{"version":3,"file":"interface.bundle.js","sources":["../src/model/range.js","../src/model/rule.js","../src/model/settings.js","../src/controls/rule/weekday.js","../src/controls/rule/range.js","../src/controls/rule/settings.js","../src/controls/joint/hint-info.js","../src/controls/joint/user-selector.js","../src/controls/link-list/list-item.js","../src/controls/link-list/list.js","../src/controls/layout.js","../src/controls/dialog-new.js","../src/controls/sharingbutton.js","../src/controls/groupsharingbutton.js","../src/interface.js","../src/controls/dialog-qr.js","../src/controls/group-sharing/groupsharing.js","../src/controls/group-sharing/groupsharingcontroller.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Util } from 'calendar.util';\nimport { CalendarSettings } from './calendar-settings';\nimport { RuleModel } from './rule';\n\nexport type RangeParams = {\n\tweekdays: number[],\n\tfrom: number,\n\tto: number,\n};\n\ntype Params = {\n\tid: number,\n\trange: RangeParams,\n\tcalendarSettings: CalendarSettings,\n\trule: RuleModel,\n};\n\nexport class RangeModel extends EventEmitter\n{\n\t#calendarSettings: CalendarSettings;\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('Calendar.Sharing.Range');\n\n\t\tconst { id, range, rule, calendarSettings, isNew } = params;\n\n\t\tthis.id = id;\n\t\tthis.rule = rule;\n\t\tthis.from = range.from;\n\t\tthis.to = range.to;\n\t\tthis.new = isNew;\n\t\tthis.deletable = false;\n\n\t\tthis.#calendarSettings = calendarSettings;\n\n\t\tthis.setWeekDays(range.weekdays);\n\t}\n\n\ttoArray(): RangeParams\n\t{\n\t\treturn {\n\t\t\tfrom: this.getFrom(),\n\t\t\tto: this.to,\n\t\t\tweekdays: this.getWeekDays(),\n\t\t};\n\t}\n\n\tgetRule(): RuleModel\n\t{\n\t\treturn this.rule;\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetFromFormatted(): string\n\t{\n\t\treturn this.formatMinutes(this.getFrom());\n\t}\n\n\tgetFrom(): number\n\t{\n\t\treturn this.from;\n\t}\n\n\tsetFrom(value): void\n\t{\n\t\tthis.from = parseInt(value, 10);\n\n\t\tif (this.from + this.#getSlotSize() > this.to)\n\t\t{\n\t\t\tthis.to = this.from + this.#getSlotSize();\n\t\t}\n\n\t\tthis.updated();\n\t}\n\n\tgetToFormatted(): string\n\t{\n\t\treturn this.formatMinutes(this.getTo());\n\t}\n\n\tgetTo(): number\n\t{\n\t\treturn this.to;\n\t}\n\n\tsetTo(value): void\n\t{\n\t\tthis.to = value;\n\t\tthis.updated();\n\t}\n\n\tupdateSlotSize(): void\n\t{\n\t\tconst maxFrom = 24 * 60 - this.#getSlotSize();\n\n\t\tif (this.from > maxFrom)\n\t\t{\n\t\t\tthis.from = maxFrom;\n\t\t\tthis.to = this.from + this.#getSlotSize();\n\t\t}\n\t\telse if (this.from + this.#getSlotSize() > this.to)\n\t\t{\n\t\t\tthis.to = this.from + this.#getSlotSize();\n\t\t}\n\n\t\tthis.updated();\n\t}\n\n\taddWeekday(weekday: number): void\n\t{\n\t\tif (this.weekdays.includes(weekday))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setWeekDays([...this.weekdays, weekday]);\n\t}\n\n\tremoveWeekday(weekday: number): void\n\t{\n\t\tthis.setWeekDays(this.weekdays.filter((w) => w !== weekday));\n\t}\n\n\tgetWeekDays(): number[]\n\t{\n\t\treturn this.weekdays;\n\t}\n\n\tsetWeekDays(weekdays: number[]): void\n\t{\n\t\tthis.weekdays = this.sortWeekdays(weekdays);\n\t\tthis.updated();\n\t}\n\n\tgetWeekdaysTitle(forceLong: boolean = false): string\n\t{\n\t\tif ([...this.weekdays].sort().join(',') === [1, 2, 3, 4, 5].sort().join(','))\n\t\t{\n\t\t\treturn Loc.getMessage('CALENDAR_SHARING_SETTINGS_WORKDAYS_MSGVER_1');\n\t\t}\n\n\t\treturn this.formatWeekdays(forceLong);\n\t}\n\n\tformatWeekdays(forceLong: boolean): string\n\t{\n\t\tconst weekdaysLoc = Util.getWeekdaysLoc(forceLong || this.weekdays.length === 1);\n\n\t\tconst weekdays = this.getWeekDays();\n\n\t\tif (weekdays.length === 0)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn weekdays.map((w) => weekdaysLoc[w]).reduce((a, b) => `${a}, ${b}`);\n\t}\n\n\tsortWeekdays(weekdays: number[]): number[]\n\t{\n\t\treturn weekdays\n\t\t\t.map((w) => (w < this.#calendarSettings.weekStart ? w + 10 : w))\n\t\t\t.sort((a, b) => a - b)\n\t\t\t.map((w) => w % 10)\n\t\t;\n\t}\n\n\tgetAvailableTimeFrom(): { value: number, name: string }[]\n\t{\n\t\tconst timeStamps = [];\n\n\t\tconst maxFrom = 24 * 60 - this.#getSlotSize();\n\t\tfor (let hour = 0; hour <= 24; hour++)\n\t\t{\n\t\t\tif (hour * 60 <= maxFrom)\n\t\t\t{\n\t\t\t\ttimeStamps.push({\n\t\t\t\t\tvalue: hour * 60,\n\t\t\t\t\tname: Util.formatTime(hour, 0),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (hour !== 24 && hour * 60 + 30 <= maxFrom)\n\t\t\t{\n\t\t\t\ttimeStamps.push({\n\t\t\t\t\tvalue: hour * 60 + 30,\n\t\t\t\t\tname: Util.formatTime(hour, 30),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn timeStamps;\n\t}\n\n\tgetAvailableTimeTo(): { value: number, name: string }[]\n\t{\n\t\tconst timeStamps = [];\n\n\t\tfor (let hour = 0; hour <= 24; hour++)\n\t\t{\n\t\t\tif (hour * 60 >= this.from + this.#getSlotSize())\n\t\t\t{\n\t\t\t\ttimeStamps.push({\n\t\t\t\t\tvalue: hour * 60,\n\t\t\t\t\tname: Util.formatTime(hour, 0),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (hour !== 24 && hour * 60 + 30 >= this.from + this.#getSlotSize())\n\t\t\t{\n\t\t\t\ttimeStamps.push({\n\t\t\t\t\tvalue: hour * 60 + 30,\n\t\t\t\t\tname: Util.formatTime(hour, 30),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn timeStamps;\n\t}\n\n\tisDeletable(): boolean\n\t{\n\t\treturn this.deletable;\n\t}\n\n\tsetDeletable(deletable: boolean): void\n\t{\n\t\tthis.deletable = deletable;\n\t}\n\n\tisNew(): boolean\n\t{\n\t\treturn this.new;\n\t}\n\n\tsetNew(isNew: boolean): void\n\t{\n\t\tthis.new = isNew;\n\t}\n\n\t#getSlotSize(): number\n\t{\n\t\treturn this.rule.getSlotSize();\n\t}\n\n\tgetWeekStart(): number\n\t{\n\t\treturn this.#calendarSettings.weekStart;\n\t}\n\n\tformatMinutes(minutes: number): string\n\t{\n\t\tconst date = new Date(Util.parseDate('01.01.2000').getTime() + minutes * 60 * 1000);\n\n\t\treturn Util.formatTime(date);\n\t}\n\n\tupdated(): void\n\t{\n\t\tthis.emit('updated');\n\t\tthis.getRule().updated();\n\t}\n}","import { Util } from 'calendar.util';\nimport { EventEmitter } from 'main.core.events';\nimport { CalendarSettings } from './calendar-settings';\nimport { RangeModel, RangeParams } from './range';\n\nexport type RuleParams = {\n\tslotSize: number,\n\tranges: RangeParams[],\n};\n\ntype Params = {\n\trule: RuleParams,\n\tcalendarSettings: CalendarSettings,\n};\n\nexport class RuleModel extends EventEmitter\n{\n\tAVAILABLE_INTERVALS = [30, 45, 60, 90, 120, 180];\n\tMAX_RANGES = 5;\n\tDEFAULT_SLOT_SIZE = 60;\n\n\t#calendarSettings: CalendarSettings;\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('Calendar.Sharing.Rule');\n\n\t\tconst { rule, calendarSettings } = params;\n\n\t\tthis.#calendarSettings = calendarSettings;\n\n\t\tthis.ranges = [];\n\t\tfor (const range of rule.ranges)\n\t\t{\n\t\t\tthis.addRange(range, false);\n\t\t}\n\n\t\tthis.setSlotSize(rule.slotSize);\n\t\tthis.sortRanges();\n\t}\n\n\ttoArray(): RuleParams\n\t{\n\t\treturn {\n\t\t\tslotSize: this.getSlotSize(),\n\t\t\tranges: this.getSortedRanges().map((range) => range.toArray()),\n\t\t};\n\t}\n\n\tgetDefaultRule(): RuleModel\n\t{\n\t\treturn new RuleModel({\n\t\t\trule: {\n\t\t\t\tslotSize: this.DEFAULT_SLOT_SIZE,\n\t\t\t\tranges: [{\n\t\t\t\t\tfrom: this.#calendarSettings.workTimeStart,\n\t\t\t\t\tto: this.#calendarSettings.workTimeEnd,\n\t\t\t\t\tweekdays: this.#calendarSettings.workDays,\n\t\t\t\t}],\n\t\t\t},\n\t\t\tcalendarSettings: this.#calendarSettings,\n\t\t});\n\t}\n\n\tgetAvailableIntervals(): number[]\n\t{\n\t\treturn this.AVAILABLE_INTERVALS;\n\t}\n\n\tgetFormattedSlotSize(): string\n\t{\n\t\treturn Util.formatDuration(this.getSlotSize());\n\t}\n\n\tgetSlotSize(): number\n\t{\n\t\treturn this.slotSize;\n\t}\n\n\tsetSlotSize(value)\n\t{\n\t\tconst slotSize = parseInt(value, 10);\n\t\tthis.slotSize = this.getAvailableIntervals().includes(slotSize) ? slotSize : this.DEFAULT_SLOT_SIZE;\n\t\tfor (const range of this.getRanges())\n\t\t{\n\t\t\trange.updateSlotSize();\n\t\t}\n\t}\n\n\tgetRanges(): RangeModel[]\n\t{\n\t\treturn this.ranges;\n\t}\n\n\tsortRanges()\n\t{\n\t\tthis.ranges = this.getSortedRanges();\n\t}\n\n\tgetSortedRanges()\n\t{\n\t\treturn [...this.ranges].sort((a, b) => this.compareRanges(a, b));\n\t}\n\n\tcompareRanges(firstRange, secondRange): 1 | 0 | -1\n\t{\n\t\tconst firstWeekdaysWeight = this.getWeekdaysWeight(firstRange.getWeekDays());\n\t\tconst secondWeekdaysWeight = this.getWeekdaysWeight(secondRange.getWeekDays());\n\n\t\tif (firstWeekdaysWeight !== secondWeekdaysWeight)\n\t\t{\n\t\t\treturn firstWeekdaysWeight - secondWeekdaysWeight;\n\t\t}\n\n\t\tif (firstRange.getFrom() !== secondRange.getFrom())\n\t\t{\n\t\t\treturn firstRange.getFrom() - secondRange.getFrom();\n\t\t}\n\n\t\treturn firstRange.getTo() - secondRange.getTo();\n\t}\n\n\tgetWeekdaysWeight(weekdays): number\n\t{\n\t\treturn weekdays.reduce((accumulator, w, index) => {\n\t\t\treturn accumulator + w * 10 ** (10 - index);\n\t\t}, 0);\n\t}\n\n\taddRange(range, isNew = true): void\n\t{\n\t\tif (!this.canAddRange())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.internalRangeId ??= 1;\n\n\t\tthis.ranges.push(\n\t\t\tnew RangeModel({\n\t\t\t\tid: this.internalRangeId++,\n\t\t\t\trange: range ?? this.getDefaultRule().getRanges()[0],\n\t\t\t\tcalendarSettings: this.#calendarSettings,\n\t\t\t\tisNew,\n\t\t\t\trule: this,\n\t\t\t}),\n\t\t);\n\n\t\tthis.#updateRanges();\n\t\tthis.updated();\n\t}\n\n\tremoveRange(rangeToRemove: RangeModel): boolean\n\t{\n\t\tif (!this.canRemoveRange())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.ranges = this.ranges.filter((range) => {\n\t\t\treturn range.getId() !== rangeToRemove.getId();\n\t\t});\n\n\t\tthis.#updateRanges();\n\t\tthis.rangeDeleted();\n\n\t\treturn true;\n\t}\n\n\t#updateRanges()\n\t{\n\t\tfor (const range of this.ranges.slice(0, -1))\n\t\t{\n\t\t\trange.setDeletable(true);\n\t\t}\n\n\t\tthis.ranges.slice(-1)[0].setDeletable(this.ranges.length === 5);\n\t}\n\n\tcanAddRange(): boolean\n\t{\n\t\treturn this.ranges.length < this.MAX_RANGES;\n\t}\n\n\tcanRemoveRange(): boolean\n\t{\n\t\treturn this.ranges.length > 1;\n\t}\n\n\tupdated(): void\n\t{\n\t\tthis.emit('updated');\n\t}\n\n\trangeDeleted(): void\n\t{\n\t\tthis.emit('rangeDeleted');\n\t}\n}","import { Util } from 'calendar.util';\nimport { EventEmitter } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\nimport { Analytics } from 'calendar.sharing.analytics';\nimport { Context } from './context';\nimport { RuleModel, RuleParams } from './rule';\nimport { User } from './user';\nimport { CalendarContext } from './calendar-context';\n\nexport type CalendarSettings = {\n\tweekStart: string,\n\tweekHolidays: string[],\n\tworkTimeStart: string,\n\tworkTimeEnd: string,\n};\n\nexport type SettingsParams = {\n\tcontext: Context,\n\tlinkHash: string,\n\tsharingUrl: string,\n\tuserInfo: User,\n\n\trule: RuleParams,\n\tcalendarSettings: CalendarSettings,\n\tcollapsed: boolean,\n\tsortJointLinksByFrequentUse: boolean,\n\tcalendarContext: CalendarContext | null,\n};\n\nexport class SettingsModel\n{\n\t#params: SettingsParams;\n\t#rule: RuleModel;\n\t#memberIds: number[];\n\n\tconstructor(params: SettingsParams)\n\t{\n\t\tthis.#params = params;\n\n\t\tconst { rule, calendarSettings } = params;\n\n\t\tthis.#rule = this.#createRuleModel(rule, calendarSettings);\n\t}\n\n\t#createRuleModel(rule: RuleParams, calendarSettings: CalendarSettings)\n\t{\n\t\tconst { weekStart, weekHolidays, workTimeStart, workTimeEnd } = calendarSettings;\n\n\t\treturn new RuleModel({\n\t\t\trule,\n\t\t\tcalendarSettings: {\n\t\t\t\tweekStart: Util.getIndByWeekDay(weekStart),\n\t\t\t\tworkTimeStart: this.getMinutesFromTime(workTimeStart),\n\t\t\t\tworkTimeEnd: this.getMinutesFromTime(workTimeEnd),\n\t\t\t\tworkDays: this.getWorkingDays(weekHolidays),\n\t\t\t},\n\t\t});\n\t}\n\n\tgetMinutesFromTime(time: string): number\n\t{\n\t\tconst dateString = new Date().toDateString();\n\t\tconst date = new Date(`${dateString} ${`${time}`.replace('.', ':')}:00`);\n\n\t\tconst shortTimeFormat = DateTimeFormat.getFormat('SHORT_TIME_FORMAT');\n\t\tconst parsedTime = Util.parseTime(DateTimeFormat.format(shortTimeFormat, date / 1000));\n\n\t\treturn parsedTime.h * 60 + parsedTime.m;\n\t}\n\n\tgetWorkingDays(weekHolidays): number[]\n\t{\n\t\tconst weekHolidaysInt = new Set(weekHolidays.map((day) => Util.getIndByWeekDay(day)));\n\n\t\treturn [0, 1, 2, 3, 4, 5, 6].filter((day) => !weekHolidaysInt.has(day));\n\t}\n\n\tisDefaultRule(): boolean\n\t{\n\t\treturn !this.isDifferentFrom(this.getRule().getDefaultRule());\n\t}\n\n\tisDifferentFrom(anotherRule: RuleModel): boolean\n\t{\n\t\treturn this.getChanges(anotherRule, this.getRule()).length > 0;\n\t}\n\n\tgetChanges(rule: RuleModel): string[]\n\t{\n\t\tconst currentRule = this.getRule().toArray();\n\t\tconst anotherRule = (rule ?? this.getRule().getDefaultRule()).toArray();\n\n\t\tconst sizeChanged = currentRule.slotSize !== anotherRule.slotSize;\n\t\tconst daysChanged = JSON.stringify(currentRule.ranges) !== JSON.stringify(anotherRule.ranges);\n\n\t\tconst changes = [];\n\n\t\tif (daysChanged)\n\t\t{\n\t\t\tchanges.push(Analytics.ruleChanges.custom_days);\n\t\t}\n\n\t\tif (sizeChanged)\n\t\t{\n\t\t\tchanges.push(Analytics.ruleChanges.custom_length);\n\t\t}\n\n\t\treturn changes;\n\t}\n\n\tsortRanges(): void\n\t{\n\t\tthis.getRule().sortRanges();\n\t}\n\n\tgetRule(): RuleModel\n\t{\n\t\treturn this.#rule;\n\t}\n\n\tgetUserInfo(): User\n\t{\n\t\treturn this.#params.userInfo;\n\t}\n\n\tgetContext(): Context\n\t{\n\t\treturn this.#params.context;\n\t}\n\n\tgetLinkHash(): string\n\t{\n\t\treturn this.#params.linkHash;\n\t}\n\n\tgetSharingUrl(): string\n\t{\n\t\treturn this.#params.sharingUrl;\n\t}\n\n\tisCollapsed(): boolean\n\t{\n\t\treturn this.#params.collapsed;\n\t}\n\n\tsortJointLinksByFrequentUse(): boolean\n\t{\n\t\treturn this.#params.sortJointLinksByFrequentUse;\n\t}\n\n\tgetCalendarContext(): CalendarContext | null\n\t{\n\t\treturn this.#params.calendarContext;\n\t}\n\n\tchangeSortJointLinksByFrequentUse()\n\t{\n\t\tthis.#params.sortJointLinksByFrequentUse = !this.#params.sortJointLinksByFrequentUse;\n\t\tthis.#updateSortByFrequentUse();\n\t}\n\n\tsetMemberIds(memberIds: number[]): void\n\t{\n\t\tthis.#memberIds = memberIds;\n\t}\n\n\tgetMemberIds(): number[]\n\t{\n\t\treturn this.#memberIds;\n\t}\n\n\tasync saveJointLink(): Promise\n\t{\n\t\tconst action = this.#params.calendarContext?.sharingObjectType === 'group'\n\t\t\t? 'calendar.api.sharinggroupajax.generateJointSharingLink'\n\t\t\t: 'calendar.api.sharingajax.generateUserJointSharingLink'\n\t\t;\n\t\tconst response = await BX.ajax.runAction(action, {\n\t\t\tdata: {\n\t\t\t\tmemberIds: this.getMemberIds(),\n\t\t\t\tgroupId: this.#params.calendarContext?.sharingObjectId,\n\t\t\t},\n\t\t});\n\n\t\treturn response.data;\n\t}\n\n\tsave(): Promise\n\t{\n\t\tif (!this.isDifferentFrom(this.#createRuleModel(this.#params.rule, this.#params.calendarSettings)))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst changes = this.getChanges();\n\t\tAnalytics.sendRuleUpdated(this.getContext(), changes);\n\n\t\tconst newRule = this.getRule().toArray();\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.ajax.runAction('calendar.api.sharingajax.saveLinkRule', {\n\t\t\t\tdata: {\n\t\t\t\t\tlinkHash: this.getLinkHash(),\n\t\t\t\t\truleArray: newRule,\n\t\t\t\t},\n\t\t\t}).then(() => {\n\t\t\t\tEventEmitter.emit('CalendarSharing:RuleUpdated');\n\t\t\t\tthis.#params.rule = newRule;\n\t\t\t\tresolve();\n\t\t\t}, (error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error(error);\n\t\t\t\treject();\n\t\t\t});\n\t\t});\n\t}\n\n\tincreaseFrequentUse(): void\n\t{\n\t\tvoid BX.ajax.runAction('calendar.api.sharingajax.increaseFrequentUse', {\n\t\t\tdata: {\n\t\t\t\thash: this.getLinkHash(),\n\t\t\t},\n\t\t});\n\t}\n\n\tupdateCollapsed(isCollapsed: boolean): void\n\t{\n\t\tvoid BX.ajax.runAction('calendar.api.sharingajax.updateSharingSettingsCollapsed', {\n\t\t\tdata: {\n\t\t\t\tcollapsed: isCollapsed ? 'Y' : 'N',\n\t\t\t},\n\t\t});\n\t}\n\n\t#updateSortByFrequentUse(): void\n\t{\n\t\tBX.ajax.runAction('calendar.api.sharingajax.setSortJointLinksByFrequentUse', {\n\t\t\tdata: {\n\t\t\t\tsortByFrequentUse: this.#params.sortJointLinksByFrequentUse ? 'Y' : 'N',\n\t\t\t},\n\t\t});\n\t}\n}\n","import { Dom, Tag, Type } from 'main.core';\n\ntype WeekdayOptions = {\n\tname: string,\n\tindex: number,\n\tactive: boolean,\n\tonSelected: void,\n\tonDiscarded: void,\n\tonMouseDown: void,\n\tcanBeDiscarded: void,\n}\n\nexport default class Weekday\n{\n\tconstructor(options: WeekdayOptions)\n\t{\n\t\tthis.wrap = null;\n\t\tthis.name = options.name;\n\t\tthis.index = options.index;\n\t\tthis.active = options.active;\n\t\tthis.onSelected = Type.isFunction(options.onSelected) ? options.onSelected : () => {};\n\n\t\tthis.onDiscarded = Type.isFunction(options.onDiscarded) ? options.onDiscarded : () => {};\n\n\t\tthis.onMouseDown = Type.isFunction(options.onMouseDown) ? options.onMouseDown : () => {};\n\n\t\tthis.canBeDiscarded = Type.isFunction(options.canBeDiscarded) ? options.canBeDiscarded : () => {};\n\t}\n\n\trender()\n\t{\n\t\tconst className = this.active ? '--selected' : '';\n\n\t\tthis.wrap = Tag.render`\n\t\t\t<div class=\"calendar-sharing__settings-popup-weekday ${className}\" onmousedown=\"${(e) => this.handleMouseDown(e)}\">\n\t\t\t\t<div class=\"calendar-sharing__settings-popup-weekday-text\">${this.name}</div>\n\t\t\t\t<div class=\"calendar-sharing__settings-popup-weekday-icon\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.wrap;\n\t}\n\n\thandleMouseDown(event)\n\t{\n\t\tif (this.active)\n\t\t{\n\t\t\tthis.discard();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.select();\n\t\t}\n\t\tthis.onMouseDown(event, this);\n\t}\n\n\tselect()\n\t{\n\t\tthis.active = true;\n\t\tDom.addClass(this.wrap, '--selected');\n\t\tthis.onSelected();\n\t}\n\n\tdiscard()\n\t{\n\t\tif (!this.canBeDiscarded())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.active = false;\n\t\tDom.removeClass(this.wrap, '--selected');\n\t\tthis.onDiscarded();\n\t}\n}\n","import { Dom, Tag, Type, Event } from 'main.core';\nimport Weekday from './weekday';\nimport { MenuManager, Popup, PopupManager } from 'main.popup';\nimport { Util } from 'calendar.util';\nimport { RangeModel } from '../../model/index';\n\ntype Params = {\n\treadOnly: boolean,\n\tmodel: RangeModel,\n\tshowReadOnlyPopup: function,\n};\n\nexport default class Range\n{\n\t#params: Params;\n\t#layout: {\n\t\twrap: HTMLElement,\n\t\tweekdaysSelect: HTMLElement,\n\t\tfromTimeSelect: HTMLElement,\n\t\ttoTimeSelect: HTMLElement,\n\t\tbutton: HTMLElement,\n\t};\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#params = params;\n\t\tthis.#layout = {};\n\n\t\tthis.showReadOnlyPopup = Type.isFunction(params.showReadOnlyPopup) ? params.showReadOnlyPopup : () => {};\n\t\tthis.onRangeUpdated = this.#onRangeUpdated.bind(this);\n\n\t\tthis.#bindEvents();\n\t}\n\n\tget #model(): RangeModel\n\t{\n\t\treturn this.#params.model;\n\t}\n\n\thasShownPopups(): boolean\n\t{\n\t\tconst weekdaysPopupShown = this.weekdaysMenu.isShown();\n\t\tconst startPopupShown = Dom.hasClass(this.#layout.fromTimeSelect, '--active');\n\t\tconst endPopupShown = Dom.hasClass(this.#layout.toTimeSelect, '--active');\n\n\t\treturn weekdaysPopupShown || startPopupShown || endPopupShown;\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tthis.#model.subscribe('updated', this.onRangeUpdated);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#layout.wrap.remove();\n\t\tthis.#unbindEvents();\n\t}\n\n\t#unbindEvents(): void\n\t{\n\t\tthis.#model.unsubscribe('updated', this.onRangeUpdated);\n\t}\n\n\t#onRangeUpdated(): void\n\t{\n\t\tthis.updateWeekdaysTitle();\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#layout.wrap = Tag.render`\n\t\t\t<div class=\"calendar-sharing__settings-range\">\n\t\t\t\t${this.#renderWeekdaysSelect()}\n\t\t\t\t<div class=\"calendar-sharing__settings-time-interval\">\n\t\t\t\t\t${this.#renderTimeFromSelect()}\n\t\t\t\t\t<div class=\"calendar-sharing__settings-dash\"></div>\n\t\t\t\t\t${this.#renderTimeToSelect()}\n\t\t\t\t</div>\n\t\t\t\t${this.renderButton()}\n\t\t\t</div>\n\t\t`;\n\n\t\tif (this.#model.isNew())\n\t\t{\n\t\t\tthis.#animate();\n\t\t}\n\n\t\treturn this.#layout.wrap;\n\t}\n\n\t#animate(): void\n\t{\n\t\tDom.addClass(this.#layout.wrap, '--animate-show');\n\t\tsetTimeout(() => {\n\t\t\tDom.removeClass(this.#layout.wrap, '--animate-show');\n\t\t\tthis.#model.setNew(false);\n\t\t}, 300);\n\t}\n\n\trenderButton(): HTMLElement\n\t{\n\t\tconst button = this.#getButton();\n\n\t\tthis.#layout.button?.replaceWith(button);\n\t\tthis.#layout.button = button;\n\n\t\treturn this.#layout.button;\n\t}\n\n\t#getButton(): HTMLElement\n\t{\n\t\tif (this.#model.isDeletable())\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"calendar-sharing__settings-delete\"\n\t\t\t\t\tonclick=\"${this.#onDeleteButtonClickHandler.bind(this)}\"\n\t\t\t\t></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"calendar-sharing__settings-add\"\n\t\t\t\tonclick=\"${this.#onAddButtonClickHandler.bind(this)}\"\n\t\t\t></div>\n\t\t`;\n\t}\n\n\t#onDeleteButtonClickHandler(): void\n\t{\n\t\tif (this.#params.readOnly)\n\t\t{\n\t\t\tthis.showReadOnlyPopup(this.#layout.button);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#remove();\n\t\t}\n\t}\n\n\t#onAddButtonClickHandler(): void\n\t{\n\t\tif (this.#params.readOnly)\n\t\t{\n\t\t\tthis.showReadOnlyPopup(this.#layout.button);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#add();\n\t\t}\n\t}\n\n\t#add(): void\n\t{\n\t\tthis.#model.getRule().addRange();\n\t}\n\n\t#remove(): void\n\t{\n\t\tif (!this.#model.getRule().removeRange(this.#model))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.#layout.wrap, '--animate-remove');\n\t\tsetTimeout(() => this.destroy(), 300);\n\t}\n\n\t#renderWeekdaysSelect(): HTMLElement\n\t{\n\t\tconst weekdaysLoc = Util.getWeekdaysLoc().map((loc, index) => {\n\t\t\treturn {\n\t\t\t\tloc,\n\t\t\t\tindex,\n\t\t\t\tactive: this.#model.getWeekDays().includes(index),\n\t\t\t};\n\t\t});\n\t\tweekdaysLoc.push(...weekdaysLoc.splice(0, this.#model.getWeekStart()));\n\n\t\tthis.#layout.weekdaysSelect = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"calendar-sharing__settings-weekdays calendar-sharing__settings-select calendar-sharing__settings-select-arrow\"\n\t\t\t\ttitle=\"${ this.#model.formatWeekdays()}\"\n\t\t\t>\n\t\t\t\t${this.#model.getWeekdaysTitle()}\n\t\t\t</div>\n\t\t`;\n\n\t\tconst observer = new IntersectionObserver(() => {\n\t\t\tif (this.#layout.weekdaysSelect.offsetWidth > 0)\n\t\t\t{\n\t\t\t\tthis.updateWeekdaysTitle();\n\t\t\t}\n\t\t});\n\t\tobserver.observe(this.#layout.weekdaysSelect);\n\n\t\tEvent.bind(this.#layout.weekdaysSelect, 'click', this.#onWeekdaysSelectClickHandler.bind(this));\n\n\t\tthis.weekdays = weekdaysLoc.map((weekdayLoc) => this.#createWeekday(weekdayLoc));\n\n\t\tconst weekdaysPopupId = `calendar-sharing-settings-weekdays-${this.#params.model.id}`;\n\t\tthis.weekdaysMenu = PopupManager.getPopupById(weekdaysPopupId);\n\t\tif (!this.weekdaysMenu)\n\t\t{\n\t\t\tthis.weekdaysMenu = this.#createWeekdaysPopup(weekdaysPopupId);\n\t\t\tthis.weekdaysMenu.canBeClosed = true;\n\t\t}\n\t\tthis.weekdaysMenu.setBindElement(this.#layout.weekdaysSelect);\n\n\t\treturn this.#layout.weekdaysSelect;\n\t}\n\n\tupdateWeekdaysTitle(): void\n\t{\n\t\tthis.#layout.weekdaysSelect.title = this.#model.formatWeekdays(false);\n\n\t\tthis.#layout.weekdaysSelect.innerText = this.#model.getWeekdaysTitle(true);\n\t\tconst weekdaysSelectWidth = this.#layout.weekdaysSelect.offsetWidth - 32;\n\t\tconst weekdaysTextWidth = this.#getTextNodeWidth(this.#layout.weekdaysSelect.firstChild);\n\t\tconst weekdaysWidthIsOverflowing = weekdaysSelectWidth < weekdaysTextWidth;\n\t\tif (weekdaysWidthIsOverflowing)\n\t\t{\n\t\t\tthis.#layout.weekdaysSelect.innerText = this.#model.getWeekdaysTitle(false);\n\t\t}\n\t}\n\n\t#getTextNodeWidth(textNode): number\n\t{\n\t\tconst spanNode = BX.Tag.render`<span style=\"position: absolute;\">${textNode.cloneNode()}</span>`;\n\t\ttextNode.replaceWith(spanNode);\n\t\tconst textWidth = spanNode.offsetWidth;\n\t\tspanNode.replaceWith(textNode);\n\n\t\treturn textWidth;\n\t}\n\n\t#createWeekdaysPopup(id: string): Popup\n\t{\n\t\treturn new Popup({\n\t\t\tid,\n\t\t\tcontent: Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__settings-popup-weekdays\">\n\t\t\t\t\t${this.weekdays.map((weekday) => weekday.render())}\n\t\t\t\t</div>\n\t\t\t`,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tangle: {\n\t\t\t\tposition: 'top',\n\t\t\t\toffset: 105,\n\t\t\t},\n\t\t\tautoHideHandler: () => this.weekdaysMenu.canBeClosed,\n\t\t\tevents: {\n\t\t\t\tonPopupShow: () => Dom.addClass(this.#layout.weekdaysSelect, '--active'),\n\t\t\t\tonPopupClose: () => Dom.removeClass(this.#layout.weekdaysSelect, '--active'),\n\t\t\t},\n\t\t});\n\t}\n\n\t#createWeekday(weekdayLoc): Weekday\n\t{\n\t\treturn new Weekday({\n\t\t\tname: weekdayLoc.loc,\n\t\t\tindex: weekdayLoc.index,\n\t\t\tactive: weekdayLoc.active,\n\t\t\tonSelected: () => this.#model.addWeekday(weekdayLoc.index),\n\t\t\tonDiscarded: () => this.#model.removeWeekday(weekdayLoc.index),\n\t\t\tcanBeDiscarded: () => this.#model.getWeekDays().length > 1,\n\t\t\tonMouseDown: this.#onWeekdayMouseDown.bind(this),\n\t\t});\n\t}\n\n\t#onWeekdayMouseDown(event, currentWeekday): void\n\t{\n\t\tthis.weekdaysMenu.canBeClosed = false;\n\t\tconst startX = event.clientX;\n\t\tconst select = currentWeekday.active;\n\t\tthis.controllableWeekdays = [];\n\n\t\tthis.collectIntersectedWeekdays = (e) => {\n\t\t\tfor (const weekday of this.weekdays)\n\t\t\t{\n\t\t\t\tconst right = weekday.wrap.getBoundingClientRect().right;\n\t\t\t\tconst left = weekday.wrap.getBoundingClientRect().left;\n\n\t\t\t\tif (\n\t\t\t\t\t(startX > right && e.clientX < right)\n\t\t\t\t\t|| (startX < left && e.clientX > left)\n\t\t\t\t\t|| (left < startX && startX < right)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tif (!this.controllableWeekdays.includes(weekday))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.controllableWeekdays.push(weekday);\n\t\t\t\t\t}\n\t\t\t\t\tweekday.intersected = true;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.onMouseMove = (e) => {\n\t\t\tthis.controllableWeekdays.forEach((controllableWeekday) => {\n\t\t\t\tcontrollableWeekday.intersected = false;\n\t\t\t});\n\n\t\t\tthis.collectIntersectedWeekdays(e);\n\n\t\t\tfor (const weekday of this.controllableWeekdays)\n\t\t\t{\n\t\t\t\tif ((weekday.intersected && select) || (!weekday.intersected && !select))\n\t\t\t\t{\n\t\t\t\t\tweekday.select();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tweekday.discard();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tEvent.bind(document, 'mousemove', this.onMouseMove);\n\t\tEvent.bind(document, 'mouseup', () => {\n\t\t\tEvent.unbind(document, 'mousemove', this.onMouseMove);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.weekdaysMenu.canBeClosed = true;\n\t\t\t}, 0);\n\t\t});\n\t}\n\n\t#renderTimeFromSelect(): HTMLElement\n\t{\n\t\tthis.#layout.fromTimeSelect = this.#renderTimeSelect(this.#model.getFromFormatted(), {\n\t\t\tgetTimeStamps: () => this.#model.getAvailableTimeFrom(),\n\t\t\tisSelected: (minutes) => this.#model.getFrom() === minutes,\n\t\t\tonItemSelected: (minutes) => this.#model.setFrom(minutes),\n\t\t}, 'calendar-sharing-settings-range-from');\n\n\t\treturn this.#layout.fromTimeSelect;\n\t}\n\n\t#renderTimeToSelect(): HTMLElement\n\t{\n\t\tthis.#layout.toTimeSelect = this.#renderTimeSelect(this.#model.getToFormatted(), {\n\t\t\tgetTimeStamps: () => this.#model.getAvailableTimeTo(),\n\t\t\tisSelected: (minutes) => this.#model.getTo() === minutes,\n\t\t\tonItemSelected: (minutes) => this.#model.setTo(minutes),\n\t\t}, 'calendar-sharing-settings-range-to');\n\n\t\treturn this.#layout.toTimeSelect;\n\t}\n\n\t#renderTimeSelect(time, callbacks, dataId): HTMLElement\n\t{\n\t\tconst timeSelect = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"calendar-sharing__settings-select calendar-sharing__settings-time calendar-sharing__settings-select-arrow\"\n\t\t\t\tdata-id=\"${dataId}\"\n\t\t\t>\n\t\t\t\t${this.formatAmPmSpan(time)}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(timeSelect, 'click', () => this.#onTimeSelectClickHandler(timeSelect, callbacks));\n\n\t\treturn timeSelect;\n\t}\n\n\t#onTimeSelectClickHandler(timeSelect, callbacks): void\n\t{\n\t\tif (this.#params.readOnly)\n\t\t{\n\t\t\tthis.showReadOnlyPopup(timeSelect);\n\t\t}\n\t\telse if (!Dom.hasClass(timeSelect, '--active'))\n\t\t{\n\t\t\tthis.#showTimeMenu(timeSelect, callbacks);\n\t\t}\n\t}\n\n\t#showTimeMenu(timeSelect, callbacks): void\n\t{\n\t\tlet timeMenu;\n\n\t\tconst items = callbacks.getTimeStamps().map((timeStamp) => {\n\t\t\treturn {\n\t\t\t\thtml: Tag.render`\n\t\t\t\t\t<div class=\"calendar-sharing__am-pm-container\">${timeStamp.name}</div>\n\t\t\t\t`,\n\t\t\t\tclassName: callbacks.isSelected(timeStamp.value) ? 'menu-popup-no-icon --selected' : 'menu-popup-no-icon',\n\t\t\t\tonclick: () => {\n\t\t\t\t\ttimeSelect.innerHTML = timeStamp.name;\n\t\t\t\t\tcallbacks.onItemSelected(timeStamp.value);\n\t\t\t\t\ttimeMenu.close();\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\n\t\ttimeMenu = MenuManager.create({\n\t\t\tid: `calendar-sharing-settings-time-menu${Date.now()}`,\n\t\t\tclassName: 'calendar-sharing-settings-time-menu',\n\t\t\tbindElement: timeSelect,\n\t\t\titems,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tevents: {\n\t\t\t\tonShow: () => Dom.addClass(timeSelect, '--active'),\n\t\t\t\tonClose: () => Dom.removeClass(timeSelect, '--active'),\n\t\t\t},\n\t\t\tmaxHeight: 300,\n\t\t\tminWidth: timeSelect.offsetWidth,\n\t\t});\n\t\ttimeMenu.show();\n\n\t\tconst timezonesPopup = timeMenu.getPopupWindow();\n\t\tconst popupContent = timezonesPopup.getContentContainer();\n\t\tconst selectedTimezoneItem = popupContent.querySelector('.menu-popup-item.--selected');\n\t\tpopupContent.scrollTop = selectedTimezoneItem.offsetTop - selectedTimezoneItem.offsetHeight * 2;\n\t}\n\n\t#onWeekdaysSelectClickHandler(): void\n\t{\n\t\tif (this.#params.readOnly)\n\t\t{\n\t\t\tthis.showReadOnlyPopup(this.#layout.weekdaysSelect);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.weekdaysMenu.show();\n\t\t}\n\t}\n\n\tformatAmPmSpan(time): string\n\t{\n\t\treturn time.toLowerCase().replace(/(am|pm)/g, '<span class=\"calendar-sharing__settings-time-am-pm\">$1</span>');\n\t}\n}\n","import { Dom, Event, Loc, Tag } from 'main.core';\nimport { Popup, MenuManager } from 'main.popup';\nimport { Util } from 'calendar.util';\nimport Range from './range';\nimport { SettingsModel, RuleModel } from '../../model/index';\n\nimport '../../css/settings.css';\n\nexport type Params = {\n\treadOnly: boolean,\n\tmodel: SettingsModel,\n};\n\nexport default class Settings\n{\n\t#params: Params;\n\n\t#layout: {\n\t\twrap: HTMLElement,\n\t\tsubtitle: HTMLElement,\n\t\texpandRuleArrow: HTMLElement,\n\t\texpandRuleButton: HTMLElement,\n\t\trule: HTMLElement,\n\t\tweekdaysSelect: HTMLElement,\n\t\tslotSizeText: HTMLElement,\n\t\tslotSizeSelect: HTMLElement,\n\t\trangesContainer: HTMLElement,\n\t\tranges: Range[],\n\t};\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#params = params;\n\t\tthis.#layout = {};\n\n\t\tthis.readOnly = params.readOnly;\n\n\t\tthis.#bindEvents();\n\t}\n\n\tget #model(): SettingsModel\n\t{\n\t\treturn this.#params.model;\n\t}\n\n\tget #rule(): RuleModel\n\t{\n\t\treturn this.#model.getRule();\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tthis.#rule.subscribe('updated', this.#onRuleUpdated.bind(this));\n\t\tthis.#rule.subscribe('rangeDeleted', this.#onRangeDeleted.bind(this));\n\t}\n\n\t#onRuleUpdated(): void\n\t{\n\t\tthis.#updateSubtitle();\n\t\tthis.#removeRuleHeight();\n\t\tthis.#renderRanges();\n\t}\n\n\t#onRangeDeleted()\n\t{\n\t\tthis.#updateSubtitle();\n\t\tthis.#removeRuleHeight();\n\t\tthis.#layout.ranges.forEach((range) => range.renderButton());\n\t}\n\n\thasShownPopups(): boolean\n\t{\n\t\tconst rangesWithPopup = this.#layout.ranges.filter((range) => range.hasShownPopups()) ?? [];\n\t\tconst rangePopupShown = rangesWithPopup.length > 0;\n\t\tconst slotSizePopupShown = Dom.hasClass(this.#layout.slotSizeSelect, '--active');\n\t\tconst readOnlyPopupShown = this.readOnlyPopup?.isShown();\n\n\t\treturn rangePopupShown || slotSizePopupShown || readOnlyPopupShown;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst readOnlyClass = this.readOnly ? '--read-only' : '';\n\t\tconst expandedClass = this.#model.isCollapsed() ? '--hide' : '';\n\t\tconst contextClass = `--${this.#model.getContext()}`;\n\n\t\tthis.#layout.wrap = Tag.render`\n\t\t\t<div class=\"calendar-sharing__settings ${readOnlyClass} ${expandedClass} ${contextClass}\">\n\t\t\t\t${this.#renderHeader()}\n\t\t\t\t${this.#renderRule()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#layout.wrap;\n\t}\n\n\t#renderHeader(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__settings-header-container\">\n\t\t\t\t<div class=\"calendar-sharing__settings-header\">\n\t\t\t\t\t<div class=\"calendar-sharing__settings-title\">\n\t\t\t\t\t\t${Loc.getMessage('CALENDAR_SHARING_SETTINGS_TITLE_V2')}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#renderSubtitle()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"calendar-sharing__settings-header-button\">\n\t\t\t\t\t${this.#renderExpandRuleButton()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderSubtitle(): HTMLElement\n\t{\n\t\tthis.#layout.subtitle = Tag.render`\n\t\t\t<div class=\"calendar-sharing__settings-subtitle\">\n\t\t\t\t${this.#getSubtitleText()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#layout.subtitle;\n\t}\n\n\t#updateSubtitle(): void\n\t{\n\t\tif (!this.#layout.subtitle)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#layout.subtitle.innerText = this.#getSubtitleText();\n\t}\n\n\t#getSubtitleText(): string\n\t{\n\t\tif (this.#model.isDefaultRule())\n\t\t{\n\t\t\treturn Loc.getMessage('CALENDAR_SHARING_SETTINGS_SUBTITLE_DEFAULT');\n\t\t}\n\n\t\treturn Loc.getMessage('CALENDAR_SHARING_SETTINGS_SUBTITLE_PERSONAL');\n\t}\n\n\t#renderExpandRuleButton(): HTMLElement|string\n\t{\n\t\tif (this.readOnly)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tthis.#layout.expandRuleArrow = Tag.render`\n\t\t\t<div class=\"calendar-sharing__settings-select-arrow ${this.#model.isCollapsed() ? '' : '--active'}\"></div>\n\t\t`;\n\n\t\tthis.#layout.expandRuleButton = Tag.render`\n\t\t\t<div class=\"calendar-sharing__settings-expand\">\n\t\t\t\t${this.#layout.expandRuleArrow}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#layout.expandRuleButton, 'click', this.#toggleExpand.bind(this));\n\n\t\treturn this.#layout.expandRuleButton;\n\t}\n\n\t#renderRule(): HTMLElement\n\t{\n\t\tthis.#layout.rule = Tag.render`\n\t\t\t<div class=\"calendar-sharing__settings-rule\">\n\t\t\t\t${this.#renderRanges()}\n\t\t\t\t<div class=\"calendar-sharing__settings-slotSize\">\n\t\t\t\t\t<span class=\"calendar-sharing__settings-slotSize-title\">${Loc.getMessage('CALENDAR_SHARING_SETTINGS_SLOT_SIZE_V2')}</span>\n\t\t\t\t\t${this.#renderSettingsSlotSizeSelect()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#layout.rule;\n\t}\n\n\t#toggleExpand(): void\n\t{\n\t\tthis.#updateRuleHeight();\n\t\tsetTimeout(() => {\n\t\t\tDom.toggleClass(this.#layout.wrap, '--hide');\n\t\t\tDom.toggleClass(this.#layout.expandRuleArrow, '--active');\n\n\t\t\tthis.#model.updateCollapsed(Dom.hasClass(this.#layout.wrap, '--hide'));\n\t\t}, 0);\n\t}\n\n\t#updateRuleHeight(): void\n\t{\n\t\tDom.style(this.#layout.rule, 'height', `${this.#calculateRuleHeight()}px`);\n\t}\n\n\t#renderRanges(): HTMLElement\n\t{\n\t\tthis.#layout.ranges?.forEach((range) => range.destroy());\n\t\tthis.#layout.ranges = this.#rule.getRanges().map((range) => this.#createRange(range));\n\n\t\tconst rangesContainer = Tag.render`\n\t\t\t<div class=\"calendar-sharing__settings-range-list\">\n\t\t\t\t${this.#layout.ranges.map((range) => range.render())}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#layout.rangesContainer?.replaceWith(rangesContainer);\n\t\tthis.#layout.rangesContainer = rangesContainer;\n\n\t\tthis.#layout.ranges.forEach((range) => range.updateWeekdaysTitle());\n\n\t\treturn rangesContainer;\n\t}\n\n\t#createRange(range): Range\n\t{\n\t\treturn new Range({\n\t\t\tmodel: range,\n\t\t\treadOnly: this.readOnly,\n\t\t\tshowReadOnlyPopup: this.#showReadOnlyPopup.bind(this),\n\t\t});\n\t}\n\n\t#renderSettingsSlotSizeSelect(): HTMLElement\n\t{\n\t\tthis.#layout.slotSizeText = Tag.render`\n\t\t\t<span class=\"calendar-sharing__settings-select-link\">\n\t\t\t\t${this.#rule.getFormattedSlotSize()}\n\t\t\t</span>\n\t\t`;\n\n\t\tthis.#layout.slotSizeSelect = Tag.render`\n\t\t\t<span class=\"calendar-sharing__settings-select-arrow --small-arrow\">\n\t\t\t\t${this.#layout.slotSizeText}\n\t\t\t</span>\n\t\t`;\n\n\t\tEvent.bind(this.#layout.slotSizeSelect, 'click', this.#slotSizeSelectClickHandler.bind(this));\n\n\t\tthis.slotSizeMenu = MenuManager.create({\n\t\t\tid: `calendar-sharing-settings-slotSize${Date.now()}`,\n\t\t\tbindElement: this.#layout.slotSizeSelect,\n\t\t\titems: this.#model.getRule().getAvailableIntervals().map((minutes) => {\n\t\t\t\treturn {\n\t\t\t\t\ttext: Util.formatDuration(minutes),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.#rule.setSlotSize(minutes);\n\t\t\t\t\t\tthis.#layout.slotSizeText.innerHTML = this.#rule.getFormattedSlotSize();\n\t\t\t\t\t\tthis.slotSizeMenu.close();\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}),\n\t\t\tcloseByEsc: true,\n\t\t\tevents: {\n\t\t\t\tonShow: () => Dom.addClass(this.#layout.slotSizeSelect, '--active'),\n\t\t\t\tonClose: () => Dom.removeClass(this.#layout.slotSizeSelect, '--active'),\n\t\t\t},\n\t\t});\n\n\t\treturn this.#layout.slotSizeSelect;\n\t}\n\n\t#calculateRuleHeight(): number\n\t{\n\t\tconst topMarginHeight = 10;\n\t\tconst bottomMarginHeight = 2;\n\t\tconst marginsHeight = topMarginHeight + bottomMarginHeight;\n\t\tconst slotSizeHeight = 15;\n\t\tconst rangeHeight = 45;\n\n\t\treturn rangeHeight * this.#model.getRule().getRanges().length + (marginsHeight + slotSizeHeight);\n\t}\n\n\t#removeRuleHeight(): void\n\t{\n\t\tDom.style(this.#layout.rule, 'height', null);\n\t}\n\n\t#slotSizeSelectClickHandler(): void\n\t{\n\t\tif (this.readOnly)\n\t\t{\n\t\t\tthis.#showReadOnlyPopup(this.#layout.slotSizeSelect);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.slotSizeMenu.show();\n\t\t}\n\t}\n\n\t#showReadOnlyPopup(pivotNode): void\n\t{\n\t\tthis.#closeReadOnlyPopup();\n\t\tthis.#getReadOnlyPopup(pivotNode).show();\n\t}\n\n\t#getReadOnlyPopup(pivotNode): Popup\n\t{\n\t\tconst readonlyHint = this.#model.getCalendarContext()?.sharingObjectType === 'group'\n\t\t\t? 'CALENDAR_SHARING_SETTINGS_READ_ONLY_HINT_GROUP'\n\t\t\t: 'CALENDAR_SHARING_SETTINGS_READ_ONLY_HINT'\n\t\t;\n\t\tthis.readOnlyPopup = new Popup({\n\t\t\tbindElement: pivotNode,\n\t\t\tclassName: 'calendar-sharing__settings-read-only-hint',\n\t\t\tcontent: Loc.getMessage(readonlyHint),\n\t\t\tangle: {\n\t\t\t\toffset: 0,\n\t\t\t},\n\t\t\twidth: 300,\n\t\t\toffsetLeft: pivotNode.offsetWidth / 2,\n\t\t\tdarkMode: true,\n\t\t\tautoHide: true,\n\t\t});\n\n\t\tEvent.bind(this.readOnlyPopup.popupContainer, 'click', () => this.#closeReadOnlyPopup());\n\n\t\tclearTimeout(this.closePopupTimeout);\n\t\tthis.closePopupTimeout = setTimeout(() => this.#closeReadOnlyPopup(), 3000);\n\n\t\treturn this.readOnlyPopup;\n\t}\n\n\t#closeReadOnlyPopup(): void\n\t{\n\t\tthis.readOnlyPopup?.destroy();\n\t}\n}\n","import { Loc, Tag } from 'main.core';\nimport { Popup } from 'main.popup';\n\nexport default class HintInfo\n{\n\t#bindElement: HTMLElement;\n\t#layout: {\n\t\twrapper: HTMLElement,\n\t};\n\t#popup: Popup;\n\n\tconstructor(props)\n\t{\n\t\tthis.#bindElement = props.bindElement;\n\t\tthis.#layout = {};\n\n\t\tthis.#popup = new Popup({\n\t\t\tbindElement: this.#bindElement,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top',\n\t\t\t},\n\t\t\tangle: {\n\t\t\t\toffset: this.#bindElement.offsetWidth / 2 + 24,\n\t\t\t},\n\t\t\tborderRadius: '24px',\n\t\t\twidth: 425,\n\t\t\tcontent: this.getContent(),\n\t\t\tanimation: 'fading-slide',\n\t\t});\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tif (!this.#layout.wrapper)\n\t\t{\n\t\t\tthis.#layout.wrapper = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__user-selector-hint-wrapper\">\n\t\t\t\t\t<div class=\"calendar-sharing__user-selector-hint-text-wrapper\">\n\t\t\t\t\t\t<div class=\"calendar-sharing__user-selector-hint-text-title\">\n\t\t\t\t\t\t\t${Loc.getMessage('CALENDAR_SHARING_USER_SELECTOR_HINT_TITLE')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"calendar-sharing__user-selector-hint-text-desc\">\n\t\t\t\t\t\t\t${Loc.getMessage('CALENDAR_SHARING_USER_SELECTOR_HINT_DESC')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"calendar-sharing__user-selector-hint-icon\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.wrapper;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#popup?.show();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n}","import { Text, Dom, Loc, Tag, Event } from 'main.core';\nimport { Dialog } from 'ui.entity-selector';\nimport HintInfo from './hint-info';\nimport { SettingsModel } from '../../model/index';\nimport 'ui.icon-set.actions';\nimport { AvatarRoundGuest } from 'ui.avatar';\n\nexport default class UserSelector\n{\n\t#layout: {\n\t\twrapper: HTMLElement,\n\t\ttitle: HTMLElement,\n\t\tchevron: HTMLElement,\n\t\tuserSelectorWrapper: HTMLElement,\n\t\tuserSelector: HTMLElement,\n\t\thint: HTMLElement,\n\t};\n\n\t#userSelectorDialog: Dialog;\n\t#selectedEntityList: any;\n\t#selectedEntityNodeList: any;\n\t#defaultUserEntity: any;\n\t#onMembersAdded: function;\n\n\t#model: SettingsModel;\n\n\tconstructor(props = {})\n\t{\n\t\tthis.#layout = {};\n\t\tthis.#userSelectorDialog = null;\n\t\tthis.#selectedEntityList = {};\n\t\tthis.#selectedEntityNodeList = {};\n\t\tthis.#model = props.model;\n\t\tthis.#defaultUserEntity = this.#model.getUserInfo();\n\t\tthis.#onMembersAdded = props.onMembersAdded;\n\n\t\tthis.openEntitySelector = this.openEntitySelector.bind(this);\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.#layout.wrapper)\n\t\t{\n\t\t\tconst contextClass = `--${this.#model.getContext()}`;\n\n\t\t\tthis.#layout.wrapper = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__user-selector-main ${contextClass}\">\n\t\t\t\t\t${this.#renderTitle()}\n\t\t\t\t\t${this.renderUserSelectorWrapper()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.wrapper;\n\t}\n\n\t#renderTitle(): HTMLElement\n\t{\n\t\tif (!this.#layout.title)\n\t\t{\n\t\t\tthis.#layout.title = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__user-selector-title\">\n\t\t\t\t\t<div class=\"calendar-sharing__user-selector-title-icon\"></div>\n\t\t\t\t\t<div class=\"calendar-sharing__user-selector-title-text\">\n\t\t\t\t\t\t${this.#getTitleText()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst infoNotify = this.#layout.title.querySelector('[ data-role=\"calendar-sharing_popup-joint-slots\"]');\n\n\t\t\tif (infoNotify)\n\t\t\t{\n\t\t\t\tlet hintInfo;\n\t\t\t\tlet timer;\n\n\t\t\t\tEvent.bind(infoNotify, 'mouseenter', () => {\n\t\t\t\t\ttimer = setTimeout(() => {\n\t\t\t\t\t\tif (!hintInfo)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thintInfo = new HintInfo({\n\t\t\t\t\t\t\t\tbindElement: infoNotify,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thintInfo.show();\n\t\t\t\t\t}, 1000);\n\t\t\t\t});\n\n\t\t\t\tEvent.bind(infoNotify, 'mouseleave', () => {\n\t\t\t\t\tclearTimeout(timer);\n\n\t\t\t\t\tif (hintInfo)\n\t\t\t\t\t{\n\t\t\t\t\t\thintInfo.close();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this.#layout.title;\n\t}\n\n\t#getTitleText(): string\n\t{\n\t\tswitch (this.#model.getContext())\n\t\t{\n\t\t\tcase 'calendar':\n\t\t\t\treturn Loc.getMessage('CALENDAR_SHARING_USER_SELECTOR_TITLE_V2');\n\t\t\tcase 'crm':\n\t\t\t\treturn Loc.getMessage('CALENDAR_SHARING_USER_SELECTOR_TITLE_CRM');\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n\n\trenderUserSelectorWrapper(): HTMLElement\n\t{\n\t\tif (!this.#layout.userSelectorWrapper)\n\t\t{\n\t\t\tthis.#layout.userSelectorWrapper = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__user-selector-wrapper\">\n\t\t\t\t\t${this.renderUserSelector()}\n\t\t\t\t\t<div class=\"calendar-sharing__user-selector-add\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --plus-20\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.#layout.userSelectorWrapper, 'click', this.openEntitySelector);\n\t\t}\n\n\t\treturn this.#layout.userSelectorWrapper;\n\t}\n\n\trenderUserSelector(): HTMLElement\n\t{\n\t\tif (!this.#layout.userSelector)\n\t\t{\n\t\t\tconst entityNode = this.getDefaultEntityNode();\n\n\t\t\tthis.#layout.userSelector = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__user-selector-container\" data-id=\"calendar-sharing-members\">\n\t\t\t\t\t${entityNode}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.userSelector;\n\t}\n\n\tgetDefaultEntityNode(): HTMLElement\n\t{\n\t\tconst entityNode = this.renderUserEntity(this.#defaultUserEntity);\n\t\tconst key = this.getEntityKey(this.#defaultUserEntity.id);\n\t\tthis.#selectedEntityList[key] = this.#defaultUserEntity;\n\t\tthis.#selectedEntityNodeList[key] = entityNode;\n\t\tthis.#model.setMemberIds(this.getSelectedUserIdList());\n\n\t\treturn entityNode;\n\t}\n\n\trenderUserEntity(entity): HTMLElement\n\t{\n\t\tif (entity.isCollabUser)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__user-selector-entity-container\">\n\t\t\t\t\t${this.#renderCollabAvatar(entity)}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.hasAvatar(entity.avatar))\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__user-selector-entity-container\">\n\t\t\t\t\t<img class=\"calendar-sharing__user-selector-entity\" title=\"${Text.encode(entity.name)}\" src=\"${entity.avatar}\" alt=\"\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-icon ui-icon-common-user calendar-sharing__user-selector-entity\" title=\"${Text.encode(entity?.name)}\"><i></i></div>\n\t\t`;\n\t}\n\n\thasAvatar(avatar): boolean\n\t{\n\t\treturn avatar && avatar !== '/bitrix/images/1.gif';\n\t}\n\n\topenEntitySelector(): void\n\t{\n\t\tif (!this.#layout.userSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preselectedItem = ['user', this.#defaultUserEntity.id];\n\n\t\tif (!this.#userSelectorDialog)\n\t\t{\n\t\t\tthis.#userSelectorDialog = new Dialog({\n\t\t\t\twidth: 340,\n\t\t\t\ttargetNode: this.#layout.userSelector,\n\t\t\t\tcontext: 'CALENDAR_SHARING',\n\t\t\t\tpreselectedItems: [preselectedItem],\n\t\t\t\tenableSearch: true,\n\t\t\t\tzIndex: 4200,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\t\tthis.onUserSelectorSelect(event);\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onDeselect': (event) => {\n\t\t\t\t\t\tthis.onUserSelectorDeselect(event);\n\t\t\t\t\t},\n\t\t\t\t\t'onHide': () => {\n\t\t\t\t\t\tif (this.hasChanges())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#onMembersAdded();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tintranetUsersOnly: !(this.#model.getCalendarContext()?.sharingObjectType === 'group'),\n\t\t\t\t\t\t\temailUsers: false,\n\t\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\t\tinviteGuestLink: false,\n\t\t\t\t\t\t\tanalyticsSource: 'calendar',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfilters: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tid: 'calendar.jointSharingFilter',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\n\t\tthis.#userSelectorDialog.show();\n\t}\n\n\tisUserSelectorDialogOpened(): boolean\n\t{\n\t\tif (this.#userSelectorDialog)\n\t\t{\n\t\t\treturn this.#userSelectorDialog.isOpen();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tonUserSelectorSelect(event): void\n\t{\n\t\tconst item = event.data.item;\n\t\tconst name = item.customData.get('name')\n\t\t\t? `${item.customData.get('name')} ${item.customData.get('lastName') ?? ''}`.trim()\n\t\t\t: String(item.customData.get('login'))\n\t\t;\n\n\t\tconst entity = {\n\t\t\tid: item.id,\n\t\t\tavatar: item.avatar,\n\t\t\tname,\n\t\t\tisCollabUser: item.entityType === 'collaber',\n\t\t};\n\t\tconst entityNode = this.renderUserEntity(entity);\n\n\t\tif (this.#layout.userSelector)\n\t\t{\n\t\t\tDom.append(entityNode, this.#layout.userSelector);\n\t\t}\n\n\t\tconst key = this.getEntityKey(entity.id);\n\n\t\tthis.#selectedEntityList[key] = entity;\n\t\tthis.#selectedEntityNodeList[key] = entityNode;\n\t\tthis.#model.setMemberIds(this.getSelectedUserIdList());\n\t}\n\n\tonUserSelectorDeselect(event): void\n\t{\n\t\tconst item = event.data.item;\n\t\tconst key = this.getEntityKey(item.id);\n\n\t\tconst entityNode = this.#selectedEntityNodeList[key];\n\n\t\tif (entityNode)\n\t\t{\n\t\t\tDom.remove(entityNode);\n\t\t\tdelete this.#selectedEntityList[key];\n\t\t\tdelete this.#selectedEntityNodeList[key];\n\t\t}\n\n\t\tthis.#model.setMemberIds(this.getSelectedUserIdList());\n\t}\n\n\tclearSelectedUsers(): void\n\t{\n\t\tif (this.#layout.userSelector)\n\t\t{\n\t\t\tDom.clean(this.#layout.userSelector);\n\t\t\tthis.#selectedEntityList = {};\n\t\t\tthis.#selectedEntityNodeList = {};\n\n\t\t\tconst entityNode = this.getDefaultEntityNode();\n\t\t\tDom.append(entityNode, this.#layout.userSelector);\n\t\t}\n\n\t\tif (this.#userSelectorDialog)\n\t\t{\n\t\t\tthis.#userSelectorDialog.destroy();\n\t\t\tthis.#userSelectorDialog = null;\n\t\t}\n\t}\n\n\thasChanges(): boolean\n\t{\n\t\treturn this.getPeopleCount() > 1;\n\t}\n\n\tgetPeopleCount(): any\n\t{\n\t\treturn Object.keys(this.#selectedEntityList).length;\n\t}\n\n\tgetSelectedUserIdList(): any\n\t{\n\t\tconst result = [];\n\n\t\tObject.values(this.#selectedEntityList).forEach((entity) => {\n\t\t\tresult.push(entity.id);\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetEntityKey(id)\n\t{\n\t\treturn `user-${id}`;\n\t}\n\n\t#renderCollabAvatar(member): HTMLElement\n\t{\n\t\treturn new AvatarRoundGuest({\n\t\t\tsize: 36,\n\t\t\tuserName: member.name,\n\t\t\tuserpicPath: this.hasAvatar(member.avatar) && member.avatar,\n\t\t\tbaseColor: '#19cc45',\n\t\t}).getContainer();\n\t}\n}\n","import { Text, Dom, Tag, Loc, Event } from 'main.core';\nimport { Util } from 'calendar.util';\nimport { Icon, Actions, Main } from 'ui.icon-set.api.core';\nimport { MenuManager, Menu } from 'main.popup';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Button, ButtonSize, ButtonColor } from 'ui.buttons';\nimport { EventEmitter } from 'main.core.events';\nimport 'ui.icon-set.actions';\n\nconst MAX_AVATAR_COUNT = 4;\n\ntype ListItemProps = {\n\tid: number,\n\thash: string,\n\tshortUrl: string,\n\tmembers: any,\n\tfrequentUse: number,\n\tuserId: number,\n\tuserIds: any,\n\tuserInfo: any,\n\ttype: string,\n\tpathToUser: string,\n\tsetListItemPopupState: func,\n\tdateCreate: string,\n};\n\nexport default class ListItem\n{\n\t#props: ListItemProps;\n\t#layout: {\n\t\twrapper: HTMLElement,\n\t\tavatarContainer: HTMLElement,\n\t\tdate: HTMLElement,\n\t\tcopyButton: HTMLElement,\n\t\tdeleteButton: HTMLElement,\n\t};\n\n\t#avatarPopup: Menu;\n\t#deletePopup: MessageBox;\n\n\tconstructor(props: ListItemProps)\n\t{\n\t\tthis.#props = props;\n\t\tthis.#layout = {};\n\t\tthis.#avatarPopup = null;\n\t\tthis.#deletePopup = null;\n\n\t\tthis.openAvatarList = this.openAvatarList.bind(this);\n\t\tthis.onCopyButtonClick = this.onCopyButtonClick.bind(this);\n\t\tthis.onDeleteButtonClick = this.onDeleteButtonClick.bind(this);\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.#layout.wrapper)\n\t\t{\n\t\t\tthis.#layout.wrapper = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-item\">\n\t\t\t\t\t${this.renderAvatarContainer()}\n\t\t\t\t\t${this.renderDate()}\n\t\t\t\t\t${this.renderCopyButton()}\n\t\t\t\t\t${this.renderDeleteButton()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.wrapper;\n\t}\n\n\trenderAvatarContainer(): HTMLElement\n\t{\n\t\tif (!this.#layout.avatarContainer)\n\t\t{\n\t\t\tconst showMoreIcon = this.#props.members.length > MAX_AVATAR_COUNT;\n\t\t\tconst moreCounter = this.#props.members.length - MAX_AVATAR_COUNT;\n\n\t\t\tthis.#layout.avatarContainer = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-item-avatar-container\">\n\t\t\t\t\t${this.renderAvatar(this.#props.userInfo)}\n\t\t\t\t\t${this.#props.members.slice(0, MAX_AVATAR_COUNT).map((member) => this.renderAvatar(member))}\n\t\t\t\t\t${showMoreIcon ? this.renderMore(moreCounter) : null}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.#layout.avatarContainer, 'click', this.openAvatarList);\n\t\t}\n\n\t\treturn this.#layout.avatarContainer;\n\t}\n\n\trenderAvatar(user): HTMLElement\n\t{\n\t\tconst name = `${user.name} ${user.lastName ?? ''}`.trim();\n\n\t\tif (this.hasAvatar(user.avatar))\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<img class=\"calendar-sharing__dialog-link-list-item-avatar\" title=\"${Text.encode(name)}\" alt=\"\" src=\"${user.avatar}\">\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-icon ui-icon-common-user calendar-sharing__dialog-link-list-item-avatar\" title=\"${Text.encode(name)}\"><i></i></div>\n\t\t`;\n\t}\n\n\thasAvatar(avatar): boolean\n\t{\n\t\treturn avatar && avatar !== '/bitrix/images/1.gif';\n\t}\n\n\trenderMore(counter): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__dialog-link-list-item-more\">\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-item-more-text\">${`+${counter}`}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\topenAvatarList(): void\n\t{\n\t\tif (!this.#avatarPopup)\n\t\t{\n\t\t\tconst uid = BX.util.getRandomString(6);\n\n\t\t\tthis.#avatarPopup = MenuManager.create({\n\t\t\t\tid: `calendar-sharing-dialog_${uid}`,\n\t\t\t\tbindElement: this.#layout.avatarContainer,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tclassName: 'calendar-sharing__dialog-link-list-user-popup-container',\n\t\t\t\titems: this.getAvatarPopupItems(),\n\t\t\t\tmaxHeight: 250,\n\t\t\t\tmaxWidth: 300,\n\t\t\t});\n\t\t\tthis.#avatarPopup.getPopupWindow().subscribe('onClose', () => {\n\t\t\t\tthis.setPopupState(false);\n\t\t\t});\n\n\t\t\tconst menuContainer = this.#avatarPopup.getMenuContainer();\n\n\t\t\t// eslint-disable-next-line init-declarations\n\t\t\tlet timeout;\n\n\t\t\tEvent.bind(menuContainer, 'mouseleave', () => {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\ttimeout = setTimeout(() => {\n\t\t\t\t\tthis.closeAvatarList();\n\t\t\t\t}, 500);\n\t\t\t});\n\t\t\tEvent.bind(menuContainer, 'mouseenter', () => {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t});\n\t\t}\n\n\t\tthis.#avatarPopup.show();\n\t\tthis.setPopupState(true);\n\t}\n\n\tcloseAvatarList(): void\n\t{\n\t\tif (this.#avatarPopup)\n\t\t{\n\t\t\tthis.#avatarPopup.close();\n\t\t}\n\t}\n\n\tgetAvatarPopupItems(): any\n\t{\n\t\tconst result = [];\n\n\t\tresult.push(this.getAvatarPopupItem(this.#props.userInfo));\n\t\tthis.#props.members.forEach((member) => {\n\t\t\tresult.push(this.getAvatarPopupItem(member));\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetAvatarPopupItem(user): any\n\t{\n\t\tconst avatar = user.avatar;\n\t\tconst name = `${user.name} ${user.lastName ?? ''}`.trim();\n\t\tconst userPath = this.#props.pathToUser.replace('#USER_ID#', user.id);\n\n\t\treturn {\n\t\t\thtml: Tag.render`\n\t\t\t\t<a href=\"${userPath}\" target=\"_blank\" class=\"calendar-sharing__dialog-link-list-user-popup-item\">\n\t\t\t\t\t<span class=\"ui-icon ui-icon-common-user calendar-sharing__dialog-link-list-user-popup-item-avatar\">\n\t\t\t\t\t\t<i style=\"${this.hasAvatar(avatar) ? `background-image: url('${avatar}')` : ''}\"></i>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-user-popup-item-text\">\n\t\t\t\t\t\t${Text.encode(name)}\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t`,\n\t\t};\n\t}\n\n\trenderDate(): HTMLElement\n\t{\n\t\tif (!this.#layout.date)\n\t\t{\n\t\t\tconst date = this.#props.dateCreate\n\t\t\t\t? new Date(this.#props.dateCreate)\n\t\t\t\t: new Date()\n\t\t\t;\n\t\t\tconst formattedDate = Util.formatDate(date);\n\n\t\t\tthis.#layout.date = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-item-date\" title=\"${Loc.getMessage('CALENDAR_SHARING_LINK_LIST_DATE_CREATE')}\">${formattedDate}</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.date;\n\t}\n\n\trenderCopyButton(): HTMLElement\n\t{\n\t\tif (!this.#layout.copyButton)\n\t\t{\n\t\t\tconst icon = new Icon({\n\t\t\t\ticon: Main.LINK_3,\n\t\t\t\tsize: 14,\n\t\t\t});\n\n\t\t\tthis.#layout.copyButton = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-item-copy-container\">\n\t\t\t\t\t${icon.render()}\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-item-copy-text\">${Loc.getMessage('CALENDAR_SHARING_LINK_LIST_COPY')}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.#layout.copyButton, 'click', this.onCopyButtonClick);\n\t\t}\n\n\t\treturn this.#layout.copyButton;\n\t}\n\n\tonCopyButtonClick(): void\n\t{\n\t\tEventEmitter.emit('CalendarSharing:onJointLinkCopy', {\n\t\t\tid: this.#props.id,\n\t\t\tshortUrl: this.#props.shortUrl,\n\t\t\thash: this.#props.hash,\n\t\t\tmembers: this.#props.members,\n\t\t});\n\t}\n\n\trenderDeleteButton(): HTMLElement\n\t{\n\t\tif (this.#props.members.length === 0)\n\t\t{\n\t\t\treturn Tag.render`<div class=\"calendar-sharing__dialog-link-list-item-delete\"></div>`;\n\t\t}\n\n\t\tif (!this.#layout.deleteButton)\n\t\t{\n\t\t\tconst icon = new Icon({\n\t\t\t\ticon: Actions.CROSS_30,\n\t\t\t\tsize: 18,\n\t\t\t});\n\n\t\t\tthis.#layout.deleteButton = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-item-delete\">\n\t\t\t\t\t${icon.render()}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.#layout.deleteButton, 'click', this.onDeleteButtonClick);\n\t\t}\n\n\t\treturn this.#layout.deleteButton;\n\t}\n\n\tonDeleteButtonClick(): void\n\t{\n\t\tif (!this.#deletePopup)\n\t\t{\n\t\t\tthis.#deletePopup = new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('CALENDAR_SHARING_LINK_LIST_DELETE_MESSAGE_TITLE_MSGVER_1'),\n\t\t\t\tmessage: Loc.getMessage('CALENDAR_SHARING_LINK_LIST_DELETE_MESSAGE_DESC_MSGVER_1'),\n\t\t\t\tbuttons: this.getDeletePopupButtons(),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tminWidth: 365,\n\t\t\t\t\tmaxWidth: 385,\n\t\t\t\t\tminHeight: 180,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tthis.#deletePopup.show();\n\t\tthis.setPopupState(true);\n\t}\n\n\tgetDeletePopupButtons(): any\n\t{\n\t\treturn [\n\t\t\tnew Button({\n\t\t\t\tsize: ButtonSize.MEDIUM,\n\t\t\t\tcolor: ButtonColor.DANGER,\n\t\t\t\ttext: Loc.getMessage('SHARING_WARNING_POPUP_SUBMIT_BUTTON_NEW_MSGVER_1'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.deleteLink();\n\t\t\t\t\t\tthis.#deletePopup.close();\n\t\t\t\t\t\tthis.setPopupState(false);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew Button({\n\t\t\t\tsize: ButtonSize.MEDIUM,\n\t\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\t\ttext: Loc.getMessage('SHARING_WARNING_POPUP_CANCEL_BUTTON'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.#deletePopup.close();\n\t\t\t\t\t\tthis.setPopupState(false);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t];\n\t}\n\n\tdeleteLink(): void\n\t{\n\t\tif (this.#layout.wrapper)\n\t\t{\n\t\t\tBX.ajax.runAction('calendar.api.sharingajax.disableUserLink', {\n\t\t\t\tdata: {\n\t\t\t\t\thash: this.#props.hash,\n\t\t\t\t},\n\t\t\t});\n\t\t\tDom.addClass(this.#layout.wrapper, '--animate-delete');\n\t\t\tsetTimeout(() => {\n\t\t\t\tDom.remove(this.#layout.wrapper);\n\t\t\t}, 300);\n\n\t\t\tEventEmitter.emit('CalendarSharing:onJointLinkDelete', {\n\t\t\t\tid: this.#props.id,\n\t\t\t});\n\t\t}\n\t}\n\n\tsetPopupState(state): void\n\t{\n\t\tthis.#props?.setListItemPopupState(state);\n\t}\n}\n","import { Dom, Tag, Loc, Event, Type } from 'main.core';\nimport { Icon, Actions } from 'ui.icon-set.api.core';\nimport { EventEmitter } from 'main.core.events';\nimport { SettingsModel } from '../../model/index';\nimport ListItem from './list-item';\nimport 'ui.icon-set.actions'\n\nconst DEFAULT_LIST_HEIGHT = 300;\nconst LIST_PADDING_SUM = 45;\n\ntype ListProps = {\n\tmodel: SettingsModel,\n\tonLinkListClose: function,\n};\n\nexport default class List\n{\n\t#props: ListProps;\n\t#layout: {\n\t\twrapper: HTMLElement,\n\t\ttitle: HTMLElement,\n\t\tsortingButton: HTMLElement,\n\t\tsortingButtonText: HTMLElement,\n\t\tbackButton: HTMLElement,\n\t\tlist: HTMLElement,\n\t\temptyState: HTMLElement,\n\t};\n\t#linkList: any;\n\t#popupOpenState = false;\n\t#pathToUser: string;\n\n\tconstructor(props: ListProps)\n\t{\n\t\tthis.#props = props;\n\t\tthis.#layout = {};\n\t\tthis.#linkList = null;\n\t\tthis.#pathToUser = null;\n\t\tthis.getLinkListInfo();\n\n\t\tthis.setListItemPopupState = this.setListItemPopupState.bind(this);\n\n\t\tthis.eventSubscribe();\n\t}\n\n\tget #model(): SettingsModel\n\t{\n\t\treturn this.#props.model;\n\t}\n\n\teventSubscribe()\n\t{\n\t\tEventEmitter.subscribe('CalendarSharing:onJointLinkCopy', (event) => {\n\t\t\tthis.onJointLinkCopy(event);\n\t\t});\n\t\tEventEmitter.subscribe('CalendarSharing:onJointLinkDelete', (event) => {\n\t\t\tthis.onJointLinkDelete(event);\n\t\t});\n\t}\n\n\tgetLinkListInfo(): void\n\t{\n\t\tBX.ajax.runAction('calendar.api.sharingajax.getAllUserLink').then((response) => {\n\t\t\tif (response && response.data)\n\t\t\t{\n\t\t\t\tthis.#linkList = response.data.userLinks;\n\t\t\t\tthis.#pathToUser = response.data.pathToUser;\n\n\t\t\t\tthis.updateLinkList();\n\n\t\t\t\tif (this.isListEmpty())\n\t\t\t\t{\n\t\t\t\t\tthis.hideSortingButton();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.#linkList)\n\t\t\t\t{\n\t\t\t\t\tthis.showSortingButton();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (!this.#layout.wrapper)\n\t\t{\n\t\t\tthis.#layout.wrapper =  Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-wrapper\">\n\t\t\t\t\t${this.getTitleNode()}\n\t\t\t\t\t${this.getListNode()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.wrapper;\n\t}\n\n\tgetTitleNode(): HTMLElement\n\t{\n\t\tif (!this.#layout.title)\n\t\t{\n\t\t\tthis.#layout.title =  Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-title-wrapper\">\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-title\">\n\t\t\t\t\t\t${this.getChevronBackIcon()}\n\t\t\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-title-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('CALENDAR_SHARING_LINK_LIST_TITLE')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getSortingButton()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.title;\n\t}\n\n\tgetChevronBackIcon(): HTMLElement\n\t{\n\t\tif (!this.#layout.backButton)\n\t\t{\n\t\t\tconst icon = new Icon({\n\t\t\t\ticon: Actions.CHEVRON_LEFT,\n\t\t\t\tsize: 24,\n\t\t\t});\n\n\t\t\tthis.#layout.backButton = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-back-button\">\n\t\t\t\t\t${icon.render()}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.#layout.backButton, 'click', this.close.bind(this));\n\t\t}\n\n\t\treturn this.#layout.backButton;\n\t}\n\n\tgetSortingButton(): HTMLElement\n\t{\n\t\tif (!this.#layout.sortingButton)\n\t\t{\n\t\t\tconst icon = new Icon({\n\t\t\t\ticon: Actions.SORT,\n\t\t\t\tsize: 14,\n\t\t\t\tcolor: '#2066b0',\n\t\t\t});\n\n\t\t\tthis.#layout.sortingButton = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-sorting-button\">\n\t\t\t\t\t${icon.render()}\n\t\t\t\t\t${this.getSortingButtonText()}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.#layout.sortingButton, 'click', this.changeListSort.bind(this));\n\t\t}\n\n\t\treturn this.#layout.sortingButton;\n\t}\n\n\tgetSortingButtonText(): HTMLElement\n\t{\n\t\tif (!this.#layout.sortingButtonText)\n\t\t{\n\t\t\tthis.#layout.sortingButtonText = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-sorting-button-text\">\n\t\t\t\t\t${this.#getSortingName()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.sortingButtonText;\n\t}\n\n\tgetListNode(): HTMLElement\n\t{\n\t\tif (!this.#layout.list)\n\t\t{\n\t\t\tthis.#layout.list = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-container\">\n\t\t\t\t\t${this.getListItemsNode()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.list;\n\t}\n\n\tgetListItemsNode(): HTMLElement\n\t{\n\t\tif (this.isListEmpty())\n\t\t{\n\t\t\treturn this.getEmptyStateNode();\n\t\t}\n\n\t\tconst linkListItems = this.getListItems();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__dialog-link-list\">\n\t\t\t\t${linkListItems.map((listItem) => listItem.render())}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetEmptyStateNode(): HTMLElement\n\t{\n\t\tif (!this.#layout.emptyState)\n\t\t{\n\t\t\tthis.#layout.emptyState = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-empty-state-wrapper\">\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-empty-state-icon\"></div>\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-link-list-empty-state-text\">${Loc.getMessage('CALENDAR_SHARING_LIST_EMPTY_TITLE')}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.emptyState;\n\t}\n\n\tgetListItems(): any\n\t{\n\t\tif (this.#model.sortJointLinksByFrequentUse())\n\t\t{\n\t\t\treturn this.getSortedByFrequentUseListItems();\n\t\t}\n\n\t\treturn this.getSortedByDateListItems();\n\t}\n\n\tgetSortedByFrequentUseListItems(): any\n\t{\n\t\treturn Object.values(this.#linkList).sort((a, b) => {\n\t\t\tif (a.frequentUse > b.frequentUse)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (a.frequentUse < b.frequentUse)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (a.id > b.id)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (a.id < b.id)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}).map((item) => new ListItem({\n\t\t\t...item,\n\t\t\tuserInfo: this.#model.getUserInfo(),\n\t\t\tpathToUser: this.#pathToUser,\n\t\t\tsetListItemPopupState: this.setListItemPopupState,\n\t\t}));\n\t}\n\n\tgetSortedByDateListItems(): any\n\t{\n\t\treturn Object.keys(this.#linkList).sort((a, b) => b - a).map((index) => {\n\t\t\treturn new ListItem({\n\t\t\t\t...this.#linkList[index],\n\t\t\t\tuserInfo: this.#model.getUserInfo(),\n\t\t\t\tpathToUser: this.#pathToUser,\n\t\t\t\tsetListItemPopupState: this.setListItemPopupState,\n\t\t\t});\n\t\t});\n\t}\n\n\tshow(maxListHeight): void\n\t{\n\t\tif (this.#layout.list && maxListHeight)\n\t\t{\n\t\t\tDom.style(this.#layout.list, 'max-height', `${maxListHeight - LIST_PADDING_SUM}px`);\n\t\t}\n\n\t\tif (this.#layout.wrapper)\n\t\t{\n\t\t\tDom.addClass(this.#layout.wrapper, '--show');\n\t\t}\n\t}\n\n\tclose(): void\n\t{\n\t\tif (this.#layout.list)\n\t\t{\n\t\t\tDom.style(this.#layout.list, 'max-height', `${DEFAULT_LIST_HEIGHT}px`);\n\t\t}\n\n\t\tif (this.#layout.wrapper)\n\t\t{\n\t\t\tDom.removeClass(this.#layout.wrapper, '--show');\n\t\t}\n\n\t\tif (this.#props.onLinkListClose)\n\t\t{\n\t\t\tthis.#props.onLinkListClose();\n\t\t}\n\t}\n\n\tupdateLinkList(): void\n\t{\n\t\tif (this.#layout.list)\n\t\t{\n\t\t\tDom.clean(this.getListNode());\n\n\t\t\tconst listItems = this.getListItemsNode();\n\t\t\tDom.append(listItems, this.#layout.list);\n\t\t}\n\t}\n\n\tchangeListSort(): void\n\t{\n\t\tthis.#model.changeSortJointLinksByFrequentUse();\n\n\t\tif (this.#layout.sortingButtonText)\n\t\t{\n\t\t\tDom.adjust(this.#layout.sortingButtonText, {\n\t\t\t\ttext: this.#getSortingName(),\n\t\t\t});\n\t\t}\n\n\t\tthis.updateLinkList();\n\t}\n\n\t#getSortingName(): string\n\t{\n\t\treturn this.#model.sortJointLinksByFrequentUse()\n\t\t\t? Loc.getMessage('CALENDAR_SHARING_LINK_LIST_SORT_RECENT')\n\t\t\t: Loc.getMessage('CALENDAR_SHARING_LINK_LIST_SORT_DATE');\n\t}\n\n\tsetListItemPopupState(state): void\n\t{\n\t\tthis.#popupOpenState = state;\n\t}\n\n\tisOpenListItemPopup(): boolean\n\t{\n\t\treturn this.#popupOpenState;\n\t}\n\n\tonJointLinkCopy(event): void\n\t{\n\t\tconst id = event.data.id;\n\t\tconst hash = event.data.hash;\n\n\t\tsetTimeout(() => {\n\t\t\tif (this.#linkList[id])\n\t\t\t{\n\t\t\t\tthis.#linkList[id].frequentUse = this.#linkList[id].frequentUse + 1;\n\t\t\t\tthis.updateLinkList();\n\t\t\t}\n\t\t}, 1000);\n\n\t\tBX.ajax.runAction('calendar.api.sharingajax.increaseFrequentUse', {\n\t\t\tdata: {\n\t\t\t\thash,\n\t\t\t},\n\t\t});\n\t}\n\n\tonJointLinkDelete(event): void\n\t{\n\t\tconst id = event.data.id;\n\n\t\tif (this.#linkList[id])\n\t\t{\n\t\t\tdelete this.#linkList[id];\n\t\t}\n\n\t\tif (this.isListEmpty())\n\t\t{\n\t\t\tthis.updateLinkList();\n\t\t\tthis.hideSortingButton();\n\t\t}\n\t}\n\n\tisListEmpty()\n\t{\n\t\treturn Type.isNil(this.#linkList)\n\t\t\t|| (Type.isArray(this.#linkList) && !Type.isArrayFilled(this.#linkList))\n\t\t\t|| (Type.isObject(this.#linkList) && !Object.keys(this.#linkList).length)\n\t\t;\n\t}\n\n\thideSortingButton()\n\t{\n\t\tif (this.#layout.sortingButton)\n\t\t{\n\t\t\tDom.addClass(this.#layout.sortingButton, '--hide');\n\t\t}\n\t}\n\n\tshowSortingButton()\n\t{\n\t\tif (this.#layout.sortingButton)\n\t\t{\n\t\t\tDom.removeClass(this.#layout.sortingButton, '--hide');\n\t\t}\n\t}\n}","import { Dom, Event, Loc, Tag, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Analytics } from 'calendar.sharing.analytics';\nimport { Util } from 'calendar.util';\nimport Settings from './rule/settings';\nimport UserSelector from './joint/user-selector';\nimport List from './link-list/list';\n\nimport { SettingsModel } from '../model/index';\n\nexport type LayoutParams = {\n\treadOnly: boolean,\n\tsettingsModel: SettingsModel,\n\texternalIcon: HTMLElement,\n};\n\nexport class Layout\n{\n\tHELP_DESK_CODE_CALENDAR = 17198666;\n\tHELP_DESK_CODE_CRM = 17502612;\n\n\tCONTEXT = {\n\t\tCRM: 'crm',\n\t\tCALENDAR: 'calendar',\n\t};\n\n\t#params: LayoutParams;\n\n\t#layout: {\n\t\twrap: HTMLElement,\n\t\tmain: HTMLElement,\n\t\tmainTop: HTMLElement,\n\t\tmainBottom: HTMLElement,\n\t\tbuttonHistory: HTMLElement,\n\t\tbuttonCopy: HTMLElement,\n\t\tbuttonWhatSeeUsers: HTMLElement,\n\t};\n\n\t#settingsControl: Settings;\n\t#userSelectorControl: UserSelector;\n\t#linkList: List;\n\n\tconstructor(params: LayoutParams)\n\t{\n\t\tthis.#params = params;\n\t\tthis.#layout = {};\n\t\tthis.#bindEvents();\n\t\tthis.isGroupContext = params.settingsModel.getCalendarContext()?.sharingObjectType === 'group';\n\t}\n\n\tget #settingsModel(): SettingsModel\n\t{\n\t\treturn this.#params.settingsModel;\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tEvent.bind(window, 'beforeunload', () => this.#settingsModel.save());\n\t\tEventEmitter.subscribe('CalendarSharing:onJointLinkCopy', async (event) => {\n\t\t\tconst shortUrl = event.data.shortUrl;\n\t\t\tconst linkHash = event.data.hash;\n\n\t\t\tawait this.copyLink(shortUrl, linkHash);\n\n\t\t\tAnalytics.sendLinkCopiedList(this.#settingsModel.getContext(), {\n\t\t\t\tpeopleCount: event.data.members.length + 1,\n\t\t\t\truleChanges: this.#settingsModel.getChanges(),\n\t\t\t});\n\t\t});\n\t}\n\n\treset(): void\n\t{\n\t\tvoid this.#settingsModel.save();\n\t\tthis.#userSelectorControl?.clearSelectedUsers();\n\t\tsetTimeout(() => this.#linkList?.close(), 200);\n\t}\n\n\thasShownPopups(): boolean\n\t{\n\t\tconst isSettingsPopupShown = this.#settingsControl.hasShownPopups();\n\t\tconst isUserSelectorDialogOpened = this.#userSelectorControl?.isUserSelectorDialogOpened();\n\t\tconst isListItemPopupOpened = this.#linkList?.isOpenListItemPopup();\n\n\t\treturn isSettingsPopupShown || isUserSelectorDialogOpened || isListItemPopupOpened;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.#layout.wrap = Tag.render`\n\t\t\t<div class=\"calendar-sharing__dialog-wrapper\">\n\t\t\t\t${this.#renderMain()}\n\t\t\t\t${this.isGroupContext ? null : this.#renderLinkList()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#layout.wrap;\n\t}\n\n\t#renderMain(): HTMLElement\n\t{\n\t\tthis.#layout.main ??= Tag.render`\n\t\t\t<div class=\"calendar-sharing__dialog-content-wrapper --show\">\n\t\t\t\t${this.#renderTop()}\n\t\t\t\t<div class=\"calendar-sharing__dialog-body\">\n\t\t\t\t\t${this.#renderDialogMessage()}\n\t\t\t\t\t${this.#renderSettings()}\n\t\t\t\t\t${this.#renderMembers()}\n\t\t\t\t</div>\n\t\t\t\t${this.#renderMainBottom()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#layout.main;\n\t}\n\n\t#renderDialogMessage(): HTMLElement | string\n\t{\n\t\tif (\n\t\t\tthis.#settingsModel.getContext() === this.CONTEXT.CRM\n\t\t\t|| this.isGroupContext\n\t\t)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__dialog-message\">\n\t\t\t\t<div class=\"calendar-sharing__dialog-info-icon-container\">\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-info-icon\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"calendar-sharing__dialog-notify\" onclick=\"${this.#onOpenLink.bind(this)}\">\n\t\t\t\t\t${Loc.getMessage('SHARING_INFO_POPUP_CONTENT_4_V3', { '#LINK#': this.#settingsModel.getSharingUrl() })}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tasync #onOpenLink(): Promise\n\t{\n\t\tawait this.#settingsModel.save();\n\t\twindow.open(this.#settingsModel.getSharingUrl(), '_blank').focus();\n\t}\n\n\t#renderTop(): HTMLElement\n\t{\n\t\tif (!this.#layout.mainTop)\n\t\t{\n\t\t\tthis.#layout.mainTop = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__dialog-top\">\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-title\">\n\t\t\t\t\t\t<span>${Loc.getMessage('SHARING_BUTTON_TITLE')}</span>\n\t\t\t\t\t\t${this.#renderHowDoesItWorkIcon()}\n\t\t\t\t\t\t${this.#params.externalIcon ?? ''}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"calendar-sharing__dialog-info\">\n\t\t\t\t\t\t${this.#getSharingInfoMessage()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tconst howDoesItWork = this.#layout.mainTop.querySelector('[data-role=\"calendar-sharing-how-does-it-work\"]');\n\t\t\tEvent.bind(howDoesItWork, 'click', this.#openHelpDesk.bind(this));\n\n\t\t\tconst infoNotify = this.#layout.mainTop.querySelector('[data-role=\"calendar-sharing_popup-open-link\"]');\n\n\t\t\tif (infoNotify)\n\t\t\t{\n\t\t\t\tlet infoNotifyHint;\n\t\t\t\tlet timer;\n\t\t\t\tEvent.bind(infoNotify, 'mouseenter', () => {\n\t\t\t\t\ttimer = setTimeout(() => {\n\t\t\t\t\t\tif (!infoNotifyHint)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinfoNotifyHint = new Popup({\n\t\t\t\t\t\t\t\tbindElement: infoNotify,\n\t\t\t\t\t\t\t\tangle: {\n\t\t\t\t\t\t\t\t\toffset: infoNotify.offsetWidth / 2 + 16,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\twidth: 410,\n\t\t\t\t\t\t\t\tdarkMode: true,\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('SHARING_INFO_POPUP_SLOT_DESC'),\n\t\t\t\t\t\t\t\tanimation: 'fading-slide',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinfoNotifyHint.show();\n\t\t\t\t\t}, 1000);\n\t\t\t\t});\n\n\t\t\t\tEvent.bind(infoNotify, 'mouseleave', () => {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\tif (infoNotifyHint)\n\t\t\t\t\t{\n\t\t\t\t\t\tinfoNotifyHint.close();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this.#layout.mainTop;\n\t}\n\n\t#renderHowDoesItWorkIcon(): HTMLElement | string\n\t{\n\t\tif (this.#settingsModel.getContext() === this.CONTEXT.CRM)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst howDoesItWork = Tag.render`\n\t\t\t<span\n\t\t\t\tclass=\"calendar-sharing__dialog-title-help\"\n\t\t\t\ttitle=\"${Loc.getMessage('SHARING_INFO_POPUP_HOW_IT_WORK')}\"\n\t\t\t></span>\n\t\t`;\n\n\t\tEvent.bind(howDoesItWork, 'click', this.#openHelpDesk.bind(this));\n\n\t\treturn howDoesItWork;\n\t}\n\n\t#openHelpDesk(): void\n\t{\n\t\ttop.BX.Helper.show(`redirect=detail&code=${this.#getContextHelpDeskCode()}`);\n\t}\n\n\t#getSharingInfoMessage(): string\n\t{\n\t\tswitch (this.#settingsModel.getContext())\n\t\t{\n\t\t\tcase this.CONTEXT.CALENDAR:\n\t\t\t\treturn Loc.getMessage('SHARING_INFO_POPUP_CONTENT_3_CALENDAR');\n\t\t\tcase this.CONTEXT.CRM:\n\t\t\t\treturn Loc.getMessage('SHARING_INFO_POPUP_CONTENT_3_CRM_MSGVER_2');\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n\n\t#getContextHelpDeskCode(): number\n\t{\n\t\tswitch (this.#settingsModel.getContext())\n\t\t{\n\t\t\tcase this.CONTEXT.CALENDAR:\n\t\t\t\treturn this.HELP_DESK_CODE_CALENDAR;\n\n\t\t\tcase this.CONTEXT.CRM:\n\t\t\t\treturn this.HELP_DESK_CODE_CRM;\n\n\t\t\tdefault:\n\t\t\t\treturn 0;\n\t\t}\n\t}\n\n\t#renderSettings(): HTMLElement\n\t{\n\t\tthis.#settingsControl = new Settings({\n\t\t\treadOnly: this.#params.readOnly,\n\t\t\tmodel: this.#settingsModel,\n\t\t});\n\n\t\treturn this.#settingsControl.render();\n\t}\n\n\t#renderMembers(): HTMLElement\n\t{\n\t\tthis.#userSelectorControl = new UserSelector({\n\t\t\tmodel: this.#settingsModel,\n\t\t\tonMembersAdded: () => Analytics.sendMembersAdded(\n\t\t\t\tthis.#settingsModel.getContext(),\n\t\t\t\tthis.#userSelectorControl.getPeopleCount(),\n\t\t\t),\n\t\t});\n\n\t\treturn this.#userSelectorControl.render();\n\t}\n\n\t#renderMainBottom(): HTMLElement\n\t{\n\t\tif (this.#settingsModel.getContext() === this.CONTEXT.CRM)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tthis.#layout.mainBottom ??= Tag.render`\n\t\t\t<div class=\"calendar-sharing__dialog-bottom\">\n\t\t\t\t${this.#renderCopyLinkButton()}\n\t\t\t\t${this.isGroupContext ? null : this.#renderLinkHistoryButton()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#layout.mainBottom;\n\t}\n\n\t#renderCopyLinkButton(): HTMLElement\n\t{\n\t\tif (!this.#layout.buttonCopy)\n\t\t{\n\t\t\tthis.#layout.buttonCopy = Tag.render`\n\t\t\t\t<span class=\"ui-btn ui-btn-success ui-btn-round ui-btn-no-caps calendar-sharing__dialog-copy\">\n\t\t\t\t\t${Loc.getMessage('SHARING_DIALOG_SHARING_BLOCK_COPY_LINK_BUTTON')}\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.#layout.buttonCopy, 'click', this.#onButtonCopyClick.bind(this));\n\t\t}\n\n\t\treturn this.#layout.buttonCopy;\n\t}\n\n\tasync #onButtonCopyClick(): void\n\t{\n\t\tconst params = {\n\t\t\tpeopleCount: this.#userSelectorControl?.getPeopleCount() ?? 1,\n\t\t\truleChanges: this.#settingsModel.getChanges(),\n\t\t};\n\n\t\tif (this.#userSelectorControl && this.#userSelectorControl.hasChanges())\n\t\t{\n\t\t\tAnalytics.sendLinkCopied(this.#settingsModel.getContext(), Analytics.linkTypes.multiple, params);\n\n\t\t\tvoid this.saveJointLink();\n\t\t}\n\t\telse if (await this.copyLink(this.#settingsModel.getSharingUrl()))\n\t\t{\n\t\t\tAnalytics.sendLinkCopied(this.#settingsModel.getContext(), Analytics.linkTypes.solo, params);\n\n\t\t\tif (!this.isGroupContext)\n\t\t\t{\n\t\t\t\tthis.#settingsModel.increaseFrequentUse();\n\t\t\t}\n\t\t}\n\t}\n\n\tasync saveJointLink(): Promise\n\t{\n\t\tif (this.#layout.buttonCopy && Dom.hasClass(this.#layout.buttonCopy, 'ui-btn-clock'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.#layout.buttonCopy, 'ui-btn-clock');\n\n\t\tconst link = await this.#settingsModel.saveJointLink();\n\n\t\tDom.removeClass(this.#layout.buttonCopy, 'ui-btn-clock');\n\n\t\tawait this.copyLink(link.url, link.hash);\n\n\t\tthis.#linkList?.getLinkListInfo();\n\t}\n\n\t#renderLinkHistoryButton(): HTMLElement\n\t{\n\t\tif (!this.#layout.buttonHistory)\n\t\t{\n\t\t\tthis.#layout.buttonHistory = Tag.render`\n\t\t\t\t<span\n\t\t\t\t\tclass=\"ui-btn ui-btn-round ui-btn-light ui-btn-no-caps calendar-sharing__dialog-people\"\n\t\t\t\t\tdata-id=\"calendar-sharing-history-btn\"\n\t\t\t\t>\n\t\t\t\t\t${Loc.getMessage('SHARING_DIALOG_SHARING_BLOCK_JOINT_SLOTS_BUTTON')}\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.#layout.buttonHistory, 'click', this.#openLinkList.bind(this));\n\t\t}\n\n\t\treturn this.#layout.buttonHistory;\n\t}\n\n\t#renderLinkList(): HTMLElement | null\n\t{\n\t\tif (this.#settingsModel.getContext() === this.CONTEXT.CRM)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#getLinkList().render();\n\t}\n\n\t#getLinkList(): List\n\t{\n\t\tthis.#linkList ??= new List({\n\t\t\tmodel: this.#settingsModel,\n\t\t\tonLinkListClose: this.#closeLinkList.bind(this),\n\t\t});\n\n\t\treturn this.#linkList;\n\t}\n\n\t#openLinkList(): void\n\t{\n\t\tDom.removeClass(this.#layout.main, '--show');\n\t\tthis.#linkList.show(this.#layout.main.offsetHeight);\n\t}\n\n\t#closeLinkList(): void\n\t{\n\t\tDom.addClass(this.#layout.main, '--show');\n\t}\n\n\tasync copyLink(url: string, hash: string): Promise<boolean>\n\t{\n\t\tif (!url)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#copyToClipboard(url);\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tUtil.showNotification(Loc.getMessage('SHARING_COPY_LINK_NOTIFICATION'));\n\t\tEventEmitter.emit('CalendarSharing:LinkCopied', { url, hash });\n\n\t\treturn true;\n\t}\n\n\tasync #copyToClipboard(textToCopy: string): Promise<void>\n\t{\n\t\tif (!Type.isString(textToCopy))\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\t// navigator.clipboard defined only if window.isSecureContext === true\n\t\t// so or https should be activated, or localhost address\n\t\tif (navigator.clipboard)\n\t\t{\n\t\t\t// safari not allowed clipboard manipulation as result of ajax request\n\t\t\t// so timeout is hack for this, to prevent \"not have permission\"\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tsetTimeout(() => (\n\t\t\t\t\tnavigator.clipboard\n\t\t\t\t\t\t.writeText(textToCopy)\n\t\t\t\t\t\t.then(() => resolve())\n\t\t\t\t\t\t.catch((e) => reject(e))\n\t\t\t\t), 0);\n\t\t\t});\n\t\t}\n\n\t\treturn BX.clipboard?.copy(textToCopy) ? Promise.resolve() : Promise.reject();\n\t}\n}\n","import { Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Analytics } from 'calendar.sharing.analytics';\nimport type { RuleParams } from '../model/rule';\nimport type { Context, User } from '../model/index';\nimport { SettingsModel, CalendarSettings } from '../model/settings';\nimport { Layout } from './layout';\nimport { CalendarContext } from '../model';\n\nimport 'main.qrcode';\nimport 'ui.design-tokens';\n\ntype DialogOptions = {\n\tbindElement: HTMLElement,\n\tuserInfo: ?User,\n\tsharingUrl: string,\n\tlinkHash: string,\n\tsharingRule: RuleParams,\n\tcalendarSettings: CalendarSettings,\n\tcontext: Context,\n\treadOnly: boolean,\n\tsettingsCollapsed: boolean,\n\tsortJointLinksByFrequentUse: boolean,\n\tcalendarContext: CalendarContext | null,\n};\n\nexport default class DialogNew\n{\n\t#popup: Popup;\n\t#layout: {\n\t\twrapper: HTMLElement,\n\t\tbindElement: HTMLElement,\n\t};\n\n\t#dialogLayout: Layout;\n\t#settingsModel: SettingsModel;\n\n\tconstructor(options: DialogOptions)\n\t{\n\t\tthis.#layout = {};\n\n\t\tthis.#layout.bindElement = options.bindElement;\n\n\t\tthis.#settingsModel = new SettingsModel({\n\t\t\tcontext: options.context,\n\t\t\tlinkHash: options.linkHash,\n\t\t\tsharingUrl: options.sharingUrl,\n\t\t\tuserInfo: options.userInfo,\n\t\t\trule: options.sharingRule,\n\t\t\tcalendarSettings: options.calendarSettings,\n\t\t\tcollapsed: options.settingsCollapsed,\n\t\t\tsortJointLinksByFrequentUse: options.sortJointLinksByFrequentUse,\n\t\t\tcalendarContext: options.calendarContext,\n\t\t});\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('CalendarSharing:LinkCopied', this.onSuccessfulCopyingLink.bind(this));\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', (event): void => this.checkAndClosePopupOnSlider(event));\n\t}\n\n\tgetPopup(): Popup\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#popup = new Popup({\n\t\t\t\tbindElement: this.#layout.bindElement,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tclassName: 'calendar-sharing__dialog',\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tpadding: 0,\n\t\t\t\twidth: 470,\n\t\t\t\tangle: this.#getAngleConfig(),\n\t\t\t\tautoHideHandler: (event) => this.canBeClosed(event),\n\t\t\t\tcontent: this.getPopupWrapper(),\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: this.onPopupShow.bind(this),\n\t\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\tonPopupShow(): void\n\t{\n\t\tDom.addClass(this.#layout.bindElement, 'ui-btn-hover');\n\n\t\tAnalytics.sendPopupOpened(this.#settingsModel.getContext());\n\t}\n\n\tonPopupClose(): void\n\t{\n\t\tDom.removeClass(this.#layout.bindElement, 'ui-btn-hover');\n\t\tthis.#dialogLayout.reset();\n\t}\n\n\tcanBeClosed(event): boolean\n\t{\n\t\tconst isClickInside = this.#layout.wrapper.contains(event.target);\n\t\tconst layoutHasShownPopups = this.#dialogLayout.hasShownPopups();\n\t\tconst topSlider = this.getTopSlider();\n\t\tconst calendarOpenInTopSlider = topSlider && this.getCalendarSliderParams(topSlider);\n\n\t\treturn !isClickInside\n\t\t\t&& !layoutHasShownPopups\n\t\t\t&& (\n\t\t\t\t!topSlider\n\t\t\t\t|| calendarOpenInTopSlider\n\t\t\t\t|| this.#isExternalSharing()\n\t\t\t)\n\t\t;\n\t}\n\n\tgetPopupWrapper(): HTMLElement\n\t{\n\t\tif (!this.#layout.wrapper)\n\t\t{\n\t\t\tthis.#dialogLayout = new Layout({\n\t\t\t\treadOnly: this.#settingsModel.getCalendarContext()?.sharingObjectType === 'group',\n\t\t\t\tsettingsModel: this.#settingsModel,\n\t\t\t});\n\t\t\tthis.#layout.wrapper = this.#dialogLayout.render();\n\t\t}\n\n\t\tthis.#layout.wrapper = this.#dialogLayout.render();\n\n\t\treturn this.#layout.wrapper;\n\t}\n\n\tonSuccessfulCopyingLink(): void\n\t{\n\t\tthis.closePopup();\n\t}\n\n\tclosePopup(): void\n\t{\n\t\tthis.getPopup().close();\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.getPopup().isShown();\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#settingsModel.sortRanges();\n\n\t\tthis.getPopup().adjustPosition({ forceBindPosition: true });\n\t\tthis.getPopup().show();\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.getPopup().destroy();\n\t}\n\n\tgetTopSlider(): BX.SidePanel.Slider | null\n\t{\n\t\treturn (this.#settingsModel.getContext() === 'calendar')\n\t\t\t? BX.SidePanel.Instance.getTopSlider()\n\t\t\t: false\n\t\t;\n\t}\n\n\tgetCalendarSliderParams(slider: BX.SidePanel.Slider): Array | null\n\t{\n\t\treturn slider.iframeSrc?.match(/\\/workgroups\\/group\\/(\\d+)\\/calendar\\//i);\n\t}\n\n\tcheckAndClosePopupOnSlider(event): void\n\t{\n\t\tif (!this.isShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst slider = event.getData() && event.getData()[0]?.slider;\n\n\t\tconst sliderParams = slider && this.getCalendarSliderParams(slider);\n\t\tif (!sliderParams)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst groupId = parseInt(sliderParams[1], 10);\n\t\tif (!groupId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentGroupId = this.#settingsModel.getCalendarContext()?.sharingObjectId;\n\t\tif (currentGroupId && groupId !== currentGroupId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.closePopup();\n\t}\n\n\t#isExternalSharing(): boolean\n\t{\n\t\treturn Boolean(this.#settingsModel.getCalendarContext()?.externalSharing);\n\t}\n\n\t#getAngleConfig()\n\t{\n\t\tif (this.#isExternalSharing())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\toffset: this.#layout.bindElement.offsetWidth / 2 + 16,\n\t\t};\n\t}\n}\n","import { Dom, Event, Loc, Tag, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Button, ButtonSize, ButtonColor, ButtonIcon } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Util } from 'calendar.util';\nimport DialogNew from './dialog-new';\nimport 'ui.switcher';\nimport 'spotlight';\nimport { Guide } from 'ui.tour';\nimport { Counter } from 'ui.cnt';\nimport { FeaturePromotersRegistry } from 'ui.info-helper';\n\nexport default class SharingButton\n{\n\tPAY_ATTENTION_TO_NEW_FEATURE_DELAY = 1000;\n\n\tPAY_ATTENTION_TO_NEW_FEATURE_FIRST = 'first-feature';\n\tPAY_ATTENTION_TO_NEW_FEATURE_NEW = 'new-feature';\n\tPAY_ATTENTION_TO_NEW_FEATURE_REMIND = 'remind-feature';\n\tPAY_ATTENTION_TO_NEW_FEATURE_JOINT = 'joint-sharing';\n\n\tPAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS = [this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST];\n\tPAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS = [\n\t\tthis.PAY_ATTENTION_TO_NEW_FEATURE_NEW,\n\t\tthis.PAY_ATTENTION_TO_NEW_FEATURE_REMIND,\n\n\t];\n\n\tconstructor(options = {})\n\t{\n\t\tthis.wrap = options.wrap;\n\t\tthis.userInfo = options.userInfo || null;\n\t\tthis.sharingConfig = Util.getSharingConfig();\n\t\tthis.sharingUrl = this.sharingConfig?.url || null;\n\t\tthis.linkHash = this.sharingConfig?.hash || null;\n\t\tthis.sharingRule = this.sharingConfig?.rule || null;\n\t\tthis.payAttentionToNewFeatureMode = options.payAttentionToNewFeature;\n\t\tthis.sharingFeatureLimit = options.sharingFeatureLimit;\n\t\tthis.sharingSettingsCollapsed = options.sharingSettingsCollapsed;\n\t\tthis.sortJointLinksByFrequentUse = options.sortJointLinksByFrequentUse;\n\t}\n\n\tshow()\n\t{\n\t\tDom.addClass(this.wrap, 'calendar-sharing__btn-wrap');\n\t\tthis.button = new Button({\n\t\t\ttext: Loc.getMessage('SHARING_BUTTON_TITLE'),\n\t\t\tround: true,\n\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\ticon: this.sharingFeatureLimit ? ButtonIcon.LOCK : null,\n\t\t\tclassName: 'ui-btn-themes calendar-sharing__btn',\n\t\t\tonclick: (button, event) => {\n\t\t\t\tif (!this.switcher.getNode().contains(event.target))\n\t\t\t\t{\n\t\t\t\t\tthis.handleSharingButtonClick();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.button.renderTo(this.wrap);\n\t\tthis.renderSwitcher();\n\n\t\tif (this.payAttentionToNewFeatureMode === this.PAY_ATTENTION_TO_NEW_FEATURE_JOINT)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (BX.SidePanel.Instance.getTopSlider() === null)\n\t\t\t\t{\n\t\t\t\t\tthis.payAttentionToNewFeatureWithText();\n\t\t\t\t\tBX.ajax.runAction('calendar.api.sharingajax.disableOptionPayAttentionToNewSharingFeature');\n\t\t\t\t}\n\t\t\t}, this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY);\n\t\t}\n\t}\n\n\thandleSharingButtonClick()\n\t{\n\t\tif (this.sharingFeatureLimit)\n\t\t{\n\t\t\tFeaturePromotersRegistry.getPromoter({ featureId: 'calendar_sharing' }).show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isSharingEnabled())\n\t\t{\n\t\t\tthis.openDialog();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.switcher.toggle();\n\t\t}\n\t}\n\n\tgetSwitcherContainer()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__switcher\"></div>\n\t\t`;\n\t}\n\n\tgetSwitcherDivider()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__switcher_divider\"></div>\n\t\t`;\n\t}\n\n\trenderSwitcher()\n\t{\n\t\tDom.append(this.getSwitcherDivider(), this.wrap);\n\t\tthis.switcherWrap = Tag.render`<div class=\"calendar-sharing__switcher-wrap\"></div>`;\n\t\tDom.append(this.switcherWrap, this.wrap);\n\t\tEvent.bind(this.switcherWrap, 'click', this.handleSwitcherWrapClick.bind(this), { capture: true });\n\n\t\tthis.switcher = new BX.UI.Switcher({\n\t\t\tnode: this.getSwitcherContainer(),\n\t\t\tchecked: this.isSharingEnabled() && !this.sharingFeatureLimit,\n\t\t\tcolor: 'green',\n\t\t\tsize: 'small',\n\t\t\thandlers: {\n\t\t\t\ttoggled: () => this.handleSwitcherToggled(),\n\t\t\t},\n\t\t});\n\n\t\tthis.switcher.renderTo(this.switcherWrap);\n\t}\n\n\thandleSwitcherWrapClick(event)\n\t{\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tthis.showWarningPopup();\n\t\t\tevent.stopPropagation();\n\t\t}\n\t}\n\n\thandleSwitcherToggled()\n\t{\n\t\tif (this.sharingFeatureLimit && this.switcher.isChecked())\n\t\t{\n\t\t\tFeaturePromotersRegistry.getPromoter({ featureId: 'calendar_sharing' }).show();\n\t\t\tthis.switcher.toggle();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isToggledAfterErrorOccurred())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.switcher.isChecked())\n\t\t{\n\t\t\tthis.enableSharing();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.disableSharing();\n\t\t}\n\t}\n\n\tisToggledAfterErrorOccurred()\n\t{\n\t\treturn this.switcher.isChecked() === this.isSharingEnabled();\n\t}\n\n\tisSharingEnabled()\n\t{\n\t\treturn Type.isString(this.sharingUrl);\n\t}\n\n\tenableSharing()\n\t{\n\t\tconst action = 'calendar.api.sharingajax.enableUserSharing';\n\t\tconst event = 'Calendar.Sharing.copyLinkButton:onSharingEnabled';\n\n\t\tBX.ajax.runAction(action)\n\t\t\t.then((response) => {\n\t\t\t\tthis.sharingUrl = response.data.url;\n\t\t\t\tthis.linkHash = response.data.hash;\n\t\t\t\tthis.sharingRule = response.data.rule;\n\t\t\t\tthis.openDialog();\n\n\t\t\t\tEventEmitter.emit(\n\t\t\t\t\tevent,\n\t\t\t\t\t{\n\t\t\t\t\t\tisChecked: this.switcher.isChecked(),\n\t\t\t\t\t\turl: response.data.url,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tthis.switcher.toggle();\n\t\t\t})\n\t\t;\n\t}\n\n\topenDialog()\n\t{\n\t\tthis.pulsar?.close();\n\t\tDom.remove(this.counterNode);\n\n\t\tif (!this.newDialog)\n\t\t{\n\t\t\tthis.newDialog = new DialogNew({\n\t\t\t\tbindElement: this.button.getContainer(),\n\t\t\t\tsharingUrl: this.sharingUrl,\n\t\t\t\tlinkHash: this.linkHash,\n\t\t\t\tsharingRule: this.sharingRule,\n\t\t\t\tcontext: 'calendar',\n\t\t\t\tcalendarSettings: {\n\t\t\t\t\tweekHolidays: Util.config.week_holidays,\n\t\t\t\t\tweekStart: Util.config.week_start,\n\t\t\t\t\tworkTimeStart: Util.config.work_time_start,\n\t\t\t\t\tworkTimeEnd: Util.config.work_time_end,\n\t\t\t\t},\n\t\t\t\tuserInfo: this.userInfo,\n\t\t\t\tsettingsCollapsed: this.sharingSettingsCollapsed,\n\t\t\t\tsortJointLinksByFrequentUse: this.sortJointLinksByFrequentUse,\n\t\t\t});\n\t\t}\n\n\t\tif (!this.newDialog.isShown())\n\t\t{\n\t\t\tthis.newDialog.show();\n\t\t}\n\t}\n\n\tdisableSharing()\n\t{\n\t\tconst action = 'calendar.api.sharingajax.disableUserSharing';\n\t\tconst event = 'Calendar.Sharing.copyLinkButton:onSharingDisabled';\n\t\tthis.warningPopup.close();\n\n\t\tBX.ajax.runAction(action)\n\t\t\t.then(() => {\n\t\t\t\tthis.sharingUrl = null;\n\t\t\t\tif (this.newDialog)\n\t\t\t\t{\n\t\t\t\t\tthis.newDialog.destroy();\n\t\t\t\t\tthis.newDialog = null;\n\t\t\t\t}\n\t\t\t\tEventEmitter.emit(event, { isChecked: this.switcher.isChecked() });\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tthis.switcher.toggle();\n\t\t\t})\n\t\t;\n\t}\n\n\tshowWarningPopup()\n\t{\n\t\tif (!this.warningPopup)\n\t\t{\n\t\t\tthis.warningPopup = new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('SHARING_WARNING_POPUP_TITLE_1'),\n\t\t\t\tmessage: Loc.getMessage('SHARING_WARNING_POPUP_CONTENT_2'),\n\t\t\t\tbuttons: this.getWarningPopupButtons(),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tminWidth: 365,\n\t\t\t\t\tmaxWidth: 385,\n\t\t\t\t\tminHeight: 180,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tthis.warningPopup.show();\n\t}\n\n\tgetWarningPopupButtons()\n\t{\n\t\treturn [this.getSubmitButton(), this.getCancelButton()];\n\t}\n\n\tgetSubmitButton()\n\t{\n\t\treturn new Button({\n\t\t\tsize: ButtonSize.MEDIUM,\n\t\t\tcolor: ButtonColor.DANGER,\n\t\t\ttext: Loc.getMessage('SHARING_WARNING_POPUP_SUBMIT_BUTTON_NEW_MSGVER_1'),\n\t\t\tevents: {\n\t\t\t\tclick: () => this.handleSubmitButtonClick(),\n\t\t\t},\n\t\t});\n\t}\n\n\tgetCancelButton()\n\t{\n\t\treturn new Button({\n\t\t\tsize: ButtonSize.MEDIUM,\n\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\ttext: Loc.getMessage('SHARING_WARNING_POPUP_CANCEL_BUTTON'),\n\t\t\tevents: {\n\t\t\t\tclick: () => this.handleCancelButtonClick(),\n\t\t\t},\n\t\t});\n\t}\n\n\thandleSubmitButtonClick()\n\t{\n\t\tthis.switcher.toggle();\n\t\tthis.warningPopup.close();\n\t}\n\n\thandleCancelButtonClick()\n\t{\n\t\tthis.warningPopup.close();\n\t}\n\n\tpayAttentionToNewFeature(mode)\n\t{\n\t\tif (this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS.includes(mode))\n\t\t{\n\t\t\tthis.payAttentionToNewFeatureWithoutText();\n\t\t}\n\n\t\tif (this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS.includes(mode))\n\t\t{\n\t\t\tthis.payAttentionToNewFeatureWithText();\n\t\t}\n\t}\n\n\tpayAttentionToNewFeatureWithoutText()\n\t{\n\t\tthis.pulsar = this.getPulsar(this.wrap, false);\n\t\tthis.pulsar.show();\n\t\tEvent.bind(this.pulsar.container, 'click', () => {\n\t\t\tthis.handleSharingButtonClick();\n\t\t});\n\n\t\tthis.counterNode = (new Counter({\n\t\t\tvalue: 1,\n\t\t\tcolor: Counter.Color.DANGER,\n\t\t\tsize: Counter.Size.MEDIUM,\n\t\t\tanimation: false,\n\t\t})).getContainer();\n\t\tDom.addClass(this.counterNode, 'calendar-sharing__new-feature-counter');\n\t\tDom.append(this.counterNode, this.wrap);\n\t}\n\n\tpayAttentionToNewFeatureWithText()\n\t{\n\t\tconst title = Loc.getMessage('CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_JOINT_TITLE');\n\t\tconst text = Loc.getMessage('CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_JOINT_TEXT');\n\n\t\tconst guide = this.getGuide(title, text);\n\t\tconst pulsar = this.getPulsar(this.wrap);\n\n\t\tguide.showNextStep();\n\t\tguide.getPopup().setAngle({ offset: 210 });\n\n\t\tpulsar.show();\n\t}\n\n\tgetGuide(title, text)\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsimpleMode: true,\n\t\t\tonEvents: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.wrap,\n\t\t\t\t\ttitle,\n\t\t\t\t\ttext,\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: true,\n\t\t\t\t\t\tbottom: false,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tconst guidePopup = guide.getPopup();\n\t\tDom.addClass(guidePopup.popupContainer, 'calendar-popup-ui-tour-animate');\n\t\tguidePopup.setWidth(400);\n\t\tDom.style(guidePopup.getContentContainer(), 'paddingRight', getComputedStyle(guidePopup.closeIcon).width);\n\n\t\treturn guide;\n\t}\n\n\tgetPulsar(target, hideOnHover = true)\n\t{\n\t\tconst pulsar = new BX.SpotLight({\n\t\t\ttargetElement: target,\n\t\t\ttargetVertex: 'middle-center',\n\t\t\tlightMode: true,\n\t\t});\n\t\tif (hideOnHover)\n\t\t{\n\t\t\tpulsar.bindEvents({\n\t\t\t\tonTargetEnter: () => pulsar.close(),\n\t\t\t});\n\t\t}\n\n\t\treturn pulsar;\n\t}\n}\n","import { Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Util } from 'calendar.util';\nimport DialogNew from './dialog-new';\nimport SharingButton from './sharingbutton';\n\nexport default class GroupSharingButton extends SharingButton\n{\n\tconstructor(options = {})\n\t{\n\t\tsuper(options);\n\n\t\tthis.calendarContext = options.calendarContext;\n\t}\n\n\t/**\n\t * @override\n\t */\n\topenDialog()\n\t{\n\t\tthis.pulsar?.close();\n\t\tDom.remove(this.counterNode);\n\n\t\tif (!this.newDialog)\n\t\t{\n\t\t\tthis.newDialog = new DialogNew({\n\t\t\t\tbindElement: this.button.getContainer(),\n\t\t\t\tsharingUrl: this.sharingUrl,\n\t\t\t\tlinkHash: this.linkHash,\n\t\t\t\tsharingRule: this.sharingRule,\n\t\t\t\tcontext: 'calendar',\n\t\t\t\tcalendarSettings: {\n\t\t\t\t\tweekHolidays: Util.config.week_holidays,\n\t\t\t\t\tweekStart: Util.config.week_start,\n\t\t\t\t\tworkTimeStart: Util.config.work_time_start,\n\t\t\t\t\tworkTimeEnd: Util.config.work_time_end,\n\t\t\t\t},\n\t\t\t\tuserInfo: this.userInfo,\n\t\t\t\tsettingsCollapsed: this.sharingSettingsCollapsed,\n\t\t\t\tsortJointLinksByFrequentUse: this.sortJointLinksByFrequentUse,\n\t\t\t\tcalendarContext: this.calendarContext,\n\t\t\t});\n\t\t}\n\n\t\tif (!this.newDialog.isShown())\n\t\t{\n\t\t\tthis.newDialog.show();\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t */\n\tenableSharing()\n\t{\n\t\tconst event = 'Calendar.Sharing.copyLinkButton:onSharingEnabled';\n\n\t\tBX.ajax\n\t\t\t.runAction(\n\t\t\t\t'calendar.api.sharinggroupajax.enableSharing',\n\t\t\t\t{ data: { groupId: this.calendarContext.sharingObjectId } },\n\t\t\t)\n\t\t\t.then((response) => {\n\t\t\t\tthis.sharingUrl = response.data.url;\n\t\t\t\tthis.linkHash = response.data.hash;\n\t\t\t\tthis.sharingRule = response.data.rule;\n\t\t\t\tthis.openDialog();\n\n\t\t\t\tEventEmitter.emit(\n\t\t\t\t\tevent,\n\t\t\t\t\t{\n\t\t\t\t\t\tisChecked: this.switcher.isChecked(),\n\t\t\t\t\t\turl: response.data.url,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tthis.switcher.toggle();\n\t\t\t})\n\t\t;\n\t}\n\n\t/**\n\t * @override\n\t */\n\tdisableSharing()\n\t{\n\t\tconst event = 'Calendar.Sharing.copyLinkButton:onSharingDisabled';\n\t\tthis.warningPopup.close();\n\n\t\tBX.ajax\n\t\t\t.runAction(\n\t\t\t\t'calendar.api.sharinggroupajax.disableSharing',\n\t\t\t\t{ data: { groupId: this.calendarContext.sharingObjectId } },\n\t\t\t)\n\t\t\t.then(() => {\n\t\t\t\tthis.sharingUrl = null;\n\t\t\t\tif (this.newDialog)\n\t\t\t\t{\n\t\t\t\t\tthis.newDialog.destroy();\n\t\t\t\t\tthis.newDialog = null;\n\t\t\t\t}\n\t\t\t\tEventEmitter.emit(event, { isChecked: this.switcher.isChecked() });\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tthis.switcher.toggle();\n\t\t\t})\n\t\t;\n\t}\n}\n","import SharingButton from './controls/sharingbutton';\nimport GroupSharingButton from './controls/groupsharingbutton';\n\nexport default class Interface\n{\n\tconstructor(options)\n\t{\n\t\tthis.buttonWrap = options.buttonWrap;\n\t\tthis.userInfo = options.userInfo || null;\n\t\tthis.payAttentionToNewFeature = options.payAttentionToNewFeature ?? false;\n\t\tthis.sharingFeatureLimit = options.sharingFeatureLimit ?? false;\n\t\tthis.sharingSettingsCollapsed = options.sharingSettingsCollapsed ?? false;\n\t\tthis.sortJointLinksByFrequentUse = options.sortJointLinksByFrequentUse ?? false;\n\t\tthis.calendarContext = options.calendarContext ?? null;\n\t}\n\n\tshowSharingButton()\n\t{\n\t\tthis.sharingButton = new SharingButton({\n\t\t\twrap: this.buttonWrap,\n\t\t\tuserInfo: this.userInfo,\n\t\t\tpayAttentionToNewFeature: this.payAttentionToNewFeature,\n\t\t\tsharingFeatureLimit: this.sharingFeatureLimit,\n\t\t\tsharingSettingsCollapsed: this.sharingSettingsCollapsed,\n\t\t\tsortJointLinksByFrequentUse: this.sortJointLinksByFrequentUse,\n\t\t});\n\t\tthis.sharingButton.show();\n\t}\n\n\tshowGroupSharingButton(): void\n\t{\n\t\tthis.sharingButton = new GroupSharingButton({\n\t\t\twrap: this.buttonWrap,\n\t\t\tuserInfo: this.userInfo,\n\t\t\tpayAttentionToNewFeature: this.payAttentionToNewFeature,\n\t\t\tsharingFeatureLimit: this.sharingFeatureLimit,\n\t\t\tsharingSettingsCollapsed: this.sharingSettingsCollapsed,\n\t\t\tsortJointLinksByFrequentUse: this.sortJointLinksByFrequentUse,\n\t\t\tcalendarContext: this.calendarContext,\n\t\t});\n\t\tthis.sharingButton.show();\n\t}\n}\n","import { Tag, Loc, Runtime } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Loader } from 'main.loader';\n\ntype DialogQrOptions = {\n\tsharingUrl: string,\n\tcontext: 'calendar' | 'crm',\n}\nexport default class DialogQr\n{\n\tQRCODE_SIZE = 114;\n\tQRCODE_COLOR_LIGHT = '#fff';\n\tQRCODE_COLOR_DARK = '#000';\n\t#popup;\n\t#loader;\n\t#layout;\n\t#qrCode;\n\t#context;\n\n\tconstructor(options: DialogQrOptions)\n\t{\n\t\tthis.#popup = null;\n\t\tthis.#loader = null;\n\t\tthis.#layout = {\n\t\t\tqr: null,\n\t\t};\n\t\tthis.#qrCode = null;\n\t\tthis.#context = options.context;\n\n\t\tthis.sharingUrl = options.sharingUrl;\n\t}\n\n\t/**\n\t *\n\t * @returns {Popup}\n\t */\n\tgetPopup()\n\t{\n\t\tif (!this.#popup)\n\t\t{\n\t\t\tthis.#popup = new Popup({\n\t\t\t\tclassName: 'calendar-sharing__qr',\n\t\t\t\twidth: 315,\n\t\t\t\tpadding: 0,\n\t\t\t\tcontent: this.getContent(),\n\t\t\t\tcloseIcon: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\toverlay: true,\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t/**\n\t *\n\t * @returns {Loader}\n\t */\n\tgetLoader()\n\t{\n\t\tif (!this.#loader)\n\t\t{\n\t\t\tthis.#loader = new Loader({ size: 95 });\n\t\t}\n\n\t\treturn this.#loader;\n\t}\n\n\t/**\n\t *\n\t * @returns {HTMLElement}\n\t */\n\tgetNodeQr()\n\t{\n\t\tif (!this.#layout.qr)\n\t\t{\n\t\t\tthis.#layout.qr = Tag.render`\n\t\t\t\t<div class=\"calendar-sharing__qr-block\"></div>\n\t\t\t`;\n\n\t\t\t// qr emulation\n\t\t\tthis.getLoader().show(this.#layout.qr);\n\n\t\t\tthis.showQr();\n\t\t}\n\n\t\treturn this.#layout.qr;\n\t}\n\n\tasync showQr()\n\t{\n\t\tawait this.initQrCode();\n\t\tthis.QRCode = new QRCode(this.#layout.qr, {\n\t\t\ttext: this.sharingUrl,\n\t\t\twidth: this.QRCODE_SIZE,\n\t\t\theight: this.QRCODE_SIZE,\n\t\t\tcolorDark: this.QRCODE_COLOR_DARK,\n\t\t\tcolorLight: this.QRCODE_COLOR_LIGHT,\n\t\t\tcorrectLevel: QRCode.CorrectLevel.H,\n\t\t});\n\t\tawait this.getLoader().hide();\n\t}\n\n\tasync initQrCode()\n\t{\n\t\tawait Runtime.loadExtension(['main.qrcode']);\n\t}\n\n\t/**\n\t *\n\t * @returns {HTMLElement}\n\t */\n\tgetContent()\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__qr-content\">\n\t\t\t\t<div class=\"calendar-sharing__qr-title\">${this.getPhraseDependsOnContext('SHARING_INFO_POPUP_QR_TITLE')}</div>\n\t\t\t\t${this.getNodeQr()}\n\t\t\t\t<div class=\"calendar-sharing__qr-info\">${Loc.getMessage('SHARING_INFO_POPUP_QR_INFO')}</div>\n\t\t\t\t<a class=\"calendar-sharing__dialog-link\" href=\"${this.sharingUrl}\" target=\"_blank\">${Loc.getMessage('SHARING_INFO_POPUP_QR_OPEN_LINK')}</a>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tisShown()\n\t{\n\t\treturn this.getPopup().isShown();\n\t}\n\n\tclose()\n\t{\n\t\tthis.getPopup().close();\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.getPopup().destroy();\n\t}\n\n\tgetPhraseDependsOnContext(code: string)\n\t{\n\t\treturn Loc.getMessage(`${code}_${this.#context.toUpperCase()}`);\n\t}\n}\n","import DialogNew from '../dialog-new';\nimport { EventEmitter } from 'main.core.events';\nimport GroupSharingButton from '../groupsharingbutton';\n\nexport default class GroupSharing extends GroupSharingButton\n{\n\tconstructor(options = {})\n\t{\n\t\tsuper(options);\n\n\t\tthis.bindElement = options.bindElement;\n\t\tthis.calendarSettings = options.calendarSettings;\n\t\tthis.context = options.context;\n\n\t\tif (options.sharingConfig)\n\t\t{\n\t\t\tthis.sharingConfig = options.sharingConfig;\n\t\t\tthis.sharingUrl = this.sharingConfig?.url || null;\n\t\t\tthis.linkHash = this.sharingConfig?.hash || null;\n\t\t\tthis.sharingRule = this.sharingConfig?.rule || null;\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t */\n\topenDialog()\n\t{\n\t\tif (!this.newDialog)\n\t\t{\n\t\t\tthis.newDialog = new DialogNew({\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tsharingUrl: this.sharingUrl,\n\t\t\t\tlinkHash: this.linkHash,\n\t\t\t\tsharingRule: this.sharingRule,\n\t\t\t\tcontext: this.context,\n\t\t\t\tcalendarSettings: {\n\t\t\t\t\tweekHolidays: this.calendarSettings.week_holidays,\n\t\t\t\t\tweekStart: this.calendarSettings.week_start,\n\t\t\t\t\tworkTimeStart: this.calendarSettings.work_time_start,\n\t\t\t\t\tworkTimeEnd: this.calendarSettings.work_time_end,\n\t\t\t\t},\n\t\t\t\tuserInfo: this.userInfo,\n\t\t\t\tsettingsCollapsed: this.sharingSettingsCollapsed,\n\t\t\t\tsortJointLinksByFrequentUse: this.sortJointLinksByFrequentUse,\n\t\t\t\tcalendarContext: this.calendarContext,\n\t\t\t});\n\t\t}\n\n\t\tif (!this.newDialog.isShown())\n\t\t{\n\t\t\tthis.newDialog.show();\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t */\n\tenableSharing()\n\t{\n\t\tconst event = 'Calendar.Sharing.copyLinkButton:onSharingEnabled';\n\t\tconst action = 'calendar.api.sharinggroupajax.enableSharing';\n\t\tconst data = { groupId: this.calendarContext.sharingObjectId };\n\n\t\tBX.ajax.runAction(action, { data })\n\t\t\t.then((response) => {\n\t\t\t\tEventEmitter.emit(\n\t\t\t\t\tevent,\n\t\t\t\t\t{\n\t\t\t\t\t\tisChecked: true,\n\t\t\t\t\t\turl: response.data.url,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t})\n\t\t;\n\t}\n}\n","import GroupSharing from './groupsharing';\nimport { User } from '../../model';\n\ntype GroupSharingConfig = {\n\tlink: {\n\t\turl: string,\n\t\thash: string,\n\t\trule: Object,\n\t},\n\tuserCalendarSettings: {\n\t\tweek_holidays: string,\n\t\tweek_start: string,\n\t\twork_time_start: string,\n\t\twork_time_end: string,\n\t},\n\tuser: User,\n}\n\nexport default class GroupSharingController\n{\n\tstatic #groupSharing: GroupSharing = null;\n\tstatic #groupId: number = null;\n\tstatic #bindElement: number = null;\n\tstatic #config = null;\n\n\tstatic async getGroupSharing(groupId: number, bindElement: HTMLElement): Promise<GroupSharing>\n\t{\n\t\tif (\n\t\t\tGroupSharingController.#groupSharing\n\t\t\t&& GroupSharingController.#groupId === groupId\n\t\t\t&& GroupSharingController.#bindElement === bindElement\n\t\t)\n\t\t{\n\t\t\treturn GroupSharingController.#groupSharing;\n\t\t}\n\n\t\tconst config = await this.#getSharingConfig(groupId);\n\n\t\tGroupSharingController.#groupSharing = new GroupSharing({\n\t\t\tbindElement,\n\t\t\tcontext: 'calendar',\n\t\t\tcalendarContext: {\n\t\t\t\tsharingObjectType: 'group',\n\t\t\t\tsharingObjectId: groupId,\n\t\t\t\texternalSharing: true,\n\t\t\t},\n\t\t\tuserInfo: {\n\t\t\t\tid: config.user.id,\n\t\t\t\tname: config.user.name,\n\t\t\t\tavatar: config.user.avatar,\n\t\t\t\tisCollabUser: config.user.isCollabUser,\n\t\t\t},\n\t\t\tsharingConfig: config.link,\n\t\t\tcalendarSettings: config.userCalendarSettings,\n\t\t});\n\n\t\tGroupSharingController.#config = config;\n\t\tGroupSharingController.#groupId = groupId;\n\t\tGroupSharingController.#bindElement = bindElement;\n\n\t\treturn this.#groupSharing;\n\t}\n\n\tstatic async #getSharingConfig(groupId: number): Promise<GroupSharingConfig>\n\t{\n\t\tif (\n\t\t\tthis.#groupId === groupId\n\t\t\t&& this.#config\n\t\t)\n\t\t{\n\t\t\treturn new Promise((resolve: Function): void => {\n\t\t\t\tvoid resolve(this.#config);\n\t\t\t});\n\t\t}\n\n\t\treturn this.#requestSharingConfig(groupId);\n\t}\n\n\tstatic async #requestSharingConfig(groupId: number): Promise<GroupSharingConfig>\n\t{\n\t\tconst action = 'calendar.api.sharinggroupajax.enableAndGetSharingConfig';\n\t\tconst response = await BX.ajax.runAction(action, { data: { groupId } });\n\n\t\treturn response.data;\n\t}\n}\n"],"names":["RangeModel","EventEmitter","constructor","params","setEventNamespace","id","range","rule","calendarSettings","isNew","from","to","new","deletable","setWeekDays","weekdays","toArray","getFrom","getWeekDays","getRule","getId","getFromFormatted","formatMinutes","setFrom","value","parseInt","updated","getToFormatted","getTo","setTo","updateSlotSize","maxFrom","addWeekday","weekday","includes","removeWeekday","filter","w","sortWeekdays","getWeekdaysTitle","forceLong","sort","join","Loc","getMessage","formatWeekdays","weekdaysLoc","Util","getWeekdaysLoc","length","map","reduce","a","b","weekStart","getAvailableTimeFrom","timeStamps","hour","push","name","formatTime","getAvailableTimeTo","isDeletable","setDeletable","setNew","getWeekStart","minutes","date","Date","parseDate","getTime","emit","getSlotSize","RuleModel","AVAILABLE_INTERVALS","MAX_RANGES","DEFAULT_SLOT_SIZE","ranges","addRange","setSlotSize","slotSize","sortRanges","getSortedRanges","getDefaultRule","workTimeStart","workTimeEnd","workDays","getAvailableIntervals","getFormattedSlotSize","formatDuration","getRanges","compareRanges","firstRange","secondRange","firstWeekdaysWeight","getWeekdaysWeight","secondWeekdaysWeight","accumulator","index","canAddRange","internalRangeId","removeRange","rangeToRemove","canRemoveRange","rangeDeleted","slice","SettingsModel","getMinutesFromTime","time","dateString","toDateString","replace","shortTimeFormat","DateTimeFormat","getFormat","parsedTime","parseTime","format","h","m","getWorkingDays","weekHolidays","weekHolidaysInt","Set","day","getIndByWeekDay","has","isDefaultRule","isDifferentFrom","anotherRule","getChanges","currentRule","sizeChanged","daysChanged","JSON","stringify","changes","Analytics","ruleChanges","custom_days","custom_length","getUserInfo","userInfo","getContext","context","getLinkHash","linkHash","getSharingUrl","sharingUrl","isCollapsed","collapsed","sortJointLinksByFrequentUse","getCalendarContext","calendarContext","changeSortJointLinksByFrequentUse","setMemberIds","memberIds","getMemberIds","saveJointLink","action","sharingObjectType","response","BX","ajax","runAction","data","groupId","sharingObjectId","save","sendRuleUpdated","newRule","Promise","resolve","reject","ruleArray","then","error","console","increaseFrequentUse","hash","updateCollapsed","sortByFrequentUse","Weekday","options","wrap","active","onSelected","Type","isFunction","onDiscarded","onMouseDown","canBeDiscarded","render","className","Tag","e","handleMouseDown","event","discard","select","Dom","addClass","removeClass","Range","showReadOnlyPopup","onRangeUpdated","bind","hasShownPopups","weekdaysPopupShown","weekdaysMenu","isShown","startPopupShown","hasClass","fromTimeSelect","endPopupShown","toTimeSelect","destroy","remove","renderButton","button","replaceWith","updateWeekdaysTitle","weekdaysSelect","title","innerText","weekdaysSelectWidth","offsetWidth","weekdaysTextWidth","firstChild","weekdaysWidthIsOverflowing","formatAmPmSpan","toLowerCase","model","subscribe","unsubscribe","setTimeout","readOnly","loc","splice","observer","IntersectionObserver","observe","Event","weekdayLoc","weekdaysPopupId","PopupManager","getPopupById","canBeClosed","setBindElement","textNode","spanNode","cloneNode","textWidth","Popup","content","autoHide","closeByEsc","angle","position","offset","autoHideHandler","events","onPopupShow","onPopupClose","currentWeekday","startX","clientX","controllableWeekdays","collectIntersectedWeekdays","right","getBoundingClientRect","left","intersected","onMouseMove","forEach","controllableWeekday","document","unbind","getTimeStamps","isSelected","onItemSelected","callbacks","dataId","timeSelect","timeMenu","items","timeStamp","html","onclick","innerHTML","close","MenuManager","create","now","bindElement","onShow","onClose","maxHeight","minWidth","show","timezonesPopup","getPopupWindow","popupContent","getContentContainer","selectedTimezoneItem","querySelector","scrollTop","offsetTop","offsetHeight","Settings","rangesWithPopup","rangePopupShown","slotSizePopupShown","slotSizeSelect","readOnlyPopupShown","readOnlyPopup","readOnlyClass","expandedClass","contextClass","subtitle","expandRuleArrow","expandRuleButton","toggleClass","style","rangesContainer","slotSizeText","slotSizeMenu","text","topMarginHeight","bottomMarginHeight","marginsHeight","slotSizeHeight","rangeHeight","pivotNode","readonlyHint","width","offsetLeft","darkMode","popupContainer","clearTimeout","closePopupTimeout","HintInfo","props","bindOptions","borderRadius","getContent","animation","wrapper","UserSelector","onMembersAdded","openEntitySelector","renderUserSelectorWrapper","userSelectorWrapper","renderUserSelector","userSelector","entityNode","getDefaultEntityNode","renderUserEntity","key","getEntityKey","getSelectedUserIdList","entity","isCollabUser","hasAvatar","avatar","Text","encode","preselectedItem","Dialog","targetNode","preselectedItems","enableSearch","zIndex","onUserSelectorSelect","onUserSelectorDeselect","hasChanges","entities","intranetUsersOnly","emailUsers","inviteEmployeeLink","inviteGuestLink","analyticsSource","filters","isUserSelectorDialogOpened","isOpen","item","customData","get","trim","String","entityType","append","clearSelectedUsers","clean","getPeopleCount","Object","keys","result","values","infoNotify","hintInfo","timer","member","AvatarRoundGuest","size","userName","userpicPath","baseColor","getContainer","MAX_AVATAR_COUNT","ListItem","openAvatarList","onCopyButtonClick","onDeleteButtonClick","renderAvatarContainer","renderDate","renderCopyButton","renderDeleteButton","avatarContainer","showMoreIcon","members","moreCounter","renderAvatar","renderMore","user","lastName","counter","uid","util","getRandomString","getAvatarPopupItems","maxWidth","setPopupState","menuContainer","getMenuContainer","timeout","closeAvatarList","getAvatarPopupItem","userPath","pathToUser","dateCreate","formattedDate","formatDate","copyButton","icon","Icon","Main","LINK_3","shortUrl","deleteButton","Actions","CROSS_30","MessageBox","message","buttons","getDeletePopupButtons","popupOptions","draggable","closeIcon","minHeight","Button","ButtonSize","MEDIUM","color","ButtonColor","DANGER","click","deleteLink","LIGHT_BORDER","state","setListItemPopupState","DEFAULT_LIST_HEIGHT","LIST_PADDING_SUM","List","getLinkListInfo","eventSubscribe","onJointLinkCopy","onJointLinkDelete","userLinks","updateLinkList","isListEmpty","hideSortingButton","showSortingButton","getTitleNode","getListNode","getChevronBackIcon","getSortingButton","backButton","CHEVRON_LEFT","sortingButton","SORT","getSortingButtonText","changeListSort","sortingButtonText","list","getListItemsNode","getEmptyStateNode","linkListItems","getListItems","listItem","emptyState","getSortedByFrequentUseListItems","getSortedByDateListItems","frequentUse","maxListHeight","onLinkListClose","listItems","adjust","isOpenListItemPopup","isNil","isArray","isArrayFilled","isObject","Layout","HELP_DESK_CODE_CALENDAR","HELP_DESK_CODE_CRM","CONTEXT","CRM","CALENDAR","isGroupContext","settingsModel","reset","isSettingsPopupShown","isListItemPopupOpened","buttonCopy","link","copyLink","url","showNotification","window","sendLinkCopiedList","peopleCount","main","open","focus","mainTop","externalIcon","howDoesItWork","infoNotifyHint","top","Helper","sendMembersAdded","mainBottom","sendLinkCopied","linkTypes","multiple","solo","buttonHistory","textToCopy","isString","navigator","clipboard","writeText","catch","copy","DialogNew","sharingRule","settingsCollapsed","bindEvents","onSuccessfulCopyingLink","checkAndClosePopupOnSlider","getPopup","targetContainer","body","padding","getPopupWrapper","sendPopupOpened","isClickInside","contains","target","layoutHasShownPopups","topSlider","getTopSlider","calendarOpenInTopSlider","getCalendarSliderParams","closePopup","adjustPosition","forceBindPosition","SidePanel","Instance","slider","iframeSrc","match","getData","sliderParams","currentGroupId","Boolean","externalSharing","SharingButton","PAY_ATTENTION_TO_NEW_FEATURE_DELAY","PAY_ATTENTION_TO_NEW_FEATURE_FIRST","PAY_ATTENTION_TO_NEW_FEATURE_NEW","PAY_ATTENTION_TO_NEW_FEATURE_REMIND","PAY_ATTENTION_TO_NEW_FEATURE_JOINT","PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS","PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS","sharingConfig","getSharingConfig","payAttentionToNewFeatureMode","payAttentionToNewFeature","sharingFeatureLimit","sharingSettingsCollapsed","round","EXTRA_SMALL","ButtonIcon","LOCK","switcher","getNode","handleSharingButtonClick","renderTo","renderSwitcher","payAttentionToNewFeatureWithText","FeaturePromotersRegistry","getPromoter","featureId","isSharingEnabled","openDialog","toggle","getSwitcherContainer","getSwitcherDivider","switcherWrap","handleSwitcherWrapClick","capture","UI","Switcher","node","checked","handlers","toggled","handleSwitcherToggled","isChecked","showWarningPopup","stopPropagation","isToggledAfterErrorOccurred","enableSharing","disableSharing","pulsar","counterNode","newDialog","config","week_holidays","week_start","work_time_start","work_time_end","warningPopup","getWarningPopupButtons","getSubmitButton","getCancelButton","handleSubmitButtonClick","handleCancelButtonClick","mode","payAttentionToNewFeatureWithoutText","getPulsar","container","Counter","Color","Size","guide","getGuide","showNextStep","setAngle","Guide","simpleMode","onEvents","steps","condition","bottom","guidePopup","setWidth","getComputedStyle","hideOnHover","SpotLight","targetElement","targetVertex","lightMode","onTargetEnter","GroupSharingButton","Interface","buttonWrap","showSharingButton","sharingButton","showGroupSharingButton","DialogQr","QRCODE_SIZE","QRCODE_COLOR_LIGHT","QRCODE_COLOR_DARK","qr","overlay","getLoader","Loader","getNodeQr","showQr","initQrCode","QRCode","height","colorDark","colorLight","correctLevel","CorrectLevel","H","hide","Runtime","loadExtension","getPhraseDependsOnContext","code","toUpperCase","GroupSharing","GroupSharingController","getGroupSharing","userCalendarSettings"],"mappings":"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"}