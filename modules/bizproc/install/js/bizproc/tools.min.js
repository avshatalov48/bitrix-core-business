BX.namespace("BX.Bizproc");if(typeof BX.Bizproc.doInlineTask==="undefined"){BX.Bizproc.doInlineTask=function(e,t,o,a){if(o){if(o.__waiting)return false;o.__waiting=true;if(BX.hasClass(o,"bp-button")){BX.addClass(o,"bp-button-wait")}else if(BX.hasClass(o,"ui-btn")){BX.addClass(o,"ui-btn-wait")}}if(!e||!e["TASK_ID"])return false;e["sessid"]=BX.bitrix_sessid();BX.ajax({method:"POST",dataType:"json",url:"/bitrix/tools/bizproc_do_task_ajax.php",data:e,onsuccess:function(e){if(e.ERROR){window.alert(e.ERROR);if(a){a(e.ERROR)}}if(o){o.__waiting=false;BX.removeClass(o,["bp-button-wait","ui-btn-wait"])}if(e.SUCCESS&&t){t(arguments)}}});return false};BX.Bizproc.taskPopupInstance=null;BX.Bizproc.taskPopupCallback=null;BX.Bizproc.showTaskPopup=function(e,t,o,a,i){if(a){if(a.__waiting)return false;a.__waiting=true;if(BX.hasClass(a,"bp-button")){BX.addClass(a,"bp-button-wait")}else if(BX.hasClass(a,"ui-btn")){BX.addClass(a,"ui-btn-wait")}}BX.Bizproc.taskPopupInstance=null;BX.Bizproc.taskPopupCallback=null;BX.ajax({method:"GET",dataType:"html",url:"/bitrix/components/bitrix/bizproc.task/popup.php?site_id="+BX.message("SITE_ID")+"&TASK_ID="+e+(o?"&USER_ID="+o:"")+(i?"&IFRAME=Y":""),onsuccess:function(o){if(a){a.__waiting=false;BX.removeClass(a,["bp-button-wait","ui-btn-wait"])}var i=BX.create("div",{style:{width:"100%"}});i.innerHTML=o;var n="",s=BX.findChild(i,{className:"bp-popup-title"},true);if(s){n=s.textContent;BX.remove(s)}BX.Bizproc.taskPopupInstance=new BX.PopupWindow("bp-task-popup-"+e+Math.round(Math.random()*1e5),null,{content:i,closeIcon:true,titleBar:n,contentColor:"white",contentNoPaddings:true,zIndex:-100,offsetLeft:0,offsetTop:0,width:980,closeByEsc:true,draggable:{restrict:false},overlay:{backgroundColor:"black",opacity:30},events:{onPopupClose:function(e){e.destroy();if(BX.Bizproc.delegationPopup)BX.Bizproc.delegationPopup.destroy();BX.Bizproc.delegationPopup=null}}});BX.Bizproc.taskPopupCallback=t;BX.load(["/bitrix/components/bitrix/bizproc.task/templates/.default/style.css"],(function(){BX.Bizproc.taskPopupInstance.show()}))}});return false};BX.Bizproc.delegationPopup=null;BX.Bizproc.delegationSelected=null;BX.Bizproc.showDelegationPopup=function(e,t,o){if(BX.Bizproc.delegationPopup){BX.Bizproc.delegationPopup.show();return false}if(BX.Reflection.getClass("BX.UI.EntitySelector.Dialog")){BX.Bizproc.delegationSelected=null;BX.Bizproc.delegationPopup=new BX.UI.EntitySelector.Dialog({targetNode:e,id:"bp-task-delegation-"+Math.round(Math.random()*1e5),context:"bp-task-delegation",entities:[{id:"user",options:{intranetUsersOnly:true,emailUsers:false,inviteEmployeeLink:false,inviteGuestLink:false}},{id:"department",options:{selectMode:"usersOnly"}}],popupOptions:{bindOptions:{forceBindPosition:true}},enableSearch:true,events:{"Item:onSelect":e=>{const a=e.getData().item;const i=e.getTarget();BX.Bizproc.delegationOnSelect(a);BX.Bizproc.delegateTask(t,o,BX.Bizproc.delegationSelected);i.deselectAll()}},hideOnSelect:true,offsetTop:3,clearUnavailableItems:true,multiple:false});BX.Bizproc.delegationPopup.show();return false}BX.ajax({method:"GET",dataType:"html",url:"/bitrix/components/bitrix/bizproc.task/delegate.php?SITE_ID="+BX.message("SITE_ID")+"&sessid="+BX.bitrix_sessid(),onsuccess:function(a){BX.Bizproc.delegationSelected=null;BX.Bizproc.delegationPopup=new BX.PopupWindow("bp-task-delegation-"+Math.round(Math.random()*1e5),e,{content:a,lightShadow:true,offsetTop:3,zIndex:0,autoHide:true,closeByEsc:true,bindOptions:{forceBindPosition:true},angle:{position:"top",offset:20},buttons:[new BX.PopupWindowButton({text:BX.message("BPAT_DELEGATE_SELECT"),className:"popup-window-button-accept",events:{click:function(e){BX.Bizproc.delegateTask(t,o,BX.Bizproc.delegationSelected);BX.Bizproc.delegationPopup.close()}}}),new BX.PopupWindowButtonLink({text:BX.message("BPAT_DELEGATE_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(e){if(!e)e=window.event;BX.Bizproc.delegationPopup.close();if(e)BX.PreventDefault(e)}}})]});BX.Bizproc.delegationPopup.show()}});return false};BX.Bizproc.delegationOnSelect=function(e){BX.Bizproc.delegationSelected=e.id};BX.Bizproc.delegateTask=function(e,t,o){const a={taskIds:!BX.Type.isArray(e)?[e]:e,fromUserId:t,toUserId:o};BX.ajax.runAction("bizproc.task.delegate",{data:a}).then((e=>{const t=()=>{if(BX.Bizproc.taskPopupInstance){BX.Bizproc.taskPopupInstance.close()}if(BX.Bizproc.taskPopupCallback){BX.Bizproc.taskPopupCallback()}else{window.location.reload()}return true};if(BX.Reflection.getClass("BX.UI.Dialogs.MessageBox")){BX.UI.Dialogs.MessageBox.alert(BX.Text.encode(e.data.message),t);return}window.alert(e.data.message);t()}),(e=>{if(BX.Reflection.getClass("BX.UI.Dialogs.MessageBox")){BX.UI.Dialogs.MessageBox.alert(BX.Text.encode(e.errors[0].message));return}window.alert(e.errors[0].message)}))};BX.Bizproc.showWorkflowInfoPopup=function(e){BX.ajax({method:"GET",dataType:"html",url:"/bitrix/components/bitrix/bizproc.workflow.info/popup.php?site_id="+BX.message("SITE_ID")+"&WORKFLOW_ID="+e,onsuccess:function(t){BX.load(["/bitrix/components/bitrix/bizproc.workflow.info/templates/.default/style.css"],(function(){var o=BX.create("div",{style:{width:"800px"}});o.innerHTML=t;var a="",i=BX.findChild(o,{className:"bp-popup-title"},true);if(i){a=i.textContent;BX.remove(i)}var n=new BX.PopupWindow("bp-wfi-popup-"+e+Math.round(Math.random()*1e5),null,{content:o,closeIcon:true,titleBar:a,contentColor:"white",contentNoPaddings:true,zIndex:-100,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:{backgroundColor:"black",opacity:30},events:{onPopupClose:function(e){e.destroy()}}});n.show()}))}});return false};BX.Bizproc.showWorkflowLogPopup=function(e,t){if(!BX.type.isPlainObject(t)){t={}}BX.ajax({method:"GET",dataType:"html",url:"/bitrix/components/bitrix/bizproc.log/popup.php?site_id="+BX.message("SITE_ID")+"&WORKFLOW_ID="+e,onsuccess:function(o){var a=BX.create("div",{style:{width:"800px"}});a.innerHTML=o;var i=new BX.PopupWindow("bp-wfi-popup-"+e+Math.round(Math.random()*1e5),null,{content:a,closeIcon:true,titleBar:t.title||"",contentColor:"white",contentNoPaddings:true,zIndex:-100,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:{backgroundColor:"black",opacity:30},events:{onPopupClose:function(e){e.destroy()}}});i.show()}});return false};BX.Bizproc.postTaskForm=function(e,t){if(e.BPRUNNING){return}BX.PreventDefault(t);e.action="/bitrix/tools/bizproc_do_task_ajax.php";e.BPRUNNING=true;var o,a,i=document.activeElement;if((!i||!i.type)&&t.explicitOriginalTarget){i=t.explicitOriginalTarget}if(!!i&&i.type&&i.type.toLowerCase()=="submit"&&!!i.name&&!!i.value){o=i.name;a=i.value}if(!e.target){if(null==e.BXFormTarget){var n="formTarget_"+Math.random();e.BXFormTarget=document.body.appendChild(BX.create("IFRAME",{props:{name:n,id:n,src:"javascript:void(0)"},style:{display:"none"}}))}e.target=e.BXFormTarget.name}var s=null;if(o){s=BX.findChild(e,{property:{type:"submit",name:o}},true)}if(s){if(BX.hasClass(s,"bp-button")){BX.addClass(s,"bp-button-wait")}else if(BX.hasClass(s,"ui-btn")){BX.addClass(s,"ui-btn-wait")}}e.BXFormCallback=function(t){e.BPRUNNING=false;if(s){BX.removeClass(s,["bp-button-wait","ui-btn-wait"])}t=BX.parseJSON(t);if(t&&t.ERROR)window.alert(t.ERROR);else{if(!!BX.Bizproc.taskPopupInstance)BX.Bizproc.taskPopupInstance.close();if(!!BX.Bizproc.taskPopupCallback)BX.Bizproc.taskPopupCallback()}};BX.bind(e.BXFormTarget,"load",BX.proxy(BX.ajax._submit_callback,e));BX.submit(e,o,a)}}if(typeof BX.Bizproc.WorkflowFaces==="undefined"){BX.Bizproc.WorkflowFaces={};BX.Bizproc.WorkflowFaces.showFaces=function(e,t,o,a){if(typeof t.__popup==="undefined"){t.__popup=new BX.PopupWindow("bp-wf-faces-"+Math.round(Math.random()*1e5),t,{lightShadow:true,offsetLeft:-51,offsetTop:3,zIndex:0,autoHide:true,closeByEsc:true,bindOptions:{position:"bottom"},angle:{position:"top",offset:78},content:BX.Bizproc.WorkflowFaces.createMenu(e,o,a)})}if(t.__popup.isShown())t.__popup.close();else t.__popup.show();return false};BX.Bizproc.WorkflowFaces.createMenu=function(e,t,o){var a,i,n=e.length,s;var p=[];const l=e=>BX.Text.encode(encodeURI(e));for(a=0;a<n;++a){var r,c=e[a],u=[];for(i=0,s=c.USERS.length;i<s;++i){r="bp-popup-parallel-avatar-ready";if(c.USERS[i].STATUS=="0")r="";else if(c.USERS[i].STATUS=="2"||c.USERS[i].STATUS=="4")r="bp-popup-parallel-avatar-cancel";var B=["<a>",'<span class="bp-popup-parallel-avatar '+r+'"><span class="ui-icon ui-icon-common-user">'+(c.USERS[i].PHOTO_SRC?"<i style=\"background-image: url('"+l(c.USERS[i].PHOTO_SRC)+'\')" alt=""></i>':"<i></i>")+"</span></span>",'<span class="bp-popup-parallel-name" title="'+c.USERS[i].FULL_NAME+'">'+c.USERS[i].FULL_NAME+"</span>","</a>"];u.push(B.join(""))}var d=u.join("");if(n==1&&!o)p.push(d);else{r="bp-popup-parallel-avatar-ready";if(c.USERS[0].STATUS=="0")r="";else if(c.USERS[0].STATUS=="2"||c.USERS[0].STATUS=="4")r="bp-popup-parallel-avatar-cancel";var f=['<a class="'+(u.length>1||t?"bp-popup-parallel-parent":"")+'">',!t?'<span class="bp-popup-parallel-avatar '+r+'"><span class="ui-icon ui-icon-common-user">'+(c.USERS[0].PHOTO_SRC?"<i style=\"background-image:url('"+l(c.USERS[0].PHOTO_SRC)+'\')" alt=""></i>':"<i></i>")+"</span></span>":"",'<span class="bp-popup-parallel-name" title="'+c.NAME+'">'+(!t?c.USERS[0].FULL_NAME:c.NAME)+"</span>","</a>"];p.push('<div class="bp-popup-parallel-sub">'+f.join("")+(u.length>1||t?'<div class="bp-popup-parallel">'+d+"</div></div>":""))}}return'<div class="bp-popup-parallel">'+p.join("")+"</div>"}}
//# sourceMappingURL=tools.map.js