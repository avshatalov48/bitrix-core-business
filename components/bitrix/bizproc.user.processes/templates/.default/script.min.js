this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,s,t,l,a,r,o,i,n,d,c,b){"use strict";var u=babelHelpers.classPrivateFieldLooseKey("runComponentAction");class p{constructor(){Object.defineProperty(this,u,{value:v})}loadWorkflows(e){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]("loadWorkflows",{ids:e})}}function v(e,s={}){return new Promise(((t,l)=>{c.ajax.runComponentAction("bitrix:bizproc.user.processes",e,{mode:"class",data:s}).catch((e=>{l(e)})).then((e=>{t(e)}))}))}let h=e=>e,P,f,m,B,w;var L=babelHelpers.classPrivateFieldLooseKey("currentUserId");var g=babelHelpers.classPrivateFieldLooseKey("targetUserId");var T=babelHelpers.classPrivateFieldLooseKey("data");var k=babelHelpers.classPrivateFieldLooseKey("task");var F=babelHelpers.classPrivateFieldLooseKey("inlineTaskView");var E=babelHelpers.classPrivateFieldLooseKey("faces");var H=babelHelpers.classPrivateFieldLooseKey("getWorkflowInfoUrl");class I{constructor(e){Object.defineProperty(this,H,{value:S});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e.workflow;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=c.Type.isNumber(e.currentUserId)?e.currentUserId:0;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=babelHelpers.classPrivateFieldLooseBase(this,T)[T].userId;if(babelHelpers.classPrivateFieldLooseBase(this,T)[T].task){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=new r.Task(babelHelpers.classPrivateFieldLooseBase(this,T)[T].task);if(c.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,k)[k].controls.buttons)){babelHelpers.classPrivateFieldLooseBase(this,k)[k].setButtons(babelHelpers.classPrivateFieldLooseBase(this,k)[k].buttons.map((s=>({onclick:()=>e.userProcesses.doTask({taskId:babelHelpers.classPrivateFieldLooseBase(this,k)[k].id,workflowId:babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowId,taskName:babelHelpers.classPrivateFieldLooseBase(this,k)[k].name,taskRequest:{[s.NAME]:s.VALUE}}),...s}))))}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=new r.InlineTaskView({task:babelHelpers.classPrivateFieldLooseBase(this,k)[k],responsibleUser:babelHelpers.classPrivateFieldLooseBase(this,g)[g]})}}renderProcess(){var e,s,t,l;const a=c.Type.isString((e=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:e.name)?babelHelpers.classPrivateFieldLooseBase(this,T)[T].name:"";const r=c.Type.isString((s=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:s.typeName)?babelHelpers.classPrivateFieldLooseBase(this,T)[T].typeName:"";const o=((t=babelHelpers.classPrivateFieldLooseBase(this,T)[T].task)==null?void 0:t.url)||babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowUrl||babelHelpers.classPrivateFieldLooseBase(this,H)[H]();const i=c.Type.isString((l=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:l.description)?babelHelpers.classPrivateFieldLooseBase(this,T)[T].description:"";const n=80;const d=c.Dom.create("span",{html:i==null?void 0:i.replace(/(<br \/>)+/gm," ")}).textContent.replace(/\n+/," ").slice(0,n);const b=(i==null?void 0:i.length)>n;return c.Tag.render(P||(P=h`
				<div class="bp-user-processes">
					<a class="bp-user-processes__title-link ui-typography-text-lg"
						href="${0}">${0}
					</a>
					<div class="bp-user-processes__appointment">${0}</div>
					<div class="bp-user-processes__description-box ${0}">
						<span class="bp-user-processes__short_description">
							${0}
							...<a href="#" onclick="this.closest('div').classList.add('--expanded'); return false;" class="bp-user-processes__description-link">${0}</a>
						</span>
						<span class="bp-user-processes__description">
							${0}
						</span>
					</div>
			</div>
		`),c.Text.encode(o),c.Text.encode(a),c.Text.encode(r.toUpperCase()),b?"":"--expanded",c.Text.encode(d),c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_DESCRIPTION_MORE"),i)}renderTaskName(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,F)[F])==null?void 0:e.render()}renderTask(){if(!babelHelpers.classPrivateFieldLooseBase(this,T)[T].task||babelHelpers.classPrivateFieldLooseBase(this,T)[T].userId!==babelHelpers.classPrivateFieldLooseBase(this,L)[L]){const t=babelHelpers.classPrivateFieldLooseBase(this,T)[T].isCompleted?"--success":"";let l="";let r="";if(babelHelpers.classPrivateFieldLooseBase(this,T)[T].isCompleted&&babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowResult!==null){if(babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowResult.status===a.WorkflowResultStatus.BB_CODE_RESULT){var e;l=`${c.Loc.getMessage("BIZPROC_RENDERED_RESULT_VALUE")}<br>${(e=babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowResult.text)!=null?e:""}`}if(babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowResult.status===a.WorkflowResultStatus.USER_RESULT){var s;l=c.Loc.getMessage("BIZPROC_RENDERED_RESULT_POSITIVE_RESULT_FOR",{"#USER#":(s=babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowResult.text)!=null?s:""})}if(babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowResult.status===a.WorkflowResultStatus.NO_RIGHTS_RESULT){r="no-rights";l=`${c.Loc.getMessage("BIZPROC_RENDERED_RESULT_NO_RIGHTS_VIEW")} <span data-hint="${c.Loc.getMessage("BIZPROC_RENDERED_RESULT_NO_RIGHTS_TOOLTIP")}"></span>`}}const o=c.Tag.render(f||(f=h`
				<div class="bp-status-panel ${0}">
						<div class="bp-status-item">
							<div class="bp-status-name">${0}</div>
							<div class="bp-workflow-result ${0}">${0}</div>
						</div>
				</div>
			`),t,c.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,T)[T].statusText.toUpperCase()),r,l);if(babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowResult!==null&&babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowResult.status===a.WorkflowResultStatus.NO_RIGHTS_RESULT){BX.UI.Hint.init(o)}return o}return this.renderTaskName()}renderDocumentName(){var e,s,t,l;const a=c.Type.isString((e=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(s=e.document)==null?void 0:s.name)?babelHelpers.classPrivateFieldLooseBase(this,T)[T].document.name:"";if(c.Type.isString((t=babelHelpers.classPrivateFieldLooseBase(this,T)[T])==null?void 0:(l=t.document)==null?void 0:l.url)){const e=new c.Uri(babelHelpers.classPrivateFieldLooseBase(this,T)[T].document.url);return c.Tag.render(m||(m=h`
				<a href="${0}">
					${0}
				</a>
			`),c.Text.encode(e.toString()),c.Text.encode(a))}return c.Text.encode(a)}renderWorkflowFaces(){const e=c.Tag.render(B||(B=h`<div></div>`));if(babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowId&&babelHelpers.classPrivateFieldLooseBase(this,T)[T].taskProgress){try{babelHelpers.classPrivateFieldLooseBase(this,E)[E]=new i.WorkflowFaces({workflowId:babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowId,targetUserId:babelHelpers.classPrivateFieldLooseBase(this,g)[g],target:e,data:{steps:babelHelpers.classPrivateFieldLooseBase(this,T)[T].taskProgress.steps,progressBox:babelHelpers.classPrivateFieldLooseBase(this,T)[T].taskProgress.progressBox},showArrow:true});babelHelpers.classPrivateFieldLooseBase(this,E)[E].render()}catch(e){console.error(e)}}return e}renderSummary(){var e;if(!babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowId||!((e=babelHelpers.classPrivateFieldLooseBase(this,T)[T].taskProgress)!=null&&e.timeStep)){return null}return new n.Summary({workflowId:babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowId,data:babelHelpers.classPrivateFieldLooseBase(this,T)[T].taskProgress.timeStep}).render()}renderModified(){var e;let s=null;if(babelHelpers.classPrivateFieldLooseBase(this,T)[T].userId===babelHelpers.classPrivateFieldLooseBase(this,L)[L]&&(babelHelpers.classPrivateFieldLooseBase(this,T)[T].taskCnt>0||babelHelpers.classPrivateFieldLooseBase(this,T)[T].commentCnt>0)){const e=babelHelpers.classPrivateFieldLooseBase(this,T)[T].taskCnt===0&&babelHelpers.classPrivateFieldLooseBase(this,T)[T].commentCnt>0?d.CounterColor.SUCCESS:d.CounterColor.DANGER;s=new d.Counter({value:(babelHelpers.classPrivateFieldLooseBase(this,T)[T].taskCnt||0)+(babelHelpers.classPrivateFieldLooseBase(this,T)[T].commentCnt||0),color:e,secondaryColor:d.CounterColor.SUCCESS,isDouble:babelHelpers.classPrivateFieldLooseBase(this,T)[T].taskCnt>0&&babelHelpers.classPrivateFieldLooseBase(this,T)[T].commentCnt>0})}return c.Tag.render(w||(w=h`
			<div class="bp-modified-cell">
				<span class="bp-row-counters">${0}</span>
				<span>${0}</span>
			</div>
		`),(e=s)==null?void 0:e.getContainer(),c.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,T)[T].modified))}destroy(){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=null;babelHelpers.classPrivateFieldLooseBase(this,k)[k]=null;babelHelpers.classPrivateFieldLooseBase(this,F)[F]=null;if(!c.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,E)[E])){babelHelpers.classPrivateFieldLooseBase(this,E)[E].destroy();babelHelpers.classPrivateFieldLooseBase(this,E)[E]=null}}}function S(){var e;const s=c.Type.isNil((e=babelHelpers.classPrivateFieldLooseBase(this,T)[T].task)==null?void 0:e.id)?babelHelpers.classPrivateFieldLooseBase(this,T)[T].workflowId:babelHelpers.classPrivateFieldLooseBase(this,T)[T].task.id;const t=new c.Uri(`/company/personal/bizproc/${s}/`);return t.toString()}var y=babelHelpers.classPrivateFieldLooseKey("subscribeToPulls");var R=babelHelpers.classPrivateFieldLooseKey("getTaskColor");var _=babelHelpers.classPrivateFieldLooseKey("getCommentColor");var C=babelHelpers.classPrivateFieldLooseKey("setFilterPreset");var O=babelHelpers.classPrivateFieldLooseKey("getFilterManager");class U{constructor(e){Object.defineProperty(this,O,{value:x});Object.defineProperty(this,C,{value:M});Object.defineProperty(this,_,{value:N});Object.defineProperty(this,R,{value:D});Object.defineProperty(this,y,{value:A});this.filterId=e.filterId;this.counters=e.counters}renderTo(e){var s,t,l,a;this.uiPanel=new BX.UI.CounterPanel({target:e,multiselect:false,title:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_LABEL"),items:[{id:"task",value:{value:((s=this.counters)==null?void 0:s.task)||0,order:1},title:{value:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_TASK"),order:2},color:babelHelpers.classPrivateFieldLooseBase(this,R)[R]((t=this.counters)==null?void 0:t.task),separator:false,eventsForActive:{click:babelHelpers.classPrivateFieldLooseBase(this,C)[C].bind(this)},eventsForUnActive:{click:babelHelpers.classPrivateFieldLooseBase(this,C)[C].bind(this,"active_task")}},{id:"comment",value:((l=this.counters)==null?void 0:l.comment)||0,title:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_COMMENT"),color:babelHelpers.classPrivateFieldLooseBase(this,_)[_]((a=this.counters)==null?void 0:a.comment),eventsForActive:{click:babelHelpers.classPrivateFieldLooseBase(this,C)[C].bind(this)},eventsForUnActive:{click:babelHelpers.classPrivateFieldLooseBase(this,C)[C].bind(this,"comment")}}]});this.uiPanel.init();babelHelpers.classPrivateFieldLooseBase(this,y)[y]()}}function A(){BX.PULL.subscribe({moduleId:"main",command:"user_counter",callback:e=>{var s,t;const l=(s=(t=e[BX.message("SITE_ID")])==null?void 0:t.bp_tasks)!=null?s:null;if(l!==null){this.uiPanel.getItemById("task").updateValue(l);this.uiPanel.getItemById("task").updateColor(babelHelpers.classPrivateFieldLooseBase(this,R)[R](l))}}});BX.PULL.subscribe({moduleId:"bizproc",command:"comment",callback:e=>{var s,t;const l=(s=(t=e.counter)==null?void 0:t.allUnread)!=null?s:null;if(l!==null){this.uiPanel.getItemById("comment").updateValue(l);this.uiPanel.getItemById("comment").updateColor(babelHelpers.classPrivateFieldLooseBase(this,_)[_](l))}}})}function D(e){return e>0?"DANGER":"THEME"}function N(e){return e>0?"SUCCESS":"THEME"}function M(e){const s=babelHelpers.classPrivateFieldLooseBase(this,O)[O]();if(!s){return}const t=s.getApi();const l={SYSTEM_PRESET:e!=null?e:"in_work"};t.setFields(l);t.apply()}function x(){if(this.filterId){var e;return(e=BX.Main.filterManager)==null?void 0:e.getById(this.filterId)}console.warn("Filter not found");return null}let W=e=>e,K;var j=babelHelpers.classPrivateFieldLooseKey("workflowTasks");var G=babelHelpers.classPrivateFieldLooseKey("workflowRenderer");var X=babelHelpers.classPrivateFieldLooseKey("subscribeToPushes");var $=babelHelpers.classPrivateFieldLooseKey("updateWorkflows");var z=babelHelpers.classPrivateFieldLooseKey("appendWorkflow");var V=babelHelpers.classPrivateFieldLooseKey("createWorkflowRenderer");var Z=babelHelpers.classPrivateFieldLooseKey("getWorkflowRendererById");var Y=babelHelpers.classPrivateFieldLooseKey("deleteWorkflowRendererById");var q=babelHelpers.classPrivateFieldLooseKey("hideRow");var J=babelHelpers.classPrivateFieldLooseKey("showRow");class Q{constructor(e){Object.defineProperty(this,J,{value:ie});Object.defineProperty(this,q,{value:oe});Object.defineProperty(this,Y,{value:re});Object.defineProperty(this,Z,{value:ae});Object.defineProperty(this,V,{value:le});Object.defineProperty(this,z,{value:te});Object.defineProperty(this,$,{value:se});Object.defineProperty(this,X,{value:ee});this.delegateToUserId=0;Object.defineProperty(this,j,{writable:true,value:new Map});Object.defineProperty(this,G,{writable:true,value:{}});let s=false;if(c.Type.isPlainObject(e)){this.gridId=e.gridId;if(c.Type.isArray(e.errors)){this.showErrors(e.errors)}this.actionPanel={wrapperElementId:e.actionPanelUserWrapperId,actionButtonName:`${this.gridId}_action_button`};this.currentUserId=e.currentUserId;s=e.mustSubscribeToPushes===true}this.loader=new p;if(s){babelHelpers.classPrivateFieldLooseBase(this,X)[X]()}this.init();this.initCounterPanel(e.counters,e.filterId)}getDefaultAddRowOptions(e,s){const t=[{text:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_ROW_ACTION_DOCUMENT"),href:e.document.url||"#"}];if(e.task){t.push({text:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_ROW_ACTION_TASK"),href:e.task.url})}return{id:e.workflowId,animation:false,columns:{ID:e.workflowId,PROCESS:s.renderProcess(),TASK_PROGRESS:s.renderWorkflowFaces(),TASK:s.renderTask(),WORKFLOW_STATE:c.Text.encode(e.statusText),DOCUMENT_NAME:s.renderDocumentName(),WORKFLOW_TEMPLATE_NAME:c.Text.encode(e.templateName),TASK_DESCRIPTION:c.Dom.create("span",{html:e.description||""}),MODIFIED:s.renderModified(),WORKFLOW_STARTED:c.Text.encode(e.workflowStarted),WORKFLOW_STARTED_BY:c.Text.encode(e.startedBy),OVERDUE_DATE:c.Text.encode(e.overdueDate),SUMMARY:s.renderSummary()},actions:t,columnClasses:{TASK_PROGRESS:"bp-task-progress-cell",SUMMARY:"bp-summary-cell",TASK:e.isCompleted?"bp-status-completed-cell":""},editable:Boolean(e.task)}}init(){this.actionPanel.userWrapperElement=document.getElementById(this.actionPanel.wrapperElementId);this.initUserSelector();this.renderCells();this.onActionPanelChanged()}initCounterPanel(e,s){const t=document.querySelector('[data-role="bizproc-counterpanel"]');if(!t){return}new U({counters:e,filterId:s}).renderTo(t)}renderCells(){const e=new Map;document.querySelectorAll('[data-role="bp-render-cell"]').forEach((s=>{const t=c.Dom.attr(s,"data-workflow");const l=c.Dom.attr(s,"data-column");if(t){if(!e.has(t.workflowId)){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](t.workflowId);e.set(t.workflowId)}if(t.task){babelHelpers.classPrivateFieldLooseBase(this,j)[j].set(t.workflowId,t.task.id)}this.renderColumnCell(s,l,t)}}))}renderColumnCell(e,s,t){var l;const a=(l=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](String(t.workflowId)))!=null?l:babelHelpers.classPrivateFieldLooseBase(this,V)[V](String(t.workflowId),t);let r=null;switch(s){case"DOCUMENT_NAME":r=a.renderDocumentName();break;case"PROCESS":r=a.renderProcess();break;case"TASK_PROGRESS":r=a.renderWorkflowFaces();break;case"TASK":r=a.renderTask();break;case"SUMMARY":r=a.renderSummary();break;case"MODIFIED":r=a.renderModified();break;default:}if(r){c.Dom.replace(e,r)}}async initStartWorkflowButton(e){const s=c.Type.isStringFilled(e)&&document.getElementById(e);const t=c.Type.isStringFilled(s==null?void 0:s.dataset.lists)&&JSON.parse(s.dataset.lists);let a=null;if(t){const e=new l.Menu({angle:true,offsetLeft:c.Dom.getPosition(s).width/2,autoHide:true,bindElement:s,closeByEsc:true,items:Object.values(t).map((s=>{const t={text:s.name,className:"feed-add-post-form-link-lists",dataset:{iconUrl:s.icon}};if(c.Type.isNil(s.url)){const l={iBlockTypeId:s.iBlockTypeId,iBlockId:s.iBlockId,analyticsP1:s.name};if(s.selected===true){a=l}t.onclick=()=>{e.close();c.Runtime.loadExtension("lists.element.creation-guide").then((({CreationGuide:e})=>{e==null?void 0:e.open(l)})).catch((()=>{}))}}else{t.href=s.url}return t}))});const r=e.getMenuContainer();for(const e of r.querySelectorAll(".menu-popup-item-icon")){c.Dom.append(c.Tag.render(K||(K=W`
						<img src = "${0}" alt="" width = "19" height = "16"/>
					`),e.parentElement.dataset.iconUrl),e)}s.onclick=s=>{s.preventDefault();if(!e.getPopupWindow().isShown()){c.Runtime.loadExtension("ui.analytics").then((({sendData:e})=>{e({tool:"automation",category:"bizproc_operations",event:"drawer_open",c_section:"bizproc",c_element:"button"})})).catch((()=>{}))}e.toggle()}}if(a){c.Runtime.loadExtension("lists.element.creation-guide").then((({CreationGuide:e})=>{e==null?void 0:e.open(a)})).catch((()=>{}))}}initUserSelector(){if(!this.delegateToSelector){this.delegateToSelector=new t.TagSelector({multiple:false,tagMaxWidth:180,events:{onTagAdd:e=>{this.delegateToUserId=parseInt(e.getData().tag.getId(),10);if(!c.Type.isInteger(this.delegateToUserId)){this.delegateToUserId=0}},onTagRemove:()=>{this.delegateToUserId=0}},dialogOptions:{entities:[{id:"user",options:{intranetUsersOnly:true,inviteEmployeeLink:false}}]}})}if(c.Type.isDomNode(this.actionPanel.userWrapperElement)){c.Dom.clean(this.actionPanel.userWrapperElement);this.delegateToSelector.renderTo(this.actionPanel.userWrapperElement)}}showErrors(e){if(!c.Type.isArrayFilled(e)){if(!c.Type.isArray(e)){console.error(e)}return}const t=document.getElementById("bp-user-processes-errors-container");if(t){let l=0;const a=()=>{if(l>0){c.Dom.style(t,{margin:"10px"})}else{c.Dom.style(t,{margin:"0px"})}};for(const r of e){l+=1;const e=new s.Alert({text:c.Text.encode(r.message),color:s.AlertColor.DANGER,closeBtn:true,animated:true});e.renderTo(t);if(e.getCloseBtn()){e.getCloseBtn().onclick=()=>{l-=1;a()}}}a()}}onActionPanelChanged(){const e=this.getGrid();const s=e==null?void 0:e.getActionsPanel();if(s){const e=s.getValues()[this.actionPanel.actionButtonName];if(!c.Type.isString(e)||e.includes("set_status")){c.Dom.hide(this.actionPanel.userWrapperElement)}else{c.Dom.show(this.actionPanel.userWrapperElement)}}}applyActionPanelValues(){const e=this.getGrid();const s=e==null?void 0:e.getActionsPanel();if(e&&s){var t;const l=((t=s.getForAllCheckbox())==null?void 0:t.checked)===true;if(l){this.showErrors([{message:"Not implemented currently"}])}const a=s.getValues()[this.actionPanel.actionButtonName];if(c.Type.isString(a)){const s=this.getSelectedTaskIds(e.getRows().getSelectedIds());if(s.length===0){return}if(a.includes("set_status_")){const e=parseInt(a.split("_").pop(),10);if(c.Type.isNumber(e)){this.setTasksStatuses(s,e)}}else if(a.startsWith("delegate_to")){this.delegateTasks(s,this.delegateToUserId)}}}}getSelectedTaskIds(e){return e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,j)[j].get(e))).filter((e=>c.Type.isNumber(e)))}setTasksStatuses(e,s){c.ajax.runAction("bizproc.task.doInlineTasks",{data:{taskIds:e,newStatus:s}}).catch((e=>{this.showErrors(e.errors);this.reloadGrid()}))}delegateTasks(e,s){c.ajax.runComponentAction("bitrix:bizproc.user.processes","delegateTasks",{mode:"class",data:{taskIds:e,toUserId:s}}).catch((e=>{this.showErrors(e.errors);this.reloadGrid()}))}reloadGrid(){var e;(e=this.getGrid())==null?void 0:e.reload()}doTask(e){babelHelpers.classPrivateFieldLooseBase(this,q)[q](e.workflowId);c.ajax.runAction("bizproc.task.do",{data:e}).then((()=>{if(e.taskName){b.UI.Notification.Center.notify({content:c.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_TASK_TOUCHED",{"#TASK_NAME#":c.Text.encode(e.taskName)})})}})).catch((s=>{this.showErrors(s.errors);babelHelpers.classPrivateFieldLooseBase(this,J)[J](e.workflowId)}))}removeWorkflow(e){babelHelpers.classPrivateFieldLooseBase(this,q)[q](e,true);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](e);babelHelpers.classPrivateFieldLooseBase(this,j)[j].delete(e)}getGrid(){if(this.gridId){var e;return(e=BX.Main.gridManager)==null?void 0:e.getInstanceById(this.gridId)}console.warn("Grid not found");return null}}function ee(){BX.PULL.subscribe({moduleId:"bizproc",command:"workflow",callback:e=>{if(e.eventName==="DELETED"||e.eventName==="UPDATED"){e.items.forEach((e=>this.removeWorkflow(e.id)))}if(e.eventName==="ADDED"||e.eventName==="UPDATED"){const s=this.getGrid().getRows();let t=e.items.map((e=>e.id));if(e.eventName==="ADDED"){t=t.filter((e=>!s.getById(e)))}if(t.length>0){this.loader.loadWorkflows(t).then(babelHelpers.classPrivateFieldLooseBase(this,$)[$].bind(this)).catch((e=>this.showErrors(e)))}}}})}function se(e){var s;const{workflows:t}=e.data;if(!c.Type.isArray(t)){console.warn("Unexpected response from server. Expected workflow.data to be an array");return}const l=(s=this.getGrid())==null?void 0:s.getRealtime();if(l){let e=null;t.forEach((s=>{const t=Boolean(s.taskCnt>0||s.commentCnt>0||s.startedById===this.currentUserId&&s.isCompleted===false);if(t){babelHelpers.classPrivateFieldLooseBase(this,z)[z]({workflow:s,renderer:babelHelpers.classPrivateFieldLooseBase(this,V)[V](s.workflowId,s),insertAfter:e});e=s.workflowId}}))}}function te({workflow:e,renderer:s,insertAfter:t}){var l,a;if(e.task){babelHelpers.classPrivateFieldLooseBase(this,j)[j].set(e.workflowId,e.task.id)}const r=(l=this.getGrid())==null?void 0:l.getRealtime();if(!r){return}const o=this.getDefaultAddRowOptions(e,s);if(c.Type.isStringFilled(t)){o.insertAfter=t}else{o.prepend=true}r.addRow(o);const i=(a=this.getGrid())==null?void 0:a.getRows().getById(e.workflowId);if(i){if(o.columnClasses){for(const[e,s]of Object.entries(o.columnClasses)){if(s){c.Dom.addClass(i.getCellById(e),s)}}}c.Dom.addClass(i.getNode(),"main-ui-grid-show-new-row");c.Event.bind(i.getNode(),"animationend",(e=>{if(e.animationName==="showNewRow"){c.Dom.removeClass(i.getNode(),"main-ui-grid-show-new-row")}}))}}function le(e,s){babelHelpers.classPrivateFieldLooseBase(this,G)[G][e]=new I({userProcesses:this,currentUserId:this.currentUserId,workflow:s});return babelHelpers.classPrivateFieldLooseBase(this,G)[G][e]}function ae(e){return c.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,G)[G][e])?null:babelHelpers.classPrivateFieldLooseBase(this,G)[G][e]}function re(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](e);if(s){s.destroy();delete babelHelpers.classPrivateFieldLooseBase(this,G)[G][e]}}function oe(e,s=false){const t=this.getGrid();const l=t==null?void 0:t.getRows().getById(e);if(l){l.hide();if(s){c.Dom.remove(l.getNode())}if(t.getRows().getCountDisplayed()===0){t.getRealtime().showStub()}}}function ie(e){var s,t;(s=this.getGrid())==null?void 0:(t=s.getRows().getById(e))==null?void 0:t.show()}e.UserProcesses=Q})(this.BX.Bizproc.Component=this.BX.Bizproc.Component||{},BX.UI,BX.UI.EntitySelector,BX.Main,BX.Bizproc,BX.Bizproc,BX,BX.Bizproc.Workflow,BX.Bizproc.Workflow.Faces,BX.UI,BX,BX);
//# sourceMappingURL=script.map.js