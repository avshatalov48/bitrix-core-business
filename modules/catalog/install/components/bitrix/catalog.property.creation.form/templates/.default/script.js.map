{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {ajax, Dom, Reflection, Tag, Type} from 'main.core';\n\nclass PropertyCreationForm extends BX.Catalog.IblockFieldConfigurator\n{\n\tinitialize(id, settings = {})\n\t{\n\t\tsuper.initialize(id, settings);\n\t\tBX.addCustomEvent(this, \"onSave\", BX.delegate(this.onFormSave, this));\n\t\tBX.addCustomEvent(this, \"onCancel\", BX.delegate(this.onFormCancel, this));\n\t\tthis.componentName = settings.componentName || '';\n\t\tthis.signedParameters = settings.signedParameters || '';\n\t}\n\n\tgetInputTitle()\n\t{\n\t\treturn (!this.isCreationMode()) ? this._field.getTitle() : '';\n\t}\n\n\tisCreationMode()\n\t{\n\t\treturn this._field === null;\n\t}\n\n\tonFormSave(sender, params)\n\t{\n\t\tif (this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isLocked = true;\n\t\tBX.addClass(this._saveButton, \"ui-btn-wait\");\n\t\tconst fields = this.formatConfiguratorFields(params);\n\n\t\tif (this.isCreationMode())\n\t\t{\n\t\t\tthis.addProperty(fields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateProperty(fields);\n\t\t}\n\t}\n\n\taddProperty(fields)\n\t{\n\t\tajax.runComponentAction(\n\t\t\tthis.componentName,\n\t\t\t'addProperty',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tdata: fields\n\t\t\t}\n\t\t)\n\t\t\t.then(response => {\n\t\t\t\tfields.CODE = response.data.PROPERTY_GRID_CODE;\n\t\t\t\tBX.SidePanel.Instance.postMessage(window, 'PropertyCreationForm:onAdd', {fields});\n\t\t\t\tthis.onFormCancel();\n\t\t\t})\n\t\t\t.catch(this.onError.bind(this))\n\t\t;\n\t}\n\n\tupdateProperty(fields)\n\t{\n\t\tajax.runComponentAction(\n\t\t\tthis.componentName,\n\t\t\t'updateProperty',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tdata: fields\n\t\t\t}\n\t\t)\n\t\t\t.then(response => {\n\t\t\t\tBX.SidePanel.Instance.postMessage(window, 'PropertyCreationForm:onModify', {fields});\n\t\t\t\tthis.onFormCancel();\n\t\t\t})\n\t\t\t.catch(this.onError.bind(this))\n\t\t;\n\t}\n\n\tonError(response)\n\t{\n\t\tDom.removeClass(this._saveButton, \"ui-btn-wait\");\n\t\tthis._isLocked = false;\n\n\t\tif (this._errorContainer)\n\t\t{\n\t\t\tDom.clean(this._errorContainer);\n\n\t\t\tif (Type.isArray(response.errors))\n\t\t\t{\n\t\t\t\tresponse.errors.forEach((error) => {\n\t\t\t\t\tthis.showError(error);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tgetFormFieldName(name)\n\t{\n\t\treturn 'fields['+name+']';\n\t}\n\n\tshowError(error)\n\t{\n\t\tthis._errorContainer.append(\n\t\t\tTag.render`\n\t\t\t\t<p class=\"ui-entity-editor-field-error-text\">${error.message}</p>\n\t\t\t`\n\t\t);\n\t}\n\n\tformatConfiguratorFields(fields)\n\t{\n\t\tconst form = new FormData();\n\t\tconst formatted = {\n\t\t\tNAME: fields.label,\n\t\t\tMULTIPLE: fields.multiple ? 'Y' : 'N',\n\t\t\tIS_REQUIRED: fields.mandatory ? 'Y' : 'N',\n\t\t\tPROPERTY_TYPE: 'S',\n\t\t};\n\n\t\tif (fields.field)\n\t\t{\n\t\t\tformatted.ID = fields.field.getId();\n\t\t}\n\n\t\tswitch (fields.typeId)\n\t\t{\n\t\t\tcase 'directory':\n\t\t\t\tformatted.DIRECTORY_NAME = fields.directoryName;\n\t\t\t\tformatted.USER_TYPE = 'directory';\n\t\t\t\tfields.enumeration = fields.enumeration || [];\n\t\t\t\tfields.enumeration.forEach((enumItem, key) => {\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][SORT'), enumItem.SORT);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][VALUE'), enumItem.VALUE.value);\n\t\t\t\t\tif (!this.isCreationMode())\n\t\t\t\t\t{\n\t\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][XML_ID'), enumItem.XML_ID);\n\t\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][FILE_ID'), enumItem.FILE_ID);\n\t\t\t\t\t}\n\t\t\t\t\tform.append('FILES['+enumItem.SORT+']' , enumItem.VALUE.file);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'list':\n\t\t\t\tformatted.PROPERTY_TYPE = 'L';\n\t\t\t\tfields.enumeration = fields.enumeration || [];\n\t\t\t\tfields.enumeration.forEach((enumItem, key) => {\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][SORT'), enumItem.SORT);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][VALUE'), enumItem.VALUE);\n\t\t\t\t\tform.append(this.getFormFieldName('VALUES]['+key+'][ID'), enumItem.ID);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'boolean':\n\t\t\t\tformatted.PROPERTY_TYPE = 'L';\n\t\t\t\tformatted.VALUES = ['Y'];\n\t\t\t\tformatted.LIST_TYPE = 'C';\n\t\t\t\tbreak;\n\t\t}\n\n\t\tfor (let [key, item] of Object.entries(formatted))\n\t\t{\n\t\t\tform.append(this.getFormFieldName(key), item);\n\t\t}\n\t\treturn form;\n\t}\n\n\tonFormCancel()\n\t{\n\t\tBX.SidePanel.Instance.close();\n\t}\n}\n\nReflection.namespace('BX.Catalog').PropertyCreationForm = PropertyCreationForm;"],"names":["PropertyCreationForm","id","settings","BX","addCustomEvent","delegate","onFormSave","onFormCancel","componentName","signedParameters","isCreationMode","_field","getTitle","sender","params","_isLocked","addClass","_saveButton","fields","formatConfiguratorFields","addProperty","updateProperty","ajax","runComponentAction","mode","data","then","response","CODE","PROPERTY_GRID_CODE","SidePanel","Instance","postMessage","window","catch","onError","bind","Dom","removeClass","_errorContainer","clean","Type","isArray","errors","forEach","error","showError","name","append","Tag","render","message","form","FormData","formatted","NAME","label","MULTIPLE","multiple","IS_REQUIRED","mandatory","PROPERTY_TYPE","field","ID","getId","typeId","DIRECTORY_NAME","directoryName","USER_TYPE","enumeration","enumItem","key","getFormFieldName","SORT","VALUE","value","XML_ID","FILE_ID","file","VALUES","LIST_TYPE","Object","entries","item","close","Catalog","IblockFieldConfigurator","Reflection","namespace"],"mappings":"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"}