this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.Provider=this.BX.Messenger.Provider||{};(function(e,s,t,r,i){"use strict";
/**
	 * Bitrix Messenger
	 * Base Rest Answer Handler
	 *
	 * @package bitrix
	 * @subpackage im
	 * @copyright 2001-2019 Bitrix
	 */var a=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(s)}}]);function e(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers["typeof"](s.controller)==="object"&&s.controller){this.controller=s.controller}if(babelHelpers["typeof"](s.store)==="object"&&s.store){this.store=s.store}}babelHelpers.createClass(e,[{key:"execute",value:function e(s,t){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};s="handle"+s.split(".").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join("");if(t.error()){if(typeof this[s+"Error"]==="function"){return this[s+"Error"](t.error(),r)}}else{if(typeof this[s+"Success"]==="function"){return this[s+"Success"](t.data(),r)}}return typeof this[s]==="function"?this[s](t,r):null}}]);return e}();function n(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);s&&(r=r.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?n(Object(t),!0).forEach((function(s){babelHelpers.defineProperty(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}var o=function(e){babelHelpers.inherits(a,e);function a(){babelHelpers.classCallCheck(this,a);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).apply(this,arguments))}babelHelpers.createClass(a,[{key:"handleImUserListGetSuccess",value:function e(t){this.store.dispatch("users/set",s.VuexBuilderModel.convertToArray(t))}},{key:"handleImUserGetSuccess",value:function e(s){this.store.dispatch("users/set",[s])}},{key:"handleImChatGetSuccess",value:function e(s){this.store.dispatch("dialogues/set",s)}},{key:"handleImDialogMessagesGetSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/setBefore",this.controller.application.prepareFilesBeforeSave(s.files))}},{key:"handleImDialogMessagesGetInitSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/set",this.controller.application.prepareFilesBeforeSave(s.files));if(s.messages.length===0&&s.chat_id){r.Logger.warn("setting messagesSet for empty chat",s.chat_id);setTimeout((function(){i.EventEmitter.emit(t.EventType.dialog.messagesSet,{chatId:s.chat_id})}),100)}else{this.store.dispatch("messages/set",s.messages.reverse())}}},{key:"handleImDialogMessagesGetUnreadSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/set",this.controller.application.prepareFilesBeforeSave(s.files))}},{key:"handleImDiskFolderGetSuccess",value:function e(s){this.store.commit("application/set",{dialog:{diskFolderId:s.ID}})}},{key:"handleImMessageAddSuccess",value:function e(s,t){var r=this;this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{id:s,sending:false,error:false}}).then((function(){r.store.dispatch("messages/actionFinish",{id:s,chatId:t.chatId})}))}},{key:"handleImMessageAddError",value:function e(s,t){this.store.dispatch("messages/actionError",{id:t.id,chatId:t.chatId})}},{key:"handleImDiskFileCommitSuccess",value:function e(s,t){var r=this;this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{id:s["MESSAGE_ID"],sending:false,error:false}}).then((function(){r.store.dispatch("messages/actionFinish",{id:s["MESSAGE_ID"],chatId:t.chatId})}))}},{key:"handleImDiskFileCommitError",value:function e(s,r){this.store.dispatch("files/update",{chatId:r.chatId,id:r.file.id,fields:{status:t.FileStatus.error,progress:0}});this.store.dispatch("messages/actionError",{id:r.id,chatId:r.chatId,retry:false})}},{key:"handleImRecentListSuccess",value:function e(s,t){r.Logger.warn("Provider.Rest.handleImRecentGetSuccess",s);var i=[];var a=[];var n=[];s.items.forEach((function(e){var s=0;var t=0;if(e.user&&e.user.id>0){s=e.user.id;i.push(e.user)}if(e.chat){t=e.chat.id;a.push(Object.assign(e.chat,{dialogId:e.id}))}else{a.push(Object.assign({},{dialogId:e.id}))}n.push(l(l({},e),{},{avatar:e.avatar.url,color:e.avatar.color,userId:s,chatId:t}))}));this.store.dispatch("users/set",i);this.store.dispatch("dialogues/set",a);this.store.dispatch("recent/set",n)}}]);return a}(a);
/**
	 * Bitrix Im
	 * Dialog Rest answers (Rest Answer Handler)
	 *
	 * @package bitrix
	 * @subpackage im
	 * @copyright 2001-2023 Bitrix
	 */var c=function(e){babelHelpers.inherits(s,e);function s(e){var t;babelHelpers.classCallCheck(this,s);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this,e));t.application=e.application;return t}babelHelpers.createClass(s,[{key:"handleImChatGetSuccess",value:function e(s){this.store.commit("application/set",{dialog:{chatId:s.id,dialogId:s.dialog_id,diskFolderId:s.disk_folder_id}})}},{key:"handleImCallGetCallLimitsSuccess",value:function e(s){this.store.commit("application/set",{call:{serverEnabled:s.callServerEnabled,maxParticipants:s.maxParticipants}})}},{key:"handleImChatGetError",value:function e(s){if(s.ex.error==="ACCESS_ERROR"){r.Logger.error("MobileRestAnswerHandler.handleImChatGetError: ACCESS_ERROR")}}},{key:"handleImDialogMessagesGetInitSuccess",value:function e(s){}},{key:"handleImMessageAddSuccess",value:function e(s,t){console.warn("im.message.add success in dialog handler")}},{key:"handleImMessageAddError",value:function e(s,t){}},{key:"handleImDiskFileCommitSuccess",value:function e(s,t){}}]);return s}(a);
/**
	 * Bitrix Messenger
	 * Bundle rest answer handlers
	 *
	 * @package bitrix
	 * @subpackage im
	 * @copyright 2001-2019 Bitrix
	 */e.BaseRestHandler=a;e.CoreRestHandler=o;e.DialogRestHandler=c})(this.BX.Messenger.Provider.Rest=this.BX.Messenger.Provider.Rest||{},BX,BX.Messenger.Const,BX.Messenger.Lib,BX.Event);
//# sourceMappingURL=registry.bundle.map.js