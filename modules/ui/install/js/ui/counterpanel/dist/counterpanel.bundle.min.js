this.BX=this.BX||{};(function(t,e,i,s,n){"use strict";let a=t=>t,l,r,o,u,h,c,d,v;function p(t,e){f(t,e);e.add(t)}function f(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function y(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var m=new WeakSet;var g=new WeakSet;var k=new WeakSet;var C=new WeakSet;var w=new WeakSet;var T=new WeakSet;let A=function(){function t(e){babelHelpers.classCallCheck(this,t);p(this,T);p(this,w);p(this,C);p(this,k);p(this,g);p(this,m);this.id=e.id?e.id:null;this.separator=i.Type.isBoolean(e.separator)?e.separator:true;this.items=i.Type.isArray(e.items)?e.items:[];this.popupMenu=null;this.isActive=i.Type.isBoolean(e.isActive)?e.isActive:false;this.isRestricted=i.Type.isBoolean(e.isRestricted)?e.isRestricted:false;this.panel=e.panel?e.panel:null;this.title=e.title?e.title:null;this.value=i.Type.isNumber(e.value)&&e.value!==undefined?e.value:null;this.titleOrder=null;this.valueOrder=null;this.color=e.color?e.color:null;this.parent=i.Type.isBoolean(e.parent)?e.parent:null;this.parentId=e.parentId?e.parentId:null;this.locked=false;this.type=i.Type.isString(e.type)?e.type.toLowerCase():null;this.eventsForActive=i.Type.isObject(e.eventsForActive)?e.eventsForActive:{};this.eventsForUnActive=i.Type.isObject(e.eventsForUnActive)?e.eventsForUnActive:{};if(i.Type.isObject(e.title)){this.title=e.title.value?e.title.value:null;this.titleOrder=i.Type.isNumber(e.title.order)?e.title.order:null}if(i.Type.isObject(e.value)){this.value=i.Type.isNumber(e.value.value)?e.value.value:null;this.valueOrder=i.Type.isNumber(e.value.order)?e.value.order:null}this.layout={container:null,value:null,title:null,cross:null,dropdownArrow:null,menuItem:null};this.counter=y(this,k,L).call(this);if(!y(this,g,E).call(this).isMultiselect()){y(this,m,I).call(this)}}babelHelpers.createClass(t,[{key:"getItems",value:function t(){return this.items}},{key:"hasParentId",value:function t(){return this.parentId}},{key:"updateValue",value:function t(e){if(i.Type.isNumber(e)){this.value=e;y(this,k,L).call(this).update(e);if(e===0){this.updateColor(this.parentId?"GRAY":"THEME")}}}},{key:"updateValueAnimate",value:function t(e){if(i.Type.isNumber(e)){this.value=e;y(this,k,L).call(this).update(e);y(this,k,L).call(this).show();if(e===0){this.updateColor(this.parentId?"GRAY":"THEME")}}}},{key:"updateColor",value:function t(e){if(i.Type.isString(e)){this.color=e;y(this,k,L).call(this).setColor(s.Counter.Color[e])}}},{key:"activate",value:function t(e=true){this.isActive=true;if(this.parentId){const t=BX.findParent(this.getContainerMenu(),{className:"ui-counter-panel__popup-item"});if(t){t.classList.add("--active")}}else{this.getContainer().classList.add("--active")}if(e){n.EventEmitter.emit("BX.UI.CounterPanel.Item:activate",this)}}},{key:"deactivate",value:function t(e=true){this.isActive=false;if(this.parentId){const t=BX.findParent(this.getContainerMenu(),{className:"ui-counter-panel__popup-item"});if(t){t.classList.remove("--active");t.classList.remove("--hover")}}else{this.getContainer().classList.remove("--active");this.getContainer().classList.remove("--hover")}if(e){n.EventEmitter.emit("BX.UI.CounterPanel.Item:deactivate",this)}}},{key:"getSeparator",value:function t(){return this.separator}},{key:"setEvents",value:function t(e){if(!e){e=this.getContainer()}if(this.eventsForActive){const t=Object.keys(this.eventsForActive);for(let i=0;i<t.length;i++){let s=t[i];e.addEventListener(s,(()=>{if(this.isActive){this.eventsForActive[s]()}}))}}if(this.eventsForUnActive){const t=Object.keys(this.eventsForUnActive);for(let i=0;i<t.length;i++){let s=t[i];e.addEventListener(s,(()=>{if(!this.isActive){this.eventsForUnActive[s]()}}))}}}},{key:"isLocked",value:function t(){return this.locked}},{key:"lock",value:function t(){this.locked=true;this.getContainer().classList.add("--locked")}},{key:"unLock",value:function t(){this.locked=false;this.getContainer().classList.remove("--locked")}},{key:"getArrowDropdown",value:function t(){if(!this.layout.dropdownArrow){this.layout.dropdownArrow=i.Tag.render(l||(l=a`
				<div class="ui-counter-panel__item-dropdown">
					<i></i>
				</div>
			`))}return this.layout.dropdownArrow}},{key:"getContainerMenu",value:function t(){if(!this.layout.menuItem){this.layout.menuItem=i.Tag.render(r||(r=a`
				<span>
					${0}
					${0}
					${0}
				</span>
			`),y(this,C,_).call(this),this.title,y(this,T,B).call(this))}return this.layout.menuItem}},{key:"getContainer",value:function t(){if(!this.layout.container){const t=this.type?`id="ui-counter-panel-item-${this.type}"`:"";const e=i.Type.isNumber(this.value);this.layout.container=i.Tag.render(o||(o=a`
				<div ${0} class="ui-counter-panel__item">
					${0}
					${0}
					${0}
				</div>
			`),t,e?y(this,C,_).call(this):"",this.title?y(this,w,b).call(this):"",e?y(this,T,B).call(this):"");if(this.parent){this.layout.container=i.Tag.render(u||(u=a`
					<div class="ui-counter-panel__item">
						${0}
						${0}
						${0}
					</div>
				`),this.title?y(this,w,b).call(this):"",e?y(this,C,_).call(this):"",y(this,T,B).call(this));y(this,T,B).call(this).addEventListener("click",(t=>{this.deactivate();t.stopPropagation()}));i.Dom.addClass(this.layout.container,"--dropdown")}if(!e){this.layout.container.classList.add("--string")}if(!e&&!this.eventsForActive&&!this.eventsForUnActive){this.layout.container.classList.add("--title")}if(!this.separator){this.layout.container.classList.add("--without-separator")}if(this.locked){this.layout.container.classList.add("--locked")}if(this.isActive){this.activate()}if(this.isRestricted){this.layout.container.classList.add("--restricted")}this.setEvents(this.layout.container);if(e&&this.items.length===0){if(!this.parent){this.layout.container.addEventListener("mouseenter",(()=>{if(!this.isActive){this.layout.container.classList.add("--hover")}}));this.layout.container.addEventListener("mouseleave",(()=>{if(!this.isActive){this.layout.container.classList.remove("--hover")}}));this.layout.container.addEventListener("click",(()=>{this.isActive?this.deactivate():this.activate()}))}}if(this.parent){i.Dom.append(this.getArrowDropdown(),this.layout.container)}}return this.layout.container}}]);return t}();function I(){n.EventEmitter.subscribe("BX.UI.CounterPanel.Item:activate",(t=>{const e=t.data.parentId===this.id;if(t.data!==this&&!e){this.deactivate()}}))}function E(){return this.panel}function L(t,e){if(!this.counter){this.counter=new s.Counter({value:this.value,color:this.color?s.Counter.Color[this.color.toUpperCase()]:this.parentId?s.Counter.Color.GRAY:s.Counter.Color.THEME,animation:false})}return this.counter}function _(){if(!this.layout.value){const t=this.isRestricted?i.Tag.render(h||(h=a`<div class="ui-counter-panel__item-lock"></div>`)):y(this,k,L).call(this).getContainer();this.layout.value=i.Tag.render(c||(c=a`
				<div class="ui-counter-panel__item-value">
					${0}
				</div>
			`),t);this.layout.value.style.setProperty("order",this.valueOrder)}return this.layout.value}function b(){if(!this.layout.title){this.layout.title=i.Tag.render(d||(d=a`
				<div class="ui-counter-panel__item-title">${0}</div>
			`),this.title);this.layout.title.style.setProperty("order",this.titleOrder)}return this.layout.title}function B(){if(!this.layout.cross){this.layout.cross=i.Tag.render(v||(v=a`
				<div class="ui-counter-panel__item-cross">
					<i></i>
				</div>
			`))}return this.layout.cross}let P=t=>t,$,F,O;function S(t,e){U(t,e);e.add(t)}function U(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function X(t,e,i){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return i}var M=new WeakSet;var N=new WeakSet;var W=new WeakSet;let j=function(){function t(e){babelHelpers.classCallCheck(this,t);S(this,W);S(this,N);S(this,M);this.target=i.Type.isDomNode(e.target)?e.target:null;this.items=i.Type.isArray(e.items)?e.items:[];this.multiselect=i.Type.isBoolean(e.multiselect)?e.multiselect:null;this.title=i.Type.isStringFilled(e.title)?e.title:null;this.container=null;this.keys=[];this.hasParent=[]}babelHelpers.createClass(t,[{key:"isMultiselect",value:function t(){return this.multiselect}},{key:"getItems",value:function t(){return this.items}},{key:"getItemById",value:function t(e){if(e){const t=this.keys.indexOf(e);return this.items[t]}}},{key:"init",value:function t(){X(this,M,H).call(this);X(this,W,D).call(this)}}]);return t}();function H(){this.items=this.items.map((t=>{t.panel=this;this.keys.push(t.id);if(t.parentId){this.hasParent.push(t.parentId)}return new A(t)}));this.hasParent.forEach((t=>{let e=this.keys.indexOf(t);this.items[e].parent=true}));this.items.map((t=>{if(t.parentId){let e=this.keys.indexOf(t.parentId);this.items[e].items.push(t.id)}}))}function R(){if(!this.container){let t="";if(this.title){t=i.Tag.render($||($=P`
					<div class="ui-counter-panel__item-head">${0}</div>
				`),this.title)}this.container=i.Tag.render(F||(F=P`
				<div class="ui-counter-panel ui-counter-panel__scope">${0}</div>
			`),t)}return this.container}function D(){if(this.target&&this.items.length>0){this.items.map(((t,s)=>{if(t instanceof A){if(!t.hasParentId()){X(this,N,R).call(this).appendChild(t.getContainer());if(this.items.length!==s+1&&this.items.length>1){X(this,N,R).call(this).appendChild(i.Tag.render(O||(O=P`
								<div class="ui-counter-panel__item-separator ${0}"></div>
							`),!t.getSeparator()?"--invisible":""))}}if(t.parent){t.getContainer().addEventListener("click",(()=>{const i=[];t.getItems().forEach((t=>{const e=this.getItemById(t);let s={html:e.getContainerMenu(),className:`ui-counter-panel__popup-item menu-popup-no-icon ${e.isActive?"--active":""}`,onclick:()=>{e.isActive?e.deactivate():e.activate()}};i.push(s)}));const s=new e.PopupMenuWindow({className:"ui-counter-panel__popup ui-counter-panel__scope",bindElement:t.getArrowDropdown(),autoHide:true,closeByEsc:true,items:i,angle:true,offsetLeft:6,offsetTop:5,animation:"fading-slide",events:{onPopupShow:()=>{t.getContainer().classList.add("--hover");t.getContainer().classList.add("--pointer-events-none")},onPopupClose:()=>{t.getContainer().classList.remove("--hover");t.getContainer().classList.remove("--pointer-events-none");s.destroy()}}});s.show()}))}}}));i.Dom.clean(this.target);this.target.appendChild(X(this,N,R).call(this))}}t.CounterPanel=j;t.CounterItem=A})(this.BX.UI=this.BX.UI||{},BX.Main,BX,BX.UI,BX.Event);
//# sourceMappingURL=counterpanel.bundle.map.js