this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i,a,n,o,r,l,c,g,d,u,p,m,h,M,v,I,b,_,C,f,L,E,x,y,A,B,T,S,F,P,k,D,H,G){"use strict";const O={name:"DialogLoader",props:{fullHeight:{type:Boolean,default:true}},data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-dialog-loader__container" :class="{'--full-height': fullHeight}">\n\t\t\t<div class="bx-im-dialog-loader__spinner"></div>\n\t\t\t<div class="bx-im-dialog-loader__text">{{ loc('IM_DIALOG_CHAT_LOADER_TEXT') }}</div>\n\t\t</div>\n\t`};const U=new Set([M.MessageComponent.unsupported,M.MessageComponent.chatCreation,M.MessageComponent.ownChatCreation,M.MessageComponent.conferenceCreation,M.MessageComponent.callInvite,M.MessageComponent.copilotCreation,M.MessageComponent.copilotMessage,M.MessageComponent.supportVote,M.MessageComponent.supportSessionNumber,M.MessageComponent.zoomInvite,M.MessageComponent.copilotAddedUsers,M.MessageComponent.supervisorUpdateFeature,M.MessageComponent.supervisorEnableFeature,M.MessageComponent.sign]);var w=babelHelpers.classPrivateFieldLooseKey("message");var N=babelHelpers.classPrivateFieldLooseKey("store");var X=babelHelpers.classPrivateFieldLooseKey("isServerComponent");var K=babelHelpers.classPrivateFieldLooseKey("hasFiles");var R=babelHelpers.classPrivateFieldLooseKey("hasText");var j=babelHelpers.classPrivateFieldLooseKey("hasAttach");var $=babelHelpers.classPrivateFieldLooseKey("isEmptyMessage");var V=babelHelpers.classPrivateFieldLooseKey("isDeletedMessage");var Y=babelHelpers.classPrivateFieldLooseKey("isSystemMessage");var q=babelHelpers.classPrivateFieldLooseKey("isEmojiOnly");var z=babelHelpers.classPrivateFieldLooseKey("hasSmilesOnly");var W=babelHelpers.classPrivateFieldLooseKey("hasOnlyText");var Q=babelHelpers.classPrivateFieldLooseKey("isForward");class Z{constructor(e){Object.defineProperty(this,Q,{value:ce});Object.defineProperty(this,W,{value:le});Object.defineProperty(this,z,{value:re});Object.defineProperty(this,q,{value:oe});Object.defineProperty(this,Y,{value:ne});Object.defineProperty(this,V,{value:ae});Object.defineProperty(this,$,{value:ie});Object.defineProperty(this,j,{value:se});Object.defineProperty(this,R,{value:te});Object.defineProperty(this,K,{value:ee});Object.defineProperty(this,X,{value:J});Object.defineProperty(this,w,{writable:true,value:void 0});Object.defineProperty(this,N,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,w)[w]=e;babelHelpers.classPrivateFieldLooseBase(this,N)[N]=h.Core.getStore()}getName(){if(babelHelpers.classPrivateFieldLooseBase(this,V)[V]()){return M.MessageComponent.deleted}if(babelHelpers.classPrivateFieldLooseBase(this,X)[X]()){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].componentId}if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]()){return M.MessageComponent.system}if(babelHelpers.classPrivateFieldLooseBase(this,K)[K]()){return M.MessageComponent.file}if(babelHelpers.classPrivateFieldLooseBase(this,q)[q]()||babelHelpers.classPrivateFieldLooseBase(this,z)[z]()){return M.MessageComponent.smile}return M.MessageComponent.default}}function J(){return U.has(babelHelpers.classPrivateFieldLooseBase(this,w)[w].componentId)}function ee(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].files.length>0}function te(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].text.length>0}function se(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].attach.length>0}function ie(){return!babelHelpers.classPrivateFieldLooseBase(this,R)[R]()&&!babelHelpers.classPrivateFieldLooseBase(this,K)[K]()&&!babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}function ae(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].isDeleted||babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}function ne(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].authorId===0}function oe(){if(babelHelpers.classPrivateFieldLooseBase(this,w)[w].replyId>0){return false}if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]()){return false}if(!babelHelpers.classPrivateFieldLooseBase(this,W)[W]()){return false}return g.Utils.text.isEmojiOnly(babelHelpers.classPrivateFieldLooseBase(this,w)[w].text)}function re(){var e,s;if(babelHelpers.classPrivateFieldLooseBase(this,w)[w].replyId>0){return false}if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]()){return false}if(!babelHelpers.classPrivateFieldLooseBase(this,W)[W]()){return false}const i=t.SmileManager.getInstance();const a=(e=(s=i.smileList)==null?void 0:s.smiles)!=null?e:[];const n=[...a].sort(((e,t)=>t.typing.localeCompare(e.typing)));const o=n.map((e=>g.Utils.text.escapeRegex(e.typing))).join("|");const r=babelHelpers.classPrivateFieldLooseBase(this,w)[w].text.replaceAll(new RegExp(o,"g"),"");const l=r.trim().length===0;const c=new RegExp(`(?:(?:${o})\\s*){4,}`);return l&&!c.test(babelHelpers.classPrivateFieldLooseBase(this,w)[w].text)}function le(){if(!babelHelpers.classPrivateFieldLooseBase(this,R)[R]()){return false}return!babelHelpers.classPrivateFieldLooseBase(this,K)[K]()&&!babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}function ce(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N].getters["messages/isForward"](babelHelpers.classPrivateFieldLooseBase(this,w)[w].id)}class ge extends n.BaseMenu{constructor(){super();this.id="bx-im-avatar-context-menu";this.permissionManager=i.PermissionManager.getInstance()}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:21}}getMenuItems(){return[this.getMentionItem(),this.getSendItem(),this.getProfileItem(),this.getKickItem()]}getMentionItem(){return{text:p.Loc.getMessage("IM_DIALOG_AVATAR_MENU_MENTION_2"),onclick:()=>{m.EventEmitter.emit(M.EventType.textarea.insertMention,{mentionText:this.context.user.name,mentionReplacement:g.Utils.text.getMentionBbCode(this.context.user.id,this.context.user.name)});this.menuInstance.close()}}}getSendItem(){if(this.context.dialog.type===M.ChatType.user){return null}return{text:p.Loc.getMessage("IM_DIALOG_AVATAR_MENU_SEND_MESSAGE"),onclick:()=>{s.Messenger.openChat(this.context.user.id);this.menuInstance.close()}}}getProfileItem(){if(this.isBot()){return null}return{text:p.Loc.getMessage("IM_DIALOG_AVATAR_MENU_OPEN_PROFILE"),href:g.Utils.user.getProfileLink(this.context.user.id),onclick:()=>{this.menuInstance.close()}}}getKickItem(){const e=this.permissionManager.canPerformAction(M.ChatActionType.kick,this.context.dialog.dialogId);if(!e){return null}return{text:p.Loc.getMessage("IM_DIALOG_AVATAR_MENU_KICK"),onclick:async()=>{this.menuInstance.close();const e=await a.showKickUserConfirm();if(e===true){const e=new l.ChatService;e.kickUserFromChat(this.context.dialog.dialogId,this.context.user.id)}}}}isUser(){return this.store.getters["chats/isUser"](this.context.user.id)}isBot(){if(!this.isUser()){return false}const e=this.store.getters["users/get"](this.context.user.id);return e.bot===true}}var de=babelHelpers.classPrivateFieldLooseKey("isOwnMessage");var ue=babelHelpers.classPrivateFieldLooseKey("isDeletedMessage");var pe=babelHelpers.classPrivateFieldLooseKey("getMessageFile");var me=babelHelpers.classPrivateFieldLooseKey("isForwardedMessage");class he extends n.BaseMenu{constructor(){super();Object.defineProperty(this,me,{value:be});Object.defineProperty(this,pe,{value:Ie});Object.defineProperty(this,ue,{value:ve});Object.defineProperty(this,de,{value:Me});this.id="bx-im-message-context-menu";this.diskService=new l.DiskService;this.marketManager=c.MarketManager.getInstance()}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:11}}getMenuItems(){return[this.getReplyItem(),this.getCopyItem(),this.getCopyFileItem(),this.getPinItem(),this.getForwardItem(),this.getDelimiter(),this.getMarkItem(),this.getFavoriteItem(),this.getDelimiter(),this.getCreateItem(),this.getDelimiter(),this.getDownloadFileItem(),this.getSaveToDisk(),this.getDelimiter(),this.getEditItem(),this.getDeleteItem()]}getReplyItem(){return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_REPLY"),onclick:()=>{m.EventEmitter.emit(M.EventType.textarea.replyMessage,{messageId:this.context.id});this.menuInstance.close()}}}getForwardItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()||p.Type.isString(this.context.id)){return null}return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_FORWARD"),onclick:()=>{m.EventEmitter.emit(M.EventType.dialog.showForwardPopup,{messageId:this.context.id});this.menuInstance.close()}}}getCopyItem(){if(this.context.text.trim().length===0){return null}return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY"),onclick:()=>{var e;const t=o.Parser.prepareCopy(this.context);if((e=BX.clipboard)!=null&&e.copy(t)){BX.UI.Notification.Center.notify({content:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_SUCCESS")})}this.menuInstance.close()}}}getCopyFileItem(){if(this.context.files.length===0){return null}return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_FILE"),onclick:()=>{var e;const t=o.Parser.prepareCopyFile(this.context);if((e=BX.clipboard)!=null&&e.copy(t)){BX.UI.Notification.Center.notify({content:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_FILE_SUCCESS")})}this.menuInstance.close()}}}getPinItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()){return null}const e=this.store.getters["messages/pin/isPinned"]({chatId:this.context.chatId,messageId:this.context.id});return{text:e?p.Loc.getMessage("IM_DIALOG_CHAT_MENU_UNPIN"):p.Loc.getMessage("IM_DIALOG_CHAT_MENU_PIN"),onclick:()=>{const t=new l.MessageService({chatId:this.context.chatId});if(e){t.unpinMessage(this.context.chatId,this.context.id)}else{t.pinMessage(this.context.chatId,this.context.id)}this.menuInstance.close()}}}getFavoriteItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()){return null}const e=this.store.getters["sidebar/favorites/isFavoriteMessage"](this.context.chatId,this.context.id);const t=e?p.Loc.getMessage("IM_DIALOG_CHAT_MENU_REMOVE_FROM_SAVED"):p.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE");return{text:t,onclick:()=>{const t=new l.MessageService({chatId:this.context.chatId});if(e){t.removeMessageFromFavorite(this.context.id)}else{t.addMessageToFavorite(this.context.id)}this.menuInstance.close()}}}getMarkItem(){const e=this.context.viewed&&!babelHelpers.classPrivateFieldLooseBase(this,de)[de]();const t=this.store.getters["chats/getByChatId"](this.context.chatId);const s=this.context.id===t.markedId;if(!e||s){return null}return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_MARK"),onclick:()=>{const e=new l.MessageService({chatId:this.context.chatId});e.markMessage(this.context.id);this.menuInstance.close()}}}getCreateItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()){return null}return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE"),items:[this.getCreateTaskItem(),this.getCreateMeetingItem(),...this.getMarketItems()]}}getCreateTaskItem(){return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_TASK"),onclick:()=>{const e=new r.EntityCreator(this.context.chatId);void e.createTaskForMessage(this.context.id);this.menuInstance.close()}}}getCreateMeetingItem(){return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_MEETING"),onclick:()=>{const e=new r.EntityCreator(this.context.chatId);void e.createMeetingForMessage(this.context.id);this.menuInstance.close()}}}getEditItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,de)[de]()||babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()||babelHelpers.classPrivateFieldLooseBase(this,me)[me]()){return null}return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_EDIT"),onclick:()=>{m.EventEmitter.emit(M.EventType.textarea.editMessage,{messageId:this.context.id});this.menuInstance.close()}}}getDeleteItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,de)[de]()||babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()){return null}return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_DELETE"),className:"menu-popup-no-icon bx-im-dialog-chat__message-menu_delete",onclick:()=>{const e=new l.MessageService({chatId:this.context.chatId});void e.deleteMessage(this.context.id);this.menuInstance.close()}}}getMarketItems(){const{dialogId:e,id:t}=this.context;const s=this.marketManager.getAvailablePlacementsByType(M.PlacementType.contextMenu,e);const i=[];if(s.length>0){i.push(this.getDelimiter())}const a={messageId:t,dialogId:e};s.forEach((e=>{i.push({text:e.title,onclick:()=>{c.MarketManager.openSlider(e,a);this.menuInstance.close()}})}));const n=11;return i.slice(0,n)}getDownloadFileItem(){const e=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]();if(!e){return null}return{html:g.Utils.file.createDownloadLink(p.Loc.getMessage("IM_DIALOG_CHAT_MENU_DOWNLOAD_FILE"),e.urlDownload,e.name),onclick:function(){this.menuInstance.close()}.bind(this)}}getSaveToDisk(){const e=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]();if(!e){return null}return{text:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ON_DISK"),onclick:function(){void this.diskService.save(e.id).then((()=>{BX.UI.Notification.Center.notify({content:p.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ON_DISK_SUCCESS")})}));this.menuInstance.close()}.bind(this)}}getDelimiter(){return{delimiter:true}}}function Me(){return this.context.authorId===h.Core.getUserId()}function ve(){return this.context.isDeleted}function Ie(){if(this.context.files.length===0){return null}return this.store.getters["files/get"](this.context.files[0])}function be(){return p.Type.isStringFilled(this.context.forward.id)}const _e={props:{title:{type:String,required:true}},data(){return{}},template:`\n\t\t<div class="bx-im-message-list-date-group-title__container">\n\t\t\t<div class="bx-im-message-list-date-group-title__text">{{ title }}</div>\n\t\t</div>\n\t`};const Ce={name:"DateGroup",components:{DateGroupTitle:_e},props:{item:{type:Object,required:true}},data(){return{}},computed:{BlockType:()=>M.DialogBlockType,dateGroup(){return this.item}},template:`\n\t\t<div class="bx-im-message-list-date-group__container">\n\t\t\t<DateGroupTitle :title="dateGroup.date.title" />\n\t\t\t<template v-for="dateGroupItem in dateGroup.items" >\n\t\t\t\t<slot\n\t\t\t\t\tname="dateGroupItem"\n\t\t\t\t\t:dateGroupItem="dateGroupItem"\n\t\t\t\t\t:isMarkedBlock="dateGroupItem.type === BlockType.markedMessages"\n\t\t\t\t\t:isNewMessagesBlock="dateGroupItem.type === BlockType.newMessages"\n\t\t\t\t\t:isAuthorBlock="dateGroupItem.type === BlockType.authorGroup"\n\t\t\t\t></slot>\n\t\t\t</template>\n\t\t</div>\n\t`};const fe={name:"AuthorGroup",components:{Avatar:u.Avatar},props:{item:{type:Object,required:true}},emits:["avatarClick"],data(){return{}},computed:{AvatarSize:()=>u.AvatarSize,authorGroup(){return this.item}},methods:{onAvatarClick(e){this.$emit("avatarClick",{dialogId:this.authorGroup.avatar.avatarId,$event:e})}},template:`\n\t\t<div class="bx-im-message-list-author-group__container" :class="'--' + authorGroup.messageType">\n\t\t\t<div v-if="authorGroup.avatar.isNeeded" class="bx-im-message-list-author-group__avatar">\n\t\t\t\t<Avatar\n\t\t\t\t\t:dialogId="authorGroup.avatar.avatarId"\n\t\t\t\t\t:size="AvatarSize.L"\n\t\t\t\t\t@click="onAvatarClick"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="bx-im-message-list__content">\n\t\t\t\t<template v-for="(message, index) in authorGroup.items">\n\t\t\t\t\t<slot name="message" :message="message" :index="index"></slot>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const Le={data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-new-message__container">\n\t\t\t<div class="bx-im-message-list-new-message__text">\n\t\t\t\t{{ loc('IM_DIALOG_CHAT_BLOCK_NEW_MESSAGES_2') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const Ee={data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-new-message__container">\n\t\t\t<div class="bx-im-message-list-new-message__text">\n\t\t\t\t{{ loc('IM_DIALOG_CHAT_BLOCK_MARKED_MESSAGES') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const xe=[p.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_1"),p.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_2"),p.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_3"),p.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_4"),p.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_5")];const ye={name:"EmptyState",data(){return{}},computed:{defaultMessages:()=>xe},methods:{onMessageClick(e){m.EventEmitter.emit(M.EventType.textarea.insertText,{text:e})},loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-empty-state__container">\n\t\t\t<div class="bx-im-message-list-empty-state__content">\n\t\t\t\t<div class="bx-im-message-list-empty-state__icon"></div>\n\t\t\t\t<div class="bx-im-message-list-empty-state__title">{{ loc('IM_MESSAGE_LIST_EMPTY_STATE_TITLE') }}</div>\n\t\t\t\t<div class="bx-im-message-list-empty-state__action-list">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for="(message, index) in defaultMessages"\n\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\t@click="onMessageClick(message)"\n\t\t\t\t\t\tclass="bx-im-message-list-empty-state__action-list_item"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ message }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};class Ae{constructor(e){this.firstIteration=true;this.cachedDateGroups={};this.store=h.Core.getStore();this.dialogId=e}formatMessageCollection(e){const t={};const s=[];let i=null;let a=null;let n=null;const o=this.store.getters["chats/get"](this.dialogId);const{markedId:r,inited:l}=o;let c=false;const g=this.store.getters["chats/getLastReadId"](this.dialogId);if(this.firstIteration){this.initialLastReadMessage=g;this.initialMarkedId=r}if(r!==this.initialMarkedId&&r!==0){this.initialMarkedId=r;this.initialLastReadMessage=null}e.forEach(((o,r)=>{const l=this.getDateGroup(o.date);if(!t[l.title]){t[l.title]=l.id;i=[];s.push({type:M.DialogBlockType.dateGroup,date:l,items:i});a=null}if(o.id===this.initialMarkedId){i.push({type:M.DialogBlockType.markedMessages});a=null;c=true}if(o.authorId!==a){a=o.authorId;n=[];i.push({type:M.DialogBlockType.authorGroup,userId:o.authorId,avatar:this.getAvatarConfig(o),messageType:this.getMessageType(o),items:n})}n.push(o);const g=r===e.length-1;if(!c&&!g&&o.id===this.initialLastReadMessage){i.push({type:M.DialogBlockType.newMessages});a=null}}));if(l){this.firstIteration=false}return s}getDateGroup(e){const t=10;const s=e.toJSON().slice(0,t);if(this.cachedDateGroups[s]){return this.cachedDateGroups[s]}this.cachedDateGroups[s]={id:s,title:v.DateFormatter.formatByTemplate(e,v.DateTemplate.dateGroup)};return this.cachedDateGroups[s]}getAvatarConfig(e){const t=this.getMessageType(e);const s=t===M.MessageType.system;const i=t===M.MessageType.self;const a=this.store.getters["application/settings/get"](M.Settings.appearance.alignment);let n=true;if(a===M.DialogAlignment.left){n=!s}else if(a===M.DialogAlignment.center){n=!i&&!s}return{isNeeded:n,avatarId:e.authorId.toString()}}getMessageType(e){if(!e.authorId){return M.MessageType.system}if(e.authorId===h.Core.getUserId()){return M.MessageType.self}return M.MessageType.opponent}}const Be={DefaultMessage:b.DefaultMessage,FileMessage:I.FileMessage,SmileMessage:L.SmileMessage,CallInviteMessage:_.CallInviteMessage,DeletedMessage:C.DeletedMessage,SystemMessage:E.SystemMessage,UnsupportedMessage:f.UnsupportedMessage,ChatCreationMessage:x.ChatCreationMessage,OwnChatCreationMessage:H.OwnChatCreationMessage,ChatCopilotCreationMessage:y.ChatCopilotCreationMessage,CopilotMessage:A.CopilotMessage,SupportVoteMessage:T.SupportVoteMessage,SupportSessionNumberMessage:S.SupportSessionNumberMessage,ConferenceCreationMessage:F.ConferenceCreationMessage,ZoomInviteMessage:G.ZoomInviteMessage,SupervisorUpdateFeatureMessage:P.SupervisorUpdateFeatureMessage,SupervisorEnableFeatureMessage:k.SupervisorEnableFeatureMessage,ChatCopilotAddedUsersMessage:B.ChatCopilotAddedUsersMessage,SignMessage:D.SignMessage};const Te={name:"MessageList",directives:{"message-observer":{mounted(e,t){t.instance.observer.observeMessage(e)},beforeUnmount(e,t){t.instance.observer.unobserveMessage(e)}}},components:{DateGroup:Ce,AuthorGroup:fe,NewMessagesBlock:Le,MarkedMessagesBlock:Ee,DialogStatus:u.DialogStatus,DialogLoader:O,EmptyState:ye,...Be},props:{dialogId:{type:String,required:true},messages:{type:Array,required:true},observer:{type:Object,required:true}},emits:["showQuoteButton"],data(){return{messageMenuIsActiveForId:0}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},user(){return this.$store.getters["users/get"](this.dialogId,true)},isUser(){return this.dialog.type===M.ChatType.user},dialogInited(){return this.dialog.inited},messageCollection(){return this.messages},formattedCollection(){if(!this.dialogInited&&this.messageCollection.length===0){return[]}return this.getCollectionManager().formatMessageCollection(this.messageCollection)},noMessages(){return this.formattedCollection.length===0},showDialogStatus(){return this.messageCollection.some((e=>e.id===this.dialog.lastMessageId))},statusComponent(){return u.DialogStatus}},created(){this.initContextMenu();this.initCollectionManager()},mounted(){this.subscribeToEvents()},beforeUnmount(){this.unsubscribeFromEvents()},methods:{needToShowAvatarMenuFor(e){if(!e){return false}const t=e.id===h.Core.getUserId();const s=this.isUser&&this.user.bot===true;return!t&&!s},subscribeToEvents(){m.EventEmitter.subscribe(M.EventType.dialog.onClickMessageContextMenu,this.onMessageContextMenuClick)},unsubscribeFromEvents(){m.EventEmitter.unsubscribe(M.EventType.dialog.onClickMessageContextMenu,this.onMessageContextMenuClick)},initCollectionManager(){this.getCollectionManager()},initContextMenu(){this.messageMenu=new he;this.messageMenu.subscribe(he.events.onCloseMenu,(()=>{this.messageMenuIsActiveForId=0}));this.avatarMenu=new ge},onAvatarClick(e){const{dialogId:t,$event:s}=e;const i=this.$store.getters["users/get"](t);if(!this.needToShowAvatarMenuFor(i)){return}if(g.Utils.key.isAltOrOption(s)){m.EventEmitter.emit(M.EventType.textarea.insertMention,{mentionText:i.name,mentionReplacement:g.Utils.text.getMentionBbCode(i.id,i.name)});return}this.avatarMenu.openMenu({user:i,dialog:this.dialog},s.currentTarget)},onMessageContextMenuClick(e){const{message:t,event:s}=e.getData();const i={dialogId:this.dialogId,...t};this.messageMenu.openMenu(i,s.currentTarget);this.messageMenuIsActiveForId=t.id},async onMessageMouseUp(e,t){await g.Utils.browser.waitForSelectionToUpdate();const s=window.getSelection().toString().trim();if(s.length===0||this.isGuest){return}this.$emit("showQuoteButton",e,t)},getMessageComponentName(e){return new Z(e).getName()},getCollectionManager(){if(!this.collectionManager){this.collectionManager=new Ae(this.dialogId)}return this.collectionManager}},template:`\n\t\t<div class="bx-im-message-list__container">\n\t\t\t<DialogLoader v-if="!dialogInited" :fullHeight="noMessages" />\n\t\t\t<EmptyState v-else-if="noMessages && isUser" />\n\t\t\t<DateGroup v-for="dateGroup in formattedCollection" :key="dateGroup.date.id" :item="dateGroup">\n\t\t\t\t\x3c!-- Slot for every date group item --\x3e\n\t\t\t\t<template #dateGroupItem="{ dateGroupItem, isMarkedBlock, isNewMessagesBlock, isAuthorBlock }">\n\t\t\t\t\t<MarkedMessagesBlock v-if="isMarkedBlock" data-id="newMessages" />\n\t\t\t\t\t<NewMessagesBlock v-else-if="isNewMessagesBlock" data-id="newMessages" />\n\t\t\t\t\t<AuthorGroup v-else-if="isAuthorBlock" :item="dateGroupItem" @avatarClick="onAvatarClick">\n\t\t\t\t\t\t\x3c!-- Slot for every message --\x3e\n\t\t\t\t\t\t<template #message="{ message, index }">\n\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\tv-message-observer\n\t\t\t\t\t\t\t\t:is="getMessageComponentName(message)"\n\t\t\t\t\t\t\t\t:withTitle="index === 0"\n\t\t\t\t\t\t\t\t:item="message"\n\t\t\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t\t\t:key="message.id"\n\t\t\t\t\t\t\t\t:menuIsActiveForId="messageMenuIsActiveForId"\n\t\t\t\t\t\t\t\t:data-viewed="message.viewed"\n\t\t\t\t\t\t\t\t@mouseup="onMessageMouseUp(message, $event)"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</component>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</AuthorGroup>\n\t\t\t\t</template>\n\t\t\t</DateGroup>\n\t\t\t<component :is="statusComponent" v-if="showDialogStatus" :dialogId="dialogId" />\n\t\t</div>\n\t`};e.MessageList=Te})(this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Component.Elements,BX,BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message);
//# sourceMappingURL=message-list.bundle.map.js