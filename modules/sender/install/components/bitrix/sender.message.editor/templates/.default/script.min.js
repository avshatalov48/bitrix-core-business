(function(){BX.namespace("BX.Sender.Message");if(BX.Sender.Message.Editor){return}var e=BX.Sender.Helper;function t(){this.context=null;this.editor=null}t.prototype.classNameMoreActive="sender-more-active";t.prototype.init=function(t){this.context=BX(t.containerId);this.actionUri=t.actionUri;this.mess=t.mess;this.fieldPrefix=t.fieldPrefix;this.messageCode=t.messageCode;this.messageId=t.messageId;this.templateType=t.templateType;this.templateId=t.templateId;this.moreButton=e.getNode("more-btn",this.context);this.blockToCopy=e.getNode("consent-block-to-copy",this.context);if(this.blockToCopy){this.blockToCopy.hidden=false;if(this.templateId!=="empty"){this.blockToCopy.hidden=true}}this.copyBtn=document.getElementById("ui-button-copy");this.moreFields=e.getNode("more-fields",this.context);if(this.moreButton&&this.moreFields){BX.bind(this.moreButton,"click",this.onMoreClick.bind(this))}if(this.copyBtn){BX.bind(this.copyBtn,"click",this.onCopyClick.bind(this))}this.configuration=new i(this);this.ajaxAction=new BX.AjaxAction(this.actionUri);e.hint.init(this.context);this.bindNodes();this.initFields();this.loadFrame()};t.prototype.initFields=function(){var t=this.context.querySelectorAll("[data-bx-field]");t=BX.convert.nodeListToArray(t);t.forEach(function(t){var i=t.getAttribute("data-bx-field");var n=t.querySelector('[name="'+i+'"]');e.tag.init(t,n)},this)};t.prototype.loadFrame=function(){var t=e.getNode("bx-sender-template-iframe",this.context);if(t){t.src=this.ajaxAction.getRequestingUri("prepareHtml",{lang:"",messageId:this.messageId});t.onload=function(){var i=e.getNode("bx-sender-view-loader",BX.Sender.Message.Editor.context);i.style.display="none";t.style.display="block"}}};t.prototype.onMoreClick=function(){e.display.toggle(this.moreFields);BX.toggleClass(this.moreButton,this.classNameMoreActive)};t.prototype.onCopyClick=function(){var e=document.createElement("textarea");e.value=document.querySelector(".sender-footer-to-copy").textContent;e.style.top="0";e.style.left="0";e.style.position="fixed";document.body.appendChild(e);e.focus();e.select();try{document.execCommand("copy");e.remove()}catch(e){}};t.prototype.setAdaptedInstance=function(e){this.editor=e};t.prototype.initTester=function(){var e=BX.Sender.Message.Tester;if(!e){return}BX.addCustomEvent(e,e.eventNameSend,this.onTestSend.bind(this))};t.prototype.bindNodes=function(){setTimeout(this.initTester.bind(this),200);if(BX.Sender.Template&&BX.Sender.Template.Selector){var e=BX.Sender.Template.Selector;BX.addCustomEvent(e,e.events.templateSelect,this.onTemplateSelect.bind(this))}};t.prototype.onTemplateSelect=function(e){if(this.blockToCopy){this.blockToCopy.hidden=false;if(e.code!=="empty"){this.blockToCopy.hidden=true}}this.setTemplate(e)};t.prototype.setTemplate=function(e){this.templateType=e.type;this.templateId=e.code;var t={};(e.messageFields||{}).reduce(function(e,t){if(!t.onDemand){e[t.code]=t.value}return e},t);this.configuration.set(t)};t.prototype.onTestSend=function(e){if(this.getMessageId()){e.id=this.getMessageId()}if(!e.data)e.data={};e.data=Object.assign(e.data,this.getConfiguration())};t.prototype.getMessageId=function(){return this.messageId};t.prototype.getConfiguration=function(){return this.configuration.get()};function i(e){this.manager=e}i.prototype={getInputs:function(e){e=e||{};e.disableChecked=e.disableChecked||false;var t=e.disableChecked?"":":checked";var i=this.manager.context.querySelectorAll("select, textarea, "+'input[type="text"], '+'input[type="hidden"], '+'input[type="radio"]'+t+", "+'input[type="checkbox"]'+t);i=BX.convert.nodeListToArray(i);return i.filter(function(e){return!!this.getInputName(e)},this)},getInputName:function(e){var t=e.name;if(t.indexOf(this.manager.fieldPrefix)!==0){return""}return t.substring(this.manager.fieldPrefix.length)},set:function(e){this.getInputs({disableChecked:true}).forEach(function(t){var i=this.getInputName(t);if(e[i]){switch(t.type){case"checkbox":t.checked=t.value===e[i];break;default:t.value=e[i]}BX.fireEvent(t,"change")}},this)},get:function(){var e={};this.getInputs().forEach(function(t){var i=this.getInputName(t);if(!t.value){return}if(e[i]){if(!BX.type.isArray(e[i])){e[i]=[e[i]]}e[i].push(t.value)}else{e[i]=t.value}},this);e.TEMPLATE_TYPE=this.manager.templateType;e.TEMPLATE_ID=this.manager.templateId;return e}};BX.Sender.Message.Editor=new t})(window);
//# sourceMappingURL=script.map.js