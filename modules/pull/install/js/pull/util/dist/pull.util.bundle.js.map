{"version":3,"file":"pull.util.bundle.js","sources":["../src/util.js"],"sourcesContent":["/* eslint-disable @bitrix24/bitrix24-rules/no-typeof */\n\nexport const browser = {\n\tIsChrome(): boolean\n\t{\n\t\treturn navigator.userAgent.toLowerCase().includes('chrome');\n\t},\n\n\tIsFirefox(): boolean\n\t{\n\t\treturn navigator.userAgent.toLowerCase().includes('firefox');\n\t},\n\n\tIsIe(): boolean\n\t{\n\t\treturn navigator.userAgent.match(/(Trident\\/|MSIE\\/)/) !== null;\n\t},\n};\n\nexport function getTimestamp(): number\n{\n\treturn Date.now();\n}\n\n/**\n * Reduces errors array to single string.\n * @param {array} errors\n * @return {string}\n */\nexport function errorsToString(errors): string\n{\n\tif (!isArray(errors))\n\t{\n\t\treturn '';\n\t}\n\n\treturn errors.reduce((accum, currentValue) => {\n\t\tconst result = accum === '' ? accum : `${accum}; `;\n\n\t\treturn `${result + currentValue.code}: ${currentValue.message}`;\n\t}, '');\n}\n\nexport function isString(item): boolean\n{\n\treturn item === '' ? true : (item ? (typeof (item) === 'string' || item instanceof String) : false);\n}\n\nexport function isArray(item): boolean\n{\n\treturn item && Object.prototype.toString.call(item) === '[object Array]';\n}\n\nexport function isFunction(item): boolean\n{\n\treturn item === null ? false : (typeof (item) === 'function' || item instanceof Function);\n}\n\nexport function getFunction(f: Function): Function\n{\n\treturn isFunction(f) ? f : function() {};\n}\n\nexport function isDomNode(item): boolean\n{\n\treturn item && typeof (item) === 'object' && 'nodeType' in item;\n}\n\nexport function isDate(item): boolean\n{\n\treturn item && Object.prototype.toString.call(item) === '[object Date]';\n}\n\nexport function isNumber(item): boolean\n{\n\treturn typeof item === 'number' && Number.isFinite(item);\n}\n\nexport function isObject(item): boolean\n{\n\treturn Boolean(item) && typeof item === 'object';\n}\n\nexport function isPlainObject(item): boolean\n{\n\treturn Boolean(item) && typeof item === 'object' && item.constructor === Object;\n}\n\nexport function isNotEmptyString(item): boolean\n{\n\treturn isString(item) ? item.length > 0 : false;\n}\n\nexport function isJsonRpcRequest(item): boolean\n{\n\treturn (\n\t\ttypeof (item) === 'object'\n\t\t&& item\n\t\t&& 'jsonrpc' in item\n\t\t&& isNotEmptyString(item.jsonrpc)\n\t\t&& 'method' in item\n\t\t&& isNotEmptyString(item.method)\n\t);\n}\n\nexport function isJsonRpcResponse(item): boolean\n{\n\treturn (\n\t\ttypeof (item) === 'object'\n\t\t&& item\n\t\t&& 'jsonrpc' in item\n\t\t&& isNotEmptyString(item.jsonrpc)\n\t\t&& 'id' in item\n\t\t&& (\n\t\t\t'result' in item\n\t\t\t|| 'error' in item\n\t\t)\n\t);\n}\n\nexport function buildQueryString(params: Object): string\n{\n\tlet result = '';\n\tfor (const key of Object.keys(params))\n\t{\n\t\tconst value = params[key];\n\t\tif (isArray(value))\n\t\t{\n\t\t\tfor (const [index, valueElement] of value.entries())\n\t\t\t{\n\t\t\t\tconst left = encodeURIComponent(`${key}[${index}]`);\n\t\t\t\tconst right = `${encodeURIComponent(valueElement)}&`;\n\t\t\t\tresult += `${left}=${right}`;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult += `${encodeURIComponent(key)}=${encodeURIComponent(value)}&`;\n\t\t}\n\t}\n\n\tif (result.length > 0)\n\t{\n\t\tresult = result.slice(0, Math.max(0, result.length - 1));\n\t}\n\n\treturn result;\n}\n\nexport function clone(obj: any, bCopyObj = true): any\n{\n\tlet _obj, i, l;\n\n\tif (obj === null)\n\t{\n\t\treturn null;\n\t}\n\n\tif (isDomNode(obj))\n\t{\n\t\t_obj = obj.cloneNode(bCopyObj);\n\t}\n\telse if (typeof obj === 'object')\n\t{\n\t\tif (isArray(obj))\n\t\t{\n\t\t\t_obj = [];\n\t\t\tfor (i = 0, l = obj.length; i < l; i++)\n\t\t\t{\n\t\t\t\tif (typeof obj[i] === 'object' && bCopyObj)\n\t\t\t\t{\n\t\t\t\t\t_obj[i] = clone(obj[i], bCopyObj);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t_obj[i] = obj[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t_obj = {};\n\t\t\tif (obj.constructor)\n\t\t\t{\n\t\t\t\tif (isDate(obj))\n\t\t\t\t{\n\t\t\t\t\t_obj = new Date(obj);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t_obj = new obj.constructor();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i in obj)\n\t\t\t{\n\t\t\t\tif (!obj.hasOwnProperty(i))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (typeof obj[i] === 'object' && bCopyObj)\n\t\t\t\t{\n\t\t\t\t\t_obj[i] = clone(obj[i], bCopyObj);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t_obj[i] = obj[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\t_obj = obj;\n\t}\n\n\treturn _obj;\n}\n\nexport function getDateForLog(): string\n{\n\tconst d = new Date();\n\n\treturn `${d.getFullYear()}-${lpad(d.getMonth(), 2, '0')}-${lpad(d.getDate(), 2, '0')} ${lpad(d.getHours(), 2, '0')}:${lpad(d.getMinutes(), 2, '0')}`;\n}\n\nexport function lpad(str: string, length, chr = ' '): string\n{\n\tif (str.length > length)\n\t{\n\t\treturn str;\n\t}\n\n\tlet result = '';\n\tfor (let i = 0; i < length - result.length; i++)\n\t{\n\t\tresult += chr;\n\t}\n\n\treturn result + str;\n}\n\nexport function isWebSocketSupported(): boolean\n{\n\treturn typeof 'WebSocket' !== 'undefined';\n}\n\nexport class CircularBuffer<T>\n{\n\tstorage: T[];\n\tcapacity: number;\n\tpointer = 0;\n\n\tconstructor(capacity: number)\n\t{\n\t\tif (capacity <= 0)\n\t\t{\n\t\t\tthrow new Error('capacity must be > 0');\n\t\t}\n\n\t\tthis.capacity = capacity;\n\t\tthis.storage = [];\n\t}\n\n\tpush(element: T)\n\t{\n\t\tthis.storage[this.pointer] = element;\n\t\tthis.pointer++;\n\t\tif (this.pointer >= this.capacity)\n\t\t{\n\t\t\tthis.pointer = 0;\n\t\t}\n\t}\n\n\tgetAll(): T[]\n\t{\n\t\tif (this.pointer === 0)\n\t\t{\n\t\t\treturn this.storage;\n\t\t}\n\n\t\treturn [...this.storage.slice(this.pointer), ...this.storage.slice(0, this.pointer)];\n\t}\n}\n"],"names":["browser","IsChrome","navigator","userAgent","toLowerCase","includes","IsFirefox","IsIe","match","getTimestamp","Date","now","errorsToString","errors","isArray","reduce","accum","currentValue","result","code","message","isString","item","String","Object","prototype","toString","call","isFunction","Function","getFunction","f","isDomNode","isDate","isNumber","Number","isFinite","isObject","Boolean","isPlainObject","constructor","isNotEmptyString","length","isJsonRpcRequest","jsonrpc","method","isJsonRpcResponse","buildQueryString","params","key","keys","value","index","valueElement","entries","left","encodeURIComponent","right","slice","Math","max","clone","obj","bCopyObj","_obj","i","l","cloneNode","hasOwnProperty","getDateForLog","d","getFullYear","lpad","getMonth","getDate","getHours","getMinutes","str","chr","isWebSocketSupported","CircularBuffer","capacity","pointer","Error","storage","push","element","getAll"],"mappings":"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"}