(function(){BX.namespace("BX.Call");if(BX.Call.Util){return}var e="/bitrix/js/im/images/blank.gif";BX.Call.Util={userData:{},usersInProcess:{},updateUserData:function(e,t){var r=[];var a=this;for(var n=0;n<t.length;n++){if(this.userData.hasOwnProperty(t[n])){continue}r.push(t[n])}var s=new Promise((function(n,s){if(r.length===0){return n()}BX.CallEngine.getRestClient().callMethod("im.call.getUsers",{callId:e,userIds:r}).then((function(e){var r=BX.type.isPlainObject(e.answer.result)?e.answer.result:{};t.forEach((function(e){if(r[e]){a.userData[e]=r[e]}delete a.usersInProcess[e]}));n()})).catch((function(e){s(e.answer)}))}));for(var n=0;n<r.length;n++){this.usersInProcess[r[n]]=s}return s},setUserData:function(e){for(var t in e){this.userData[t]=e[t]}},getDateForLog:function(){var e=new Date;return e.getFullYear()+"-"+this.lpad(e.getMonth()+1,2,"0")+"-"+this.lpad(e.getDate(),2,"0")+" "+this.lpad(e.getHours(),2,"0")+":"+this.lpad(e.getMinutes(),2,"0")+":"+this.lpad(e.getSeconds(),2,"0")+"."+e.getMilliseconds()},getTimeForLog:function(){var e=new Date;return this.lpad(e.getHours(),2,"0")+":"+this.lpad(e.getMinutes(),2,"0")+":"+this.lpad(e.getSeconds(),2,"0")+"."+e.getMilliseconds()},lpad:function(e,t,r){e=e.toString();r=r||" ";if(e.length>t){return e}var a="";for(var n=0;n<t-e.length;n++){a+=r}return a+e},getUser:function(e,t){var r=this;return new Promise((function(a,n){if(r.userData.hasOwnProperty(t)){return a(r.userData[t])}else if(r.usersInProcess.hasOwnProperty(t)){r.usersInProcess[t].then((function(){return a(r.userData[t])}))}else{r.updateUserData(e,[t]).then((function(){return a(r.userData[t])}))}}))},getUsers:function(e,t){var r=this;return new Promise((function(a,n){r.updateUserData(e,t).then((function(){var e={};t.forEach((function(t){e[t]=r.userData[t]||{}}));return a(e)}))}))},getUserName:function(e,t){var r=this;return new Promise((function(a,n){if(r.userData.hasOwnProperty(t)){return a(r.userData[t].name?r.userData[t].name:"")}else if(r.usersInProcess.hasOwnProperty(t)){r.usersInProcess[t].then((function(){return a(r.userData[t].name?r.userData[t].name:"")}))}else{r.updateUserData(e,[t]).then((function(){return a(r.userData[t].name?r.userData[t].name:"")}))}}))},getUserAvatar:function(e,t){var a=this;return new Promise((function(n,s){if(a.userData.hasOwnProperty(t)){return n(a.userData[t].avatar_hr&&!r(a.userData[t].avatar_hr)?a.userData[t].avatar_hr:"")}else if(a.usersInProcess.hasOwnProperty(t)){a.usersInProcess[t].then((function(){return n(a.userData[t].avatar_hr&&!r(a.userData[t].avatar_hr)?a.userData[t].avatar_hr:"")}))}else{a.updateUserData(e,[t]).then((function(){return n(a.userData[t].avatar_hr&&!r(a.userData[t].avatar_hr)?a.userData[t].avatar_hr:"")}))}}))},getUserAvatars:function(e,t){var a=this;return new Promise((function(n,s){a.updateUserData(e,t).then((function(){var e={};t.forEach((function(t){e[t]=a.userData[t].avatar_hr&&!r(a.userData[t].avatar_hr)?a.userData[t].avatar_hr:""}));return n(e)}))}))},isAvatarBlank:function(e){var t=r(e);return t},getCustomMessage:function(e,t){var r;if(!BX.type.isPlainObject(t)){t={}}if(t.gender&&BX.message.hasOwnProperty(e+"_"+t.gender)){r=BX.message(e+"_"+t.gender)}else{r=BX.message(e)}t=this.convertKeysToUpper(t);return r.replace(/#.+?#/gm,(function(e){var r=e.substr(1,e.length-2);return t.hasOwnProperty(r)?t[r]:e}))},convertKeysToUpper:function(e){var t=BX.util.objectClone(e);for(var r in t){var a=r.toUpperCase();if(a!=r){t[a]=t[r];delete t[r]}}return t},appendChildren:function(e,t){t.forEach((function(t){e.appendChild(t)}))},containsVideoTrack:function(e){if(!(e instanceof MediaStream))return false;return e.getVideoTracks().length>0},hasHdVideo:function(e){if(!(e instanceof MediaStream)||e.getVideoTracks().length===0)return false;var t=e.getVideoTracks()[0];var r=t.getSettings();return r.width>=1280},findBestElementSize:function(e,t,r,a,n){a=a||0;n=n||0;var s=0;for(var i=1;i<=r;i++){var u=this.getFilledArea(e,t,r,i);if(u.area>s&&u.elementWidth>a&&u.elementHeight>n){s=u.area;var o=u.elementWidth;var c=u.elementHeight}if(u.area<s){break}}if(s===0){o=a;c=n}return{width:o,height:c}},getFilledArea:function(e,t,r,a){var n=Math.ceil(r/a);var s=Math.floor(e/n);var i=Math.floor(t/a);var u=i/s;var o=9/16;var c;var l;if(u<o){c=i;l=Math.floor(s*(u/o))}else{l=s;c=Math.floor(i*(o/u))}var f=l*c*r;return{area:f,elementWidth:l,elementHeight:c}},isWebRTCSupported:function(){return typeof webkitRTCPeerConnection!="undefined"||typeof mozRTCPeerConnection!="undefined"||typeof RTCPeerConnection!="undefined"},isCallServerAllowed:function(){return BX.message("call_server_enabled")==="Y"},isFeedbackAllowed:function(){return BX.message("call_allow_feedback")==="Y"},shouldCollectStats:function(){return BX.message("call_collect_stats")==="Y"},shouldShowDocumentButton:function(){return BX.message("call_docs_status")!=="N"||BX.message("call_resumes_status")!=="N"},getDocumentsArticleCode:function(){if(!BX.message("call_docs_status").startsWith("L")){return false}return BX.message("call_docs_status").substr(2)},getResumesArticleCode:function(){if(!BX.message("call_resumes_status").startsWith("L")){return false}return BX.message("call_resumes_status").substr(2)},getUserLimit:function(){if(this.isCallServerAllowed()){return parseInt(BX.message("call_server_max_users"))}return parseInt(BX.message("turn_server_max_users"))},getLogMessage:function(){var e=BX.Call.Util.getDateForLog();for(var t=0;t<arguments.length;t++){if(arguments[t]instanceof Error){e=arguments[t].message+"\n"+arguments[t].stack}else{try{e=e+" | "+(typeof arguments[t]=="object"?JSON.stringify(arguments[t]):arguments[t])}catch(t){e=e+" | (circular structure)"}}}return e},getUuidv4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=Math.random()*16|0,r=e=="x"?t:t&3|8;return r.toString(16)}))},alterSDP:function(e,r){if(!r){return}var a=e.split("\n");var n=[];var s=false;for(var i=0;i<a.length;i++){var u=a[i];s=s||(u.match(/m=video/)!==null?i:false);if(!s){continue}var o=/a=rtpmap:(\d+)\s(.+)/.exec(u);if(o){n.push({rtpmap:o[1],codec:o[2]})}}if(!s){return}a[s]=t(a[s],n,r);return a.join("\n")},reportConnectionResult:function(e,t){BX.ajax.runAction("im.call.reportConnection",{data:{callId:e,connectionResult:t}})},sendTelemetryEvent:function(e){var t=(document.location.protocol=="https:"?"https://":"http://")+"bitrix.info/bx_stat";var r=new XMLHttpRequest;r.open("POST",t,true);r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");r.withCredentials=true;e.op="call";e.d=document.location.host;var a=BX.util.buildQueryString(e);r.send(a)},isDesktop:function(){return typeof BXDesktopSystem!="undefined"||typeof BXDesktopWindow!="undefined"},getBrowserForStatistics:function(){if(BX.browser.IsOpera()){return"opera"}if(BX.browser.IsChrome()){return"chrome"}if(BX.browser.IsFirefox()){return"firefox"}if(BX.browser.IsSafari()){return"safari"}return"other"}};function t(e,t,r){debugger;var a=e.split(" ");var n=a.slice(3);var s={};t.forEach((function(e){s[e.rtpmap]=e.codec}));n.sort((function(e,t){e=e.trim();t=t.trim();var r=s[e];var a=s[t];if(r.substr(0,4)==="H264"&&a.substr(0,4)!=="H264"){return-1}else if(r.substr(0,4)!=="H264"&&a.substr(0,4)==="H264"){return 1}else{return e-t}}));var i=a.slice(0,3).concat(n);return i.join(" ")}function r(t){return typeof t!=="string"||t==""||t.endsWith(e)}function a(e){if(!e instanceof MediaStream){return}e.getTracks().forEach((function(e){e.stop()}))}})();
//# sourceMappingURL=util.map.js