{"version":3,"file":"lazyloadtotalcount.bundle.js","sources":["../src/lazyloadtotalcount.js"],"sourcesContent":["import { Tag, Loc, Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport './style.css';\n\nexport class Lazyloadtotalcount\n{\n\tregister(containerNode)\n\t{\n\t\tconst container = containerNode ?? document.body;\n\t\tcontainer.querySelectorAll('lazy-load-total-count:not([data-registered])').forEach((node) => {\n\t\t\tconst gridId = node.getAttribute('grid-id');\n\t\t\tDom.append(this.getCounterLabel(), node);\n\t\t\tDom.append(this.getCounterContainer(gridId), node);\n\n\t\t\tEventEmitter.subscribe('Grid::updated', (event) => {\n\t\t\t\tconst grid = event.compatData[0];\n\t\t\t\tif (grid.getId() === gridId)\n\t\t\t\t{\n\t\t\t\t\tthis.register(grid.getContainer());\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tnode.dataset.registered = true;\n\t\t});\n\t}\n\n\tgetCounterLabel(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<span class=\"main-pagination-lazyload-count_label\">\n\t\t\t\t${Loc.getMessage('MAIN_PAGE_NAVIGATION_TOTAL_COUNTER_AMOUNT')}: \n\t\t\t</span>\n\t\t`;\n\t}\n\n\tgetCounterContainer(gridId: string): HTMLElement\n\t{\n\t\tconst counter = Tag.render`<span class=\"main-pagination-lazyload-count_container\"></span>`;\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<a class=\"main-pagination-lazyload-count_counter\" onclick=\"${this.handleCounterClick.bind(this, gridId, counter)}\">\n\t\t\t\t\t${Loc.getMessage('MAIN_PAGE_NAVIGATION_TOTAL_COUNTER_SHOW_LINK')}\n\t\t\t\t</a>\n\t\t\t`,\n\t\t\tcounter,\n\t\t);\n\n\t\treturn counter;\n\t}\n\n\thandleCounterClick(gridId: string, counter: HTMLElement)\n\t{\n\t\tDom.clean(counter);\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<svg class=\"main-pagination-lazyload-count_loader\" viewBox=\"25 25 50 50\">\n\t\t\t\t\t<circle class=\"main-pagination-lazyload-count_loader-path\" r=\"20\" cx=\"50\" cy=\"50\" stroke-width=\"1\" stroke-miterlimit=\"10\" fill=\"none\"></circle>\n\t\t\t\t</svg>\n\t\t\t`,\n\t\t\tcounter,\n\t\t);\n\n\t\tconst grid = BX.Main.gridManager.getById(gridId)?.instance;\n\n\t\tif (grid)\n\t\t{\n\t\t\tgrid.getData().request('', null, null, 'get_total_rows_count', (response) => {\n\t\t\t\tconst res = JSON.parse(response);\n\t\t\t\tDom.clean(counter);\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<span class=\"main-pagination-lazyload-count_count\">${res.payload.totalCount}</span>`,\n\t\t\t\t\tcounter,\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n}\n"],"names":["Lazyloadtotalcount","register","containerNode","container","document","body","querySelectorAll","forEach","node","gridId","getAttribute","Dom","append","getCounterLabel","getCounterContainer","EventEmitter","subscribe","event","grid","compatData","getId","getContainer","dataset","registered","Tag","render","Loc","getMessage","counter","handleCounterClick","bind","clean","BX","Main","gridManager","getById","instance","getData","request","response","res","JSON","parse","payload","totalCount"],"mappings":";;;;;;;;;;;;AAAA,CAIO,MAAMA,kBAAkB,CAC/B;GACCC,QAAQ,CAACC,aAAa,EACtB;KACC,MAAMC,SAAS,GAAGD,aAAa,WAAbA,aAAa,GAAIE,QAAQ,CAACC,IAAI;KAChDF,SAAS,CAACG,gBAAgB,CAAC,8CAA8C,CAAC,CAACC,OAAO,CAAEC,IAAI,IAAK;OAC5F,MAAMC,MAAM,GAAGD,IAAI,CAACE,YAAY,CAAC,SAAS,CAAC;OAC3CC,aAAG,CAACC,MAAM,CAAC,IAAI,CAACC,eAAe,EAAE,EAAEL,IAAI,CAAC;OACxCG,aAAG,CAACC,MAAM,CAAC,IAAI,CAACE,mBAAmB,CAACL,MAAM,CAAC,EAAED,IAAI,CAAC;OAElDO,6BAAY,CAACC,SAAS,CAAC,eAAe,EAAGC,KAAK,IAAK;SAClD,MAAMC,IAAI,GAAGD,KAAK,CAACE,UAAU,CAAC,CAAC,CAAC;SAChC,IAAID,IAAI,CAACE,KAAK,EAAE,KAAKX,MAAM,EAC3B;WACC,IAAI,CAACR,QAAQ,CAACiB,IAAI,CAACG,YAAY,EAAE,CAAC;;QAEnC,CAAC;OAEFb,IAAI,CAACc,OAAO,CAACC,UAAU,GAAG,IAAI;MAC9B,CAAC;;GAGHV,eAAe,GACf;KACC,OAAOW,aAAG,CAACC,MAAM,cAAC;;MAEhB,CAA8D;;GAEhE,GAFIC,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;;GAKhEb,mBAAmB,CAACL,MAAc,EAClC;KACC,MAAMmB,OAAO,GAAGJ,aAAG,CAACC,MAAM,gBAAC,gEAA8D,EAAC;KAC1Fd,aAAG,CAACC,MAAM,CACTY,aAAG,CAACC,MAAM,gBAAC;iEACiD,CAAsD;OAChH,CAAiE;;IAEnE,GAH8D,IAAI,CAACI,kBAAkB,CAACC,IAAI,CAAC,IAAI,EAAErB,MAAM,EAAEmB,OAAO,CAAC,EAC7GF,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC,GAGlEC,OAAO,CACP;KAED,OAAOA,OAAO;;GAGfC,kBAAkB,CAACpB,MAAc,EAAEmB,OAAoB,EACvD;KAAA;KACCjB,aAAG,CAACoB,KAAK,CAACH,OAAO,CAAC;KAClBjB,aAAG,CAACC,MAAM,CACTY,aAAG,CAACC,MAAM,gBAAC;;;;IAIX,IACAG,OAAO,CACP;KAED,MAAMV,IAAI,4BAAGc,EAAE,CAACC,IAAI,CAACC,WAAW,CAACC,OAAO,CAAC1B,MAAM,CAAC,qBAAnC,sBAAqC2B,QAAQ;KAE1D,IAAIlB,IAAI,EACR;OACCA,IAAI,CAACmB,OAAO,EAAE,CAACC,OAAO,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,sBAAsB,EAAGC,QAAQ,IAAK;SAC5E,MAAMC,GAAG,GAAGC,IAAI,CAACC,KAAK,CAACH,QAAQ,CAAC;SAChC5B,aAAG,CAACoB,KAAK,CAACH,OAAO,CAAC;SAClBjB,aAAG,CAACC,MAAM,CACTY,aAAG,CAACC,MAAM,gBAAC,sDAAmD,CAAyB,SAAO,GAA9Be,GAAG,CAACG,OAAO,CAACC,UAAU,GACtFhB,OAAO,CACP;QACD,CAAC;;;CAGL;;;;;;;;"}