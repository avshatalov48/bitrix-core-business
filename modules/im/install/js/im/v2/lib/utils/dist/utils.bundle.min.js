this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i,r,n){"use strict";const a=navigator.userAgent.toLowerCase();const o={isChrome(){return n.Browser.isChrome()},isFirefox(){return n.Browser.isFirefox()},isIe(){return n.Browser.isIE()},isSafari(){if(this.isChrome()){return false}if(!a.includes("safari")){return false}return!this.isSafariBased()},isSafariBased(){if(!a.includes("applewebkit")){return false}return a.includes("yabrowser")||a.includes("yaapp_ios_browser")||a.includes("crios")},findParent(e,t){const s=t instanceof HTMLElement;if(!t||!n.Type.isString(t)&&!s){return null}for(;e&&e!==document;e=e.parentNode){if(n.Type.isString(t)){if(n.Dom.hasClass(t)){return e}}else if(s&&e===t){return e}}return null},openLink(e,t="_blank"){window.open(e,t,"",true);return true}};const c={cast(e,t=new Date){let s=t;if(e instanceof Date){s=e}else if(n.Type.isString(e)){s=new Date(e)}else if(n.Type.isNumber(e)){s=new Date(e*1e3)}if(s instanceof Date&&Number.isNaN(s.getTime())){s=t}return s},getTimeToNextMidnight(){const e=new Date((new Date).setHours(24,0,0)).getTime();return e-Date.now()},getStartOfTheDay(){return new Date((new Date).setHours(0,0))},isToday(e){return this.cast(e).toDateString()===(new Date).toDateString()}};const l=navigator.userAgent.toLowerCase();const u={isDesktop(){return!this.isMobile()},isMobile(){if(!n.Type.isUndefined(this.isMobileStatic)){return this.isMobileStatic}this.isMobileStatic=l.includes("android")||l.includes("webos")||l.includes("iphone")||l.includes("ipad")||l.includes("ipod")||l.includes("blackberry")||l.includes("windows phone");return this.isMobileStatic},orientationHorizontal:"horizontal",orientationPortrait:"portrait",getOrientation(){if(!this.isMobile()){return this.orientationHorizontal}return Math.abs(window.orientation)===0?this.orientationPortrait:this.orientationHorizontal}};const p=navigator.userAgent.toLowerCase();const g={isMac(){return n.Browser.isMac()},isLinux(){return n.Browser.isLinux()},isWindows(){return n.Browser.isWin()||!this.isMac()&&!this.isLinux()},isBitrixMobile(){return p.includes("bitrixmobile")},isBitrixDesktop(){return t.DesktopManager.isDesktop()},getDesktopVersion(){return t.DesktopManager.getInstance().getDesktopVersion()},isDesktopFeatureEnabled(e){return t.DesktopManager.getInstance().isDesktopFeatureEnabled(e)},isMobile(){return this.isAndroid()||this.isIos()||this.isBitrixMobile()},isIos(){return n.Browser.isIOS()},getIosVersion(){if(!this.isIos()){return null}const e=p.match(/(iphone|ipad)(.+)(OS\s([0-9]+)([_.]([0-9]+))?)/i);if(!e||!e[4]){return null}return parseFloat(e[4]+"."+(e[6]?e[6]:0))},isAndroid(){return n.Browser.isAndroid()},openNewPage(e){if(!e){return false}if(this.isBitrixMobile()){const t=window.BX.MobileTools;if(n.Type.isUndefined()){const s=t.resolveOpenFunction(e);if(s){s();return true}}window.app.openNewPage(e);return true}window.open(e,"_blank");return true}};const f={getLogTrackingParams(e={}){const t=[];let{name:s="tracking",data:i=[]}=e;const{dialog:r=null,message:a=null,files:o=null}=e;s=encodeURIComponent(s);if(n.Type.isPlainObject(i)){const e=[];for(const t in i){if(i.hasOwnProperty(t)){e.push(encodeURIComponent(t)+"="+encodeURIComponent(i[t]))}}i=e}else if(!n.Type.isArray(i)){i=[]}if(n.Type.isObjectLike(r)){t.push("timType="+r.type);if(r.type==="lines"){t.push("timLinesType="+r.entityId.split("|")[0])}}if(!n.Type.isNull(o)){let e="file";if(n.Type.isArray(o)&&o[0]){e=o[0].type}else if(n.Type.isObjectLike(o)){e=o.type}t.push("timMessageType="+e)}else if(!n.Type.isNull(a)){t.push("timMessageType=text")}if(g.isBitrixMobile()){t.push("timDevice=bitrixMobile")}else if(g.isBitrixDesktop()){t.push("timDevice=bitrixDesktop")}else if(g.isIos()||g.isAndroid()){t.push("timDevice=mobile")}else{t.push("timDevice=web")}return s+(i.length?"&"+i.join("&"):"")+(t.length?"&"+t.join("&"):"")}};const h={convertHtmlEntities(e){return n.Dom.create({tag:"span",html:e}).innerText},convertSnakeToCamelCase(e){return e.replace(/(_[a-z])/gi,(e=>e.toUpperCase().replace("_","")))},escapeRegex(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},getLocalizeForNumber(e,t,s="en"){let i=1;t=parseInt(t);if(t<0){t=t*-1}if(s){switch(s){case"de":case"en":i=t!==1?1:0;break;case"ru":case"ua":i=t%10===1&&t%100!==11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;break}}return n.Loc.getMessage(e+"_PLURAL_"+i)},getFirstLetters(e){const t=/[\p{L}\p{N} ]/u;const s=e.split(/[\s,]/).filter((e=>{const s=e.charAt(0);return t.test(s)}));if(s.length===0){return""}if(s.length>1){return s[0].charAt(0)+s[1].charAt(0)}return s[0].charAt(0)},insertUnseenWhitespace(e,t){if(e.length<=t){return e}const s="\u200b";let i=e.slice(0,t+1);const r=e.slice(t+1);const n=/\s/.test(i);const a=/\[user=(\d+)(\s)?(replace)?](.*?)\[\/user]/gi.test(e);if(i.length===t+1&&!n&&!a){i+=s}return i+r},getUuidV4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{var t=Math.random()*16|0,s=e=="x"?t:t&3|8;return s.toString(16)}))},isUuidV4(e){if(!n.Type.isString(e)){return false}const t=new RegExp(/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i);return e.search(t)===0},isTempMessage(e){return this.isUuidV4(e)||e.toString().startsWith("temp")},checkUrl(e){const t=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];const s=["/",...t].find((t=>e.startsWith(t)));if(!s){return false}const i=n.Dom.create({tag:"a",attrs:{href:e}});return t.indexOf(i.protocol)>-1},htmlspecialchars(e){return n.Text.encode(e)},htmlspecialcharsback(e){return n.Text.decode(e)}};const d=n.Extension.getSettings("im.v2.lib.utils");const m={getLastDateText(e={}){if(e.bot||e.network||!e.lastActivityDate){return""}const t=this.isOnline(e.lastActivityDate);const s=this.isMobileOnline(e.lastActivityDate,e.mobileLastDate);let r="";const a=this.getLastSeenText(e.lastActivityDate);if(t&&e.idle&&!s){r=n.Loc.getMessage("IM_STATUS_AWAY_TITLE").replace("#TIME#",this.getIdleText(e.idle))}else if(t&&!a){r=this.getStatusTextForLastDate(e.status)}else if(a){const t=`IM_LAST_SEEN_${e.gender}`;r=n.Loc.getMessage(t).replace("#POSITION#. ","").replace("#LAST_SEEN#",a)}if(e.absent){const t=n.Loc.getMessage("IM_STATUS_VACATION_TITLE").replace("#DATE#",i.DateFormatter.formatByCode(e.absent.getTime()/1e3,i.DateCode.shortDateFormat));r=r?`${r}. ${t}`:t}return r},getIdleText(e=""){if(!e){return""}return s.DateTimeFormat.format([["s60","sdiff"],["i60","idiff"],["H24","Hdiff"],["","ddiff"]],e)},isOnline(e){if(!e){return false}return Date.now()-e.getTime()<=this.getOnlineLimit()*1e3},isMobileOnline(e,t){if(!e||!t){return false}const s=5*60*1e3;return Date.now()-t.getTime()<this.getOnlineLimit()*1e3&&e-t<s},getStatusTextForLastDate(e){var t;e=e.toUpperCase();return(t=n.Loc.getMessage(`IM_STATUS_${e}`))!=null?t:e},getStatusText(e){var t;e=e.toUpperCase();return(t=n.Loc.getMessage(`IM_STATUS_TEXT_${e}`))!=null?t:e},getLastSeenText(e){if(!e){return""}const t=5*60*1e3;if(Date.now()-e.getTime()>t){return s.DateTimeFormat.formatLastActivityDate(e)}return""},isBirthdayToday(e){return e===s.DateTimeFormat.format("d-m",new Date)},getOnlineLimit(){const e=d.get("limitOnline",false);const t=15*60;return e?Number.parseInt(e,10):t},getProfileLink(e){if(n.Type.isString(e)){e=Number.parseInt(e,10)}return`/company/personal/user/${e}/`},getCalendarLink(e){if(n.Type.isString(e)){e=Number.parseInt(e,10)}const t=n.Extension.getSettings("im.v2.lib.utils").get("pathToUserCalendar");return t.replace("#user_id#",e)},getMentionBbCode(e,t){if(n.Type.isString(e)){e=Number.parseInt(e,10)}return`[USER=${e}]${t}[/USER]`}};const T={getFileExtension(e){return e.split(".").splice(-1)[0]},getIconTypeByFilename(e){const t=this.getFileExtension(e);return this.getIconTypeByExtension(t)},getIconTypeByExtension(e){let t="empty";switch(e.toString()){case"png":case"jpe":case"jpg":case"jpeg":case"gif":case"heic":case"bmp":case"webp":t="img";break;case"mp4":case"mkv":case"webm":case"mpeg":case"hevc":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"wmv":case"mov":t="mov";break;case"txt":t="txt";break;case"doc":case"docx":t="doc";break;case"xls":case"xlsx":t="xls";break;case"php":t="php";break;case"pdf":t="pdf";break;case"ppt":case"pptx":t="ppt";break;case"rar":t="rar";break;case"zip":case"7z":case"tar":case"gz":case"gzip":t="zip";break;case"set":t="set";break;case"conf":case"ini":case"plist":t="set";break}return t},getFileTypeByExtension(e){let t=r.FileType.file;switch(e){case"png":case"jpe":case"jpg":case"jpeg":case"gif":case"heic":case"bmp":case"webp":t=r.FileType.image;break;case"mp4":case"mkv":case"webm":case"mpeg":case"hevc":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"wmv":case"mov":t=r.FileType.video;break;case"mp3":t=r.FileType.audio;break}return t},formatFileSize(e){if(!e||e<=0){e=0}const t=["BYTE","KB","MB","GB","TB"];const s=1024;let i=0;while(e>=s&&i<t.length-1){e/=s;i++}const r=n.Loc.getMessage(`IM_UTILS_FILE_SIZE_${t[i]}`);const a=Math.round(e);return`${a} ${r}`},getShortFileName(e,t){if(!e||e.length<t){return e}const s=1;const i=10;const r=this.getFileExtension(e);const n=r.length+s+i;const a=e.slice(-n);const o=e.slice(0,t-a.length-s*3);return`${o.trim()}...${a.trim()}`},getViewerDataAttributes(e){if(!e){return{}}const t={"data-viewer":true};Object.entries(e).forEach((([e,s])=>{t[`data-${n.Text.toKebabCase(e)}`]=s}));return t},isImage(e){const t=T.getFileExtension(e);const s=T.getFileTypeByExtension(t);return s===r.FileType.image}};const b="Key";const x="Digit";const y="Ctrl";const w="Alt";const D="Shift";const M=new Set([y,w,D]);const S={isCmdOrCtrl(e){if(g.isMac()){return e.metaKey}if(g.isLinux()||g.isWindows()){return e.ctrlKey}return false},isAltOrOption(e){return e.altKey},isCombination(e,t){if(n.Type.isString(t)){t=[t]}return t.some((t=>k(e,t)))}};function k(e,t){if(t.includes(D)&&!e.shiftKey){return false}if(t.includes(w)&&!e.altKey){return false}if(t.includes(y)&&!this.isCmdOrCtrl(e)){return false}const s=t.split("+").filter((e=>!M.has(e))).map((e=>{const t=/^[A-Za-z]$/;const s=/^\d$/;if(t.test(e)){return`${b}${e.toUpperCase()}`}else if(s.test(e)){return`${x}${e}`}return e}));let i=true;s.forEach((t=>{if(t!==e.code){i=false}}));return i}const L={recursiveBackwardNodeSearch(e,t,s=10){while(s>0){if(n.Dom.hasClass(e,t)){return e}if(!e||!e.parentNode){return null}e=e.parentNode;s--}return null}};const v={isDialogId(e){return/(chat\d+)|\d+/i.test(e)}};const B={browser:o,date:c,device:u,platform:g,rest:f,text:h,user:m,file:T,dom:L,key:S,dialog:v};e.Utils=B})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Lib,BX.Main,BX.Im.V2.Lib,BX.Messenger.v2.Const,BX);
//# sourceMappingURL=utils.bundle.map.js