{"version":3,"file":"search-result.bundle.js","sources":["../src/classes/search-utils.js","../src/classes/search-item.js","../src/classes/search-config.js","../src/classes/store-updater.js","../src/classes/layout-manager.js","../src/classes/sorting-result.js","../src/classes/entity-services/recent-state-search-service.js","../src/classes/indexed-db-connection.js","../src/classes/entity-services/indexed-db-search-service.js","../src/classes/entity-services/base-server-search-service.js","../src/classes/entity-services/network-search-service.js","../src/classes/entity-services/department-search-service.js","../src/classes/search-service.js","../src/classes/search-context-menu.js","../src/components/carousel-user.js","../src/components/recent-users-carousel.js","../src/components/search-result-section.js","../src/components/search-result-network-item.js","../src/components/search-result-item.js","../src/components/search-result-department-item.js","../src/search-result.js"],"sourcesContent":["import {SearchEntityIdTypes} from 'im.v2.const';\nimport {SearchItem} from './search-item';\nimport {Type} from 'main.core';\n\nexport const SearchUtils = {\n\tgetWordsFromString(string: string): Array<string>\n\t{\n\t\tconst clearedString = string\n\t\t\t.replaceAll('(', ' ')\n\t\t\t.replaceAll(')', ' ')\n\t\t\t.replaceAll('[', ' ')\n\t\t\t.replaceAll(']', ' ')\n\t\t\t.replaceAll('{', ' ')\n\t\t\t.replaceAll('}', ' ')\n\t\t\t.replaceAll('<', ' ')\n\t\t\t.replaceAll('>', ' ')\n\t\t\t.replaceAll('-', ' ')\n\t\t\t.replaceAll('#', ' ')\n\t\t\t.replaceAll('\"', ' ')\n\t\t\t.replaceAll('\\'', ' ')\n\t\t\t.replace(/\\s\\s+/g, ' ')\n\t\t;\n\n\t\treturn clearedString.split(' ').filter(word => word !== '');\n\t},\n\n\tgetTypeByEntityId(entityId: string): string\n\t{\n\t\tswitch (entityId)\n\t\t{\n\t\t\tcase SearchEntityIdTypes.user:\n\t\t\tcase SearchEntityIdTypes.bot:\n\t\t\t\treturn 'user';\n\t\t\tcase SearchEntityIdTypes.chat:\n\t\t\tcase SearchEntityIdTypes.chatUser:\n\t\t\t\treturn 'chat';\n\t\t\tcase SearchEntityIdTypes.department:\n\t\t\t\treturn 'department';\n\t\t\tcase SearchEntityIdTypes.network:\n\t\t\t\treturn 'network';\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unknown entity id: ${entityId}`);\n\t\t}\n\t},\n\n\tcreateItemMap(items: Array): Map<string, SearchItem>\n\t{\n\t\tconst map = new Map();\n\n\t\titems.forEach(item => {\n\t\t\tconst mapItem = new SearchItem(item);\n\t\t\tmap.set(mapItem.getEntityFullId(), mapItem);\n\t\t});\n\n\t\treturn map;\n\t},\n\n\tgetFirstItemFromMap(map: Map<string, SearchItem>): SearchItem\n\t{\n\t\tconst iterator = map.entries();\n\t\tconst firstIteration = iterator.next();\n\t\tconst firstItem = firstIteration.value;\n\t\tconst [, content] = firstItem;\n\n\t\treturn content;\n\t},\n\n\tconvertKeysToLowerCase(object: Object): Object\n\t{\n\t\tconst result = {};\n\t\tObject.keys(object).forEach(key => {\n\t\t\tif (Type.isObject(object[key]) && !Type.isArray(object[key]))\n\t\t\t{\n\t\t\t\tresult[key.toLowerCase()] = this.convertKeysToLowerCase(object[key]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult[key.toLowerCase()] = object[key];\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t},\n\n\tconvertKeysToUpperCase(object: Object): Object\n\t{\n\t\tconst result = {};\n\t\tObject.keys(object).forEach(key => {\n\t\t\tif (Type.isObject(object[key]) && !Type.isArray(object[key]))\n\t\t\t{\n\t\t\t\tresult[key.toUpperCase()] = this.convertKeysToUpperCase(object[key]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult[key.toUpperCase()] = object[key];\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t},\n\n\tprepareRecentItems(recentItems: Array<string, number>): Array<Object>\n\t{\n\t\tif (!recentItems)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\treturn recentItems.map(item => {\n\t\t\tconst [entityId, id] = item;\n\t\t\tconst type = SearchUtils.getTypeByEntityId(entityId);\n\n\t\t\treturn {\n\t\t\t\tcacheId: `${type}|${id}`,\n\t\t\t\tdate: new Date(),\n\t\t\t};\n\t\t});\n\t}\n};","import {Type} from 'main.core';\nimport {SearchEntityIdTypes, DialogType} from 'im.v2.const';\nimport {SearchUtils} from './search-utils';\n\nexport class SearchItem\n{\n\tid: number | string;\n\tentityId: $Values<typeof SearchEntityIdTypes>;\n\tentityType: ?string = null;\n\tdialogId: string = null;\n\ttitle: ?string = null;\n\tsubtitle: ?string = null;\n\tname: ?string = null;\n\tlastName: ?string = null;\n\tsecondName: ?string = null;\n\tposition: ?string = null;\n\tavatar: ?string = null;\n\tavatarOptions: ?Object = null;\n\tcustomSort: number = 0;\n\tcontextSort: number = 0;\n\tfromStore: boolean = false;\n\trawData: ?Object = null;\n\n\tconstructor(itemOptions)\n\t{\n\t\tthis.#setRawData(itemOptions);\n\t\tthis.#setId(itemOptions);\n\t\tthis.#setDialogId(itemOptions);\n\t\tthis.#setEntityId(itemOptions);\n\t\tthis.#setEntityType(itemOptions);\n\t\tthis.#setTitle(itemOptions);\n\t\tthis.#setSubtitle(itemOptions);\n\t\tthis.#setName(itemOptions);\n\t\tthis.#setLastName(itemOptions);\n\t\tthis.#setSecondName(itemOptions);\n\t\tthis.#setPosition(itemOptions);\n\t\tthis.#setAvatar(itemOptions);\n\t\tthis.#setAvatarOptions(itemOptions);\n\t\tthis.#setContextSort(itemOptions);\n\t}\n\n\t#isFromProviderResponse(itemOptions: Object): boolean\n\t{\n\t\treturn Type.isString(itemOptions.entityId) && !Type.isNil(itemOptions.id);\n\t}\n\n\tisFromModel(itemOptions: Object): boolean\n\t{\n\t\treturn Type.isString(itemOptions.dialogId) && Type.isObject(itemOptions.dialog);\n\t}\n\n\t#setId(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.id = itemOptions.id;\n\t\t}\n\t\telse if (this.isFromModel(itemOptions))\n\t\t{\n\t\t\tconst id = itemOptions.dialogId.startsWith('chat') ? itemOptions.dialogId.slice(4) : itemOptions.dialogId;\n\t\t\tthis.id = Number.parseInt(id, 10);\n\t\t\tthis.fromStore = true;\n\t\t}\n\t}\n\n\t#setDialogId(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tif (itemOptions.customData?.imChat?.ID > 0)\n\t\t\t{\n\t\t\t\tthis.dialogId = `chat${itemOptions.customData.imChat.ID}`;\n\t\t\t}\n\t\t\telse if (itemOptions.customData?.imUser?.ID > 0)\n\t\t\t{\n\t\t\t\tthis.dialogId = itemOptions.customData.imUser.ID.toString();\n\t\t\t}\n\t\t}\n\t\telse if (this.isFromModel(itemOptions))\n\t\t{\n\t\t\tthis.dialogId = itemOptions.dialogId;\n\t\t}\n\t}\n\n\t#setEntityId(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.entityId = itemOptions.entityId;\n\t\t}\n\t\telse if (this.isFromModel(itemOptions))\n\t\t{\n\t\t\tif (!itemOptions.user)\n\t\t\t{\n\t\t\t\tthis.entityId = SearchEntityIdTypes.chat;\n\t\t\t}\n\t\t\telse if (itemOptions.user.bot)\n\t\t\t{\n\t\t\t\tthis.entityId = SearchEntityIdTypes.bot;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.entityId = SearchEntityIdTypes.user;\n\t\t\t}\n\t\t}\n\t}\n\n\t#setEntityType(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.entityType = itemOptions.entityType ? itemOptions.entityType.toLowerCase() : '';\n\t\t}\n\t\telse if (this.isFromModel(itemOptions))\n\t\t{\n\t\t\tconst {type} = itemOptions.dialog;\n\n\t\t\tif (type === DialogType.user)\n\t\t\t{\n\t\t\t\tthis.entityType = itemOptions.user.extranet ? 'extranet' : 'employee';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.entityType = type;\n\t\t\t}\n\t\t}\n\t}\n\n\t#setTitle(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.title = itemOptions.title;\n\t\t}\n\t\telse if (this.isFromModel(itemOptions))\n\t\t{\n\t\t\tthis.title = itemOptions.dialog.name;\n\t\t}\n\t}\n\n\t#setSubtitle(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.subtitle = itemOptions.subtitle;\n\t\t}\n\t}\n\n\t#setName(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.name = itemOptions.customData?.name;\n\t\t}\n\t\telse if (this.isFromModel(itemOptions))\n\t\t{\n\t\t\tthis.name = itemOptions.user?.firstName;\n\t\t}\n\t}\n\n\t#setLastName(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.lastName = itemOptions.customData?.lastName;\n\t\t}\n\t\telse if (this.isFromModel(itemOptions))\n\t\t{\n\t\t\tthis.lastName = itemOptions.user?.lastName;\n\t\t}\n\t}\n\n\t#setSecondName(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.secondName = itemOptions.customData?.secondName;\n\t\t}\n\t}\n\n\t#setPosition(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.position = itemOptions.customData?.position;\n\t\t}\n\t\telse if (this.isFromModel(itemOptions))\n\t\t{\n\t\t\tthis.position = itemOptions.user?.workPosition;\n\t\t}\n\t}\n\n\t#setAvatar(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.avatar = itemOptions.avatar !== '' ? itemOptions.avatar : null;\n\t\t}\n\t\telse if (this.isFromModel(itemOptions))\n\t\t{\n\t\t\tconst avatar = itemOptions.user ? itemOptions.user.avatar : itemOptions.dialog.avatar;\n\t\t\tthis.avatar = avatar !== '' ? decodeURI(avatar) : null;\n\t\t}\n\t}\n\n\t#setAvatarOptions(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.avatarOptions = itemOptions.avatarOptions;\n\t\t}\n\t}\n\n\t#setContextSort(itemOptions: Object)\n\t{\n\t\tif (this.#isFromProviderResponse(itemOptions))\n\t\t{\n\t\t\tthis.contextSort = itemOptions.contextSort;\n\t\t}\n\t}\n\n\t#setRawData(itemOptions: Object)\n\t{\n\t\tthis.rawData = itemOptions;\n\t}\n\n\tgetId(): number | string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetEntityId(): string\n\t{\n\t\treturn this.entityId;\n\t}\n\n\tgetEntityType(): ?string\n\t{\n\t\treturn this.entityType.toLowerCase();\n\t}\n\n\tgetEntityFullId(): string\n\t{\n\t\tconst type = SearchUtils.getTypeByEntityId(this.entityId);\n\n\t\treturn `${type}|${this.id}`;\n\t}\n\n\tgetTitle(): ?string\n\t{\n\t\treturn this.title;\n\t}\n\n\tgetSubtitle(): ?string\n\t{\n\t\treturn this.subtitle;\n\t}\n\n\tgetName(): ?string\n\t{\n\t\treturn this.name;\n\t}\n\n\tgetLastName(): ?string\n\t{\n\t\treturn this.lastName;\n\t}\n\n\tgetSecondName(): ?string\n\t{\n\t\treturn this.secondName;\n\t}\n\n\tgetPosition(): ?string\n\t{\n\t\treturn this.position;\n\t}\n\n\tgetCustomData(): ?Object\n\t{\n\t\treturn this.rawData.customData;\n\t}\n\n\tgetDialogId(): string\n\t{\n\t\treturn this.dialogId;\n\t}\n\n\tgetAvatar(): ?string\n\t{\n\t\treturn this.avatar;\n\t}\n\n\tgetAvatarOptions()\n\t{\n\t\treturn this.avatarOptions;\n\t}\n\n\tgetContextSort(): number\n\t{\n\t\treturn this.contextSort ? this.contextSort : 0;\n\t}\n\n\taddCustomSort(value: number)\n\t{\n\t\tthis.customSort += value;\n\t}\n\n\tgetCustomSort(): number\n\t{\n\t\treturn this.customSort;\n\t}\n\n\tisUser(): boolean\n\t{\n\t\tif (this.#isFromProviderResponse(this.rawData))\n\t\t{\n\t\t\treturn !!this.rawData.customData?.imUser && this.rawData.customData.imUser.ID > 0;\n\t\t}\n\n\t\treturn !!this.rawData.user;\n\t}\n\n\tisChat(): boolean\n\t{\n\t\treturn [SearchEntityIdTypes.chat, SearchEntityIdTypes.chatUser].includes(this.getEntityId());\n\t}\n\n\tisExtranet(): boolean\n\t{\n\t\tif (this.#isFromProviderResponse(this.rawData))\n\t\t{\n\t\t\treturn !!this.rawData.customData?.imUser?.EXTRANET || !!this.rawData.customData?.imChat?.EXTRANET;\n\t\t}\n\t\telse if (this.isFromModel(this.rawData))\n\t\t{\n\t\t\treturn !!this.rawData.user?.extranet || !!this.rawData.dialog.extranet;\n\t\t}\n\t}\n\n\tgetUserCustomData()\n\t{\n\t\treturn this.rawData.customData?.imUser ? this.rawData.customData.imUser : null;\n\t}\n\n\tgetChatCustomData()\n\t{\n\t\treturn this.rawData.customData?.imChat ? this.rawData.customData.imChat : null;\n\t}\n\n\tisOpeLinesType(): boolean\n\t{\n\t\treturn this.getEntityType() === 'lines';\n\t}\n\n\tisDepartmentType(): boolean\n\t{\n\t\treturn this.getEntityId() === SearchEntityIdTypes.department;\n\t}\n\n\tisNetworkType(): boolean\n\t{\n\t\treturn this.getEntityId() === SearchEntityIdTypes.network;\n\t}\n\n\tgetOpenlineEntityId(): string\n\t{\n\t\tif (!this.isOpeLinesType())\n\t\t{\n\t\t\treturn '';\n\t\t}\n\t\tconst entityId = this.rawData.customData?.imChat?.ENTITY_ID;\n\n\t\treturn entityId.toString().split('|')[0];\n\t}\n\n\tgetAvatarColor(): string\n\t{\n\t\tlet color = '';\n\t\tif (this.#isFromProviderResponse(this.rawData))\n\t\t{\n\t\t\tif (this.isUser())\n\t\t\t{\n\t\t\t\tcolor = this.rawData.customData?.imUser?.COLOR?.toString();\n\t\t\t}\n\t\t\telse if (this.isChat())\n\t\t\t{\n\t\t\t\tcolor = this.rawData.customData?.imChat?.COLOR?.toString();\n\t\t\t}\n\t\t}\n\t\telse if (this.isFromModel(this.rawData))\n\t\t{\n\t\t\tcolor = this.rawData.dialog.color.toString();\n\t\t}\n\n\t\treturn color;\n\t}\n\n\tisCrmSession()\n\t{\n\t\tif (this.#isFromProviderResponse(this.rawData) && this.isOpeLinesType())\n\t\t{\n\t\t\tconst sessionData = this.rawData.customData?.imChat?.ENTITY_DATA_1.toString().split('|');\n\n\t\t\treturn sessionData[0] === 'Y';\n\t\t}\n\n\t\treturn false;\n\t}\n}","import {Type, Extension} from 'main.core';\n\nimport {Core} from 'im.v2.application.core';\n\nimport {SearchItem} from './search-item';\n\nexport type SearchConfig = {\n\tcurrentUser: boolean,\n\texcludeUsers: [],\n\textranet: boolean,\n\tchats: boolean,\n\tbots: boolean,\n\tdepartments: boolean,\n\tnetwork: boolean,\n};\n\ntype EntitySelectorProviderEntity = {\n\tid: string,\n\toptions: Object,\n\tdynamicLoad: boolean,\n\tdynamicSearch: boolean,\n};\n\ntype EntitySelectorRequestConfig = {\n\tdialog: {\n\t\tentities: EntitySelectorProviderEntity[],\n\t\tpreselectedItems: [],\n\t\tclearUnavailableItems: boolean,\n\t\tcontext: string,\n\t\tid: string,\n\t}\n};\n\nconst CHAT_TYPE_OPEN = 'O';\nconst CHAT_TYPE_PRIVATE = 'C';\n\nexport class Config\n{\n\t#config: SearchConfig = {};\n\t#store: Object;\n\t#currentUserId: number;\n\t#settings: Object;\n\t#networkSearchButtonClicked: boolean = false;\n\n\tconstructor(config: SearchConfig)\n\t{\n\t\tthis.#config = {...this.#getDefaultConfig(), ...config};\n\t\tthis.#store = Core.getStore();\n\t\tthis.#settings = Extension.getSettings('im.v2.component.search.search-result');\n\t\tthis.#currentUserId = Core.getUserId();\n\t}\n\n\tgetRecentRequestConfig(): EntitySelectorRequestConfig\n\t{\n\t\tconst entities = [this.#getUserEntity(), this.#getChatEntity(), this.#getBotsEntity(), this.#getChatUserEntity()];\n\n\t\treturn this.#get(entities);\n\t}\n\n\tgetSearch(): EntitySelectorRequestConfig\n\t{\n\t\tconst entities = [this.#getUserEntity(), this.#getChatEntity(), this.#getBotsEntity(), this.#getChatUserEntity(),\n\t\t\tthis.#getDepartmentEntity(), this.#getNetworkEntity()\n\t\t];\n\n\t\treturn this.#get(entities);\n\t}\n\n\tgetDepartmentUsers(): EntitySelectorRequestConfig\n\t{\n\t\tconst entities = [this.#getUserEntity(), this.#getBotsEntity(), this.#getDepartmentEntity()];\n\n\t\treturn this.#get(entities);\n\t}\n\n\tgetNetwork(): EntitySelectorRequestConfig\n\t{\n\t\tconst entities = [this.#getNetworkEntity()];\n\n\t\treturn this.#get(entities);\n\t}\n\n\tenableNetworkSearch(): void\n\t{\n\t\tthis.#networkSearchButtonClicked = true;\n\t}\n\n\tdisableNetworkSearch(): void\n\t{\n\t\tthis.#networkSearchButtonClicked = false;\n\t}\n\n\tisItemAllowed(item: SearchItem): boolean\n\t{\n\t\tif (item.isUser() && item.isExtranet() && !this.#needExtranet())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (item.isNetworkType() && !this.#needNetwork())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (item.isChat() && !this.#needChats())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (item.isUser() && !this.#needCurrentUser() && item.getId() === this.#currentUserId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tisNetworkAvailable(): boolean\n\t{\n\t\treturn this.#settings.get('isNetworkAvailable', false) && this.#config.network;\n\t}\n\n\t#get(entities: EntitySelectorProviderEntity[])\n\t{\n\t\tentities = entities.filter((entity: ?EntitySelectorProviderEntity) => !Type.isNil(entity));\n\n\t\treturn {\n\t\t\tdialog: {\n\t\t\t\tentities: entities,\n\t\t\t\tpreselectedItems: [],\n\t\t\t\tclearUnavailableItems: false,\n\t\t\t\tcontext: 'IM_CHAT_SEARCH',\n\t\t\t\tid: 'im-search',\n\t\t\t}\n\t\t};\n\t}\n\n\t#getBotsEntity(): ?EntitySelectorProviderEntity\n\t{\n\t\tif (!this.#needBots())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'im-bot',\n\t\t\toptions: {\n\t\t\t\tsearchableBotTypes: [\n\t\t\t\t\t'H',\n\t\t\t\t\t'B',\n\t\t\t\t\t'S',\n\t\t\t\t\t'N',\n\t\t\t\t],\n\t\t\t\tfillDialogWithDefaultValues: false,\n\t\t\t},\n\t\t\tdynamicLoad: true,\n\t\t\tdynamicSearch: true,\n\t\t};\n\t}\n\n\t#getUserEntity(): EntitySelectorProviderEntity\n\t{\n\t\treturn {\n\t\t\tid: 'user',\n\t\t\tdynamicLoad: true,\n\t\t\tdynamicSearch: true,\n\t\t\tfilters: [\n\t\t\t\t{\n\t\t\t\t\tid: 'im.userDataFilter'\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n\n\t#getChatUserEntity(): ?EntitySelectorProviderEntity\n\t{\n\t\tif (!this.#needChats())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'im-chat-user',\n\t\t\toptions: {\n\t\t\t\tsearchableChatTypes: [CHAT_TYPE_OPEN, CHAT_TYPE_PRIVATE],\n\t\t\t\tfillDialogWithDefaultValues: false,\n\t\t\t},\n\t\t\tdynamicLoad: true,\n\t\t\tdynamicSearch: true,\n\t\t};\n\t}\n\n\t#getNetworkEntity(): ?EntitySelectorProviderEntity\n\t{\n\t\tif (!this.#needNetwork())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'imbot-network',\n\t\t\tdynamicSearch: true,\n\t\t\toptions: {\n\t\t\t\t'filterExistingLines': true,\n\t\t\t}\n\t\t};\n\t}\n\n\t#getDepartmentEntity(): ?EntitySelectorProviderEntity\n\t{\n\t\tif (!this.#needDepartments)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'department',\n\t\t\tdynamicLoad: true,\n\t\t\tdynamicSearch: true,\n\t\t\toptions: {\n\t\t\t\tselectMode: 'usersAndDepartments',\n\t\t\t\tallowSelectRootDepartment: true,\n\t\t\t},\n\t\t\tfilters: [\n\t\t\t\t{\n\t\t\t\t\tid: 'im.departmentDataFilter'\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n\n\t#getChatEntity(): EntitySelectorProviderEntity\n\t{\n\t\tif (!this.#needChats())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'im-chat',\n\t\t\toptions: {\n\t\t\t\tsearchableChatTypes: [CHAT_TYPE_PRIVATE, CHAT_TYPE_OPEN],\n\t\t\t\tfillDialogWithDefaultValues: false,\n\t\t\t},\n\t\t\tdynamicLoad: true,\n\t\t\tdynamicSearch: true,\n\t\t};\n\t}\n\n\t#needChats(): boolean\n\t{\n\t\treturn this.#config.chats;\n\t}\n\n\t#needBots(): boolean\n\t{\n\t\treturn this.#config.bots;\n\t}\n\n\t#needNetwork(): boolean\n\t{\n\t\treturn this.#networkSearchButtonClicked && this.isNetworkAvailable();\n\t}\n\n\t#needDepartments(): boolean\n\t{\n\t\tif (this.#isCurrentUserExtranet() || !this.#isDepartmentsAvailable())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.#config.departments;\n\t}\n\n\t#isDepartmentsAvailable(): boolean\n\t{\n\t\treturn this.#settings.get('isDepartmentsAvailable', false);\n\t}\n\n\t#needExtranet(): boolean\n\t{\n\t\treturn this.#config.extranet;\n\t}\n\n\t#needCurrentUser(): boolean\n\t{\n\t\treturn this.#config.currentUser;\n\t}\n\n\t#isCurrentUserExtranet(): boolean\n\t{\n\t\tconst user = this.#store.getters['users/get'](this.#currentUserId, true);\n\n\t\treturn user.extranet;\n\t}\n\n\t#getDefaultConfig(): SearchConfig\n\t{\n\t\treturn {\n\t\t\tcurrentUser: true,\n\t\t\texcludeUsers: [],\n\t\t\textranet: true,\n\t\t\tchats: true,\n\t\t\tbots: true,\n\t\t\tdepartments: true,\n\t\t\tnetwork: true,\n\t\t};\n\t}\n}","import {Core} from 'im.v2.application.core';\nimport {UserManager} from 'im.v2.lib.user';\nimport {SearchItem} from './search-item';\nimport {SearchUtils} from './search-utils';\n\nexport class StoreUpdater\n{\n\t#store: Object;\n\t#userManager: UserManager;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#userManager = new UserManager();\n\t}\n\n\tupdate(updateConfig: {items: Map<string, SearchItem>, onlyAdd: boolean}): Promise\n\t{\n\t\tconst {items, onlyAdd} = updateConfig;\n\t\tconst {users, dialogues} = this.#prepareDataForModels(items);\n\n\t\tif (onlyAdd)\n\t\t{\n\t\t\tconst cleanedUsers = this.#removeActivityData(users);\n\n\t\t\treturn Promise.all([\n\t\t\t\tthis.#userManager.addUsersToModel(cleanedUsers),\n\t\t\t\tthis.#addDialoguesToModel(dialogues)\n\t\t\t]);\n\t\t}\n\n\t\treturn Promise.all([\n\t\t\tthis.#userManager.setUsersToModel(users),\n\t\t\tthis.#setDialoguesToModel(dialogues)\n\t\t]);\n\t}\n\n\t#addDialoguesToModel(dialogues): Promise\n\t{\n\t\treturn this.#store.dispatch('dialogues/add', dialogues);\n\t}\n\n\t#setDialoguesToModel(dialogues): Promise\n\t{\n\t\treturn this.#store.dispatch('dialogues/set', dialogues);\n\t}\n\n\t#removeActivityData(users: Object[])\n\t{\n\t\treturn users.map(user => {\n\t\t\treturn {\n\t\t\t\t...user,\n\t\t\t\tlast_activity_date: false,\n\t\t\t\tmobile_last_date: false,\n\t\t\t\tstatus: '',\n\t\t\t\tidle: false,\n\t\t\t\tabsent: false,\n\t\t\t\tbirthday: ''\n\t\t\t};\n\t\t});\n\t}\n\n\t#prepareDataForModels(items: Map<string, SearchItem>): { users: Array<Object>, dialogues: Array<Object> }\n\t{\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\tdialogues: [],\n\t\t};\n\n\t\titems.forEach(item => {\n\t\t\tif (!item.getCustomData() || item.fromStore)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (item.isUser())\n\t\t\t{\n\t\t\t\tconst preparedUser = SearchUtils.convertKeysToLowerCase(item.getUserCustomData());\n\t\t\t\tresult.users.push(preparedUser);\n\t\t\t}\n\n\t\t\tif (item.isChat() && !item.isOpeLinesType())\n\t\t\t{\n\t\t\t\tconst chat = SearchUtils.convertKeysToLowerCase(item.getChatCustomData());\n\n\t\t\t\tresult.dialogues.push({\n\t\t\t\t\t...chat,\n\t\t\t\t\tdialogId: `chat${chat.id}`\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n}","import {Core} from 'im.v2.application.core';\n\nexport class LayoutManager\n{\n\t#store: Object;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tchangeLayout(query: string): string\n\t{\n\t\tif (this.#isRussianInterface() && BX.correctText)\n\t\t{\n\t\t\t// eslint-disable-next-line bitrix-rules/no-bx\n\t\t\treturn BX.correctText(query, {replace_way: 'AUTO'});\n\t\t}\n\n\t\treturn query;\n\t}\n\n\tneedLayoutChange(originalLayoutQuery: string): boolean\n\t{\n\t\tconst wrongLayoutQuery = this.changeLayout(originalLayoutQuery);\n\t\tconst isIdenticalQuery = wrongLayoutQuery === originalLayoutQuery;\n\n\t\treturn this.#isRussianInterface() && !isIdenticalQuery;\n\t}\n\n\t#isRussianInterface(): boolean\n\t{\n\t\treturn Core.getLanguageId() === 'ru';\n\t}\n}","import {SearchItem} from './search-item';\nimport {SearchEntityIdTypes} from 'im.v2.const';\nimport {SearchUtils} from './search-utils';\nimport {Core} from 'im.v2.application.core';\nimport {LayoutManager} from './layout-manager';\n\nexport class SortingResult\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.layoutManager = new LayoutManager();\n\t}\n\n\tsortItemsByEntityIdAndContextSort(items: Map<string, SearchItem>): Map<string, SearchItem>\n\t{\n\t\tconst entityWeight = {\n\t\t\t'user': 100,\n\t\t\t'im-chat': 80,\n\t\t\t'im-chat-user': 80,\n\t\t\t'im-bot': 70,\n\t\t\t'department': 60,\n\t\t\t'extranet': 10,\n\t\t};\n\n\t\treturn new Map([...items.entries()].sort((firstItem, secondItem) => {\n\t\t\tconst [, firstItemValue] = firstItem;\n\t\t\tconst [, secondItemValue] = secondItem;\n\n\t\t\tconst secondItemEntityId = secondItemValue.isExtranet() ? 'extranet' : secondItemValue.getEntityId();\n\t\t\tconst firstItemEntityId = firstItemValue.isExtranet() ? 'extranet' : firstItemValue.getEntityId();\n\n\t\t\tif (entityWeight[secondItemEntityId] < entityWeight[firstItemEntityId])\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (entityWeight[secondItemEntityId] > entityWeight[firstItemEntityId])\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn secondItemValue.getContextSort() - firstItemValue.getContextSort();\n\t\t\t}\n\t\t}));\n\t}\n\n\tallocateSearchResults(items: Map<string, SearchItem>, originalLayoutQuery: string): Object\n\t{\n\t\tconst usersAndChats = new Map();\n\t\tconst chatUsers = new Map();\n\t\tconst departments = new Map();\n\t\tconst openLines = new Map();\n\t\tconst network = new Map();\n\n\t\titems.forEach(item => {\n\t\t\tswitch (item.getEntityId())\n\t\t\t{\n\t\t\t\tcase SearchEntityIdTypes.chatUser:\n\t\t\t\t{\n\t\t\t\t\tchatUsers.set(item.getEntityFullId(), item);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase SearchEntityIdTypes.department:\n\t\t\t\t{\n\t\t\t\t\tdepartments.set(item.getEntityFullId(), item);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase SearchEntityIdTypes.network:\n\t\t\t\t{\n\t\t\t\t\tnetwork.set(item.getEntityFullId(), item);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t{\n\t\t\t\t\tif (item.isOpeLinesType())\n\t\t\t\t\t{\n\t\t\t\t\t\topenLines.set(item.getEntityFullId(), item);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tusersAndChats.set(item.getEntityFullId(), item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tusersAndChats: this.getSortedItems(usersAndChats, originalLayoutQuery),\n\t\t\tchatUsers: chatUsers,\n\t\t\tdepartments: departments,\n\t\t\topenLines: openLines,\n\t\t\tnetwork: network\n\t\t};\n\t}\n\n\tsortItemsBySearchField(items: Map<string, SearchItem>, originalLayoutQuery: string): Map<string, SearchItem>\n\t{\n\t\tlet queryWords = SearchUtils.getWordsFromString(originalLayoutQuery);\n\t\tif (this.layoutManager.needLayoutChange(originalLayoutQuery))\n\t\t{\n\t\t\tconst wrongLayoutQueryWords = SearchUtils.getWordsFromString(this.layoutManager.changeLayout(originalLayoutQuery));\n\t\t\tqueryWords = [...queryWords, ...wrongLayoutQueryWords];\n\t\t}\n\t\tconst uniqueWords = [...new Set(queryWords)];\n\n\t\tconst searchFieldsWeight = {\n\t\t\ttitle: 10_000,\n\t\t\tname: 1000,\n\t\t\tlastName: 100,\n\t\t\tposition: 1,\n\t\t};\n\n\t\titems.forEach(item => {\n\t\t\tuniqueWords.forEach(word => {\n\t\t\t\tif (item.getTitle().toLowerCase().startsWith(word))\n\t\t\t\t{\n\t\t\t\t\titem.addCustomSort(searchFieldsWeight.title);\n\t\t\t\t}\n\t\t\t\telse if (item.getName()?.toLowerCase().startsWith(word))\n\t\t\t\t{\n\t\t\t\t\titem.addCustomSort(searchFieldsWeight.name);\n\t\t\t\t}\n\t\t\t\telse if (item.getLastName()?.toLowerCase().startsWith(word))\n\t\t\t\t{\n\t\t\t\t\titem.addCustomSort(searchFieldsWeight.lastName);\n\t\t\t\t}\n\t\t\t\telse if (item.getPosition()?.toLowerCase().startsWith(word))\n\t\t\t\t{\n\t\t\t\t\titem.addCustomSort(searchFieldsWeight.position);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn new Map([...items.entries()].sort((firstItem, secondItem) => {\n\t\t\tconst [, firstItemValue] = firstItem;\n\t\t\tconst [, secondItemValue] = secondItem;\n\n\t\t\treturn secondItemValue.getCustomSort() - firstItemValue.getCustomSort();\n\t\t}));\n\t}\n\n\tgetSortedItems(items: Map<string, SearchItem>, originalLayoutQuery: string): Map<string, SearchItem>\n\t{\n\t\tlet sortedItems = this.sortItemsBySearchField(items, originalLayoutQuery);\n\t\tsortedItems = this.sortItemsByEntityIdAndContextSort(sortedItems);\n\n\t\treturn sortedItems;\n\t}\n}","import {Core} from 'im.v2.application.core';\nimport {DialogType} from 'im.v2.const';\n\nimport {LayoutManager} from '../layout-manager';\nimport {SearchUtils} from '../search-utils';\n\nimport type {ImModelUser, ImModelDialog} from 'im.v2.model';\n\ntype RecentItem = {\n\tdialogId: string,\n\tuser: ImModelUser,\n\tdialog: ImModelDialog\n}\n\nconst collator = new Intl.Collator(undefined, {sensitivity: 'base'});\n\nexport class RecentStateSearchService\n{\n\t#store: Object;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.layoutManager = new LayoutManager();\n\t}\n\n\tload(): RecentItem[]\n\t{\n\t\tconst recentUsers = [];\n\t\tthis.#store.getters['recent/getSortedCollection'].forEach(recentItem => {\n\t\t\tconst dialog = this.#store.getters['dialogues/get'](recentItem.dialogId, true);\n\t\t\tconst user = this.#store.getters['users/get'](recentItem.dialogId, true);\n\n\t\t\trecentUsers.push({dialogId: recentItem.dialogId, dialog, user});\n\t\t});\n\n\t\treturn recentUsers.filter(item => {\n\t\t\treturn item.dialog.type === 'user' && !item.user.bot && item.user.id !== Core.getUserId();\n\t\t});\n\t}\n\n\tsearch(originalLayoutQuery: string): Promise\n\t{\n\t\tlet wrongLayoutSearchPromise = Promise.resolve([]);\n\t\tif (this.layoutManager.needLayoutChange(originalLayoutQuery))\n\t\t{\n\t\t\tconst wrongLayoutQuery = this.layoutManager.changeLayout(originalLayoutQuery);\n\t\t\twrongLayoutSearchPromise = this.getItemsFromRecentListByQuery(wrongLayoutQuery);\n\t\t}\n\n\t\tconst correctLayoutSearchPromise = this.getItemsFromRecentListByQuery(originalLayoutQuery);\n\n\t\treturn Promise.all([correctLayoutSearchPromise, wrongLayoutSearchPromise]).then(result => {\n\t\t\treturn new Map([...result[0], ...result[1]]);\n\t\t});\n\t}\n\n\tgetItemsFromRecentListByQuery(query: string): Promise\n\t{\n\t\tconst queryWords = SearchUtils.getWordsFromString(query);\n\n\t\treturn SearchUtils.createItemMap(this.getFromStore(queryWords));\n\t}\n\n\tgetFromStore(queryWords: Array<string>)\n\t{\n\t\tconst recentListItems = this.getRecentListItems();\n\t\tconst foundItems = [];\n\n\t\trecentListItems.forEach(recentListItem => {\n\t\t\tif (this.searchByQueryWords(recentListItem, queryWords))\n\t\t\t{\n\t\t\t\tfoundItems.push(recentListItem);\n\t\t\t}\n\t\t});\n\n\t\treturn foundItems;\n\t}\n\t//endregion\n\n\tgetRecentListItems(): Array\n\t{\n\t\treturn this.#store.getters['recent/getSortedCollection'].map(item => {\n\t\t\tconst dialog = this.#store.getters['dialogues/get'](item.dialogId, true);\n\t\t\tconst isUser = dialog.type === DialogType.user;\n\n\t\t\tconst recentListItem = {\n\t\t\t\tdialogId: item.dialogId,\n\t\t\t\tdialog: dialog,\n\t\t\t};\n\n\t\t\tif (isUser)\n\t\t\t{\n\t\t\t\trecentListItem.user = this.#store.getters['users/get'](item.dialogId, true);\n\t\t\t}\n\n\t\t\treturn recentListItem;\n\t\t});\n\t}\n\n\tsearchByQueryWords(recentListItem: Object, queryWords: Array<string>): boolean\n\t{\n\t\tif (recentListItem.user)\n\t\t{\n\t\t\treturn this.searchByUserFields(recentListItem, queryWords);\n\t\t}\n\n\t\treturn this.searchByDialogFields(recentListItem, queryWords);\n\t}\n\n\tsearchByDialogFields(recentListItem: Object, queryWords: Array<string>): boolean\n\t{\n\t\tconst searchField = [];\n\n\t\tif (recentListItem.dialog.name)\n\t\t{\n\t\t\tconst dialogNameWords = SearchUtils.getWordsFromString(recentListItem.dialog.name.toLowerCase());\n\t\t\tsearchField.push(...dialogNameWords);\n\t\t}\n\n\t\treturn this.doesItemMatchQuery(searchField, queryWords);\n\t}\n\n\tsearchByUserFields(recentListItem: Object, queryWords: Array<string>): boolean\n\t{\n\t\tconst searchField = [];\n\n\t\tif (recentListItem.user.firstName)\n\t\t{\n\t\t\tconst userFirstNameWords = SearchUtils.getWordsFromString(recentListItem.user.firstName.toLowerCase());\n\t\t\tsearchField.push(...userFirstNameWords);\n\t\t}\n\n\t\tif (recentListItem.user.lastName)\n\t\t{\n\t\t\tconst userLastNameWords = SearchUtils.getWordsFromString(recentListItem.user.lastName.toLowerCase());\n\t\t\tsearchField.push(...userLastNameWords);\n\t\t}\n\n\t\tif (recentListItem.user.workPosition)\n\t\t{\n\t\t\tconst userWorkPositionWords = SearchUtils.getWordsFromString(recentListItem.user.workPosition.toLowerCase());\n\t\t\tsearchField.push(...userWorkPositionWords);\n\t\t}\n\n\t\treturn this.doesItemMatchQuery(searchField, queryWords);\n\t}\n\n\tdoesItemMatchQuery(fieldsForSearch: Array<string>, queryWords: Array<string>): boolean\n\t{\n\t\tlet found = 0;\n\t\tqueryWords.forEach(queryWord => {\n\t\t\tlet queryWordsMatchCount = 0;\n\t\t\tfieldsForSearch.forEach(field => {\n\t\t\t\tconst word = field.slice(0, queryWord.length);\n\t\t\t\tif (collator.compare(queryWord, word) === 0)\n\t\t\t\t{\n\t\t\t\t\tqueryWordsMatchCount++;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (queryWordsMatchCount > 0)\n\t\t\t{\n\t\t\t\tfound++;\n\t\t\t}\n\t\t});\n\n\t\treturn found >= queryWords.length;\n\t}\n}","import {Dexie} from 'ui.dexie';\nimport {Type} from 'main.core';\nimport {SearchUtils} from './search-utils';\nimport {ImSearchProviderItem} from '../types/rest';\nimport {EventEmitter} from 'main.core.events';\nimport {EventType, SearchEntityIdTypes} from 'im.v2.const';\n\nexport class IndexedDbConnection\n{\n\tstatic instance = null;\n\n\tstatic getInstance(currentUserId: number)\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this(currentUserId);\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tconstructor(currentUserId: number)\n\t{\n\t\t/** @type {Dexie} */\n\t\tthis.db = new Dexie('bx-im-search-results');\n\t\tthis.db.version(2).stores({\n\t\t\titems: 'id, *title, *name, *lastName, *secondName, *position, date',\n\t\t\trecentItems: '++id, cacheId, date',\n\t\t\tsettings: '&name'\n\t\t}).upgrade(transaction => {\n\t\t\tconst clearItemsPromise = transaction.table('items').clear();\n\t\t\tconst clearRecentItemsPromise = transaction.table('recentItems').clear();\n\n\t\t\treturn Dexie.Promise.all([clearItemsPromise, clearRecentItemsPromise]);\n\t\t});\n\t\tthis.db.version(3).stores({\n\t\t\titems: 'id, *title, *name, *lastName, *position, date',\n\t\t\trecentItems: '++id, cacheId, date',\n\t\t\tsettings: '&name'\n\t\t});\n\n\t\tthis.checkTables(currentUserId);\n\n\t\tthis.onAccessDeniedHandler = this.onAccessDenied.bind(this);\n\t\tEventEmitter.subscribe(EventType.dialog.errors.accessDenied, this.onAccessDeniedHandler);\n\n\t\tthis.collator = new Intl.Collator(undefined, {sensitivity: 'base'});\n\t}\n\n\tcheckTables(currentUserId: number)\n\t{\n\t\tthis.db.open();\n\t\tthis.db.on('ready', () => {\n\t\t\treturn this.db.transaction('rw', this.db.settings, this.db.items, this.db.recentItems, () => {\n\t\t\t\treturn this.db.settings.where('name').equals('userId').first();\n\t\t\t}).then(settings => {\n\t\t\t\tconst promises = [];\n\t\t\t\tif (settings?.value !== currentUserId)\n\t\t\t\t{\n\t\t\t\t\tconst clearItemsPromise = this.db.items.clear();\n\t\t\t\t\tconst clearRecentItemsPromise = this.db.recentItems.clear();\n\n\t\t\t\t\tpromises.push(clearItemsPromise, clearRecentItemsPromise);\n\t\t\t\t}\n\t\t\t\treturn Dexie.Promise.all(promises);\n\t\t\t}).then(() => {\n\t\t\t\treturn this.db.settings.put({name: 'userId', value: currentUserId});\n\t\t\t});\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.errors.accessDenied, this.onAccessDeniedHandler);\n\t}\n\n\tloadRecentFromCache()\n\t{\n\t\tconst searchResults = {};\n\n\t\treturn this.db.transaction('rw', this.db.items, this.db.recentItems, () => {\n\t\t\treturn this.deleteExpiredItems().then(() => {\n\t\t\t\treturn this.db.recentItems.orderBy('id').toArray();\n\t\t\t});\n\t\t}).then(recentItemsFromCache => {\n\t\t\tsearchResults.recentItems = recentItemsFromCache;\n\n\t\t\tconst resultItemsPromises = [];\n\t\t\tsearchResults.recentItems.forEach(recentItem => {\n\t\t\t\tresultItemsPromises.push(this.db.items.get({id: recentItem.cacheId}));\n\t\t\t});\n\n\t\t\treturn Dexie.Promise.all(resultItemsPromises);\n\t\t}).then(result => {\n\t\t\tsearchResults.items = result.filter(item => !Type.isUndefined(item)).map(item => item.json);\n\n\t\t\treturn searchResults;\n\t\t});\n\t}\n\n\tsave(searchResults: Object): void\n\t{\n\t\tconst preparedItems = searchResults.items ? this.prepareItems(searchResults.items) : [];\n\t\tconst preparedRecentItems = searchResults.recentItems ? SearchUtils.prepareRecentItems(searchResults.recentItems) : [];\n\n\t\tthis.db.transaction('rw', this.db.items, this.db.recentItems, () => {\n\t\t\tif (preparedItems.length > 0)\n\t\t\t{\n\t\t\t\tthis.db.items.bulkPut(preparedItems);\n\t\t\t}\n\t\t\tif (preparedRecentItems.length > 0)\n\t\t\t{\n\t\t\t\tthis.db.recentItems.clear().then(() => {\n\t\t\t\t\tthis.db.recentItems.bulkPut(preparedRecentItems);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteExpiredItems()\n\t{\n\t\tconst oneMonthAgo = new Date(Date.now() - 60*60*1000*24*7*30);\n\n\t\treturn this.db.items.where('date').below(oneMonthAgo).delete().then(() => {\n\t\t\treturn this.db.recentItems.where('date').below(oneMonthAgo).delete();\n\t\t});\n\t}\n\n\tonAccessDenied({data: eventData}): Dexie.Promise\n\t{\n\t\tconst cacheId = this.convertDialogIdToCacheItemId(eventData.dialogId);\n\n\t\treturn this.db.items.where('id').equals(cacheId).delete().then(() => {\n\t\t\treturn this.db.recentItems.where('cacheId').equals(cacheId).delete();\n\t\t});\n\t}\n\n\tconvertDialogIdToCacheItemId(dialogId: string): string\n\t{\n\t\tif (dialogId.startsWith('chat'))\n\t\t{\n\t\t\treturn `chat|${dialogId.slice(4)}`;\n\t\t}\n\n\t\treturn `user|${dialogId}`;\n\t}\n\n\tprepareItems(items: Array<ImSearchProviderItem>): Array<Object>\n\t{\n\t\treturn items\n\t\t\t.filter(item => {\n\t\t\t\treturn item.entityId !== SearchEntityIdTypes.department\n\t\t\t\t\t&& item.entityId !== SearchEntityIdTypes.network\n\t\t\t\t\t&& item.entityType !== 'LINES'\n\t\t\t\t\t;\n\t\t\t})\n\t\t\t.map(item => {\n\t\t\t\tconst type = SearchUtils.getTypeByEntityId(item.entityId);\n\t\t\t\treturn {\n\t\t\t\t\tid: `${type}|${item.id}`,\n\t\t\t\t\tname: item.customData?.name ? SearchUtils.getWordsFromString(item.customData.name) : [],\n\t\t\t\t\tlastName: item.customData?.lastName ? SearchUtils.getWordsFromString(item.customData.lastName) : [],\n\t\t\t\t\tposition: item.customData.imUser?.WORK_POSITION ? SearchUtils.getWordsFromString(item.customData.imUser?.WORK_POSITION) : [],\n\t\t\t\t\ttitle: item.title ? SearchUtils.getWordsFromString(item.title) : [],\n\t\t\t\t\tjson: item,\n\t\t\t\t\tdate: new Date()\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\t/**\n\t * Moves item to the top of the recent search items list.\n\t *\n\t * @param itemToMove Array<string, number>\n\t */\n\tunshiftItem(itemToMove: Array<string, number>): void\n\t{\n\t\tconst [itemToMoveEntityId, itemToMoveId] = itemToMove;\n\t\tconst type = SearchUtils.getTypeByEntityId(itemToMoveEntityId);\n\t\tconst itemToMoveCacheId = `${type}|${itemToMoveId}`;\n\n\t\tthis.db.transaction('rw', this.db.recentItems, () => {\n\t\t\treturn this.db.recentItems.toArray();\n\t\t}).then(recentItems => {\n\t\t\tconst itemIndexToUpdate = recentItems.findIndex(recentItem => {\n\t\t\t\treturn recentItem.cacheId === itemToMoveCacheId;\n\t\t\t});\n\n\t\t\tif (itemIndexToUpdate === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (itemIndexToUpdate !== -1)\n\t\t\t{\n\t\t\t\tconst item = recentItems.splice(itemIndexToUpdate, 1);\n\t\t\t\titem[0].date = new Date();\n\t\t\t\trecentItems.unshift(item[0]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst item = {\n\t\t\t\t\tcacheId: `${itemToMoveCacheId}|${itemToMoveId}`,\n\t\t\t\t\tdate: new Date(),\n\t\t\t\t};\n\t\t\t\trecentItems.unshift(item);\n\t\t\t}\n\n\t\t\trecentItems.forEach(item => delete item.id);\n\n\t\t\tthis.db.recentItems.clear().then(() => {\n\t\t\t\tthis.db.recentItems.bulkPut(recentItems);\n\t\t\t});\n\t\t});\n\t}\n\n\tsearch(words: Array<string>): Promise<Array<ImSearchProviderItem>>\n\t{\n\t\treturn this.db.transaction('r', this.db.items, function* () {\n\t\t\t// Parallel search for all words - just select resulting primary keys\n\t\t\tconst results = yield this.getQueryResultByWords(words);\n\t\t\tif (!Type.isArrayFilled(results))\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst intersectedResult = this.intersectArrays(...results);\n\t\t\tconst distinctIds = [...new Set(intersectedResult.flat())];\n\n\t\t\t// Finally, select entire items from intersection\n\t\t\treturn yield this.db.items.where(':id').anyOf(distinctIds).toArray();\n\t\t}.bind(this)).then(items => {\n\t\t\treturn items.map(item => item.json);\n\t\t});\n\t}\n\n\tgetQueryResultByWords(words: Array<string>): Dexie.Promise\n\t{\n\t\treturn Dexie.Promise.all(words.map(word => {\n\t\t\treturn this.db.table('items').filter(record => {\n\t\t\t\tconst fieldsForSearch = [\n\t\t\t\t\t...record.name.flat(),\n\t\t\t\t\t...record.lastName.flat(),\n\t\t\t\t\t...record.position.flat(),\n\t\t\t\t\t...record.title.flat()\n\t\t\t\t];\n\n\t\t\t\treturn fieldsForSearch.some(field => {\n\t\t\t\t\tconst fieldToCompare = field.slice(0, word.length).toLowerCase();\n\t\t\t\t\treturn this.collator.compare(fieldToCompare, word) === 0;\n\t\t\t\t});\n\t\t\t})\n\t\t\t\t.distinct()\n\t\t\t\t.primaryKeys();\n\t\t}));\n\t}\n\n\tintersectArrays(firstArray: Array, secondArray: Array, ...restArrays: Array): Array\n\t{\n\t\tif (Type.isUndefined(secondArray))\n\t\t{\n\t\t\treturn firstArray;\n\t\t}\n\n\t\tconst intersectedArray = firstArray.filter(value => secondArray.includes(value));\n\t\tif (restArrays.length === 0)\n\t\t{\n\t\t\treturn intersectedArray;\n\t\t}\n\n\t\treturn this.intersectArrays(intersectedArray, ...restArrays);\n\t}\n}","import {Core} from 'im.v2.application.core';\nimport {Logger} from 'im.v2.lib.logger';\n\nimport {Config} from '../search-config';\nimport {IndexedDbConnection} from '../indexed-db-connection';\nimport {LayoutManager} from '../layout-manager';\nimport {SearchItem} from '../search-item';\nimport {SearchUtils} from '../search-utils';\n\nexport class IndexedDbSearchService\n{\n\tconstructor(config: Config)\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.db = IndexedDbConnection.getInstance(Core.getUserId());\n\t\tthis.config = config;\n\t\tthis.layoutManager = new LayoutManager();\n\t}\n\n\tload(): Promise<Map<string, SearchItem>>\n\t{\n\t\treturn this.db.loadRecentFromCache().then(responseFromCache => {\n\t\t\tLogger.warn('Im.Search: Recent search loaded from cache', responseFromCache);\n\n\t\t\treturn responseFromCache;\n\t\t}).then(responseFromCache => {\n\t\t\tconst {items, recentItems} = responseFromCache;\n\t\t\tconst itemMap = SearchUtils.createItemMap(items);\n\n\t\t\treturn {recentItems, itemMap};\n\t\t});\n\t}\n\n\tsave(items)\n\t{\n\t\treturn this.db.save(items);\n\t}\n\n\tunshiftItem(item)\n\t{\n\t\treturn this.db.unshiftItem(item);\n\t}\n\n\tsearch(originalLayoutQuery: string): Promise<Map<string, SearchItem>>\n\t{\n\t\tlet wrongLayoutSearchPromise = Promise.resolve([]);\n\t\tif (this.layoutManager.needLayoutChange(originalLayoutQuery))\n\t\t{\n\t\t\tconst wrongLayoutQuery = this.layoutManager.changeLayout(originalLayoutQuery);\n\t\t\twrongLayoutSearchPromise = this.getItemsFromCacheByQuery(wrongLayoutQuery);\n\t\t}\n\n\t\tconst correctLayoutSearchPromise = this.getItemsFromCacheByQuery(originalLayoutQuery);\n\n\t\treturn Promise.all([correctLayoutSearchPromise, wrongLayoutSearchPromise]).then(result => {\n\t\t\treturn new Map([...result[0], ...result[1]]);\n\t\t}).catch(error => {\n\t\t\tconsole.error('Unknown exception', error);\n\n\t\t\treturn new Map();\n\t\t});\n\t}\n\n\tgetItemsFromCacheByQuery(query: string): Promise\n\t{\n\t\tconst queryWords = SearchUtils.getWordsFromString(query);\n\n\t\treturn this.db.search(queryWords).then(cacheItems => {\n\t\t\treturn SearchUtils.createItemMap(cacheItems);\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.db.destroy();\n\t}\n}","import {ajax as Ajax} from 'main.core';\nimport {Logger} from 'im.v2.lib.logger';\nimport {SearchUtils} from '../search-utils';\nimport type {Config} from '../search-config';\n\nexport class BaseServerSearchService\n{\n\t#searchConfig: Config;\n\n\tconstructor(searchConfig: Config)\n\t{\n\t\tthis.#searchConfig = searchConfig;\n\t}\n\n\tsearchRequest(query: string): Promise\n\t{\n\t\tconst config = {\n\t\t\tjson: this.#searchConfig.getSearch()\n\t\t};\n\n\t\tconfig.json.searchQuery = {\n\t\t\t'queryWords': SearchUtils.getWordsFromString(query),\n\t\t\t'query': query,\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('ui.entityselector.doSearch', config).then(response => {\n\t\t\t\tLogger.warn(`Im.Search: Search request result`, response);\n\t\t\t\tresolve(response.data.dialog.items);\n\t\t\t}).catch(error => reject(error));\n\t\t});\n\t}\n\n\tloadRecentFromServer(): Promise\n\t{\n\t\tconst config = {\n\t\t\tjson: this.#searchConfig.getRecentRequestConfig()\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('ui.entityselector.load', config).then(response => {\n\t\t\t\tLogger.warn(`Im.Search: Recent search request result`, response);\n\t\t\t\tresolve(response.data.dialog);\n\t\t\t}).catch(error => reject(error));\n\t\t});\n\t}\n\n\taddItemsToRecentSearchResults(recentItem: Array<string, number>): void\n\t{\n\t\tconst [entityId, id] = recentItem;\n\t\tconst recentItems = [{id, entityId}];\n\n\t\tconst config = {\n\t\t\tjson: {\n\t\t\t\t...this.#searchConfig.getRecentRequestConfig(),\n\t\t\t\trecentItems\n\t\t\t},\n\t\t};\n\n\t\tAjax.runAction('ui.entityselector.saveRecentItems', config);\n\t}\n}","import {ajax as Ajax} from 'main.core';\nimport {Logger} from 'im.v2.lib.logger';\nimport {callBatch} from 'im.v2.lib.rest';\nimport {RestMethod, SearchEntityIdTypes} from 'im.v2.const';\nimport {SearchUtils} from '../search-utils';\nimport {Config} from '../search-config';\n\nconst RestMethodImopenlinesNetworkJoin = 'imopenlines.network.join';\n\nexport class NetworkSearchService\n{\n\t#searchConfig: Config;\n\n\tconstructor(searchConfig: Config)\n\t{\n\t\tthis.#searchConfig = searchConfig;\n\t}\n\n\tsearch(query: string): Promise\n\t{\n\t\tconst config = {\n\t\t\tjson: this.#searchConfig.getNetwork()\n\t\t};\n\n\t\tconfig.json.searchQuery = {\n\t\t\t'queryWords': SearchUtils.getWordsFromString(query.trim()),\n\t\t\t'query': query.trim(),\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('ui.entityselector.doSearch', config).then(response => {\n\t\t\t\tLogger.warn(`Im.Search: Network Search request result`, response);\n\n\t\t\t\tresolve(response.data.dialog.items);\n\t\t\t}).catch(error => reject(error));\n\t\t});\n\t}\n\n\tloadItem(networkCode: string): Promise\n\t{\n\t\tconst query = {\n\t\t\t[RestMethodImopenlinesNetworkJoin]: {code: networkCode},\n\t\t\t[RestMethod.imUserGet]: {id: `$result[${RestMethodImopenlinesNetworkJoin}]`}\n\t\t};\n\n\t\treturn callBatch(query).then(result => {\n\t\t\tconst user = result[RestMethod.imUserGet];\n\n\t\t\treturn {\n\t\t\t\tid: user.id,\n\t\t\t\tentityId: SearchEntityIdTypes.bot,\n\t\t\t\tentityType: 'network',\n\t\t\t\ttitle: user.name,\n\t\t\t\tcustomData: {imUser: SearchUtils.convertKeysToUpperCase(user)},\n\t\t\t\tavatar: user.avatar,\n\t\t\t};\n\t\t});\n\t}\n}","import {ajax as Ajax} from 'main.core';\nimport {Logger} from 'im.v2.lib.logger';\n\nimport type {Config} from '../search-config';\nimport type {SearchItem} from '../search-item';\n\nexport class DepartmentSearchService\n{\n\t#searchConfig: Config;\n\n\tconstructor(searchConfig: Config)\n\t{\n\t\tthis.#searchConfig = searchConfig;\n\t}\n\n\tloadUsers(department: SearchItem): Promise\n\t{\n\t\tconst parentItem = {\n\t\t\tid: department.getId(),\n\t\t\tentityId: department.getEntityId()\n\t\t};\n\n\t\tconst config = {\n\t\t\tjson: {\n\t\t\t\t...this.#searchConfig.getDepartmentUsers(),\n\t\t\t\tparentItem\n\t\t\t}\n\t\t};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('ui.entityselector.getChildren', config).then(response => {\n\t\t\t\tLogger.warn('Im.V2.Search: department users response', response);\n\t\t\t\tresolve(response.data.dialog.items);\n\t\t\t}).catch(error => reject(error));\n\t\t});\n\t}\n}","import {Logger} from 'im.v2.lib.logger';\nimport {Config} from './search-config';\nimport {SearchItem} from './search-item';\nimport {StoreUpdater} from './store-updater';\nimport {SortingResult} from './sorting-result';\nimport {RecentStateSearchService} from './entity-services/recent-state-search-service';\nimport {IndexedDbSearchService} from './entity-services/indexed-db-search-service';\nimport {BaseServerSearchService} from './entity-services/base-server-search-service';\nimport {NetworkSearchService} from './entity-services/network-search-service';\nimport {DepartmentSearchService} from './entity-services/department-search-service';\nimport {SearchUtils} from './search-utils';\n\nimport type {ImSearchProviderItem} from '../types/rest';\n\nexport class SearchService\n{\n\tconstructor(searchConfig)\n\t{\n\t\tthis.searchConfig = new Config(searchConfig);\n\n\t\tthis.storeUpdater = new StoreUpdater();\n\t\tthis.sortingResult = new SortingResult();\n\n\t\tthis.recentStateSearchService = new RecentStateSearchService();\n\t\tthis.indexedDbSearchService = new IndexedDbSearchService();\n\t\tthis.baseServerSearchService = new BaseServerSearchService(this.searchConfig);\n\t\tthis.networkSearchService = new NetworkSearchService(this.searchConfig);\n\t\tthis.departmentSearchService = new DepartmentSearchService(this.searchConfig);\n\t}\n\n\tloadRecentSearchFromCache(): Promise<Map<string, SearchItem>>\n\t{\n\t\treturn this.indexedDbSearchService.load().then(result => {\n\t\t\tconst {recentItems, itemMap} = result;\n\n\t\t\treturn this.#getItemsFromRecentItems(recentItems, itemMap);\n\t\t}).then(items => {\n\t\t\treturn this.#processResponse({items, onlyAdd: true});\n\t\t});\n\t}\n\n\tloadRecentUsers(): Promise<Map<string, SearchItem>>\n\t{\n\t\tconst recentUsers = this.recentStateSearchService.load();\n\t\tconst items = SearchUtils.createItemMap(recentUsers);\n\n\t\treturn this.#processResponse({items, updateStore: false});\n\t}\n\n\tloadRecentSearchFromServer(): Promise<Map<string, SearchItem>>\n\t{\n\t\treturn this.baseServerSearchService.loadRecentFromServer().then(responseFromServer => {\n\t\t\tthis.indexedDbSearchService.save(responseFromServer);\n\n\t\t\tLogger.warn('Im.Search: Recent search loaded from server');\n\t\t\tconst {items, recentItems} = responseFromServer;\n\n\t\t\tconst itemMap = SearchUtils.createItemMap(items);\n\t\t\tconst preparedRecentItems = SearchUtils.prepareRecentItems(recentItems);\n\n\t\t\treturn this.#getItemsFromRecentItems(preparedRecentItems, itemMap);\n\t\t}).then(items => {\n\t\t\treturn this.#processResponse({items});\n\t\t});\n\t}\n\n\tsearchLocal(query: string): Promise<Map<string, SearchItem>>\n\t{\n\t\tconst searchInCachePromise = this.indexedDbSearchService.search(query);\n\t\tconst searchInRecentListPromise = this.recentStateSearchService.search(query);\n\n\t\treturn Promise.all([searchInCachePromise, searchInRecentListPromise]).then(result => {\n\t\t\tconst [itemsFromCache, itemsFromRecent] = result;\n\n\t\t\treturn Promise.all([\n\t\t\t\tthis.#processResponse({items: itemsFromCache, onlyAdd: false}),\n\t\t\t\tthis.#processResponse({items: itemsFromRecent, updateStore: false})\n\t\t\t]);\n\t\t}).then(result => {\n\t\t\tconst [itemsFromCacheProcessed, itemsFromRecentProcessed] = result;\n\t\t\t// Spread order is important, because we have more data in cache than in recent list\n\t\t\t// (for example contextSort field)\n\t\t\tconst items = new Map([...itemsFromRecentProcessed, ...itemsFromCacheProcessed]);\n\n\t\t\treturn this.sortingResult.getSortedItems(items, query);\n\t\t});\n\t}\n\n\tsearchOnServer(query: string): Promise\n\t{\n\t\treturn this.baseServerSearchService.searchRequest(query).then(itemsFromServer => {\n\t\t\tthis.indexedDbSearchService.save({items: itemsFromServer});\n\n\t\t\treturn SearchUtils.createItemMap(itemsFromServer);\n\t\t}).then(items => {\n\t\t\treturn this.#processResponse({items});\n\t\t}).then(items => {\n\t\t\treturn this.sortingResult.allocateSearchResults(items, query);\n\t\t});\n\t}\n\n\tsearchOnNetwork(query: string): Promise<Map<string, SearchItem>>\n\t{\n\t\tthis.searchConfig.enableNetworkSearch();\n\n\t\treturn this.networkSearchService.search(query).then(items => {\n\t\t\treturn SearchUtils.createItemMap(items);\n\t\t});\n\t}\n\n\tloadDepartmentUsers(parentItem: ImSearchProviderItem): Promise<Map<string, SearchItem>>\n\t{\n\t\treturn this.departmentSearchService.loadUsers(parentItem).then(responseFromServer => {\n\t\t\tthis.indexedDbSearchService.save({items: responseFromServer});\n\t\t\tconst items = SearchUtils.createItemMap(responseFromServer);\n\n\t\t\treturn this.#processResponse({items});\n\t\t});\n\t}\n\n\tloadNetworkItem(networkCode: string): Promise\n\t{\n\t\treturn this.networkSearchService.loadItem(networkCode).then(responseFromServer => {\n\t\t\tconst items = SearchUtils.createItemMap([responseFromServer]);\n\n\t\t\treturn this.#processResponse({items});\n\t\t});\n\t}\n\n\taddItemToRecent(selectedItem: SearchItem)\n\t{\n\t\tif (selectedItem.isDepartmentType() || selectedItem.isNetworkType())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = [selectedItem.entityId, selectedItem.id];\n\n\t\tthis.indexedDbSearchService.unshiftItem(item);\n\t\tthis.baseServerSearchService.addItemsToRecentSearchResults(item);\n\t}\n\n\t#processResponse({items, updateStore = true, onlyAdd = false}): Promise<Map<string, SearchItem>>\n\t{\n\t\tconst filteredItems = this.#filterByConfig(items);\n\t\tif (!updateStore)\n\t\t{\n\t\t\treturn Promise.resolve(filteredItems);\n\t\t}\n\n\t\treturn this.storeUpdater.update({items: filteredItems, onlyAdd: onlyAdd}).then(() => {\n\t\t\treturn filteredItems;\n\t\t});\n\t}\n\n\t#filterByConfig(items: Map<string, SearchItem>): Map<string, SearchItem>\n\t{\n\t\tconst filteredItems = [...items].filter(item => {\n\t\t\tconst [, value] = item;\n\t\t\treturn this.searchConfig.isItemAllowed(value);\n\t\t});\n\n\t\treturn new Map(filteredItems);\n\t}\n\n\t#getItemsFromRecentItems(recentItems: Array<Object>, items: Map<string, SearchItem>): Map<string, SearchItem>\n\t{\n\t\tconst filledRecentItems = new Map();\n\t\trecentItems.forEach(recentItem => {\n\t\t\tconst itemFromMap = items.get(recentItem.cacheId);\n\t\t\tif (itemFromMap && !itemFromMap.isOpeLinesType())\n\t\t\t{\n\t\t\t\tfilledRecentItems.set(itemFromMap.getEntityFullId(), itemFromMap);\n\t\t\t}\n\t\t});\n\n\t\treturn filledRecentItems;\n\t}\n\n\tisNetworkAvailable(): boolean\n\t{\n\t\treturn this.searchConfig.isNetworkAvailable();\n\t}\n\n\tdisableNetworkSearch(): void\n\t{\n\t\tthis.searchConfig.disableNetworkSearch();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.indexedDbSearchService.destroy();\n\t}\n}","import {RecentMenu} from 'im.v2.lib.menu';\n\nexport class SearchContextMenu extends RecentMenu\n{\n\tgetMenuItems(): Array\n\t{\n\t\treturn [\n\t\t\tthis.getSendMessageItem(),\n\t\t\tthis.getCallItem(),\n\t\t\tthis.getHistoryItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t];\n\t}\n}","import {EventEmitter} from 'main.core.events';\nimport {EventType} from 'im.v2.const';\nimport {Avatar, AvatarSize} from 'im.v2.component.elements';\nimport {SearchContextMenu} from '../classes/search-context-menu';\nimport '../css/carousel-user.css';\nimport type {ImModelUser} from 'im.v2.model';\nimport type {SearchItem} from '../classes/search-item';\n\n// @vue/component\nexport const CarouselUser = {\n\tname: 'CarouselUser',\n\tcomponents: {Avatar},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tselectMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\tisSelected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t}\n\t},\n\temits: ['clickItem'],\n\tdata() {\n\t\treturn {\n\t\t\tselected: this.isSelected,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tsearchItem(): SearchItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tuserId(): number\n\t\t{\n\t\t\treturn this.searchItem.getId();\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.userId, true);\n\t\t},\n\t\tname(): string\n\t\t{\n\t\t\treturn this.user.firstName ? this.user.firstName : this.user.name;\n\t\t},\n\t\tisExtranet(): boolean\n\t\t{\n\t\t\treturn this.user.extranet;\n\t\t},\n\t\tuserDialogId(): string\n\t\t{\n\t\t\treturn this.userId.toString();\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tisSelected(newValue, oldValue)\n\t\t{\n\t\t\tif (newValue === true && oldValue === false)\n\t\t\t{\n\t\t\t\tthis.selected = true;\n\t\t\t}\n\t\t\telse if (newValue === false && oldValue === true)\n\t\t\t{\n\t\t\t\tthis.selected = false;\n\t\t\t}\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tif (this.selectMode)\n\t\t\t{\n\t\t\t\tthis.selected = !this.selected;\n\t\t\t}\n\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tselectedItem: this.searchItem,\n\t\t\t\tselectedStatus: this.selected,\n\t\t\t\tnativeEvent: event\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = {dialogId: this.userDialogId};\n\t\t\tEventEmitter.emit(EventType.search.openContextMenu, {item, nativeEvent: event});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-carousel-user__container bx-im-carousel-user__scope\"\n\t\t\t:class=\"{'--extranet': isExtranet, '--selected': selectMode && selected}\"\n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\"\n\t\t>\n\t\t\t<div v-if=\"selectMode && selected\" class=\"bx-im-carousel-user__selected-mark\"></div>\n\t\t\t<Avatar :dialogId=\"userDialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t<div class=\"bx-im-carousel-user__title\" :title=\"user.name\">\n\t\t\t\t{{ name }}\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import {CarouselUser} from './carousel-user';\nimport '../css/recent-users-carousel.css';\nimport type {SearchItem} from '../classes/search-item';\n\nconst recentUsersLimit = 6;\n\n// @vue/component\nexport const RecentUsersCarousel = {\n\tname: 'RecentUsersCarousel',\n\tcomponents: {CarouselUser},\n\tprops:\n\t{\n\t\titems: {\n\t\t\ttype: Object, // Map<string, SearchItem>\n\t\t\trequired: true\n\t\t},\n\t\tselectMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\tselectedItems: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => []\n\t\t}\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tusers(): SearchItem[]\n\t\t{\n\t\t\tconst itemsFromMap = [...this.items.values()];\n\n\t\t\treturn itemsFromMap.slice(0, recentUsersLimit);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tisSelected(item: SearchItem): boolean\n\t\t{\n\t\t\treturn this.selectedItems.includes(item.getEntityFullId());\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-recent-users-carousel__container bx-im-recent-users-carousel__scope\">\n\t\t\t<div class=\"bx-im-recent-users-carousel__title-container\">\n\t\t\t\t<span class=\"bx-im-recent-users-carousel__section-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SEARCH_SECTION_RECENT_CHATS') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-recent-users-carousel__users-container\">\n\t\t\t\t<CarouselUser \n\t\t\t\t\tv-for=\"user in users\"\n\t\t\t\t\t:key=\"user.getId()\"\n\t\t\t\t\t:item=\"user\"\n\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t:isSelected=\"isSelected(user)\"\n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import {ExpandAnimation} from 'im.v2.component.animation';\nimport '../css/search-result-section.css';\nimport type {SearchItem} from '../classes/search-item';\n\nexport const SearchResultSection = {\n\tname: 'SearchResultSection',\n\tcomponents: {ExpandAnimation},\n\tprops: {\n\t\tcomponent: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\titems: {\n\t\t\ttype: Object, // Map<string, SearchItem>\n\t\t\trequired: true\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\tshowMoreButton: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t\trequired: false\n\t\t},\n\t\tminItems: {\n\t\t\ttype: Number,\n\t\t\tdefault: 10,\n\t\t\trequired: false\n\t\t},\n\t\tmaxItems: {\n\t\t\ttype: Number,\n\t\t\tdefault: 50,\n\t\t\trequired: false\n\t\t},\n\t\tcanBeFolded: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t\trequired: false\n\t\t},\n\t\tselectMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tselectedItems: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => []\n\t\t}\n\t},\n\temits: ['clickItem'],\n\tdata: function ()\n\t{\n\t\treturn {\n\t\t\texpanded: false,\n\t\t\tfolded: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tshowMore(): boolean\n\t\t{\n\t\t\tif (!this.showMoreButton)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.items.size > this.minItems;\n\t\t},\n\t\tshowMoreButtonText(): string\n\t\t{\n\t\t\treturn this.expanded\n\t\t\t\t? this.$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_TITLE_SHOW_LESS')\n\t\t\t\t: this.$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_TITLE_SHOW_MORE')\n\t\t\t\t;\n\t\t},\n\t\tsectionItems(): SearchItem[]\n\t\t{\n\t\t\tconst itemsFromMap = [...this.items.values()];\n\t\t\tif (!this.showMoreButton)\n\t\t\t{\n\t\t\t\treturn itemsFromMap;\n\t\t\t}\n\n\t\t\treturn this.expanded ? itemsFromMap.slice(0, this.maxItems) : itemsFromMap.slice(0, this.minItems);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonFoldSection()\n\t\t{\n\t\t\tif (!this.canBeFolded)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.folded = !this.folded;\n\t\t},\n\t\tonShowMore()\n\t\t{\n\t\t\tthis.expanded = !this.expanded;\n\t\t},\n\t\tisSelected(item: SearchItem): boolean\n\t\t{\n\t\t\treturn this.selectedItems.includes(item.getEntityFullId());\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-result-section__container bx-im-search-result-section__scope\">\n\t\t\t<div \n\t\t\t\tv-if=\"title\" \n\t\t\t\tclass=\"bx-im-search-result-section__title-container\" \n\t\t\t\t:class=\"{'--down': !folded, '--foldable': canBeFolded}\"\n\t\t\t\t@click=\"onFoldSection\"\n\t\t\t>\n\t\t\t\t<span \n\t\t\t\t\tclass=\"bx-im-search-result-section__title-text\"\n\t\t\t\t\t:class=\"{'--icon': canBeFolded}\"\n\t\t\t\t>\n\t\t\t\t\t{{title}}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<ExpandAnimation>\n\t\t\t\t<div v-if=\"!folded\" class=\"bx-im-search-result-section__items-container\">\n\t\t\t\t\t<component \n\t\t\t\t\t\t:is=\"component\"\n\t\t\t\t\t\tv-for=\"item in sectionItems\" \n\t\t\t\t\t\t:key=\"item.getEntityFullId()\" \n\t\t\t\t\t\t:item=\"item\" \n\t\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t\t:isSelected=\"isSelected(item)\"\n\t\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t\t/>\n\t\t\t\t\t<button \n\t\t\t\t\t\tv-if=\"showMore\" \n\t\t\t\t\t\tclass=\"bx-im-search-result-section__show-more\" \n\t\t\t\t\t\t@click.prevent=\"onShowMore\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ showMoreButtonText }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</ExpandAnimation>\n\t\t</div>\n\t`\n};","import {Text, Type} from 'main.core';\nimport {Loader} from 'im.v2.component.elements';\nimport '../css/search-result-network-item.css';\nimport type {SearchItem} from '../classes/search-item';\nimport {SearchUtils} from '../classes/search-utils';\n\n// @vue/component\nexport const SearchResultNetworkItem = {\n\tname: 'SearchResultNetworkItem',\n\tcomponents: {Loader},\n\tinject: ['searchService'],\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tdata: function() {\n\t\treturn {\n\t\t\tisLoading: false\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tsearchItem(): SearchItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\thasAvatar(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.searchItem.getAvatar());\n\t\t},\n\t\tavatarStyles(): {[string]: string}\n\t\t{\n\t\t\tif (!this.hasAvatar)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tbackgroundSize: '37px',\n\t\t\t\t\tbackgroundPosition: 'center 8px',\n\t\t\t\t\tbackgroundColor: this.searchItem.getAvatarOptions().color\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {backgroundImage: `url('${this.searchItem.getAvatar()}')`};\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\treturn Text.decode(this.searchItem.getTitle());\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.isLoading = true;\n\t\t\tconst networkCode = this.searchItem.getId();\n\n\t\t\tthis.searchService.loadNetworkItem(networkCode).then(response => {\n\t\t\t\tconst searchItem = SearchUtils.getFirstItemFromMap(response);\n\t\t\t\tthis.$emit('clickItem', {\n\t\t\t\t\tselectedItem: searchItem,\n\t\t\t\t\tnativeEvent: event\n\t\t\t\t});\n\t\t\t}).catch(error => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.isLoading = false;\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"bx-im-search-result-network-item__container bx-im-search-result-network-item__scope\"\n\t\t\t@click=\"onClick\"\n\t\t>\n\t\t\t<div class=\"bx-im-search-result-network-item__avatar-container\">\n\t\t\t\t<div\n\t\t\t\t\t:title=\"searchItem.title\"\n\t\t\t\t\tclass=\"bx-im-search-result-network-item__avatar\"\n\t\t\t\t\t:style=\"avatarStyles\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-result-network-item__content-container\">\n\t\t\t\t<div class=\"bx-im-search-result-network-item__title-text\" :title=\"title\">\n\t\t\t\t\t{{title}}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-search-result-network-item__item-text\" :title=\"searchItem.getSubtitle()\">\n\t\t\t\t\t{{ searchItem.getSubtitle() }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"isLoading\" class=\"bx-im-search-result-network-item__loader\">\n\t\t\t\t\t<Loader />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};","import {EventEmitter} from 'main.core.events';\nimport {DialogType, EventType} from 'im.v2.const';\nimport {Avatar, AvatarSize, ChatTitle} from 'im.v2.component.elements';\nimport '../css/search-result-item.css';\nimport type {ImModelDialog, ImModelUser} from 'im.v2.model';\nimport type {SearchItem} from '../classes/search-item';\n\n// @vue/component\nexport const SearchResultItem = {\n\tname: 'SearchResultItem',\n\tcomponents: {Avatar, ChatTitle},\n\tinject: ['searchService'],\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tselectMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\tisSelected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t}\n\t},\n\temits: ['clickItem'],\n\tdata() {\n\t\treturn {\n\t\t\tselected: this.isSelected,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tsearchItem(): SearchItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialogId(): string\n\t\t{\n\t\t\treturn this.searchItem.getDialogId();\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelDialog\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.dialogId, true);\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === DialogType.user;\n\t\t},\n\t\tuserItemText(): string\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst status = this.$store.getters['users/getLastOnline'](this.dialogId);\n\t\t\tif (status)\n\t\t\t{\n\t\t\t\treturn status;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t},\n\t\tchatItemText(): string\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_ITEM_CHAT_TYPE_GROUP_V2');\n\t\t},\n\t\titemText(): string\n\t\t{\n\t\t\treturn this.isUser ? this.userItemText : this.chatItemText;\n\t\t},\n\t\tselectedStyles()\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--selected': this.selectMode && this.selected\n\t\t\t};\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tisSelected(newValue: boolean, oldValue: boolean)\n\t\t{\n\t\t\tif (newValue === true && oldValue === false)\n\t\t\t{\n\t\t\t\tthis.selected = true;\n\t\t\t}\n\t\t\telse if (newValue === false && oldValue === true)\n\t\t\t{\n\t\t\t\tthis.selected = false;\n\t\t\t}\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tif (this.selectMode)\n\t\t\t{\n\t\t\t\tthis.selected = !this.selected;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.searchService.addItemToRecent(this.searchItem);\n\t\t\t}\n\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tselectedItem: this.searchItem,\n\t\t\t\tselectedStatus: this.selected,\n\t\t\t\tnativeEvent: event\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = {dialogId: this.dialogId};\n\t\t\tEventEmitter.emit(EventType.search.openContextMenu, {item, nativeEvent: event});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\" \n\t\t\tclass=\"bx-im-search-result-item__container bx-im-search-result-item__scope\"\n\t\t\t:class=\"selectedStyles\"\n\t\t>\n\t\t\t<div class=\"bx-im-search-result-item__avatar-container\">\n\t\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-result-item__content-container\">\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" />\n\t\t\t\t<div class=\"bx-im-search-result-item__item-text\" :title=\"itemText\">\n\t\t\t\t\t{{ itemText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"selectMode && selected\" class=\"bx-im-search-result-item__selected\"></div>\n\t\t</div>\n\t`\n};","import {Type, Text} from 'main.core';\nimport {ExpandAnimation} from 'im.v2.component.animation';\nimport {Loader} from 'im.v2.component.elements';\nimport {SearchResultItem} from './search-result-item';\n\nimport type {SearchItem} from '../classes/search-item';\nimport '../css/search-result-department-item.css';\n\n// @vue/component\nexport const SearchResultDepartmentItem = {\n\tname: 'SearchResultDepartmentItem',\n\tcomponents: {SearchResultItem, ExpandAnimation, Loader},\n\tinject: ['searchService'],\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tselectMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\tisSelected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t}\n\t},\n\temits: ['clickItem'],\n\tdata: function() {\n\t\treturn {\n\t\t\tselected: this.isSelected,\n\t\t\texpanded: false,\n\t\t\tisLoading: false,\n\t\t\tusersInDepartment: [],\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tsearchItem(): SearchItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdepartmentAvatarStyle(): {[string]: string}\n\t\t{\n\t\t\tif (this.searchItem.avatarOptions?.color)\n\t\t\t{\n\t\t\t\treturn {backgroundColor: this.searchItem.avatarOptions.color};\n\t\t\t}\n\n\t\t\treturn {};\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\treturn Text.decode(this.searchItem.title);\n\t\t},\n\t\tselectedStyles()\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--selected': this.selectMode && this.selected\n\t\t\t};\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tisSelected(newValue: boolean, oldValue: boolean)\n\t\t{\n\t\t\tif (newValue === true && oldValue === false)\n\t\t\t{\n\t\t\t\tthis.selected = true;\n\t\t\t}\n\t\t\telse if (newValue === false && oldValue === true)\n\t\t\t{\n\t\t\t\tthis.selected = false;\n\t\t\t}\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tif (!this.expanded)\n\t\t\t{\n\t\t\t\tthis.openDepartment(event);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.expanded = false;\n\t\t\t}\n\t\t},\n\t\topenDepartment(event)\n\t\t{\n\t\t\tif (this.selectMode)\n\t\t\t{\n\t\t\t\tthis.selected = !this.selected;\n\n\t\t\t\tthis.$emit('clickItem', {\n\t\t\t\t\tselectedItem: this.searchItem,\n\t\t\t\t\tselectedStatus: this.selected,\n\t\t\t\t\tnativeEvent: event\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tif (Type.isArrayFilled(this.usersInDepartment))\n\t\t\t\t{\n\t\t\t\t\tthis.isLoading = false;\n\t\t\t\t\tthis.expanded = true;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.searchService.loadDepartmentUsers(this.searchItem).then(response => {\n\t\t\t\t\tthis.usersInDepartment = [...response.values()].filter(user => user.isUser());\n\t\t\t\t\tthis.isLoading = false;\n\t\t\t\t\tthis.expanded = true;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\t@click=\"onClick\" \n\t\t\tclass=\"bx-im-search-result-department-item__container bx-im-search-result-department-item__scope\"\n\t\t\t:class=\"selectedStyles\"\n\t\t>\n\t\t\t<div class=\"bx-im-search-result-department-item__avatar_container\">\n\t\t\t\t<div \n\t\t\t\t\t:title=\"searchItem.title\" \n\t\t\t\t\tclass=\"bx-im-search-result-department-item__avatar\"\n\t\t\t\t\t:style=\"departmentAvatarStyle\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-result-department-item__title_container\">\n\t\t\t\t<div class=\"bx-im-search-result-department-item__title_text\" :title=\"title\">\n\t\t\t\t\t{{title}}\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"!selectMode\" class=\"bx-im-search-result-department-item__expand-button\">\n\t\t\t\t\t<div v-if=\"isLoading\" class=\"bx-im-search-result-department-item__loader\">\n\t\t\t\t\t\t<Loader />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else-if=\"expanded\" class=\"bx-im-search-result-department-item__arrow --down\"></div>\n\t\t\t\t\t<div v-else class=\"bx-im-search-result-department-item__arrow\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"selectMode && selected\" class=\"bx-im-search-result-department-item__selected\"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<ExpandAnimation>\n\t\t\t<div v-if=\"expanded\" class=\"bx-im-search-result-department-item__users\">\n\t\t\t\t<SearchResultItem \n\t\t\t\t\tv-for=\"user in usersInDepartment\" \n\t\t\t\t\t:key=\"user.getEntityFullId()\" \n\t\t\t\t\t:item=\"user\"\n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</ExpandAnimation>\n\t`\n};","import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport {Runtime, Extension} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {provide} from 'ui.vue3';\n\nimport {Messenger} from 'im.public';\nimport {EventType} from 'im.v2.const';\nimport {Button, ButtonColor, ButtonSize, Loader} from 'im.v2.component.elements';\nimport {Utils} from 'im.v2.lib.utils';\n\nimport {SearchService} from './classes/search-service';\nimport {SearchContextMenu} from './classes/search-context-menu';\nimport {SearchUtils} from './classes/search-utils';\nimport {SearchItem} from './classes/search-item';\nimport {RecentUsersCarousel} from './components/recent-users-carousel';\nimport {SearchResultSection} from './components/search-result-section';\nimport {SearchResultNetworkItem} from './components/search-result-network-item';\nimport {SearchResultDepartmentItem} from './components/search-result-department-item';\nimport {SearchResultItem} from './components/search-result-item';\n\nimport './css/search-result.css';\n\n// @vue/component\nexport const SearchResult = {\n\tname: 'SearchResult',\n\tcomponents: {\n\t\tRecentUsersCarousel,\n\t\tSearchResultSection,\n\t\tSearchResultNetworkItem,\n\t\tSearchResultDepartmentItem,\n\t\tSearchResultItem,\n\t\tButton,\n\t\tLoader\n\t},\n\tprops: {\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\tsearchMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true\n\t\t},\n\t\tsearchConfig: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tselectMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\tselectedItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => []\n\t\t}\n\t},\n\tdata: function()\n\t{\n\t\treturn {\n\t\t\tisRecentLoading: false,\n\t\t\tisLocalLoading: false,\n\t\t\tisServerLoading: false,\n\t\t\tisNetworkLoading: false,\n\n\t\t\tcurrentServerQueries: 0,\n\t\t\tisNetworkButtonClicked: false,\n\t\t\tresult: {\n\t\t\t\trecentUsers: new Map(),\n\t\t\t\trecent: new Map(),\n\t\t\t\tusersAndChats: new Map(),\n\t\t\t\tchatUsers: new Map(),\n\t\t\t\tdepartments: new Map(),\n\t\t\t\topenLines: new Map(),\n\t\t\t\tnetwork: new Map(),\n\t\t\t}\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\titemComponent: () => SearchResultItem,\n\t\titemDepartmentComponent: () => SearchResultDepartmentItem,\n\t\titemNetworkComponent: () => SearchResultNetworkItem,\n\t\tcleanQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\tif (this.isServerLoading || this.isLocalLoading || this.isNetworkLoading)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.isNetworkSectionAvailable && !this.isNetworkButtonClicked && this.isServerSearch)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.result.usersAndChats.size === 0\n\t\t\t\t&& this.result.departments.size === 0\n\t\t\t\t&& this.result.chatUsers.size === 0\n\t\t\t\t&& this.result.openLines.size === 0\n\t\t\t\t&& this.result.network.size === 0;\n\t\t},\n\t\tisLoadingState(): boolean\n\t\t{\n\t\t\treturn this.isServerLoading || this.isRecentLoading;\n\t\t},\n\t\tisServerSearch(): boolean\n\t\t{\n\t\t\treturn this.cleanQuery.length >= this.minTokenSize;\n\t\t},\n\t\tneedToShowNetworkSection(): boolean\n\t\t{\n\t\t\treturn !this.isNetworkButtonClicked || this.result.network.size > 0;\n\t\t},\n\t\tshowSearchResult(): boolean\n\t\t{\n\t\t\treturn this.cleanQuery.length > 0;\n\t\t},\n\t\tisNetworkSearchCode(): boolean\n\t\t{\n\t\t\treturn !!(this.cleanQuery.length === 32 && /[\\da-f]{32}/.test(this.cleanQuery));\n\t\t},\n\t\tisNetworkSectionAvailable(): boolean\n\t\t{\n\t\t\tif (!this.searchService.isNetworkAvailable())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.isNetworkSearchEnabled || this.isNetworkSearchCode;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tcleanQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.startSearch(newQuery);\n\t\t},\n\t\tsearchMode(newValue, oldValue)\n\t\t{\n\t\t\t// search switched on and we have recent items\n\t\t\tif (newValue === true && oldValue === false && this.result.recent.size > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newValue === false && oldValue === true) // search switched off\n\t\t\t{\n\t\t\t\tthis.isNetworkButtonClicked = false;\n\t\t\t\tthis.searchService.disableNetworkSearch();\n\t\t\t}\n\n\t\t\tthis.loadRecentSearchFromServer();\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\n\t\tthis.searchService = new SearchService(this.searchConfig);\n\t\tprovide('searchService', this.searchService);\n\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 1500, this);\n\n\t\tEventEmitter.subscribe(EventType.search.openContextMenu, this.onOpenContextMenu);\n\t\tEventEmitter.subscribe(EventType.dialog.errors.accessDenied, this.onDelete);\n\t\tEventEmitter.subscribe(EventType.search.keyPressed, this.onPressEnterKey);\n\n\t\tthis.loadInitialRecentResult();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.searchService.destroy();\n\t\tthis.contextMenuManager.destroy();\n\t\tEventEmitter.unsubscribe(EventType.search.openContextMenu, this.onOpenContextMenu);\n\t\tEventEmitter.unsubscribe(EventType.dialog.errors.accessDenied, this.onDelete);\n\t\tEventEmitter.unsubscribe(EventType.search.keyPressed, this.onPressEnterKey);\n\t},\n\tmethods:\n\t{\n\t\tloadInitialRecentResult()\n\t\t{\n\t\t\tthis.searchService.loadRecentUsers().then(items => {\n\t\t\t\tthis.result.recentUsers = items;\n\t\t\t});\n\n\t\t\t// we don't need an extra request to get recent items while messenger initialization\n\t\t\tthis.searchService.loadRecentSearchFromCache().then(recentItems => {\n\t\t\t\tif (recentItems.size > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.result.recent = recentItems;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.loadRecentSearchFromServer();\n\t\t\t});\n\t\t},\n\t\tloadRecentSearchFromServer()\n\t\t{\n\t\t\tthis.isRecentLoading = true;\n\t\t\tthis.searchService.loadRecentSearchFromServer().then(recentItemsFromServer => {\n\t\t\t\tthis.result.recent = recentItemsFromServer;\n\t\t\t\tthis.isRecentLoading = false;\n\t\t\t});\n\t\t},\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.search.search-result');\n\t\t\tconst defaultMinTokenSize = 3;\n\t\t\tthis.minTokenSize = settings.get('minTokenSize', defaultMinTokenSize);\n\t\t\tthis.isNetworkSearchEnabled = settings.get('isNetworkSearchEnabled', true);\n\t\t},\n\t\tstartSearch(query: string)\n\t\t{\n\t\t\tif (query.length > 0 && query.length < this.minTokenSize)\n\t\t\t{\n\t\t\t\tthis.isLocalLoading = true;\n\t\t\t\tconst queryBeforeRequest = query;\n\t\t\t\tthis.searchService.searchLocal(query).then((localSearchResult: Map<string, SearchItem>) => {\n\t\t\t\t\tif (queryBeforeRequest !== this.cleanQuery)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.result.usersAndChats = localSearchResult;\n\t\t\t\t\tthis.isLocalLoading = false;\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (query.length >= this.minTokenSize)\n\t\t\t{\n\t\t\t\tthis.isServerLoading = true;\n\t\t\t\tconst queryBeforeRequest = query;\n\t\t\t\tthis.searchService.searchLocal(query).then((localSearchResult: Map<string, SearchItem>) => {\n\t\t\t\t\tif (queryBeforeRequest !== this.cleanQuery)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.isServerLoading = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.result.usersAndChats = localSearchResult;\n\t\t\t\t}).then(() => this.searchOnServerDelayed(query));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.result.usersAndChats = new Map();\n\t\t\tthis.result.departments = new Map();\n\t\t\tthis.result.chatUsers = new Map();\n\t\t\tthis.result.network = new Map();\n\t\t\tthis.result.openLines = new Map();\n\t\t},\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\t\t\tthis.isNetworkLoading = this.isNetworkButtonClicked;\n\n\t\t\tconst queryBeforeRequest = query;\n\t\t\tthis.searchService.searchOnServer(query).then((searchResultFromServer: Object) => {\n\t\t\t\tif (queryBeforeRequest !== this.cleanQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.stopLoader();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.result.usersAndChats = this.mergeResults(this.result.usersAndChats, searchResultFromServer.usersAndChats);\n\t\t\t\tthis.result.departments = searchResultFromServer.departments;\n\t\t\t\tthis.result.chatUsers = searchResultFromServer.chatUsers;\n\t\t\t\tthis.result.openLines = searchResultFromServer.openLines;\n\t\t\t\tthis.result.network = searchResultFromServer.network;\n\t\t\t}).catch(error => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t});\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isNetworkLoading = false;\n\t\t\tthis.isServerLoading = false;\n\t\t},\n\t\tmergeResults(originalItems: Map<string, SearchItem>, newItems: Map<string, SearchItem>): Map<string, SearchItem>\n\t\t{\n\t\t\tconst mergedMap = new Map(originalItems.entries());\n\n\t\t\tnewItems.forEach((newItemValue, newItemKey) => {\n\t\t\t\tif (!mergedMap.has(newItemKey))\n\t\t\t\t{\n\t\t\t\t\tmergedMap.set(newItemKey, newItemValue);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn mergedMap;\n\t\t},\n\t\tonOpenContextMenu(event: BaseEvent)\n\t\t{\n\t\t\tconst {item, nativeEvent} = event.getData();\n\n\t\t\tif (Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.contextMenuManager.openMenu(item, nativeEvent.currentTarget);\n\t\t},\n\t\tonDelete({data: eventData})\n\t\t{\n\t\t\tconst {dialogId} = eventData;\n\t\t\tthis.result.recent.delete(dialogId);\n\t\t\tthis.result.usersAndChats.delete(dialogId);\n\t\t\tthis.result.chatUsers.delete(dialogId);\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tthis.$emit('scroll', event);\n\t\t\tthis.contextMenuManager.destroy();\n\t\t},\n\t\tonClickLoadNetworkResult()\n\t\t{\n\t\t\tthis.isNetworkLoading = true;\n\n\t\t\tconst originalQuery = this.cleanQuery;\n\t\t\tthis.searchService.searchOnNetwork(originalQuery).then((searchResultFromServer: Map<string, SearchItem>) => {\n\t\t\t\tthis.isNetworkLoading = false;\n\t\t\t\tif (originalQuery !== this.cleanQuery)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.result.network = searchResultFromServer;\n\t\t\t\tthis.isNetworkButtonClicked = true;\n\t\t\t});\n\t\t},\n\t\tonClickItem(event: {selectedItem: SearchItem, selectedStatus: boolean, nativeEvent: KeyboardEvent})\n\t\t{\n\t\t\tif (!this.searchMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst {selectedItem, nativeEvent} = event;\n\t\t\tif (this.selectMode)\n\t\t\t{\n\t\t\t\tthis.$emit('selectItem', event);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tMessenger.openChat(selectedItem.getDialogId());\n\t\t\t}\n\n\t\t\tif (!Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.search.close);\n\t\t\t}\n\t\t},\n\t\tonPressEnterKey(event: BaseEvent)\n\t\t{\n\t\t\tif (this.selectMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst {keyboardEvent} = event.getData();\n\n\t\t\tif (!Utils.key.isCombination(keyboardEvent, 'Enter'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst firstItem = this.getFirstItemFromSearchResults();\n\t\t\tif (!firstItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.onClickItem({\n\t\t\t\tselectedItem: firstItem,\n\t\t\t\tnativeEvent: keyboardEvent\n\t\t\t});\n\t\t},\n\t\tgetFirstItemFromSearchResults(): ?SearchItem\n\t\t{\n\t\t\tif (!this.showSearchResult && this.result.recent.size > 0)\n\t\t\t{\n\t\t\t\treturn SearchUtils.getFirstItemFromMap(this.result.recent);\n\t\t\t}\n\n\t\t\tif (this.result.usersAndChats.size > 0)\n\t\t\t{\n\t\t\t\treturn SearchUtils.getFirstItemFromMap(this.result.usersAndChats);\n\t\t\t}\n\n\t\t\tif (this.result.chatUsers.size > 0)\n\t\t\t{\n\t\t\t\treturn SearchUtils.getFirstItemFromMap(this.result.chatUsers);\n\t\t\t}\n\n\t\t\tif (this.result.openLines.size > 0)\n\t\t\t{\n\t\t\t\treturn SearchUtils.getFirstItemFromMap(this.result.openLines);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-result__container bx-im-search-result__scope\" @scroll=\"onScroll\">\n\t\t\t<template v-if=\"!showSearchResult\">\n\t\t\t\t<RecentUsersCarousel \n\t\t\t\t\t:items=\"result.recentUsers\"\n\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t:selectedItems=\"selectedItems\"\n\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t/>\n\t\t\t\t<SearchResultSection\n\t\t\t\t\t:component=\"itemComponent\"\n\t\t\t\t\t:items=\"result.recent\"\n\t\t\t\t\t:showMoreButton=\"false\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_RECENT')\"\n\t\t\t\t\t:canBeFolded=\"false\"\n\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t:selectedItems=\"selectedItems\"\n\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<SearchResultSection\n\t\t\t\t\tv-if=\"result.usersAndChats.size > 0\"\n\t\t\t\t\t:component=\"itemComponent\"\n\t\t\t\t\t:items=\"result.usersAndChats\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_USERS_AND_CHATS')\"\n\t\t\t\t\t:min-items:=\"20\"\n\t\t\t\t\t:max-items=\"50\"\n\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t:selectedItems=\"selectedItems\"\n\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t/>\n\t\t\t\t<template v-if=\"!isLoadingState && isServerSearch\">\n\t\t\t\t\t<SearchResultSection\n\t\t\t\t\t\tv-if=\"result.chatUsers.size > 0\"\n\t\t\t\t\t\t:component=\"itemComponent\"\n\t\t\t\t\t\t:items=\"result.chatUsers\"\n\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_CHAT_USERS')\"\n\t\t\t\t\t\t:min-items:=\"5\"\n\t\t\t\t\t\t:max-items=\"20\"\n\t\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t\t:selectedItems=\"selectedItems\"\n\t\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t\t/>\n\t\t\t\t\t<SearchResultSection\n\t\t\t\t\t\tv-if=\"result.departments.size > 0\"\n\t\t\t\t\t\t:component=\"itemDepartmentComponent\"\n\t\t\t\t\t\t:items=\"result.departments\"\n\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_DEPARTMENTS')\"\n\t\t\t\t\t\t:min-items:=\"5\"\n\t\t\t\t\t\t:max-items=\"20\"\n\t\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t\t:selectedItems=\"selectedItems\"\n\t\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t\t/>\n\t\t\t\t\t<template v-if=\"isNetworkSectionAvailable\">\n\t\t\t\t\t\t<SearchResultSection\n\t\t\t\t\t\t\tv-if=\"needToShowNetworkSection\"\n\t\t\t\t\t\t\t:component=\"itemNetworkComponent\"\n\t\t\t\t\t\t\t:items=\"result.network\"\n\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_NETWORK')\"\n\t\t\t\t\t\t\t:canBeFolded=\"isNetworkButtonClicked\"\n\t\t\t\t\t\t\t:min-items:=\"5\"\n\t\t\t\t\t\t\t:max-items=\"20\"\n\t\t\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t\t\t:selectedItems=\"selectedItems\"\n\t\t\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class=\"bx-im-search-result__network-button-container\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tv-if=\"!isNetworkButtonClicked\"\n\t\t\t\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_NETWORK_BUTTON')\"\n\t\t\t\t\t\t\t\t:color=\"ButtonColor.Primary\"\n\t\t\t\t\t\t\t\t:size=\"ButtonSize.L\"\n\t\t\t\t\t\t\t\t:isLoading=\"isNetworkLoading\"\n\t\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t\t@click=\"onClickLoadNetworkResult\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\t\t\t\t<div v-if=\"isEmptyState\" class=\"bx-im-search-result__empty-state-container\">\n\t\t\t\t\t<div class=\"bx-im-search-result__empty-state-icon\"></div>\n\t\t\t\t\t<div class=\"bx-im-search-result__empty-state-title\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SEARCH_RESULT_NOT_FOUND') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-search-result__empty-state-subtitle\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SEARCH_RESULT_NOT_FOUND_DESCRIPTION') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div v-if=\"isLoadingState\" class=\"bx-im-search-result__loader-container\">\n\t\t\t\t<Loader />\n\t\t\t</div>\n\t\t</div>\n\t`\n};"],"names":["SearchUtils","getWordsFromString","string","clearedString","replaceAll","replace","split","filter","word","getTypeByEntityId","entityId","SearchEntityIdTypes","user","bot","chat","chatUser","department","network","Error","createItemMap","items","map","Map","forEach","item","mapItem","SearchItem","set","getEntityFullId","getFirstItemFromMap","iterator","entries","firstIteration","next","firstItem","value","content","convertKeysToLowerCase","object","result","Object","keys","key","Type","isObject","isArray","toLowerCase","convertKeysToUpperCase","toUpperCase","prepareRecentItems","recentItems","id","type","cacheId","date","Date","constructor","itemOptions","entityType","dialogId","title","subtitle","name","lastName","secondName","position","avatar","avatarOptions","customSort","contextSort","fromStore","rawData","isFromModel","isString","dialog","getId","getEntityId","getEntityType","getTitle","getSubtitle","getName","getLastName","getSecondName","getPosition","getCustomData","customData","getDialogId","getAvatar","getAvatarOptions","getContextSort","addCustomSort","getCustomSort","isUser","imUser","ID","isChat","includes","isExtranet","EXTRANET","imChat","extranet","getUserCustomData","getChatCustomData","isOpeLinesType","isDepartmentType","isNetworkType","getOpenlineEntityId","ENTITY_ID","toString","getAvatarColor","color","COLOR","isCrmSession","sessionData","ENTITY_DATA_1","isNil","startsWith","slice","Number","parseInt","DialogType","firstName","workPosition","decodeURI","CHAT_TYPE_OPEN","CHAT_TYPE_PRIVATE","Config","config","Core","getStore","Extension","getSettings","getUserId","getRecentRequestConfig","entities","getSearch","getDepartmentUsers","getNetwork","enableNetworkSearch","disableNetworkSearch","isItemAllowed","isNetworkAvailable","get","entity","preselectedItems","clearUnavailableItems","context","options","searchableBotTypes","fillDialogWithDefaultValues","dynamicLoad","dynamicSearch","filters","searchableChatTypes","selectMode","allowSelectRootDepartment","chats","bots","departments","currentUser","getters","excludeUsers","StoreUpdater","UserManager","update","updateConfig","onlyAdd","users","dialogues","cleanedUsers","Promise","all","addUsersToModel","setUsersToModel","dispatch","last_activity_date","mobile_last_date","status","idle","absent","birthday","preparedUser","push","LayoutManager","changeLayout","query","BX","correctText","replace_way","needLayoutChange","originalLayoutQuery","wrongLayoutQuery","isIdenticalQuery","getLanguageId","SortingResult","store","layoutManager","sortItemsByEntityIdAndContextSort","entityWeight","sort","secondItem","firstItemValue","secondItemValue","secondItemEntityId","firstItemEntityId","allocateSearchResults","usersAndChats","chatUsers","openLines","getSortedItems","sortItemsBySearchField","queryWords","wrongLayoutQueryWords","uniqueWords","Set","searchFieldsWeight","sortedItems","collator","Intl","Collator","undefined","sensitivity","RecentStateSearchService","load","recentUsers","recentItem","search","wrongLayoutSearchPromise","resolve","getItemsFromRecentListByQuery","correctLayoutSearchPromise","then","getFromStore","recentListItems","getRecentListItems","foundItems","recentListItem","searchByQueryWords","searchByUserFields","searchByDialogFields","searchField","dialogNameWords","doesItemMatchQuery","userFirstNameWords","userLastNameWords","userWorkPositionWords","fieldsForSearch","found","queryWord","queryWordsMatchCount","field","length","compare","IndexedDbConnection","getInstance","currentUserId","instance","db","Dexie","version","stores","settings","upgrade","transaction","clearItemsPromise","table","clear","clearRecentItemsPromise","checkTables","onAccessDeniedHandler","onAccessDenied","bind","EventEmitter","subscribe","EventType","errors","accessDenied","open","on","where","equals","first","promises","put","destroy","unsubscribe","loadRecentFromCache","searchResults","deleteExpiredItems","orderBy","toArray","recentItemsFromCache","resultItemsPromises","isUndefined","json","save","preparedItems","prepareItems","preparedRecentItems","bulkPut","oneMonthAgo","now","below","delete","data","eventData","convertDialogIdToCacheItemId","WORK_POSITION","unshiftItem","itemToMove","itemToMoveEntityId","itemToMoveId","itemToMoveCacheId","itemIndexToUpdate","findIndex","splice","unshift","words","results","getQueryResultByWords","isArrayFilled","intersectedResult","intersectArrays","distinctIds","flat","anyOf","record","some","fieldToCompare","distinct","primaryKeys","firstArray","secondArray","restArrays","intersectedArray","IndexedDbSearchService","responseFromCache","Logger","warn","itemMap","getItemsFromCacheByQuery","catch","error","console","cacheItems","BaseServerSearchService","searchConfig","searchRequest","searchQuery","reject","Ajax","runAction","response","loadRecentFromServer","addItemsToRecentSearchResults","RestMethodImopenlinesNetworkJoin","NetworkSearchService","trim","loadItem","networkCode","code","RestMethod","imUserGet","callBatch","DepartmentSearchService","loadUsers","parentItem","SearchService","storeUpdater","sortingResult","recentStateSearchService","indexedDbSearchService","baseServerSearchService","networkSearchService","departmentSearchService","loadRecentSearchFromCache","loadRecentUsers","updateStore","loadRecentSearchFromServer","responseFromServer","searchLocal","searchInCachePromise","searchInRecentListPromise","itemsFromCache","itemsFromRecent","itemsFromCacheProcessed","itemsFromRecentProcessed","searchOnServer","itemsFromServer","searchOnNetwork","loadDepartmentUsers","loadNetworkItem","addItemToRecent","selectedItem","filteredItems","filledRecentItems","itemFromMap","SearchContextMenu","RecentMenu","getMenuItems","getSendMessageItem","getCallItem","getHistoryItem","getOpenProfileItem","CarouselUser","components","Avatar","props","required","Boolean","default","isSelected","emits","selected","computed","AvatarSize","searchItem","userId","$store","userDialogId","watch","newValue","oldValue","created","contextMenuManager","beforeUnmount","methods","onClick","event","$emit","selectedStatus","nativeEvent","onRightClick","altKey","shiftKey","emit","openContextMenu","template","recentUsersLimit","RecentUsersCarousel","selectedItems","Array","itemsFromMap","values","SearchResultSection","ExpandAnimation","component","String","showMoreButton","minItems","maxItems","canBeFolded","expanded","folded","showMore","size","showMoreButtonText","$Bitrix","Loc","getMessage","sectionItems","onFoldSection","onShowMore","SearchResultNetworkItem","Loader","inject","isLoading","hasAvatar","isStringFilled","avatarStyles","backgroundSize","backgroundPosition","backgroundColor","backgroundImage","Text","decode","searchService","finally","SearchResultItem","ChatTitle","userItemText","chatItemText","itemText","selectedStyles","SearchResultDepartmentItem","usersInDepartment","departmentAvatarStyle","openDepartment","SearchResult","Button","searchMode","isRecentLoading","isLocalLoading","isServerLoading","isNetworkLoading","currentServerQueries","isNetworkButtonClicked","recent","ButtonSize","ButtonColor","itemComponent","itemDepartmentComponent","itemNetworkComponent","cleanQuery","isEmptyState","isNetworkSectionAvailable","isServerSearch","isLoadingState","minTokenSize","needToShowNetworkSection","showSearchResult","isNetworkSearchCode","test","isNetworkSearchEnabled","newQuery","previousQuery","startSearch","initSettings","provide","searchOnServerDelayed","Runtime","debounce","onOpenContextMenu","onDelete","keyPressed","onPressEnterKey","loadInitialRecentResult","recentItemsFromServer","defaultMinTokenSize","queryBeforeRequest","localSearchResult","cleanSearchResult","searchResultFromServer","stopLoader","mergeResults","originalItems","newItems","mergedMap","newItemValue","newItemKey","has","getData","Utils","isAltOrOption","openMenu","currentTarget","onScroll","onClickLoadNetworkResult","originalQuery","onClickItem","Messenger","openChat","close","keyboardEvent","isCombination","getFirstItemFromSearchResults"],"mappings":"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"}