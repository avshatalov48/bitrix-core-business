{"version":3,"file":"script.js","sources":["src/pages/base-page.js","src/pages/error-page.js","src/pages/install-page.js","src/buttons/einvoice-app-button.js","src/pages/selection-page.js","src/providers/page-provider.js","src/envoice-installer.js"],"sourcesContent":["import { Tag } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nexport class BasePage extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Rest.EInvoiceInstaller.Page');\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tthrow new Error('Must be implemented in a child class');\n\t}\n\n\tgetIcon(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"bitrix-einvoice-installer-main-icon-wrapper\">\n\t\t\t\t<div class=\"bitrix-einvoice-installer-main-icon\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tstatic getType(): string\n\t{\n\t\tthrow new Error('Must be implemented in a child class');\n\t}\n}\n","import { Tag, Loc } from 'main.core';\nimport { Button } from 'ui.buttons';\nimport { BasePage } from './base-page';\n\nexport class ErrorPage extends BasePage\n{\n\t#content: HTMLElement;\n\t#button: HTMLElement;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Rest.EInvoiceInstaller.ErrorPage');\n\t}\n\n\tstatic getType(): string\n\t{\n\t\treturn 'error';\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tif (!this.#content)\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"bitrix-einvoice-installer-content --error-content\">\n\t\t\t\t\t<div class=\"bitrix-einvoice-installer-error-icon\"></div>\n\t\t\t\t\t<div class=\"bitrix-einvoice-installer-title-install\">${Loc.getMessage('REST_EINVOICE_INSTALLER_ERROR_TITLE')}</div>\n\t\t\t\t\t${this.#getButton()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#content;\n\t}\n\n\t#getButton(): HTMLElement\n\t{\n\t\tif (!this.#button)\n\t\t{\n\t\t\tthis.#button = (new Button({\n\t\t\t\ttext: Loc.getMessage('REST_EINVOICE_INSTALLER_ERROR_BUTTON'),\n\t\t\t\tsize: Button.Size.LARGE,\n\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\tclassName: 'bitrix-einvoice-installer-button-try-again',\n\t\t\t\tonclick: () => {\n\t\t\t\t\tthis.emit('go-back');\n\t\t\t\t},\n\t\t\t})).getContainer();\n\t\t}\n\n\t\treturn this.#button;\n\t}\n}","import { Tag, Loc } from 'main.core';\nimport { Loader } from 'main.loader';\nimport { BasePage } from './base-page';\nimport { ajax } from 'main.core';\nimport { AppForm } from 'rest.app-form';\n\nexport class InstallPage extends BasePage\n{\n\t#content: ?HTMLElement;\n\t#title: ?HTMLElement;\n\t#loader: ?HTMLElement;\n\n\tstatic getType(): string\n\t{\n\t\treturn 'install';\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Rest.EInvoiceInstaller.InstallPage');\n\t\tthis.subscribe('install-app', (event) => {\n\t\t\tthis.#getLoader().show();\n\t\t\tconst installer = event.data.source;\n\t\t\tevent.data.install\n\t\t\t\t.then((response) => {\n\t\t\t\t\tif (!response.status)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn Promise.reject();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn AppForm.buildByApp(response.data.id);\n\t\t\t\t})\n\t\t\t\t.then((appForm) => {\n\t\t\t\t\tthis.#getLoader().hide();\n\t\t\t\t\tappForm.show();\n\t\t\t\t\tinstaller.render('selection');\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\tthis.#getLoader().hide();\n\t\t\t\tthis.#onAfterUnsuccessfulInstallApplication();\n\t\t\t});\n\t\t});\n\t}\n\n\t#onAfterUnsuccessfulInstallApplication(): void\n\t{\n\t\tthis.emit('install-error');\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tif (!this.#content)\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"bitrix-einvoice-installer-content\">\n\t\t\t\t\t${this.#getTitle()}\n\t\t\t\t\t<div class=\"bitrix-einvoice-installer-loader-wrapper-install\"/>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#content;\n\t}\n\n\t#getTitle(): HTMLElement\n\t{\n\t\tif (!this.#title)\n\t\t{\n\t\t\tthis.#title = Tag.render`\n\t\t\t\t<div class=\"bitrix-einvoice-installer-title-install\">\n\t\t\t\t\t${Loc.getMessage('REST_EINVOICE_INSTALLER_INSTALL_TITLE')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#title;\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (!this.#loader)\n\t\t{\n\t\t\tthis.#loader = new Loader({\n\t\t\t\ttarget: this.getContent().querySelector('.bitrix-einvoice-installer-loader-wrapper-install'),\n\t\t\t\tsize: 90,\n\t\t\t\tcolor: '#2FC6F6',\n\t\t\t\tmode: 'inline',\n\t\t\t});\n\t\t}\n\n\t\treturn this.#loader;\n\t}\n}\n","import { Tag, Loc, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { PopupComponentsMaker } from 'ui.popupcomponentsmaker';\nimport { Button } from 'ui.buttons';\nimport type { FormConfiguration } from '../types';\nimport { AppConfig } from '../types';\n\nexport class EInvoiceAppButton extends EventEmitter\n{\n\t#popup: ?PopupComponentsMaker;\n\t#apps: Array<AppConfig>;\n\t#popupContent: ?Array;\n\t#formConfiguration: FormConfiguration;\n\n\tconstructor(apps: Array<AppConfig>, formConfiguration: FormConfiguration)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Rest.EInvoiceAppButton');\n\t\tthis.#apps = apps;\n\t\tthis.#formConfiguration = formConfiguration;\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tconst button = new Button({\n\t\t\ttext: Loc.getMessage('REST_EINVOICE_INSTALLER_SELECTION_BUTTON'),\n\t\t\tsize: Button.Size.LARGE,\n\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\tdropdown: true,\n\t\t\tclassName: 'bitrix-einvoice-installer-button-select',\n\t\t\tonclick: (event) => {\n\t\t\t\tconst popup = this.#getPopup(event.button);\n\t\t\t\tpopup.getPopup().setMaxWidth(event.button.offsetWidth);\n\t\t\t\tpopup.getPopup().toggle();\n\t\t\t},\n\t\t});\n\n\t\treturn button.getContainer();\n\t}\n\n\t#getPopup(bindElement: HTMLElement): PopupComponentsMaker\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\treturn this.#popup;\n\t\t}\n\n\t\tthis.#popup = new PopupComponentsMaker({\n\t\t\ttarget: bindElement,\n\t\t\tcontent: this.#getPopupContent(),\n\t\t\tuseAngle: false,\n\t\t});\n\t\tthis.#popup.getPopup().setOffset({\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t});\n\t\tthis.subscribe('popup-close', () => {\n\t\t\tthis.#popup.close();\n\t\t});\n\n\t\treturn this.#popup;\n\t}\n\n\t#getPopupContent(): Array\n\t{\n\t\tif (this.#popupContent)\n\t\t{\n\t\t\treturn this.#popupContent;\n\t\t}\n\n\t\tthis.#popupContent = [];\n\t\tthis.#apps.forEach((app) => {\n\t\t\tconst onclick = () => {\n\t\t\t\tthis.emit('popup-close');\n\t\t\t\tthis.emit('click-app', new BaseEvent({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcode: app.code,\n\t\t\t\t\t\tname: app.name,\n\t\t\t\t\t},\n\t\t\t\t}));\n\t\t\t};\n\t\t\tthis.#popupContent.push({\n\t\t\t\thtml: Tag.render`\n\t\t\t\t\t<div onclick=\"${onclick}\" class=\"bitrix-einvoice-installer-app-wrapper\">\n\t\t\t\t\t\t<div class=\"bitrix-einvoice-installer-app-name\">\n\t\t\t\t\t\t\t${Text.encode(app.name)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t});\n\t\t});\n\n\t\tconst showForm = () => {\n\t\t\tthis.#showFormForOffer();\n\t\t\tthis.emit('popup-close');\n\t\t};\n\t\tthis.#popupContent.push({\n\t\t\thtml: Tag.render`\n\t\t\t\t<div onclick=\"${showForm}\" class=\"bitrix-einvoice-installer-app-wrapper --form\">\n\t\t\t\t\t${Loc.getMessage('REST_EINVOICE_INSTALLER_SELECTION_BUTTON_OFFER')}\n\t\t\t\t</div>\n\t\t\t`,\n\t\t});\n\n\t\treturn this.#popupContent;\n\t}\n\n\t#showFormForOffer(): void\n\t{\n\t\tBX.UI.Feedback.Form.open({\n\t\t\tid: 'b5309667',\n\t\t\tforms: [\n\t\t\t\t{ zones: ['es'], id: 676, lang: 'es', sec: 'uthphh' },\n\t\t\t\t{ zones: ['de'], id: 670, lang: 'de', sec: 'gk89kt' },\n\t\t\t\t{ zones: ['com.br'], id: 668, lang: 'br', sec: 'kuelnm' },\n\t\t\t],\n\t\t\tdefaultForm: { id: 674, lang: 'en', sec: '5iorws' },\n\t\t\tpresets: {\n\t\t\t\t...this.#formConfiguration,\n\t\t\t\tsender_page: document.location.href,\n\t\t\t},\n\t\t});\n\t}\n}\n","import { Tag, Loc } from 'main.core';\nimport { EInvoiceAppButton } from '../buttons/einvoice-app-button';\nimport type { FormConfiguration } from '../types';\nimport { BasePage } from './base-page';\nimport { AppConfig } from '../types';\n\nexport class SelectionPage extends BasePage\n{\n\t#content: ?HTMLElement;\n\t#title: ?HTMLElement;\n\t#description: ?HTMLElement;\n\t#button: ?HTMLElement;\n\t#apps: Array<AppConfig>;\n\t#formConfiguration: FormConfiguration;\n\t#moreInformation: ?HTMLElement;\n\n\tconstructor(apps: Array<AppConfig>, formConfiguration: FormConfiguration)\n\t{\n\t\tsuper();\n\t\tthis.#apps = apps;\n\t\tthis.#formConfiguration = formConfiguration;\n\t\tthis.setEventNamespace('BX.Rest.EInvoiceInstaller.SelectionPage');\n\t}\n\n\tstatic getType(): string\n\t{\n\t\treturn 'selection';\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tif (!this.#content)\n\t\t{\n\t\t\tthis.#content = Tag.render`\n\t\t\t\t<div class=\"bitrix-einvoice-installer-content\">\n\t\t\t\t\t${this.#getTitle()}\n\t\t\t\t\t${this.#getDescription()}\n\t\t\t\t\t${this.#getButton()}\n\t\t\t\t\t${this.#getMoreInformation()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#content;\n\t}\n\n\t#getTitle(): HTMLElement\n\t{\n\t\tif (!this.#title)\n\t\t{\n\t\t\tthis.#title = Tag.render`\n\t\t\t\t<div class=\"bitrix-einvoice-installer-title__wrapper\">\n\t\t\t\t\t<div class=\"bitrix-einvoice-installer-title__main-text\">\n\t\t\t\t\t\t${Loc.getMessage('REST_EINVOICE_INSTALLER_SELECTION_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#title;\n\t}\n\n\t#getDescription(): HTMLElement\n\t{\n\t\tif (!this.#description)\n\t\t{\n\t\t\tthis.#description = Tag.render`\n\t\t\t\t<div class=\"bitrix-einvoice-installer-description\">\n\t\t\t\t\t${Loc.getMessage('REST_EINVOICE_INSTALLER_SELECTION_DESCRIPTION')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#description;\n\t}\n\n\t#getButton(): HTMLElement\n\t{\n\t\tif (this.#button)\n\t\t{\n\t\t\treturn this.#button;\n\t\t}\n\n\t\tconst buttonConstructor = new EInvoiceAppButton(this.#apps, this.#formConfiguration);\n\t\tthis.#button = buttonConstructor.getContent();\n\t\tbuttonConstructor.subscribe('click-app', (event) => {\n\t\t\tthis.emit('start-install-app', event);\n\t\t});\n\n\t\treturn this.#button;\n\t}\n\n\t#getMoreInformation(): HTMLElement\n\t{\n\t\tif (this.#moreInformation)\n\t\t{\n\t\t\treturn this.#moreInformation;\n\t\t}\n\n\t\tconst onclick = () => {\n\t\t\ttop.BX.Helper.show('redirect=detail&code=19312840');\n\t\t};\n\n\t\tthis.#moreInformation = Tag.render`\n\t\t\t<div class=\"bitrix-einvoice-installer-more-information-wrapper\">\n\t\t\t\t<div onclick=\"${onclick}\" class=\"bitrix-einvoice-installer-more-information-link\">\n\t\t\t\t\t${Loc.getMessage('REST_EINVOICE_INSTALLER_MORE')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#moreInformation;\n\t}\n}","import type { EInvoiceInstallerOptions } from '../types';\nimport { BasePage } from '../pages/base-page';\nimport { ErrorPage } from '../pages/error-page';\nimport { InstallPage } from '../pages/install-page';\nimport { SelectionPage } from '../pages/selection-page';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nexport class PageProvider extends EventEmitter\n{\n\t#selectionPage: SelectionPage;\n\t#installPage: InstallPage;\n\t#errorPage: ErrorPage;\n\t#options: EInvoiceInstallerOptions;\n\t#types: string[];\n\n\tconstructor(options: EInvoiceInstallerOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Rest.EInvoiceInstaller.PageProvider');\n\t\tthis.#options = options;\n\t\tthis.#types = [\n\t\t\tSelectionPage.getType(),\n\t\t\tInstallPage.getType(),\n\t\t\tErrorPage.getType(),\n\t\t];\n\t}\n\n\texist(type: string): boolean\n\t{\n\t\treturn this.#types.includes(type);\n\t}\n\n\tgetPageByType(type: string): BasePage\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase SelectionPage.getType():\n\t\t\t\treturn this.#getSelectionPage();\n\t\t\tcase InstallPage.getType():\n\t\t\t\treturn this.#getInstallPage();\n\t\t\tcase ErrorPage.getType():\n\t\t\t\treturn this.#getErrorPage();\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Incorrect page type');\n\t\t}\n\t}\n\n\t#getSelectionPage(): SelectionPage\n\t{\n\t\tif (!this.#selectionPage)\n\t\t{\n\t\t\tthis.#selectionPage = new SelectionPage(this.#options.apps, this.#options.formConfiguration);\n\t\t\tthis.#registerPageHandlers(this.#selectionPage);\n\t\t\tthis.#selectionPage.subscribe('start-install-app', () => {\n\t\t\t\tthis.emit('render', new BaseEvent({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttype: InstallPage.getType(),\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t})\n\t\t}\n\n\t\treturn this.#selectionPage;\n\t}\n\n\t#getInstallPage(): InstallPage\n\t{\n\t\tif (!this.#installPage)\n\t\t{\n\t\t\tthis.#installPage = new InstallPage();\n\t\t\tthis.#registerPageHandlers(this.#installPage);\n\t\t}\n\n\t\treturn this.#installPage;\n\t}\n\n\t#getErrorPage(): ErrorPage\n\t{\n\t\tif (!this.#errorPage)\n\t\t{\n\t\t\tthis.#errorPage = new ErrorPage();\n\t\t\tthis.#registerPageHandlers(this.#errorPage);\n\t\t}\n\n\t\treturn this.#errorPage;\n\t}\n\n\t#registerPageHandlers(page: BasePage): void\n\t{\n\t\tpage.subscribe('go-back', () => {\n\t\t\tthis.emit('render', new BaseEvent({\n\t\t\t\tdata: {\n\t\t\t\t\ttype: SelectionPage.getType(),\n\t\t\t\t},\n\t\t\t}));\n\t\t});\n\t\tpage.subscribe('install-error', () => {\n\t\t\tthis.emit('render', new BaseEvent({\n\t\t\t\tdata: {\n\t\t\t\t\ttype: ErrorPage.getType(),\n\t\t\t\t},\n\t\t\t}));\n\t\t});\n\t}\n}\n","import { ajax, Dom } from 'main.core';\nimport { PageProvider } from './providers/page-provider';\nimport type { EInvoiceInstallerOptions } from './types';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Listener } from 'rest.listener';\nimport { AppForm } from 'rest.app-form';\n\nexport class EInvoiceInstaller extends EventEmitter\n{\n\t#options: EInvoiceInstallerOptions;\n\t#pageProvider: PageProvider;\n\t#formListener: Listener;\n\n\tconstructor(options: EInvoiceInstallerOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Rest.EInvoiceInstaller');\n\t\tthis.#options = options;\n\t\tthis.render('selection');\n\t\tthis.#getPageProvider().getPageByType('selection').subscribe('start-install-app', this.#onStartInstall.bind(this));\n\t}\n\n\trender(pageType: string): void\n\t{\n\t\tif (this.#getPageProvider().exist(pageType))\n\t\t{\n\t\t\tDom.clean(this.#options.wrapper);\n\t\t\tconst page = this.#getPageProvider().getPageByType(pageType);\n\t\t\tDom.append(page.getContent(), this.#options.wrapper);\n\n\t\t\tif (pageType !== 'error')\n\t\t\t{\n\t\t\t\tDom.append(page.getIcon(), this.#options.wrapper);\n\t\t\t}\n\t\t}\n\t}\n\n\t#installApplicationByCode(code: string): Promise\n\t{\n\t\treturn ajax.runComponentAction('bitrix:rest.einvoice.installer', 'installApplicationByCode', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\tcode: code,\n\t\t\t},\n\t\t});\n\t}\n\n\t#onStartInstall(event: BaseEvent): void\n\t{\n\t\tthis.#getPageProvider().getPageByType('install').emit('install-app', new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tsource: this,\n\t\t\t\tcode: event.data.code,\n\t\t\t\tname: event.data.name,\n\t\t\t\tinstall: this.#installApplicationByCode(event.data.code),\n\t\t\t},\n\t\t}));\n\t}\n\n\t#getPageProvider(): PageProvider\n\t{\n\t\tif (!this.#pageProvider)\n\t\t{\n\t\t\tthis.#pageProvider = new PageProvider(this.#options);\n\t\t\tthis.#pageProvider.subscribe('render', (event) => {\n\t\t\t\tthis.render(event.data.type);\n\t\t\t});\n\t\t}\n\n\t\treturn this.#pageProvider;\n\t}\n}"],"names":["BasePage","setEventNamespace","Error","Tag","render","EventEmitter","ErrorPage","Loc","getMessage","Button","text","size","Size","LARGE","color","Color","SUCCESS","className","onclick","emit","getContainer","InstallPage","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","subscribe","event","_classPrivateMethodGet","show","installer","data","source","install","then","response","status","Promise","reject","AppForm","buildByApp","id","appForm","hide","Loader","target","getContent","querySelector","mode","EInvoiceAppButton","apps","formConfiguration","button","dropdown","popup","getPopup","setMaxWidth","offsetWidth","toggle","bindElement","PopupComponentsMaker","content","useAngle","setOffset","offsetLeft","offsetTop","close","forEach","app","BaseEvent","code","name","push","html","Text","encode","showForm","BX","UI","Feedback","Form","open","forms","zones","lang","sec","defaultForm","presets","sender_page","document","location","href","SelectionPage","buttonConstructor","top","Helper","PageProvider","options","getType","type","includes","page","EInvoiceInstaller","getPageByType","bind","pageType","exist","Dom","clean","wrapper","append","getIcon","ajax","runComponentAction"],"mappings":"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"}