this.BX=this.BX||{};this.BX.Socialnetwork=this.BX.Socialnetwork||{};(function(t,e,s,a,i,o,n,c,r,l,d,p,h){"use strict";var u=babelHelpers.classPrivateFieldLooseKey("dontShowCollapseMenuAhaMoment");var S=babelHelpers.classPrivateFieldLooseKey("showSpotlight");var m=babelHelpers.classPrivateFieldLooseKey("showAhaMoment");class v{constructor(){Object.defineProperty(this,m,{value:I});Object.defineProperty(this,S,{value:g});Object.defineProperty(this,u,{value:b})}showAhaMoment(){const t=document.querySelector(".menu-items-header .menu-switcher");if(d.Type.isDomNode(t)){babelHelpers.classPrivateFieldLooseBase(this,S)[S](t)}babelHelpers.classPrivateFieldLooseBase(this,u)[u]()}}function b(){d.ajax.runAction("socialnetwork.api.ahamoment.dontShowCollapseMenuAhaMoment")}function g(t){d.Runtime.loadExtension(["spotlight","ui.tour"]).then((()=>{const e=new BX.SpotLight({targetElement:t,targetVertex:"middle-center"});d.Dom.addClass(t,"--active");e.bindEvents({onTargetEnter:()=>{d.Dom.removeClass(t,"--active");e.close()}});e.setColor("#2fc6f6");e.show();babelHelpers.classPrivateFieldLooseBase(this,m)[m](t,e)}))}async function I(t,e){const{Guide:s}=await d.Runtime.loadExtension("ui.tour");const a=new s({simpleMode:true,onEvents:true,steps:[{target:t,title:d.Loc.getMessage("SOCIALNETWORK_SPACES_COLLAPSE_MENU_AHA_MOMENT_TITLE"),text:d.Loc.getMessage("SOCIALNETWORK_SPACES_COLLAPSE_MENU_AHA_MOMENT_TEXT"),position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});a.showNextStep();const i=a.getPopup();i.setWidth(380);i.getContentContainer().style.paddingRight=getComputedStyle(i.closeIcon)["width"];i.setAngle({offset:t.offsetWidth/2-5});i.subscribe("onClose",(()=>e.close()));i.setAutoHide(true);i.getPopupContainer().style.marginLeft="5px";i.angle.element.style.left="-1px"}const f={state(){return{avatarColors:[],avatarColor:"29AD49"}},actions:{setAvatarColors:(t,e)=>{t.commit("setAvatarColors",e)},setAvatarColor:(t,e)=>{t.commit("setAvatarColor",e)}},mutations:{setAvatarColors:(t,e)=>{t.avatarColors=e},setAvatarColor:(t,e)=>{t.avatarColor=e}},getters:{avatarColors:t=>t.avatarColors,previousAvatarColor:t=>t.avatarColor}};class L{static async loadSpaces(t){const e="bitrix:socialnetwork.spaces.list";const s="loadSpaces";const a=await d.ajax.runComponentAction(e,s,{mode:"class",data:t});return a.data}static async reloadSpaces(t){const e="bitrix:socialnetwork.spaces.list";const s="reloadSpaces";const a=await d.ajax.runComponentAction(e,s,{mode:"class",data:t});return a.data}static async searchSpaces(t){const e="bitrix:socialnetwork.spaces.list";const s="searchSpaces";const a=await d.ajax.runComponentAction(e,s,{mode:"class",data:t});return a.data}static async loadRecentSearchSpaces(){const t="bitrix:socialnetwork.spaces.list";const e="loadRecentSearchSpaces";const s=await d.ajax.runComponentAction(t,e,{mode:"class"});return s.data}static async addSpaceToRecentSearch(t){const e="bitrix:socialnetwork.spaces.list";const s="addSpaceToRecentSearch";const a=await d.ajax.runComponentAction(e,s,{mode:"class",data:{spaceId:t}});return a.data}static async loadSpaceData(t){const e="bitrix:socialnetwork.spaces.list";const s="loadSpaceData";const a=await d.ajax.runComponentAction(e,s,{mode:"class",data:{spaceId:t}});return a.data}static async loadSpacesData(t){const e="bitrix:socialnetwork.spaces.list";const s="loadSpacesData";const a=await d.ajax.runComponentAction(e,s,{mode:"class",data:{spaceIds:t}});return a.data}static async loadSpaceTheme(t){const e="bitrix:socialnetwork.spaces.list";const s="loadSpaceTheme";const a=await d.ajax.runComponentAction(e,s,{mode:"class",data:{spaceId:t}});return a.data}}var _=babelHelpers.classPrivateFieldLooseKey("selectedSpaceId");class C{constructor(){Object.defineProperty(this,_,{writable:true,value:void 0});this.hasMoreSpacesToLoad=true}static getInstance(){if(!this.instance){this.instance=new this}return this.instance}setSelectedSpaceId(t){babelHelpers.classPrivateFieldLooseBase(this,_)[_]=t}getSelectedSpaceId(){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}async loadSpaces(t){const e={};e.loadedSpacesCount=t.loadedSpacesCount;e.mode=t.filterMode;e.searchString="";const s=await L.loadSpaces(e);this.hasMoreSpacesToLoad=s.hasMoreSpacesToLoad;return s}canLoadSpaces(){return this.hasMoreSpacesToLoad}async reloadSpaces(t){const e={};e.mode=t.filterMode;const s=await L.reloadSpaces(e);this.hasMoreSpacesToLoad=s.hasMoreSpacesToLoad;return s}}C.instance=null;const w=Object.freeze({recent:"recent",recentSearch:"recentSearch",search:"search"});const y=Object.freeze({my:"my",other:"other",all:"all"});const P=Object.freeze([{type:y.my,nameMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_MY_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_MY_DESCRIPTION"},{type:y.other,nameMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_OTHER_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_OTHER_DESCRIPTION"},{type:y.all,nameMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_ALL_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_FILTER_MODE_ALL_DESCRIPTION"}]);const M=Object.freeze({open:"open",closed:"closed",secret:"secret"});const A=Object.freeze([{type:M.open,nameMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_OPEN_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_OPEN_DESCRIPTION"},{type:M.closed,nameMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_CLOSED_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_CLOSED_DESCRIPTION"},{type:M.secret,nameMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_SECRET_TITLE",descriptionMessageId:"SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_SECRET_DESCRIPTION"}]);const T=Object.freeze({nonMember:"nonMember",applicant:"applicant",invited:"invited",member:"member"});const E=Object.freeze({calendar:"calendar_comment",task:"task_comment",livefeed:"livefeed_comment"});class F{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}buildSpaces(t){return t.map((t=>({id:parseInt(t.id,10),name:t.name,isPinned:t.isPinned,isSelected:C.getInstance().getSelectedSpaceId()===parseInt(t.id,10),recentActivity:this.buildRecentActivity(t.recentActivityData),avatar:t.avatar,visibilityType:t.visibilityType,counter:parseInt(t.counter,10),lastSearchDate:new Date(this.convertTimestampFromPhp(t.lastSearchDateTimestamp)),lastSearchDateTimestamp:t.lastSearchDateTimestamp*1e3,userRole:t.userRole,follow:t.follow,theme:[],permissions:t.permissions})))}convertTimestampFromPhp(t){return parseInt(t,10)*1e3}buildInvitations(t){return t.map((t=>({spaceId:parseInt(t.spaceId,10),message:t.message,invitationDateTimestamp:this.convertTimestampFromPhp(t.invitationDateTimestamp),invitationDate:new Date(this.convertTimestampFromPhp(t.invitationDateTimestamp))})))}buildRecentActivity(t){const e={};e.description=t.description;e.typeId=t.typeId;e.entityId=parseInt(t.entityId,10);e.timestamp=this.convertTimestampFromPhp(t.timestamp);e.date=new Date(e.timestamp);e.secondaryEntityId=t.secondaryEntityId;return e}getStringCapitalized(t){return t[0].toUpperCase()+t.slice(1)}getModelNameByListViewMode(t){let e=`${t}ListSpaceIds`;if(t===w.search){e="searchResultFromServerSpaceIds"}return e}doAddSpaceToRecentList(t,e,s){const a=e.recentActivity.date<t.recentActivity.date;const i=this.doSpaceUserRoleFitsFilterMode(t.userRole,s);return a&&i||t.id===0}doSpaceUserRoleFitsFilterMode(t,e){if([T.nonMember,T.applicant].includes(t)&&e===y.my){return false}if(t===T.member&&e===y.other){return false}return t!==T.invited}}F.instance=null;const B={state(){return{spaces:new Map,recentListSpaceIds:new Set,searchResultFromServerSpaceIds:new Set,searchResultFromLoadedSpaceIds:new Set,invitations:new Map,invitationSpaceIds:new Set,recentSearchListSpaceIds:new Set,selectedFilterModeType:"",spacesListState:"",canCreateGroup:false}},actions:{setSpaces:(t,e)=>{t.commit("setSpaces",F.getInstance().buildSpaces(e))},setInvitations:(t,e)=>{t.commit("setInvitations",F.getInstance().buildInvitations(e))},setCanCreateGroup:(t,e)=>{t.commit("setCanCreateGroup",e)},setRecentSpaceIds:(t,e)=>{t.commit("setRecentListSpaceIds",e)},setInvitationSpaceIds:(t,e)=>{t.commit("setInvitationSpaceIds",e)},setRecentSearchSpaceIds:(t,e)=>{t.commit("setRecentSearchListSpaceIds",e)},addSpaces:(t,e)=>{t.commit("addSpaces",F.getInstance().buildSpaces(e))},setSelectedFilterModeType:(t,e)=>{t.commit("setSelectedFilterModeType",e)},setSelectedSpace:(t,e)=>{const s=C.getInstance().getSelectedSpaceId();C.getInstance().setSelectedSpaceId(e);t.commit("setSelectedSpace",{spaceId:s,selected:false});t.commit("setSelectedSpace",{spaceId:e,selected:true})},setSpacesListState:(t,e)=>{t.commit("setSpacesListState",e)},setLocalSearchResult:(t,e)=>{t.commit("setSearchResultFromLoadedSpaceIds",e)},clearSpacesViewByMode:(t,e)=>{const s=F.getInstance();const a=s.getModelNameByListViewMode(e);const i=s.getStringCapitalized(a);t.commit(`set${i}`,[])},addSpacesToView:(t,e)=>{const s=F.getInstance();const a=s.getModelNameByListViewMode(e.mode);const i=s.getStringCapitalized(a);const o=s.buildSpaces(e.spaces);const n=o.map((t=>t.id));const c=[...t.state[a],...n];t.commit(`set${i}`,c);t.commit("addSpaces",o)},pinSpace:(t,e)=>{t.commit("pinSpace",e)},changeUserRole:(t,e)=>{t.commit("changeUserRole",e)},deleteInvitationFromStore:(t,e)=>{const s=e.spaceId;t.commit("deleteInvitationBySpaceId",s)},deleteSpaceFromStore:(t,e)=>{const s=e.spaceId;t.commit("deleteSpaceById",s)},updateCounters:(t,e)=>{const s=e.userId;const a=e.total;BX.ready((()=>{if(BX.getClass("BX.Intranet.LeftMenu")){e.spaces.forEach((t=>{if(t.id===0){const e={spaces:a,sonet_total:t.metrics.countersLiveFeedTotal};BX.Intranet.LeftMenu.updateCounters(e,false)}}))}}));t.getters.spaces.forEach((e=>{t.commit("updateCounter",{userId:s,spaceId:e.id,counter:0,tasksTotal:0,calendarTotal:0,workGroupTotal:0,lifeFeedTotal:0})}));e.spaces.forEach((e=>{t.commit("updateCounter",{userId:s,spaceId:e.id,counter:e.total,tasksTotal:e.metrics.countersTasksTotal,calendarTotal:e.metrics.countersCalendarTotal,workGroupTotal:e.metrics.countersWorkGroupRequestTotal,lifeFeedTotal:e.metrics.countersLiveFeedTotal})}))},updateSpaceData:(t,e)=>{if(e.checkInvitation!==false){if(e.space&&e.isInvitation){t.commit("addInvitations",F.getInstance().buildInvitations([e.invitation]))}else{t.commit("deleteInvitationBySpaceId",e.spaceId)}}if(e.space){const s=F.getInstance();const a=s.buildSpaces([e.space]).pop();const i=t.getters.recentSpaces[t.getters.recentSpaces.length-1];t.commit("addSpaces",[a]);if(s.doAddSpaceToRecentList(a,i,t.state.selectedFilterModeType)){t.commit("addRecentListSpaceId",a.id)}else if(!s.doSpaceUserRoleFitsFilterMode(a.userRole,t.state.selectedFilterModeType)){t.commit("removeRecentListSpaceId",a.id)}}else{t.commit("deleteSpaceById",e.spaceId)}},updateSpaceRecentActivityData:(t,e)=>{t.commit("updateSpaceRecentActivityData",e);const s=t.state.spaces.get(e.spaceId);if(!s){return}const a=F.getInstance();const i=t.getters.recentSpaces[t.getters.recentSpaces.length-1];if(a.doAddSpaceToRecentList(s,i,t.state.selectedFilterModeType)){t.commit("addRecentListSpaceId",s.id)}}},mutations:{setSpaces:(t,e)=>{t.spaces.clear();e.forEach((e=>t.spaces.set(e.id,e)))},addSpaces:(t,e)=>{e.forEach((e=>t.spaces.set(e.id,e)))},setRecentListSpaceIds:(t,e)=>{t.recentListSpaceIds=new Set(e)},addRecentListSpaceId:(t,e)=>{t.recentListSpaceIds.add(e)},removeRecentListSpaceId:(t,e)=>{t.recentListSpaceIds.delete(e)},setInvitations:(t,e)=>{t.invitations.clear();e.forEach((e=>t.invitations.set(e.spaceId,e)))},setInvitationSpaceIds:(t,e)=>{t.invitationSpaceIds=new Set(e)},addInvitations:(t,e)=>{e.forEach((e=>{t.invitationSpaceIds.add(e.spaceId);t.invitations.set(e.spaceId,e)}))},setCanCreateGroup:(t,e)=>{t.canCreateGroup=e},setSearchResultFromServerSpaceIds:(t,e)=>{t.searchResultFromServerSpaceIds=new Set(e)},setSearchResultFromLoadedSpaceIds:(t,e)=>{t.searchResultFromLoadedSpaceIds=new Set(e)},setRecentSearchListSpaceIds:(t,e)=>{t.recentSearchListSpaceIds=new Set(e)},setSelectedFilterModeType:(t,e)=>{t.selectedFilterModeType=e},setSelectedSpace:(t,e)=>{const s=t.spaces.get(e.spaceId);if(s){s.isSelected=e.selected}},setSpacesListState:(t,e)=>{t.spacesListState=e},pinSpace:(t,e)=>{const s=t.spaces.get(e.spaceId);s.isPinned=e.isPinned;t.spaces.set(s.id,s)},changeUserRole:(t,e)=>{const s=t.spaces.get(e.spaceId);s.userRole=e.userRole},deleteSpaceById:(t,e)=>{t.spaces.delete(e);t.recentListSpaceIds.delete(e);t.searchResultFromServerSpaceIds.delete(e);t.searchResultFromLoadedSpaceIds.delete(e);t.recentSearchListSpaceIds.delete(e)},deleteInvitationBySpaceId:(t,e)=>{t.invitations.delete(e);t.invitationSpaceIds.delete(e)},updateCounter:(t,e)=>{var s;const a=e.spaceId;const i=e.counter;const o=(s=t.spaces.get(a))!=null?s:{};o.counter=i},updateSpaceRecentActivityData:(t,e)=>{const s=t.spaces.get(e.spaceId);if(!s){return}s.recentActivity=F.getInstance().buildRecentActivity(e)}},getters:{spaces:t=>[...t.spaces.values()],invitations:t=>[...t.invitations.values()],spaceInvitations:(t,e)=>{const s=t.spaces;const a=e.invitations;return a.map((t=>{const e=s.get(t.spaceId);const a={recentActivity:{...e.recentActivity,description:t.message,date:t.invitationDate,timestamp:t.invitationDate.getTime()},counter:1};return{...e,...a}})).sort(((t,e)=>e.recentActivity.date-t.recentActivity.date))},canCreateGroup:t=>t.canCreateGroup,spacesListState:t=>t.spacesListState,recentSpacesUnordered:(t,e)=>{const s=e.spaces;const a=s.filter((e=>t.recentListSpaceIds.has(e.id)&&!t.invitationSpaceIds.has(e.id)));return a.sort(((t,e)=>e.recentActivity.date-t.recentActivity.date))},recentSpaces:(t,e)=>{let s=[];switch(t.selectedFilterModeType){case y.my:s=e.myRecentSpaces;break;case y.other:s=e.otherRecentSpaces;break;case y.all:s=e.allRecentSpaces;break;default:break}return s},myRecentSpaces:(t,e)=>[...e.pinnedSpacesFromRecent,e.commonSpaceFromRecent,...e.notPinnedSpacesWithoutCommonFromRecent],otherRecentSpaces:(t,e)=>[...e.spacesWithoutCommonFromRecent],allRecentSpaces:(t,e)=>[e.commonSpaceFromRecent,...e.spacesWithoutCommonFromRecent],commonSpaceFromRecent:(t,e)=>e.recentSpacesUnordered.find((t=>t.id===0)),spacesWithoutCommonFromRecent:(t,e)=>e.recentSpacesUnordered.filter((t=>t.id!==e.commonSpaceFromRecent.id)),pinnedSpacesFromRecent:(t,e)=>e.recentSpacesUnordered.filter((t=>t.isPinned)),notPinnedSpacesWithoutCommonFromRecent:(t,e)=>e.spacesWithoutCommonFromRecent.filter((t=>!t.isPinned)),searchSpaces:(t,e)=>{const s=e.spaces;const a=new Set([...t.searchResultFromLoadedSpaceIds,...t.searchResultFromServerSpaceIds]);return s.filter((t=>a.has(t.id)))},spacesLoadedByCurrentSearchQueryCount:t=>t.searchResultFromServerSpaceIds.size,recentSearchSpaces:(t,e)=>{const s=e.spaces.filter((e=>t.recentSearchListSpaceIds.has(e.id)));return s.sort(((t,e)=>e.lastSearchDate-t.lastSearchDate))},recentSpacesCountForLoad:(t,e)=>e.recentSpaces.length-1,recentSearchSpacesCountForLoad:(t,e)=>e.recentSearchSpaces.length,searchSpacesCountForLoad:(t,e)=>e.spacesLoadedByCurrentSearchQueryCount}};const O=l.createStore({modules:{addForm:f,main:B}});class R{static getSpaceLink(t){let e=R.commonSpacePath;if(t>0){e=R.groupPath.replace("#group_id#",t)}return e}}R.groupPath="";R.commonSpacePath="";const k=Object.freeze({default:"default",collapsed:"collapsed",expanded:"expanded"});const H=Object.freeze({showLoader:"socialnetwork:spacesList:showLoader",hideLoader:"socialnetwork:spacesList:hideLoader",tryToLoadSpacesIfHasNoScrollbar:"socialnetwork:spacesList:tryToLoadSpacesIfHasNoScrollbar",spaceListScroll:"socialnetwork:spacesList:onScroll",spaceListShown:"socialnetwork:spacesList:onShown",showUpperSpaceAddForm:"socialnetwork:spacesList:showUpperSpaceAddForm",showBtnToggleBlock:"socialnetwork:spacesList:showBtnToggleBlock",hideSpaceAddForm:"socialnetwork:spacesList:hideSpaceAddForm",updateCounters:"socialnetwork:spacesList:updateCounters",changeSpace:"socialnetwork:spacesList:changeSpace",changeUserRole:"socialnetwork:spacesList:changeUserRole",changeSubscription:"socialnetwork:spacesList:changeSubscription",pinChanged:"socialnetwork:spacesList:pinChanged",changeSpaceListState:"socialnetwork:spacesList:changeSpaceListState",recentActivityUpdate:"socialnetwork:spacesList:recentActivityUpdate",recentActivityDelete:"socialnetwork:spacesList:recentActivityDelete",recentActivityRemoveFromSpace:"socialnetwork:spacesList:recentActivityRemoveFromSpace",openSpaceFromContextMenu:"socialnetwork:spacesList:openSpaceFromContextMenu",changeMode:"socialnetwork:spacesList:changeMode"});const x="#popup-window-content-";const D={name:"BasePopup",props:{id:{type:String,required:true},config:{type:Object,required:false,default(){return{}}}},emits:["close"],computed:{popupContainer(){return`${x}${this.id}`}},created(){this.instance=this.getPopupInstance();this.instance.show()},mounted(){this.instance.adjustPosition({forceBindPosition:true,position:this.getPopupConfig().bindOptions.position})},beforeUnmount(){if(!this.instance){return}this.closePopup()},methods:{getPopupInstance(){if(!this.instance){var t;(t=i.PopupManager.getPopupById(this.id))==null?void 0:t.destroy();this.instance=new i.Popup(this.getPopupConfig())}return this.instance},getDefaultConfig(){return{id:this.id,className:"ui-test-popup",autoHide:true,animation:"fading-slide",bindOptions:{position:"bottom"},cacheable:false,events:{onPopupClose:this.closePopup.bind(this)}}},getPopupConfig(){var t,e;const s=this.getDefaultConfig();const a={};const i=s.className;if(this.config.className){a.className=`${i} ${this.config.className}`}const o=(t=this.config.offsetTop)!=null?t:s.offsetTop;if(((e=this.config.bindOptions)==null?void 0:e.position)==="top"&&d.Type.isNumber(this.config.offsetTop)){a.offsetTop=o-10}return{...s,...this.config,...a}},closePopup(){this.$emit("close");this.instance.destroy();this.instance=null},enableAutoHide(){this.getPopupInstance().setAutoHide(true)},disableAutoHide(){this.getPopupInstance().setAutoHide(false)},adjustPosition(){this.getPopupInstance().adjustPosition({forceBindPosition:true,position:this.getPopupConfig().bindOptions.position})}},template:`\n\t\t<Teleport :to="popupContainer">\n\t\t\t<slot\n\t\t\t\t:adjustPosition="adjustPosition"\n\t\t\t\t:enableAutoHide="enableAutoHide"\n\t\t\t\t:disableAutoHide="disableAutoHide"\n\t\t\t></slot>\n\t\t</Teleport>\n\t`};const $={props:{option:{type:Object,default:()=>{}},isSelected:Boolean},emits:["changeSelectedOption"],computed:{active(){return this.isSelected?"--active":""},iconClass(){return`--${this.option.type}-spaces`},dataId(){return`spaces-list-popup-menu-option-${this.option.type}`}},template:`\n\t\t<div\n\t\t\t@click="this.$emit('changeSelectedOption', option.type)"\n\t\t\tclass="sn-spaces__popup-menu_item"\n\t\t\t:class="active"\n\t\t\t:data-id="dataId"\n\t\t>\n\t\t\t<div class="sn-spaces__popup-menu_item-icon" :class="iconClass"/>\n\t\t\t<div class="sn-spaces__popup-menu_item-info">\n\t\t\t\t<div class="sn-spaces__popup-menu_item-name">{{ option.name }}</div>\n\t\t\t\t<div class="sn-spaces__popup-menu_item-description">{{ option.description }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const N={props:{config:{type:Object,required:true}},emits:["popupMenuButtonClick"],computed:{doShowIcon(){return d.Type.isStringFilled(this.config.class)}},template:`\n\t\t<div\n\t\t\tclass="sn-spaces__popup-menu_item sn-spaces__popup-menu_item-btn"\n\t\t\tdata-id="spaces-popup-menu-button"\n\t\t\t@click="this.$emit('popupMenuButtonClick')"\n\t\t>\n\t\t\t<div v-if="doShowIcon" class="ui-icon-set" :class="config.class"></div>\n\t\t\t{{config.text}}\n\t\t</div>\n\t`};const U={name:"ModePopupContent",components:{PopupMenuOption:$,PopupMenuButton:N},props:{options:{type:Array,required:true},selectedOption:{type:String,required:false,default:""},hint:{type:String,required:false,default:""},button:{type:Object,required:false,default:()=>{}}},emits:["closePopup","changeSelectedOption","popupMenuButtonClick"],computed:{doShowHint(){return this.hint.length>0},doShowButton(){var t,e;return((t=this.button)==null?void 0:(e=t.text)==null?void 0:e.length)>0}},methods:{onChangeSelectedOption(t){this.$emit("closePopup");this.$emit("changeSelectedOption",t)},onPopupMenuButtonClick(){this.$emit("closePopup");this.$emit("popupMenuButtonClick")}},template:`\n\t\t<div class="sn-spaces__popup-menu">\n\t\t\t<PopupMenuOption\n\t\t\t\tv-for="option in options"\n\t\t\t\t:option="option"\n\t\t\t\t:key="option.type"\n\t\t\t\t:isSelected="option.type === this.selectedOption"\n\t\t\t\t@changeSelectedOption="onChangeSelectedOption"\n\t\t\t/>\n\t\t\t<div v-if="doShowHint" class="sn-spaces__popup-menu_hint">\n\t\t\t\t{{hint}}\n\t\t\t</div>\n\t\t\t<PopupMenuButton\n\t\t\t\tv-if="doShowButton"\n\t\t\t\t:config="button"\n\t\t\t\t@popupMenuButtonClick="onPopupMenuButtonClick"\n\t\t\t/>\n\t\t</div>\n\t`};const j="socialnetwork-spaces-list-mode-popup";const K={components:{BasePopup:D,PopupMenuContent:U},props:{bindElement:{type:Object,required:true},context:{type:String,required:true},options:{type:Array,required:true},selectedOption:{type:String,required:false,default:""},button:{type:Object,required:false,default:()=>{}},hint:{type:String,required:false,default:""}},computed:{POPUP_ID(){return`${j}-${this.context}`},config(){return{className:"ui-test-popup",width:343,closeIcon:false,closeByEsc:true,overlay:true,padding:0,animation:"fading-slide",bindElement:this.bindElement}}},emits:["close","changeSelectedOption","popupMenuButtonClick"],methods:{onChangeSelectedOption(t){this.$emit("changeSelectedOption",t)},onPopupMenuButtonClick(){this.$emit("popupMenuButtonClick")}},template:`\n\t\t<BasePopup\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t\tv-slot="{enableAutoHide, disableAutoHide}"\n\t\t\t:id="POPUP_ID"\n\t\t>\n\t\t\t<PopupMenuContent\n\t\t\t\t:options="options"\n\t\t\t\t:selectedOption="selectedOption"\n\t\t\t\t:hint="hint"\n\t\t\t\t@closePopup="$emit('close')"\n\t\t\t\t@enableAutoHide="enableAutoHide"\n\t\t\t\t@disableAutoHide="disableAutoHide"\n\t\t\t\t@changeSelectedOption="onChangeSelectedOption"\n\t\t\t\t@popupMenuButtonClick="onPopupMenuButtonClick"\n\t\t\t\t:button="button"\n\t\t\t/>\n\t\t</BasePopup>\n\t`};const W={components:{PopupMenu:K},props:{canCreateGroup:Boolean},emits:["changeMode"],data(){return{showModePopup:false,isSpaceListScrolled:false,filterModes:P}},computed:{scrollClass(){return this.isSpaceListScrolled?"--scroll-content":""},selectedFilterModeType(){return this.$store.state.main.selectedFilterModeType},title(){const t=this.selectedFilterModeType;const e=this.filterModes.find((e=>e.type===t));return e?this.loc(e.nameMessageId):this.loc("SOCIALNETWORK_SPACES_TITLE")},selectFilterModeButtonIconModifier(){return`--${this.selectedFilterModeType}`},popupMenuOptions(){return this.filterModes.map((t=>({type:t.type,name:this.loc(t.nameMessageId),description:this.loc(t.descriptionMessageId)})))},popupMenuButton(){if(!this.canCreateGroup){return null}return{text:this.loc("SOCIALNETWORK_SPACES_LIST_MODE_POPUP_NEW_SPACE_BUTTON"),class:"--plus-30"}}},created(){this.$bitrix.eventEmitter.subscribe(H.spaceListScroll,this.handleListChanges);this.$bitrix.eventEmitter.subscribe(H.spaceListShown,this.handleListChanges)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(H.spaceListScroll,this.handleListChanges);this.$bitrix.eventEmitter.unsubscribe(H.spaceListShown,this.handleListChanges)},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)},openPopup(){this.showModePopup=true},handleListChanges(t){const e=t.data.isSpaceListScrolled;const s=t.data.mode;if(s===w.recent){this.isSpaceListScrolled=e}},enableSearch(){this.$emit("changeMode",w.recentSearch)},async onChangeSelectedFilterMode(t){if(this.selectedFilterModeType!==t){const e=C.getInstance();this.$bitrix.eventEmitter.emit(H.showLoader,w.recent);const s=await e.reloadSpaces({filterMode:t});this.$store.dispatch("setSelectedFilterModeType",t);this.$store.dispatch("clearSpacesViewByMode",w.recent);this.$store.dispatch("addSpacesToView",{mode:w.recent,spaces:s.spaces});this.$bitrix.eventEmitter.emit(H.hideLoader,w.recent)}},onCreateSpaceButtonClick(){this.$bitrix.eventEmitter.emit(H.showUpperSpaceAddForm)},showBtnArrow(){this.$bitrix.eventEmitter.emit(H.showBtnToggleBlock)}},template:`\n\t\t<div \n\t\t\tclass="sn-spaces__list-header" \n\t\t\t:class="scrollClass"\n\t\t\t@mouseenter="showBtnArrow"\n\t\t>\n\t\t\t<div\n\t\t\t\t@click="openPopup"\n\t\t\t\tclass="sn-spaces__list-header_name"\n\t\t\t\tref="spaces-list-header-name"\n\t\t\t\tdata-id="spaces-header-title"\n\t\t\t>\n\t\t\t\t<div class="sn-spaces__list-header_name-block">\n\t\t\t\t\t<div class="sn-spaces__list-header_title">\n\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-icon-set --chevron-down" style='--ui-icon-set__icon-size: 15px;'>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="sn-spaces__list-header_btn-spaces" :class="selectFilterModeButtonIconModifier"></div>\n\t\t\t</div>\n\t\t\t<PopupMenu\n\t\t\t\t:options="popupMenuOptions"\n\t\t\t\tcontext="space-recent-header"\n\t\t\t\t:bind-element="$refs['spaces-list-header-name'] || {}"\n\t\t\t\t:selectedOption="selectedFilterModeType"\n\t\t\t\t:hint="loc('SOCIALNETWORK_SPACES_LIST_MODE_POPUP_BOTTOM_DESCRIPTION')"\n\t\t\t\t@changeSelectedOption="onChangeSelectedFilterMode"\n\t\t\t\t@popupMenuButtonClick="onCreateSpaceButtonClick"\n\t\t\t\tv-if="showModePopup"\n\t\t\t\t@close="showModePopup = false"\n\t\t\t\t:button="popupMenuButton"\n\t\t\t/>\n\t\t\t<button\n\t\t\t\tclass="ui-btn ui-btn-light ui-btn-round ui-btn-xs sn-spaces__list-header_btn-search"\n\t\t\t\t@click="enableSearch"\n\t\t\t\tdata-id="spaces-search-button"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --search-2"></div>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\tv-if="canCreateGroup"\n\t\t\t\tclass="ui-btn ui-btn-light ui-btn-round ui-btn-xs sn-spaces__list-header_btn-add"\n\t\t\t\t@click="onCreateSpaceButtonClick"\n\t\t\t\tdata-id="spaces-header-add-space-button"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --plus-30"></div>\n\t\t\t</button>\n\t\t</div>\n\t`};const G=3;class V{constructor(){this.hasMoreSpacesToLoad=true;this.searchString=""}static getInstance(){if(!this.instance){this.instance=new this}return this.instance}async loadSpaces(t){const e={};e.loadedSpacesCount=t.loadedSpacesCount;e.mode=y.all;e.searchString=this.searchString;const s=await L.searchSpaces(e);this.hasMoreSpacesToLoad=s.hasMoreSpacesToLoad;return s}canLoadSpaces(){return this.hasMoreSpacesToLoad&&this.searchString.length>=G}}V.instance=null;const q={data(){return{searchQuery:"",isSpaceListScrolled:false}},created(){this.startSearchDebounced=d.Runtime.debounce(this.startSearch,500,this);this.$bitrix.eventEmitter.subscribe(H.spaceListScroll,this.handleListChanges);this.$bitrix.eventEmitter.subscribe(H.spaceListShown,this.handleListChanges)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(H.spaceListScroll,this.handleListChanges);this.$bitrix.eventEmitter.unsubscribe(H.spaceListShown,this.handleListChanges)},computed:{...l.mapGetters({spaces:"spaces"}),scrollClass(){return this.isSpaceListScrolled?"--scroll-content":""}},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},closeSearch(){this.searchQuery="";this.$emit("changeMode",w.recent)},handleListChanges(t){const e=t.data.isSpaceListScrolled;const s=t.data.mode;if([w.search,w.recentSearch].includes(s)){this.isSpaceListScrolled=e}},onInputChange(){V.getInstance().searchString=this.searchQuery;if(this.searchQuery.length===0){this.$emit("changeMode",w.recentSearch)}else{this.startSearchDebounced()}},startSearch(){if(this.searchQuery.length>0){V.getInstance().hasMoreSpacesToLoad=true;this.$store.dispatch("clearSpacesViewByMode",w.search);const t=this.spaces.filter((t=>t.name.toLowerCase().includes(this.searchQuery.toLowerCase())));const e=t.map((t=>t.id));this.$store.dispatch("setLocalSearchResult",e);this.$emit("changeMode",w.search);setTimeout((()=>{this.$bitrix.eventEmitter.emit(H.tryToLoadSpacesIfHasNoScrollbar,w.search)}),80)}}},mounted(){this.$refs.input.focus()},template:`\n\t\t<div class="sn-spaces__list-header" :class="scrollClass">\n\t\t\t<div class="sn-spaces__search ui-ctl ui-ctl-textbox ui-ctl-after-icon ui-ctl-w100 ui-ctl-sm">\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t:placeholder="loc('SOCIALNETWORK_SPACES_LIST_SEARCH_INPUT_PLACEHOLDER')"\n\t\t\t\t\tv-model.trim="searchQuery"\n\t\t\t\t\tref="input"\n\t\t\t\t\t@input="onInputChange"\n\t\t\t\t\tdata-id="spaces-search-input"\n\t\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tclass="sn-spaces__search-clear ui-ctl-after"\n\t\t\t\t\t@click="closeSearch"\n\t\t\t\t\tdata-id="spaces-close-search-button"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --cross-circle-70"></div>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`};class X extends p.EventEmitter{constructor(t){super();this.setEventNamespace("BX.Socialnetwork.Spaces.ContextItem");this.message=t.message;this.spaceId=t.spaceId;this.emitter=new p.EventEmitter}}class z extends X{create(){return{text:this.message,onclick:(t,e)=>{BX.clipboard.copy(location.origin+R.getSpaceLink(this.spaceId));e.getMenuWindow().close();s.UI.Notification.Center.notify({content:d.Loc.getMessage("SN_SPACES_LIST_SPACE_COPY_LINK_NOTIFY")})}}}}class Y extends X{create(){return{text:this.message,onclick:(t,e)=>{const s=new a.MessageBox({message:d.Loc.getMessage("SN_SPACES_LIST_SPACE_COPY_LOGOUT_POPUP_TEXT"),buttons:a.MessageBoxButtons.OK_CANCEL,okCaption:d.Loc.getMessage("SN_SPACES_LIST_SPACE_COPY_LOGOUT_POPUP_CONFIRM_BTN"),onOk:()=>{n.Controller.leaveGroup(this.spaceId).then((()=>{e.getMenuWindow().close();s.close();this.emit("click")})).catch((()=>{s.getOkButton().setDisabled(false)}))}});s.show()}}}}var Q=babelHelpers.classPrivateFieldLooseKey("switch");var J=babelHelpers.classPrivateFieldLooseKey("flush");class Z extends X{constructor(...t){super(...t);Object.defineProperty(this,J,{value:et});Object.defineProperty(this,Q,{value:tt})}create(){return{text:this.message,onclick:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]().then((t=>{e.getMenuWindow().close();const s=t.data.message;const a=t.data.mode;setTimeout((()=>{e.setText(s)}),800);babelHelpers.classPrivateFieldLooseBase(this,J)[J](a)}))}}}}function tt(){return d.ajax.runAction("socialnetwork.api.livefeed.spaces.switcher.pin",{data:{switcher:{type:Z.ID,spaceId:this.spaceId},space:this.spaceId}})}function et(t){this.emit(H.pinChanged,{spaceId:this.spaceId,isPinned:t==="Y"})}Z.ID="pinner";var st=babelHelpers.classPrivateFieldLooseKey("switch");var at=babelHelpers.classPrivateFieldLooseKey("flush");class it extends X{constructor(...t){super(...t);Object.defineProperty(this,at,{value:nt});Object.defineProperty(this,st,{value:ot})}create(){return{text:this.message,onclick:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,st)[st]().then((t=>{e.getMenuWindow().close();const s=t.data.message;const a=t.data.mode;setTimeout((()=>{e.setText(s)}),800);babelHelpers.classPrivateFieldLooseBase(this,at)[at](a)}))}}}}function ot(){return d.ajax.runAction("socialnetwork.api.livefeed.spaces.switcher.follow",{data:{switcher:{type:it.ID,spaceId:this.spaceId},space:this.spaceId}})}function nt(t){this.emit("followChanged",{spaceId:this.spaceId,isFollowed:t==="Y"})}it.ID="follow";class ct extends X{create(){return{text:this.message,onclick:(t,e)=>{this.emitter.emit(H.openSpaceFromContextMenu,{spaceId:this.spaceId});e.getMenuWindow().close()}}}setPath(t){this.path=t;return this}}var rt=babelHelpers.classPrivateFieldLooseKey("cache");var lt=babelHelpers.classPrivateFieldLooseKey("setOptions");var dt=babelHelpers.classPrivateFieldLooseKey("getOption");var pt=babelHelpers.classPrivateFieldLooseKey("init");class ht extends p.EventEmitter{constructor(t){super();Object.defineProperty(this,pt,{value:mt});Object.defineProperty(this,dt,{value:St});Object.defineProperty(this,lt,{value:ut});Object.defineProperty(this,rt,{writable:true,value:new d.Cache.MemoryCache});this.setEventNamespace("BX.Socialnetwork.Spaces.ContextMenu");babelHelpers.classPrivateFieldLooseBase(this,lt)[lt](t);babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]()}createMenu(){const t=this.getMenuId();this.menu=i.MenuManager.create({id:t,closeByEsc:true,bindElement:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("bindElement"),items:this.getItems()})}getMenuId(){return ht.ID+babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("spaceId")}toggle(){this.collection.destroy();this.collection.add(this);this.createMenu();this.menu.toggle()}getSpaceId(){return babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("spaceId")}isShown(){var t;return(t=this.menu.getPopupWindow())==null?void 0:t.isShown()}getItems(){const t=[];if(!babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("isSelected")){const e=new ct({spaceId:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("spaceId"),message:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("openMessage")});t.push(e.setPath(babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("path")).create())}if(babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("listFilter")===y.my&&babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("listMode")===w.recent){const e=new Z({spaceId:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("spaceId"),message:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("pinMessage")});t.push(e.create())}const e=new it({spaceId:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("spaceId"),message:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("followMessage")});t.push(e.create());const s=new z({spaceId:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("spaceId"),message:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("copyLinkMessage")});t.push(s.create());const a=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("permissions");if(babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("listFilter")===y.my&&babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("listMode")===w.recent&&a.canLeave){const e=new Y({spaceId:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("spaceId"),message:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("logoutMessage")});e.subscribe("click",(()=>{if(C.getInstance().getSelectedSpaceId()===babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]("spaceId")){this.emit("openCommonSpace")}}));t.push(e.create())}return t}}function ut(t){babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].set("options",t)}function St(t){return babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].get("options")[t]}function mt(){this.collection=vt.getInstance()}ht.ID="space-context-menu-";class vt{static getInstance(){if(vt.instance===null){vt.instance=new this}return vt.instance}add(t){vt.items.push(t)}destroy(){vt.items.forEach((t=>{const e=i.MenuManager.getMenuById(ht.ID+t.getSpaceId());e==null?void 0:e.destroy()}));vt.items=vt.items.filter((t=>t.isShown()))}}vt.items=[];vt.instance=null;var bt=babelHelpers.classPrivateFieldLooseKey("date");var gt=babelHelpers.classPrivateFieldLooseKey("currentDate");var It=babelHelpers.classPrivateFieldLooseKey("isToday");var ft=babelHelpers.classPrivateFieldLooseKey("isCurrentWeek");var Lt=babelHelpers.classPrivateFieldLooseKey("isCurrentYear");class _t{static formatDate(t){return new _t(new Date(t)).formatDate()}constructor(t){Object.defineProperty(this,Lt,{value:yt});Object.defineProperty(this,ft,{value:wt});Object.defineProperty(this,It,{value:Ct});Object.defineProperty(this,bt,{writable:true,value:void 0});Object.defineProperty(this,gt,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]=t;babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]=new Date}formatDate(){let t="";if(babelHelpers.classPrivateFieldLooseBase(this,It)[It]()){t=o.DateTimeFormat.getFormat("SHORT_TIME_FORMAT")}else if(babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]()){t="D"}else if(babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]()){t=o.DateTimeFormat.getFormat("DAY_SHORT_MONTH_FORMAT")}else{t=o.DateTimeFormat.getFormat("MEDIUM_DATE_FORMAT")}return o.DateTimeFormat.format(t,babelHelpers.classPrivateFieldLooseBase(this,bt)[bt].getTime()/1e3)}}function Ct(){return babelHelpers.classPrivateFieldLooseBase(this,bt)[bt].toLocaleDateString()===babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].toLocaleDateString()}function wt(){const t=parseInt(o.DateTimeFormat.format("W",babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]),10);const e=parseInt(o.DateTimeFormat.format("W",babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]),10);return babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]()&&e===t}function yt(){return babelHelpers.classPrivateFieldLooseBase(this,bt)[bt].getFullYear()===babelHelpers.classPrivateFieldLooseBase(this,gt)[gt].getFullYear()}const Pt={props:{avatar:{type:Object,default:()=>{}},isSecret:{type:Boolean,default:true},isInvitation:{type:Boolean,default:true}},data(){return{secretSpaceImage:"/bitrix/components/bitrix/socialnetwork.spaces.list/templates/.default/images/socialnetwork-spaces_icon_close-spase.svg"}},computed:{avatarModel(){return this.avatar},avatarClass(){let t="";if(this.avatarModel.type==="icon"){if(this.avatarModel.id.length>0){t=`sonet-common-workgroup-avatar --${this.avatarModel.id}`}else{t="ui-icon-common-user-group ui-icon"}}return t},iconStyle(){let t="";if(this.avatarModel.type==="image"){t=`background-image: url(${this.avatarModel.id});`}return t},iconClass(){return this.avatarModel.type==="image"?"sn-spaces__list-item_img":""}},template:`\n\t\t<div class="sn-spaces__list-item_icon" :class="avatarClass">\n\t\t\t<i :style="iconStyle" :class="iconClass"/>\n\t\t\t<div v-if="isInvitation" class="sn-spaces__list-item_invitation-icon">\n\t\t\t\t<div class="ui-icon-set --mail" style="--ui-icon-set__icon-size: 18px;"></div>\n\t\t\t</div>\n\t\t\t<div class="sn-spaces__list-item_icon-close" v-if="isSecret"/>\n\t\t</div>\n\t`};const Mt={components:{Avatar:Pt},props:{space:{type:Object,default:()=>{}},mode:{type:String,required:true},isInvitation:{type:Boolean,default:false},showAvatar:{type:Boolean,default:true}},data(){return{modes:w,spaceUserRoles:T,doShowSuccessButton:false}},computed:{spaceModel(){return this.space},selectedFilterModeType(){return this.$store.state.main.selectedFilterModeType},doShowCounter(){return this.spaceModel.counter&&this.spaceModel.counter>0&&this.mode===this.modes.recent&&!this.isApplicantButtonsShown},doShowPin(){return this.spaceModel.isPinned&&this.mode===this.modes.recent&&!this.isApplicantButtonsShown&&!this.doShowCounter&&this.selectedFilterModeType===y.my},isApplicantButtonsShown(){return this.doShowJoinButton||this.doShowPendingButton||this.doShowSuccessButton},doShowJoinButton(){return this.spaceModel.userRole===this.spaceUserRoles.nonMember&&this.mode===this.modes.recent},doShowPendingButton(){return this.spaceModel.userRole===this.spaceUserRoles.applicant&&this.mode===this.modes.recent},isFollowing(){return this.spaceModel.userRole!==this.spaceUserRoles.member||this.spaceModel.follow},spaceDescription(){const t=this.isApplicantButtonsShown||!this.spaceModel.recentActivity.description||this.spaceModel.recentActivity.description.length===0;return t?this.getVisibilityTypeName():this.spaceModel.recentActivity.description},isCommon(){return this.spaceModel.id===0}},created(){this.$bitrix.eventEmitter.subscribe(`onSpaceUpdate_${this.spaceModel.id}`,this.onSpaceUpdate.bind(this))},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(`onSpaceUpdate_${this.spaceModel.id}`,this.onSpaceUpdate.bind(this))},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},getVisibilityTypeName(){var t;if(this.isCommon){return""}const e=(t=A.find((t=>t.type===this.spaceModel.visibilityType)))==null?void 0:t.nameMessageId;return d.Type.isStringFilled(e)?this.loc(e):""},formatDate(t){return _t.formatDate(t)},isSecretSpace(t){return t===M.secret},formatCounter(t){if(t>99){return"99+"}if(t===0){return""}return t.toString()},counterClass(t){return t?"sn-spaces__list-item_counter":"sn-spaces__list-item_counter --mute"},showSuccessButton(){this.doShowSuccessButton=true;setTimeout((()=>{this.doShowSuccessButton=false}),1e3)},onSpaceUpdate(t){if(this.mode===this.modes.recent){const e=t.data;const s=F.getInstance();const a=s.buildSpaces([e]).pop();const i=this.spaceModel.userRole===this.spaceUserRoles.applicant;const o=a.userRole===this.spaceUserRoles.member;if(i&&o){this.showSuccessButton()}}},async onJoinButtonClick(t){t.stopPropagation();await d.ajax.runAction("socialnetwork.api.userToGroup.join",{data:{params:{groupId:this.spaceModel.id}}}).then((t=>{const e=t.data.confirmationNeeded;let s=this.spaceUserRoles.member;if(e){s=this.spaceUserRoles.applicant}else{this.showSuccessButton()}this.$store.dispatch("changeUserRole",{spaceId:this.spaceModel.id,userRole:s})}),(t=>{console.log(t)}))},onPendingButtonClick(t){t.stopPropagation()},onAcceptedButtonClick(t){t.stopPropagation()},async acceptInvitationButtonClickHandler(t){t.stopPropagation();await d.ajax.runAction("socialnetwork.api.userToGroup.acceptOutgoingRequest",{data:{groupId:this.spaceModel.id}}).then((t=>{const e=t.data;if(e){this.$store.dispatch("changeUserRole",{spaceId:this.spaceModel.id,userRole:this.spaceUserRoles.member});this.$store.dispatch("deleteInvitationFromStore",{spaceId:this.spaceModel.id})}}),(t=>{console.log(t)}))},async declineInvitationButtonClickHandler(t){t.stopPropagation();await d.ajax.runAction("socialnetwork.api.userToGroup.rejectOutgoingRequest",{data:{groupId:this.spaceModel.id}}).then((t=>{const e=t.data;if(e){this.$store.dispatch("deleteInvitationFromStore",{spaceId:this.spaceModel.id});if(this.isSecretSpace(this.spaceModel.visibilityType)){this.$store.dispatch("deleteSpaceFromStore",{spaceId:this.spaceModel.id})}else{this.$store.dispatch("changeUserRole",{spaceId:this.spaceModel.id,userRole:this.spaceUserRoles.nonMember})}}}),(t=>{console.log(t)}))}},template:`\n\t\t<Avatar\n\t\t\tv-if="showAvatar"\n\t\t\t:avatar="spaceModel.avatar"\n\t\t\t:isSecret="isSecretSpace(spaceModel.visibilityType)"\n\t\t\t:isInvitation="isInvitation"\n\t\t/>\n\t\t<div class="sn-spaces__list-item_info">\n\t\t\t<div class="sn-spaces__list-item_title" :title="spaceModel.name">\n\t\t\t\t<div class="sn-spaces__list-item_name">{{spaceModel.name}}</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!isFollowing"\n\t\t\t\t\tclass="sn-spaces__list-item_mute ui-icon-set --sound-off"\n\t\t\t\t\tstyle="--ui-icon-set__icon-size: 18px;"\n\t\t\t\t\tdata-id="spaces-list-element-mute-icon"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class="sn-spaces__list-item_description" data-id="spaces-list-element-description">\n\t\t\t\t{{spaceDescription}}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="sn-spaces__list-item_details">\n\t\t\t<div class="sn-spaces__list-item_time" data-id="spaces-list-element-activity-date">\n\t\t\t\t{{formatDate(spaceModel.recentActivity.date.getTime())}}\n\t\t\t</div>\n\t\t\t<div class="sn-spaces__list-item_changes">\n\t\t\t\t<div\n\t\t\t\t\tv-if="doShowPin"\n\t\t\t\t\tclass="ui-icon-set --pin-1"\n\t\t\t\t\tstyle='--ui-icon-set__icon-size: 18px;'\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="doShowCounter"\n\t\t\t\t\t:class="counterClass(isFollowing)"\n\t\t\t\t\tdata-id="spaces-list-element-counter"\n\t\t\t\t>\n\t\t\t\t\t{{formatCounter(spaceModel.counter)}}\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\tv-if="doShowJoinButton"\n\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-success ui-btn-no-caps ui-btn-round sn-spaces__list-item_btn-event"\n\t\t\t\t\t@click="onJoinButtonClick"\n\t\t\t\t\tdata-id="spaces-list-element-join-button"\n\t\t\t\t>\n\t\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_JOIN_SPACE_BUTTON')}}\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tv-if="doShowPendingButton"\n\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-primary ui-btn-no-caps ui-btn-round sn-spaces__list-item_btn-event"\n\t\t\t\t\t@click="onPendingButtonClick"\n\t\t\t\t\tdata-id="spaces-list-element-pending-button"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --mail-out" style='--ui-icon-set__icon-color: white;'></div>\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tv-if="doShowSuccessButton"\n\t\t\t\t\tclass="ui-btn ui-btn-xs ui-btn-primary ui-btn-no-caps ui-btn-round sn-spaces__list-item_btn-event"\n\t\t\t\t\t@click="onAcceptedButtonClick"\n\t\t\t\t\tdata-id="spaces-list-element-success-button"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --check" style='--ui-icon-set__icon-color: white;'></div>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if="isInvitation" class="sn-spaces__list-item_btns">\n\t\t\t<button\n\t\t\t\tclass="ui-btn ui-btn-sm ui-btn-success ui-btn-no-caps ui-btn-round"\n\t\t\t\t@click="acceptInvitationButtonClickHandler"\n\t\t\t\tdata-id="spaces-list-element-accept-invitation-button"\n\t\t\t>\n\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_ACCEPT_INVITATION_BUTTON')}}\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\tclass="ui-btn ui-btn-sm ui-btn-light-border ui-btn-no-caps ui-btn-round"\n\t\t\t\t@click="declineInvitationButtonClickHandler"\n\t\t\t\tdata-id="spaces-list-element-decline-invitation-button"\n\t\t\t>\n\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_DECLINE_INVITATION_BUTTON')}}\n\t\t\t</button>\n\t\t</div>\n\t`};const At="sn-spaces__short";const Tt={components:{BasePopup:D,SpaceContent:Mt},emits:["closeSpacePopup","popupSpaceClick"],props:{bindElement:{type:Object,required:true},context:{type:String,required:true},options:{type:Object,required:true},space:{type:Object,default:()=>{}},mode:{type:String,required:true},link:{type:String,required:true},isInvitation:{type:Boolean,default:false}},data(){return{modes:w}},computed:{POPUP_ID(){return`${At}-${this.context}`},config(){return{className:"sn-spaces__list-popup",width:293,height:this.heightPopup,closeIcon:false,closeByEsc:true,overlay:false,padding:0,animation:"fading-slide",offsetLeft:this.options.left,offsetTop:-70,bindOptions:{position:"bottom"},bindElement:this.bindElement}},classModifiers(){const t=[];if(this.isInvitation){t.push("--invitation")}return t.join(" ")},spaceModel(){return this.space},heightPopup(){return this.isInvitation?115:70}},methods:{closePopupShortSpace(){this.$emit("closeSpacePopup")},onSpaceClick(){this.$emit("popupSpaceClick")}},template:`\n\t\t<BasePopup\n\t\t\t:config="config"\n\t\t\t:id="POPUP_ID"\n\t\t>\n\t\t\t<div\n\t\t\t\tref="popup-content"\n\t\t\t\tclass="sn-spaces__popup-list_collapsed-mode"\n\t\t\t\t@click="onSpaceClick"\n\t\t\t\t@mouseleave="closePopupShortSpace"\n\t\t\t>\n\t\t\t\t<div \n\t\t\t\t\tclass="sn-spaces__popup-list-item"\n\t\t\t\t\t:class="classModifiers"\n\t\t\t\t>\n\t\t\t\t\t<SpaceContent \n\t\t\t\t\t\t:space="space" \n\t\t\t\t\t\t:mode="mode"\n\t\t\t\t\t\t:is-invitation="isInvitation"\n\t\t\t\t\t\t:showAvatar="false"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BasePopup>\n\t`};const Et={components:{PopupShortSpace:Tt,SpaceContent:Mt},props:{space:{type:Object,default:()=>{}},mode:{type:String,required:true},isInvitation:{type:Boolean,default:false}},data(){return{modes:w,spaceUserRoles:T,showModePopup:false}},computed:{popupShortSpaceOptions(){return{left:this.widthItem}},selectedFilterModeType(){return this.$store.state.main.selectedFilterModeType},classModifiers(){const t=this.mode===this.modes.recent;const e=[];if(this.spaceModel.isPinned&&this.selectedFilterModeType===y.my&&t){e.push("--pinned")}if(this.spaceModel.isSelected&&t){e.push("--active")}if(this.isInvitation){e.push("--invitation")}return e.join(" ")},link(){return R.getSpaceLink(this.spaceModel.id)},spaceModel(){return this.space},widthItem(){return this.$refs.link.getBoundingClientRect().width},isCommon(){return this.spaceModel.id===0}},created(){p.EventEmitter.subscribe(H.openSpaceFromContextMenu,this.openSpaceFromContextMenu)},beforeUnmount(){p.EventEmitter.unsubscribe(H.openSpaceFromContextMenu,this.openSpaceFromContextMenu)},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},async openSpaceFromContextMenu(t){const e=t.data.spaceId;if(this.spaceModel.id===e){await this.onSpaceClick()}},getPinMessage(){return this.spaceModel.isPinned?this.loc("SOCIALNETWORK_SPACES_LIST_SPACE_UNPIN"):this.loc("SOCIALNETWORK_SPACES_LIST_SPACE_PIN")},getFollowMessage(){return this.spaceModel.follow?this.loc("SOCIALNETWORK_SPACES_LIST_SPACE_UNFOLLOW"):this.loc("SOCIALNETWORK_SPACES_LIST_SPACE_FOLLOW")},getOpenMessage(){return this.loc("SOCIALNETWORK_SPACES_LIST_SPACE_OPEN")},getCopyLinkMessage(){return this.loc("SN_SPACES_LIST_SPACE_COPY_LINK")},getLogoutMessage(){return this.loc("SN_SPACES_LIST_SPACE_LOGOUT")},async onSpaceClick(){const t=this.mode;if(this.mode!==w.recent){this.$bitrix.eventEmitter.emit(H.changeMode,w.recent)}this.$store.dispatch("setSelectedSpace",this.spaceModel.id);BX.Socialnetwork.Spaces.space.reloadPageContent(R.getSpaceLink(this.spaceModel.id));if([w.recentSearch,w.search].includes(t)){await L.addSpaceToRecentSearch(this.spaceModel.id)}},async onSpaceContextMenuClick(t){t.preventDefault();if(this.isCommon||this.spaceModel.userRole!==T.member){return}const e=new ht({spaceId:this.spaceModel.id,bindElement:t.currentTarget,path:this.link,isSelected:this.spaceModel.isSelected,permissions:this.spaceModel.permissions,listFilter:this.selectedFilterModeType,listMode:this.mode,pinMessage:this.getPinMessage(),followMessage:this.getFollowMessage(),openMessage:this.getOpenMessage(),copyLinkMessage:this.getCopyLinkMessage(),logoutMessage:this.getLogoutMessage()});e.subscribe("openCommonSpace",(()=>{n.Controller.openCommonSpace()}));e.toggle()},openPopup(){if(this.$store.getters.spacesListState===k.collapsed){this.showModePopup=true}},closePopup(){if(this.$store.getters.spacesListState===k.collapsed){var t;const e=this.$refs.link;const s=(t=this.$refs["popup-item"])==null?void 0:t.$refs["popup-content"];let a=null;d.Event.bind(document,"mouseover",(t=>{a=t.target}));setTimeout((()=>{if(!s||!e.contains(a)&&!s.contains(a)){this.showModePopup=false}}),100)}}},template:`\n\t\t<a\n\t\t\tref="link"\n\t\t\tclass="sn-spaces__list-item"\n\t\t\t:class="classModifiers"\n\t\t\tdata-id="spaces-list-element"\n\t\t\t@click="onSpaceClick"\n\t\t\t@contextmenu="onSpaceContextMenuClick"\n\t\t\t@mouseenter="openPopup"\n\t\t\t@mouseleave="closePopup"\n\t\t>\n\t\t\t<PopupShortSpace\n\t\t\t\tref="popup-item"\n\t\t\t\t:options="popupShortSpaceOptions"\n\t\t\t\t:space="space"\n\t\t\t\t:mode="mode"\n\t\t\t\t:link="link"\n\t\t\t\t:is-invitation="isInvitation"\n\t\t\t\tcontext="popup-short-space"\n\t\t\t\t:bind-element="$refs['link'] || {}"\n\t\t\t\tv-if="showModePopup"\n\t\t\t\t@close="showModePopup = false"\n\t\t\t\t@closeSpacePopup="closePopup"\n\t\t\t\t@popupSpaceClick="onSpaceClick"\n\t\t\t/>\n\t\t\t<SpaceContent \n\t\t\t\t:space="space" \n\t\t\t\t:mode="mode"\n\t\t\t\t:is-invitation="isInvitation"\n\t\t\t/>\n\t\t</a>\n\t`};const Ft=Object.freeze({enter:13});const Bt={components:{PopupMenu:K},data(){return{modes:w,spaceViewModes:A,spaceViewModeTypes:M,spaceData:{name:"",viewMode:M.open,image:null},isFocusedOnNameInput:false,showViewModePopup:false,wasCreateGroupRequestSent:false,doShowNameAlreadyExistsError:false,avatarColor:""}},computed:{...l.mapGetters({avatarColors:"avatarColors",previousAvatarColor:"previousAvatarColor"}),isDataValidated(){return this.spaceData.name.length>0&&!this.doShowNameAlreadyExistsError},confirmButtonClass(){return this.isDataValidated&&!this.wasCreateGroupRequestSent?"":"--disabled"},popupMenuOptions(){return this.spaceViewModes.map((t=>({type:t.type,name:this.loc(t.nameMessageId),description:this.loc(t.descriptionMessageId)})))},selectedViewModeOptionName(){return this.loc(`SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_${this.spaceData.viewMode.toUpperCase()}_TITLE`)},nameInputModifier(){return this.doShowNameAlreadyExistsError?"sn-spaces__list-add-item_input-error":""},isNameInputReadOnly(){return this.wasCreateGroupRequestSent}},mounted(){this.$refs.spaceAddFormNameInput.focus();d.Event.bind(document,"click",this.handleAutoHide,true);d.Event.bind(document,"keydown",this.handleKeyDown);this.$bitrix.eventEmitter.subscribe(H.showUpperSpaceAddForm,this.chooseRandomAvatarColor);this.chooseRandomAvatarColor()},unmounted(){d.Event.unbind(document,"click",this.handleAutoHide,true);d.Event.unbind(document,"keydown",this.handleKeyDown);this.$bitrix.eventEmitter.unsubscribe(H.showUpperSpaceAddForm,this.chooseRandomAvatarColor)},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},openViewModePopup(){this.showViewModePopup=true},onChangeSelectedOption(t){this.spaceData.viewMode=t},chooseSpaceImage(){const t=this.getAvatarEditor();t.show("file")},getAvatarEditor(){if(!this.avatarEditor){this.avatarEditor=new c.Editor({enableCamera:false});d.Dom.addClass(this.avatarEditor.popup.getPopupContainer(),"sn-spaces__avatar-editor");this.avatarEditor.subscribe("onApply",(t=>{var e;const[s]=t.getCompatData();(e=s.name)!=null?e:s.name="tmp.png";this.spaceData.image=s;this.$refs.groupImage.src=URL.createObjectURL(s);d.Dom.style(this.$refs.groupImageContainer,"background","none");d.Dom.style(this.$refs.groupImage,"background","none")}))}return this.avatarEditor},onAddSpaceClickHandler(){this.addSpace()},chooseRandomAvatarColor(){if(this.spaceData.image!==null){return}if(!d.Type.isArrayFilled(this.avatarColors)){return}const t=this.avatarColors.filter((t=>t!==this.previousAvatarColor));this.avatarColor=t[Math.floor(Math.random()*t.length)];d.Dom.style(this.$refs.groupImageContainer,"backgroundColor",`#${this.avatarColor}`);this.$store.dispatch("setAvatarColor",this.avatarColor)},addSpace(){this.spaceData.name=this.spaceData.name.trim();if(this.spaceData.name.length===0){return}const t=new FormData;t.append("groupName",this.spaceData.name);t.append("viewMode",this.spaceData.viewMode);if(this.spaceData.image!==null){t.append("groupImage",this.spaceData.image,this.spaceData.image.name)}t.append("avatarColor",this.avatarColor);this.wasCreateGroupRequestSent=true;d.ajax.runAction("socialnetwork.api.workgroup.createGroup",{data:t}).then((t=>{BX.Socialnetwork.Spaces.space.reloadPageContent(`${R.getSpaceLink(t.data.groupId)}?empty-state=enabled`);this.$bitrix.eventEmitter.emit(H.hideSpaceAddForm);L.loadSpaceData(t.data.groupId).then((t=>{this.$store.dispatch("addSpacesToView",{mode:w.recentSearch,spaces:[t.space]});this.$store.dispatch("setSelectedSpace",t.space.id)}))}),(t=>{t.errors.forEach((t=>{if(t.code==="ERROR_GROUP_NAME_EXISTS"){this.doShowNameAlreadyExistsError=true}}));this.wasCreateGroupRequestSent=false;console.log(t)}))},handleAutoHide(t){if(this.shouldHideForm(t)){this.$bitrix.eventEmitter.emit(H.hideSpaceAddForm)}},handleKeyDown(t){if(this.isFocusedOnNameInput&&t.keyCode===Ft.enter&&this.isDataValidated&&!this.wasCreateGroupRequestSent){this.addSpace()}},shouldHideForm(t){var e,s;const a=this.$refs.spaceAddForm.offsetHeight===0;if(a){return false}const i=t.target.closest(".sn-spaces__list-item")!==null;const o=this.$refs.spaceAddForm.contains(t.target);const n=(e=this.avatarEditor)==null?void 0:(s=e.popup)==null?void 0:s.isShown();const c=this.showViewModePopup;const r=n||c;return!o&&!i&&!r&&!this.formDataChanged()},formDataChanged(){const t=this.spaceData.name!=="";const e=this.spaceData.viewMode!==M.open;const s=this.$refs.groupImage.src!=="";return t||e||s}},template:`\n\t\t<div class="sn-spaces__list-item --add-active --error" ref="spaceAddForm" data-id="spaces-list-add-space-form">\n\t\t\t<div class="sn-spaces__list-item_add">\n\t\t\t\t<div class="sn-spaces__list-item_icon" ref="groupImageContainer">\n\t\t\t\t\t<img\n\t\t\t\t\t\talt="" class="spaces-list-add-space-image"\n\t\t\t\t\t\t@click="chooseSpaceImage()"\n\t\t\t\t\t\tref="groupImage"\n\t\t\t\t\t\tdata-id="spaces-list-add-space-image"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class="sn-spaces__list-item_info">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-xs ui-ctl-no-padding ui-ctl-no-border">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tv-model="spaceData.name"\n\t\t\t\t\t\t\ttype="text" class="ui-ctl-element"\n\t\t\t\t\t\t\t:placeholder="loc('SOCIALNETWORK_SPACES_LIST_ADD_SPACE_FORM_NAME_PLACEHOLDER')"\n\t\t\t\t\t\t\tref="spaceAddFormNameInput"\n\t\t\t\t\t\t\tdata-id="spaces-list-add-space-name-input"\n\t\t\t\t\t\t\t@focus="isFocusedOnNameInput=true"\n\t\t\t\t\t\t\t@blur="isFocusedOnNameInput=false"\n\t\t\t\t\t\t\t:class="nameInputModifier"\n\t\t\t\t\t\t\t@input="doShowNameAlreadyExistsError=false"\n\t\t\t\t\t\t\t:readonly="isNameInputReadOnly"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div @click="openViewModePopup" ref="privacySelector" class="sn-spaces__list-item_select-private">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="sn-spaces__list-item_select-private-text"\n\t\t\t\t\t\t\tdata-id="spaces-list-add-space-view-mode"\n\t\t\t\t\t\t>{{selectedViewModeOptionName}}</div>\n\t\t\t\t\t\t<div class="ui-icon-set --chevron-down" style="--ui-icon-set__icon-size: 14px;"></div>\n\t\t\t\t\t\t<PopupMenu\n\t\t\t\t\t\t\tv-if="showViewModePopup"\n\t\t\t\t\t\t\t:options="popupMenuOptions"\n\t\t\t\t\t\t\tcontext="space-add-form"\n\t\t\t\t\t\t\t:bind-element="this.$refs.privacySelector || {}"\n\t\t\t\t\t\t\t:hint="loc('SOCIALNETWORK_SPACES_LIST_SPACE_VIEW_MODE_HINT')"\n\t\t\t\t\t\t\t:selectedOption="this.spaceData.viewMode"\n\t\t\t\t\t\t\t@close="showViewModePopup = false"\n\t\t\t\t\t\t\t@changeSelectedOption="onChangeSelectedOption"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="sn-spaces__list-item_details">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="ui-icon-set --circle-check sn-spaces__list-item_save-btn" :class="confirmButtonClass"\n\t\t\t\t\t\t@click="onAddSpaceClickHandler()"\n\t\t\t\t\t\tdata-id="spaces-list-add-space-create-button"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-show="doShowNameAlreadyExistsError" class="sn-spaces__list-item_error">\n\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_NAME_ALREADY_EXISTS_ERROR')}}\n\t\t\t</div>\n\t\t</div>\n\t`};const Ot={methods:{loc(t){return this.$bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="sn-spaces__list-item --add-btn">\n\t\t\t<div class="sn-spaces__list-item_icon">\n\t\t\t</div>\n\t\t\t<div class="sn-spaces__list-item_info">\n\t\t\t\t<div class="sn-spaces__list-item_title">\n\t\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_ADD_SPACE_ITEM_TITLE')}}\n\t\t\t\t</div>\n\t\t\t\t<div class="sn-spaces__list-item_description">\n\t\t\t\t\t{{loc('SOCIALNETWORK_SPACES_LIST_ADD_SPACE_ITEM_DESCRIPTION')}}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Rt={data(){return{loader:null}},props:{config:{type:Object,required:false,default(){return{}}}},mounted(){this.getLoaderInstance().show()},beforeUnmount(){if(!this.instance){return}this.destroyLoader()},methods:{getLoaderInstance(){if(!this.instance){this.instance=new r.Loader(this.getLoaderConfig())}return this.instance},getDefaultConfig(){return{target:this.$refs.root,size:110,color:"#2fc6f6",offset:{left:"0px",top:"0px"},mode:"absolute"}},getLoaderConfig(){const t=this.getDefaultConfig();return{...t,...this.config}},destroyLoader(){this.instance.destroy();this.instance=null}},template:`\n\t\t<div ref="root" style="position: relative">\n\t\t</div>\n\t`};const kt=20;const Ht={components:{Space:Et,Loader:Rt,SpaceListAddButton:Ot,SpaceAddForm:Bt},emits:["isSpaceAddFormShown"],data(){return{isScrollLoading:false,isLoading:false,modes:w,doShowLowerSpaceAddForm:false,doShowUpperSpaceAddForm:false,skeletonItemsAmount:25}},props:{mode:{type:String,required:true},spaces:{type:Array,required:true,default:[]},spaceInvitations:{type:Array,required:false,default:[]},canCreateGroup:Boolean,spacesCountForLoad:{type:Number,required:true},serviceInstance:{type:Object,required:true},subtitle:{type:String,required:false,default:""},isShown:{type:Boolean,required:true}},created(){this.$bitrix.eventEmitter.subscribe(H.tryToLoadSpacesIfHasNoScrollbar,this.tryToLoadSpacesIfHasNoScrollbarHandler);this.$bitrix.eventEmitter.subscribe(H.showLoader,this.showLoaderHandler);this.$bitrix.eventEmitter.subscribe(H.hideLoader,this.hideLoaderHandler);this.$bitrix.eventEmitter.subscribe(H.showUpperSpaceAddForm,this.showUpperSpaceAddFormHandler);this.$bitrix.eventEmitter.subscribe(H.hideSpaceAddForm,this.hideSpaceAddFormHandler)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(H.tryToLoadSpacesIfHasNoScrollbar,this.tryToLoadSpacesIfHasNoScrollbarHandler);this.$bitrix.eventEmitter.unsubscribe(H.showLoader,this.showLoaderHandler);this.$bitrix.eventEmitter.unsubscribe(H.hideLoader,this.hideLoaderHandler);this.$bitrix.eventEmitter.unsubscribe(H.showUpperSpaceAddForm,this.showUpperSpaceAddFormHandler);this.$bitrix.eventEmitter.unsubscribe(H.hideSpaceAddForm,this.hideSpaceAddFormHandler)},computed:{service(){return this.serviceInstance},hasScrollbar(){return this.$refs.list.scrollHeight>this.$refs.list.clientHeight},loadingClass(){return this.isLoading?"--loading":""},filterMode(){return this.$store.state.main.selectedFilterModeType},doShowSubtitle(){return this.subtitle.length>0},doShowSpaceListAddButton(){return this.canCreateGroup&&this.mode===this.modes.recent&&this.spaces.length<=5&&!this.isSpaceAddFormShown},doShowInvitations(){return this.mode===this.modes.recent&&this.spaceInvitations.length>0},isSpaceAddFormShown(){return this.doShowLowerSpaceAddForm||this.doShowUpperSpaceAddForm},listState(){return this.$store.getters.spacesListState}},watch:{filterMode(){this.scrollToTop();this.isLoading=false},isShown(){if(this.isShown===true){const t=this.$refs.list.scrollTop>0;this.$bitrix.eventEmitter.emit(H.spaceListShown,{isSpaceListScrolled:t,mode:this.mode})}},doShowUpperSpaceAddForm(){if(this.doShowUpperSpaceAddForm===true){this.doShowLowerSpaceAddForm=false}},isSpaceAddFormShown(){this.$emit("isSpaceAddFormShown",this.isSpaceAddFormShown)}},methods:{tryToLoadSpacesIfHasNoScrollbarHandler(t){const e=t.data;if(this.isProperMode(e)&&!this.hasScrollbar&&this.service.canLoadSpaces()){this.loadSpaces()}},showLoaderHandler(t){const e=t.data;if(this.isProperMode(e)){this.isLoading=true}},hideLoaderHandler(t){const e=t.data;if(this.isProperMode(e)){this.isLoading=false}},showUpperSpaceAddFormHandler(){if(this.mode===this.modes.recent){this.doShowUpperSpaceAddForm=true}},showLowerSpaceAddForm(){this.doShowLowerSpaceAddForm=true},hideSpaceAddFormHandler(){this.doShowLowerSpaceAddForm=false;this.doShowUpperSpaceAddForm=false;if(this.listState===k.expanded){this.$bitrix.eventEmitter.emit(H.changeSpaceListState,k.collapsed)}},isProperMode(t){return this.mode===t},scrollToTop(){this.$refs.list.scrollTop=0},onScroll(t){const e=t.target;const s=e.scrollTop>0;this.$bitrix.eventEmitter.emit(H.spaceListScroll,{isSpaceListScrolled:s,mode:this.mode});const a=e.scrollHeight-e.offsetHeight;const i=e.scrollTop;const o=i>a-kt;if(!this.isScrollLoading&&this.service.canLoadSpaces()&&o){this.loadSpaces()}vt.getInstance().destroy()},loadSpaces(){this.isScrollLoading=true;this.service.loadSpaces({loadedSpacesCount:this.spacesCountForLoad,filterMode:this.filterMode}).then((t=>{this.$store.dispatch("addSpacesToView",{mode:this.mode,spaces:t.spaces});this.isScrollLoading=false})).catch((()=>{setTimeout((()=>{this.isScrollLoading=false}),5e3)}))}},template:`\n\t\t<span>\n\t\t\t<Loader v-if="isLoading" :config="{offset: {left: '0px', top: '40vh'}}"/>\n\t\t\t<div\n\t\t\t\t@scroll="onScroll"\n\t\t\t\tclass="sn-spaces__list-content"\n\t\t\t\t:class="loadingClass"\n\t\t\t\tref="list"\n\t\t\t\tdata-id="spaces-list-content"\n\t\t\t>\n\t\t\t\t<div v-show="doShowSubtitle" class="sn-spaces__list-subtitle">\n\t\t\t\t\t{{subtitle}}\n\t\t\t\t</div>\n\t\t\t\t<SpaceAddForm v-if="doShowUpperSpaceAddForm"/>\n\t\t\t\t<div class="sn-spaces__list-item_invitation" v-if="doShowInvitations">\n\t\t\t\t\t<Space\n\t\t\t\t\t\tv-for="spaceInvitation in spaceInvitations"\n\t\t\t\t\t\t:key="spaceInvitation.id"\n\t\t\t\t\t\t:space="spaceInvitation"\n\t\t\t\t\t\t:mode="mode"\n\t\t\t\t\t\t:isInvitation="true"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<Space \n\t\t\t\t\tv-for="space in spaces"\n\t\t\t\t\t:key="space.id"\n\t\t\t\t\t:space="space"\n\t\t\t\t\t:mode="mode"\n\t\t\t\t/>\n\t\t\t\t<SpaceListAddButton\n\t\t\t\t\tv-if="doShowSpaceListAddButton"\n\t\t\t\t\t@click="showLowerSpaceAddForm"\n\t\t\t\t\tdata-id="spaces-list-add-space-button"\n\t\t\t\t/>\n\t\t\t\t<SpaceAddForm v-if="doShowLowerSpaceAddForm"/>\n\t\t\t\t<span v-show="isScrollLoading">\n\t\t\t\t\t<div v-for="index in skeletonItemsAmount" :key="index" class="sn-spaces__list-skeleton-item"></div>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</span>\n\t`};class xt{constructor(){this.hasMoreSpacesToLoad=false}static getInstance(){if(!this.instance){this.instance=new this}return this.instance}async loadSpaces(){return L.loadRecentSearchSpaces()}canLoadSpaces(){return false}}xt.instance=null;const Dt=3;const $t={name:"ToggleBlock",data(){return{dataSpacesContent:document.getElementById("sn-spaces__content"),counterImpressionsBtnShowToggleBlock:0,showBtnShowToggleBlock:false}},created(){this.$bitrix.eventEmitter.subscribe(H.showBtnToggleBlock,this.showBtnToggleBlockHandler)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(H.showBtnToggleBlock,this.showBtnToggleBlockHandler)},computed:{isShowHintBtn(){return!(this.counterImpressionsBtnShowToggleBlock>Dt)},btnClassName(){return this.showBtnShowToggleBlock?"":"--hide"}},mounted(){if(localStorage.counterImpressionsBtnShowToggleBlock){this.counterImpressionsBtnShowToggleBlock=localStorage.counterImpressionsBtnShowToggleBlock}},methods:{showBtnToggleBlockHandler(){if(this.isShowHintBtn&&!this.showBtnShowToggleBlock){this.showBtnShowToggleBlock=true}},hideBtnToggleBlockHandler(){this.showBtnShowToggleBlock=false},hideHintBtn(){localStorage.counterImpressionsBtnShowToggleBlock=++this.counterImpressionsBtnShowToggleBlock;this.showBtnShowToggleBlock=false},toggleList(){this.showBtnShowToggleBlock=false;if(this.$store.getters.spacesListState===k.collapsed){this.$bitrix.eventEmitter.emit(H.changeSpaceListState,k.default);this.saveState(k.default);d.Dom.removeClass(this.dataSpacesContent,"--list-collapsed-mode")}else{this.$bitrix.eventEmitter.emit(H.changeSpaceListState,k.collapsed);this.saveState(k.collapsed);d.Dom.addClass(this.dataSpacesContent,"--list-collapsed-mode")}},saveState(t){d.ajax.runAction("socialnetwork.api.space.saveListSate",{data:{spacesListState:t}})}},template:`\n\t\t<div class="sn-spaces__toggle-block">\n\t\t\t<div class="sn-spaces__toggle-image"></div>\n\t\t\t<div \n\t\t\t\tclass="sn-spaces__toggle-wrapper"\n\t\t\t\t@click="toggleList"\n\t\t\t>\n\t\t\t\t<div \n\t\t\t\t\tref="toggle-btn"\n\t\t\t\t\tclass="sn-spaces__toggle-btn" \n\t\t\t\t\tid="sn-spaces__toggle-btn"\n\t\t\t\t\tdata-id="sn-spaces__toggle-btn"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-icon-set --chevron-left" style="--ui-icon-set__icon-size: 15px;"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="sn-spaces__btn-show-toggle-block"\n\t\t\t\t:class="btnClassName"\n\t\t\t\tdata-id="sn-spaces__btn-hint_show-toggle-block"\n\t\t\t\tv-if="isShowHintBtn"\n\t\t\t\t@click="hideHintBtn"\n\t\t\t\t@mouseleave="hideBtnToggleBlockHandler"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --chevron-left" style="--ui-icon-set__icon-size: 15px;"></div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Nt={components:{RecentHeader:W,SpaceList:Ht,SearchHeader:q,CollapsedModeToggleBlock:$t},data(){return{mode:"recent",modes:w,listNode:document.getElementById("sn-spaces-list"),isSpaceAddFormShownInRecentList:false}},computed:{...l.mapGetters({recentSpaces:"recentSpaces",recentSpacesCountForLoad:"recentSpacesCountForLoad",recentSearchSpaces:"recentSearchSpaces",recentSearchSpacesCountForLoad:"recentSearchSpacesCountForLoad",searchSpaces:"searchSpaces",searchSpacesCountForLoad:"searchSpacesCountForLoad",spacesLoadedByCurrentSearchQueryCount:"spacesLoadedByCurrentSearchQueryCount",canCreateGroup:"canCreateGroup",spaceInvitations:"spaceInvitations"}),doExpandCollapsedList(){const t=this.$store.getters.spacesListState===k.collapsed;const e=[this.modes.search,this.modes.recentSearch].includes(this.mode);return t&&(e||this.isSpaceAddFormShownInRecentList)},doCollapseExpandedList(){const t=this.$store.getters.spacesListState===k.expanded;const e=this.modes.recent===this.mode;return t&&e&&!this.isSpaceAddFormShownInRecentList}},watch:{doExpandCollapsedList(){if(this.doExpandCollapsedList){this.changeSpaceListState(k.expanded)}},doCollapseExpandedList(){if(this.doCollapseExpandedList){this.changeSpaceListState(k.collapsed)}}},created(){this.$bitrix.eventEmitter.subscribe(H.changeSpaceListState,this.changeSpaceListStateHandler);this.$bitrix.eventEmitter.subscribe(H.changeMode,this.changeModeHandler)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(H.changeSpaceListState,this.changeSpaceListStateHandler);this.$bitrix.eventEmitter.unsubscribe(H.changeMode,this.changeModeHandler)},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},changeModeHandler(t){const e=t.data;this.setMode(e)},setMode(t){this.mode=t},getRecentService(){return C.getInstance()},getRecentSearchService(){return xt.getInstance()},getSearchService(){return V.getInstance()},changeSpaceListStateHandler(t){const e=t.data;this.changeSpaceListState(e)},changeSpaceListState(t){if(t===k.expanded&&!d.Dom.hasClass(this.listNode,"--fixed")){d.Dom.addClass(this.listNode,"--fixed")}else if(d.Dom.hasClass(this.listNode,"--fixed")){d.Dom.removeClass(this.listNode,"--fixed")}this.$store.dispatch("setSpacesListState",t)},isSpaceAddFormShownHandler(t){this.isSpaceAddFormShownInRecentList=t}},template:`\n\t\t<div class="sn-spaces__list-wrapper">\n\t\t\t<RecentHeader\n\t\t\t\tv-if="mode === modes.recent"\n\t\t\t\t:canCreateGroup="canCreateGroup"\n\t\t\t\t@changeMode="setMode"\n\t\t\t/>\n\t\t\t<SearchHeader\n\t\t\t\tv-if="mode === modes.search || mode === modes.recentSearch"\n\t\t\t\t@changeMode="setMode"\n\t\t\t/>\n\t\t\t<SpaceList\n\t\t\t\tv-show="mode === modes.recent"\n\t\t\t\t@isSpaceAddFormShown="isSpaceAddFormShownHandler"\n\t\t\t\t:isShown="mode === modes.recent"\n\t\t\t\t:mode="modes.recent"\n\t\t\t\t:spaces="recentSpaces"\n\t\t\t\t:spaceInvitations="spaceInvitations"\n\t\t\t\t:canCreateGroup="canCreateGroup"\n\t\t\t\t:spacesCountForLoad="recentSpacesCountForLoad"\n\t\t\t\t:serviceInstance="getRecentService()"\n\t\t\t/>\n\t\t\t<SpaceList\n\t\t\t\tv-show="mode === modes.recentSearch"\n\t\t\t\t:isShown="mode === modes.recentSearch"\n\t\t\t\t:mode="modes.recentSearch"\n\t\t\t\t:spaces="recentSearchSpaces"\n\t\t\t\t:canCreateGroup="canCreateGroup"\n\t\t\t\t:spacesCountForLoad="recentSearchSpacesCountForLoad"\n\t\t\t\t:serviceInstance="getRecentSearchService()"\n\t\t\t\t:subtitle="loc('SOCIALNETWORK_SPACES_LIST_RECENT_SEARCH_LIST_TITLE')"\n\t\t\t/>\n\t\t\t<SpaceList\n\t\t\t\tv-show="mode === modes.search"\n\t\t\t\t:isShown="mode === modes.search"\n\t\t\t\t:mode="modes.search"\n\t\t\t\t:spaces="searchSpaces"\n\t\t\t\t:canCreateGroup="canCreateGroup"\n\t\t\t\t:spacesCountForLoad="searchSpacesCountForLoad"\n\t\t\t\t:serviceInstance="getSearchService()"\n\t\t\t\t:subtitle="loc('SOCIALNETWORK_SPACES_LIST_SEARCH_LIST_TITLE')"\n\t\t\t/>\n\t\t</div>\n\t\t<CollapsedModeToggleBlock />\n\t`};var Ut=babelHelpers.classPrivateFieldLooseKey("pinChanged");var jt=babelHelpers.classPrivateFieldLooseKey("updateCounters");var Kt=babelHelpers.classPrivateFieldLooseKey("onChangeSpace");var Wt=babelHelpers.classPrivateFieldLooseKey("onChangeUserRole");var Gt=babelHelpers.classPrivateFieldLooseKey("onChangeSubscription");var Vt=babelHelpers.classPrivateFieldLooseKey("onRecentActivityUpdate");var qt=babelHelpers.classPrivateFieldLooseKey("onRecentActivityDelete");var Xt=babelHelpers.classPrivateFieldLooseKey("onRecentActivityRemoveFromSpace");class zt extends p.EventEmitter{constructor(){super();Object.defineProperty(this,Xt,{value:ae});Object.defineProperty(this,qt,{value:se});Object.defineProperty(this,Vt,{value:ee});Object.defineProperty(this,Gt,{value:te});Object.defineProperty(this,Wt,{value:Zt});Object.defineProperty(this,Kt,{value:Jt});Object.defineProperty(this,jt,{value:Qt});Object.defineProperty(this,Ut,{value:Yt});this.setEventNamespace("BX.Socialnetwork.Spaces.List.PullRequests")}getModuleId(){return"socialnetwork"}getMap(){return{workgroup_pin_changed:babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut].bind(this),user_spaces_counter:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].bind(this),workgroup_update:babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt].bind(this),workgroup_subscribe_changed:babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].bind(this),space_user_role_change:babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].bind(this),recent_activity_update:babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt].bind(this),recent_activity_delete:babelHelpers.classPrivateFieldLooseBase(this,qt)[qt].bind(this),recent_activity_remove_from_space:babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].bind(this)}}}function Yt(t){this.emit(H.pinChanged,{spaceId:t.GROUP_ID,isPinned:t.ACTION==="pin"})}function Qt(t){this.emit(H.updateCounters,t)}function Jt(t){const e=t.params;this.emit(H.changeSpace,{spaceId:e.GROUP_ID})}function Zt(t){this.emit(H.changeUserRole,{spaceId:t.GROUP_ID,userId:t.USER_ID})}function te(t){this.emit(H.changeSubscription,{spaceId:t.GROUP_ID,userId:t.USER_ID})}function ee(t){this.emit(H.recentActivityUpdate,{recentActivities:t})}function se(t){this.emit(H.recentActivityDelete,{typeId:t.typeId,entityId:t.entityId})}function ae(t){this.emit(H.recentActivityRemoveFromSpace,{spaceIds:t.spaceIdsToReload})}var ie=babelHelpers.classPrivateFieldLooseKey("initialOptions");var oe=babelHelpers.classPrivateFieldLooseKey("target");var ne=babelHelpers.classPrivateFieldLooseKey("application");var ce=babelHelpers.classPrivateFieldLooseKey("initLinkManager");var re=babelHelpers.classPrivateFieldLooseKey("initServices");var le=babelHelpers.classPrivateFieldLooseKey("createApplication");class de{constructor(t){Object.defineProperty(this,le,{value:ue});Object.defineProperty(this,re,{value:he});Object.defineProperty(this,ce,{value:pe});Object.defineProperty(this,ie,{writable:true,value:void 0});Object.defineProperty(this,oe,{writable:true,value:void 0});Object.defineProperty(this,ne,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]=t;if(t.doShowCollapseMenuAhaMoment){(new v).showAhaMoment()}}create(t){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=t;babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]();babelHelpers.classPrivateFieldLooseBase(this,re)[re]();babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}}function pe(){R.groupPath=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].pathToGroupSpace;R.commonSpacePath=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].pathToUserSpace}function he(){C.getInstance().setSelectedSpaceId(parseInt(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].selectedSpaceId,10))}function ue(){const t=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].recentSpaceIds;const s=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].invitationSpaceIds;const a=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].invitations;const i=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].spaces;const o=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].avatarColors;const n=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].filterMode;const c=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].spacesListMode;const r=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].canCreateGroup;const l=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].currentUserId;babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=e.BitrixVue.createApp({name:"SpacesList",props:{initialSpaces:Array,selectedFilterModeType:String,spacesListState:String,canCreateGroup:Boolean,recentSpaceIds:Array,invitations:Array,invitationSpaceIds:Array},components:{BaseComponent:Nt},methods:{castArrayValuesToInt(t){return t.map((t=>parseInt(t,10)))},subscribeToPull(){const t=new zt;t.subscribe(H.pinChanged,this.pinChangedHandler);t.subscribe(H.updateCounters,this.updateCountersHandler);t.subscribe(H.changeSpace,this.updateSpaceData);t.subscribe(H.changeUserRole,this.updateSpaceUserData);t.subscribe(H.changeSubscription,this.updateSpaceUserData);t.subscribe(H.recentActivityUpdate,this.recentActivityUpdate);t.subscribe(H.recentActivityDelete,this.recentActivityDelete);t.subscribe(H.recentActivityRemoveFromSpace,this.recentActivityRemoveFromSpace);h.PULL.subscribe(t)},pinChangedHandler(t){this.pinSpace(t.getData().spaceId,t.getData().isPinned)},pinSpace(t,e){this.$store.dispatch("pinSpace",{spaceId:t,isPinned:e})},updateCountersHandler(t){if(t.data.userId&&parseInt(t.data.userId,10)===l){this.$store.dispatch("updateCounters",t.data)}},async recentActivityUpdate(t){const e=t.data.recentActivities;const s=[];e.forEach((t=>{const e=this.$store.state.main.spaces.get(t.spaceId);if(e){this.$store.dispatch("updateSpaceRecentActivityData",t)}else{s.push(t.spaceId)}}));if(s.length>0){await this.loadSpaces(s)}},async recentActivityDelete(t){const e=t.data.typeId;const s=t.data.entityId;const a=[...this.$store.getters.recentSpaces.values()];const i=[];a.forEach((t=>{if(this.wasRecentActivityDeleted(t,e,s)){i.push(t.id)}}));if(i.length>0){this.loadSpaces(i)}},wasRecentActivityDeleted(t,e,s){const a=t.recentActivity;if(E[e]){const t=E[e];return a.secondaryEntityId===s&&t===a.typeId||a.entityId===s&&e===a.typeId}return a.entityId===s&&e===a.typeId},async recentActivityRemoveFromSpace(t){const e=t.data.spaceIds;const s=[];e.forEach((t=>{const e=this.$store.state.main.spaces.get(t);if(e){s.push(t)}}));this.loadSpaces(s)},async loadSpace(t){const e=await L.loadSpaceData(t);this.$store.dispatch("updateSpaceData",e)},async loadSpaces(t){const e=await L.loadSpacesData(t);e.forEach((t=>{this.$store.dispatch("updateSpaceData",{space:t,checkInvitation:false})}))},async updateSpaceData(t){if(t.data.spaceId>=0){await this.loadSpace(t.data.spaceId)}},async updateSpaceUserData(t){if(t.data.userId&&parseInt(t.data.userId,10)===l){const e=await L.loadSpaceData(t.data.spaceId);if(e.space){this.$bitrix.eventEmitter.emit(`onSpaceUpdate_${e.space.id}`,e.space)}this.$store.dispatch("updateSpaceData",e)}}},beforeCreate(){this.$bitrix.Application.set(this)},created(){this.$store.dispatch("setSpaces",this.initialSpaces);this.$store.dispatch("setRecentSpaceIds",this.castArrayValuesToInt(this.recentSpaceIds));this.$store.dispatch("setInvitationSpaceIds",this.castArrayValuesToInt(this.invitationSpaceIds));this.$store.dispatch("setInvitations",this.invitations);this.$store.dispatch("setAvatarColors",o);this.$store.dispatch("setSelectedFilterModeType",this.selectedFilterModeType);this.$store.dispatch("setSpacesListState",this.spacesListState);this.$store.dispatch("setCanCreateGroup",this.canCreateGroup);this.subscribeToPull()},mounted(){this.$bitrix.eventEmitter.emit(H.showLoader,w.recentSearch);xt.getInstance().loadSpaces().then((t=>{this.$store.dispatch("addSpacesToView",{mode:w.recentSearch,spaces:t});this.$bitrix.eventEmitter.emit(H.hideLoader,w.recentSearch)})).catch((()=>{}))},template:`\n\t\t\t\t\t<BaseComponent/>\n\t\t\t\t`},{initialSpaces:i,selectedFilterModeType:n,spacesListState:c,canCreateGroup:r,recentSpaceIds:t,invitationSpaceIds:s,invitations:a});babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].use(O);babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].mount(babelHelpers.classPrivateFieldLooseBase(this,oe)[oe])}t.List=de})(this.BX.Socialnetwork.Spaces=this.BX.Socialnetwork.Spaces||{},BX.Vue3,BX,BX.UI.Dialogs,BX.Main,BX.Main,BX.Socialnetwork,BX.UI.AvatarEditor,BX,BX.Vue3.Vuex,BX,BX.Event,BX);
//# sourceMappingURL=script.map.js