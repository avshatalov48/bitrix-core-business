BX.namespace("BX.Bizproc");if(typeof BX.Bizproc.doInlineTask==="undefined"){BX.Bizproc.doInlineTask=function(e,o,t){if(t){if(t.__waiting)return false;t.__waiting=true;if(BX.hasClass(t,"bp-button"))BX.addClass(t,"bp-button-wait")}if(!e||!e["TASK_ID"])return false;e["sessid"]=BX.bitrix_sessid();BX.ajax({method:"POST",dataType:"json",url:"/bitrix/tools/bizproc_do_task_ajax.php",data:e,onsuccess:function(e){if(e.ERROR){window.alert(e.ERROR)}if(t){t.__waiting=false;BX.removeClass(t,"bp-button-wait")}if(e.SUCCESS&&o){o(arguments)}}});return false};BX.Bizproc.taskPopupInstance=null;BX.Bizproc.taskPopupCallback=null;BX.Bizproc.showTaskPopup=function(e,o,t,a,i){if(a){if(a.__waiting)return false;a.__waiting=true;if(BX.hasClass(a,"bp-button"))BX.addClass(a,"bp-button-wait")}BX.Bizproc.taskPopupInstance=null;BX.Bizproc.taskPopupCallback=null;BX.ajax({method:"GET",dataType:"html",url:"/bitrix/components/bitrix/bizproc.task/popup.php?site_id="+BX.message("SITE_ID")+"&TASK_ID="+e+(t?"&USER_ID="+t:"")+(i?"&IFRAME=Y":""),onsuccess:function(t){if(a){a.__waiting=false;BX.removeClass(a,"bp-button-wait")}var i=BX.create("div",{style:{width:"800px"}});i.innerHTML=t;var p="",n=BX.findChild(i,{className:"bp-popup-title"},true);if(n){p=n.textContent;BX.remove(n)}BX.Bizproc.taskPopupInstance=new BX.PopupWindow("bp-task-popup-"+e+Math.round(Math.random()*1e5),null,{content:i,closeIcon:true,titleBar:p,contentColor:"white",contentNoPaddings:true,zIndex:-100,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:{backgroundColor:"black",opacity:30},events:{onPopupClose:function(e){e.destroy();if(BX.Bizproc.delegationPopup)BX.Bizproc.delegationPopup.destroy();BX.Bizproc.delegationPopup=null}}});BX.Bizproc.taskPopupCallback=o;BX.load(["/bitrix/components/bitrix/bizproc.task/templates/.default/style.css"],function(){BX.Bizproc.taskPopupInstance.show()})}});return false};BX.Bizproc.delegationPopup=null;BX.Bizproc.delegationSelected=null;BX.Bizproc.showDelegationPopup=function(e,o,t){if(BX.Bizproc.delegationPopup){BX.Bizproc.delegationPopup.show();return false}BX.ajax({method:"GET",dataType:"html",url:"/bitrix/components/bitrix/bizproc.task/delegate.php?SITE_ID="+BX.message("SITE_ID")+"&sessid="+BX.bitrix_sessid(),onsuccess:function(a){BX.Bizproc.delegationSelected=null;BX.Bizproc.delegationPopup=new BX.PopupWindow("bp-task-delegation-"+Math.round(Math.random()*1e5),e,{content:a,lightShadow:true,offsetTop:3,zIndex:0,autoHide:true,closeByEsc:true,bindOptions:{forceBindPosition:true},angle:{position:"top",offset:20},buttons:[new BX.PopupWindowButton({text:BX.message("BPAT_DELEGATE_SELECT"),className:"popup-window-button-accept",events:{click:function(e){BX.Bizproc.delegateTask(o,t,BX.Bizproc.delegationSelected);BX.Bizproc.delegationPopup.close()}}}),new BX.PopupWindowButtonLink({text:BX.message("BPAT_DELEGATE_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(e){if(!e)e=window.event;BX.Bizproc.delegationPopup.close();if(e)BX.PreventDefault(e)}}})]});BX.Bizproc.delegationPopup.show()}});return false};BX.Bizproc.delegationOnSelect=function(e){BX.Bizproc.delegationSelected=e.id};BX.Bizproc.delegateTask=function(e,o,t){var a={SITE_ID:BX.message("SITE_ID"),action:"delegate",sessid:BX.bitrix_sessid(),task_id:e,from_user_id:o,to_user_id:t};BX.ajax({action:"delegate",method:"POST",dataType:"json",url:"/bitrix/components/bitrix/bizproc.task/delegate.php",data:a,onsuccess:function(e){window.alert(e.message);if(e.success){if(!!BX.Bizproc.taskPopupInstance)BX.Bizproc.taskPopupInstance.close();if(BX.Bizproc.taskPopupCallback)BX.Bizproc.taskPopupCallback();else window.location.reload()}}})};BX.Bizproc.showWorkflowInfoPopup=function(e){BX.ajax({method:"GET",dataType:"html",url:"/bitrix/components/bitrix/bizproc.workflow.info/popup.php?site_id="+BX.message("SITE_ID")+"&WORKFLOW_ID="+e,onsuccess:function(o){BX.load(["/bitrix/components/bitrix/bizproc.workflow.info/templates/.default/style.css"],function(){var t=BX.create("div",{style:{width:"800px"}});t.innerHTML=o;var a="",i=BX.findChild(t,{className:"bp-popup-title"},true);if(i){a=i.textContent;BX.remove(i)}var p=new BX.PopupWindow("bp-wfi-popup-"+e+Math.round(Math.random()*1e5),null,{content:t,closeIcon:true,titleBar:a,contentColor:"white",contentNoPaddings:true,zIndex:-100,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:{backgroundColor:"black",opacity:30},events:{onPopupClose:function(e){e.destroy()}}});p.show()})}});return false};BX.Bizproc.showWorkflowLogPopup=function(e,o){if(!BX.type.isPlainObject(o)){o={}}BX.ajax({method:"GET",dataType:"html",url:"/bitrix/components/bitrix/bizproc.log/popup.php?site_id="+BX.message("SITE_ID")+"&WORKFLOW_ID="+e,onsuccess:function(t){var a=BX.create("div",{style:{width:"800px"}});a.innerHTML=t;var i=new BX.PopupWindow("bp-wfi-popup-"+e+Math.round(Math.random()*1e5),null,{content:a,closeIcon:true,titleBar:o.title||"",contentColor:"white",contentNoPaddings:true,zIndex:-100,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:{backgroundColor:"black",opacity:30},events:{onPopupClose:function(e){e.destroy()}}});i.show()}});return false};BX.Bizproc.postTaskForm=function(e,o){if(e.BPRUNNING){return}BX.PreventDefault(o);e.action="/bitrix/tools/bizproc_do_task_ajax.php";e.BPRUNNING=true;var t,a,i=document.activeElement;if((!i||!i.type)&&o.explicitOriginalTarget){i=o.explicitOriginalTarget}if(!!i&&i.type&&i.type.toLowerCase()=="submit"&&!!i.name&&!!i.value){t=i.name;a=i.value}if(!e.target){if(null==e.BXFormTarget){var p="formTarget_"+Math.random();e.BXFormTarget=document.body.appendChild(BX.create("IFRAME",{props:{name:p,id:p,src:"javascript:void(0)"},style:{display:"none"}}))}e.target=e.BXFormTarget.name}var n=null;if(t){n=BX.findChild(e,{property:{type:"submit",name:t}},true)}if(n){BX.addClass(n,"bp-button-wait")}e.BXFormCallback=function(o){e.BPRUNNING=false;if(n){BX.removeClass(n,"bp-button-wait")}o=BX.parseJSON(o);if(o&&o.ERROR)window.alert(o.ERROR);else{if(!!BX.Bizproc.taskPopupInstance)BX.Bizproc.taskPopupInstance.close();if(!!BX.Bizproc.taskPopupCallback)BX.Bizproc.taskPopupCallback()}};BX.bind(e.BXFormTarget,"load",BX.proxy(BX.ajax._submit_callback,e));BX.submit(e,t,a)}}if(typeof BX.Bizproc.WorkflowFaces==="undefined"){BX.Bizproc.WorkflowFaces={};BX.Bizproc.WorkflowFaces.showFaces=function(e,o,t,a){if(typeof o.__popup==="undefined"){o.__popup=new BX.PopupWindow("bp-wf-faces-"+Math.round(Math.random()*1e5),o,{lightShadow:true,offsetLeft:-51,offsetTop:3,zIndex:0,autoHide:true,closeByEsc:true,bindOptions:{position:"bottom"},angle:{position:"top",offset:78},content:BX.Bizproc.WorkflowFaces.createMenu(e,t,a)})}if(o.__popup.isShown())o.__popup.close();else o.__popup.show();return false};BX.Bizproc.WorkflowFaces.createMenu=function(e,o,t){var a,i,p=e.length,n;var s=[];for(a=0;a<p;++a){var r,l=e[a],c=[];for(i=0,n=l.USERS.length;i<n;++i){r="bp-popup-parallel-avatar-ready";if(l.USERS[i].STATUS=="0")r="";else if(l.USERS[i].STATUS=="2"||l.USERS[i].STATUS=="4")r="bp-popup-parallel-avatar-cancel";var u=["<a>",'<span class="bp-popup-parallel-avatar '+r+'"><span class="ui-icon ui-icon-common-user">'+(l.USERS[i].PHOTO_SRC?"<i style=\"background-image: url('"+l.USERS[i].PHOTO_SRC+'\')" alt=""></i>':"<i></i>")+"</span></span>",'<span class="bp-popup-parallel-name" title="'+l.USERS[i].FULL_NAME+'">'+l.USERS[i].FULL_NAME+"</span>","</a>"];c.push(u.join(""))}var B=c.join("");if(p==1&&!t)s.push(B);else{r="bp-popup-parallel-avatar-ready";if(l.USERS[0].STATUS=="0")r="";else if(l.USERS[0].STATUS=="2"||l.USERS[0].STATUS=="4")r="bp-popup-parallel-avatar-cancel";var d=['<a class="'+(c.length>1||o?"bp-popup-parallel-parent":"")+'">',!o?'<span class="bp-popup-parallel-avatar '+r+'"><span class="ui-icon ui-icon-common-user">'+(l.USERS[0].PHOTO_SRC?"<i style=\"background-image:url('"+l.USERS[0].PHOTO_SRC+'\')" alt=""></i>':"<i></i>")+"</span></span>":"",'<span class="bp-popup-parallel-name" title="'+l.NAME+'">'+(!o?l.USERS[0].FULL_NAME:l.NAME)+"</span>","</a>"];s.push('<div class="bp-popup-parallel-sub">'+d.join("")+(c.length>1||o?'<div class="bp-popup-parallel">'+B+"</div></div>":""))}}return'<div class="bp-popup-parallel">'+s.join("")+"</div>"}}
//# sourceMappingURL=tools.map.js