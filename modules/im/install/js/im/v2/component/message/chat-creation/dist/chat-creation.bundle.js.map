{"version":3,"file":"chat-creation.bundle.js","sources":["../src/chat-creation.js"],"sourcesContent":["import { Messenger } from 'im.public';\nimport { Button as ButtonComponent, ButtonSize, ButtonIcon } from 'im.v2.component.elements';\nimport { AddToChat } from 'im.v2.component.entity-selector';\nimport { BaseMessage } from 'im.v2.component.message.base';\n\nimport './css/chat-creation-message.css';\n\nimport { Analytics as CallAnalytics} from 'call.lib.analytics';\nimport type { CustomColorScheme } from 'im.v2.component.elements';\nimport { CallManager } from 'im.v2.lib.call';\nimport type { ImModelMessage } from 'im.v2.model';\nimport { hint } from 'ui.vue3.directives.hint';\n\nconst BUTTON_COLOR = '#00ace3';\n\n// @vue/component\nexport const ChatCreationMessage = {\n\tname: 'ChatCreationMessage',\n\tdirectives: { hint },\n\tcomponents: { ButtonComponent, AddToChat, BaseMessage },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): {showAddToChatPopup: boolean}\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonIcon: () => ButtonIcon,\n\t\tbuttonColorScheme(): CustomColorScheme\n\t\t{\n\t\t\treturn {\n\t\t\t\tbackgroundColor: 'transparent',\n\t\t\t\tborderColor: BUTTON_COLOR,\n\t\t\t\ticonColor: BUTTON_COLOR,\n\t\t\t\ttextColor: BUTTON_COLOR,\n\t\t\t\thoverColor: 'transparent',\n\t\t\t};\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.message.chatId;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\thasActiveCurrentCall(): boolean\n\t\t{\n\t\t\treturn CallManager\n\t\t\t\t.getInstance()\n\t\t\t\t.hasActiveCurrentCall(this.dialogId);\n\t\t},\n\t\thasActiveAnotherCall(): boolean\n\t\t{\n\t\t\treturn CallManager\n\t\t\t\t.getInstance()\n\t\t\t\t.hasActiveAnotherCall(this.dialogId);\n\t\t},\n\t\tisActive(): boolean\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.hasActiveCurrentCall\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.hasActiveAnotherCall)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn CallManager\n\t\t\t\t.getInstance()\n\t\t\t\t.chatCanBeCalled(this.dialogId);\n\t\t},\n\t\tuserLimit(): number\n\t\t{\n\t\t\treturn CallManager\n\t\t\t\t.getInstance()\n\t\t\t\t.getCallUserLimit();\n\t\t},\n\t\tisChatUserLimitExceeded(): boolean\n\t\t{\n\t\t\treturn CallManager\n\t\t\t\t.getInstance()\n\t\t\t\t.isChatUserLimitExceeded(this.dialogId);\n\t\t},\n\t\thintContent(): Object | null\n\t\t{\n\t\t\tif (this.isChatUserLimitExceeded)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\ttext: this.loc('IM_LIB_CALL_USER_LIMIT_EXCEEDED_TOOLTIP', { '#USER_LIMIT#': this.userLimit }),\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tangle: { position: 'top' },\n\t\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\t\toffsetLeft: 82,\n\t\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonCallButtonClick()\n\t\t{\n\t\t\tCallAnalytics.getInstance().onChatCreationMessageStartCallClick({ chatId: this.chatId });\n\t\t\tMessenger.startVideoCall(this.dialogId);\n\t\t},\n\t\tonInviteButtonClick()\n\t\t{\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BaseMessage\n\t\t\t:dialogId=\"dialogId\"\n\t\t\t:item=\"item\"\n\t\t\t:withContextMenu=\"false\"\n\t\t\t:withReactions=\"false\"\n\t\t\t:withBackground=\"false\"\n\t\t\tclass=\"bx-im-message-chat-creation__scope\"\n\t\t>\n\t\t\t<div class=\"bx-im-message-chat-creation__container\">\n\t\t\t\t<div class=\"bx-im-message-chat-creation__image\"></div>\n\t\t\t\t<div class=\"bx-im-message-chat-creation__content\">\n\t\t\t\t\t<div class=\"bx-im-message-chat-creation__title\">\n\t\t\t\t\t\t{{ loc('IM_MESSAGE_CHAT_CREATION_TITLE_V2') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-message-chat-creation__description\">\n\t\t\t\t\t\t{{ loc('IM_MESSAGE_CHAT_CREATION_DESCRIPTION') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-message-chat-creation__buttons_container\">\n\t\t\t\t\t\t<div class=\"bx-im-message-chat-creation__buttons_item\">\n\t\t\t\t\t\t\t<ButtonComponent\n\t\t\t\t\t\t\t\t:size=\"ButtonSize.L\" \n\t\t\t\t\t\t\t\t:icon=\"ButtonIcon.Call\" \n\t\t\t\t\t\t\t\t:customColorScheme=\"buttonColorScheme\"\n\t\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t\t:text=\"loc('IM_MESSAGE_CHAT_CREATION_BUTTON_VIDEOCALL')\"\n\t\t\t\t\t\t\t\t@click=\"onCallButtonClick\"\n\t\t\t\t\t\t\t\t:isDisabled=\"!isActive\"\n\t\t\t\t\t\t\t\tv-hint=\"hintContent\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-message-chat-creation__buttons_item\">\n\t\t\t\t\t\t\t<ButtonComponent\n\t\t\t\t\t\t\t\t:size=\"ButtonSize.L\"\n\t\t\t\t\t\t\t\t:icon=\"ButtonIcon.AddUser\"\n\t\t\t\t\t\t\t\t:customColorScheme=\"buttonColorScheme\"\n\t\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t\t:text=\"loc('IM_MESSAGE_CHAT_CREATION_BUTTON_INVITE_USERS')\"\n\t\t\t\t\t\t\t\t@click=\"onInviteButtonClick\"\n\t\t\t\t\t\t\t\tref=\"add-members-button\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<AddToChat\n\t\t\t\t\tv-if=\"showAddToChatPopup\"\n\t\t\t\t\t:bindElement=\"$refs['add-members-button'] || {}\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:popupConfig=\"{offsetTop: 0, offsetLeft: 0}\"\n\t\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</BaseMessage>\n\t`,\n};\n"],"names":["BUTTON_COLOR","ChatCreationMessage","name","directives","hint","components","ButtonComponent","AddToChat","BaseMessage","props","item","type","Object","required","dialogId","String","data","showAddToChatPopup","computed","ButtonSize","ButtonIcon","buttonColorScheme","backgroundColor","borderColor","iconColor","textColor","hoverColor","message","chatId","dialog","$store","getters","hasActiveCurrentCall","CallManager","getInstance","hasActiveAnotherCall","isActive","chatCanBeCalled","userLimit","getCallUserLimit","isChatUserLimitExceeded","hintContent","text","loc","popupOptions","bindOptions","position","angle","targetContainer","document","body","offsetLeft","offsetTop","methods","phraseCode","replacements","$Bitrix","Loc","getMessage","onCallButtonClick","CallAnalytics","onChatCreationMessageStartCallClick","Messenger","startVideoCall","onInviteButtonClick","template"],"mappings":"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"}