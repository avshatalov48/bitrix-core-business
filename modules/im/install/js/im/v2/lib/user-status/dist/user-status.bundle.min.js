this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,i){"use strict";const l=1e3*60*60*24;var r=babelHelpers.classPrivateFieldLooseKey("instance");var o=babelHelpers.classPrivateFieldLooseKey("absentList");var b=babelHelpers.classPrivateFieldLooseKey("absentCheckInterval");var d=babelHelpers.classPrivateFieldLooseKey("birthdayLoadInterval");var c=babelHelpers.classPrivateFieldLooseKey("setUserBirthdayFlag");var n=babelHelpers.classPrivateFieldLooseKey("setUserAbsentFlag");var v=babelHelpers.classPrivateFieldLooseKey("startAbsentCheckInterval");var h=babelHelpers.classPrivateFieldLooseKey("stopAbsentCheckInterval");var p=babelHelpers.classPrivateFieldLooseKey("checkAbsentList");var P=babelHelpers.classPrivateFieldLooseKey("startBirthdayLoadInterval");class u{constructor(){Object.defineProperty(this,P,{value:y});Object.defineProperty(this,p,{value:f});Object.defineProperty(this,h,{value:H});Object.defineProperty(this,v,{value:F});Object.defineProperty(this,n,{value:B});Object.defineProperty(this,c,{value:L});Object.defineProperty(this,o,{writable:true,value:new Set});Object.defineProperty(this,b,{writable:true,value:null});Object.defineProperty(this,d,{writable:true,value:null})}static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,r)[r]){babelHelpers.classPrivateFieldLooseBase(this,r)[r]=new this}return babelHelpers.classPrivateFieldLooseBase(this,r)[r]}onUserUpdate(e){babelHelpers.classPrivateFieldLooseBase(this,P)[P]();if(e.birthday&&a.Utils.user.isBirthdayToday(e.birthday)){babelHelpers.classPrivateFieldLooseBase(this,c)[c](e.id,true);setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,c)[c](e.id,false)}),a.Utils.date.getTimeToNextMidnight())}if(s.Type.isDate(e.absent)){babelHelpers.classPrivateFieldLooseBase(this,n)[n](e.id,true);babelHelpers.classPrivateFieldLooseBase(this,v)[v](e.id)}else if(e.absent===false&&babelHelpers.classPrivateFieldLooseBase(this,o)[o].has(e.id)){babelHelpers.classPrivateFieldLooseBase(this,n)[n](e.id,false);babelHelpers.classPrivateFieldLooseBase(this,h)[h](e.id)}}clear(){babelHelpers.classPrivateFieldLooseBase(this,o)[o]=new Set;clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,b)[b]);babelHelpers.classPrivateFieldLooseBase(this,b)[b]=null;clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,d)[d]);babelHelpers.classPrivateFieldLooseBase(this,d)[d]=null}}function L(e,s){t.Core.getStore().dispatch("users/update",{id:e,fields:{isBirthday:s}})}function B(e,s){t.Core.getStore().dispatch("users/update",{id:e,fields:{isAbsent:s}})}function F(e){babelHelpers.classPrivateFieldLooseBase(this,o)[o].add(e);if(babelHelpers.classPrivateFieldLooseBase(this,b)[b]){return}babelHelpers.classPrivateFieldLooseBase(this,b)[b]=setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p]();setInterval((()=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p]()}),l)}),a.Utils.date.getTimeToNextMidnight())}function H(e){babelHelpers.classPrivateFieldLooseBase(this,o)[o].delete(e)}function f(){for(const e of babelHelpers.classPrivateFieldLooseBase(this,o)[o]){const a=t.Core.getStore().getters["users/get"](e);if(!a||!s.Type.isDate(a.absent)){babelHelpers.classPrivateFieldLooseBase(this,h)[h](e);return}const i=a.absent.getTime();if(i<=Date.now()){babelHelpers.classPrivateFieldLooseBase(this,n)[n](a.id,false);babelHelpers.classPrivateFieldLooseBase(this,h)[h](a.id)}}}function y(){if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]){return}babelHelpers.classPrivateFieldLooseBase(this,d)[d]=setTimeout((()=>{i.RecentService.getInstance().loadFirstPage();setInterval((()=>{i.RecentService.getInstance().loadFirstPage()}),l)}),a.Utils.date.getTimeToNextMidnight())}Object.defineProperty(u,r,{writable:true,value:void 0});e.UserStatusManager=u})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Service);
//# sourceMappingURL=user-status.bundle.map.js