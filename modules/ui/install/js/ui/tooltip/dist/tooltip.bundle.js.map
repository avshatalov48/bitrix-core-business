{"version":3,"file":"tooltip.bundle.js","sources":["../src/tooltip.js","../src/balloon.js","../src/index.js"],"sourcesContent":["export class Tooltip\n{\n\tstatic disabled = false;\n\tstatic tooltipsList =  {};\n\n\tstatic disable()\n\t{\n\t\tthis.disabled = true;\n\t}\n\n\tstatic enable()\n\t{\n\t\tthis.disabled = false;\n\t}\n\n\tstatic getDisabledStatus()\n\t{\n\t\treturn this.disabled;\n\t}\n\n\tstatic getLoader()\n\t{\n\t\treturn '/bitrix/tools/tooltip.php';\n\t}\n\n\tstatic getIdPrefix()\n\t{\n\t\treturn 'bx-ui-tooltip-';\n\t}\n}\n","import {Type, ajax, Loc} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {Tooltip} from './tooltip';\n\n\nexport class TooltipBalloon\n{\n\tconstructor(params)\n\t{\n\t\tthis.node = null;\n\t\tthis.userId = null;\n\t\tthis.loader = null;\n\t\tthis.version = null;\n\t\tthis.tracking = false;\n\t\tthis.active = false;\n\t\tthis.width = 364; // 393\n\t\tthis.height = 215; // 302\n\t\tthis.realAnchor = null;\n\t\tthis.coordsLeft = 0;\n\t\tthis.coordsTop = 0;\n\t\tthis.anchorRight = 0;\n\t\tthis.anchorTop = 0;\n\t\tthis.hMirror = false;\n\t\tthis.vMirror = false;\n\t\tthis.rootClassName = '';\n\t\tthis.INFO = null;\n\t\tthis.DIV = null;\n\t\tthis.ROOT_DIV = null;\n\t\tthis.params = {};\n\t\tthis.trackMouseHandle = this.trackMouse.bind(this);\n\n\t\tthis.init(params);\n\t\tthis.create();\n\t\treturn this;\n\t}\n\n\tinit(params)\n\t{\n\t\tthis.node = params.node;\n\t\tthis.userId = params.userId;\n\t\tthis.loader = (Type.isStringFilled(params.loader) ? params.loader : '');\n\n\t\tthis.version = (\n\t\t\t!Type.isUndefined(params.version)\n\t\t\t&& parseInt(params.version) > 0\n\t\t\t\t? parseInt(params.version)\n\t\t\t\t: (Type.isStringFilled(this.loader) ? 2 : 3)\n\t\t);\n\n\t\tthis.rootClassName = this.node.getAttribute('bx-tooltip-classname');\n\n\t\tconst paramsString = this.node.getAttribute('bx-tooltip-params');\n\n\t\tlet anchorParams = {};\n\t\tif (Type.isStringFilled(paramsString))\n\t\t{\n\t\t\tanchorParams = JSON.parse(paramsString);\n\t\t\tif (!Type.isPlainObject(anchorParams))\n\t\t\t{\n\t\t\t\tanchorParams = {};\n\t\t\t}\n\t\t}\n\n\t\tthis.params = anchorParams;\n\t}\n\n\tcreate()\n\t{\n\t\tif (!Tooltip.getDisabledStatus())\n\t\t{\n\t\t\tthis.startTrackMouse();\n\t\t}\n\n\t\tthis.node.addEventListener('mouseout', this.stopTrackMouse.bind(this));\n\t\tEventEmitter.subscribe('SidePanel.Slider:onOpen', this.onSliderOpen.bind(this));\n\t}\n\n\tonSliderOpen()\n\t{\n\t\tif (this.tracking)\n\t\t{\n\t\t\tthis.stopTrackMouse();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideTooltip();\n\t\t}\n\t}\n\n\tstartTrackMouse()\n\t{\n\t\tif (this.tracking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst elCoords = BX.pos(this.node);\n\t\tthis.realAnchor = this.node;\n\n\t\tthis.coordsLeft = (\n\t\t\telCoords.width < 40\n\t\t\t\t? (elCoords.left - 35)\n\t\t\t\t: (elCoords.left + 0)\n\t\t);\n\t\tthis.coordsTop = elCoords.top - 245; // 325\n\t\tthis.anchorRight = elCoords.right;\n\t\tthis.anchorTop = elCoords.top;\n\n\t\tthis.tracking = true;\n\n\t\tdocument.addEventListener('mousemove', this.trackMouseHandle);\n\n\t\tsetTimeout(() => {\n\t\t\tthis.tickTimer();\n\t\t}, 500);\n\n\t\tthis.node.addEventListener('mouseout', this.stopTrackMouse.bind(this));\n\t}\n\n\tstopTrackMouse()\n\t{\n\t\tif (!this.tracking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tdocument.removeEventListener('mousemove', this.trackMouseHandle);\n\n\t\tthis.active = false;\n\t\tsetTimeout(() => {\n\t\t\tthis.hideTooltip()\n\t\t}, 500);\n\t\tthis.tracking = false;\n\t}\n\n\ttrackMouse(e)\n\t{\n\t\tif (!this.tracking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst current = (\n\t\t\te && e.pageX\n\t\t\t\t? {\n\t\t\t\t\tx: e.pageX,\n\t\t\t\t\ty: e.pageY,\n\t\t\t\t}\n\t\t\t\t: {\n\t\t\t\t\tx: e.clientX + document.body.scrollLeft,\n\t\t\t\t\ty: e.clientY + document.body.scrollTop,\n\t\t\t\t}\n\t\t);\n\n\t\tif (current.x < 0)\n\t\t{\n\t\t\tcurrent.x = 0;\n\t\t}\n\n\t\tif (current.y < 0)\n\t\t{\n\t\t\tcurrent.y = 0;\n\t\t}\n\n\t\tcurrent.time = this.tracking;\n\n\t\tif (!this.active)\n\t\t{\n\t\t\tthis.active = current;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.active.x >= (current.x - 1) && this.active.x <= (current.x + 1)\n\t\t\t\t&& this.active.y >= (current.y - 1) && this.active.y <= (current.y + 1)\n\t\t\t)\n\t\t\t{\n\t\t\t\tif ((this.active.time + 20/*2sec*/) <= current.time)\n\t\t\t\t{\n\t\t\t\t\tthis.showTooltip();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.active = current;\n\t\t\t}\n\t\t}\n\t}\n\n\ttickTimer()\n\t{\n\t\tif (!this.tracking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tracking++;\n\t\tif (this.active)\n\t\t{\n\t\t\tif ((this.active.time + 5/*0.5sec*/)  <= this.tracking)\n\t\t\t{\n\t\t\t\tthis.showTooltip();\n\t\t\t}\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tthis.tickTimer();\n\t\t}, 100);\n\t}\n\n\thideTooltip()\n\t{\n\t\tif (this.tracking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showOpacityEffect(1);\n\t}\n\n\tshowOpacityEffect(bFade)\n\t{\n\t\tconst steps = 3;\n\t\tconst period = 1;\n\t\tconst delta = 1 / steps;\n\t\tlet i = 0;\n\n\t\tconst intId = setInterval(() => {\n\t\t\ti++;\n\t\t\tif (i > steps)\n\t\t\t{\n\t\t\t\tclearInterval(intId);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst op = (\n\t\t\t\tbFade\n\t\t\t\t\t? 1 - i * delta\n\t\t\t\t\t: i * delta\n\t\t\t);\n\n\t\t\tif (this.DIV != null)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.DIV.style.opacity = op;\n\t\t\t\t}\n\t\t\t\tcatch(e)\n\t\t\t\t{\n\t\t\t\t}\n\t\t\t\tfinally\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\t!bFade\n\t\t\t\t\t\t&& i == 1\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.DIV.classList.add('ui-tooltip-info-shadow-show');\n\t\t\t\t\t\tthis.DIV.style.display = 'block';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tbFade\n\t\t\t\t\t\t&& i == steps\n\t\t\t\t\t\t&& this.DIV\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.DIV.classList.remove('ui-tooltip-info-shadow-show');\n\t\t\t\t\t\tthis.DIV.classList.add('ui-tooltip-info-shadow-hide');\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.DIV.style.display = 'none';\n\t\t\t\t\t\t}, 500);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (bFade)\n\t\t\t\t\t{\n\t\t\t\t\t\tEventEmitter.emit('onTooltipHide', new BaseEvent({\n\t\t\t\t\t\t\tcompatData: [ this ],\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, period);\n\t}\n\n\tshowTooltip()\n\t{\n\t\tconst old = document.getElementById(`${Tooltip.getIdPrefix()}${this.userId}`);\n\n\t\tif (\n\t\t\tTooltip.getDisabledStatus()\n\t\t\t|| (\n\t\t\t\told\n\t\t\t\t&& old.classList.contains('ui-tooltip-info-shadow-show')\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tnull == this.DIV\n\t\t\t&& null == this.ROOT_DIV\n\t\t)\n\t\t{\n\t\t\tthis.ROOT_DIV = document.body.appendChild(document.createElement('DIV'));\n\t\t\tthis.ROOT_DIV.style.position = 'absolute';\n\n\t\t\tBX.ZIndexManager.register(this.ROOT_DIV);\n\n\t\t\tthis.DIV = this.ROOT_DIV.appendChild(document.createElement('DIV'));\n\t\t\tthis.DIV.className = 'bx-ui-tooltip-info-shadow';\n\n\t\t\tthis.DIV.style.width = `${this.width}px`;\n\t\t}\n\n\t\tlet left = this.coordsLeft;\n\t\tconst top = this.coordsTop + 30;\n\t\tconst arScroll = BX.GetWindowScrollPos();\n\t\tconst body = document.body;\n\n\t\tthis.hMirror = false;\n\t\tthis.vMirror = ((top - arScroll.scrollTop) < 0);\n\n\t\tif ((body.clientWidth + arScroll.scrollLeft) < (left + this.width))\n\t\t{\n\t\t\tleft = this.anchorRight - this.width;\n\t\t\tthis.hMirror = true;\n\t\t}\n\n\t\tthis.ROOT_DIV.style.left = `${parseInt(left)}px`;\n\t\tthis.ROOT_DIV.style.top = `${parseInt(top)}px`;\n\n\t\tBX.ZIndexManager.bringToFront(this.ROOT_DIV);\n\n\t\tthis.ROOT_DIV.addEventListener('click', (e) => { e.stopPropagation(); });\n\n\t\tif (Type.isStringFilled(this.rootClassName))\n\t\t{\n\t\t\tthis.ROOT_DIV.className = this.rootClassName;\n\t\t}\n\n\t\tconst loader = (\n\t\t\tType.isStringFilled(this.loader)\n\t\t\t\t? this.loader\n\t\t\t\t: Tooltip.getLoader()\n\t\t);\n\n\t\t// create stub\n\t\tlet stubCreated = false;\n\n\t\tif ('' == this.DIV.innerHTML)\n\t\t{\n\t\t\tstubCreated = true;\n\n\t\t\tif (this.version >= 3)\n\t\t\t{\n\t\t\t\tajax.runComponentAction('bitrix:ui.tooltip', 'getData', {\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tparams: (!Type.isUndefined(this.params) ? this.params : {}),\n\t\t\t\t\t}\n\t\t\t\t}).then((response) => {\n\n\t\t\t\t\tconst detailUrl = (Type.isStringFilled(response.data.user.detailUrl) ? response.data.user.detailUrl : '');\n\t\t\t\t\tlet cardUserName = '';\n\n\t\t\t\t\tif (Type.isStringFilled(response.data.user.nameFormatted))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst {nameFormatted = ''} = response.data.user;\n\n\t\t\t\t\t\tif (Type.isStringFilled(detailUrl))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcardUserName = `\n\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bx-ui-tooltip-user-name\"\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"${nameFormatted}\"\n\t\t\t\t\t\t\t\t\t\t\t\thref=\"${detailUrl}\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t${response.data.user.nameFormatted}\n\t\t\t\t\t\t\t\t\t\t\t</a>`\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcardUserName = `\n\t\t\t\t\t\t\t\t\t\t\t<span \n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bx-ui-tooltip-user-name\"\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"${nameFormatted}\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tresponse.data.user.nameFormatted\n\t\t\t\t\t\t\t\t\t\t\t</span>`\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet cardFields = '<div class=\"bx-ui-tooltip-info-data-info\">';\n\t\t\t\t\tObject.keys(response.data.user.cardFields).forEach((fieldCode) => {\n\t\t\t\t\t\tcardFields += `<span class=\"bx-ui-tooltip-field-row bx-ui-tooltip-field-row-${fieldCode.toLowerCase()}\"><span class=\"bx-ui-tooltip-field-name\">${response.data.user.cardFields[fieldCode].name}</span>: <span class=\"bx-ui-tooltip-field-value\">${response.data.user.cardFields[fieldCode].value}</span></span>`;\n\t\t\t\t\t});\n\t\t\t\t\tcardFields += '</div>';\n\n\t\t\t\t\tconst cardFieldsClassName = (\n\t\t\t\t\t\tparseInt(Loc.getMessage('USER_ID')) > 0\n\t\t\t\t\t\t&& response.data.currentUserPerms.operations.videocall\n\t\t\t\t\t\t\t? 'bx-ui-tooltip-info-data-cont-video'\n\t\t\t\t\t\t\t: 'bx-ui-tooltip-info-data-cont'\n\t\t\t\t\t);\n\t\t\t\t\tcardFields = `<div id=\"bx_user_info_data_cont_${response.data.user.id}\" class=\"${cardFieldsClassName}\">${cardFields}</div>`;\n\n\t\t\t\t\tlet photo = '';\n\t\t\t\t\tlet photoClassName = 'bx-ui-tooltip-info-data-photo no-photo';\n\n\t\t\t\t\tif (Type.isStringFilled(response.data.user.photo))\n\t\t\t\t\t{\n\t\t\t\t\t\tphoto = response.data.user.photo;\n\t\t\t\t\t\tphotoClassName = 'bx-ui-tooltip-info-data-photo';\n\t\t\t\t\t}\n\n\t\t\t\t\tphoto = (\n\t\t\t\t\t\tType.isStringFilled(detailUrl)\n\t\t\t\t\t\t\t? `<a href=\"${detailUrl}\" class=\"${photoClassName}\">${photo}</a>`\n\t\t\t\t\t\t\t: `<span class=\"${photoClassName}\">${photo}</span>`\n\t\t\t\t\t);\n\n\t\t\t\t\tlet toolbar = '';\n\t\t\t\t\tlet toolbar2 = '';\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tparseInt(Loc.getMessage('USER_ID')) > 0\n\t\t\t\t\t\t&& response.data.user.active\n\t\t\t\t\t\t&& response.data.user.id != Loc.getMessage('USER_ID')\n\t\t\t\t\t\t&& response.data.currentUserPerms.operations.message\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\ttoolbar2 += `<li class=\"bx-icon bx-icon-message\"><span onclick=\"return BX.tooltip.openIM(${response.data.user.id});\">${Loc.getMessage('MAIN_UL_TOOLBAR_MESSAGES_CHAT')}</span></li>`;\n\t\t\t\t\t\ttoolbar2 += `<li id=\"im-video-call-button${response.data.user.id}\" class=\"bx-icon bx-icon-video\"><span onclick=\"return BX.tooltip.openCallTo(${response.data.user.id});\">${Loc.getMessage('MAIN_UL_TOOLBAR_VIDEO_CALL')}</span></li>`;\n\t\t\t\t\t\ttoolbar2 += `<script>Event.ready(() => { BX.tooltip.checkCallTo(\"im-video-call-button${response.data.user.id}\"); };</script>`;\n\t\t\t\t\t}\n\n\t\t\t\t\ttoolbar2 = (Type.isStringFilled(toolbar2) ? `<div class=\"bx-ui-tooltip-info-data-separator\"></div><ul>${toolbar2}</ul>` : '');\n\n\t\t\t\t\tif (response.data.user.hasBirthday)\n\t\t\t\t\t{\n\t\t\t\t\t\ttoolbar += `<li class=\"bx-icon bx-icon-birth\">${Loc.getMessage('MAIN_UL_TOOLBAR_BIRTHDAY')}</li>`;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (response.data.user.hasHonour)\n\t\t\t\t\t{\n\t\t\t\t\t\ttoolbar += `<li class=\"bx-icon bx-icon-featured\">${Loc.getMessage('MAIN_UL_TOOLBAR_HONORED')}</li>`;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (response.data.user.hasAbsence)\n\t\t\t\t\t{\n\t\t\t\t\t\ttoolbar += `<li class=\"bx-icon bx-icon-away\">${Loc.getMessage('MAIN_UL_TOOLBAR_ABSENT')}</li>`;\n\t\t\t\t\t}\n\n\t\t\t\t\ttoolbar = (Type.isStringFilled(toolbar) ? `<ul>${toolbar}</ul>` : '');\n\n\t\t\t\t\tthis.insertData({\n\t\t\t\t\t\tRESULT: {\n\t\t\t\t\t\t\tName: cardUserName,\n\t\t\t\t\t\t\tPosition: (Type.isStringFilled(response.data.user.position) ? response.data.user.position : ''),\n\t\t\t\t\t\t\tCard: cardFields,\n\t\t\t\t\t\t\tPhoto: photo,\n\t\t\t\t\t\t\tToolbar: toolbar,\n\t\t\t\t\t\t\tToolbar2: toolbar2,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tthis.adjustPosition();\n\n\t\t\t\t}, () => {});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst url = loader +\n\t\t\t\t\t(loader.indexOf('?') >= 0 ? '&' : '?') +\n\t\t\t\t\t`MODE=UI&MUL_MODE=INFO&USER_ID=${this.userId}` +\n\t\t\t\t\t`&site=${(Loc.getMessage('SITE_ID') || '')}` +\n\t\t\t\t\t`&version=${this.version}` +\n\t\t\t\t\t(\n\t\t\t\t\t\t!Type.isUndefined(this.params)\n\t\t\t\t\t\t&& !Type.isUndefined(this.params.entityType)\n\t\t\t\t\t\t&& Type.isStringFilled(this.params.entityType)\n\t\t\t\t\t\t\t? `&entityType=${this.params.entityType}`\n\t\t\t\t\t\t\t: ''\n\t\t\t\t\t) +\n\t\t\t\t\t(\n\t\t\t\t\t\t!Type.isUndefined(this.params)\n\t\t\t\t\t\t&& !Type.isUndefined(this.params.entityId)\n\t\t\t\t\t\t&& parseInt(this.params.entityId) > 0\n\t\t\t\t\t\t\t? `&entityId=${parseInt(this.params.entityId)}`\n\t\t\t\t\t\t\t: ''\n\t\t\t\t\t);\n\n\t\t\t\tajax.get(url, (data) => {\n\t\t\t\t\tthis.insertData(data);\n\t\t\t\t\tthis.adjustPosition();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.DIV.id = `${Tooltip.getIdPrefix()}${this.userId}`;\n\n\t\t\tthis.DIV.innerHTML = '<div class=\"bx-ui-tooltip-info-wrap\">'\n\t\t\t\t+ '<div class=\"bx-ui-tooltip-info-leftcolumn\">'\n\t\t\t\t+ `<div class=\"bx-ui-tooltip-photo\" id=\"${Tooltip.getIdPrefix()}photo-${this.userId}\"><div class=\"bx-ui-tooltip-info-data-loading\">${Loc.getMessage('JS_CORE_LOADING')}</div></div>`\n\t\t\t\t+ '</div>'\n\t\t\t\t+ '<div class=\"bx-ui-tooltip-info-data\">'\n\t\t\t\t+ `<div id=\"${Tooltip.getIdPrefix()}data-card-${this.userId}\"></div>`\n\t\t\t\t+ '<div class=\"bx-ui-tooltip-info-data-tools\">'\n\t\t\t\t+ `<div class=\"bx-ui-tooltip-tb-control bx-ui-tooltip-tb-control-left\" id=\"${Tooltip.getIdPrefix()}toolbar-${this.userId}\"></div>`\n\t\t\t\t+ `<div class=\"bx-ui-tooltip-tb-control bx-ui-tooltip-tb-control-right\" id=\"${Tooltip.getIdPrefix()}toolbar2-${this.userId}\"></div>`\n\t\t\t\t+ '<div class=\"bx-ui-tooltip-info-data-clear\"></div>'\n\t\t\t\t+ '</div>'\n\t\t\t\t+ '</div>'\n\t\t\t\t+ '</div><div class=\"bx-ui-tooltip-info-bottomarea\"></div>';\n\t\t}\n\n\t\tthis.DIV.className = 'bx-ui-tooltip-info-shadow';\n\t\tthis.classNameAnim = 'bx-ui-tooltip-info-shadow-anim';\n\t\tthis.classNameFixed = 'bx-ui-tooltip-info-shadow';\n\n\t\tif (this.hMirror && this.vMirror)\n\t\t{\n\t\t\tthis.DIV.className = 'bx-ui-tooltip-info-shadow-hv';\n\t\t\tthis.classNameAnim = 'bx-ui-tooltip-info-shadow-hv-anim';\n\t\t\tthis.classNameFixed = 'bx-ui-tooltip-info-shadow-hv';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.hMirror)\n\t\t\t{\n\t\t\t\tthis.DIV.className = 'bx-ui-tooltip-info-shadow-h';\n\t\t\t\tthis.classNameAnim = 'bx-ui-tooltip-info-shadow-h-anim';\n\t\t\t\tthis.classNameFixed = 'bx-ui-tooltip-info-shadow-h';\n\t\t\t}\n\n\t\t\tif (this.vMirror)\n\t\t\t{\n\t\t\t\tthis.DIV.className = 'bx-ui-tooltip-info-shadow-v';\n\t\t\t\tthis.classNameAnim = 'bx-ui-tooltip-info-shadow-v-anim';\n\t\t\t\tthis.classNameFixed = 'bx-ui-tooltip-info-shadow-v';\n\t\t\t}\n\t\t}\n\n\t\tthis.DIV.style.display = 'block';\n\n\t\tif (!stubCreated)\n\t\t{\n\t\t\tthis.adjustPosition();\n\t\t}\n\n\t\tthis.showOpacityEffect(0);\n\n\t\tdocument.getElementById(`${Tooltip.getIdPrefix()}${this.userId}`).onmouseover = () => {\n\t\t\tthis.startTrackMouse(this);\n\t\t};\n\n\t\tdocument.getElementById(`${Tooltip.getIdPrefix()}${this.userId}`).onmouseout = () => {\n\t\t\tthis.stopTrackMouse(this);\n\t\t};\n\n\t\tEventEmitter.emit('onTooltipShow', new BaseEvent({\n\t\t\tcompatData: [ this ],\n\t\t}));\n\t}\n\n\tadjustPosition()\n\t{\n\t\tconst tooltipCoords = BX.pos(this.DIV);\n\n\t\tif (this.vMirror)\n\t\t{\n\t\t\tthis.ROOT_DIV.style.top = `${parseInt(this.anchorTop + 13)}px`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.ROOT_DIV.style.top = `${parseInt(this.anchorTop - tooltipCoords.height - 13 + 12)}px`; // 12 - bottom block\n\t\t}\n\t}\n\n\tinsertData(data)\n\t{\n\t\tif (\n\t\t\tnull != data\n\t\t\t&& (\n\t\t\t\tthis.version >= 3\n\t\t\t\t|| data.length > 0\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tif (this.version >= 3)\n\t\t\t{\n\t\t\t\tthis.INFO = data;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\teval(`this.INFO = ${data}`);\n\t\t\t}\n\n\t\t\tconst cardEl = document.getElementById(`${Tooltip.getIdPrefix()}data-card-${this.userId}`);\n\t\t\tcardEl.innerHTML = '';\n\t\t\tif (Type.isStringFilled(this.INFO.RESULT.Name))\n\t\t\t{\n\t\t\t\tcardEl.innerHTML += `<div class=\"bx-ui-tooltip-user-name-block\">${this.INFO.RESULT.Name}</div>`;\n\t\t\t}\n\t\t\tif (Type.isStringFilled(this.INFO.RESULT.Position))\n\t\t\t{\n\t\t\t\tcardEl.innerHTML += `<div class=\"bx-ui-tooltip-user-position\">${this.INFO.RESULT.Position}</div>`;\n\t\t\t}\n\t\t\tcardEl.innerHTML += this.INFO.RESULT.Card;\n\n\t\t\tconst photoEl = document.getElementById(`${Tooltip.getIdPrefix()}photo-${this.userId}`);\n\t\t\tphotoEl.innerHTML = this.INFO.RESULT.Photo;\n\n\t\t\tconst toolbarEl = document.getElementById(`${Tooltip.getIdPrefix()}toolbar-${this.userId}`);\n\t\t\ttoolbarEl.innerHTML = this.INFO.RESULT.Toolbar;\n\n\t\t\tconst toolbar2El = document.getElementById(`${Tooltip.getIdPrefix()}toolbar2-${this.userId}`);\n\t\t\ttoolbar2El.innerHTML = this.INFO.RESULT.Toolbar2;\n\n\t\t\tif (Type.isArray(this.INFO.RESULT.Scripts))\n\t\t\t{\n\t\t\t\tthis.INFO.RESULT.Scripts.forEach((script) => {\n\t\t\t\t\teval(script);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tEventEmitter.emit('onTooltipInsertData', new BaseEvent({\n\t\t\t\tcompatData: [ this ],\n\t\t\t}));\n\t\t}\n\t}\n}","import {Browser, Event, Type} from 'main.core';\n\nimport {Tooltip} from './tooltip.js';\nimport {TooltipBalloon} from './balloon.js';\n\nimport './css/style.css';\n\nEvent.ready(() => {\n\tif (\n\t\tBrowser.isAndroid()\n\t\t|| Browser.isIOS()\n\t)\n\t{\n\t\treturn;\n\t}\n\n\tdocument.addEventListener('mouseover', (e) => {\n\n\t\tconst node = e.target;\n\n\t\tconst userId = node.getAttribute('bx-tooltip-user-id');\n\t\tconst loader = node.getAttribute('bx-tooltip-loader');\n\n\t\tlet tooltipId = userId; // don't use integer value!\n\n\t\tif (Type.isStringFilled(loader))\n\t\t{\n\t\t\tlet loaderHash = 0;\n\n\t\t\t[...loader].forEach((c, i) => {\n\t\t\t\tloaderHash = (31 * loaderHash + loader.charCodeAt(i)) << 0;\n\t\t\t});\n\n\t\t\ttooltipId = loaderHash + userId;\n\t\t}\n\n\t\tif (Type.isStringFilled(userId))\n\t\t{\n\t\t\tif (null == Tooltip.tooltipsList[tooltipId])\n\t\t\t{\n\t\t\t\tTooltip.tooltipsList[tooltipId] = new TooltipBalloon({\n\t\t\t\t\tuserId: userId,\n\t\t\t\t\tnode: node,\n\t\t\t\t\tloader: loader\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tTooltip.tooltipsList[tooltipId].node = node;\n\t\t\t\tTooltip.tooltipsList[tooltipId].create();\n\t\t\t}\n\n\t\t\te.preventDefault();\n\t\t}\n\t});\n\n});\n\nexport {\n\tTooltip,\n\tTooltipBalloon,\n}\n"],"names":["Tooltip","disable","disabled","enable","getDisabledStatus","getLoader","getIdPrefix","tooltipsList","TooltipBalloon","constructor","params","node","userId","loader","version","tracking","active","width","height","realAnchor","coordsLeft","coordsTop","anchorRight","anchorTop","hMirror","vMirror","rootClassName","INFO","DIV","ROOT_DIV","trackMouseHandle","trackMouse","bind","init","create","Type","isStringFilled","isUndefined","parseInt","getAttribute","paramsString","anchorParams","JSON","parse","isPlainObject","startTrackMouse","addEventListener","stopTrackMouse","EventEmitter","subscribe","onSliderOpen","hideTooltip","elCoords","BX","pos","left","top","right","document","setTimeout","tickTimer","removeEventListener","e","current","pageX","x","y","pageY","clientX","body","scrollLeft","clientY","scrollTop","time","showTooltip","showOpacityEffect","bFade","steps","period","delta","i","intId","setInterval","clearInterval","op","style","opacity","classList","add","display","remove","emit","BaseEvent","compatData","old","getElementById","contains","appendChild","createElement","position","ZIndexManager","register","className","arScroll","GetWindowScrollPos","clientWidth","bringToFront","stopPropagation","stubCreated","innerHTML","ajax","runComponentAction","mode","data","then","response","detailUrl","user","cardUserName","nameFormatted","cardFields","Object","keys","forEach","fieldCode","toLowerCase","name","value","cardFieldsClassName","Loc","getMessage","currentUserPerms","operations","videocall","id","photo","photoClassName","toolbar","toolbar2","message","hasBirthday","hasHonour","hasAbsence","insertData","RESULT","Name","Position","Card","Photo","Toolbar","Toolbar2","adjustPosition","url","indexOf","entityType","entityId","get","classNameAnim","classNameFixed","onmouseover","onmouseout","tooltipCoords","length","eval","cardEl","photoEl","toolbarEl","toolbar2El","isArray","Scripts","script","Event","ready","Browser","isAndroid","isIOS","target","tooltipId","loaderHash","c","charCodeAt","preventDefault"],"mappings":"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"}