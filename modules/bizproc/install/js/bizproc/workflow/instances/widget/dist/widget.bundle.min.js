this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};this.BX.Bizproc.Workflow=this.BX.Bizproc.Workflow||{};(function(e,s,a,i,t,l,r){"use strict";let o=e=>e,c,n,p,d,b,v;const P=[["s","sdiff"],["i","idiff"],["H","Hdiff"],["d","ddiff"],["m","mdiff"],["Y","Ydiff"]];const u={type:t.imageTypeEnum.ICON,data:{icon:"business-process-1",color:"var(--ui-color-base-10)"}};var h=babelHelpers.classPrivateFieldLooseKey("params");var L=babelHelpers.classPrivateFieldLooseKey("stack");var f=babelHelpers.classPrivateFieldLooseKey("popupInstance");var B=babelHelpers.classPrivateFieldLooseKey("popupListNode");var F=babelHelpers.classPrivateFieldLooseKey("initStack");var g=babelHelpers.classPrivateFieldLooseKey("getStackText");var m=babelHelpers.classPrivateFieldLooseKey("getStackUserImages");var T=babelHelpers.classPrivateFieldLooseKey("getEmptyStackImages");var y=babelHelpers.classPrivateFieldLooseKey("handleClick");var H=babelHelpers.classPrivateFieldLooseKey("getPopupContent");var _=babelHelpers.classPrivateFieldLooseKey("renderListSkeleton");var w=babelHelpers.classPrivateFieldLooseKey("loadList");var O=babelHelpers.classPrivateFieldLooseKey("renderListItemFaces");var I=babelHelpers.classPrivateFieldLooseKey("formatDuration");class S{constructor(e){Object.defineProperty(this,I,{value:j});Object.defineProperty(this,O,{value:X});Object.defineProperty(this,w,{value:U});Object.defineProperty(this,_,{value:C});Object.defineProperty(this,H,{value:K});Object.defineProperty(this,y,{value:R});Object.defineProperty(this,T,{value:z});Object.defineProperty(this,m,{value:W});Object.defineProperty(this,g,{value:E});Object.defineProperty(this,F,{value:k});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e;babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}static renderTo(e){const a=new S(JSON.parse(e.dataset.widget));s.Dom.replace(e,a.render())}render(){const e=babelHelpers.classPrivateFieldLooseBase(this,h)[h].allCount<1;const a=s.Tag.render(c||(c=o`<div class="bp-workflow-instances-widget ${0}"></div>`),e?"--empty":"");babelHelpers.classPrivateFieldLooseBase(this,L)[L].renderTo(a);if(!e){s.Event.bind(a,"click",babelHelpers.classPrivateFieldLooseBase(this,y)[y].bind(this))}return a}}function k(){babelHelpers.classPrivateFieldLooseBase(this,L)[L]=new t.ImageStackSteps({steps:[{id:"basis",stack:{images:s.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,h)[h].users)?babelHelpers.classPrivateFieldLooseBase(this,m)[m](babelHelpers.classPrivateFieldLooseBase(this,h)[h].users,babelHelpers.classPrivateFieldLooseBase(this,h)[h].allCount):babelHelpers.classPrivateFieldLooseBase(this,T)[T]()},footer:{type:t.footerTypeEnum.TEXT,data:{text:babelHelpers.classPrivateFieldLooseBase(this,g)[g](babelHelpers.classPrivateFieldLooseBase(this,h)[h].allCount)},styles:{maxWidth:90}},styles:{minWidth:90}}]})}function E(e){if(e<1){return s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_LIST_EMPTY")}return s.Loc.getMessagePlural("BIZPROC_JS_WORKFLOW_INST_WIDGET_LIST",e,{"#COUNT#":e<100?e:"99+"})}function W(e,a){const i=[];e.forEach((e=>{const a=s.Text.toInteger(e.id);if(a>0){i.push({type:t.imageTypeEnum.USER,data:{userId:a,src:String(e.avatarUrl||"")}})}else{i.push(u)}}));if(a>3){const e=i.slice(0,2);e.push({type:t.imageTypeEnum.COUNTER,data:{text:`+${a-2}`}});return e}return i}function z(e,s=3){return Array.from({length:s}).fill(e!=null?e:{type:t.imageTypeEnum.USER_STUB})}function R(e){if(!babelHelpers.classPrivateFieldLooseBase(this,f)[f]){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=new i.Popup({autoHide:true,width:305,minHeight:342,animation:"fading-slide",content:babelHelpers.classPrivateFieldLooseBase(this,H)[H](),bindElement:e.target,padding:0,borderRadius:"12px"})}babelHelpers.classPrivateFieldLooseBase(this,f)[f].toggle()}function K(){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=s.Tag.render(n||(n=o`<div class="bizproc-workflow-instances-popup-list"></div>`));babelHelpers.classPrivateFieldLooseBase(this,_)[_](babelHelpers.classPrivateFieldLooseBase(this,B)[B]);babelHelpers.classPrivateFieldLooseBase(this,w)[w]();return s.Tag.render(p||(p=o`
			<div class="bizproc-workflow-instances-popup-content">
				<div class="bizproc-workflow-instances-popup-title">${0}</div>
				<div class="bizproc-workflow-instances-popup-text">
					${0}
					<br>
					${0}
				</div>
				<div class="bizproc-workflow-instances-popup-heads">
					<div class="bizproc-workflow-instances-popup-heads-item">
						${0}
					</div>
					<div class="bizproc-workflow-instances-popup-heads-item">
						${0}
					</div>
					<div class="bizproc-workflow-instances-popup-heads-item">
						${0}
					</div>
				</div>
				${0}
			</div>
		`),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TITLE"),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TEXT_P1"),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TEXT_P2"),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_AUTHOR"),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_IN_PROGRESS"),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TIME"),babelHelpers.classPrivateFieldLooseBase(this,B)[B])}function C(e){let a=0;let i=1.15;while(a<5){++a;i-=.15;const t=babelHelpers.classPrivateFieldLooseBase(this,O)[O]();const r=new l.Label({color:l.LabelColor.DEFAULT,size:l.LabelSize.SM,fill:true,customClass:"bizproc-workflow-instances-popup-list-item-time-skeleton"});const c=s.Tag.render(d||(d=o`
				<div class="bizproc-workflow-instances-popup-list-item" style="opacity: ${0}">
					${0}
					<div class="bizproc-workflow-instances-popup-list-item-time">${0}</div>
				</div>
			`),i,t,r.render());s.Dom.append(c,e)}}function U(){s.ajax.runAction("bizproc.workflow.getTemplateInstances",{data:{templateId:babelHelpers.classPrivateFieldLooseBase(this,h)[h].tplId}}).then((e=>{s.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,B)[B]);e.data.list.forEach((e=>{const a=babelHelpers.classPrivateFieldLooseBase(this,O)[O](e.avatars.author,e.avatars.running);const i=new l.Label({text:babelHelpers.classPrivateFieldLooseBase(this,I)[I](e.time.current),color:l.LabelColor.LIGHT_BLUE,size:l.LabelSize.SM,fill:true});const t=s.Tag.render(b||(b=o`
					<div class="bizproc-workflow-instances-popup-list-item">
						${0}
						<div class="bizproc-workflow-instances-popup-list-item-time">${0}</div>
					</div>
				`),a,i.render());s.Dom.append(t,babelHelpers.classPrivateFieldLooseBase(this,B)[B])}))})).catch((e=>{var a;if(((a=e.errors)==null?void 0:a.length)>0){s.Runtime.loadExtension("ui.dialogs.messagebox").then((({MessageBox:a})=>{a.alert(s.Text.encode(e.errors[0].message))})).catch((()=>{}))}else{console.error(e)}}))}function X(e,a){const i=s.Tag.render(v||(v=o`
			<div class="bizproc-workflow-instances-popup-list-item-faces"></div>
		`));const l=new t.ImageStackSteps({steps:[{id:"col-1",stack:{images:s.Type.isArrayFilled(e)?babelHelpers.classPrivateFieldLooseBase(this,m)[m](e):babelHelpers.classPrivateFieldLooseBase(this,T)[T](u,1)},styles:{minWidth:36}},{id:"col-2",stack:{images:s.Type.isArrayFilled(a)?babelHelpers.classPrivateFieldLooseBase(this,m)[m](a):babelHelpers.classPrivateFieldLooseBase(this,T)[T](u,1)}}]});l.renderTo(i);return i}function j(e){if(!e){return"?"}return r.DateTimeFormat.format(P,0,e)}e.Widget=S})(this.BX.Bizproc.Workflow.Instances=this.BX.Bizproc.Workflow.Instances||{},BX,BX.Event,BX.Main,BX.UI,BX.UI,BX.Main);
//# sourceMappingURL=widget.bundle.map.js