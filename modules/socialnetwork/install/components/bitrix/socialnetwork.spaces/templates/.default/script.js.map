{"version":3,"file":"script.js","sources":["src/disk.js","src/loader-type/default-loader.js","src/loader-type/calendar-base-loader.js","src/loader-type/calendar-schedule-loader.js","src/loader-type/discussions-loader.js","src/loader-type/files-list-loader.js","src/loader-type/files-tile-loader.js","src/loader-type/files-big-tile-loader.js","src/loader-type/tasks-calendar-loader.js","src/loader-type/tasks-gantt-loader.js","src/loader-type/tasks-kanban-loader.js","src/loader-type/tasks-list-loader.js","src/loader-type/tasks-scrum-plan-loader.js","src/loader-type/tasks-timeline-loader.js","src/loader.js","src/frame.js","src/overlay.js","src/space.js"],"sourcesContent":["import { BaseEvent, EventEmitter } from 'main.core.events';\n\ntype Params = {\n\twindow: Window;\n}\n\nexport class Disk extends EventEmitter\n{\n\t#window: Window;\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Socialnetwork.Spaces.Disk');\n\n\t\tthis.#window = params.window;\n\n\t\tthis.#window.BX.Event.EventEmitter.subscribe(\n\t\t\t'Disk.TileItem.Item:onItemDblClick',\n\t\t\tthis.#changeNavigation.bind(this),\n\t\t);\n\t\tthis.#window.BX.Event.EventEmitter.subscribe(\n\t\t\t'Disk.TileItem.Item:onItemEnter',\n\t\t\tthis.#changeNavigation.bind(this),\n\t\t);\n\t\tthis.#window.BX.Event.EventEmitter.subscribe(\n\t\t\t'Disk.Breadcrumbs:onClickBreadcrumb',\n\t\t\tthis.#changeBreadcrumbsNavigation.bind(this),\n\t\t);\n\t}\n\n\t#changeNavigation(baseEvent: BaseEvent)\n\t{\n\t\tconst [item] = baseEvent.getCompatData();\n\t\tif (item.isFolder)\n\t\t{\n\t\t\tthis.emit('changePage', item.item.titleLink.href);\n\t\t}\n\t}\n\n\t#changeBreadcrumbsNavigation(baseEvent: BaseEvent)\n\t{\n\t\tconst [breadcrumbLink] = baseEvent.getCompatData();\n\n\t\tthis.emit('changePage', breadcrumbLink.href);\n\t}\n}\n","import { Tag } from 'main.core';\n\nexport class DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sn-spaces__content-loader-default-container\">\n\t\t\t\t${this.#renderSvg()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderSvg(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<svg class=\"sn-spaces__content-loader-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t<circle\n\t\t\t\t\tclass=\"sn-spaces__content-loader-path\"\n\t\t\t\t\tcx=\"50\"\n\t\t\t\t\tcy=\"50\"\n\t\t\t\t\tr=\"20\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tstroke-miterlimit=\"10\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t`;\n\t}\n}","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class CalendarBaseLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-calendar-base\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class CalendarScheduleLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-calendar-schedule\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class DiscussionsLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-discussions\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class FilesListLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-files-list\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class FilesTileLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-files-tile\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class FilesBigTileLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-files-big-tile\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class TasksCalendarLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-tasks-calendar\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class TasksGanttLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-tasks-gantt\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class TasksKanbanLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-tasks-kanban\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class TasksListLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-tasks-list\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class TasksScrumPlanLoader extends DefaultLoader\n{\n\t#pageView: string;\n\n\tconstructor(pageView: string)\n\t{\n\t\tsuper(pageView);\n\n\t\tthis.#pageView = pageView;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-${this.#pageView}\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Tag } from 'main.core';\nimport { DefaultLoader } from './default-loader';\n\nexport class TasksTimelineLoader extends DefaultLoader\n{\n\trender(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"sn-spaces__content-loader-container sn-spaces__content-loader-tasks-timeline\"\n\t\t\t></div>\n\t\t`;\n\t}\n}\n","import { Dom } from 'main.core';\nimport { CalendarBaseLoader } from './loader-type/calendar-base-loader';\nimport { CalendarScheduleLoader } from './loader-type/calendar-schedule-loader';\nimport { DefaultLoader } from './loader-type/default-loader';\nimport { DiscussionsLoader } from './loader-type/discussions-loader';\nimport { FilesListLoader } from './loader-type/files-list-loader';\nimport { FilesTileLoader } from './loader-type/files-tile-loader';\nimport { FilesBigTileLoader } from './loader-type/files-big-tile-loader';\nimport { TasksCalendarLoader } from './loader-type/tasks-calendar-loader';\nimport { TasksGanttLoader } from './loader-type/tasks-gantt-loader';\nimport { TasksKanbanLoader } from './loader-type/tasks-kanban-loader';\nimport { TasksListLoader } from './loader-type/tasks-list-loader';\nimport { TasksScrumPlanLoader } from './loader-type/tasks-scrum-plan-loader';\nimport { TasksTimelineLoader } from './loader-type/tasks-timeline-loader';\n\ntype Params = {\n\tpageView: string,\n\tpageUrl: string,\n}\n\nexport class Loader\n{\n\t#pageUrl: string;\n\n\t#node: ?HTMLElement = null;\n\t#container: HTMLElement;\n\n\t#loader: DefaultLoader;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#pageUrl = params.pageUrl;\n\n\t\tthis.setLoader(params.pageView);\n\t}\n\n\tshow(container: HTMLElement)\n\t{\n\t\tif (this.#node !== null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#container = container;\n\n\t\tDom.addClass(container, '--visible');\n\n\t\tthis.#node = this.#loader.render();\n\n\t\tDom.prepend(this.#node, container);\n\t}\n\n\thide()\n\t{\n\t\tDom.removeClass(this.#container, '--visible');\n\n\t\tDom.remove(this.#node);\n\n\t\tthis.#node = null;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#node !== null;\n\t}\n\n\tsetLoader(pageView: string)\n\t{\n\t\tthis.#loader = this.#initLoader(pageView);\n\t}\n\n\t#initLoader(pageView: string): DefaultLoader\n\t{\n\t\tswitch (pageView)\n\t\t{\n\t\t\tcase 'discussions':\n\t\t\t\treturn new DiscussionsLoader();\n\t\t\tcase 'tasks-list':\n\t\t\t\treturn new TasksListLoader();\n\t\t\tcase 'tasks-timeline':\n\t\t\t\treturn new TasksTimelineLoader();\n\t\t\tcase 'tasks-plan':\n\t\t\tcase 'tasks-kanban':\n\t\t\t\treturn new TasksKanbanLoader();\n\t\t\tcase 'tasks-calendar':\n\t\t\t\treturn new TasksCalendarLoader();\n\t\t\tcase 'tasks-gantt':\n\t\t\t\treturn new TasksGanttLoader();\n\t\t\tcase 'tasks-scrum-plan-sprint':\n\t\t\tcase 'tasks-scrum-plan-backlog':\n\t\t\t\treturn new TasksScrumPlanLoader(pageView);\n\t\t\tcase 'tasks-scrum-active':\n\t\t\tcase 'tasks-scrum-complete':\n\t\t\t\treturn new TasksKanbanLoader();\n\t\t\tcase 'calendar-base':\n\t\t\t\treturn new CalendarBaseLoader();\n\t\t\tcase 'calendar-schedule':\n\t\t\t\treturn new CalendarScheduleLoader();\n\t\t\tcase 'files-list':\n\t\t\t\treturn new FilesListLoader();\n\t\t\tcase 'files-tile-m':\n\t\t\t\treturn new FilesTileLoader();\n\t\t\tcase 'files-tile-xl':\n\t\t\t\treturn new FilesBigTileLoader();\n\t\t\tdefault:\n\t\t\t\treturn new DefaultLoader();\n\t\t}\n\t}\n}\n","import { Dom, Event, Runtime, Tag, Type, Uri } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Loader } from './loader';\n\ntype Params = {\n\tpageId: string,\n\tpageView: string,\n\tid: string,\n\tsrc: string,\n\tclassName: string,\n}\n\nexport type LoadInfo = {\n\tsrc: string,\n\twindow: Window;\n}\n\nexport class Frame extends EventEmitter\n{\n\t#pageId: string;\n\t#pageView: string;\n\t#id: string;\n\t#src: string;\n\t#className: string;\n\n\t#loader: Loader;\n\n\t#sidePanelManager: BX.SidePanel.Manager;\n\n\t#container: HTMLElement;\n\t#node: HTMLIFrameElement;\n\t#window: Window;\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Socialnetwork.Spaces.Frame');\n\n\t\tthis.#pageId = params.pageId;\n\t\tthis.#pageView = params.pageView;\n\t\tthis.#id = params.id;\n\t\tthis.#className = params.className;\n\n\t\tthis.#loader = new Loader({\n\t\t\tpageView: this.#pageView,\n\t\t\tpageUrl: params.src,\n\t\t});\n\n\t\tthis.#sidePanelManager = BX.SidePanel.Instance;\n\n\t\tthis.#setSrc(params.src);\n\n\t\tthis.updateSrcDebounced = Runtime.debounce(this.updateSrc.bind(this), 1000);\n\t}\n\n\trenderTo(container: HTMLElement): void\n\t{\n\t\tthis.#container = container;\n\n\t\tthis.#loader.show(this.#container);\n\n\t\tDom.append(this.#render(), container);\n\t}\n\n\treload(pageView: string, src?: string)\n\t{\n\t\tthis.#loader.setLoader(pageView);\n\n\t\tDom.addClass(this.#node, '--hidden');\n\t\tthis.#loader.show(this.#container);\n\n\t\tif (src)\n\t\t{\n\t\t\tthis.#setSrc(src);\n\t\t}\n\n\t\tif (this.#loader.isShown())\n\t\t{\n\t\t\tthis.updateSrcDebounced();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateSrc();\n\t\t}\n\t}\n\n\tupdateSrc()\n\t{\n\t\tthis.#node.src = this.#src;\n\t}\n\n\tgetFrameNode(): HTMLIFrameElement\n\t{\n\t\treturn this.#node;\n\t}\n\n\tgetWindow(): Window\n\t{\n\t\treturn this.#window;\n\t}\n\n\t#render(): HTMLIFrameElement\n\t{\n\t\tthis.#node = Tag.render`\n\t\t\t<iframe\n\t\t\t\tid=\"${this.#id}\"\n\t\t\t\tclass=\"${`${this.#className} --hidden`}\"\n\t\t\t\tsrc=\"${this.#src}\"\n\t\t\t\tonload=\"${this.#load.bind(this)}\"\n\t\t\t>\n\t\t\t</iframe>\n\t\t`;\n\n\t\treturn this.#node;\n\t}\n\n\t#setSrc(src: string)\n\t{\n\t\tconst uri = new Uri(src);\n\t\turi.setQueryParams({ IFRAME: 'Y' });\n\n\t\tthis.#src = uri.toString();\n\t}\n\n\t#load(event)\n\t{\n\t\tthis.#window = event.target.contentWindow;\n\n\t\tEvent.bind(this.#window, 'unload', () => {\n\t\t\tthis.emit('unload', {\n\t\t\t\tsrc: this.#src,\n\t\t\t\twindow: this.#window,\n\t\t\t});\n\t\t});\n\n\t\tconst url = new URL(this.#src, location);\n\t\turl.searchParams.delete('empty-state');\n\t\tthis.#src = url.toString();\n\n\t\tthis.#initHacks();\n\n\t\tthis.#changeLinksTargets(this.#window.document.body);\n\t\tthis.#initObserver();\n\n\t\tthis.#loader.hide();\n\t\tDom.removeClass(this.#node, '--hidden');\n\n\t\tthis.emit('load', {\n\t\t\tsrc: this.#src,\n\t\t\twindow: this.#window,\n\t\t});\n\t}\n\n\t#initHacks()\n\t{\n\t\tthis.#sidePanelManager.registerAnchorListener(this.#window.document);\n\t}\n\n\t#initObserver()\n\t{\n\t\tif (Type.isUndefined(MutationObserver))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst observer = new MutationObserver((mutations) => {\n\t\t\tmutations.forEach((mutation) => {\n\t\t\t\tfor (let i = 0; i < mutation.addedNodes.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tthis.#changeLinksTargets(mutation.addedNodes.item(i));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tobserver.observe(this.#window.document.body, { childList: true, subtree: true });\n\t}\n\n\t#changeLinksTargets(context: ?HTMLElement)\n\t{\n\t\tif (!context)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet list = [];\n\t\tif (context.tagName === 'A')\n\t\t{\n\t\t\tlist = [context];\n\t\t}\n\t\telse if (Type.isElementNode(context))\n\t\t{\n\t\t\tlist = [...context.querySelectorAll('a')];\n\t\t}\n\n\t\tlist\n\t\t\t.filter((a: HTMLLinkElement) => !a.target)\n\t\t\t// eslint-disable-next-line no-return-assign,no-param-reassign\n\t\t\t.forEach((a: HTMLLinkElement) => a.target = '_top')\n\t\t;\n\t}\n}\n","import { Dom, Event, Tag } from 'main.core';\n\ntype Params = {\n\tpopupId: string,\n\tworkpiece: HTMLElement,\n\tcontainerWithoutOverlay: HTMLElement,\n}\n\nexport class Overlay\n{\n\t#popupId: string;\n\t#workpiece: HTMLElement;\n\t#containerWithoutOverlay: HTMLElement;\n\n\t#overlay: HTMLElement;\n\t#leftOverlay: HTMLElement;\n\t#topOverlay: HTMLElement;\n\t#rightOverlay: HTMLElement;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#popupId = params.popupId;\n\t\tthis.#workpiece = params.workpiece;\n\t\tthis.#containerWithoutOverlay = params.containerWithoutOverlay;\n\n\t\tthis.#createOverlay();\n\n\t\tEvent.bind(window, 'resize', this.#resizeWindow.bind(this));\n\t}\n\n\tshow()\n\t{\n\t\tDom.style(this.#overlay, 'display', 'block');\n\t}\n\n\thide()\n\t{\n\t\tDom.style(this.#overlay, 'display', 'none');\n\t}\n\n\tappend()\n\t{\n\t\tDom.append(this.#overlay, document.body);\n\t}\n\n\tremove()\n\t{\n\t\tDom.remove(this.#overlay);\n\t}\n\n\t#createOverlay()\n\t{\n\t\tconst params = this.#getOverlayParams();\n\n\t\tthis.#leftOverlay = this.#createPartOfOverlay(params.left.width, params.left.height);\n\t\tthis.#topOverlay = this.#createPartOfOverlay(\n\t\t\tparams.top.width,\n\t\t\tparams.top.height,\n\t\t\tparams.top.left,\n\t\t);\n\t\tthis.#rightOverlay = this.#createPartOfOverlay(\n\t\t\tparams.right.width,\n\t\t\tparams.right.height,\n\t\t\tparams.right.left,\n\t\t);\n\n\t\tthis.#overlay = Tag.render`\n\t\t\t<div>\n\t\t\t\t${this.#leftOverlay}\n\t\t\t\t${this.#topOverlay}\n\t\t\t\t${this.#rightOverlay}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createPartOfOverlay(width: number, height: number, left: number = 0): HTMLElement\n\t{\n\t\tconst overlay = this.#workpiece.cloneNode(true);\n\n\t\tthis.#resizeOverlay(overlay, width, height, left);\n\n\t\treturn overlay;\n\t}\n\n\t#resizeWindow()\n\t{\n\t\tconst params = this.#getOverlayParams();\n\n\t\tthis.#resizeOverlay(this.#leftOverlay, params.left.width, params.left.height);\n\t\tthis.#resizeOverlay(\n\t\t\tthis.#topOverlay,\n\t\t\tparams.top.width,\n\t\t\tparams.top.height,\n\t\t\tparams.top.left,\n\t\t);\n\t\tthis.#resizeOverlay(\n\t\t\tthis.#rightOverlay,\n\t\t\tparams.right.width,\n\t\t\tparams.right.height,\n\t\t\tparams.right.left,\n\t\t);\n\t}\n\n\t#getSizes(): Array\n\t{\n\t\tconst scrollWidth = document.documentElement.scrollWidth;\n\t\tconst scrollHeight = Math.max(\n\t\t\tdocument.body.scrollHeight,\n\t\t\tdocument.documentElement.scrollHeight,\n\t\t\tdocument.body.offsetHeight,\n\t\t\tdocument.documentElement.offsetHeight,\n\t\t\tdocument.body.clientHeight,\n\t\t\tdocument.documentElement.clientHeight,\n\t\t);\n\n\t\treturn [scrollWidth, scrollHeight];\n\t}\n\n\t#getOverlayParams(): Object\n\t{\n\t\tconst [scrollWidth, scrollHeight] = this.#getSizes();\n\n\t\tconst rect = Dom.getPosition(this.#containerWithoutOverlay);\n\n\t\treturn {\n\t\t\tleft: {\n\t\t\t\twidth: rect.left,\n\t\t\t\theight: scrollHeight,\n\t\t\t\tleft: 0,\n\t\t\t},\n\t\t\ttop: {\n\t\t\t\twidth: rect.width,\n\t\t\t\theight: rect.top,\n\t\t\t\tleft: rect.left,\n\t\t\t},\n\t\t\tright: {\n\t\t\t\twidth: scrollWidth - rect.right,\n\t\t\t\theight: scrollHeight,\n\t\t\t\tleft: rect.right,\n\t\t\t},\n\t\t};\n\t}\n\n\t#resizeOverlay(overlay: HTMLElement, width: number, height: number, left: number = 0)\n\t{\n\t\tDom.style(overlay, 'width', `${width}px`);\n\t\tDom.style(overlay, 'height', `${height}px`);\n\n\t\tif (left)\n\t\t{\n\t\t\tDom.style(overlay, 'left', `${left}px`);\n\t\t}\n\t}\n}\n","import { ajax, AjaxError, AjaxResponse, Cache, Dom, Event, Type, Uri } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { BaseEvent } from 'main.core.events';\nimport { Disk } from './disk';\n\nimport { Frame, LoadInfo } from './frame';\nimport { Overlay } from './overlay';\n\ntype Params = {\n\tpageId: string,\n\tcontentUrl: string,\n\tuserId: number,\n\tgroupId: number,\n}\n\nexport class Space\n{\n\t#cache = new Cache.MemoryCache();\n\n\t#frame: Frame;\n\t#disk: Disk;\n\t#overlays: Map<string, Overlay> = new Map();\n\t#popupIds: Set<string> = new Set();\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.setParams(params);\n\n\t\tthis.#initServices();\n\t}\n\n\tsetParams(params: Params): void\n\t{\n\t\tthis.#cache.set('params', params);\n\t}\n\n\trenderContentTo(container: HTMLElement): void\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\tthrow new Error('BX.Socialnetwork.Spaces.Space: HTMLElement for space not found');\n\t\t}\n\n\t\tthis.#frame.renderTo(container);\n\t}\n\n\treloadPageContent(pageUrl?: string): void\n\t{\n\t\tconst uri = new Uri(pageUrl);\n\n\t\tconst pageType = this.#getPageType(uri);\n\n\t\tlet viewMode = '';\n\t\tlet viewSize = '';\n\t\tlet fState = '';\n\t\tif (pageType === 'tasks')\n\t\t{\n\t\t\tfState = uri.getQueryParam('F_STATE');\n\t\t\tviewMode = uri.getQueryParam('tab') ?? '';\n\t\t}\n\n\t\tlet isTrashMode = false;\n\t\tif (pageType === 'files')\n\t\t{\n\t\t\tif (uri.getPath().includes('trashcan'))\n\t\t\t{\n\t\t\t\tisTrashMode = true;\n\t\t\t}\n\n\t\t\tviewMode = uri.getQueryParam('viewMode') ?? '';\n\t\t\tviewSize = uri.getQueryParam('viewSize') ?? '';\n\t\t}\n\n\t\tajax.runComponentAction(\n\t\t\t'bitrix:socialnetwork.spaces',\n\t\t\t'getPageView',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tpageType: pageType,\n\t\t\t\t\tuserId: this.#getParam('userId'),\n\t\t\t\t\tgroupId: this.#getParam('groupId'),\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tisTrashMode,\n\t\t\t\t\t\tviewMode,\n\t\t\t\t\t\tviewSize,\n\t\t\t\t\t},\n\t\t\t\t\tF_STATE: fState,\n\t\t\t\t},\n\t\t\t},\n\t\t)\n\t\t\t.then((response: AjaxResponse) => {\n\t\t\t\tthis.#frame.reload(response.data, pageUrl);\n\t\t\t})\n\t\t\t.catch((error: AjaxError) => {\n\t\t\t\tthis.#consoleError('getPageView', error);\n\t\t\t})\n\t\t;\n\t}\n\n\tshowOverlay(popupId: string, frameOverlay: HTMLElement): void\n\t{\n\t\tthis.#blockScroll(popupId);\n\n\t\tconst topOverlay = (\n\t\t\tthis.#overlays.has(popupId)\n\t\t\t\t? this.#overlays.get(popupId)\n\t\t\t\t: new Overlay({\n\t\t\t\t\tpopupId,\n\t\t\t\t\tworkpiece: frameOverlay,\n\t\t\t\t\tcontainerWithoutOverlay: this.#frame.getFrameNode(),\n\t\t\t\t})\n\t\t);\n\n\t\tthis.#overlays.set(popupId, topOverlay);\n\n\t\ttopOverlay.append();\n\t}\n\n\thideOverlay(popupId: string): void\n\t{\n\t\tif (this.#overlays.has(popupId))\n\t\t{\n\t\t\tthis.#overlays.get(popupId).remove();\n\t\t}\n\n\t\tthis.#unblockScroll(popupId);\n\t}\n\n\t#showOverlays(): void\n\t{\n\t\tthis.#overlays.forEach((overlay: Overlay) => overlay.show());\n\t}\n\n\t#hideOverlays(): void\n\t{\n\t\tthis.#overlays.forEach((overlay: Overlay) => overlay.hide());\n\t}\n\n\t#removeOverlays(): void\n\t{\n\t\tthis.#overlays.forEach((overlay: Overlay) => overlay.remove());\n\t}\n\n\t#blockScroll(popupId: string)\n\t{\n\t\tthis.#popupIds.add(popupId);\n\n\t\tDom.addClass(\n\t\t\tthis.#frame.getWindow().document.querySelector('.sn-spaces__wrapper'),\n\t\t\t'--scroll-disabled',\n\t\t);\n\t}\n\n\t#unblockScroll(popupId: string)\n\t{\n\t\tthis.#popupIds.delete(popupId);\n\n\t\tif (this.#popupIds.size === 0)\n\t\t{\n\t\t\tDom.removeClass(\n\t\t\t\tthis.#frame.getWindow().document.querySelector('.sn-spaces__wrapper'),\n\t\t\t\t'--scroll-disabled',\n\t\t\t);\n\t\t}\n\t}\n\n\t#initServices(): void\n\t{\n\t\tthis.#frame = new Frame({\n\t\t\tpageId: this.#getParam('pageId'),\n\t\t\tpageView: this.#getParam('pageView'),\n\t\t\tid: 'sn-spaces-iframe',\n\t\t\tsrc: this.#getParam('contentUrl'),\n\t\t\tclassName: 'sn-spaces-iframe',\n\t\t});\n\n\t\tthis.#frame.subscribe('load', (baseEvent: BaseEvent) => {\n\t\t\tconst info: LoadInfo = baseEvent.getData();\n\n\t\t\tconst uri = new Uri(info.src);\n\t\t\turi.removeQueryParam(['IFRAME']);\n\n\t\t\tthis.#changeBrowserHistory(uri.toString());\n\n\t\t\tif (this.#getParam('pageId') === 'files')\n\t\t\t{\n\t\t\t\tthis.#disk = new Disk({\n\t\t\t\t\twindow: info.window,\n\t\t\t\t});\n\t\t\t\tthis.#disk.subscribe('changePage', (innerBaseEvent: BaseEvent) => {\n\t\t\t\t\tthis.#changeBrowserHistory(innerBaseEvent.getData());\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.#frame.subscribe('unload', () => {\n\t\t\tthis.#removeOverlays();\n\t\t});\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onOpen', () => {\n\t\t\tthis.#hideOverlays();\n\t\t});\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', () => {\n\t\t\tthis.#showOverlays();\n\t\t});\n\n\t\tnew MutationObserver(() => {\n\t\t\tconst theme = BX.Intranet.Bitrix24.ThemePicker.Singleton.getAppliedThemeId();\n\t\t\tconst themeStyles = document.head.querySelectorAll(`link[data-theme-id=\"${theme}\"`);\n\t\t\t// eslint-disable-next-line promise/catch-or-return\n\t\t\tPromise.all([...themeStyles].map((link) => new Promise((resolve) => {\n\t\t\t\tEvent.bind(link, 'load', resolve);\n\t\t\t}))).then(() => this.#updateBaseTheme());\n\t\t}).observe(document.head, { childList: true, subtree: false });\n\t}\n\n\t#updateBaseTheme(): void\n\t{\n\t\tconst currentTheme = BX.Intranet.Bitrix24.ThemePicker.Singleton.getAppliedThemeId();\n\t\tconst baseTheme = currentTheme.match(/(.*):/)[1];\n\t\tconst document = this.#frame.getFrameNode().contentDocument;\n\t\tif (!document.body)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdocument.body.className = document.body.className.replace(/bitrix24-\\S*-theme/, '');\n\t\tDom.addClass(document.body, `bitrix24-${baseTheme}-theme`);\n\t}\n\n\t#getParam(param: string): any\n\t{\n\t\treturn this.#cache.get('params')[param];\n\t}\n\n\t#changeBrowserHistory(url: string): void\n\t{\n\t\twindow.history.replaceState({}, '', url);\n\t}\n\n\t#getPageType(uri: Uri): string\n\t{\n\t\tif (uri.getPath().includes('general'))\n\t\t{\n\t\t\treturn 'discussions';\n\t\t}\n\n\t\tif (uri.getPath().includes('tasks'))\n\t\t{\n\t\t\treturn 'tasks';\n\t\t}\n\n\t\tif (uri.getPath().includes('calendar'))\n\t\t{\n\t\t\treturn 'calendar';\n\t\t}\n\n\t\tif (uri.getPath().includes('disk'))\n\t\t{\n\t\t\treturn 'files';\n\t\t}\n\n\t\treturn 'discussions';\n\t}\n\n\t#consoleError(action: string, error: AjaxError)\n\t{\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.error(`Spaces: ${action} error`, error);\n\t}\n}\n"],"names":["Disk","params","setEventNamespace","window","BX","Event","EventEmitter","subscribe","bind","baseEvent","getCompatData","item","isFolder","emit","titleLink","href","breadcrumbLink","DefaultLoader","_classPrivateMethodInitSpec","Tag","render","CalendarBaseLoader","CalendarScheduleLoader","DiscussionsLoader","FilesListLoader","FilesTileLoader","FilesBigTileLoader","TasksCalendarLoader","TasksGanttLoader","TasksKanbanLoader","TasksListLoader","TasksScrumPlanLoader","pageView","_classPrivateFieldInitSpec","TasksTimelineLoader","Loader","pageUrl","setLoader","container","Dom","addClass","prepend","removeClass","remove","Frame","pageId","id","className","src","SidePanel","Instance","_classPrivateMethodGet","updateSrcDebounced","Runtime","debounce","updateSrc","show","append","isShown","uri","Uri","setQueryParams","IFRAME","toString","event","target","contentWindow","url","URL","location","searchParams","document","body","hide","registerAnchorListener","Type","isUndefined","MutationObserver","observer","mutations","forEach","mutation","i","addedNodes","length","observe","childList","subtree","context","list","tagName","isElementNode","querySelectorAll","filter","a","Overlay","popupId","workpiece","containerWithoutOverlay","style","left","width","height","top","right","overlay","cloneNode","scrollWidth","documentElement","scrollHeight","Math","max","offsetHeight","clientHeight","rect","getPosition","Space","Cache","MemoryCache","Map","Set","setParams","set","isDomNode","Error","renderTo","pageType","viewMode","viewSize","fState","getQueryParam","isTrashMode","getPath","includes","ajax","runComponentAction","mode","data","userId","groupId","F_STATE","then","response","reload","error","frameOverlay","topOverlay","has","get","getFrameNode","add","getWindow","querySelector","size","info","getData","removeQueryParam","innerBaseEvent","theme","Intranet","Bitrix24","ThemePicker","Singleton","getAppliedThemeId","themeStyles","head","Promise","all","map","link","resolve","currentTheme","baseTheme","match","contentDocument","replace","param","history","replaceState","action","console"],"mappings":"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"}