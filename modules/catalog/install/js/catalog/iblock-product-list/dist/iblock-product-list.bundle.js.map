{"version":3,"file":"iblock-product-list.bundle.js","sources":["../src/iblock-product-list.js"],"sourcesContent":["import type {BaseEvent} from 'main.core.events';\nimport {EventEmitter} from 'main.core.events';\nimport {Dom, Tag, Text, Type, Uri} from 'main.core';\nimport './style.css';\n\nexport class IblockProductList\n{\n\t/**\n\t * @type {?BX.Main.grid}\n\t */\n\tgrid;\n\tvariations = new Map();\n\tvariationsEditData = new Map();\n\n\tonSettingsWindowSaveHandler = this.handleOnSettingsWindowSave.bind(this);\n\tonChangeVariationHandler = this.handleOnChangeVariation.bind(this);\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\n\tonFilterApplyHandler = this.handleOnFilterApply.bind(this);\n\n\tconstructor(options = {})\n\t{\n\t\tthis.gridId = options.gridId;\n\t\tthis.rowIdMask = options.rowIdMask || '#ID#';\n\t\tthis.variationFieldNames = options.variationFieldNames || [];\n\t\tthis.productVariationMap = options.productVariationMap || {};\n\t\tthis.createNewProductHref = options.createNewProductHref || '';\n\t\tthis.showCatalogWithOffers = options.showCatalogWithOffers || false;\n\n\t\tthis.addCustomClassToGrid();\n\t\tthis.cacheSelectedVariation();\n\n\t\tEventEmitter.subscribe('BX.Grid.SettingsWindow:save', this.onSettingsWindowSaveHandler);\n\t\tEventEmitter.subscribe('SkuProperty::onChange', this.onChangeVariationHandler);\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApplyHandler);\n\t}\n\n\taddCustomClassToGrid()\n\t{\n\t\tDom.addClass(this.getGrid().getContainer(), 'catalog-product-grid');\n\t}\n\n\tcacheSelectedVariation()\n\t{\n\t\tthis.getGrid().getRows().getBodyChild().forEach((row) => {\n\t\t\tlet rowId = row.getId();\n\t\t\tlet productId = this.getProductIdByRowId(rowId);\n\t\t\tlet variationId = this.getCurrentVariationIdByProduct(productId);\n\n\t\t\tif (variationId)\n\t\t\t{\n\t\t\t\tthis.variations.set(variationId, row.getNode().cloneNode(true));\n\t\t\t\tthis.variationsEditData.set(variationId, row.getEditData());\n\t\t\t}\n\t\t});\n\t}\n\n\tclearAllVariationCache()\n\t{\n\t\tthis.variations.clear();\n\t\tthis.variationsEditData.clear();\n\t}\n\n\tclearVariationCache(variationId)\n\t{\n\t\tthis.variations.delete(variationId);\n\t\tthis.variationsEditData.delete(variationId);\n\t}\n\n\t/**\n\t * @returns {?BX.Main.grid}\n\t */\n\tgetGrid()\n\t{\n\t\tif (!this.grid)\n\t\t{\n\t\t\tthis.grid = BX.Main.gridManager.getInstanceById(this.gridId);\n\t\t}\n\n\t\treturn this.grid;\n\t}\n\n\thandleOnSettingsWindowSave(event: BaseEvent)\n\t{\n\t\tconst [settingsWindow] = event.getCompatData();\n\t\tconst selectedColumns = settingsWindow.getSelectedColumns();\n\t\tthis.showCatalogWithOffers = selectedColumns.indexOf('CATALOG_PRODUCT') !== -1;\n\t}\n\n\thandleOnChangeVariation(event: BaseEvent)\n\t{\n\t\tconst [skuFields] = event.getData();\n\t\tconst productId = Text.toNumber(skuFields.PARENT_PRODUCT_ID);\n\t\tconst variationId = Text.toNumber(skuFields.ID);\n\n\t\tif (productId <= 0 || variationId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getVariation(productId, variationId)\n\t\t\t.then((variationNode) => {\n\t\t\t\tthis.updateProductRow(productId, variationId, variationNode);\n\t\t\t\tthis.productVariationMap[productId] = variationId;\n\t\t\t});\n\t}\n\n\tgetVariation(productId, variationId)\n\t{\n\t\tif (this.variations.has(variationId))\n\t\t{\n\t\t\treturn Promise.resolve(this.variations.get(variationId))\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.loadVariation(productId, variationId, resolve);\n\t\t})\n\t\t\t.then((variation) => {\n\t\t\t\tif (Type.isDomNode(variation))\n\t\t\t\t{\n\t\t\t\t\tthis.variations.set(variationId, variation);\n\t\t\t\t\treturn variation;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t});\n\t}\n\n\tloadVariation(productId, variationId, resolve)\n\t{\n\t\tconst self = this;\n\t\tconst url = '';\n\t\tconst method = 'POST';\n\t\tconst data = {productId, variationId};\n\n\t\tthis.getProductRow(productId).stateLoad();\n\t\tthis.getGrid().getData().request(url, method, data, 'changeVariation', function() {\n\t\t\tconst row = self.getProductRow(productId);\n\t\t\tif (row)\n\t\t\t{\n\t\t\t\trow.stateUnload();\n\t\t\t\tresolve(this.getRowById(row.getId()));\n\t\t\t}\n\t\t});\n\t}\n\n\tgetProductIdByRowId(rowId)\n\t{\n\t\tconst mask = new RegExp(this.rowIdMask.replace('#ID#', '([0-9]+)'));\n\t\tconst matches = rowId.match(mask);\n\n\t\treturn Type.isArray(matches) ? Text.toNumber(matches[1]) : 0;\n\t}\n\n\tgetRowIdByProductId(id)\n\t{\n\t\treturn this.rowIdMask.replace('#ID#', id);\n\t}\n\n\t/**\n\t * @param id\n\t * @returns {?BX.Grid.Row}\n\t */\n\tgetProductRow(id)\n\t{\n\t\tconst rowId = this.getRowIdByProductId(id);\n\n\t\treturn this.getGrid().getRows().getById(rowId);\n\t}\n\n\t/**\n\t * @returns {?BX.Grid.Row}\n\t */\n\tgetHeadRow()\n\t{\n\t\treturn this.getGrid().getRows().getHeadFirstChild();\n\t}\n\n\tupdateProductRow(productId, variationId, variationNode)\n\t{\n\t\tif (!productId || !Type.isDomNode(variationNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst headRow = this.getHeadRow();\n\t\tconst productRow = this.getProductRow(productId);\n\t\tconst fields = {};\n\n\t\t[...variationNode.cells].forEach((cell, index) => {\n\t\t\tconst cellName = headRow.getCellNameByCellIndex(index);\n\n\t\t\tif (this.variationFieldNames.includes(cellName))\n\t\t\t{\n\t\t\t\tlet columnCell = productRow.getCellByIndex(index);\n\t\t\t\tif (columnCell)\n\t\t\t\t{\n\t\t\t\t\tconst cellHtml = productRow.getContentContainer(cell).innerHTML;\n\t\t\t\t\tproductRow.getContentContainer(columnCell).innerHTML = cellHtml;\n\t\t\t\t\tfields[cellName] = cellHtml;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (this.variationsEditData.has(variationId))\n\t\t{\n\t\t\tproductRow.setEditData(this.variationsEditData.get(variationId));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tproductRow.resetEditData();\n\t\t\tthis.variationsEditData.set(variationId, productRow.getEditData());\n\n\t\t}\n\n\t\tif (productRow.isEdit())\n\t\t{\n\t\t\tproductRow.editCancel();\n\t\t\tproductRow.edit();\n\t\t}\n\t}\n\n\thandleOnBeforeGridRequest(event: BaseEvent)\n\t{\n\t\tconst [, gridData] = event.getData();\n\t\tconst submitData = BX.prop.get(gridData, 'data', {});\n\n\t\t// reload settings, columns or something else\n\t\tif (!submitData.productId && !submitData.FIELDS)\n\t\t{\n\t\t\tthis.clearAllVariationCache();\n\t\t}\n\n\t\tif (submitData.FIELDS)\n\t\t{\n\t\t\tfor (let rowId in submitData.FIELDS)\n\t\t\t{\n\t\t\t\tif (!submitData.FIELDS.hasOwnProperty(rowId))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst productId = this.getProductIdByRowId(rowId);\n\t\t\t\tconst variationId = this.getCurrentVariationIdByProduct(productId);\n\t\t\t\tconst newFilesRegExp = new RegExp(/([0-9A-Za-z_]+?(_n\\d+)*)\\[([A-Za-z_]+)\\]/);\n\t\t\t\tconst rowFields = submitData.FIELDS[rowId];\n\t\t\t\tconst morePhotoValues = {};\n\t\t\t\tif (!Type.isNil(rowFields['MORE_PHOTO_custom']))\n\t\t\t\t{\n\t\t\t\t\tfor (let key in rowFields['MORE_PHOTO_custom'])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!rowFields['MORE_PHOTO_custom'].hasOwnProperty(key))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst inputValue = rowFields['MORE_PHOTO_custom'][key];\n\t\t\t\t\t\tif (newFilesRegExp.test(inputValue.name))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet fileCounter, fileSetting;\n\t\t\t\t\t\t\t[, fileCounter, , fileSetting] = inputValue.name.match(newFilesRegExp);\n\t\t\t\t\t\t\tif (fileCounter && fileSetting)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmorePhotoValues[fileCounter] = morePhotoValues[fileCounter] || {};\n\t\t\t\t\t\t\t\tmorePhotoValues[fileCounter][fileSetting] = inputValue.value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmorePhotoValues[inputValue.name] = inputValue.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trowFields['MORE_PHOTO'] = morePhotoValues;\n\t\t\t\tif (variationId && this.showCatalogWithOffers)\n\t\t\t\t{\n\t\t\t\t\tconst variationRowId = this.getRowIdByProductId(variationId);\n\t\t\t\t\t// clear old cache\n\t\t\t\t\tthis.clearVariationCache(variationId);\n\n\t\t\t\t\tsubmitData.FIELDS[variationRowId] = {};\n\n\t\t\t\t\tfor (let fieldName of this.variationFieldNames)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!rowFields.hasOwnProperty(fieldName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsubmitData.FIELDS[variationRowId][fieldName] = rowFields[fieldName];\n\t\t\t\t\t\tdelete submitData.FIELDS[rowId][fieldName];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCurrentVariationIdByProduct(productId)\n\t{\n\t\treturn productId in this.productVariationMap ? Text.toNumber(this.productVariationMap[productId]) : null;\n\t}\n\n\thandleOnFilterApply(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst filterGridId = data[0];\n\t\tconst filter = data[2] instanceof BX.Main.Filter ? event.getData()[2] : null;\n\n\t\tif (filter && (filterGridId === this.gridId))\n\t\t{\n\t\t\tconst filterFields = this.getFilterFields(filter);\n\n\t\t\tlet sectionId = '0';\n\n\t\t\tif (Type.isArray(filterFields))\n\t\t\t{\n\t\t\t\tconst fieldSectionId = this.getFieldSectionId(filterFields);\n\n\t\t\t\tif (fieldSectionId)\n\t\t\t\t{\n\t\t\t\t\tconst value = fieldSectionId['VALUE'];\n\n\t\t\t\t\tif (Type.isObject(value))\n\t\t\t\t\t{\n\t\t\t\t\t\tsectionId = value['VALUE'];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setNewProductButtonHrefSectionId(sectionId);\n\t\t}\n\t}\n\n\tgetFilterFields(filter: BX.Main.Filter)\n\t{\n\t\tconst presets = filter.getParam('PRESETS');\n\n\t\tlet tmpFilterPreset = null;\n\n\t\tif (Type.isArray(presets))\n\t\t{\n\t\t\ttmpFilterPreset = presets.find((preset) => {\n\t\t\t\treturn preset['ID'] === 'tmp_filter';\n\t\t\t});\n\t\t}\n\n\t\tif (tmpFilterPreset)\n\t\t{\n\t\t\treturn tmpFilterPreset['FIELDS'] || null;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetFieldSectionId(fields: Array)\n\t{\n\t\treturn fields.find((field) => {\n\t\t\treturn field['ID'] === 'field_SECTION_ID'\n\t\t});\n\t}\n\n\tsetNewProductButtonHrefSectionId(sectionId: String)\n\t{\n\t\tconst uri = new Uri(this.createNewProductHref);\n\t\turi.setQueryParams({\n\t\t\tIBLOCK_SECTION_ID: sectionId,\n\t\t});\n\t\tconst button = document.getElementById('create_new_product_button_' + this.gridId);\n\n\t\tif (Type.isDomNode(button))\n\t\t{\n\t\t\tbutton.href = uri.getPath() + uri.getQuery();\n\t\t}\n\t}\n}"],"names":["IblockProductList","options","Map","handleOnSettingsWindowSave","bind","handleOnChangeVariation","handleOnBeforeGridRequest","handleOnFilterApply","gridId","rowIdMask","variationFieldNames","productVariationMap","createNewProductHref","showCatalogWithOffers","addCustomClassToGrid","cacheSelectedVariation","EventEmitter","subscribe","onSettingsWindowSaveHandler","onChangeVariationHandler","onBeforeGridRequestHandler","onFilterApplyHandler","Dom","addClass","getGrid","getContainer","getRows","getBodyChild","forEach","row","rowId","getId","productId","getProductIdByRowId","variationId","getCurrentVariationIdByProduct","variations","set","getNode","cloneNode","variationsEditData","getEditData","clear","delete","grid","BX","Main","gridManager","getInstanceById","event","getCompatData","settingsWindow","selectedColumns","getSelectedColumns","indexOf","getData","skuFields","Text","toNumber","PARENT_PRODUCT_ID","ID","getVariation","then","variationNode","updateProductRow","has","Promise","resolve","get","loadVariation","variation","Type","isDomNode","self","url","method","data","getProductRow","stateLoad","request","stateUnload","getRowById","mask","RegExp","replace","matches","match","isArray","id","getRowIdByProductId","getById","getHeadFirstChild","headRow","getHeadRow","productRow","cells","cell","index","cellName","getCellNameByCellIndex","includes","columnCell","getCellByIndex","cellHtml","getContentContainer","innerHTML","fields","setEditData","resetEditData","isEdit","editCancel","edit","gridData","submitData","prop","FIELDS","clearAllVariationCache","hasOwnProperty","newFilesRegExp","rowFields","morePhotoValues","isNil","key","inputValue","test","name","fileCounter","fileSetting","value","variationRowId","clearVariationCache","fieldName","filterGridId","filter","Filter","filterFields","getFilterFields","sectionId","fieldSectionId","getFieldSectionId","isObject","setNewProductButtonHrefSectionId","presets","getParam","tmpFilterPreset","find","preset","field","uri","Uri","setQueryParams","IBLOCK_SECTION_ID","button","document","getElementById","href","getPath","getQuery"],"mappings":"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"}