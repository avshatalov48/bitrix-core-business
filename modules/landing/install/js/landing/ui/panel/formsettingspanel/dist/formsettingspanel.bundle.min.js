this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};this.BX.Landing.UI=this.BX.Landing.UI||{};(function(e,t,n,i,a,s,r,o,l,c,u,d,g,p,m,h,_,T,f,E,b,L,I,v,N,S,C,y,F,D,A,M){"use strict";var O="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/header-and-buttons/images/header-and-buttons-message-icon.svg";var R=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.HeaderAndButtonContent");var i=new L.HeaderCard({title:F.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_TITLE")});var a=new b.MessageCard({id:"headerAndButtonMessage",icon:O,header:F.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_MESSAGE_HEADER"),description:F.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_MESSAGE_DESCRIPTION"),restoreState:true});var s=new I.FormSettingsForm({id:"headers",title:F.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_HEADERS_FORM_TITLE"),toggleable:true,fields:[new p.VariablesField({selector:"title",title:F.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_HEADERS_FORM_HEADER_FIELD_TITLE"),textOnly:true,content:n.options.values.title,variables:n.options.personalizationVariables}),new p.VariablesField({selector:"desc",title:F.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_HEADERS_FORM_SUBHEADER_FIELD_TITLE"),textOnly:true,content:n.options.values.desc,variables:n.options.personalizationVariables}),new BX.Landing.UI.Field.Checkbox({selector:"hideDesc",items:[{value:"hideDesc",name:F.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_HEADERS_FORM_HIDE_SUBHEADER_FIELD_TITLE")}],compact:true})]});var r=new I.FormSettingsForm({id:"buttons",title:F.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_BUTTONS_FORM_TITLE"),fields:[new v.TextField({selector:"buttonCaption",title:F.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_BUTTONS_FORM_SEND_BUTTON_TITLE"),textOnly:true,content:n.options.values.buttonCaption})]});n.addItem(i);n.addItem(a);n.addItem(s);n.addItem(r);return n}babelHelpers.createClass(t,[{key:"valueReducer",value:function e(t){var n=Object.entries(t).reduce(function(e,t){var n=babelHelpers.slicedToArray(t,2),i=n[0],a=n[1];if(i==="hideDesc"){if(a.includes(i)){e.desc=""}delete e.hideDesc}if(i==="useSign"){e.useSign=a.includes("useSign")}return e},babelHelpers.objectSpread({},t));if(!this.items[2].getSwitch().getValue()){n.title="";n.desc=""}return n}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var k="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/agreements/images/message-icon.svg";var B=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.AgreementsContent");var i=new L.HeaderCard({title:A.Loc.getMessage("LANDING_AGREEMENTS_TITLE")});var a=new b.MessageCard({id:"agreementsMessage",header:A.Loc.getMessage("LANDING_AGREEMENTS_MESSAGE_HEADER"),description:A.Loc.getMessage("LANDING_AGREEMENTS_MESSAGE_DESCRIPTION"),icon:k,restoreState:true});var s=new I.FormSettingsForm({id:"agreementsList",fields:[new r.AgreementsList({selector:"agreements",formOptions:n.options.formOptions,agreementsList:n.options.agreementsList,value:n.options.values.agreements})]});if(!a.isShown()){F.Dom.style(i.getLayout(),"margin-bottom","0");F.Dom.style(s.getLayout(),"margin-top","-19px")}a.subscribe("onClose",function(){F.Dom.style(i.getLayout(),"margin-bottom","0");F.Dom.style(s.getLayout(),"margin-top","-19px")});n.addItem(i);n.addItem(a);n.addItem(s);return n}return t}(M.ContentWrapper);var G=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.SpamProtection");var i=new L.HeaderCard({title:A.Loc.getMessage("LANDING_SPAM_PROTECTION_TITLE")});var a=new I.FormSettingsForm({id:"type",description:null,fields:[new h.RadioButtonField({selector:"use",title:A.Loc.getMessage("LANDING_SPAM_PROTECTION_TABS_TITLE"),value:n.options.values.use?"hidden":"disabled",items:[{id:"disabled",title:A.Loc.getMessage("LANDING_SPAM_PROTECTION_TAB_DISABLED"),icon:"landing-ui-spam-protection-icon-disabled"},{id:"hidden",title:A.Loc.getMessage("LANDING_SPAM_PROTECTION_TAB_HIDDEN"),icon:"landing-ui-spam-protection-icon-hidden"}]})]});n.addItem(i);n.addItem(a);n.addItem(n.getKeysCheckbox());n.addItem(n.getKeysForm());var s=n.options.values.key&&n.options.values.secret;if(a.fields[0].getValue()==="disabled"){n.hideKeysCheckbox();n.hideKeysForm()}else{n.showKeysCheckbox();n.getKeysCheckbox().fields[0].setValue([s?"useCustomKeys":""]);if(s){n.showKeysForm()}else{n.hideKeysForm()}}a.subscribe("onChange",function(){if(a.fields[0].getValue()==="disabled"){n.hideKeysCheckbox();n.hideKeysForm()}else{n.showKeysCheckbox();n.getKeysCheckbox().fields[0].setValue([s?"useCustomKeys":""]);if(s){n.showKeysForm()}else{n.hideKeysForm()}}});n.getKeysCheckbox().subscribe("onChange",function(){if(n.getKeysCheckbox().fields[0].getValue().includes("useCustomKeys")){n.showKeysForm()}else{n.hideKeysForm()}});return n}babelHelpers.createClass(t,[{key:"getKeysCheckbox",value:function e(){return this.cache.remember("keysCheckbox",function(){return new I.FormSettingsForm({id:"customKeys",description:null,fields:[new BX.Landing.UI.Field.Checkbox({selector:"useCustomKeys",items:[{name:A.Loc.getMessage("LANDING_SPAM_PROTECTION_CUSTOM_KEYS_CHECKBOX_LABEL"),value:"useCustomKeys"}]})]})})}},{key:"showKeysCheckbox",value:function e(){this.getKeysCheckbox().getLayout().hidden=false}},{key:"hideKeysCheckbox",value:function e(){this.getKeysCheckbox().getLayout().hidden=true}},{key:"getKeysForm",value:function e(){var t=this;return this.cache.remember("keysForm",function(){return new I.FormSettingsForm({id:"keys",title:A.Loc.getMessage("LANDING_SPAM_PROTECTION_KEYS_FORM_TITLE"),help:{text:A.Loc.getMessage("LANDING_SPAM_PROTECTION_KEYS_FORM_HELP_TEXT"),href:A.Loc.getMessage("LANDING_SPAM_PROTECTION_KEYS_FORM_HELP_HREF")},fields:[new v.TextField({selector:"key",title:A.Loc.getMessage("LANDING_SPAM_PROTECTION_RECAPTCHA_KEY_FIELD_TITLE"),textOnly:true,content:t.options.values.key}),new v.TextField({selector:"secret",title:A.Loc.getMessage("LANDING_SPAM_PROTECTION_RECAPTCHA_SECRET_KEY_FIELD_TITLE"),textOnly:true,content:t.options.values.secret})]})})}},{key:"showKeysForm",value:function e(){this.getKeysForm().getLayout().hidden=false}},{key:"hideKeysForm",value:function e(){this.getKeysForm().getLayout().hidden=true}},{key:"valueReducer",value:function e(t){var n=t.useCustomKeys.length>0;return{recaptcha:{use:t.use==="hidden",key:n?t.key:"",secret:n?t.secret:""}}}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var P="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/analytics/images/yandex.svg";var H="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/analytics/images/google.svg";function w(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="landing-ui-content-table-cell">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);w=function t(){return e};return e}var U=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);this.options=babelHelpers.objectSpread({},t)}babelHelpers.createClass(e,[{key:"render",value:function e(){return F.Tag.render(w(),this.options.content)}}]);return e}();function x(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="landing-ui-content-table-row','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);x=function t(){return e};return e}var X=function(){function e(t){babelHelpers.classCallCheck(this,e);this.options=babelHelpers.objectSpread({},t)}babelHelpers.createClass(e,[{key:"render",value:function e(){var t=this.options.head?" landing-ui-content-table-row-head":"";return F.Tag.render(x(),t,this.options.columns.map(function(e){return e.render()}))}}]);return e}();function K(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="landing-ui-content-table-wrapper">\n\t\t\t\t\n\t\t\t\t<div class="landing-ui-content-table">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);K=function t(){return e};return e}function Y(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-content-table-title">',"</div>\n\t\t\t"]);Y=function t(){return e};return e}var V=function(){function e(t){babelHelpers.classCallCheck(this,e);this.options=babelHelpers.objectSpread({},t);this.headRow=new X({columns:this.options.columns.map(function(e){return new U(e)}),head:true});this.rows=this.options.rows.map(function(e){return new X({columns:e.columns.map(function(e){return new U(e)})})})}babelHelpers.createClass(e,[{key:"getTitleLayout",value:function e(){if(Type.isStringFilled(this.options.title)){return F.Tag.render(Y(),this.options.title)}return""}},{key:"render",value:function e(){return F.Tag.render(K(),this.headRow.render(),this.rows.map(function(e){return e.render()}))}}]);return e}();var j=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.AgreementsContent");var i=new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_TITLE")});var a=[];if(A.Loc.getMessage("LANGUAGE_ID")==="ru"){a.push({id:"yandex",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_ITEM_YANDEX_METRIKA"),icon:P,checked:true,switcher:false,content:n.getYandexTable()})}a.push({id:"google",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_ITEM_GOOGLE_ANALYTICS"),icon:H,checked:true,switcher:false,content:n.getGoogleTable()});var s=new o.AccordionField({selector:"analytics",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_ITEMS_FIELD_TITLE"),items:a});var r=new b.MessageCard({id:"analyticsMessage",header:A.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_MESSAGE_TITLE"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_MESSAGE_DESCRIPTION"),angle:false,restoreState:true});n.addItem(i);n.addItem(r);n.addItem(s);return n}babelHelpers.createClass(t,[{key:"getYandexTable",value:function e(){var t=new V({columns:[{id:"title",content:A.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_TABLE_NAME_COLUMN_TITLE")},{id:"id",content:A.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_TABLE_ID_COLUMN_TITLE")}],rows:this.options.events.map(function(e){return{columns:[{content:e.name},{content:e.event}]}})});return t.render()}},{key:"getGoogleTable",value:function e(){var t=new V({columns:[{id:"title",content:A.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_TABLE_NAME_COLUMN_TITLE")},{id:"id",content:A.Loc.getMessage("LANDING_FORM_SETTINGS_ANALYTICS_TABLE_ID_COLUMN_TITLE")}],rows:this.options.events.map(function(e){return{columns:[{content:e.name},{content:e.code}]}})});return t.render()}}]);return t}(M.ContentWrapper);var W="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/fields/images/message-icon.svg";var z=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.FieldsContent");var i=new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_FIELDS_TITLE")});var a=new b.MessageCard({id:"fieldsMessage",header:A.Loc.getMessage("LANDING_FORM_SETTINGS_FIELDS_MESSAGE_TITLE"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_FIELDS_MESSAGE_DESCRIPTION"),icon:W,restoreState:true});var s=new I.FormSettingsForm({fields:[new l.FieldsListField({selector:"fields",isLeadEnabled:n.options.isLeadEnabled,formOptions:babelHelpers.objectSpread({},n.options.formOptions),crmFields:babelHelpers.objectSpread({},n.options.crmFields),items:babelHelpers.toConsumableArray(n.options.values.fields)})]});if(!a.isShown()){s.setOffsetTop(-36)}a.subscribe("onClose",function(){s.setOffsetTop(-36)});n.addItem(i);n.addItem(a);n.addItem(s);return n}return t}(M.ContentWrapper);var Z=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.FieldsRulesContent");n.addItem(n.getHeader());if(!Object.keys(n.options.values).length>0){n.addItem(n.getRuleTypeField())}else{n.addItem(n.getRulesForm());n.addItem(n.getActionPanel());var i=n.options.values.reduce(function(e,t){t.list.forEach(function(t){var i=e.find(function(e){return(e.condition.field===t.condition.target||e.condition.field.id===t.condition.target)&&e.condition.value===t.condition.value&&e.condition.operator===t.condition.operation});if(i){i.expression.push({field:n.options.fields.find(function(e){return e.id===t.action.target}),action:t.action.type})}else{e.push({condition:{field:n.options.fields.find(function(e){return e.name===t.condition.target}),value:t.condition.value,operator:t.condition.operation},expression:[{field:n.options.fields.find(function(e){return e.name===t.action.target}),action:t.action.type}]})}});return e},[]);n.getRulesForm().addField(new c.RuleField({fields:n.options.fields,rules:i,onRemove:n.onFieldRemove.bind(babelHelpers.assertThisInitialized(n))}))}return n}babelHelpers.createClass(t,[{key:"onFieldRemove",value:function e(t){this.getRulesForm().removeField(t.getTarget());this.clear();var n=this.getHeader();n.setBottomMargin(true);this.addItem(n);this.addItem(this.getRuleTypeField())}},{key:"getRulesForm",value:function e(){return this.cache.remember("rulesForm",function(){return new I.FormSettingsForm({selector:"dependencies",description:null})})}},{key:"getActionPanel",value:function e(){return this.cache.remember("actionPanel",function(){return new u.ActionPanel({left:[]})})}},{key:"getHeader",value:function e(){return this.cache.remember("headerCard",function(){return new L.HeaderCard({title:F.Loc.getMessage("LANDING_FIELDS_RULES_TITLE")})})}},{key:"onCreateRule",value:function e(){this.clear();var t=this.getHeader();t.setBottomMargin(false);this.addItem(t);var n=this.getRulesForm();n.addField(new c.RuleField({fields:this.options.fields,rules:[],onRemove:this.onFieldRemove.bind(this)}));this.addItem(n);this.addItem(this.getActionPanel())}},{key:"getRuleTypeField",value:function e(){var t=this;return this.cache.remember("ruleTypeField",function(){return new h.RadioButtonField({selector:"rules-type",items:[{id:"type1",icon:"landing-ui-rules-type1-icon",title:F.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_1"),button:{text:F.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_BUTTON"),onClick:t.onCreateRule.bind(t)}},{id:"type2",icon:"landing-ui-rules-type2-icon",title:F.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_2"),button:{text:F.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_BUTTON"),onClick:t.onCreateRule.bind(t)},disabled:true,soon:true},{id:"type3",icon:"landing-ui-rules-type3-icon",title:F.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_3"),button:{text:F.Loc.getMessage("LANDING_FIELDS_RULES_TYPE_BUTTON"),onClick:t.onCreateRule.bind(t)},disabled:true,soon:true}]})})}},{key:"onAddRuleClick",value:function e(){var t=this.getRuleTypeField();this.insertBefore(t,this.items[this.items.length-1])}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}},{key:"valueReducer",value:function e(t){return{dependencies:Object.values(t).map(function(e){return{typeId:0,list:e.reduce(function(e,t){t.forEach(function(t){t.expression.forEach(function(n){e.push({condition:{target:t.condition.field,event:"change",value:t.condition.value,operation:t.condition.operator},action:{target:n.field,type:n.action,value:""}})})});return e},[])}})}}}]);return t}(M.ContentWrapper);function q(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="'," ","-",'">\n\t\t\t\t<div class="','-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="','-inner">\n\t\t\t\t\t<div class="','-header">\n\t\t\t\t\t\t<span class="','-header-view" onclick="','">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="','-icon"></div>\n\t\t\t\t\t<div class="','-text" onclick="','" oninput="','">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="','-footer">\n\t\t\t\t\t\t<span class="','-footer-edit" onclick="','">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);q=function t(){return e};return e}var Q=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Field.ActionPagesField");n.subscribeFromOptions(d.fetchEventsFromOptions(e));n.setLayoutClass("landing-ui-field-action-pages");F.Dom.append(n.getSuccess(),n.input);F.Dom.append(n.getFailure(),n.input);F.Event.bind(document,"click",n.onDocumentClick.bind(babelHelpers.assertThisInitialized(n)));F.Event.bind(window.top.document,"click",n.onDocumentClick.bind(babelHelpers.assertThisInitialized(n)));return n}babelHelpers.createClass(t,[{key:"onDocumentClick",value:function e(){var t=this.getSuccess().querySelector(".landing-ui-field-action-pages-page-text");var n=this.getFailure().querySelector(".landing-ui-field-action-pages-page-text");F.Dom.attr(t,"contenteditable",null);F.Dom.attr(n,"contenteditable",null)}},{key:"getSuccess",value:function e(){var n=this;return this.cache.remember("success",function(){return t.createPageBlock({type:"success",title:A.Loc.getMessage("LANDING_FORM_ACTIONS_EDIT_SUCCESS_PAGE_TITLE"),text:n.options.successText,onInput:function e(){n.emit("onChange")},onShowClick:function e(){n.emit("onShowSuccess")}})})}},{key:"getFailure",value:function e(){var n=this;return this.cache.remember("failure",function(){return t.createPageBlock({type:"failure",title:A.Loc.getMessage("LANDING_FORM_ACTIONS_EDIT_FAILURE_PAGE_TITLE"),text:n.options.failureText,onInput:function e(){n.emit("onChange")},onShowClick:function e(){n.emit("onShowFailure")}})})}},{key:"getSuccessText",value:function e(){return this.getSuccess().querySelector(".landing-ui-field-action-pages-page-text").innerText}},{key:"getFailureText",value:function e(){return this.getFailure().querySelector(".landing-ui-field-action-pages-page-text").innerText}},{key:"getValue",value:function e(){return{success:this.getSuccessText(),failure:this.getFailureText()}}}],[{key:"createPageBlock",value:function e(t){var n="landing-ui-field-action-pages-page";var i=function e(i){i.preventDefault();i.stopPropagation();var a=i.currentTarget.closest(".".concat(n,"-inner"));var s=a.querySelector(".".concat(n,"-text"));F.Dom.attr(s,"contenteditable",!s.isContentEditable);if(F.Type.isFunction(t.onEditClick)){t.onEditClick(i)}};var a=function e(t){t.stopPropagation()};var s=function e(n){n.preventDefault();if(F.Type.isFunction(t.onShowClick)){t.onShowClick(n)}};return F.Tag.render(q(),n,n,t.type,n,t.title,n,n,n,s,A.Loc.getMessage("LANDING_FORM_ACTIONS_EDIT_PAGE_SHOW"),n,n,a,t.onInput,t.text,n,n,i,A.Loc.getMessage("LANDING_FORM_ACTIONS_EDIT_PAGE_EDIT"))}}]);return t}(S.BaseField);var $="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/actions/images/type1.svg";var J="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/actions/images/type2.svg";var ee=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.ActionsContent");F.Dom.addClass(n.getLayout(),"landing-ui-actions-content-wrapper");n.addItem(n.getHeader());n.addItem(n.getTypeButtons());n.getActionPages().subscribe("onShowSuccess",function(){n.emit("onShowSuccess")}).subscribe("onShowFailure",function(){n.emit("onShowFailure")});return n}babelHelpers.createClass(t,[{key:"getHeader",value:function e(){return this.cache.remember("header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_ACTIONS_TITLE")})})}},{key:"getTypeButtons",value:function e(){var t=this;return this.cache.remember("typeButtons",function(){return new h.RadioButtonField({selectable:true,value:function(){if(F.Type.isStringFilled(t.options.values.success.url)&&F.Type.isStringFilled(t.options.values.failure.url)){return"type2"}return"type1"}(),items:[{id:"type1",title:A.Loc.getMessage("LANDING_FORM_ACTIONS_TYPE_1"),icon:"landing-ui-form-actions-type1"},{id:"type2",title:A.Loc.getMessage("LANDING_FORM_ACTIONS_TYPE_2"),icon:"landing-ui-form-actions-type2"}],onChange:t.onTypeChange.bind(t)})})}},{key:"getCheckbox",value:function e(){return this.cache.remember("checkbox",function(){return new BX.Landing.UI.Field.Checkbox({items:[{name:A.Loc.getMessage("LANDING_FORM_ACTIONS_CHECKBOX_TITLE"),value:true}]})})}},{key:"getTypeDropdown",value:function e(){var t=this;return this.cache.remember("typeDropdown",function(){var e=new g.PresetField({events:{onClick:function e(){t.clear();t.addItem(t.getHeader());t.addItem(t.getTypeButtons())}}});e.setTitle(A.Loc.getMessage("LANDING_FORM_ACTIONS_TYPE_DROPDOWN_TITLE"));e.setIcon($);return e})}},{key:"getSuccessLinkField",value:function e(){var t=this;return this.cache.remember("successLinkField",function(){return new v.TextField({title:A.Loc.getMessage("LANDING_FORM_ACTIONS_SUCCESS_FIELD_TITLE"),placeholder:"http://",textOnly:true,content:t.options.values.success.url,onInput:t.onChange.bind(t)})})}},{key:"getFailureLinkField",value:function e(){var t=this;return this.cache.remember("failureLinkField",function(){return new v.TextField({title:A.Loc.getMessage("LANDING_FORM_ACTIONS_FAILURE_FIELD_TITLE"),placeholder:"http://",textOnly:true,content:t.options.values.failure.url,onInput:t.onChange.bind(t)})})}},{key:"getDelayField",value:function e(){var t=this;return this.cache.remember("delayField",function(){return new BX.Landing.UI.Field.Dropdown({selector:"redirectDelay",title:A.Loc.getMessage("LANDING_FORM_ACTIONS_DELAY_TITLE"),content:t.options.values.redirectDelay,items:Array.from({length:11},function(e,t){return{name:"".concat(t," ").concat(A.Loc.getMessage("LANDING_FORM_ACTIONS_DELAY_ITEM")),value:t}})})})}},{key:"onChange",value:function e(){this.emit("onChange",{skipPrepare:true})}},{key:"getActionPages",value:function e(){var t=this;return this.cache.remember("actionPages",function(){return new Q({successText:t.options.values.success.text,failureText:t.options.values.failure.text,onChange:t.onChange.bind(t)})})}},{key:"onTypeChange",value:function e(t){var n=t.getData();var i=this.getTypeDropdown();this.clear();this.addItem(this.getHeader());this.addItem(i);i.setLinkText(n.item.title.replace(/&nbsp;/," "));if(n.item.id==="type1"){i.setIcon($);this.addItem(this.getActionPages())}if(n.item.id==="type2"){i.setIcon(J);this.addItem(this.getSuccessLinkField());this.addItem(this.getFailureLinkField());this.addItem(this.getDelayField())}}},{key:"getValue",value:function e(){var t=this.getActionPages().getValue();return{result:{success:{text:t.success,url:this.getSuccessLinkField().getValue()},failure:{text:t.failure,url:this.getFailureLinkField().getValue()},redirectDelay:this.getDelayField().getValue()}}}}]);return t}(M.ContentWrapper);function te(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-field-embed-header">\n\t\t\t\t\t<div class="landing-ui-field-embed-header-button">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);te=function t(){return e};return e}var ne=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Field.EmbedField");n.setLayoutClass("landing-ui-field-embed");F.Dom.clean(n.layout);F.Dom.append(n.getHeader(),n.layout);F.Dom.append(n.input,n.layout);F.Event.bind(n.input,"click",n.onInputClick.bind(babelHelpers.assertThisInitialized(n)));return n}babelHelpers.createClass(t,[{key:"getCopyButton",value:function e(){var t=this;return this.cache.remember("copyButton",function(){return new T.Button({text:A.Loc.getMessage("LANDING_FORM_EMBED_COPY_BUTTON_LABEL"),size:T.Button.Size.SMALL,color:T.Button.Color.PRIMARY,onclick:t.onCopyButtonClick.bind(t)})})}},{key:"onCopyButtonClick",value:function e(){this.selectCode();var t=y.PageObject.getRootWindow();t.document.execCommand("copy");t.getSelection().removeAllRanges();var n=this.getCopyButton();n.setColor(T.Button.Color.LINK);n.setIcon(T.Button.Icon.DONE);n.setText(A.Loc.getMessage("LANDING_FORM_EMBED_COPIED_BUTTON_LABEL"));F.Dom.addClass(this.getHeader(),"landing-ui-field-embed-header-copied")}},{key:"onInputClick",value:function e(t){t.preventDefault();this.selectCode()}},{key:"selectCode",value:function e(){y.PageObject.getRootWindow().getSelection().selectAllChildren(this.input)}},{key:"getHeader",value:function e(){var t=this;return this.cache.remember("header",function(){return F.Tag.render(te(),t.getCopyButton().render())})}},{key:"setValue",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";this.input.innerHTML=F.Text.encode(t)}}]);return t}(S.BaseField);function ie(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-filed-widget-wrapper">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);ie=function t(){return e};return e}var ae=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Filed.WidgetField");n.setLayoutClass("landing-ui-filed-widget");F.Dom.append(n.getInputWrapper(),n.layout);return n}babelHelpers.createClass(t,[{key:"getInputWrapper",value:function e(){var t=this;return this.cache.remember("inputWrapper",function(){return F.Tag.render(ie(),t.input,t.getSettingsButton().render())})}},{key:"getSettingsButton",value:function e(){return this.cache.remember("settingsButton",function(){return new T.Button({text:A.Loc.getMessage("LANDING_FORM_EMBED_WIDGET_BUTTON_LABEL"),color:T.Button.Color.LIGHT_BORDER,icon:T.Button.Icon.SETTING})})}}]);return t}(S.BaseField);function se(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-field-copy-link-preview">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);se=function t(){return e};return e}var re=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setLayoutClass("landing-ui-field-copy-link");F.Dom.clean(n.layout);F.Dom.append(n.getLink(),n.layout);F.Dom.append(n.getCopyButton().render(),n.layout);return n}babelHelpers.createClass(t,[{key:"getLink",value:function e(){var t=this;return this.cache.remember("link",function(){var e=new m.Link({text:t.options.link,href:t.options.link,target:"_blank"});return F.Tag.render(se(),e.getLayout())})}},{key:"getCopyButton",value:function e(){var t=this;return this.cache.remember("copyButton",function(){return new T.Button({color:T.Button.Color.PRIMARY,size:T.Button.Size.SMALL,text:A.Loc.getMessage("LANDING_FORM_EMBED_PUB_COPY_LINK_BUTTON_LABEL"),onclick:t.onCopyButtonClick.bind(t)})})}},{key:"selectCode",value:function e(){y.PageObject.getRootWindow().getSelection().selectAllChildren(this.getLink())}},{key:"onCopyButtonClick",value:function e(){this.selectCode();var t=y.PageObject.getRootWindow();t.document.execCommand("copy");t.getSelection().removeAllRanges();var n=this.getCopyButton();n.setColor(T.Button.Color.LINK);n.setIcon(T.Button.Icon.DONE);n.setText(A.Loc.getMessage("LANDING_FORM_EMBED_PUB_COPIED_LINK_BUTTON_LABEL"))}}]);return t}(S.BaseField);function oe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-position-fields-inner"></div>\n\t\t\t']);oe=function t(){return e};return e}var le=function(e){babelHelpers.inherits(t,e);function t(){var e;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,n));e.horizontal=new BX.Landing.UI.Field.Dropdown({selector:"horizontal",value:n.value.horizontal,items:[{name:A.Loc.getMessage("LANDING_FORM_EMBED_POSITION_LEFT"),value:"left"},{name:A.Loc.getMessage("LANDING_FORM_EMBED_POSITION_CENTER"),value:"center"},{name:A.Loc.getMessage("LANDING_FORM_EMBED_POSITION_RIGHT"),value:"right"}]});e.vertical=new BX.Landing.UI.Field.Dropdown({selector:"vertical",value:n.value.vertical,items:[{name:A.Loc.getMessage("LANDING_FORM_EMBED_POSITION_TOP"),value:"top"},{name:A.Loc.getMessage("LANDING_FORM_EMBED_POSITION_BOTTOM"),value:"bottom"}]});e.horizontal.subscribe("onChange",function(){e.emit("onChange")});e.vertical.subscribe("onChange",function(){e.emit("onChange")});var i=e.getFieldsInner();F.Dom.append(e.horizontal.getLayout(),i);F.Dom.append(e.vertical.getLayout(),i);F.Dom.replace(e.input,i);return e}babelHelpers.createClass(t,[{key:"getFieldsInner",value:function e(){return this.cache.remember("fieldsInner",function(){return F.Tag.render(oe())})}},{key:"getValue",value:function e(){return{vertical:this.vertical.getValue(),horizontal:this.horizontal.getValue()}}},{key:"setValue",value:function e(t){this.vertical.setValue(t.vertical);this.horizontal.setValue(t.horizontal)}}]);return t}(S.BaseField);var ce="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type1.svg";var ue="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type2.svg";var de="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type3.svg";var ge="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type4.svg";var pe="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type5.svg";var me="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/embed/images/type6.svg";var he=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.EmbedContent");F.Dom.addClass(n.getLayout(),"landing-ui-embed-content-wrapper");n.addItem(n.getHeader());n.addItem(n.getTypeButtons());return n}babelHelpers.createClass(t,[{key:"getHeader",value:function e(){return this.cache.remember("header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_EMBED_TITLE")})})}},{key:"getTypeButtons",value:function e(){var t=this;return this.cache.remember("typeButtons",function(){return new h.RadioButtonField({title:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_FIELD_TITLE"),items:[1,3,4,2,5,6].map(function(e){return{id:"type".concat(e),title:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_".concat(e)),icon:"landing-ui-form-embed-type".concat(e),soon:[2,5,6].includes(e),disabled:[2,5,6].includes(e)}}),onChange:t.onTypeChange.bind(t),selectable:false})})}},{key:"getTypeDropdown",value:function e(){var t=this;return this.cache.remember("typeDropdown",function(){var e=new g.PresetField({events:{onClick:function e(){t.clear();t.addItem(t.getHeader());t.addItem(t.getTypeButtons())}}});e.setTitle(A.Loc.getMessage("LANDING_FORM_ACTIONS_TYPE_DROPDOWN_TITLE"));return e})}},{key:"getType1Message",value:function e(){return this.cache.remember("type1Message",function(){return new b.MessageCard({header:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_1_MESSAGE_TITLE"),description:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_1_MESSAGE_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"getType3Message",value:function e(){return this.cache.remember("type3Message",function(){return new b.MessageCard({header:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_3_MESSAGE_TITLE"),description:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_3_MESSAGE_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"getType4Message",value:function e(){return this.cache.remember("type4Message",function(){return new b.MessageCard({header:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_4_MESSAGE_TITLE"),description:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_4_MESSAGE_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"getType5Message",value:function e(){return this.cache.remember("type5Message",function(){return new b.MessageCard({header:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_4_MESSAGE_TITLE"),description:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_4_MESSAGE_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"getType8Message",value:function e(){return this.cache.remember("type8Message",function(){return new b.MessageCard({header:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_8_MESSAGE_TITLE"),description:A.Loc.getMessage("LANDING_FORM_EMBED_TYPE_8_MESSAGE_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"getEmbedField",value:function e(){return this.cache.remember("embedField",function(){return new ne({})})}},{key:"getType2Header",value:function e(){return this.cache.remember("type2header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_EMBED_LINK_SETTINGS_HEADER"),level:2})})}},{key:"getType3Header",value:function e(){return this.cache.remember("type3header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_EMBED_CLICK_SETTINGS_HEADER"),level:2,description:A.Loc.getMessage("LANDING_FORM_EMBED_SHOW_SETTINGS_DESCRIPTION")})})}},{key:"getType4Header",value:function e(){return this.cache.remember("type4header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_EMBED_AUTO_SHOW_SETTINGS_HEADER"),level:2,description:A.Loc.getMessage("LANDING_FORM_EMBED_SHOW_SETTINGS_DESCRIPTION")})})}},{key:"getLinkTextField",value:function e(){return this.cache.remember("linkTextField",function(){return new p.VariablesField({title:A.Loc.getMessage("LANDING_FORM_EMBED_LINK_TEXT_SETTINGS_FIELD_TITLE"),variables:[{name:"Test",value:"test"}]})})}},{key:"getType4Checkbox",value:function e(){var t=this;return this.cache.remember("type4checkbox",function(){var e=new BX.Landing.UI.Field.Radio({items:[{name:A.Loc.getMessage("LANDING_FORM_EMBED_SHOW_AFTER_PAGE_LOADED"),value:"pageLoaded"},{html:A.Loc.getMessage("LANDING_FORM_EMBED_SHOW_AFTER_TIME"),value:"afterTime"}],value:function(){if(t.options.values.views.auto.delay>0){return["afterTime"]}return["pageLoaded"]}()});F.Dom.replace(e.layout.querySelector(".delay_time"),t.getDelayDropdown().getLayout());return e})}},{key:"getWidgetField",value:function e(){return this.cache.remember("widgetField",function(){return new ae({title:A.Loc.getMessage("LANDING_FORM_EMBED_WIDGET_FIELD_TITLE"),placeholder:A.Loc.getMessage("LANDING_FORM_EMBED_WIDGET_FIELD_PLACEHOLDER")})})}},{key:"getCopyLinkField",value:function e(){return this.cache.remember("copyLinkField",function(){return new re({link:"https://bitrix24.io/pub/my/form/link"})})}},{key:"getDelayDropdown",value:function e(){var t=this;return this.cache.remember("delayDropdown",function(){return new BX.Landing.UI.Field.DropdownInline({selector:"showDelay",content:t.options.values.views.auto.delay,items:[{name:"5c",value:"5"},{name:"10c",value:"10"},{name:"15c",value:"15"}],onChange:t.onChange.bind(t),skipInitialEvent:true})})}},{key:"getType3PositionField",value:function e(){var t=this;return this.cache.remember("type3PositionField",function(){return new le({title:A.Loc.getMessage("LANDING_FORM_EMBED_POSITION_FIELD_TITLE"),value:{vertical:t.options.values.views.click.vertical,horizontal:t.options.values.views.click.position}})})}},{key:"getType4PositionField",value:function e(){var t=this;return this.cache.remember("type4PositionField",function(){return new le({title:A.Loc.getMessage("LANDING_FORM_EMBED_POSITION_FIELD_TITLE"),value:{vertical:t.options.values.views.auto.vertical,horizontal:t.options.values.views.auto.position}})})}},{key:"getType3ShowTypeField",value:function e(){var t=this;return this.cache.remember("type3ShowTypeField",function(){return new BX.Landing.UI.Field.Dropdown({title:A.Loc.getMessage("LANDING_FORM_EMBED_SHOW_TYPE"),selector:"type",items:[{name:A.Loc.getMessage("LANDING_FORM_EMBED_SHOW_POPUP"),value:"popup"},{name:A.Loc.getMessage("LANDING_FORM_EMBED_SHOW_SLIDER"),value:"panel"}],content:t.options.values.views.click.type})})}},{key:"getType4ShowTypeField",value:function e(){var t=this;return this.cache.remember("type4ShowTypeField",function(){return new BX.Landing.UI.Field.Dropdown({title:A.Loc.getMessage("LANDING_FORM_EMBED_SHOW_TYPE"),selector:"type",items:[{name:A.Loc.getMessage("LANDING_FORM_EMBED_SHOW_POPUP"),value:"popup"},{name:A.Loc.getMessage("LANDING_FORM_EMBED_SHOW_SLIDER"),value:"panel"}],content:t.options.values.views.auto.type})})}},{key:"onTypeChange",value:function e(t){var n=t.getData();var i=this.getTypeDropdown();if(/type[1-6]$/.test(n.item.id)){this.clear();this.addItem(this.getHeader());this.addItem(i)}i.setLinkText(n.item.title.replace(/&nbsp;/," "));var a=this.getEmbedField();if(n.item.id==="type1"){i.setIcon(ce);this.addItem(this.getType1Message());a.setValue(this.options.values.scripts.inline.text);this.addItem(a)}if(n.item.id==="type2"){i.setIcon(ue);a.setValue(this.options.values.scripts.click.text);this.addItem(a)}if(n.item.id==="type3"){i.setIcon(de);a.setValue(this.options.values.scripts.click.text);var s=this.getType3PositionField();s.setValue({vertical:this.options.values.views.click.vertical,horizontal:this.options.values.views.click.position});this.addItem(this.getType3Message());this.addItem(this.getType3Header());this.addItem(s);this.addItem(this.getType3ShowTypeField());this.addItem(a)}if(n.item.id==="type4"){i.setIcon(ge);this.addItem(this.getType4Message());this.addItem(this.getType4Header());this.addItem(this.getType4Checkbox());var r=this.getType4PositionField();r.setValue({vertical:this.options.values.views.auto.vertical,horizontal:this.options.values.views.auto.position});this.addItem(r);this.addItem(this.getType4ShowTypeField());a.setValue(this.options.values.scripts.auto.text);this.addItem(a)}if(n.item.id==="type5"){i.setIcon(pe);this.addItem(this.getType5Message());this.addItem(this.getWidgetField());a.setValue(this.options.values.scripts.auto.text);this.addItem(a)}if(n.item.id==="type6"){i.setIcon(me);this.addItem(this.getCopyLinkField())}}},{key:"onChange",value:function e(t){this.emit("onChange",{skipPrepare:true})}},{key:"getValue",value:function e(){var t=this;var n=this.getType3PositionField().getValue();var i=this.getType4PositionField().getValue();return{embedding:{views:{auto:{delay:function(){if(t.getType4Checkbox().getValue().includes("pageLoaded")){return 0}return t.getDelayDropdown().getValue()}(),position:n.horizontal,vertical:n.vertical,type:this.getType4ShowTypeField().getValue()},click:{position:i.horizontal,vertical:i.vertical,type:this.getType3ShowTypeField().getValue()}}}}}}]);return t}(M.ContentWrapper);var _e="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/identify/images/icon.svg";var Te=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.Identify");var i=new L.HeaderCard({title:A.Loc.getMessage("LANDING_IDENTIFY_HEADER")});var a=new b.MessageCard({header:A.Loc.getMessage("LANDING_IDENTIFY_MESSAGE_HEADER"),description:A.Loc.getMessage("LANDING_IDENTIFY_MESSAGE_DESCRIPTION"),icon:_e,angle:false,closeable:false,hideActions:true});n.addItem(i);n.addItem(a);return n}return t}(M.ContentWrapper);function fe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-field-order-wrapper">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t"]);fe=function t(){return e};return e}var Ee=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));F.Dom.replace(n.input,n.getWrapper());return n}babelHelpers.createClass(t,[{key:"getDropdown",value:function e(){var t=this;return this.cache.remember("dropdown",function(){return new BX.Landing.UI.Field.Dropdown({items:t.options.items})})}},{key:"getButton",value:function e(){var t=this;return this.cache.remember("button",function(){return new T.Button({text:A.Loc.getMessage("LANDING_FORM_SETTINGS_ORDER_SETTINGS_BUTTON_LABEL"),color:T.Button.Color.LIGHT_BORDER,size:T.Button.Size.MEDIUM,events:{click:t.onButtonClick.bind(t)}})})}},{key:"onButtonClick",value:function e(){var t=this.getDropdown().getValue();var n="/crm/company/details/".concat(t,"/?init_mode=edit");window.open(n,"_blank")}},{key:"getWrapper",value:function e(){var t=this;return this.cache.remember("wrapper",function(){return F.Tag.render(fe(),t.getDropdown().getLayout(),t.getButton().render())})}}]);return t}(S.BaseField);function be(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-field-stages">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"]);be=function t(){return e};return e}var Le=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));F.Dom.replace(n.input,n.getInner());return n}babelHelpers.createClass(t,[{key:"getInner",value:function e(){var t=this;return this.cache.remember("inner",function(){return F.Tag.render(be(),t.getCategoriesDropdown().getLayout())})}},{key:"getCategoriesDropdown",value:function e(){var t=this;return this.cache.remember("categoriesDropdown",function(){return new BX.Landing.UI.Field.Dropdown({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CATEGORIES_FIELD_TITLE"),content:t.options.value.category,items:t.options.categories.map(function(e){return{name:e.NAME,value:e.ID}}),onChange:t.onCategoryChange.bind(t)})})}},{key:"getCurrentCategory",value:function e(){var t=this.getCategoriesDropdown().getValue();return this.options.categories.find(function(e){return String(e.ID)===String(t)})}},{key:"onCategoryChange",value:function e(){var t=this.getStagesDropdown();this.cache.delete("stagesDropdown");if(t.popup){t.popup.destroy()}var n=this.getStagesDropdown();F.Dom.replace(t.getLayout(),n.getLayout());this.emit("onChange")}},{key:"getStagesDropdown",value:function e(){var t=this;return this.cache.remember("stagesDropdown",function(){var e=t.getCurrentCategory().STAGES;return new BX.Landing.UI.Field.Dropdown({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_STAGES_FIELD_TITLE"),items:e.map(function(e){return{name:e.NAME,value:e.ID}})})})}},{key:"getValue",value:function e(){return{category:this.getCategoriesDropdown().getValue(),stage:this.getStagesDropdown().getValue()}}}]);return t}(S.BaseField);var Ie="/bitrix/js/landing/ui/panel/formsettingspanel/dist/internal/content/crm/images/message-icon.svg";var ve=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.CrmContent");n.addItem(n.getHeader());n.addItem(n.getTypesField());n.addItem(n.getExpertSettingsForm());n.addItem(n.getOrderSettingsForm());return n}babelHelpers.createClass(t,[{key:"getHeader",value:function e(){return this.cache.remember("header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TITLE")})})}},{key:"getDuplicatesField",value:function e(){var t=this;return this.cache.remember("duplicatesField",function(){return new BX.Landing.UI.Field.Radio({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_DUPLICATES_FIELD_TITLE"),selector:"duplicateMode",value:[t.options.values.duplicateMode?t.options.values.duplicateMode:"ALLOW"],items:[{name:A.Loc.getMessage("LANDING_FORM_SETTINGS_DUPLICATES_ALLOW"),value:"ALLOW"},{name:A.Loc.getMessage("LANDING_FORM_SETTINGS_DUPLICATES_REPLACE"),value:"REPLACE"},{name:A.Loc.getMessage("LANDING_FORM_SETTINGS_DUPLICATES_MERGE"),value:"MERGE"}]})})}},{key:"getPaymentField",value:function e(){var t=this;return this.cache.remember("paymentField",function(){return new BX.Landing.UI.Field.Checkbox({selector:"payment",value:[t.options.values.payment],items:[{name:A.Loc.getMessage("LANDING_FORM_SETTINGS_ORDER_SHOW_PAYMENT"),value:true}]})})}},{key:"getOrderSettingsForm",value:function e(){var t=this;return this.cache.remember("formSettingsForm",function(){return new I.FormSettingsForm({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_ORDER_HEADER"),toggleable:true,opened:F.Text.toNumber(t.options.values.scheme)>4,fields:[t.getPaymentField(),new b.MessageCard({id:"orderMessage",header:A.Loc.getMessage("LANDING_FORM_SETTINGS_ORDER_MESSAGE_HEADER"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_ORDER_MESSAGE_DESCRIPTION"),angle:false,icon:Ie,restoreState:true})]})})}},{key:"getType1Header",value:function e(){return this.cache.remember("type1header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_1").replace("&nbsp;"," "),level:2})})}},{key:"getType2Header",value:function e(){return this.cache.remember("type2header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_2").replace("&nbsp;"," "),level:2})})}},{key:"getType3Header",value:function e(){return this.cache.remember("type3header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_3").replace("&nbsp;"," "),level:2})})}},{key:"getType4Header",value:function e(){return this.cache.remember("type4header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_4").replace("&nbsp;"," "),level:2})})}},{key:"getExpertSettingsForm",value:function e(){var t=this;return this.cache.remember("expertSettingsForm",function(){return new I.FormSettingsForm({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_EXPERT_MODE"),toggleable:true,toggleableType:I.FormSettingsForm.ToggleableType.Link,opened:false,fields:[new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_1").replace("&nbsp;"," "),level:2}),t.getDuplicatesField()]})})}},{key:"getTypesField",value:function e(){var t=this;return this.cache.remember("typesField",function(){setTimeout(function(){t.onTypeChange(new N.BaseEvent({data:{item:{id:t.options.values.scheme}}}))});var e=[{id:"2",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_2"),icon:"landing-ui-crm-entity-type2"},{id:"3",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_3"),icon:"landing-ui-crm-entity-type3"},{id:"4",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_4"),icon:"landing-ui-crm-entity-type4"}];if(t.options.isLeadEnabled){e.unshift({id:"1",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_TYPE_1"),icon:"landing-ui-crm-entity-type1"})}return new h.RadioButtonField({selector:"scheme",value:function(){if(String(t.options.values.scheme)==="8"){return 1}if(String(t.options.values.scheme)==="5"){return 2}if(String(t.options.values.scheme)==="6"){return 3}if(String(t.options.values.scheme)==="7"){return 4}return t.options.values.scheme}(),items:e,onChange:t.onTypeChange.bind(t)})})}},{key:"getStagesField",value:function e(){var t=this;return this.cache.remember("stagesField",function(){return new Le({categories:t.options.categories,value:{category:t.options.values.category}})})}},{key:"getDuplicatesEnabledField",value:function e(){var t=this;return this.cache.remember("duplicatesEnabledField",function(){return new BX.Landing.UI.Field.Checkbox({selector:"duplicatesEnabled",compact:true,value:[t.options.values.duplicatesEnabled],items:[{name:A.Loc.getMessage("LANDING_FORM_SETTINGS_CRM_DUPLICATES_ENABLED"),value:true}]})})}},{key:"onTypeChange",value:function e(t){var n=t.getData(),i=n.item;this.clear();this.addItem(this.getHeader());this.addItem(this.getTypesField());var a=this.getExpertSettingsForm();a.clear();if(String(i.id)==="1"||String(i.id)==="8"){a.addField(this.getType1Header());a.addField(this.getDuplicatesField())}if(String(i.id)==="2"||String(i.id)==="5"){a.addField(this.getType2Header());a.addField(this.getDuplicatesField())}if(String(i.id)==="3"||String(i.id)==="6"){a.addField(this.getType3Header());a.addField(this.getStagesField());a.addField(this.getDuplicatesEnabledField());a.addField(this.getDuplicatesField())}if(String(i.id)==="4"||String(i.id)==="7"){a.addField(this.getType4Header());a.addField(this.getDuplicatesField())}if(F.Text.toNumber(i.id)>4||this.getOrderSettingsForm().isOpened()){this.getOrderSettingsForm().onSwitchChange(true)}this.addItem(a);this.addItem(this.getOrderSettingsForm())}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}},{key:"valueReducer",value:function e(t){var n=this.getDuplicatesField().getValue()[0];var i={duplicateMode:n==="ALLOW"?"":n,scheme:this.getTypesField().getValue(),deal:{duplicatesEnabled:F.Text.toBoolean(this.getDuplicatesEnabledField().getValue()[0])},payment:{use:this.getPaymentField().getValue().length>0}};if(this.getOrderSettingsForm().isOpened()){if(String(i.scheme)==="1"){i.scheme="8"}if(String(i.scheme)==="2"){i.scheme="5"}if(String(i.scheme)==="3"){i.scheme="6"}if(String(i.scheme)==="4"){i.scheme="7"}}if(String(i.scheme)==="3"||String(i.scheme)==="6"){i.deal.category=this.getStagesField().getValue().category}return{document:i}}}]);return t}(M.ContentWrapper);var Ne=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.DefaultValues");var i=new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_DEFAULT_VALUE_TITLE")});var a=new b.MessageCard({id:"defaultValueMessage",header:A.Loc.getMessage("LANDING_FORM_SETTINGS_DEFAULT_VALUE_MESSAGE_TITLE"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_DEFAULT_VALUE_MESSAGE_DESCRIPTION"),restoreState:true});var s=new I.FormSettingsForm({fields:[new _.DefaultValueField({selector:"presetFields",isLeadEnabled:n.options.isLeadEnabled,personalizationVariables:n.options.personalizationVariables,formOptions:babelHelpers.objectSpread({},n.options.formOptions),crmFields:babelHelpers.objectSpread({},n.options.crmFields),dictionary:babelHelpers.objectSpread({},n.options.dictionary),items:babelHelpers.toConsumableArray(n.options.values.fields)})]});if(!a.isShown()){s.setOffsetTop(-36)}a.subscribe("onClose",function(){s.setOffsetTop(-36)});n.addItem(i);n.addItem(a);n.addItem(s);return n}babelHelpers.createClass(t,[{key:"getLayout",value:function e(){var n=babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"getLayout",this).call(this);F.Dom.addClass(n,"landing-ui-default-fields-values");return n}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var Se=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.FacebookContent");var i=new L.HeaderCard({title:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_FACEBOOK")});var a=new f.BaseCard;var s=new T.Button({text:n.prepareButtonText(n.options.formOptions),color:T.Button.Color.LIGHT_BORDER,onclick:function e(){BX.SidePanel.Instance.open("/crm/webform/ads/".concat(n.options.formOptions.id,"/?type=facebook"),{cacheable:false,events:{onClose:function e(){var t=E.FormClient.getInstance();t.resetCache(n.options.formOptions.id);t.getOptions(n.options.formOptions.id).then(function(e){s.setText(n.prepareButtonText(e))})}}})}});F.Dom.style(a.getLayout(),{padding:0,margin:0});F.Dom.append(s.render(),a.getBody());n.addItem(i);n.addItem(a);return n}babelHelpers.createClass(t,[{key:"prepareButtonText",value:function e(t){var n=t.integration.cases.some(function(e){return e.providerCode==="facebook"});if(n){return A.Loc.getMessage("LANDING_FORM_SETTINGS_FACEBOOK_BUTTON_ENABLED")}return A.Loc.getMessage("LANDING_FORM_SETTINGS_FACEBOOK_BUTTON")}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var Ce=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.VkContent");var i=new L.HeaderCard({title:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_VK")});var a=new f.BaseCard;var s=new T.Button({text:n.prepareButtonText(n.options.formOptions),color:T.Button.Color.LIGHT_BORDER,onclick:function e(){BX.SidePanel.Instance.open("/crm/webform/ads/".concat(n.options.formOptions.id,"/?type=vkontakte"),{cacheable:false,events:{onClose:function e(){var t=E.FormClient.getInstance();t.resetCache(n.options.formOptions.id);t.getOptions(n.options.formOptions.id).then(function(e){s.setText(n.prepareButtonText(e))})}}})}});F.Dom.style(a.getLayout(),{padding:0,margin:0});F.Dom.append(s.render(),a.getBody());n.addItem(i);n.addItem(a);return n}babelHelpers.createClass(t,[{key:"prepareButtonText",value:function e(t){var n=t.integration.cases.some(function(e){return e.providerCode==="vkontakte"});if(n){return A.Loc.getMessage("LANDING_FORM_SETTINGS_VK_BUTTON_ENABLED")}return A.Loc.getMessage("LANDING_FORM_SETTINGS_VK_BUTTON")}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var ye=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.Callback");n.addItem(n.getHeader());if(!n.isAvailable()){n.addItem(n.getWarningMessage());n.getSettingsForm().disable()}n.addItem(n.getSettingsForm());return n}babelHelpers.createClass(t,[{key:"getHeader",value:function e(){return this.cache.remember("header",function(){return new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CALLBACK_TITLE")})})}},{key:"getWarningMessage",value:function e(){return this.cache.remember("warningMessage",function(){return new b.MessageCard({header:A.Loc.getMessage("LANDING_FORM_CALLBACK_WARNING_HEADER"),description:A.Loc.getMessage("LANDING_FORM_CALLBACK_WARNING_TEXT"),angle:false,closeable:false,hideActions:true})})}},{key:"isAvailable",value:function e(){var t=this;return this.cache.remember("isAvailable",function(){return t.options.dictionary.callback.from.length>0})}},{key:"getSettingsForm",value:function e(){var t=this;return this.cache.remember("settingsForm",function(){return new I.FormSettingsForm({title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CALLBACK_USE_CHECKBOX_LABEL"),toggleable:true,toggleableType:I.FormSettingsForm.ToggleableType.Switch,opened:t.isAvailable()&&F.Text.toBoolean(t.options.values.use),fields:[t.getPhoneListField(),t.getTextField()]})})}},{key:"getUseCheckboxField",value:function e(){var t=this;return this.cache.remember("useCheckboxField",function(){return new BX.Landing.UI.Field.Checkbox({selector:"use",compact:true,value:[F.Text.toBoolean(t.options.values.use)],items:[{name:A.Loc.getMessage("LANDING_FORM_SETTINGS_CALLBACK_USE_CHECKBOX_LABEL"),value:true}]})})}},{key:"getPhoneListField",value:function e(){var t=this;return this.cache.remember("phoneListField",function(){return new BX.Landing.UI.Field.Dropdown({selector:"from",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CALLBACK_PHONE_TITLE"),content:t.options.values.from,items:[{name:A.Loc.getMessage("LANDING_FORM_DEFAULT_PHONE_NOT_SELECTED"),value:""}].concat(babelHelpers.toConsumableArray(t.options.dictionary.callback.from.map(function(e){return{name:e.name,value:e.id}})))})})}},{key:"getTextField",value:function e(){var t=this;return this.cache.remember("textField",function(){return new v.TextField({selector:"text",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_CALLBACK_TEXT_TITLE"),content:t.options.values.text,textOnly:true})})}},{key:"valueReducer",value:function e(t){return{callback:babelHelpers.objectSpread({},t,{use:this.getSettingsForm().isOpened()})}}},{key:"onChange",value:function e(t){this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var Fe=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));F.Dom.removeClass(n.input,"landing-ui-field-input");n.getTagSelector().renderTo(n.input);return n}babelHelpers.createClass(t,[{key:"getTagSelector",value:function e(){var t=this;return this.cache.remember("tagSelector",function(){var e=y.PageObject.getRootWindow();return new e.BX.UI.EntitySelector.TagSelector({id:"user-selector",dialogOptions:{id:"user-selector",entities:[{id:"user",options:{activeUsers:true}}],preselectedItems:t.options.value,events:{"Item:onSelect":function e(){t.emit("onChange",{skipPrepare:true})},"Item:onDeselect":function e(){t.emit("onChange",{skipPrepare:true})}}}})})}},{key:"getValue",value:function e(){return this.getTagSelector().getDialog().getSelectedItems().map(function(e){return e.id})}}]);return t}(S.BaseField);var De=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel.SpamProtection");var i=new L.HeaderCard({title:A.Loc.getMessage("LANDING_FORM_OTHER_TITLE")});var a=new I.FormSettingsForm({id:"other",description:null,fields:[n.getNameField(),n.getUserSelectorField(),n.getUseSignField()]});n.addItem(i);n.addItem(a);return n}babelHelpers.createClass(t,[{key:"canRemoveCopyrights",value:function e(){return this.options.dictionary.sign.canRemove}},{key:"getNameField",value:function e(){var t=this;return this.cache.remember("nameField",function(){return new v.TextField({title:A.Loc.getMessage("LANDING_FORM_OTHER_TITLE_NAME_TITLE"),selector:"name",textOnly:true,content:t.options.values.name})})}},{key:"getUseSignField",value:function e(){var t=this;return this.cache.remember("useSignField",function(){return new BX.Landing.UI.Field.Checkbox({selector:"useSign",value:t.options.values.useSign?["useSign"]:[],items:[{value:"useSign",html:"".concat(A.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_SHOW_SIGN")).concat(t.createCopyRight())}],compact:true})})}},{key:"getUserSelectorField",value:function e(){var t=this;return this.cache.remember("userSelectorField",function(){return new Fe({selector:"users",title:A.Loc.getMessage("LANDING_CRM_FORM_USER"),value:t.options.values.users.reduce(function(e,t){if(F.Type.isStringFilled(t)||F.Type.isNumber(t)){e.push(["user",t])}return e},[])})})}},{key:"createCopyRight",value:function e(){return'\n\t\t\t<span class="landing-ui-signin">\n\t\t\t\t<span class="landing-ui-sign">'.concat(A.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_BUTTONS_SIGN"),'</span>\n\t\t\t\t<span class="landing-ui-sign-in">').concat(A.Loc.getMessage("LANDING_HEADER_AND_BUTTONS_BUTTONS_SIGN_BY"),'</span>\n\t\t\t\t<span class="landing-ui-sign-24">24</span>\n\t\t\t</span>\n\t\t')}},{key:"valueReducer",value:function e(t){return{name:t.name,data:{useSign:t.useSign.includes("useSign")},responsible:{users:t.users}}}},{key:"onChange",value:function e(t){if(!this.canRemoveCopyrights()){var n=this.getUseSignField();if(!n.getValue().includes("useSign")){n.setValue(["useSign"]);if(F.Type.isStringFilled(this.options.dictionary.restriction.helper)){var i=F.Reflection.getClass("BX.evalGlobal");if(F.Type.isFunction(i)){i(this.options.dictionary.restriction.helper)}}}}this.emit("onChange",babelHelpers.objectSpread({},t.getData(),{skipPrepare:true}))}}]);return t}(M.ContentWrapper);var Ae=[new D.SidebarButton({id:"fields",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_FIELDS"),child:true}),new D.SidebarButton({id:"agreements",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_AGREEMENT"),child:true,important:true}),new D.SidebarButton({id:"crm",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_ENTITY"),child:true}),new D.SidebarButton({id:"identify",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_CLIENT_IDENTIFY"),child:true}),new D.SidebarButton({id:"button_and_header",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_HEADER_AND_BUTTON"),child:true}),new D.SidebarButton({id:"spam_protection",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_SPAM_PROTECTION"),child:true}),new D.SidebarButton({id:"fields_rules",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_FIELDS_RULES"),child:true}),new D.SidebarButton({id:"actions",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_ACTIONS"),child:true}),new D.SidebarButton({id:"default_values",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_DEFAULT_VALUES"),child:true}),new D.SidebarButton({id:"analytics",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_DEFAULT_ANALYTICS"),child:true}),new D.SidebarButton({id:"facebook",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_FACEBOOK"),child:true}),new D.SidebarButton({id:"vk",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_VK"),child:true}),new D.SidebarButton({id:"callback",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CALLBACK"),child:true}),new D.SidebarButton({id:"embed",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_CRM_EMBED"),child:true}),new D.SidebarButton({id:"more",text:A.Loc.getMessage("LANDING_FORM_SETTINGS_MORE_BUTTON_TEXT"),className:"landing-ui-button-sidebar-more",child:true}),new D.SidebarButton({id:"other",text:A.Loc.getMessage("LANDING_SIDEBAR_BUTTON_OTHER"),child:true})];var Me=[new M.PresetCategory({id:"crm",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CATEGORY_CRM")}),new M.PresetCategory({id:"products",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CATEGORY_PRODUCTS")}),new M.PresetCategory({id:"social",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CATEGORY_SOCIAL")}),new M.PresetCategory({id:"crm_automation",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CATEGORY_CRM_AUTOMATION")})];var Oe="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/integration.svg";var Re="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/autoshow.svg";var ke="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/revertcall.svg";var Be="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/producttext.svg";var Ge="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/productimage.svg";var Pe="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/vk.svg";var He="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/facebook.svg";var we="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/crm.svg";var Ue="/bitrix/js/landing/ui/panel/formsettingspanel/dist/images/icons/service.svg";var xe=[new M.Preset({id:"contacts",category:"crm",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS_DESCRIPTION"),icon:Oe,items:["fields","agreements","crm","embed","other"],options:{templateId:"contacts",name:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS"),agreements:{use:true},data:{title:"",desc:"",buttonCaption:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS_BUTTON"),fields:[{name:"LEAD_NAME"},{name:"LEAD_LAST_NAME"},{name:"LEAD_PHONE"},{name:"LEAD_EMAIL"}],agreements:[{checked:true}],dependencies:[],recaptcha:{use:false}},captcha:{key:"",secret:""},result:{success:{text:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS_SUCCESS_TEXT")},failure:{text:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CONTACTS_FAILURE_TEXT")}},document:{scheme:1}}}),new M.Preset({id:"feedback",category:"crm",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_DESCRIPTION"),icon:Re,items:["fields","agreements","crm","embed","other"],options:{templateId:"feedback",name:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK"),agreements:{use:true},data:{title:"",desc:"",buttonCaption:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_BUTTON"),fields:[{name:"LEAD_NAME"},{name:"LEAD_PHONE"},{name:"LEAD_EMAIL"},{name:"LEAD_COMMENTS"}],agreements:[{checked:true}],dependencies:[],recaptcha:{use:false}},captcha:{key:"",secret:""},result:{success:{text:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_SUCCESS_TEXT")},failure:{text:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_FAILURE_TEXT")}},document:{scheme:1}}}),new M.Preset({id:"callback",category:"crm",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK_DESCRIPTION"),icon:ke,defaultSection:"callback",items:["fields","agreements","crm","embed","callback","other"],options:{templateId:"callback",name:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK"),agreements:{use:true},data:{title:"",desc:"",buttonCaption:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK_BUTTON"),fields:[{name:"LEAD_PHONE"}],agreements:[{checked:true}],dependencies:[],recaptcha:{use:false}},captcha:{key:"",secret:""},result:{success:{text:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK_SUCCESS_TEXT")},failure:{text:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_CALLBACK_FAILURE_TEXT")}},document:{scheme:1}}}),new M.Preset({id:"expert",category:"crm",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_EXPERT"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_EXPERT_DESCRIPTION"),icon:Ue,items:["fields","agreements","crm","identify","button_and_header","spam_protection","fields_rules","actions","default_values","analytics","facebook","vk","callback","embed","other"],options:{templateId:"expert",name:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_EXPERT"),agreements:{use:true},result:{success:{text:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_SUCCESS_TEXT")},failure:{text:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FEEDBACK_FAILURE_TEXT")}}}}),new M.Preset({id:"products_small",category:"products",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCTS_SMALL"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCTS_SMALL_DESCRIPTION"),icon:Be,items:["analytics","embed","other"],disabled:true,soon:true}),new M.Preset({id:"products_big",category:"products",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCTS_BIG"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PRODUCTS_BIG_DESCRIPTION"),icon:Ge,items:["identify","button_and_header","other"],disabled:true,soon:true}),new M.Preset({id:"vk",category:"social",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_VK"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_VK_DESCRIPTION"),icon:Pe,items:["fields","embed","other"],disabled:true,soon:true}),new M.Preset({id:"facebook",category:"social",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FB"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_FB_DESCRIPTION"),icon:He,items:["embed","other"],disabled:true,soon:true}),new M.Preset({id:"personalisation",category:"crm_automation",title:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PERSONALIZATION"),description:A.Loc.getMessage("LANDING_FORM_SETTINGS_PRESET_PERSONALIZATION_DESCRIPTION"),icon:we,items:["embed","other"],disabled:true,soon:true})];function Xe(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-access-error-message">\n\t\t\t\t\t<div class="landing-ui-access-error-message-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"]);Xe=function t(){return e};return e}var Ke=function(e){babelHelpers.inherits(s,e);babelHelpers.createClass(s,null,[{key:"getInstance",value:function e(){var t=y.PageObject.getRootWindow();var n=t.BX.Landing.UI.Panel.FormSettingsPanel;if(!n.instance&&!s.instance){n.instance=new s}return n.instance||s.instance}}]);function s(){var e;babelHelpers.classCallCheck(this,s);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));e.setEventNamespace("BX.Landing.UI.Panel.FormSettingsPanel");e.setTitle(A.Loc.getMessage("LANDING_FORM_SETTINGS_PANEL_TITLE"));e.disableOverlay();var t=Ae.filter(function(t){return e.isCrmFormPage()||t.id!=="embed"});e.setSidebarButtons(t);e.setCategories(Me);var n=xe.filter(function(e){return A.Loc.getMessage("LANGUAGE_ID")==="ru"||A.Loc.getMessage("LANGUAGE_ID")!=="ru"&&e.options.id!=="vk"});e.setPresets(n);if(!e.isCrmFormPage()){F.Dom.append(e.getBlockSettingsButton().render(),e.getRightHeaderControls())}e.subscribe("onCancel",e.onCancelClick.bind(babelHelpers.assertThisInitialized(e)));return e}babelHelpers.createClass(s,[{key:"isCrmFormPage",value:function e(){return i.Env.getInstance().getOptions().specialType==="crm_forms"}},{key:"getBlockSettingsButton",value:function e(){var t=this;return this.cache.remember("blockSettingsButton",function(){return new T.Button({text:A.Loc.getMessage("LANDING_FORM_SETTINGS_BLOCK_SETTINGS_BUTTON_TEXT"),color:T.Button.Color.LIGHT_BORDER,onclick:t.onBlockSettingsButtonClick.bind(t),size:T.Button.Size.SMALL})})}},{key:"onBlockSettingsButtonClick",value:function e(){var t=this;if(this.getCurrentBlock()){this.hide().then(function(){t.getCurrentBlock().showContentPanel()})}}},{key:"getLoader",value:function e(){var t=this;return this.cache.remember("loader",function(){return new n.Loader({target:t.body})})}},{key:"showLoader",value:function e(){void this.getLoader().show();F.Dom.hide(this.sidebar);F.Dom.hide(this.content);F.Dom.hide(this.getPresetField().getLayout())}},{key:"hideLoader",value:function e(){this.getLoader().hide();F.Dom.show(this.sidebar);F.Dom.show(this.content);F.Dom.show(this.getPresetField().getLayout())}},{key:"load",value:function e(){var n=this;var i=t.Backend.getInstance().batch("Form::getCrmFields",{crmFields:{action:"Form::getCrmFields",data:null},crmCompanies:{action:"Form::getCrmCompanies",data:null},crmCategories:{action:"Form::getCrmCategories",data:null},agreements:{action:"Form::getAgreements",data:null}}).then(function(e){n.setCrmFields(e.crmFields.result);n.setCrmCompanies(e.crmCompanies.result);n.setCrmCategories(e.crmCategories.result);n.setAgreements(e.agreements.result)});var a=E.FormClient.getInstance().getOptions(this.getCurrentFormId()).then(function(e){n.setFormOptions(e)});var s=E.FormClient.getInstance().getDictionary().then(function(e){n.setFormDictionary(e)});return Promise.all([i,a,s])}},{key:"setAgreements",value:function e(t){this.cache.set("agreements",F.Runtime.orderBy(t,["id"],["asc"]))}},{key:"getAgreements",value:function e(){return this.cache.get("agreements")}},{key:"isLeadEnabled",value:function e(){return this.getFormDictionary().document.lead.enabled}},{key:"setCurrentBlock",value:function e(t){this.cache.set("currentBlock",t)}},{key:"getCurrentBlock",value:function e(){return this.cache.get("currentBlock")}},{key:"show",value:function e(){var t=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{formOptions:{}};if(!this.layout.parentNode){this.enableToggleMode()}if(!this.isFormCreated()){this.disableTransparentMode()}this.setCurrentBlock(n.block);this.setCurrentFormId(n.formId);this.setCurrentFormInstanceId(n.instanceId);this.showLoader();this.load().then(function(){t.hideLoader();var e=t.getFormOptions();if(!t.isLeadEnabled()){var i=t.getPresets().map(function(e){if(F.Type.isPlainObject(e.options.options)&&F.Type.isPlainObject(e.options.options.data)){if(F.Type.isArrayFilled(e.options.options.data.fields)){e.options.options.data.fields=e.options.options.data.fields.map(function(e){return babelHelpers.objectSpread({},e,{name:e.name.replace(/^LEAD_/,"CONTACT_")})})}if(F.Type.isPlainObject(e.options.options.document)){e.options.options.document.scheme=3}}return e});t.setPresets(i)}if(F.Type.isPlainObject(n.formOptions)){var a=F.Runtime.merge(t.getFormOptions(),n.formOptions);t.setFormOptions(a)}if(n.state==="presets"&&e.templateId!=="callback"){t.onPresetFieldClick();t.activatePreset(e.templateId)}else{var s=t.getPresets().find(function(t){return t.options.id===e.templateId});if(!s){s=t.getPresets().find(function(e){return e.options.id==="expert"})}if(t.isFormCreated()&&e.templateId!=="callback"){t.applyPreset(s)}else{t.applyPreset(s,true)}}t.setInitialFormOptions(F.Runtime.clone(t.getFormOptions()))}).catch(function(e){if(F.Type.isArrayFilled(e)){var n=510;var i=e.some(function(e){return String(e.code)===String(n)});if(i){t.getLoader().hide();F.Dom.show(t.sidebar);F.Dom.show(t.content);F.Dom.hide(t.footer);F.Dom.append(t.getAccessError(),t.content)}}console.error(e)});void a.StylePanel.getInstance().hide();return babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"show",this).call(this,n)}},{key:"getAccessError",value:function e(){return this.cache.remember("accessErrorMessage",function(){return F.Tag.render(Xe(),A.Loc.getMessage("LANDING_CRM_ACCESS_ERROR_MESSAGE"))})}},{key:"isFormCreated",value:function e(){var t=new F.Uri(window.location.origin);return F.Text.toBoolean(t.getQueryParam("formCreated"))}},{key:"setCurrentFormId",value:function e(t){this.cache.set("currentFormId",F.Text.toNumber(t))}},{key:"getCurrentFormId",value:function e(){return this.cache.get("currentFormId")}},{key:"setCurrentFormInstanceId",value:function e(t){this.cache.set("currentFormInstanceId",t)}},{key:"getCurrentFormInstanceId",value:function e(){return this.cache.get("currentFormInstanceId")}},{key:"setCrmFields",value:function e(t){this.cache.set("fields",t)}},{key:"getCrmFields",value:function e(){return this.cache.get("fields")||{}}},{key:"setCrmCompanies",value:function e(t){this.cache.set("companies",t)}},{key:"getCrmCompanies",value:function e(){return this.cache.get("companies")||[]}},{key:"setCrmCategories",value:function e(t){this.cache.set("crmCategories",t)}},{key:"getCrmCategories",value:function e(){return this.cache.get("crmCategories")||[]}},{key:"setFormOptions",value:function e(t){this.cache.set("formOptions",t)}},{key:"getFormOptions",value:function e(){return F.Runtime.clone(this.cache.get("formOptions")||{})}},{key:"setFormDictionary",value:function e(t){this.cache.set("formDictionary",t)}},{key:"getFormDictionary",value:function e(){return this.cache.get("formDictionary")||{}}},{key:"setInitialFormOptions",value:function e(t){this.cache.set("initialFormOptions",F.Runtime.clone(t))}},{key:"getInitialFormOptions",value:function e(){return this.cache.get("initialFormOptions")}},{key:"getCrmForm",value:function e(){var t=F.Reflection.getClass("b24form.App");if(t){if(this.getCurrentFormInstanceId()){return t.get(this.getCurrentFormInstanceId())}return t.list()[0]}return null}},{key:"onChange",value:function e(t){var n=this;var i=t.getData();var a=t.getTarget().getValue();Promise.resolve(a).then(function(e){if(i.skipPrepare){var t=n.getFormOptions();if(F.Type.isArrayFilled(t.data.dependencies)&&F.Type.isArrayFilled(e.fields)){var a=t.data.dependencies;t.data.dependencies=a.reduce(function(t,n){var i=babelHelpers.objectSpread({},n);i.list=i.list.filter(function(t){return e.fields.some(function(e){return e.id===t.condition.target})&&e.fields.some(function(e){return e.id===t.action.target})});if(i.list.length>0){t.push(i)}return t},[])}if(Reflect.has(e,"presetFields")||Reflect.has(e,"document")||Reflect.has(e,"result")){var s={};if(Reflect.has(e,"document")){s.payment=e.document.payment;delete e.document.payment}return babelHelpers.objectSpread({},t,e,s)}if(Reflect.has(e,"embedding")||Reflect.has(e,"callback")||Reflect.has(e,"name")&&Reflect.has(e,"data")&&Reflect.has(e.data,"useSign")){return F.Runtime.merge(t,e)}if(Reflect.has(e,"recaptcha")){var r=e.recaptcha,o=r.key,l=r.secret;delete e.recaptcha.key;delete e.recaptcha.secret;var c={key:o,secret:l};return babelHelpers.objectSpread({},t,{captcha:c,data:babelHelpers.objectSpread({},t.data,e)})}return babelHelpers.objectSpread({},t,{data:babelHelpers.objectSpread({},t.data,e)})}return E.FormClient.getInstance().prepareOptions(n.getFormOptions(),e).then(function(t){if(e.agreements){t.data=F.Runtime.merge(t.data,e)}if(e.fields){t.data.fields=t.data.fields.map(function(t,n){return F.Runtime.merge(t,e.fields[n])})}return t})}).then(function(e){n.setFormOptions(e);n.getCrmForm().adjust(F.Runtime.clone(e.data))})}},{key:"getPersonalizationVariables",value:function e(){var t=this;return this.cache.remember("personalizationVariables",function(){return t.getFormDictionary().personalization.list.map(function(e){return{name:e.name,value:e.id}})})}},{key:"getContent",value:function e(t){var n=this;var i=this.getCrmForm();i.sent=false;i.error=false;if(t==="button_and_header"){return new R({personalizationVariables:this.getPersonalizationVariables(),values:{title:s.sanitize(i.title),desc:s.sanitize(i.desc),buttonCaption:i.buttonCaption}})}if(t==="spam_protection"){return new G({values:{key:this.getFormOptions().captcha.key,secret:this.getFormOptions().captcha.secret,use:F.Text.toBoolean(this.getFormOptions().data.recaptcha.use)}})}if(t==="agreements"){return new B({formOptions:this.getFormOptions(),agreementsList:this.getAgreements(),values:{agreements:this.getFormOptions().data.agreements}})}if(t==="analytics"){return new j({events:this.getFormOptions().analytics.steps,values:{}})}if(t==="fields"){return new z({crmFields:this.getCrmFields(),formOptions:this.getFormOptions(),isLeadEnabled:this.isLeadEnabled(),values:{fields:this.getFormOptions().data.fields}})}if(t==="fields_rules"){return new Z({fields:this.getFormOptions().data.fields,values:this.getFormOptions().data.dependencies})}if(t==="actions"){var a=new ee({fields:this.getFormOptions().data.fields,values:this.getFormOptions().result});a.subscribe("onShowSuccess",function(){i.stateText=n.getFormOptions().result.success.text;i.sent=!i.sent;i.error=false}).subscribe("onShowFailure",function(){i.stateText=n.getFormOptions().result.failure.text;i.error=!i.error;i.sent=false});return a}if(t==="embed"){return new he({fields:this.getFormOptions().data.fields,values:this.getFormOptions().embedding})}if(t==="identify"){return new Te({fields:this.getFormOptions().data.fields,values:{}})}if(t==="crm"){return new ve({fields:this.getFormOptions().data.fields,companies:this.getCrmCompanies(),categories:this.getCrmCategories(),isLeadEnabled:this.isLeadEnabled(),values:{scheme:this.getFormOptions().document.scheme,duplicatesEnabled:this.getFormOptions().document.deal.duplicatesEnabled||"Y",category:this.getFormOptions().document.deal.category,payment:this.getFormOptions().payment.use,duplicateMode:this.getFormOptions().document.duplicateMode}})}if(t==="default_values"){return new Ne({crmFields:this.getCrmFields(),formOptions:this.getFormOptions(),dictionary:this.getFormDictionary(),isLeadEnabled:this.isLeadEnabled(),personalizationVariables:this.getPersonalizationVariables(),values:{fields:this.getFormOptions().presetFields}})}if(t==="facebook"){return new Se({formOptions:this.getFormOptions()})}if(t==="vk"){return new Ce({formOptions:this.getFormOptions()})}if(t==="callback"){return new ye({dictionary:this.getFormDictionary(),values:this.getFormOptions().callback})}if(t==="other"){return new De({formOptions:this.getFormOptions(),dictionary:this.getFormDictionary(),values:{name:this.getFormOptions().name,useSign:this.getFormOptions().data.useSign,users:this.getFormOptions().responsible.users}})}return null}},{key:"applyPreset",value:function e(t){var n=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.getPresets().forEach(function(e){e.deactivate()});t.activate();if(F.Type.isPlainObject(t.options.options)&&!i){this.showLoader();var a=babelHelpers.objectSpread({data:{}},F.Runtime.clone(t.options.options));var r=[];if(Reflect.has(a.data,"agreements")){var o=this.getAgreements();r=babelHelpers.toConsumableArray(a.data.agreements);a.data.agreements=a.data.agreements.map(function(e,t){return o[t].id})}E.FormClient.getInstance().prepareOptions(this.getFormOptions(),a.data).then(function(e){if(Reflect.has(a.data,"fields")){delete a.data.fields}if(Reflect.has(a.data,"agreements")){delete a.data.agreements}var i=F.Runtime.merge({},e,a);i.data.agreements=i.data.agreements.map(function(e,t){return babelHelpers.objectSpread({},e,r[t])});n.setFormOptions(i);n.getCrmForm().adjust(F.Runtime.clone(i.data));babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"applyPreset",n).call(n,t);n.hideLoader()})}else{babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"applyPreset",this).call(this,t)}}},{key:"getFormNode",value:function e(){var t=this;return this.cache.remember("formNode",function(){return t.getCurrentBlock().node.querySelector("[data-b24form-use-style]")})}},{key:"useBlockDesign",value:function e(){var t=this;return this.cache.remember("useBlockDesign",function(){return F.Text.toBoolean(F.Dom.attr(t.getFormNode(),"data-b24form-use-style"))})}},{key:"getCurrentCrmEntityName",value:function e(){var t=this.getFormOptions().document.scheme;var n=this.getFormDictionary().document.schemes.find(function(e){return String(t)===String(e.id)});return n.name}},{key:"getNotSynchronizedFields",value:function e(){return E.FormClient.getInstance().checkFields(this.getFormOptions()).then(function(e){return e})}},{key:"showSynchronizationPopup",value:function e(t){var n=this;return new Promise(function(e){var i=function t(n){n.close();e(true)};var a=function t(n){n.close();e(false)};var s=function(){var e=A.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_ENTITY_TEMPLATE").replace("{entityName}",n.getCurrentCrmEntityName());return A.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_DESCRIPTION").replace("{entityName}",e)}();var r=function(){var e=babelHelpers.toConsumableArray(t).map(function(e){return A.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_FIELD_TEMPLATE").replace("{fieldName}",e)});if(t.length>1){var n=e.pop();return A.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_TEXT").replace("{fieldsList}",e.join(", ")).replace("{lastField}",n)}return A.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_TEXT_1").replace("{field}",e.join(", "))}();window.top.BX.UI.Dialogs.MessageBox.confirm("".concat(s,"<br><br>").concat(r),A.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_TITLE"),i,A.Loc.getMessage("LANDING_SYNCHRONIZATION_POPUP_OK_BUTTON_LABEL"),a)})}},{key:"showSynchronizationErrorPopup",value:function e(t){var n=t.reduce(function(e,t){return"".concat(e,"\n\n").concat(t)},"");window.top.BX.UI.Dialogs.MessageBox.alert(n)}},{key:"onSaveClick",value:function e(){var t=this;this.getNotSynchronizedFields().then(function(e){if(F.Type.isArrayFilled(e.sync.errors)){t.showSynchronizationErrorPopup(e.sync.errors);return false}if(F.Type.isArrayFilled(e.sync.fields)){var n=e.sync.fields.map(function(e){return e.label});return t.showSynchronizationPopup(n)}return true}).then(function(e){if(e){var n=new F.Uri(window.top.location.toString());n.removeQueryParam("formCreated");window.top.history.replaceState(null,document.title,n.toString());var i=t.getInitialFormOptions();var a=t.getFormOptions();var s=function(){if(!t.isCrmFormPage()){var e=F.Runtime.clone(a);e.data.design=F.Runtime.clone(i.data.design);return e}return a}();void t.hide();void E.FormClient.getInstance().saveOptions(s).then(function(e){t.setFormOptions(e);E.FormClient.getInstance().resetCache(e.id)});if(t.useBlockDesign()&&t.isCrmFormPage()){t.disableUseBlockDesign()}}})}},{key:"disableUseBlockDesign",value:function e(){F.Dom.attr(this.getFormNode(),"data-b24form-use-style","N");this.cache.set("useBlockDesign",false);t.Backend.getInstance().action("Landing\\Block::updateNodes",{block:this.getCurrentBlock().id,data:{".bitrix24forms":{attrs:{"data-b24form-use-style":"N"}}},lid:this.getCurrentBlock().lid,siteId:this.getCurrentBlock().siteId},{code:this.getCurrentBlock().manifest.code})}},{key:"onCancelClick",value:function e(){this.getCrmForm().adjust(this.getInitialFormOptions().data);void this.hide()}}],[{key:"sanitize",value:function e(t){if(F.Type.isStringFilled(t)){return F.Text.decode(t).replace(/<style[^>]*>.*<\/style>/gm,"").replace(/<script[^>]*>.*<\/script>/gm,"").replace(/<[^>]+>/gm,"")}return t}}]);return s}(M.BasePresetPanel);e.FormSettingsPanel=Ke})(this.BX.Landing.UI.Panel=this.BX.Landing.UI.Panel||{},BX.Landing,BX,BX.Landing,BX.Landing.UI.Panel,BX.UI.Dialogs,BX.Landing.UI.Field,BX.Landing.UI.Field,BX.Landing.UI.Field,BX.Landing.UI.Field,BX.Landing.UI.Component,BX.Landing.UI.Component,BX.Landing.UI.Field,BX.Landing.UI.Field,BX.Landing.UI.Component,BX.Landing.UI.Field,BX.Landing.UI.Field,BX.UI,BX.Landing.UI.Card,BX.Crm.Form,BX.Landing.UI.Card,BX.Landing.UI.Card,BX.Landing.UI.Form,BX.Landing.UI.Field,BX.Event,BX.Landing.UI.Field,BX.UI.EntitySelector,BX.Landing,BX,BX.Landing.UI.Button,BX.Landing,BX.Landing.UI.Panel);
//# sourceMappingURL=formsettingspanel.bundle.map.js