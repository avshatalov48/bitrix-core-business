{"version":3,"file":"call-feedback.bundle.js","sources":["../src/call-feedback.js"],"sourcesContent":["import { BitrixVue } from \"ui.vue\";\nimport \"ui.forms\";\nimport { Menu } from \"main.popup\";\n\nimport './call-feedback.css';\nimport { Logger } from \"im.lib.logger\";\n\nBitrixVue.component('bx-im-component-call-feedback',\n{\n\tprops: {\n\t\tdarkMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false\n\t\t},\n\t\tcallDetails: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: () => {\n\t\t\t\treturn {\n\t\t\t\t\tid: 0,\n\t\t\t\t\tprovider: '',\n\t\t\t\t\tuserCount: 0,\n\t\t\t\t\tbrowser: '',\n\t\t\t\t\tisMobile: false,\n\t\t\t\t\tisConference: false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tselectedRating: 0,\n\t\t\thoveredRating: 0,\n\t\t\tselectedProblem: '',\n\t\t\tproblemDescription: '',\n\t\t\tisFilled: false\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.initProblemsList();\n\t\tthis.selectedProblem = this.problemsList.noProblem;\n\t},\n\tcomputed:\n\t{\n\t\tshowTextarea()\n\t\t{\n\t\t\treturn this.selectedProblem === this.problemsList.other;\n\t\t},\n\t\twrapClasses()\n\t\t{\n\t\t\treturn ['bx-im-call-feedback-wrap', this.darkMode? 'bx-im-call-feedback-wrap-dark': '']\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tonRatingMouseover(index)\n\t\t{\n\t\t\tthis.hoveredRating = index;\n\t\t},\n\t\tonRatingMouseOut(index)\n\t\t{\n\t\t\tthis.hoveredRating = 0;\n\t\t},\n\t\tonRatingClick(index)\n\t\t{\n\t\t\tthis.selectedRating = index;\n\t\t},\n\t\tprepareFeedback()\n\t\t{\n\t\t\treturn {\n\t\t\t\tevent: 'call_feedback',\n\t\t\t\tcall_id: this.callDetails.id,\n\t\t\t\tkind: this.callDetails.provider,\n\t\t\t\tuserCount: this.callDetails.userCount,\n\t\t\t\tbrowser: this.callDetails.browser,\n\t\t\t\tisMobile: this.callDetails.isMobile,\n\t\t\t\tisConference: this.callDetails.isConference,\n\t\t\t\tcallRating: this.selectedRating,\n\t\t\t\tcallProblem: this.getProblemCode(),\n\t\t\t\tproblemDescription: this.problemDescription\n\t\t\t};\n\t\t},\n\t\tgetProblemCode()\n\t\t{\n\t\t\tlet problem = '';\n\t\t\tfor (const [key, value] of Object.entries(this.problemsList))\n\t\t\t{\n\t\t\t\tif (this.selectedProblem === value)\n\t\t\t\t{\n\t\t\t\t\tproblem = key;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn problem;\n\t\t},\n\t\tsendFeedback()\n\t\t{\n\t\t\tthis.isFilled = true;\n\t\t\tconst feedback = this.prepareFeedback();\n\t\t\tLogger.warn('Call feedback', feedback);\n\t\t\tthis.$emit('feedbackSent');\n\n\t\t\tif (this.selectedRating === 0 && this.selectedProblem === this.problemsList.noProblem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tBX.Call.Util.sendTelemetryEvent(feedback);\n\t\t},\n\t\tgetRatingStarClasses(index)\n\t\t{\n\t\t\treturn [\n\t\t\t\t'bx-im-call-feedback-rating-star',\n\t\t\t\tthis.hoveredRating >= index || this.selectedRating >= index ? 'bx-im-call-feedback-rating-star-filled': 'bx-im-call-feedback-rating-star-empty'\n\t\t\t];\n\t\t},\n\t\tinitProblemsList()\n\t\t{\n\t\t\tthis.problemsList = {\n\t\t\t\tnoProblem: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_NO_ISSUE'),\n\t\t\t\tvideoQuality: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_VIDEO_QUALITY'),\n\t\t\t\tcantSeeEachOther: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_CANT_SEE_EACH_OTHER'),\n\t\t\t\tcantHearEachOther: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_CANT_HEAR_EACH_OTHER'),\n\t\t\t\taudioQuality: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_AUDIO_QUALITY'),\n\t\t\t\tscreenSharingProblem: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_SCREEN_SHARING_PROBLEM'),\n\t\t\t\trecordingProblem: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_RECORDING_PROBLEM'),\n\t\t\t\tcallInterfaceProblem: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_CALL_INTERFACE_PROBLEM'),\n\t\t\t\tgotDisconnected: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_GOT_DISCONNECTED'),\n\t\t\t\tother: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_OTHER')\n\t\t\t};\n\t\t},\n\t\tcreateProblemSelectPopup()\n\t\t{\n\t\t\tconst problemSelect = this.$refs['problemSelect'];\n\t\t\tconst className = 'bx-im-call-feedback-problem-select' + (this.darkMode ? ' bx-im-call-feedback-problem-select-dark': '');\n\t\t\tconst items = [];\n\t\t\tfor (const problem of Object.values(this.problemsList)) {\n\t\t\t\titems.push({\n\t\t\t\t\ttext: problem,\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\tthis.onProblemClick(item);\n\t\t\t\t\t},\n\t\t\t\t\tclassName: 'bx-im-call-feedback-problem-option'\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.problemSelectPopup = new Menu({\n\t\t\t\tbindElement: problemSelect,\n\t\t\t\titems,\n\t\t\t\tclassName,\n\t\t\t\toffsetTop: 0\n\t\t\t});\n\t\t},\n\t\ttoggleProblemSelectPopup()\n\t\t{\n\t\t\tif (!this.problemSelectPopup)\n\t\t\t{\n\t\t\t\tthis.createProblemSelectPopup();\n\t\t\t}\n\n\t\t\tthis.problemSelectPopup.toggle();\n\t\t},\n\t\tonProblemClick(problem)\n\t\t{\n\t\t\tthis.selectedProblem = problem.text;\n\t\t\tthis.problemSelectPopup.toggle();\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"wrapClasses\">\n\t\t\t<div class=\"bx-im-call-feedback-header\">\n\t\t  \t\t<div class=\"bx-im-call-feedback-header-icon\"></div>\n\t\t\t\t<div class=\"bx-im-call-feedback-header-title\">{{ $Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_VIDEOCALL_FINISHED') }}</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-call-feedback-content\">\n\t\t\t  \t<template v-if=\"!isFilled\">\n\t\t\t\t\t<div class=\"bx-im-call-feedback-content-title\">{{ $Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_RATE_QUALITY') }}</div>\n\t\t\t\t\t<div class=\"bx-im-call-feedback-rating-wrap\">\n\t\t\t\t\t  \t<template v-for=\"i in 5\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t  \t\t@click=\"onRatingClick(i)\"\n\t\t\t\t\t\t\t\t@mouseover=\"onRatingMouseover(i)\"\n\t\t\t\t\t\t\t\t@mouseout=\"onRatingMouseOut(i)\"\n\t\t\t\t\t\t\t  \t:class=\"getRatingStarClasses(i)\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-call-feedback-problem\">\n\t\t\t\t\t\t<div @click=\"toggleProblemSelectPopup\" class=\"bx-im-call-feedback-problem-selected ui-ctl ui-ctl-after-icon ui-ctl-dropdown\" ref=\"problemSelect\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t<div class=\"ui-ctl-element\">{{ selectedProblem }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t  \t<template v-if=\"showTextarea\">\n\t\t\t\t  \t\t<textarea\n\t\t\t\t\t\t  class=\"bx-im-call-feedback-problem-description\"\n\t\t\t\t\t\t  v-model=\"problemDescription\"\n\t\t\t\t\t\t  :placeholder=\"$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_DESCRIPTION')\"\n\t\t\t\t\t\t></textarea>\n\t\t\t\t\t</template>\n\t\t\t\t  \t<div class=\"bx-im-call-feedback-submit-wrap\">\n\t\t\t\t\t\t<button @click=\"sendFeedback\" class=\"ui-btn ui-btn-lg ui-btn-primary bx-im-call-feedback-submit\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_SEND') }}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t  \t<template v-else>\n\t\t\t\t  \t<div class=\"bx-im-call-feedback-filled-wrap\">\n\t\t\t\t\t\t<div class=\"bx-im-call-feedback-filled-icon\"></div>\n\t\t\t\t\t\t<div class=\"bx-im-call-feedback-filled-text\">{{ $Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_FILLED') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["BitrixVue","component","props","darkMode","type","Boolean","required","default","callDetails","Object","id","provider","userCount","browser","isMobile","isConference","data","selectedRating","hoveredRating","selectedProblem","problemDescription","isFilled","created","initProblemsList","problemsList","noProblem","computed","showTextarea","other","wrapClasses","methods","onRatingMouseover","index","onRatingMouseOut","onRatingClick","prepareFeedback","event","call_id","kind","callRating","callProblem","getProblemCode","problem","entries","key","value","sendFeedback","feedback","Logger","warn","$emit","BX","Call","Util","sendTelemetryEvent","getRatingStarClasses","$Bitrix","Loc","getMessage","videoQuality","cantSeeEachOther","cantHearEachOther","audioQuality","screenSharingProblem","recordingProblem","callInterfaceProblem","gotDisconnected","createProblemSelectPopup","problemSelect","$refs","className","items","values","push","text","onclick","item","onProblemClick","problemSelectPopup","Menu","bindElement","offsetTop","toggleProblemSelectPopup","toggle","template"],"mappings":"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"}