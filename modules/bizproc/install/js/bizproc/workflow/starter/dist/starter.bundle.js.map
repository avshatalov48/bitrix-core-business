{"version":3,"file":"starter.bundle.js","sources":["../src/data/complex-document-id.js","../src/data/complex-document-type.js","../src/call-action-helper.js","../src/error-notifier.js","../src/starter.js","../src/manager.js","../src/index.js"],"sourcesContent":["import { Type } from 'main.core';\n\nexport class ComplexDocumentId\n{\n\t#moduleId: string;\n\t#entity: string;\n\t#documentId: string | number;\n\n\tconstructor(moduleId: string, entity: string, documentId: string | number)\n\t{\n\t\tif (\n\t\t\t!Type.isStringFilled(moduleId)\n\t\t\t|| !Type.isStringFilled(entity)\n\t\t\t|| !(Type.isStringFilled(documentId) || Type.isNumber(documentId))\n\t\t)\n\t\t{\n\t\t\tthrow new TypeError('incorrect complex document id');\n\t\t}\n\n\t\tthis.#moduleId = moduleId;\n\t\tthis.#entity = entity;\n\t\tthis.#documentId = documentId;\n\t}\n\n\tget moduleId(): string\n\t{\n\t\treturn this.#moduleId;\n\t}\n\n\tget entity(): string\n\t{\n\t\treturn this.#entity;\n\t}\n\n\tget documentId(): string | number\n\t{\n\t\treturn this.#documentId;\n\t}\n}\n","import { Type } from 'main.core';\nimport type { SignedDocumentType } from '../starter';\n\nexport class ComplexDocumentType\n{\n\t#moduleId: string;\n\t#entity: string;\n\t#documentType: string;\n\n\tconstructor(moduleId: string, entity: string, documentType: string)\n\t{\n\t\tif (\n\t\t\t!Type.isStringFilled(moduleId)\n\t\t\t|| !Type.isStringFilled(entity)\n\t\t\t|| !Type.isStringFilled(documentType)\n\t\t)\n\t\t{\n\t\t\tthrow new TypeError('incorrect complex document type');\n\t\t}\n\n\t\tthis.#moduleId = moduleId;\n\t\tthis.#entity = entity;\n\t\tthis.#documentType = documentType;\n\t}\n\n\tget moduleId(): string\n\t{\n\t\treturn this.#moduleId;\n\t}\n\n\tget entity(): string\n\t{\n\t\treturn this.#entity;\n\t}\n\n\tget documentType(): string\n\t{\n\t\treturn this.#documentType;\n\t}\n\n\tisEqual(targetDocumentType: SignedDocumentType | ComplexDocumentType): boolean\n\t{\n\t\tif (Type.isString(targetDocumentType))\n\t\t{\n\t\t\treturn (\n\t\t\t\ttargetDocumentType.includes(this.moduleId)\n\t\t\t\t&& targetDocumentType.includes(this.entity)\n\t\t\t\t&& targetDocumentType.includes(this.documentType)\n\t\t\t);\n\t\t}\n\n\t\tif (Type.isObjectLike(targetDocumentType))\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.moduleId === targetDocumentType.moduleId\n\t\t\t\t&& this.entity === targetDocumentType.entity\n\t\t\t\t&& this.documentType === targetDocumentType.documentType\n\t\t\t);\n\t\t}\n\n\t\treturn false;\n\t}\n}\n","import { ajax, Loc, Type, Text } from 'main.core';\nimport type { CallActionHelperData } from './types/call-action-helper-data';\n\nexport type Action = 'load' | 'start' | 'check_parameters';\n\nconst ACTION_AJAX_MAP = Object.freeze({\n\tload: 'get_templates',\n\tstart: 'start_workflow',\n\tcheck_parameters: 'check_parameters',\n});\n\nconst ACTION_CONTROLLER_MAP = Object.freeze({\n\tload: 'getTemplates',\n\tstart: 'startWorkflow',\n\tcheck_parameters: 'checkParameters',\n});\n\nexport class CallActionHelper\n{\n\t#defaultData: {} = {};\n\t#ajaxUrl: string = '';\n\t#controller: string = 'bizproc.workflow.starter';\n\n\tconstructor(data: CallActionHelperData)\n\t{\n\t\tthis.#fillDefaultData(data);\n\n\t\tif (Type.isStringFilled(data.customAjaxUrl))\n\t\t{\n\t\t\tthis.#ajaxUrl = data.customAjaxUrl;\n\t\t}\n\t\telse if (!Type.isStringFilled(this.#defaultData.signed_document_type))\n\t\t{\n\t\t\tconsole.warn(`\n\t\t\t\tBizproc.Workflow.Starter: \n\t\t\t\tUsing the document type in parts has been deprecated and will soon cease to be supported. \n\t\t\t\tPlease use a signed document type\n\t\t\t`);\n\n\t\t\tthis.#ajaxUrl = '/bitrix/components/bitrix/bizproc.workflow.start/ajax.php';\n\t\t}\n\t}\n\n\t#fillDefaultData(data: CallActionHelperData)\n\t{\n\t\tif (!Type.isNil(data.signedDocumentType))\n\t\t{\n\t\t\tthis.#defaultData.signed_document_type = data.signedDocumentType;\n\t\t}\n\n\t\tif (!Type.isNil(data.signedDocumentId))\n\t\t{\n\t\t\tthis.#defaultData.signed_document_id = data.signedDocumentId;\n\t\t}\n\n\t\tif (!Type.isNil(data.complexDocumentType?.moduleId))\n\t\t{\n\t\t\tthis.#defaultData.module_id = data.complexDocumentType.moduleId;\n\t\t}\n\n\t\tif (!Type.isNil(data.complexDocumentType?.entity))\n\t\t{\n\t\t\tthis.#defaultData.entity = data.complexDocumentType.entity;\n\t\t}\n\n\t\tif (!Type.isNil(data.complexDocumentType?.documentType))\n\t\t{\n\t\t\tthis.#defaultData.document_type = data.complexDocumentType.documentType;\n\t\t}\n\n\t\tif (!Type.isNil(data.complexDocumentId?.documentId))\n\t\t{\n\t\t\tthis.#defaultData.document_id = data.complexDocumentId.documentId;\n\t\t}\n\t}\n\n\tget #hasAjaxUrl(): boolean\n\t{\n\t\treturn Type.isStringFilled(this.#ajaxUrl);\n\t}\n\n\tcallAction(action: Action, actionData: {} | FormData = {}): Promise\n\t{\n\t\tconst actionName = this.#hasAjaxUrl ? ACTION_AJAX_MAP[action] : ACTION_CONTROLLER_MAP[action];\n\t\tif (!Type.isStringFilled(actionName))\n\t\t{\n\t\t\treturn Promise.reject(new Error('incorrect action')); // todo: Loc\n\t\t}\n\n\t\tconst data = this.addData(this.#defaultData, actionData);\n\n\t\treturn (\n\t\t\tthis.#hasAjaxUrl\n\t\t\t\t? this.#callAjax(actionName, data)\n\t\t\t\t: this.#callController(actionName, data)\n\t\t);\n\t}\n\n\t#callAjax(actionName: string, actionData: {} | FormData = {}): Promise\n\t{\n\t\tconst data = this.addData(\n\t\t\t{\n\t\t\t\tsessid: Loc.getMessage('bitrix_sessid'),\n\t\t\t\tsite: Loc.getMessage('SITE_ID'),\n\t\t\t\tajax_action: actionName,\n\t\t\t},\n\t\t\tactionData,\n\t\t);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst ajaxConfig = {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: this.#ajaxUrl,\n\t\t\t\tdata,\n\t\t\t\tonsuccess: (response) => {\n\t\t\t\t\tif (response.success)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(response);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonfailure: () => {\n\t\t\t\t\treject();\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tif (!Type.isPlainObject(data))\n\t\t\t{\n\t\t\t\tajaxConfig.preparePost = false;\n\t\t\t}\n\n\t\t\tajax(ajaxConfig);\n\t\t});\n\t}\n\n\t#callController(actionName: string, data: {} | FormData = {}): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction(`${this.#controller}.${actionName}`, { data }).then(resolve).catch(reject);\n\t\t});\n\t}\n\n\taddData(targetData: {}, actionData: {} | FormData = {}): {} | FormData\n\t{\n\t\tconst data = actionData;\n\t\tconst isPlainObject = Type.isPlainObject(data);\n\n\t\tObject.entries(targetData).forEach(([key, value]) => {\n\t\t\tconst modifiedKey = this.#hasAjaxUrl ? key : Text.toCamelCase(key);\n\n\t\t\tif (isPlainObject)\n\t\t\t{\n\t\t\t\tdata[modifiedKey] = value;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdata.set(modifiedKey, value);\n\t\t});\n\n\t\treturn data;\n\t}\n}\n","import { Text, Type, Loc } from 'main.core';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\nexport class ErrorNotifier\n{\n\t#messages: [] = [];\n\tconstructor(errors: ?[])\n\t{\n\t\tif (Type.isArrayFilled(errors))\n\t\t{\n\t\t\tthis.#setMessages(errors);\n\t\t}\n\t}\n\n\t#setMessages(errors: [])\n\t{\n\t\terrors.forEach((error) => {\n\t\t\tif (Type.isStringFilled(error))\n\t\t\t{\n\t\t\t\tthis.#messages.push(Text.encode(error));\n\t\t\t}\n\t\t\telse if (Type.isPlainObject(error) && Type.isStringFilled(error.message))\n\t\t\t{\n\t\t\t\tif (Type.isStringFilled(error.code) && error.code === 'NETWORK_ERROR')\n\t\t\t\t{\n\t\t\t\t\tthis.#messages.push(Text.encode(this.#defaultErrorMessage));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#messages.push(Text.encode(error.message));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.#showMessages(MessageBox);\n\t}\n\n\tshowToWindow(targetWindow: Window)\n\t{\n\t\ttargetWindow.BX.Runtime.loadExtension('ui.dialogs.messagebox')\n\t\t\t.then(() => {\n\t\t\t\tthis.#showMessages(targetWindow.BX.UI.Dialogs.MessageBox);\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n\n\t#showMessages(messageBox)\n\t{\n\t\tif (!messageBox)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isArrayFilled(this.#messages))\n\t\t{\n\t\t\tmessageBox.alert(this.#messages.join('<br>'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tmessageBox.alert(Text.encode(this.#defaultErrorMessage));\n\t}\n\n\tget #defaultErrorMessage(): string\n\t{\n\t\treturn Loc.getMessage('BIZPROC_JS_WORKFLOW_STARTER_REQUEST_FAILED');\n\t}\n}\n","import { Type, Loc, Text, Uri } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Dialog } from 'ui.entity-selector';\nimport 'ui.notification';\nimport 'sidepanel';\nimport type { Action } from './call-action-helper';\n\nimport { ComplexDocumentId } from './data/complex-document-id';\nimport { ComplexDocumentType } from './data/complex-document-type';\nimport { CallActionHelper } from './call-action-helper';\nimport { ErrorNotifier } from './error-notifier';\nimport { managerInstance } from './index';\nimport type { StarterData } from './types/starter-data';\n\nexport type SignedDocumentType = string;\nexport type SignedDocumentId = string;\n\nexport class Starter extends EventEmitter\n{\n\t#templates: ?[] = null;\n\t#signedDocumentType: ?SignedDocumentType = null;\n\t#signedDocumentId: ?SignedDocumentId = null;\n\t#complexDocumentType: ?ComplexDocumentType = null;\n\t#complexDocumentId: ?ComplexDocumentId = null;\n\n\t#templatesSelector: ?Dialog = null;\n\t#callActionHelper: CallActionHelper;\n\t#hasCustomAjaxUrl: boolean = false;\n\n\tconstructor(data: StarterData)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Workflow.Starter');\n\n\t\tthis.#setDocumentType(data);\n\t\tif (Type.isNil(this.#complexDocumentType) && Type.isNil(this.#signedDocumentType))\n\t\t{\n\t\t\tthrow new TypeError('document type is empty');\n\t\t}\n\n\t\tthis.#setDocumentId(data);\n\n\t\tif (Type.isArray(data.templates))\n\t\t{\n\t\t\tthis.#templates = data.templates;\n\t\t}\n\n\t\tthis.#hasCustomAjaxUrl = Type.isStringFilled(data.ajaxUrl);\n\t\tthis.#callActionHelper = new CallActionHelper({\n\t\t\tcomplexDocumentType: this.#complexDocumentType,\n\t\t\tsignedDocumentType: this.#signedDocumentType,\n\t\t\tcomplexDocumentId: this.#complexDocumentId,\n\t\t\tsignedDocumentId: this.#signedDocumentId,\n\t\t\tcustomAjaxUrl: this.#hasCustomAjaxUrl ? data.ajaxUrl : null,\n\t\t});\n\n\t\tmanagerInstance.put(this);\n\t}\n\n\t#setDocumentType(data: StarterData): void\n\t{\n\t\tif (\n\t\t\tType.isStringFilled(data.moduleId)\n\t\t\t&& Type.isStringFilled(data.entity)\n\t\t\t&& Type.isStringFilled(data.documentType)\n\t\t)\n\t\t{\n\t\t\tthis.#complexDocumentType = new ComplexDocumentType(data.moduleId, data.entity, data.documentType);\n\t\t}\n\n\t\tif (Type.isStringFilled(data.signedDocumentType))\n\t\t{\n\t\t\tthis.#signedDocumentType = data.signedDocumentType;\n\t\t}\n\t}\n\n\t#setDocumentId(data: StarterData): void\n\t{\n\t\tif (\n\t\t\tType.isStringFilled(data.moduleId)\n\t\t\t&& Type.isStringFilled(data.entity)\n\t\t\t&& (Type.isStringFilled(data.documentId) || Type.isNumber(data.documentId))\n\t\t)\n\t\t{\n\t\t\tthis.#complexDocumentId = new ComplexDocumentId(data.moduleId, data.entity, data.documentId);\n\t\t}\n\n\t\tif (Type.isStringFilled(data.signedDocumentId))\n\t\t{\n\t\t\tthis.#signedDocumentId = data.signedDocumentId;\n\t\t}\n\t}\n\n\tstatic singleStart(config: StarterData & { hasParameters: boolean, templateId: number }, callback: ?Function)\n\t{\n\t\tconst templateId = Text.toInteger(config?.templateId);\n\t\tif (templateId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet starter = null;\n\t\ttry\n\t\t{\n\t\t\tstarter = new Starter({\n\t\t\t\tmoduleId: config.moduleId,\n\t\t\t\tentity: config.entity,\n\t\t\t\tdocumentType: config.documentType,\n\t\t\t\tdocumentId: config.documentId,\n\t\t\t\tsignedDocumentType: config.signedDocumentType,\n\t\t\t\tsignedDocumentId: config.signedDocumentId,\n\t\t\t\ttemplates: config.templates || null,\n\t\t\t\tajaxUrl: config.ajaxUrl || '',\n\t\t\t});\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isFunction(callback))\n\t\t{\n\t\t\tEventEmitter.subscribe(starter, 'onAfterStartWorkflow', callback);\n\t\t}\n\n\t\tstarter.beginStartWorkflow(templateId)\n\t\t\t.then(() => {\n\t\t\t\tmanagerInstance.remove(starter);\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n\n\tstatic showTemplates(\n\t\tstarterData: { signedDocumentType: string, signedDocumentId: string },\n\t\tconfig: { targetNode: ?HTMLElement, callback: ?Function },\n\t): void\n\t{\n\t\tlet starter = null;\n\t\ttry\n\t\t{\n\t\t\tstarter = new Starter({\n\t\t\t\tsignedDocumentType: starterData.signedDocumentType,\n\t\t\t\tsignedDocumentId: starterData.signedDocumentId,\n\t\t\t});\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error(e);\n\n\t\t\treturn;\n\t\t}\n\n\t\tstarter.#showTemplatesSlider(() => {\n\t\t\tif (Type.isFunction(config.callback))\n\t\t\t{\n\t\t\t\tconfig.callback();\n\t\t\t}\n\t\t\tmanagerInstance.remove(starter);\n\t\t});\n\t}\n\n\tget signedDocumentType(): ?string\n\t{\n\t\treturn this.#signedDocumentType;\n\t}\n\n\tget complexDocumentType(): ?ComplexDocumentType\n\t{\n\t\treturn this.#complexDocumentType;\n\t}\n\n\t#showTemplatesSlider(callback: ?Function = null): void\n\t{\n\t\tconst sliderOptions = {\n\t\t\twidth: 970,\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonCloseComplete: Type.isFunction(callback) ? callback : () => {},\n\t\t\t},\n\t\t};\n\n\t\tconst componentParams = {\n\t\t\tsignedDocumentType: this.#signedDocumentType,\n\t\t\tsignedDocumentId: this.#signedDocumentId,\n\t\t};\n\n\t\tconst url = BX.Uri.addParam(\n\t\t\t'/bitrix/components/bitrix/bizproc.workflow.start.list/',\n\t\t\tcomponentParams,\n\t\t);\n\n\t\tBX.SidePanel.Instance.open(url, sliderOptions);\n\t}\n\n\t// compatibility\n\tshowTemplatesMenu(targetNode)\n\t{\n\t\tif (Type.isStringFilled(this.#signedDocumentType) && !this.#hasCustomAjaxUrl)\n\t\t{\n\t\t\tthis.#showTemplatesSlider();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isElementNode(targetNode) && !Type.isNull(targetNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isArray(this.#templates))\n\t\t{\n\t\t\tif (!this.#templatesSelector)\n\t\t\t{\n\t\t\t\tthis.#initTemplateSelector(targetNode);\n\t\t\t}\n\n\t\t\tthis.#templatesSelector.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#loadTemplates()\n\t\t\t.then(() => {\n\t\t\t\tthis.showTemplatesMenu(targetNode);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.#showErrors(response?.errors);\n\t\t\t})\n\t\t;\n\t}\n\n\t#loadTemplates(): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#callAction('load')\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.#templates = Type.isArray(response.data.templates) ? response.data.templates : [];\n\t\t\t\t\tresolve(response);\n\t\t\t\t})\n\t\t\t\t.catch(reject)\n\t\t\t;\n\t\t});\n\t}\n\n\t#initTemplateSelector(targetNode: HTMLElement)\n\t{\n\t\tconst items = [];\n\t\tif (Type.isArrayFilled(this.#templates))\n\t\t{\n\t\t\tthis.#templates.forEach((template) => {\n\t\t\t\tif (Text.toInteger(template.id) > 0 && Type.isStringFilled(template.name))\n\t\t\t\t{\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tid: template.id,\n\t\t\t\t\t\ttitle: template.name,\n\t\t\t\t\t\tsubtitle: template.description || '',\n\t\t\t\t\t\tentityId: 'template',\n\t\t\t\t\t\ttabs: 'recents',\n\t\t\t\t\t\tcustomData: template,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.#templatesSelector = new Dialog({\n\t\t\ttargetNode,\n\t\t\tcontext: 'bp_workflow_starter',\n\t\t\titems,\n\t\t\tmultiple: false,\n\t\t\tdropdownMode: true,\n\t\t\tenableSearch: true,\n\t\t\thideOnSelect: true,\n\t\t\tclearSearchOnSelect: true,\n\t\t\thideByEsc: true,\n\t\t\tcacheable: true,\n\t\t\tfocusOnFirst: true,\n\t\t\tshowAvatars: false,\n\t\t\tcompactView: false,\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\tthis.#templatesSelector.deselectAll();\n\t\t\t\t\tconst customData = event.getData().item?.getCustomData();\n\t\t\t\t\tif (customData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onTemplateSelect(customData);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\trecentTabOptions: {\n\t\t\t\tstub: true,\n\t\t\t\tstubOptions: {\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_JS_WORKFLOW_STARTER_EMPTY_TEMPLATES'),\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#onTemplateSelect(template: Map)\n\t{\n\t\tthis.beginStartWorkflow(template.get('id')).then(() => {}).catch(() => {});\n\t}\n\n\t// compatibility\n\tshowParametersPopup(templateId)\n\t{\n\t\tthis.beginStartWorkflow(templateId).then(() => {}).catch(() => {});\n\t}\n\n\tbeginStartWorkflow(templateId: number): Promise\n\t{\n\t\tif (Text.toInteger(templateId) <= 0)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#showStepByStepSlider({ templateId, autoExecuteType: null })\n\t\t\t\t.then((data: { workflowId: string }) => {\n\t\t\t\t\tif (Type.isStringFilled(data.workflowId))\n\t\t\t\t\t{\n\t\t\t\t\t\tmanagerInstance.fireEvent(this, 'onAfterStartWorkflow', { workflowId: data.workflowId });\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch(reject)\n\t\t\t;\n\t\t});\n\t}\n\n\t// compatibility\n\tshowAutoStartParametersPopup(\n\t\tautoExecuteType: number,\n\t\tconfig: { callback: Function } = {},\n\t)\n\t{\n\t\tthis.#showStepByStepSlider({ templateId: null, autoExecuteType })\n\t\t\t.then((data: { signedParameters: string }) => {\n\t\t\t\tif (Type.isFunction(config?.callback))\n\t\t\t\t{\n\t\t\t\t\tif (Type.isString(data.signedParameters))\n\t\t\t\t\t{\n\t\t\t\t\t\tconfig.callback({ parameters: data.signedParameters });\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconfig.callback({ parameters: null });\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n\n\t#showStepByStepSlider(componentParams: { templateId: ?number, autoExecuteType: ?number }): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\tthis.#createStepByStepSliderUrl(componentParams),\n\t\t\t\t{\n\t\t\t\t\twidth: 900,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t\tallowChangeHistory: false,\n\t\t\t\t\t// loader: '', // todo: loader\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonCloseComplete: (event: BX.SidePanel.Event) => {\n\t\t\t\t\t\t\tconst slider = event.getSlider();\n\t\t\t\t\t\t\tconst dictionary: ?BX.SidePanel.Dictionary = slider ? slider.getData() : null;\n\t\t\t\t\t\t\tlet data = {};\n\t\t\t\t\t\t\tif (dictionary && dictionary.has('data'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdata = {\n\t\t\t\t\t\t\t\t\tworkflowId: dictionary.get('data').workflowId || null,\n\t\t\t\t\t\t\t\t\tsignedParameters: dictionary.get('data').signedParameters || null,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\t}\n\n\t#createStepByStepSliderUrl(componentParams: { templateId: ?number, autoExecuteType: ?number }): string\n\t{\n\t\tlet url = Uri.addParam(\n\t\t\t'/bitrix/components/bitrix/bizproc.workflow.start/',\n\t\t\t{ sessid: Loc.getMessage('bitrix_sessid') }, // todo: remove?\n\t\t);\n\n\t\tconst templateId = Text.toInteger(componentParams.templateId);\n\t\tif (templateId > 0)\n\t\t{\n\t\t\turl = Uri.addParam(url, { templateId });\n\t\t}\n\n\t\tconst autoExecuteType = Text.toInteger(componentParams.autoExecuteType);\n\t\tif (!Type.isNil(componentParams.autoExecuteType) && autoExecuteType >= 0)\n\t\t{\n\t\t\turl = Uri.addParam(url, { autoExecuteType });\n\t\t}\n\n\t\tif (this.#complexDocumentType?.moduleId)\n\t\t{\n\t\t\turl = Uri.addParam(\n\t\t\t\turl,\n\t\t\t\t{\n\t\t\t\t\tmoduleId: this.#complexDocumentType.moduleId,\n\t\t\t\t\tentity: this.#complexDocumentType.entity,\n\t\t\t\t\tdocumentType: this.#complexDocumentType.documentType,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tif (this.#signedDocumentType)\n\t\t{\n\t\t\turl = Uri.addParam(url, { signedDocumentType: this.#signedDocumentType });\n\t\t}\n\n\t\tif (this.#complexDocumentId?.documentId)\n\t\t{\n\t\t\turl = Uri.addParam(url, { documentId: this.#complexDocumentId.documentId });\n\t\t}\n\n\t\tif (this.#signedDocumentId)\n\t\t{\n\t\t\turl = Uri.addParam(url, { signedDocumentId: this.#signedDocumentId });\n\t\t}\n\n\t\treturn url;\n\t}\n\n\t#callAction(action: Action, formData: {} | FormData = {}, addData: {} = {}): Promise\n\t{\n\t\treturn this.#callActionHelper.callAction(action, this.#callActionHelper.addData(addData, formData));\n\t}\n\n\t#showErrors(errors: ?[], targetWindow: ?Window)\n\t{\n\t\tconst notifier = new ErrorNotifier(errors);\n\t\tconst method = Type.isNil(targetWindow) ? 'show' : 'showToWindow';\n\n\t\tnotifier[method](targetWindow);\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\nimport type { Starter } from './starter';\n\nexport class Manager\n{\n\t#instances: Set<Starter> = new Set();\n\n\tput(starter: Starter): Manager\n\t{\n\t\tthis.#instances.add(starter);\n\n\t\treturn this;\n\t}\n\n\tremove(starter: Starter)\n\t{\n\t\tthis.#instances.delete(starter);\n\t}\n\n\tfireEvent(starter: Starter, eventName: string, parameters: {})\n\t{\n\t\tconst instances = this.#findSimilar(starter);\n\t\tinstances.forEach((target) => {\n\t\t\ttarget.emit(eventName, parameters);\n\t\t\tEventEmitter.emit(target, eventName, parameters, { useGlobalNaming: true }); // compatibility\n\t\t});\n\t}\n\n\t#findSimilar(target: Starter): Array<Starter>\n\t{\n\t\tconst result = [target];\n\n\t\tthis.#instances.forEach((starter) => {\n\t\t\tif (starter !== target && this.#isEqual(target, starter))\n\t\t\t{\n\t\t\t\tresult.push(starter);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t#isEqual(target: Starter, starter: Starter): boolean\n\t{\n\t\tif (target.signedDocumentType && starter.signedDocumentType)\n\t\t{\n\t\t\treturn target.signedDocumentType === starter.signedDocumentType;\n\t\t}\n\n\t\tif (target.complexDocumentType)\n\t\t{\n\t\t\treturn (\n\t\t\t\ttarget.complexDocumentType.isEqual(\n\t\t\t\t\tstarter.complexDocumentType || starter.signedDocumentType,\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\tstarter.complexDocumentType.isEqual(\n\t\t\t\ttarget.complexDocumentType || target.signedDocumentType,\n\t\t\t)\n\t\t);\n\t}\n}\n","import { Starter } from './starter';\nimport { Manager } from './manager';\n\nconst managerInstance = new Manager();\n\nexport { Starter, managerInstance };\n"],"names":["ComplexDocumentId","constructor","moduleId","entity","documentId","Type","isStringFilled","isNumber","TypeError","ComplexDocumentType","documentType","isEqual","targetDocumentType","isString","includes","isObjectLike","ACTION_AJAX_MAP","Object","freeze","load","start","check_parameters","ACTION_CONTROLLER_MAP","CallActionHelper","data","customAjaxUrl","signed_document_type","console","warn","callAction","action","actionData","actionName","Promise","reject","Error","addData","targetData","isPlainObject","entries","forEach","key","value","modifiedKey","Text","toCamelCase","set","isNil","signedDocumentType","signedDocumentId","signed_document_id","complexDocumentType","module_id","document_type","complexDocumentId","document_id","sessid","Loc","getMessage","site","ajax_action","resolve","ajaxConfig","method","dataType","url","onsuccess","response","success","onfailure","preparePost","ajax","runAction","then","catch","ErrorNotifier","errors","isArrayFilled","show","MessageBox","showToWindow","targetWindow","BX","Runtime","loadExtension","UI","Dialogs","error","push","encode","message","code","messageBox","alert","join","Starter","EventEmitter","setEventNamespace","isArray","templates","ajaxUrl","managerInstance","put","singleStart","config","callback","templateId","toInteger","starter","e","isFunction","subscribe","beginStartWorkflow","remove","showTemplates","starterData","showTemplatesMenu","targetNode","isElementNode","isNull","showParametersPopup","autoExecuteType","workflowId","fireEvent","showAutoStartParametersPopup","signedParameters","parameters","sliderOptions","width","cacheable","events","onCloseComplete","componentParams","Uri","addParam","SidePanel","Instance","open","items","template","id","name","title","subtitle","description","entityId","tabs","customData","Dialog","context","multiple","dropdownMode","enableSearch","hideOnSelect","clearSearchOnSelect","hideByEsc","focusOnFirst","showAvatars","compactView","event","deselectAll","getData","item","getCustomData","recentTabOptions","stub","stubOptions","get","allowChangeHistory","slider","getSlider","dictionary","has","formData","notifier","Manager","Set","add","delete","eventName","instances","target","emit","useGlobalNaming","result"],"mappings":"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"}