{"version":3,"file":"faces.bundle.js","sources":["../src/helpers/validators.js","../src/faces.js"],"sourcesContent":["import { Type } from 'main.core';\nimport type { FacesData, WorkflowFacesData } from '../types/workflow-faces';\n\nexport function workflowFacesDataValidator(data: WorkflowFacesData): boolean\n{\n\tif (!Type.isPlainObject(data))\n\t{\n\t\treturn false;\n\t}\n\n\tif (!Type.isStringFilled(data.workflowId))\n\t{\n\t\treturn false;\n\t}\n\n\tif (!Type.isDomNode(data.target))\n\t{\n\t\treturn false;\n\t}\n\n\tif (!Type.isNil(data.targetUserId) && (!Type.isInteger(data.targetUserId) || data.targetUserId <= 0))\n\t{\n\t\treturn false;\n\t}\n\n\treturn validateFacesData(data.data);\n}\n\nexport function validateFacesData(data: FacesData): boolean\n{\n\tif (!Type.isPlainObject(data))\n\t{\n\t\treturn false;\n\t}\n\n\tif (!Type.isArrayFilled(data.steps))\n\t{\n\t\treturn false;\n\t}\n\n\tfor (const step of data.steps)\n\t{\n\t\tif (!Type.isStringFilled(step.id) || !Type.isString(step.name) || !Type.isArray(step.avatars))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst duration = step.duration;\n\t\tif (\n\t\t\t!Type.isString(duration)\n\t\t\t&& (!Type.isNumber(duration) || duration < 0)\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n","import { Summary } from 'bizproc.workflow.faces.summary';\nimport { ajax, Dom, Tag, Text, Type } from 'main.core';\nimport type { FooterType, StackType, StepType } from 'ui.image-stack-steps';\nimport { footerTypeEnum, headerTypeEnum, ImageStackSteps, imageTypeEnum, stackStatusEnum } from 'ui.image-stack-steps';\nimport { validateFacesData, workflowFacesDataValidator } from './helpers/validators';\n\nimport 'ui.design-tokens';\nimport 'ui.icons';\nimport 'ui.icon-set.main';\n\nimport type { Avatar, FacesData, StepData, WorkflowFacesData } from './types/workflow-faces';\n\nimport './css/style.css';\n\nexport type { FacesData, WorkflowFacesData, Avatar };\n\nexport class WorkflowFaces\n{\n\t#target: HTMLElement;\n\t#data: FacesData = {};\n\t#showArrow: boolean = false;\n\t#showTimeStep: boolean = false;\n\t#workflowId: string;\n\t#targetUserId: number;\n\n\t#stack: ImageStackSteps;\n\t#unsubscribePushCallback = null;\n\t#node: null;\n\t#timelineNode: null;\n\t#errorNode: null;\n\n\tconstructor(data: WorkflowFacesData)\n\t{\n\t\tif (!workflowFacesDataValidator(data))\n\t\t{\n\t\t\tthrow new TypeError('Bizproc.Workflow.Faces: data must be correct plain object');\n\t\t}\n\n\t\tthis.#workflowId = data.workflowId;\n\t\tthis.#target = data.target;\n\t\tthis.#targetUserId = data.targetUserId || 0;\n\t\tthis.#data = data.data;\n\n\t\tif (Type.isBoolean(data.showArrow))\n\t\t{\n\t\t\tthis.#showArrow = data.showArrow;\n\t\t}\n\n\t\tif (Type.isBoolean(data.showTimeStep))\n\t\t{\n\t\t\tthis.#showTimeStep = data.showTimeStep;\n\t\t}\n\n\t\tthis.#initStack();\n\t\tif (data.subscribeToPushes && !data.isWorkflowFinished)\n\t\t{\n\t\t\tthis.#subscribeToPushes();\n\t\t}\n\t}\n\n\t#initStack()\n\t{\n\t\tthis.#stack = new ImageStackSteps({ steps: this.#getStackSteps() });\n\t}\n\n\t#getStackSteps(): []\n\t{\n\t\tconst steps = [];\n\t\tthis.#data.steps.forEach((stepData) => {\n\t\t\tsteps.push(this.#createStep(stepData));\n\t\t});\n\n\t\tif (steps.length < 3)\n\t\t{\n\t\t\tfor (let i = steps.length; i < 3; i++)\n\t\t\t{\n\t\t\t\tsteps.push(this.#getStubStep());\n\t\t\t}\n\t\t}\n\n\t\tif (this.#data.progressBox && this.#data.progressBox.progressTasksCount > 0)\n\t\t{\n\t\t\tsteps[0].progressBox = { title: this.#data.progressBox.text };\n\t\t}\n\n\t\treturn steps.map((step, index) => ({ ...step, id: `step-${index}` }));\n\t}\n\n\t#createStep(data: StepData): StepType\n\t{\n\t\treturn {\n\t\t\tid: data.id,\n\t\t\theader: { type: headerTypeEnum.TEXT, data: { text: data.name } },\n\t\t\tstack: this.#getStack(data),\n\t\t\tfooter: this.#getFooter(data),\n\t\t\tstyles: { minWidth: 75 },\n\t\t};\n\t}\n\n\t#getStack(data: StepData): StackType\n\t{\n\t\tconst userStack = this.#getUserStack(data);\n\t\tif (userStack)\n\t\t{\n\t\t\treturn userStack;\n\t\t}\n\n\t\treturn this.#getIconStack(data);\n\t}\n\n\t#getUserStack(data: StepData): ?StackType\n\t{\n\t\tconst images = this.#getStackUserImages(data.avatarsData);\n\t\tif (Type.isArrayFilled(images))\n\t\t{\n\t\t\tconst stack = { images };\n\n\t\t\tlet status = null;\n\t\t\tswitch (data.status)\n\t\t\t{\n\t\t\t\tcase 'wait':\n\t\t\t\t\tstatus = stackStatusEnum.WAIT;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'success':\n\t\t\t\t\tstatus = stackStatusEnum.OK;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'not-success':\n\t\t\t\t\tstatus = stackStatusEnum.CANCEL;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tstatus = null;\n\t\t\t}\n\n\t\t\tif (status)\n\t\t\t{\n\t\t\t\tstack.status = { type: status };\n\t\t\t}\n\n\t\t\treturn stack;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#getStackUserImages(avatars): []\n\t{\n\t\tconst images = [];\n\t\tif (Type.isArrayFilled(avatars))\n\t\t{\n\t\t\tavatars.forEach((avatar) => {\n\t\t\t\tconst userId = Text.toInteger(avatar.id);\n\t\t\t\tif (userId > 0)\n\t\t\t\t{\n\t\t\t\t\timages.push({\n\t\t\t\t\t\ttype: imageTypeEnum.USER,\n\t\t\t\t\t\tdata: { userId, src: String(avatar.avatarUrl || '') },\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn images;\n\t}\n\n\t#getIconStack(data: StepData): StackType\n\t{\n\t\tlet icon = null;\n\t\tlet color = null;\n\t\tswitch (data.id)\n\t\t{\n\t\t\tcase 'completed':\n\t\t\t\ticon = data.success ? 'circle-check' : 'cross-circle-60';\n\t\t\t\tcolor = data.success ? 'var(--ui-color-primary-alt)' : 'var(--ui-color-base-35)';\n\t\t\t\tbreak;\n\t\t\tcase 'running':\n\t\t\t\ticon = 'black-clock';\n\t\t\t\tcolor = 'var(--ui-color-palette-blue-60)';\n\t\t\t\tbreak;\n\t\t\tcase 'done':\n\t\t\t\ticon = 'circle-check';\n\t\t\t\tcolor = 'var(--ui-color-primary-alt)';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\ticon = 'bp';\n\t\t\t\tcolor = 'var(--ui-color-palette-gray-20)';\n\t\t}\n\n\t\treturn { images: [{ type: imageTypeEnum.ICON, data: { icon, color } }] };\n\t}\n\n\t#getFooter(data: StepData): FooterType\n\t{\n\t\tif (\n\t\t\t(Type.isNumber(data.duration) && data.duration > 0)\n\t\t\t|| (data.id === 'running')\n\t\t)\n\t\t{\n\t\t\treturn {\n\t\t\t\ttype: footerTypeEnum.DURATION,\n\t\t\t\tdata: { duration: Text.toInteger(data.duration), realtime: data.id === 'running' },\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\ttype: footerTypeEnum.TEXT,\n\t\t\tdata: { text: String(data.duration) },\n\t\t};\n\t}\n\n\t#getStubStep(): StepType\n\t{\n\t\treturn {\n\t\t\tid: 'stub',\n\t\t\theader: { type: headerTypeEnum.STUB },\n\t\t\tstack: { images: [{ type: imageTypeEnum.USER_STUB }] },\n\t\t\tfooter: { type: footerTypeEnum.STUB },\n\t\t\tstyles: { minWidth: 75 },\n\t\t};\n\t}\n\n\t#subscribeToPushes()\n\t{\n\t\tif (BX.PULL)\n\t\t{\n\t\t\tthis.#unsubscribePushCallback = BX.PULL.subscribe({\n\t\t\t\tmoduleId: 'bizproc',\n\t\t\t\tcommand: 'workflow',\n\t\t\t\tcallback: this.#onWorkflowPush.bind(this),\n\t\t\t});\n\t\t}\n\t}\n\n\t#onWorkflowPush(params)\n\t{\n\t\tif (params && params.eventName === 'UPDATED' && Type.isArrayFilled(params.items))\n\t\t{\n\t\t\tfor (const item of params.items)\n\t\t\t{\n\t\t\t\tif (String(item.id) === this.#workflowId)\n\t\t\t\t{\n\t\t\t\t\tthis.#loadWorkflowFaces();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#loadWorkflowFaces()\n\t{\n\t\tif (this.#target && Type.isDomNode(this.#target) && this.#target.clientHeight > 0)\n\t\t{\n\t\t\tajax.runAction('bizproc.workflow.faces.load', {\n\t\t\t\tdata: {\n\t\t\t\t\tworkflowId: this.#workflowId,\n\t\t\t\t\trunningTaskId: this.#getRunningTaskId(),\n\t\t\t\t\tuserId: this.#targetUserId,\n\t\t\t\t},\n\t\t\t}).then(({ data }) => {\n\t\t\t\tif (Type.isDomNode(this.#errorNode))\n\t\t\t\t{\n\t\t\t\t\tDom.replace(this.#errorNode, this.#node);\n\t\t\t\t\tthis.#errorNode = null;\n\t\t\t\t}\n\n\t\t\t\tthis.updateData(data);\n\t\t\t}).catch(({ errors }) => {\n\t\t\t\tif (Type.isArrayFilled(errors))\n\t\t\t\t{\n\t\t\t\t\tconst firstError = errors.pop();\n\t\t\t\t\tif (firstError.code === 'ACCESS_DENIED')\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.replace(\n\t\t\t\t\t\t\tthis.#node,\n\t\t\t\t\t\t\tthis.#renderError(firstError.message),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.errorMessage = firstError.message;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t#getRunningTaskId(): number\n\t{\n\t\tconst runningStep = this.#data.steps.find((step) => step.id === 'running');\n\t\tif (runningStep)\n\t\t{\n\t\t\treturn runningStep.taskId;\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t#unsubscribeToPushes()\n\t{\n\t\tif (Type.isFunction(this.#unsubscribePushCallback))\n\t\t{\n\t\t\tthis.#unsubscribePushCallback();\n\t\t\tthis.#unsubscribePushCallback = null;\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tif (this.#node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#node = Tag.render`<div class=\"bp-workflow-faces\"></div>`;\n\t\tDom.append(this.#node, this.#target);\n\t\tthis.#stack.renderTo(this.#node);\n\n\t\tif (this.#showArrow)\n\t\t{\n\t\t\tDom.append(Tag.render`<div class=\"bp-workflow-faces-arrow\"></div>`, this.#node);\n\t\t}\n\n\t\tif (this.#showTimeStep && this.#data.timeStep)\n\t\t{\n\t\t\tDom.append(this.#renderTimeline(), this.#node);\n\t\t}\n\t}\n\n\tupdateData(data)\n\t{\n\t\tconst facesData = {\n\t\t\tsteps: data.steps,\n\t\t\tprogressBox: data.progressBox,\n\t\t\ttimeStep: data.timeStep,\n\t\t};\n\n\t\tif (!validateFacesData(facesData))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#data = facesData;\n\n\t\tthis.#getStackSteps().forEach((step) => {\n\t\t\tthis.#stack.updateStep(step, step.id);\n\t\t});\n\n\t\tif (data.isWorkflowFinished)\n\t\t{\n\t\t\tthis.#unsubscribeToPushes();\n\t\t\tif (this.#showTimeStep)\n\t\t\t{\n\t\t\t\tDom.replace(this.#timelineNode, this.#renderTimeline());\n\t\t\t}\n\t\t}\n\t}\n\n\t#renderTimeline(): HTMLElement\n\t{\n\t\tconst timeline = new Summary({\n\t\t\tworkflowId: this.#workflowId,\n\t\t\tdata: this.#data.timeStep,\n\t\t});\n\t\tthis.#timelineNode = timeline.render();\n\n\t\treturn this.#timelineNode;\n\t}\n\n\t#renderError(message: string): HTMLElement\n\t{\n\t\tthis.#errorNode = Tag.render`\n\t\t\t<div class=\"bp-workflow-faces\">\n\t\t\t\t<span class=\"bp-workflow-faces-error-message\">\n\t\t\t\t\t${Text.encode(message)}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#errorNode;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#unsubscribeToPushes();\n\n\t\tthis.#stack.destroy();\n\t\tthis.#stack = null;\n\n\t\tthis.#target = null;\n\t\tthis.#data = null;\n\t\tthis.#workflowId = null;\n\n\t\tDom.clean(this.#timelineNode);\n\t\tthis.#timelineNode = null;\n\t}\n}\n"],"names":["workflowFacesDataValidator","data","Type","isPlainObject","isStringFilled","workflowId","isDomNode","target","isNil","targetUserId","isInteger","validateFacesData","isArrayFilled","steps","step","id","isString","name","isArray","avatars","duration","isNumber","WorkflowFaces","constructor","TypeError","isBoolean","showArrow","showTimeStep","subscribeToPushes","isWorkflowFinished","render","Tag","Dom","append","renderTo","timeStep","updateData","facesData","progressBox","forEach","updateStep","replace","destroy","clean","ImageStackSteps","stepData","push","length","i","progressTasksCount","title","text","map","index","header","type","headerTypeEnum","TEXT","stack","footer","styles","minWidth","userStack","images","avatarsData","status","stackStatusEnum","WAIT","OK","CANCEL","avatar","userId","Text","toInteger","imageTypeEnum","USER","src","String","avatarUrl","icon","color","success","ICON","footerTypeEnum","DURATION","realtime","STUB","USER_STUB","BX","PULL","subscribe","moduleId","command","callback","bind","params","eventName","items","item","clientHeight","ajax","runAction","runningTaskId","then","catch","errors","firstError","pop","code","message","errorMessage","runningStep","find","taskId","isFunction","timeline","Summary","encode"],"mappings":"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"}