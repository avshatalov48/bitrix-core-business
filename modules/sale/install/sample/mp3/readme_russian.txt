
	Установка

1. Убедитесь, что у вас установлена версия модуля Интернет-магазина не ниже 4.0.10

2. Скопируйте содержимое каталога в любую публичную папку на вашем сайте (можно, 
например, создать папку mp3 в корне сайта). Далее будем называть эту папку MP3-папкой.

3. Создайте файл /bitrix/php_interface/init.php, если его еще нет. Вставьте в этот 
файл (вновь созданный или уже существующий) следующий код:
<?
include_once($_SERVER["DOCUMENT_ROOT"]."/mp3/init_vars.php");
?>
изменив путь к файлу init_vars.php на реальный (файл init_vars.php лежит в MP3-папке).

4. Настройте переменные в начале файла init_vars.php, если это необходимо:
$mp3Price - стоимость одной композиции (файла)
$mp3Currency - валюта стоимости одной композиции (файла)
$mp3AccessTimeLength - величина периода времени, в течение которого композиция (файл) доступна
$mp3AccessTimeType - единица измерения периода времени, в течение которого композиция 
	(файл) доступна (возможные значения: I - минута, H - час, D - день, W - неделя, 
	M - месяц, Q - квартал, S - полугодие, Y - год)
$arMP3Sums - массив возможных сумм для занесения на счет покупателем. Имеет вид 
	array(
			код_товара => array(
					"PRICE" => вносимая_сумма,
					"CURRENCY" => валюта_вносимой_суммы
				),
			...
		)
	Каждая сумма является для системы отдельным товаром.

5. Поменяйте в файле .htaccess в MP3-папке путь к файлу download_private.php на правильный.
Если MP3-папкой является папка /mp3/ (относительно корня сайта), то в файле .htaccess 
в MP3-папке должна быть строка
ErrorDocument 404 /mp3/download_private.php

6. Если вы не используете в магазине физическую доставку, убедитесь, что у заказа нет 
свойств с флагом "Использовать как местоположение". Это упростит процедуру заказа. Так же
упростит процедуру заказа, если у вас будет только один тип плательщика для данного сайта.

7. Положите в каталог /original/files/ (путь относительно MP3-папки) продаваемые mp3 файлы.

8. Откройте MP3-папку в браузере.



	Описание

Данный набор файлов является примером организации продажи файлов (на примере mp3 файлов),
а так же примером организации продаж со статических страниц (без формирования каталога
средствами модулей Информационных блоков и Торгового каталога).

Суть продажи файлов состоит в предоставлении временного доступа на скачивание к 
приобретаемым файлам. Оплата доступа производится с внутреннего счета покупателей.
Перед приобретением доступа покупатели должны занести на свой внутренний счет некоторую 
сумму денег, в пределах которой и осуществляется приобретение файлов.

Список файлов формируется автоматически при посещении страницы списка файлов. Скрипт 
сканирует каталог, в котором лежат файлы (по умолчанию каталог /original/files/ 
относительно MP3-папки). Параметры mp3 файлов извлекаются из стандартных тегов mp3 файлов.
Таким образом для добавления файла на продажу достаточно скопировать его в указанный
выше каталог. При этом рекомендуется убедиться, что в файле присутствуют все необходимые
теги. В противном случае отображаемая посетителям информация о файле будет не полной.

Данный пример полнофункционален, за исключением следующих ограничений:
- пример настроен на продажу именно mp3 файлов. Для продажи файлов других типов потребуется
  небольшая модификация исходного кода скриптов;
- все файлы имеют одну и ту же стоимость;
- mp3 файлы не делятся по категориям и представляют собой единый список. В случае 
  необходимости деления файлов по категориям возможно так расширить функциональность 
  сканирования каталога, в котором лежат файлы, чтобы оно соответствующим образом 
  обрабатывало подкаталоги.

Занесение денег на внутренний счет покупателя осуществляется путем покупки одной из сумм,
заданных в массиве $arMP3Sums (настраивается на 4 шаге установки). Покупка осуществляется
стандартным для системы образом, т.е. создается соответствующая запись в корзине и 
пользователь перенаправляется на процедуру оформления заказа. Если для сайта задан только 
один тип плательщика и на одно из свойств заказа не имеет установленного флага 
"Использовать как местоположение" (что логично, так как физическая доставка не осуществляется
и расчитывать ее стоимость не надо), то процедура заказа будет состоять только из трех
шагов (заполнение свойств заказа, выбор платежной системы и подтверждение заказа). Это
верно, конечно, только для стандартной (не кастомизированой) процедуры оформления заказа.

Фактическое занесение средств на внутренний счет покупателя осуществляется при разрешении 
доставки заказа (установке флага "Доставка разрешена").
