{"version":3,"file":"summary.bundle.js","sources":["../src/summary.js"],"sourcesContent":["import { Loc, Tag, Type, Text } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { Timeline } from 'bizproc.workflow.timeline';\n\nimport 'ui.design-tokens';\nimport 'ui.icons';\nimport 'ui.icon-set.main';\n\nimport './css/style.css';\n\nexport type SummaryData = {\n\tworkflowId: string,\n\tdata: {\n\t\tname: string,\n\t\tduration: number,\n\t\tstatus: 'success' | 'wait',\n\t},\n};\n\nexport class Summary\n{\n\t#name: string;\n\t#isFinal: boolean = false;\n\t#workflowId: string;\n\t#durationTexts: {} = {\n\t\tnameBefore: '',\n\t\tvalue: '',\n\t\tnameAfter: '',\n\t};\n\n\tconstructor(props: SummaryData = {})\n\t{\n\t\tif (!Type.isStringFilled(props.workflowId))\n\t\t{\n\t\t\tthrow new TypeError('workflowId must be filled string');\n\t\t}\n\t\tthis.#workflowId = props.workflowId;\n\n\t\tthis.#isFinal = props.data?.status === 'success';\n\t\tthis.#name = Type.isStringFilled(props.data?.name) ? props.data.name : '';\n\n\t\tthis.#calculateDurationTexts(props.data?.duration);\n\t}\n\n\t#calculateDurationTexts(time)\n\t{\n\t\tif (!this.#isFinal)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst duration = (\n\t\t\tType.isNumber(time)\n\t\t\t\t? DateTimeFormat.format(\n\t\t\t\t\t[['s', 'sdiff'], ['i', 'idiff'], ['H', 'Hdiff'], ['d', 'ddiff'], ['m', 'mdiff'], ['Y', 'Ydiff']],\n\t\t\t\t\t0,\n\t\t\t\t\ttime,\n\t\t\t\t)\n\t\t\t\t: null\n\t\t);\n\n\t\tif (duration)\n\t\t{\n\t\t\tconst pattern = /\\d+/;\n\t\t\tconst match = duration.match(pattern);\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tthis.#durationTexts.value = String(match[0]);\n\n\t\t\t\tconst index = duration.indexOf(this.#durationTexts.value);\n\t\t\t\tif (index !== -1)\n\t\t\t\t{\n\t\t\t\t\tthis.#durationTexts.nameBefore = duration.slice(0, index).trim();\n\t\t\t\t\tthis.#durationTexts.nameAfter = duration.slice(index + this.#durationTexts.value.length).trim();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#durationTexts.nameAfter = duration;\n\t\t\t}\n\t\t}\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst title = Text.encode(this.#name);\n\t\tconst footerTitle = Text.encode(Loc.getMessage('BIZPROC_JS_WORKFLOW_FACES_SUMMARY_TIMELINE_MSGVER_1'));\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bp-workflow-faces-summary-item\">\n\t\t\t\t<div class=\"bp-workflow-faces-summary-name\">\n\t\t\t\t\t<div class=\"bp-workflow-faces-summary__text-area\" title=\"${title}\">${title}</div>\n\t\t\t\t</div>\n\t\t\t\t${this.#renderContent()}\n\t\t\t\t<div class=\"bp-workflow-faces-summary__duration\" onclick=\"${this.#openTimeline.bind(this)}\">\n\t\t\t\t\t<div class=\"bp-workflow-faces-summary__text-area\" title=\"${footerTitle}\">${footerTitle}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderContent(): HTMLElement\n\t{\n\t\tif (this.#isFinal)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"bp-workflow-faces-summary__summary\">\n\t\t\t\t\t<div class=\"bp-workflow-faces-summary__summary-name\">${Text.encode(this.#durationTexts.nameBefore)}</div>\n\t\t\t\t\t<div class=\"bp-workflow-faces-summary__summary-value\">${Text.encode(this.#durationTexts.value)}</div>\n\t\t\t\t\t<div class=\"bp-workflow-faces-summary__summary-name\">${Text.encode(this.#durationTexts.nameAfter)}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bp-workflow-faces-summary__icon-wrapper\">\n\t\t\t\t<div class=\"ui-icon-set --clock-2 bp-workflow-faces-summary__icon\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#openTimeline(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t\tTimeline.open({ workflowId: this.#workflowId });\n\t}\n}\n"],"names":["Summary","constructor","props","nameBefore","value","nameAfter","Type","isStringFilled","workflowId","TypeError","data","status","name","duration","render","title","Text","encode","footerTitle","Loc","getMessage","Tag","bind","time","isNumber","DateTimeFormat","format","pattern","match","String","index","indexOf","slice","trim","length","event","stopPropagation","preventDefault","Timeline","open"],"mappings":"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"}