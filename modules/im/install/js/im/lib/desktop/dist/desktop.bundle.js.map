{"version":3,"file":"desktop.bundle.js","sources":["../src/desktop.js"],"sourcesContent":["import {Type} from 'main.core';\n\nexport class Desktop\n{\n\tclientVersion = 0;\n\teventHandlers = {};\n\thtmlWrapperHead = null;\n\n\taddCustomEvent(eventName: string, eventHandler: Function): boolean\n\t{\n\t\tconst realHandler = (event) =>\n\t\t{\n\t\t\teventHandler.apply(window, [...Object.values(event.detail)]);\n\t\t};\n\n\t\tif (!this.eventHandlers[eventName])\n\t\t{\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\t}\n\n\t\tthis.eventHandlers[eventName].push(realHandler);\n\t\twindow.addEventListener(eventName, realHandler);\n\n\t\treturn true;\n\t}\n\n\tremoveCustomEvents(eventName: string): boolean\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.eventHandlers[eventName].forEach(eventHandler =>\n\t\t{\n\t\t\twindow.removeEventListener(eventName, eventHandler);\n\t\t});\n\t\tthis.eventHandlers[eventName] = [];\n\n\t\treturn true;\n\t}\n\n\tonCustomEvent(windowTarget, eventName: string, eventParams: Array<any>): boolean\n\t{\n\t\tif (arguments.length === 2)\n\t\t{\n\t\t\teventParams = eventName\n\t\t\teventName = windowTarget;\n\t\t\twindowTarget = 'all';\n\t\t}\n\t\telse if (arguments.length < 2)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst convertedEventParams = {...eventParams};\n\n\t\tif (windowTarget === 'all')\n\t\t{\n\t\t\tconst mainWindow = opener? opener: top;\n\t\t\tmainWindow.BXWindows.forEach(windowItem => {\n\t\t\t\tif (\n\t\t\t\t\twindowItem &&\n\t\t\t\t\twindowItem.name !== '' &&\n\t\t\t\t\twindowItem.BXDesktopWindow &&\n\t\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent(eventName, convertedEventParams);\n\t\t\t\t}\n\t\t\t});\n\t\t\tmainWindow.BXDesktopWindow.DispatchCustomEvent(eventName, convertedEventParams);\n\t\t}\n\t\telse if (Type.isObject(windowTarget) && windowTarget.hasOwnProperty(\"BXDesktopWindow\"))\n\t\t{\n\t\t\twindowTarget.BXDesktopWindow.DispatchCustomEvent(eventName, convertedEventParams);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst existingWindow = this.findWindow(windowTarget);\n\t\t\tif (existingWindow)\n\t\t\t{\n\t\t\t\texistingWindow.BXDesktopWindow.DispatchCustomEvent(eventName, convertedEventParams);\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfindWindow(name: string = 'main'): Object | void\n\t{\n\t\tconst mainWindow = opener? opener: top;\n\t\tif (name === 'main')\n\t\t{\n\t\t\treturn mainWindow;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn mainWindow.BXWindows.find(windowItem => {\n\t\t\t\treturn windowItem.name === name;\n\t\t\t});\n\t\t}\n\t}\n\n\tsetWindowResizable(enabled: boolean = true): boolean\n\t{\n\t\tBXDesktopWindow.SetProperty(\"resizable\", enabled);\n\n\t\treturn true;\n\t}\n\n\tsetWindowClosable(enabled: boolean = true): boolean\n\t{\n\t\tBXDesktopWindow.SetProperty(\"closable\", enabled);\n\n\t\treturn true;\n\t}\n\n\tsetWindowTitle(title: string): boolean\n\t{\n\t\tif (Type.isUndefined(title))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\ttitle = title.trim();\n\t\tif (title.length <= 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tBXDesktopWindow.SetProperty(\"title\", title);\n\n\t\treturn true;\n\t}\n\n\tsetWindowPosition(params: Object): boolean\n\t{\n\t\tBXDesktopWindow.SetProperty(\"position\", params);\n\n\t\treturn true;\n\t}\n\n\tsetWindowMinSize(params: Object): boolean\n\t{\n\t\tif (!params.Width || !params.Height)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tBXDesktopWindow.SetProperty(\"minClientSize\", params);\n\n\t\treturn true;\n\t}\n\n\tgetHtmlPage(content, jsContent, initImJs, bodyClass: string = ''): string\n\t{\n\t\tif (window.BXIM)\n\t\t{\n\t\t\treturn window.BXIM.desktop.getHtmlPage(content, jsContent, initImJs, bodyClass);\n\t\t}\n\n\t\tcontent = content || '';\n\t\tjsContent = jsContent || '';\n\t\tbodyClass = bodyClass || '';\n\n\t\tif (Type.isDomNode(content))\n\t\t{\n\t\t\tcontent = content.outerHTML;\n\t\t}\n\n\t\tif (Type.isDomNode(jsContent))\n\t\t{\n\t\t\tjsContent = jsContent.outerHTML;\n\t\t}\n\n\t\tif (jsContent !== '')\n\t\t{\n\t\t\tjsContent = '<script>BX.ready(function(){'+jsContent+'});</script>';\n\t\t}\n\n\t\tif (this.isPopupPageLoaded())\n\t\t{\n\t\t\treturn '<div class=\"im-desktop im-desktop-popup '+bodyClass+'\">'+content+jsContent+'</div>';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.htmlWrapperHead == null)\n\t\t\t{\n\t\t\t\tthis.htmlWrapperHead = document.head.outerHTML.replace(/BX\\.PULL\\.start\\([^)]*\\);/g, '');\n\t\t\t}\n\n\t\t\treturn '<!DOCTYPE html><html>'+this.htmlWrapperHead+'<body class=\"im-desktop im-desktop-popup '+bodyClass+'\">'+content+jsContent+'</body></html>';\n\t\t}\n\t}\n\n\tisPopupPageLoaded(): boolean\n\t{\n\t\tif (!this.enableInVersion(45))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (window.BXIM && !window.BXIM.isUtfMode)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!BXInternals)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!BXInternals.PopupTemplate)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (BXInternals.PopupTemplate === '#PLACEHOLDER#')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tenableInVersion(version: number)\n\t{\n\t\tif (Type.isUndefined(BXDesktopSystem))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.getApiVersion() >= parseInt(version);\n\t}\n\n\tgetApiVersion(): number\n\t{\n\t\tif (Type.isUndefined(BXDesktopSystem))\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!this.clientVersion)\n\t\t{\n\t\t\tthis.clientVersion = BXDesktopSystem.GetProperty('versionParts');\n\t\t}\n\n\t\treturn this.clientVersion[3];\n\t}\n\n\tisReady()\n\t{\n\t\treturn typeof(BXDesktopSystem) != \"undefined\";\n\t}\n}"],"names":["Desktop","eventName","eventHandler","realHandler","event","apply","window","Object","values","detail","eventHandlers","push","addEventListener","forEach","removeEventListener","windowTarget","eventParams","arguments","length","convertedEventParams","mainWindow","opener","top","BXWindows","windowItem","name","BXDesktopWindow","DispatchCustomEvent","Type","isObject","hasOwnProperty","existingWindow","findWindow","find","enabled","SetProperty","title","isUndefined","trim","params","Width","Height","content","jsContent","initImJs","bodyClass","BXIM","desktop","getHtmlPage","isDomNode","outerHTML","isPopupPageLoaded","htmlWrapperHead","document","head","replace","enableInVersion","isUtfMode","BXInternals","PopupTemplate","version","BXDesktopSystem","getApiVersion","parseInt","clientVersion","GetProperty"],"mappings":"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"}