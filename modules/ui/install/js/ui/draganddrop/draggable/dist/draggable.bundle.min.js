this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,r){"use strict";var n=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{data:e}))}return t}(r.Event.BaseEvent);var i=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var a=function(e){babelHelpers.inherits(t,e);function t(){var e;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"originalDragStartEvent",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"dragStartEvent",null);e.setEventNamespace("BX.UI.DragAndDrop.Draggable.Sensor");var a=i.dropzone;e.containers=r.Type.isArray(n)?babelHelpers.toConsumableArray(n):[n];e.dropzones=r.Type.isArrayLike(a)?babelHelpers.toConsumableArray(a):[a];e.options=babelHelpers.objectSpread({delay:0},i);return e}babelHelpers.createClass(t,[{key:"getDocument",value:function e(){return this.options.context.document}},{key:"addContainer",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this.containers=[].concat(babelHelpers.toConsumableArray(this.containers),r)}},{key:"removeContainer",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this.containers=this.containers.filter(function(e){return!r.includes(e)})}},{key:"getContainerByChild",value:function e(t){return this.containers.find(function(e){return e.contains(t)})}},{key:"addDropzone",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this.dropzones=[].concat(babelHelpers.toConsumableArray(this.dropzones),r)}},{key:"removeDropzone",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this.dropzones=this.dropzones.filter(function(e){return!r.includes(e)})}},{key:"getDropzoneByChild",value:function e(t){return this.dropzones.find(function(e){return e.contains(t)})}},{key:"getElementFromPoint",value:function e(t,r){return this.getDocument().elementFromPoint(t,r)}},{key:"preventDefaultEventAction",value:function e(t){if(t.cancelable){t.preventDefault()}}},{key:"isDragging",value:function e(){return this.dragStartEvent&&!this.dragStartEvent.isDefaultPrevented()}},{key:"enable",value:function e(){return this}},{key:"disable",value:function e(){return this}},{key:"getDragElementByChild",value:function e(t){if(t){var r=this.options.dragElement;return t.closest(r)||null}return null}}]);return t}(t.EventEmitter);var o=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var s=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var l=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var u=function(e){babelHelpers.inherits(t,e);function t(){var e;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,r,n));e.mousedownTimeoutId=null;e.onMouseDown=e.onMouseDown.bind(babelHelpers.assertThisInitialized(e));e.onMouseMove=e.onMouseMove.bind(babelHelpers.assertThisInitialized(e));e.onMouseUp=e.onMouseUp.bind(babelHelpers.assertThisInitialized(e));e.onDragStart=e.onDragStart.bind(babelHelpers.assertThisInitialized(e));return e}babelHelpers.createClass(t,[{key:"enable",value:function e(){this.getDocument().addEventListener("mousedown",this.onMouseDown,true)}},{key:"disable",value:function e(){this.getDocument().removeEventListener("mousedown",this.onMouseDown,true)}},{key:"startHandleMouseUp",value:function e(){this.getDocument().addEventListener("mouseup",this.onMouseUp)}},{key:"stopHandleMouseUp",value:function e(){this.getDocument().removeEventListener("mouseup",this.onMouseUp)}},{key:"startHandleMouseMove",value:function e(){this.getDocument().addEventListener("mousemove",this.onMouseMove)}},{key:"stopHandleMouseMove",value:function e(){this.getDocument().removeEventListener("mousemove",this.onMouseMove)}},{key:"startPreventContextMenu",value:function e(){this.getDocument().addEventListener("contextmenu",this.preventDefaultEventAction,true)}},{key:"stopPreventContextMenu",value:function e(){this.getDocument().removeEventListener("contextmenu",this.preventDefaultEventAction,true)}},{key:"startPreventNativeDragAndDrop",value:function e(){this.getDocument().addEventListener("dragstart",this.preventDefaultEventAction)}},{key:"stopPreventNativeDragAndDrop",value:function e(){this.getDocument().removeEventListener("dragstart",this.preventDefaultEventAction)}},{key:"onMouseDown",value:function e(t){var r=this;if(!t.ctrlKey&&!t.metaKey&&!t.button){this.originalDragStartEvent=t;var n=this.getContainerByChild(t.target);if(n){var i=this.getDragElementByChild(t.target);if(i){this.startHandleMouseUp();this.startPreventNativeDragAndDrop();this.mousedownTimeoutId=setTimeout(function(){r.onDragStart()},this.options.delay)}}}}},{key:"onDragStart",value:function e(){var t=this.getContainerByChild(this.originalDragStartEvent.target);this.dragStartEvent=new i({clientX:this.originalDragStartEvent.clientX,clientY:this.originalDragStartEvent.clientY,originalSource:this.originalDragStartEvent.target,originalEvent:this.originalDragStartEvent,sourceContainer:t});this.emit("drag:start",this.dragStartEvent);if(this.isDragging()){this.startPreventContextMenu();this.startHandleMouseMove()}}},{key:"onMouseMove",value:function e(t){if(this.isDragging()){var r=t.clientX,n=t.clientY;var i=this.getElementFromPoint(r,n);var a=this.getContainerByChild(i);var s=this.dragStartEvent.data,l=s.originalSource,u=s.sourceContainer;var h=new o({clientX:r,clientY:n,originalSource:l,sourceContainer:u,over:i,overContainer:a,originalEvent:t});this.emit("drag:move",h)}}},{key:"onMouseUp",value:function e(t){clearTimeout(this.mousedownTimeoutId);this.stopHandleMouseUp();this.stopPreventNativeDragAndDrop();if(this.isDragging()){var r=t.clientX,n=t.clientY;var i=this.getElementFromPoint(r,n);var a=this.getContainerByChild(i);var o=this.dragStartEvent.data,u=o.originalSource,h=o.sourceContainer;var c=new s({clientX:r,clientY:n,originalSource:u,sourceContainer:h,over:i,overContainer:a,originalEvent:t});this.emit("drag:end",c);if(!c.isDefaultPrevented()){var v=this.getDropzoneByChild(i);if(v){var p=new l({clientX:r,clientY:n,originalSource:u,sourceContainer:h,over:i,overContainer:a,originalEvent:t,dropzone:v});this.emit("drag:drop",p)}}this.stopPreventContextMenu();this.stopHandleMouseMove()}this.originalDragStartEvent=null}}]);return t}(a);var h=false;window.addEventListener("touchmove",function(e){if(h){e.preventDefault()}},{passive:false});var c=function(e){babelHelpers.inherits(t,e);function t(){var e;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,r,n));e.tapTimeoutId=null;e.touchMoved=false;e.onTouchStart=e.onTouchStart.bind(babelHelpers.assertThisInitialized(e));e.onTouchEnd=e.onTouchEnd.bind(babelHelpers.assertThisInitialized(e));e.onTouchMove=e.onTouchMove.bind(babelHelpers.assertThisInitialized(e));e.onDragStart=e.onDragStart.bind(babelHelpers.assertThisInitialized(e));return e}babelHelpers.createClass(t,[{key:"enable",value:function e(){this.getDocument().addEventListener("touchstart",this.onTouchStart)}},{key:"disable",value:function e(){this.getDocument().removeEventListener("touchstart",this.onTouchStart)}},{key:"isTouchMoved",value:function e(){return this.touchMoved}},{key:"startPreventScrolling",value:function e(){h=true}},{key:"stopPreventScrolling",value:function e(){h=false}},{key:"startPreventContextMenu",value:function e(){this.getDocument().addEventListener("contextmenu",this.preventDefaultEventAction,true)}},{key:"stopPreventContextMenu",value:function e(){this.getDocument().removeEventListener("contextmenu",this.preventDefaultEventAction,true)}},{key:"startHandleTouchEvents",value:function e(){this.getDocument().addEventListener("touchmove",this.onTouchMove);this.getDocument().addEventListener("touchend",this.onTouchEnd);this.getDocument().addEventListener("touchcancel",this.onTouchEnd)}},{key:"stopHandleTouchEvents",value:function e(){this.getDocument().removeEventListener("touchmove",this.onTouchMove);this.getDocument().removeEventListener("touchend",this.onTouchEnd);this.getDocument().removeEventListener("touchcancel",this.onTouchEnd)}},{key:"onTouchStart",value:function e(t){var r=this;var n=this.getContainerByChild(t.target);if(n){var i=this.getDragElementByChild(t.target);if(i){this.originalDragStartEvent=t;this.startHandleTouchEvents();this.startPreventContextMenu();this.startPreventScrolling();this.tapTimeoutId=setTimeout(function(){if(!r.isTouchMoved()){r.onDragStart()}},this.options.delay)}}}},{key:"onDragStart",value:function e(){var t=this.originalDragStartEvent.touches[0]||this.originalDragStartEvent.changedTouches[0];var r=this.getContainerByChild(this.originalDragStartEvent.target);this.dragStartEvent=new i({clientX:t.clientX,clientY:t.clientY,originalSource:this.originalDragStartEvent.target,originalEvent:this.originalDragStartEvent,sourceContainer:r});this.emit("drag:start",this.dragStartEvent)}},{key:"onTouchMove",value:function e(t){this.touchMoved=true;if(this.isDragging()){var r=t.touches[0]||t.changedTouches[0];var n=r.clientX,i=r.clientY;var a=this.getElementFromPoint(n,i);var s=this.getContainerByChild(a);var l=this.dragStartEvent.data,u=l.originalSource,h=l.sourceContainer;var c=new o({clientX:n,clientY:i,originalSource:u,sourceContainer:h,over:a,overContainer:s,originalEvent:t});this.emit("drag:move",c)}}},{key:"onTouchEnd",value:function e(t){clearTimeout(this.tapTimeoutId);this.stopPreventScrolling();this.stopPreventContextMenu();this.stopHandleTouchEvents();if(this.isDragging()){var r=t.touches[0]||t.changedTouches[0];var n=r.clientX,i=r.clientY;var a=this.getElementFromPoint(n,i);var o=this.getContainerByChild(a);var u=this.dragStartEvent.data,h=u.originalSource,c=u.sourceContainer;var v=new s({clientX:n,clientY:i,originalSource:h,sourceContainer:c,over:a,overContainer:o,originalEvent:t});this.emit("drag:end",v);if(!v.isDefaultPrevented()){var p=this.getDropzoneByChild(a);if(p){var g=new l({clientX:n,clientY:i,originalSource:h,sourceContainer:c,over:a,overContainer:o,originalEvent:t,dropzone:p});this.emit("drag:drop",g)}}}this.originalDragStartEvent=null;this.dragStartEvent=null;this.touchMoved=false}}]);return t}(a);var v=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var p=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var g=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var b=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var d=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var f=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var m=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var y=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var D=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var C=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var E=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var H=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);var S=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return t}(n);function O(){var e=babelHelpers.taggedTemplateLiteral(["<div>","</div>"]);O=function t(){return e};return e}function P(){var e=babelHelpers.taggedTemplateLiteral(["<div></div>"]);P=function t(){return e};return e}var k=[u,c];var T=Symbol("options");var w=Symbol("sensors");var M=Symbol("containers");var x=Symbol("dropzones");var A=function(e){babelHelpers.inherits(t,e);function t(){var e;var n;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,i));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),T,{delay:0,sensors:[],draggable:".ui-draggable--item",type:"move",transitionDuration:150,dropzone:[],context:window,offset:{x:0,y:0}});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),M,[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),x,[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),w,[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"dragStartEvent",null);n.setEventNamespace("BX.UI.DragAndDrop.Draggable");n.cache=new r.Cache.MemoryCache;n.onDragStart=n.onDragStart.bind(babelHelpers.assertThisInitialized(n));n.onDragMove=n.onDragMove.bind(babelHelpers.assertThisInitialized(n));n.onDragEnd=n.onDragEnd.bind(babelHelpers.assertThisInitialized(n));n.onDragDrop=n.onDragDrop.bind(babelHelpers.assertThisInitialized(n));if(r.Type.isArray(i.container)||r.Type.isDomNode(i.container)||i.container instanceof NodeList){if(i.container instanceof NodeList){var a;(a=n).addContainer.apply(a,babelHelpers.toConsumableArray(i.container))}else{var o;(o=n).addContainer.apply(o,babelHelpers.toConsumableArray([i.container].flat()))}}else{throw new Error("Option container not a HTMLElement, Array of HTMLElement or NodeList")}if(!r.Type.isNil(i.dropzone)){if(r.Type.isArray(i.dropzone)||r.Type.isDomNode(i.dropzone)||i.dropzone instanceof NodeList){if(i.dropzone instanceof NodeList){var s;(s=n).addDropzone.apply(s,babelHelpers.toConsumableArray(i.dropzone))}else{var l;(l=n).addDropzone.apply(l,babelHelpers.toConsumableArray([i.dropzone].flat()))}}}n.setOptions(babelHelpers.objectSpread({},n.getOptions(),i));var u=n.getOptions(),h=u.sensors;(e=n).addSensor.apply(e,[].concat(k,babelHelpers.toConsumableArray(h)));return n}babelHelpers.createClass(t,[{key:"getDocument",value:function e(){return this.getOptions().context.document}},{key:"getOptions",value:function e(){return this[T]}},{key:"setOptions",value:function e(t){this[T]=babelHelpers.objectSpread({},t);if(!r.Type.isString(this[T].dragElement)){this[T].dragElement=this[T].draggable}if(!r.Type.isPlainObject(this[T].offset)){this[T].offset={x:0,y:0}}if(!r.Type.isNumber(this[T].offset.x)){this[T].offset.x=0}if(!r.Type.isNumber(this[T].offset.y)){this[T].offset.y=0}this.invalidateCache()}},{key:"isDragging",value:function e(){return this.dragStartEvent&&!this.dragStartEvent.isDefaultPrevented()}},{key:"getSensors",value:function e(){return this[w]}},{key:"addSensor",value:function e(){var t=this;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++){n[i]=arguments[i]}var a=n.map(function(e){var r=new e(t.getContainers(),t.getOptions());r.subscribe("drag:start",t.onDragStart);r.subscribe("drag:move",t.onDragMove);r.subscribe("drag:end",t.onDragEnd);r.subscribe("drag:drop",t.onDragDrop);r.enable();return r});this[w]=[].concat(babelHelpers.toConsumableArray(this.getSensors()),babelHelpers.toConsumableArray(a))}},{key:"removeSensor",value:function e(){var t=this;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++){n[i]=arguments[i]}var a=this.getSensors().filter(function(e){return n.includes(e.constructor)});a.forEach(function(e){e.unsubscribe("drag:start",t.onDragStart);e.unsubscribe("drag:move",t.onDragMove);e.unsubscribe("drag:end",t.onDragEnd);e.unsubscribe("drag:drop",t.onDragDrop);e.enable()});this[w]=this.getSensors().filter(function(e){return!a.includes(e)})}},{key:"getContainers",value:function e(){return this[M]}},{key:"getContainerByChild",value:function e(t){return this.getContainers().find(function(e){return e.contains(t)})}},{key:"addContainer",value:function e(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++){n[i]=arguments[i]}this[M]=[].concat(babelHelpers.toConsumableArray(this.getContainers()),n);this[M].forEach(function(e){r.Dom.addClass(e,"ui-draggable--container")});this.getSensors().forEach(function(e){e.addContainer.apply(e,n)});this.invalidateContainersCache()}},{key:"removeContainer",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this[M]=this.getContainers().filter(function(e){return!r.includes(e)});this.getSensors().forEach(function(e){e.removeContainer.apply(e,r)});this.invalidateContainersCache()}},{key:"getDropzones",value:function e(){return this[x]}},{key:"getDropzoneByChild",value:function e(t){return this.getDropzones().find(function(e){return e.contains(t)})}},{key:"addDropzone",value:function e(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++){n[i]=arguments[i]}this[x]=[].concat(babelHelpers.toConsumableArray(this.getDropzones()),n);this[x].forEach(function(e){r.Dom.addClass(e,"ui-draggable--dropzone")});this.getSensors().forEach(function(e){e.addDropzone.apply(e,n)})}},{key:"removeDropzone",value:function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}this[x]=this.getContainers().filter(function(e){return!r.includes(e)});this.getSensors().forEach(function(e){e.removeDropzone.apply(e,r)})}},{key:"getDraggableElements",value:function e(){var t=this;return this.cache.remember("draggableElements",function(){return t.getContainers().reduce(function(e,r){return[].concat(babelHelpers.toConsumableArray(e),babelHelpers.toConsumableArray(t.getDraggableElementsOfContainer(r)))},[])})}},{key:"getDraggableElementsOfContainer",value:function e(t){var r=this;return this.cache.remember(t,function(){var e=r.getOptions().draggable;var n=":not(.ui-draggable--draggable)";var i=":not(.ui-draggable--drop-preview)";var a="".concat(n).concat(i);var o="".concat(e).concat(a);var s=babelHelpers.toConsumableArray(t.querySelectorAll(o));return s.filter(function(e){return e.parentElement===t})})}},{key:"getLastDraggableElementOfContainer",value:function e(t){var r=this.getDraggableElementsOfContainer(t);return r[r.length-1]||null}},{key:"getElementIndex",value:function e(t){return this.getDraggableElements().indexOf(t)}},{key:"getDropPreview",value:function e(){var n=this;return this.cache.remember("dropPreview",function(){var e=n.getOptions(),i=e.type;var a=n.getSource();var o=n.getSourceClientRect();var s;if(i===t.CLONE){s=r.Runtime.clone(a);r.Dom.addClass(s,"ui-draggable--drop-preview-clone")}else{s=r.Tag.render(P())}r.Dom.addClass(s,"ui-draggable--drop-preview");r.Dom.style(s,{width:"".concat(o.width,"px"),height:"".concat(o.height,"px")});return s})}},{key:"move",value:function e(t,n){var i=n.x,a=i===void 0?0:i,o=n.y,s=o===void 0?0:o;var l=this.getOptions(),u=l.transitionDuration;requestAnimationFrame(function(){r.Dom.style(t,{transform:"translate3d(".concat(a,"px, ").concat(s,"px, 0px)"),transition:"all ".concat(u,"ms ease 0s")})})}},{key:"setSource",value:function e(t){this.cache.set("source",t||null)}},{key:"getSource",value:function e(){return this.cache.get("source")||null}},{key:"getSourceClientRect",value:function e(){var t=this;return this.cache.remember("sourceClientRect",function(){return t.cache.get("source").getBoundingClientRect()})}},{key:"adjustDropPreview",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var i=n.x,a=i===void 0?false:i,o=n.y,s=o===void 0?false:o,l=n.force,u=l===void 0?true:l,h=n.skipOffset,c=h===void 0?false:h,v=n.transition,p=v===void 0?true:v;var g=this.getDropPreview();var b=r.Dom.getRelativePosition(t,t.parentElement);var d=r.Dom.getRelativePosition(g,g.parentElement);var f=0;if(d.height!==0&&!c){if(b.height>d.height){if(b.top>d.top){f=b.height-d.height}}else if(b.top>d.top){f=-Math.abs(b.height-d.height)}}var m=this.getOptions(),y=m.transitionDuration;var D=function e(){var t={transition:p?"all ".concat(y,"ms ease 0ms"):"null"};if(s){t.top="".concat(b.top+f,"px")}if(a){t.left="".concat(b.left,"px")}r.Dom.style(g,t)};if(u){D()}else{requestAnimationFrame(D)}}},{key:"showDropPreviewAfter",value:function e(t){var n=this;var i=r.Dom.getRelativePosition(t,t.parentElement);var a=r.Text.toNumber(r.Dom.style(t,"margin-bottom"));var o=r.Text.toNumber(r.Dom.style(t,"margin-top"));var s=i.bottom+a+o;var l=this.getOptions(),u=l.transitionDuration;requestAnimationFrame(function(){r.Dom.style(n.getDropPreview(),{top:"".concat(s,"px"),transition:"all ".concat(u,"ms ease 0s")})})}},{key:"pushDraggableElementToContainer",value:function e(t,n){var i=this.getLastDraggableElementOfContainer(n);if(i){r.Dom.insertAfter(t,i)}else{r.Dom.append(t,n)}this.invalidateContainersCache()}},{key:"resetDraggableElementsPosition",value:function e(t){var n=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},a=i.transition,o=a===void 0?true:a;var s=function(){if(t){return n.getDraggableElementsOfContainer(t)}return n.getDraggableElements()}();s.forEach(function(e){r.Dom.style(e,{transform:null,transition:!o?"none":undefined})})}},{key:"resetDraggableElementsTransition",value:function e(t){var n=this;var i=function(){if(t){return n.getDraggableElementsOfContainer(t)}return n.getDraggableElements()}();i.forEach(function(e){r.Dom.style(e,{transition:null})})}},{key:"getSortOffsetY",value:function e(){var t=this;return this.cache.remember("sortOffsetY",function(){var e=t.getSource();var n=t.getSourceClientRect();var i=r.Text.toNumber(r.Dom.style(e,"margin-top"));var a=r.Text.toNumber(r.Dom.style(e,"margin-bottom"));return n.height+(i+a)})}},{key:"getSortOffsetX",value:function e(){var t=this;return this.cache.remember("sortOffsetX",function(){var e=t.getSource();var n=t.getSourceClientRect();var i=r.Text.toNumber(r.Dom.style(e,"margin-left"));var a=r.Text.toNumber(r.Dom.style(e,"margin-right"));return n.width+(i+a)})}},{key:"getElementMiddlePoint",value:function e(t){var r=t.getBoundingClientRect();return{x:r.left+r.width/2,y:r.top+r.height/2}}},{key:"getDraggableElementByChild",value:function e(t){return t.closest(this.getOptions().draggable)}},{key:"splitDraggableElementsListByPoint",value:function e(t,r){var n=this;var i=true;return this.getDraggableElementsOfContainer(t).reduce(function(e,t){if(i){var a=n.getElementMiddlePoint(t);if(a.y<r.y){e[0].push(t)}else{e[1].push(t);i=false}}else{e[1].push(t)}return e},[[],[]])}},{key:"invalidateContainersCache",value:function e(){var t=this;this.cache.delete("draggableElements");this.getContainers().forEach(function(e){return t.cache.delete(e)})}},{key:"invalidateCache",value:function e(){this.cache.delete("source");this.cache.delete("sourceClientRect");this.cache.delete("dropPreview");this.cache.delete("sortOffsetY");this.cache.delete("sortOffsetX");this.cache.delete("sourceLeftOffset");this.cache.delete("sourceLeftMargin");this.invalidateContainersCache()}},{key:"isDepthEditorEnabled",value:function e(){var n=this.getOptions(),i=n.depth,a=n.type;return r.Type.isPlainObject(i)&&(a===t.DROP_PREVIEW||a===t.CLONE)}},{key:"getDepthProperty",value:function e(){var t=this.getOptions(),r=t.depth;return r.property||"margin-left"}},{key:"getDepthMargin",value:function e(){var t=this.getOptions(),n=t.depth;return r.Text.toNumber(n.margin)||20}},{key:"getElementDepth",value:function e(t){return r.Text.toNumber(r.Dom.attr(t,"data-depth"))}},{key:"setElementDepth",value:function e(t,n){r.Dom.attr(t,"data-depth",n);var i=this.getDepthMargin();var a=this.getSourceLeftMargin();var o=i*n+a;r.Dom.style(t,this.getDepthProperty(),"".concat(o,"px"))}},{key:"getStartSourceDepth",value:function e(){return this.dragStartEvent.data.sourceDepth}},{key:"getSourceWidth",value:function e(){return this.getSourceClientRect().width}},{key:"getSourceLeftOffset",value:function e(){var t=this;return this.cache.remember("sourceLeftOffset",function(){var e=t.getSource();var n=r.Dom.getRelativePosition(e,e.parentElement);var i=t.getStartSourceDepth()*t.getDepthMargin();return n.left-i})}},{key:"getSourceLeftMargin",value:function e(){var t=this;return this.cache.remember("sourceLeftMargin",function(){var e=t.getSource();var n=t.getStartSourceDepth();var i=t.getDepthMargin();var a=n*i;var o=r.Text.toNumber(r.Dom.style(e,t.getDepthProperty()));return o-a})}},{key:"setDropPreviewDepth",value:function e(t){var n=this.getStartSourceDepth();var i=this.getSourceWidth();var a=this.getDepthMargin();var o=this.getSourceLeftOffset();var s=function(){var e=Math.abs(n-t);if(t>n){return i-e*a}if(t<n){return i+e*a}return i}();r.Dom.style(this.getDropPreview(),{left:"".concat(t*a+o,"px"),width:"".concat(s,"px")})}},{key:"calcDepthByOffset",value:function e(t){var r=this.getStartSourceDepth();var n=this.getDepthMargin();var i=r*n;return Math.max(0,Math.floor((t+i)/n))}},{key:"getChildren",value:function e(t){var r=this;var n=this.getElementDepth(t);var i=t.getBoundingClientRect();var a=this.getContainerByChild(t);var o=this.splitDraggableElementsListByPoint(a,{x:i.left,y:i.bottom}),s=babelHelpers.slicedToArray(o,2),l=s[1];var u=false;return l.reduce(function(e,t){if(!u){var i=r.getElementDepth(t);if(i>n){return[].concat(babelHelpers.toConsumableArray(e),[t])}u=true}return e},[])}},{key:"getPreviousElement",value:function e(t){var n=t.getBoundingClientRect();var i=this.getContainerByChild(t);var a=this.splitDraggableElementsListByPoint(i,{x:n.left,y:n.top}),o=babelHelpers.slicedToArray(a,1),s=o[0];if(r.Type.isArrayFilled(s)){return s.pop()}return null}},{key:"onDragStart",value:function e(n){var i=n.data,a=i.originalSource,o=i.sourceContainer,s=i.clientX,l=i.clientY;var u=this.getDraggableElementByChild(a);this.setSource(u);var h=this.getElementDepth(u);var c=this.getSourceClientRect();var p=s-c.left;var g=l-c.top;var b=this.getOptions(),d=b.type;var f=u;if(d!==t.HEADLESS){var m=r.Runtime.clone(u);r.Dom.style(m,"margin",0);f=r.Tag.render(O(),m);r.Dom.style(f,{width:"".concat(c.width,"px"),height:"".concat(c.height,"px"),top:"".concat(l-g+this.getOptions().offset.y,"px"),left:"".concat(s-p+this.getOptions().offset.x,"px")});r.Dom.addClass(f,"ui-draggable--draggable");this.pushDraggableElementToContainer(f,o);if(this.isDepthEditorEnabled()){var y=this.getChildren(u);this.childrenElements=y;if(y.length>0){r.Dom.append(r.Runtime.clone(m),f);y.forEach(function(e){r.Dom.style(e,"display","none")})}}}var D=this.getDropPreview();if(d===t.DROP_PREVIEW||d===t.CLONE){this.pushDraggableElementToContainer(D,o);this.adjustDropPreview(u,{force:true,x:true,y:true,transition:false})}r.Dom.addClass(u,"ui-draggable--source");r.Dom.addClass(this.getDocument().body,"ui-draggable--disable-user-select");r.Dom.addClass(this.getDocument().body,"ui-draggable--type-".concat(this.getOptions().type));var C=this.getElementIndex(u);this.dragStartEvent=new v({clientX:s,clientY:l,pointerOffsetX:p,pointerOffsetY:g,draggable:f,dropPreview:D,source:u,sourceIndex:C,sourceContainer:o,sourceDepth:h,originalSource:a});this.emit("start",this.dragStartEvent);if(this.dragStartEvent.isDefaultPrevented()){n.preventDefault()}}},{key:"onDragMove",value:function e(n){var i=this;if(!this.isDragging()){return}var a=n.data,o=a.clientX,s=a.clientY,l=a.sourceContainer,u=a.originalSource;var h=this.dragStartEvent.data,c=h.clientX,v=h.clientY,D=h.pointerOffsetX,S=h.pointerOffsetY,O=h.source,P=h.sourceIndex,k=h.draggable,T=h.dropPreview;var w=o-c;var M=s-v;var x=new p({clientX:o,clientY:s,offsetX:w,offsetY:M,pointerOffsetX:D,pointerOffsetY:S,draggable:k,dropPreview:T,source:O,sourceIndex:P,sourceContainer:l,originalSource:u});this.emit("move",x);if(x.isDefaultPrevented()){n.preventDefault()}if(!r.Type.isDomNode(n.data.over)){return}var A=n.data.over;var z=this.getDraggableElementByChild(A);var L=this.getContainerByChild(A);var R=this.getOptions(),B=R.type;if(B!==t.HEADLESS){r.Dom.style(k,{top:"".concat(s-S+this.getOptions().offset.y,"px"),left:"".concat(o-D+this.getOptions().offset.x,"px")});if(L&&L.contains(O)&&!this.stopMove){var I=this.getSortOffsetY();var X=this.getDraggableElementsOfContainer(L);var N=X.indexOf(O);X.forEach(function(e,t){if(e!==O){var r=e.style.transform;var n=i.getElementMiddlePoint(e);if(n.y===0){return}if(t>N&&s>n.y&&r!=="translate3d(0px, ".concat(-I,"px, 0px)")){i.adjustDropPreview(e,{y:true});i.move(e,{y:-I});i.insertType="after";i.insertElement=e}if(t<N&&s<n.y&&r!=="translate3d(0px, ".concat(I,"px, 0px)")){i.adjustDropPreview(e,{y:true});i.move(e,{y:I});i.insertType="before";i.insertElement=e}if((t<N&&s>n.y||t>N&&s<n.y)&&r!=="translate3d(0px, 0px, 0px)"&&r!==""){i.adjustDropPreview(e,{y:true});i.move(e,{y:0});i.insertElement=e;if(t<N&&s>n.y){i.insertType="after"}if(t>N&&s<n.y){i.insertType="before"}}}})}}if(this.isDepthEditorEnabled()){var Y=this.calcDepthByOffset(w);var j=this.getPreviousElement(T);if(j){var U=this.getElementDepth(j);var F=0;var W=Math.max(F,U+1);Y=Math.max(F,Math.min(Y,W))}else{Y=0}this.setDropPreviewDepth(Y);this.currentDepth=Y}if(r.Type.isDomNode(z)&&O!==z){var V=new g(babelHelpers.objectSpread({},x.data,{over:z,originalOver:A,overContainer:L}));this.emit("over",V);if(!V.isDefaultPrevented()){r.Dom.addClass(z,"ui-draggable--over")}if(z!==this.lastOver){var _=new d(babelHelpers.objectSpread({},x.data,{enter:z,enterContainer:L}));this.emit("enter",_)}}this.lastOver=this.lastOver||z;if(!z||z!==this.lastOver){if(this.lastOver){var q=this.getContainerByChild(this.lastOver);var K=new m(babelHelpers.objectSpread({},x,{out:this.lastOver,outContainer:q}));this.emit("out",K);r.Dom.removeClass(this.lastOver,"ui-draggable--over")}this.lastOver=z}var G=this.getDocument().elementFromPoint(o,s);var J=this.getDropzoneByChild(G);if(J){var Q=new C(babelHelpers.objectSpread({},x.data,{dropzone:J}));this.emit("dropzone:over",Q);if(J!==this.lastOverDropzone){var Z=new E(babelHelpers.objectSpread({},x.data,{dropzone:J}));this.emit("dropzone:enter",Z)}}this.lastOverDropzone=this.lastOverDropzone||J;if(J!==this.lastOverDropzone){var $=new H(babelHelpers.objectSpread({},x.data,{dropzone:this.lastOverDropzone}));this.emit("dropzone:out",$);this.lastOverDropzone=J}if(L){var ee=new b(babelHelpers.objectSpread({},x.data,{over:L}));this.emit("container:over",ee);if(L!==this.lastOverContainer){var te=new f(babelHelpers.objectSpread({},x.data,{enter:L}));this.emit("container:enter",te);if(!L.contains(O)){var re=this.getContainerByChild(O);var ne=this.splitDraggableElementsListByPoint(L,{x:o,y:s}),ie=babelHelpers.slicedToArray(ne,2),ae=ie[0],oe=ie[1];if(B===t.DROP_PREVIEW||B===t.CLONE){this.stopMove=true;setTimeout(function(){i.stopMove=false},300);this.pushDraggableElementToContainer(this.getDropPreview(),L)}if(B!==t.HEADLESS){this.pushDraggableElementToContainer(O,L)}if(r.Type.isArrayFilled(ae)){var se=ae[ae.length-1];if(B===t.DROP_PREVIEW||B===t.CLONE){this.showDropPreviewAfter(se)}this.insertType="after";this.insertElement=se}else if(r.Type.isArrayFilled(oe)){var le=babelHelpers.slicedToArray(oe,1),ue=le[0];if(B===t.DROP_PREVIEW||B===t.CLONE){this.adjustDropPreview(oe)}this.insertType="before";this.insertElement=ue}this.resetDraggableElementsTransition(re);this.resetDraggableElementsPosition(re);if(B!==t.HEADLESS){if(r.Type.isArrayFilled(oe)){var he=this.getSortOffsetY();oe.forEach(function(e){i.move(e,{y:he})})}}}}}this.lastOverContainer=this.lastOverContainer||L;if(L!==this.lastOverContainer){var ce=new y(babelHelpers.objectSpread({},x.data,{out:this.lastOverContainer}));this.emit("container:out",ce);this.lastOverContainer=L}}},{key:"onDragEnd",value:function e(n){var i=this;var a=new D(babelHelpers.objectSpread({},this.dragStartEvent.data,{clientX:n.data.clientX,clientY:n.data.clientY,end:this.lastOver,endContainer:this.lastOverContainer}));var o=this.dragStartEvent.data,s=o.source,l=o.draggable;if(this.getOptions().type!==t.HEADLESS){r.Dom.remove(l)}r.Dom.removeClass(s,"ui-draggable--source");this.getDraggableElements().forEach(function(e){r.Dom.removeClass(e,"ui-draggable--draggable");r.Dom.removeClass(e,"ui-draggable--over")});r.Dom.remove(this.getDropPreview());this.resetDraggableElementsPosition();this.resetDraggableElementsTransition();if(this.getOptions().type!==t.HEADLESS){if(r.Type.isString(this.insertType)){if(this.insertType==="after"){r.Dom.insertAfter(s,this.insertElement)}else{r.Dom.insertBefore(s,this.insertElement)}}}if(this.isDepthEditorEnabled()){var u=this.getStartSourceDepth();var h=function(){if(r.Type.isNumber(i.currentDepth)){return i.currentDepth-u}return 0}();var c=s;this.childrenElements.forEach(function(e){var t=i.getElementDepth(e);i.setElementDepth(e,t+h);r.Dom.insertAfter(e,c);r.Dom.style(e,"display",null);c=e});if(r.Type.isNumber(this.currentDepth)){this.setElementDepth(s,this.currentDepth)}}this.lastOver=null;this.lastOverContainer=null;this.insertType=null;this.lastOverDropzone=null;this.childrenElements=[];this.currentDepth=null;this.invalidateCache();r.Dom.removeClass(this.getDocument().body,"ui-draggable--disable-user-select");r.Dom.removeClass(this.getDocument().body,"ui-draggable--type-".concat(this.getOptions().type));this.emit("end",a)}},{key:"onDragDrop",value:function e(t){var r=new S(babelHelpers.objectSpread({},this.dragStartEvent.data,{clientX:t.data.clientX,clientY:t.data.clientY,dropzone:t.data.dropzone}));this.emit("drop",r)}}]);return t}(t.EventEmitter);babelHelpers.defineProperty(A,"MOVE","move");babelHelpers.defineProperty(A,"CLONE","clone");babelHelpers.defineProperty(A,"DROP_PREVIEW","drop-preview");babelHelpers.defineProperty(A,"HEADLESS","headless");e.Draggable=A;e.DragStartEvent=v;e.DragMoveEvent=p;e.DragOutEvent=m;e.DragOutContainerEvent=y;e.DragEndEvent=D;e.DragOverEvent=g;e.DragOverContainerEvent=b;e.DragEnterEvent=d;e.DragEnterContainerEvent=f})(this.BX.UI.DragAndDrop=this.BX.UI.DragAndDrop||{},BX.Event,BX);
//# sourceMappingURL=draggable.bundle.map.js