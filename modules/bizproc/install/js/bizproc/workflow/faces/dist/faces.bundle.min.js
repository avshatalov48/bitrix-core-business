this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,s,a,l){"use strict";function t(e){if(!l.Type.isPlainObject(e)){return false}if(!l.Type.isStringFilled(e.workflowId)){return false}if(!l.Type.isDomNode(e.target)){return false}if(!l.Type.isInteger(e.targetUserId)||e.targetUserId<=0){return false}return r(e.data)}function r(e){if(!l.Type.isPlainObject(e)){return false}const s=e.avatars;if(!l.Type.isPlainObject(s)||!l.Type.isArrayFilled(s.author)||!l.Type.isArray(s.running)||!l.Type.isArray(s.completed)||!l.Type.isArray(s.done)){return false}const a=e.statuses;if(!l.Type.isPlainObject(a)){return false}const t=e.time;if(!l.Type.isPlainObject(t)||!i(t.author)||!i(t.running)||!i(t.completed)||!i(t.done)||!i(t.total)){return false}return true}const i=e=>l.Type.isNull(e)||e===0||l.Text.toInteger(e)>0;let o=e=>e,b,c,d;var p=babelHelpers.classPrivateFieldLooseKey("target");var n=babelHelpers.classPrivateFieldLooseKey("data");var v=babelHelpers.classPrivateFieldLooseKey("showArrow");var u=babelHelpers.classPrivateFieldLooseKey("showTimeline");var h=babelHelpers.classPrivateFieldLooseKey("workflowId");var P=babelHelpers.classPrivateFieldLooseKey("targetUserId");var F=babelHelpers.classPrivateFieldLooseKey("stack");var L=babelHelpers.classPrivateFieldLooseKey("unsubscribePushCallback");var f=babelHelpers.classPrivateFieldLooseKey("node");var y=babelHelpers.classPrivateFieldLooseKey("timelineNode");var B=babelHelpers.classPrivateFieldLooseKey("errorNode");var H=babelHelpers.classPrivateFieldLooseKey("initStack");var m=babelHelpers.classPrivateFieldLooseKey("getStackSteps");var T=babelHelpers.classPrivateFieldLooseKey("getAuthorStep");var g=babelHelpers.classPrivateFieldLooseKey("getHiddenTaskCount");var w=babelHelpers.classPrivateFieldLooseKey("getRunningStep");var O=babelHelpers.classPrivateFieldLooseKey("getCompletedStep");var E=babelHelpers.classPrivateFieldLooseKey("getDoneStep");var k=babelHelpers.classPrivateFieldLooseKey("getStubStep");var I=babelHelpers.classPrivateFieldLooseKey("getStackUserImages");var S=babelHelpers.classPrivateFieldLooseKey("getFooterDuration");var C=babelHelpers.classPrivateFieldLooseKey("subscribeToPushes");var K=babelHelpers.classPrivateFieldLooseKey("onWorkflowPush");var j=babelHelpers.classPrivateFieldLooseKey("loadWorkflowFaces");var _=babelHelpers.classPrivateFieldLooseKey("unsubscribeToPushes");var A=babelHelpers.classPrivateFieldLooseKey("renderTimeline");var N=babelHelpers.classPrivateFieldLooseKey("renderError");class U{constructor(e){Object.defineProperty(this,N,{value:ee});Object.defineProperty(this,A,{value:V});Object.defineProperty(this,_,{value:Q});Object.defineProperty(this,j,{value:q});Object.defineProperty(this,K,{value:Y});Object.defineProperty(this,C,{value:G});Object.defineProperty(this,S,{value:$});Object.defineProperty(this,I,{value:Z});Object.defineProperty(this,k,{value:J});Object.defineProperty(this,E,{value:z});Object.defineProperty(this,O,{value:x});Object.defineProperty(this,w,{value:M});Object.defineProperty(this,g,{value:X});Object.defineProperty(this,T,{value:W});Object.defineProperty(this,m,{value:R});Object.defineProperty(this,H,{value:D});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:{}});Object.defineProperty(this,v,{writable:true,value:false});Object.defineProperty(this,u,{writable:true,value:false});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:null});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});if(!t(e)){throw new TypeError("Bizproc.Workflow.Faces: data must be correct plain object",e)}babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.workflowId;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e.target;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e.targetUserId;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.data;if(l.Type.isBoolean(e.showArrow)){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.showArrow}if(l.Type.isBoolean(e.showTimeline)){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e.showTimeline}babelHelpers.classPrivateFieldLooseBase(this,H)[H]();if(e.subscribeToPushes){babelHelpers.classPrivateFieldLooseBase(this,C)[C]()}}render(){if(babelHelpers.classPrivateFieldLooseBase(this,f)[f]){return}babelHelpers.classPrivateFieldLooseBase(this,f)[f]=l.Tag.render(b||(b=o`<div class="bp-workflow-faces"></div>`));l.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,f)[f],babelHelpers.classPrivateFieldLooseBase(this,p)[p]);babelHelpers.classPrivateFieldLooseBase(this,F)[F].renderTo(babelHelpers.classPrivateFieldLooseBase(this,f)[f]);if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]){l.Dom.append(l.Tag.render(c||(c=o`<div class="bp-workflow-faces-arrow"></div>`)),babelHelpers.classPrivateFieldLooseBase(this,f)[f])}if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]){l.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,A)[A](),babelHelpers.classPrivateFieldLooseBase(this,f)[f])}}updateData(e){if(!r(e)){return}babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e;babelHelpers.classPrivateFieldLooseBase(this,m)[m]().forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,F)[F].updateStep(e,e.id)}));if(babelHelpers.classPrivateFieldLooseBase(this,n)[n].workflowIsCompleted){babelHelpers.classPrivateFieldLooseBase(this,_)[_]();if(babelHelpers.classPrivateFieldLooseBase(this,u)[u]){l.Dom.replace(babelHelpers.classPrivateFieldLooseBase(this,y)[y],babelHelpers.classPrivateFieldLooseBase(this,A)[A]())}}}destroy(){babelHelpers.classPrivateFieldLooseBase(this,_)[_]();babelHelpers.classPrivateFieldLooseBase(this,F)[F].destroy();babelHelpers.classPrivateFieldLooseBase(this,F)[F]=null;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=null;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=null;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=null;l.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,y)[y]);babelHelpers.classPrivateFieldLooseBase(this,y)[y]=null}}function D(){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=new a.ImageStackSteps({steps:babelHelpers.classPrivateFieldLooseBase(this,m)[m]()})}function R(){const e=[babelHelpers.classPrivateFieldLooseBase(this,T)[T]()];if(l.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,n)[n].avatars.completed)){e.push(babelHelpers.classPrivateFieldLooseBase(this,O)[O]())}if(babelHelpers.classPrivateFieldLooseBase(this,n)[n].workflowIsCompleted){e.push(babelHelpers.classPrivateFieldLooseBase(this,E)[E]())}else{e.push(babelHelpers.classPrivateFieldLooseBase(this,w)[w]())}if(e.length===2){e.push(babelHelpers.classPrivateFieldLooseBase(this,k)[k]())}return e.map(((e,s)=>({...e,id:`step-${s}`})))}function W(){const e={images:[{type:a.imageTypeEnum.ICON,data:{icon:"bp",color:"var(--ui-color-palette-gray-20)"}}]};const s=babelHelpers.classPrivateFieldLooseBase(this,n)[n].avatars.author[0];const t=l.Text.toInteger(s.id);if(t>0){e.images=[{type:a.imageTypeEnum.USER,data:{src:String(s.avatarUrl||""),userId:t}}]}const r={id:"author",header:{type:a.headerTypeEnum.TEXT,data:{text:l.Loc.getMessage("BIZPROC_JS_WORKFLOW_FACES_COLUMN_AUTHOR")}},stack:e,footer:babelHelpers.classPrivateFieldLooseBase(this,S)[S](babelHelpers.classPrivateFieldLooseBase(this,n)[n].time.author)};const i=babelHelpers.classPrivateFieldLooseBase(this,g)[g]();if(i>0){r.progressBox={title:l.Loc.getMessage("BIZPROC_JS_WORKFLOW_COMPLETED_TASK_COUNT",{"#COUNT#":i})}}return r}function X(){const e=l.Text.toInteger(babelHelpers.classPrivateFieldLooseBase(this,n)[n].completedTaskCount);if(babelHelpers.classPrivateFieldLooseBase(this,n)[n].workflowIsCompleted){return e>2?e-2:0}return e>1?e-1:0}function M(){const e={images:[{type:a.imageTypeEnum.ICON,data:{icon:"black-clock",color:"var(--ui-color-palette-blue-60)"}}]};const s=babelHelpers.classPrivateFieldLooseBase(this,I)[I](babelHelpers.classPrivateFieldLooseBase(this,n)[n].avatars.running);if(l.Type.isArrayFilled(s)){e.images=s;e.status={type:a.stackStatusEnum.WAIT}}return{id:"running",header:{type:a.headerTypeEnum.TEXT,data:{text:l.Loc.getMessage("BIZPROC_JS_WORKFLOW_FACES_COLUMN_RUNNING")}},stack:e,footer:{type:a.footerTypeEnum.DURATION,data:{duration:babelHelpers.classPrivateFieldLooseBase(this,n)[n].time.running,realtime:true}}}}function x(){const e=l.Text.toBoolean(babelHelpers.classPrivateFieldLooseBase(this,n)[n].statuses.completedSuccess);const s={images:[{type:a.imageTypeEnum.ICON,data:{icon:e?"circle-check":"cross-circle-60",color:e?"var(--ui-color-primary-alt)":"var(--ui-color-base-35)"}}]};const t=babelHelpers.classPrivateFieldLooseBase(this,I)[I](babelHelpers.classPrivateFieldLooseBase(this,n)[n].avatars.completed);if(l.Type.isArrayFilled(t)){s.images=t;s.status={type:e?a.stackStatusEnum.OK:a.stackStatusEnum.CANCEL}}return{id:"completed",header:{type:a.headerTypeEnum.TEXT,data:{text:l.Loc.getMessage("BIZPROC_JS_WORKFLOW_FACES_COLUMN_COMPLETED")}},stack:s,footer:babelHelpers.classPrivateFieldLooseBase(this,S)[S](babelHelpers.classPrivateFieldLooseBase(this,n)[n].time.completed)}}function z(){const e={images:[{type:a.imageTypeEnum.ICON,data:{icon:"circle-check",color:"var(--ui-color-primary-alt)"}}]};const s=babelHelpers.classPrivateFieldLooseBase(this,I)[I](babelHelpers.classPrivateFieldLooseBase(this,n)[n].avatars.done);if(l.Type.isArrayFilled(s)){const t=l.Text.toBoolean(babelHelpers.classPrivateFieldLooseBase(this,n)[n].statuses.doneSuccess);e.images=s;e.status={type:t?a.stackStatusEnum.OK:a.stackStatusEnum.CANCEL}}return{id:"done",header:{type:a.headerTypeEnum.TEXT,data:{text:l.Loc.getMessage("BIZPROC_JS_WORKFLOW_FACES_COLUMN_DONE")}},stack:e,footer:babelHelpers.classPrivateFieldLooseBase(this,S)[S](babelHelpers.classPrivateFieldLooseBase(this,n)[n].time.done)}}function J(){return{id:"stub",header:{type:a.headerTypeEnum.STUB},stack:{images:[{type:a.imageTypeEnum.USER_STUB}]},footer:{type:a.footerTypeEnum.STUB}}}function Z(e){const s=[];if(l.Type.isArrayFilled(e)){e.forEach((e=>{const t=l.Text.toInteger(e.id);if(t>0){s.push({type:a.imageTypeEnum.USER,data:{userId:t,src:String(e.avatarUrl||"")}})}}))}return s}function $(e){if(l.Type.isNumber(e)&&e>0){return{type:a.footerTypeEnum.DURATION,data:{duration:e,realtime:false}}}return{type:a.footerTypeEnum.TEXT,data:{text:l.Loc.getMessage("BIZPROC_JS_WORKFLOW_FACES_EMPTY_TIME")}}}function G(){if(!babelHelpers.classPrivateFieldLooseBase(this,n)[n].workflowIsCompleted&&BX.PULL){babelHelpers.classPrivateFieldLooseBase(this,L)[L]=BX.PULL.subscribe({moduleId:"bizproc",command:"workflow",callback:babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this)})}}function Y(e){if(e&&e.eventName==="UPDATED"&&l.Type.isArrayFilled(e.items)){for(const s of e.items){if(String(s.id)===babelHelpers.classPrivateFieldLooseBase(this,h)[h]){babelHelpers.classPrivateFieldLooseBase(this,j)[j]();return}}}}function q(){if(babelHelpers.classPrivateFieldLooseBase(this,p)[p]&&l.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,p)[p])&&babelHelpers.classPrivateFieldLooseBase(this,p)[p].clientHeight>0){l.ajax.runAction("bizproc.workflow.faces.load",{data:{workflowId:babelHelpers.classPrivateFieldLooseBase(this,h)[h],runningTaskId:babelHelpers.classPrivateFieldLooseBase(this,n)[n].runningTaskId||0,userId:babelHelpers.classPrivateFieldLooseBase(this,P)[P]}}).then((({data:e})=>{if(l.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,B)[B])){l.Dom.replace(babelHelpers.classPrivateFieldLooseBase(this,B)[B],babelHelpers.classPrivateFieldLooseBase(this,f)[f]);babelHelpers.classPrivateFieldLooseBase(this,B)[B]=null}this.updateData(e)})).catch((({errors:e})=>{if(l.Type.isArrayFilled(e)){const s=e.pop();if(s.code==="ACCESS_DENIED"){l.Dom.replace(babelHelpers.classPrivateFieldLooseBase(this,f)[f],babelHelpers.classPrivateFieldLooseBase(this,N)[N](s.message));this.errorMessage=s.message}}}))}}function Q(){if(l.Type.isFunction(babelHelpers.classPrivateFieldLooseBase(this,L)[L])){babelHelpers.classPrivateFieldLooseBase(this,L)[L]();babelHelpers.classPrivateFieldLooseBase(this,L)[L]=null}}function V(){const e=new s.Summary({workflowId:babelHelpers.classPrivateFieldLooseBase(this,h)[h],time:babelHelpers.classPrivateFieldLooseBase(this,n)[n].time.total,workflowIsCompleted:babelHelpers.classPrivateFieldLooseBase(this,n)[n].workflowIsCompleted,showArrow:false});babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e.render();return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}function ee(e){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=l.Tag.render(d||(d=o`
			<div class="bp-workflow-faces">
				<span class="bp-workflow-faces-error-message">
					${0}
				</span>
			</div>
		`),l.Text.encode(e));return babelHelpers.classPrivateFieldLooseBase(this,B)[B]}e.WorkflowFaces=U})(this.BX.Bizproc.Workflow=this.BX.Bizproc.Workflow||{},BX.Bizproc.Workflow.Faces,BX.UI,BX);
//# sourceMappingURL=faces.bundle.map.js