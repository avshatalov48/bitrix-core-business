this.BX=this.BX||{};(function(e,t,s,i,r,a,o,l){"use strict";let n=e=>e,p,c,d;var u=babelHelpers.classPrivateFieldLooseKey("name");var b=babelHelpers.classPrivateFieldLooseKey("icon");class v{constructor(e){Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e.name;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.icon}getContainer(){return l.Tag.render(p||(p=n`
			<span class="rest-market-item">
				${0}
				<span class="rest-market-item__name" title="${0}">${0}</span>
			</span>
		`),this.renderIcon(),this.getName(),this.getName())}renderTo(e){l.Dom.append(this.getContainer(),e)}getName(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}renderIcon(){if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b]){return l.Tag.render(c||(c=n`
				<div class="rest-market-item__icon-container">
					<div class="ui-icon-set --cube-plus rest-market-item__icon"></div>
				</div>
			`))}return l.Tag.render(d||(d=n`
			<div class="rest-market-item__icon-container" 
				style="
					background-image: url(${0});
					background-size: cover;
				">
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,b)[b])}}let P=e=>e,_,h;var L=babelHelpers.classPrivateFieldLooseKey("items");var E=babelHelpers.classPrivateFieldLooseKey("title");var m=babelHelpers.classPrivateFieldLooseKey("link");var g=babelHelpers.classPrivateFieldLooseKey("count");var T=babelHelpers.classPrivateFieldLooseKey("onClick");var B=babelHelpers.classPrivateFieldLooseKey("renderList");class k{constructor(e){Object.defineProperty(this,B,{value:F});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,m,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,L)[L]=l.Type.isArray(e.items)?e.items:[];babelHelpers.classPrivateFieldLooseBase(this,E)[E]=e.title;babelHelpers.classPrivateFieldLooseBase(this,m)[m]=e.link;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e.count;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=e.onClick}render(){return l.Tag.render(_||(_=P`
			<div class="rest-market-list">
				<div class="rest-market-list__header">
					<span class="rest-market-list__title">${0}</span>
					<a class="rest-market-list__link" href="${0}" onclick="${0}">
						${0}
					</a>
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,E)[E],babelHelpers.classPrivateFieldLooseBase(this,m)[m],babelHelpers.classPrivateFieldLooseBase(this,T)[T],l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_MARKET_LIST_LINK",{"#COUNT#":babelHelpers.classPrivateFieldLooseBase(this,g)[g]}),babelHelpers.classPrivateFieldLooseBase(this,B)[B]())}}function F(){if(babelHelpers.classPrivateFieldLooseBase(this,L)[L].length===0){return null}const e=l.Tag.render(h||(h=P`
			<div class="rest-market-list__container"></div>
		`));babelHelpers.classPrivateFieldLooseBase(this,L)[L].forEach((t=>{t.renderTo(e)}));return e}let H=e=>e,y;class R{render(){return l.Tag.render(y||(y=H`
			<aside class="rest-market-expired-popup__discount">
				<p class="rest-market-expired-popup__discount-description">
					${0}
				</p>
			</aside>
		`),l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DISCOUNT_DESCRIPTION",{"[white-span]":'<span class="rest-market-expired-popup__discount-description-white">',"[/white-span]":"</span>"}))}}var D=babelHelpers.classPrivateFieldLooseKey("send");var I=babelHelpers.classPrivateFieldLooseKey("getType");var O=babelHelpers.classPrivateFieldLooseKey("getP1");class x{constructor(e){Object.defineProperty(this,O,{value:S});Object.defineProperty(this,I,{value:f});Object.defineProperty(this,D,{value:w});this.context=e}sendShow(){babelHelpers.classPrivateFieldLooseBase(this,D)[D]({tool:"infohelper",category:"market",event:"show_popup"})}sendClickButton(e){babelHelpers.classPrivateFieldLooseBase(this,D)[D]({tool:"infohelper",category:"market",event:"click_button",c_element:e})}sendDemoActivated(){babelHelpers.classPrivateFieldLooseBase(this,D)[D]({tool:"intranet",category:"demo",event:"demo_activated"})}}function w(e){o.sendData({...e,type:babelHelpers.classPrivateFieldLooseBase(this,I)[I](),p1:babelHelpers.classPrivateFieldLooseBase(this,O)[O]()})}function f(){return this.context.popupType==="WARNING"?"pre_disconnection_alert":"post_disconnection_notice"}function S(){return`discount_${this.context.withDiscount?"Y":"N"}`}let M=e=>e,C,K,$,A,N;var U=babelHelpers.classPrivateFieldLooseKey("popup");var X=babelHelpers.classPrivateFieldLooseKey("container");var j=babelHelpers.classPrivateFieldLooseKey("appList");var W=babelHelpers.classPrivateFieldLooseKey("integrationList");var z=babelHelpers.classPrivateFieldLooseKey("marketSubscriptionUrl");var G=babelHelpers.classPrivateFieldLooseKey("withDiscount");var Y=babelHelpers.classPrivateFieldLooseKey("discountEarContainer");var q=babelHelpers.classPrivateFieldLooseKey("analytic");var J=babelHelpers.classPrivateFieldLooseKey("getFeatureCode");var Q=babelHelpers.classPrivateFieldLooseKey("getContent");var V=babelHelpers.classPrivateFieldLooseKey("getContainer");var Z=babelHelpers.classPrivateFieldLooseKey("renderCloseIcon");var ee=babelHelpers.classPrivateFieldLooseKey("getDiscountEarContainer");var te=babelHelpers.classPrivateFieldLooseKey("renderMarketList");var se=babelHelpers.classPrivateFieldLooseKey("renderAboutLink");var ie=babelHelpers.classPrivateFieldLooseKey("showOlWidget");class re extends i.EventEmitter{constructor(e){super();Object.defineProperty(this,ie,{value:ue});Object.defineProperty(this,se,{value:de});Object.defineProperty(this,te,{value:ce});Object.defineProperty(this,ee,{value:pe});Object.defineProperty(this,Z,{value:ne});Object.defineProperty(this,V,{value:le});Object.defineProperty(this,Q,{value:oe});Object.defineProperty(this,J,{value:ae});Object.defineProperty(this,U,{writable:true,value:null});Object.defineProperty(this,X,{writable:true,value:null});Object.defineProperty(this,j,{writable:true,value:void 0});Object.defineProperty(this,W,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:void 0});Object.defineProperty(this,G,{writable:true,value:void 0});Object.defineProperty(this,Y,{writable:true,value:null});Object.defineProperty(this,q,{writable:true,value:void 0});this.setEventNamespace("Rest.MarketExpired:Popup");this.transitionPeriodEndDate=e.transitionPeriodEndDate;babelHelpers.classPrivateFieldLooseBase(this,j)[j]=e.appList;babelHelpers.classPrivateFieldLooseBase(this,W)[W]=e.integrationList;babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e.marketSubscriptionUrl;babelHelpers.classPrivateFieldLooseBase(this,G)[G]=e.withDiscount;this.withDemo=e.withDemo;this.olWidgetCode=e.olWidgetCode;babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e.analytic}getType(){return""}getTitle(){return""}show(){var e,s,i,r;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,U))[U])!=null?s:e[U]=t.PopupWindowManager.create(`marketExpiredPopup_${this.getType()}`,null,{animation:{showClassName:"rest-market-expired-popup__show",closeAnimationType:"animation"},overlay:true,content:babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](),disableScroll:true,padding:0,className:"rest-market-expired-popup-wrapper",events:{onClose:this.onClose.bind(this)}});(i=babelHelpers.classPrivateFieldLooseBase(this,U)[U])==null?void 0:i.show();(r=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:r.sendShow();if(babelHelpers.classPrivateFieldLooseBase(this,G)[G]){l.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,V)[V](),{maxHeight:`${babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]().offsetHeight}px`});babelHelpers.classPrivateFieldLooseBase(this,U)[U].adjustPosition()}if(l.Type.isStringFilled(this.olWidgetCode)&&(!this.withDemo||this.getType()==="FINAL")){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](window,document,`https://bitrix24.team/upload/crm/site_button/loader_${this.olWidgetCode}.js`)}}onClose(){var e;(e=BX.SiteButton)==null?void 0:e.hide();this.emit("onClose");BX.userOptions.save("rest","marketTransitionPopupTs",null,Math.floor(Date.now()/1e3))}renderDescription(){return null}renderButtons(){return null}getSubscribeButton(){return new s.Button({text:l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_SUBSCRIBE"),className:"rest-market-expired-popup__button",id:"marketExpiredPopup_button_subscribe",size:s.Button.Size.MEDIUM,color:s.Button.Color.SUCCESS,noCaps:true,round:true,tag:s.Button.Tag.LINK,link:babelHelpers.classPrivateFieldLooseBase(this,z)[z],onclick:()=>{var e;(e=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:e.sendClickButton("buy")}})}getDemoButton(){const e=new s.Button({text:l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_DEMO"),className:"rest-market-expired-popup__button",id:"marketExpiredPopup_button_demo",size:s.Button.Size.MEDIUM,color:s.Button.Color.LIGHT_BORDER,noCaps:true,round:true,onclick:()=>{var t;e.unbindEvent("click");e.setState(s.Button.State.WAITING);(t=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:t.sendClickButton("demo");l.ajax({url:"/bitrix/tools/rest.php",method:"POST",dataType:"json",data:{sessid:BX.bitrix_sessid(),action:"activate_demo"},onsuccess:e=>{babelHelpers.classPrivateFieldLooseBase(this,U)[U].close();if(e.error){a.UI.Notification.Center.notify({content:e.error,category:"demo_subscribe_error",position:"top-right"})}else{var t;(t=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:t.sendDemoActivated();r.FeaturePromotersRegistry.getPromoter({code:"limit_market_trial_active"}).show()}}})}});return e}getHideButton(){return new s.Button({text:l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_BUTTON_HIDE"),className:"rest-market-expired-popup__button rest-market-expired-popup__button--link",id:"marketExpiredPopup_button_hide",size:s.Button.Size.EXTRA_SMALL,color:s.Button.Color.LINK,noCaps:true,onclick:()=>{var e,t;(e=babelHelpers.classPrivateFieldLooseBase(this,U)[U])==null?void 0:e.close();(t=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:t.sendClickButton("ok");BX.userOptions.save("rest","marketTransitionPopupDismiss",null,"Y")}})}}function ae(){return`\n\t\t\tlimit_v2_nosubscription_marketplace_withapplications\n\t\t\t${babelHelpers.classPrivateFieldLooseBase(this,G)[G]?"":"_nodiscount"}\n\t\t\t_off\n\t\t\t${this.withDemo?"":"_no_demo"}\n\t\t`}function oe(){return l.Tag.render(C||(C=M`
			<div class="rest-market-expired-popup">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,V)[V]())}function le(){var e,t;(t=(e=babelHelpers.classPrivateFieldLooseBase(this,X))[X])!=null?t:e[X]=l.Tag.render(K||(K=M`
			<div class="rest-market-expired-popup__container">
				${0}
				<div class="rest-market-expired-popup__content-wrapper">
					<div class="rest-market-expired-popup__content">
						<span class="rest-market-expired-popup__title">${0}</span>
						${0}
						${0}
						${0}
					</div>
					${0}
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,G)[G]?babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]():"",this.getTitle(),this.renderDescription(),babelHelpers.classPrivateFieldLooseBase(this,se)[se](),this.renderButtons(),babelHelpers.classPrivateFieldLooseBase(this,te)[te](),babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]());return babelHelpers.classPrivateFieldLooseBase(this,X)[X]}function ne(){const e=()=>{var e;babelHelpers.classPrivateFieldLooseBase(this,U)[U].close();(e=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:e.sendClickButton("cancel")};return l.Tag.render($||($=M`
			<div class="rest-market-expired-popup__close-icon ui-icon-set --cross-30" onclick="${0}"></div>
		`),e)}function pe(){var e,t;(t=(e=babelHelpers.classPrivateFieldLooseBase(this,Y))[Y])!=null?t:e[Y]=new R(this.withDemo).render();return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]}function ce(){var e,t;return l.Tag.render(A||(A=M`
			<aside class="rest-market-expired-popup__aside">
				${0}
				${0}
			</aside>
		`),(e=babelHelpers.classPrivateFieldLooseBase(this,j)[j])==null?void 0:e.render(),(t=babelHelpers.classPrivateFieldLooseBase(this,W)[W])==null?void 0:t.render())}function de(){const e=()=>{var e;(e=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:e.sendClickButton("details")};return l.Tag.render(N||(N=M`
			<span class="rest-market-expired-popup__details">
				<a
					class="ui-link rest-market-expired-popup__link"
					href="FEATURE_PROMOTER=${0}"
					onclick="${0}"
				>
					${0}
				</a>
			</span>
		`),babelHelpers.classPrivateFieldLooseBase(this,J)[J](),e,l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DETAILS"))}function ue(e,t,s){const i=t.createElement("script");i.async=true;i.src=`${s}?${Date.now()/6e4|0}`;const r=t.getElementsByTagName("script")[0];r.parentNode.insertBefore(i,r)}let be=e=>e,ve,Pe,_e;class he extends re{getType(){return"final"}getTitle(){return l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_TITLE_FINAL")}renderDescription(){return l.Tag.render(ve||(ve=be`
			<div class="rest-market-expired-popup__description">
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
			</div>
		`),l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_1"),l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_2"),l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_3"),l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_FINAL"),l.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_FINAL_DESCRIPTION${this.withDemo?"_DEMO":""}`))}renderButtons(){if(this.withDemo){return l.Tag.render(Pe||(Pe=be`
				<div class="rest-market-expired-popup__buttons-wrapper">
					${0}
					<div class="rest-market-expired-popup__button-container">
						${0}
						${0}
					</div>
				</div>
			`),this.getSubscribeButton().render(),this.getDemoButton().render(),this.getHideButton().render())}return l.Tag.render(_e||(_e=be`
			<div class="rest-market-expired-popup__button-container">
				${0}
				${0}
			</div>
		`),this.getSubscribeButton().render(),this.getHideButton().render())}}let Le=e=>e,Ee,me;class ge extends re{getType(){return"warning"}renderDescription(){return l.Tag.render(Ee||(Ee=Le`
			<div class="rest-market-expired-popup__description">
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
				<p class="rest-market-expired-popup__description-text">
					${0}
				</p>
			</div>
		`),l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_1"),l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_2"),l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_DESCRIPTION_3"),l.Loc.getMessage(`REST_MARKET_EXPIRED_POPUP_WARNING_DESCRIPTION${this.withDemo?"_DEMO":""}`,{"#DATE#":this.transitionPeriodEndDate}))}getTitle(){return l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_TITLE_WARNING")}renderButtons(){return l.Tag.render(me||(me=Le`
			<div class="rest-market-expired-popup__button-container">
				${0}
				${0}
			</div>
		`),this.getSubscribeButton().render(),this.withDemo?this.getDemoButton().render():"")}}const Te={WARNING:ge,FINAL:he};class Be{static async getPopup(){const e=(e,t,s,i)=>{if(!e||!e.data){return null}const{items:r,count:a}=e.data;const o=[];if(r.length===0||a<1){return null}Object.values(r).forEach((e=>{o.push(new v({name:e.name,icon:e.icon}))}));return new k({title:s,count:a,items:o,link:t,onClick:i})};const t=l.Extension.getSettings("rest.market-expired");let s=null;await Promise.all([l.ajax.runAction("rest.integration.getApplicationList",{data:{limit:3}}),l.ajax.runAction("rest.integration.getIntegrationList",{data:{limit:3}})]).then((([i,r])=>{const a=new x({withDiscount:t.withDiscount,popupType:t.type});const o=e(i,"/market/installed/",l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_MARKET_LIST_TITLE_APPS"),(()=>{a.sendClickButton("view_all_apps")}));const n=e(r,"/devops/list/",l.Loc.getMessage("REST_MARKET_EXPIRED_POPUP_MARKET_LIST_TITLE_INTEGRATIONS"),(()=>{a.sendClickButton("view_all_integrations")}));if(o||n){const e=Te[t.type];if(e){s=new e({transitionPeriodEndDate:t.transitionPeriodEndDate,appList:o,integrationList:n,marketSubscriptionUrl:t.marketSubscriptionUrl,withDiscount:t.withDiscount,withDemo:t.withDemo,olWidgetCode:t.olWidgetCode,analytic:a})}}})).catch((e=>{console.log(e)}));return s}}e.MarketItem=v;e.MarketList=k;e.WarningMarketExpiredPopup=ge;e.FinalMarketExpiredPopup=he;e.MarketExpired=Be})(this.BX.Rest=this.BX.Rest||{},BX.Main,BX.UI,BX.Event,BX.UI,BX,BX.UI.Analytics,BX);
//# sourceMappingURL=market-expired.bundle.map.js