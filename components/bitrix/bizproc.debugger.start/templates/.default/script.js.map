{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import { Dom, Event, Reflection, Type, Text, Loc } from 'main.core';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Mode, Session } from 'bizproc.debugger';\nimport { Button, ButtonColor, ButtonSize } from 'ui.buttons';\nimport './css/style.css';\n\nconst namespace = Reflection.namespace('BX.Bizproc.Component');\n\nclass DebuggerStartComponent\n{\n\t#documentSigned: string = '';\n\t#activeSession: Session | null = null;\n\t#currentUserId: number = null;\n\n\tconstructor(options)\n\t{\n\t\tthis.#documentSigned = options.documentSigned;\n\t\tthis.#activeSession = options.activeSession ? new Session(options.activeSession) : null;\n\t\tthis.#currentUserId = Text.toInteger(options.currentUserId);\n\t}\n\n\tinit()\n\t{\n\t\tif (this.#activeSession)\n\t\t{\n\t\t\tthis.#disableButtons();\n\t\t\tthis.#setActiveSessionHint();\n\n\t\t\tif (this.#currentUserId === this.#activeSession.startedBy)\n\t\t\t{\n\t\t\t\tthis.#renderFinishSessionButton();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initEvents();\n\t\t}\n\t}\n\n\tget buttons(): Object\n\t{\n\t\tconst buttons = {};\n\t\tbuttons[Mode.experimental.id] = document.getElementById('bizproc-debugger-start-experimental-element');\n\t\tbuttons[Mode.interception.id] = document.getElementById('bizproc-debugger-start-interception-element');\n\n\t\treturn buttons;\n\t}\n\n\t#disableButtons()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tDom.addClass(buttons[key], 'ui-btn-disabled');\n\t\t});\n\t}\n\n\t#enableButtons()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tDom.removeClass(buttons[key], 'ui-btn-disabled');\n\t\t\tDom.attr(buttons[key], 'disabled', null);\n\t\t});\n\t}\n\n\t#setActiveSessionHint()\n\t{\n\t\tif (!this.#activeSession)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tDom.attr(buttons[key], 'data-hint', Text.encode(this.#activeSession.shortDescription));\n\t\t\tDom.attr(buttons[key], 'data-hint-no-icon', 'y');\n\n\t\t\tBX.UI.Hint.init(BX(buttons[key].id).parentElement);\n\t\t});\n\t}\n\n\t#renderFinishSessionButton()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tconst mode = this.#activeSession.modeId;\n\n\t\tif (buttons[mode])\n\t\t{\n\t\t\tconst buttonId = buttons[mode].id;\n\n\t\t\tconst button = new Button({\n\t\t\t\tprops: {\n\t\t\t\t\tid: buttonId,\n\t\t\t\t},\n\t\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\ttext: Loc.getMessage('BIZPROC_DEBUGGER_START_TEMPLATE_FINISH'),\n\t\t\t\tround: true,\n\t\t\t\tonclick: this.#onFinishSessionClick.bind(this),\n\t\t\t});\n\n\t\t\tDom.replace(buttons[mode], (button).render());\n\t\t}\n\t}\n\n\t#initEvents()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tObject.keys(buttons).forEach(key => {\n\t\t\tEvent.bind(buttons[key], 'click', () => {\n\t\t\t\tthis.#onStartSessionClick(buttons[key], key);\n\t\t\t});\n\t\t});\n\t}\n\n\t#onStartSessionClick(btn: HTMLButtonElement, modeId: number)\n\t{\n\t\ttop.BX.Runtime.loadExtension('bizproc.debugger')\n\t\t\t.then((exports) => {\n\t\t\t\tthis.#disableButtons();\n\t\t\t\tDom.addClass(btn, 'ui-btn-wait');\n\n\t\t\t\tconst {Manager} = exports;\n\t\t\t\tManager.Instance.startSession(this.#documentSigned, Text.toInteger(modeId))\n\t\t\t\t\t.then(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tthis.#enableButtons();\n\t\t\t\t\t\t\tBX.SidePanel.Instance.closeAll();\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tthis.#reject(\n\t\t\t\t\t\t\t\tresponse,\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tthis.#enableButtons();\n\t\t\t\t\t\t\t\t\tDom.removeClass(btn, 'ui-btn-wait');\n\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t)\n\t\t\t\t;\n\t\t\t}\n\t\t);\n\t}\n\n\t#onFinishSessionClick(button: Button)\n\t{\n\t\tbutton.setDisabled(true);\n\t\tbutton.setWaiting(true);\n\n\t\tif (top.BX.Bizproc.Debugger)\n\t\t{\n\t\t\ttop.BX.Bizproc.Debugger.Manager.Instance.askFinishSession(this.#activeSession)\n\t\t\t\t.then(\n\t\t\t\t\tthis.#onAfterFinishSession.bind(this),\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tthis.#reject(\n\t\t\t\t\t\t\tresponse,\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tbutton.setDisabled(false);\n\t\t\t\t\t\t\t\tbutton.setWaiting(false);\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#activeSession.finish()\n\t\t\t\t.then(\n\t\t\t\t\tthis.#onAfterFinishSession.bind(this),\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tthis.#reject(\n\t\t\t\t\t\t\tresponse,\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tbutton.setDisabled(false);\n\t\t\t\t\t\t\t\tbutton.setWaiting(false);\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t;\n\t\t}\n\t}\n\n\t#onAfterFinishSession()\n\t{\n\t\tconst buttons = this.buttons;\n\t\tconst mode = this.#activeSession.modeId;\n\t\tconst buttonId = buttons[mode].id;\n\n\t\tthis.#enableButtons();\n\t\tthis.#activeSession = null;\n\n\t\tDom.replace(\n\t\t\tbuttons[mode],\n\t\t\t(new Button({\n\t\t\t\tprops: {\n\t\t\t\t\tid: buttonId,\n\t\t\t\t},\n\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\ttext: Loc.getMessage('BIZPROC_DEBUGGER_START_TEMPLATE_START'),\n\t\t\t\tround: true,\n\t\t\t})).render()\n\t\t);\n\n\t\tthis.init();\n\t}\n\n\t#reject(response, callback: Function)\n\t{\n\t\tif (Type.isArrayFilled(response.errors))\n\t\t{\n\t\t\tlet message = '';\n\t\t\tresponse.errors.forEach((error)=>{\n\t\t\t\tmessage = message + '\\n' + error.message;\n\t\t\t});\n\n\t\t\tMessageBox.alert(message, callback);\n\t\t}\n\t\telse if (Type.isFunction(callback))\n\t\t{\n\t\t\tcallback();\n\t\t}\n\t}\n}\n\nnamespace.DebuggerStartComponent = DebuggerStartComponent;"],"names":["namespace","Reflection","DebuggerStartComponent","options","documentSigned","activeSession","Session","Text","toInteger","currentUserId","startedBy","buttons","Mode","experimental","id","document","getElementById","interception","Object","keys","forEach","key","Dom","addClass","removeClass","attr","encode","shortDescription","BX","UI","Hint","init","parentElement","mode","modeId","buttonId","button","Button","props","color","ButtonColor","LIGHT_BORDER","size","ButtonSize","SMALL","text","Loc","getMessage","round","onclick","bind","replace","render","Event","btn","top","Runtime","loadExtension","then","exports","Manager","Instance","startSession","SidePanel","closeAll","response","setDisabled","setWaiting","Bizproc","Debugger","askFinishSession","finish","SUCCESS","callback","Type","isArrayFilled","errors","message","error","MessageBox","alert","isFunction"],"mappings":"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"}