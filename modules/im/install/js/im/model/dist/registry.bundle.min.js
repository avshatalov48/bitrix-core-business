this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(e,t,i,n,a){"use strict";var r=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"application"}},{key:"getState",value:function e(){return{common:{host:this.getVariable("common.host",location.protocol+"//"+location.host),siteId:this.getVariable("common.siteId","default"),userId:this.getVariable("common.userId",0),languageId:this.getVariable("common.languageId","en")},dialog:{dialogId:this.getVariable("dialog.dialogId","0"),chatId:this.getVariable("dialog.chatId",0),diskFolderId:this.getVariable("dialog.diskFolderId",0),messageLimit:this.getVariable("dialog.messageLimit",20),enableReadMessages:this.getVariable("dialog.enableReadMessages",true),messageExtraCount:0},disk:{enabled:false,maxFileSize:5242880},call:{serverEnabled:false,maxParticipants:24},mobile:{keyboardShow:false},device:{type:this.getVariable("device.type",i.DeviceType.desktop),orientation:this.getVariable("device.orientation",i.DeviceOrientation.portrait)},options:{quoteEnable:this.getVariable("options.quoteEnable",true),quoteFromRight:this.getVariable("options.quoteFromRight",true),autoplayVideo:this.getVariable("options.autoplayVideo",true),darkBackground:this.getVariable("options.darkBackground",false),showSmiles:false},error:{active:false,code:"",description:""}}}},{key:"getStateSaveException",value:function e(){return Object.assign({common:this.getVariable("saveException.common",null),dialog:this.getVariable("saveException.dialog",null),mobile:this.getVariable("saveException.mobile",null),device:this.getVariable("saveException.device",null),error:this.getVariable("saveException.error",null)})}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){i.commit("set",t.validate(n))},showSmiles:function e(t,i){t.commit("showSmiles")},hideSmiles:function e(t,i){t.commit("hideSmiles")}}}},{key:"getMutations",value:function e(){var t=this;return{set:function e(i,n){var a=false;for(var r in n){if(!n.hasOwnProperty(r)){continue}for(var o in n[r]){if(!n[r].hasOwnProperty(o)){continue}i[r][o]=n[r][o];a=true}}if(a&&t.isSaveNeeded(n)){t.saveState(i)}},increaseDialogExtraCount:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=i.count,a=n===void 0?1:n;t.dialog.messageExtraCount+=a},decreaseDialogExtraCount:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=i.count,a=n===void 0?1:n;var r=t.dialog.messageExtraCount-a;if(r<=0){r=0}t.dialog.messageExtraCount=r},clearDialogExtraCount:function e(t){t.dialog.messageExtraCount=0},showSmiles:function e(t){t.options.showSmiles=true},hideSmiles:function e(t){t.options.showSmiles=false}}}},{key:"validate",value:function e(t){var n={};if(babelHelpers.typeof(t.common)==="object"&&t.common){n.common={};if(typeof t.common.userId==="number"){n.common.userId=t.common.userId}if(typeof t.common.languageId==="string"){n.common.languageId=t.common.languageId}}if(babelHelpers.typeof(t.dialog)==="object"&&t.dialog){n.dialog={};if(typeof t.dialog.dialogId==="number"){n.dialog.dialogId=t.dialog.dialogId.toString();n.dialog.chatId=0}else if(typeof t.dialog.dialogId==="string"){n.dialog.dialogId=t.dialog.dialogId;if(typeof t.dialog.chatId!=="number"){var a=t.dialog.dialogId;if(a.startsWith("chat")){a=t.dialog.dialogId.substr(4)}a=parseInt(a);n.dialog.chatId=!isNaN(a)?a:0;t.dialog.chatId=n.dialog.chatId}}if(typeof t.dialog.chatId==="number"){n.dialog.chatId=t.dialog.chatId}if(typeof t.dialog.diskFolderId==="number"){n.dialog.diskFolderId=t.dialog.diskFolderId}if(typeof t.dialog.messageLimit==="number"){n.dialog.messageLimit=t.dialog.messageLimit}if(typeof t.dialog.messageExtraCount==="number"){n.dialog.messageExtraCount=t.dialog.messageExtraCount}if(typeof t.dialog.enableReadMessages==="boolean"){n.dialog.enableReadMessages=t.dialog.enableReadMessages}}if(babelHelpers.typeof(t.disk)==="object"&&t.disk){n.disk={};if(typeof t.disk.enabled==="boolean"){n.disk.enabled=t.disk.enabled}if(typeof t.disk.maxFileSize==="number"){n.disk.maxFileSize=t.disk.maxFileSize}}if(babelHelpers.typeof(t.call)==="object"&&t.call){n.call={};if(typeof t.call.serverEnabled==="boolean"){n.call.serverEnabled=t.call.serverEnabled}if(typeof t.call.maxParticipants==="number"){n.call.maxParticipants=t.call.maxParticipants}}if(babelHelpers.typeof(t.mobile)==="object"&&t.mobile){n.mobile={};if(typeof t.mobile.keyboardShow==="boolean"){n.mobile.keyboardShow=t.mobile.keyboardShow}}if(babelHelpers.typeof(t.device)==="object"&&t.device){n.device={};if(typeof t.device.type==="string"&&typeof i.DeviceType[t.device.type]!=="undefined"){n.device.type=t.device.type}if(typeof t.device.orientation==="string"&&typeof i.DeviceOrientation[t.device.orientation]!=="undefined"){n.device.orientation=t.device.orientation}}if(babelHelpers.typeof(t.error)==="object"&&t.error){if(typeof t.error.active==="boolean"){n.error={active:t.error.active,code:t.error.code.toString()||"",description:t.error.description.toString()||""}}}return n}}]);return t}(a.VuexBuilderModel);var o=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"callApplication"}},{key:"getState",value:function e(){return{common:{inited:false,passChecked:true,showChat:false,userCount:0,userInCallCount:0,state:i.CallStateType.preparation,showSmiles:false,error:"",conferenceTitle:"",alias:"",conferenceStarted:null,conferenceStartDate:null,joinWithVideo:null,userReadyToJoin:false},user:{id:-1,hash:""}}}},{key:"getMutations",value:function e(){var t=this;return{common:function e(t,i){if(typeof i.inited==="boolean"){t.common.inited=i.inited}if(typeof i.passChecked==="boolean"){t.common.passChecked=i.passChecked}if(typeof i.showChat==="boolean"){t.common.showChat=i.showChat}if(typeof i.userCount==="number"||typeof i.userCount==="string"){t.common.userCount=parseInt(i.userCount)}if(typeof i.userInCallCount==="number"||typeof i.userInCallCount==="string"){t.common.userInCallCount=parseInt(i.userInCallCount)}if(typeof i.componentError==="string"){t.common.componentError=i.componentError}},user:function e(i,n){if(typeof n.id==="number"){i.user.id=n.id}if(typeof n.hash==="string"&&n.hash!==i.user.hash){i.user.hash=n.hash}if(t.isSaveNeeded({user:n})){t.saveState(i)}},startCall:function e(t,n){t.common.state=i.CallStateType.call},endCall:function e(t,n){t.common.state=i.CallStateType.preparation},returnToPreparation:function e(t,n){t.common.state=i.CallStateType.preparation},toggleSmiles:function e(t,i){t.common.showSmiles=!t.common.showSmiles},setError:function e(t,i){if(typeof i.errorCode==="string"){t.common.error=i.errorCode}},setConferenceTitle:function e(t,i){if(typeof i.conferenceTitle==="string"){t.common.conferenceTitle=i.conferenceTitle}},setAlias:function e(t,i){if(typeof i.alias==="string"){t.common.alias=i.alias}},setJoinType:function e(t,i){if(typeof i.joinWithVideo==="boolean"){t.common.joinWithVideo=i.joinWithVideo}},setConferenceStatus:function e(t,i){if(typeof i.conferenceStarted==="boolean"){t.common.conferenceStarted=i.conferenceStarted}},setConferenceStartDate:function e(t,i){if(i.conferenceStartDate instanceof Date){t.common.conferenceStartDate=i.conferenceStartDate}},setUserReadyToJoin:function e(t,i){t.common.userReadyToJoin=true}}}},{key:"getStateSaveException",value:function e(){return{common:{inited:null,state:null,showSmiles:null,userCount:null,userInCallCount:null,error:null,conferenceTitle:null,alias:null,conferenceStarted:null,conferenceStartDate:null,joinWithVideo:null,userReadyToJoin:null}}}}]);return t}(a.VuexBuilderModel);function s(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=l(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function l(e,t){if(!e)return;if(typeof e==="string")return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return c(e,t)}function c(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var d={empty:"empty",equal:"equal",none:"none",found:"found",foundReverse:"foundReverse"};var u=function(e){babelHelpers.inherits(a,e);function a(){babelHelpers.classCallCheck(this,a);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).apply(this,arguments))}babelHelpers.createClass(a,[{key:"getName",value:function e(){return"messages"}},{key:"getState",value:function e(){return{created:0,collection:{},mutationType:{},saveMessageList:{},saveFileList:{},saveUserList:{},host:this.getVariable("host",location.protocol+"//"+location.host)}}},{key:"getElementState",value:function e(){return{templateId:0,templateType:"message",id:0,chatId:0,authorId:0,date:new Date,text:"",textConverted:"",params:{TYPE:"default",COMPONENT_ID:"bx-im-view-message"},push:false,unread:false,sending:false,error:false,retry:false,blink:false}}},{key:"getGetters",value:function e(){var t=this;return{getMutationType:function e(t){return function(e){if(!t.mutationType[e]){return{initialType:i.MutationType.none,appliedType:i.MutationType.none}}return t.mutationType[e]}},getLastId:function e(t){return function(e){if(!t.collection[e]||t.collection[e].length<=0){return null}var i=0;for(var n=0;n<t.collection[e].length;n++){var a=t.collection[e][n];if(a.push||a.sending||a.id.toString().startsWith("temporary")){continue}if(i<a.id){i=a.id}}return i?i:null}},getMessage:function e(t){return function(e,i){if(!t.collection[e]||t.collection[e].length<=0){return null}for(var n=t.collection[e].length-1;n>=0;n--){if(t.collection[e][n].id===i){return t.collection[e][n]}}return null}},get:function e(t){return function(e){if(!t.collection[e]||t.collection[e].length<=0){return[]}return t.collection[e]}},getBlank:function e(i){return function(e){return t.getElementState()}},getSaveFileList:function e(t){return function(e){return t.saveFileList}},getSaveUserList:function e(t){return function(e){return t.saveUserList}}}}},{key:"getActions",value:function e(){var n=this;return{add:function e(t,i){var a=n.validate(Object.assign({},i));a.params=Object.assign({},n.getElementState().params,a.params);a.id="temporary"+(new Date).getTime()+t.state.created;a.templateId=a.id;a.unread=false;t.commit("add",Object.assign({},n.getElementState(),a));if(i.sending!==false){t.dispatch("actionStart",{id:a.id,chatId:a.chatId})}return a.id},actionStart:function e(i,n){if(/^\d+$/.test(n.id)){n.id=parseInt(n.id)}n.chatId=parseInt(n.chatId);t.Vue.nextTick(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{sending:true}})})},actionError:function e(i,n){if(/^\d+$/.test(n.id)){n.id=parseInt(n.id)}n.chatId=parseInt(n.chatId);t.Vue.nextTick(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{sending:false,error:true,retry:n.retry!==false}})})},actionFinish:function e(i,n){if(/^\d+$/.test(n.id)){n.id=parseInt(n.id)}n.chatId=parseInt(n.chatId);t.Vue.nextTick(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{sending:false,error:false,retry:false}})})},set:function e(t,a){if(a instanceof Array){a=a.map(function(e){return n.prepareMessage(e,{host:t.state.host})})}else{var r=n.prepareMessage(a,{host:t.state.host});(a=[]).push(r)}t.commit("set",{insertType:i.MutationType.set,data:a})},setAfter:function e(t,a){if(a instanceof Array){a=a.map(function(e){return n.prepareMessage(e)})}else{var r=n.prepareMessage(a);(a=[]).push(r)}t.commit("set",{insertType:i.MutationType.setAfter,data:a})},setBefore:function e(t,a){if(a instanceof Array){a=a.map(function(e){return n.prepareMessage(e)})}else{var r=n.prepareMessage(a);(a=[]).push(r)}t.commit("set",{insertType:i.MutationType.setBefore,data:a})},update:function e(t,i){if(/^\d+$/.test(i.id)){i.id=parseInt(i.id)}if(/^\d+$/.test(i.chatId)){i.chatId=parseInt(i.chatId)}t.commit("initCollection",{chatId:i.chatId});var a=t.state.collection[i.chatId].findIndex(function(e){return e.id===i.id});if(a<0){return false}var r=n.validate(Object.assign({},i.fields));if(r.params){r.params=Object.assign({},n.getElementState().params,t.state.collection[i.chatId][a].params,r.params)}t.commit("update",{id:i.id,chatId:i.chatId,index:a,fields:r});if(i.fields.blink){setTimeout(function(){t.commit("update",{id:i.id,chatId:i.chatId,fields:{blink:false}})},1e3)}return true},delete:function e(t,i){if(!(i.id instanceof Array)){i.id=[i.id]}i.id=i.id.map(function(e){if(/^\d+$/.test(e)){e=parseInt(e)}return e});t.commit("delete",{chatId:i.chatId,elements:i.id});return true},clear:function e(t,i){i.chatId=parseInt(i.chatId);t.commit("clear",{chatId:i.chatId});return true},applyMutationType:function e(t,i){i.chatId=parseInt(i.chatId);t.commit("applyMutationType",{chatId:i.chatId});return true},readMessages:function e(t,i){i.readId=parseInt(i.readId)||0;i.chatId=parseInt(i.chatId);if(typeof t.state.collection[i.chatId]==="undefined"){return{count:0}}var n=0;for(var a=t.state.collection[i.chatId].length-1;a>=0;a--){var r=t.state.collection[i.chatId][a];if(!r.unread)continue;if(i.readId===0||r.id<=i.readId){n++}}t.commit("readMessages",{chatId:i.chatId,readId:i.readId});return{count:n}},unreadMessages:function e(t,i){i.unreadId=parseInt(i.unreadId)||0;i.chatId=parseInt(i.chatId);if(typeof t.state.collection[i.chatId]==="undefined"||!i.unreadId){return{count:0}}var n=0;for(var a=t.state.collection[i.chatId].length-1;a>=0;a--){var r=t.state.collection[i.chatId][a];if(r.unread)continue;if(r.id>=i.unreadId){n++}}t.commit("unreadMessages",{chatId:i.chatId,unreadId:i.unreadId});return{count:n}}}}},{key:"getMutations",value:function e(){var n=this;return{initCollection:function e(t,i){return n.initCollection(t,i)},add:function e(t,a){n.initCollection(t,{chatId:a.chatId});n.setMutationType(t,{chatId:a.chatId,initialType:i.MutationType.add});t.collection[a.chatId].push(a);t.saveMessageList[a.chatId].push(a.id);t.created+=1;n.saveState(t,a.chatId)},set:function e(t,a){var r=[];var o=[];var l={};l.initialType=a.insertType;if(a.insertType===i.MutationType.set){(function(){a.insertType=i.MutationType.setAfter;var e={};a.data.forEach(function(t){if(!e[t.chatId]){e[t.chatId]=[]}e[t.chatId].push(t.id)});var r=function r(o){if(!e.hasOwnProperty(o))return"continue";n.initCollection(t,{chatId:o});if(t.saveMessageList[o].length>e[o].length||e[o].length<i.StorageLimit.messages){t.collection[o]=t.collection[o].filter(function(t){return e[o].includes(t.id)});t.saveMessageList[o]=t.saveMessageList[o].filter(function(t){return e[o].includes(t)})}var s=n.manageCacheBeforeSet(babelHelpers.toConsumableArray(t.saveMessageList[o].reverse()),e[o]);if(s.type===d.none){if(s.foundElements.length>0){t.collection[o]=t.collection[o].filter(function(e){return!s.foundElements.includes(e.id)});t.saveMessageList[o]=t.saveMessageList[o].filter(function(e){return!s.foundElements.includes(e)})}n.removeIntersectionCacheElements=t.collection[o].map(function(e){return e.id});clearTimeout(n.removeIntersectionCacheTimeout);n.removeIntersectionCacheTimeout=setTimeout(function(){t.collection[o]=t.collection[o].filter(function(e){return!n.removeIntersectionCacheElements.includes(e.id)});t.saveMessageList[o]=t.saveMessageList[o].filter(function(e){return!n.removeIntersectionCacheElements.includes(e)});n.removeIntersectionCacheElements=[]},1e3)}else{if(s.type===d.foundReverse){a.insertType=i.MutationType.setBefore;a.data=a.data.reverse()}}if(s.foundElements.length>0){if(s.type===d.found&&s.noneElements[0]){l.scrollStickToTop=false;l.scrollMessageId=s.foundElements[s.foundElements.length-1]}else{l.scrollStickToTop=false;l.scrollMessageId=0}}else if(s.type===d.none){l.scrollStickToTop=false;l.scrollMessageId=a.data[0].id}};for(var o in e){var s=r(o);if(s==="continue")continue}})()}l.appliedType=a.insertType;var c=s(a.data),u;try{var f=function e(){var s=u.value;n.initCollection(t,{chatId:s.chatId});var l=t.collection[s.chatId].findIndex(function(e){return e.id===s.id});if(l>-1){delete s.templateId;t.collection[s.chatId][l]=Object.assign(t.collection[s.chatId][l],s)}else if(a.insertType===i.MutationType.setBefore){t.collection[s.chatId].unshift(s)}else if(a.insertType===i.MutationType.setAfter){t.collection[s.chatId].push(s)}r.push(s.chatId);if(n.store.getters["dialogues/canSaveChat"]&&n.store.getters["dialogues/canSaveChat"](s.chatId)){o.push(s.chatId)}};for(c.s();!(u=c.n()).done;){f()}}catch(e){c.e(e)}finally{c.f()}r=babelHelpers.toConsumableArray(new Set(r));o=babelHelpers.toConsumableArray(new Set(o));if(l.initialType===i.MutationType.set){r.forEach(function(e){var i=0;var n=false;for(var a=0;a<t.collection[e].length;a++){var r=t.collection[e][a];if(r.id<i){n=true;break}i=r.id}if(n){t.collection[e].sort(function(e,t){return e.id-t.id})}})}r.forEach(function(e){n.setMutationType(t,babelHelpers.objectSpread({chatId:e},l))});if(l.initialType!==i.MutationType.setBefore){o.forEach(function(e){n.saveState(t,e)})}},update:function e(t,i){n.initCollection(t,{chatId:i.chatId});var a=-1;if(typeof i.index!=="undefined"&&t.collection[i.chatId][i.index]){a=i.index}else{a=t.collection[i.chatId].findIndex(function(e){return e.id===i.id})}if(a>=0){var r=t.saveMessageList[i.chatId].includes(t.collection[i.chatId][a].id)||i.fields.id&&!i.fields.id.toString().startsWith("temporary")&&t.collection[i.chatId][a].id.toString().startsWith("temporary");delete i.fields.templateId;t.collection[i.chatId][a]=Object.assign(t.collection[i.chatId][a],i.fields);if(r){n.saveState(t,i.chatId)}}},delete:function e(t,a){n.initCollection(t,{chatId:a.chatId});n.setMutationType(t,{chatId:a.chatId,initialType:i.MutationType.delete});t.collection[a.chatId]=t.collection[a.chatId].filter(function(e){return!a.elements.includes(e.id)});if(t.saveMessageList[a.chatId].length>0){var r=s(a.elements),o;try{for(r.s();!(o=r.n()).done;){var l=o.value;if(t.saveMessageList[a.chatId].includes(l)){n.saveState(t,a.chatId);break}}}catch(e){r.e(e)}finally{r.f()}}},clear:function e(t,i){n.initCollection(t,{chatId:i.chatId});n.setMutationType(t,{chatId:i.chatId,initialType:"clear"});t.collection[i.chatId]=[];t.saveMessageList[i.chatId]=[]},applyMutationType:function e(n,a){if(typeof n.mutationType[a.chatId]==="undefined"){t.Vue.set(n.mutationType,a.chatId,{applied:false,initialType:i.MutationType.none,appliedType:i.MutationType.none,scrollStickToTop:0,scrollMessageId:0})}n.mutationType[a.chatId].applied=true},readMessages:function e(t,i){n.initCollection(t,{chatId:i.chatId});var a=false;for(var r=t.collection[i.chatId].length-1;r>=0;r--){var o=t.collection[i.chatId][r];if(!o.unread)continue;if(i.readId===0||o.id<=i.readId){t.collection[i.chatId][r]=Object.assign(t.collection[i.chatId][r],{unread:false});a=true}}if(a){n.saveState(t,i.chatId)}},unreadMessages:function e(t,i){n.initCollection(t,{chatId:i.chatId});var a=false;for(var r=t.collection[i.chatId].length-1;r>=0;r--){var o=t.collection[i.chatId][r];if(o.unread)continue;if(o.id>=i.unreadId){t.collection[i.chatId][r]=Object.assign(t.collection[i.chatId][r],{unread:true});a=true}}if(a){n.saveState(t,i.chatId);n.updateSubordinateStates()}}}}},{key:"initCollection",value:function e(n,a){if(typeof a.chatId==="undefined"){return false}if(typeof a.chatId==="undefined"||typeof n.collection[a.chatId]!=="undefined"){return true}t.Vue.set(n.collection,a.chatId,a.messages?[].concat(a.messages):[]);t.Vue.set(n.mutationType,a.chatId,{applied:false,initialType:i.MutationType.none,appliedType:i.MutationType.none,scrollStickToTop:0,scrollMessageId:0});t.Vue.set(n.saveMessageList,a.chatId,[]);t.Vue.set(n.saveFileList,a.chatId,[]);t.Vue.set(n.saveUserList,a.chatId,[]);return true}},{key:"setMutationType",value:function e(n,a){var r={applied:false,initialType:i.MutationType.none,appliedType:i.MutationType.none,scrollStickToTop:false,scrollMessageId:0};if(a.initialType&&!a.appliedType){a.appliedType=a.initialType}if(typeof n.mutationType[a.chatId]==="undefined"){t.Vue.set(n.mutationType,a.chatId,r)}n.mutationType[a.chatId]=babelHelpers.objectSpread({},r,a);return true}},{key:"prepareMessage",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=this.validate(Object.assign({},t),i);n.params=Object.assign({},this.getElementState().params,n.params);n.templateId=n.id;return Object.assign({},this.getElementState(),n)}},{key:"manageCacheBeforeSet",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var a={type:d.empty,foundElements:[],noneElements:[]};if(!t||t.length<=0){return a}var r=s(i),o;try{for(r.s();!(o=r.n()).done;){var l=o.value;if(t.includes(l)){if(a.type===d.empty){a.type=d.found}a.foundElements.push(l)}else{if(a.type===d.empty){a.type=d.none}a.noneElements.push(l)}}}catch(e){r.e(e)}finally{r.f()}if(a.type===d.found&&t.length===i.length&&a.foundElements.length===i.length){a.type=d.equal}else if(a.type===d.none&&!n&&a.foundElements.length>0){var c=this.manageCacheBeforeSet(t.reverse(),i.reverse(),true);if(c.type===d.found){c.type=d.foundReverse;return c}}return a}},{key:"updateSaveLists",value:function e(t,n){if(!this.isSaveAvailable()){return true}if(!n||!this.store.getters["dialogues/canSaveChat"]||!this.store.getters["dialogues/canSaveChat"](n)){return false}this.initCollection(t,{chatId:n});var a=0;var r=[];var o=[];var s=[];var l=this.store.getters["dialogues/getByChatId"](n);if(l&&l.type==="private"){s.push(parseInt(l.dialogId))}for(var c=t.collection[n].length-1;c>=0;c--){if(t.collection[n][c].id.toString().startsWith("temporary")){continue}if(a>=i.StorageLimit.messages&&!t.collection[n][c].unread){break}r.unshift(t.collection[n][c].id);a++}r=r.slice(0,i.StorageLimit.messages);t.collection[n].filter(function(e){return r.includes(e.id)}).forEach(function(e){if(e.authorId>0){s.push(e.authorId)}if(e.params.FILE_ID instanceof Array){o=e.params.FILE_ID.concat(o)}});t.saveMessageList[n]=r;t.saveFileList[n]=babelHelpers.toConsumableArray(new Set(o));t.saveUserList[n]=babelHelpers.toConsumableArray(new Set(s));return true}},{key:"getSaveTimeout",value:function e(){return 150}},{key:"saveState",value:function e(t,i){if(!this.updateSaveLists(t,i)){return false}babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"saveState",this).call(this,function(){var e={collection:{},saveMessageList:{},saveUserList:{},saveFileList:{}};var i=function i(n){if(!t.saveMessageList.hasOwnProperty(n)){return"continue"}if(!t.collection[n]){return"continue"}if(!e.collection[n]){e.collection[n]=[]}t.collection[n].filter(function(e){return t.saveMessageList[n].includes(e.id)}).forEach(function(t){return e.collection[n].push(t)});e.saveMessageList[n]=t.saveMessageList[n];e.saveFileList[n]=t.saveFileList[n];e.saveUserList[n]=t.saveUserList[n]};for(var n in t.saveMessageList){var a=i(n);if(a==="continue")continue}return e})}},{key:"updateSubordinateStates",value:function e(){this.store.dispatch("users/saveState");this.store.dispatch("files/saveState")}},{key:"validate",value:function e(t,i){var a={};if(typeof t.id==="number"){a.id=t.id}else if(typeof t.id==="string"){if(t.id.startsWith("temporary")){a.id=t.id}else{a.id=parseInt(t.id)}}if(typeof t.templateId==="number"){a.templateId=t.templateId}else if(typeof t.templateId==="string"){if(t.templateId.startsWith("temporary")){a.templateId=t.templateId}else{a.templateId=parseInt(t.templateId)}}if(typeof t.chat_id!=="undefined"){t.chatId=t.chat_id}if(typeof t.chatId==="number"||typeof t.chatId==="string"){a.chatId=parseInt(t.chatId)}if(typeof t.date!=="undefined"){a.date=n.Utils.date.cast(t.date)}if(typeof t.textOriginal==="string"||typeof t.textOriginal==="number"){a.text=t.textOriginal.toString();if(typeof t.text==="string"||typeof t.text==="number"){a.textConverted=this.convertToHtml({text:t.text.toString(),isConverted:true})}}else{if(typeof t.text_converted!=="undefined"){t.textConverted=t.text_converted}if(typeof t.textConverted==="string"||typeof t.textConverted==="number"){a.textConverted=t.textConverted.toString()}if(typeof t.text==="string"||typeof t.text==="number"){a.text=t.text.toString();var r=typeof a.textConverted!=="undefined";a.textConverted=this.convertToHtml({text:r?a.textConverted:a.text,isConverted:r})}}if(typeof t.senderId!=="undefined"){t.authorId=t.senderId}else if(typeof t.author_id!=="undefined"){t.authorId=t.author_id}if(typeof t.authorId==="number"||typeof t.authorId==="string"){if(t.system===true||t.system==="Y"){a.authorId=0}else{a.authorId=parseInt(t.authorId)}}if(babelHelpers.typeof(t.params)==="object"&&t.params!==null){var o=this.validateParams(t.params,i);if(o){a.params=o}}if(typeof t.push==="boolean"){a.push=t.push}if(typeof t.sending==="boolean"){a.sending=t.sending}if(typeof t.unread==="boolean"){a.unread=t.unread}if(typeof t.blink==="boolean"){a.blink=t.blink}if(typeof t.error==="boolean"||typeof t.error==="string"){a.error=t.error}if(typeof t.retry==="boolean"){a.retry=t.retry}return a}},{key:"validateParams",value:function e(t,i){var a={};try{for(var r in t){if(!t.hasOwnProperty(r)){continue}if(r==="COMPONENT_ID"){if(typeof t[r]==="string"&&BX.Vue.isComponent(t[r])){a[r]=t[r]}}else if(r==="LIKE"){if(t[r]instanceof Array){a["REACTION"]={like:t[r].map(function(e){return parseInt(e)})}}}else if(r==="CHAT_LAST_DATE"){a[r]=n.Utils.date.cast(t[r])}else if(r==="AVATAR"){if(t[r]){a[r]=t[r].startsWith("http")?t[r]:i.host+t[r]}}else if(r==="NAME"){if(t[r]){a[r]=t[r]}}else if(r==="ATTACH"){a[r]=this.decodeAttach(t[r])}else{a[r]=t[r]}}}catch(e){}var o=false;for(var s in a){if(!a.hasOwnProperty(s)){continue}o=true;break}return o?a:null}},{key:"convertToHtml",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.quote,n=i===void 0?true:i,a=t.image,r=a===void 0?true:a,o=t.text,s=o===void 0?"":o,l=t.highlightText,c=l===void 0?"":l,d=t.isConverted,u=d===void 0?false:d,f=t.enableBigSmile,p=f===void 0?true:f;s=s.trim();if(!u){s=s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}if(s.startsWith("/me")){s="<i>".concat(s.substr(4),"</i>")}else if(s.startsWith("/loud")){s="<b>".concat(s.substr(6),"</b>")}var h="&gt;&gt;";if(n&&s.indexOf(h)>=0){var g=s.split(u?"<br />":"\n");for(var m=0;m<g.length;m++){if(g[m].startsWith(h)){g[m]=g[m].replace(h,'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">');while(++m<g.length&&g[m].startsWith(h)){g[m]=g[m].replace(h,"")}g[m-1]+="</div></div><br>"}}s=g.join("<br />")}s=s.replace(/\n/gi,"<br />");s=s.replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;");s=this.decodeBbCode(s,false,p);if(n){s=s.replace(/------------------------------------------------------<br \/>(.*?)\[(.*?)\]<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,function(e,t,i,n,a,r){return(r>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap"><div class="bx-im-message-content-quote-name"><span class="bx-im-message-content-quote-name-text">'+t+'</span><span class="bx-im-message-content-quote-name-time">'+i+"</span></div>"+n+"</div></div><br />"});s=s.replace(/------------------------------------------------------<br \/>(.*?)------------------------------------------------------(<br \/>)?/g,function(e,t,i,n,a){return(a>0?"<br>":"")+'<div class="bx-im-message-content-quote"><div class="bx-im-message-content-quote-wrap">'+t+"</div></div><br />"})}if(r){var y=false;s=s.replace(/<a(.*?)>(http[s]{0,1}:\/\/.*?)<\/a>/gi,function(e,t,i,n){if(!i.match(/(\.(jpg|jpeg|png|gif|webp)\?|\.(jpg|jpeg|png|gif|webp)$)/i)||i.indexOf("/docs/pub/")>0||i.indexOf("logout=yes")>0){return e}else{y=true;return(n>0?"<br />":"")+"<a"+t+' target="_blank" class="bx-im-element-file-image"><img src="'+i+'" class="bx-im-element-file-image-source-text" onerror="BX.Messenger.Model.MessagesModel.hideErrorImage(this)"></a></span>'}});if(y){s=s.replace(/<\/span>(\n?)<br(\s\/?)>/gi,"</span>").replace(/<br(\s\/?)>(\n?)<br(\s\/?)>(\n?)<span/gi,"<br /><span")}}if(c){s=s.replace(new RegExp("("+c.replace(/[\-\[\]\/{}()*+?.\\^$|]/g,"\\$&")+")","ig"),'<span class="bx-messenger-highlight">$1</span>')}if(p){s=s.replace(/^(\s*<img\s+src=[^>]+?data-code=[^>]+?data-definition="UHD"[^>]+?style="width:)(\d+)(px[^>]+?height:)(\d+)(px[^>]+?class="bx-smile"\s*\/?>\s*)$/,function e(t,i,n,a,r,o){return i+parseInt(n,10)*1.7+a+parseInt(r,10)*1.7+o})}if(s.substr(-6)=="<br />"){s=s.substr(0,s.length-6)}s=s.replace(/<br><br \/>/gi,"<br />");s=s.replace(/<br \/><br>/gi,"<br />");return s}},{key:"decodeBbCode",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return a.decodeBbCode({text:t,textOnly:i,enableBigSmile:n})}},{key:"decodeAttach",value:function e(t){var i=this;if(Array.isArray(t)){t.forEach(function(e){e=i.decodeAttach(e)})}else if(babelHelpers.typeof(t)==="object"&&t!==null){for(var a in t){if(t.hasOwnProperty(a)){t[a]=this.decodeAttach(t[a])}}}else{if(typeof t==="string"){t=n.Utils.text.htmlspecialcharsback(t)}}return t}}],[{key:"decodeBbCode",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.text,a=t.textOnly,r=a===void 0?false:a,o=t.enableBigSmile,s=o===void 0?true:o;var l=[];i=i.replace(/\[CODE\]\n?([\s\S]*?)\[\/CODE\]/gi,function(e,t){var i=l.length;l.push(t);return"####REPLACEMENT_MARK_"+i+"####"});i=i.replace(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,function(e,t,i){var a=document.createElement("a");a.href=n.Utils.text.htmlspecialcharsback(t);a.target="_blank";a.text=n.Utils.text.htmlspecialcharsback(i);var r=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];if(r.indexOf(a.protocol)<=-1){return e}return a.outerHTML});i=i.replace(/\[url\]([^\]]+)\[\/url\]/gi,function(e,t){t=n.Utils.text.htmlspecialcharsback(t);var i=document.createElement("a");i.href=t;i.target="_blank";i.text=t;var a=["http:","https:","ftp:","file:","tel:","callto:","mailto:","skype:","viber:"];if(a.indexOf(i.protocol)<=-1){return e}return i.outerHTML});i=i.replace(/\[LIKE\]/gi,'<span class="bx-smile bx-im-smile-like"></span>');i=i.replace(/\[DISLIKE\]/gi,'<span class="bx-smile bx-im-smile-dislike"></span>');i=i.replace(/\[BR\]/gi,"<br/>");i=i.replace(/\[([buis])\](.*?)\[(\/[buis])\]/gi,function(e,t,i,n){return"<"+t+">"+i+"<"+n+">"});i=i.replace(/\[CHAT=(imol\|)?([0-9]{1,})\](.*?)\[\/CHAT\]/gi,function(e,t,i,n){return t?n:'<span class="bx-im-mention" data-type="CHAT" data-value="chat'+i+'">'+n+"</span>"});i=i.replace(/\[CALL(?:=(.+?))?\](.+?)?\[\/CALL\]/gi,function(e,t,i){return'<span class="bx-im-mention" data-type="CALL" data-value="'+n.Utils.text.htmlspecialchars(t)+'">'+i+"</span>"});i=i.replace(/\[PCH=([0-9]{1,})\](.*?)\[\/PCH\]/gi,function(e,t,i){return i});i=i.replace(/\[SEND(?:=(.+?))?\](.+?)?\[\/SEND\]/gi,function(e,t,i){var n="";i=i?i:t;t=(t?t:i).replace("<br />","\n");if(!r&&i){i=i.replace(/<([\w]+)[^>]*>(.*?)<\\1>/i,"$2",i);i=i.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",i);n='<span class="bx-im-message-command-wrap">'+'<span class="bx-im-message-command" data-entity="send">'+i+"</span>"+'<span class="bx-im-message-command-data">'+t+"</span>"+"</span>"}else{n=i}return n});i=i.replace(/\[PUT(?:=(.+?))?\](.+?)?\[\/PUT\]/gi,function(e,t,i){var n="";i=i?i:t;t=(t?t:i).replace("<br />","\n");if(!r&&i){i=i.replace(/<([\w]+)[^>]*>(.*?)<\/\1>/i,"$2",i);i=i.replace(/\[([\w]+)[^\]]*\](.*?)\[\/\1\]/i,"$2",i);n='<span class="bx-im-message-command" data-entity="put">'+i+"</span>";n+='<span class="bx-im-message-command-data">'+t+"</span>"}else{n=i}return n});var c=0;if(s){c=i.replace(/\[icon\=([^\]]*)\]/gi,"").trim().length}i=i.replace(/\[icon\=([^\]]*)\]/gi,function(e){var t=e.match(/icon\=(\S+[^\s.,> )\];\'\"!?])/i);if(t&&t[1]){t=t[1]}else{return""}var i={src:t,border:0};var a=e.match(/size\=(\d+)/i);if(a&&a[1]){i["width"]=a[1];i["height"]=a[1]}else{var r=e.match(/width\=(\d+)/i);if(r&&r[1]){i["width"]=r[1]}var o=e.match(/height\=(\d+)/i);if(o&&o[1]){i["height"]=o[1]}if(i["width"]&&!i["height"]){i["height"]=i["width"]}else if(i["height"]&&!i["width"]){i["width"]=i["height"]}else if(i["height"]&&i["width"]);else{i["width"]=20;i["height"]=20}}i["width"]=i["width"]>100?100:i["width"];i["height"]=i["height"]>100?100:i["height"];if(s&&c===0&&i["width"]===i["height"]&&i["width"]===20){i["width"]=40;i["height"]=40}var l=e.match(/title\=(.*[^\s\]])/i);if(l&&l[1]){l=l[1];if(l.indexOf("width=")>-1){l=l.substr(0,l.indexOf("width="))}if(l.indexOf("height=")>-1){l=l.substr(0,l.indexOf("height="))}if(l.indexOf("size=")>-1){l=l.substr(0,l.indexOf("size="))}if(l){i["title"]=n.Utils.text.htmlspecialchars(l).trim();i["alt"]=i["title"]}}var d="";for(var u in i){if(i.hasOwnProperty(u)){d+=u+'="'+i[u]+'" '}}return'<img class="bx-smile bx-icon" '+d+">"});l.forEach(function(e,t){i=i.replace("####REPLACEMENT_MARK_"+t+"####",!r?'<div class="bx-im-message-content-code">'+e+"</div>":e)});return i}},{key:"hideErrorImage",value:function e(t){if(t.parentNode&&t.parentNode){t.parentNode.innerHTML='<a href="'+t.src+'" target="_blank">'+t.src+"</a>"}return true}}]);return a}(a.VuexBuilderModel);function f(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=p(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function p(e,t){if(!e)return;if(typeof e==="string")return h(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(e,t)}function h(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var g=function(e){babelHelpers.inherits(a,e);function a(){babelHelpers.classCallCheck(this,a);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).apply(this,arguments))}babelHelpers.createClass(a,[{key:"getName",value:function e(){return"dialogues"}},{key:"getState",value:function e(){return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:{},saveDialogList:[],saveChatList:[]}}},{key:"getStateSaveException",value:function e(){return{host:null}}},{key:"getElementStateSaveException",value:function e(){return{writingList:null,quoteId:null}}},{key:"getElementState",value:function e(){return{dialogId:"0",chatId:0,counter:0,userCounter:0,unreadId:0,unreadLastId:0,managerList:[],readedList:[],writingList:[],textareaMessage:"",quoteId:0,editId:0,init:false,name:"",owner:0,extranet:false,avatar:"",color:"#17A3EA",type:"chat",entityType:"",entityId:"",entityData1:"",entityData2:"",entityData3:"",dateCreate:new Date,restrictions:{avatar:true,extend:true,leave:true,leaveOwner:true,rename:true},public:{code:"",link:""}}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(e){if(!t.collection[e]){return null}return t.collection[e]}},getByChatId:function e(t){return function(e){e=parseInt(e);for(var i in t.collection){if(!t.collection.hasOwnProperty(i)){continue}if(t.collection[i].chatId===e){return t.collection[i]}}return null}},getBlank:function e(i){return function(e){return t.getElementState()}},getQuoteId:function e(t){return function(e){if(!t.collection[e]){return 0}return t.collection[e].quoteId}},getEditId:function e(t){return function(e){if(!t.collection[e]){return 0}return t.collection[e].editId}},canSaveChat:function e(t){return function(e){if(/^\d+$/.test(e)){e=parseInt(e)}return t.saveChatList.includes(parseInt(e))}},canSaveDialog:function e(t){return function(e){return t.saveDialogList.includes(e.toString())}},isPrivateDialog:function e(t){return function(e){e=e.toString();return t.collection[e.toString()]&&t.collection[e].type==="private"}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){if(n instanceof Array){n=n.map(function(e){return Object.assign({},t.validate(Object.assign({},e),{host:i.state.host}),{init:true})})}else{var a=[];a.push(Object.assign({},t.validate(Object.assign({},n),{host:i.state.host}),{init:true}));n=a}i.commit("set",n)},update:function e(i,n){if(typeof i.state.collection[n.dialogId]==="undefined"||i.state.collection[n.dialogId].init===false){return true}i.commit("update",{dialogId:n.dialogId,fields:t.validate(Object.assign({},n.fields),{host:i.state.host})});return true},delete:function e(t,i){t.commit("delete",i.dialogId);return true},updateWriting:function e(i,n){if(typeof i.state.collection[n.dialogId]==="undefined"||i.state.collection[n.dialogId].init===false){return true}var a=i.state.collection[n.dialogId].writingList.findIndex(function(e){return e.userId===n.userId});if(n.action){if(a>=0){return true}else{var r=[].concat(i.state.collection[n.dialogId].writingList);r.unshift({userId:n.userId,userName:n.userName});i.commit("update",{actionName:"updateWriting/1",dialogId:n.dialogId,fields:t.validate({writingList:r},{host:i.state.host})})}}else{if(a>=0){var o=i.state.collection[n.dialogId].writingList.filter(function(e){return e.userId!==n.userId});i.commit("update",{actionName:"updateWriting/2",dialogId:n.dialogId,fields:t.validate({writingList:o},{host:i.state.host})});return true}else{return true}}return false},updateReaded:function e(i,n){if(typeof i.state.collection[n.dialogId]==="undefined"||i.state.collection[n.dialogId].init===false){return true}var a=i.state.collection[n.dialogId].readedList.filter(function(e){return e.userId!==n.userId});if(n.action){a.push({userId:n.userId,userName:n.userName||"",messageId:n.messageId,date:n.date||new Date})}i.commit("update",{actionName:"updateReaded",dialogId:n.dialogId,fields:t.validate({readedList:a},{host:i.state.host})});return false},increaseCounter:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var n=t.state.collection[i.dialogId].counter;if(n===100){return true}var a=n+i.count;if(a>100){a=100}var r={counter:a};if(typeof i.unreadLastId!=="undefined"){r.unreadLastId=i.unreadLastId}t.commit("update",{actionName:"increaseCounter",dialogId:i.dialogId,fields:r});return false},decreaseCounter:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}var n=t.state.collection[i.dialogId].counter;if(n===100){return true}var a=n-i.count;if(a<0){a=0}var r=i.unreadId>t.state.collection[i.dialogId].unreadId?i.unreadId:t.state.collection[i.dialogId].unreadId;if(t.state.collection[i.dialogId].unreadId!==r||t.state.collection[i.dialogId].counter!==a){if(a===0){r=0}t.commit("update",{actionName:"decreaseCounter",dialogId:i.dialogId,fields:{counter:a,unreadId:r}})}return false},saveDialog:function e(t,i){if(typeof t.state.collection[i.dialogId]==="undefined"||t.state.collection[i.dialogId].init===false){return true}t.commit("saveDialog",{dialogId:i.dialogId,chatId:i.chatId});return false}}}},{key:"getMutations",value:function e(){var t=this;return{initCollection:function e(i,n){t.initCollection(i,n)},saveDialog:function e(n,a){if(!(a.chatId>0&&a.dialogId.length>0)){return false}var r=n.saveDialogList.filter(function(e){return e!==a.dialogId});r.unshift(a.dialogId);r=r.slice(0,i.StorageLimit.dialogues);if(n.saveDialogList.join(",")===r.join(",")){return true}n.saveDialogList=r;var o=n.saveChatList.filter(function(e){return e!==a.chatId});o.unshift(a.chatId);n.saveChatList=o.slice(0,i.StorageLimit.dialogues);t.saveState(n)},set:function e(i,n){var a=f(n),r;try{for(a.s();!(r=a.n()).done;){var o=r.value;t.initCollection(i,{dialogId:o.dialogId});i.collection[o.dialogId]=Object.assign(t.getElementState(),i.collection[o.dialogId],o)}}catch(e){a.e(e)}finally{a.f()}t.saveState(i)},update:function e(i,n){t.initCollection(i,n);i.collection[n.dialogId]=Object.assign(i.collection[n.dialogId],n.fields);t.saveState(i)},delete:function e(i,n){delete i.collection[n.dialogId];t.saveState(i)}}}},{key:"initCollection",value:function e(i,n){if(typeof i.collection[n.dialogId]!=="undefined"){return true}t.Vue.set(i.collection,n.dialogId,this.getElementState());if(n.fields){i.collection[n.dialogId]=Object.assign(i.collection[n.dialogId],this.validate(Object.assign({},n.fields),{host:i.host}))}return true}},{key:"getSaveTimeout",value:function e(){return 100}},{key:"saveState",value:function e(){var t=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.isSaveAvailable()){return true}babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"saveState",this).call(this,function(){var e={collection:{},saveDialogList:[].concat(i.saveDialogList),saveChatList:[].concat(i.saveChatList)};i.saveDialogList.forEach(function(n){if(!i.collection[n])return false;e.collection[n]=Object.assign(t.getElementState(),t.cloneState(i.collection[n],t.getElementStateSaveException()))});return e})}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a={};i.host=i.host||this.getState().host;if(typeof t.dialog_id!=="undefined"){t.dialogId=t.dialog_id}if(typeof t.dialogId==="number"||typeof t.dialogId==="string"){a.dialogId=t.dialogId.toString()}if(typeof t.chat_id!=="undefined"){t.chatId=t.chat_id}else if(typeof t.id!=="undefined"){t.chatId=t.id}if(typeof t.chatId==="number"||typeof t.chatId==="string"){a.chatId=parseInt(t.chatId)}if(typeof t.quoteId==="number"){a.quoteId=parseInt(t.quoteId)}if(typeof t.editId==="number"){a.editId=parseInt(t.editId)}if(typeof t.counter==="number"||typeof t.counter==="string"){a.counter=parseInt(t.counter)}if(typeof t.user_counter==="number"||typeof t.user_counter==="string"){a.userCounter=parseInt(t.user_counter)}if(typeof t.userCounter==="number"||typeof t.userCounter==="string"){a.userCounter=parseInt(t.userCounter)}if(typeof t.unread_id!=="undefined"){t.unreadId=t.unread_id}if(typeof t.unreadId==="number"||typeof t.unreadId==="string"){a.unreadId=parseInt(t.unreadId)}if(typeof t.unread_last_id!=="undefined"){t.unreadLastId=t.unread_last_id}if(typeof t.unreadLastId==="number"||typeof t.unreadLastId==="string"){a.unreadLastId=parseInt(t.unreadLastId)}if(typeof t.readed_list!=="undefined"){t.readedList=t.readed_list}if(typeof t.readedList!=="undefined"){a.readedList=[];if(t.readedList instanceof Array){t.readedList.forEach(function(e){var t={};if(typeof e.user_id!=="undefined"){e.userId=e.user_id}if(typeof e.user_name!=="undefined"){e.userName=e.user_name}if(typeof e.message_id!=="undefined"){e.messageId=e.message_id}if(!e.userId||!e.userName||!e.messageId){return false}t.userId=parseInt(e.userId);t.userName=e.userName.toString();t.messageId=parseInt(e.messageId);t.date=n.Utils.date.cast(e.date);a.readedList.push(t)})}}if(typeof t.writing_list!=="undefined"){t.writingList=t.writing_list}if(typeof t.writingList!=="undefined"){a.writingList=[];if(t.writingList instanceof Array){t.writingList.forEach(function(e){var t={};if(!e.userId){return false}t.userId=parseInt(e.userId);t.userName=n.Utils.text.htmlspecialcharsback(e.userName);a.writingList.push(t)})}}if(typeof t.manager_list!=="undefined"){t.managerList=t.manager_list}if(typeof t.managerList!=="undefined"){a.managerList=[];if(t.managerList instanceof Array){t.managerList.forEach(function(e){e=parseInt(e);if(e>0){a.managerList.push(e)}})}}if(typeof t.mute_list!=="undefined"){t.muteList=t.mute_list}if(typeof t.muteList!=="undefined"){a.muteList=[];if(t.muteList instanceof Array){t.muteList.forEach(function(e){e=parseInt(e);if(e>0){a.muteList.push(e)}})}}if(typeof t.textareaMessage!=="undefined"){a.textareaMessage=t.textareaMessage.toString()}if(typeof t.title!=="undefined"){t.name=t.title}if(typeof t.name==="string"||typeof t.name==="number"){a.name=n.Utils.text.htmlspecialcharsback(t.name.toString())}if(typeof t.owner!=="undefined"){t.ownerId=t.owner}if(typeof t.ownerId==="number"||typeof t.ownerId==="string"){a.ownerId=parseInt(t.ownerId)}if(typeof t.extranet==="boolean"){a.extranet=t.extranet}if(typeof t.avatar==="string"){var r;if(!t.avatar||t.avatar.endsWith("/js/im/images/blank.gif")){r=""}else if(t.avatar.startsWith("http")){r=t.avatar}else{r=i.host+t.avatar}if(r){a.avatar=encodeURI(r)}}if(typeof t.color==="string"){a.color=t.color.toString()}if(typeof t.type==="string"){a.type=t.type.toString()}if(typeof t.entity_type!=="undefined"){t.entityType=t.entity_type}if(typeof t.entityType==="string"){a.entityType=t.entityType.toString()}if(typeof t.entity_id!=="undefined"){t.entityId=t.entity_id}if(typeof t.entityId==="string"||typeof t.entityId==="number"){a.entityId=t.entityId.toString()}if(typeof t.entity_data_1!=="undefined"){t.entityData1=t.entity_data_1}if(typeof t.entityData1==="string"){a.entityData1=t.entityData1.toString()}if(typeof t.entity_data_2!=="undefined"){t.entityData2=t.entity_data_2}if(typeof t.entityData2==="string"){a.entityData2=t.entityData2.toString()}if(typeof t.entity_data_3!=="undefined"){t.entityData3=t.entity_data_3}if(typeof t.entityData3==="string"){a.entityData3=t.entityData3.toString()}if(typeof t.date_create!=="undefined"){t.dateCreate=t.date_create}if(typeof t.dateCreate!=="undefined"){a.dateCreate=n.Utils.date.cast(t.dateCreate)}if(typeof t.dateLastOpen!=="undefined"){a.dateLastOpen=n.Utils.date.cast(t.dateLastOpen)}if(babelHelpers.typeof(t.restrictions)==="object"&&t.restrictions){a.restrictions={};if(typeof t.restrictions.AVATAR==="boolean"){a.restrictions.avatar=t.restrictions.AVATAR}if(typeof t.restrictions.EXTEND==="boolean"){a.restrictions.extend=t.restrictions.EXTEND}if(typeof t.restrictions.LEAVE==="boolean"){a.restrictions.leave=t.restrictions.LEAVE}if(typeof t.restrictions.LEAVE_OWNER==="boolean"){a.restrictions.leaveOwner=t.restrictions.LEAVE_OWNER}if(typeof t.restrictions.RENAME==="boolean"){a.restrictions.rename=t.restrictions.RENAME}}if(babelHelpers.typeof(t.public)==="object"&&t.public){a.public={};if(typeof t.public.code==="string"){a.public.code=t.public.code}if(typeof t.public.link==="string"){a.public.link=t.public.link}}return a}}]);return a}(a.VuexBuilderModel);function m(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=y(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function y(e,t){if(!e)return;if(typeof e==="string")return v(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return v(e,t)}function v(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var b=function(e){babelHelpers.inherits(i,e);function i(){babelHelpers.classCallCheck(this,i);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).apply(this,arguments))}babelHelpers.createClass(i,[{key:"getName",value:function e(){return"users"}},{key:"getState",value:function e(){this.startOnlineCheckInterval();return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:{},onlineList:[],mobileOnlineList:[],absentList:[]}}},{key:"getElementState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=t.id,n=i===void 0?0:i,a=t.name,r=a===void 0?this.getVariable("default.name",""):a,o=t.firstName,s=o===void 0?this.getVariable("default.name",""):o,l=t.lastName,c=l===void 0?"":l;return{id:n,name:r,firstName:s,lastName:c,workPosition:"",color:"#048bd0",avatar:"",gender:"M",birthday:false,isBirthday:false,extranet:false,network:false,bot:false,connector:false,externalAuthId:"default",status:"online",idle:false,lastActivityDate:false,mobileLastDate:false,isOnline:false,isMobileOnline:false,absent:false,isAbsent:false,departments:[],phones:{workPhone:"",personalMobile:"",personalPhone:"",innerPhone:""},init:false}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(i){return function(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;e=parseInt(e);if(e<=0){if(n){e=0}else{return null}}if(!n&&(!i.collection[e]||!i.collection[e].init)){return null}if(!i.collection[e]){return t.getElementState({id:e})}return i.collection[e]}},getBlank:function e(i){return function(e){return t.getElementState(e)}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){if(n instanceof Array){n=n.map(function(e){return Object.assign({},t.getElementState(),t.validate(Object.assign({},e),{host:i.state.host}),{init:true})})}else{var a=[];a.push(Object.assign({},t.getElementState(),t.validate(Object.assign({},n),{host:i.state.host}),{init:true}));n=a}i.commit("set",n)},update:function e(i,n){n.id=parseInt(n.id);if(typeof i.state.collection[n.id]==="undefined"||i.state.collection[n.id].init===false){return true}i.commit("update",{id:n.id,fields:t.validate(Object.assign({},n.fields),{host:i.state.host})});return true},delete:function e(t,i){t.commit("delete",i.id);return true},saveState:function e(t,i){t.commit("saveState",{});return true}}}},{key:"getMutations",value:function e(){var t=this;return{set:function e(i,a){var r=m(a),o;try{var s=function e(){var a=o.value;t.initCollection(i,{id:a.id});i.collection[a.id]=a;var r=n.Utils.user.getOnlineStatus(a);if(r.isOnline){i.collection[a.id].isOnline=true;t.addToOnlineList(i,a.id)}var s=n.Utils.user.isMobileActive(a);if(s){i.collection[a.id].isMobileOnline=true;t.addToMobileOnlineList(i,a.id)}if(a.birthday){var l=n.Utils.date.format(new Date,"d-m");if(a.birthday===l){i.collection[a.id].isBirthday=true;var c=t.getTimeToNextMidnight();setTimeout(function(){i.collection[a.id].isBirthday=false},c)}}if(a.absent){a.isAbsent=true;if(!i.absentList.includes(a.id)){t.addToAbsentList(i,a.id);var d=t.getTimeToNextMidnight();var u=1e3*60*60*24;setTimeout(function(){setInterval(function(){return t.startAbsentCheckInterval(i)},u)},d)}}t.saveState(i)};for(r.s();!(o=r.n()).done;){s()}}catch(e){r.e(e)}finally{r.f()}},update:function e(i,a){t.initCollection(i,a);if(typeof a.fields.lastActivityDate!=="undefined"&&i.collection[a.id].lastActivityDate){var r=i.collection[a.id].lastActivityDate.getTime();var o=a.fields.lastActivityDate.getTime();if(o>r){var s=n.Utils.user.getOnlineStatus(a.fields);if(s.isOnline){i.collection[a.id].isOnline=true;t.addToOnlineList(i,a.fields.id)}}}if(typeof a.fields.mobileLastDate!=="undefined"&&i.collection[a.id].mobileLastDate!==a.fields.mobileLastDate){var l=n.Utils.user.isMobileActive(a.fields);if(l){i.collection[a.id].isMobileOnline=true;t.addToMobileOnlineList(i,a.fields.id)}}i.collection[a.id]=Object.assign(i.collection[a.id],a.fields);t.saveState(i)},delete:function e(i,n){delete i.collection[n.id];t.saveState(i)},saveState:function e(i,n){t.saveState(i)}}}},{key:"initCollection",value:function e(i,n){if(typeof i.collection[n.id]!=="undefined"){return true}t.Vue.set(i.collection,n.id,this.getElementState());return true}},{key:"getSaveUserList",value:function e(){if(!this.db){return[]}if(!this.store.getters["messages/getSaveUserList"]){return[]}var t=this.store.getters["messages/getSaveUserList"]();if(!t){return[]}return t}},{key:"getSaveTimeout",value:function e(){return 250}},{key:"saveState",value:function e(t){var n=this;if(!this.isSaveAvailable()){return false}babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"saveState",this).call(this,function(){var e=n.getSaveUserList();if(!e){return false}var i={collection:{}};var a={absent:true,idle:true,mobileLastDate:true,lastActivityDate:true};for(var r in e){if(!e.hasOwnProperty(r)){continue}e[r].forEach(function(e){if(!t.collection[e]){return false}i.collection[e]=n.cloneState(t.collection[e],a)})}return i})}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a={};i.host=i.host||this.getState().host;if(typeof t.id==="number"||typeof t.id==="string"){a.id=parseInt(t.id)}if(typeof t.first_name!=="undefined"){t.firstName=n.Utils.text.htmlspecialcharsback(t.first_name)}if(typeof t.last_name!=="undefined"){t.lastName=n.Utils.text.htmlspecialcharsback(t.last_name)}if(typeof t.name==="string"||typeof t.name==="number"){t.name=n.Utils.text.htmlspecialcharsback(t.name.toString());a.name=t.name;if(typeof t.firstName==="undefined"||typeof t.firstName!=="undefined"&&!t.firstName){var r=t.name.split(" ");if(r.length>1){delete r[r.length-1];t.firstName=r.join(" ").trim()}else{t.firstName=a.name}}if(typeof t.lastName==="undefined"||typeof t.lastName!=="undefined"&&!t.lastName){var o=t.name.split(" ");if(o.length>1){t.lastName=o[o.length-1]}else{t.lastName=""}}}if(typeof t.firstName==="string"||typeof t.firstName==="number"){a.firstName=n.Utils.text.htmlspecialcharsback(t.firstName.toString())}if(typeof t.lastName==="string"||typeof t.lastName==="number"){a.lastName=n.Utils.text.htmlspecialcharsback(t.lastName.toString())}if(typeof t.work_position!=="undefined"){t.workPosition=t.work_position}if(typeof t.workPosition==="string"||typeof t.workPosition==="number"){a.workPosition=t.workPosition.toString()}if(typeof t.color==="string"){a.color=t.color}if(typeof t.avatar==="string"){var s;if(!t.avatar||t.avatar.endsWith("/js/im/images/blank.gif")){s=""}else if(t.avatar.startsWith("http")){s=t.avatar}else{s=i.host+t.avatar}if(s){a.avatar=encodeURI(s)}}if(typeof t.gender!=="undefined"){a.gender=t.gender==="F"?"F":"M"}if(typeof t.birthday==="string"){a.birthday=t.birthday}if(typeof t.extranet==="boolean"){a.extranet=t.extranet}if(typeof t.network==="boolean"){a.network=t.network}if(typeof t.bot==="boolean"){a.bot=t.bot}if(typeof t.connector==="boolean"){a.connector=t.connector}if(typeof t.external_auth_id!=="undefined"){t.externalAuthId=t.external_auth_id}if(typeof t.externalAuthId==="string"&&t.externalAuthId){a.externalAuthId=t.externalAuthId}if(typeof t.status==="string"){a.status=t.status}if(typeof t.idle!=="undefined"){a.idle=n.Utils.date.cast(t.idle,false)}if(typeof t.last_activity_date!=="undefined"){t.lastActivityDate=t.last_activity_date}if(typeof t.lastActivityDate!=="undefined"){a.lastActivityDate=n.Utils.date.cast(t.lastActivityDate,false)}if(typeof t.mobile_last_date!=="undefined"){t.mobileLastDate=t.mobile_last_date}if(typeof t.mobileLastDate!=="undefined"){a.mobileLastDate=n.Utils.date.cast(t.mobileLastDate,false)}if(typeof t.absent!=="undefined"){a.absent=n.Utils.date.cast(t.absent,false)}if(typeof t.departments!=="undefined"){a.departments=[];if(t.departments instanceof Array){t.departments.forEach(function(e){e=parseInt(e);if(e>0){a.departments.push(e)}})}}if(babelHelpers.typeof(t.phones)==="object"&&t.phones){a.phones={};if(typeof t.phones.work_phone!=="undefined"){t.phones.workPhone=t.phones.work_phone}if(typeof t.phones.workPhone==="string"||typeof t.phones.workPhone==="number"){a.phones.workPhone=t.phones.workPhone.toString()}if(typeof t.phones.personal_mobile!=="undefined"){t.phones.personalMobile=t.phones.personal_mobile}if(typeof t.phones.personalMobile==="string"||typeof t.phones.personalMobile==="number"){a.phones.personalMobile=t.phones.personalMobile.toString()}if(typeof t.phones.personal_phone!=="undefined"){t.phones.personalPhone=t.phones.personal_phone}if(typeof t.phones.personalPhone==="string"||typeof t.phones.personalPhone==="number"){a.phones.personalPhone=t.phones.personalPhone.toString()}if(typeof t.phones.inner_phone!=="undefined"){t.phones.innerPhone=t.phones.inner_phone}if(typeof t.phones.innerPhone==="string"||typeof t.phones.innerPhone==="number"){a.phones.innerPhone=t.phones.innerPhone.toString()}}return a}},{key:"addToOnlineList",value:function e(t,i){if(!t.onlineList.includes(i)){t.onlineList.push(i)}}},{key:"addToMobileOnlineList",value:function e(t,i){if(!t.mobileOnlineList.includes(i)){t.mobileOnlineList.push(i)}}},{key:"addToAbsentList",value:function e(t,i){if(!t.absentList.includes(i)){t.absentList.push(i)}}},{key:"getTimeToNextMidnight",value:function e(){var t=new Date((new Date).setHours(24,0,0)).getTime();return t-new Date}},{key:"startAbsentCheckInterval",value:function e(t){var i=m(t.absentList),n;try{var a=function e(){var i=n.value;var a=t.collection[i];if(!a){return"continue"}var r=(new Date).getTime();var o=new Date(t.collection[i].absent).getTime();if(o<=r){t.absentList=t.absentList.filter(function(e){return e!==i});a.isAbsent=false}};for(i.s();!(n=i.n()).done;){var r=a();if(r==="continue")continue}}catch(e){i.e(e)}finally{i.f()}}},{key:"startOnlineCheckInterval",value:function e(){var t=this;var i=6e4;setInterval(function(){var e=m(t.store.state.users.onlineList),i;try{var a=function e(){var a=i.value;var r=t.store.state.users.collection[a];if(!r){return"continue"}var o=n.Utils.user.getOnlineStatus(r);if(o.isOnline){r.isOnline=true}else{r.isOnline=false;t.store.state.users.onlineList=t.store.state.users.onlineList.filter(function(e){return e!==a})}};for(e.s();!(i=e.n()).done;){var r=a();if(r==="continue")continue}}catch(t){e.e(t)}finally{e.f()}var o=m(t.store.state.users.mobileOnlineList),s;try{var l=function e(){var i=s.value;var a=t.store.state.users.collection[i];if(!a){return"continue"}var r=n.Utils.user.isMobileActive(a);if(r){a.isMobileOnline=true}else{a.isMobileOnline=false;t.store.state.users.mobileOnlineList=t.store.state.users.mobileOnlineList.filter(function(e){return e!==i})}};for(o.s();!(s=o.n()).done;){var c=l();if(c==="continue")continue}}catch(e){o.e(e)}finally{o.f()}},i)}}]);return i}(a.VuexBuilderModel);function I(e,t){var i;if(typeof Symbol==="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=S(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var n=0;var a=function e(){};return{s:a,n:function t(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){i=e[Symbol.iterator]()},n:function e(){var t=i.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&i.return!=null)i.return()}finally{if(o)throw s}}}}function S(e,t){if(!e)return;if(typeof e==="string")return x(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return x(e,t)}function x(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++){n[i]=e[i]}return n}var k=function(e){babelHelpers.inherits(a,e);function a(){babelHelpers.classCallCheck(this,a);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).apply(this,arguments))}babelHelpers.createClass(a,[{key:"getName",value:function e(){return"files"}},{key:"getState",value:function e(){return{created:0,host:this.getVariable("host",location.protocol+"//"+location.host),collection:{},index:{}}}},{key:"getElementState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n=t.id,a=n===void 0?0:n,r=t.chatId,o=r===void 0?0:r,s=t.name,l=s===void 0?this.getVariable("default.name",""):s;return{id:a,chatId:o,name:l,templateId:a,date:new Date,type:"file",extension:"",icon:"empty",size:0,image:false,status:i.FileStatus.done,progress:100,authorId:0,authorName:"",urlPreview:"",urlShow:"",urlDownload:"",init:false,viewerAttrs:{}}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(t){return function(e,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!e||!i){return null}if(!t.index[e]||!t.index[e][i]){return null}if(!n&&!t.index[e][i].init){return null}return t.index[e][i]}},getList:function e(t){return function(e){if(!t.index[e]){return null}return t.index[e]}},getBlank:function e(i){return function(e){return t.getElementState(e)}}}}},{key:"getActions",value:function e(){var t=this;return{add:function e(i,n){var a=t.validate(Object.assign({},n),{host:i.state.host});a.id="temporary"+(new Date).getTime()+i.state.created;a.templateId=a.id;a.init=true;i.commit("add",Object.assign({},t.getElementState(),a));return a.id},set:function e(n,a){if(a instanceof Array){a=a.map(function(e){var i=t.validate(Object.assign({},e),{host:n.state.host});i.templateId=i.id;return Object.assign({},t.getElementState(),i,{init:true})})}else{var r=t.validate(Object.assign({},a),{host:n.state.host});r.templateId=r.id;a=[];a.push(Object.assign({},t.getElementState(),r,{init:true}))}n.commit("set",{insertType:i.MutationType.setAfter,data:a})},setBefore:function e(n,a){if(a instanceof Array){a=a.map(function(e){var i=t.validate(Object.assign({},e),{host:n.state.host});i.templateId=i.id;return Object.assign({},t.getElementState(),i,{init:true})})}else{var r=t.validate(Object.assign({},a),{host:n.state.host});r.templateId=r.id;a=[];a.push(Object.assign({},t.getElementState(),r,{init:true}))}n.commit("set",{actionName:"setBefore",insertType:i.MutationType.setBefore,data:a})},update:function e(i,n){var a=t.validate(Object.assign({},n.fields),{host:i.state.host});i.commit("initCollection",{chatId:n.chatId});var r=i.state.collection[n.chatId].findIndex(function(e){return e.id===n.id});if(r<0){return false}i.commit("update",{id:n.id,chatId:n.chatId,index:r,fields:a});if(n.fields.blink){setTimeout(function(){i.commit("update",{id:n.id,chatId:n.chatId,fields:{blink:false}})},1e3)}return true},delete:function e(t,i){t.commit("delete",{id:i.id,chatId:i.chatId});return true},saveState:function e(t,i){t.commit("saveState",{});return true}}}},{key:"getMutations",value:function e(){var t=this;return{initCollection:function e(i,n){t.initCollection(i,n)},add:function e(i,n){t.initCollection(i,n);i.collection[n.chatId].push(n);i.index[n.chatId][n.id]=n;i.created+=1;t.saveState(i)},set:function e(n,a){var r=I(a.data),o;try{var s=function e(){var r=o.value;t.initCollection(n,{chatId:r.chatId});var s=n.collection[r.chatId].findIndex(function(e){return e.id===r.id});if(s>-1){delete r.templateId;n.collection[r.chatId][s]=Object.assign(n.collection[r.chatId][s],r)}else if(a.insertType===i.MutationType.setBefore){n.collection[r.chatId].unshift(r)}else{n.collection[r.chatId].push(r)}n.index[r.chatId][r.id]=r;t.saveState(n)};for(r.s();!(o=r.n()).done;){s()}}catch(e){r.e(e)}finally{r.f()}},update:function e(i,n){t.initCollection(i,n);var a=-1;if(typeof n.index!=="undefined"&&i.collection[n.chatId][n.index]){a=n.index}else{a=i.collection[n.chatId].findIndex(function(e){return e.id===n.id})}if(a>=0){delete n.fields.templateId;var r=Object.assign(i.collection[n.chatId][a],n.fields);i.collection[n.chatId][a]=r;i.index[n.chatId][r.id]=r;t.saveState(i)}},delete:function e(i,n){t.initCollection(i,n);i.collection[n.chatId]=i.collection[n.chatId].filter(function(e){return e.id!==n.id});delete i.index[n.chatId][n.id];t.saveState(i)},saveState:function e(i,n){t.saveState(i)}}}},{key:"initCollection",value:function e(i,n){if(typeof i.collection[n.chatId]!=="undefined"){return true}t.Vue.set(i.collection,n.chatId,[]);t.Vue.set(i.index,n.chatId,{});return true}},{key:"getLoadedState",value:function e(t){if(!t||babelHelpers.typeof(t)!=="object"){return t}if(babelHelpers.typeof(t.collection)!=="object"){return t}t.index={};var i=function e(i){if(!t.collection.hasOwnProperty(i)){return"continue"}t.index[i]={};t.collection[i].filter(function(e){return e!=null}).forEach(function(e){t.index[i][e.id]=e})};for(var n in t.collection){var a=i(n);if(a==="continue")continue}return t}},{key:"getSaveFileList",value:function e(){if(!this.db){return[]}if(!this.store.getters["messages/getSaveFileList"]){return[]}var t=this.store.getters["messages/getSaveFileList"]();if(!t){return[]}return t}},{key:"getSaveTimeout",value:function e(){return 250}},{key:"saveState",value:function e(t){var i=this;if(!this.isSaveAvailable()){return false}babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"saveState",this).call(this,function(){var e=i.getSaveFileList();if(!e){return false}var n={collection:{}};var a=function i(a){if(!e.hasOwnProperty(a)){return"continue"}e[a].forEach(function(e){if(!t.index[a]){return false}if(!t.index[a][e]){return false}if(!n.collection[a]){n.collection[a]=[]}n.collection[a].push(t.index[a][e])})};for(var r in e){var o=a(r);if(o==="continue")continue}return n})}},{key:"validate",value:function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var o={};r.host=r.host||this.getState().host;if(typeof t.id==="number"){o.id=t.id}else if(typeof t.id==="string"){if(t.id.startsWith("temporary")){o.id=t.id}else{o.id=parseInt(t.id)}}if(typeof t.templateId==="number"){o.templateId=t.templateId}else if(typeof t.templateId==="string"){if(t.templateId.startsWith("temporary")){o.templateId=t.templateId}else{o.templateId=parseInt(t.templateId)}}if(typeof t.chatId==="number"||typeof t.chatId==="string"){o.chatId=parseInt(t.chatId)}if(typeof t.date!=="undefined"){o.date=n.Utils.date.cast(t.date)}if(typeof t.type==="string"){o.type=t.type}if(typeof t.extension==="string"){o.extension=t.extension.toString();if(o.type==="image"){o.icon="img"}else if(o.type==="video"){o.icon="mov"}else{o.icon=a.getIconType(o.extension)}}if(typeof t.name==="string"||typeof t.name==="number"){o.name=t.name.toString()}if(typeof t.size==="number"||typeof t.size==="string"){o.size=parseInt(t.size)}if(typeof t.image==="boolean"){o.image=false}else if(babelHelpers.typeof(t.image)==="object"&&t.image){o.image={width:0,height:0};if(typeof t.image.width==="string"||typeof t.image.width==="number"){o.image.width=parseInt(t.image.width)}if(typeof t.image.height==="string"||typeof t.image.height==="number"){o.image.height=parseInt(t.image.height)}if(o.image.width<=0||o.image.height<=0){o.image=false}}if(typeof t.status==="string"&&typeof i.FileStatus[t.status]!=="undefined"){o.status=t.status}if(typeof t.progress==="number"||typeof t.progress==="string"){o.progress=parseInt(t.progress)}if(typeof t.authorId==="number"||typeof t.authorId==="string"){o.authorId=parseInt(t.authorId)}if(typeof t.authorName==="string"||typeof t.authorName==="number"){o.authorName=t.authorName.toString()}if(typeof t.urlPreview==="string"){if(!t.urlPreview||t.urlPreview.startsWith("http")||t.urlPreview.startsWith("bx")||t.urlPreview.startsWith("file")||t.urlPreview.startsWith("blob")){o.urlPreview=t.urlPreview}else{o.urlPreview=r.host+t.urlPreview}}if(typeof t.urlDownload==="string"){if(!t.urlDownload||t.urlDownload.startsWith("http")||t.urlDownload.startsWith("bx")||t.urlPreview.startsWith("file")){o.urlDownload=t.urlDownload}else{o.urlDownload=r.host+t.urlDownload}}if(typeof t.urlShow==="string"){if(!t.urlShow||t.urlShow.startsWith("http")||t.urlShow.startsWith("bx")||t.urlShow.startsWith("file")){o.urlShow=t.urlShow}else{o.urlShow=r.host+t.urlShow}}if(babelHelpers.typeof(t.viewerAttrs)==="object"){if(o.type==="image"&&!n.Utils.platform.isBitrixMobile()){o.viewerAttrs=t.viewerAttrs}if(o.type==="video"&&!n.Utils.platform.isBitrixMobile()&&o.size>a.maxDiskFileSize){o.viewerAttrs=t.viewerAttrs}}return o}}],[{key:"getType",value:function e(t){t=t.toString().toLowerCase().split(".").splice(-1)[0];switch(t){case"png":case"jpe":case"jpg":case"jpeg":case"gif":case"heic":case"bmp":case"webp":return i.FileType.image;case"mp4":case"mkv":case"webm":case"mpeg":case"hevc":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"wmv":case"mov":return i.FileType.video;case"mp3":return i.FileType.audio}return i.FileType.file}},{key:"getIconType",value:function e(t){var i="empty";switch(t.toString()){case"png":case"jpe":case"jpg":case"jpeg":case"gif":case"heic":case"bmp":case"webp":i="img";break;case"mp4":case"mkv":case"webm":case"mpeg":case"hevc":case"avi":case"3gp":case"flv":case"m4v":case"ogg":case"wmv":case"mov":i="mov";break;case"txt":i="txt";break;case"doc":case"docx":i="doc";break;case"xls":case"xlsx":i="xls";break;case"php":i="php";break;case"pdf":i="pdf";break;case"ppt":case"pptx":i="ppt";break;case"rar":i="rar";break;case"zip":case"7z":case"tar":case"gz":case"gzip":i="zip";break;case"set":i="set";break;case"conf":case"ini":case"plist":i="set";break}return i}}]);return a}(a.VuexBuilderModel);babelHelpers.defineProperty(k,"maxDiskFileSize",5242880);var C=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"getName",value:function e(){return"recent"}},{key:"getState",value:function e(){return{host:this.getVariable("host",location.protocol+"//"+location.host),collection:{pinned:[],general:[]}}}},{key:"getElementState",value:function e(){return{id:0,templateId:"",template:"item",chatType:"chat",sectionCode:"general",avatar:"",color:"#048bd0",title:"",lines:{id:0,status:0},message:{id:0,text:"",date:new Date},counter:0,pinned:false,chatId:0,userId:0}}},{key:"getGetters",value:function e(){var t=this;return{get:function e(i){return function(e){return t.findItem(i.collection,e)}}}}},{key:"getActions",value:function e(){var t=this;return{set:function e(i,n){var a={};if(n.pinned instanceof Array){a.pinned=n.pinned.map(function(e){return t.prepareItem(e,{host:i.state.host,sectionCode:"pinned"})})}else if(typeof n.pinned!=="undefined"){var r=[];r.push(t.prepareItem(n.pinned,{host:i.state.host,sectionCode:"pinned"}));a.pinned=r}if(n.general instanceof Array){a.general=n.general.map(function(e){return t.prepareItem(e,{host:i.state.host})})}else if(typeof n.general!=="undefined"){var o=[];o.push(t.prepareItem(n.general,{host:i.state.host}));a.general=o}i.commit("set",a)},updatePlaceholders:function e(i,n){if(!(n.items instanceof Array)){return false}n.items=n.items.map(function(e){return t.prepareItem(e)});n.items.forEach(function(e,a){var r="placeholder"+(n.firstMessage+a);var o=t.findItem(i.state.collection,r,"templateId");var s=t.findItem(i.state.collection,e.id);if(s.element){i.commit("update",{index:s.index,fields:Object.assign({},e),section:"general"});i.commit("delete",{index:o.index,section:"general"})}else{i.commit("update",{index:o.index,fields:Object.assign({},e),section:"general"})}})},update:function e(i,n){if(babelHelpers.typeof(n)!=="object"||n instanceof Array||!n.id||!n.fields){return false}if(typeof n.id==="string"&&!n.id.startsWith("chat")&&n.id!=="notify"){n.id=parseInt(n.id)}var a=t.findItem(i.state.collection,n.id);if(!a.element){return false}i.commit("update",{index:a.index,fields:Object.assign({},t.validate(n.fields)),section:a.element.sectionCode})},pin:function e(i,n){if(babelHelpers.typeof(n)!=="object"||n instanceof Array||!n.id||typeof n.action!=="boolean"){return false}if(typeof n.id==="string"&&!n.id.startsWith("chat")&&n.id!=="notify"){n.id=parseInt(n.id)}var a=t.findItem(i.state.collection,n.id,undefined,n.action?"general":"pinned");if(!a.element){return true}if(n.action){i.state.collection.pinned.push(Object.assign({},a.element,{sectionCode:"pinned",pinned:true}));i.state.collection.pinned.sort(t.sortListByMessageDate);i.commit("delete",{index:a.index,section:"general"})}else{i.state.collection.general.push(Object.assign({},a.element,{sectionCode:"general",pinned:false}));i.state.collection.general.sort(t.sortListByMessageDate);i.commit("delete",{index:a.index,section:"pinned"})}},clearPlaceholders:function e(t,i){t.state.collection.general=t.state.collection.general.filter(function(e){return!e.id.toString().startsWith("placeholder")})},delete:function e(i,n){if(babelHelpers.typeof(n)!=="object"||n instanceof Array||!n.id){return false}if(typeof n.id==="string"&&!n.id.startsWith("chat")&&n.id!=="notify"){n.id=parseInt(n.id)}var a=t.findItem(i.state.collection,n.id);if(!a.element){return false}i.commit("delete",{index:a.index,section:a.element.sectionCode})}}}},{key:"getMutations",value:function e(){var t=this;return{set:function e(i,n){if(n.general instanceof Array){n.general.forEach(function(e){var n=t.initCollection(i,e,"general"),a=n.index,r=n.alreadyExists;if(r){i.collection.general[a]=Object.assign({},i.collection.general[a],e)}})}if(n.pinned instanceof Array){n.pinned.forEach(function(e){var n=t.initCollection(i,e,"pinned"),a=n.index,r=n.alreadyExists;if(r){i.collection.pinned[a]=Object.assign({},i.collection.pinned[a],e)}})}},update:function e(i,n){if(!n||n instanceof Array||babelHelpers.typeof(n.fields)!=="object"||typeof n.index!=="number"||typeof n.section!=="string"){return false}i.collection[n.section][n.index]=Object.assign({},i.collection[n.section][n.index],n.fields);i.collection[n.section].sort(t.sortListByMessageDate)},delete:function e(t,i){if(!i||i instanceof Array||typeof i.index!=="number"||typeof i.section!=="string"){return false}t.collection[i.section].splice(i.index,1)}}}},{key:"initCollection",value:function e(t,i,n){var a=this.findItem(t.collection,i.id,undefined,n);if(a.element){return{index:a.index,alreadyExists:true}}var r=t.collection[n].push(Object.assign({},this.getElementState(),i));return{index:r-1,alreadyExists:false}}},{key:"validate",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n={};if(typeof t.id==="number"||typeof t.id==="string"){n.id=t.id}if(typeof t.templateId==="string"){n.templateId=t.templateId}if(typeof t.template==="string"){n.template=t.template}if(typeof t.type==="string"){if(t.type==="chat"){if(t.chat.type==="open"){n.chatType="open"}else if(t.chat.type==="chat"){n.chatType="chat"}}else if(t.type==="user"){n.chatType="user"}else if(t.type==="notification"){n.chatType="notification";t.title="Notifications"}}if(typeof t.avatar==="string"){var a;if(!t.avatar||t.avatar.endsWith("/js/im/images/blank.gif")){a=""}else if(t.avatar.startsWith("http")){a=t.avatar}else{a=i.host+t.avatar}if(a){n.avatar=encodeURI(a)}}if(typeof t.color==="string"){n.color=t.color}if(typeof t.title==="string"){n.title=t.title}if(babelHelpers.typeof(t.message)==="object"&&!(t.message instanceof Array)&&t.message!==null){n.message=t.message}if(typeof t.counter==="number"){n.counter=t.counter}if(typeof t.pinned==="boolean"){n.pinned=t.pinned}if(typeof t.chatId==="number"){n.chatId=t.chatId}if(typeof t.userId==="number"){n.userId=t.userId}return n}},{key:"sortListByMessageDate",value:function e(t,i){if(t.message&&i.message){var n=new Date(t.message.date).getTime();var a=new Date(i.message.date).getTime();return a-n}}},{key:"prepareItem",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=this.validate(Object.assign({},t));return Object.assign({},this.getElementState(),n,i)}},{key:"findItem",value:function e(t,i){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"id";var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"general";var r={};if(babelHelpers.typeof(t[a])===undefined){return r}var o=t[a].findIndex(function(e,t){return e[n]===i});if(o!==-1){r.index=o;r.element=t[a][o];return r}return r}}]);return t}(a.VuexBuilderModel);e.ApplicationModel=r;e.CallApplicationModel=o;e.MessagesModel=u;e.DialoguesModel=g;e.UsersModel=b;e.FilesModel=k;e.RecentModel=C})(this.BX.Messenger.Model=this.BX.Messenger.Model||{},BX,BX.Messenger.Const,BX.Messenger.Lib,BX);
//# sourceMappingURL=registry.bundle.map.js