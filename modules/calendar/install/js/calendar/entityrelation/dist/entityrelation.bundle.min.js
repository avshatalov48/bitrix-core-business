this.BX=this.BX||{};(function(e,t,a,n,r){"use strict";let i=e=>e,s,o,l,d,h,c,u,g;class v{constructor(e){this.parentNode=e.parentNode;this.init()}init(){this.bar=r.Tag.render(s||(s=i`
			<div class="calendar-relation-bar">
			</div>
		`));r.Event.bind(this.bar,"mouseenter",(()=>{t.EventEmitter.emit("BX.Calendar.EntityRelation.onMouseEnter")}))}renderLoader(){r.Dom.clean(this.bar);if(!this.loaderWrap){this.loaderWrap=r.Tag.render(o||(o=i`<div class="calendar-relation-bar-loader"></div>`))}r.Dom.append(this.loaderWrap,this.bar);this.showLoader();return this.bar}showLoader(){if(this.loader){this.loader.destroy()}this.loader=new a.Loader({target:this.loaderWrap,size:22,color:"#2066B0",offset:{left:"0px",top:"0px"},mode:"inline"});this.loader.show()}render(e){r.Dom.clean(this.bar);r.Dom.append(this.getEntityLink(e),this.bar);r.Dom.append(this.getOwnerData(e),this.bar);return this.bar}getEntityLink(e){return r.Tag.render(l||(l=i`
			<a
				class="calendar-relation-entity-link"
				href="${0}"
				title="${0}"
			>
				<div class="calendar-relation-entity-link-text">
					${0}
				</div>
				<div class="calendar-relation-entity-link-arrow"></div>
			</a>
		`),e.entity.link,r.Loc.getMessage("CALENDAR_RELATION_OPEN_ENTITY_HINT_DEAL"),r.Loc.getMessage("CALENDAR_RELATION_ENTITY_LINK_DEAL"))}getOwnerData(e){const{root:t,chatButton:a}=r.Tag.render(d||(d=i`
			<div class="calendar-relation-owner">
				<div class="calendar-relation-owner-role">${0}</div>
				<div class="calendar-relation-owner-info">
					${0}
					${0}
					<div
						ref="chatButton"
						class="calendar-relation-owner-chat"
						title="${0}"
					/>
				</div>
			</div>
		`),r.Loc.getMessage("CALENDAR_RELATION_OWNER_ROLE_DEAL"),this.getOwnerAvatarNode(e),this.getOwnerNameNode(e),r.Loc.getMessage("CALENDAR_RELATION_CHAT_BUTTON_HINT"));r.Event.bind(a,"click",(()=>this.openChat(e.owner.id)));return t}getOwnerAvatarNode(e){const t=r.Tag.render(h||(h=i`
			<a
				href="${0}"
				class="calendar-relation-owner-avatar ui-icon ui-icon-common-user"
				title="${0}"
			>
			</a>
		`),e.owner.link,r.Loc.getMessage("CALENDAR_RELATION_OWNER_PROFILE_HINT"));let a=null;if(e.owner.avatar){a=r.Tag.render(c||(c=i`
				<img
					src="${0}"
					alt=""
				/>
			`),encodeURI(e.owner.avatar))}else{a=r.Tag.render(u||(u=i`
				<i></i>
			`))}r.Dom.append(a,t);return t}getOwnerNameNode(e){return r.Tag.render(g||(g=i`
			<a
				class="calendar-relation-owner-name"
				href="${0}"
				title="${0}"
			>
				${0}
			</a>
		`),e.owner.link,r.Loc.getMessage("CALENDAR_RELATION_OWNER_PROFILE_HINT"),e.owner.name)}openChat(e){n.Messenger.openChat(e)}}class N{static async getRelationData(e){if(r.Type.isNil(e)){return false}const t="calendar.api.calendarentryajax.getEventEntityRelation";const a={eventId:e};const n=await r.ajax.runAction(t,{data:a}).then((e=>e),(()=>null));return(n==null?void 0:n.data)||false}}class E{static getRelation(e){var t;return(t=E.map.get(e))!=null?t:false}static setRelation(e){E.map.set(e.eventId,e)}}E.map=new Map;class L{constructor(e){var t;this.bar=new v({parentNode:e.parentNode});this.eventId=(t=e.eventId)!=null?t:null;this.relationData=E.getRelation(this.eventId)||null;this.layout=null}render(){if(r.Type.isNil(this.relationData)){this.layout=this.bar.renderLoader();this.showLazy()}else if(this.relationData){this.layout=this.bar.render(this.relationData)}return this.layout}async showLazy(){this.relationData=await N.getRelationData(this.eventId);if(this.relationData){E.setRelation(this.relationData);const e=this.bar.render(this.relationData);r.Dom.replace(this.layout,e);this.layout=e}else{this.destroy()}}destroy(){r.Dom.remove(this.layout);this.layout=null}}e.RelationInterface=L})(this.BX.Calendar=this.BX.Calendar||{},BX.Event,BX,BX.Messenger.v2.Lib,BX);
//# sourceMappingURL=entityrelation.bundle.map.js