this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t){"use strict";var s=babelHelpers.classPrivateFieldLooseKey("list");var i=babelHelpers.classPrivateFieldLooseKey("loadedList");var a=babelHelpers.classPrivateFieldLooseKey("opened");var o=babelHelpers.classPrivateFieldLooseKey("appendFormToSlider");var r=babelHelpers.classPrivateFieldLooseKey("appendFormScript");var l=babelHelpers.classPrivateFieldLooseKey("handleB24FormInit");class n{static getList(){return babelHelpers.classPrivateFieldLooseBase(n,s)[s]}static getById(e){return babelHelpers.classPrivateFieldLooseBase(n,s)[s].find((t=>t.id===e))||null}static open(e){if(babelHelpers.classPrivateFieldLooseBase(n,a)[a]){return}const t=e.id;const s=babelHelpers.classPrivateFieldLooseBase(n,i)[i][t];if(s){s.openPanel();return}const o=new n({map:e});babelHelpers.classPrivateFieldLooseBase(n,i)[i][e.id]=o;o.openPanel()}constructor(e){Object.defineProperty(this,l,{value:p});Object.defineProperty(this,r,{value:c});Object.defineProperty(this,o,{value:d});this.init(e);babelHelpers.classPrivateFieldLooseBase(n,s)[s].push(this)}init(e){this.cached=false;if(e.map!==undefined){this.map=e.map;return}this.id=e.id;this.portal=e.portal;this.presets=e.presets||{};this.form=e.form||{};this.title=e.title||"";if(e.button){this.button=BX(e.button);t.Event.bind(this.button,"click",this.openPanel.bind(this))}}appendPresets(e){Object.entries(e).forEach((([e,t])=>{this.presets[e]=t}))}openPanel(){babelHelpers.classPrivateFieldLooseBase(n,a)[a]=true;BX.SidePanel.Instance.open(`ui:feedback-form-${this.id}`,{cacheable:false,contentCallback:()=>Promise.resolve(),animationDuration:200,events:{onLoad:this.checkSidePanelLoad.bind(this),onBeforeCloseComplete:this.checkSidePanelClosed.bind(this)},width:600})}checkSidePanelClosed(){babelHelpers.classPrivateFieldLooseBase(n,a)[a]=false}checkSidePanelLoad(e){if(this.map&&this.cached===false){t.ajax.runAction("ui.feedback.loadData",{json:{title:this.map.title||null,id:this.map.id||null,presets:this.map.presets||null,portalUri:this.map.portalUri||null,forms:this.map.forms||null,defaultForm:this.map.defaultForm||null}}).then((t=>{const s=t.data.params;this.id=s.id;this.title=s.title;this.form=s.form;this.presets=s.presets;this.portal=s.portal;this.cached=true;this.onSidePanelLoad(e)})).catch((e=>{console.error(e)}));return}this.onSidePanelLoad(e)}onSidePanelLoad(e){const t=e.getSlider();if(!t){return}babelHelpers.classPrivateFieldLooseBase(this,o)[o](t);setTimeout((()=>{t.showLoader()}),0);this.loadForm(this.checkLoader.bind(this,t))}checkLoader(e){setTimeout((()=>{e.closeLoader()}),100)}loadForm(e){const s=this.form;if(!s||!s.id||!s.lang||!s.sec){return}if(s.presets){this.appendPresets(s.presets)}const i=`b24form${this.id}`;babelHelpers.classPrivateFieldLooseBase(this,r)[r](`${this.portal}/bitrix/js/crm/form_loader.js`,i);t.Event.bind(top,"b24:form:init",babelHelpers.classPrivateFieldLooseBase(this,l)[l]);top[i]({id:s.id,lang:s.lang,sec:s.sec,type:"inline",node:this.formNode,presets:this.presets,handlers:{load:e}})}}function d(e){if(!e){return}this.formNode=t.Dom.create("div");const s=t.Dom.create("div",{style:{marginBottom:"25px",font:"26px/26px var(--ui-font-family-primary, var(--ui-font-family-helvetica))",color:"var(--ui-color-text-primary)"},text:this.title});const i=t.Dom.create("div",{style:{padding:"20px",overflowY:"auto"},children:[s,this.formNode]});t.Dom.append(i,e.layout.content)}function c(e,s){top.Bitrix24FormObject=s;top[s]=top[s]||function(){arguments[0].ref=e;(top[s].forms=top[s].forms||[]).push(arguments[0])};if(top[s].forms){return}const i=top.document.createElement("script");const a=Date.now();i.async=1;i.src=`${e}?${a}`;const o=top.document.getElementsByTagName("script")[0];t.Dom.insertBefore(i,o)}function p(e){const t=e.detail.object;t.design.setFont("var(--ui-font-family-primary),var(--ui-font-family-helvetica)")}Object.defineProperty(n,s,{writable:true,value:[]});Object.defineProperty(n,i,{writable:true,value:{}});Object.defineProperty(n,a,{writable:true,value:false});e.Form=n})(this.BX.UI.Feedback=this.BX.UI.Feedback||{},BX);
//# sourceMappingURL=form.bundle.map.js