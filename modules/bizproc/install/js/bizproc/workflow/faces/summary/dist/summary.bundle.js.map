{"version":3,"file":"summary.bundle.js","sources":["../src/summary.js"],"sourcesContent":["import { Loc, Tag, Type, Text } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { Timeline } from 'bizproc.workflow.timeline';\n\nimport 'ui.design-tokens';\nimport 'ui.icons';\nimport 'ui.icon-set.main';\n\nimport './css/style.css';\n\nexport type SummaryData = {\n\tworkflowId: string,\n\ttime: ?number,\n\tworkflowIsCompleted: boolean,\n};\n\nexport class Summary\n{\n\t#isFinal: boolean = false;\n\t#workflowId: string;\n\n\tconstructor(props: SummaryData = {})\n\t{\n\t\tif (!Type.isStringFilled(props.workflowId))\n\t\t{\n\t\t\tthrow new TypeError('workflowId must be filled string');\n\t\t}\n\t\tthis.#workflowId = props.workflowId;\n\n\t\tif (Type.isBoolean(props.workflowIsCompleted))\n\t\t{\n\t\t\tthis.#isFinal = props.workflowIsCompleted;\n\t\t}\n\n\t\tthis.#calculateDurationTexts(props.time);\n\t}\n\n\t#calculateDurationTexts(time)\n\t{\n\t\tconst duration = (\n\t\t\tType.isNumber(time)\n\t\t\t\t? DateTimeFormat.format(\n\t\t\t\t\t[['s', 'sdiff'], ['i', 'idiff'], ['H', 'Hdiff'], ['d', 'ddiff'], ['m', 'mdiff'], ['Y', 'Ydiff']],\n\t\t\t\t\t0,\n\t\t\t\t\ttime,\n\t\t\t\t)\n\t\t\t\t: null\n\t\t);\n\n\t\tthis.durationTexts = { nameBefore: '', value: '', nameAfter: '' };\n\n\t\tif (duration)\n\t\t{\n\t\t\tconst pattern = /\\d+/;\n\t\t\tconst match = duration.match(pattern);\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tthis.durationTexts.value = String(match[0]);\n\n\t\t\t\tconst index = duration.indexOf(this.durationTexts.value);\n\t\t\t\tif (index !== -1)\n\t\t\t\t{\n\t\t\t\t\tthis.durationTexts.nameBefore = duration.slice(0, index).trim();\n\t\t\t\t\tthis.durationTexts.nameAfter = duration.slice(index + this.durationTexts.value.length).trim();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.durationTexts.nameAfter = duration;\n\t\t\t}\n\t\t}\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst title = Text.encode(Loc.getMessage(\n\t\t\tthis.#isFinal\n\t\t\t\t? 'BIZPROC_JS_WORKFLOW_FACES_SUMMARY_TITLE_FINAL'\n\t\t\t\t: 'BIZPROC_JS_WORKFLOW_FACES_SUMMARY_TITLE'\n\t\t\t,\n\t\t));\n\t\tconst footerTitle = Text.encode(Loc.getMessage('BIZPROC_JS_WORKFLOW_FACES_SUMMARY_TIMELINE_MSGVER_1'));\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bp-workflow-faces-summary-item\">\n\t\t\t\t<div class=\"bp-workflow-faces-summary-name\">\n\t\t\t\t\t<div class=\"bp-workflow-faces-summary__text-area\" title=\"${title}\">${title}</div>\n\t\t\t\t</div>\n\t\t\t\t${this.#renderContent()}\n\t\t\t\t<div class=\"bp-workflow-faces-summary__duration\" onclick=\"${this.#openTimeline.bind(this)}\">\n\t\t\t\t\t<div class=\"bp-workflow-faces-summary__text-area\" title=\"${footerTitle}\">${footerTitle}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderContent(): HTMLElement\n\t{\n\t\tif (this.#isFinal)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"bp-workflow-faces-summary__summary\">\n\t\t\t\t\t<div class=\"bp-workflow-faces-summary__summary-name\">${Text.encode(this.durationTexts.nameBefore)}</div>\n\t\t\t\t\t<div class=\"bp-workflow-faces-summary__summary-value\">${Text.encode(this.durationTexts.value)}</div>\n\t\t\t\t\t<div class=\"bp-workflow-faces-summary__summary-name\">${Text.encode(this.durationTexts.nameAfter)}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bp-workflow-faces-summary__icon-wrapper\">\n\t\t\t\t<div class=\"ui-icon-set --clock-2 bp-workflow-faces-summary__icon\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#openTimeline(event)\n\t{\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t\tTimeline.open({ workflowId: this.#workflowId });\n\t}\n}\n"],"names":["Summary","constructor","props","Type","isStringFilled","workflowId","TypeError","isBoolean","workflowIsCompleted","time","render","title","Text","encode","Loc","getMessage","footerTitle","Tag","bind","duration","isNumber","DateTimeFormat","format","durationTexts","nameBefore","value","nameAfter","pattern","match","String","index","indexOf","slice","trim","length","event","stopPropagation","preventDefault","Timeline","open"],"mappings":"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"}