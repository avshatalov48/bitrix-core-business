this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(exports,ui_fonts_opensans,im_v2_lib_parser,im_v2_provider_service,im_v2_application_core,im_v2_lib_user,ui_loader,im_public,im_v2_model,im_v2_lib_logger,main_popup,dropdown_css,main_core_events,im_v2_lib_utils,im_v2_lib_progressbar,ui_icons_disk,ui_vue3_directives_lazyload,ui_vue3_components_audioplayer,im_v2_const,ui_vue3,ui_vue3_components_socialvideo,main_core){"use strict";const UserStatusSize={S:"S",M:"M",L:"L",XL:"XL",XXL:"XXL"};const UserStatus={name:"UserStatus",props:{status:{type:String,required:true,validator(t){return Object.values(im_v2_const.UserStatus).includes(t)}},size:{type:String,default:UserStatusSize.M,validator(t){return Object.values(UserStatusSize).includes(t)}}},data(){return{}},computed:{containerClasses(){return[`--size-${this.size.toLowerCase()}`,`--${this.status}`]}},template:`\n\t\t<div :class="containerClasses" class="bx-im-user-status__container bx-im-user-status__scope"></div>\n\t`};const AvatarSize=Object.freeze({XS:"XS",S:"S",M:"M",L:"L",XL:"XL",XXL:"XXL",XXXL:"XXXL"});const Avatar={name:"MessengerAvatar",components:{UserStatus:UserStatus},props:{dialogId:{type:[String,Number],default:0},size:{type:String,default:AvatarSize.M},withAvatarLetters:{type:Boolean,default:true},withStatus:{type:Boolean,default:true},withSpecialTypes:{type:Boolean,default:true}},data(){return{imageLoadError:false}},computed:{dialog(){return this.$store.getters["dialogues/get"](this.dialogId,true)},user(){return this.$store.getters["users/get"](this.dialogId,true)},isUser(){return this.dialog.type===im_v2_const.DialogType.user},isBot(){if(this.isUser){return this.user.bot}return false},isSpecialType(){const t=[im_v2_const.DialogType.user,im_v2_const.DialogType.chat,im_v2_const.DialogType.open];return!t.includes(this.dialog.type)},containerClasses(){const t=[`--size-${this.size.toLowerCase()}`];if(this.withSpecialTypes&&this.isSpecialType){t.push("--special")}const e=im_v2_const.DialogType[this.dialog.type]?`--${this.dialog.type}`:"--default";t.push(e);return t},backgroundColorStyle(){return{backgroundColor:this.dialog.color}},avatarText(){if(this.isSpecialType||!this.isEnoughSizeForText){return""}return im_v2_lib_utils.Utils.text.getFirstLetters(this.dialog.name)},userStatusIcon(){if(!this.isUser||this.isBot||this.user.id===im_v2_application_core.Core.getUserId()||!this.isEnoughSizeForStatus){return""}const t=this.$store.getters["users/getStatus"](this.dialogId);if(t&&t!==im_v2_const.UserStatus.online){return t}return""},userStatusSize(){const t={[AvatarSize.M]:UserStatusSize.S,[AvatarSize.L]:UserStatusSize.M,[AvatarSize.XL]:UserStatusSize.L,[AvatarSize.XXL]:UserStatusSize.XL,[AvatarSize.XXXL]:UserStatusSize.XXL};return t[this.size]},isEnoughSizeForText(){const t=[AvatarSize.L,AvatarSize.XL,AvatarSize.XXL,AvatarSize.XXXL];return t.includes(this.size.toUpperCase())},isEnoughSizeForStatus(){const t=[AvatarSize.M,AvatarSize.L,AvatarSize.XL,AvatarSize.XXL,AvatarSize.XXXL];return t.includes(this.size.toUpperCase())},avatarUrl(){return this.dialog.avatar},hasImage(){return this.avatarUrl&&!this.imageLoadError}},watch:{avatarUrl(){this.imageLoadError=false}},methods:{onImageLoadError(){this.imageLoadError=true}},template:`\n\t\t<div :title="dialog.name" :class="containerClasses" class="bx-im-avatar__scope bx-im-avatar__container">\n\t\t\t\x3c!-- Avatar --\x3e\n\t\t\t<template v-if="hasImage">\n\t\t\t\t<img :src="avatarUrl" :alt="dialog.name" class="bx-im-avatar__content --image" @error="onImageLoadError"/>\n\t\t\t\t<div v-if="withSpecialTypes && isSpecialType" :style="backgroundColorStyle" class="bx-im-avatar__special-type_icon"></div>\n\t\t\t</template>\n\t\t\t<div v-else-if="withAvatarLetters && avatarText" :style="backgroundColorStyle" class="bx-im-avatar__content --text">\n\t\t\t\t{{ avatarText }}\n\t\t\t</div>\n\t\t\t<div v-else :style="backgroundColorStyle" class="bx-im-avatar__content bx-im-avatar__icon"></div>\n\t\t\t\x3c!-- Status icons --\x3e\n\t\t\t<div v-if="withStatus && userStatusIcon" class="bx-im-avatar__status-icon">\n\t\t\t\t<UserStatus :status="userStatusIcon" :size="userStatusSize" />\n\t\t\t</div>\n\t\t</div>\n\t`};const RecentLoadingState={name:"RecentLoadingState",props:{compactMode:{type:Boolean,default:false},itemsToShow:{type:Number,default:50}},methods:{isThreeLineVersion(){return Math.random()<.5}},template:`\n\t\t<div v-if="!compactMode" class="bx-im-component-recent-loading-state">\n\t\t\t<div v-for="index in itemsToShow" class="bx-im-component-recent-loading-state-item">\n\t\t\t\t<div class="bx-im-component-recent-loading-state-avatar-wrap">\n\t\t\t\t\t<div class="bx-im-component-recent-loading-state-avatar-placeholder"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-component-recent-loading-state-content">\n\t\t\t\t\t<div class="bx-im-component-recent-loading-state-line bx-im-component-recent-loading-state-line-long"></div>\n\t\t\t\t\t<div class="bx-im-component-recent-loading-state-line bx-im-component-recent-loading-state-line-short"></div>\n\t\t\t\t\t<div v-if="isThreeLineVersion()" class="bx-im-component-recent-loading-state-line bx-im-component-recent-loading-state-line-short"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if="compactMode" class="bx-im-component-recent-loading-state bx-im-component-recent-loading-state-compact">\n\t\t\t<div v-for="index in itemsToShow" class="bx-im-component-recent-loading-state-item">\n\t\t\t\t<div class="bx-im-component-recent-loading-state-avatar-wrap">\n\t\t\t\t\t<div class="bx-im-component-recent-loading-state-avatar-placeholder"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const DialogSpecialType={bot:"bot",extranet:"extranet",network:"network",support24:"support24"};const TitleIcons={absent:"absent",birthday:"birthday"};const ChatTitle={name:"ChatTitle",props:{dialogId:{type:[Number,String],default:0},text:{type:String,default:""},showItsYou:{type:Boolean,default:true},withLeftIcon:{type:Boolean,default:true},withColor:{type:Boolean,default:false},withMute:{type:Boolean,default:false},onlyFirstName:{type:Boolean,default:false},twoLine:{type:Boolean,default:false}},computed:{dialog(){return this.$store.getters["dialogues/get"](this.dialogId,true)},user(){return this.$store.getters["users/get"](this.dialogId,true)},botType(){if(!this.isUser){return""}return this.$store.getters["users/getBotType"](this.dialogId)},isUser(){return this.dialog.type===im_v2_const.DialogType.user},isSelfChat(){return this.isUser&&this.user.id===im_v2_application_core.Core.getUserId()},containerClasses(){const t=[];if(this.twoLine){t.push("--twoline")}return t},dialogName(){if(!this.dialogId&&this.text){return this.text}if(this.isUser){if(this.onlyFirstName){return this.user.firstName}return this.user.name}return this.dialog.name},dialogSpecialType(){if(!this.isUser){if(this.isExtranet){return DialogSpecialType.extranet}else if([im_v2_const.DialogType.support24Notifier,im_v2_const.DialogType.support24Question].includes(this.dialog.type)){return DialogSpecialType.support24}return""}if(this.isBot){return this.botType}else if(this.isExtranet){return DialogSpecialType.extranet}else if(this.isNetwork){return DialogSpecialType.network}return""},leftIcon(){if(!this.withLeftIcon){return""}if(this.dialogSpecialType){return this.dialogSpecialType}if(!this.isUser){return""}if(this.showBirthdays&&this.user.isBirthday){return TitleIcons.birthday}else if(this.user.isAbsent){return TitleIcons.absent}return""},color(){if(!this.withColor||this.specialColor){return""}return this.dialog.color},specialColor(){return this.dialogSpecialType},isBot(){if(this.isUser){return this.user.bot}return false},isExtranet(){if(this.isUser){return this.user.extranet}return this.dialog.extranet},isNetwork(){if(this.isUser){return this.user.network}return false},isChatMuted(){if(this.isUser){return false}const t=this.dialog.muteList.find((t=>t===im_v2_application_core.Core.getUserId()));return!!t},tooltipText(){if(this.isSelfChat&&this.showItsYou){return`${this.dialog.name} (${this.$Bitrix.Loc.getMessage("IM_LIST_RECENT_CHAT_SELF")})`}return this.dialog.name},showBirthdays(){return this.$store.getters["application/settings/get"](im_v2_const.Settings.recent.showBirthday)}},template:`\n\t\t<div :class="containerClasses" class="bx-im-chat-title__scope bx-im-chat-title__container">\n\t\t\t<span class="bx-im-chat-title__content">\n\t\t\t\t<span v-if="leftIcon" :class="'--' + leftIcon" class="bx-im-chat-title__icon"></span>\n\t\t\t\t<span\n\t\t\t\t\t:class="[specialColor? '--' + specialColor : '']"\n\t\t\t\t\t:style="{color: color}"\n\t\t\t\t\t:title="tooltipText"\n\t\t\t\t\tclass="bx-im-chat-title__text"\n\t\t\t\t>\n\t\t\t\t\t{{ dialogName }}\n\t\t\t\t</span>\n\t\t\t\t<strong v-if="isSelfChat && showItsYou">\n\t\t\t\t\t<span class="bx-im-chat-title__text --self">({{ $Bitrix.Loc.getMessage('IM_LIST_RECENT_CHAT_SELF') }})</span>\n\t\t\t\t</strong>\n\t\t\t\t<div v-if="withMute && isChatMuted" class="bx-im-chat-title__muted-icon"></div>\n\t\t\t</span>\n\t\t</div>\n\t`};const ButtonSize={S:"S",M:"M",L:"L",XL:"XL",XXL:"XXL"};const ButtonColor={Primary:"primary",PrimaryLight:"primary-light",Success:"success",Danger:"danger",LightBorder:"light-border",DangerBorder:"danger-border",PrimaryBorder:"primary-border",Link:"link"};const ButtonIcon={Plus:"plus",Link:"link",Call:"call",EndCall:"end-call",AddUser:"add-user"};const Button={name:"MessengerButton",props:{size:{type:String,required:true},text:{type:String,required:false,default:""},icon:{type:String,required:false,default:""},color:{type:String,required:false,default:ButtonColor.Primary},customColorScheme:{type:Object,required:false,default:()=>({borderColor:"",backgroundColor:"",iconColor:"",textColor:"",hoverColor:""})},isRounded:{type:Boolean,required:false,default:false},isDisabled:{type:Boolean,required:false,default:false},isLoading:{type:Boolean,required:false,default:false},isUppercase:{type:Boolean,required:false,default:true}},emits:["click"],computed:{buttonStyles(){const t={};if(this.hasCustomColorScheme){t["borderColor"]=this.customColorScheme.borderColor;t["backgroundColor"]=this.customColorScheme.backgroundColor;t["color"]=this.customColorScheme.textColor;t["--im-button__background-color_hover"]=this.customColorScheme.hoverColor}return t},buttonClasses(){const t=[`--size-${this.size.toLowerCase()}`];if(!this.hasCustomColorScheme){t.push(`--color-${this.color.toLowerCase()}`)}if(this.isRounded){t.push("--rounded")}if(this.isDisabled){t.push("--disabled")}if(this.isLoading){t.push("--loading")}if(this.isUppercase&&this.size!==ButtonSize.S){t.push("--uppercase")}if(this.text===""){t.push("--no-text")}return t},iconStyles(){const t={};if(this.hasCustomColorScheme){t["backgroundColor"]=this.customColorScheme.iconColor}return t},iconClasses(){const t=[`--${this.icon}`];if(this.hasCustomColorScheme){t.push("--custom-color")}return t},hasCustomColorScheme(){return main_core.Type.isStringFilled(this.customColorScheme.borderColor)&&main_core.Type.isStringFilled(this.customColorScheme.iconColor)&&main_core.Type.isStringFilled(this.customColorScheme.textColor)&&main_core.Type.isStringFilled(this.customColorScheme.hoverColor)}},methods:{onClick(t){if(this.isDisabled||this.isLoading){return}this.$emit("click",t)}},template:`\n\t\t<button\n\t\t\t:class="buttonClasses"\n\t\t\t:style="buttonStyles"\n\t\t\t@click.stop="onClick"\n\t\t\tclass="bx-im-button__scope bx-im-button__container"\n\t\t>\n\t\t\t<span v-if="icon" :style="iconStyles" :class="iconClasses" class="bx-im-button__icon"></span>\n\t\t\t<span class="bx-im-button__text">{{ text }}</span>\n\t\t</button>\n\t`};const POPUP_CONTAINER_PREFIX="#popup-window-content-";const MessengerPopup={name:"MessengerPopup",props:{id:{type:String,required:true},config:{type:Object,required:false,default:function(){return{}}}},emits:["close"],computed:{popupContainer(){return`${POPUP_CONTAINER_PREFIX}${this.id}`}},created(){im_v2_lib_logger.Logger.warn(`Popup: ${this.id} created`);this.instance=this.getPopupInstance();this.instance.show()},mounted(){this.instance.adjustPosition({forceBindPosition:true,position:this.getPopupConfig().bindOptions.position})},beforeUnmount(){if(!this.instance){return}this.closePopup()},methods:{getPopupInstance(){if(!this.instance){var t;(t=main_popup.PopupManager.getPopupById(this.id))==null?void 0:t.destroy();this.instance=new main_popup.Popup(this.getPopupConfig())}return this.instance},getDefaultConfig(){return{id:this.id,bindOptions:{position:"bottom"},offsetTop:0,offsetLeft:0,className:"bx-im-messenger__scope",cacheable:false,closeIcon:false,autoHide:true,closeByEsc:true,animation:"fading",events:{onPopupClose:this.closePopup.bind(this)}}},getPopupConfig(){var t,e;const i=this.getDefaultConfig();const n={};const s=i.className;if(this.config.className){n["className"]=`${s} ${this.config.className}`}const r=(t=this.config.offsetTop)!=null?t:i.offsetTop;if(((e=this.config.bindOptions)==null?void 0:e.position)==="top"&&main_core.Type.isNumber(this.config.offsetTop)){n["offsetTop"]=r-10}return{...i,...this.config,...n}},closePopup(){im_v2_lib_logger.Logger.warn(`Popup: ${this.id} closing`);this.$emit("close");this.instance.destroy();this.instance=null},enableAutoHide(){this.getPopupInstance().setAutoHide(true)},disableAutoHide(){this.getPopupInstance().setAutoHide(false)},adjustPosition(){this.getPopupInstance().adjustPosition({forceBindPosition:true,position:this.getPopupConfig().bindOptions.position})}},template:`\n\t\t<Teleport :to="popupContainer">\n\t\t\t<slot\n\t\t\t\t:adjustPosition="adjustPosition"\n\t\t\t\t:enableAutoHide="enableAutoHide"\n\t\t\t\t:disableAutoHide="disableAutoHide"\n\t\t\t></slot>\n\t\t</Teleport>\n\t`};const MenuItemIcon={chat:"chat",channel:"channel",conference:"conference",disk:"disk",upload:"upload",task:"task",meeting:"meeting",summary:"summary",vote:"vote"};const MenuItem={name:"MenuItem",props:{icon:{type:String,required:false,default:""},title:{type:String,required:true},subtitle:{type:String,required:false,default:""},disabled:{type:Boolean,required:false,default:false},counter:{type:Number,required:false,default:0}},data(){return{}},computed:{formattedCounter(){if(this.counter===0){return""}return this.counter>99?"99+":`${this.counter}`}},template:`\n\t\t<div class="bx-im-menu-item__container" :class="{'--disabled': disabled}">\n\t\t\t<div class="bx-im-menu-item__content" :class="{'--with-icon': !!icon}">\n\t\t\t\t<div v-if="icon" class="bx-im-menu_item__icon" :class="'--' + icon"></div>\n\t\t\t\t<div class="bx-im-menu-item__text-content" :class="{'--with-subtitle': !!subtitle}">\n\t\t\t\t\t<div class="bx-im-menu-item__title">\n\t\t\t\t\t\t<div class="bx-im-menu-item__title_text">{{ title }}</div>\n\t\t\t\t\t\t<div v-if="counter" class="bx-im-menu-item__title_counter">{{ formattedCounter }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="subtitle" :title="subtitle" class="bx-im-menu-item__subtitle">{{ subtitle }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const ID_PREFIX="im-v2-menu";const MessengerMenu={name:"MessengerMenu",components:{MessengerPopup:MessengerPopup},props:{config:{type:Object,required:true},className:{type:String,required:false,default:""}},emits:["close"],data(){return{id:""}},created(){var t;this.id=(t=this.config.id)!=null?t:`${ID_PREFIX}-${im_v2_lib_utils.Utils.text.getUuidV4()}`},template:`\n\t\t<MessengerPopup\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t\t:id="id"\n\t\t>\n\t\t\t<div class="bx-im-menu__container" :class="className">\n\t\t\t\t<slot name="header"></slot>\n\t\t\t\t<slot></slot>\n\t\t\t\t<slot name="footer"></slot>\n\t\t\t</div>\n\t\t</MessengerPopup>\n\t`};const AttachDelimiter={name:"AttachDelimiter",props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config},styles(){var t;const e={backgroundColor:(t=this.internalConfig.DELIMITER.COLOR)!=null?t:this.color};if(this.internalConfig.DELIMITER.SIZE){e.width=`${this.internalConfig.DELIMITER.SIZE}px`}return e}},template:`\n\t\t<div class="bx-im-attach-delimiter__container" :style="styles"></div>\n\t`};const AttachFileItem={name:"AttachFileItem",props:{config:{type:Object,default:()=>{}}},computed:{internalConfig(){return this.config},fileName(){return this.internalConfig.NAME},fileSize(){return this.internalConfig.SIZE},link(){return this.internalConfig.LINK},fileShortName(){const t=70;return im_v2_lib_utils.Utils.file.getShortFileName(this.fileName,t)},formattedFileSize(){return im_v2_lib_utils.Utils.file.formatFileSize(this.fileSize)},iconClasses(){return["ui-icon",`ui-icon-file-${this.fileIcon}`]},fileIcon(){return im_v2_lib_utils.Utils.file.getIconTypeByFilename(this.fileName)}},methods:{openLink(){if(!this.link){return false}window.open(this.link,"_blank")}},template:`\n\t\t<div @click="openLink" class="bx-im-attach-file__container">\n\t\t\t<div class="bx-im-attach-file__item">\n\t\t\t\t<div class="bx-im-attach-file__icon">\n\t\t\t\t\t<div :class="iconClasses"><i></i></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-attach-file__block">\n\t\t\t\t\t<div class="bx-im-attach-file__name" :title="fileName">\n\t\t\t\t\t\t{{ fileShortName }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bx-im-attach-file__size">\n\t\t\t\t\t\t{{ formattedFileSize }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const AttachFile={name:"AttachFile",components:{AttachFileItem:AttachFileItem},props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config}},template:`\n\t\t<div class="bx-im-attach-file__container">\n\t\t\t<AttachFileItem\n\t\t\t\tv-for="(fileItem, index) in internalConfig.FILE"\n\t\t\t\t:config="fileItem"\n\t\t\t\t:key="index"\n\t\t\t/>\n\t\t</div>\n\t`};const AttachGridItemDisplayType={block:"block",line:"line",row:"row"};const DisplayType=AttachGridItemDisplayType;const AttachGridItem={name:"AttachGridItem",props:{config:{type:Object,default:()=>{}}},computed:{DisplayType:()=>DisplayType,internalConfig(){return this.config},display(){return this.internalConfig.DISPLAY.toLowerCase()},width(){if(!this.value||!this.internalConfig.WIDTH){return""}return`${this.internalConfig.WIDTH}px`},value(){if(!this.internalConfig.VALUE){return""}return im_v2_lib_parser.Parser.decodeText(this.internalConfig.VALUE)},color(){return this.internalConfig.COLOR||""},name(){return this.internalConfig.NAME},link(){return this.internalConfig.LINK}},template:`\n\t\t<div v-if="display === DisplayType.block" :style="{width}" class="bx-im-attach-grid__item --block">\n\t\t\t<div class="bx-im-attach-grid__name">{{ name }}</div>\n\t\t\t<div v-if="link" class="bx-im-attach-grid__value --link">\n\t\t\t\t<a :href="link" target="_blank" :style="{color}" v-html="value"></a>\n\t\t\t</div>\n\t\t\t<div v-else v-html="value" :style="{color}" class="bx-im-attach-grid__value"></div>\n\t\t</div>\n\t\t<div v-if="display === DisplayType.line" :style="{width}" class="bx-im-attach-grid__item --line">\n\t\t\t<div class="bx-im-attach-grid__name">{{ name }}</div>\n\t\t\t<div v-if="link" :style="{color}" class="bx-im-attach-grid__value --link">\n\t\t\t\t<a :href="link" target="_blank" v-html="value"></a>\n\t\t\t</div>\n\t\t\t<div v-else class="bx-im-attach-grid__value" :style="{color}" v-html="value"></div>\n\t\t</div>\n\t\t<div v-if="display === DisplayType.row" class="bx-im-attach-grid__item --row">\n\t\t\t<table>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td v-if="name" :colspan="value? 1: 2" :style="{width}" class="bx-im-attach-grid__name">\n\t\t\t\t\t\t\t{{ name }}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td\n\t\t\t\t\t\t\tv-if="value && link"\n\t\t\t\t\t\t\t:colspan="name? 1: 2"\n\t\t\t\t\t\t\t:style="{color}"\n\t\t\t\t\t\t\tclass="bx-im-attach-grid__value --link"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<a :href="link" target="_blank" v-html="value"></a>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td\n\t\t\t\t\t\t\tv-if="value && !link"\n\t\t\t\t\t\t\t:colspan="name? 1: 2"\n\t\t\t\t\t\t\t:style="{color}"\n\t\t\t\t\t\t\tv-html="value"\n\t\t\t\t\t\t\tclass="bx-im-attach-grid__value"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t`};const AttachGrid={name:"AttachGrid",components:{AttachGridItem:AttachGridItem},props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config}},template:`\n\t\t<div class="bx-im-attach-grid__container">\n\t\t\t<AttachGridItem\n\t\t\t\tv-for="(gridItem, index) in internalConfig.GRID"\n\t\t\t\t:config="gridItem"\n\t\t\t\t:key="index"\n\t\t\t/>\n\t\t</div>\n\t`};const AttachHtml={props:{config:{type:Object,default:()=>{}}},computed:{internalConfig(){return this.config},html(){return im_v2_lib_parser.Parser.decodeHtml(this.internalConfig.HTML)}},template:`\n\t\t<div class="bx-im-element-attach-type-html" v-html="html"></div>\n\t`};const MAX_IMAGE_SIZE=250;const AttachImageItem={name:"AttachImageItem",directives:{lazyload:ui_vue3_directives_lazyload.lazyload},props:{config:{type:Object,default:()=>{}}},computed:{internalConfig(){return this.config},width(){return this.internalConfig.WIDTH},height(){return this.internalConfig.HEIGHT},link(){return this.internalConfig.LINK},name(){return this.internalConfig.NAME},preview(){return this.internalConfig.PREVIEW},source(){var t;return(t=this.preview)!=null?t:this.link},imageSize(){if(!this.width&&!this.height){return{}}const t=this.width>MAX_IMAGE_SIZE?MAX_IMAGE_SIZE/this.width:1;const e={width:this.width*t,height:this.height*t};return{width:`${e.width}px`,height:`${e.height}px`,backgroundSize:e.width<100||e.height<100?"contain":"initial"}}},methods:{open(){if(!this.link){return false}window.open(this.link,"_blank")},lazyLoadCallback(t){const{element:e}=t;if(!main_core.Dom.style(e,"width")){main_core.Dom.style(e,"width",`${e.offsetWidth}px`)}if(!main_core.Dom.style(e,"height")){main_core.Dom.style(e,"height",`${e.offsetHeight}px`)}}},template:`\n\t\t<div class="bx-im-attach-image__item" @click="open">\n\t\t\t<img\n\t\t\t\tv-lazyload="{callback: lazyLoadCallback}"\n\t\t\t\t:data-lazyload-src="source"\n\t\t\t\t:style="imageSize"\n\t\t\t\t:title="name"\n\t\t\t\t:alt="name"\n\t\t\t\tclass="bx-im-attach-image__source"\n\t\t\t/>\n\t\t</div>\n\t`};const AttachImage={name:"AttachImage",components:{AttachImageItem:AttachImageItem},props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config}},template:`\n\t\t<div class="bx-im-attach-image__container">\n\t\t\t<AttachImageItem v-for="(image, index) in internalConfig.IMAGE" :config="image" :key="index" />\n\t\t</div>\n\t`};const AttachLinkItem={name:"AttachLinkItem",components:{AttachImage:AttachImage},props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config},link(){return this.internalConfig.LINK},name(){var t;return(t=this.internalConfig.NAME)!=null?t:this.link},description(){return this.internalConfig.DESC},html(){const t=this.internalConfig.HTML||this.description;return im_v2_lib_parser.Parser.decodeText(t)},preview(){return this.internalConfig.PREVIEW},imageConfig(){return{IMAGE:[{NAME:this.internalConfig.NAME,PREVIEW:this.internalConfig.PREVIEW,WIDTH:this.internalConfig.WIDTH,HEIGHT:this.internalConfig.HEIGHT}]}}},template:`\n\t\t<div class="bx-im-attach-link__item">\n\t\t\t<a v-if="link" :href="link" target="_blank" class="bx-im-attach-link__link">\n\t\t\t\t{{ name }}\n\t\t\t</a>\n\t\t\t<span v-else class="bx-im-attach-link__name">\n\t\t\t\t{{ name }}\n\t\t\t</span>\n\t\t\t<div v-if="internalConfig.HTML || description" class="bx-im-attach-link__desc" v-html="html"></div>\n\t\t\t<div v-if="preview" class="bx-im-attach-link__image">\n\t\t\t\t<AttachImage :config="imageConfig" :color="color" />\n\t\t\t</div>\n\t\t</div>\n\t`};const AttachLink={name:"AttachLink",components:{AttachLinkItem:AttachLinkItem},props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config}},template:`\n\t\t<div class="bx-im-attach-link__container">\n\t\t\t<AttachLinkItem v-for="(link, index) in internalConfig.LINK" :config="link" :key="index" />\n\t\t</div>\n\t`};const AttachMessage={name:"AttachMessage",props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config},message(){return im_v2_lib_parser.Parser.decodeText(this.internalConfig.MESSAGE)}},template:`\n\t\t<div class="bx-im-attach-message__container" v-html="message"></div>\n\t`};const AttachRichItem={name:"AttachRichItem",components:{AttachImage:AttachImage},props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config},link(){return this.internalConfig.LINK},name(){return im_v2_lib_utils.Utils.text.convertHtmlEntities(this.internalConfig.NAME)},description(){return im_v2_lib_utils.Utils.text.convertHtmlEntities(this.internalConfig.DESC)},html(){return this.internalConfig.HTML},preview(){return this.internalConfig.PREVIEW},imageConfig(){return{IMAGE:[{NAME:this.name,PREVIEW:this.preview}]}}},methods:{openLink(){if(!this.link){return false}window.open(this.link,"_blank")}},template:`\n\t\t<div class="bx-im-attach-rich__item">\n\t\t\t<div v-if="preview" class="bx-im-attach-rich__image">\n\t\t\t\t<AttachImage :config="imageConfig" :color="color" />\n\t\t\t</div>\n\t\t\t<div class="bx-im-attach-rich__block">\n\t\t\t\t<div class="bx-im-attach-rich__name" @click="openLink">{{ name }}</div>\n\t\t\t\t<div v-if="html || description" class="bx-im-attach-rich__desc">{{ html || description }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const AttachRich={components:{AttachRichItem:AttachRichItem},props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config}},template:`\n\t\t<div class="bx-im-attach-rich__container">\n\t\t\t<AttachRichItem v-for="(rich, index) in internalConfig.RICH_LINK" :config="rich" :color="color" :key="index" />\n\t\t</div>\n\t`};const AVATAR_TYPE={user:"user",chat:"chat",bot:"bot"};const AttachUserItem={name:"AttachUserItem",directives:{lazyload:ui_vue3_directives_lazyload.lazyload},props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config},name(){return this.internalConfig.NAME},avatar(){return this.internalConfig.AVATAR},avatarType(){return this.internalConfig.AVATAR_TYPE},link(){return this.internalConfig.LINK},avatarTypeClass(){if(this.avatar){return""}let t=AVATAR_TYPE.user;if(this.avatarType===AVATAR_TYPE.chat){t=AVATAR_TYPE.chat}else if(this.avatarType===AVATAR_TYPE.bot){t=AVATAR_TYPE.bot}return`--${t}`},avatarTypeStyle(){return{backgroundColor:!this.avatar?this.color:""}}},template:`\n\t\t<div class="bx-im-attach-user__item">\n\t\t\t<div class="bx-im-attach-user__avatar" :class="avatarTypeClass" :style="avatarTypeStyle">\n\t\t\t\t<img v-if="avatar" v-lazyload :data-lazyload-src="avatar" class="bx-im-attach-user__source" alt="name" />\n\t\t\t</div>\n\t\t\t<a v-if="link" :href="link" class="bx-im-attach-user__name" target="_blank">\n\t\t\t\t{{ name }}\n\t\t\t</a>\n\t\t\t<span class="bx-im-attach-user__name" v-else>\n\t\t\t\t{{ name }}\n\t\t\t</span>\n\t\t</div>\n\t`};const AttachUser={name:"AttachUser",components:{AttachUserItem:AttachUserItem},props:{config:{type:Object,default:()=>{}},color:{type:String,default:im_v2_const.Color.transparent}},computed:{internalConfig(){return this.config}},template:`\n\t\t<div class="bx-im-attach-user__container">\n\t\t\t<AttachUserItem v-for="(user, index) in internalConfig.USER" :config="user" :color="color" :key="index" />\n\t\t</div>\n\t`};const PropertyToComponentMap={[im_v2_const.AttachType.Delimiter]:AttachDelimiter,[im_v2_const.AttachType.File]:AttachFile,[im_v2_const.AttachType.Grid]:AttachGrid,[im_v2_const.AttachType.Html]:AttachHtml,[im_v2_const.AttachType.Image]:AttachImage,[im_v2_const.AttachType.Link]:AttachLink,[im_v2_const.AttachType.Message]:AttachMessage,[im_v2_const.AttachType.Rich]:AttachRich,[im_v2_const.AttachType.User]:AttachUser};const Attach={name:"MessengerAttach",components:{AttachDelimiter:AttachDelimiter,AttachFile:AttachFile,AttachGrid:AttachGrid,AttachHtml:AttachHtml,AttachImage:AttachImage,AttachLink:AttachLink,AttachMessage:AttachMessage,AttachRich:AttachRich,AttachUser:AttachUser},props:{config:{type:Object,default:()=>{}},baseColor:{type:String,default:im_v2_const.Color.base}},computed:{internalConfig(){return this.config},blocks(){return this.internalConfig.BLOCKS},color(){if(!this.internalConfig.COLOR){return this.baseColor}if(this.internalConfig.COLOR===im_v2_const.Color.transparent){return""}return this.internalConfig.COLOR}},methods:{getComponentForBlock(t){const[e]=Object.keys(t);if(!PropertyToComponentMap[e]){return""}return PropertyToComponentMap[e]}},template:`\n\t\t<div class="bx-im-attach__container bx-im-attach__scope">\n\t\t\t<div v-if="color" class="bx-im-attach__border" :style="{borderColor: color}"></div>\n\t\t\t<div class="bx-im-attach__content">\n\t\t\t\t<component\n\t\t\t\t\tv-for="(block, index) in blocks"\n\t\t\t\t\t:is="getComponentForBlock(block)"\n\t\t\t\t\t:config="block"\n\t\t\t\t\t:color="color"\n\t\t\t\t\t:key="index"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const ChatInfoContent={components:{Avatar:Avatar,ChatTitle:ChatTitle,Button:Button},props:{dialogId:{type:String,required:true}},data(){return{hasError:false,isLoading:false}},computed:{ButtonColor:()=>ButtonColor,ButtonSize:()=>ButtonSize,dialog(){return this.$store.getters["dialogues/get"](this.dialogId)},user(){return this.$store.getters["users/get"](this.dialogId,true)},isUser(){var t;return((t=this.dialog)==null?void 0:t.type)===im_v2_const.DialogType.user},isChat(){return!this.isUser},chatType(){if(this.isUser){return this.$store.getters["users/getPosition"](this.dialogId)}return this.$Bitrix.Loc.getMessage("IM_LIST_RECENT_CHAT_TYPE_GROUP_V2")},openChatButtonText(){if(this.isChat){return this.$Bitrix.Loc.getMessage("IM_ELEMENTS_CHAT_INFO_POPUP_OPEN_CHAT")}return this.$Bitrix.Loc.getMessage("IM_ELEMENTS_CHAT_INFO_POPUP_WRITE_A_MESSAGE")},userProfileLink(){return im_v2_lib_utils.Utils.user.getProfileLink(this.dialogId)}},created(){this.chatService=new im_v2_provider_service.ChatService;if(!this.dialog){this.loadChat()}},methods:{loadChat(){this.isLoading=true;this.chatService.loadChat(this.dialogId).then((()=>{this.isLoading=false})).catch((t=>{this.isLoading=false;this.hasError=true;console.error(t)}))},onOpenChat(){im_public.Messenger.openChat(this.dialogId)},onClickVideoCall(){im_public.Messenger.startVideoCall(this.dialogId)}},template:`\n\t\t<div class="bx-im-chat-info-content__container">\n\t\t\t<template v-if="!isLoading && !hasError">\n\t\t\t\t<div class="bx-im-chat-info-content__detail-info-container">\n\t\t\t\t\t<div class="bx-im-chat-info-content__avatar-container">\n\t\t\t\t\t\t<Avatar :dialogId="dialogId" size="XL"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bx-im-chat-info-content__title-container">\n\t\t\t\t\t\t<ChatTitle v-if="isChat" :dialogId="dialogId" />\n\t\t\t\t\t\t<a v-else :href="userProfileLink" target="_blank">\n\t\t\t\t\t\t\t<ChatTitle :dialogId="dialogId" />\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<div class="bx-im-chat-info-content__chat-description_text">\n\t\t\t\t\t\t\t{{ chatType }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-chat-info-content__buttons-container">\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:size="ButtonSize.M"\n\t\t\t\t\t\t:color="ButtonColor.PrimaryBorder"\n\t\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t\t:text="openChatButtonText"\n\t\t\t\t\t\t:isUppercase="false"\n\t\t\t\t\t\t@click="onOpenChat"\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tv-if="isUser"\n\t\t\t\t\t\t:size="ButtonSize.M"\n\t\t\t\t\t\t:color="ButtonColor.PrimaryBorder"\n\t\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t\t:isUppercase="false"\n\t\t\t\t\t\t:text="$Bitrix.Loc.getMessage('IM_ELEMENTS_CHAT_INFO_POPUP_VIDEOCALL')"\n\t\t\t\t\t\t@click="onClickVideoCall"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if="isLoading">\n\t\t\t\t<div class="bx-im-chat-info-content__loader-container">\n\t\t\t\t\t<div class="bx-im-chat-info-content__loader_icon"></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if="hasError">\n\t\t\t\t<div class="bx-im-chat-info-content__error-container">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_ELEMENTS_CHAT_INFO_POPUP_NO_ACCESS') }}\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const POPUP_ID="im-chat-info-popup";const ChatInfoPopup={name:"ChatInfoPopup",components:{MessengerPopup:MessengerPopup,ChatInfoContent:ChatInfoContent},props:{showPopup:{type:Boolean,required:true},bindElement:{type:Object,required:true},dialogId:{type:String,required:true}},emits:["close"],computed:{POPUP_ID:()=>POPUP_ID,config(){return{minWidth:313,height:134,bindElement:this.bindElement,targetContainer:document.body,offsetTop:0,padding:16,angle:true}}},template:`\n\t\t<MessengerPopup\n\t\t\tv-if="showPopup" \n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t\t:id="POPUP_ID"\n\t\t>\n\t\t\t<ChatInfoContent :dialogId="dialogId"/>\n\t\t</MessengerPopup>\n\t`};var _store=babelHelpers.classPrivateFieldLooseKey("store");var _restClient=babelHelpers.classPrivateFieldLooseKey("restClient");var _userManager=babelHelpers.classPrivateFieldLooseKey("userManager");class UserListService{constructor(){Object.defineProperty(this,_store,{writable:true,value:void 0});Object.defineProperty(this,_restClient,{writable:true,value:void 0});Object.defineProperty(this,_userManager,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_store)[_store]=im_v2_application_core.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,_restClient)[_restClient]=im_v2_application_core.Core.getRestClient();babelHelpers.classPrivateFieldLooseBase(this,_userManager)[_userManager]=new im_v2_lib_user.UserManager}loadUsers(t){return babelHelpers.classPrivateFieldLooseBase(this,_restClient)[_restClient].callMethod(im_v2_const.RestMethod.imUserListGet,{ID:t}).then((t=>babelHelpers.classPrivateFieldLooseBase(this,_userManager)[_userManager].setUsersToModel(Object.values(t.data()))))}}const LOADER_SIZE="xs";const LOADER_TYPE="BULLET";const Loader={name:"MessengerLoader",mounted(){this.loader=new ui_loader.Loader({target:this.$refs["messenger-loader"],type:LOADER_TYPE,size:LOADER_SIZE});this.loader.render();this.loader.show()},beforeUnmount(){this.loader.hide();this.loader=null},template:`\n\t\t<div class="bx-im-elements-loader__container" ref="messenger-loader"></div>\n\t`};const UserItem={name:"UserItem",components:{Avatar:Avatar,ChatTitle:ChatTitle},props:{userId:{type:Number,required:true}},computed:{AvatarSize:()=>AvatarSize,user(){return this.$store.getters["users/get"](this.userId,true)},userDialogId(){return this.userId.toString()},userStatusClasses(){if(this.user.bot){return[]}const t=this.$store.getters["users/getStatus"](this.userId);if(t===""){return[]}return["bx-im-user-list-content__avatar-status",`--${t}`]}},methods:{onUserClick(){im_public.Messenger.openChat(this.userDialogId)}},template:`\n\t\t<div class="bx-im-user-list-content__user-container" @click="onUserClick">\n\t\t\t<div class="bx-im-user-list-content__avatar-container" :class="userStatusClasses">\n\t\t\t\t<Avatar :size="AvatarSize.XS" :dialogId="userDialogId" />\n\t\t\t</div>\n\t\t\t<ChatTitle class="bx-im-user-list-content__chat-title-container" :dialogId="userDialogId" />\n\t\t</div>\n\t`};const UserListContent={components:{UserItem:UserItem,Loader:Loader},props:{userIds:{type:Array,required:true},adjustPopupFunction:{type:Function,required:true},loading:{type:Boolean,required:false,default:false}},data(){return{hasError:false,isLoadingUsers:false}},computed:{isLoading(){return this.loading||this.isLoadingUsers}},watch:{userIds(){this.$nextTick((()=>{this.adjustPopupFunction()}))}},created(){if(this.needUserRequest()){this.requestUserData()}},methods:{getUserListService(){if(!this.userListService){this.userListService=new UserListService}return this.userListService},getUser(t){return this.$store.getters["users/get"](t)},needUserRequest(){return this.userIds.some((t=>!this.getUser(t)))},requestUserData(){this.isLoadingUsers=true;this.getUserListService().loadUsers(this.userIds).then((()=>{this.isLoadingUsers=false})).catch((t=>{console.error(t);this.hasError=true;this.isLoadingUsers=false}))},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-user-list-content__container bx-im-user-list-content__scope">\n\t\t\t<template v-if="!isLoading && !hasError">\n\t\t\t\t<UserItem v-for="userId in userIds" :userId="userId" />\n\t\t\t</template>\n\t\t\t<div v-else-if="isLoading" class="bx-im-user-list-content__loader-container">\n\t\t\t\t<Loader />\n\t\t\t</div>\n\t\t\t<div v-else-if="hasError">\n\t\t\t\t{{ loc('IM_ELEMENTS_CHAT_INFO_POPUP_NO_ACCESS') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const POPUP_ID$1="im-user-list-popup";const UserListPopup={name:"UserListPopup",components:{MessengerPopup:MessengerPopup,UserListContent:UserListContent},props:{showPopup:{type:Boolean,required:true},id:{type:String,required:false,default:POPUP_ID$1},bindElement:{type:Object,required:true},userIds:{type:Array,required:true},withAngle:{type:Boolean,required:false,default:true},loading:{type:Boolean,required:false,default:false},forceTop:{type:Boolean,required:false,default:false},offsetLeft:{type:Number,required:false,default:0}},emits:["close"],computed:{POPUP_ID:()=>POPUP_ID$1,config(){const t={bindElement:this.bindElement,targetContainer:document.body,offsetTop:4,offsetLeft:this.offsetLeft,padding:0,angle:this.withAngle};if(this.forceTop){t.bindOptions={position:"top"}}return t}},template:`\n\t\t<MessengerPopup\n\t\t\tv-if="showPopup"\n\t\t\tv-slot="{adjustPosition}"\n\t\t\t:config="config"\n\t\t\t@close="$emit('close')"\n\t\t\t:id="id"\n\t\t>\n\t\t\t<UserListContent :userIds="userIds" :loading="loading" :adjustPopupFunction="adjustPosition"/>\n\t\t</MessengerPopup>\n\t`};
/**
	 * Bitrix Messenger
	 * Attach element Vue component
	 *
	 * @package bitrix
	 * @subpackage im
	 * @copyright 2001-2019 Bitrix
	 */const ButtonType=Object.freeze({newline:"NEWLINE",button:"BUTTON"});const Keyboard={props:{buttons:{type:Array,default:()=>[]},messageId:{default:0},userId:{default:0},dialogId:{default:0}},data:function(){return{isMobile:im_v2_lib_utils.Utils.platform.isMobile(),isBlocked:false,localButtons:[]}},created(){this.localButtons=this.prepareButtons(this.buttons)},watch:{buttons(){clearTimeout(this.recoverStateButton);this.isBlocked=false;this.localButtons=this.prepareButtons(this.buttons)}},methods:{click(button){if(this.isBlocked){return false}if(button.DISABLED&&button.DISABLED==="Y"){return false}if(button.ACTION&&button.ACTION_VALUE.toString()){this.$emit("click",{action:"ACTION",params:{dialogId:this.dialogId,messageId:this.messageId,botId:button.BOT_ID,action:button.ACTION,value:button.ACTION_VALUE}})}else if(button.FUNCTION){const execFunction=button.FUNCTION.toString().replace("#MESSAGE_ID#",this.messageId).replace("#DIALOG_ID#",this.dialogId).replace("#USER_ID#",this.userId);eval(execFunction)}else if(button.APP_ID){im_v2_lib_logger.Logger.warn("Messenger keyboard: open app is not implemented.")}else if(button.LINK){if(im_v2_lib_utils.Utils.platform.isBitrixMobile()){app.openNewPage(button.LINK)}else{window.open(button.LINK,"_blank")}}else if(button.WAIT!=="Y"){if(button.BLOCK==="Y"){this.isBlocked=true}button.WAIT="Y";this.$emit("click",{action:"COMMAND",params:{dialogId:this.dialogId,messageId:this.messageId,botId:button.BOT_ID,command:button.COMMAND,params:button.COMMAND_PARAMS}});this.recoverStateButton=setTimeout((()=>{this.isBlocked=false;button.WAIT="N"}),1e4)}return true},getStyles(t){const e={};if(t.WIDTH){e["width"]=`${t.WIDTH}px`}else if(t.DISPLAY==="BLOCK"){e["width"]="225px"}if(t.BG_COLOR){e["backgroundColor"]=t.BG_COLOR}if(t.TEXT_COLOR){e["color"]=t.TEXT_COLOR}return e},prepareButtons(t){return t.filter((t=>{if(!t.CONTEXT){return true}if(im_v2_lib_utils.Utils.platform.isBitrixMobile()&&t.CONTEXT==="DESKTOP"){return false}if(!im_v2_lib_utils.Utils.platform.isBitrixMobile()&&t.CONTEXT==="MOBILE"){return false}if(!im_v2_lib_utils.Utils.platform.isBitrixMobile()&&(t.ACTION==="DIALOG"||t.ACTION==="CALL")){return false}return true}))}},computed:{ButtonType:()=>ButtonType},template:`\n\t\t<div :class="['bx-im-element-keyboard', {'bx-im-element-keyboard-mobile': isMobile}]">\n\t\t\t<template v-for="(button, index) in localButtons">\n\t\t\t\t<div v-if="button.TYPE === ButtonType.newline" class="bx-im-element-keyboard-button-separator"></div>\n\t\t\t\t<span v-else-if="button.TYPE === ButtonType.button" :class="[\n\t\t\t\t\t'bx-im-element-keyboard-button', \n\t\t\t\t\t'bx-im-element-keyboard-button-'+button.DISPLAY.toLowerCase(), \n\t\t\t\t\t{\n\t\t\t\t\t\t'bx-im-element-keyboard-button-disabled': isBlocked || button.DISABLED === 'Y',\n\t\t\t\t\t\t'bx-im-element-keyboard-button-progress': button.WAIT === 'Y',\n\t\t\t\t\t}\n\t\t\t\t]" @click="click(button)">\n\t\t\t\t\t<span class="bx-im-element-keyboard-button-text" :style="getStyles(button)">{{button.TEXT}}</span>\n\t\t\t\t</span>\n\t\t\t</template>\n\t\t</div>\n\t`};const Dropdown={name:"ChatDropdown",props:{items:{type:Object,required:true},id:{type:String,required:true}},emits:["itemChange"],data(){return{selectedElement:"",menuOpened:false}},computed:{formattedItems(){const t={};this.items.forEach((e=>{t[e.value]=e}));return t},defaultItem(){return this.items.find((t=>t.default===true))}},created(){this.menuInstance=null;if(this.defaultItem){this.selectedElement=this.defaultItem.value}this.$emit("itemChange",this.selectedElement)},methods:{toggleMenu(){if(!this.menuInstance){this.menuInstance=this.getMenuInstance()}if(this.menuOpened){this.menuInstance.close();return}this.menuInstance.show();const t=this.$refs["container"].clientWidth;this.menuInstance.getPopupWindow().setWidth(t);this.menuOpened=true},getMenuInstance(){return main_popup.MenuManager.create({id:this.id,bindOptions:{forceBindPosition:true,position:"bottom"},targetContainer:document.body,bindElement:this.$refs["container"],items:this.getMenuItems(),events:{onClose:()=>{this.menuOpened=false}}})},getMenuItems(){return Object.values(this.formattedItems).map((t=>({text:t.text,onclick:()=>{this.selectedElement=t.value;this.$emit("itemChange",t.value);this.menuInstance.close()}})))}},template:`\n\t\t<div class="bx-im-dropdown__container bx-im-dropdown__scope">\n\t\t\t<div @click="toggleMenu" class="ui-ctl ui-ctl-xl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown" ref="container">\n\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t<div class="ui-ctl-element">{{ formattedItems[selectedElement].text }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const SpinnerSize=Object.freeze({S:"S",L:"L"});const Spinner={name:"MessengerSpinner",props:{size:{type:String,default:SpinnerSize.S}},computed:{sizeClassName(){return`--size-${this.size.toLowerCase()}`}},template:`\n\t\t<div class="bx-im-elements-spinner__container">\n\t\t\t<div class="bx-im-elements-spinner__spinner" :class="sizeClassName"></div>\n\t\t</div>\n\t`};const ToggleSize={S:"S",M:"M"};const Toggle={name:"ToggleControl",props:{size:{type:String,required:true},isEnabled:{type:Boolean,default:true}},emits:["change"],data(){return{}},computed:{containerClasses(){const t=[`--size-${this.size.toLowerCase()}`];if(!this.isEnabled){t.push("--off")}return t}},methods:{toggle(){this.$emit("change",!this.isEnabled)}},template:`\n\t\t<div @click="toggle" :class="containerClasses" class="bx-im-toggle__container bx-im-toggle__scope">\n\t\t\t<span class="bx-im-toggle__cursor"></span>\n\t\t\t<span class="bx-im-toggle__enabled"></span>\n\t\t\t<span class="bx-im-toggle__disabled"></span>\n\t\t</div>\n\t`};const File={name:"FileComponent",props:{item:{type:Object,required:true}},data(){return{}},computed:{file(){return this.item},fileShortName(){const t=70;return im_v2_lib_utils.Utils.file.getShortFileName(this.file.name,t)},fileSize(){return im_v2_lib_utils.Utils.file.formatFileSize(this.file.size)},iconClass(){const t=im_v2_lib_utils.Utils.file.getIconTypeByFilename(this.file.name);return`ui-icon-file-${t}`},isImage(){return this.file.type!==im_v2_const.FileType.image},isVideo(){return this.file.type!==im_v2_const.FileType.video},canBeOpenedWithViewer(){var t;return this.file.viewerAttrs&&((t=BX.UI)==null?void 0:t.Viewer)},viewerAttributes(){return im_v2_lib_utils.Utils.file.getViewerDataAttributes(this.file.viewerAttrs)}},watch:{"file.status"(){this.getProgressBarManager().update()},"file.progress"(){this.getProgressBarManager().update()}},mounted(){this.initProgressBar()},beforeUnmount(){this.removeProgressBar()},methods:{download(){var t;if(this.file.progress!==100||this.canBeOpenedWithViewer){return}const e=(t=this.file.urlDownload)!=null?t:this.file.urlShow;window.open(e,"_blank")},initProgressBar(){if(this.file.progress===100){return}let t;if(this.file.progress<0||!this.isImage&&!this.isVideo){t=false}this.progressBarManager=new im_v2_lib_progressbar.ProgressBarManager({container:this.$refs["container"],uploadState:this.file,customConfig:{blurElement:t}});this.progressBarManager.subscribe(im_v2_lib_progressbar.ProgressBarManager.event.cancel,(()=>{main_core_events.EventEmitter.emit(im_v2_const.EventType.uploader.cancel,{taskId:this.file.id})}));this.progressBarManager.subscribe(im_v2_lib_progressbar.ProgressBarManager.event.destroy,(()=>{if(this.progressBar){this.progressBar=null}}));this.progressBarManager.start()},removeProgressBar(){if(!this.progressBarManager){return}this.progressBarManager.destroy()},getProgressBarManager(){return this.progressBarManager},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div @click="download" v-bind="viewerAttributes" class="bx-im-media-file__container bx-im-media-file__scope" ref="container">\n\t\t\t<div class="bx-im-media-file__icon">\n\t\t\t\t<div :class="iconClass" class="ui-icon"><i></i></div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-media-file__right">\n\t\t\t\t<div :title="file.name" class="bx-im-element-file-name bx-im-media-file__name">\n\t\t\t\t\t{{ fileShortName }}\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-element-file-size bx-im-media-file__size">{{ fileSize }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const MAX_IMAGE_SIZE$1=250;const Image=ui_vue3.BitrixVue.cloneComponent(File,{name:"ImageComponent",directives:{lazyload:ui_vue3_directives_lazyload.lazyload},data(){return{}},computed:{imageSize(){const t=this.file.width>MAX_IMAGE_SIZE$1?MAX_IMAGE_SIZE$1/this.file.width:1;const e={width:this.file.width*t,height:this.file.height*t};return{width:`${e.width}px`,height:`${e.height}px`,backgroundSize:e.width<100||e.height<100?"contain":"initial"}}},template:`\n\t\t<div class="bx-im-media-image__container" @click="download" ref="container">\n\t\t\t<img\n\t\t\t\tv-lazyload\n\t\t\t\tdata-lazyload-dont-hide\n\t\t\t\t:data-lazyload-src="file.urlPreview"\n\t\t\t\tv-bind="viewerAttributes"\n\t\t\t\t:title="loc('IM_ELEMENTS_MEDIA_IMAGE_TITLE', {'#NAME#': file.name, '#SIZE#': file.size})"\n\t\t\t\t:style="imageSize"\n\t\t\t\tclass="bx-im-media-image__source"\n\t\t\t/>\n\t\t</div>\n\t`});const Audio={name:"AudioComponent",components:{AudioPlayer:ui_vue3_components_audioplayer.AudioPlayer},props:{item:{type:Object,required:true},messageType:{type:String,required:true}},data(){return{}},computed:{file(){return this.item},playerBackgroundType(){return this.messageType===im_v2_const.MessageType.self?"dark":"light"}},template:`\n\t\t<div class="bx-im-media-audio__container">\n\t\t\t<AudioPlayer :id="file.id" :src="file.urlShow" :background="playerBackgroundType" />\n\t\t</div>\n\t`};const VIDEO_SIZE_TO_AUTOPLAY=5e6;const Video=ui_vue3.BitrixVue.cloneComponent(Image,{name:"VideoComponent",components:{SocialVideo:ui_vue3_components_socialvideo.SocialVideo},data(){return{}},computed:{autoplay(){return this.file.size<VIDEO_SIZE_TO_AUTOPLAY}},template:`\n\t\t<div @click="download" class="bx-im-media-video__container" ref="container">\n\t\t\t<SocialVideo\n\t\t\t\tv-bind="viewerAttributes"\n\t\t\t\t:id="file.id"\n\t\t\t\t:src="file.urlShow"\n\t\t\t\t:preview="file.urlPreview"\n\t\t\t\t:containerStyle="{height: '162px'}"\n\t\t\t\t:elementStyle="imageSize"\n\t\t\t\t:autoplay="autoplay"\n\t\t\t\t:showControls="!file.viewerAttrs"\n\t\t\t/>\n\t\t</div>\n\t`});const ARROW_CONTROL_SIZE=50;const TabsColorScheme=Object.freeze({white:"white",gray:"gray"});const MessengerTabs={name:"MessengerTabs",props:{colorScheme:{type:String,required:true,default:TabsColorScheme.white,validator:t=>Object.values(TabsColorScheme).includes(t.toLowerCase())},tabs:{type:Array,default:()=>[]}},data(){return{hasLeftControl:false,hasRightControl:false,currentElementIndex:0,highlightOffsetLeft:0,highlightWidth:0}},computed:{highlightStyle(){return{left:`${this.highlightOffsetLeft}px`,width:`${this.highlightWidth}px`}},colorSchemeClass(){return this.colorScheme===TabsColorScheme.white?"--white":"--gray"}},watch:{currentElementIndex(t){this.updateHighlightPosition(t);this.$emit("tabSelect",this.tabs[t]);this.scrollToElement(t)}},mounted(){if(this.$refs.tabs.scrollWidth>this.$refs.tabs.offsetWidth){this.hasRightControl=true}this.updateHighlightPosition(this.currentElementIndex)},methods:{getElementNodeByIndex(t){return[...this.$refs.tabs.children].filter((t=>!main_core.Dom.hasClass(t,"bx-im-elements-tabs__highlight")))[t]},updateHighlightPosition(t){const e=this.getElementNodeByIndex(t);this.highlightOffsetLeft=e.offsetLeft;this.highlightWidth=e.offsetWidth},scrollToElement(t){const e=this.getElementNodeByIndex(t);this.$refs.tabs.scroll({left:e.offsetLeft-ARROW_CONTROL_SIZE,behavior:"smooth"})},onTabClick(t){this.currentElementIndex=t.index},isSelectedTab(t){return t===this.currentElementIndex},onLeftClick(){if(this.currentElementIndex<=0){return}this.currentElementIndex--},onRightClick(){if(this.currentElementIndex>=this.tabs.length-1){return}this.currentElementIndex++},updateControlsVisibility(){this.hasRightControl=this.$refs.tabs.scrollWidth>this.$refs.tabs.scrollLeft+this.$refs.tabs.clientWidth;this.hasLeftControl=this.$refs.tabs.scrollLeft>0}},template:`\n\t\t<div class="bx-im-elements-tabs__container bx-im-elements-tabs__scope" :class="colorSchemeClass">\n\t\t\t<div v-if="hasLeftControl" @click.stop="onLeftClick" class="bx-im-elements-tabs__control --left">\n\t\t\t\t<div class="bx-im-elements-tabs__forward-icon"></div>\n\t\t\t</div>\n\t\t\t<div v-if="hasRightControl" @click.stop="onRightClick" class="bx-im-elements-tabs__control --right">\n\t\t\t\t<div class="bx-im-elements-tabs__forward-icon"></div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-elements-tabs__elements" ref="tabs" @scroll.passive="updateControlsVisibility">\n\t\t\t\t<div class="bx-im-elements-tabs__highlight" :style="highlightStyle"></div>\n\t\t\t\t<div\n\t\t\t\t\tv-for="(tab, index) in tabs"\n\t\t\t\t\t:key="tab.id"\n\t\t\t\t\tclass="bx-im-elements-tabs__item"\n\t\t\t\t\t:class="[isSelectedTab(index) ? '--selected' : '']"\n\t\t\t\t\t@click="onTabClick({index: index})"\n\t\t\t\t\t:title="tab.title"\n\t\t\t\t>\n\t\t\t\t\t<div class="bx-im-elements-tabs__item-title">{{ tab.title }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};exports.Avatar=Avatar;exports.AvatarSize=AvatarSize;exports.RecentLoadingState=RecentLoadingState;exports.ChatTitle=ChatTitle;exports.Button=Button;exports.ButtonColor=ButtonColor;exports.ButtonSize=ButtonSize;exports.ButtonIcon=ButtonIcon;exports.MessengerPopup=MessengerPopup;exports.MessengerMenu=MessengerMenu;exports.MenuItem=MenuItem;exports.MenuItemIcon=MenuItemIcon;exports.Attach=Attach;exports.ChatInfoPopup=ChatInfoPopup;exports.UserListPopup=UserListPopup;exports.Keyboard=Keyboard;exports.UserStatus=UserStatus;exports.UserStatusSize=UserStatusSize;exports.Dropdown=Dropdown;exports.Loader=Loader;exports.Spinner=Spinner;exports.SpinnerSize=SpinnerSize;exports.Toggle=Toggle;exports.ToggleSize=ToggleSize;exports.File=File;exports.Image=Image;exports.Audio=Audio;exports.Video=Video;exports.MessengerTabs=MessengerTabs;exports.TabsColorScheme=TabsColorScheme})(this.BX.Messenger.v2.Component.Elements=this.BX.Messenger.v2.Component.Elements||{},BX,BX.Messenger.v2.Lib,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.UI,BX.Messenger.v2.Lib,BX.Messenger.v2.Model,BX.Messenger.v2.Lib,BX.Main,BX,BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Vue3.Directives,BX.Vue3.Components,BX.Messenger.v2.Const,BX.Vue3,BX.Vue3.Components,BX);
//# sourceMappingURL=registry.bundle.map.js