{"version":3,"file":"call-feedback.bundle.js","sources":["../src/call-feedback.js"],"sourcesContent":["import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport { BitrixVue } from \"ui.vue\";\nimport \"ui.forms\";\nimport { Menu } from \"main.popup\";\n\nimport './call-feedback.css';\nimport { Logger } from \"im.lib.logger\";\n\nBitrixVue.component('bx-im-component-call-feedback',\n{\n\tprops: {\n\t\tdarkMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false\n\t\t},\n\t\tcallDetails: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: () => {\n\t\t\t\treturn {\n\t\t\t\t\tid: 0,\n\t\t\t\t\tprovider: '',\n\t\t\t\t\tuserCount: 0,\n\t\t\t\t\tbrowser: '',\n\t\t\t\t\tisMobile: false,\n\t\t\t\t\tisConference: false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tselectedRating: 0,\n\t\t\thoveredRating: 0,\n\t\t\tselectedProblem: '',\n\t\t\tproblemDescription: '',\n\t\t\tisFilled: false\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.initProblemsList();\n\t\tthis.selectedProblem = this.problemsList.noProblem;\n\t},\n\tcomputed:\n\t{\n\t\tshowTextarea()\n\t\t{\n\t\t\treturn this.selectedProblem === this.problemsList.other;\n\t\t},\n\t\twrapClasses()\n\t\t{\n\t\t\treturn ['bx-im-call-feedback-wrap', this.darkMode? 'bx-im-call-feedback-wrap-dark': '']\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tonRatingMouseover(index)\n\t\t{\n\t\t\tthis.hoveredRating = index;\n\t\t},\n\t\tonRatingMouseOut(index)\n\t\t{\n\t\t\tthis.hoveredRating = 0;\n\t\t},\n\t\tonRatingClick(index)\n\t\t{\n\t\t\tthis.selectedRating = index;\n\t\t},\n\t\tprepareFeedback()\n\t\t{\n\t\t\treturn {\n\t\t\t\tevent: 'call_feedback',\n\t\t\t\tcall_id: this.callDetails.id,\n\t\t\t\tkind: this.callDetails.provider,\n\t\t\t\tuserCount: this.callDetails.userCount,\n\t\t\t\tbrowser: this.callDetails.browser,\n\t\t\t\tisMobile: this.callDetails.isMobile,\n\t\t\t\tisConference: this.callDetails.isConference,\n\t\t\t\tcallRating: this.selectedRating,\n\t\t\t\tcallProblem: this.getProblemCode(),\n\t\t\t\tproblemDescription: this.problemDescription\n\t\t\t};\n\t\t},\n\t\tgetProblemCode()\n\t\t{\n\t\t\tlet problem = '';\n\t\t\tfor (const [key, value] of Object.entries(this.problemsList))\n\t\t\t{\n\t\t\t\tif (this.selectedProblem === value)\n\t\t\t\t{\n\t\t\t\t\tproblem = key;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn problem;\n\t\t},\n\t\tsendFeedback()\n\t\t{\n\t\t\tthis.isFilled = true;\n\t\t\tconst feedback = this.prepareFeedback();\n\t\t\tLogger.warn('Call feedback', feedback);\n\t\t\tthis.$emit('feedbackSent');\n\n\t\t\tif (this.selectedRating === 0 && this.selectedProblem === this.problemsList.noProblem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tBX.Call.Util.sendTelemetryEvent(feedback);\n\t\t},\n\t\tgetRatingStarClasses(index)\n\t\t{\n\t\t\treturn [\n\t\t\t\t'bx-im-call-feedback-rating-star',\n\t\t\t\tthis.hoveredRating >= index || this.selectedRating >= index ? 'bx-im-call-feedback-rating-star-filled': 'bx-im-call-feedback-rating-star-empty'\n\t\t\t];\n\t\t},\n\t\tinitProblemsList()\n\t\t{\n\t\t\tthis.problemsList = {\n\t\t\t\tnoProblem: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_NO_ISSUE'),\n\t\t\t\tvideoQuality: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_VIDEO_QUALITY'),\n\t\t\t\tcantSeeEachOther: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_CANT_SEE_EACH_OTHER'),\n\t\t\t\tcantHearEachOther: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_CANT_HEAR_EACH_OTHER'),\n\t\t\t\taudioQuality: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_AUDIO_QUALITY'),\n\t\t\t\tscreenSharingProblem: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_SCREEN_SHARING_PROBLEM'),\n\t\t\t\trecordingProblem: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_RECORDING_PROBLEM'),\n\t\t\t\tcallInterfaceProblem: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_CALL_INTERFACE_PROBLEM'),\n\t\t\t\tgotDisconnected: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_GOT_DISCONNECTED'),\n\t\t\t\tother: this.$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_OTHER')\n\t\t\t};\n\t\t},\n\t\tcreateProblemSelectPopup()\n\t\t{\n\t\t\tconst problemSelect = this.$refs['problemSelect'];\n\t\t\tconst className = 'bx-im-call-feedback-problem-select' + (this.darkMode ? ' bx-im-call-feedback-problem-select-dark': '');\n\t\t\tconst items = [];\n\t\t\tfor (const problem of Object.values(this.problemsList)) {\n\t\t\t\titems.push({\n\t\t\t\t\ttext: problem,\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\tthis.onProblemClick(item);\n\t\t\t\t\t},\n\t\t\t\t\tclassName: 'bx-im-call-feedback-problem-option'\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.problemSelectPopup = new Menu({\n\t\t\t\tbindElement: problemSelect,\n\t\t\t\titems,\n\t\t\t\tclassName,\n\t\t\t\toffsetTop: 0\n\t\t\t});\n\t\t},\n\t\ttoggleProblemSelectPopup()\n\t\t{\n\t\t\tif (!this.problemSelectPopup)\n\t\t\t{\n\t\t\t\tthis.createProblemSelectPopup();\n\t\t\t}\n\n\t\t\tthis.problemSelectPopup.toggle();\n\t\t},\n\t\tonProblemClick(problem)\n\t\t{\n\t\t\tthis.selectedProblem = problem.text;\n\t\t\tthis.problemSelectPopup.toggle();\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"wrapClasses\">\n\t\t\t<div class=\"bx-im-call-feedback-header\">\n\t\t\t\t<div class=\"bx-im-call-feedback-header-title\">{{ $Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_VIDEOCALL_FINISHED') }}</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-call-feedback-content\">\n\t\t\t  \t<template v-if=\"!isFilled\">\n\t\t\t\t\t<div class=\"bx-im-call-feedback-content-title\">{{ $Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_RATE_QUALITY') }}</div>\n\t\t\t\t\t<div class=\"bx-im-call-feedback-rating-wrap\">\n\t\t\t\t\t  \t<template v-for=\"i in 5\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t  \t\t@click=\"onRatingClick(i)\"\n\t\t\t\t\t\t\t\t@mouseover=\"onRatingMouseover(i)\"\n\t\t\t\t\t\t\t\t@mouseout=\"onRatingMouseOut(i)\"\n\t\t\t\t\t\t\t  \t:class=\"getRatingStarClasses(i)\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-call-feedback-problem\">\n\t\t\t\t\t\t<div @click=\"toggleProblemSelectPopup\" class=\"bx-im-call-feedback-problem-selected ui-ctl ui-ctl-after-icon ui-ctl-dropdown\" ref=\"problemSelect\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t<div class=\"ui-ctl-element\">{{ selectedProblem }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t  \t<template v-if=\"showTextarea\">\n\t\t\t\t  \t\t<textarea\n\t\t\t\t\t\t  class=\"bx-im-call-feedback-problem-description\"\n\t\t\t\t\t\t  v-model=\"problemDescription\"\n\t\t\t\t\t\t  :placeholder=\"$Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_ISSUE_DESCRIPTION')\"\n\t\t\t\t\t\t></textarea>\n\t\t\t\t\t</template>\n\t\t\t\t  \t<div class=\"bx-im-call-feedback-submit-wrap\">\n\t\t\t\t\t\t<button @click=\"sendFeedback\" class=\"ui-btn ui-btn-lg ui-btn-primary bx-im-call-feedback-submit\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_SEND') }}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t  \t<template v-else>\n\t\t\t\t  \t<div class=\"bx-im-call-feedback-filled-wrap\">\n\t\t\t\t\t\t<div class=\"bx-im-call-feedback-filled-icon\"></div>\n\t\t\t\t\t\t<div class=\"bx-im-call-feedback-filled-text\">{{ $Bitrix.Loc.getMessage('BX_IM_COMPONENT_CALL_FEEDBACK_FILLED') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["BitrixVue","component","props","darkMode","type","Boolean","required","callDetails","Object","id","provider","userCount","browser","isMobile","isConference","data","selectedRating","hoveredRating","selectedProblem","problemDescription","isFilled","created","initProblemsList","problemsList","noProblem","computed","showTextarea","other","wrapClasses","methods","onRatingMouseover","index","onRatingMouseOut","onRatingClick","prepareFeedback","event","call_id","kind","callRating","callProblem","getProblemCode","problem","entries","key","value","sendFeedback","feedback","Logger","warn","$emit","BX","Call","Util","sendTelemetryEvent","getRatingStarClasses","$Bitrix","Loc","getMessage","videoQuality","cantSeeEachOther","cantHearEachOther","audioQuality","screenSharingProblem","recordingProblem","callInterfaceProblem","gotDisconnected","createProblemSelectPopup","problemSelect","$refs","className","items","values","push","text","onclick","item","onProblemClick","problemSelectPopup","Menu","bindElement","offsetTop","toggleProblemSelectPopup","toggle","template"],"mappings":"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"}