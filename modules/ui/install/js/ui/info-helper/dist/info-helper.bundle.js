this.BX=this.BX||{},function(e,t,s,a,r,i){"use strict";class l{static ClosePage(){BX.UI.InfoHelper.close()}static openPage(){window.location.href=BX.UI.InfoHelper.frameUrl}static openPageInNewTab(){window.open(BX.UI.InfoHelper.frameUrl,"_blank")}static reloadParent(){BX.UI.InfoHelper.reloadParent()}static openSlider(e){top.BX.SidePanel.Instance.open(e.url)}static openPriceTable(){l.openSlider({url:"/settings/license_all.php"})}static openChatWithHead(e){const t=top.BX.Messenger.Public.openChat(),s={tool:"InfoHelper",c_section:document.location.href,event:"create_chatforrequest"};e.toolId&&i.ajax.runAction("intranet.tools.tool.createHeadChat",{data:{toolId:e.toolId}}).then(a=>{t.then(()=>{top.BX.Messenger.Public.openChat("chat"+a.data.chatId)}),s.type=e.toolId,s.category="tool_off",r.sendData(s)}),e.featureCode&&i.ajax.runAction("bitrix24.license.upgraderequest.createHeadChat",{data:{code:e.featureCode}}).then(a=>{t.then(()=>{top.BX.Messenger.Public.openChat("chat"+a.data.chatId)}),s.type=e.featureCode,s.category="limit",r.sendData(s)})}static openCheckout(e){if(e.mpSubscribe&&i.Extension.getSettings("ui.info-helper").licenseType){const e=i.Uri.addParam("/settings/order/make.php",{product:i.Extension.getSettings("ui.info-helper").licenseType+"12",subscr:"o"});l.openSlider({url:e})}else if(e.tariff){const t=i.Uri.addParam("/settings/order/make.php",{product:e.period?e.tariff+e.period:e.tariff+"12",subscr:e.mpSubscribe?"o":null});l.openSlider({url:t})}}static openToolsSettings(){l.openSlider({url:i.Extension.getSettings("ui.info-helper").settingsUrl+"?page=tools"})}static openInformer(e){top.BX.UI.InfoHelper.__showExternal(e.code,e.option)}static activateDemoSubscription(e){if("Y"===e.licenseAgreed){const e="/bitrix/tools/rest.php",t=e=>{var t;BX.SidePanel.Instance.getTopSlider()&&e.error&&(null==(t=BX.UI.InfoHelper.sliderProviderForOldFormat)||t.getFrame().contentWindow.postMessage({action:"onActivateDemoSubscriptionResult",result:e},"*"));if(!e.error){const e=i.Extension.getSettings("ui.info-helper");e.licenseNeverPayed?l.openInformer({code:"limit_market_trial_active"}):e.marketUrl&&l.openSlider({url:e.marketUrl})}};BX.ajax({dataType:"json",method:"POST",url:e,data:{action:"activate_demo",sessid:BX.bitrix_sessid()},onsuccess:t,onfailure:function(e,s){t({error:e+(s?": "+s:"")})}})}}static activateDemoLicense(){i.ajax.runAction("ui.infoHelper.activateDemoLicense").then(e=>{var t;BX.SidePanel.Instance.getTopSlider()&&(null==(t=BX.UI.InfoHelper.sliderProviderForOldFormat)||t.getFrame().contentWindow.postMessage({action:"onActivateDemoLicenseResult",result:e},"*"));"Y"===e.data.success&&BX.onCustomEvent("BX.UI.InfoHelper:onActivateDemoLicenseSuccess",{result:e})})}static openBuySubscriptionPage(){i.ajax.runAction("ui.infoHelper.getBuySubscriptionUrl").then(e=>{e.data&&e.data.url&&("blank"===e.data.action?window.open(e.data.url,"_blank"):"redirect"===e.data.action&&(window.location.href=e.data.url))})}static activateTrialFeature(e){i.ajax.runAction("ui.infoHelper.activateTrialFeature",{data:{featureId:e.featureId}}).then(t=>{var s;BX.SidePanel.Instance.getTopSlider()&&(null==(s=BX.UI.InfoHelper.sliderProviderForOldFormat)||s.getFrame().contentWindow.postMessage({action:"onActivateTrialFeature",result:t},"*"));"Y"===t.data.success&&BX.onCustomEvent("BX.UI.InfoHelper:onActivateTrialFeatureSuccess",{result:t,featureId:e.featureId})})}}class o{}o.SLIDER="slider",o.POPUP="popup";var n=babelHelpers.classPrivateFieldLooseKey("type"),d=babelHelpers.classPrivateFieldLooseKey("code"),c=babelHelpers.classPrivateFieldLooseKey("featureId");class p{constructor(e){if(Object.defineProperty(this,n,{writable:!0,value:void 0}),Object.defineProperty(this,d,{writable:!0,value:void 0}),Object.defineProperty(this,c,{writable:!0,value:void 0}),e.type!==o.SLIDER&&e.type!==o.POPUP)throw new Error("Invalid parameter 'type'");var t,s;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.type,babelHelpers.classPrivateFieldLooseBase(this,d)[d]=null!=(t=e.code)?t:null,babelHelpers.classPrivateFieldLooseBase(this,c)[c]=null!=(s=e.featureId)?s:null}getRequest(){return i.ajax.runAction(p.controller,{data:{type:babelHelpers.classPrivateFieldLooseBase(this,n)[n],code:babelHelpers.classPrivateFieldLooseBase(this,d)[d],currentUrl:window.location.href,featureId:babelHelpers.classPrivateFieldLooseBase(this,c)[c]}})}}p.controller="ui.infoHelper.getInitParams";class b{show(e,t){throw new Error("Must be implemented in a child class")}close(){throw new Error("Must be implemented in a child class")}}var u=babelHelpers.classPrivateFieldLooseKey("openSlider"),h=babelHelpers.classPrivateFieldLooseKey("buildUrl"),v=babelHelpers.classPrivateFieldLooseKey("createContainerNode"),P=babelHelpers.classPrivateFieldLooseKey("createFrameNode");class f extends b{constructor(e={}){if(super(),Object.defineProperty(this,P,{value:L}),Object.defineProperty(this,v,{value:g}),Object.defineProperty(this,h,{value:F}),Object.defineProperty(this,u,{value:m}),this.frameUrlTemplate=e.frameUrlTemplate||"",this.frameUrl=i.Type.isStringFilled(e.frameUrl)?e.frameUrl:"",this.width=i.Type.isNumber(e.width)?e.width:700,this.constructorParams=e,e.dataSource&&e.dataSource instanceof Promise)this.dataSource=e.dataSource;else{const t={type:o.SLIDER,code:null,featureId:e.featureId};this.dataSource=new p(t).getRequest()}}__showExternal(e,t){let s=700;const a=`${this.getId()}:${e}`,r=babelHelpers.classPrivateFieldLooseBase(this,P)[P]();t&&t.width&&t.width>0&&(s=t.width);babelHelpers.classPrivateFieldLooseBase(this,u)[u]({id:a,contentCallback:(t=>new Promise((t,s)=>{const a={type:o.SLIDER};new p(a).getRequest().then(t=>(r.src=babelHelpers.classPrivateFieldLooseBase(this,h)[h](e),babelHelpers.classPrivateFieldLooseBase(this,v)[v](this.getLoader(),r))).then(e=>t(e))})).bind(this),width:s,events:{onLoad:()=>this.showFrame(r)}})}show(e,t){this.isOpen()||(i.Type.isPlainObject(t)||(t={}),(e||t.featureId||this.constructorParams.featureId||this.constructorParams.dataSource)&&(this.contentCallback=s=>new Promise((s,a)=>{this.hasOpen?s(this.getContent()):this.dataSource.then(a=>{const{data:r}=a;return r.code&&(e=r.code),this.frameUrlTemplate=r.frameUrlTemplate,this.frameUrl=babelHelpers.classPrivateFieldLooseBase(this,h)[h](e,t,r),this.getFrame().src!==this.frameUrl&&(this.getFrame().src=this.frameUrl),this.bindEvent(r.availableDomainList),this.hasOpen=!0,s(this.getContent())})}),babelHelpers.classPrivateFieldLooseBase(this,u)[u]({id:this.getId(),contentCallback:this.contentCallback,width:this.width,events:{onLoad:()=>this.showFrame(),onClose:()=>{var e;(i.Event.unbindAll(window,"message"),this.frameNode)&&(null==(e=this.frameNode.contentWindow)||e.postMessage({action:"onCloseWidget"},"*"))}}})))}bindEvent(e){BX.bind(top.window,"message",BX.proxy((function(t){if(!t.origin||t.origin&&!e.includes(t.origin))return;if(!t.data||!i.Type.isObject(t.data))return;const s=l[t.data.action];i.Type.isFunction(s)&&s(t.data)}),this))}close(){const e=this.getSlider();e&&e.isOpen()&&e.close()}getContent(){return this.content||(this.content=babelHelpers.classPrivateFieldLooseBase(this,v)[v](this.getLoader(),this.getFrame())),this.content}getId(){return"ui:info_helper"}getFrame(){return this.frameNode||(this.frameNode=babelHelpers.classPrivateFieldLooseBase(this,P)[P]()),this.frameNode}hasFrameNode(){return i.Type.isElementNode(this.frameNode)}showFrame(e){e||(e=this.getFrame()),setTimeout(()=>{e.classList.add("info-helper-panel-iframe-show")},600)}getSlider(){return BX.SidePanel.Instance.getSlider(this.getId())}isOpen(){return this.getSlider()&&this.getSlider().isOpen()}getLoader(){if(this.popupLoader)return this.popupLoader;const e=new t.Loader({target:BX("info-helper-container"),size:100});return e.show(),this.popupLoader=e.data.container,this.popupLoader}}function m(e){BX.SidePanel.Instance.open(e.id,{contentCallback:e.contentCallback,width:e.width,loader:"default-loader",cacheable:!1,customRightBoundary:0,events:e.events})}function F(e,t={},s=null){let a=this.frameUrlTemplate.replace(/code/,e);return t.featureId&&i.Type.isArray(s.trialableFeatureList)&&(a=i.Uri.addParam(a,{featureId:t.featureId,trialableFeatureList:s.trialableFeatureList.join(",")})),a}function g(e,t){return BX.create("div",{attrs:{className:"info-helper-container",id:"info-helper-container"},children:[e,t]})}function L(){return BX.create("iframe",{attrs:{className:"info-helper-panel-iframe",src:"about:blank"}})}var B=babelHelpers.classPrivateFieldLooseKey("code"),H=babelHelpers.classPrivateFieldLooseKey("category");class w{constructor(e,t){Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,H,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e,babelHelpers.classPrivateFieldLooseBase(this,H)[H]=t}sendByEventName(e,t=null){r.sendData({tool:"InfoHelper",category:babelHelpers.classPrivateFieldLooseBase(this,H)[H],type:babelHelpers.classPrivateFieldLooseBase(this,B)[B],event:e,c_section:new i.Uri(document.location.href).getPath(),p1:t})}}var y=babelHelpers.classPrivateFieldLooseKey("dataSource"),I=babelHelpers.classPrivateFieldLooseKey("bindElement"),O=babelHelpers.classPrivateFieldLooseKey("popup"),S=babelHelpers.classPrivateFieldLooseKey("code"),E=babelHelpers.classPrivateFieldLooseKey("analytics"),U=babelHelpers.classPrivateFieldLooseKey("getPopup");class X extends b{constructor(e){if(super(),Object.defineProperty(this,U,{value:j}),Object.defineProperty(this,y,{writable:!0,value:void 0}),Object.defineProperty(this,I,{writable:!0,value:void 0}),Object.defineProperty(this,O,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),Object.defineProperty(this,E,{writable:!0,value:void 0}),!i.Type.isDomNode(e.bindElement))throw new Error("Invalid parameter 'bindElement'");if(babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e.bindElement,!i.Type.isString(e.code))throw new Error("Invalid parameter 'code'");if(babelHelpers.classPrivateFieldLooseBase(this,S)[S]=e.code,e.dataSource&&e.dataSource instanceof Promise)babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e.dataSource;else{const t={type:o.POPUP,code:babelHelpers.classPrivateFieldLooseBase(this,S)[S],featureId:e.featureId};babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new p(t).getRequest()}babelHelpers.classPrivateFieldLooseBase(this,E)[E]=new w(babelHelpers.classPrivateFieldLooseBase(this,S)[S],o.POPUP)}show(e,t){babelHelpers.classPrivateFieldLooseBase(this,U)[U]().show(),babelHelpers.classPrivateFieldLooseBase(this,E)[E].sendByEventName("show")}close(){babelHelpers.classPrivateFieldLooseBase(this,U)[U]().close(),babelHelpers.classPrivateFieldLooseBase(this,E)[E].sendByEventName("close")}}function j(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O]||(babelHelpers.classPrivateFieldLooseBase(this,O)[O]=new a.PopupWithHeader({target:babelHelpers.classPrivateFieldLooseBase(this,I)[I],id:"demo-popup-components-maker-"+Math.random(8),width:344,content:[],asyncData:babelHelpers.classPrivateFieldLooseBase(this,y)[y],template:new a.SaleTemplate,analyticsCallback:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,E)[E]&&babelHelpers.classPrivateFieldLooseBase(this,E)[E].sendByEventName(e,t)}})),babelHelpers.classPrivateFieldLooseBase(this,O)[O]}var T=babelHelpers.classPrivateFieldLooseKey("code"),C=babelHelpers.classPrivateFieldLooseKey("provider"),x=babelHelpers.classPrivateFieldLooseKey("options"),K=babelHelpers.classPrivateFieldLooseKey("createProvider");class N{constructor(e){var t,s;if(Object.defineProperty(this,K,{value:_}),Object.defineProperty(this,T,{writable:!0,value:void 0}),Object.defineProperty(this,C,{writable:!0,value:void 0}),Object.defineProperty(this,x,{writable:!0,value:void 0}),!e.code&&!e.featureId)throw new Error("Either the 'code' parameter or the 'featureId' parameter is required");babelHelpers.classPrivateFieldLooseBase(this,x)[x]=e,babelHelpers.classPrivateFieldLooseBase(this,x)[x].bindElement=null!=(t=e.bindElement)?t:null,babelHelpers.classPrivateFieldLooseBase(this,T)[T]=null!=(s=e.code)?s:"";const a=i.Extension.getSettings("ui.info-helper");babelHelpers.classPrivateFieldLooseBase(this,C)[C]=babelHelpers.classPrivateFieldLooseBase(this,K)[K](a)}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,x)[x]}getProvider(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}show(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].show(babelHelpers.classPrivateFieldLooseBase(this,T)[T],{})}close(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].close()}getBindElement(){return this.getOptions().bindElement}}function _(e){if(!(i.Type.isObject(e)&&e.popupProviderEnabled&&i.Type.isDomNode(this.getOptions().bindElement))||this.getOptions().featureId&&e.isUpgradeTariffAvailable){var t;const e=new f({featureId:null!=(t=this.getOptions().featureId)?t:null});return s.InfoHelper.sliderProviderForOldFormat=e,e}var a;return new X({bindElement:this.getOptions().bindElement,code:babelHelpers.classPrivateFieldLooseBase(this,T)[T],featureId:null!=(a=this.getOptions().featureId)?a:null})}var k=babelHelpers.classPrivateFieldLooseKey("promoters");class A{static register(e){A.exist(e)||babelHelpers.classPrivateFieldLooseBase(A,k)[k].push(e)}static exist(e){return babelHelpers.classPrivateFieldLooseBase(A,k)[k].find(t=>t===e)}static getPromoter(e){let t;return babelHelpers.classPrivateFieldLooseBase(A,k)[k].forEach(s=>{let a=!0;Object.keys(s.getOptions()).forEach(t=>{s.getOptions()[t]!==e[t]&&(a=!1)}),a&&(t=s)}),t instanceof N||(t=new N(e),A.register(t)),t}}Object.defineProperty(A,k,{writable:!0,value:[]});var D=babelHelpers.classPrivateFieldLooseKey("elements"),R=babelHelpers.classPrivateFieldLooseKey("isLaunch"),M=babelHelpers.classPrivateFieldLooseKey("attributeName");class q{static launch(){babelHelpers.classPrivateFieldLooseBase(q,R)[R]||(q.getElements().forEach(e=>{i.Event.bind(e,"click",t=>{var s,a,r;const i=null==(s=t.target)||null==(a=s.attributes)||null==(r=a.getNamedItem(babelHelpers.classPrivateFieldLooseBase(q,M)[M]))?void 0:r.value;i&&A.getPromoter({code:i,bindElement:e}).show()})}),babelHelpers.classPrivateFieldLooseBase(q,R)[R]=!0)}static getElements(){return babelHelpers.classPrivateFieldLooseBase(q,D)[D]||(babelHelpers.classPrivateFieldLooseBase(q,D)[D]=document.querySelectorAll(`[${babelHelpers.classPrivateFieldLooseBase(q,M)[M]}]`)),babelHelpers.classPrivateFieldLooseBase(q,D)[D]}}Object.defineProperty(q,D,{writable:!0,value:void 0}),Object.defineProperty(q,R,{writable:!0,value:void 0}),Object.defineProperty(q,M,{writable:!0,value:"data-feature-promoter"}),BX.ready(()=>{q.launch()}),e.InfoHelper=class{static init(e){this.sliderProviderForOldFormat=new f({width:700,frameUrlTemplate:e.frameUrlTemplate})}static __showExternal(e,t){var s;null==(s=this.sliderProviderForOldFormat)||s.__showExternal(e,t)}static show(e,t){var s;i.Type.isPlainObject(t)||(t={}),this.init({}),null==(s=this.sliderProviderForOldFormat)||s.show(e,t)}static close(){var e;null==(e=this.sliderProviderForOldFormat)||e.close()}static getContent(){var e;return null==(e=this.sliderProviderForOldFormat)?void 0:e.getContent()}static getFrame(){var e;return null==(e=this.sliderProviderForOldFormat)?void 0:e.getFrame()}static showFrame(e){var t;null==(t=this.sliderProviderForOldFormat)||t.showFrame(e)}static getLoader(){var e;return null==(e=this.sliderProviderForOldFormat)?void 0:e.getLoader()}static getSliderId(){var e;return null==(e=this.sliderProviderForOldFormat)?void 0:e.getId()}static getSlider(){var e;return null==(e=this.sliderProviderForOldFormat)?void 0:e.getSlider()}static reloadParent(){let e=!1;const t=BX.SidePanel.Instance.getTopSlider();t&&(e=BX.SidePanel.Instance.getPreviousSlider(t)),e?e.reload():window.location.reload()}static isOpen(){var e;return null==(e=this.sliderProviderForOldFormat)?void 0:e.isOpen()}static isInited(){return this.inited}},e.FeaturePromoter=N,e.FeaturePromotersRegistry=A}(this.BX.UI=this.BX.UI||{},BX,BX.UI,BX.UI,BX.UI.Analytics,BX);
//# sourceMappingURL=info-helper.bundle.js.map
