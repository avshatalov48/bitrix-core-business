this.BX=this.BX||{};(function(t,i,e,o,s){"use strict";let n=t=>t,r,a,l,h,u,d,p,c;class g{constructor(t={}){var e,o,s,n;this.title=t.title||null;this.content=t.content||null;this.bottomText=t.bottomText||i.Loc.getMessage("UI_QR_AUTHORIZE_TAKE_CODE");this.showFishingWarning=(e=t.showFishingWarning)!=null?e:false;this.showBottom=(o=t.showBottom)!=null?o:true;this.helpLink=t.helpLink||null;this.helpCode=t.helpCode||null;this.qr=t.qr||null;this.popupParam=t.popupParam||null;this.intent=t.intent||"calendar";this.popup=null;this.loader=null;this.ttl=(s=(n=i.Extension.getSettings("ui.qrauthorization"))==null?void 0:n.ttl)!=null?s:60;this.ttlInterval=null;this.qrNode=null;this.successNode=null;this.loadingNode=null;this.isSubscribe=false}createQrCodeImage(){i.Dom.clean(this.getQrNode());if(i.Type.isString(this.qr)){this.clean();new QRCode(this.getQrNode(),{text:this.qr,width:180,height:180});return}this.loading();i.ajax.runAction("mobile.deeplink.get",{data:{intent:this.intent,ttl:this.ttl}}).then((t=>{var i;const e=(i=t.data)==null?void 0:i.link;if(e){this.clean();new QRCode(this.getQrNode(),{text:e,width:180,height:180});if(!this.isSubscribe){this.isSubscribe=true;this.subscribe()}}})).catch((()=>{}))}subscribe(){if(s.PULL){s.PULL.subscribe({type:"BX.PullClient.SubscriptionType.Server",moduleId:"mobile",command:"onDeeplinkShouldRefresh",callback:t=>{this.success()}})}}getQrNode(){if(!this.qrNode){this.qrNode=i.Tag.render(r||(r=n`
				<div class="ui-qr-authorization__popup-qr"></div>
			`))}return this.qrNode}getPopup(){if(!this.popup){var t,o,s,r,l,h,u,d,p,c,g,v;const _=i.Type.isObject(this.title)?(t=this.title)==null?void 0:t.text:this.title;const m=i.Type.isObject(this.title)?(o=this.title)==null?void 0:o.size:"";const N=i.Tag.render(a||(a=n`
				<div class="ui-qr-authorization__popup-wrapper">
					<div class="ui-qr-authorization__popup-top ${0}">
						<div class="ui-qr-authorization__popup-left ${0}">
							${0}
							${0}
						</div>
						<div class="ui-qr-authorization__popup-right ${0}" data-role="ui-qr-authorization__qr-node"></div>
					</div>
					${0}
					${0}
				</div>
			`),this.content?"":"--direction-column",_?"":"--flex",_?`<div class="ui-qr-authorization__popup-title --${m}">${_}</div>`:"",this.content?`<div class="ui-qr-authorization__popup-text">${this.content}</div>`:"",this.title?"":"--no-margin",this.renderFishingWarning(),this.renderBottom());const q=this.content?710:405;const b={className:(s=(r=this.popupParam)==null?void 0:r.className)!=null?s:"ui-qr-authorization__popup ui-qr-authorization__popup-scope",width:(l=(h=this.popupParam)==null?void 0:h.width)!=null?l:q,content:N,closeByEsc:(u=this.popupParam)!=null&&u.closeByEsc?(d=this.popupParam)==null?void 0:d.className:true,overlay:(p=(c=this.popupParam)==null?void 0:c.overlay)!=null?p:false,autoHide:(g=(v=this.popupParam)==null?void 0:v.autoHide)!=null?g:true,closeIcon:{top:"14px",right:"15px"},events:{onPopupShow:()=>{this.createQrCodeImage();this.ttlInterval=setInterval((()=>{this.createQrCodeImage()}),this.ttl*1e3);const t=this.getPopup().getContentContainer().querySelector('[data-role="ui-qr-authorization__qr-node"]');if(t){i.Dom.append(this.getQrNode(),t)}},onPopupClose:()=>{clearInterval(this.ttlInterval)}},padding:0,animation:"fading-slide"};this.popup=new e.Popup(b)}return this.popup}renderFishingWarning(){if(!this.showFishingWarning){return""}return i.Tag.render(l||(l=n`
			<div class="ui-qr-authorization__popup-warning">
				<div class="ui-icon-set --shield-2-attention"></div>
				${0}
			</div>
		`),i.Loc.getMessage("UI_QR_AUTHORIZE_DONT_SHARE_QR_WARNING"))}renderBottom(){var t,e;if(!this.showBottom){return""}const o=i.Type.isObject(this.bottomText)?(t=this.bottomText)==null?void 0:t.text:this.bottomText;const s=i.Type.isObject(this.bottomText)?(e=this.bottomText)==null?void 0:e.size:"";return i.Tag.render(h||(h=n`
			<div class="ui-qr-authorization__popup-bottom">
				<div class="ui-qr-authorization__popup-bottom--title ${0}">
					${0}
				</div>
				${0}
			</div>
		`),s?"--"+s:"",o,this.renderHelpLink())}renderHelpLink(){if(this.helpCode){const t=t=>{t.preventDefault();top.BX.Helper.show(`redirect=detail&code=${this.helpCode}`)};return i.Tag.render(u||(u=n`
				<a onclick="${0}" class="ui-qr-authorization__popup-bottom--link">
					${0}
				</a onc>
			`),t,i.Loc.getMessage("UI_QR_AUTHORIZE_HELP"))}if(this.helpLink){return i.Tag.render(d||(d=n`
				<a href="${0}" class="ui-qr-authorization__popup-bottom--link">
					${0}
				</a>
			`),this.helpLink,i.Loc.getMessage("UI_QR_AUTHORIZE_HELP"))}return""}success(){this.clean();i.Dom.addClass(this.getQrNode(),"--success");i.Dom.append(this.getSuccessNode(),this.getQrNode())}getSuccessNode(){if(!this.successNode){this.successNode=i.Tag.render(p||(p=n`
				<div class="ui-qr-authorization__popup-qr-success"></div>
			`))}return this.successNode}loading(){this.clean();i.Dom.addClass(this.getQrNode(),"--loading");i.Dom.append(this.getLoadingNode(),this.getQrNode());this.showLoader()}getLoadingNode(){if(!this.loadingNode){this.loadingNode=i.Tag.render(c||(c=n`
				<div class="ui-qr-authorization__popup-qr-loading"></div>
			`))}return this.loadingNode}getLoader(){if(!this.loader){this.loader=new o.Loader({target:this.getLoadingNode(),size:150})}return this.loader}showLoader(){void this.getLoader().show()}hideLoader(){void this.getLoader().hide()}clean(){i.Dom.removeClass(this.getQrNode(),["--loading","--success"]);i.Dom.remove(this.getLoadingNode());i.Dom.remove(this.getSuccessNode());i.Dom.clean(this.getQrNode());this.hideLoader()}show(){if(!this.getPopup().isShown()){this.loading();this.getPopup().show()}}close(){if(this.getPopup().isShown()){this.clean();this.getPopup().close()}}}t.QrAuthorization=g})(this.BX.UI=this.BX.UI||{},BX,BX.Main,BX,BX);
//# sourceMappingURL=qrauthorization.bundle.map.js