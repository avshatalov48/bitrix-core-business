{"version":3,"file":"address_widget.bundle.js","sources":["../src/view/baseview.js","../src/view/editentry.js","../src/view/edit.js","../src/view/view.js","../src/address_widget.js"],"sourcesContent":["export class BaseView\n{\n\t#wrapper: ?Element = null;\n\n\tconstructor(params: Object) {\n\t\tthis.#wrapper = params.wrapper;\n\t}\n\n\tgetWrapper(): Element\n\t{\n\t\treturn this.#wrapper;\n\t}\n\n\tlayout(): Element\n\t{\n\t\tthrow new Error('please implement the layout() method');\n\t}\n}\n","import { Address as AddressEntity, AddressStringConverter, AddressType, ControlMode, Format } from 'location.core';\nimport { Address as AddressWidget, AutocompleteFeature, Factory, State } from 'location.widget';\nimport { Dom, Event, Loc, Tag, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport type { EditEntryProps } from './editentryprops';\n\nexport class EditEntry extends EventEmitter\n{\n\t#widget: AddressWidget;\n\t#nodes: { name: string, node: Element } = {};\n\t#wrapper: Element;\n\t#address: AddressEntity = null;\n\t#fieldName: string;\n\t#fieldFormName: string;\n\t#showMap: boolean = true;\n\t#enableRemoveButton: boolean = false;\n\t#isCompactMode: boolean = false;\n\t#initialAddressId: ?number = null;\n\t#areDetailsShown: boolean = false;\n\t#isLoading: boolean = false;\n\t#isDropdownLoading: boolean = false;\n\t#isDestroyed: boolean = false;\n\t#showDetailsToggle: boolean = true;\n\n\tstatic onRemoveInputButtonClickedEvent = 'onRemoveInputButtonClicked';\n\n\tconstructor(props: EditEntryProps)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('Fileman.EditEntry');\n\t\tthis.#wrapper = props.wrapper;\n\t\tthis.#fieldName = props.fieldName;\n\t\tthis.#fieldFormName = props.fieldFormName;\n\t\tthis.#enableRemoveButton = props.enableRemoveButton;\n\t\tthis.#initialAddressId = props.initialAddressId;\n\t\tthis.#showMap = props.showMap;\n\t\tthis.#showDetailsToggle = Boolean(props.showDetailsToggle ?? true);\n\n\t\tif (props.address)\n\t\t{\n\t\t\tthis.#address = props.address;\n\t\t}\n\t\tif (props.isCompactMode)\n\t\t{\n\t\t\tthis.#isCompactMode = props.isCompactMode;\n\t\t}\n\t}\n\n\tlayout(): Element\n\t{\n\t\tconst factory = new Factory();\n\t\tthis.#widget = factory.createAddressWidget({\n\t\t\taddress: this.#address,\n\t\t\tmode: ControlMode.edit,\n\t\t\tpopupOptions: {\n\t\t\t\toffsetLeft: 14,\n\t\t\t},\n\t\t\tpopupBindOptions: {\n\t\t\t\tforceBindPosition: true,\n\t\t\t\tposition: 'right',\n\t\t\t},\n\t\t\tmapBehavior: 'auto',\n\t\t\tuseFeatures: {\n\t\t\t\tfields: true,\n\t\t\t\tmap: this.#showMap,\n\t\t\t\tautocomplete: true,\n\t\t\t},\n\t\t});\n\n\t\tthis.#nodes.userInput = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" />`;\n\n\t\tthis.#nodes.fieldsContainer = Tag.render`<div class=\"location-fields-control-block\"></div>`;\n\n\t\tif (this.#showDetailsToggle)\n\t\t{\n\t\t\tthis.#nodes.detailsToggle = Tag.render`<span class=\"ui-link ui-link-secondary address-control-mode-switch\">${Loc.getMessage(\n\t\t\t\t'ADDRESS_USERFIELD_DETAILS')}</span>`;\n\t\t\tEvent.bind(this.#nodes.detailsToggle, 'click', this.onDetailsToggleClick.bind(this));\n\t\t}\n\n\t\tlet inputValue = this.getInitialAddressFieldValue();\n\t\tthis.#nodes.fieldValueInput = Tag.render`<input type=\"hidden\" name=\"${this.#fieldFormName}\" value=\"${inputValue}\" />`;\n\n\t\tthis.#nodes.inputIcon = Tag.render`<button type=\"button\" class=\"ui-ctl-after ui-ctl-icon-clear\"></button>`;\n\t\tEvent.bind(this.#nodes.inputIcon, 'click', this.onInputIconClick.bind(this));\n\n\t\tthis.#widget.subscribeOnAddressChangedEvent(this.onAddressChanged.bind(this));\n\t\tthis.#widget.subscribeOnStateChangedEvent(this.onWidgetStateChangedEvent.bind(this));\n\t\tthis.#widget.subscribeOnFeatureEvent(this.onFeatureEvent.bind(this));\n\n\t\tthis.#nodes.entryWrapper = Tag.render`\n\t\t\t<div class=\"edit-entry-input-wrapper\">\n\t\t\t\t<div class=\"fields address field-item edit ui-ctl ui-ctl-after-icon ${this.getUserInputSizeClass()}\">\n\t\t\t\t\t${this.#nodes.userInput}\n\t\t\t\t\t${this.#nodes.fieldsContainer}\n\t\t\t\t\t${this.#nodes.inputIcon}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\t// a workaround for bizproc conditionals; their conditionals popup seems to use the topmost <input>'s value\n\t\tconst hiddenFormattedInputValue = this.#address ? this.getRawValueForHiddenFormattedInput(this.#address) : '';\n\t\tthis.#nodes.hiddenFormattedAddressInput = Tag.render`<input type=\"hidden\" name=\"${this.#fieldName}_formatted\" value=\"${hiddenFormattedInputValue}\" />`;\n\n\t\t// a flag used to identify values set manually by the user\n\t\tconst manualEditFlagNode = Tag.render`<input type=\"hidden\" name=\"${this.#fieldName}_manual_edit\" value=\"Y\">`;\n\n\t\tthis.#nodes.layout = Tag.render`\n\t\t\t<div class=\"edit-entry-layout-wrapper ${this.getLayoutSizeClass()}\">\n\t\t\t\t${this.#getAddressControlSwitchContainer()}\n\t\t\t\t${this.#nodes.hiddenFormattedAddressInput}\n\t\t\t\t${this.#nodes.entryWrapper}\n\t\t\t\t${manualEditFlagNode}\n\t\t\t</div>\n\t\t`;\n\n\t\tif (this.#enableRemoveButton)\n\t\t{\n\t\t\tDom.append(this.getRemoveInputButton(this.#nodes.layout), this.#nodes.entryWrapper);\n\t\t}\n\n\t\tDom.append(this.#nodes.fieldValueInput, this.#nodes.layout);\n\n\t\tthis.#widget.render({\n\t\t\tinputNode: this.#nodes.userInput,\n\t\t\tmapBindElement: this.#wrapper,\n\t\t\tcontrolWrapper: this.#nodes.layout,\n\t\t\tfieldsContainer: this.#nodes.fieldsContainer,\n\t\t});\n\n\t\treturn this.#nodes.layout;\n\t}\n\n\t#getAddressControlSwitchContainer(): ?HTMLElement\n\t{\n\t\tif (!this.#showDetailsToggle)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"address-control-mode-switch-wrapper\">\n\t\t\t\t${this.#nodes.detailsToggle}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetUserInputSizeClass(): string\n\t{\n\t\treturn this.#isCompactMode ? 'ui-ctl-wd' : 'ui-ctl-w100';\n\t}\n\n\tgetLayoutSizeClass(): string\n\t{\n\t\treturn this.#isCompactMode ? 'compact' : '';\n\t}\n\n\tgetRemoveInputButton(layout: Element)\n\t{\n\t\tconst removeInputButton = Tag.render`\n\t\t\t<span class=\"uf-address-search-input-remove\"></span>\n\t\t`;\n\n\t\tEvent.bind(removeInputButton, 'click', (event) => {\n\t\t\tthis.emit(EditEntry.onRemoveInputButtonClickedEvent);\n\t\t});\n\n\t\treturn removeInputButton;\n\t}\n\n\tdestroy()\n\t{\n\t\tif (!this.#nodes.layout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#widget)\n\t\t{\n\t\t\tthis.#widget.destroy();\n\t\t}\n\n\t\tif (this.#address && this.#address.id > 0)\n\t\t{\n\t\t\tDom.clean(this.#nodes.layout);\n\t\t\tconst input = Tag.render`<input type=\"hidden\" name=\"${this.#fieldFormName}\" value=\"${this.#address.id}_del\" />`;\n\t\t\tDom.append(input, this.#nodes.layout);\n\t\t\tthis.emitFieldChangedEvent();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.remove(this.#nodes.layout);\n\t\t}\n\n\t\tthis.#isDestroyed = true;\n\t}\n\n\tisDestroyed(): boolean\n\t{\n\t\treturn this.#isDestroyed;\n\t}\n\n\tonAddressChanged(event)\n\t{\n\t\tconst initialAddressId = parseInt(this.#initialAddressId);\n\t\t/** @type {AddressEntity} */\n\t\tconst address = event.data.address;\n\t\tif (!address)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// when we clear the input, the address' id becomes 0, and because of it a new address is created upon\n\t\t// saving. we can set the address's id to the old id to edit the old address instead\n\t\tif (initialAddressId && parseInt(address.id) !== initialAddressId)\n\t\t{\n\t\t\taddress.id = initialAddressId;\n\t\t}\n\n\t\tthis.#nodes.fieldValueInput.value = this.getChangedAddressFieldValue(address);\n\n\t\tthis.#nodes.hiddenFormattedAddressInput.value = this.getRawValueForHiddenFormattedInput(address);\n\n\t\tthis.emitFieldChangedEvent();\n\t}\n\n\tonWidgetStateChangedEvent(event)\n\t{\n\t\tconst state = event.data.state;\n\t\tthis.#isLoading = (state === State.DATA_LOADING);\n\n\t\tthis.refreshInputIcon();\n\t}\n\n\tonFeatureEvent(event)\n\t{\n\t\tif (event.data.feature instanceof AutocompleteFeature)\n\t\t{\n\t\t\tthis.#isDropdownLoading = (event.data.eventCode === AutocompleteFeature.searchStartedEvent);\n\n\t\t\tthis.refreshInputIcon();\n\t\t}\n\t}\n\n\tisInputLoading(): boolean\n\t{\n\t\treturn this.#isLoading || this.#isDropdownLoading;\n\t}\n\n\trefreshInputIcon()\n\t{\n\t\tif (!this.#nodes.inputIcon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isInputLoading())\n\t\t{\n\t\t\tDom.removeClass(this.#nodes.inputIcon, 'ui-ctl-icon-clear');\n\t\t\tDom.addClass(this.#nodes.inputIcon, 'ui-ctl-icon-loader');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.#nodes.inputIcon, 'ui-ctl-icon-loader');\n\t\t\tDom.addClass(this.#nodes.inputIcon, 'ui-ctl-icon-clear');\n\t\t}\n\t}\n\n\tgetInitialAddressFieldValue(): string\n\t{\n\t\tlet inputValue =  '';\n\n\t\tif (this.#address?.id == 0)\n\t\t{\n\t\t\tif (this.#address.location)\n\t\t\t{\n\t\t\t\t// JSON has probably been passed as the component's value; we need to create a new address\n\t\t\t\tinputValue = Text.encode(this.#address.toJson());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// for compatibility with the format used before the switch to location module's addresses\n\t\t\t\tinputValue = `${this.#address.getFieldValue(AddressType.ADDRESS_LINE_2)}|${this.#address.latitude};${this.#address.longitude}`;\n\t\t\t}\n\t\t}\n\t\telse if (this.#address?.id > 0)\n\t\t{\n\t\t\tinputValue = `${this.getFormattedAddress(this.#address)}|${this.#address.latitude};${this.#address.longitude}|${this.#address.id}`;\n\t\t}\n\n\t\treturn inputValue;\n\t}\n\n\tgetChangedAddressFieldValue(address: AddressEntity): string\n\t{\n\t\treturn address.toJson();\n\t}\n\n\tgetFormattedAddress(address: AddressEntity): string\n\t{\n\t\tconst format = new Format(JSON.parse(BX.message('LOCATION_WIDGET_DEFAULT_FORMAT')));\n\t\treturn address.toString(format, AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA) ?? '';\n\t}\n\n\tgetRawValueForHiddenFormattedInput(address: AddressEntity): string\n\t{\n\t\tconst formattedAddress = this.getFormattedAddress(address);\n\t\tif (\n\t\t\t(parseInt(address.latitude) !== 0 || parseInt(address.longitude) !== 0)\n\t\t\t&& (address.latitude !== '' && address.longitude !== '')\n\t\t)\n\t\t{\n\t\t\treturn `${formattedAddress}|${address.latitude};${address.longitude}`;\n\t\t}\n\t\treturn formattedAddress;\n\t}\n\n\tonInputIconClick()\n\t{\n\t\tif (this.isInputLoading())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#nodes.userInput.focus();\n\n\t\tthis.#widget.resetView();\n\t\tthis.#widget.address = null;\n\n\t\tif (this.#address && this.#address.id > 0)\n\t\t{\n\t\t\tthis.#nodes.fieldValueInput.value = this.#address.id + '_del';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#nodes.fieldValueInput.value = '';\n\t\t}\n\n\t\tthis.emitFieldChangedEvent();\n\t}\n\n\tonDetailsToggleClick()\n\t{\n\t\tif (!this.#nodes.fieldsContainer || !this.#nodes.detailsToggle)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldsContainer = this.#nodes.fieldsContainer;\n\t\tconst detailsToggle = this.#nodes.detailsToggle;\n\t\tif (this.#areDetailsShown && Dom.hasClass(fieldsContainer, 'visible'))\n\t\t{\n\t\t\tDom.removeClass(fieldsContainer, 'visible');\n\t\t\tdetailsToggle.innerText = Loc.getMessage('ADDRESS_USERFIELD_DETAILS');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(fieldsContainer, 'visible');\n\t\t\tdetailsToggle.innerText = Loc.getMessage('ADDRESS_USERFIELD_NO_DETAILS');\n\t\t}\n\n\t\tthis.#areDetailsShown = !this.#areDetailsShown;\n\t}\n\n\temitFieldChangedEvent()\n\t{\n\t\tBX.onCustomEvent(window, 'onUIEntityEditorUserFieldExternalChanged', [this.#fieldName]);\n\t\tBX.onCustomEvent(window, 'onCrmEntityEditorUserFieldExternalChanged', [this.#fieldName]);\n\t}\n}\n","import { Address as AddressEntity } from 'location.core';\nimport { Dom, Event, Loc, Tag } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { BaseView } from './baseview';\n\nimport './css/style.css';\nimport { EditEntry } from './editentry';\n\nexport class Edit extends BaseView\n{\n\t#fieldName = '';\n\t#fieldFormName = '';\n\t#addresses: AddressEntity[] = [];\n\t#inputsWrapper: Element = null;\n\t#isMultiple = false;\n\t#isCompactMode = false;\n\t#showMap = true;\n\t#showDetailsToggle: boolean = false;\n\t#inputs: EditEntry[] = [];\n\n\tconstructor(params: Object)\n\t{\n\t\tsuper(params);\n\t\tthis.#fieldName = params.fieldName;\n\t\tthis.#fieldFormName = params.fieldFormName;\n\t\tthis.#addresses = params.addresses;\n\t\tthis.#isMultiple = params.isMultiple;\n\t\tthis.#isCompactMode = params.compactMode;\n\t\tthis.#showMap = params.showMap;\n\t\tthis.#showDetailsToggle = Boolean(params.showDetailsToggle ?? false);\n\t}\n\n\tlayout(): Element\n\t{\n\t\tconst layout = Tag.render`<div class=\"address-edit-wrapper\"></div>`;\n\n\t\tconst inputsWrapper = Tag.render`<div class=\"address-inputs-wrapper\"></div>`;\n\n\t\tif (this.#addresses.length > 0)\n\t\t{\n\t\t\tthis.#addresses.forEach((address) => {\n\t\t\t\tconst input = this.createInputForAddress(address);\n\t\t\t\tDom.append(input.layout(), inputsWrapper);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst input = this.createInputForAddress();\n\t\t\tDom.append(input.layout(), inputsWrapper);\n\t\t}\n\n\t\tDom.append(inputsWrapper, layout);\n\t\tthis.#inputsWrapper = inputsWrapper;\n\n\t\tif (this.#isMultiple)\n\t\t{\n\t\t\tconst addInputElement = Tag.render`<input type=\"button\" value=\"${Loc.getMessage('ADDRESS_USERFIELD_ADD_INPUT')}\" />`;\n\t\t\tEvent.bind(addInputElement, 'click', this.addInput.bind(this));\n\t\t\tDom.append(addInputElement, layout);\n\t\t}\n\n\t\tDom.append(layout, this.getWrapper());\n\n\t\treturn this.getWrapper();\n\t}\n\n\taddInput()\n\t{\n\t\tif (!this.#inputsWrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst input = this.createInputForAddress();\n\t\tDom.append(input.layout(), this.#inputsWrapper);\n\t}\n\n\tcreateInputForAddress(address: AddressEntity): EditEntry\n\t{\n\t\tconst entry = new EditEntry({\n\t\t\twrapper: this.getWrapper(),\n\t\t\taddress: address,\n\t\t\tfieldName: this.#fieldName,\n\t\t\tfieldFormName: this.#fieldFormName,\n\t\t\tenableRemoveButton: this.#isMultiple,\n\t\t\tinitialAddressId: parseInt(address?.id) ?? null,\n\t\t\tisCompactMode: this.#isCompactMode,\n\t\t\tshowMap: this.#showMap,\n\t\t\tshowDetailsToggle: this.#showDetailsToggle,\n\t\t});\n\t\tEventEmitter.subscribe(entry, EditEntry.onRemoveInputButtonClickedEvent, this.removeInput.bind(this, entry));\n\t\tthis.#inputs.push(entry);\n\n\t\treturn entry;\n\t}\n\n\tremoveInput(input: EditEntry)\n\t{\n\t\tconst activeInputsCount = this.#inputs.filter((input) => {return !input.isDestroyed()}).length;\n\n\t\tif (activeInputsCount > 1)\n\t\t{\n\t\t\tinput.destroy();\n\t\t}\n\t}\n}\n","import { Address as AddressEntity, AddressStringConverter, ControlMode, Format } from 'location.core';\nimport { Address as AddressWidget, Factory } from 'location.widget';\nimport { Dom, Tag } from 'main.core';\nimport 'ui.design-tokens';\nimport { BaseView } from './baseview';\nimport './css/style.css';\n\nexport class View extends BaseView\n{\n\t#addresses: AddressEntity[] = [];\n\n\t#widgets: AddressWidget[] = [];\n\n\tconstructor(params: Object)\n\t{\n\t\tsuper(params);\n\t\tthis.#addresses = params.addresses;\n\t}\n\n\tdestroyWidgets()\n\t{\n\t\tthis.#widgets.forEach((widget) => {\n\t\t\twidget.destroy();\n\t\t});\n\t}\n\n\tlayout(): Element\n\t{\n\t\tconst layout = new DocumentFragment();\n\n\t\tthis.#addresses.forEach((address) => {\n\t\t\tlayout.append(this.getLayoutForAddress(address));\n\t\t});\n\n\t\tDom.append(layout, this.getWrapper());\n\n\t\treturn this.getWrapper();\n\t}\n\n\tgetLayoutForAddress(address: AddressEntity)\n\t{\n\t\tconst factory = new Factory();\n\t\tconst widget = factory.createAddressWidget({\n\t\t\taddress: address,\n\t\t\tmode: ControlMode.view,\n\t\t\tpopupOptions: {\n\t\t\t\toffsetLeft: 14,\n\t\t\t},\n\t\t\tpopupBindOptions: {\n\t\t\t\tforceBindPosition: true,\n\t\t\t\tposition: 'right',\n\t\t\t},\n\t\t\tmapBehavior: 'auto',\n\t\t\tuseFeatures: {\n\t\t\t\tfields: false,\n\t\t\t\tmap: true,\n\t\t\t\tautocomplete: false,\n\t\t\t}\n\t\t});\n\n\t\tthis.#widgets.push(widget);\n\n\t\tconst addressLayout = Tag.render`\n\t\t\t<span class=\"fields address field-item view\" data-id=\"${address.id}\">\n\t\t\t\t<span class=\"ui-link ui-link-dark ui-link-dotted\">${this.getFormattedAddress(address)}</span>\n\t\t\t</span>\n\t\t`;\n\n\t\twidget.render({\n\t\t\tmapBindElement: addressLayout,\n\t\t\tcontrolWrapper: addressLayout,\n\t\t});\n\n\t\treturn addressLayout;\n\t}\n\n\tgetFormattedAddress(address: AddressEntity): string\n\t{\n\t\tconst format = new Format(JSON.parse(BX.message('LOCATION_WIDGET_DEFAULT_FORMAT')));\n\t\treturn address.toString(format, AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA) ?? '';\n\t}\n}\n","import { Address as AddressEntity } from 'location.core';\nimport { Reflection, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Edit } from './view/edit';\n\nimport { View } from './view/view';\n\nclass AddressField\n{\n\tstatic VIEW_MODE = 'view';\n\tstatic EDIT_MODE = 'edit';\n\n\t#mode = AddressField.VIEW_MODE;\n\t#wrapper: Element;\n\t#addresses: [];\n\t#isMultiple: boolean = false;\n\t#showMap: boolean = true;\n\t#showDetailsToggle: boolean = true;\n\n\t#fieldConfig = {};\n\t#additionalProperties = {};\n\n\tstatic init(params: Object)\n\t{\n\t\tconst mode = params.mode;\n\t\tconst wrapper = document.getElementById(params.wrapperId);\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet addresses = [];\n\t\tconst addressData = params.addressData;\n\t\taddressData.forEach((addressFields) => {\n\t\t\tif (Type.isObject(addressFields))\n\t\t\t{\n\t\t\t\taddresses.push(new AddressEntity(addressFields));\n\t\t\t}\n\t\t});\n\n\t\tconst showMap = params.showMap ?? true;\n\t\tconst showDetailsToggle = Boolean(params.showDetailsToggle ?? true);\n\t\tconst addressFieldParams = {\n\t\t\taddresses: addresses,\n\t\t\twrapper: wrapper,\n\t\t\tmode: mode,\n\t\t\tfieldConfig: {\n\t\t\t\tfieldName: params.fieldName,\n\t\t\t\tfieldFormName: params.fieldFormName,\n\t\t\t},\n\t\t\tisMultiple: params.isMultiple,\n\t\t\tshowMap,\n\t\t\tshowDetailsToggle,\n\t\t};\n\n\t\tif (params.additionalProperties)\n\t\t{\n\t\t\taddressFieldParams.additionalProperties = params.additionalProperties;\n\t\t}\n\n\t\tconst addressField = new AddressField(addressFieldParams);\n\t\taddressField.layout();\n\n\t\tEventEmitter.emit(this, 'BX.Fileman.UserField.AddressField:onInitiated', addressFieldParams);\n\t}\n\n\tconstructor(params: Object)\n\t{\n\t\tthis.#mode = params.mode;\n\t\tthis.#wrapper = params.wrapper;\n\t\tthis.#addresses = params.addresses;\n\t\tthis.#fieldConfig = params.fieldConfig;\n\t\tthis.#isMultiple = params.isMultiple;\n\t\tthis.#showMap = params.showMap;\n\t\tthis.#showDetailsToggle = Boolean(params.showDetailsToggle ?? true);\n\t\tif (params.additionalProperties)\n\t\t{\n\t\t\tthis.#additionalProperties = params.additionalProperties;\n\t\t}\n\t}\n\n\tlayout()\n\t{\n\t\t/** @type BaseView */\n\t\tlet view = null;\n\n\t\tif (this.#mode === AddressField.VIEW_MODE)\n\t\t{\n\t\t\tview = new View({\n\t\t\t\twrapper: this.#wrapper,\n\t\t\t\taddresses: this.#addresses,\n\t\t\t});\n\t\t}\n\n\t\tif (this.#mode === AddressField.EDIT_MODE)\n\t\t{\n\t\t\tview = new Edit({\n\t\t\t\twrapper: this.#wrapper,\n\t\t\t\tfieldName: this.#fieldConfig.fieldName,\n\t\t\t\tfieldFormName: this.#fieldConfig.fieldFormName,\n\t\t\t\taddresses: this.#addresses,\n\t\t\t\tisMultiple: this.#isMultiple,\n\t\t\t\tcompactMode: this.#additionalProperties.compactMode ?? false,\n\t\t\t\tshowMap: this.#showMap,\n\t\t\t\tshowDetailsToggle: this.#showDetailsToggle,\n\t\t\t});\n\t\t}\n\n\t\tif (view)\n\t\t{\n\t\t\tview.layout()\n\t\t}\n\t}\n}\n\nconst namespace = Reflection.namespace('BX.Fileman.UserField');\nnamespace.AddressField = AddressField;\n"],"names":["BaseView","constructor","params","wrapper","getWrapper","layout","Error","EditEntry","EventEmitter","props","setEventNamespace","fieldName","fieldFormName","enableRemoveButton","initialAddressId","showMap","Boolean","showDetailsToggle","address","isCompactMode","factory","Factory","createAddressWidget","mode","ControlMode","edit","popupOptions","offsetLeft","popupBindOptions","forceBindPosition","position","mapBehavior","useFeatures","fields","map","autocomplete","userInput","Tag","render","fieldsContainer","detailsToggle","Loc","getMessage","Event","bind","onDetailsToggleClick","inputValue","getInitialAddressFieldValue","fieldValueInput","inputIcon","onInputIconClick","subscribeOnAddressChangedEvent","onAddressChanged","subscribeOnStateChangedEvent","onWidgetStateChangedEvent","subscribeOnFeatureEvent","onFeatureEvent","entryWrapper","getUserInputSizeClass","hiddenFormattedInputValue","getRawValueForHiddenFormattedInput","hiddenFormattedAddressInput","manualEditFlagNode","getLayoutSizeClass","Dom","append","getRemoveInputButton","inputNode","mapBindElement","controlWrapper","removeInputButton","event","emit","onRemoveInputButtonClickedEvent","destroy","id","clean","input","emitFieldChangedEvent","remove","isDestroyed","parseInt","data","value","getChangedAddressFieldValue","state","State","DATA_LOADING","refreshInputIcon","feature","AutocompleteFeature","eventCode","searchStartedEvent","isInputLoading","removeClass","addClass","location","Text","encode","toJson","getFieldValue","AddressType","ADDRESS_LINE_2","latitude","longitude","getFormattedAddress","format","Format","JSON","parse","BX","message","toString","AddressStringConverter","STRATEGY_TYPE_TEMPLATE_COMMA","formattedAddress","focus","resetView","hasClass","innerText","onCustomEvent","window","Edit","addresses","isMultiple","compactMode","inputsWrapper","length","forEach","createInputForAddress","addInputElement","addInput","entry","subscribe","removeInput","push","activeInputsCount","filter","View","destroyWidgets","widget","DocumentFragment","getLayoutForAddress","view","addressLayout","AddressField","init","document","getElementById","wrapperId","addressData","addressFields","Type","isObject","AddressEntity","addressFieldParams","fieldConfig","additionalProperties","addressField","VIEW_MODE","EDIT_MODE","namespace","Reflection"],"mappings":"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"}