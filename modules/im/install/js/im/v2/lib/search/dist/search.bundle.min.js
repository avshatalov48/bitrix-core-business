this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,r,i,l){"use strict";const o="im-recent-v2";const c="IM_CHAT_SEARCH";const n="im-chat-search";const d=e=>{const s={id:o,dynamicLoad:true,dynamicSearch:true,options:b(e)};return{dialog:{entities:[s],preselectedItems:[],clearUnavailableItems:false,context:c,id:n}}};const b=e=>{const t={withChatByUsers:false};if(!e){return{...t,exclude:[]}}const a=[];if(s.Type.isBoolean(e.chats)&&!e.chats){a.push("chats")}if(s.Type.isBoolean(e.users)&&!e.users){a.push("users")}return{...t,exclude:a}};var u=babelHelpers.classPrivateFieldLooseKey("store");var h=babelHelpers.classPrivateFieldLooseKey("userManager");var v=babelHelpers.classPrivateFieldLooseKey("updateChats");var p=babelHelpers.classPrivateFieldLooseKey("prepareDataForModels");class P{constructor(){Object.defineProperty(this,p,{value:f});Object.defineProperty(this,v,{value:g});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,u)[u]=r.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,h)[h]=new t.UserManager}update(e){const{users:s,chats:t}=babelHelpers.classPrivateFieldLooseBase(this,p)[p](e);return Promise.all([this.updateUsers(s),babelHelpers.classPrivateFieldLooseBase(this,v)[v](t)])}updateUsers(e){return babelHelpers.classPrivateFieldLooseBase(this,h)[h].setUsersToModel(e)}}function g(e){return babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("chats/set",e)}function f(e){const s={users:[],chats:[]};e.forEach((e=>{const t=e.customData;if(e.entityType===i.SearchEntityIdTypes.imUser){s.users.push(t)}if(e.entityType===i.SearchEntityIdTypes.chat){s.chats.push({...t,dialogId:e.id})}}));return s}const y=new Intl.Collator(undefined,{sensitivity:"base"});var L=babelHelpers.classPrivateFieldLooseKey("searchConfig");var F=babelHelpers.classPrivateFieldLooseKey("store");var B=babelHelpers.classPrivateFieldLooseKey("search");var H=babelHelpers.classPrivateFieldLooseKey("getRecentListItems");var m=babelHelpers.classPrivateFieldLooseKey("prepareRecentItem");var I=babelHelpers.classPrivateFieldLooseKey("searchByQueryWords");var M=babelHelpers.classPrivateFieldLooseKey("searchByDialogFields");var O=babelHelpers.classPrivateFieldLooseKey("searchByUserFields");var j=babelHelpers.classPrivateFieldLooseKey("doesItemMatchQuery");var K=babelHelpers.classPrivateFieldLooseKey("getLocalItems");var C=babelHelpers.classPrivateFieldLooseKey("getLocalItemsFromDialogIds");var S=babelHelpers.classPrivateFieldLooseKey("mergeItems");var w=babelHelpers.classPrivateFieldLooseKey("filterByConfig");var X=babelHelpers.classPrivateFieldLooseKey("getRecentItemDate");class U{constructor(e){Object.defineProperty(this,X,{value:q});Object.defineProperty(this,w,{value:_});Object.defineProperty(this,S,{value:V});Object.defineProperty(this,C,{value:Q});Object.defineProperty(this,K,{value:k});Object.defineProperty(this,j,{value:A});Object.defineProperty(this,O,{value:R});Object.defineProperty(this,M,{value:D});Object.defineProperty(this,I,{value:W});Object.defineProperty(this,m,{value:E});Object.defineProperty(this,H,{value:x});Object.defineProperty(this,B,{value:T});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e;babelHelpers.classPrivateFieldLooseBase(this,F)[F]=r.Core.getStore()}search(e,s){const t=babelHelpers.classPrivateFieldLooseBase(this,K)[K](s);const a=babelHelpers.classPrivateFieldLooseBase(this,B)[B](e,t);return babelHelpers.classPrivateFieldLooseBase(this,w)[w](a)}}function T(e,s){const t=l.Utils.text.getWordsFromString(e);const a=new Map;s.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,I)[I](e,t)){a.set(e.dialogId,{dialogId:e.dialogId,dateMessage:e.dateMessage})}}));return[...a.values()]}function x(){return babelHelpers.classPrivateFieldLooseBase(this,F)[F].getters["recent/getSortedCollection"].map((e=>{const s=babelHelpers.classPrivateFieldLooseBase(this,X)[X](e);return babelHelpers.classPrivateFieldLooseBase(this,m)[m](e.dialogId,s)}))}function E(e,s){const t=babelHelpers.classPrivateFieldLooseBase(this,F)[F].getters["chats/get"](e,true);const a=t.type===i.ChatType.user;const r={dialogId:e,dialog:t,dateMessage:s};if(a){r.user=babelHelpers.classPrivateFieldLooseBase(this,F)[F].getters["users/get"](e,true)}return r}function W(e,s){if(e.user){return babelHelpers.classPrivateFieldLooseBase(this,O)[O](e,s)}return babelHelpers.classPrivateFieldLooseBase(this,M)[M](e,s)}function D(e,s){const t=[];if(e.dialog.name){const s=l.Utils.text.getWordsFromString(e.dialog.name.toLowerCase());t.push(...s)}return babelHelpers.classPrivateFieldLooseBase(this,j)[j](t,s)}function R(e,s){const t=[];if(e.user.name){const s=l.Utils.text.getWordsFromString(e.user.name.toLowerCase());t.push(...s)}if(e.user.workPosition){const s=l.Utils.text.getWordsFromString(e.user.workPosition.toLowerCase());t.push(...s)}return babelHelpers.classPrivateFieldLooseBase(this,j)[j](t,s)}function A(e,s){let t=0;s.forEach((s=>{let a=0;e.forEach((e=>{const t=e.slice(0,s.length);if(y.compare(s,t)===0){a++}}));if(a>0){t++}}));return t>=s.length}function k(e){const s=babelHelpers.classPrivateFieldLooseBase(this,H)[H]();const t=babelHelpers.classPrivateFieldLooseBase(this,C)[C](e);return babelHelpers.classPrivateFieldLooseBase(this,S)[S](t,s)}function Q(e){return e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,m)[m](e.dialogId,e.dateMessage)))}function V(e,s){const t=new Map;const a=[...e,...s];for(const e of a){if(!t.has(e.dialogId)){t.set(e.dialogId,e)}}return[...t.values()]}function _(e){if(!babelHelpers.classPrivateFieldLooseBase(this,L)[L]){return e}return e.filter((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,L)[L].chats&&e.dialogId.startsWith("chat")){return true}return!e.dialogId.startsWith("chat")&&babelHelpers.classPrivateFieldLooseBase(this,L)[L].users}))}function q(e){var s;const t=(s=babelHelpers.classPrivateFieldLooseBase(this,F)[F].getters["recent/getMessage"](e.dialogId))==null?void 0:s.date;if(!t){return""}return t.toISOString()}e.getSearchConfig=d;e.EntityId=o;e.StoreUpdater=P;e.LocalSearch=U})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Messenger.v2.Lib,BX.Vue3.Vuex,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib);
//# sourceMappingURL=search.bundle.map.js