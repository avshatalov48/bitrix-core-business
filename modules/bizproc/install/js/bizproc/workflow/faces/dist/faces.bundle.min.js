this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,s,a,l){"use strict";function r(e){if(!l.Type.isPlainObject(e)){return false}if(!l.Type.isStringFilled(e.workflowId)){return false}if(!l.Type.isDomNode(e.target)){return false}if(!l.Type.isNil(e.targetUserId)&&(!l.Type.isInteger(e.targetUserId)||e.targetUserId<=0)){return false}return i(e.data)}function i(e){if(!l.Type.isPlainObject(e)){return false}if(!l.Type.isArrayFilled(e.steps)){return false}for(const s of e.steps){if(!l.Type.isStringFilled(s.id)||!l.Type.isString(s.name)||!l.Type.isArray(s.avatars)){return false}const e=s.duration;if(!l.Type.isString(e)&&(!l.Type.isNumber(e)||e<0)){return false}}return true}let t=e=>e,o,b,c;var d=babelHelpers.classPrivateFieldLooseKey("target");var p=babelHelpers.classPrivateFieldLooseKey("data");var n=babelHelpers.classPrivateFieldLooseKey("showArrow");var v=babelHelpers.classPrivateFieldLooseKey("showTimeStep");var u=babelHelpers.classPrivateFieldLooseKey("workflowId");var h=babelHelpers.classPrivateFieldLooseKey("targetUserId");var P=babelHelpers.classPrivateFieldLooseKey("stack");var f=babelHelpers.classPrivateFieldLooseKey("unsubscribePushCallback");var F=babelHelpers.classPrivateFieldLooseKey("node");var y=babelHelpers.classPrivateFieldLooseKey("timelineNode");var L=babelHelpers.classPrivateFieldLooseKey("errorNode");var B=babelHelpers.classPrivateFieldLooseKey("initStack");var H=babelHelpers.classPrivateFieldLooseKey("getStackSteps");var m=babelHelpers.classPrivateFieldLooseKey("createStep");var w=babelHelpers.classPrivateFieldLooseKey("getStack");var g=babelHelpers.classPrivateFieldLooseKey("getUserStack");var T=babelHelpers.classPrivateFieldLooseKey("getStackUserImages");var k=babelHelpers.classPrivateFieldLooseKey("getIconStack");var S=babelHelpers.classPrivateFieldLooseKey("getFooter");var O=babelHelpers.classPrivateFieldLooseKey("getStubStep");var j=babelHelpers.classPrivateFieldLooseKey("subscribeToPushes");var K=babelHelpers.classPrivateFieldLooseKey("onWorkflowPush");var I=babelHelpers.classPrivateFieldLooseKey("loadWorkflowFaces");var E=babelHelpers.classPrivateFieldLooseKey("getRunningTaskId");var D=babelHelpers.classPrivateFieldLooseKey("unsubscribeToPushes");var U=babelHelpers.classPrivateFieldLooseKey("renderTimeline");var A=babelHelpers.classPrivateFieldLooseKey("renderError");class x{constructor(e){Object.defineProperty(this,A,{value:Z});Object.defineProperty(this,U,{value:Y});Object.defineProperty(this,D,{value:V});Object.defineProperty(this,E,{value:Q});Object.defineProperty(this,I,{value:J});Object.defineProperty(this,K,{value:G});Object.defineProperty(this,j,{value:q});Object.defineProperty(this,O,{value:M});Object.defineProperty(this,S,{value:_});Object.defineProperty(this,k,{value:$});Object.defineProperty(this,T,{value:R});Object.defineProperty(this,g,{value:C});Object.defineProperty(this,w,{value:z});Object.defineProperty(this,m,{value:W});Object.defineProperty(this,H,{value:X});Object.defineProperty(this,B,{value:N});Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:{}});Object.defineProperty(this,n,{writable:true,value:false});Object.defineProperty(this,v,{writable:true,value:false});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:null});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});if(!r(e)){throw new TypeError("Bizproc.Workflow.Faces: data must be correct plain object")}babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e.workflowId;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e.target;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e.targetUserId||0;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e.data;if(l.Type.isBoolean(e.showArrow)){babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.showArrow}if(l.Type.isBoolean(e.showTimeStep)){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.showTimeStep}babelHelpers.classPrivateFieldLooseBase(this,B)[B]();if(e.subscribeToPushes&&!e.isWorkflowFinished){babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}}render(){if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=l.Tag.render(o||(o=t`<div class="bp-workflow-faces"></div>`));l.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,F)[F],babelHelpers.classPrivateFieldLooseBase(this,d)[d]);babelHelpers.classPrivateFieldLooseBase(this,P)[P].renderTo(babelHelpers.classPrivateFieldLooseBase(this,F)[F]);if(babelHelpers.classPrivateFieldLooseBase(this,n)[n]){l.Dom.append(l.Tag.render(b||(b=t`<div class="bp-workflow-faces-arrow"></div>`)),babelHelpers.classPrivateFieldLooseBase(this,F)[F])}if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]&&babelHelpers.classPrivateFieldLooseBase(this,p)[p].timeStep){l.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,U)[U](),babelHelpers.classPrivateFieldLooseBase(this,F)[F])}}updateData(e){const s={steps:e.steps,progressBox:e.progressBox,timeStep:e.timeStep};if(!i(s)){return}babelHelpers.classPrivateFieldLooseBase(this,p)[p]=s;babelHelpers.classPrivateFieldLooseBase(this,H)[H]().forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,P)[P].updateStep(e,e.id)}));if(e.isWorkflowFinished){babelHelpers.classPrivateFieldLooseBase(this,D)[D]();if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]){l.Dom.replace(babelHelpers.classPrivateFieldLooseBase(this,y)[y],babelHelpers.classPrivateFieldLooseBase(this,U)[U]())}}}destroy(){babelHelpers.classPrivateFieldLooseBase(this,D)[D]();babelHelpers.classPrivateFieldLooseBase(this,P)[P].destroy();babelHelpers.classPrivateFieldLooseBase(this,P)[P]=null;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=null;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=null;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=null;l.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,y)[y]);babelHelpers.classPrivateFieldLooseBase(this,y)[y]=null}}function N(){babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new a.ImageStackSteps({steps:babelHelpers.classPrivateFieldLooseBase(this,H)[H]()})}function X(){const e=[];babelHelpers.classPrivateFieldLooseBase(this,p)[p].steps.forEach((s=>{e.push(babelHelpers.classPrivateFieldLooseBase(this,m)[m](s))}));if(e.length<3){for(let s=e.length;s<3;s++){e.push(babelHelpers.classPrivateFieldLooseBase(this,O)[O]())}}if(babelHelpers.classPrivateFieldLooseBase(this,p)[p].progressBox&&babelHelpers.classPrivateFieldLooseBase(this,p)[p].progressBox.progressTasksCount>0){e[0].progressBox={title:babelHelpers.classPrivateFieldLooseBase(this,p)[p].progressBox.text}}return e.map(((e,s)=>({...e,id:`step-${s}`})))}function W(e){return{id:e.id,header:{type:a.headerTypeEnum.TEXT,data:{text:e.name}},stack:babelHelpers.classPrivateFieldLooseBase(this,w)[w](e),footer:babelHelpers.classPrivateFieldLooseBase(this,S)[S](e),styles:{minWidth:75}}}function z(e){const s=babelHelpers.classPrivateFieldLooseBase(this,g)[g](e);if(s){return s}return babelHelpers.classPrivateFieldLooseBase(this,k)[k](e)}function C(e){const s=babelHelpers.classPrivateFieldLooseBase(this,T)[T](e.avatarsData);if(l.Type.isArrayFilled(s)){const l={images:s};let r=null;switch(e.status){case"wait":r=a.stackStatusEnum.WAIT;break;case"success":r=a.stackStatusEnum.OK;break;case"not-success":r=a.stackStatusEnum.CANCEL;break;default:r=null}if(r){l.status={type:r}}return l}return null}function R(e){const s=[];if(l.Type.isArrayFilled(e)){e.forEach((e=>{const r=l.Text.toInteger(e.id);if(r>0){s.push({type:a.imageTypeEnum.USER,data:{userId:r,src:String(e.avatarUrl||"")}})}}))}return s}function $(e){let s=null;let l=null;switch(e.id){case"completed":s=e.success?"circle-check":"cross-circle-60";l=e.success?"var(--ui-color-primary-alt)":"var(--ui-color-base-35)";break;case"running":s="black-clock";l="var(--ui-color-palette-blue-60)";break;case"done":s="circle-check";l="var(--ui-color-primary-alt)";break;default:s="bp";l="var(--ui-color-palette-gray-20)"}return{images:[{type:a.imageTypeEnum.ICON,data:{icon:s,color:l}}]}}function _(e){if(l.Type.isNumber(e.duration)&&e.duration>0||e.id==="running"){return{type:a.footerTypeEnum.DURATION,data:{duration:l.Text.toInteger(e.duration),realtime:e.id==="running"}}}return{type:a.footerTypeEnum.TEXT,data:{text:String(e.duration)}}}function M(){return{id:"stub",header:{type:a.headerTypeEnum.STUB},stack:{images:[{type:a.imageTypeEnum.USER_STUB}]},footer:{type:a.footerTypeEnum.STUB},styles:{minWidth:75}}}function q(){if(BX.PULL){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=BX.PULL.subscribe({moduleId:"bizproc",command:"workflow",callback:babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this)})}}function G(e){if(e&&e.eventName==="UPDATED"&&l.Type.isArrayFilled(e.items)){for(const s of e.items){if(String(s.id)===babelHelpers.classPrivateFieldLooseBase(this,u)[u]){babelHelpers.classPrivateFieldLooseBase(this,I)[I]();return}}}}function J(){if(babelHelpers.classPrivateFieldLooseBase(this,d)[d]&&l.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,d)[d])&&babelHelpers.classPrivateFieldLooseBase(this,d)[d].clientHeight>0){l.ajax.runAction("bizproc.workflow.faces.load",{data:{workflowId:babelHelpers.classPrivateFieldLooseBase(this,u)[u],runningTaskId:babelHelpers.classPrivateFieldLooseBase(this,E)[E](),userId:babelHelpers.classPrivateFieldLooseBase(this,h)[h]}}).then((({data:e})=>{if(l.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,L)[L])){l.Dom.replace(babelHelpers.classPrivateFieldLooseBase(this,L)[L],babelHelpers.classPrivateFieldLooseBase(this,F)[F]);babelHelpers.classPrivateFieldLooseBase(this,L)[L]=null}this.updateData(e)})).catch((({errors:e})=>{if(l.Type.isArrayFilled(e)){const s=e.pop();if(s.code==="ACCESS_DENIED"){l.Dom.replace(babelHelpers.classPrivateFieldLooseBase(this,F)[F],babelHelpers.classPrivateFieldLooseBase(this,A)[A](s.message));this.errorMessage=s.message}}}))}}function Q(){const e=babelHelpers.classPrivateFieldLooseBase(this,p)[p].steps.find((e=>e.id==="running"));if(e){return e.taskId}return 0}function V(){if(l.Type.isFunction(babelHelpers.classPrivateFieldLooseBase(this,f)[f])){babelHelpers.classPrivateFieldLooseBase(this,f)[f]();babelHelpers.classPrivateFieldLooseBase(this,f)[f]=null}}function Y(){const e=new s.Summary({workflowId:babelHelpers.classPrivateFieldLooseBase(this,u)[u],data:babelHelpers.classPrivateFieldLooseBase(this,p)[p].timeStep});babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e.render();return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}function Z(e){babelHelpers.classPrivateFieldLooseBase(this,L)[L]=l.Tag.render(c||(c=t`
			<div class="bp-workflow-faces">
				<span class="bp-workflow-faces-error-message">
					${0}
				</span>
			</div>
		`),l.Text.encode(e));return babelHelpers.classPrivateFieldLooseBase(this,L)[L]}e.WorkflowFaces=x})(this.BX.Bizproc.Workflow=this.BX.Bizproc.Workflow||{},BX.Bizproc.Workflow.Faces,BX.UI,BX);
//# sourceMappingURL=faces.bundle.map.js