this.BX=this.BX||{};this.BX.Socialnetwork=this.BX.Socialnetwork||{};this.BX.Socialnetwork.UI=this.BX.Socialnetwork.UI||{};(function(t,e,n,s,r){"use strict";var i=function(){function t(e){babelHelpers.classCallCheck(this,t);this.grid=e.gridInstance;this.bindEvents();this.colorPinnedRows()}babelHelpers.createClass(t,[{key:"bindEvents",value:function t(){r.EventEmitter.subscribe("BX.Main.grid:paramsUpdated",this.onParamsUpdated.bind(this))}},{key:"onParamsUpdated",value:function t(){this.colorPinnedRows()}},{key:"colorPinnedRows",value:function e(){var n=this;this.getRows().forEach((function(e){var r=e.getNode();n.getIsPinned(e.getId())?s.Dom.addClass(r,t["class"].pinned):s.Dom.removeClass(r,t["class"].pinned)}))}},{key:"resetRows",value:function t(){this.grid.getRows().reset()}},{key:"getRows",value:function t(){return this.grid.getRows().getBodyChild()}},{key:"getLastPinnedRowId",value:function t(){var e=this;var n=Object.values(this.getRows()).filter((function(t){return e.getIsPinned(t.getId())}));var s=Object.keys(n);if(s.length>0){return n[s[s.length-1]].getId()}return 0}},{key:"getIsPinned",value:function t(e){return this.isRowExist(e)&&s.Type.isDomNode(this.getRowNodeById(e).querySelector(".main-grid-cell-content-action-pin.main-grid-cell-content-action-active"))}},{key:"getRowNodeById",value:function t(e){return this.getRowById(e).getNode()}},{key:"getRowById",value:function t(e){return this.grid.getRows().getById(e)}},{key:"isRowExist",value:function t(e){return this.getRowById(e)!==null}}]);return t}();babelHelpers.defineProperty(i,"class",{pinned:"sonet-ui-grid-row-pinned"});var a=function(){babelHelpers.createClass(t,null,[{key:"class",get:function t(){return{highlighted:"sonet-ui-grid-row-highlighted"}}}]);function t(e){babelHelpers.classCallCheck(this,t);this.grid=BX.Main.gridManager.getInstanceById(e.id);this.sort=e.sort;this.pageSize=parseInt(e.pageSize);this.stub=e.gridStub;this.items=new Map;this.fillItems(e.items);this.pinController=new i({gridInstance:this.getGrid()});this.init();this.bindEvents()}babelHelpers.createClass(t,[{key:"init",value:function t(){}},{key:"bindEvents",value:function t(){r.EventEmitter.subscribe("BX.Main.grid:sort",this.onColumnSort.bind(this))}},{key:"onColumnSort",value:function t(e){var n=e.getData();var s=n[1];var r=n[0];if(s===this.getGrid()){this.sort={};this.sort[r.sort_by]=r.sort_order}}},{key:"getGrid",value:function t(){return this.grid}},{key:"getPinController",value:function t(){return this.pinController}},{key:"getSort",value:function t(){return this.sort}},{key:"addRow",value:function t(e,n,i){var a={id:e,columns:n.columns,actions:n.actions,cellActions:n.cellActions};var o=i.moveParams||{};if(o.rowBefore){a.insertAfter=o.rowBefore}else if(o.rowAfter){a.insertBefore=o.rowAfter}else{a.append=true}if(this.items.size>this.getCurrentPage()*this.pageSize){var u=this.getLastRowId();this.removeItem(u);s.Dom.remove(this.getRowNodeById(u));this.showMoreButton()}this.hideStub();this.getRealtime().addRow(a);this.getPinController().colorPinnedRows();r.EventEmitter.emit("SocialNetwork.Projects.Grid:RowAdd",{id:e})}},{key:"updateRow",value:function t(e,n,r){var i=this;var a=this.getRowById(e);if(s.Type.isPlainObject(n)){if(!s.Type.isUndefined(n.columns)){a.setCellsContent(n.columns)}if(!s.Type.isUndefined(n.actions)){a.setActions(n.actions)}if(!s.Type.isUndefined(n.cellActions)){a.setCellActions(n.cellActions)}if(!s.Type.isUndefined(n.counters)){a.setCounters(n.counters)}}this.resetRows();this.moveRow(e,r.moveParams||{});this.highlightRow(e,r.highlightParams||{}).then((function(){return i.getPinController().colorPinnedRows()}),(function(){}));this.getGrid().bindOnRowEvents()}},{key:"resetRows",value:function t(){this.getRows().reset()}},{key:"removeRow",value:function t(e){if(!this.isRowExist(e)){return}this.removeItem(e);this.grid.removeRow(e)}},{key:"moveRow",value:function t(e,n){if(n.skip){return}var s=n.rowBefore||0;var r=n.rowAfter||0;if(s){this.getRows().insertAfter(e,s)}else if(r){this.getRows().insertBefore(e,r)}}},{key:"highlightRow",value:function e(n,r){var a=this;r=r||{};return new Promise((function(e,o){if(!a.isRowExist(n)){o();return}if(r.skip){e();return}var u=a.getRowNodeById(n);var l=s.Dom.hasClass(u,i["class"].pinned);if(l){s.Dom.removeClass(u,i["class"].pinned)}s.Dom.addClass(u,t["class"].highlighted);setTimeout((function(){s.Dom.removeClass(u,t["class"].highlighted);if(l){s.Dom.addClass(u,i["class"].pinned)}e()}),900)}))}},{key:"isRowExist",value:function t(e){return this.getRowById(e)!==null}},{key:"getRows",value:function t(){return this.getGrid().getRows()}},{key:"getRowById",value:function t(e){return this.getRows().getById(e)}},{key:"getRowNodeById",value:function t(e){return this.getRowById(e).getNode()}},{key:"getFirstRowId",value:function t(){var e=this.getRows().getBodyFirstChild();return e?this.getRowProperty(e,"id"):0}},{key:"getLastRowId",value:function t(){var e=this.getRows().getBodyLastChild();return e?this.getRowProperty(e,"id"):0}},{key:"getRowProperty",value:function t(e,n){return BX.data(e.getNode(),n)}},{key:"getCurrentPage",value:function t(){return this.getGrid().getCurrentPage()}},{key:"fillItems",value:function t(e){var n=this;Object.keys(e).forEach((function(t){return n.addItem(t)}))}},{key:"getItems",value:function t(){return Array.from(this.items.keys())}},{key:"hasItem",value:function t(e){return this.items.has(parseInt(e))}},{key:"addItem",value:function t(e){this.items.set(parseInt(e))}},{key:"removeItem",value:function t(e){this.items["delete"](parseInt(e))}},{key:"clearItems",value:function t(){this.items.clear()}},{key:"getRealtime",value:function t(){return this.getGrid().getRealtime()}},{key:"showStub",value:function t(){if(this.stub){this.getRealtime().showStub({content:this.stub})}}},{key:"hideStub",value:function t(){this.getGrid().hideEmptyStub()}},{key:"showMoreButton",value:function t(){this.getGrid().getMoreButton().getNode().style.display="inline-block"}},{key:"hideMoreButton",value:function t(){this.getGrid().getMoreButton().getNode().style.display="none"}}]);return t}();var o,u,l,p,c,d,g,h,m,f;var b=function(){function t(e){babelHelpers.classCallCheck(this,t);this.componentName=e.componentName;this.signedParameters=e.signedParameters}babelHelpers.createClass(t,[{key:"showPopup",value:function t(n,s,r){var i=this;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"all";if(this.isPopupShown){this.popup.destroy()}this.groupId=n;this.resetPopupData(s);this.changeType(a,false);this.popup=e.PopupWindowManager.create({id:"workgroup-grid-members-popup-menu",className:"sonet-ui-members-popup",bindElement:r,autoHide:true,closeByEsc:true,lightShadow:true,bindOptions:{position:"bottom"},animationOptions:{show:{type:"opacity-transform"},close:{type:"opacity"}},events:{onPopupDestroy:function t(){i.loader=null;i.isPopupShown=false},onPopupClose:function t(){i.popup.destroy()},onAfterPopupShow:function t(e){e.contentContainer.appendChild(i.renderContainer());i.showLoader();i.showUsers(n,a);i.isPopupShown=true}}});this.popupScroll(n,a);this.popup.show()}},{key:"renderContainer",value:function t(){return s.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="sonet-ui-members-popup-container">\n\t\t\t\t<span class="sonet-ui-members-popup-head">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t",'\n\t\t\t\t</span>\n\t\t\t\t<span class="sonet-ui-members-popup-body">\n\t\t\t\t\t<div class="sonet-ui-members-popup-content">\n\t\t\t\t\t\t<div class="sonet-ui-members-popup-content-box">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t"])),this.popupData.all.tab,this.popupData.heads.tab,this.popupData.members.tab,this.getCurrentPopupData().innerContainer)}},{key:"popupScroll",value:function t(e,n){var r=this;if(!s.Type.isDomNode(this.getCurrentPopupData().innerContainer)){return}s.Event.bind(this.getCurrentPopupData().innerContainer,"scroll",(function(t){var i=t.target;if(i.scrollTop>(i.scrollHeight-i.offsetHeight)/1.5){r.showUsers(e,n);s.Event.unbindAll(r.getCurrentPopupData().innerContainer)}}))}},{key:"showUsers",value:function t(e,n){var r=this;s.ajax.runAction("socialnetwork.api.workgroup.getGridPopupMembers",{data:{groupId:e,type:n,page:this.getCurrentPopupData().currentPage,componentName:this.componentName,signedParameters:this.signedParameters}}).then((function(t){if(r.groupId!==e||r.currentType!==n){r.hideLoader();return}if(t.data.length>0){r.renderUsers(t.data);r.popupScroll(e,r.currentType)}else if(!r.getCurrentPopupData().innerContainer.hasChildNodes()){r.getCurrentPopupData().innerContainer.innerText=s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_EMPTY")}r.getCurrentPopupData().currentPage++;r.hideLoader()}),(function(){return r.hideLoader()}))}},{key:"renderUsers",value:function t(e){var n=this;Object.values(e).forEach((function(t){if(n.getCurrentPopupData().renderedUsers.indexOf(t.ID)>=0){return}n.getCurrentPopupData().renderedUsers.push(t.ID);n.getCurrentPopupData().innerContainer.appendChild(s.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<a class="sonet-ui-members-popup-item" href="','" target="_blank">\n\t\t\t\t\t\t<span class="sonet-ui-members-popup-avatar-new">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t<span class="sonet-ui-members-popup-avatar-status-icon"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="sonet-ui-members-popup-name">',"</span>\n\t\t\t\t\t</a>\n\t\t\t\t"])),t["HREF"],n.getAvatar(t),t["FORMATTED_NAME"]))}))}},{key:"getAvatar",value:function t(e){if(s.Type.isStringFilled(e["PHOTO"])){return s.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-icon ui-icon-common-user sonet-ui-members-popup-avatar-img">\n\t\t\t\t\t<i style="background-image: url(\'',"')\"></i>\n\t\t\t\t</div>\n\t\t\t"])),encodeURI(e["PHOTO"]))}return s.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-icon ui-icon-common-user sonet-ui-members-popup-avatar-img"><i></i></div>\n\t\t'])))}},{key:"showLoader",value:function t(){if(!this.loader){this.loader=new n.Loader({target:this.popup.getPopupContainer().querySelector(".sonet-ui-members-popup-content"),size:40})}void this.loader.show()}},{key:"hideLoader",value:function t(){if(this.loader){void this.loader.hide();this.loader=null}}},{key:"changeType",value:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var r=this.currentType;this.currentType=e;Object.values(this.popupData).forEach((function(t){s.Dom.removeClass(t.tab,"sonet-ui-members-popup-head-item-current")}));s.Dom.addClass(this.getCurrentPopupData().tab,"sonet-ui-members-popup-head-item-current");if(r){s.Dom.replace(this.popupData[r].innerContainer,this.getCurrentPopupData().innerContainer)}if(n&&this.getCurrentPopupData().currentPage===1){this.showLoader();this.showUsers(this.groupId,e)}}},{key:"resetPopupData",value:function t(e){var n=s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_TITLE_HEADS");var r=s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_TITLE_MEMBERS");if(e==="project"){n=s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_TITLE_HEADS_PROJECT");r=s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_TITLE_MEMBERS_PROJECT")}this.popupData={all:{currentPage:1,renderedUsers:[],tab:s.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="sonet-ui-members-popup-head-item" onclick="','">\n\t\t\t\t\t\t<span class="sonet-ui-members-popup-head-text">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t"])),this.changeType.bind(this,"all"),s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_TITLE_ALL")),innerContainer:s.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['<div class="sonet-ui-members-popup-inner"></div>'])))},heads:{currentPage:1,renderedUsers:[],tab:s.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="sonet-ui-members-popup-head-item" onclick="','">\n\t\t\t\t\t\t<span class="sonet-ui-members-popup-head-text">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t"])),this.changeType.bind(this,"heads"),n),innerContainer:s.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<div class="sonet-ui-members-popup-inner"></div>'])))},members:{currentPage:1,renderedUsers:[],tab:s.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="sonet-ui-members-popup-head-item" onclick="','">\n\t\t\t\t\t\t<span class="sonet-ui-members-popup-head-text">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t"])),this.changeType.bind(this,"members"),r),innerContainer:s.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['<div class="sonet-ui-members-popup-inner"></div>'])))}}}},{key:"getCurrentPopupData",value:function t(){return this.popupData[this.currentType]}}]);return t}();var v,y,P,T,C,E,w,I,R,k,_;var D=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"renderContainer",value:function t(){return s.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="sonet-ui-members-popup-container">\n\t\t\t\t<span class="sonet-ui-members-popup-head">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t",'\n\t\t\t\t</span>\n\t\t\t\t<span class="sonet-ui-members-popup-body">\n\t\t\t\t\t<div class="sonet-ui-members-popup-content">\n\t\t\t\t\t\t<div class="sonet-ui-members-popup-content-box">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t"])),this.popupData.all.tab,this.popupData.scrumTeam.tab,this.popupData.members.tab,this.getCurrentPopupData().innerContainer)}},{key:"resetPopupData",value:function t(){this.popupData={all:{currentPage:1,renderedUsers:[],tab:s.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="sonet-ui-members-popup-head-item"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="sonet-ui-members-popup-head-text">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t"])),this.changeType.bind(this,"all"),s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_TITLE_ALL")),innerContainer:s.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['<div class="sonet-ui-members-popup-inner"></div>'])))},scrumTeam:{currentPage:1,renderedUsers:[],tab:s.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="sonet-ui-members-popup-head-item"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="sonet-ui-members-popup-head-text">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t"])),this.changeType.bind(this,"scrumTeam"),s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_TITLE_HEADS_SCRUM_1")),innerContainer:s.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['<div class="sonet-ui-members-popup-inner"></div>'])))},members:{currentPage:1,renderedUsers:[],tab:s.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="sonet-ui-members-popup-head-item"\n\t\t\t\t\t\tonclick="','"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="sonet-ui-members-popup-head-text">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t"])),this.changeType.bind(this,"members"),s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_TITLE_MEMBERS_SCRUM")),innerContainer:s.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['<div class="sonet-ui-members-popup-inner"></div>'])))}}}},{key:"renderUsers",value:function t(n){var r=this;if(this.currentType==="scrumTeam"){this.renderLabels(n);Object.values(n).forEach((function(t){if(r.getCurrentPopupData().renderedUsers.indexOf(t.ID)>=0&&t.ROLE!=="M"){return}r.getCurrentPopupData().renderedUsers.push(t.ID);var e=new Map;e.set("A","sonet-ui-scrum-members-popup-owner-container");e.set("M","sonet-ui-scrum-members-popup-master-container");e.set("E","sonet-ui-scrum-members-popup-team-container");if(s.Type.isUndefined(e.get(t.ROLE))){return}r.getCurrentPopupData().innerContainer.querySelector("."+e.get(t.ROLE)).appendChild(s.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\tclass="sonet-ui-members-popup-item"\n\t\t\t\t\t\t\t\thref="','"\n\t\t\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="sonet-ui-members-popup-avatar-new">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\tclass="sonet-ui-members-popup-avatar-status-icon"\n\t\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass="sonet-ui-scrum-members-popup-name"\n\t\t\t\t\t\t\t\t>',"</span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t"])),t["HREF"],r.getAvatar(t),t["FORMATTED_NAME"]))}))}else{babelHelpers.get(babelHelpers.getPrototypeOf(e.prototype),"renderUsers",this).call(this,n)}}},{key:"renderLabels",value:function t(e){var n=e.find((function(t){return t.ROLE==="A"}));var r=e.find((function(t){return t.ROLE==="M"}));var i=e.find((function(t){return t.ROLE==="E"}));if(n){if(s.Type.isNull(this.getCurrentPopupData().innerContainer.querySelector(".sonet-ui-scrum-members-popup-owner-container"))){this.getCurrentPopupData().innerContainer.appendChild(s.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="sonet-ui-scrum-members-popup-owner-container">\n\t\t\t\t\t\t<span class="sonet-ui-scrum-members-popup-label">\n\t\t\t\t\t\t\t<span class="sonet-ui-scrum-members-popup-label-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t"])),s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_LABEL_SCRUM_OWNER")))}}if(r){if(s.Type.isNull(this.getCurrentPopupData().innerContainer.querySelector(".sonet-ui-scrum-members-popup-master-container"))){this.getCurrentPopupData().innerContainer.appendChild(s.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="sonet-ui-scrum-members-popup-master-container">\n\t\t\t\t\t\t<span class="sonet-ui-scrum-members-popup-label">\n\t\t\t\t\t\t\t<span class="sonet-ui-scrum-members-popup-label-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t"])),s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_LABEL_SCRUM_MASTER")))}}if(i){if(s.Type.isNull(this.getCurrentPopupData().innerContainer.querySelector(".sonet-ui-scrum-members-popup-team-container"))){this.getCurrentPopupData().innerContainer.appendChild(s.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="sonet-ui-scrum-members-popup-team-container">\n\t\t\t\t\t\t<span class="sonet-ui-scrum-members-popup-label">\n\t\t\t\t\t\t\t<span class="sonet-ui-scrum-members-popup-label-text">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t"])),s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_POPUP_LABEL_SCRUM_TEAM")))}}}}]);return e}(b);var S=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"setOptions",value:function e(n){t.options=n}},{key:"setActionsPanel",value:function e(n){t.actionsPanel=n}},{key:"changePin",value:function e(n,r){var i=r.getData(),a=i.button;var o=s.Dom.hasClass(a,t["class"].active)?"unpin":"pin";s.ajax.runAction("socialnetwork.api.workgroup.changePin",{data:{groupIdList:[n],action:o,componentName:t.options.componentName,signedParameters:t.options.signedParameters}}).then((function(){if(o==="unpin"){s.Dom.removeClass(a,t["class"].active);s.Dom.addClass(a,t["class"].showByHover)}else{s.Dom.addClass(a,t["class"].active);s.Dom.removeClass(a,t["class"].showByHover)}}),(function(t){var e=s.Type.isStringFilled(t.message)?t.message:s.Loc.getMessage("SONET_EXT_UI_GRID_MEMBERS_ACTION_ERROR");BX.UI.Notification.Center.notify({content:e})}))}},{key:"getActionIds",value:function e(n){if(!s.Type.isUndefined(n.groupId)){return[n.groupId]}var r=t.getSelectedRows();if(r.length===0){return[]}return r.map((function(t){return t.getDataset().id}))}},{key:"hideActionsPanel",value:function e(){if(!t.actionsPanel){return}t.actionsPanel.hidePanel()}},{key:"getSelectedRows",value:function e(){return t.getGridInstance().getRows().getSelected()}},{key:"unselectRows",value:function e(){t.getGridInstance().getRows().unselectAll()}},{key:"getGridInstance",value:function e(){return t.options.gridInstance}}]);return t}();babelHelpers.defineProperty(S,"options",{});babelHelpers.defineProperty(S,"class",{active:"main-grid-cell-content-action-active",showByHover:"main-grid-cell-content-action-by-hover"});babelHelpers.defineProperty(S,"actionsPanel",null);var M=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"setOptions",value:function e(n){t.options=n}},{key:"onTagClick",value:function e(n){var s=t.options.filter;s.toggleByField(n)}},{key:"onTagAddClick",value:function e(n,r){s.Runtime.loadExtension("socialnetwork.entity-selector").then((function(e){var i=function e(s){var r=s.getTarget();var i=r.getSelectedItems().map((function(t){return t.getId()}));void t.update(n,i)};var a=e.Dialog,o=e.Footer;var u=new a({targetNode:r.getData().button,enableSearch:true,width:350,height:400,multiple:true,dropdownMode:true,compactView:true,context:"SONET_GROUP_TAG",entities:[{id:"project-tag",options:{groupId:n}}],searchOptions:{allowCreateItem:true,footerOptions:{label:s.Loc.getMessage("SOCNET_ENTITY_SELECTOR_TAG_FOOTER_LABEL")}},footer:o,footerOptions:{tagCreationLabel:true},events:{onShow:function t(){},onHide:function t(){},"Search:onItemCreateAsync":function t(e){return new Promise((function(t){var n=e.getData(),s=n.searchQuery;var r=s.getQuery().toLowerCase();var i=e.getTarget();setTimeout((function(){var e=i.addItem({id:r,entityId:"project-tag",title:r,tabs:"all"});if(e){e.select()}t()}),1e3)}))},"Item:onSelect":i,"Item:onDeselect":i}});u.show()}))}},{key:"update",value:function t(e,n){s.ajax.runAction("socialnetwork.api.workgroup.update",{data:{groupId:e,fields:{KEYWORDS:n.join(",")}}}).then((function(t){}),(function(t){}))["catch"]((function(t){}));S.hideActionsPanel();S.unselectRows()}}]);return t}();babelHelpers.defineProperty(M,"options",{});var B=function(){function t(e){babelHelpers.classCallCheck(this,t);this.filterInstance=BX.Main.filterManager.getById(e.filterId);if(!this.filterInstance){return}this.defaultFilterPresetId=e.defaultFilterPresetId;this.gridId=e.gridId;this.init();this.bindEvents()}babelHelpers.createClass(t,[{key:"init",value:function t(){this.fields=this.filterInstance.getFilterFieldsValues()}},{key:"bindEvents",value:function t(){r.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this))}},{key:"onFilterApply",value:function t(){this.updateFields()}},{key:"updateFields",value:function t(){this.fields=this.filterInstance.getFilterFieldsValues()}},{key:"toggleByField",value:function t(e){var n=this;var s=Object.keys(e)[0];var r=e[s];if(!this.isFilteredByFieldValue(s,r)){this.filterInstance.getApi().extendFilter(babelHelpers.defineProperty({},s,r));return}this.filterInstance.getFilterFields().forEach((function(t){if(t.getAttribute("data-name")===s){n.filterInstance.getFields().deleteField(t)}}));this.filterInstance.getSearch().apply()}},{key:"isFilteredByFieldValue",value:function t(e,n){return this.isFilteredByField(e)&&this.fields[e]===n}},{key:"isFilteredByField",value:function t(e){if(!Object.keys(this.fields).includes(e)){return false}if(s.Type.isArray(this.fields[e])){return this.fields[e].length>0}return this.fields[e]!==""}}]);return t}();var L=function(){babelHelpers.createClass(t,null,[{key:"getById",value:function e(n){return t.repo.get(n)}}]);function t(e){babelHelpers.classCallCheck(this,t);this.gridInstance=new a(e);this.membersPopup=new b(e);this.scrumMembersPopup=new D(e);t.repo.set(e.id,this)}babelHelpers.createClass(t,[{key:"getMembersPopup",value:function t(){return this.membersPopup}},{key:"getScrumMembersPopup",value:function t(){return this.scrumMembersPopup}},{key:"getInstance",value:function t(){return this.gridInstance}},{key:"getGrid",value:function t(){return this.getInstance().getGrid()}}]);return t}();babelHelpers.defineProperty(L,"repo",new Map);t.Controller=L;t.ActionController=S;t.TagController=M;t.Filter=B;t.PinManager=i})(this.BX.Socialnetwork.UI.Grid=this.BX.Socialnetwork.UI.Grid||{},BX.Main,BX,BX,BX.Event);
//# sourceMappingURL=grid.bundle.map.js