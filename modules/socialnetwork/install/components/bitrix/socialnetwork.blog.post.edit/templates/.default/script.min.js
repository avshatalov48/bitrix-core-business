(function(){if(window["SBPETabs"])return;window.SBPEFullForm=function(){this.lazyLoad=null;this.ajaxUrl="";this.inited=false;this.loaded=false;this.container=null;this.containerMicro=null;this.containerMicroInner=null;this.clickDisabled=false;this.lastWait=[];this.animationStartHeight=0};window.SBPEFullForm.instance=null;window.SBPEFullForm.getInstance=function(){if(window.SBPEFullForm.instance==null){window.SBPEFullForm.instance=new SBPEFullForm}return window.SBPEFullForm.instance};window.SBPEFullForm.prototype={init:function(t){if(this.inited!==true){this.inited=true;this.lazyLoad=typeof t.lazyLoad!="undefined"?t.lazyLoad:null;this.ajaxUrl=typeof t.ajaxUrl!="undefined"?t.ajaxUrl:"";this.container=typeof t.container!="undefined"?t.container:null;this.containerMicro=typeof t.containerMicro!="undefined"?t.containerMicro:null;this.containerMicroInner=typeof t.containerMicroInner!="undefined"?t.containerMicroInner:null}},get:function(t){var e=this;if(e.clickDisabled){return}if(e.lazyLoad&&!e.loaded){e.clickDisabled=true;e.animationStartHeight=this.containerMicro.offsetHeight;e.containerMicroInner.style.display="none";e.showWait(e.containerMicro);BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{action:"SBPE_get_full_form",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(o){e.loaded=true;e.clickDisabled=false;e.closeWait();if(o.success){e.processAjaxBlock(o.PROPS,t.callback)}else{}}),onfailure:function(t){e.clickDisabled=false;e.closeWait();e.containerMicroInner.style.display="block"}})}else{t.callback()}},processAjaxBlock:function(t,e){if(!t){return}var o=this;var s=false;var i=false;a(n);r(l);function a(e){if(BX.type.isArray(t.CSS)&&t.CSS.length>0){BX.load(t.CSS,e)}else{e()}}function n(){o.container.appendChild(BX.create("DIV",{html:t.CONTENT}));s=true;if(i){l()}}function r(e){if(BX.type.isArray(t.JS)&&t.JS.length>0){BX.load(t.JS,e)}else{e()}}function l(){i=true;if(s){BX.ajax.processRequestData(t.CONTENT,{scriptsRunFirst:false,dataType:"HTML"});e()}}},showWait:function(t){t=BX(t)||document.body||document.documentElement;var e=t.bxmsg=document.body.appendChild(BX.create("DIV",{props:{id:"wait_"+t.id,className:"feed-add-post-loader-cont"},html:'<svg class="feed-add-post-loader" viewBox="25 25 50 50"><circle class="feed-add-post-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle><circle class="feed-add-post-loader-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle></svg>'}));setTimeout(BX.delegate(this.adjustWait,t),10);this.lastWait[this.lastWait.length]=e;return e},adjustWait:function(){if(!this.bxmsg)return;var t=BX.pos(this),e=t.top+15;if(e<BX.GetDocElement().scrollTop)e=BX.GetDocElement().scrollTop+5;this.bxmsg.style.top=e+5+"px";if(this==BX.GetDocElement()){this.bxmsg.style.right="5px"}else{this.bxmsg.style.left=t.left+parseInt((t.width-this.bxmsg.offsetWidth)/2)+"px"}},closeWait:function(){var t=this.containerMicro;obMsg=t.bxmsg;if(obMsg&&obMsg.parentNode){for(var e=0,o=this.lastWait.length;e<o;e++){if(obMsg==this.lastWait[e]){this.lastWait=BX.util.deleteFromArray(this.lastWait,e);break}}obMsg.parentNode.removeChild(obMsg);if(t)t.bxmsg=null;BX.cleanNode(obMsg,true)}},tasksTaskEvent:function(t){this.showTaskPopup(t)},showTaskPopup:function(t){this.createTaskPopup=new BX.PopupWindow("blogPostEditCreateTaskPopup",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:false,lightShadow:true,closeIcon:{right:"12px",top:"10px"},draggable:{restrict:true},closeByEsc:false,contentColor:"white",contentNoPaddings:true,buttons:[],content:BX.create("DIV",{attrs:{id:"blogPostEditCreateTaskPopup_content"},props:{className:"feed-create-task-popup-content"}}),events:{onAfterPopupShow:BX.proxy(function(){this.setTaskPopupContent(BX.create("DIV",{children:[BX.create("DIV",{props:{className:"feed-create-task-popup-title"},html:BX.message("sonetBPECreateTaskSuccessTitle")}),BX.create("DIV",{props:{className:"feed-create-task-popup-description"},html:BX.message("sonetBPECreateTaskSuccessDescription")})]}));this.createTaskPopup.setButtons([new BX.PopupWindowButton({text:BX.message("sonetBPECreateTaskButtonTitle"),events:{click:BX.proxy(function(){this.createTaskPopup.destroy();var e=BX.message("PATH_TO_USER_TASKS_TASK").replace("#user_id#",BX.message("USER_ID")).replace("#task_id#",t).replace("#action#","view");if(typeof BX.Bitrix24!="undefined"&&typeof BX.Bitrix24.PageSlider!="undefined"){BX.Bitrix24.PageSlider.open(e)}else{window.open(e,"_blank")}},this)}})])},this),onPopupClose:BX.proxy(function(){this.createTaskPopup.destroy()},this)}});this.createTaskPopup.params.zIndex=BX.WindowManager?BX.WindowManager.GetZIndex():0;this.createTaskPopup.show()},setTaskPopupContent:function(t){if(BX("blogPostEditCreateTaskPopup_content")){var e=BX("blogPostEditCreateTaskPopup_content");BX.cleanNode(e);e.appendChild(t)}}};window.SBPETabs=function(){if(window.SBPETabs.instance!=null){throw"SBPETabs is a singleton. Use SBPETabs.getInstance to get an object."}this.tabs={};this.bodies={};this.active=null;this.animation=null;this.animationStartHeight=0;this.menu=null;this.menuItems=[];this.lastWait=[];this.clickDisabled=false;this.createTaskPopup=null;if(this.inited!==true)this.init();window.SBPETabs.instance=this};window.SBPETabs.instance=null;window.SBPETabs.getInstance=function(){if(window.SBPETabs.instance==null){window.SBPETabs.instance=new SBPETabs}return window.SBPETabs.instance};window.SBPETabs.changePostFormTab=function(t,e){var o=window.SBPETabs.getInstance();if(o.clickDisabled)return false;return o.setActive(t,e)};window.SBPETabs.prototype={_createOnclick:function(t,e,o){return function(){var s=BX("feed-add-post-form-link-more",true);var i=BX("feed-add-post-form-link-text",true);i.innerHTML=e;if(t!="lists"){s.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-link-active feed-add-post-form-"+t+"-link";window.SBPETabs.changePostFormTab(t)}else{s.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-"+t+"-link"}if(BX.type.isNotEmptyString(o)){BX.evalGlobal(o)}this.popupWindow.close()}},init:function(){this.tabContainer=BX("feed-add-post-form-tab");var t=BX.findChildren(this.tabContainer,{tag:"span",className:"feed-add-post-form-link"},true);this.arrow=BX("feed-add-post-form-tab-arrow");this.tabs={};this.bodies={};for(var e=0;e<t.length;e++){var o=t[e].getAttribute("id").replace("feed-add-post-form-tab-","");this.tabs[o]=t[e];if(this.tabs[o].style.display=="none"){this.menuItems.push({tabId:o,text:t[e].getAttribute("data-name"),className:"menu-popup-no-icon feed-add-post-form-"+o+" feed-add-post-form-"+o+"-more",onclick:this._createOnclick(o,t[e].getAttribute("data-name"),t[e].getAttribute("data-onclick"))});this.tabs[o]=this.tabs[o].parentNode}this.bodies[o]=BX("feed-add-post-content-"+o)}if(!!this.tabs["file"])this.bodies["file"]=[this.bodies["message"]];if(!!this.tabs["calendar"])this.bodies["calendar"]=[this.bodies["calendar"]];if(!!this.tabs["vote"])this.bodies["vote"]=[this.bodies["message"],this.bodies["vote"]];if(!!this.tabs["more"])this.bodies["more"]=null;if(!!this.tabs["important"])this.bodies["important"]=[this.bodies["message"],this.bodies["important"]];if(!!this.tabs["grat"])this.bodies["grat"]=[this.bodies["message"],this.bodies["grat"]];if(!!this.tabs["lists"])this.bodies["lists"]=[this.bodies["lists"]];if(!!this.tabs["tasks"])this.bodies["tasks"]=[this.bodies["tasks"]];for(var s in this.bodies){if(this.bodies.hasOwnProperty(s)&&BX.type.isDomNode(this.bodies[s]))this.bodies[s]=[this.bodies[s]]}this.inited=true;this.previousTab=false;if(BX("bx-b-uploadfile-blogPostForm")){BX("bx-b-uploadfile-blogPostForm").setAttribute("bx-press","pressOut");BX.bind(BX("bx-b-uploadfile-blogPostForm"),"mousedown",BX.delegate(function(){BX("bx-b-uploadfile-blogPostForm").setAttribute("bx-press",BX("bx-b-uploadfile-blogPostForm").getAttribute("bx-press")=="pressOut"?"pressOn":"pressOut")},this))}BX.onCustomEvent(this.tabContainer,"onObjectInit",[this]);var i=BX("blogPostForm");if(i){if(!i.changePostFormTab){i.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"changePostFormTab",value:""}}))}BX.addCustomEvent(window,"changePostFormTab",function(t){if(t!="more"){i.changePostFormTab.value=t}});if(i["UF_BLOG_POST_IMPRTNT"]){BX.addCustomEvent(window,"changePostFormTab",function(t){if(t!="more"){i["UF_BLOG_POST_IMPRTNT"].value=t=="important"?1:0}})}}},setActive:function(t,e){if(t==null||this.active==t&&t!="lists")return this.active;else if(!this.tabs[t])return false;var o,s;var i=t!=="tasks"||this.isTaskTabLoaded();if(i){this.startAnimation()}for(o in this.tabs){if(this.tabs.hasOwnProperty(o)&&o!=t){BX.removeClass(this.tabs[o],"feed-add-post-form-link-active");if(this.bodies[o]==null||this.bodies[t]==null)continue;for(s=0;s<this.bodies[o].length;s++){if(this.bodies[t][s]!=this.bodies[o][s])BX.adjust(this.bodies[o][s],{style:{display:"none"}})}}}if(!!this.tabs[t]){this.active=t;var a=BX.pos(this.tabs[t],true);this.arrow.style.display="block";this.arrow.style.top=a.bottom+"px";var n=parseInt(this.arrow.style.left)||0;var r=parseInt(this.arrow.style.width)||0;new BX.easing({duration:200,start:{left:n,width:r},finish:{left:a.left,width:a.width},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:BX.proxy(function(t){this.arrow.style.left=t.left+"px";this.arrow.style.width=t.width+"px"},this),complete:BX.proxy(function(){this.arrow.style.display="none";BX.addClass(this.tabs[t],"feed-add-post-form-link-active")},this)}).animate();if(this.previousTab=="file"||t=="file"){var l=null,d=null,c=false,u=false,f=BX("divoPostFormLHE_blogPostForm");if(!!f&&!!f.childNodes&&f.childNodes.length>0){for(o in f.childNodes){if(f.childNodes.hasOwnProperty(o)&&f.childNodes[o].className=="file-selectdialog"){l=f.childNodes[o];var p=BX.findChild(l,{className:"file-placeholder-tbody"},true),m=BX.findChildren(l,{className:"feed-add-photo-block"},true);if(p.rows>0||!!m&&m.length>1)c=true}else if(BX.type.isNotEmptyString(f.childNodes[o].className)&&(f.childNodes[o].className.indexOf("wduf-selectdialog")>=0||f.childNodes[o].className.indexOf("diskuf-selectdialog")>=0)){d=f.childNodes[o];var h=BX.findChildren(d,{className:"wd-inline-file"},true);u=!!h&&h.length>0}else if(BX.type.isElementNode(f.childNodes[o])&&!BX.hasClass(f.childNodes[o],"urlpreview")){BX.adjust(f.childNodes[o],{style:{display:t=="file"?"none":""}})}}if(t=="file"){if(!!window["PlEditorblogPostForm"]){if(!window["PlEditorblogPostForm"]["SBPEBinded"]){window["PlEditorblogPostForm"].SBPEBinded=true;BX.addCustomEvent(window["PlEditorblogPostForm"].eventNode,"onUploadsHasBeenChanged",function(t){if(t.dialogName=="AttachFileDialog"&&t.urlUpload.indexOf("&dropped=Y")<0){t.urlUpload=t.agent.uploadFileUrl=t.urlUpload.replace("&random_folder=Y","&dropped=Y")}BX("bx-b-uploadfile-blogPostForm").setAttribute("bx-press","pressOn");window.SBPETabs.changePostFormTab("message")})}window["PlEditorblogPostForm"].controllerInit("show")}window["PlEditorblogPostForm"].controllerInit("show");BX.addClass(f,"feed-add-post-form");BX.addClass(f,"feed-add-post-edit-form");BX.addClass(f,"feed-add-post-edit-form-file")}else{BX.removeClass(f,"feed-add-post-form");BX.removeClass(f,"feed-add-post-edit-form");BX.removeClass(f,"feed-add-post-edit-form-file");if(!c&&!u&&BX("bx-b-uploadfile-blogPostForm").getAttribute("bx-press")=="pressOut"&&!!window["PlEditorblogPostForm"]){window["PlEditorblogPostForm"].controllerInit("hide")}}}}if(BX("divoPostFormLHE_blogPostForm")&&BX("divoPostFormLHE_blogPostForm").style.display=="none"){BX.onCustomEvent(BX("divoPostFormLHE_blogPostForm"),"OnShowLHE",["justShow"])}if(t=="lists"){BX.onCustomEvent("onDisplayClaimLiveFeed",[e])}this.previousTab=t;if(!!this.bodies[t]){for(s=0;s<this.bodies[t].length;s++){if(!!this.bodies[t][s]){BX.adjust(this.bodies[t][s],{style:{display:"block"}})}}}}if(i){this.endAnimation()}if(t!="lists")this.restoreMoreMenu();BX.onCustomEvent(window,"changePostFormTab",[t]);return this.active},startAnimation:function(){if(this.animation){this.animation.stop()}var t=BX("microblog-form",true);if(!t){return false}if(window.SBPEFullForm.getInstance().animationStartHeight>0){this.animationStartHeight=window.SBPEFullForm.getInstance().animationStartHeight;window.SBPEFullForm.getInstance().animationStartHeight=0}else{this.animationStartHeight=t.parentNode.offsetHeight}t.parentNode.style.height=this.animationStartHeight+"px";t.parentNode.style.overflowY="hidden";t.parentNode.style.position="relative";t.style.opacity=0},endAnimation:function(){var t=BX("microblog-form",true);if(!t){return false}this.animation=new BX.easing({duration:500,start:{height:this.animationStartHeight,opacity:0},finish:{height:t.offsetHeight+t.offsetTop,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){t.parentNode.style.height=e.height+"px";t.style.opacity=e.opacity/100},complete:BX.proxy(function(){t.style.cssText="";t.parentNode.style.cssText="";this.animation=null},this)});this.animation.animate()},collapse:function(){window.SBPETabs.changePostFormTab("message");if(window.SBPEFullForm.getInstance().containerMicroInner){window.SBPEFullForm.getInstance().containerMicroInner.style.display="block"}this.startAnimation();BX.onCustomEvent(BX("divoPostFormLHE_blogPostForm"),"OnShowLHE",[false]);BX.onCustomEvent(window,"onExtAutoSaveReset_blogPostForm",[]);this.endAnimation();this.active=null},showMoreMenu:function(){if(!this.menu){this.menu=BX.PopupMenu.create("feed-add-post-form-popup",BX("feed-add-post-form-link-text"),this.menuItems,{className:"feed-add-post-form-popup",closeByEsc:true,offsetTop:5,offsetLeft:3,angle:true})}this.menu.popupWindow.show()},restoreMoreMenu:function(){var t=this.menuItems.length;if(t<1){return}for(var e=0;e<t;e++){if(this.active==this.menuItems[e]["tabId"]){return}}var o=BX("feed-add-post-form-link-more",true);var s=BX("feed-add-post-form-link-text",true);o.className="feed-add-post-form-link feed-add-post-form-link-more";s.innerHTML=BX.message("SBPE_MORE")},getLists:function(){var t=BX("feed-add-post-form-tab-lists")&&BX("feed-add-post-form-tab-lists").style.display!="none"?BX("feed-add-post-form-tab-lists"):BX("feed-add-post-form-link-more"),e=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists"},true),o=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists-default"},true),s=[],i=[];if(e.length){i=this.getMenuItems(e,this.createOnclickLists);s=this.getMenuItemsDefault(o);i=i.concat(s);this.showMoreMenuLists(i)}else{var a=this.showMoreMenuLists,n=this.getMenuItems,r=this.getMenuItemsDefault,l=this.createOnclickLists,d=null;if(BX("bx-lists-select-site-id")){d=BX("bx-lists-select-site-id").value}BX.ajax({method:"POST",dataType:"json",url:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/post.ajax.php",data:{bitrix_processes:1,siteId:d,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(d){if(d.success){var c=null;for(c in d.lists){if(d.lists.hasOwnProperty(c)){t.appendChild(BX.create("span",{attrs:{"data-name":d.lists[c].NAME,"data-picture":d.lists[c].PICTURE,"data-description":d.lists[c].DESCRIPTION,"data-picture-small":d.lists[c].PICTURE_SMALL,"data-code":d.lists[c].CODE,iblockId:d.lists[c].ID},props:{className:"feed-add-post-form-link-lists",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}}e=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists"},true);i=n(e,l);if(!o.length){for(c in d.permissions){if(d.permissions.hasOwnProperty(c)){var u;if(c=="new"){u='document.location.href = "'+BX("bx-lists-lists-page").value+'0/edit/"'}else if(c=="market"){if(d.admin&&BX("bx-lists-lists-page")){u='document.location.href = "'+BX("bx-lists-lists-page").value+'?bp_catalog=y"'}else{if(BX("bx-lists-random-string")){u='BX.Lists["LiveFeedClass_'+BX("bx-lists-random-string").value+'"].errorPopup("'+BX.message("LISTS_CATALOG_PROCESSES_ACCESS_DENIED")+'");'}}}else if(c=="settings"){u='document.location.href = "'+BX("bx-lists-lists-page").value+'"'}t.appendChild(BX.create("span",{attrs:{"data-name":d.permissions[c],"data-picture-small":"","data-key":c,"data-onclick":u},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}}o=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists-default"},true)}s=r(o);i=i.concat(s);a(i)}else{t.appendChild(BX.create("span",{attrs:{"data-name":d.error,"data-picture-small":""},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}));e=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists-default"},true);i=n(e,0);a(i)}})})}},isTaskTabLoaded:function(){var t=BX("feed-add-post-content-tasks-container");return t&&t.children.length},getTaskForm:function(){var t=BX("feed-add-post-form-tab-tasks")&&BX("feed-add-post-form-tab-tasks").style.display!="none"?BX("feed-add-post-form-tab-tasks"):BX("feed-add-post-form-link-more"),e=BX("feed-add-post-content-tasks"),o=BX("feed-add-post-content-tasks-container");if(o&&o.innerHTML.length<=0&&!this.clickDisabled){this.clickDisabled=true;window.SBPEFullForm.getInstance().showWait(o);this.startAnimation();var s={GROUP_ID:BX.message("TASK_SOCNET_GROUP_ID"),PATH_TO_USER_TASKS:BX.message("PATH_TO_USER_TASKS"),PATH_TO_USER_TASKS_TASK:BX.message("PATH_TO_USER_TASKS_TASK"),PATH_TO_GROUP_TASKS:BX.message("PATH_TO_GROUP_TASKS"),PATH_TO_GROUP_TASKS_TASK:BX.message("PATH_TO_GROUP_TASKS_TASK"),PATH_TO_USER_PROFILE:BX.message("PATH_TO_USER_PROFILE"),PATH_TO_GROUP:BX.message("PATH_TO_GROUP"),PATH_TO_USER_TASKS_PROJECTS_OVERVIEW:BX.message("PATH_TO_USER_TASKS_PROJECTS_OVERVIEW"),PATH_TO_USER_TASKS_TEMPLATES:BX.message("PATH_TO_USER_TASKS_TEMPLATES"),PATH_TO_USER_TEMPLATES_TEMPLATE:BX.message("PATH_TO_USER_TEMPLATES_TEMPLATE"),ENABLE_FOOTER:"N",TEMPLATE_CONTROLLER_ID:"lifefeed_task_form",ENABLE_FORM:"N",BACKURL:BX.message("TASK_SUBMIT_BACKURL")};BX.Tasks.Util.Query.runOnce("ui.task.edit",{parameters:{COMPONENT_PARAMETERS:s}}).then(BX.proxy(function(t){if(t.isSuccess()){BX.html(o,t.getData());BX.adjust(e,{style:{display:"block"}});return true}else{this.closeWait(o);this.endAnimation();throw new Error}},this),BX.proxy(function(t){this.closeWait(o);this.endAnimation();throw new Error},this)).then(BX.proxy(function(){this.clickDisabled=false;this.closeWait(o);this.endAnimation()},this))}else{this.startAnimation();this.endAnimation()}BX.onCustomEvent(BX("lifefeed_task_form"),"OnShowLHE",["justShow"])},closeWait:function(t){obMsg=t.bxmsg;if(obMsg&&obMsg.parentNode){for(var e=0,o=this.lastWait.length;e<o;e++){if(obMsg==this.lastWait[e]){this.lastWait=BX.util.deleteFromArray(this.lastWait,e);break}}obMsg.parentNode.removeChild(obMsg);if(t)t.bxmsg=null;BX.cleanNode(obMsg,true)}},getMenuItems:function(t,e){var o=[];for(var s=0;s<t.length;s++){var i=t[s].getAttribute("id").replace("feed-add-post-form-tab-","");if(e){o.push({tabId:i,text:BX.util.htmlspecialchars(t[s].getAttribute("data-name")),className:"feed-add-post-form-"+i+"feed-add-post-form-"+i+"-item",onclick:e(i,[t[s].getAttribute("iblockId"),t[s].getAttribute("data-name"),t[s].getAttribute("data-description"),t[s].getAttribute("data-picture"),t[s].getAttribute("data-code")])})}else{o.push({tabId:i,text:t[s].getAttribute("data-name"),className:"feed-add-post-form-"+i,onclick:""})}}return o},getMenuItemsDefault:function(t){var e=[];for(var o=0;o<t.length;o++){e.push({text:BX.util.htmlspecialchars(t[o].getAttribute("data-name")),className:"feed-add-post-form-lists-default-"+t[o].getAttribute("data-key"),onclick:t[o].getAttribute("data-onclick")})}return e},showMoreMenuLists:function(t){var e=BX("feed-add-post-form-tab-lists").style.display!="none"?BX("feed-add-post-form-tab-lists"):BX("feed-add-post-form-link-more");var o=BX.PopupMenu.create("lists",e,t,{closeByEsc:true,offsetTop:5,offsetLeft:12,angle:true});var s=BX.findChildren(BX("popup-window-content-menu-popup-lists"),{tag:"span",className:"menu-popup-item-icon"},true),i=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists"},true),a=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists-default"},true);i=i.concat(a);for(var n=0;n<s.length;n++){if(i[n].getAttribute("data-picture-small")){s[n].innerHTML=i[n].getAttribute("data-picture-small")}}o.popupWindow.show()},createOnclickLists:function(t,e){return function(){window.SBPETabs.changePostFormTab(t,e);this.popupWindow.close()}}};window.BXfpGratSelectCallback=function(t){BXfpGratMedalSelectCallback(t,"grat")};window.BXfpMedalSelectCallback=function(t){BXfpGratMedalSelectCallback(t,"medal")};window.BXfpGratMedalSelectCallback=function(t,e){if(e!="grat")e="medal";var o="U";BX("feed-add-post-"+e+"-item").appendChild(BX.create("span",{attrs:{"data-id":t.id},props:{className:"feed-add-post-"+e+" feed-add-post-destination-users"},children:[BX.create("input",{attrs:{type:"hidden",name:(e=="grat"?"GRAT":"MEDAL")+"["+o+"][]",value:t.id}}),BX.create("span",{props:{className:"feed-add-post-"+e+"-text"},html:t.name}),BX.create("span",{props:{className:"feed-add-post-del-but"},events:{click:function(e){BX.SocNetLogDestination.deleteItem(t.id,"users",window["BXSocNetLogGratFormName"]);BX.PreventDefault(e)},mouseover:function(){BX.addClass(this.parentNode,"feed-add-post-"+e+"-hover")},mouseout:function(){BX.removeClass(this.parentNode,"feed-add-post-"+e+"-hover")}}})]}));BX("feed-add-post-"+e+"-input").value="";BX.SocNetLogDestination.BXfpSetLinkName({formName:e=="grat"?window["BXSocNetLogGratFormName"]:window["BXSocNetLogMedalFormName"],tagInputName:"bx-"+e+"-tag",tagLink1:BX.message("BX_FPGRATMEDAL_LINK_1"),tagLink2:BX.message("BX_FPGRATMEDAL_LINK_2")})};if(!!BX.SocNetGratSelector)return;BX.SocNetPostDateEndData={isInitialized:false,popupShowingPeriods:null,customDateStyleModifier:"feed-add-post-expire-date-customize",popupTriggerSelector:".js-important-till-popup-trigger",customDatePopupOptionClass:"js-custom-date-end",customDateFinalSelector:".js-date-post-showing-custom",postExpireDateBlockSelector:".js-post-expire-date-block"};BX.SocNetGratSelector={popupWindow:null,obWindowCloseIcon:{},sendEvent:true,obCallback:{},gratsContentElement:null,itemSelectedImageItem:{},itemSelectedInput:{},searchTimeout:null,obDepartmentEnable:{},obSonetgroupsEnable:{},obLastEnable:{},obWindowClass:{},obPathToAjax:{},obDepartmentLoad:{},obDepartmentSelectDisable:{},obItems:{},obItemsLast:{},obItemsSelected:{},obElementSearchInput:{},obElementBindMainPopup:{},obElementBindSearchPopup:{}};BX.SocNetPostDateEndData.init=function(){if(this.isInitialized){return}this.addEventHandlers();if(!this.formDateTimeEditing.value){this.customDateSelectedTitle.innerText=this.getCurrentDate()}this.isInitialized=true};BX.SocNetPostDateEndData.addEventHandlers=function(){this.postExpireDateBlock=document.querySelector(this.postExpireDateBlockSelector);this.formUfInputDateCustom=document.querySelector(".js-form-post-end-time");this.formDateDuration=document.querySelector(".js-form-post-end-period");this.formDateTimeEditing=document.querySelector(".js-form-editing-post-end-time");this.popupTrigger=document.querySelector(this.popupTriggerSelector);if(this.popupTrigger){this.popupTrigger.addEventListener("click",function(t){BX.SocNetPostDateEndData.showPostEndPeriodsPopup()})}this.customDateSelectedTitle=document.querySelector(this.customDateFinalSelector);if(this.customDateSelectedTitle){this.customDateSelectedTitle.addEventListener("click",function(t){var e=new Date;var o=Math.round(e/1e3)-e.getTimezoneOffset()*60;if(this.formDateTimeEditing.value){e=BX.parseDate(this.formDateTimeEditing.value);o=BX.date.convertToUTC(e)}BX.calendar({node:this.customDateSelectedTitle,form:"blogPostForm",value:o,bTime:false,callback:function(){return true},callback_after:BX.SocNetPostDateEndData.onEndDateSet.bind(BX.SocNetPostDateEndData)})}.bind(this))}};BX.SocNetPostDateEndData.showPostEndPeriodsPopup=function(){if(!this.popupShowingPeriods){this.createPopupShowingPeriods()}this.popupShowingPeriods.popupWindow.show()};BX.SocNetPostDateEndData.createPopupShowingPeriods=function(){if(!this.menuItems){this.menuItems=this.createPopupItems()}this.popupShowingPeriods=BX.PopupMenu.create("feed-add-post-form-popup42",BX("js-post-expire-date-wrapper"),this.menuItems,{className:"feed-add-post-expire-date-options",closeByEsc:true,angle:true})};BX.SocNetPostDateEndData.createPopupItems=function(){var t=[];var e=BX.findChildren(document.querySelector(".js-post-showing-duration-options-container"),{className:"js-post-showing-duration-option"},true);if(e){e.forEach(function(e){t.push({onclick:this.onPopupItemClick.bind(this),dataset:{value:e.getAttribute("data-value"),class:e.getAttribute("data-class")},text:e.getAttribute("data-text"),className:"menu-popup-item menu-popup-no-icon "+e.getAttribute("data-class")})}.bind(this));return t}return[]};BX.SocNetPostDateEndData.onPopupItemClick=function(t){var e=t.currentTarget;if(e.getAttribute("data-class")==this.customDatePopupOptionClass){this.postExpireDateBlock.classList.add(this.customDateStyleModifier);if(this.formDateTimeEditing.value){this.formUfInputDateCustom.value=this.formDateTimeEditing.value;this.customDateSelectedTitle.innerText=this.formDateTimeEditing.value}else{this.formUfInputDateCustom.value=this.getCurrentDate()}}else{this.postExpireDateBlock.classList.remove(this.customDateStyleModifier);this.formUfInputDateCustom.value=null}this.popupTrigger.innerText=e.innerText.toLowerCase();this.formDateDuration.value=e.getAttribute("data-value").toUpperCase();this.popupShowingPeriods.popupWindow.close()};BX.SocNetPostDateEndData.onEndDateSet=function(t){if(!t){return}this.formDateTimeEditing.value=this.getFormattedDate(t);this.formUfInputDateCustom.value=this.getFormattedDate(t);this.customDateSelectedTitle.innerText=this.getFormattedDate(t)};BX.SocNetPostDateEndData.getFormattedDate=function(t){return BX.date.format(BX.date.convertBitrixFormat(BX.message("FORMAT_DATE")),t)};BX.SocNetPostDateEndData.getCurrentDate=function(){return BX.SocNetPostDateEndData.getFormattedDate(new Date)};BX.SocNetGratSelector.init=function(t){if(!t.name)t.name="lm";BX.SocNetGratSelector.obCallback[t.name]=t.callback;BX.SocNetGratSelector.obWindowCloseIcon[t.name]=typeof t.obWindowCloseIcon=="undefined"?true:t.obWindowCloseIcon;BX.SocNetGratSelector.itemSelectedImageItem[t.name]=t.itemSelectedImageItem;BX.SocNetGratSelector.itemSelectedInput[t.name]=t.itemSelectedInput};BX.SocNetGratSelector.openDialog=function(t){if(!t)t="lm";if(BX.SocNetGratSelector.popupWindow!=null){BX.SocNetGratSelector.popupWindow.close();return false}var e=[];for(var o=0;o<arGrats.length;o++){e[e.length]=BX.create("span",{props:{className:"feed-add-grat-box "+arGrats[o].style},attrs:{title:arGrats[o].title},events:{click:BX.delegate(function(e){BX.SocNetGratSelector.selectItem(t,this.code,this.style,this.title);BX.PreventDefault(e)},arGrats[o])}})}var s=[];var i=1;for(o=0;o<e.length;o++){if(o>=e.length/2)i=2;if(s[i]==null||s[i]=="undefined")s[i]=BX.create("div",{props:{className:"feed-add-grat-list-row"}});s[i].appendChild(e[o])}BX.SocNetGratSelector.gratsContentElement=BX.create("div",{children:[BX.create("div",{props:{className:"feed-add-grat-list-title"},html:BX.message("BLOG_GRAT_POPUP_TITLE")}),BX.create("div",{props:{className:"feed-add-grat-list"},children:s})]});BX.SocNetGratSelector.popupWindow=new BX.PopupWindow("BXSocNetGratSelector",BX("feed-add-post-grat-type-selected"),{autoHide:true,offsetLeft:25,bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:BX.SocNetGratSelector.obWindowCloseIcon[t]?{top:"5px",right:"10px"}:false,events:{onPopupShow:function(){if(BX.SocNetGratSelector.sendEvent&&BX.SocNetGratSelector.obCallback[t]&&BX.SocNetGratSelector.obCallback[t].openDialog)BX.SocNetGratSelector.obCallback[t].openDialog()},onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){BX.SocNetGratSelector.popupWindow=null;if(BX.SocNetGratSelector.sendEvent&&BX.SocNetGratSelector.obCallback[t]&&BX.SocNetGratSelector.obCallback[t].closeDialog)BX.SocNetGratSelector.obCallback[t].closeDialog()},this)},content:BX.SocNetGratSelector.gratsContentElement,angle:{position:"bottom",offset:20},lightShadow:true});BX.SocNetGratSelector.popupWindow.setAngle({});BX.SocNetGratSelector.popupWindow.show();return true};BX.SocNetGratSelector.selectItem=function(t,e,o,s){var i=BX.findChild(BX.SocNetGratSelector.itemSelectedImageItem[t],{tag:"span"},false,false);if(typeof i!="undefined"&&i){i.className="feed-add-grat-box "+o}BX.SocNetGratSelector.itemSelectedImageItem[t].title=s;BX.SocNetGratSelector.itemSelectedInput[t].value=e;BX.SocNetGratSelector.popupWindow.close()};var t=function(t,e){var o="blogPostForm",s=BX(o),i="POST_TITLE",a=BX(i),n=BX(o).TAGS,r=function(t){BX.bind(a,"keydown",BX.proxy(t.Init,t));BX.bind(n,"keydown",BX.proxy(t.Init,t))};if(!s)return;e=typeof e!="undefined"?!!e:true;BX.addCustomEvent(s,"onAutoSavePrepare",function(t){t.DISABLE_STANDARD_NOTIFY=true;var e=t;setTimeout(function(){r(e)},100)});BX.addCustomEvent(s,"onAutoSave",function(t,e){e["TAGS"]=BX(o).TAGS.value;delete e["POST_MESSAGE"]});if(t=="Y"){BX.addCustomEvent(s,"onAutoSaveRestoreFound",function(t,e){var s=BX.util.trim(e["text"+o])||"",a=BX.util.trim(e[i])||"";if(s.length<1&&a.length<1)return;t.Restore()})}else{BX.addCustomEvent(s,"onAutoSaveRestoreFound",BX.delegate(function(t,e){var s=BX.util.trim(e["text"+o])||"",a=BX.util.trim(e[i])||"";if(s.length<1&&a.length<1)return;var n=BX("microoPostFormLHE_blogPostForm"),r=BX.create("DIV",{attrs:{className:"feed-add-successfully"},children:[BX.create("SPAN",{attrs:{className:"feed-add-info-icon"}}),BX.create("A",{attrs:{className:"feed-add-info-text",href:"#"},events:{click:function(){t.Restore();r.parentNode.removeChild(r);return false}},text:BX.message("BLOG_POST_AUTOSAVE2")})]});if(n){n.parentNode.insertBefore(r,n)}},this))}if(e){BX.addCustomEvent(s,"onAutoSaveRestore",function(t,e){BX(i).value=e[i];if(e[i].length>0&&e[i]!=BX(i).getAttribute("placeholder")){if(BX("divoPostFormLHE_blogPostForm").style.display!="none")window["showPanelTitle_"+o](true);else window["bShowTitle"]=true;if(!!BX(i).__onchange)BX(i).__onchange()}var s=window["BXPostFormTags_"+o];if(e["TAGS"].length>0&&s){var a=s.addTag(e["TAGS"]);if(a.length>0){BX.show(s.tagsArea)}}if(BX.SocNetLogDestination){var n;if(e["SPERM[DR][]"]){for(n=0;n<e["SPERM[DR][]"].length;n++){BX.SocNetLogDestination.selectItem(BXSocNetLogDestinationFormName,"",3,e["SPERM[DR][]"][n],"department",false)}}if(e["SPERM[SG][]"]){for(n=0;n<e["SPERM[SG][]"].length;n++){BX.SocNetLogDestination.selectItem(BXSocNetLogDestinationFormName,"",3,e["SPERM[SG][]"][n],"sonetgroups",false)}}if(e["SPERM[U][]"]){for(n=0;n<e["SPERM[U][]"].length;n++){BX.SocNetLogDestination.selectItem(BXSocNetLogDestinationFormName,"",3,e["SPERM[U][]"][n],"users",false)}}if(!e["SPERM[UA][]"]){BX.SocNetLogDestination.deleteItem("UA","groups",BXSocNetLogDestinationFormName)}}r(t)})}},e={},o=function(t){if(e[t]&&e[t]["editorID"]){if(e[t]["editor"])e[t]["editor"](e[t]["text"]);else setTimeout(function(){o(t)},50)}};BX.SocnetBlogPostInit=function(s,i){e[s]={editorID:i["editorID"],showTitle:!!i["showTitle"],submitted:false,text:i["text"],autoSave:i["autoSave"],handler:LHEPostForm&&LHEPostForm.getHandler(i["editorID"]),editor:LHEPostForm&&LHEPostForm.getEditor(i["editorID"]),restoreAutosave:!!i["restoreAutosave"]};window["showPanelTitle_"+s]=function(t,o){t=t===true||t===false?t:BX("blog-title").style.display=="none";o=o!==false;var i=e[s]["showTitle"],a=BX("lhe_button_title_"+s),n=BX("feed-add-post-block"+s),r=BX("show_title")||{};if(t){BX.show(BX("blog-title"));BX.focus(BX("POST_TITLE"));e[s]["showTitle"]=true;r.value="Y";if(a){BX.addClass(a,"feed-add-post-form-btn-active")}if(n){BX.addClass(n,"blog-post-edit-open")}}else{BX.hide(BX("blog-title"));e[s]["showTitle"]=false;r.value="N";if(a)BX.removeClass(a,"feed-add-post-form-btn-active")}if(o)BX.userOptions.save("socialnetwork","postEdit","showTitle",e[s]["showTitle"]?"Y":"N");else e[s]["showTitle"]=i};window["setBlogPostFormSubmitted"]=function(t){if(BX("blog-submit-button-save")){if(t){BX.addClass(BX("blog-submit-button-save"),"ui-btn-clock")}else{BX.removeClass(BX("blog-submit-button-save"),"ui-btn-clock")}}e[s]["submitted"]=t};window["submitBlogPostForm"]=function(t,o){if(typeof t!="object"){o=t;t=LHEPostForm.getEditor(e[s]["editorID"])}if(t&&t.id==e[s]["editorID"]){if(e[s]["submitted"])return false;t.SaveContent();if(!o){o="save"}if(BX("blog-title").style.display=="none"){BX("POST_TITLE").value=""}var i=null;if(o=="save"&&BX("blog-submit-button-save")){i=BX("blog-submit-button-save")}else if(o=="draft"&&BX("blog-submit-button-draft")){i=BX("blog-submit-button-draft")}if(i){BX.addClass(i,"ui-btn-clock");BX.addClass(i,"ui-btn-disabled");i.disabled=true;window.addEventListener("beforeunload",BX.proxy(function(t){var o=this.submitButton;setTimeout(function(){BX.removeClass(o,"ui-btn-clock");BX.removeClass(o,"ui-btn-disabled");o.disabled=false;e[s]["submitted"]=false},3e3)},{submitButton:i}))}BX.submit(BX(s),o);e[s]["submitted"]=true}};var a=function(t,o){if(o==s){e[s]["handler"]=t;BX.addCustomEvent(t.eventNode,"OnControlClick",function(){window.SBPETabs.changePostFormTab("message")});var i=function(){var t=[BX("feed-add-post-form-notice-blockblogPostForm"),BX("feed-add-buttons-blockblogPostForm"),BX("feed-add-post-content-message-add-ins")];for(var o=0;o<t.length;o++){if(!!t[o]){BX.adjust(t[o],{style:{display:"block",height:"auto",opacity:1}})}}if(e[s]["showTitle"])window["showPanelTitle_"+s](true,false)},a=function(){var t,o=[BX("feed-add-post-form-notice-blockblogPostForm"),BX("feed-add-buttons-blockblogPostForm"),BX("feed-add-post-content-message-add-ins")];for(t=0;t<o.length;t++){if(!!o[t]){BX.adjust(o[t],{style:{display:"block",height:"0px",opacity:0}})}}if(e[s]["showTitle"])window["showPanelTitle_"+s](false,false)};BX.addCustomEvent(t.eventNode,"OnAfterShowLHE",i);BX.addCustomEvent(t.eventNode,"OnAfterHideLHE",a);if(t.eventNode.style.display=="none")a();else i()}},n=function(o){if(o.id==e[s]["editorID"]){e[s]["editor"]=o;if(e[s]["autoSave"]!="N")new t(e[s]["autoSave"],e[s]["restoreAutosave"]);var i=window[o.id+"Files"],a=LHEPostForm.getHandler(o.id),n,r,l,d=[],c=null;for(r in a["controllers"]){if(a["controllers"].hasOwnProperty(r)){if(a["controllers"][r]["parser"]&&a["controllers"][r]["parser"]["bxTag"]=="postimage"){c=a["controllers"][r];break}}}var u=function(t,e){return function(){t.insertFile(e)}},f=function(t,e,o){return function(){if(c){c.deleteFile(e,{});BX.remove(BX("wd-doc"+e));BX.ajax({method:"GET",url:o})}else{t.deleteFile(e,o,t,{controlID:"common"})}}};for(n in i){if(i.hasOwnProperty(n)){if(c){c.addFile(i[n])}else{r=a.checkFile(n,"common",i[n]);d.push(n);if(!!r&&BX("wd-doc"+n)&&!BX("wd-doc"+n).hasOwnProperty("bx-bound")){BX("wd-doc"+n).setAttribute("bx-bound","Y");if((l=BX.findChild(BX("wd-doc"+n),{className:"feed-add-img-wrap"},true,false))&&l){BX.bind(l,"click",u(a,r));l.style.cursor="pointer"}if((l=BX.findChild(BX("wd-doc"+n),{className:"feed-add-img-title"},true,false))&&l){BX.bind(l,"click",u(a,r));l.style.cursor="pointer"}if((l=BX.findChild(BX("wd-doc"+n),{className:"feed-add-post-del-but"},true,false))&&l){BX.bind(l,"click",f(a,n,i[n]["del_url"]));l.style.cursor="pointer"}}}if((l=BX.findChild(BX("wd-doc"+n),{className:"feed-add-post-del-but"},true,false))&&l){BX.bind(l,"click",f(a,n,i[n]["del_url"]));l.style.cursor="pointer"}}}if(d.length>0){o.SaveContent();var p=o.GetContent();p=p.replace(new RegExp("\\&\\#91\\;IMG ID=("+d.join("|")+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"[IMG ID=$1$2]");o.SetContent(p);o.Focus()}}};BX.addCustomEvent(window,"onInitialized",a);if(e[s]["handler"])a(e[s]["handler"],s);BX.addCustomEvent(window,"OnEditorInitedAfter",n);if(e[s]["editor"])n(e[s]["editor"]);BX.addCustomEvent(window,"onSocNetLogMoveBody",function(t){if(t=="sonet_log_microblog_container"){o(s)}});BX.ready(function(){if(BX.browser.IsIE()&&BX("POST_TITLE")){var t=function(t){if(!this.value||this.value==this.getAttribute("placeholder")){this.value=this.getAttribute("placeholder");BX.removeClass(this,"feed-add-post-inp-active")}};BX.bind(BX("POST_TITLE"),"blur",t);t.apply(BX("POST_TITLE"));BX("POST_TITLE").__onchange=BX.delegate(function(t){if(this.value==this.getAttribute("placeholder")){this.value=""}if(this.className.indexOf("feed-add-post-inp-active")<0){BX.addClass(this,"feed-add-post-inp-active")}},BX("POST_TITLE"));BX.bind(BX("POST_TITLE"),"click",BX("POST_TITLE").__onchange);BX.bind(BX("POST_TITLE"),"keydown",BX("POST_TITLE").__onchange);BX.bind(BX("POST_TITLE").form,"submit",function(){if(BX("POST_TITLE").value==BX("POST_TITLE").getAttribute("placeholder")){BX("POST_TITLE").value=""}})}if(i["activeTab"]!=="")window.SBPETabs.changePostFormTab(i["activeTab"])})}})();