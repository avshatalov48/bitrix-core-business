{"version":3,"file":"quote.bundle.js","sources":["../src/quote.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { Core } from 'im.v2.application.core';\nimport { EventType, ChatType } from 'im.v2.const';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport type { ImModelMessage, ImModelUser, ImModelChat } from 'im.v2.model';\n\nconst QUOTE_DELIMITER = '-'.repeat(54);\n\nexport const Quote = {\n\tsendQuoteEvent(message: ImModelMessage, text: string, dialogId: string)\n\t{\n\t\tEventEmitter.emit(EventType.textarea.insertText, {\n\t\t\ttext: this.prepareQuoteText(message, text),\n\t\t\tdialogId,\n\t\t\twithNewLine: true,\n\t\t\treplace: false,\n\t\t});\n\t},\n\tprepareQuoteText(message: ImModelMessage, text: string): string\n\t{\n\t\tconst dialog: ImModelChat = Core.getStore().getters['chats/getByChatId'](message.chatId);\n\n\t\tlet quoteTitle = Loc.getMessage('IM_DIALOG_CHAT_QUOTE_DEFAULT_TITLE');\n\t\tif (message.authorId)\n\t\t{\n\t\t\tquoteTitle = getName(message);\n\t\t}\n\n\t\tconst quoteDate = DateFormatter.formatByTemplate(message.date, DateTemplate.notification);\n\n\t\tconst quoteText = Parser.prepareQuote(message, text);\n\n\t\tlet quoteContext = '';\n\t\tif (dialog && dialog.type === ChatType.user)\n\t\t{\n\t\t\tquoteContext = `#${dialog.dialogId}:${Core.getUserId()}/${message.id}`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tquoteContext = `#${dialog.dialogId}/${message.id}`;\n\t\t}\n\n\t\treturn `${QUOTE_DELIMITER}\\n`\n\t\t\t+ `${quoteTitle} [${quoteDate}] ${quoteContext}\\n`\n\t\t\t+ `${quoteText}\\n`\n\t\t\t+ `${QUOTE_DELIMITER}\\n`\n\t\t;\n\t},\n};\n\nconst getName = (message: ImModelMessage): string => {\n\tlet name = '';\n\n\tconst copilotManager = new CopilotManager();\n\tif (copilotManager.isCopilotBot(message.authorId))\n\t{\n\t\tname = copilotManager.getNameWithRole({\n\t\t\tdialogId: message.authorId,\n\t\t\tmessageId: message.id,\n\t\t});\n\t}\n\telse\n\t{\n\t\tconst user: ImModelUser = Core.getStore().getters['users/get'](message.authorId);\n\t\tname = user.name;\n\t}\n\n\treturn name;\n};\n"],"names":["QUOTE_DELIMITER","repeat","Quote","sendQuoteEvent","message","text","dialogId","EventEmitter","emit","EventType","textarea","insertText","prepareQuoteText","withNewLine","replace","dialog","Core","getStore","getters","chatId","quoteTitle","Loc","getMessage","authorId","getName","quoteDate","DateFormatter","formatByTemplate","date","DateTemplate","notification","quoteText","Parser","prepareQuote","quoteContext","type","ChatType","user","getUserId","id","name","copilotManager","CopilotManager","isCopilotBot","getNameWithRole","messageId"],"mappings":";;;;;;;CAWA,MAAMA,eAAe,GAAG,GAAG,CAACC,MAAM,CAAC,EAAE,CAAC;AAEtC,OAAaC,KAAK,GAAG;GACpBC,cAAc,CAACC,OAAuB,EAAEC,IAAY,EAAEC,QAAgB,EACtE;KACCC,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACC,QAAQ,CAACC,UAAU,EAAE;OAChDN,IAAI,EAAE,IAAI,CAACO,gBAAgB,CAACR,OAAO,EAAEC,IAAI,CAAC;OAC1CC,QAAQ;OACRO,WAAW,EAAE,IAAI;OACjBC,OAAO,EAAE;MACT,CAAC;IACF;GACDF,gBAAgB,CAACR,OAAuB,EAAEC,IAAY,EACtD;KACC,MAAMU,MAAmB,GAAGC,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,mBAAmB,CAAC,CAACd,OAAO,CAACe,MAAM,CAAC;KAExF,IAAIC,UAAU,GAAGC,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;KACrE,IAAIlB,OAAO,CAACmB,QAAQ,EACpB;OACCH,UAAU,GAAGI,OAAO,CAACpB,OAAO,CAAC;;KAG9B,MAAMqB,SAAS,GAAGC,qCAAa,CAACC,gBAAgB,CAACvB,OAAO,CAACwB,IAAI,EAAEC,oCAAY,CAACC,YAAY,CAAC;KAEzF,MAAMC,SAAS,GAAGC,uBAAM,CAACC,YAAY,CAAC7B,OAAO,EAAEC,IAAI,CAAC;KAEpD,IAAI6B,YAAY,GAAG,EAAE;KACrB,IAAInB,MAAM,IAAIA,MAAM,CAACoB,IAAI,KAAKC,oBAAQ,CAACC,IAAI,EAC3C;OACCH,YAAY,GAAI,IAAGnB,MAAM,CAACT,QAAS,IAAGU,2BAAI,CAACsB,SAAS,EAAG,IAAGlC,OAAO,CAACmC,EAAG,EAAC;MACtE,MAED;OACCL,YAAY,GAAI,IAAGnB,MAAM,CAACT,QAAS,IAAGF,OAAO,CAACmC,EAAG,EAAC;;KAGnD,OAAQ,GAAEvC,eAAgB,IAAG,GACzB,GAAEoB,UAAW,KAAIK,SAAU,KAAIS,YAAa,IAAG,GAC/C,GAAEH,SAAU,IAAG,GACf,GAAE/B,eAAgB,IAAG;;CAG3B,CAAC;CAED,MAAMwB,OAAO,GAAIpB,OAAuB,IAAa;GACpD,IAAIoC,IAAI,GAAG,EAAE;GAEb,MAAMC,cAAc,GAAG,IAAIC,gCAAc,EAAE;GAC3C,IAAID,cAAc,CAACE,YAAY,CAACvC,OAAO,CAACmB,QAAQ,CAAC,EACjD;KACCiB,IAAI,GAAGC,cAAc,CAACG,eAAe,CAAC;OACrCtC,QAAQ,EAAEF,OAAO,CAACmB,QAAQ;OAC1BsB,SAAS,EAAEzC,OAAO,CAACmC;MACnB,CAAC;IACF,MAED;KACC,MAAMF,IAAiB,GAAGrB,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,WAAW,CAAC,CAACd,OAAO,CAACmB,QAAQ,CAAC;KAChFiB,IAAI,GAAGH,IAAI,CAACG,IAAI;;GAGjB,OAAOA,IAAI;CACZ,CAAC;;;;;;;;"}