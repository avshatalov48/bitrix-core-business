this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,i,n,s){"use strict";var r=50;var o=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getTypes",value:function e(){return Object.freeze({string:"string",enumeration:"enumeration",date:"date",datetime:"datetime",address:"address",url:"url",file:"file",money:"money",boolean:"boolean",double:"double",employee:"employee",crm:"crm",crmStatus:"crm_status"})}},{key:"getDescriptions",value:function e(){return Object.freeze({string:{title:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_STRING_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_STRING_LEGEND"),defaultTitle:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_STRING_LABEL")},enumeration:{title:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUM_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUM_LEGEND"),defaultTitle:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUMERATION_LABEL")},datetime:{title:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATETIME_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATETIME_LEGEND"),defaultTitle:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATETIME_LABEL")},address:{title:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ADDRESS_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ADDRESS_LEGEND")},url:{title:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_URL_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_URL_LEGEND")},file:{title:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_FILE_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_FILE_LEGEND"),defaultTitle:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_FILE_LABEL")},money:{title:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_MONEY_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_MONEY_LEGEND"),defaultTitle:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_MONEY_LABEL")},boolean:{title:n.Loc.getMessage("UI_USERFIELD_FACTORY_BOOLEAN_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_BOOLEAN_LEGEND")},double:{title:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DOUBLE_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DOUBLE_LEGEND"),defaultTitle:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DOUBLE_LABEL")},employee:{title:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_EMPLOYEE_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_EMPLOYEE_LEGEND")}})}},{key:"getCustomTypeDescription",value:function e(){return Object.freeze({name:"custom",title:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_CUSTOM_TITLE"),description:n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_CUSTOM_LEGEND")})}}]);return e}();var l=Object.freeze({multiple:"N",mandatory:"N",userTypeId:o.string,showFilter:"E",showInList:"Y",settings:{},isSearchable:"N"});var a=Object.freeze({file:{showFilter:"N",showInList:"N"},employee:{showFilter:"I"},crm:{showFilter:"I"},crm_status:{showFilter:"I"},enumeration:{settings:{DISPLAY:"UI"}},double:{settings:{PRECISION:2}}});function u(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-creation-menu-item" onclick="','">\n\t\t\t<div class="ui-userfieldfactory-creation-menu-item-title">','</div>\n\t\t\t<div class="ui-userfieldfactory-creation-menu-item-desc">',"</div>\n\t\t</div>"]);u=function t(){return e};return e}function c(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-creation-menu-list"></div>']);c=function t(){return e};return e}function d(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-creation-menu-scroll-bottom">',"</div>"]);d=function t(){return e};return e}function h(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-creation-menu-scroll-top">',"</div>"]);h=function t(){return e};return e}function p(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-creation-menu-container"></div>']);p=function t(){return e};return e}var f=3;var g=function(){function e(t,i,s){babelHelpers.classCallCheck(this,e);v.set(this,{writable:true,value:void 0});b.set(this,{writable:true,value:void 0});this.id=t;this.items=i;this.params={};if(n.Type.isPlainObject(s)){this.params=s}}babelHelpers.createClass(e,[{key:"getId",value:function e(){if(!this.id){return"ui-user-field-factory-menu"}return this.id}},{key:"getPopup",value:function t(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this.popup){var s=babelHelpers.objectSpread({},e.getDefaultPopupOptions(),this.params);s.events={onPopupShow:this.onPopupShow.bind(this),onPopupDestroy:this.onPopupDestroy.bind(this)};s.id=this.getId();this.popup=new i.Popup(s)}this.popup.setContent(this.render(n));return this.popup}},{key:"open",value:function e(t){var i=this.getPopup(t);if(!i.isShown()){i.show()}}},{key:"render",value:function e(t){if(!this.container){this.container=n.Tag.render(p());var i='<svg xmlns="http://www.w3.org/2000/svg" width="42" height="13" viewBox="0 0 42 13">\n'+'  <polyline fill="none" stroke="#CACDD1" stroke-width="2" points="274 98 284 78.614 274 59" transform="rotate(90 186 -86.5)" stroke-linecap="round" stroke-linejoin="round"/>\n'+"</svg>\n";this.topScrollButton=n.Tag.render(h(),i);this.bottomScrollButton=n.Tag.render(d(),i);this.container.appendChild(this.topScrollButton);this.container.appendChild(this.bottomScrollButton);this.container.appendChild(this.renderList(t))}return this.container}},{key:"renderList",value:function e(t){var i=this;if(!this.containerList){this.containerList=n.Tag.render(c());this.items.forEach(function(e){i.containerList.appendChild(i.renderItem(e,t))})}return this.containerList}},{key:"renderItem",value:function e(t,i){var s=this;return n.Tag.render(u(),function(){s.handleItemClick(t,i)},t.title,t.description)}},{key:"handleItemClick",value:function e(t,i){if(n.Type.isFunction(t.onClick)){t.onClick(t.name)}else if(n.Type.isFunction(i)){i(t.name)}this.getPopup().close()}},{key:"onPopupShow",value:function e(){n.Event.bind(this.bottomScrollButton,"mouseover",this.onBottomButtonMouseOver.bind(this));n.Event.bind(this.bottomScrollButton,"mouseout",this.onBottomButtonMouseOut.bind(this));n.Event.bind(this.topScrollButton,"mouseover",this.onTopButtonMouseOver.bind(this));n.Event.bind(this.topScrollButton,"mouseout",this.onTopButtonMouseOut.bind(this));n.Event.bind(this.containerList,"scroll",this.onScroll.bind(this));window.setTimeout(this.adjust.bind(this),100)}},{key:"onPopupDestroy",value:function e(){n.Event.unbind(this.bottomScrollButton,"mouseover",this.onBottomButtonMouseOver.bind(this));n.Event.unbind(this.bottomScrollButton,"mouseout",this.onBottomButtonMouseOut.bind(this));n.Event.unbind(this.topScrollButton,"mouseover",this.onTopButtonMouseOver.bind(this));n.Event.unbind(this.topScrollButton,"mouseout",this.onTopButtonMouseOut.bind(this));n.Event.unbind(this.containerList,"scroll",this.onScroll.bind(this));this.container=null;this.containerList=null;this.topScrollButton=null;this.bottomScrollButton=null;this.popup=null}},{key:"onBottomButtonMouseOver",value:function e(){if(babelHelpers.classPrivateFieldGet(this,v)){return}babelHelpers.classPrivateFieldSet(this,v,true);babelHelpers.classPrivateFieldSet(this,b,false);(function e(){if(!babelHelpers.classPrivateFieldGet(this,v)){return}if(this.containerList.scrollTop+this.containerList.offsetHeight!==this.containerList.scrollHeight){this.containerList.scrollTop+=f}if(this.containerList.scrollTop+this.containerList.offsetHeight===this.containerList.scrollHeight){babelHelpers.classPrivateFieldSet(this,v,false)}else{window.setTimeout(e.bind(this),20)}}).bind(this)()}},{key:"onBottomButtonMouseOut",value:function e(){babelHelpers.classPrivateFieldSet(this,v,false)}},{key:"onTopButtonMouseOver",value:function e(){if(babelHelpers.classPrivateFieldGet(this,b)){return}babelHelpers.classPrivateFieldSet(this,v,false);babelHelpers.classPrivateFieldSet(this,b,true);(function e(){if(!babelHelpers.classPrivateFieldGet(this,b)){return}if(this.containerList.scrollTop>0){this.containerList.scrollTop-=f}if(this.containerList.scrollTop===0){babelHelpers.classPrivateFieldSet(this,b,false)}else{window.setTimeout(e.bind(this),20)}}).bind(this)()}},{key:"onTopButtonMouseOut",value:function e(){babelHelpers.classPrivateFieldSet(this,b,false)}},{key:"onScroll",value:function e(){this.adjust()}},{key:"adjust",value:function e(){var t=this.containerList.offsetHeight;var i=this.containerList.scrollTop;var s=this.containerList.scrollHeight;if(i===0){n.Dom.hide(this.topScrollButton)}else{n.Dom.show(this.topScrollButton)}if(i+t===s){n.Dom.hide(this.bottomScrollButton)}else{n.Dom.show(this.bottomScrollButton)}}}],[{key:"getDefaultPopupOptions",value:function e(){return{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,cacheable:false}}}]);return e}();var v=new WeakMap;var b=new WeakMap;var m=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,e);this.value=t;this.id=i}babelHelpers.createClass(e,[{key:"setNode",value:function e(t){this.node=t}},{key:"getId",value:function e(){return this.id}},{key:"getNode",value:function e(){return this.node}},{key:"getInput",value:function e(){var t=this.getNode();if(!t){return null}if(t instanceof HTMLInputElement){return t}return t.querySelector("input")}},{key:"getValue",value:function e(){var t=this.getInput();if(t&&t.value){return t.value}return this.value||""}}]);return e}();function T(){var e=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t</label>\n\t\t\t</div>"]);T=function t(){return e};return e}function E(){var e=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element" type="checkbox">']);E=function t(){return e};return e}function L(){var e=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t</label>\n\t\t\t</div>"]);L=function t(){return e};return e}function F(){var e=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element" type="checkbox">']);F=function t(){return e};return e}function _(){var e=babelHelpers.taggedTemplateLiteral(['<div>\n\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">\n\t\t\t\t\t','\n\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t</label>\n\t\t\t</div>"]);_=function t(){return e};return e}function I(){var e=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element" type="checkbox">']);I=function t(){return e};return e}function y(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block"></div>']);y=function t(){return e};return e}function U(){var e=babelHelpers.taggedTemplateLiteral(['<div style="margin-bottom: 10px;" class="ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row">\n\t\t\t<input class="ui-ctl-element" type="text" value="','">\n\t\t\t<div class="ui-userfieldfactory-configurator-remove-enum" onclick="','"></div>\n\t\t</div>']);U=function t(){return e};return e}function C(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block">\n\t\t\t<div class="ui-userfieldfactory-configurator-title">\n\t\t\t\t<span class="ui-userfieldfactory-configurator-title-text">',"</span>\n\t\t\t</div>\n\t\t\t","\n\t\t\t","\n\t\t</div>"]);C=function t(){return e};return e}function S(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block-add-field">\n\t\t\t<span class="ui-userfieldfactory-configurator-add-button" onclick="','">',"</span>\n\t\t</div>"]);S=function t(){return e};return e}function k(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block"></div>']);k=function t(){return e};return e}function D(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block">\n\t\t\t',"","\n\t\t</div>"]);D=function t(){return e};return e}function R(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-btn ui-btn-light-border" onclick="','">',"</span>"]);R=function t(){return e};return e}function O(){var e=babelHelpers.taggedTemplateLiteral(['<span class="ui-btn ui-btn-primary" onclick="','">',"</span>"]);O=function t(){return e};return e}function M(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator-block">\n\t\t\t<div class="ui-userfieldfactory-configurator-title">\n\t\t\t\t<span class="ui-userfieldfactory-configurator-title-text">','</span>\n\t\t\t</div>\n\t\t\t<div class="ui-userfieldfactory-configurator-content">\n\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>"]);M=function t(){return e};return e}function B(){var e=babelHelpers.taggedTemplateLiteral(['<input class="ui-ctl-element" type="text" value="','" />']);B=function t(){return e};return e}function A(){var e=babelHelpers.taggedTemplateLiteral(['<div class="ui-userfieldfactory-configurator"></div>']);A=function t(){return e};return e}var H=function(){function e(t){babelHelpers.classCallCheck(this,e);if(n.Type.isPlainObject(t)){if(t.userField){this.userField=t.userField}if(n.Type.isFunction(t.onSave)){this.onSave=t.onSave}if(n.Type.isFunction(t.onCancel)){this.onCancel=t.onCancel}}this.enumItems=new Set}babelHelpers.createClass(e,[{key:"render",value:function e(){var t=this;this.node=n.Tag.render(A());this.labelInput=n.Tag.render(B(),n.Text.encode(this.userField.getTitle()));this.node.appendChild(n.Tag.render(M(),n.Loc.getMessage("UI_USERFIELD_FACTORY_CONFIGURATOR_FIELD_TITLE"),this.labelInput));if(this.userField.getUserTypeId()===o.getTypes().enumeration){this.node.appendChild(this.renderEnumeration())}this.node.appendChild(this.renderOptions());var i=function e(i){i.preventDefault();if(n.Type.isFunction(t.onSave)){t.onSave(t.saveField())}};var s=function e(i){i.preventDefault();if(n.Type.isFunction(t.onCancel)){t.onCancel()}else{t.node.style.display="none"}};this.saveButton=n.Tag.render(O(),i.bind(this),n.Loc.getMessage("UI_USERFIELD_SAVE"));this.cancelButton=n.Tag.render(R(),s.bind(this),n.Loc.getMessage("UI_USERFIELD_CANCEL"));this.node.appendChild(n.Tag.render(D(),this.saveButton,this.cancelButton));return this.node}},{key:"saveField",value:function e(){if(this.timeCheckbox){if(this.timeCheckbox.checked){this.userField.setUserTypeId(o.getTypes().datetime)}else{this.userField.setUserTypeId(o.getTypes().date)}}if(this.multipleCheckbox){this.userField.setIsMultiple(this.multipleCheckbox.checked)}this.userField.setTitle(this.labelInput.value);this.userField.setIsMandatory(this.mandatoryCheckbox.checked);this.saveEnumeration(this.userField,this.enumItems);return this.userField}},{key:"renderEnumeration",value:function e(){var t=this;this.enumItemsContainer=n.Tag.render(k());this.enumAddItemContainer=n.Tag.render(S(),function(){t.addEnumInput().focus()},n.Loc.getMessage("UI_USERFIELD_ADD"));this.enumContainer=n.Tag.render(C(),n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUM_ITEMS"),this.enumItemsContainer,this.enumAddItemContainer);this.userField.getEnumeration().forEach(function(e){t.addEnumInput(e)});this.addEnumInput();return this.enumContainer}},{key:"addEnumInput",value:function e(t){var i=this;var s;if(n.Type.isPlainObject(t)){s=new m(t.value,t.id)}else{s=new m}var r=n.Tag.render(U(),s.getValue(),function(e){e.preventDefault();i.deleteEnumItem(s)});s.setNode(r);this.enumItems.add(s);this.enumItemsContainer.appendChild(r);return r}},{key:"deleteEnumItem",value:function e(t){this.enumItemsContainer.removeChild(t.getNode());this.enumItems.delete(t)}},{key:"renderOptions",value:function e(){this.optionsContainer=n.Tag.render(y());this.mandatoryCheckbox=n.Tag.render(I());this.mandatoryCheckbox.checked=this.userField.isMandatory();this.optionsContainer.appendChild(n.Tag.render(_(),this.mandatoryCheckbox,n.Loc.getMessage("UI_USERFIELD_FACTORY_FIELD_REQUIRED")));if(!this.userField.isSaved()&&(this.userField.getUserTypeId()===o.getTypes().date||this.userField.getUserTypeId()===o.getTypes().datetime)){this.timeCheckbox=n.Tag.render(F());this.timeCheckbox.checked=this.userField.getUserTypeId()===o.getTypes().datetime;this.optionsContainer.appendChild(n.Tag.render(L(),this.timeCheckbox,n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENABLE_TIME")))}if(!this.userField.isSaved()&&this.userField.getUserTypeId()!==o.getTypes().boolean){this.multipleCheckbox=n.Tag.render(E());this.multipleCheckbox.checked=this.userField.isMultiple();this.optionsContainer.appendChild(n.Tag.render(T(),this.multipleCheckbox,n.Loc.getMessage("UI_USERFIELD_FACTORY_FIELD_MULTIPLE")))}return this.optionsContainer}},{key:"saveEnumeration",value:function e(t,i){var n=[];var s=100;i.forEach(function(e){n.push({value:e.getValue(),sort:s,id:e.getId()});s+=100});t.setEnumeration(n)}}]);return e}();var w=function(){function e(i){var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,e);t.EventEmitter.makeObservable(this,"BX.UI.UserFieldFactory.Factory");this.configuratorClass=H;if(n.Type.isString(i)&&i.length>0){this.entityId=i}if(n.Type.isPlainObject(s)){if(n.Type.isString(s.menuId)){this.menuId=s.menuId}if(!n.Type.isArray(s.types)){s.types=[]}if(n.Type.isDomNode(s.bindElement)){this.bindElement=s.bindElement}this.moduleId=s.moduleId;this.setCustomTypesUrl(s.customTypesUrl).setConfiguratorClass(s.configuratorClass)}else{s.types=[]}this.types=this.getFieldTypes().concat(s.types)}babelHelpers.createClass(e,[{key:"getFieldTypes",value:function e(){var t=[];Object.keys(o.getDescriptions()).forEach(function(e){t.push(babelHelpers.objectSpread({},o.getDescriptions()[e],{name:e}))});this.emit("OnGetUserTypes",{types:t});return t}},{key:"getMenu",value:function e(t){if(!n.Type.isPlainObject(t)){t={}}if(!n.Type.isDomNode(t.bindElement)){t.bindElement=this.bindElement}var i=this.types;if(this.customTypesUrl&&!this.isCustomTypeAdded){var s=babelHelpers.objectSpread({},o.getCustomTypeDescription());s.onClick=this.onCustomTypeClick.bind(this);i.push(s);this.isCustomTypeAdded=true}if(!this.menu){this.menu=new g(this.menuId,i,t)}return this.menu}},{key:"setConfiguratorClass",value:function e(t){var i=null;if(n.Type.isString(t)){i=n.Reflection.getClass(t)}else if(n.Type.isFunction(t)){i=t}if(n.Type.isFunction(i)&&i.prototype instanceof H){this.configuratorClass=i}}},{key:"setCustomTypesUrl",value:function e(t){this.customTypesUrl=t;return this}},{key:"getConfigurator",value:function e(t){return new this.configuratorClass(t)}},{key:"createUserField",value:function e(t,i){var o=babelHelpers.objectSpread({},l,a[t],{userTypeId:t});if(!n.Type.isString(i)||i.length<=0||i.length>r){i=this.generateFieldName()}o.fieldName=i;o.entityId=this.entityId;var u=new s.UserField(o,{moduleId:this.moduleId});u.setTitle(this.getDefaultLabel(t));this.emit("onCreateField",{userField:u});return u}},{key:"getDefaultLabel",value:function e(t){var i=n.Loc.getMessage("UI_USERFIELD_FACTORY_UF_LABEL");this.types.forEach(function(e){if(e.name===t&&n.Type.isString(e.defaultTitle)){i=e.defaultTitle}});return i}},{key:"generateFieldName",value:function e(){var t="UF_"+(this.entityId?this.entityId+"_":"");var i=(new Date).getTime().toString();if(t.length+i.length>r){i=i.substr(t.length+i.length-r)}t+=i;return t}},{key:"onCustomTypeClick",value:function e(){var t=this;if(!this.customTypesUrl){return}BX.SidePanel.Instance.open(this.customTypesUrl.toString(),{cacheable:false,allowChangeHistory:false,width:900,events:{onClose:function e(i){var n=i.getSlider();if(n){var r=n.getData().get("userFieldData");if(r){var o=s.UserField.unserialize(r);t.emit("onCreateCustomUserField",{userField:o})}}}}})}}]);return e}();e.Factory=w;e.FieldTypes=o;e.Configurator=H})(this.BX.UI.UserFieldFactory=this.BX.UI.UserFieldFactory||{},BX.Event,BX.Main,BX,BX.UI.UserField);
//# sourceMappingURL=userfieldfactory.bundle.map.js