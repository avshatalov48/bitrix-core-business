(function(e,i,s){"use strict";var t,a;function l(e,i){o(e,i);i.add(e)}function r(e,i,s){if(!i.has(e)){throw new TypeError("attempted to get private field on non-instance")}return s}function n(e,i,s){o(e,i);i.set(e,s)}function o(e,i){if(i.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var c=i.Reflection.namespace("BX.Ui.Form");var d=new WeakMap;var b=function e(i){var s=this;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"isOpen",false);n(this,d,{writable:true,value:[]});babelHelpers.defineProperty(this,"popupContainer",null);i.scopes.forEach((function(e){e.config=s;babelHelpers.classPrivateFieldGet(s,d).push(new BX.Ui.Form.ConfigItem(e))}),this);this.popupContainer=i.componentId};var p=new WeakMap;var v=new WeakMap;var h=new WeakMap;var u=new WeakMap;var m=new WeakMap;var f=new WeakMap;var H=new WeakMap;var C=new WeakSet;var F=new WeakSet;var I=new WeakSet;var g=new WeakSet;var T=new WeakSet;var P=new WeakSet;var w=new WeakSet;var k=new WeakSet;var E=function(e){babelHelpers.inherits(i,e);function i(e){var s;babelHelpers.classCallCheck(this,i);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));l(babelHelpers.assertThisInitialized(s),k);l(babelHelpers.assertThisInitialized(s),w);l(babelHelpers.assertThisInitialized(s),P);l(babelHelpers.assertThisInitialized(s),T);l(babelHelpers.assertThisInitialized(s),g);l(babelHelpers.assertThisInitialized(s),I);l(babelHelpers.assertThisInitialized(s),F);l(babelHelpers.assertThisInitialized(s),C);n(babelHelpers.assertThisInitialized(s),p,{writable:true,value:void 0});n(babelHelpers.assertThisInitialized(s),v,{writable:true,value:void 0});n(babelHelpers.assertThisInitialized(s),h,{writable:true,value:void 0});n(babelHelpers.assertThisInitialized(s),u,{writable:true,value:void 0});n(babelHelpers.assertThisInitialized(s),m,{writable:true,value:void 0});n(babelHelpers.assertThisInitialized(s),f,{writable:true,value:"BX.Ui.Form.ConfigItem:onComponentOpen"});n(babelHelpers.assertThisInitialized(s),H,{writable:true,value:"BX.Main.SelectorV2:reInitDialog"});s.setEventNamespace("BX.Ui.Form");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),p,e["scopeId"]||null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),v,e["members"]||null);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),h,BX("ui-editor-config-".concat(babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(s),p))));babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),u,{});s.drawingIconsLimit=e["drawingIconsLimit"]||10;babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(s),m,e["moduleId"]||null);s.config=e["config"]||null;r(babelHelpers.assertThisInitialized(s),C,z).call(babelHelpers.assertThisInitialized(s));s.addToAccessCodesHandler=BX.delegate(s.onAddToAccessCodes,babelHelpers.assertThisInitialized(s));s.removeFromAccessCodesHandler=BX.delegate(s.onRemoveFromAccessCodes,babelHelpers.assertThisInitialized(s));s.closePopupHandler=BX.delegate(s.onClosePopup,babelHelpers.assertThisInitialized(s));BX.addCustomEvent("Grid::updated",s.onGridUpdate.bind(babelHelpers.assertThisInitialized(s)));setTimeout((function(){BX.onCustomEvent("BX.Ui.Form.ConfigItem:onComponentLoad",[{openDialogWhenInit:false}])}),100);return s}babelHelpers.createClass(i,[{key:"onGridUpdate",value:function e(i){r(this,k,U).call(this)}},{key:"onClosePopup",value:function e(i){this.config.isOpen=false;r(this,w,y).call(this)}},{key:"onAddToAccessCodes",value:function e(i){var s=this;if(i.data.state==="select"){var t=i.data.item.id;babelHelpers.classPrivateFieldGet(this,u)[t]=i.data.entityType}BX.ajax.runComponentAction("bitrix:ui.form.config","updateScopeAccessCodes",{data:{moduleId:babelHelpers.classPrivateFieldGet(this,m),scopeId:babelHelpers.classPrivateFieldGet(this,p),accessCodes:babelHelpers.classPrivateFieldGet(this,u)}}).then((function(e){r(s,k,U).call(s,e.data)}))}},{key:"onRemoveFromAccessCodes",value:function e(i){var s=i.data.item.id;delete babelHelpers.classPrivateFieldGet(this,u)[s];this.onAddToAccessCodes(i)}}],[{key:"onMemberSelect",value:function e(i){if(i.state==="select"){s.EventEmitter.emit("BX.Ui.Form.ConfigItem:addToAccessCodes",i)}}},{key:"onDialogClose",value:function e(i){s.EventEmitter.emit("BX.Ui.Form.ConfigItem:closePopup",i)}},{key:"onMemberUnselect",value:function e(i){s.EventEmitter.emit("BX.Ui.Form.ConfigItem:removeFromAccessCodes",i)}}]);return i}(s.EventEmitter);function z(){if(babelHelpers.classPrivateFieldGet(this,v)){var e=0;for(var i in babelHelpers.classPrivateFieldGet(this,v)){var s=babelHelpers.classPrivateFieldGet(this,v)[i];babelHelpers.classPrivateFieldGet(this,h).appendChild(r(this,F,B).call(this,s));if(e++>this.drawingIconsLimit){break}}}babelHelpers.classPrivateFieldGet(this,h).appendChild(r(this,I,G).call(this))}function B(e){var s=e.avatar?i.Tag.render(t||(t=babelHelpers.taggedTemplateLiteral(['<a href="','" class="ui-editor-config-item-avatar"  title="','" style="background-image: url(\'',"')\"></a>"])),e.url,i.Text.encode(e.name),e.avatar):i.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<a href="','" class="ui-icon ui-icon-xs ui-icon-common-user" title="','"><i></i></a>'])),e.url,i.Text.encode(e.name));return i.Dom.create("div",{attrs:{class:"ui-editor-config-item"},children:[s]})}function G(){var e=this;return i.Dom.create("div",{events:{click:function i(s){if(!e.config.isOpen){r(e,g,X).call(e)}}},attrs:{class:"ui-editor-config-item ui-editor-config-item--add"}})}function X(){this.config.isOpen=true;r(this,T,A).call(this);var e=BX.Main.selectorManagerV2.controls[this.config.popupContainer].selectorInstance;e.itemsSelected={};BX.onCustomEvent(babelHelpers.classPrivateFieldGet(this,f),[{id:this.config.popupContainer,bindNode:babelHelpers.classPrivateFieldGet(this,h)}]);BX.onCustomEvent(babelHelpers.classPrivateFieldGet(this,H),[{selectorId:this.config.popupContainer,selectedItems:i.Runtime.clone(r(this,P,S).call(this))}])}function A(){s.EventEmitter.subscribe("BX.Ui.Form.ConfigItem:addToAccessCodes",this.addToAccessCodesHandler);s.EventEmitter.subscribe("BX.Ui.Form.ConfigItem:removeFromAccessCodes",this.removeFromAccessCodesHandler);s.EventEmitter.subscribe("BX.Ui.Form.ConfigItem:closePopup",this.closePopupHandler)}function S(){if(babelHelpers.classPrivateFieldGet(this,v)&&!i.Type.isArrayFilled(Object.keys(babelHelpers.classPrivateFieldGet(this,u)))){var e={};for(var s in babelHelpers.classPrivateFieldGet(this,v)){e[s]=babelHelpers.classPrivateFieldGet(this,v)[s].type.toUpperCase()}babelHelpers.classPrivateFieldSet(this,u,e)}return babelHelpers.classPrivateFieldGet(this,u)||{}}function y(){s.EventEmitter.unsubscribe("BX.Ui.Form.ConfigItem:addToAccessCodes",this.addToAccessCodesHandler);s.EventEmitter.unsubscribe("BX.Ui.Form.ConfigItem:removeFromAccessCodes",this.removeFromAccessCodesHandler);s.EventEmitter.unsubscribe("BX.Ui.Form.ConfigItem:closePopup",this.closePopupHandler)}function U(e){babelHelpers.classPrivateFieldSet(this,h,BX("ui-editor-config-".concat(babelHelpers.classPrivateFieldGet(this,p))));if(e){babelHelpers.classPrivateFieldSet(this,v,e)}if(babelHelpers.classPrivateFieldGet(this,h)){while(babelHelpers.classPrivateFieldGet(this,h).firstChild){babelHelpers.classPrivateFieldGet(this,h).removeChild(babelHelpers.classPrivateFieldGet(this,h).firstChild)}r(this,C,z).call(this)}}c.Config=b;c.ConfigItem=E})(this.window=this.window||{},BX,BX.Event);
//# sourceMappingURL=script.map.js