{"version":3,"file":"errorbox.bundle.js","sources":["../src/errorbox.js"],"sourcesContent":["import {Loc, Tag} from 'main.core';\nimport './css/style.css';\n\nexport class ErrorBox\n{\n\t#wrapper;\n\t#errorLink;\n\t#errorBoxWasRendered = false;\n\t#errorBoxNode = null;\n\t#mailboxId;\n\n\tconstructor(config)\n\t{\n\t\tconst {\n\t\t\twrapper = [],\n\t\t\terrorLink = '',\n\t\t\tcurrentMailboxId = null,\n\t\t} = config;\n\n\t\tif (currentMailboxId !== null)\n\t\t{\n\t\t\tthis.#mailboxId = Number(currentMailboxId);\n\t\t}\n\n\t\tthis.#wrapper = wrapper;\n\t\tthis.#errorLink = errorLink;\n\n\t\ttop.BX.addCustomEvent(\"MailClient:syncWasSuccessful\", (data) => {\n\t\t\tconst {\n\t\t\t\tmailboxId,\n\t\t\t} = data;\n\n\t\t\tif (mailboxId !== undefined && this.#mailboxId === Number(mailboxId))\n\t\t\t{\n\t\t\t\tthis.destroy();\n\t\t\t}\n\t\t});\n\n\t\ttop.BX.addCustomEvent(\"MailClient:syncFailedWithErrors\", (data) => {\n\n\t\t\tconst {\n\t\t\t\tmailboxId,\n\t\t\t} = data;\n\n\t\t\tif (mailboxId !== undefined && this.#mailboxId === Number(mailboxId))\n\t\t\t{\n\t\t\t\tBX.ajax.runComponentAction('bitrix:mail.client.message.list', 'getLastMailboxSyncIsSuccessStatus', {\n\t\t\t\t\tmode: 'class',\n\t\t\t\t\tdata:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmailboxId,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t).then((response) => {\n\t\t\t\t\tconst {\n\t\t\t\t\t\tdata,\n\t\t\t\t\t} = response;\n\n\t\t\t\t\tif (data === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.build();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.#errorBoxWasRendered === true && this.#errorBoxNode !== undefined)\n\t\t{\n\t\t\tthis.#errorBoxNode.remove();\n\t\t\tthis.#errorBoxWasRendered = false;\n\t\t\tthis.#errorBoxNode = null;\n\t\t}\n\t}\n\n\tbuild()\n\t{\n\t\tif (this.#errorBoxWasRendered === false)\n\t\t{\n\t\t\tlet message = Loc.getMessage(\"MAIL_ERROR_BOX_MAILBOX_CONNECTION_ERROR\");\n\t\t\tmessage = message.replace('[link]', `<a href='${this.#errorLink}' target='_blank'>`);\n\t\t\tmessage = message.replace('[/link]', '</a>');\n\n\t\t\tconst errorBox = Tag.render`\n\t\t\t<div class=\"ui-alert ui-alert-danger ui-alert-icon-danger ui-alert-mail-error-box\">\n\t\t\t\t<span class=\"ui-alert-message\">${message}</span>\n\t\t\t</div>`;\n\n\t\t\tthis.#wrapper.prepend(errorBox);\n\t\t\tthis.#errorBoxNode = errorBox;\n\n\t\t\tthis.#errorBoxWasRendered = true;\n\t\t}\n\t}\n}"],"names":["ErrorBox","config","babelHelpers","_classPrivateFieldInitSpec","writable","value","wrapper","_config$errorLink","errorLink","_config$currentMailbo","currentMailboxId","Number","top","BX","addCustomEvent","data","mailboxId","undefined","_this","destroy","ajax","runComponentAction","mode","then","response","build","key","remove","message","Loc","getMessage","replace","this","errorBox","Tag","render","prepend"],"mappings":"uOACyB,0EAEZA,aAQZ,WAAYC,GACZ,WAAAC,oCAAAC,UAAAC,YAAAC,eAAAF,UAAAC,YAAAC,eAAAF,UAAAC,YAAAC,OALuB,IAAKF,UAAAC,YAAAC,MACZ,OAAIF,UAAAC,YAAAC,eAKnB,MAIIJ,EAHHK,QAAAA,aAAU,KAAEC,EAGTN,EAFHO,UAAAA,aAAY,KAAEC,EAEXR,EADHS,iBAAAA,aAAmB,OAGK,OAArBA,GAEHR,yCAAkBS,OAAOD,IAG1BR,yCAAgBI,GAChBJ,yCAAkBM,GAElBI,IAAIC,GAAGC,eAAe,gCAAgC,SAACC,GACtD,IACCC,EACGD,EADHC,eAGiBC,IAAdD,GAA2Bd,yCAAoBS,OAAOK,IAEzDE,EAAKC,aAIPP,IAAIC,GAAGC,eAAe,mCAAmC,SAACC,GAEzD,IACCC,EACGD,EADHC,eAGiBC,IAAdD,GAA2Bd,yCAAoBS,OAAOK,IAEzDH,GAAGO,KAAKC,mBAAmB,kCAAmC,oCAAqC,CAClGC,KAAM,QACNP,KACC,CACCC,UAAAA,KAGDO,MAAK,SAACC,GACP,IACCT,EACGS,EADHT,MAGY,IAATA,GAEHG,EAAKO,SAGO,IAATV,GAEHG,EAAKC,gBAmCT,OA9BAjB,6BAAAwB,cAAArB,kBAIkC,IAA9BH,gDAA6De,IAAvBf,4CAEzCA,0CAAmByB,SACnBzB,0CAA4B,GAC5BA,yCAAqB,UAEtBwB,YAAArB,iBAIA,IAAkC,IAA9BH,0CACJ,CACC,IAAI0B,EAAUC,MAAIC,WAAW,2CAE7BF,GADAA,EAAUA,EAAQG,QAAQ,8DAAsBC,gCAC9BD,QAAQ,UAAW,QAErC,IAAME,EAAWC,MAAIC,mNAEaP,GAGlC1B,0CAAckC,QAAQH,GACtB/B,yCAAqB+B,GAErB/B,0CAA4B"}