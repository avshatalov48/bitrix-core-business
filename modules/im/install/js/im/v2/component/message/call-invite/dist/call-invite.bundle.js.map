{"version":3,"file":"call-invite.bundle.js","sources":["../src/call-invite.js"],"sourcesContent":["import { Messenger } from 'im.public';\nimport { ChatActionType } from 'im.v2.const';\nimport { CallManager } from 'im.v2.lib.call';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { Type } from 'main.core';\n\nimport { Button as ButtonComponent, ButtonSize, ButtonIcon } from 'im.v2.component.elements';\nimport { BaseMessage } from 'im.v2.component.message.base';\nimport { MessageHeader, DefaultMessageContent } from 'im.v2.component.message.elements';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport './css/call-invite.css';\n\nimport type { CustomColorScheme } from 'im.v2.component.elements';\nimport type { ImModelMessage } from 'im.v2.model';\n\ntype ComponentParams = {\n\tlink: string,\n};\n\nconst BUTTON_COLOR = '#00ace3';\n\n// @vue/component\nexport const CallInviteMessage = {\n\tname: 'CallInviteMessage',\n\tcomponents: {\n\t\tButtonComponent,\n\t\tBaseMessage,\n\t\tDefaultMessageContent,\n\t\tMessageHeader,\n\t},\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonIcon: () => ButtonIcon,\n\t\tbuttonColorScheme(): CustomColorScheme\n\t\t{\n\t\t\treturn {\n\t\t\t\tbackgroundColor: 'transparent',\n\t\t\t\tborderColor: BUTTON_COLOR,\n\t\t\t\ticonColor: BUTTON_COLOR,\n\t\t\t\ttextColor: BUTTON_COLOR,\n\t\t\t\thoverColor: 'transparent',\n\t\t\t};\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tcomponentParams(): ComponentParams\n\t\t{\n\t\t\treturn this.item.componentParams;\n\t\t},\n\t\tcanSetReactions(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.message.id);\n\t\t},\n\t\tisAvailable(): boolean\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.$store.getters['recent/calls/hasActiveCall'](this.dialogId)\n\t\t\t\t&& CallManager.getInstance().getCurrentCallDialogId() === this.dialogId\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (this.$store.getters['recent/calls/hasActiveCall']())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst chatCanBeCalled = CallManager.getInstance().chatCanBeCalled(this.dialogId);\n\t\t\tconst chatIsAllowedToCall = PermissionManager.getInstance().canPerformAction(ChatActionType.call, this.dialogId);\n\n\t\t\treturn chatCanBeCalled && chatIsAllowedToCall;\n\t\t},\n\t\tinviteTitle(): string\n\t\t{\n\t\t\treturn this.loc('IM_MESSENGER_MESSAGE_CALL_INVITE_TITLE_2');\n\t\t},\n\t\tdescriptionTitle(): string\n\t\t{\n\t\t\treturn this.loc('IM_MESSENGER_MESSAGE_CALL_INVITE_DESCRIPTION');\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonCallButtonClick($event)\n\t\t{\n\t\t\tif (Utils.key.isAltOrOption($event))\n\t\t\t{\n\t\t\t\tUtils.browser.openLink(this.componentParams.link);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tMessenger.startVideoCall(this.dialogId);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BaseMessage :dialogId=\"dialogId\" :item=\"item\">\n\t\t\t<div class=\"bx-im-message-call-invite__scope bx-im-message-call-invite__container\">\n\t\t\t\t<MessageHeader :withTitle=\"withTitle\" :item=\"item\" />\n\t\t\t\t<div class=\"bx-im-message-call-invite__content-container\">\n\t\t\t\t\t<div class=\"bx-im-message-call-invite__image\"></div>\n\t\t\t\t\t<div class=\"bx-im-message-call-invite__content\">\n\t\t\t\t\t\t<div class=\"bx-im-message-call-invite__title\">\n\t\t\t\t\t\t\t{{ inviteTitle }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-message-call-invite__description\">\n\t\t\t\t\t\t\t{{ descriptionTitle }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"isAvailable\" class=\"bx-im-message-call-invite__buttons_container\">\n\t\t\t\t\t\t\t<div class=\"bx-im-message-call-invite__buttons_item\">\n\t\t\t\t\t\t\t\t<ButtonComponent\n\t\t\t\t\t\t\t\t\t:size=\"ButtonSize.L\"\n\t\t\t\t\t\t\t\t\t:icon=\"ButtonIcon.Call\"\n\t\t\t\t\t\t\t\t\t:customColorScheme=\"buttonColorScheme\"\n\t\t\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t\t\t:text=\"loc('IM_MESSENGER_MESSAGE_CALL_INVITE_BUTTON_JOIN')\"\n\t\t\t\t\t\t\t\t\t@click=\"onCallButtonClick\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<DefaultMessageContent :item=\"item\" :dialogId=\"dialogId\" :withText=\"false\" :withAttach=\"false\" />\n\t\t\t</div>\n\t\t</BaseMessage>\n\t`,\n};\n"],"names":["BUTTON_COLOR","CallInviteMessage","name","components","ButtonComponent","BaseMessage","DefaultMessageContent","MessageHeader","props","item","type","Object","required","dialogId","String","withTitle","Boolean","default","computed","ButtonSize","ButtonIcon","buttonColorScheme","backgroundColor","borderColor","iconColor","textColor","hoverColor","message","componentParams","canSetReactions","Type","isNumber","id","isAvailable","$store","getters","CallManager","getInstance","getCurrentCallDialogId","chatCanBeCalled","chatIsAllowedToCall","PermissionManager","canPerformAction","ChatActionType","call","inviteTitle","loc","descriptionTitle","methods","phraseCode","replacements","$Bitrix","Loc","getMessage","onCallButtonClick","$event","Utils","key","isAltOrOption","browser","openLink","link","Messenger","startVideoCall","template"],"mappings":";;;;;;;;CAoBA,MAAMA,YAAY,GAAG,SAAS;;CAE9B;AACA,OAAaC,iBAAiB,GAAG;GAChCC,IAAI,EAAE,mBAAmB;GACzBC,UAAU,EAAE;sBACXC,+BAAe;kBACfC,wCAAW;4BACXC,sDAAqB;oBACrBC;IACA;GACDC,KAAK,EACL;KACCC,IAAI,EAAE;OACLC,IAAI,EAAEC,MAAM;OACZC,QAAQ,EAAE;MACV;KACDC,QAAQ,EAAE;OACTH,IAAI,EAAEI,MAAM;OACZF,QAAQ,EAAE;MACV;KACDG,SAAS,EAAE;OACVL,IAAI,EAAEM,OAAO;OACbC,OAAO,EAAE;;IAEV;GACDC,QAAQ,EACR;KACCC,UAAU,EAAE,MAAMA,mCAAU;KAC5BC,UAAU,EAAE,MAAMA,mCAAU;KAC5BC,iBAAiB,GACjB;OACC,OAAO;SACNC,eAAe,EAAE,aAAa;SAC9BC,WAAW,EAAEvB,YAAY;SACzBwB,SAAS,EAAExB,YAAY;SACvByB,SAAS,EAAEzB,YAAY;SACvB0B,UAAU,EAAE;QACZ;MACD;KACDC,OAAO,GACP;OACC,OAAO,IAAI,CAAClB,IAAI;MAChB;KACDmB,eAAe,GACf;OACC,OAAO,IAAI,CAACnB,IAAI,CAACmB,eAAe;MAChC;KACDC,eAAe,GACf;OACC,OAAOC,cAAI,CAACC,QAAQ,CAAC,IAAI,CAACJ,OAAO,CAACK,EAAE,CAAC;MACrC;KACDC,WAAW,GACX;OACC,IACC,IAAI,CAACC,MAAM,CAACC,OAAO,CAAC,4BAA4B,CAAC,CAAC,IAAI,CAACtB,QAAQ,CAAC,IAC7DuB,0BAAW,CAACC,WAAW,EAAE,CAACC,sBAAsB,EAAE,KAAK,IAAI,CAACzB,QAAQ,EAExE;SACC,OAAO,IAAI;;OAGZ,IAAI,IAAI,CAACqB,MAAM,CAACC,OAAO,CAAC,4BAA4B,CAAC,EAAE,EACvD;SACC,OAAO,KAAK;;OAGb,MAAMI,eAAe,GAAGH,0BAAW,CAACC,WAAW,EAAE,CAACE,eAAe,CAAC,IAAI,CAAC1B,QAAQ,CAAC;OAChF,MAAM2B,mBAAmB,GAAGC,sCAAiB,CAACJ,WAAW,EAAE,CAACK,gBAAgB,CAACC,0BAAc,CAACC,IAAI,EAAE,IAAI,CAAC/B,QAAQ,CAAC;OAEhH,OAAO0B,eAAe,IAAIC,mBAAmB;MAC7C;KACDK,WAAW,GACX;OACC,OAAO,IAAI,CAACC,GAAG,CAAC,0CAA0C,CAAC;MAC3D;KACDC,gBAAgB,GAChB;OACC,OAAO,IAAI,CAACD,GAAG,CAAC,8CAA8C,CAAC;;IAEhE;GACDE,OAAO,EACP;KACCF,GAAG,CAACG,UAAkB,EAAEC,YAAmC,GAAG,EAAE,EAChE;OACC,OAAO,IAAI,CAACC,OAAO,CAACC,GAAG,CAACC,UAAU,CAACJ,UAAU,EAAEC,YAAY,CAAC;MAC5D;KACDI,iBAAiB,CAACC,MAAM,EACxB;OACC,IAAIC,qBAAK,CAACC,GAAG,CAACC,aAAa,CAACH,MAAM,CAAC,EACnC;SACCC,qBAAK,CAACG,OAAO,CAACC,QAAQ,CAAC,IAAI,CAAChC,eAAe,CAACiC,IAAI,CAAC;QACjD,MAED;SACCC,mBAAS,CAACC,cAAc,CAAC,IAAI,CAAClD,QAAQ,CAAC;;;IAGzC;GACDmD,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA+BZ,CAAC;;;;;;;;"}