this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};(function(t,e,s){"use strict";var n={props:["value","popupInstance"],data:function t(){return{chat:{},hasError:false,requestFinished:false}},created:function t(){var e=this.getChat(this.value);if(e){this.chat=e;this.requestFinished=true}else{this.requestChatData(this.value)}},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.popupInstance.destroy()},methods:{getChat:function t(e){return this.$store.getters["dialogues/get"](e)},requestChatData:function t(e){var n=this;this.$Bitrix.RestClient.get().callMethod(s.RestMethod.imChatGet,{dialog_id:e}).then((function(t){n.$Bitrix.Data.get("controller").executeRestAnswer(s.RestMethodHandler.imChatGet,t);n.chat=n.getChat(n.value);n.requestFinished=true}))["catch"]((function(t){n.hasError=true;console.error(t);n.requestFinished=true}))},onOpenChat:function t(e){this.popupInstance.destroy();BXIM.openMessenger(this.value)},onOpenHistory:function t(e){this.popupInstance.destroy();BXIM.openHistory(this.value)}},computed:{avatarStyles:function t(){var e={};if(this.emptyAvatar){e.backgroundColor=this.chat.color}return e},chatAvatar:function t(){if(this.emptyAvatar){return"/bitrix/js/im/images/blank.gif"}else{return this.chat.avatar}},emptyAvatar:function t(){return this.chat.avatar===""||this.chat.avatar.indexOf("/bitrix/js/im/images/blank.gif")>=0}},template:'\n\t\t<div class="bx-messenger-external-data" style="width: 272px; max-width: 272px; height: 100px;">\n\t\t\t<div v-if="requestFinished && !hasError">\n\t\t\t\t<div class="bx-messenger-external-avatar">\n\t\t\t\t\t<div class="bx-messenger-panel-avatar bx-messenger-panel-avatar-chat">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t:src="chatAvatar"\n\t\t\t\t\t\t\t:alt="chat.name"\n\t\t\t\t\t\t\t:style="avatarStyles"\n\t\t\t\t\t\t\t:class="[emptyAvatar ? \'bx-messenger-panel-avatar-img-default\' : \'\', \'bx-messenger-panel-avatar-img\']"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span v-if="chat.extranet" class="bx-messenger-panel-title"><div class="bx-messenger-user-extranet">{{ chat.name }}</div></span>\n\t\t\t\t\t<span v-else class="bx-messenger-panel-title">{{ chat.name }}</span>\n\t\t\t\t\t<span class="bx-messenger-panel-desc">{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_GROUP_CHAT\') }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-messenger-external-data-buttons">\n\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenChat">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_OPEN_CHAT\') }}\n\t\t\t\t</span>\n\t\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenHistory">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_OPEN_HISTORY\') }}\n\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span v-else-if="!requestFinished && !hasError" class="bx-messenger-content-load-img"></span>\n\t\t\t<div v-else-if="requestFinished && hasError">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_NO_ACCESS\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};var a={props:["value","popupInstance"],data:function t(){return{user:{},hasError:false,requestFinished:false}},created:function t(){var e=this.getUser(this.value);if(e){this.user=e;this.requestFinished=true}else{this.requestUserData(this.value)}},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.popupInstance.destroy()},methods:{getUser:function t(e){return this.$store.getters["users/get"](e)},requestUserData:function t(e){var n=this;this.$Bitrix.RestClient.get().callMethod(s.RestMethod.imUserGet,{ID:e}).then((function(t){n.$Bitrix.Data.get("controller").executeRestAnswer(s.RestMethodHandler.imUserGet,t);n.user=n.getUser(n.value);n.requestFinished=true}))["catch"]((function(t){n.hasError=true;console.error(t);n.requestFinished=true}))},onOpenChat:function t(e){this.popupInstance.destroy();BXIM.openMessenger(this.value)},onOpenHistory:function t(e){this.popupInstance.destroy();BXIM.openHistory(this.value)}},computed:{avatarStyles:function t(){var e={};if(this.emptyAvatar){e.backgroundColor=this.chat.color}return e},userAvatar:function t(){if(this.emptyAvatar){return"/bitrix/js/im/images/blank.gif"}else{return this.user.avatar}},emptyAvatar:function t(){return this.user.avatar===""||this.user.avatar.indexOf("/bitrix/js/im/images/blank.gif")>=0},botStyles:function t(){return"bx-messenger-user-bot"},userStatusText:function t(){return BX.MessengerCommon.getUserStatus(this.user.id,false).statusText},userStatusClass:function t(){return"bx-messenger-panel-avatar-status-"+BX.MessengerCommon.getUserStatus(this.user.id,true)},userPosition:function t(){return BX.MessengerCommon.getUserPosition(this.user.id)}},template:'\n\t\t<div class="bx-messenger-external-data" style="width: 272px; max-width: 272px; height: 100px;">\n\t\t\t<div v-if="requestFinished && !hasError">\n\t\t\t\t<div class="bx-messenger-external-avatar">\n\t\t\t\t\t<div :class="[userStatusClass, \'bx-messenger-panel-avatar\']">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t:src="userAvatar"\n\t\t\t\t\t\t\t:style="avatarStyles"\n\t\t\t\t\t\t\t:class="[emptyAvatar ? \'bx-messenger-panel-avatar-img-default\' : \'\', \'bx-messenger-panel-avatar-img\']"\n\t\t\t\t\t\t\t:alt="user.name"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span :title="userStatusText" class="bx-messenger-panel-avatar-status"></span>\n\t\t\t\t\t</div>\n\t\n\t\t\t\t\t<span v-if="user.extranet" class="bx-messenger-panel-title"><div class="bx-messenger-user-extranet">{{ user.name }}</div></span>\n\t\t\t\t\t<span v-else-if="user.bot" class="bx-messenger-panel-title"><div :class="botStyles">{{ user.name }}</div></span>\n\t\t\t\t\t<span v-else class="bx-messenger-panel-title">{{ user.name }}</span>\n\t\n\t\t\t\t\t<span class="bx-messenger-panel-desc">{{ userPosition }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-messenger-external-data-buttons">\n\t\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenChat">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_USER_OPEN_CHAT\') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="bx-notifier-item-button bx-notifier-item-button-white" @click="onOpenHistory">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_OPEN_HISTORY\') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span v-else-if="!requestFinished && !hasError" class="bx-messenger-content-load-img"></span>\n\t\t\t<div v-else-if="requestFinished && hasError">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_NO_ACCESS\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};var r={props:["value","popupInstance"],data:function t(){return{users:{},hasError:false,requestFinished:false}},created:function t(){var e=this.isNeedUserRequest(this.value);if(e){this.requestUserData(this.value)}else
//!needRequest
{this.users=this.getUsersForPopup();this.requestFinished=true}},mounted:function t(){this.popupInstance.show()},beforeDestroy:function t(){this.popupInstance.destroy()},computed:{popupHeight:function t(){var e=this.value.length*30;if(e>150){e=150}return e+"px"}},methods:{getUser:function t(e){return this.$store.getters["users/get"](e)},getUsersForPopup:function t(){var e=this;return this.value.map((function(t){return e.getUser(t)}))},getUserAvatar:function t(e){if(this.isEmptyAvatar(e)){return"/bitrix/js/im/images/blank.gif"}else{return e.avatar}},isEmptyAvatar:function t(e){return e.avatar===""||e.avatar.indexOf("/bitrix/js/im/images/blank.gif")>=0},getAvatarStyles:function t(e){var s={};if(this.isEmptyAvatar(e)){s.backgroundColor=e.color}return s},getUserStatusClass:function t(e){return"bx-notifier-popup-avatar-status-".concat(e.status)},isNeedUserRequest:function t(e){for(var s=0;s<e.length;s++){if(!this.getUser(e[s])){return true}}return false},requestUserData:function t(e){var n=this;this.$Bitrix.RestClient.get().callMethod(s.RestMethod.imUserListGet,{ID:e}).then((function(t){n.$Bitrix.Data.get("controller").executeRestAnswer(s.RestMethodHandler.imUserListGet,t);n.users=n.getUsersForPopup();n.requestFinished=true}))["catch"]((function(t){n.hasError=true;console.error(t);n.requestFinished=true}))},onUserClick:function t(e){this.popupInstance.destroy();BXIM.openMessenger(e)}},template:'\n\t\t<div\n\t\t\tclass="bx-im-vue-popup-container" \n\t\t\t:style="{height: popupHeight, width: \'180px\', display: \'flex\', alignItems: \'center\', justifyContent: \'center\'}"\n\t\t>\n\t\t\t<span v-if="requestFinished && !hasError" class="bx-notifier-item-help-popup">\n\t\t\t\t<a \n\t\t\t\t\tv-for="user in users"\n\t\t\t\t\tclass="bx-notifier-item-help-popup-img"\n\t\t\t\t\t@click.prevent="onUserClick(user.id)"\n\t\t\t\t>\n\t\t\t\t\t<span :class="[getUserStatusClass(user), \'bx-notifier-popup-avatar\']">\n\t\t\t\t\t\t<img \n\t\t\t\t\t\t\t:src="getUserAvatar(user)"\n\t\t\t\t\t\t\t:class="[\'bx-notifier-popup-avatar-img\', isEmptyAvatar(user) ? \'bx-notifier-popup-avatar-img-default\' : \'\']"\n\t\t\t\t\t\t\t:style="getAvatarStyles(user)"\n\t\t\t\t\t\t\t:alt="user.name"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span \n\t\t\t\t\t\t:class="[\'bx-notifier-item-help-popup-name\', user.extranet ? \'bx-notifier-popup-avatar-extranet\' : \'\']"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ user.name }}\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t\t<span v-else-if="!requestFinished && !hasError" class="bx-messenger-content-load-img"></span>\n\t\t\t<div v-else-if="requestFinished && hasError">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'IM_VIEW_POPUP_CONTENT_NO_ACCESS\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};var i={props:["type","value","popupInstance"],components:{Chat:n,User:a,Users:r},template:'\n\t\t<component :is="type" :value="value" :popupInstance="popupInstance"/>\n\t'};t.Popup=i})(this.BX.Messenger.View=this.BX.Messenger.View||{},BX,BX.Messenger.Const);
//# sourceMappingURL=popup.bundle.map.js