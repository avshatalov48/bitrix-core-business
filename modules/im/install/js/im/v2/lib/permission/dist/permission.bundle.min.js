this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,r,t,i){"use strict";const a={[i.ActionByRole.readMessage]:i.UserRole.member,[i.ActionByRole.setReaction]:i.UserRole.member,[i.ActionByRole.openMessageMenu]:i.UserRole.member,[i.ActionByRole.openAvatarMenu]:i.UserRole.member,[i.ActionByRole.openSidebarMenu]:i.UserRole.member,[i.ActionByRole.subscribeToComments]:i.UserRole.member,[i.ActionByRole.openComments]:i.UserRole.guest,[i.ActionByRole.openSidebar]:i.UserRole.guest};const l="default";var o=babelHelpers.classPrivateFieldLooseKey("instance");var n=babelHelpers.classPrivateFieldLooseKey("rolePermissions");var c=babelHelpers.classPrivateFieldLooseKey("chatTypePermissions");var b=babelHelpers.classPrivateFieldLooseKey("userTypePermissions");var p=babelHelpers.classPrivateFieldLooseKey("actionGroups");var v=babelHelpers.classPrivateFieldLooseKey("actionGroupsDefaultRoles");var u=babelHelpers.classPrivateFieldLooseKey("init");var d=babelHelpers.classPrivateFieldLooseKey("canPerformActionByRole");var P=babelHelpers.classPrivateFieldLooseKey("canPerformActionByChatType");var y=babelHelpers.classPrivateFieldLooseKey("canPerformActionByChatSettings");var h=babelHelpers.classPrivateFieldLooseKey("getGroupByAction");var B=babelHelpers.classPrivateFieldLooseKey("prepareChatTypePermissions");var f=babelHelpers.classPrivateFieldLooseKey("checkMinimalRole");var L=babelHelpers.classPrivateFieldLooseKey("getDialog");var F=babelHelpers.classPrivateFieldLooseKey("getUserType");var H=babelHelpers.classPrivateFieldLooseKey("handleKickAndLeaveActionType");class g{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,o)[o]){babelHelpers.classPrivateFieldLooseBase(this,o)[o]=new this}return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}static init(){g.getInstance()}constructor(){Object.defineProperty(this,H,{value:C});Object.defineProperty(this,F,{value:T});Object.defineProperty(this,L,{value:M});Object.defineProperty(this,f,{value:K});Object.defineProperty(this,B,{value:j});Object.defineProperty(this,h,{value:O});Object.defineProperty(this,y,{value:U});Object.defineProperty(this,P,{value:A});Object.defineProperty(this,d,{value:R});Object.defineProperty(this,u,{value:m});Object.defineProperty(this,n,{writable:true,value:{}});Object.defineProperty(this,c,{writable:true,value:{}});Object.defineProperty(this,b,{writable:true,value:{}});Object.defineProperty(this,p,{writable:true,value:{}});Object.defineProperty(this,v,{writable:true,value:{}});const{permissions:e}=r.Core.getApplicationData();t.Logger.warn("PermissionManager: permission from server",e);babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)}canPerformActionByRole(e,s){return babelHelpers.classPrivateFieldLooseBase(this,d)[d](e,s)&&babelHelpers.classPrivateFieldLooseBase(this,P)[P](e,s)&&babelHelpers.classPrivateFieldLooseBase(this,y)[y](e,s)}canPerformActionByUserType(e){var s;const t=babelHelpers.classPrivateFieldLooseBase(this,F)[F](r.Core.getUserId());const a=babelHelpers.classPrivateFieldLooseBase(this,b)[b][t];if(!e||!a){return true}const l=i.ActionByUserType[e];return(s=a[l])!=null?s:true}getDefaultRolesForActionGroups(e){if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v][e]){return babelHelpers.classPrivateFieldLooseBase(this,v)[v][l]}return babelHelpers.classPrivateFieldLooseBase(this,v)[v][e]}}function m(e){babelHelpers.classPrivateFieldLooseBase(this,n)[n]=a;if(!e){return}const{byChatType:s,byUserType:r,actionGroups:t,actionGroupsDefaults:i}=e;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=babelHelpers.classPrivateFieldLooseBase(this,B)[B](s);babelHelpers.classPrivateFieldLooseBase(this,b)[b]=r;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=t;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=i}function R(e,r){const{role:t}=babelHelpers.classPrivateFieldLooseBase(this,L)[L](r);if(s.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,n)[n][e])){return true}const i=babelHelpers.classPrivateFieldLooseBase(this,n)[n][e];return babelHelpers.classPrivateFieldLooseBase(this,f)[f](i,t)}function A(e,r){var t;let i=e;const a=babelHelpers.classPrivateFieldLooseBase(this,L)[L](r);const{role:o,ownerId:n}=a;let{type:b}=a;if(s.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,c)[c][b])){b=l}i=babelHelpers.classPrivateFieldLooseBase(this,H)[H](i,n);if(s.Type.isUndefined((t=babelHelpers.classPrivateFieldLooseBase(this,c)[c][b])==null?void 0:t[i])){return true}const p=babelHelpers.classPrivateFieldLooseBase(this,c)[c][b][i];return babelHelpers.classPrivateFieldLooseBase(this,f)[f](p,o)}function U(e,s){const{role:r,type:t,permissions:a}=babelHelpers.classPrivateFieldLooseBase(this,L)[L](s);if(t===i.ChatType.user){return true}const l=babelHelpers.classPrivateFieldLooseBase(this,h)[h](e);if(!l){return true}let o=a[l];if(!o){o=i.UserRole.member}return babelHelpers.classPrivateFieldLooseBase(this,f)[f](o,r)}function O(e){const s=Object.entries(babelHelpers.classPrivateFieldLooseBase(this,p)[p]).find((([s,r])=>r.includes(e)));if(!s){return null}const[r]=s;return r}function j(e){const s={...e};const r="private";s[i.ChatType.user]=s[r];return s}function K(e,s){if(e===i.UserRole.none){return false}const r={};Object.values(i.UserRole).forEach(((e,s)=>{r[e]=s}));return r[s]>=r[e]}function M(e){return r.Core.getStore().getters["chats/get"](e,true)}function T(e){return r.Core.getStore().getters["users/get"](e,true).type}function C(e,s){const t=s===r.Core.getUserId();if(e===i.ActionByRole.kick){return i.ActionByRole.leave}if(e===i.ActionByRole.leave&&t){return i.ActionByRole.leaveOwner}return e}Object.defineProperty(g,o,{writable:true,value:void 0});e.PermissionManager=g})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=permission.bundle.map.js