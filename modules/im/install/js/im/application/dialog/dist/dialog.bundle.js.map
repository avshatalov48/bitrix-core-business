{"version":3,"file":"dialog.bundle.js","sources":["../src/view.js","../src/controller.js"],"sourcesContent":["/**\n * Bitrix Im\n * Application Dialog view\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\nimport {Vue} from \"ui.vue\";\nimport {Logger} from \"im.lib.logger\";\nimport {Utils} from \"im.lib.utils\";\nimport \"im.component.dialog\";\nimport \"pull.component.status\";\nimport \"./view.css\";\n\n/**\n * @notice Do not mutate or clone this component! It is under development.\n */\nVue.component('bx-im-application-dialog',\n{\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: '0' }\n\t},\n\n\tdata()\n\t{\n\t\treturn {\n\t\t\trealDialogId: 0\n\t\t}\n\t},\n\n\n\tcreated()\n\t{\n\t\tthis.realDialogId = this.dialogId;\n\n\t\tVue.event.$on('openMessenger', data =>\n\t\t{\n\t\t\tlet metaPress = data.$event.ctrlKey || data.$event.metaKey;\n\n\t\t\tif (this.$root.$bitrixApplication.params.place === 2)\n\t\t\t{\n\t\t\t\tif (metaPress)\n\t\t\t\t{\n\t\t\t\t\tthis.realDialogId = data.id;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!metaPress)\n\t\t\t\t{\n\t\t\t\t\tthis.realDialogId = data.id;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tcomputed:\n\t{\n\t\tisDialog()\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.realDialogId);\n\t\t},\n\n\t\tisEnableGesture()\n\t\t{\n\t\t\treturn false;\n\t\t},\n\n\t\tisEnableGestureQuoteFromRight()\n\t\t{\n\t\t\treturn this.isEnableGesture && true;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tlogEvent(name, ...params)\n\t\t{\n\t\t\tLogger.info(name, ...params);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-mobilechat\">\n\t\t\t<div class=\"bx-mobilechat-dialog-title\">Dialog: {{realDialogId}}</div>\n\t\t\t<bx-pull-component-status/>\n\t\t\t<bx-im-component-dialog\n\t\t\t\t:userId=\"userId\" \n\t\t\t\t:dialogId=\"realDialogId\"\n\t\t\t\t:enableGestureMenu=\"isEnableGesture\"\n\t\t\t\t:enableGestureQuote=\"isEnableGesture\"\n\t\t\t\t:enableGestureQuoteFromRight=\"isEnableGestureQuoteFromRight\"\n\t\t\t\t:showMessageUserName=\"isDialog\"\n\t\t\t\t:showMessageAvatar=\"isDialog\"\n\t\t\t\t@clickByCommand=\"logEvent('clickByCommand', $event)\"\n\t\t\t\t@clickByMention=\"logEvent('clickByMention', $event)\"\n\t\t\t\t@clickByUserName=\"logEvent('clickByUserName', $event)\"\n\t\t\t\t@clickByMessageMenu=\"logEvent('clickByMessageMenu', $event)\"\n\t\t\t\t@clickByMessageRetry=\"logEvent('clickByMessageRetry', $event)\"\n\t\t\t\t@clickByUploadCancel=\"logEvent('clickByUploadCancel', $event)\"\n\t\t\t\t@clickByReadedList=\"logEvent('clickByReadedList', $event)\"\n\t\t\t\t@setMessageReaction=\"logEvent('setMessageReaction', $event)\"\n\t\t\t\t@openMessageReactionList=\"logEvent('openMessageReactionList', $event)\"\n\t\t\t\t@clickByKeyboardButton=\"logEvent('clickByKeyboardButton', $event)\"\n\t\t\t\t@clickByChatTeaser=\"logEvent('clickByChatTeaser', $event)\"\n\t\t\t\t@click=\"logEvent('click', $event)\"\n\t\t\t />\n\t\t</div>\n\t`\n});","/**\n * Bitrix Im\n * Dialog application\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\n// vue\nimport {VueVendorV2} from \"ui.vue\";\n\n// im\nimport {Core} from \"im.application.core\";\nimport {Utils} from \"im.lib.utils\";\nimport {Logger} from \"im.lib.logger\";\nimport {DialogRestHandler} from \"im.provider.rest\";\n\n// core\nimport \"promise\";\n\n// pull\nimport {PULL as Pull} from \"pull.client\";\n\n// component\nimport \"./view\";\n\nexport class DialogApplication\n{\n\t/* region 01. Initialize */\n\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new BX.Promise;\n\n\t\tthis.params = params;\n\n\t\tthis.template = null;\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.event = new VueVendorV2;\n\n\t\tthis.initCore()\n\t\t\t.then(() => this.initComponent())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tinitCore()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCore.ready().then(controller => {\n\t\t\t\tthis.controller = controller;\n\t\t\t\tresolve();\n\t\t\t})\n\t\t});\n\t}\n\n\tinitComponent()\n\t{\n\t\tconsole.log('2. initComponent');\n\n\t\tthis.controller.getStore().commit('application/set', {\n\t\t\tdialog: {\n\t\t\t\tdialogId: this.getDialogId()\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tquoteEnable: true,\n\t\t\t\tautoplayVideo: true,\n\t\t\t\tdarkBackground: false\n\t\t\t}\n\t\t});\n\n\t\tthis.controller.addRestAnswerHandler(\n\t\t\tDialogRestHandler.create({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tcontext: this,\n\t\t\t})\n\t\t);\n\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (dialog)\n\t\t{\n\t\t\tthis.controller.getStore().commit('application/set', {dialog: {\n\t\t\t\tchatId: dialog.chatId,\n\t\t\t\tdiskFolderId: dialog.diskFolderId || 0\n\t\t\t}});\n\t\t}\n\n\t\treturn this.controller.createVue(this, {\n\t\t\tel: this.rootNode,\n\t\t\tdata: () =>\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tuserId: this.getUserId(),\n\t\t\t\t\tdialogId: this.getDialogId()\n\t\t\t\t};\n\t\t\t},\n\t\t\ttemplate: `<bx-im-application-dialog :userId=\"userId\" :dialogId=\"dialogId\"/>`,\n\t\t})\n\t\t.then(vue => {\n\t\t\tthis.template = vue;\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t});\n\t}\n\n\tinitComplete()\n\t{\n\t\tthis.inited = true;\n\t\tthis.initPromise.resolve(this);\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\tlet promise = new BX.Promise;\n\t\t\tpromise.resolve(this);\n\n\t\t\treturn promise;\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n/* endregion 01. Initialize */\n\n/* region 02. Methods */\n\n\tgetUserId()\n\t{\n\t\tlet userId = this.params.userId || this.getLocalize('USER_ID');\n\t\treturn userId? parseInt(userId): 0;\n\t}\n\n\tgetDialogId()\n\t{\n\t\treturn this.params.dialogId? this.params.dialogId.toString(): \"0\";\n\t}\n\n\tgetHost()\n\t{\n\t\treturn location.origin || '';\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn 's1';\n\t}\n\n/* endregion 02. Methods */\n\n/* region 03. Utils */\n\n\taddLocalize(phrases)\n\t{\n\t\treturn this.controller.addLocalize(phrases);\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\treturn this.controller.getLocalize(name);\n\t}\n\n/* endregion 03. Utils */\n}"],"names":["Vue","component","props","userId","default","dialogId","data","realDialogId","created","event","$on","metaPress","$event","ctrlKey","metaKey","$root","$bitrixApplication","params","place","id","computed","isDialog","Utils","dialog","isChatId","isEnableGesture","isEnableGestureQuoteFromRight","methods","logEvent","name","Logger","info","template","DialogApplication","inited","initPromise","BX","Promise","rootNode","node","document","createElement","VueVendorV2","initCore","then","initComponent","initComplete","resolve","reject","Core","ready","controller","console","log","getStore","commit","getDialogId","options","quoteEnable","autoplayVideo","darkBackground","addRestAnswerHandler","DialogRestHandler","create","store","context","getters","application","chatId","diskFolderId","createVue","el","getUserId","vue","promise","getLocalize","parseInt","toString","location","origin","phrases","addLocalize"],"mappings":"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"}