{"version":3,"file":"vote.bundle.js","sources":["../src/const/vote-type.js","../src/const/vote-params-keys.js","../src/classes/vote-service.js","../src/vote.js"],"sourcesContent":["export const VoteType = {\n\tlike: 'like',\n\tdislike: 'dislike',\n\tnone: 'none',\n};\n","export const VoteParamKey = {\n\tvoteText: 'imolVoteText',\n\tlikeText: 'imolVoteLike',\n\tdislikeText: 'imolVoteDislike',\n\tcurrentVote: 'imolVote',\n\ttimeLimit: 'imolTimeLimitVote',\n\tvoteCloseDate: 'imolDateCloseVote',\n};\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\n\nimport { VoteType } from '../const/vote-type';\nimport { VoteParamKey } from '../const/vote-params-keys';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\nexport class VoteService\n{\n\t#messageId: number;\n\t#dialogId: string;\n\n\tconstructor(messageId: number, dialogId: string)\n\t{\n\t\tthis.#messageId = messageId;\n\t\tthis.#dialogId = dialogId;\n\t}\n\n\tlike(): void\n\t{\n\t\tthis.#updateModel({\n\t\t\tvote: VoteType.like,\n\t\t});\n\t\tCore.getRestClient().callMethod(RestMethod.imBotDialogVote, {\n\t\t\tMESSAGE_ID: this.#messageId,\n\t\t\tDIALOG_ID: this.#dialogId,\n\t\t\tRATING: VoteType.like,\n\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('VoteService: error in dialog vote', error);\n\t\t\t});\n\t}\n\n\tdislike(): void\n\t{\n\t\tthis.#updateModel({\n\t\t\tvote: VoteType.dislike,\n\t\t});\n\t\tCore.getRestClient().callMethod(RestMethod.imBotDialogVote, {\n\t\t\tMESSAGE_ID: this.#messageId,\n\t\t\tDIALOG_ID: this.#dialogId,\n\t\t\tRATING: VoteType.dislike,\n\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error('VoteService: error in dialog vote', error);\n\t\t\t});\n\t}\n\n\t#updateModel(params: {vote: $Values<typeof VoteType>})\n\t{\n\t\tconst { vote } = params;\n\t\tconst currentMessage: ImModelMessage = Core.getStore().getters['messages/getById'](this.#messageId);\n\t\tconst newComponentParams = {\n\t\t\t...currentMessage.componentParams,\n\t\t\t[VoteParamKey.currentVote]: vote,\n\t\t};\n\t\tCore.getStore().dispatch('messages/update', {\n\t\t\tid: this.#messageId,\n\t\t\tfields: { componentParams: newComponentParams },\n\t\t});\n\t}\n}\n","import { Type } from 'main.core';\nimport 'ui.notification';\n\nimport { BaseMessage } from 'im.v2.component.message.base';\nimport { DateFormatter } from 'im.v2.lib.date-formatter';\n\nimport { VoteService } from './classes/vote-service';\nimport { VoteType } from './const/vote-type';\nimport { VoteParamKey as ParamKey } from './const/vote-params-keys';\n\nimport './css/vote.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const SupportVoteMessage = {\n\tname: 'SupportVote',\n\tcomponents: { BaseMessage },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tcurrentVote(): $Values<typeof VoteType>\n\t\t{\n\t\t\treturn this.message.componentParams[ParamKey.currentVote] || VoteType.none;\n\t\t},\n\t\tvoteText(): string\n\t\t{\n\t\t\tif (this.currentVote === VoteType.none)\n\t\t\t{\n\t\t\t\treturn this.message.componentParams[ParamKey.voteText];\n\t\t\t}\n\n\t\t\tif (this.currentVote === VoteType.like)\n\t\t\t{\n\t\t\t\treturn this.message.componentParams[ParamKey.likeText];\n\t\t\t}\n\n\t\t\treturn this.message.componentParams[ParamKey.dislikeText];\n\t\t},\n\t\tvoteClosed(): boolean\n\t\t{\n\t\t\tconst closeDate = this.message.componentParams[ParamKey.voteCloseDate];\n\t\t\tif (!Type.isStringFilled(closeDate))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn new Date(closeDate).getTime() < Date.now();\n\t\t},\n\t\tvoteTimeSecondsLimit(): number\n\t\t{\n\t\t\tconst limit = this.message.componentParams[ParamKey.timeLimit] ?? 0;\n\n\t\t\treturn Number.parseInt(limit, 10);\n\t\t},\n\t\tlikeClasses(): { [className: string]: boolean }\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--active': this.currentVote === VoteType.like,\n\t\t\t\t'--disabled': this.currentVote === VoteType.dislike,\n\t\t\t};\n\t\t},\n\t\tdislikeClasses(): { [className: string]: boolean }\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--active': this.currentVote === VoteType.dislike,\n\t\t\t\t'--disabled': this.currentVote === VoteType.like,\n\t\t\t};\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonLike()\n\t\t{\n\t\t\tif (this.currentVote === VoteType.like)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.voteClosed)\n\t\t\t{\n\t\t\t\tthis.showVoteClosedNotification();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.getVoteService().like();\n\t\t},\n\t\tonDislike()\n\t\t{\n\t\t\tif (this.currentVote === VoteType.dislike)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.voteClosed)\n\t\t\t{\n\t\t\t\tthis.showVoteClosedNotification();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.getVoteService().dislike();\n\t\t},\n\t\tshowVoteClosedNotification()\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: this.loc('IM_MESSAGE_SUPPORT_VOTE_CLOSED'),\n\t\t\t});\n\t\t},\n\t\tgetDaysForVote(): string\n\t\t{\n\t\t\tconst currentSeconds = Date.now() / 1000;\n\n\t\t\treturn DateFormatter.formatByCode(currentSeconds - this.voteTimeSecondsLimit, 'ddiff');\n\t\t},\n\t\tgetVoteService(): VoteService\n\t\t{\n\t\t\tif (!this.voteService)\n\t\t\t{\n\t\t\t\tthis.voteService = new VoteService(this.message.id, this.dialogId);\n\t\t\t}\n\n\t\t\treturn this.voteService;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BaseMessage\n\t\t\t:item=\"item\"\n\t\t\t:dialogId=\"dialogId\"\n\t\t\t:withTitle=\"withTitle\"\n\t\t\t:withContextMenu=\"false\"\n\t\t\t:withReactions=\"false\"\n\t\t>\n\t\t\t<div class=\"bx-im-message-support-vote__container\">\n\t\t\t\t<div class=\"bx-im-message-support-vote__title\">{{ loc('IM_MESSAGE_SUPPORT_VOTE_TITLE') }}</div>\n\t\t\t\t<div class=\"bx-im-message-support-vote__subtitle\">{{ voteText }}</div>\n\t\t\t\t<div class=\"bx-im-message-support-vote__actions\">\n\t\t\t\t\t<div class=\"bx-im-message-support-vote__action_item --like\" :class=\"likeClasses\" @click=\"onLike\"></div>\n\t\t\t\t\t<div class=\"bx-im-message-support-vote__action_item --dislike\" :class=\"dislikeClasses\" @click=\"onDislike\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BaseMessage>\n\t`,\n};\n"],"names":["VoteType","like","dislike","none","VoteParamKey","voteText","likeText","dislikeText","currentVote","timeLimit","voteCloseDate","VoteService","constructor","messageId","dialogId","vote","Core","getRestClient","callMethod","RestMethod","imBotDialogVote","MESSAGE_ID","DIALOG_ID","RATING","catch","error","console","params","currentMessage","getStore","getters","newComponentParams","componentParams","dispatch","id","fields","SupportVoteMessage","name","components","BaseMessage","props","item","type","Object","required","String","withTitle","Boolean","default","data","computed","message","ParamKey","voteClosed","closeDate","Type","isStringFilled","Date","getTime","now","voteTimeSecondsLimit","limit","Number","parseInt","likeClasses","dislikeClasses","methods","onLike","showVoteClosedNotification","getVoteService","onDislike","BX","UI","Notification","Center","notify","content","loc","getDaysForVote","currentSeconds","DateFormatter","formatByCode","voteService","phraseCode","replacements","$Bitrix","Loc","getMessage","template"],"mappings":"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"}