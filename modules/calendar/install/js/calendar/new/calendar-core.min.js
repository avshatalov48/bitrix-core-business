(function(e){function t(t,i,n){this.DEFAULT_VIEW="month";this.RELOAD_DELAY=500;this.REFRESH_DELAY=500;this.id=t.id;this.showTasks=t.showTasks;this.util=new e.BXEventCalendar.Util(this,t,n);this.needForReload=false;this.pullEventList=new Set;if(this.util.isFilterEnabled()&&t.filterId){this.search=new BX.Calendar.Search(t.filterId,t.counters)}if(t.settings&&t.weekStart){t.settings.week_start=t.weekStart}this.externalMode=t.externalDataHandleMode;this.entityType=t.entityType||"";this.newEntryName=t.newEntryName||null;this.collapsedLabelMessage=t.collapsedLabelMessage||BX.message("EC_COLLAPSED_MESSAGE");this.viewOption="view"+(this.entityType?"_"+this.entityType:"");BX.Calendar.Util.setCalendarContext(this);this.sectionManager=new BX.Calendar.SectionManager(i,t);this.entryManager=new BX.Calendar.EntryManager(i,t);this.roomsManager=new BX.Calendar.RoomsManager(i,t);this.categoryManager=new BX.Calendar.CategoryManager(i,t);if(BX.Calendar.Controls&&BX.Calendar.Controls.Location){BX.Calendar.Controls.Location.setLocationList(n.locationList)}this.entryController=new e.BXEventCalendar.EntryController(this,i);this.currentViewName=this.util.getUserOption(this.viewOption)||this.DEFAULT_VIEW;BX.Calendar.Util.setUserSettings(t.userSettings);BX.Calendar.Util.setOptions(t.settings);BX.Calendar.Util.setAccessNames(t.accessNames);BX.Calendar.Util.setEventWithEmailGuestEnabled(t.eventWithEmailGuestEnabled);BX.Calendar.Util.setProjectFeatureEnabled(t.projectFeatureEnabled);BX.Calendar.Util.setDayMonthFormat(t.dayMonthFormat);BX.Calendar.Util.setLongDateFormat(t.longDateFormat);BX.Calendar.Util.setIphoneConnectionStatus(t.isIphoneConnected);BX.Calendar.Util.setMacConnectionStatus(t.isMacConnected);BX.Calendar.Util.setIcloudConnectionStatus(t.isIcloudConnected);BX.Calendar.Util.setGoogleConnectionStatus(t.isGoogleConnected);BX.Calendar.Util.setIsSharingFeatureEnabled(t.isSharingFeatureEnabled);BX.Calendar.Util.setSharingConfig(t.sharing);this.payAttentionToNewSharingFeature=t.payAttentionToNewSharingFeature;this.sharingFeatureLimitEnable=t.sharingFeatureLimitEnable;this.sharingSettingsCollapsed=t.sharingOptions?.sharingSettingsCollapsed;this.sortJointLinksByFrequentUse=t.sharingOptions?.sortJointLinksByFrequentUse;this.requests={};this.currentUser=t.user;this.ownerUser=t.ownerUser||false;this.viewRangeDate=new Date;this.keyHandlerEnabled=true;this.build();if(!this.isExternalMode()){if(t.startupEvent){this.showStartUpEntry(t.startupEvent)}if(t.showAfterSyncAccent){this.showAfterSyncAccent(t.showAfterSyncAccent)}}BX.Event.EventEmitter.subscribe("onPullEvent-calendar",this.handlePullEvent.bind(this));BX.Event.EventEmitter.subscribe("onPullEvent-tasks",this.handlePullEvent.bind(this));this.reloadDebounce=BX.Runtime.debounce(this.reload,this.RELOAD_DELAY,this);this.refreshDebounce=BX.Runtime.debounce(this.refresh,this.REFRESH_DELAY,this)}t.prototype={build:function(){this.mainCont=BX(this.id+"-main-container");if(this.mainCont){this.topBlock=BX.create("DIV",{props:{className:"calendar-top-block"}});this.buildNavigation();this.viewTitleContainer=this.topBlock.appendChild(BX.create("DIV",{props:{className:"calendar-top-title-container"}}));this.viewTitle=this.viewTitleContainer.appendChild(BX.create("H2",{props:{className:"calendar-top-title"}}));this.mainCont.appendChild(this.topBlock);this.viewsCont=BX.create("DIV",{props:{className:"calendar-views-container calendar-disable-select"}});BX.bind(this.viewsCont,"click",this.handleViewsClick.bind(this));this.dragDrop=new e.BXEventCalendar.DragDrop(this);if(this.util.isFilterEnabled()&&!this.search.isFilterEmpty()){this.currentViewName="list"}if(this.isLocationViewDisabled()){this.currentViewName="month"}this.buildViews();if(!this.isLocationViewDisabled()){this.buildViewSwitcher()}if(this.util.isFilterEnabled()){if(!this.search.isFilterEmpty()){this.search.applyFilter()}if(this.search&&this.util.getCounters()){this.buildCountersControl()}}if(!this.isExternalMode()&&!this.isLocationViewDisabled()){this.buildTopButtons()}this.mainCont.appendChild(this.viewsCont);this.rightBlock=this.mainCont.appendChild(BX.create("DIV",{props:{className:"calendar-right-container"}}));BX.addCustomEvent(this,"doRefresh",BX.proxy(this.refresh,this));BX.Event.bind(document.body,"keyup",BX.proxy(this.keyUpHandler,this));BX.Event.bind(document.body,"keydown",BX.proxy(this.keyDownHandler,this));BX.Event.bind(e,"beforeunload",BX.Calendar.EntryManager.doDelayedActions);BX.addCustomEvent(this,"changeViewRange",BX.Calendar.EntryManager.doDelayedActions);BX.Event.bind(document,"visibilitychange",this.handleVisibilityChange.bind(this));this.topBlock.appendChild(BX.create("DIV",{style:{clear:"both"}}));top.BX.addCustomEvent(top,"onCalendarBeforeCustomSliderCreate",BX.proxy(this.loadCssList,this));top.BX.Event.EventEmitter.subscribe("BX.Calendar:doRefresh",this.refresh.bind(this));top.BX.Event.EventEmitter.subscribe("BX.Calendar:doReloadCounters",top.BX.Runtime.debounce(this.updateCounters,5e3,this));if(top!==e){if(!top.BX.getClass("top.BX.SocNetLogDestination")){top.BX.loadExt("socnetlogdest")}if(!top.BX.getClass("top.BX.Access")){top.BX.loadExt("access")}}if(this.util.userIsOwner()&&!this.util.isExtranetUser()){this.syncInterface=new BX.Calendar.Sync.Manager.Manager({wrapper:document.getElementById(`${this.id}-sync-container`),syncInfo:this.util.config.syncInfo,payAttentionToNewSharingFeature:this.payAttentionToNewSharingFeature,userId:this.currentUser.id,syncLinks:this.util.config.syncLinks,isSetSyncGoogleSettings:this.util.config.isSetSyncGoogleSettings,isSetSyncOffice365Settings:this.util.config.isSetSyncOffice365Settings,sections:this.sectionManager.getSections(),portalAddress:this.util.config.caldav_link_all,isRuZone:this.util.config.isRuZone,calendar:this});this.syncInterface.showSyncButton();this.sharingInterface=new BX.Calendar.Sharing.Interface({buttonWrap:document.querySelector(`#${this.id}-sharing-container`),userInfo:{id:this.currentUser.id,name:this.currentUser.name,avatar:this.currentUser.avatar},payAttentionToNewFeature:this.payAttentionToNewSharingFeature,sharingFeatureLimit:!this.sharingFeatureLimitEnable,sharingSettingsCollapsed:this.sharingSettingsCollapsed,sortJointLinksByFrequentUse:this.sortJointLinksByFrequentUse});if(BX.Calendar.Util.checkSharingFeatureEnabled()){this.sharingInterface.showSharingButton()}}BX.Event.EventEmitter.subscribe("BX.Calendar.EventEditForm:onSave",function(e){if(e instanceof BX.Event.BaseEvent){var t=e.getData();if(t.options.recursionMode||t.responseData.reload){this.reload()}else if(t.responseData&&BX.Type.isArray(t.responseData.eventList)){this.entryController.handleEntriesList(t.responseData.eventList);this.getView().displayEntries()}}}.bind(this));BX.Event.EventEmitter.subscribe("BX.Calendar.CompactEventForm:onSave",function(e){if(e instanceof BX.Event.BaseEvent){var t=e.getData();if(t.options.recursionMode||t.responseData.reload){this.reload()}else if(t.responseData&&BX.Type.isArray(t.responseData.eventList)){this.entryController.handleEntriesList(t.responseData.eventList);this.getView().displayEntries()}}}.bind(this));BX.Event.EventEmitter.subscribe("BX.Calendar.Entry:onChangeMeetingStatus",function(e){if(e instanceof BX.Event.BaseEvent){var t=e.getData();if(BX.Type.isObjectLike(t.counters)&&this.counters&&this.util.getCounters()){this.counters.setCountersValue(t.counters)}if(t.status==="Y"){const e=this.sectionManager.getSection(t.entry.sectionId);e.show()}this.reload()}}.bind(this));BX.Event.EventEmitter.subscribe("BX.Calendar.CompactEventForm:doRefresh",function(e){this.refreshDebounce()}.bind(this));if(this.isLocationViewDisabled()){this.buildLockView();BX.addClass(this.mainCont,"--lock");if(this.lockView){this.mainCont.appendChild(this.lockView)}}}},buildViews:function(){var t=this.util.getAvilableViews(),i={day:e.BXEventCalendar.CalendarDayView,week:e.BXEventCalendar.CalendarWeekView,month:e.BXEventCalendar.CalendarMonthView,list:e.BXEventCalendar.CalendarListView};this.views=[];if(BX.type.isArray(t)){t.forEach((function(e){if(e&&i[e]){this.views.push(new i[e](this))}}),this)}var n=this.util.getCustumViews();if(BX.type.isArray(n)){n.forEach((function(t){this.views.push(new e.BXEventCalendar.CalendarCustomView(this,t))}),this)}BX.addCustomEvent(this,"keydown",function(e){if(BX.Calendar&&BX.Calendar.Util&&!BX.Calendar.Util.isAnyModifierKeyPressed(e.e)){this.views.forEach((function(t){if(t.getHotkey()&&BX.Calendar.Util.getKeyCode(t.getHotkey())===e.keyCode){BX.Calendar.Util.sendAnalyticLabel({calendarAction:"viewChange",viewMode:"hotkey",viewType:t.getName()});this.setView(t.getName(),{animation:true})}}),this)}}.bind(this));BX.onCustomEvent(e,"onCalendarBeforeBuildViews",[this.views,this]);this.views.forEach(this.buildView,this);this.viewTransition=new e.BXEventCalendar.ViewTransition(this);BX.onCustomEvent(e,"onCalendarAfterBuildViews",[this])},buildNavigation:function(){this.navigationWrap=this.topBlock.appendChild(BX.create("DIV",{props:{className:"calendar-navigation-container"}}));this.navigationWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-navigation-previous"},events:{click:BX.delegate(this.showPrevious,this)}}));this.navigationWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-navigation-current"},text:BX.message("EC_TODAY"),events:{click:BX.delegate(this.showToday,this)}}));this.navigationWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-navigation-next"},events:{click:BX.delegate(this.showNext,this)}}))},showNext:function(){var e=this.getView().increaseViewRangeDate();if(e){this.triggerEvent("changeViewDate",{viewRange:e})}},showPrevious:function(){var e=this.getView().decreaseViewRangeDate();if(e){this.triggerEvent("changeViewDate",{viewRange:e})}},showToday:function(){var e=this.getView(),t=e.adjustViewRangeToDate(new Date);if(t){this.triggerEvent("changeViewDate",{viewRange:t})}},buildView:function(e){var t=e.getContainer();if(t){this.viewsCont.appendChild(t)}if(this.currentViewName===e.getName()){this.setView(e.getName(),{first:true})}},buildViewSwitcher:function(){var e=[];var t=null;this.views.forEach((function(t){e.push({name:t.name,text:t.title||t.name,type:"base",dataset:null,hotkey:t.getHotkey()})}),this);if(BX.type.isArray(this.util.config.additionalViewModes)){this.util.config.additionalViewModes.forEach((function(i){e.push({name:i.id,text:BX.util.htmlspecialchars(i.label),type:"additional",dataset:i});if(i.selected){t=i.id}}),this)}this.viewSelector=new BX.Calendar.Controls.ViewSelector({views:e,currentView:this.getView(),currentViewMode:t});this.viewSelector.subscribe("onChange",function(e){var t=e.getData();if(t&&t.name){if(t.type==="base"){this.setView(t.name,{animation:true});BX.Calendar.Util.sendAnalyticLabel({calendarAction:"viewChange",viewMode:"selector",viewType:t.name})}else if(t.type==="additional"){this.triggerEvent("changeViewMode",t.dataset)}}}.bind(this));this.topBlock.appendChild(this.viewSelector.getOuterWrap());this.lineViewSelectorWrap=BX(this.id+"-view-switcher-container");if(this.lineViewSelectorWrap){this.lineViewSelector=new BX.Calendar.Controls.LineViewSelector({views:e,currentView:this.getView(),currentViewMode:t});this.lineViewSelectorWrap.appendChild(this.lineViewSelector.getOuterWrap());this.lineViewSelector.subscribe("onChange",function(e){var t=e.getData();if(t&&t.name){if(t.type==="base"){this.setView(t.name,{animation:true});BX.Calendar.Util.sendAnalyticLabel({calendarAction:"viewChange",viewMode:"topmenu",viewType:t.name})}}}.bind(this))}},buildLockView:function(){this.lockView=this.mainCont.appendChild(BX.create("DIV",{props:{className:"calendar-view-locker"}}));this.lockViewContainer=this.lockView.appendChild(BX.create("DIV",{props:{className:"calendar-view-locker-container"}}));this.lockViewContainer.appendChild(BX.create("DIV",{props:{className:"calendar-view-locker-top"},html:'<div class="calendar-view-locker-icon"></div>'+'<div class="calendar-view-locker-text">'+BX.message("EC_LOCATION_VIEW_LOCKED")+"</div>"}));this.lockViewContainer.appendChild(BX.create("DIV",{props:{className:"calendar-view-locker-button"},html:'<a href="javascript:void(0)" '+"onclick=\"top.BX.UI.FeaturePromotersRegistry.getPromoter({ featureId: 'calendar_location' }).show()\" "+'class="ui-btn ui-btn-sm ui-btn-light-border ui-btn-round">'+BX.message("EC_LOCATION_VIEW_UNLOCK_FEATURE")+"</a>"}));top.BX.UI.FeaturePromotersRegistry.getPromoter({featureId:"calendar_location"}).show()},setView:function(e,t){if(e){if(!t){t={}}var i=this.getView(),n=i.getViewRange(),s=this.getView(e);if(this.viewSelector){this.viewSelector.setValue(s);this.viewSelector.closePopup()}if(this.lineViewSelector){this.lineViewSelector.setValue(s)}if(s&&(e!==this.currentViewName||!i.getIsBuilt())){t.currentViewDate=this.getViewRangeDate();if(BX.type.isDate(t.date)){t.newViewDate=t.date}else{t.newViewDate=s.getAdjustedDate(t.date||false,n,true)}t.currentView=i;t.newView=s;this.setViewRangeDate(t.newViewDate);this.triggerEvent("beforeSetView",{currentViewName:this.currentViewName,newViewName:e});if(i.type==="custom"||s.type==="custom"){t.animation=false}if(this.rightBlock&&(e==="month"||e==="week")){this.rightBlock.style.display="none"}else if(this.rightBlock){this.rightBlock.style.display=""}const a=24*60*60*1e3;if(e==="day"){t.animation=t.animation&&this.getDisplayedViewRange().start.getTime()<=t.newViewDate.getTime()&&t.newViewDate.getTime()<=this.getDisplayedViewRange().end.getTime()+a}if(t.animation){this.viewTransition.transit(t)}else{if(e!==this.currentViewName){i.hide()}if(t.first===true){this.initialViewShow=true;s.adjustViewRangeToDate(t.newViewDate)}else{s.adjustViewRangeToDate(t.newViewDate)}this.currentViewName=s.getName()}if(t.first!==true){this.util.setUserOption(this.viewOption,e)}this.triggerEvent("afterSetView",{viewName:e});BX.Calendar.Util.setCurrentView(e)}}},request:function(e){if(!e.url){e.url=this.util.getActionUrl()}if(e.bIter!==false){e.bIter=true}if(!e.data){e.data={}}var t;e.reqId=t=Math.round(Math.random()*1e6);e.data.sessid=BX.bitrix_sessid();e.data.bx_event_calendar_request="Y";e.data.reqId=t;var i=this,n=0,s;if(e.handler){s=function(s){var a=function(){if(i.requests[t].status!=="canceled"){var r=s.toLowerCase().indexOf("bx_event_calendar_action_error");if(!s||s.length<=0||r!==-1){var o="";if(r>=0){var l=r+"BX_EVENT_CALENDAR_ACTION_ERROR:".length,c=s.indexOf("--\x3e",l);o=s.substr(l,c-l)}if(BX.type.isFunction(e.onerror)){e.onerror()}return i.displayError(o||e.errorText||"")}i.requests[t].status="complete";var h=e.handler(i.getRequestResult(t),s);if(h===false&&++n<20&&e.bIter){setTimeout(a,5)}else{delete top.BXCRES[t]}}};setTimeout(a,50)}}else{s=BX.DoNothing()}this.requests[e.reqId]={status:"sent",xhr:e.type==="post"?BX.ajax.post(e.url,e.data,s):BX.ajax.get(e.url,e.data,s)};return e},cancelRequest:function(e){if(this.requests[e]&&this.requests[e].status==="sent"){this.requests[e].status="canceled"}},getRequestResult:function(e){if(top.BXCRES&&typeof top.BXCRES[e]!="undefined"){return top.BXCRES[e]}return{}},displayError:function(e,t){if(BX.type.isArray(e)&&e.length>0){var i="",n=e;for(var s=0;s<n.length;s++){i+=n[s].message+"\n"}e=i}var a=this;setTimeout((function(){if(!a.bOnunload){alert(e||"[Bitrix Calendar] Request error");if(t){BX.reload()}}}),200)},triggerEvent:function(e,t){BX.onCustomEvent(this,e,[t])},getView:function(e){e=e||this.currentViewName;for(var t=0;t<this.views.length;t++){if(this.views[t].getName()===e){return this.views[t]}}return this.views[0]},getViewRangeDate:function(){if(!this.viewRangeDate){this.viewRangeDate=new Date}this.viewRangeDate.setHours(0,0,0,0);return this.viewRangeDate},setViewRangeDate:function(e){this.viewRangeDate=e;this.triggerEvent("changeViewRange",e)},getDisplayedViewRange:function(){return this.displayedRange},setDisplayedViewRange:function(e){this.displayedRange=e},handleViewsClick:function(e){var t=e.target||e.srcElement,i=this.util.findTargetNode(t,this.viewsCont);if(i){if(i.getAttribute("data-bx-calendar-weeknumber")){this.setView("week",{date:new Date(parseInt(i.getAttribute("data-bx-cal-time"))),animation:true})}else if(i.getAttribute("data-bx-calendar-date")){this.setView("day",{date:new Date(parseInt(i.getAttribute("data-bx-calendar-date"))),animation:true})}this.triggerEvent("viewOnClick",{e:e,target:t,specialTarget:i})}},handleViewsMousedown:function(e){var t=e.target||e.srcElement,i=this.util.findTargetNode(t,this.viewsCont);if(i){this.triggerEvent("viewOnMouseDown",{e:e,target:t,specialTarget:i})}},disableKeyHandler:function(){this.keyHandlerEnabled=false},enableKeyHandler:function(){this.keyHandlerEnabled=true},isKeyHandlerEnabled:function(e){var t=e.target||e.srcElement;if(t&&BX.Type.isDomNode(t)){if({INPUT:true,TEXTAREA:true}[t.nodeName]){return false}}var i=this.keyHandlerEnabled&&!BX.hasClass(document.body,"bx-im-fullscreen-block-scroll")&&!BX.hasClass(document.body,"side-panel-disable-scrollbar");if(i){var n,s=document.body.querySelectorAll(".popup-window");for(n=0;n<s.length;n++){if(s[n]&&s[n].style.display!=="none"&&!BX.hasClass(s[n],"calendar-view-switcher-popup")){i=false;break}}}return i},keyUpHandler:function(e){if(this.isKeyHandlerEnabled(e)){var t=e.keyCode;if(t===BX.Calendar.Util.getKeyCode("left")){this.showPrevious()}else if(t===BX.Calendar.Util.getKeyCode("right")){this.showNext()}this.triggerEvent("keyup",{e:e,keyCode:t})}},keyDownHandler:function(e){if(this.isKeyHandlerEnabled(e)){const t=e.keyCode;this.triggerEvent("keydown",{e:e,keyCode:t})}},buildCountersControl:function(){this.countersCont=BX(this.id+"-counter-container");this.counters=new BX.Calendar.Counters({search:this.search,countersWrap:this.countersCont,counters:this.util.getCounters(),userId:this.currentUser.id});this.counters.init()},buildTopButtons:function(){if(this.util.type==="location"){this.buildingTopButtonsRooms()}else{this.buildingTopButtonsCalendar()}},buildingTopButtonsCalendar:function(){this.buttonsCont=BX(this.id+"-buttons-container");if(this.buttonsCont){this.sectionButton=this.buttonsCont.appendChild(BX.create("button",{props:{className:"ui-btn ui-btn-light-border ui-btn-themes",type:"button"},text:BX.message("EC_SECTION_BUTTON")}));BX.Event.bind(this.sectionButton,"click",function(){this.getSectionInterface().then(function(e){if(!this.sectionInterface){this.sectionInterface=new e({calendarContext:this,readonly:this.util.readOnlyMode(),sectionManager:this.sectionManager})}this.sectionInterface.show()}.bind(this))}.bind(this));if(this.util.userIsOwner()||this.util.config.TYPE_ACCESS){this.settingsButton=this.buttonsCont.appendChild(BX.create("button",{props:{className:"ui-btn ui-btn-icon-setting ui-btn-light-border ui-btn-themes"}}));BX.Event.bind(this.settingsButton,"click",function(){this.getSettingsInterface().then(function(e){if(!this.settingsInterface){this.settingsInterface=new e({calendarContext:this,showPersonalSettings:this.util.userIsOwner(),showGeneralSettings:!!(this.util.config.perm&&this.util.config.perm.access),settings:this.util.config.settings})}this.settingsInterface.show()}.bind(this))}.bind(this))}const e=BX(this.id+"-add-button-container");if(!this.util.readOnlyMode()&&BX.Type.isDomNode(e)){e.appendChild(new BX.Calendar.Controls.AddButton({addEntry:()=>{BX.Calendar.EntryManager.openEditSlider({calendarContext:this,type:this.util.type,isLocationCalendar:false,locationAccess:this.util.config.locationAccess,ownerId:this.util.ownerId,userId:parseInt(this.currentUser.id)})},addTask:this.showTasks?()=>{const e=BX.Uri.addParam(this.util.getEditTaskPath(),{ta_sec:"calendar",ta_el:"create_button"});BX.SidePanel.Instance.open(e,{loader:"task-new-loader"})}:null}).getWrap())}}},buildingTopButtonsRooms:function(){this.buttonsCont=BX(this.id+"-buttons-container");if(this.buttonsCont){this.roomsButton=this.buttonsCont.appendChild(BX.create("button",{props:{className:"ui-btn ui-btn-light-border ui-btn-themes",type:"button"},text:BX.message("EC_SECTION_ROOMS_LIST")}));BX.Event.bind(this.roomsButton,"click",function(){this.getRoomsInterface().then(function(e){if(!this.roomsInterface){this.roomsInterface=new e({calendarContext:this,readonly:this.util.readOnlyMode(),roomsManager:this.roomsManager,categoryManager:this.categoryManager})}this.roomsInterface.show()}.bind(this))}.bind(this));if(this.util.userIsOwner()||this.util.config.TYPE_ACCESS){this.settingsButton=this.buttonsCont.appendChild(BX.create("button",{props:{className:"ui-btn ui-btn-icon-setting ui-btn-light-border ui-btn-themes"}}));BX.Event.bind(this.settingsButton,"click",function(){this.getSettingsInterface().then(function(e){if(!this.settingsInterface){this.settingsInterface=new e({calendarContext:this,showPersonalSettings:this.util.userIsOwner(),showGeneralSettings:false,showAccessControll:true,settings:this.util.config.settings})}this.settingsInterface.show()}.bind(this))}.bind(this))}const e=BX(this.id+"-add-button-container");if(this.util.type==="location"&&BX.Type.isDomNode(e)){e.appendChild(new BX.Calendar.Rooms.ReserveButton({addEntry:()=>{BX.Calendar.EntryManager.openEditSlider({calendarContext:this,roomsManager:this.roomsManager,categoryManager:this.categoryManager,type:"user",isLocationCalendar:true,locationAccess:this.util.config.locationAccess,ownerId:this.util.ownerId,userId:parseInt(this.currentUser.id)})}}).getWrap())}}},refresh:function(){this.getView().reload()},reload:function(e){if(BX.Calendar.Util.documentIsDisplayingNow()){this.entryController.clearLoadIndexCache();this.refresh()}else{this.needForReload=true}},handleVisibilityChange:function(){if(this.needForReload){this.reloadDebounce()}if(this.pullEventList.size){this.pullEventList.forEach(((e,t,i)=>{if(this.entryManager&&["edit_event","delete_event","set_meeting_status","task_remove","task_add","task_update"].includes(e.command)){this.entryManager.handlePullChanges(e);this.reloadDebounce()}if(this.sectionManager&&["edit_section","delete_section","change_section_subscription"].includes(e.command)){this.sectionManager.reloadDataDebounce();if(this.sectionInterface){this.sectionInterface.close()}}if(this.syncInterface&&["refresh_sync_status","refresh_sync_status","delete_sync_connection"].includes(e.command)){}}));this.pullEventList.clear()}},showStartUpEntry:function(e){BX.Calendar.EntryManager.openViewSlider(e.ID,{from:BX.Calendar.Util.parseDate(e["~CURRENT_DATE"]),timezoneOffset:e.TZ_OFFSET_FROM||null,link:location.href})},isExternalMode:function(){return this.externalMode},showLoader:function(){if(this.viewsCont){if(this.entryLoader){this.entryLoader.destroy()}this.entryLoader=new BX.Loader({target:this.viewsCont});this.entryLoader.layout.style.zIndex=1e3;this.entryLoader.show();this.mainCont.style.opacity="0.5"}},hideLoader:function(){if(this.entryLoader){this.entryLoader.destroy()}this.mainCont.style.opacity=""},getCurrentViewName:function(){return this.currentViewName},loadCssList:function(){if(e.top&&e.top.BX){e.top.BX.loadCSS(["/bitrix/components/bitrix/calendar.grid/templates/.default/style.css","/bitrix/js/calendar/new/calendar.css","/bitrix/js/calendar/cal-style.css"])}},handlePullEvent:function(e){if(e&&BX.Type.isFunction(e.getData)){const t={command:e.getData()[0],...e.getData()[1]};if(BX.Calendar.Util.documentIsDisplayingNow()){this.processPullEvent(t)}else{this.storePullEvent(t)}}},storePullEvent:function(e){if(!BX.Calendar.Util.checkRequestId(e.requestUid)){return}if(this.pullEventList.has(e)){this.pullEventList.delete(e)}this.pullEventList.add(e)},processPullEvent:function(e){e.sections=this.sectionManager.getSections();switch(e.command){case"edit_event":case"edit_event_location":case"delete_event":case"delete_event_location":case"set_meeting_status":this.entryManager.handlePullChanges(e);break;case"edit_section":case"delete_section":case"change_section_subscription":case"hidden_sections_updated":this.sectionManager.handlePullChanges(e);break;case"delete_room":case"create_room":case"update_room":this.roomsManager.handlePullRoomChanges(e);break;case"delete_category":case"create_category":case"update_category":this.categoryManager.handlePullCategoryChanges(e);break;case"change_section_customization":this.reloadDebounce();break;case"refresh_sync_status":case"add_sync_connection":case"delete_sync_connection":case"process_sync_connection":if(this.syncInterface){this.syncInterface.handlePullEvent(e)}break;case"task_remove":case"task_add":case"task_update":this.reloadDebounce();break}},getCalendarType:function(){return this.util.type},getOwnerId:function(){return parseInt(this.util.ownerId)},getUserId:function(){return parseInt(this.util.userId)},getSectionInterface:function(){return new Promise(function(e){var t=BX.Calendar.Util.getBX();if(t.Calendar.SectionInterface){e(t.Calendar.SectionInterface)}else{var i="calendar.sectioninterface";t.Runtime.loadExtension(i).then((function(n){if(t.Calendar.SectionInterface){e(t.Calendar.SectionInterface)}else{console.error("Extension "+i+" not found")}}))}}.bind(this))},getSettingsInterface:function(){return new Promise(function(e){var t=BX.Calendar.Util.getBX();if(t.Calendar.SettingsInterface){e(t.Calendar.SettingsInterface)}else{var i="calendar.settingsinterface";t.Runtime.loadExtension(i).then((function(n){if(t.Calendar.SettingsInterface){e(t.Calendar.SettingsInterface)}else{console.error("Extension "+i+" not found")}}))}}.bind(this))},getRoomsInterface:function(){return new Promise(function(e){var t=BX.Calendar.Util.getBX();if(t.Calendar.Rooms.RoomsInterface){e(t.Calendar.Rooms.RoomsInterface)}else{var i="calendar.rooms";t.Runtime.loadExtension(i).then((function(n){if(t.Calendar.Rooms.RoomsInterface){e(t.Calendar.Rooms.RoomsInterface)}else{console.error("Extension "+i+" not found")}}))}}.bind(this))},updateCounters:function(){return new Promise(function(e){BX.ajax.runAction("calendar.api.calendarajax.updateCounters",{data:{}}).then(function(t){if(BX.Type.isObjectLike(t.data.counters)&&this.counters&&this.util.getCounters()){this.counters.setCountersValue(t.data.counters)}e()}.bind(this),function(t){BX.Calendar.Util.displayError(t.errors);e(t)}.bind(this))}.bind(this))},showAfterSyncAccent:function(e){return;BX.Calendar.Sync.Interface.AfterSyncTour.createInstance({showAfterSyncAccent:e,view:this.getView()}).show()},isLocationViewDisabled:function(){return!this.util.config.locationFeatureEnabled&&this.util.config.type==="location"}};if(e.BXEventCalendar){e.BXEventCalendar.Core=t}else{BX.addCustomEvent(e,"onBXEventCalendarInit",(function(){e.BXEventCalendar.Core=t}))}})(window);
//# sourceMappingURL=calendar-core.map.js