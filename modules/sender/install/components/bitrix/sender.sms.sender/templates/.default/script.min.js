(function(){BX.namespace("BX.Sender.SMS");if(BX.Sender.SMS.Sender){return}var e={changeDisplay:function(e,t){if(!e){return}e.style.display=t?"":"none"}};function t(){this.context=null;this.editor=null}t.prototype.init=function(e){this.context=BX(e.containerId);this.senderInputNode=this.context.querySelector('[data-role="sender-input"]');this.senderNode=this.context.querySelector('[data-role="sender-selector"]');this.fromContainerNode=this.context.querySelector('[data-role="from-container"]');this.setupNode=this.context.querySelector('[data-role="setup"]');this.fromNode=this.context.querySelector('[data-role="from-selector"]');this.manageUrl=e.manageUrl;this.senderId=e.senderId;this.list=e.list;var t=this.list.map(function(e){return{id:e.senderId+"."+Math.random(),text:e.name,onclick:this.onSenderSelect.bind(this,e)}},this);this.initSender();BX.bind(this.senderNode,"click",this.showMenu.bind(this,this.senderNode,t,"main"));BX.bind(this.fromNode,"click",this.showFromMenu.bind(this))};t.prototype.initSender=function(){if(this.getSender()){var t=this.getSender();var n=this.list.filter(function(n){var i=n.data.list.filter(function(e){return t==e.id},this);if(i.length>0){e.changeDisplay(this.fromContainerNode,!n.data.isHidden);this.setSender(i[0]);return true}return false},this);if(n.length>0){return}}var i=this.getItemById(this.senderId);if(!i&&this.list.length>0){i=this.list[0]}if(i){e.changeDisplay(this.fromContainerNode,!i.data.isHidden);this.setSender(i.data.list[0])}else{this.showSetup(true)}};t.prototype.showSetup=function(t,n){n=n||this.manageUrl;t=t||false;e.changeDisplay(this.setupNode,t);this.setupNode.href=n};t.prototype.getItemById=function(e){var t=this.list.filter(function(t){return t.senderId==e},this);return t.length===0?null:t[0]};t.prototype.onSenderSelect=function(t){this.senderNode.textContent=t.shortName;this.closeMenu();var n=false;if(t.isConfigurable&&!t.canUse){n=false}else{n=!t.data.isHidden}e.changeDisplay(this.setupNode,!n);e.changeDisplay(this.fromContainerNode,n);if(this.senderId==t.senderId){return}this.senderId=t.senderId;this.setSender(t.data.list[0])};t.prototype.setSender=function(e){this.fromNode.textContent=e.name;this.senderInputNode.value=e.id};t.prototype.getSender=function(){return this.senderInputNode.value};t.prototype.onSelect=function(e){this.setSender(e);this.closeMenu()};t.prototype.showFromMenu=function(){var e=this.getItemById(this.senderId);if(!e){return}var t=e.data.list.map(function(e){return{id:e.id,text:e.name,onclick:this.onSelect.bind(this,e)}},this);this.showMenu(this.fromNode,t,this.senderId)};t.prototype.showMenu=function(e,t,n){this.popup=this.createMenu("sender-sms-sender-"+n,e,t);this.popup.popupWindow.show()};t.prototype.createMenu=function(e,t,n,i){i=i||{};return BX.PopupMenu.create(e,t,n,{autoHide:true,offsetLeft:i.offsetLeft?i.offsetLeft:-21,offsetTop:i.offsetTop?i.offsetTop:-3,angle:{position:"top",offset:42},events:{onPopupClose:BX.delegate(this.onPopupClose,this)}})};t.prototype.closeMenu=function(){if(this.popup&&this.popup.popupWindow){this.popup.popupWindow.close()}};BX.Sender.SMS.Sender=new t})(window);