{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import {Tag, Text, Reflection, Runtime, Event, Type, ajax as Ajax, Dom, Loc} from 'main.core';\nimport {Loader} from \"main.loader\";\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {UserField} from 'ui.userfield';\n\nimport {ButtonManager, Button} from 'ui.buttons';\n\nconst namespace = Reflection.namespace('BX.Main.UserField');\n\n/**\n * @memberOf BX.Main.UserField\n */\nclass Config\n{\n\tstatic #instances: Map = new Map();\n\n\tid: number = 0;\n\tinputs: Map = new Map();\n\ttabs: Map = new Map();\n\tcontainer: Element = null;\n\tsettingsContainer: ?Element = null;\n\tsettingsTable: ?Element = null;\n\terrorsContainer: ?Element = null;\n\tsaveButton: ?Button = null;\n\tcancelButton: ?Button = null;\n\tdeleteButton: ?Button = null;\n\tmoduleId: string;\n\n\tconstructor(params: {\n\t\tid: number,\n\t\tcontainer: Element,\n\t\terrorsContainer: Element,\n\t\tmoduleId: string,\n\t})\n\t{\n\t\tthis.tabs = new Map();\n\t\tthis.inputs = new Map();\n\t\tconst saveButtonNode = document.getElementById('ui-button-panel-save');\n\t\tif (saveButtonNode)\n\t\t{\n\t\t\tthis.saveButton = ButtonManager.createFromNode(saveButtonNode);\n\t\t}\n\t\tconst cancelButtonNode = document.getElementById('ui-button-panel-cancel');\n\t\tif (cancelButtonNode)\n\t\t{\n\t\t\tthis.cancelButton = ButtonManager.createFromNode(cancelButtonNode);\n\t\t}\n\t\tconst deleteButtonNode = document.getElementById('ui-button-panel-remove');\n\t\tif (deleteButtonNode)\n\t\t{\n\t\t\tthis.deleteButton = ButtonManager.createFromNode(deleteButtonNode);\n\t\t}\n\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tthis.id = Text.toInteger(params.id);\n\t\t\tif (Type.isDomNode(params.container))\n\t\t\t{\n\t\t\t\tthis.container = params.container;\n\t\t\t}\n\t\t\tif (Type.isDomNode(params.errorsContainer))\n\t\t\t{\n\t\t\t\tthis.errorsContainer = params.errorsContainer;\n\t\t\t}\n\t\t\tthis.moduleId = params.moduleId;\n\t\t}\n\n\t\tthis.bindEvents();\n\n\t\tthis.fillTabs();\n\n\t\tthis.constructor.#instances.set(this.id, this);\n\n\t\tthis.adjustVisibility();\n\t\tthis.syncEnumDefaultSelector();\n\t}\n\n\tgetBooleanInputNames(): Array\n\t{\n\t\treturn [\n\t\t\t'multiple',\n\t\t\t'mandatory',\n\t\t\t'showFilter',\n\t\t\t'isSearchable',\n\t\t]\n\t}\n\n\tgetSettingsContainer(): ?Element\n\t{\n\t\tif (this.container && !this.settingsContainer)\n\t\t{\n\t\t\tthis.settingsContainer = this.container.querySelector('[data-role=\"main-user-field-settings-container\"]');\n\t\t}\n\n\t\treturn this.settingsContainer;\n\t}\n\n\tgetSettingsTable(): ?Element\n\t{\n\t\tif (!this.settingsTable)\n\t\t{\n\t\t\tconst settingsContainer = this.getSettingsContainer();\n\t\t\tif (settingsContainer)\n\t\t\t{\n\t\t\t\tthis.settingsTable = settingsContainer.querySelector('[data-role=\"main-user-field-settings-table\"]');\n\t\t\t}\n\t\t}\n\n\t\treturn this.settingsTable;\n\t}\n\n\tfillTabs()\n\t{\n\t\tconst tabNames = [\n\t\t\t'common', 'labels', 'additional', 'list'\n\t\t];\n\t\tif (this.container)\n\t\t{\n\t\t\ttabNames.forEach((name: string) => {\n\t\t\t\tconst tab = this.container.querySelector('[data-tab=\"' + name + '\"]');\n\t\t\t\tif (tab)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.set(name, tab);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tshowTab(name: string)\n\t{\n\t\tArray.from(this.tabs.keys()).forEach((tabName: string) => {\n\t\t\tif (tabName === name)\n\t\t\t{\n\t\t\t\tthis.tabs.get(tabName).classList.add('main-user-field-edit-tab-current');\n\n\t\t\t\tif (name === 'list')\n\t\t\t\t{\n\t\t\t\t\tthis.syncEnumDefaultSelector();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.tabs.get(tabName).classList.remove('main-user-field-edit-tab-current');\n\t\t\t}\n\t\t});\n\t}\n\n\tgetInput(name: string): ?Element\n\t{\n\t\tif (this.container && !this.inputs.has(name))\n\t\t{\n\t\t\tconst input = this.container.querySelector('[data-role=\"main-user-field-' + name + '\"]');\n\t\t\tif (input)\n\t\t\t{\n\t\t\t\tthis.inputs.set(name, input);\n\t\t\t}\n\t\t}\n\n\t\treturn this.inputs.get(name);\n\t}\n\n\tgetInputValue(name: string): ?string\n\t{\n\t\tif (name === 'userTypeId')\n\t\t{\n\t\t\treturn this.getSelectedUserTypeId();\n\t\t}\n\n\t\tconst input = this.getInput(name);\n\t\tif (input)\n\t\t{\n\t\t\tif (this.getBooleanInputNames().includes(name))\n\t\t\t{\n\t\t\t\treturn (input.checked ? 'Y' : 'N');\n\t\t\t}\n\n\t\t\treturn input.value;\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tbindEvents()\n\t{\n\t\tconst userTypeIdSelector = this.getInput('userTypeId');\n\t\tif (userTypeIdSelector)\n\t\t{\n\t\t\tEvent.bind(userTypeIdSelector, 'change', this.handleUserTypeChange.bind(this));\n\t\t}\n\n\t\tconst commonLabelInput = this.getInput('editFormLabel');\n\t\tif (commonLabelInput && commonLabelInput.parentElement && commonLabelInput.parentElement.parentElement)\n\t\t{\n\t\t\tconst languageId = commonLabelInput.parentElement.parentElement.dataset['language'];\n\t\t\tconst currentLanguageLabelInput = this.getInput('editFormLabel-' + languageId);\n\t\t\tif (currentLanguageLabelInput)\n\t\t\t{\n\t\t\t\tEvent.bind(commonLabelInput, 'change', () => {\n\t\t\t\t\tthis.syncLabelInputs(commonLabelInput, currentLanguageLabelInput);\n\t\t\t\t});\n\n\t\t\t\tEvent.bind(currentLanguageLabelInput, 'change', () => {\n\t\t\t\t\tthis.syncLabelInputs(currentLanguageLabelInput, commonLabelInput);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tconst addEnum = this.container.querySelector('[data-role=\"main-user-field-enum-add\"]');\n\t\tif (addEnum)\n\t\t{\n\t\t\tEvent.bind(addEnum, 'click', this.addEnumRow.bind(this));\n\t\t}\n\n\t\tconst deleteButtons = Array.from(this.container.querySelectorAll('[data-role=\"main-user-field-enum-delete\"]'));\n\t\tdeleteButtons.forEach((target) => {\n\t\t\tEvent.bind(target, 'click', this.deleteEnumRow.bind(this));\n\t\t});\n\n\t\tconst enumRows = Array.from(this.container.querySelectorAll('[data-role=\"main-user-field-enum-row\"]'));\n\t\tenumRows.forEach((row: Element) => {\n\t\t\tconst input = row.querySelector('[data-role=\"main-user-field-enum-value\"]');\n\t\t\tif (input)\n\t\t\t{\n\t\t\t\tEvent.bind(input, 'change', this.syncEnumDefaultSelector.bind(this));\n\t\t\t}\n\t\t});\n\n\t\tEvent.bind(\n\t\t\tthis.saveButton.getContainer(),\n\t\t\t'click',\n\t\t\t(event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.save();\n\t\t\t},\n\t\t\t{\n\t\t\t\tpassive: false\n\t\t\t}\n\t\t);\n\n\t\tif (this.deleteButton)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.deleteButton.getContainer(),\n\t\t\t\t'click',\n\t\t\t\t(event) => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tthis.delete();\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tgetSelectedUserTypeId(): ?string\n\t{\n\t\tconst option = this.getSelectedOption('userTypeId');\n\t\tif (option)\n\t\t{\n\t\t\treturn option.value;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetSelectedOption(inputName: string): ?HTMLOptionElement\n\t{\n\t\tconst input = this.getInput(inputName);\n\t\tif (input)\n\t\t{\n\t\t\tconst options = Array.from(input.querySelectorAll('option'));\n\t\t\tconst index = input.selectedIndex;\n\t\t\treturn options[index];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetSelectedOptions(inputName: string): ?HTMLCollection\n\t{\n\t\tconst input = this.getInput(inputName);\n\t\tif (input && input instanceof HTMLSelectElement)\n\t\t{\n\t\t\treturn input.selectedOptions;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thandleUserTypeChange()\n\t{\n\t\tif (this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingsTable = this.getSettingsTable();\n\t\tif (!settingsTable)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userTypeId = this.getSelectedUserTypeId();\n\t\tif (!userTypeId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.startProgress();\n\t\tAjax.runComponentAction('bitrix:main.field.config.detail', 'getSettings', {\n\t\t\tdata: {\n\t\t\t\tuserTypeId,\n\t\t\t},\n\t\t\tanalyticsLabel: 'mainUserFieldConfigGetSettings',\n\t\t\tmode: 'class',\n\t\t}).then((response) => {\n\t\t\tthis.stopProgress();\n\t\t\tlet html = '';\n\t\t\tif (response.data.html && response.data.html.length > 0)\n\t\t\t{\n\t\t\t\thtml = response.data.html;\n\t\t\t}\n\t\t\tRuntime.html(settingsTable, html).then(() => {\n\t\t\t\tthis.adjustVisibility();\n\t\t\t});\n\t\t}).catch((response) => {\n\t\t\tthis.stopProgress();\n\t\t\tthis.showErrors(response.errors);\n\t\t});\n\t}\n\n\tgetLoader()\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({size: 150});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tif (!this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(this.container);\n\t\t}\n\t\tthis.hideErrors();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.getLoader().hide();\n\t\tsetTimeout(() => {\n\t\t\tthis.saveButton.setWaiting(false);\n\t\t\tDom.removeClass(this.saveButton.getContainer(), 'ui-btn-wait');\n\t\t\tif (this.deleteButton)\n\t\t\t{\n\t\t\t\tthis.deleteButton.setWaiting(false);\n\t\t\t\tDom.removeClass(this.deleteButton.getContainer(), 'ui-btn-wait');\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tshowErrors(errors: string[])\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) => {\n\t\t\ttext += message;\n\t\t});\n\t\tif (Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = text;\n\t\t\tthis.errorsContainer.parentElement.style.display = 'block';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\thideErrors()\n\t{\n\t\tif (Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = '';\n\t\t\tthis.errorsContainer.parentElement.style.display = 'none';\n\t\t}\n\t}\n\n\tgetSettings(): {}\n\t{\n\t\tconst settings = {};\n\n\t\tconst settingsForm = this.container.querySelector('[data-role=\"main-user-field-settings\"]');\n\t\tif (settingsForm)\n\t\t{\n\t\t\tconst formData = new FormData(settingsForm);\n\t\t\tfor(let pair of formData.entries())\n\t\t\t{\n\t\t\t\tconst name = pair[0].substr(9, pair[0].length - 10);\n\t\t\t\tsettings[name] = pair[1];\n\t\t\t}\n\t\t}\n\n\t\treturn settings;\n\t}\n\n\tprepareFieldData(): {}\n\t{\n\t\tif (!this.container)\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\tconst editFormLabel = {};\n\n\t\tconst labelInputs = Array.from(this.container.querySelectorAll('[data-role=\"main-user-field-label-container\"]'));\n\t\tlabelInputs.forEach((labelContainer) => {\n\t\t\tconst languageId = labelContainer.dataset['language'];\n\t\t\teditFormLabel[languageId] = this.getInputValue('editFormLabel-' + languageId);\n\t\t});\n\n\t\tconst list = [];\n\t\tconst userTypeId = this.getInputValue('userTypeId');\n\t\tif (userTypeId === 'enumeration')\n\t\t{\n\t\t\tthis.syncEnumDefaultSelector();\n\t\t\tconst selectedAttributes = this.getSelectedEnumDefaultAttributes();\n\t\t\tconst sortStep = 100;\n\t\t\tlet sort = 0;\n\t\t\tlet index = 1;\n\t\t\tconst rows = Array.from(this.container.querySelectorAll('[data-role=\"main-user-field-enum-row\"]'));\n\t\t\trows.forEach((row: Element) => {\n\t\t\t\tconst input = row.querySelector('[data-role=\"main-user-field-enum-value\"]');\n\t\t\t\tif (!input)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst id = Text.toInteger(row.dataset['id']);\n\t\t\t\tconst value = input.value;\n\t\t\t\tlet def = 'N';\n\t\t\t\tif (\n\t\t\t\t\t(id > 0 && selectedAttributes.id.includes(id))\n\t\t\t\t\t|| selectedAttributes.value.includes(value)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tdef = 'Y';\n\t\t\t\t}\n\t\t\t\tsort += sortStep;\n\t\t\t\tlist.push({\n\t\t\t\t\tvalue: input.value,\n\t\t\t\t\tdef,\n\t\t\t\t\tsort,\n\t\t\t\t\tid,\n\t\t\t\t});\n\t\t\t\tindex++;\n\t\t\t})\n\t\t}\n\n\t\tconst id = Text.toInteger(this.getInputValue('id'));\n\t\tlet fieldName = this.getInputValue('fieldName');\n\t\tif (id <= 0)\n\t\t{\n\t\t\tfieldName = this.getInputValue('fieldPrefix') + fieldName;\n\t\t}\n\n\t\treturn {\n\t\t\tid,\n\t\t\teditFormLabel,\n\t\t\tentityId: this.getInputValue('entityId'),\n\t\t\tfieldName: fieldName,\n\t\t\tsort: this.getInputValue('sort'),\n\t\t\tmultiple: this.getInputValue('multiple'),\n\t\t\tmandatory: this.getInputValue('mandatory'),\n\t\t\tshowFilter: this.getInputValue('showFilter'),\n\t\t\tisSearchable: this.getInputValue('isSearchable'),\n\t\t\tuserTypeId,\n\t\t\tsettings: this.getSettings(),\n\t\t\tenum: list,\n\t\t};\n\t}\n\n\tsave()\n\t{\n\t\tif (this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.moduleId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.startProgress();\n\t\tconst fieldData = this.prepareFieldData();\n\n\t\tlet languageId = null;\n\t\tconst commonLabelInput = this.getInput('editFormLabel');\n\t\tif (commonLabelInput && commonLabelInput.parentElement && commonLabelInput.parentElement.parentElement)\n\t\t{\n\t\t\tlanguageId = commonLabelInput.parentElement.parentElement.dataset['language'];\n\t\t}\n\n\t\tconst userField = new UserField(fieldData, {\n\t\t\tlanguageId,\n\t\t\tmoduleId: this.moduleId,\n\t\t});\n\t\tuserField.save().then(() => {\n\t\t\tthis.afterSave(userField);\n\t\t\tthis.stopProgress();\n\t\t}).catch((errors) => {\n\t\t\tthis.showErrors(errors);\n\t\t\tthis.stopProgress();\n\t\t});\n\t}\n\n\tdelete()\n\t{\n\t\tif (this.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.moduleId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst id = Text.toInteger(this.getInputValue('id'));\n\t\tif (id <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tMessageBox.confirm(\n\t\t\tLoc.getMessage('MAIN_FIELD_CONFIG_DELETE_CONFIRM'),\n\t\t\t() => {\n\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\tconst userField = new UserField(this.prepareFieldData(), {\n\t\t\t\t\t\tmoduleId: this.moduleId,\n\t\t\t\t\t});\n\t\t\t\t\tthis.startProgress();\n\t\t\t\t\tuserField.delete().then(() => {\n\t\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\t\tconst slider = this.getSlider();\n\t\t\t\t\t\tif (slider)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addDataToSlider('userFieldData', userField.serialize());\n\t\t\t\t\t\t\tslider.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tMessageBox.alert(Loc.getMessage('MAIN_FIELD_CONFIG_DELETE_SUCCESS'));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}).catch((errors) => {\n\t\t\t\t\t\tthis.stopProgress();\n\t\t\t\t\t\tthis.showErrors(errors);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tnull,\n\t\t\t(box) => {\n\t\t\t\tthis.stopProgress();\n\t\t\t\tbox.close();\n\t\t\t}\n\t\t);\n\t}\n\n\tadjustVisibility()\n\t{\n\t\tconst settingsTable = this.getSettingsTable();\n\t\tconst settingsTab = document.querySelector('[data-role=\"tab-additional\"]');\n\t\tconst listTab = document.querySelector('[data-role=\"tab-list\"]');\n\t\tif (!settingsTable || !settingsTab || !listTab)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (settingsTable.childElementCount <= 0)\n\t\t{\n\t\t\tsettingsTab.style.display = 'none';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsettingsTab.style.display = 'block';\n\t\t}\n\t\tconst userTypeId = this.getSelectedUserTypeId();\n\t\tif (userTypeId === 'enumeration')\n\t\t{\n\t\t\tlistTab.style.display = 'flex';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlistTab.style.display = 'none';\n\t\t}\n\t\tif (userTypeId === 'boolean')\n\t\t{\n\t\t\tthis.changeInputVisibility('multiple', 'none');\n\t\t\tthis.changeInputVisibility('mandatory', 'none');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.changeInputVisibility('multiple', 'block');\n\t\t\tthis.changeInputVisibility('mandatory', 'block');\n\t\t}\n\t}\n\n\tchangeInputVisibility(inputName: string, display: string)\n\t{\n\t\tconst input = this.getInput(inputName);\n\t\tif (input && input.parentElement && input.parentElement.parentElement)\n\t\t{\n\t\t\tinput.parentElement.parentElement.style.display = display;\n\t\t}\n\t}\n\n\tafterSave(userField: UserField)\n\t{\n\t\tthis.addDataToSlider('userFieldData', userField.serialize());\n\t\tconst slider = this.getSlider();\n\t\tif (slider)\n\t\t{\n\t\t\tslider.close();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst id = Text.toInteger(this.getInputValue('id'));\n\t\t\tif (id <= 0)\n\t\t\t{\n\t\t\t\tif (!!userField.getDetailUrl())\n\t\t\t\t{\n\t\t\t\t\tlocation.href = userField.getDetailUrl();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.getInput('id').value = userField.getId();\n\t\t\t\tconst prefixInput = this.getInput('fieldPrefix');\n\t\t\t\tif (prefixInput && prefixInput.parentElement && prefixInput.parentElement.parentElement)\n\t\t\t\t{\n\t\t\t\t\tprefixInput.parentElement.parentElement.classList.remove('main-user-field-name-with-prefix');\n\t\t\t\t\tDom.remove(prefixInput.parentElement);\n\t\t\t\t}\n\t\t\t\tthis.getInput('fieldName').value = userField.getName();\n\t\t\t\tthis.getInput('fieldName').disabled = true;\n\t\t\t\tthis.getInput('fieldName').parentElement.classList.remove('ui-ctl-inline');\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSlider()\n\t{\n\t\tif (Reflection.getClass('BX.SidePanel'))\n\t\t{\n\t\t\treturn BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddDataToSlider(key, data)\n\t{\n\t\tif (Type.isString(key))\n\t\t{\n\t\t\tlet slider = this.getSlider();\n\t\t\tif (slider)\n\t\t\t{\n\t\t\t\tslider.getData().set(key, data);\n\t\t\t\tBX.SidePanel.Instance.postMessage(slider, 'userfield-list-update');\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic handleLeftMenuClick(id: number, tabName: string)\n\t{\n\t\tif (Config.#instances)\n\t\t{\n\t\t\tconst instance = Config.#instances.get(id);\n\t\t\tif (instance)\n\t\t\t{\n\t\t\t\tinstance.showTab(tabName);\n\t\t\t}\n\t\t}\n\t}\n\n\tsyncLabelInputs(fromLabel: HTMLInputElement, toLabel: HTMLInputElement)\n\t{\n\t\tconst tab = fromLabel.closest('.main-user-field-edit-tab');\n\t\tif (tab && tab.classList.contains('main-user-field-edit-tab-current'))\n\t\t{\n\t\t\ttoLabel.value = fromLabel.value;\n\t\t}\n\t}\n\n\taddEnumRow()\n\t{\n\t\tconst addEnum = this.container.querySelector('[data-role=\"main-user-field-enum-add\"]');\n\t\tif (addEnum)\n\t\t{\n\t\t\tconst input = Tag.render`<input class=\"ui-ctl-element\" type=\"text\" name=\"ENUM[][VALUE]\" value=\"\"\n\t\t\t\t\t\t\t\t data-role=\"main-user-field-enum-value\"\n\t\t\t\t\t\t\t\t onchange=\"${this.syncEnumDefaultSelector.bind(this)}\">`;\n\t\t\tconst row = Tag.render`\n\t\t\t\t\t<div class=\"main-user-field-enum-row\" data-role=\"main-user-field-enum-row\">\n\t\t\t\t\t\t<div class=\"main-user-field-enum-row-inner ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row\">\n\t\t\t\t\t\t\t<span class=\"main-user-field-enum-row-draggable\" style=\"\"></span>\n\t\t\t\t\t\t\t${input}\n\t\t\t\t\t\t\t<div class=\"main-user-field-enum-delete\" onclick=\"${this.deleteEnumRow.bind(this)}\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\tDom.append(row, document.querySelector('.main-user-field-enum-row-list'));\n\t\t\tinput.focus();\n\n\t\t\tlet item = new DragDropItem();\n\t\t\titem.init(row);\n\t\t}\n\t}\n\n\tdeleteEnumRow({target})\n\t{\n\t\tDom.remove(target.parentElement);\n\t\tthis.syncEnumDefaultSelector();\n\t}\n\n\tgetSelectedEnumDefaultAttributes(): {id: string[], value: string[]}\n\t{\n\t\tconst result = {\n\t\t\tid: [],\n\t\t\tvalue: [],\n\t\t};\n\n\t\tconst selectedDefaultOptions = this.getSelectedOptions('enumDefault');\n\t\tif (selectedDefaultOptions)\n\t\t{\n\t\t\tArray.from(selectedDefaultOptions).forEach((option) => {\n\t\t\t\tif (option.dataset['id'] && option.dataset['id'] > 0)\n\t\t\t\t{\n\t\t\t\t\tresult['id'].push(Text.toInteger(option.dataset['id']));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresult['value'].push(option.value);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsyncEnumDefaultSelector()\n\t{\n\t\tconst userTypeId = this.getInputValue('userTypeId');\n\t\tif (userTypeId === 'enumeration')\n\t\t{\n\t\t\tconst selector = this.getInput('enumDefault');\n\t\t\tif (!selector)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst isMultiple = this.getInputValue('multiple');\n\t\t\tif (isMultiple === 'Y')\n\t\t\t{\n\t\t\t\tselector.multiple = true;\n\t\t\t\tselector.size = 3;\n\t\t\t\tselector.parentElement.classList.add('ui-ctl-multiple-select');\n\t\t\t\tselector.parentElement.classList.remove('ui-ctl-after-icon');\n\t\t\t\tselector.parentElement.classList.remove('ui-ctl-dropdown');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tselector.multiple = false;\n\t\t\t\tselector.parentElement.classList.remove('ui-ctl-multiple-select');\n\t\t\t\tselector.parentElement.classList.add('ui-ctl-after-icon');\n\t\t\t\tselector.parentElement.classList.add('ui-ctl-dropdown');\n\t\t\t}\n\t\t\tconst selectedAttributes = this.getSelectedEnumDefaultAttributes();\n\t\t\tconst options = Array.from(selector.querySelectorAll('option'));\n\t\t\toptions.forEach((option: HTMLOptionElement) => {\n\t\t\t\tif (option.value !== 'empty')\n\t\t\t\t{\n\t\t\t\t\tDom.remove(option);\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst rows = Array.from(this.container.querySelectorAll('[data-role=\"main-user-field-enum-row\"]'));\n\t\t\trows.forEach((row: Element) => {\n\t\t\t\tconst id = Text.toInteger(row.dataset['id']);\n\t\t\t\tconst input = row.querySelector('[data-role=\"main-user-field-enum-value\"]');\n\t\t\t\tif (!input)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst value = input.value;\n\t\t\t\tconst selected = (\n\t\t\t\t\t(id > 0 && selectedAttributes.id.includes(id))\n\t\t\t\t\t|| (selectedAttributes.value.includes(value))\n\t\t\t\t);\n\t\t\t\tif (value.length > 0)\n\t\t\t\t{\n\t\t\t\t\tselector.appendChild(Tag.render`<option ${selected ? 'selected=\"selected\"' : ''} value=\"${Text.encode(value)}\" data-id=\"${id}\">${Text.encode(value)}</option>`);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\nclass DragDropItem\n{\n\tconstructor() {\n\t\tthis.itemContainer = null;\n\t\tthis.draggableItemContainer = null;\n\t\tthis.dragElement = null;\n\t}\n\n\tinit(item)\n\t{\n\t\tthis.itemContainer = item;\n\t\tconst dragButton = this.itemContainer.querySelector('.main-user-field-enum-row-draggable');\n\n\t\tif (jsDD)\n\t\t{\n\t\t\tdragButton.onbxdragstart = this.onDragStart.bind(this);\n\t\t\tdragButton.onbxdrag = this.onDrag.bind(this);\n\t\t\tdragButton.onbxdragstop = this.onDragStop.bind(this);\n\n\t\t\tjsDD.registerObject(dragButton);\n\n\t\t\tthis.itemContainer.onbxdestdraghover = this.onDragEnter.bind(this);\n\t\t\tthis.itemContainer.onbxdestdraghout = this.onDragLeave.bind(this);\n\t\t\tthis.itemContainer.onbxdestdragfinish = this.onDragDrop.bind(this);\n\n\t\t\tjsDD.registerDest(this.itemContainer, 30);\n\t\t}\n\t}\n\n\tonDragStart()\n\t{\n\t\tDom.addClass(this.itemContainer, \"main-user-field-enum-row-disabled\");\n\n\t\tif (!this.dragElement)\n\t\t{\n\t\t\tthis.dragElement = this.itemContainer.cloneNode(true);\n\n\t\t\tthis.dragElement.style.position = \"absolute\";\n\t\t\tthis.dragElement.style.width = this.itemContainer.offsetWidth + \"px\";\n\t\t\tthis.dragElement.className = \"main-user-field-enum-row-drag\";\n\n\t\t\tDom.append(this.dragElement, document.body);\n\t\t}\n\t}\n\n\tonDrag(x, y)\n\t{\n\t\tif (this.dragElement)\n\t\t{\n\t\t\tthis.dragElement.style.left = x + \"px\";\n\t\t\tthis.dragElement.style.top = y + \"px\";\n\t\t}\n\t}\n\n\tonDragStop()\n\t{\n\t\tDom.removeClass(this.itemContainer, \"main-user-field-enum-row-disabled\");\n\t\tDom.remove(this.dragElement);\n\t\tthis.dragElement = null;\n\t}\n\n\tonDragEnter(draggableItem)\n\t{\n\t\tthis.draggableBtnContainer = draggableItem.closest('.main-user-field-enum-row');\n\n\t\tif (this.draggableBtnContainer !== this.itemContainer)\n\t\t{\n\t\t\tthis.showDragTarget();\n\t\t}\n\t}\n\n\tonDragLeave()\n\t{\n\t\tthis.hideDragTarget();\n\t}\n\n\tonDragDrop()\n\t{\n\t\tif (this.draggableBtnContainer !== this.itemContainer)\n\t\t{\n\t\t\tthis.hideDragTarget();\n\t\t\tDom.remove(this.draggableBtnContainer);\n\t\t\tDom.insertBefore(this.draggableBtnContainer, this.itemContainer);\n\t\t}\n\t}\n\n\tshowDragTarget()\n\t{\n\t\tDom.addClass(this.itemContainer, 'main-user-field-enum-row-target-shown');\n\t\tthis.getDragTarget().style.height = this.itemContainer.offsetHeight + \"px\";\n\t}\n\n\thideDragTarget()\n\t{\n\t\tDom.removeClass(this.itemContainer, \"main-user-field-enum-row-target-shown\");\n\t\tthis.getDragTarget().style.height = 0;\n\t}\n\n\tgetDragTarget()\n\t{\n\t\tif (!this.dragTarget)\n\t\t{\n\t\t\tthis.dragTarget = Tag.render`<div class=\"main-user-field-enum-row-drag-target\"></div>`;\n\t\t\tDom.prepend(this.dragTarget, this.itemContainer);\n\t\t}\n\n\t\treturn this.dragTarget;\n\t}\n\n}\n\nclass DragDropBtnContainer\n{\n\tconstructor() {\n\t\tthis.container = document.querySelector('.main-user-field-enum-row-list');\n\t\tthis.height = null;\n\t}\n\n\tinit()\n\t{\n\t\tthis.container.onbxdestdraghover = BX.delegate(this.onDragEnter, this);\n\t\tthis.container.onbxdestdraghout = BX.delegate(this.onDragLeave, this);\n\t\tthis.container.onbxdestdragfinish = BX.delegate(this.onDragDrop, this);\n\t\tjsDD.registerDest(this.container, 40);\n\t}\n\n\tonDragEnter(draggableItem)\n\t{\n\t\tthis.draggableBtnContainer = draggableItem.closest('.main-user-field-enum-row');\n\t\tthis.height = this.draggableBtnContainer.offsetHeight;\n\t\tthis.showDragTarget();\n\t}\n\n\tonDragLeave()\n\t{\n\t\tthis.hideDragTarget();\n\t}\n\n\tonDragDrop()\n\t{\n\t\tthis.hideDragTarget();\n\t\tDom.remove(this.draggableBtnContainer);\n\t\tDom.insertBefore(this.draggableBtnContainer, this.dragTarget);\n\t}\n\n\tshowDragTarget()\n\t{\n\t\tDom.addClass(this.container, 'main-user-field-enum-row-list-target-shown');\n\t\tthis.getDragTarget().style.height = this.height + \"px\";\n\t}\n\n\thideDragTarget()\n\t{\n\t\tDom.removeClass(this.container, \"main-user-field-enum-row-list-target-shown\");\n\t\tthis.getDragTarget().style.height = 0;\n\t}\n\n\tgetDragTarget()\n\t{\n\t\tif (!this.dragTarget)\n\t\t{\n\t\t\tthis.dragTarget = Tag.render`<div class=\"main-user-field-enum-row-list-target\"></div>`;\n\t\t\tDom.append(this.dragTarget, this.container);\n\t\t}\n\n\t\treturn this.dragTarget;\n\t}\n\n}\n\nnamespace.Config = Config;\nnamespace.DragDropItem = DragDropItem;\nnamespace.DragDropBtnContainer = DragDropBtnContainer;"],"names":["namespace","Reflection","Config","params","Map","tabs","inputs","saveButtonNode","document","getElementById","saveButton","ButtonManager","createFromNode","cancelButtonNode","cancelButton","deleteButtonNode","deleteButton","Type","isPlainObject","id","Text","toInteger","isDomNode","container","errorsContainer","moduleId","bindEvents","fillTabs","constructor","set","adjustVisibility","syncEnumDefaultSelector","settingsContainer","querySelector","settingsTable","getSettingsContainer","tabNames","forEach","name","tab","Array","from","keys","tabName","get","classList","add","remove","has","input","getSelectedUserTypeId","getInput","getBooleanInputNames","includes","checked","value","userTypeIdSelector","Event","bind","handleUserTypeChange","commonLabelInput","parentElement","languageId","dataset","currentLanguageLabelInput","syncLabelInputs","addEnum","addEnumRow","deleteButtons","querySelectorAll","target","deleteEnumRow","enumRows","row","getContainer","event","preventDefault","save","passive","option","getSelectedOption","inputName","options","index","selectedIndex","HTMLSelectElement","selectedOptions","isProgress","getSettingsTable","userTypeId","startProgress","Ajax","runComponentAction","data","analyticsLabel","mode","then","response","stopProgress","html","length","Runtime","showErrors","errors","loader","Loader","size","getLoader","isShown","show","hideErrors","hide","setTimeout","setWaiting","Dom","removeClass","text","message","innerText","style","display","console","error","settings","settingsForm","formData","FormData","entries","pair","substr","editFormLabel","labelInputs","labelContainer","getInputValue","list","selectedAttributes","getSelectedEnumDefaultAttributes","sortStep","sort","rows","def","push","fieldName","entityId","multiple","mandatory","showFilter","isSearchable","getSettings","fieldData","prepareFieldData","userField","UserField","afterSave","MessageBox","confirm","Loc","getMessage","Promise","resolve","slider","getSlider","addDataToSlider","serialize","close","alert","box","settingsTab","listTab","childElementCount","changeInputVisibility","getDetailUrl","location","href","getId","prefixInput","getName","disabled","getClass","BX","SidePanel","Instance","getSliderByWindow","window","key","isString","getData","postMessage","fromLabel","toLabel","closest","contains","Tag","render","append","focus","item","DragDropItem","init","result","selectedDefaultOptions","getSelectedOptions","selector","isMultiple","selected","appendChild","encode","instance","showTab","itemContainer","draggableItemContainer","dragElement","dragButton","jsDD","onbxdragstart","onDragStart","onbxdrag","onDrag","onbxdragstop","onDragStop","registerObject","onbxdestdraghover","onDragEnter","onbxdestdraghout","onDragLeave","onbxdestdragfinish","onDragDrop","registerDest","addClass","cloneNode","position","width","offsetWidth","className","body","x","y","left","top","draggableItem","draggableBtnContainer","showDragTarget","hideDragTarget","insertBefore","getDragTarget","height","offsetHeight","dragTarget","prepend","DragDropBtnContainer","delegate"],"mappings":"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"}