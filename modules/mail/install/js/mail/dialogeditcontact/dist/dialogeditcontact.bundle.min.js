this.BX=this.BX||{};this.BX.Mail=this.BX.Mail||{};(function(e,t,a,r,n){"use strict";var i,l,o,s,c,d,u,g,v;function f(e,t){var a=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=T(e))||t&&e&&typeof e.length==="number"){if(a)e=a;var r=0;var n=function e(){};return{s:n,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,l=false,o;return{s:function t(){a=a.call(e)},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){l=true;o=t},f:function e(){try{if(!i&&a["return"]!=null)a["return"]()}finally{if(l)throw o}}}}function T(e,t){if(!e)return;if(typeof e==="string")return m(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return m(e,t)}function m(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var p=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getCheckedFields",value:function e(a){var r=a.querySelector('[data-role="email-container"]');var n=r.querySelector('[data-role="input-field"]');var i=n.value;var l=a.querySelector('[data-role="name-container"]');var o=l.querySelector('[data-role="input-field"]');var s=o.value;var c=true;var d=[];if(!t.Validation.isEmail(i)){c=false;r.showError(0)}else if(s.length<1){s=i.split("@")[0]}d={name:s,email:i};if(c){return d}return false}},{key:"openRemoveDialog",value:function e(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{id:""};var n=new BX.Promise;var i=this.removeContact;var l=BX.SidePanel.Instance.getTopSlider();var o=1;if(l!=null){o+=l.getZindex()}var s=new r.MessageBox({title:t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_REMOVE_DIALOG_TITLE"),message:t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_REMOVE_DIALOG_MESSAGE"),buttons:BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,popupOptions:{zIndex:o},onOk:function e(){i(a["id"]).then((function(){return n.fulfill()}));s.close()},onCancel:function e(){n.reject();s.close()}});s.show();return n}},{key:"removeContact",value:function e(t){return BX.ajax.runAction("mail.addressbook.removecontacts",{data:{idSet:[t]}})}},{key:"saveContact",value:function e(t,a,r){var i=n.Avatar.getAvatarData({fullName:t,email:a});var l={NAME:t,EMAIL:a,COLOR:i["color"],INITIALS:i["abbreviation"]};if(r!==undefined){l["ID"]=r}return BX.ajax.runAction("mail.addressbook.savecontact",{data:{contactData:l}})}},{key:"showError",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;this.emailInputWrapper.classList.add("ui-ctl-danger");BX.show(this.errorTitle[t])}},{key:"hideError",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"all";this.emailInputWrapper.classList.remove("ui-ctl-danger");if(t==="all"){this.errorTitle.forEach((function(e){BX.hide(e)}));return}BX.hide(this.errorTitle[t])}},{key:"openDialog",value:function e(r){var n=this;var T=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{contactID:"new"};var m="dialogEditContact_"+T["contactID"];var p="";var A="";var I="";var b="";if(T["contactData"]!==undefined){A=T["contactData"]["name"];p=T["contactData"]["email"];I="ui-ctl-disabled";b="disabled"}var L=t.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['<input data-role="input-field" type="text" class="ui-ctl-element" value="" placeholder="info@example.com"  ',">"])),b);var _=t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-textbox ui-ctl-w100 ','">\n\t\t\t',"\n\t\t</div>"])),I,L);L.value=p;var E=t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<div class="ui-alert ui-alert-danger mail-addressbook-error-box">\n\t\t\t<span class="ui-alert-message">',"</span>\n\t\t</div>"])),t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_EMAIL_ERROR"));var h=t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['<div class="ui-alert ui-alert-danger mail-addressbook-error-box">\n\t\t\t<span class="ui-alert-message">',"</span>\n\t\t\t<br>\n\t\t</div>"])),t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_EMAIL_ERROR_EMAIL_IS_ALREADY_EXISTS"));var D=h.querySelector('[data-role="contact-email"]');var C=t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['<div data-role="email-container" class="mail-addressbook-dialogeditcontact-item">\n\t\t\t<label class="mail-addressbook-dialogeditcontact-lable">','\n\t\t\t\t<div id="mail-addressbook-dialogeditcontact-contact-email-container" class="ui-ctl ui-ctl-textbox mail-addressbook-dialogeditcontact-field">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t\t","\n\t\t\t","\n\t\t</div>"])),t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_EMAIL_TITLE"),_,E,h);var M=t.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['<input data-role="input-field" type="text" class="ui-ctl-element" value="" placeholder="">'])));var O=t.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t',"\n\t\t</div>"])),M);M.value=A;var y=t.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['<div data-role="name-container" class="mail-addressbook-dialogeditcontact-item">\n\t\t\t<label class="mail-addressbook-dialogeditcontact-lable">','\n\t\t\t\t<div id="mail-addressbook-dialogeditcontact-contact-email-container" class="ui-ctl ui-ctl-textbox mail-addressbook-dialogeditcontact-field">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t</div>"])),t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_NAME_TITLE"),O);var B=t.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(["\n\t\t<div>\n\t\t\t","\n\t\t\t","\n\t\t</div>"])),y,C);C.errorTitle=[E,h];C.emailInputWrapper=_;C.showError=this.showError;C.hideError=this.hideError;C.hideError();L.oninput=function(){return C.hideError()};a.SidePanelWrapper.open({id:m,titleText:r,footerIsActive:true,content:B,cancelButton:{text:t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_BUTTON_CANCEL")},consentButton:{text:t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_BUTTON_SAVE"),function:function e(t){var a=n.getCheckedFields(B);if(a){t.setClocking(true);n.saveContact(a["name"],a["email"],T["contactID"]).then((function(e){BX.SidePanel.Instance.postMessageAll(m,"dialogEditContact::reloadList",{});BX.SidePanel.Instance.close()}))["catch"]((function(e){var a=null;var r=f(e.errors),i;try{for(r.s();!(i=r.n()).done;){var l=i.value;if(l.code==="ALL_CONTACTS_ALREADY_ADDED"){a=l.customData.lastFound[0];break}}}catch(e){r.e(e)}finally{r.f()}if(a!==null){t.setClocking(false);D.onclick=function(){n.openEditDialog({contactID:Number(a["ID"]),contactData:{name:a["NAME"],email:a["EMAIL"]}})};C.showError(1)}else{BX.SidePanel.Instance.postMessageAll(m,"dialogEditContact::reloadList",{});BX.SidePanel.Instance.close()}}))}}}})}},{key:"openCreateDialog",value:function e(a){this.openDialog(t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_TITLE_BAR_ADD"),a)}},{key:"openEditDialog",value:function e(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{contactID:"",contactData:{name:"",email:""}};this.openDialog(t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_TITLE_BAR_EDIT"),a)}}]);return e}();e.DialogEditContact=p})(this.BX.Mail.AddressBook=this.BX.Mail.AddressBook||{},BX,BX.Mail,BX.UI.Dialogs,BX.Mail);
//# sourceMappingURL=dialogeditcontact.bundle.map.js