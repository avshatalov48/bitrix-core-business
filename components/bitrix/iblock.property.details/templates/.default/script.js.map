{"version":3,"file":"script.js","sources":["src/buttons.js","src/errors.js","src/progress.js","src/sliders.js","src/property-details.js"],"sourcesContent":["import { Loc, Dom } from 'main.core';\nimport { ButtonManager, Button } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\nexport class Buttons\n{\n\tcontainer: HTMLElement;\n\tcallbacks: Object;\n\tsaveButton: Button;\n\tremoveButton: Button;\n\n\tconstructor(container: HTMLElement, callbacks: Object)\n\t{\n\t\tthis.callbacks = callbacks;\n\t\tthis.container = container;\n\n\t\tconst saveButtonNode = container.querySelector('#ui-button-panel-save');\n\t\tif (saveButtonNode)\n\t\t{\n\t\t\tsaveButtonNode.addEventListener('click', this.handleSaveButtonClick.bind(this));\n\t\t\tthis.saveButton = ButtonManager.createFromNode(saveButtonNode);\n\t\t}\n\n\t\tconst removeButtonNode = container.querySelector('#ui-button-panel-remove');\n\t\tif (removeButtonNode)\n\t\t{\n\t\t\tremoveButtonNode.addEventListener('click', this.handleRemoveButtonClick.bind(this));\n\t\t\tthis.removeButton = ButtonManager.createFromNode(removeButtonNode);\n\t\t}\n\t}\n\n\thandleSaveButtonClick(e): void\n\t{\n\t\tconst clearState = () => {\n\t\t\tthis.saveButton.setWaiting(false);\n\t\t\tDom.removeClass(this.saveButton.getContainer(), 'ui-btn-wait');\n\t\t};\n\n\t\tthis.callbacks.onSave().then(clearState).catch(clearState);\n\t}\n\n\thandleRemoveButtonClick(e): void\n\t{\n\t\tconst clearState = () => {\n\t\t\tthis.removeButton.setWaiting(false);\n\t\t\tDom.removeClass(this.removeButton.getContainer(), 'ui-btn-wait');\n\t\t};\n\n\t\tMessageBox.confirm(\n\t\t\tLoc.getMessage('IBLOCK_PROPERTY_DETAILS_REMOVE_POPUP_MESSAGE'),\n\t\t\t() => {\n\t\t\t\tthis.callbacks.onRemove().then(clearState).catch(clearState);\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tnull,\n\t\t\t() => {\n\t\t\t\tclearState();\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t);\n\t}\n}\n","import { Type } from 'main.core';\n\nexport class Errors\n{\n\terrorsMessage: HTMLElement;\n\terrorsWrapper: HTMLElement;\n\n\tconstructor(container)\n\t{\n\t\tthis.errorsWrapper = container.querySelector('#iblock-property-details-errors');\n\t\tthis.errorsMessage = this.errorsWrapper.querySelector('.ui-alert-message');\n\t}\n\n\tshow(errors: Array): void\n\t{\n\t\tif (Type.isArray(errors))\n\t\t{\n\t\t\tthis.errorsMessage.innerHTML = errors.map((i) => i.message).join(\"\\n\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.errorsMessage.innerHTML = 'Unknown error';\n\t\t}\n\t\tthis.errorsWrapper.style.display = 'block';\n\t}\n\n\thide(): void\n\t{\n\t\tthis.errorsMessage.innerHTML = '';\n\t\tthis.errorsWrapper.style.display = 'none';\n\t}\n}\n","import { Loader } from 'main.core';\n\nexport class Progress\n{\n\tloader: Loader;\n\tcontainer: HTMLElement;\n\tisProgress: Boolean = false;\n\n\tconstructor(container)\n\t{\n\t\tthis.container = container;\n\t}\n\n\tgetLoader()\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\tsize: 150,\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstart()\n\t{\n\t\tthis.isProgress = true;\n\t\tif (!this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(this.container);\n\t\t}\n\t}\n\n\tstop()\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.getLoader().hide();\n\t}\n}\n","const storageKey = 'iblockPropertyDetails:deferredSlider'\n\nexport class Sliders\n{\n\tstatic getDeferredSlider(): ?String\n\t{\n\t\tconst sliderName = top[storageKey];\n\n\t\ttop[storageKey] = null;\n\n\t\treturn sliderName;\n\t}\n\n\tstatic setDeferredSlider(sliderName: String)\n\t{\n\t\ttop[storageKey] = sliderName;\n\t}\n}\n","import { Runtime, ajax, Loc, Type } from 'main.core';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Buttons } from './buttons';\nimport { Errors } from './errors';\nimport { Progress } from './progress';\nimport { Sliders } from './sliders';\n\nexport class PropertyDetails\n{\n\tpropertyId: Number;\n\tiblockId: Number;\n\tcontainer: HTMLElement;\n\tslidersOptions: Object;\n\tsignedParameters: String;\n\tdetailPageUrlTemplate: String;\n\n\terrors: Errors;\n\tbuttons: Buttons;\n\tprogress: Progress;\n\n\tconstructor(options)\n\t{\n\t\tthis.iblockId = options.iblockId;\n\t\tthis.propertyId = options.propertyId;\n\t\tthis.slidersOptions = options.sliders;\n\t\tthis.signedParameters = options.signedParameters;\n\t\tthis.detailPageUrlTemplate = options.detailPageUrlTemplate || '';\n\n\t\tthis.container = document.querySelector(options.containerSelector);\n\n\t\tthis.errors = new Errors(this.container);\n\t\tthis.progress = new Progress(this.container);\n\t\tthis.buttons = new Buttons(this.container, {\n\t\t\tonSave: this.handlerSaveButtonClick.bind(this),\n\t\t\tonRemove: this.handlerRemoveButtonClick.bind(this),\n\t\t});\n\n\t\tthis.initEvents();\n\t\tthis.adjustVisibilityLeftMenu();\n\t\tthis.stylizationSettingsControls();\n\n\t\tBX.UI.Hint.init(this.container);\n\n\t\tconst deferredSliderName = Sliders.getDeferredSlider();\n\t\tif (deferredSliderName)\n\t\t{\n\t\t\tthis.openSlider(deferredSliderName);\n\t\t}\n\t}\n\n\t#runAction(action, data): Promise\n\t{\n\t\treturn ajax.runComponentAction('bitrix:iblock.property.details', action, {\n\t\t\tmode: 'class',\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tdata,\n\t\t});\n\t}\n\n\tinitEvents(): void\n\t{\n\t\tthis.getPropertyTypeInput().addEventListener('change', this.handlePropertyTypeChange.bind(this));\n\t}\n\n\tgetTabs(): NodeList\n\t{\n\t\treturn this.container.querySelectorAll('.iblock-property-details-tab');\n\t}\n\n\tgetAdditionalTab(): HTMLElement\n\t{\n\t\treturn Array.prototype.find.call(\n\t\t\tthis.getTabs(),\n\t\t\t(node: HTMLElement) => node.dataset.tab === 'additional',\n\t\t);\n\t}\n\n\tgetPropertyTypeInput(): HTMLInputElement\n\t{\n\t\treturn this.container.querySelector('[name=\"PROPERTY_TYPE\"]');\n\t}\n\n\topenTab(tabName): void\n\t{\n\t\tconst activeClassName = 'iblock-property-details-tab_current';\n\n\t\tthis.getTabs().forEach((tab: HTMLElement) => {\n\t\t\tif (tab.dataset.tab === tabName)\n\t\t\t{\n\t\t\t\ttab.classList.add(activeClassName);\n\t\t\t}\n\t\t\telse if (tab.classList.contains(activeClassName))\n\t\t\t{\n\t\t\t\ttab.classList.remove(activeClassName);\n\t\t\t}\n\t\t});\n\t}\n\n\topenSlider(sliderName): void\n\t{\n\t\tconst sliderOptions = this.slidersOptions[sliderName];\n\t\tif (!sliderOptions)\n\t\t{\n\t\t\tthrow new Error(`Cannot find config for slider '${sliderName}'`);\n\t\t}\n\n\t\tif (this.isNewProperty() && sliderOptions.newPropertyConfirmMessage)\n\t\t{\n\t\t\tMessageBox.confirm(\n\t\t\t\tsliderOptions.newPropertyConfirmMessage,\n\t\t\t\t() => {\n\t\t\t\t\tSliders.setDeferredSlider(sliderName);\n\n\t\t\t\t\tthis.handlerSaveButtonClick();\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tLoc.getMessage('IBLOCK_PROPERTY_DETAILS_POPUP_OPEN_SLIDER_CONFIRM_SAVE_BUTTON'),\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttop.BX.SidePanel.Instance.open(sliderOptions.url, sliderOptions);\n\t\t}\n\t}\n\n\thandlePropertyTypeChange(e)\n\t{\n\t\tif (this.progress.isProgress)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.progress.start();\n\t\tthis.errors.hide();\n\n\t\tthis\n\t\t\t.#runAction('getSettings', {\n\t\t\t\tpropertyFullType: this.getPropertyTypeInput().value,\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tconst showedFields = response.data.info?.showedFields;\n\t\t\t\tif (Type.isArray(showedFields))\n\t\t\t\t{\n\t\t\t\t\tthis.adjustVisibilityCommonFields(showedFields);\n\t\t\t\t}\n\n\t\t\t\tlet html = '';\n\t\t\t\tif (response.data.html && response.data.html.length > 0)\n\t\t\t\t{\n\t\t\t\t\thtml = response.data.html;\n\t\t\t\t}\n\n\t\t\t\tthis.progress.stop();\n\n\t\t\t\tRuntime.html(this.getAdditionalTab(), html).then(() => {\n\t\t\t\t\tthis.adjustVisibilityLeftMenu();\n\t\t\t\t\tthis.stylizationSettingsControls();\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.progress.stop();\n\n\t\t\t\tthis.errors.show(\n\t\t\t\t\tresponse.errors,\n\t\t\t\t);\n\t\t\t})\n\t\t;\n\t}\n\n\tadjustVisibilityCommonFields(fields: Array): void\n\t{\n\t\tconst commonTab = this.container.querySelector('[data-tab=\"common\"]');\n\t\tif (!commonTab)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcommonTab.querySelectorAll('input, select, textarea').forEach((input) => {\n\t\t\tif (!input.name || input.name === 'PROPERTY_TYPE')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst inputContainer = input.closest('.iblock-property-details-input');\n\t\t\tif (fields.includes(input.name))\n\t\t\t{\n\t\t\t\tinput.disabled = false;\n\t\t\t\tif (inputContainer)\n\t\t\t\t{\n\t\t\t\t\tinputContainer.style.display = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tinput.disabled = true;\n\t\t\t\tif (inputContainer)\n\t\t\t\t{\n\t\t\t\t\tinputContainer.style.display = 'none';\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tadjustVisibilityLeftMenu(): void\n\t{\n\t\tconst propertyType = this.container.querySelector('[name=\"PROPERTY_TYPE\"]')?.value;\n\n\t\tconst listMenuItem = document.querySelector('#iblock-property-details-sidepanel-menu [data-slider=\"list-values\"]');\n\t\tif (propertyType === 'L')\n\t\t{\n\t\t\tlistMenuItem.style.display = 'flex';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlistMenuItem.style.display = 'none';\n\t\t}\n\n\t\tconst directoryMenuItem = document.querySelector('#iblock-property-details-sidepanel-menu [data-slider=\"directory-items\"]');\n\t\tif (propertyType === 'S:directory')\n\t\t{\n\t\t\tdirectoryMenuItem.style.display = 'flex';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdirectoryMenuItem.style.display = 'none';\n\t\t}\n\t}\n\n\tstylizationSettingsControls(): void\n\t{\n\t\tconst buttonInputTypes = new Set([\n\t\t\t'button',\n\t\t\t'submit',\n\t\t\t'reset',\n\t\t]);\n\t\tconst flagInputTypes = new Set([\n\t\t\t'checkbox',\n\t\t\t'radio',\n\t\t]);\n\n\t\tconst isOnlyChild = function(control) {\n\t\t\tlet childs = control.parentNode.childNodes;\n\n\t\t\tchilds = Array.prototype.filter.call(childs, (item) => {\n\t\t\t\tif (item instanceof Text)\n\t\t\t\t{\n\t\t\t\t\treturn item.nodeValue.trim() !== '';\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\treturn childs.length === 1;\n\t\t};\n\n\t\tconst prepareControl = function(control) {\n\t\t\t// skip `ui.forms` controls\n\t\t\tif (control.classList.contains('ui-ctl-element'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (control.nodeName)\n\t\t\t{\n\t\t\t\tcase 'INPUT': {\n\t\t\t\t\tconst type = control.type || 'text';\n\t\t\t\t\tif (buttonInputTypes.has(type))\n\t\t\t\t\t{}\n\t\t\t\t\telse if (flagInputTypes.has(type))\n\t\t\t\t\t{\n\t\t\t\t\t// pass\n\t\t\t\t\t}\n\t\t\t\t\telse if (type === 'hidden')\n\t\t\t\t\t{\n\t\t\t\t\t// pass\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcontrol.classList.add('ui-ctl-element');\n\t\t\t\t\t\tif (isOnlyChild(control))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontrol.classList.add('ui-ctl-w100');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontrol.classList.add('ui-ctl-inline');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'SELECT': {\n\t\t\t\t\tcontrol.classList.add('ui-ctl-element');\n\t\t\t\t\tif (!isOnlyChild(control))\n\t\t\t\t\t{\n\t\t\t\t\t\tcontrol.classList.add('ui-ctl-inline');\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase 'TEXTAREA': {\n\t\t\t\t\tcontrol.classList.add('ui-ctl-element');\n\t\t\t\t\tcontrol.classList.add('ui-ctl-textarea');\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t// No default\n\t\t\t}\n\t\t};\n\n\t\tconst settingsContainer = this.getAdditionalTab().querySelector('.iblock-property-details-settings-table');\n\t\tif (settingsContainer)\n\t\t{\n\t\t\tsettingsContainer\n\t\t\t\t.querySelectorAll('input, select, textarea')\n\t\t\t\t.forEach(prepareControl)\n\t\t\t;\n\t\t}\n\n\t\tconst defaultValueControl = this.getAdditionalTab().querySelector('[name=\"DEFAULT_VALUE\"]');\n\t\tif (defaultValueControl)\n\t\t{\n\t\t\tdefaultValueControl\n\t\t\t\t.closest('.iblock-property-details-input')\n\t\t\t\t.querySelectorAll('input, select, textarea')\n\t\t\t\t.forEach(prepareControl)\n\t\t\t;\n\t\t}\n\t}\n\n\tgetFields(): FormData\n\t{\n\t\tconst result = new FormData();\n\n\t\tlet m;\n\t\tconst regex = /^(.+?)(\\[.+)$/;\n\t\tconst formData = new FormData(\n\t\t\tthis.container.querySelector('form'),\n\t\t);\n\t\tfor (const pair of formData.entries())\n\t\t{\n\t\t\tlet name = pair[0];\n\t\t\tif (m = regex.exec(name))\n\t\t\t{\n\t\t\t\tname = `fields[${m[1]}]${m[2]}`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tname = `fields[${name}]`;\n\t\t\t}\n\n\t\t\tresult.append(name, pair[1]);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#getSlider()\n\t{\n\t\treturn top.BX.SidePanel.Instance.getTopSlider();\n\t}\n\n\tisNewProperty(): Boolean\n\t{\n\t\treturn parseInt(this.propertyId) === 0;\n\t}\n\n\thandlerSaveButtonClick(): Promise\n\t{\n\t\tthis.progress.start();\n\t\tthis.errors.hide();\n\n\t\tconst data = this.getFields();\n\t\tdata.append('propertyId', this.propertyId);\n\t\tdata.append('iblockId', this.iblockId);\n\t\tdata.append('sessid', BX.bitrix_sessid());\n\n\t\treturn this\n\t\t\t.#runAction('save', data)\n\t\t\t.then((response) => {\n\t\t\t\tthis.progress.stop();\n\n\t\t\t\tif (response.errors.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.errors.show(\n\t\t\t\t\t\tresponse.errors,\n\t\t\t\t\t);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.#getSlider().close();\n\n\t\t\t\ttop.BX.Event.EventEmitter.emit('IblockPropertyDetails:saved', [\n\t\t\t\t\tresponse.data,\n\t\t\t\t]);\n\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.progress.stop();\n\n\t\t\t\tthis.errors.show(\n\t\t\t\t\tresponse.errors || [],\n\t\t\t\t);\n\n\t\t\t\treturn false;\n\t\t\t})\n\t\t;\n\t}\n\n\thandlerRemoveButtonClick(): Promise\n\t{\n\t\tthis.progress.start();\n\t\tthis.errors.hide();\n\n\t\treturn this\n\t\t\t.#runAction('delete', {\n\t\t\t\tid: this.propertyId,\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tthis.progress.stop();\n\n\t\t\t\tthis.#getSlider().close();\n\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.progress.stop();\n\n\t\t\t\tthis.errors.show(\n\t\t\t\t\tresponse.errors,\n\t\t\t\t);\n\n\t\t\t\treturn false;\n\t\t\t})\n\t\t;\n\t}\n}\n"],"names":["Buttons","container","callbacks","saveButtonNode","querySelector","addEventListener","handleSaveButtonClick","bind","saveButton","ButtonManager","createFromNode","removeButtonNode","handleRemoveButtonClick","removeButton","e","clearState","setWaiting","Dom","removeClass","getContainer","onSave","then","MessageBox","confirm","Loc","getMessage","onRemove","Errors","errorsWrapper","errorsMessage","errors","Type","isArray","innerHTML","map","i","message","join","style","display","Progress","loader","Loader","size","isProgress","getLoader","isShown","show","hide","storageKey","Sliders","sliderName","top","PropertyDetails","options","iblockId","propertyId","slidersOptions","sliders","signedParameters","detailPageUrlTemplate","document","containerSelector","progress","buttons","handlerSaveButtonClick","handlerRemoveButtonClick","initEvents","adjustVisibilityLeftMenu","stylizationSettingsControls","BX","UI","Hint","init","deferredSliderName","getDeferredSlider","openSlider","getPropertyTypeInput","handlePropertyTypeChange","querySelectorAll","Array","prototype","find","call","getTabs","node","dataset","tab","tabName","activeClassName","forEach","classList","add","contains","remove","sliderOptions","Error","isNewProperty","newPropertyConfirmMessage","setDeferredSlider","SidePanel","Instance","open","url","start","propertyFullType","value","response","showedFields","data","info","adjustVisibilityCommonFields","html","length","stop","Runtime","getAdditionalTab","fields","commonTab","input","name","inputContainer","closest","includes","disabled","propertyType","listMenuItem","directoryMenuItem","buttonInputTypes","Set","flagInputTypes","isOnlyChild","control","childs","parentNode","childNodes","filter","item","Text","nodeValue","trim","prepareControl","nodeName","type","has","settingsContainer","defaultValueControl","result","FormData","m","regex","formData","entries","pair","exec","append","parseInt","getFields","bitrix_sessid","close","Event","EventEmitter","emit","id","action","ajax","runComponentAction","mode","getTopSlider"],"mappings":";;;;;KAIaA,OAAO;GAOnB,iBAAYC,SAAsB,EAAEC,SAAiB,EACrD;KAAA;KACC,IAAI,CAACA,SAAS,GAAGA,SAAS;KAC1B,IAAI,CAACD,SAAS,GAAGA,SAAS;KAE1B,IAAME,cAAc,GAAGF,SAAS,CAACG,aAAa,CAAC,uBAAuB,CAAC;KACvE,IAAID,cAAc,EAClB;OACCA,cAAc,CAACE,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACC,qBAAqB,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;OAC/E,IAAI,CAACC,UAAU,GAAGC,wBAAa,CAACC,cAAc,CAACP,cAAc,CAAC;;KAG/D,IAAMQ,gBAAgB,GAAGV,SAAS,CAACG,aAAa,CAAC,yBAAyB,CAAC;KAC3E,IAAIO,gBAAgB,EACpB;OACCA,gBAAgB,CAACN,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACO,uBAAuB,CAACL,IAAI,CAAC,IAAI,CAAC,CAAC;OACnF,IAAI,CAACM,YAAY,GAAGJ,wBAAa,CAACC,cAAc,CAACC,gBAAgB,CAAC;;;GAEnE;KAAA;KAAA,sCAEqBG,CAAC,EACvB;OAAA;OACC,IAAMC,UAAU,GAAG,SAAbA,UAAU,GAAS;SACxB,KAAI,CAACP,UAAU,CAACQ,UAAU,CAAC,KAAK,CAAC;SACjCC,aAAG,CAACC,WAAW,CAAC,KAAI,CAACV,UAAU,CAACW,YAAY,EAAE,EAAE,aAAa,CAAC;QAC9D;OAED,IAAI,CAACjB,SAAS,CAACkB,MAAM,EAAE,CAACC,IAAI,CAACN,UAAU,CAAC,SAAM,CAACA,UAAU,CAAC;;;KAC1D;KAAA,wCAEuBD,CAAC,EACzB;OAAA;OACC,IAAMC,UAAU,GAAG,SAAbA,UAAU,GAAS;SACxB,MAAI,CAACF,YAAY,CAACG,UAAU,CAAC,KAAK,CAAC;SACnCC,aAAG,CAACC,WAAW,CAAC,MAAI,CAACL,YAAY,CAACM,YAAY,EAAE,EAAE,aAAa,CAAC;QAChE;OAEDG,gCAAU,CAACC,OAAO,CACjBC,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC,EAC9D,YAAM;SACL,MAAI,CAACvB,SAAS,CAACwB,QAAQ,EAAE,CAACL,IAAI,CAACN,UAAU,CAAC,SAAM,CAACA,UAAU,CAAC;SAE5D,OAAO,IAAI;QACX,EACD,IAAI,EACJ,YAAM;SACLA,UAAU,EAAE;SAEZ,OAAO,IAAI;QACX,CACD;;;GACD;CAAA;;KC5DWY,MAAM;GAKlB,gBAAY1B,SAAS,EACrB;KAAA;KACC,IAAI,CAAC2B,aAAa,GAAG3B,SAAS,CAACG,aAAa,CAAC,iCAAiC,CAAC;KAC/E,IAAI,CAACyB,aAAa,GAAG,IAAI,CAACD,aAAa,CAACxB,aAAa,CAAC,mBAAmB,CAAC;;GAC1E;KAAA;KAAA,qBAEI0B,MAAa,EAClB;OACC,IAAIC,cAAI,CAACC,OAAO,CAACF,MAAM,CAAC,EACxB;SACC,IAAI,CAACD,aAAa,CAACI,SAAS,GAAGH,MAAM,CAACI,GAAG,CAAC,UAACC,CAAC;WAAA,OAAKA,CAAC,CAACC,OAAO;WAAC,CAACC,IAAI,CAAC,IAAI,CAAC;QACtE,MAED;SACC,IAAI,CAACR,aAAa,CAACI,SAAS,GAAG,eAAe;;OAE/C,IAAI,CAACL,aAAa,CAACU,KAAK,CAACC,OAAO,GAAG,OAAO;;;KAC1C;KAAA,uBAGD;OACC,IAAI,CAACV,aAAa,CAACI,SAAS,GAAG,EAAE;OACjC,IAAI,CAACL,aAAa,CAACU,KAAK,CAACC,OAAO,GAAG,MAAM;;;GACzC;CAAA;;KC5BWC,QAAQ;GAMpB,kBAAYvC,SAAS,EACrB;KAAA;KAAA,gDAHsB,KAAK;KAI1B,IAAI,CAACA,SAAS,GAAGA,SAAS;;GAC1B;KAAA;KAAA,4BAGD;OACC,IAAI,CAAC,IAAI,CAACwC,MAAM,EAChB;SACC,IAAI,CAACA,MAAM,GAAG,IAAIC,gBAAM,CAAC;WACxBC,IAAI,EAAE;UACN,CAAC;;OAGH,OAAO,IAAI,CAACF,MAAM;;;KAClB;KAAA,wBAGD;OACC,IAAI,CAACG,UAAU,GAAG,IAAI;OACtB,IAAI,CAAC,IAAI,CAACC,SAAS,EAAE,CAACC,OAAO,EAAE,EAC/B;SACC,IAAI,CAACD,SAAS,EAAE,CAACE,IAAI,CAAC,IAAI,CAAC9C,SAAS,CAAC;;;;KAEtC;KAAA,uBAGD;OACC,IAAI,CAAC2C,UAAU,GAAG,KAAK;OACvB,IAAI,CAACC,SAAS,EAAE,CAACG,IAAI,EAAE;;;GACvB;CAAA;;CCtCF,IAAMC,UAAU,GAAG,sCAAsC;AAEzD,KAAaC,OAAO;GAAA;KAAA;;GAAA;KAAA;KAAA,oCAGnB;OACC,IAAMC,UAAU,GAAGC,GAAG,CAACH,UAAU,CAAC;OAElCG,GAAG,CAACH,UAAU,CAAC,GAAG,IAAI;OAEtB,OAAOE,UAAU;;;KACjB;KAAA,kCAEwBA,UAAkB,EAC3C;OACCC,GAAG,CAACH,UAAU,CAAC,GAAGE,UAAU;;;GAC5B;CAAA;;;;;;;;AChBF,CAKoC;CAAA;AAEpC,KAAaE,eAAe;GAa3B,yBAAYC,OAAO,EACnB;KAAA;KAAA;KAAA;KACC,IAAI,CAACC,QAAQ,GAAGD,OAAO,CAACC,QAAQ;KAChC,IAAI,CAACC,UAAU,GAAGF,OAAO,CAACE,UAAU;KACpC,IAAI,CAACC,cAAc,GAAGH,OAAO,CAACI,OAAO;KACrC,IAAI,CAACC,gBAAgB,GAAGL,OAAO,CAACK,gBAAgB;KAChD,IAAI,CAACC,qBAAqB,GAAGN,OAAO,CAACM,qBAAqB,IAAI,EAAE;KAEhE,IAAI,CAAC3D,SAAS,GAAG4D,QAAQ,CAACzD,aAAa,CAACkD,OAAO,CAACQ,iBAAiB,CAAC;KAElE,IAAI,CAAChC,MAAM,GAAG,IAAIH,MAAM,CAAC,IAAI,CAAC1B,SAAS,CAAC;KACxC,IAAI,CAAC8D,QAAQ,GAAG,IAAIvB,QAAQ,CAAC,IAAI,CAACvC,SAAS,CAAC;KAC5C,IAAI,CAAC+D,OAAO,GAAG,IAAIhE,OAAO,CAAC,IAAI,CAACC,SAAS,EAAE;OAC1CmB,MAAM,EAAE,IAAI,CAAC6C,sBAAsB,CAAC1D,IAAI,CAAC,IAAI,CAAC;OAC9CmB,QAAQ,EAAE,IAAI,CAACwC,wBAAwB,CAAC3D,IAAI,CAAC,IAAI;MACjD,CAAC;KAEF,IAAI,CAAC4D,UAAU,EAAE;KACjB,IAAI,CAACC,wBAAwB,EAAE;KAC/B,IAAI,CAACC,2BAA2B,EAAE;KAElCC,EAAE,CAACC,EAAE,CAACC,IAAI,CAACC,IAAI,CAAC,IAAI,CAACxE,SAAS,CAAC;KAE/B,IAAMyE,kBAAkB,GAAGxB,OAAO,CAACyB,iBAAiB,EAAE;KACtD,IAAID,kBAAkB,EACtB;OACC,IAAI,CAACE,UAAU,CAACF,kBAAkB,CAAC;;;GAEpC;KAAA;KAAA,6BAYD;OACC,IAAI,CAACG,oBAAoB,EAAE,CAACxE,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAACyE,wBAAwB,CAACvE,IAAI,CAAC,IAAI,CAAC,CAAC;;;KAChG;KAAA,0BAGD;OACC,OAAO,IAAI,CAACN,SAAS,CAAC8E,gBAAgB,CAAC,8BAA8B,CAAC;;;KACtE;KAAA,mCAGD;OACC,OAAOC,KAAK,CAACC,SAAS,CAACC,IAAI,CAACC,IAAI,CAC/B,IAAI,CAACC,OAAO,EAAE,EACd,UAACC,IAAiB;SAAA,OAAKA,IAAI,CAACC,OAAO,CAACC,GAAG,KAAK,YAAY;SACxD;;;KACD;KAAA,uCAGD;OACC,OAAO,IAAI,CAACtF,SAAS,CAACG,aAAa,CAAC,wBAAwB,CAAC;;;KAC7D;KAAA,wBAEOoF,OAAO,EACf;OACC,IAAMC,eAAe,GAAG,qCAAqC;OAE7D,IAAI,CAACL,OAAO,EAAE,CAACM,OAAO,CAAC,UAACH,GAAgB,EAAK;SAC5C,IAAIA,GAAG,CAACD,OAAO,CAACC,GAAG,KAAKC,OAAO,EAC/B;WACCD,GAAG,CAACI,SAAS,CAACC,GAAG,CAACH,eAAe,CAAC;UAClC,MACI,IAAIF,GAAG,CAACI,SAAS,CAACE,QAAQ,CAACJ,eAAe,CAAC,EAChD;WACCF,GAAG,CAACI,SAAS,CAACG,MAAM,CAACL,eAAe,CAAC;;QAEtC,CAAC;;;KACF;KAAA,2BAEUtC,UAAU,EACrB;OAAA;OACC,IAAM4C,aAAa,GAAG,IAAI,CAACtC,cAAc,CAACN,UAAU,CAAC;OACrD,IAAI,CAAC4C,aAAa,EAClB;SACC,MAAM,IAAIC,KAAK,0CAAmC7C,UAAU,OAAI;;OAGjE,IAAI,IAAI,CAAC8C,aAAa,EAAE,IAAIF,aAAa,CAACG,yBAAyB,EACnE;SACC5E,gCAAU,CAACC,OAAO,CACjBwE,aAAa,CAACG,yBAAyB,EACvC,YAAM;WACLhD,OAAO,CAACiD,iBAAiB,CAAChD,UAAU,CAAC;WAErC,KAAI,CAACc,sBAAsB,EAAE;WAE7B,OAAO,IAAI;UACX,EACDzC,aAAG,CAACC,UAAU,CAAC,+DAA+D,CAAC,CAC/E;QACD,MAED;SACC2B,GAAG,CAACkB,EAAE,CAAC8B,SAAS,CAACC,QAAQ,CAACC,IAAI,CAACP,aAAa,CAACQ,GAAG,EAAER,aAAa,CAAC;;;;KAEjE;KAAA,yCAEwBjF,CAAC,EAC1B;OAAA;OACC,IAAI,IAAI,CAACiD,QAAQ,CAACnB,UAAU,EAC5B;SACC;;OAGD,IAAI,CAACmB,QAAQ,CAACyC,KAAK,EAAE;OACrB,IAAI,CAAC1E,MAAM,CAACkB,IAAI,EAAE;OAElB,2BAAI,gCAAJ,IAAI,EACS,aAAa,EAAE;SAC1ByD,gBAAgB,EAAE,IAAI,CAAC5B,oBAAoB,EAAE,CAAC6B;QAC9C,EACArF,IAAI,CAAC,UAACsF,QAAQ,EAAK;SAAA;SACnB,IAAMC,YAAY,0BAAGD,QAAQ,CAACE,IAAI,CAACC,IAAI,wDAAlB,oBAAoBF,YAAY;SACrD,IAAI7E,cAAI,CAACC,OAAO,CAAC4E,YAAY,CAAC,EAC9B;WACC,MAAI,CAACG,4BAA4B,CAACH,YAAY,CAAC;;SAGhD,IAAII,IAAI,GAAG,EAAE;SACb,IAAIL,QAAQ,CAACE,IAAI,CAACG,IAAI,IAAIL,QAAQ,CAACE,IAAI,CAACG,IAAI,CAACC,MAAM,GAAG,CAAC,EACvD;WACCD,IAAI,GAAGL,QAAQ,CAACE,IAAI,CAACG,IAAI;;SAG1B,MAAI,CAACjD,QAAQ,CAACmD,IAAI,EAAE;SAEpBC,iBAAO,CAACH,IAAI,CAAC,MAAI,CAACI,gBAAgB,EAAE,EAAEJ,IAAI,CAAC,CAAC3F,IAAI,CAAC,YAAM;WACtD,MAAI,CAAC+C,wBAAwB,EAAE;WAC/B,MAAI,CAACC,2BAA2B,EAAE;UAClC,CAAC;QACF,CAAC,SACI,CAAC,UAACsC,QAAQ,EAAK;SACpB,MAAI,CAAC5C,QAAQ,CAACmD,IAAI,EAAE;SAEpB,MAAI,CAACpF,MAAM,CAACiB,IAAI,CACf4D,QAAQ,CAAC7E,MAAM,CACf;QACD,CAAC;;;KAEH;KAAA,6CAE4BuF,MAAa,EAC1C;OACC,IAAMC,SAAS,GAAG,IAAI,CAACrH,SAAS,CAACG,aAAa,CAAC,qBAAqB,CAAC;OACrE,IAAI,CAACkH,SAAS,EACd;SACC;;OAGDA,SAAS,CAACvC,gBAAgB,CAAC,yBAAyB,CAAC,CAACW,OAAO,CAAC,UAAC6B,KAAK,EAAK;SACxE,IAAI,CAACA,KAAK,CAACC,IAAI,IAAID,KAAK,CAACC,IAAI,KAAK,eAAe,EACjD;WACC;;SAGD,IAAMC,cAAc,GAAGF,KAAK,CAACG,OAAO,CAAC,gCAAgC,CAAC;SACtE,IAAIL,MAAM,CAACM,QAAQ,CAACJ,KAAK,CAACC,IAAI,CAAC,EAC/B;WACCD,KAAK,CAACK,QAAQ,GAAG,KAAK;WACtB,IAAIH,cAAc,EAClB;aACCA,cAAc,CAACnF,KAAK,CAACC,OAAO,GAAG,IAAI;;UAEpC,MAED;WACCgF,KAAK,CAACK,QAAQ,GAAG,IAAI;WACrB,IAAIH,cAAc,EAClB;aACCA,cAAc,CAACnF,KAAK,CAACC,OAAO,GAAG,MAAM;;;QAGvC,CAAC;;;KACF;KAAA,2CAGD;OAAA;OACC,IAAMsF,YAAY,4BAAG,IAAI,CAAC5H,SAAS,CAACG,aAAa,CAAC,wBAAwB,CAAC,0DAAtD,sBAAwDsG,KAAK;OAElF,IAAMoB,YAAY,GAAGjE,QAAQ,CAACzD,aAAa,CAAC,qEAAqE,CAAC;OAClH,IAAIyH,YAAY,KAAK,GAAG,EACxB;SACCC,YAAY,CAACxF,KAAK,CAACC,OAAO,GAAG,MAAM;QACnC,MAED;SACCuF,YAAY,CAACxF,KAAK,CAACC,OAAO,GAAG,MAAM;;OAGpC,IAAMwF,iBAAiB,GAAGlE,QAAQ,CAACzD,aAAa,CAAC,yEAAyE,CAAC;OAC3H,IAAIyH,YAAY,KAAK,aAAa,EAClC;SACCE,iBAAiB,CAACzF,KAAK,CAACC,OAAO,GAAG,MAAM;QACxC,MAED;SACCwF,iBAAiB,CAACzF,KAAK,CAACC,OAAO,GAAG,MAAM;;;;KAEzC;KAAA,8CAGD;OACC,IAAMyF,gBAAgB,GAAG,IAAIC,GAAG,CAAC,CAChC,QAAQ,EACR,QAAQ,EACR,OAAO,CACP,CAAC;OACF,IAAMC,cAAc,GAAG,IAAID,GAAG,CAAC,CAC9B,UAAU,EACV,OAAO,CACP,CAAC;OAEF,IAAME,WAAW,GAAG,SAAdA,WAAW,CAAYC,OAAO,EAAE;SACrC,IAAIC,MAAM,GAAGD,OAAO,CAACE,UAAU,CAACC,UAAU;SAE1CF,MAAM,GAAGrD,KAAK,CAACC,SAAS,CAACuD,MAAM,CAACrD,IAAI,CAACkD,MAAM,EAAE,UAACI,IAAI,EAAK;WACtD,IAAIA,IAAI,YAAYC,IAAI,EACxB;aACC,OAAOD,IAAI,CAACE,SAAS,CAACC,IAAI,EAAE,KAAK,EAAE;;WAGpC,OAAO,IAAI;UACX,CAAC;SAEF,OAAOP,MAAM,CAACpB,MAAM,KAAK,CAAC;QAC1B;OAED,IAAM4B,cAAc,GAAG,SAAjBA,cAAc,CAAYT,OAAO,EAAE;;SAExC,IAAIA,OAAO,CAACzC,SAAS,CAACE,QAAQ,CAAC,gBAAgB,CAAC,EAChD;WACC;;SAGD,QAAQuC,OAAO,CAACU,QAAQ;WAEvB,KAAK,OAAO;aAAE;eACb,IAAMC,IAAI,GAAGX,OAAO,CAACW,IAAI,IAAI,MAAM;eACnC,IAAIf,gBAAgB,CAACgB,GAAG,CAACD,IAAI,CAAC,EAC9B,CAAE,MACG,IAAIb,cAAc,CAACc,GAAG,CAACD,IAAI,CAAC,EACjC,CAEC,MACI,IAAIA,IAAI,KAAK,QAAQ,EAC1B,CAEC,MAED;iBACCX,OAAO,CAACzC,SAAS,CAACC,GAAG,CAAC,gBAAgB,CAAC;iBACvC,IAAIuC,WAAW,CAACC,OAAO,CAAC,EACxB;mBACCA,OAAO,CAACzC,SAAS,CAACC,GAAG,CAAC,aAAa,CAAC;kBACpC,MAED;mBACCwC,OAAO,CAACzC,SAAS,CAACC,GAAG,CAAC,eAAe,CAAC;;;eAIxC;;WAGD,KAAK,QAAQ;aAAE;eACdwC,OAAO,CAACzC,SAAS,CAACC,GAAG,CAAC,gBAAgB,CAAC;eACvC,IAAI,CAACuC,WAAW,CAACC,OAAO,CAAC,EACzB;iBACCA,OAAO,CAACzC,SAAS,CAACC,GAAG,CAAC,eAAe,CAAC;;eAGvC;;WAGD,KAAK,UAAU;aAAE;eAChBwC,OAAO,CAACzC,SAAS,CAACC,GAAG,CAAC,gBAAgB,CAAC;eACvCwC,OAAO,CAACzC,SAAS,CAACC,GAAG,CAAC,iBAAiB,CAAC;eAExC;;;;QAIF;;OAED,IAAMqD,iBAAiB,GAAG,IAAI,CAAC7B,gBAAgB,EAAE,CAAChH,aAAa,CAAC,yCAAyC,CAAC;OAC1G,IAAI6I,iBAAiB,EACrB;SACCA,iBAAiB,CACflE,gBAAgB,CAAC,yBAAyB,CAAC,CAC3CW,OAAO,CAACmD,cAAc,CAAC;;OAI1B,IAAMK,mBAAmB,GAAG,IAAI,CAAC9B,gBAAgB,EAAE,CAAChH,aAAa,CAAC,wBAAwB,CAAC;OAC3F,IAAI8I,mBAAmB,EACvB;SACCA,mBAAmB,CACjBxB,OAAO,CAAC,gCAAgC,CAAC,CACzC3C,gBAAgB,CAAC,yBAAyB,CAAC,CAC3CW,OAAO,CAACmD,cAAc,CAAC;;;;KAG1B;KAAA,4BAGD;OACC,IAAMM,MAAM,GAAG,IAAIC,QAAQ,EAAE;OAE7B,IAAIC,CAAC;OACL,IAAMC,KAAK,GAAG,eAAe;OAC7B,IAAMC,QAAQ,GAAG,IAAIH,QAAQ,CAC5B,IAAI,CAACnJ,SAAS,CAACG,aAAa,CAAC,MAAM,CAAC,CACpC;OAAC,2CACiBmJ,QAAQ,CAACC,OAAO,EAAE;SAAA;OAAA;SAArC,oDACA;WAAA,IADWC,IAAI;WAEd,IAAIjC,IAAI,GAAGiC,IAAI,CAAC,CAAC,CAAC;WAClB,IAAIJ,CAAC,GAAGC,KAAK,CAACI,IAAI,CAAClC,IAAI,CAAC,EACxB;aACCA,IAAI,oBAAa6B,CAAC,CAAC,CAAC,CAAC,cAAIA,CAAC,CAAC,CAAC,CAAC,CAAE;YAC/B,MAED;aACC7B,IAAI,oBAAaA,IAAI,MAAG;;WAGzB2B,MAAM,CAACQ,MAAM,CAACnC,IAAI,EAAEiC,IAAI,CAAC,CAAC,CAAC,CAAC;;;SAC5B;;SAAA;;OAED,OAAON,MAAM;;;KACb;KAAA,gCAQD;OACC,OAAOS,QAAQ,CAAC,IAAI,CAACpG,UAAU,CAAC,KAAK,CAAC;;;KACtC;KAAA,yCAGD;OAAA;OACC,IAAI,CAACO,QAAQ,CAACyC,KAAK,EAAE;OACrB,IAAI,CAAC1E,MAAM,CAACkB,IAAI,EAAE;OAElB,IAAM6D,IAAI,GAAG,IAAI,CAACgD,SAAS,EAAE;OAC7BhD,IAAI,CAAC8C,MAAM,CAAC,YAAY,EAAE,IAAI,CAACnG,UAAU,CAAC;OAC1CqD,IAAI,CAAC8C,MAAM,CAAC,UAAU,EAAE,IAAI,CAACpG,QAAQ,CAAC;OACtCsD,IAAI,CAAC8C,MAAM,CAAC,QAAQ,EAAErF,EAAE,CAACwF,aAAa,EAAE,CAAC;OAEzC,OAAO,2BAAI,gCAAJ,IAAI,EACE,MAAM,EAAEjD,IAAI,EACvBxF,IAAI,CAAC,UAACsF,QAAQ,EAAK;SACnB,MAAI,CAAC5C,QAAQ,CAACmD,IAAI,EAAE;SAEpB,IAAIP,QAAQ,CAAC7E,MAAM,CAACmF,MAAM,GAAG,CAAC,EAC9B;WACC,MAAI,CAACnF,MAAM,CAACiB,IAAI,CACf4D,QAAQ,CAAC7E,MAAM,CACf;WAED,OAAO,KAAK;;SAGb,6BAAI,gCAAJ,MAAI,EAAciI,KAAK,EAAE;SAEzB3G,GAAG,CAACkB,EAAE,CAAC0F,KAAK,CAACC,YAAY,CAACC,IAAI,CAAC,6BAA6B,EAAE,CAC7DvD,QAAQ,CAACE,IAAI,CACb,CAAC;SAEF,OAAO,IAAI;QACX,CAAC,SACI,CAAC,UAACF,QAAQ,EAAK;SACpB,MAAI,CAAC5C,QAAQ,CAACmD,IAAI,EAAE;SAEpB,MAAI,CAACpF,MAAM,CAACiB,IAAI,CACf4D,QAAQ,CAAC7E,MAAM,IAAI,EAAE,CACrB;SAED,OAAO,KAAK;QACZ,CAAC;;;KAEH;KAAA,2CAGD;OAAA;OACC,IAAI,CAACiC,QAAQ,CAACyC,KAAK,EAAE;OACrB,IAAI,CAAC1E,MAAM,CAACkB,IAAI,EAAE;OAElB,OAAO,2BAAI,gCAAJ,IAAI,EACE,QAAQ,EAAE;SACrBmH,EAAE,EAAE,IAAI,CAAC3G;QACT,EACAnC,IAAI,CAAC,UAACsF,QAAQ,EAAK;SACnB,MAAI,CAAC5C,QAAQ,CAACmD,IAAI,EAAE;SAEpB,6BAAI,gCAAJ,MAAI,EAAc6C,KAAK,EAAE;SAEzB,OAAO,IAAI;QACX,CAAC,SACI,CAAC,UAACpD,QAAQ,EAAK;SACpB,MAAI,CAAC5C,QAAQ,CAACmD,IAAI,EAAE;SAEpB,MAAI,CAACpF,MAAM,CAACiB,IAAI,CACf4D,QAAQ,CAAC7E,MAAM,CACf;SAED,OAAO,KAAK;QACZ,CAAC;;;GAEH;CAAA;CACD,qBAvYWsI,MAAM,EAAEvD,IAAI,EACvB;GACC,OAAOwD,cAAI,CAACC,kBAAkB,CAAC,gCAAgC,EAAEF,MAAM,EAAE;KACxEG,IAAI,EAAE,OAAO;KACb5G,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;KACvCkD,IAAI,EAAJA;IACA,CAAC;CACH;CAAC,uBAgTD;GACC,OAAOzD,GAAG,CAACkB,EAAE,CAAC8B,SAAS,CAACC,QAAQ,CAACmE,YAAY,EAAE;CAChD;;;;;;;;"}