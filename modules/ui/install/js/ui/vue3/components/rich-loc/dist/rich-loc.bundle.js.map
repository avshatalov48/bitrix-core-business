{"version":3,"file":"rich-loc.bundle.js","sources":["../src/lib.js","../src/rich-loc.js"],"sourcesContent":["import type { TemplateItem } from './types';\n\nconst escape = (str) => String(str).replaceAll(/[\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n\nfunction getReplacementRegExp(placeholder: string): RegExp\n{\n\tconst closePlaceholder = `${placeholder.slice(0, 1)}/${placeholder.slice(1)}`;\n\n\treturn new RegExp(`${escape(placeholder)}.*?${escape(closePlaceholder)}`, 'gmi');\n}\n\nexport function getTemplateItems(text: string, placeholder: string | string[]): TemplateItem[]\n{\n\tconst items = (Array.isArray(placeholder) ? [...placeholder] : [placeholder])\n\t\t.flatMap((templatePlaceholder: string) => {\n\t\t\treturn [...text.matchAll(getReplacementRegExp(templatePlaceholder))].map((exec) => ({\n\t\t\t\tindex: exec.index,\n\t\t\t\tplaceholder: templatePlaceholder,\n\t\t\t\ttemplate: exec[0],\n\t\t\t}));\n\t\t});\n\n\tif (items.length > 1)\n\t{\n\t\titems.sort((a, b) => a.index - b.index);\n\t}\n\n\treturn items;\n}\n\nexport function unfoldTemplate(template: string, placeholder: string): string\n{\n\treturn template.slice(placeholder.length, template.length - placeholder.length - 1);\n}\n","import { Type } from 'main.core';\nimport { h } from 'ui.vue3';\nimport { getTemplateItems, unfoldTemplate } from './lib';\nimport type { TemplateItem } from './types';\n\nfunction makeRichLocChildren(text: string, templateItems: TemplateItem[], context): Array<string | Object>\n{\n\tconst children = [];\n\tlet index = 0;\n\tfor (const item of templateItems)\n\t{\n\t\tif (item.index > index)\n\t\t{\n\t\t\tchildren.push(text.slice(index, item.index));\n\t\t\tindex = item.index;\n\t\t}\n\n\t\tif (item.index === index)\n\t\t{\n\t\t\tconst placeholder = item.placeholder;\n\t\t\tconst slotName = placeholder.slice(1, -1);\n\t\t\tif (Type.isFunction(context.slots[slotName]))\n\t\t\t{\n\t\t\t\tchildren.push(context.slots[slotName]({\n\t\t\t\t\ttext: unfoldTemplate(item.template, placeholder),\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tindex += item.template.length;\n\t\t}\n\t}\n\n\tif (index < text.length)\n\t{\n\t\tchildren.push(text.slice(index));\n\t}\n\n\treturn children;\n}\n\nfunction RichLoc(props: RichLocProps, context): Object\n{\n\tconst templateItems: TemplateItem[] = getTemplateItems(props.text, props.placeholder);\n\tconst children = makeRichLocChildren(props.text, templateItems, context);\n\n\treturn h(\n\t\tprops.tag || 'div',\n\t\t{\n\t\t\t...context.attrs,\n\t\t},\n\t\tchildren,\n\t);\n}\n\ntype RichLocProps = {\n\ttext: string;\n\tplaceholder: string | string[];\n\ttag: ?string | string[];\n}\n\nconst richLocProps: Array<$Keys<RichLocProps>> = ['text', 'placeholder', 'tag'];\n\nRichLoc.props = richLocProps;\n\nexport { RichLoc };\n"],"names":["escape","str","String","replaceAll","getReplacementRegExp","placeholder","closePlaceholder","slice","RegExp","getTemplateItems","text","items","Array","isArray","flatMap","templatePlaceholder","matchAll","map","exec","index","template","length","sort","a","b","unfoldTemplate","makeRichLocChildren","templateItems","context","children","item","push","slotName","Type","isFunction","slots","RichLoc","props","h","tag","attrs","richLocProps"],"mappings":"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"}