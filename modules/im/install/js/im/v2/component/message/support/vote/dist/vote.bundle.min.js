this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(e,t,s,i,o,r,a){"use strict";const l={like:"like",dislike:"dislike",none:"none"};const n={voteText:"imolVoteText",likeText:"imolVoteLike",dislikeText:"imolVoteDislike",currentVote:"imolVote",timeLimit:"imolTimeLimitVote",voteCloseDate:"imolDateCloseVote"};var c=babelHelpers.classPrivateFieldLooseKey("messageId");var d=babelHelpers.classPrivateFieldLooseKey("dialogId");var v=babelHelpers.classPrivateFieldLooseKey("updateModel");class m{constructor(e,t){Object.defineProperty(this,v,{value:h});Object.defineProperty(this,c,{writable:true,value:void 0});Object.defineProperty(this,d,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,c)[c]=e;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=t}like(){babelHelpers.classPrivateFieldLooseBase(this,v)[v]({vote:l.like});r.Core.getRestClient().callMethod(a.RestMethod.imBotDialogVote,{MESSAGE_ID:babelHelpers.classPrivateFieldLooseBase(this,c)[c],DIALOG_ID:babelHelpers.classPrivateFieldLooseBase(this,d)[d],RATING:l.like}).catch((e=>{console.error("VoteService: error in dialog vote",e)}))}dislike(){babelHelpers.classPrivateFieldLooseBase(this,v)[v]({vote:l.dislike});r.Core.getRestClient().callMethod(a.RestMethod.imBotDialogVote,{MESSAGE_ID:babelHelpers.classPrivateFieldLooseBase(this,c)[c],DIALOG_ID:babelHelpers.classPrivateFieldLooseBase(this,d)[d],RATING:l.dislike}).catch((e=>{console.error("VoteService: error in dialog vote",e)}))}}function h(e){const{vote:t}=e;const s=r.Core.getStore().getters["messages/getById"](babelHelpers.classPrivateFieldLooseBase(this,c)[c]);const i={...s.componentParams,[n.currentVote]:t};r.Core.getStore().dispatch("messages/update",{id:babelHelpers.classPrivateFieldLooseBase(this,c)[c],fields:{componentParams:i}})}const g={name:"SupportVote",components:{BaseMessage:i.BaseMessage},props:{item:{type:Object,required:true},dialogId:{type:String,required:true},withTitle:{type:Boolean,default:true}},data(){return{}},computed:{message(){return this.item},currentVote(){return this.message.componentParams[n.currentVote]||l.none},voteText(){if(this.currentVote===l.none){return this.message.componentParams[n.voteText]}if(this.currentVote===l.like){return this.message.componentParams[n.likeText]}return this.message.componentParams[n.dislikeText]},voteClosed(){const e=this.message.componentParams[n.voteCloseDate];if(!t.Type.isStringFilled(e)){return false}return new Date(e).getTime()<Date.now()},voteTimeSecondsLimit(){var e;const t=(e=this.message.componentParams[n.timeLimit])!=null?e:0;return Number.parseInt(t,10)},likeClasses(){return{"--active":this.currentVote===l.like,"--disabled":this.currentVote===l.dislike}},dislikeClasses(){return{"--active":this.currentVote===l.dislike,"--disabled":this.currentVote===l.like}}},methods:{onLike(){if(this.currentVote===l.like){return}if(this.voteClosed){this.showVoteClosedNotification();return}this.getVoteService().like()},onDislike(){if(this.currentVote===l.dislike){return}if(this.voteClosed){this.showVoteClosedNotification();return}this.getVoteService().dislike()},showVoteClosedNotification(){BX.UI.Notification.Center.notify({content:this.loc("IM_MESSAGE_SUPPORT_VOTE_CLOSED")})},getDaysForVote(){const e=Date.now()/1e3;return o.DateFormatter.formatByCode(e-this.voteTimeSecondsLimit,"ddiff")},getVoteService(){if(!this.voteService){this.voteService=new m(this.message.id,this.dialogId)}return this.voteService},loc(e,t={}){return this.$Bitrix.Loc.getMessage(e,t)}},template:`\n\t\t<BaseMessage\n\t\t\t:item="item"\n\t\t\t:dialogId="dialogId"\n\t\t\t:withTitle="withTitle"\n\t\t\t:withContextMenu="false"\n\t\t\t:withReactions="false"\n\t\t>\n\t\t\t<div class="bx-im-message-support-vote__container">\n\t\t\t\t<div class="bx-im-message-support-vote__title">{{ loc('IM_MESSAGE_SUPPORT_VOTE_TITLE') }}</div>\n\t\t\t\t<div class="bx-im-message-support-vote__subtitle">{{ voteText }}</div>\n\t\t\t\t<div class="bx-im-message-support-vote__actions">\n\t\t\t\t\t<div class="bx-im-message-support-vote__action_item --like" :class="likeClasses" @click="onLike"></div>\n\t\t\t\t\t<div class="bx-im-message-support-vote__action_item --dislike" :class="dislikeClasses" @click="onDislike"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BaseMessage>\n\t`};e.SupportVoteMessage=g})(this.BX.Messenger.v2.Component.Message=this.BX.Messenger.v2.Component.Message||{},BX,BX,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Const);
//# sourceMappingURL=vote.bundle.map.js