{"version":3,"file":"categorymanager.bundle.js","sources":["../src/category.js","../src/categorymanager.js"],"sourcesContent":["import { Util } from 'calendar.util';\nimport { CategoryManager } from './categorymanager';\n\nexport {\n\tCategoryManager\n}\n\nexport class Category\n{\n\tconstructor(data)\n\t{\n\t\tthis.updateData(data);\n\t\tthis.calendarContext = Util.getCalendarContext();\n\t\tthis.rooms = [];\n\t}\n\n\tupdateData(data)\n\t{\n\t\tthis.data = data || {};\n\t\tthis.id = parseInt(data.ID, 10);\n\t\tthis.name = data.NAME;\n\t}\n\n\taddRoom(room)\n\t{\n\t\tthis.rooms.push(room);\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetCheckboxStatus(checkboxStatus)\n\t{\n\t\tthis.checkboxStatus = checkboxStatus;\n\t}\n}","import { SectionManager } from 'calendar.sectionmanager';\nimport { Util } from 'calendar.util';\nimport { Event, Loc, Type } from 'main.core';\nimport {Category} from './category';\n\nexport class CategoryManager extends SectionManager\n{\n\tconstructor(data, config)\n\t{\n\t\tsuper(data, config);\n\t\tthis.setCategories(data.categories);\n\t\tthis.setConfig(config);\n\t\tthis.sortCategories();\n\t\tthis.permissions = config.perm;\n\t\tthis.locationContext = config.locationContext|| null;\n\t}\n\n\tsortCategories()\n\t{\n\t\tthis.categoryIndex = {};\n\t\tthis.categories = this.categories.sort((a, b) => {\n\t\t\tif (a.name.toLowerCase() > b.name.toLowerCase())\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (a.name.toLowerCase() < b.name.toLowerCase())\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\n\t\tthis.categories.forEach((category, i) => {\n\t\t\tthis.categoryIndex[category.getId()] = i;\n\t\t});\n\t}\n\n\tsetCategories(params = [])\n\t{\n\t\tthis.categories = [];\n\t\tthis.categoryIndex = {};\n\t\tparams.forEach((categoryData) => {\n\t\t\tlet category = new Category(categoryData);\n\t\t\tthis.categories.push(category);\n\t\t\tthis.categoryIndex[category.getId()] = this.categories.length - 1;\n\t\t});\n\t}\n\n\tgetCategories()\n\t{\n\t\treturn this.categories;\n\t}\n\n\tgetCategory(id)\n\t{\n\t\treturn this.categories[this.categoryIndex[id]];\n\t}\n\n\tcreateCategory(params)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tparams.name = this.checkName(params.name);\n\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.createCategory', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tname: params.name,\n\t\t\t\t\t\trooms: params.rooms\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconst categories = response.data || [];\n\t\t\t\t\t\tthis.setCategories(categories);\n\t\t\t\t\t\tthis.sortCategories();\n\n\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t'BX.Calendar.Rooms.Categories:create',\n\t\t\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdata: { categoryList: categories }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.updateLocationContext(categories);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t});\n\t}\n\n\tupdateCategory(params)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tparams.name = this.checkName(params.name);\n\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.updateCategory', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tid: params.id,\n\t\t\t\t\t\tname: params.name,\n\t\t\t\t\t\trooms: {\n\t\t\t\t\t\t\ttoAddCategory: params.toAddCategory,\n\t\t\t\t\t\t\ttoRemoveCategory: params.toRemoveCategory,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconst categories = response.data || [];\n\t\t\t\t\t\tthis.setCategories(categories);\n\t\t\t\t\t\tthis.sortCategories();\n\n\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t'BX.Calendar.Rooms.Categories:create'\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.updateLocationContext(categories);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t});\n\t}\n\n\tdeleteCategory(id)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.deleteCategory', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tid,\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tconst categories = response.data || [];\n\t\t\t\t\t\tif (!categories.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.setCategories(categories);\n\t\t\t\t\t\tthis.sortCategories();\n\n\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t'BX.Calendar.Rooms.Categories:delete',\n\t\t\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdata: { categoryList: categories }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.updateLocationContext(categories);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t});\n\t}\n\n\tcheckName(name)\n\t{\n\t\tif (typeof name === 'string')\n\t\t{\n\t\t\tname = name.trim();\n\t\t\tif (CategoryManager.isEmpty(name))\n\t\t\t{\n\t\t\t\tname = Loc.getMessage('EC_SEC_SLIDER_NEW_CATEGORY');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tname = Loc.getMessage('EC_SEC_SLIDER_NEW_CATEGORY');\n\t\t}\n\t\treturn name;\n\t}\n\n\tstatic isEmpty(param)\n\t{\n\t\tif (Type.isArray(param))\n\t\t{\n\t\t\treturn !param.length;\n\t\t}\n\t\treturn param === null || param === undefined || param === '' || param === [] || param === {};\n\t}\n\n\tcanDo(action)\n\t{\n\t\t//actions:view|edit|access\n\t\treturn this.permissions[action];\n\t}\n\n\tunsetRooms()\n\t{\n\t\tthis.categories.map(category => category.rooms = []);\n\t}\n\n\thandlePullCategoryChanges(params)\n\t{\n\t\tif (params.command === 'delete_category')\n\t\t{\n\t\t\tconst categoryId = parseInt(params.ID, 10);\n\t\t\tif (this.categoryIndex[categoryId])\n\t\t\t{\n\t\t\t\tthis.reloadCategoriesFromDatabase().then(this.reloadDataDebounce());\n\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t'BX.Calendar.Rooms:pull-delete',\n\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: { categoryId }\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.reloadCategoriesFromDatabase().then(this.reloadDataDebounce());\n\t\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar.Rooms.Categories:pull-delete');\n\t\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar:doRefresh');\n\t\t\t}\n\t\t}\n\t\telse if (params.command === 'create_category')\n\t\t{\n\t\t\tthis.reloadCategoriesFromDatabase().then(this.reloadDataDebounce());\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar.Rooms.Categories:pull-create');\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar:doRefresh');\n\t\t}\n\t\telse if (params.command === 'update_category')\n\t\t{\n\t\t\tthis.reloadCategoriesFromDatabase().then(this.reloadDataDebounce());\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar.Rooms.Categories:pull-update');\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar:doRefresh');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.reloadCategoriesFromDatabase().then(this.reloadDataDebounce());\n\t\t}\n\t}\n\n\treloadCategoriesFromDatabase()\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.ajax.runAction('calendar.api.locationajax.getCategoryList')\n\t\t\t\t.then((response) => {\n\t\t\t\t\t\tthis.setCategories(response.data.categories || []);\n\t\t\t\t\t\tthis.sortCategories();\n\t\t\t\t\t\tBX.Calendar.Controls.Location.setLocationList(response.data.rooms);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t// Failure\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t});\n\t}\n\n\tunsetCategoryRooms(categoryId)\n\t{\n\t\tthis.getCategory(categoryId).rooms = [];\n\t}\n\n\tgetCategoriesWithRooms(rooms)\n\t{\n\t\tthis.unsetRooms();\n\n\t\tconst categoriesWithRooms = {\n\t\t\t'default': [],\n\t\t\t'categories': this.getCategories(),\n\t\t};\n\n\t\tlet categoryIndexForRoom;\n\n\t\trooms.forEach((room) => {\n\t\t\tcategoryIndexForRoom = this.categoryIndex[room.categoryId];\n\n\t\t\tif(categoriesWithRooms['categories'][categoryIndexForRoom])\n\t\t\t{\n\t\t\t\tcategoriesWithRooms['categories'][categoryIndexForRoom].addRoom(room);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcategoriesWithRooms['default'].push(room);\n\t\t\t}\n\t\t}, this);\n\n\t\treturn categoriesWithRooms;\n\t}\n\n\tupdateLocationContext()\n\t{\n\t\tif(this.locationContext !== null && this.locationContext.roomsManagerFromDB !== null)\n\t\t{\n\t\t\tthis.locationContext.roomsManagerFromDB.reloadRoomsFromDatabase()\n\t\t\t\t.then(\n\t\t\t\t\tthis.locationContext.setValues.bind(this.locationContext)\n\t\t\t\t);\n\t\t}\n\t}\n\n\tgetCategoryRooms(category, rooms)\n\t{\n\t\tconst categoryRooms = [];\n\n\t\trooms.forEach((room) => {\n\t\t\tif(category.id === room.categoryId)\n\t\t\t{\n\t\t\t\tcategoryRooms.push(room);\n\t\t\t}\n\t\t});\n\n\t\treturn categoryRooms;\n\t}\n}"],"names":["Category","constructor","data","updateData","calendarContext","Util","getCalendarContext","rooms","id","parseInt","ID","name","NAME","addRoom","room","push","getId","setCheckboxStatus","checkboxStatus","CategoryManager","SectionManager","config","setCategories","categories","setConfig","sortCategories","permissions","perm","locationContext","categoryIndex","sort","a","b","toLowerCase","forEach","category","i","params","categoryData","length","getCategories","getCategory","createCategory","Promise","resolve","checkName","BX","ajax","runAction","then","response","getBX","Event","EventEmitter","emit","BaseEvent","categoryList","updateLocationContext","Calendar","displayError","errors","updateCategory","toAddCategory","toRemoveCategory","deleteCategory","reload","trim","isEmpty","Loc","getMessage","param","Type","isArray","undefined","canDo","action","unsetRooms","map","handlePullCategoryChanges","command","categoryId","reloadCategoriesFromDatabase","reloadDataDebounce","Controls","Location","setLocationList","unsetCategoryRooms","getCategoriesWithRooms","categoriesWithRooms","categoryIndexForRoom","roomsManagerFromDB","reloadRoomsFromDatabase","setValues","bind","getCategoryRooms","categoryRooms"],"mappings":"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"}