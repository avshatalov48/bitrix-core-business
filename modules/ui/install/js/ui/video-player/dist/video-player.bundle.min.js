this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,s,t,i){"use strict";var a=babelHelpers.classPrivateFieldLooseKey("isStarted");var r=babelHelpers.classPrivateFieldLooseKey("players");var l=babelHelpers.classPrivateFieldLooseKey("init");var o=babelHelpers.classPrivateFieldLooseKey("bindPlayerEvents");var n=babelHelpers.classPrivateFieldLooseKey("handleScroll");class c{static addPlayer(e){babelHelpers.classPrivateFieldLooseBase(this,r)[r].push(e);babelHelpers.classPrivateFieldLooseBase(this,o)[o](e);if(e.autostart||e.lazyload){babelHelpers.classPrivateFieldLooseBase(this,l)[l]()}}static getElementCoords(e){const s=.25;const t=document.getElementById(e).getBoundingClientRect();const i=t.bottom-t.top;const a=t.top+s*i;const r=t.bottom-s*i;const l=t.right-t.left;const o=t.left+s*l;const n=t.right-s*l;return{top:a+window.pageYOffset,bottom:r+window.pageYOffset,left:o+window.pageXOffset,right:n+window.pageXOffset,originTop:a,originLeft:o,originBottom:r,originRight:n}}static isVisibleOnScreen(e,s){let t=false;const i=this.getElementCoords(e);const a=document.documentElement.clientHeight;let r=window.pageYOffset||document.documentElement.scrollTop;let l=r+a;const o=s?parseInt(s,10):1;if(o>1){r-=a*(o-1);l+=a*(o-1)}const n=i.top>r&&i.top<l;const c=i.bottom<l&&i.bottom>r;const d=n||c;if(d&&s>1){return true}if(!d){return false}const h=document.getElementById(e);const u=i.originLeft+(i.originRight-i.originLeft)/2;const P=i.originTop+(i.originBottom-i.originTop)/2+20;const y=document.elementFromPoint(u,P);if(y!==null&&(y===h||y.parentNode===h||y.parentNode.parentNode===h)){t=true}return d&&t}static getPlayerById(e){if(!t.Type.isStringFilled(e)){return null}for(const s of babelHelpers.classPrivateFieldLooseBase(this,r)[r]){if(s.id===e){return s}}return null}}function d(){if(babelHelpers.classPrivateFieldLooseBase(this,a)[a]){return}babelHelpers.classPrivateFieldLooseBase(this,a)[a]=true;t.Event.ready((()=>{t.Event.bind(window,"scroll",t.Runtime.throttle(babelHelpers.classPrivateFieldLooseBase(this,n)[n],300,this));setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,n)[n]()}),50);const e=t.Reflection.getClass("top.BX.SidePanel.Instance");if(window!==window.top&&e!==null){const s=e.getSliderByWindow(window);if(s){t.Event.EventEmitter.subscribe(s,"SidePanel.Slider:onCloseComplete",(()=>{babelHelpers.classPrivateFieldLooseBase(this,r)[r].forEach((e=>{e.pause()}))}))}}}))}function h(e){const s=e.getEventList();for(const a of s){t.Event.EventEmitter.subscribe(e,a,(()=>{t.Event.EventEmitter.emit(this,`PlayerManager.${a}`,new i.BaseEvent({compatData:[e]}))}))}}function u(){if(babelHelpers.classPrivateFieldLooseBase(this,r)[r].length===0){return}let e=false;let s=false;const i=[...babelHelpers.classPrivateFieldLooseBase(this,r)[r]];for(const[t,a]of i.entries()){if(!document.getElementById(a.id)){babelHelpers.classPrivateFieldLooseBase(this,r)[r].splice(t,1);continue}if(a.lazyload&&!a.inited&&this.isVisibleOnScreen(a.id,2)){a.init()}if(!a.autostart){continue}if(a.active){continue}if(a.isEnded()){continue}if(this.isVisibleOnScreen(a.id,1)){if(e===false){e=a}}else if(a.isPlaying()){a.pause()}if(a.isPlaying()){s=true}}if(s){return}if(e!==false){if(!e.inited){e.autostart=true}else if(e.isReady()&&!e.isEnded()){e.mute(true);t.Event.EventEmitter.subscribeOnce(e,"Player:onClick",(s=>{setTimeout((()=>{e.mute(false)}),100)}));e.play()}}}Object.defineProperty(c,n,{value:u});Object.defineProperty(c,o,{value:h});Object.defineProperty(c,l,{value:d});Object.defineProperty(c,a,{writable:true,value:void 0});Object.defineProperty(c,r,{writable:true,value:[]});s.videojs.hook("beforesetup",((e,s)=>{t.Dom.addClass(e,"ui-video-player ui-icon-set__scope");if(e.tagName.toLowerCase()==="audio"){t.Dom.addClass(e,"vjs-audio-only-mode")}return s}));s.videojs.addLanguage("video-player",{Play:t.Loc.getMessage("VIDEO_PLAYER_PLAY"),Pause:t.Loc.getMessage("VIDEO_PLAYER_PAUSE"),Replay:t.Loc.getMessage("VIDEO_PLAYER_REPLAY"),"Current Time":t.Loc.getMessage("VIDEO_PLAYER_CURRENT_TIME"),Duration:t.Loc.getMessage("VIDEO_PLAYER_DURATION"),"Remaining Time":t.Loc.getMessage("VIDEO_PLAYER_REMAINING_TIME"),Loaded:t.Loc.getMessage("VIDEO_PLAYER_LOADED"),Progress:t.Loc.getMessage("VIDEO_PLAYER_PROGRESS"),"Progress Bar":t.Loc.getMessage("VIDEO_PLAYER_PROGRESS_BAR"),Fullscreen:t.Loc.getMessage("VIDEO_PLAYER_FULLSCREEN"),"Exit Fullscreen":t.Loc.getMessage("VIDEO_PLAYER_EXIT_FULLSCREEN"),Mute:t.Loc.getMessage("VIDEO_PLAYER_MUTE"),Unmute:t.Loc.getMessage("VIDEO_PLAYER_UNMUTE"),"Playback Rate":t.Loc.getMessage("VIDEO_PLAYER_PLAYBACK_RATE"),"Volume Level":t.Loc.getMessage("VIDEO_PLAYER_VOLUME_LEVEL"),"You aborted the media playback":t.Loc.getMessage("VIDEO_PLAYER_ABORTED_PLAYBACK"),"A network error caused the media download to fail part-way.":t.Loc.getMessage("VIDEO_PLAYER_NETWORK_ERROR"),"The media could not be loaded, either because the server or network failed or because the format is not supported.":t.Loc.getMessage("VIDEO_PLAYER_FORMAT_NOT_SUPPORTED"),"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.":t.Loc.getMessage("VIDEO_PLAYER_PLAYBACK_WAS_ABORTED"),"No compatible source was found for this media.":t.Loc.getMessage("VIDEO_PLAYER_NO_COMPATIBLE_SOURCE"),"The media is encrypted and we do not have the keys to decrypt it.":t.Loc.getMessage("VIDEO_PLAYER_MEDIA_IS_ENCRYPTED"),"Play Video":t.Loc.getMessage("VIDEO_PLAYER_PLAY_VIDEO"),"Exit Picture-in-Picture":t.Loc.getMessage("VIDEO_PLAYER_EXIT_PICTURE_IN_PICTURE"),"Picture-in-Picture":t.Loc.getMessage("VIDEO_PLAYER_PICTURE_IN_PICTURE")});var P=babelHelpers.classPrivateFieldLooseKey("getStorageHash");var y=babelHelpers.classPrivateFieldLooseKey("fillParameters");var v=babelHelpers.classPrivateFieldLooseKey("getDefaultOptions");var p=babelHelpers.classPrivateFieldLooseKey("hideAudioControls");var b=babelHelpers.classPrivateFieldLooseKey("handlePlayOnce");var f=babelHelpers.classPrivateFieldLooseKey("handleClick");var g=babelHelpers.classPrivateFieldLooseKey("handleKeyDown");var m=babelHelpers.classPrivateFieldLooseKey("fireEvent");var E=babelHelpers.classPrivateFieldLooseKey("proxyEvents");class L{constructor(e,s){Object.defineProperty(this,E,{value:I});Object.defineProperty(this,m,{value:A});Object.defineProperty(this,g,{value:k});Object.defineProperty(this,f,{value:F});Object.defineProperty(this,b,{value:O});Object.defineProperty(this,p,{value:_});Object.defineProperty(this,v,{value:B});Object.defineProperty(this,y,{value:j});Object.defineProperty(this,P,{value:R});this.inited=false;this.id=null;this.muted=false;this.hasStarted=false;this.vjsPlayer=null;this.isAudio=false;this.id=e;babelHelpers.classPrivateFieldLooseBase(this,y)[y](s);c.addPlayer(this);babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onCreate")}isReady(){return this.vjsPlayer&&this.vjsPlayer.isReady_}play(){this.setPlayedState();this.hasStarted=true;try{this.vjsPlayer.play()}catch{}babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onPlay")}pause(){try{this.vjsPlayer.pause()}catch{}babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onPause")}toggle(){if(this.isPlaying()){this.pause()}else{this.play()}}isPlaying(){if(this.vjsPlayer){return this.isReady()&&!this.vjsPlayer.paused()}return false}isEnded(){if(this.vjsPlayer){return this.vjsPlayer.ended()}return false}setPlayedState(){const e=babelHelpers.classPrivateFieldLooseBase(this,P)[P]();const s=t.Reflection.getClass("BX.localStorage");if(s){s.set(e,"played",14*24*3600)}}isPlayed(){const e=babelHelpers.classPrivateFieldLooseBase(this,P)[P]();const s=t.Reflection.getClass("BX.localStorage");if(s){return s.get(e)==="played"}return true}getElement(){return document.getElementById(this.id)}createElement(){let e=this.getElement();if(e){return e}if(!this.id){return null}let s="video";const i=["video-js","ui-video-player","ui-icon-set__scope"];if(this.isAudio){s="audio";i.push("vjs-audio-only-mode")}let a=i.join(" ");if(this.skin){a+=` ${this.skin}`}const r={id:this.id,className:a,width:this.width,height:this.height,controls:true};if(this.muted){r.muted=true}e=t.Dom.create(s,{attrs:r});if(t.Type.isArrayFilled(this.params.sources)){for(const s of this.params.sources){if(!s.src||!s.type){continue}const i=t.Dom.create("source",{attrs:{src:s.src,type:s.type}});t.Dom.append(i,e)}}return e}setSource(e){if(!e){return}this.vjsPlayer.src(e);babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onSetSource")}getSource(){return this.vjsPlayer.src()}init(){if(this.vjsPlayer!==null){return}babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onBeforeInit");if(s.videojs.players[this.id]){s.videojs.players[this.id].dispose()}this.vjsPlayer=s.videojs(this.id,this.params);if(this.isAudio){babelHelpers.classPrivateFieldLooseBase(this,p)[p]()}this.vjsPlayer.on("fullscreenchange",(()=>{this.vjsPlayer.focus()}));if(this.duration>0){this.vjsPlayer.one("loadedmetadata",(()=>{this.vjsPlayer.duration(this.duration)}))}this.vjsPlayer.ready((()=>{const e=this.vjsPlayer.getChild("ControlBar");const i=e.getChild("PlaybackRateMenuButton");if(i){s.videojs.off(i.menuButton_.el(),"mouseenter");s.videojs.off(i.el(),"mouseleave")}this.vjsPlayer.volume(this.volume);this.vjsPlayer.one("play",babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this));this.inited=true;if(t.Type.isFunction(this.onInit)){this.onInit(this)}babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onAfterInit");babelHelpers.classPrivateFieldLooseBase(this,E)[E]();if(this.autostart&&!this.lazyload){setTimeout((()=>{if(!this.hasStarted){this.play()}}),200)}}))}getEventList(){return["Player:onBeforeInit","Player:onAfterInit","Player:onCreate","Player:onSetSource","Player:onKeyDown","Player:onPlay","Player:onPause","Player:onClick","Player:onError","Player:onEnded"]}mute(e){var s;return(s=this.vjsPlayer)==null?void 0:s.muted(e)}isMuted(){var e;return(e=this.vjsPlayer)==null?void 0:e.muted()}focus(){var e;(e=this.vjsPlayer)==null?void 0:e.focus()}moveBackward(e){const s=this.vjsPlayer.currentTime();const t=this.vjsPlayer.liveTracker;const i=t&&t.isLive()&&t.seekableStart();let a=0;if(i&&s-e<=i){a=i}else if(s>=e){a=s-e}this.vjsPlayer.currentTime(a)}moveForward(e){if(!t.Type.isNumber(this.vjsPlayer.duration())){return}const s=this.vjsPlayer.currentTime();const i=this.vjsPlayer.liveTracker;const a=i&&i.isLive()?i.seekableEnd():this.vjsPlayer.duration();const r=s+e<=a?s+e:a;this.vjsPlayer.currentTime(r)}increasePlaybackRate(){const e=this.vjsPlayer.playbackRates();const s=this.vjsPlayer.playbackRate();const t=e.find((e=>e>s));if(t){this.vjsPlayer.playbackRate(t)}}decreasePlaybackRate(){const e=[...this.vjsPlayer.playbackRates()].reverse();const s=this.vjsPlayer.playbackRate();const t=e.find((e=>e<s));if(t){this.vjsPlayer.playbackRate(t)}}}function R(){let e=this.id;if(t.Type.isArrayFilled(this.params.sources)&&this.params.sources[0].src){e=this.params.sources[0].src}return`player_${e}`}function j(e){const s=babelHelpers.classPrivateFieldLooseBase(this,v)[v]();const i=t.Type.isPlainObject(e)?{...s,...e}:s;if(t.Type.isArrayFilled(i.techOrder)){i.techOrder=i.techOrder.filter((e=>e!=="flash"))}this.autostart=i.autostart||false;if(i.playbackRate){i.playbackRate=parseFloat(i.playbackRate);if(i.playbackRate!==1){if(i.playbackRate<=0){i.playbackRate=1}if(i.playbackRate>3){i.playbackRate=3}}if(i.playbackRate!==1){this.playbackRate=i.playbackRate}}this.volume=i.volume||.8;this.startTime=i.startTime||0;this.onInit=i.onInit;this.lazyload=i.lazyload;this.skin=i.skin||"";this.isAudio=i.isAudio||false;if(this.isAudio){i.width=i.width||400;i.height=i.height||30;i.audioOnlyMode=true}else{i.width=Math.max(i.width||560,400);i.height=Math.max(i.height||315,130)}this.width=i.width;this.height=i.height;this.duration=i.duration||null;this.muted=i.muted||false;this.params=i;this.active=this.isPlayed()}function B(){return{controls:true,playbackRates:[.5,1,1.25,1.5,1.75,2],language:"video-player",userActions:{click:babelHelpers.classPrivateFieldLooseBase(this,f)[f].bind(this),hotkeys:babelHelpers.classPrivateFieldLooseBase(this,g)[g].bind(this)}}}function _(){this.vjsPlayer.removeChild("BigPlayButton");this.vjsPlayer.removeChild("TextTrackSettings");this.vjsPlayer.removeChild("PosterImage");this.vjsPlayer.controlBar.removeChild("FullscreenToggle");this.vjsPlayer.controlBar.removeChild("PictureInPictureToggle");this.vjsPlayer.controlBar.removeChild("ChaptersButton");this.vjsPlayer.controlBar.removeChild("DescriptionsButton");if(this.skin==="vjs-audio-wave-skin"||this.skin==="vjs-viewer-audio-player-skin"){this.vjsPlayer.removeChild("VolumePanel");this.vjsPlayer.controlBar.removeChild("VolumePanel");this.vjsPlayer.controlBar.removeChild("CurrentTimeDisplay");this.vjsPlayer.controlBar.removeChild("PlaybackRateMenuButton")}}function O(){if(this.playbackRate!==1){this.vjsPlayer.playbackRate(this.playbackRate)}if(this.volume){this.vjsPlayer.volume(this.volume)}if(this.startTime>0){try{this.vjsPlayer.currentTime(this.startTime)}catch{}}this.vjsPlayer.on("volumechange",(()=>{this.active=true}))}function F(e){this.toggle();e.preventDefault();e.stopPropagation()}function k(e){switch(e.code){case"KeyK":case"Space":{this.toggle();break}case"KeyF":{if(!this.isAudio){if(this.vjsPlayer.isFullscreen()){this.vjsPlayer.exitFullscreen()}else{this.vjsPlayer.requestFullscreen()}}break}case"KeyJ":{this.moveBackward(10);break}case"KeyL":{this.moveForward(10);break}case"ArrowLeft":{this.moveBackward(5);break}case"ArrowRight":{this.moveForward(5);break}case"KeyM":{if(this.isMuted()){this.mute(false)}else{this.mute(true)}break}case"Comma":{this.decreasePlaybackRate();break}case"Period":{this.increasePlaybackRate();break}default:}e.preventDefault();e.stopPropagation();babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onKeyDown")}function A(e){if(t.Type.isStringFilled(e)){const s=`Player:${e}`;t.Event.EventEmitter.emit(this,s,new i.BaseEvent({compatData:[this,s]}))}}function I(){this.vjsPlayer.on("play",(()=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onPlay");this.hasStarted=true}));this.vjsPlayer.on("pause",(()=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onPause")}));this.vjsPlayer.on("click",(()=>{this.active=true;babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onClick")}));this.vjsPlayer.on("ended",(()=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onEnded")}));this.vjsPlayer.on("error",(()=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]("onError")}))}const T=t.Reflection.namespace("BX.Fileman");T.Player=L;T.PlayerManager=c;e.Player=L;e.PlayerManager=c})(this.BX.UI.VideoPlayer=this.BX.UI.VideoPlayer||{},window,BX,BX.Event);
//# sourceMappingURL=video-player.bundle.map.js