{"version":3,"file":"widget.bundle.js","sources":["../src/widget.js"],"sourcesContent":["import { ajax, Dom, Tag, Text, Type, Loc, Event, Runtime } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { footerTypeEnum, ImageStackSteps, imageTypeEnum } from 'ui.image-stack-steps';\nimport { Label, LabelColor, LabelSize } from 'ui.label';\nimport { DateTimeFormat } from 'main.date';\n\nimport 'main.polyfill.intersectionobserver';\n\nimport 'ui.design-tokens';\nimport 'ui.icons';\nimport 'ui.icon-set.main';\nimport './css/style.css';\n\ntype WidgetParams = {\n\ttplId: number,\n\tallCount: number,\n\tusers: Array<WidgetUsers>,\n}\n\ntype WidgetUsers = {\n\tid: number,\n\tavatarUrl?: string,\n}\n\nconst defaulFormatDuration = [\n\t['s', 'sdiff'], ['i', 'idiff'], ['H', 'Hdiff'], ['d', 'ddiff'], ['m', 'mdiff'], ['Y', 'Ydiff'],\n];\n\nconst autoRunIconType = {\n\ttype: imageTypeEnum.ICON,\n\tdata: { icon: 'business-process-1', color: 'var(--ui-color-base-10)' },\n};\n\nexport class Widget\n{\n\t#params: WidgetParams;\n\t#stack: ImageStackSteps;\n\t#popupInstance: Popup;\n\t#popupListNode: Element;\n\n\t#listSkeleton: Element;\n\t#offset: number = 0;\n\n\tconstructor(params: WidgetParams)\n\t{\n\t\tthis.#params = params;\n\t\tthis.#initStack();\n\t}\n\n\tstatic renderTo(node: HTMLElement): Widget\n\t{\n\t\tconst instance = new Widget(JSON.parse(node.dataset.widget));\n\n\t\tDom.replace(node, instance.render());\n\t}\n\n\t#initStack()\n\t{\n\t\tthis.#stack = new ImageStackSteps({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\tid: 'basis',\n\t\t\t\t\tstack: {\n\t\t\t\t\t\timages: Type.isArrayFilled(this.#params.users)\n\t\t\t\t\t\t\t? this.#getStackUserImages(this.#params.users, this.#params.allCount)\n\t\t\t\t\t\t\t: this.#getEmptyStackImages()\n\t\t\t\t\t\t,\n\t\t\t\t\t},\n\t\t\t\t\tfooter: {\n\t\t\t\t\t\ttype: footerTypeEnum.TEXT,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\ttext: this.#getStackText(this.#params.allCount),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyles: { maxWidth: 90 },\n\t\t\t\t\t},\n\t\t\t\t\tstyles: { minWidth: 90 },\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\t#getStackText(counter: number): string\n\t{\n\t\tif (counter < 1)\n\t\t{\n\t\t\treturn Loc.getMessage('BIZPROC_JS_WORKFLOW_INST_WIDGET_LIST_EMPTY');\n\t\t}\n\n\t\treturn Loc.getMessagePlural(\n\t\t\t'BIZPROC_JS_WORKFLOW_INST_WIDGET_LIST',\n\t\t\tcounter,\n\t\t\t{\n\t\t\t\t'#COUNT#': counter < 100 ? counter : '99+',\n\t\t\t},\n\t\t);\n\t}\n\n\t#getStackUserImages(avatars, allCount: number): []\n\t{\n\t\tconst images = [];\n\t\tavatars.forEach((avatar) => {\n\t\t\tconst userId = Text.toInteger(avatar.id);\n\t\t\tif (userId > 0)\n\t\t\t{\n\t\t\t\timages.push({\n\t\t\t\t\ttype: imageTypeEnum.USER,\n\t\t\t\t\tdata: { userId, src: String(avatar.avatarUrl || '') },\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\timages.push(autoRunIconType);\n\t\t\t}\n\t\t});\n\n\t\tif (allCount > 3)\n\t\t{\n\t\t\tconst mixed = images.slice(0, 2);\n\t\t\tmixed.push({\n\t\t\t\ttype: imageTypeEnum.COUNTER,\n\t\t\t\tdata: { text: `+${allCount - 2}` },\n\t\t\t});\n\n\t\t\treturn mixed;\n\t\t}\n\n\t\treturn images;\n\t}\n\n\t#getEmptyStackImages(fill: {}, length: number = 3): []\n\t{\n\t\treturn Array.from({ length }).fill(fill ?? { type: imageTypeEnum.USER_STUB });\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst isEmpty = this.#params.allCount < 1;\n\t\tconst node = Tag.render`<div class=\"bp-workflow-instances-widget ${isEmpty ? '--empty' : ''}\"></div>`;\n\t\tthis.#stack.renderTo(node);\n\n\t\tif (!isEmpty)\n\t\t{\n\t\t\tEvent.bind(node, 'click', this.#handleClick.bind(this));\n\t\t}\n\n\t\treturn node;\n\t}\n\n\t#handleClick(event: BaseEvent)\n\t{\n\t\tif (!this.#popupInstance)\n\t\t{\n\t\t\tthis.#popupInstance = new Popup({\n\t\t\t\tautoHide: true,\n\t\t\t\twidth: 305,\n\t\t\t\tminHeight: 342,\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t\tcontent: this.#getPopupContent(),\n\t\t\t\tbindElement: event.target,\n\t\t\t\tpadding: 0,\n\t\t\t\tborderRadius: '12px',\n\t\t\t});\n\t\t}\n\n\t\tthis.#popupInstance.toggle();\n\t}\n\n\t#getPopupContent(): Element\n\t{\n\t\tthis.#listSkeleton = this.#renderListSkeleton();\n\t\tthis.#popupListNode = Tag.render`<div class=\"bizproc-workflow-instances-popup-list\">${this.#listSkeleton}</div>`;\n\t\tthis.#loadList();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-workflow-instances-popup-content\">\n\t\t\t\t<div class=\"bizproc-workflow-instances-popup-title\">${Loc.getMessage('BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TITLE')}</div>\n\t\t\t\t<div class=\"bizproc-workflow-instances-popup-text\">\n\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TEXT_P1')}\n\t\t\t\t\t<br>\n\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TEXT_P2')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bizproc-workflow-instances-popup-heads\">\n\t\t\t\t\t<div class=\"bizproc-workflow-instances-popup-heads-item\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_AUTHOR')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-workflow-instances-popup-heads-item\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_IN_PROGRESS')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-workflow-instances-popup-heads-item\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TIME')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${this.#popupListNode}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderListSkeleton(): Element\n\t{\n\t\tlet i = 0;\n\t\tlet opacity = 1.15;\n\t\tconst target = Tag.render`<div class=\"bizproc-workflow-instances-popup-list-page\"></div>`;\n\t\twhile (i < 5)\n\t\t{\n\t\t\t++i;\n\t\t\topacity -= 0.15;\n\t\t\tconst facesNode = this.#renderListItemFaces();\n\t\t\tconst label = new Label({\n\t\t\t\tcolor: LabelColor.DEFAULT,\n\t\t\t\tsize: LabelSize.SM,\n\t\t\t\tfill: true,\n\t\t\t\tcustomClass: 'bizproc-workflow-instances-popup-list-item-time-skeleton',\n\t\t\t});\n\t\t\tconst node = Tag.render`\n\t\t\t\t<div class=\"bizproc-workflow-instances-popup-list-item\" style=\"opacity: ${opacity}\">\n\t\t\t\t\t${facesNode}\n\t\t\t\t\t<div class=\"bizproc-workflow-instances-popup-list-item-time\">${label.render()}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tDom.append(node, target);\n\t\t}\n\n\t\treturn target;\n\t}\n\n\t#renderListPage(list: []): Element\n\t{\n\t\tconst pageNode = Tag.render`<div class=\"bizproc-workflow-instances-popup-list-page\"></div>`;\n\n\t\tlist.forEach((item) => {\n\t\t\tconst facesNode = this.#renderListItemFaces(item.avatars.author, item.avatars.running);\n\t\t\tconst label = new Label({\n\t\t\t\ttext: this.#formatDuration(item.time.current),\n\t\t\t\tcolor: LabelColor.LIGHT_BLUE,\n\t\t\t\tsize: LabelSize.SM,\n\t\t\t\tfill: true,\n\t\t\t});\n\t\t\tconst itemNode = Tag.render`\n\t\t\t\t<div class=\"bizproc-workflow-instances-popup-list-item\">\n\t\t\t\t\t${facesNode}\n\t\t\t\t\t<div class=\"bizproc-workflow-instances-popup-list-item-time\">${label.render()}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tDom.append(itemNode, pageNode);\n\t\t});\n\n\t\treturn pageNode;\n\t}\n\n\t#loadList(): void\n\t{\n\t\tajax.runAction('bizproc.workflow.getTemplateInstances', {\n\t\t\tdata: { templateId: this.#params.tplId, offset: this.#offset },\n\t\t}).then((response) => {\n\t\t\tthis.#offset += response.data.list.length;\n\n\t\t\tDom.append(this.#renderListPage(response.data.list), this.#popupListNode);\n\t\t\tDom.append(this.#listSkeleton, this.#popupListNode); // move skeleton to the end\n\n\t\t\tthis.#handleNextPage(response.data.hasNextPage);\n\t\t}).catch((response) => {\n\t\t\tif (response.errors?.length > 0)\n\t\t\t{\n\t\t\t\tRuntime.loadExtension('ui.dialogs.messagebox')\n\t\t\t\t\t.then(({ MessageBox }) => {\n\t\t\t\t\t\tMessageBox.alert(Text.encode(response.errors[0].message));\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {})\n\t\t\t\t;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole?.error(response);\n\t\t\t}\n\t\t});\n\t}\n\n\t#handleNextPage(hasNextPage: boolean): void\n\t{\n\t\tif (hasNextPage && this.#listSkeleton)\n\t\t{\n\t\t\tnew IntersectionObserver((entries, observer) => {\n\t\t\t\tentries.forEach((entry) => {\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\t\tthis.#loadList();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).observe(this.#listSkeleton);\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.remove(this.#listSkeleton);\n\t\tthis.#listSkeleton = null;\n\t}\n\n\t#renderListItemFaces(author: [], running: []): Element\n\t{\n\t\tconst facesNode = Tag.render`\n\t\t\t<div class=\"bizproc-workflow-instances-popup-list-item-faces\"></div>\n\t\t`;\n\n\t\tconst stack = new ImageStackSteps(\n\t\t\t{\n\t\t\t\tsteps: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'col-1',\n\t\t\t\t\t\tstack: {\n\t\t\t\t\t\t\timages: Type.isArrayFilled(author)\n\t\t\t\t\t\t\t\t? this.#getStackUserImages(author)\n\t\t\t\t\t\t\t\t: this.#getEmptyStackImages(autoRunIconType, 1)\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\tminWidth: 36,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'col-2',\n\t\t\t\t\t\tstack: {\n\t\t\t\t\t\t\timages: Type.isArrayFilled(running)\n\t\t\t\t\t\t\t\t? this.#getStackUserImages(running)\n\t\t\t\t\t\t\t\t: this.#getEmptyStackImages(autoRunIconType, 1)\n\t\t\t\t\t\t\t,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t);\n\t\tstack.renderTo(facesNode);\n\n\t\treturn facesNode;\n\t}\n\n\t#formatDuration(duration?: number): string\n\t{\n\t\tif (!duration)\n\t\t{\n\t\t\treturn '?';\n\t\t}\n\n\t\treturn DateTimeFormat.format(defaulFormatDuration, 0, duration);\n\t}\n}\n"],"names":["defaulFormatDuration","autoRunIconType","type","imageTypeEnum","ICON","data","icon","color","Widget","constructor","params","renderTo","node","instance","JSON","parse","dataset","widget","Dom","replace","render","isEmpty","allCount","Tag","Event","bind","ImageStackSteps","steps","id","stack","images","Type","isArrayFilled","users","footer","footerTypeEnum","TEXT","text","styles","maxWidth","minWidth","counter","Loc","getMessage","getMessagePlural","avatars","forEach","avatar","userId","Text","toInteger","push","USER","src","String","avatarUrl","mixed","slice","COUNTER","fill","length","Array","from","USER_STUB","event","Popup","autoHide","width","minHeight","animation","content","bindElement","target","padding","borderRadius","toggle","i","opacity","facesNode","label","Label","LabelColor","DEFAULT","size","LabelSize","SM","customClass","append","list","pageNode","item","author","running","time","current","LIGHT_BLUE","itemNode","ajax","runAction","templateId","tplId","offset","then","response","hasNextPage","catch","errors","Runtime","loadExtension","MessageBox","alert","encode","message","console","error","IntersectionObserver","entries","observer","entry","isIntersecting","disconnect","observe","remove","duration","DateTimeFormat","format"],"mappings":"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"}