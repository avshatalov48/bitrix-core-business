(function(e,i,s,t){"use strict";let a=e=>e,l,r,o,n;let c=null;function d(e,s,t){const a=t?window.arAllActivities[e].PRESETS.find((e=>e.ID===t)):null;const l=a?a.PROPERTIES:{};const r={Properties:{Title:a&&a.NAME||i.Text.encode(window.arAllActivities[e].NAME),...l},Type:window.arAllActivities[e].CLASS,Children:[]};c.AddActivity(window.CreateActivity(r),s)}function h(e,i){if(window.arUserParams&&BX.type.isArray(window.arUserParams.SNIPPETS)&&window.arUserParams.SNIPPETS[e]){c.AddActivity(window.CreateActivity(window.arUserParams.SNIPPETS[e]),i)}}const b=window.BizProcActivity;var v=babelHelpers.classPrivateFieldLooseKey("numberHeadRows");var p=babelHelpers.classPrivateFieldLooseKey("menuItems");var u=babelHelpers.classPrivateFieldLooseKey("onLineMouseOver");var P=babelHelpers.classPrivateFieldLooseKey("onLineMouseOut");var w=babelHelpers.classPrivateFieldLooseKey("initDragNDropHandlers");var f=babelHelpers.classPrivateFieldLooseKey("onDragging");var y=babelHelpers.classPrivateFieldLooseKey("onDrop");var m=babelHelpers.classPrivateFieldLooseKey("moveActivityToPosition");var g=babelHelpers.classPrivateFieldLooseKey("checkMovingCycle");var A=babelHelpers.classPrivateFieldLooseKey("copyActivityToPosition");var H=babelHelpers.classPrivateFieldLooseKey("removeChild");var L=babelHelpers.classPrivateFieldLooseKey("refreshArrows");var F=babelHelpers.classPrivateFieldLooseKey("removeResources");var B=babelHelpers.classPrivateFieldLooseKey("onClick");var D=babelHelpers.classPrivateFieldLooseKey("getAllActivitiesMenuItems");var E=babelHelpers.classPrivateFieldLooseKey("getGroupMenuItems");var S=babelHelpers.classPrivateFieldLooseKey("addMyActivitiesMenuItem");var C=babelHelpers.classPrivateFieldLooseKey("getActivityMenuItem");var M=babelHelpers.classPrivateFieldLooseKey("renderActivityMenuItemNode");var T=babelHelpers.classPrivateFieldLooseKey("onGroupItemSubMenuShow");var O=babelHelpers.classPrivateFieldLooseKey("addActivity");var I=babelHelpers.classPrivateFieldLooseKey("createArrow");var N=babelHelpers.classPrivateFieldLooseKey("draw");class R extends b{constructor(){super();Object.defineProperty(this,N,{value:te});Object.defineProperty(this,I,{value:se});Object.defineProperty(this,O,{value:ie});Object.defineProperty(this,T,{value:ee});Object.defineProperty(this,M,{value:Z});Object.defineProperty(this,C,{value:Q});Object.defineProperty(this,S,{value:J});Object.defineProperty(this,E,{value:V});Object.defineProperty(this,D,{value:Y});Object.defineProperty(this,B,{value:G});Object.defineProperty(this,F,{value:$});Object.defineProperty(this,L,{value:q});Object.defineProperty(this,H,{value:X});Object.defineProperty(this,A,{value:U});Object.defineProperty(this,g,{value:z});Object.defineProperty(this,m,{value:W});Object.defineProperty(this,y,{value:k});Object.defineProperty(this,f,{value:x});Object.defineProperty(this,w,{value:_});Object.defineProperty(this,P,{value:K});Object.defineProperty(this,u,{value:j});Object.defineProperty(this,v,{writable:true,value:0});Object.defineProperty(this,p,{writable:true,value:void 0});this.Type="SequenceActivity";this.childsContainer=null;babelHelpers.classPrivateFieldLooseBase(this,w)[w]();this.LineMouseOver=babelHelpers.classPrivateFieldLooseBase(this,u)[u];this.LineMouseOut=babelHelpers.classPrivateFieldLooseBase(this,P)[P];this.OnClick=e=>{babelHelpers.classPrivateFieldLooseBase(this,B)[B](e.target)};this.ondragging=babelHelpers.classPrivateFieldLooseBase(this,f)[f].bind(this);this.ondrop=babelHelpers.classPrivateFieldLooseBase(this,y)[y].bind(this);this.ActivityRemoveChild=this.RemoveChild;this.RemoveChild=babelHelpers.classPrivateFieldLooseBase(this,H)[H].bind(this);this.RemoveResources=babelHelpers.classPrivateFieldLooseBase(this,F)[F].bind(this);this.AddActivity=babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this);this.CreateLine=babelHelpers.classPrivateFieldLooseBase(this,I)[I].bind(this);this.ActivityDraw=this.Draw;this.Draw=babelHelpers.classPrivateFieldLooseBase(this,N)[N].bind(this)}get iHead(){return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}set iHead(e){if(i.Type.isInteger(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e}}}function j(){i.Dom.style(this.parentNode,"backgroundImage","url(/bitrix/images/bizproc/arr_over.gif)")}function K(){i.Dom.style(this.parentNode,"backgroundImage","url(/bitrix/images/bizproc/arr.gif)")}function _(){this.lastDrop=false;this.h1id=window.DragNDrop.AddHandler("ondragging",babelHelpers.classPrivateFieldLooseBase(this,f)[f].bind(this));this.h2id=window.DragNDrop.AddHandler("ondrop",babelHelpers.classPrivateFieldLooseBase(this,y)[y].bind(this))}function x(e,s,t){if(this.childsContainer){for(let e=0;e<=this.childActivities.length;e++){const a=this.childsContainer.rows[e*2+this.iHead].cells[0].childNodes[0];const l=i.Dom.getPosition(a);if(l.left<s&&s<l.right&&l.top<t&&t<l.bottom){a.onmouseover();this.lastDrop=a;return}}if(this.lastDrop){this.lastDrop.onmouseout();this.lastDrop=false}}}function k(e,i,s){if(this.childsContainer&&this.lastDrop){if(window.DragNDrop.obj.parentActivity&&s.ctrlKey===false&&s.metaKey===false){babelHelpers.classPrivateFieldLooseBase(this,m)[m](window.DragNDrop.obj,this.lastDrop)}else{babelHelpers.classPrivateFieldLooseBase(this,A)[A](window.DragNDrop.obj,this.lastDrop)}this.lastDrop.onmouseout();this.lastDrop=false}}function W(e,i){const s=e.parentActivity;const t=s.childActivities.findIndex((i=>i.Name===e.Name));const a=i.ind;if(s.Name!==this.Name||t!==a&&t+1!==a){if(babelHelpers.classPrivateFieldLooseBase(this,g)[g](e)){s.childsContainer.deleteRow(t*2+1+s.iHead);s.childsContainer.deleteRow(t*2+1+s.iHead);s.childActivities.splice(t,1);babelHelpers.classPrivateFieldLooseBase(this,L)[L](s);babelHelpers.classPrivateFieldLooseBase(this,O)[O](e,i.ind)}else{alert(window.BPMESS.BPSA_ERROR_MOVE_1)}}}function z(e){let i=this;while(i){if(e.Name===i.Name){return false}i=i.parentActivity}return true}function U(e,i){const s=window.CreateActivity(e);this.AddActivity(s,i.ind)}function X(e){const i=this.childActivities.indexOf(e);if(i>=0){this.ActivityRemoveChild(e);if(this.childsContainer){this.childsContainer.deleteRow([i*2+1+this.iHead]);this.childsContainer.deleteRow([i*2+1+this.iHead]);babelHelpers.classPrivateFieldLooseBase(this,L)[L](this)}}}function q(e){for(let i=0;i<=e.childActivities.length;i++){e.childsContainer.rows[i*2+e.iHead].cells[0].childNodes[0].ind=i}}function $(){window.DragNDrop.RemoveHandler("ondragging",this.h1id);window.DragNDrop.RemoveHandler("ondrop",this.h2id);if(this.childsContainer&&this.childsContainer.parentNode){i.Dom.remove(this.childsContainer);this.childsContainer=null}}function G(e){c=this;const s=new t.Menu({bindElement:e,id:`all-worfklow-activity-${i.Text.getRandom()}`,minWidth:190,autoHide:true,zIndexOptions:{alwaysOnTop:true},cacheable:false,items:babelHelpers.classPrivateFieldLooseBase(this,D)[D](),subMenuOptions:{maxWidth:850,maxHeight:600}});s.show()}function Y(){if(babelHelpers.classPrivateFieldLooseBase(this,p)[p]){babelHelpers.classPrivateFieldLooseBase(this,S)[S]();return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}const e=babelHelpers.classPrivateFieldLooseBase(this,E)[E]();Object.entries(window.arAllActivities).forEach((([s,t])=>{if((s!=="setstateactivity"||window.rootActivity.Type!==this.Type)&&!t.EXCLUDED&&t.CATEGORY){var a;const l=(a=t.CATEGORY.OWN_ID)!=null?a:t.CATEGORY.ID;if(e[l]){e[l].items.push(babelHelpers.classPrivateFieldLooseBase(this,C)[C](s,t));if(i.Type.isArrayFilled(t.PRESETS)){t.PRESETS.forEach((i=>{e[l].items.push(babelHelpers.classPrivateFieldLooseBase(this,C)[C](s,t,i))}))}}}}));if(e.rest&&i.Reflection.getClass("BX.rest.Marketplace")){e.rest.items.push({className:"bizproc-designer-sequence-activity-menu-item-icon",html:babelHelpers.classPrivateFieldLooseBase(this,M)[M](window.BPMESS.BPSA_MARKETPLACE_ADD_TITLE_2,window.BPMESS.BPSA_MARKETPLACE_ADD_DESCR_3),title:window.BPMESS.BPSA_MARKETPLACE_ADD_DESCR_3,dataset:{icon:"/bitrix/images/bizproc/act_icon_plus.png",name:window.BPMESS.BPSA_MARKETPLACE_ADD_TITLE_2},onclick:(e,i)=>{BX.rest.Marketplace.open({},"auto_pb");i.getMenuWindow().getParentMenuWindow().close()}})}babelHelpers.classPrivateFieldLooseBase(this,p)[p]=Object.values(e).filter((e=>e.items.length>0));babelHelpers.classPrivateFieldLooseBase(this,S)[S]();return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}function V(){const e={};Object.entries(window.arAllActGroups).forEach((([i,s])=>{e[i]={id:i,text:s,items:[],events:{"SubMenu:onShow":babelHelpers.classPrivateFieldLooseBase(this,T)[T]}}}));return e}function J(){const e=babelHelpers.classPrivateFieldLooseBase(this,p)[p].findIndex((e=>e.id==="MyActivity"));if(e>=0){babelHelpers.classPrivateFieldLooseBase(this,p)[p].splice(e,1)}if(window.arUserParams&&i.Type.isArrayFilled(window.arUserParams.SNIPPETS)){const e={id:"MyActivity",text:window.BPMESS.BPSA_MY_ACTIVITIES_1,items:[],events:{"SubMenu:onShow":babelHelpers.classPrivateFieldLooseBase(this,T)[T]}};window.arUserParams.SNIPPETS.forEach(((i,s)=>{var t;e.items.push({className:"bizproc-designer-sequence-activity-menu-item-icon",html:babelHelpers.classPrivateFieldLooseBase(this,M)[M](i.Properties.Title,""),dataset:{icon:(t=i.Icon)!=null?t:"/bitrix/images/bizproc/act_icon.gif",name:i.Properties.Title},title:i.Properties.Title,onclick:(e,i)=>{h(s,i.getMenuWindow().getParentMenuWindow().bindElement.ind);i.getMenuWindow().getParentMenuWindow().close()}})}));babelHelpers.classPrivateFieldLooseBase(this,p)[p].push(e)}}function Q(e,i,s){var t;const a=s&&s.DESCRIPTION?s.DESCRIPTION:i.DESCRIPTION;return{onclick:(i,t)=>{d(e,t.getMenuWindow().getParentMenuWindow().bindElement.ind,s?s.ID:null);t.getMenuWindow().getParentMenuWindow().close()},className:"bizproc-designer-sequence-activity-menu-item-icon",html:babelHelpers.classPrivateFieldLooseBase(this,M)[M](s?s.NAME:i.NAME,a),title:a,dataset:{icon:(t=i.ICON)!=null?t:"/bitrix/images/bizproc/act_icon.gif",name:i.NAME}}}function Z(e,s){return i.Tag.render(l||(l=a`
			<div style="line-height: normal; overflow: hidden; text-overflow: ellipsis;">
				<span><b>${0}</b></span>
				<br/>
				<span>${0}</span>
			</div>
		`),i.Text.encode(e),i.Text.encode(s))}function ee(e){const s=e.getTarget();if(s.getSubMenu()&&s.getSubMenu().getMenuItems()){s.getSubMenu().getMenuItems().forEach((e=>{const s=e.layout.item.querySelector(".menu-popup-item-icon");i.Dom.append(i.Tag.render(r||(r=a`<img src="${0}" alt="${0}"/>`),i.Text.encode(e.dataset.icon),i.Text.encode(e.dataset.name)),s)}))}}function ie(e,s){this.childActivities.splice(s,0,e);e.parentActivity=this;e.setCanBeActivated(this.getCanBeActivatedChild());const t=this.childsContainer.insertRow(s*2+1+this.iHead).insertCell(-1);i.Dom.attr(t,{align:"center",vAlign:"center"});e.Draw(t);const a=this.childsContainer.insertRow(s*2+2+this.iHead).insertCell(-1);i.Dom.attr(a,{align:"center",vAlign:"center"});babelHelpers.classPrivateFieldLooseBase(this,I)[I](s+1);babelHelpers.classPrivateFieldLooseBase(this,L)[L](this);window.BPTemplateIsModified=true}function se(e){i.Dom.style(this.childsContainer.rows[e*2+this.iHead].cells[0],{height:"40px",background:"url(/bitrix/images/bizproc/arr.gif) no-repeat scroll 50% 50%"});const s=BX.Dom.create("img",{attrs:{src:"/bitrix/images/1.gif",width:"28",height:"21"}});s.onmouseover=babelHelpers.classPrivateFieldLooseBase(this,u)[u];s.onmouseout=babelHelpers.classPrivateFieldLooseBase(this,P)[P];s.ind=e;i.Event.bind(s,"click",babelHelpers.classPrivateFieldLooseBase(this,B)[B].bind(this,s));i.Dom.append(s,this.childsContainer.rows[e*2+this.iHead].cells[0])}function te(e){const s=Array.from({length:this.iHead+this.childActivities.length*2},(()=>i.Tag.render(o||(o=a`
				<tr><td align="center" valign="center"></td></tr>
			`))));this.childsContainer=i.Tag.render(n||(n=a`
			<table 
				class="seqactivitycontainer"
				id="${0}"
				width="100%"
				cellspacing="0"
				cellpadding="0"
				border="0"
			>
				<tbody>
					<tr><td align="center" valign="center"></td></tr>
					${0}
				</tbody>
			</table>
		`),i.Text.encode(this.Name),s);i.Dom.append(this.childsContainer,e);babelHelpers.classPrivateFieldLooseBase(this,I)[I](0);this.childActivities.forEach(((e,s)=>{e.Draw(this.childsContainer.rows[s*2+1+this.iHead].cells[0]);babelHelpers.classPrivateFieldLooseBase(this,I)[I](i.Text.toInteger(s)+1)}));if(this.AfterSDraw){this.AfterSDraw()}}e.SequenceActivity=R})(this.window=this.window||{},BX,BX.Event,BX.Main);
//# sourceMappingURL=sequenceactivity.map.js