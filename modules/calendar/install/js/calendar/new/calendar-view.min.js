(function(e){function t(e){this.calendar=e;this.util=e.util;this.entryController=e.entryController;this.name="#calendar view#";this.title=this.name;this.enabled=true;this.contClassName="";this.isBuilt=false;this.animateClass="calendar-grid-animate";this.isCollapsedOffHours=this.util.getUserOption("collapseOffHours","Y")==="Y";this.hotkey=null;this.entries=[];this.entriesIndex={};BX.addCustomEvent(this.calendar,"viewOnClick",BX.proxy(this.handleClick,this));this.deletedEntriesIds=[];BX.addCustomEvent("BX.Calendar.Entry:beforeDelete",(e=>{if(!e.recursionMode||e.recursionMode==="this"&&e.entryData){const t=this.calendar.entryController.getUniqueId(e.entryData);this.deletedEntriesIds.push(t)}}));BX.addCustomEvent("BX.Calendar.Entry:cancelDelete",(e=>{const t=this.calendar.entryController.getUniqueId(e.entryData);const a=this.deletedEntriesIds.indexOf(t);if(a!==-1){this.deletedEntriesIds.splice(a,1)}}))}t.prototype={getUndeletedEntries:function(){return this.entries.filter((e=>!this.deletedEntriesIds.find((t=>t===e.uid))))},build:function(){this.viewCont=BX.create("DIV",{props:{className:this.contClassName}})},show:function(){if(!this.isBuilt){this.build();this.isBuilt=true}this.viewCont.style.display="";this.setTitle("");this.highlightAll()},isFirstVisibleRecursiveEntry:function(e){if(!e.isRecursive()){return true}const t=this.entries.filter((t=>t.uid.split("|")[0]===e.parentId&&!t.isHiddenInPopup)).sort(((e,t)=>e.from.getTime()>t.from.getTime()?1:e.from.getTime()<t.from.getTime()?-1:0));if(t.length===0){return true}return t[0]&&t[0]?.uid===e?.uid},highlightAll:function(){BX.addClass(this.viewCont,"calendar-grid-highlight-all");clearTimeout(this.hightlightAll);this.hightlightAll=setTimeout((()=>{BX.removeClass(this.viewCont,"calendar-grid-highlight-all")}),6e3)},redraw:function(){this.displayEntries()},reload:function(){this.loadEntries().then((e=>{this.entries=e;this.redraw()}))},hide:function(){this.viewCont.style.display="none"},getName:function(){return this.name},getContainer:function(){return this.viewCont},setTitle:function(e){this.calendar.viewTitle.innerHTML=e.replace("#GRAY_START#",'<span class="calendar-top-title-gray">').replace("#GRAY_END#","</span>")},getIsBuilt:function(){return this.isBuilt},fadeAnimation:function(e,t,a){new BX.easing({duration:t||200,start:{opacity:100},finish:{opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){e.style.opacity=t.opacity/100},complete:function(){if(a&&BX.type.isFunction(a))a()}}).animate()},showAnimation:function(e,t,a){new BX.easing({duration:t||200,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){e.style.opacity=t.opacity/100},complete:function(){e.removeAttribute("style");if(a&&BX.type.isFunction(a)){a()}}}).animate()},getArrow:function(e,t,a){const n=a?t:"#ffffff00";const i=document.createElement("div");if(e==="left"){i.innerHTML=`\n\t\t\t\t\t<svg class="calendar-event-angle-start-yesterday" viewBox="0 0 6 18" version="1.1" xmlns="http://www.w3.org/2000/svg" style="stroke: ${t}; fill: ${n};">\n\t\t\t\t\t\t<path stroke-width="1" d="M14.5,17.5 L14.5,0.5 L2.00049088,0.5 C1.78697323,0.5 1.57591593,0.545584 1.38143042,0.633704227 C0.626846099,0.975601882 0.292297457,1.86447615 0.634195112,2.61906047 L3.05787308,7.96823256 C3.35499359,8.62399158 3.35499359,9.37600842 3.05787308,10.0317674 L0.634195112,15.3809395 C0.546074885,15.575425 0.500490885,15.7864823 0.500490885,16 C0.500490885,16.8284271 1.17206376,17.5 2.00049088,17.5 L14.5,17.5 Z"/>\n\t\t\t\t\t</svg>\n\t\t\t\t`}if(e==="right"){i.innerHTML=`\n\t\t\t\t\t<svg class="calendar-event-angle-finish-tomorrow" viewBox="8 0 15 18" version="1.1" xmlns="http://www.w3.org/2000/svg" style="stroke: ${t}; fill: ${n};">\n\t\t\t\t\t\t<path stroke-width="1" d="M0.5,0.5 L0.5,17.5 L8.7031205,17.5 C9.65559352,17.5 10.5253145,16.9587787 10.9460243,16.1042565 L13.8991717,10.1059895 C14.2418971,9.40986472 14.2419701,8.59406382 13.8993692,7.89787777 L10.9458495,1.89614482 C10.5252214,1.04140271 9.65538246,0.5 8.70274816,0.5 L0.5,0.5 Z"></path>\n\t\t\t\t\t</svg>\n\t\t\t\t`}return i.firstElementChild},occupySlot:function(e){if(this.days){var t;for(t=e.startIndex;t<e.endIndex;t++){if(this.days[t]){this.days[t].slots[e.slotIndex]=false}}}},showCompactEditForm:function(e){if(this.calendar.isExternalMode()){this.calendar.triggerEvent("createNewEntry",e);setTimeout(BX.delegate((function(){if(e.closeCallback&&typeof e.closeCallback=="function"){e.closeCallback()}}),this),300)}else{if(this.calendar.util.type==="location"){BX.Calendar.EntryManager.openCompactEditForm({type:"user",isLocationCalendar:true,locationAccess:this.calendar.util.config.locationAccess,ownerId:this.calendar.util.userId,sections:this.calendar.roomsManager.getSections(),roomsManager:this.calendar.roomsManager,trackingUserList:this.calendar.util.getSuperposedTrackedUsers(),entryTime:e.entryTime||null,closeCallback:e.closeCallback,userSettings:this.calendar.util.config.userSettings,locationFeatureEnabled:this.calendar.util.isRichLocationEnabled(),locationList:BX.Calendar.Controls.Location.getLocationList(),iblockMeetingRoomList:this.calendar.util.getMeetingRoomList(),plannerFeatureEnabled:this.calendar.util.config.plannerFeatureEnabled})}else{BX.Calendar.EntryManager.openCompactEditForm({type:this.calendar.util.type,isLocationCalendar:false,locationAccess:this.calendar.util.config.locationAccess,ownerId:this.calendar.util.ownerId,sections:this.calendar.sectionManager.getSections(),trackingUserList:this.calendar.util.getSuperposedTrackedUsers(),entryTime:e.entryTime||null,closeCallback:e.closeCallback,userSettings:this.calendar.util.config.userSettings,locationFeatureEnabled:this.calendar.util.isRichLocationEnabled(),locationList:BX.Calendar.Controls.Location.getLocationList(),iblockMeetingRoomList:this.calendar.util.getMeetingRoomList(),plannerFeatureEnabled:this.calendar.util.config.plannerFeatureEnabled})}}},showCompactViewForm:function(e){BX.Calendar.EntryManager.openCompactViewForm({entry:e.entry,calendarContext:BX.Calendar.Util.getCalendarContext(),type:this.calendar.util.type,isLocationCalendar:this.calendar.util.type==="location",locationAccess:this.calendar.util.config.locationAccess,ownerId:this.calendar.util.ownerId,sections:this.calendar.util.type==="location"?this.calendar.roomsManager.getSections():this.calendar.sectionManager.getSections(),trackingUserList:this.calendar.util.getSuperposedTrackedUsers(),userSettings:this.calendar.util.config.userSettings,locationFeatureEnabled:this.calendar.util.isRichLocationEnabled(),locationList:BX.Calendar.Controls.Location.getLocationList(),iblockMeetingRoomList:this.calendar.util.getMeetingRoomList(),plannerFeatureEnabled:this.calendar.util.config.plannerFeatureEnabled})},showEditSlider:function(e){if(this.simpleViewPopup){this.simpleViewPopup.close()}if(!e||!e.entry){e={}}if(this.calendar.util.type==="location"){BX.Calendar.EntryManager.openEditSlider({entry:e.entry,type:"user",isLocationCalendar:true,locationAccess:this.calendar.util.config.locationAccess,roomsManager:this.calendar.roomsManager,ownerId:this.calendar.util.ownerId,userId:parseInt(this.calendar.currentUser.id)})}else{BX.Calendar.EntryManager.openEditSlider({calendarContext:this.util.calendarContext,entry:e.entry,type:this.calendar.util.type,isLocationCalendar:false,locationAccess:this.calendar.util.config.locationAccess,ownerId:this.calendar.util.ownerId,userId:parseInt(this.calendar.currentUser.id)})}},handleEntryClick:function(e){e.entry=e.entry||this.getEntryById(e.uid);if(e.entry){if(this.calendar.isExternalMode()){return this.calendar.triggerEvent("entryClick",e)}if(e.entry.isTask()){const t=BX.Uri.addParam(this.calendar.util.getViewTaskPath(e.entry.id),{ta_sec:"calendar",ta_el:"title_click"});BX.SidePanel.Instance.open(t,{loader:"task-new-loader"})}else if(!this.calendar.dragDrop.isDragging){this.showCompactViewForm(e)}}},showViewSlider:function(e){if(!this.calendar.util.useViewSlider()){return}if(e.entry&&e.entry.id){BX.Calendar.EntryManager.openViewSlider(e.entry.id,{from:e.entry.from,timezoneOffset:e.entry&&e.entry.data?e.entry.data.TZ_OFFSET_FROM:null})}if(this.simpleViewPopup){this.simpleViewPopup.close()}setTimeout(BX.delegate((function(){if(this.simpleViewPopup){this.simpleViewPopup.close()}}),this),200)},isActive:function(){return this.calendar.currentViewName===this.name},getEntryById:function(e){const t=this.entries.find((t=>t.uid===e));if(!t){return false}return t},getRealEntry:function(e){if(!e){return null}for(const t of this.entries){if(t.uid===e.uid){return t}}for(const t of this.entries){if(t.data.RELATIONS){const a=e.uid.split("|")[0];const n=e.uid.split("|")[1];if(t.data.RELATIONS.COMMENT_XML_ID==="EVENT_"+a+"_"+n){return t}}}for(const t of this.entries){if(t.data.RELATIONS){const a=e.uid.split("|")[0];if(t.data.RELATIONS.COMMENT_XML_ID==="EVENT_"+a){return t}}}return null},selectEntryPart:function(e,t){if(e.wrapNode){e.backupWrapNodeClass=e.wrapNode.className;BX.addClass(e.wrapNode,"calendar-event-line-fill");BX.addClass(e.wrapNode,"active")}if(e.blockBackgroundNode){e.backupBlockOpacity=e.blockBackgroundNode.style.opacity;e.blockBackgroundNode.style.opacity=1}if(e.innerContainer){e.backupBackground=e.innerContainer.style.background;e.backupBorderColor=e.innerContainer.style.borderColor;e.innerContainer.style.backgroundColor=t;e.innerContainer.style.borderColor=t}if(e.nameNode){e.backupNameColor=e.nameNode.style.color;e.nameNode.style.color="#fff"}if(e.timeNode){e.backupTimeColor=e.timeNode.style.color;e.backupTimeZIndex=e.timeNode.style.zIndex||0;e.timeNode.style.color="#fff";e.timeNode.style.zIndex=200}return e},deselectEntry:function(e){if(!e&&this.selectedEntry)e=this.selectedEntry;if(e){if(e.deselect)e.deselect();e.parts.forEach((function(e){if(e.params.wrapNode){e.params.wrapNode.className=e.params.backupWrapNodeClass}if(e.params.innerContainer){e.params.innerContainer.style.backgroundColor=e.params.backupBackground;e.params.innerContainer.style.borderColor=e.params.backupBorderColor}if(e.params.blockBackgroundNode){e.params.blockBackgroundNode.style.opacity=e.params.backupBlockOpacity}if(e.params.nameNode){e.params.nameNode.style.color=e.params.backupNameColor}if(e.params.timeNode){e.params.timeNode.style.color=e.params.backupTimeColor;e.params.timeNode.style.zIndex=e.params.backupTimeZIndex}}),this)}BX.remove(this.calendar.additionalInfoOuter);this.selectedEntry=false},getSelectedEntry:function(){return this.selectedEntry||false},preloadEntries:function(){},showAllEventsInPopup:function(e){var t=e.entrieList||e.day.entries.list,a,n;a=BX.create("DIV",{props:{className:"calendar-all-events-popup calendar-custom-scroll"},events:{click:BX.proxy(this.calendar.handleViewsClick,this.calendar)}});t.sort(this.calendar.entryController.sort);var i,r;let s,o;t.forEach((function(t){if(t.entry){if(t.entry.isTask()){if(!i){s=BX.create("DIV",{props:{className:"calendar-event-title"},text:BX.message("EC_ENTRIES_TASKS")});a.appendChild(s);i=a.appendChild(BX.create("DIV",{props:{className:"calendar-event-block"}}))}this.displayEntryPiece({dayInCell:e.day.date,entry:t.entry,part:t.part,holder:i,popupMode:true})}else{if(!r){const t=e.day.date.getTime();o=BX.create("DIV",{props:{className:"calendar-event-title calendar-event-title-button"},attrs:{"data-bx-calendar-date":t},text:BX.message("EC_ENTRIES_EVENTS")+", "+BX.date.format("d F",t/1e3)});a.appendChild(o);r=a.appendChild(BX.create("DIV",{props:{className:"calendar-event-block"}}))}this.displayEntryPiece({dayInCell:e.day.date,entry:t.entry,part:t.part,holder:r,popupMode:true})}}}),this);n=BX.PopupWindowManager.create(this.calendar.id+"-all-events-popup",e.day.hiddenStorage,{autoHide:true,closeByEsc:true,offsetTop:-2,offsetLeft:0,lightShadow:true,content:a});n.setAngle({offset:2*this.getDayWidth()/3});n.show(true);this.allEventsPopup=n;if(o){o.addEventListener("click",(()=>{n.destroy()}))}BX.addCustomEvent(n,"onPopupClose",(function(){n.destroy()}))},showNavigationCalendar:function(){setTimeout(BX.delegate((function(){if(this.calendar.rightBlock){if(!this.calendar.navCalendar){this.calendar.navCalendar=new e.BXEventCalendar.NavigationCalendar(this.calendar,{wrap:this.calendar.rightBlock.appendChild(BX.create("DIV",{props:{className:"calendar-right-block"}}))})}if(this.calendar.initialViewShow){BX.addClass(this.calendar.mainCont,"calendar-main-container-small-calendar");this.calendar.initialViewShow=false}this.calendar.navCalendar.show()}}),this),0)},getDayWidth:function(){var e=200;if(this.days&&this.days[0]&&this.days[0].node){e=this.days[0].node.offsetWidth||e}return Math.min(e,400)},getAdjustedDate:function(e,t){if(!e){e=new Date}if(t&&e.getTime()<t.start.getTime()){e=new Date(t.start.getTime())}if(t&&e.getTime()>t.end.getTime()){e=new Date(t.end.getTime())}var a=false;if(e&&e.getTime){e.setHours(0,0,0,0);a=new Date(e.getTime())}return a},getViewRange:function(){var e=this.calendar.getViewRangeDate(),t=new Date(e.getTime());return{start:e,end:t}},getHotkey:function(){return this.hotkey||null}};function a(e){t.apply(this,arguments);this.name="year";this.title=BX.message("EC_VIEW_YEAR");this.contClassName="calendar-year-view";this.build()}a.prototype=Object.create(t.prototype);a.prototype.constructor=a;if(e.BXEventCalendar){e.BXEventCalendar.CalendarView=t;e.BXEventCalendar.CalendarYearView=a}else{BX.addCustomEvent(e,"onBXEventCalendarInit",(function(){e.BXEventCalendar.CalendarView=t;e.BXEventCalendar.CalendarYearView=a}))}e.BXEventCalendarView=t})(window);
//# sourceMappingURL=calendar-view.map.js