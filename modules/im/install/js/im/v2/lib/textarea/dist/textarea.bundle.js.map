{"version":3,"file":"textarea.bundle.js","sources":["../src/classes/resize-manager.js","../src/textarea.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Textarea.ResizeManager';\n\nexport class ResizeManager extends EventEmitter\n{\n\t#observer: ResizeObserver;\n\t#textareaHeight: number;\n\n\tstatic events = {\n\t\tonHeightChange: 'onHeightChange',\n\t};\n\n\tconstructor(): ResizeManager\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tthis.#initObserver();\n\t}\n\n\tobserveTextarea(element: HTMLElement)\n\t{\n\t\tthis.#observer.observe(element);\n\t\tthis.#textareaHeight = element.clientHeight;\n\t}\n\n\tunobserveTextarea(element: HTMLElement)\n\t{\n\t\tthis.#observer.unobserve(element);\n\t\tthis.#textareaHeight = 0;\n\t}\n\n\t#initObserver()\n\t{\n\t\tthis.#observer = new ResizeObserver(((entries: ResizeObserverEntry[]) => {\n\t\t\tentries.forEach((entry: ResizeObserverEntry) => {\n\t\t\t\tconst height = entry.borderBoxSize?.[0].blockSize;\n\t\t\t\tif (Type.isNumber(height) && height !== this.#textareaHeight)\n\t\t\t\t{\n\t\t\t\t\tthis.emit(ResizeManager.events.onHeightChange, { newHeight: height });\n\t\t\t\t\tthis.#textareaHeight = height;\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\t}\n}\n","export { ResizeManager } from './classes/resize-manager';\n\ntype InsertTextConfig = {\n\ttext: string,\n\twithNewLine?: boolean,\n\treplace?: boolean\n};\n\nconst TAB = '\\t';\nconst NEW_LINE = '\\n';\nconst LETTER_CODE_PREFIX = 'Key';\n\n/* eslint-disable no-param-reassign */\nexport const Textarea = {\n\taddTab(textarea: HTMLTextAreaElement): string\n\t{\n\t\tconst newSelectionPosition = textarea.selectionStart + 1;\n\n\t\tconst textBefore = textarea.value.slice(0, textarea.selectionStart);\n\t\tconst textAfter = textarea.value.slice(textarea.selectionEnd);\n\t\tconst textWithTab = `${textBefore}${TAB}${textAfter}`;\n\n\t\ttextarea.value = textWithTab;\n\t\ttextarea.selectionStart = newSelectionPosition;\n\t\ttextarea.selectionEnd = newSelectionPosition;\n\n\t\treturn textWithTab;\n\t},\n\tremoveTab(textarea: HTMLTextAreaElement): string\n\t{\n\t\tconst previousSymbol = textarea.value.slice(textarea.selectionStart - 1, textarea.selectionStart);\n\t\tif (previousSymbol !== TAB)\n\t\t{\n\t\t\treturn textarea.value;\n\t\t}\n\n\t\tconst newSelectionPosition = textarea.selectionStart - 1;\n\n\t\tconst textBefore = textarea.value.slice(0, textarea.selectionStart - 1);\n\t\tconst textAfter = textarea.value.slice(textarea.selectionEnd);\n\t\tconst textWithoutTab = `${textBefore}${textAfter}`;\n\n\t\ttextarea.value = textWithoutTab;\n\t\ttextarea.selectionStart = newSelectionPosition;\n\t\ttextarea.selectionEnd = newSelectionPosition;\n\n\t\treturn textWithoutTab;\n\t},\n\thandleDecorationTag(textarea: HTMLTextAreaElement, decorationKey: 'KeyB' | 'KeyI' | 'KeyU' | 'KeyS'): string\n\t{\n\t\tdecorationKey = decorationKey.replace(LETTER_CODE_PREFIX, '').toLowerCase();\n\t\tconst LEFT_TAG = `[${decorationKey}]`;\n\t\tconst RIGHT_TAG = `[/${decorationKey}]`;\n\n\t\tconst selectedText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\n\t\tif (!selectedText)\n\t\t{\n\t\t\treturn textarea.value;\n\t\t}\n\n\t\tconst hasDecorationTag = (\n\t\t\tselectedText.toLowerCase().startsWith(LEFT_TAG)\n\t\t\t&& selectedText.toLowerCase().endsWith(RIGHT_TAG)\n\t\t);\n\t\tif (hasDecorationTag)\n\t\t{\n\t\t\treturn this.removeDecorationTag(textarea, decorationKey);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.addDecorationTag(textarea, decorationKey);\n\t\t}\n\t},\n\taddDecorationTag(textarea: HTMLTextAreaElement, decorationKey: 'b' | 'i' | 'u' | 's'): string\n\t{\n\t\tconst LEFT_TAG = `[${decorationKey}]`;\n\t\tconst RIGHT_TAG = `[/${decorationKey}]`;\n\n\t\tconst decorationTagLength = LEFT_TAG.length + RIGHT_TAG.length;\n\t\tconst newSelectionStart = textarea.selectionStart;\n\t\tconst newSelectionEnd = textarea.selectionEnd + decorationTagLength;\n\n\t\tconst textBefore = textarea.value.slice(0, textarea.selectionStart);\n\t\tconst selectedText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\n\t\tconst textAfter = textarea.value.slice(textarea.selectionEnd);\n\t\tconst textWithTag = `${textBefore}${LEFT_TAG}${selectedText}${RIGHT_TAG}${textAfter}`;\n\n\t\ttextarea.value = textWithTag;\n\t\ttextarea.selectionStart = newSelectionStart;\n\t\ttextarea.selectionEnd = newSelectionEnd;\n\n\t\treturn textWithTag;\n\t},\n\tremoveDecorationTag(textarea: HTMLTextAreaElement, decorationKey: 'b' | 'i' | 'u' | 's'): string\n\t{\n\t\tconst LEFT_TAG = `[${decorationKey}]`;\n\t\tconst RIGHT_TAG = `[/${decorationKey}]`;\n\n\t\tconst decorationTagLength = LEFT_TAG.length + RIGHT_TAG.length;\n\t\tconst newSelectionStart = textarea.selectionStart;\n\t\tconst newSelectionEnd = textarea.selectionEnd - decorationTagLength;\n\n\t\tconst textBefore = textarea.value.slice(0, textarea.selectionStart);\n\n\t\tconst textInTagStart = textarea.selectionStart + LEFT_TAG.length;\n\t\tconst textInTagEnd = textarea.selectionEnd - RIGHT_TAG.length;\n\t\tconst textInTag = textarea.value.slice(textInTagStart, textInTagEnd);\n\n\t\tconst textAfter = textarea.value.slice(textarea.selectionEnd);\n\t\tconst textWithoutTag = `${textBefore}${textInTag}${textAfter}`;\n\n\t\ttextarea.value = textWithoutTag;\n\t\ttextarea.selectionStart = newSelectionStart;\n\t\ttextarea.selectionEnd = newSelectionEnd;\n\n\t\treturn textWithoutTag;\n\t},\n\taddNewLine(textarea: HTMLTextAreaElement): string\n\t{\n\t\tconst newSelectionPosition = textarea.selectionStart + 1;\n\n\t\tconst textBefore = textarea.value.slice(0, textarea.selectionStart);\n\t\tconst textAfter = textarea.value.slice(textarea.selectionEnd);\n\t\tconst textWithNewLine = `${textBefore}${NEW_LINE}${textAfter}`;\n\n\t\ttextarea.value = textWithNewLine;\n\t\ttextarea.selectionStart = newSelectionPosition;\n\t\ttextarea.selectionEnd = newSelectionPosition;\n\n\t\treturn textWithNewLine;\n\t},\n\tinsertText(textarea: HTMLTextAreaElement, config: InsertTextConfig = {}): string\n\t{\n\t\tconst { text, withNewLine = false, replace = false } = config;\n\t\tlet resultText = '';\n\n\t\tif (replace)\n\t\t{\n\t\t\tresultText = '';\n\t\t\ttextarea.value = '';\n\t\t\ttextarea.selectionStart = 0;\n\t\t\ttextarea.selectionEnd = 0;\n\t\t}\n\n\t\tif (textarea.value.length === 0)\n\t\t{\n\t\t\tresultText = text;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresultText = withNewLine ? `${textarea.value}${NEW_LINE}${text}` : `${textarea.value} ${text}`;\n\t\t}\n\n\t\treturn resultText;\n\t},\n};\n"],"names":["EVENT_NAMESPACE","ResizeManager","EventEmitter","constructor","setEventNamespace","observeTextarea","element","observe","clientHeight","unobserveTextarea","unobserve","ResizeObserver","entries","forEach","entry","height","borderBoxSize","blockSize","Type","isNumber","emit","events","onHeightChange","newHeight","TAB","NEW_LINE","LETTER_CODE_PREFIX","Textarea","addTab","textarea","newSelectionPosition","selectionStart","textBefore","value","slice","textAfter","selectionEnd","textWithTab","removeTab","previousSymbol","textWithoutTab","handleDecorationTag","decorationKey","replace","toLowerCase","LEFT_TAG","RIGHT_TAG","selectedText","hasDecorationTag","startsWith","endsWith","removeDecorationTag","addDecorationTag","decorationTagLength","length","newSelectionStart","newSelectionEnd","textWithTag","textInTagStart","textInTagEnd","textInTag","textWithoutTag","addNewLine","textWithNewLine","insertText","config","text","withNewLine","resultText"],"mappings":"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"}