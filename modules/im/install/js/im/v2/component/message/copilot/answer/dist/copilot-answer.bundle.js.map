{"version":3,"file":"copilot-answer.bundle.js","sources":["../src/components/copilot-author-title.js","../src/copilot-answer.js"],"sourcesContent":["import { BitrixVue } from 'ui.vue3';\nimport { EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Core } from 'im.v2.application.core';\nimport { AuthorTitle } from 'im.v2.component.message.elements';\n\nimport './copilot-author-title.css';\n\n// @vue/component\nexport const CopilotAuthorTitle = BitrixVue.cloneComponent(AuthorTitle, {\n\tname: 'CopilotAuthorTitle',\n\tcomputed:\n\t{\n\t\tisCopilot(): boolean\n\t\t{\n\t\t\tconst authorId = Number.parseInt(this.authorDialogId, 10);\n\t\t\tconst copilotUserId = this.$store.getters['users/bots/getCopilotUserId'];\n\n\t\t\treturn copilotUserId === authorId;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonAuthorNameClick()\n\t\t{\n\t\t\tconst authorId = Number.parseInt(this.authorDialogId, 10);\n\t\t\tif (!authorId || authorId === Core.getUserId() || this.isCopilot)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.textarea.insertMention, {\n\t\t\t\tmentionText: this.user.name,\n\t\t\t\tmentionReplacement: Utils.text.getMentionBbCode(this.user.id, this.user.name),\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tv-if=\"showTitle\" \n\t\t\t@click=\"onAuthorNameClick\" \n\t\t\tclass=\"bx-im-message-copilot-author-title__container\"\n\t\t\t:class=\"{'--clickable': !isCopilot}\"\n\t\t>\n\t\t\t<ChatTitle\n\t\t\t\t:dialogId=\"authorDialogId\"\n\t\t\t\t:showItsYou=\"false\"\n\t\t\t\t:withColor=\"true\"\n\t\t\t\t:withLeftIcon=\"false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n});\n","import 'ui.notification';\nimport { Dom, Loc, Type } from 'main.core';\n\nimport { Parser } from 'im.v2.lib.parser';\nimport { BaseMessage } from 'im.v2.component.message.base';\nimport { DefaultMessageContent, MessageStatus } from 'im.v2.component.message.elements';\n\nimport { CopilotAuthorTitle } from './components/copilot-author-title';\n\nimport './css/copilot-answer.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const CopilotMessage = {\n\tname: 'CopilotMessage',\n\tcomponents: { CopilotAuthorTitle, BaseMessage, DefaultMessageContent, MessageStatus },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tformattedText(): string\n\t\t{\n\t\t\treturn Parser.decodeMessage(this.item);\n\t\t},\n\t\tcanSetReactions(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.message.id);\n\t\t},\n\t\tisReply(): boolean\n\t\t{\n\t\t\treturn this.message.replyId !== 0;\n\t\t},\n\t\tisError(): boolean\n\t\t{\n\t\t\treturn this.message.componentParams?.copilotError === true;\n\t\t},\n\t\twarningText(): string\n\t\t{\n\t\t\treturn this.loc(\n\t\t\t\t'IM_MESSAGE_COPILOT_ANSWER_WARNING',\n\t\t\t\t{\n\t\t\t\t\t'#LINK_START#': '<a class=\"bx-im-message-copilot-answer__warning_more\">',\n\t\t\t\t\t'#LINK_END#': '</a>',\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonCopyClick()\n\t\t{\n\t\t\tif (BX.clipboard?.copy(this.message.text))\n\t\t\t{\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('IM_MESSAGE_COPILOT_ANSWER_ACTION_COPY_SUCCESS'),\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonWarningDetailsClick(event: PointerEvent)\n\t\t{\n\t\t\tif (!Dom.hasClass(event.target, 'bx-im-message-copilot-answer__warning_more'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst ARTICLE_CODE = '20412666';\n\t\t\tBX.Helper?.show(`redirect=detail&code=${ARTICLE_CODE}`);\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BaseMessage :item=\"item\" :dialogId=\"dialogId\" class=\"bx-im-message-copilot-base-message__container\">\n\t\t\t<div class=\"bx-im-message-default__container bx-im-message-copilot-answer__container\" :class=\"{'--error': isError}\">\n\t\t\t\t<CopilotAuthorTitle v-if=\"withTitle\" :item=\"item\" />\n\t\t\t\t<div class=\"bx-im-message-default-content__container bx-im-message-default-content__scope\">\n\t\t\t\t\t<div class=\"bx-im-message-default-content__text\" v-html=\"formattedText\"></div>\n\t\t\t\t\t<div v-if=\"isError\" class=\"bx-im-message-default-content__bottom-panel\">\n\t\t\t\t\t\t<div class=\"bx-im-message-default-content__status-container\">\n\t\t\t\t\t\t\t<MessageStatus :item=\"message\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"!isError\" class=\"bx-im-message-copilot-answer__bottom-panel\">\n\t\t\t\t<div class=\"bx-im-message-copilot-answer__panel-content\">\n\t\t\t\t\t<button\n\t\t\t\t\t\t:title=\"loc('IM_MESSAGE_COPILOT_ANSWER_ACTION_COPY')\"\n\t\t\t\t\t\t@click=\"onCopyClick\"\n\t\t\t\t\t\tclass=\"bx-im-message-copilot-answer__copy_icon\"\n\t\t\t\t\t></button>\n\t\t\t\t\t<span \n\t\t\t\t\t\tv-html=\"warningText\"\n\t\t\t\t\t\t@click=\"onWarningDetailsClick\"\n\t\t\t\t\t\tclass=\"bx-im-message-copilot-answer__warning\"\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-message-default-content__status-container\">\n\t\t\t\t\t<MessageStatus :item=\"message\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BaseMessage>\n\t`,\n};\n"],"names":["CopilotAuthorTitle","BitrixVue","cloneComponent","AuthorTitle","name","computed","isCopilot","authorId","Number","parseInt","authorDialogId","copilotUserId","$store","getters","methods","onAuthorNameClick","Core","getUserId","EventEmitter","emit","EventType","textarea","insertMention","mentionText","user","mentionReplacement","Utils","text","getMentionBbCode","id","template","CopilotMessage","components","BaseMessage","DefaultMessageContent","MessageStatus","props","item","type","Object","required","dialogId","String","withTitle","Boolean","default","message","formattedText","Parser","decodeMessage","canSetReactions","Type","isNumber","isReply","replyId","isError","componentParams","copilotError","warningText","loc","onCopyClick","BX","clipboard","copy","UI","Notification","Center","notify","content","Loc","getMessage","onWarningDetailsClick","event","Dom","hasClass","target","ARTICLE_CODE","Helper","show","phraseCode","replacements","$Bitrix"],"mappings":"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"}