(function(){"use strict";BX.namespace("BX.Landing.UI.Field");var e=BX.Landing.Utils.isFunction;var t=BX.Landing.Utils.isPlainObject;var n=BX.Landing.Utils.bind;var i=BX.Landing.Utils.proxy;var a=BX.Landing.Utils.escapeHtml;var s=BX.Landing.Utils.addClass;var l=BX.Landing.Utils.clone;BX.Landing.UI.Field.Font=function(l){BX.Landing.UI.Field.BaseField.apply(this,arguments);s(this.layout,"landing-ui-field-font");this.value=l.value;this.headlessMode=l.headlessMode===true;this.frame=l.frame;this.items=[];if(t(l.items)){var o=Object.keys(this.items);this.items=o.map(function(e){return{name:this.items[e],value:e}},this)}this.onChangeHandler=e(l.onChange)?l.onChange:function(){};this.onValueChangeHandler=e(l.onValueChange)?l.onValueChange:function(){};if(this.value){this.content=a(this.value.family);this.input.innerHTML=this.value.family}else{this.content=a(this.content);this.input.innerHTML=this.content}if(this.frame){var r=this.frame.document.querySelectorAll(this.selector)[0];if(r){var h=BX.style(r,"font-family");if(h){h=h.replace(/['|"]/g,"");this.content=h.split(",")[0];this.input.innerHTML=this.content}}}n(this.input,"click",i(this.onInputClick,this))};function o(e){return"g-font-"+e.toLowerCase().replace(/ /g,"-")}BX.Landing.UI.Field.Font.prototype={constructor:BX.Landing.UI.Field.Font,__proto__:BX.Landing.UI.Field.BaseField.prototype,onInputClick:function(e){e.preventDefault();e.stopPropagation();BX.Landing.UI.Panel.GoogleFonts.getInstance().show().then(function(e){if(!this.response){this.response=l(BX.Landing.UI.Panel.GoogleFonts.getInstance().response);this.response.forEach(function(e){this.items.push({name:e.family,value:o(e.family)})},this)}this.setValue(e)}.bind(this))},setValue:function(e){if(t(e)){var n=o(e.family);var i=e.family.replace(/ /g,"+");var s=BX.Landing.UI.Panel.GoogleFonts.getInstance().client.makeUrl({family:i});if(this.headlessMode){this.value={family:e.family,public:"https://fonts.google.com/specimen/"+i,uri:s};this.input.innerHTML=a(e.family);this.emit("onChange")}else{var l=BX.Landing.UI.Tool.FontManager.getInstance();l.addFont({className:n,family:e.family,href:s,category:e.category},window);this.input.innerHTML=a(e.family);this.onChangeHandler(n,this.items,this.postfix,this.property);this.onValueChangeHandler(this);l.removeUnusedFonts();var r="";l.getUsedLoadedFonts().forEach(function(e){if(e.element){e.element.setAttribute("rel","stylesheet");e.element.removeAttribute("media");r+="<noscript>"+e.element.outerHTML+"</noscript>\n";e.element.setAttribute("rel","preload");e.element.setAttribute("onload","this.removeAttribute('onload');this.rel='stylesheet'");e.element.setAttribute("as","style");r+=e.element.outerHTML+"\n"}if(e.CSSDeclaration){r+=e.CSSDeclaration.outerHTML}});r=r.replace("async@load","all").replace(/data-loadcss="true"/g,"");BX.Landing.Backend.getInstance().action("Landing::updateHead",{content:r})}}},getValue:function(){return this.value}}})();
//# sourceMappingURL=font_field.map.js