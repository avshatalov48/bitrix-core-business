{"version":3,"file":"v2.bundle.js","sources":["../src/components/header/members/selector.js","../src/components/header/members/single-member.js","../src/components/header/members.js","../src/components/header/role-heading.js","../src/components/layout/cell-layout.js","../src/components/layout/column-layout.js","../src/components/header/roles-control.js","../src/components/util/sync-horizontal-scroll.js","../src/components/header.js","../src/components/searchbox.js","../src/utils.js","../src/store/model/access-rights-model.js","../src/components/util/selected-hint.js","../src/components/section/icon.js","../src/components/section/column/cell/dependent-variables/popup-header.js","../src/components/section/column/cell/dependent-variables/popup-content.js","../src/components/section/column/cell/dependent-variables.js","../src/integration/entity-selector/footer.js","../src/components/section/column/cell/multivariables.js","../src/components/section/column/cell/toggler.js","../src/components/section/column/cell/variables.js","../src/components/section/column/cell/registry.js","../src/components/section/column/value-cell.js","../src/components/section/column.js","../src/integration/hint/hint-locator.js","../src/components/util/hint.js","../src/components/section/header.js","../src/components/section/title-column/title-cell.js","../src/components/section/title-column.js","../src/components/section.js","../src/components/grid.js","../src/store/model/application-model.js","../src/store/model/user-groups-model.js","../src/store/index.js","../src/store/model/transformation/backend-exporter/user-groups/base-user-groups-exporter.js","../src/store/model/transformation/backend-exporter/user-groups/all-user-groups-exporter.js","../src/store/model/transformation/backend-exporter/user-groups/only-changed-user-groups-exporter.js","../src/store/model/transformation/internalizer/access-rights-internalizer.js","../src/store/model/transformation/internalizer/application-internalizer.js","../src/store/model/transformation/internalizer/user-groups-internalizer.js","../src/store/model/transformation/shown-user-groups-copier.js","../src/app.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { Dialog, type Item, type ItemId } from 'ui.entity-selector';\n\nexport const Selector = {\n\tname: 'Selector',\n\temits: ['close'],\n\tprops: {\n\t\tuserGroup: {\n\t\t\t/** @type UserGroup */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tbindNode: {\n\t\t\ttype: HTMLElement,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tselectedItems(): ItemId[] {\n\t\t\tconst result = [];\n\t\t\tfor (const accessCode of this.userGroup.members.keys())\n\t\t\t{\n\t\t\t\tresult.push(this.getItemIdByAccessCode(accessCode));\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\t(new Dialog({\n\t\t\tenableSearch: true,\n\t\t\tcontext: 'ui.accessrights.v2~member-selector',\n\t\t\talwaysShowLabels: true,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\temailUsers: false,\n\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\tinviteGuestLink: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tselectMode: 'usersAndDepartments',\n\t\t\t\t\t\tallowSelectRootDepartment: true,\n\t\t\t\t\t\tallowFlatDepartments: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'project',\n\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\taddProjectMetaUsers: true,\n\t\t\t\t\t},\n\t\t\t\t\titemOptions: {\n\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\tlink: '',\n\t\t\t\t\t\t\tlinkTitle: '',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'site-groups',\n\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\tdynamicSearch: true,\n\t\t\t\t},\n\t\t\t],\n\t\t\ttargetNode: this.bindNode,\n\t\t\tpreselectedItems: this.selectedItems,\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': this.onMemberAdd,\n\t\t\t\t'Item:onDeselect': this.onMemberRemove,\n\t\t\t\tonHide: () => {\n\t\t\t\t\tthis.$emit('close');\n\t\t\t\t},\n\t\t\t},\n\t\t})).show();\n\t},\n\tmethods: {\n\t\t// eslint-disable-next-line sonarjs/cognitive-complexity\n\t\tgetItemIdByAccessCode(accessCode: string): ItemId {\n\t\t\tif (/^I?U(\\d+)$/.test(accessCode))\n\t\t\t{\n\t\t\t\tconst match = accessCode.match(/^I?U(\\d+)$/) || null;\n\t\t\t\tconst userId = match ? match[1] : null;\n\n\t\t\t\treturn ['user', userId];\n\t\t\t}\n\n\t\t\tif (/^DR(\\d+)$/.test(accessCode))\n\t\t\t{\n\t\t\t\tconst match = accessCode.match(/^DR(\\d+)$/) || null;\n\t\t\t\tconst departmentId = match ? match[1] : null;\n\n\t\t\t\treturn ['department', departmentId];\n\t\t\t}\n\n\t\t\tif (/^D(\\d+)$/.test(accessCode))\n\t\t\t{\n\t\t\t\tconst match = accessCode.match(/^D(\\d+)$/) || null;\n\t\t\t\tconst departmentId = match ? match[1] : null;\n\n\t\t\t\treturn ['department', `${departmentId}:F`];\n\t\t\t}\n\n\t\t\tif (/^G(\\d+)$/.test(accessCode))\n\t\t\t{\n\t\t\t\tconst match = accessCode.match(/^G(\\d+)$/) || null;\n\t\t\t\tconst groupId = match ? match[1] : null;\n\n\t\t\t\treturn ['site-groups', groupId];\n\t\t\t}\n\n\t\t\tif (/^SG(\\d+)_([AEK])$/.test(accessCode))\n\t\t\t{\n\t\t\t\tconst match = accessCode.match(/^SG(\\d+)_([AEK])$/) || null;\n\n\t\t\t\tconst projectId = match ? match[1] : null;\n\t\t\t\tconst postfix = match ? match[2] : null;\n\n\t\t\t\treturn ['project', `${projectId}:${postfix}`];\n\t\t\t}\n\n\t\t\treturn ['unknown', accessCode];\n\t\t},\n\t\tonMemberAdd(event: BaseEvent): void {\n\t\t\tconst member = this.getMemberFromEvent(event);\n\n\t\t\tthis.$store.dispatch('userGroups/addMember', {\n\t\t\t\tuserGroupId: this.userGroup.id,\n\t\t\t\taccessCode: member.id,\n\t\t\t\tmember,\n\t\t\t});\n\t\t},\n\t\tonMemberRemove(event: BaseEvent): void {\n\t\t\tconst member = this.getMemberFromEvent(event);\n\n\t\t\tthis.$store.dispatch('userGroups/removeMember', {\n\t\t\t\tuserGroupId: this.userGroup.id,\n\t\t\t\taccessCode: member.id,\n\t\t\t});\n\t\t},\n\t\tgetMemberFromEvent(event: BaseEvent): ?Member {\n\t\t\tconst { item } = event.getData();\n\n\t\t\treturn {\n\t\t\t\tid: this.getAccessCodeByItem(item),\n\t\t\t\ttype: this.getMemberTypeByItem(item),\n\t\t\t\tname: item.title.text,\n\t\t\t\tavatar: Type.isStringFilled(item.avatar) ? item.avatar : null,\n\t\t\t};\n\t\t},\n\t\t// eslint-disable-next-line sonarjs/cognitive-complexity\n\t\tgetAccessCodeByItem(item: Item): string {\n\t\t\tconst entityId = item.entityId;\n\n\t\t\tif (entityId === 'user')\n\t\t\t{\n\t\t\t\treturn `U${item.id}`;\n\t\t\t}\n\n\t\t\tif (entityId === 'department')\n\t\t\t{\n\t\t\t\tif (Type.isString(item.id) && item.id.endsWith(':F'))\n\t\t\t\t{\n\t\t\t\t\tconst match = item.id.match(/^(\\d+):F$/);\n\t\t\t\t\tconst originalId = match ? match[1] : null;\n\n\t\t\t\t\t// only members of the department itself\n\t\t\t\t\treturn `D${originalId}`;\n\t\t\t\t}\n\n\t\t\t\t// whole department recursively\n\t\t\t\treturn `DR${item.id}`;\n\t\t\t}\n\n\t\t\tif (entityId === 'site-groups')\n\t\t\t{\n\t\t\t\treturn `G${item.id}`;\n\t\t\t}\n\n\t\t\tif (entityId === 'project')\n\t\t\t{\n\t\t\t\tconst subType = item.customData.get('metauser');\n\t\t\t\tconst originalId = item.customData.get('projectId');\n\t\t\t\tif (subType === 'owner')\n\t\t\t\t{\n\t\t\t\t\treturn `SG${originalId}_A`;\n\t\t\t\t}\n\n\t\t\t\tif (subType === 'moderator')\n\t\t\t\t{\n\t\t\t\t\treturn `SG${originalId}_E`;\n\t\t\t\t}\n\n\t\t\t\tif (subType === 'all')\n\t\t\t\t{\n\t\t\t\t\treturn `SG${originalId}_K`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn '';\n\t\t},\n\t\tgetMemberTypeByItem(item: Item): string {\n\t\t\tswitch (item.entityId)\n\t\t\t{\n\t\t\t\tcase 'user':\n\t\t\t\t\treturn 'users';\n\t\t\t\tcase 'intranet':\n\t\t\t\tcase 'department':\n\t\t\t\t\treturn 'departments';\n\t\t\t\tcase 'socnetgroup':\n\t\t\t\tcase 'project':\n\t\t\t\t\treturn 'sonetgroups';\n\t\t\t\tcase 'group':\n\t\t\t\t\treturn 'groups';\n\t\t\t\tcase 'site-groups':\n\t\t\t\t\treturn 'usergroups';\n\t\t\t\tdefault:\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t},\n\t// just a template stub\n\ttemplate: '<div hidden></div>',\n};\n","import type { Member } from '../../../store/model/user-groups-model';\n\nexport const SingleMember = {\n\tname: 'SingleMember',\n\tprops: {\n\t\tmember: {\n\t\t\t/** @type Member */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tavatarBackgroundImage(): string {\n\t\t\treturn `url(${encodeURI(this.member.avatar)})`;\n\t\t},\n\t\tnoAvatarClass(): string {\n\t\t\tif (this.member.type === 'groups')\n\t\t\t{\n\t\t\t\treturn 'ui-icon-common-user-group';\n\t\t\t}\n\n\t\t\tif (this.member.type === 'sonetgroups' || this.member.type === 'departments')\n\t\t\t{\n\t\t\t\treturn 'ui-icon-common-company';\n\t\t\t}\n\n\t\t\tif (this.member.type === 'usergroups')\n\t\t\t{\n\t\t\t\treturn 'ui-icon-common-user-group';\n\t\t\t}\n\n\t\t\treturn 'ui-icon-common-user';\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class='ui-access-rights-v2-members-item'>\n\t\t\t<a v-if=\"member.avatar\" class='ui-access-rights-v2-members-item-avatar' :title=\"member.name\" :style=\"{\n\t\t\t\tbackgroundImage: avatarBackgroundImage,\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t}\"></a>\n\t\t\t<a v-else class='ui-icon ui-access-rights-v2-members-item-icon' :class=\"noAvatarClass\" :title=\"member.name\">\n\t\t\t\t<i></i>\n\t\t\t</a>\n\t\t</div>\n\t`,\n};\n","import type { MemberCollection } from '../../store/model/user-groups-model';\nimport { Selector } from './members/selector';\nimport { SingleMember } from './members/single-member';\n\nconst MAX_SHOWN_MEMBERS = 5;\n\nexport const Members = {\n\tname: 'Members',\n\tcomponents: { SingleMember, Selector },\n\tprops: {\n\t\tuserGroup: {\n\t\t\t/** @type UserGroup */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tisSelectorShown: false,\n\t\t\tisSelectedMembersPopupShown: false,\n\t\t};\n\t},\n\tpopup: null,\n\tcomputed: {\n\t\tshownMembers(): MemberCollection\n\t\t{\n\t\t\tif (this.userGroup.members.size <= MAX_SHOWN_MEMBERS)\n\t\t\t{\n\t\t\t\treturn this.userGroup.members;\n\t\t\t}\n\n\t\t\tconst shownKeyValuePairs = [...this.userGroup.members].slice(0, MAX_SHOWN_MEMBERS);\n\n\t\t\treturn new Map(shownKeyValuePairs);\n\t\t},\n\t\tnotShownMembersCount(): number\n\t\t{\n\t\t\tif (this.userGroup.members.size > MAX_SHOWN_MEMBERS)\n\t\t\t{\n\t\t\t\treturn this.userGroup.members.size - MAX_SHOWN_MEMBERS;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t},\n\t\tbindNode(): HTMLElement\n\t\t{\n\t\t\treturn this.$refs.container;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div ref=\"container\" class=\"ui-access-rights-v2-members-container\"  @click=\"isSelectorShown = true\">\n\t\t\t<div v-if=\"userGroup.members.size > 0\" class='ui-access-rights-v2-members'>\n\t\t\t\t<SingleMember v-for=\"[accessCode, member] in shownMembers\" :key=\"accessCode\" :member=\"member\"/>\n\t\t\t\t<span v-if=\"notShownMembersCount > 0\" class=\"ui-access-rights-v2-members-more\">\n\t\t\t\t\t+ {{ notShownMembersCount }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass='ui-access-rights-v2-members-item ui-access-rights-v2-members-item-add'\n\t\t\t\t:class=\"{\n\t\t\t\t\t'--show-always': userGroup.members.size <= 0,\n\t\t\t\t\t'--has-siblings': userGroup.members.size > 0,\n\t\t\t\t}\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-icon-set --plus-30\"></div>\n\t\t\t</div>\n\t\t\t<Selector\n\t\t\t\tv-if=\"isSelectorShown\"\n\t\t\t\t:user-group=\"userGroup\"\n\t\t\t\t:bind-node=\"bindNode\"\n\t\t\t\t@close=\"isSelectorShown = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Event } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Button, ButtonColor, ButtonSize, CancelButton } from 'ui.buttons';\nimport { RichMenuItem, RichMenuItemIcon, RichMenuPopup } from 'ui.vue3.components.rich-menu';\nimport { mapGetters, mapState } from 'ui.vue3.vuex';\n\nexport const RoleHeading = {\n\tname: 'RoleHeading',\n\tcomponents: { RichMenuPopup, RichMenuItem },\n\tprops: {\n\t\tuserGroup: {\n\t\t\t/** @type UserGroup */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tisEdit: false,\n\t\t\tisPopupShown: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tRichMenuItemIcon: () => RichMenuItemIcon,\n\t\t...mapState({\n\t\t\tisSaving: (state) => state.application.isSaving,\n\t\t\tguid: (state) => state.application.guid,\n\t\t\tmaxVisibleUserGroups: (state) => state.application.options.maxVisibleUserGroups,\n\t\t}),\n\t\t...mapGetters({\n\t\t\tisMaxVisibleUserGroupsReached: 'userGroups/isMaxVisibleUserGroupsReached',\n\t\t\tisMaxValueSet: 'accessRights/isMaxValueSet',\n\t\t\tisMinValueSet: 'accessRights/isMinValueSet',\n\t\t}),\n\t\ttitle: {\n\t\t\tget(): string {\n\t\t\t\treturn this.userGroup.title;\n\t\t\t},\n\t\t\tset(title: string): void {\n\t\t\t\tthis.$store.dispatch('userGroups/setRoleTitle', {\n\t\t\t\t\tuserGroupId: this.userGroup.id,\n\t\t\t\t\ttitle,\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t},\n\twatch: {\n\t\tisEdit(newValue): void {\n\t\t\tif (newValue === true)\n\t\t\t{\n\t\t\t\tthis.bindClickedOutsideHandler();\n\n\t\t\t\tvoid this.$nextTick(() => {\n\t\t\t\t\tthis.$refs.input.scrollIntoView({\n\t\t\t\t\t\tbehavior: 'smooth',\n\t\t\t\t\t\tblock: 'nearest',\n\t\t\t\t\t\tinline: 'nearest',\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.$refs.input.focus();\n\t\t\t\t\tthis.$refs.input.select();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.unbindClickedOutsideHandler();\n\t\t\t}\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\t// todo fix hide/show new role\n\t\tif (this.userGroup.isNew)\n\t\t{\n\t\t\t// start editing a newly created role right away\n\t\t\tthis.isEdit = true;\n\t\t}\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.unbindClickedOutsideHandler();\n\t},\n\tmethods: {\n\t\tbindClickedOutsideHandler(): void {\n\t\t\tEvent.bind(window, 'click', this.turnOffEditWhenClickedOutside, {\n\t\t\t\tcapture: true,\n\t\t\t});\n\t\t},\n\t\tunbindClickedOutsideHandler(): void {\n\t\t\tEvent.unbind(window, 'click', this.turnOffEditWhenClickedOutside, {\n\t\t\t\tcapture: true,\n\t\t\t});\n\t\t},\n\t\tturnOffEditWhenClickedOutside(event: PointerEvent): void {\n\t\t\tif (event.target !== this.$refs.input)\n\t\t\t{\n\t\t\t\tthis.isEdit = false;\n\t\t\t}\n\t\t},\n\t\tshowDeleteConfirmation(): void {\n\t\t\tconst popup = new Popup({\n\t\t\t\tbindElement: this.$refs.container,\n\t\t\t\twidth: 250,\n\t\t\t\toverlay: true,\n\t\t\t\tcontentPadding: 10,\n\t\t\t\tcontent: this.$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_POPUP_REMOVE_ROLE'),\n\t\t\t\tclassName: 'ui-access-rights-v2-text-center',\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t\tcacheable: false,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew Button({\n\t\t\t\t\t\ttext: this.$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_POPUP_REMOVE_ROLE_YES'),\n\t\t\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\tthis.$store.dispatch('userGroups/removeUserGroup', {\n\t\t\t\t\t\t\t\t\tuserGroupId: this.userGroup.id,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew CancelButton({\n\t\t\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tpopup.show();\n\t\t},\n\t\tshowActionsMenu(): void {\n\t\t\tif (!this.isSaving)\n\t\t\t{\n\t\t\t\tthis.isPopupShown = true;\n\t\t\t}\n\t\t},\n\t\tonSetMaxValuesClick(): void {\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tthis.$store.dispatch('userGroups/setMaxAccessRightValuesForUserGroup', {\n\t\t\t\tuserGroupId: this.userGroup.id,\n\t\t\t});\n\t\t},\n\t\tonSetMinValuesClick(): void {\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tthis.$store.dispatch('userGroups/setMinAccessRightValuesForUserGroup', {\n\t\t\t\tuserGroupId: this.userGroup.id,\n\t\t\t});\n\t\t},\n\t\tonEnableEditClick(): void {\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tthis.isEdit = true;\n\t\t},\n\t\tonCopyRoleClick(): void {\n\t\t\tif (this.isMaxVisibleUserGroupsReached)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tthis.$store.dispatch('userGroups/copyUserGroup', { userGroupId: this.userGroup.id });\n\t\t},\n\t\tonDeleteRoleClick(): void {\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tthis.showDeleteConfirmation();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div ref=\"container\" class='ui-access-rights-v2-role'>\n\t\t\t<div class=\"ui-access-rights-v2-role-value-container\">\n\t\t\t\t<input\n\t\t\t\t\tv-if=\"isEdit && !isSaving\"\n\t\t\t\t\tref=\"input\"\n\t\t\t\t\ttype='text'\n\t\t\t\t\tclass='ui-access-rights-v2-role-input'\n\t\t\t\t\tv-model=\"title\"\n\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_NAME')\"\n\t\t\t\t\t@keydown.enter=\"isEdit = false\"\n\t\t\t\t/>\n\t\t\t\t<div v-else class='ui-access-rights-v2-role-value' :title=\"title\">{{ title }}</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tref=\"menu\"\n\t\t\t\tclass=\"ui-icon-set --more ui-access-rights-v2-role-menu\" \n\t\t\t\t@click=\"showActionsMenu\"\n\t\t\t>\n\t\t\t\t<RichMenuPopup v-if=\"isPopupShown\" @close=\"isPopupShown = false\" :popup-options=\"{bindElement: $refs.menu}\">\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\tv-if=\"isMaxValueSet\"\n\t\t\t\t\t\t:icon=\"RichMenuItemIcon.check\"\n\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MAX_ACCESS_RIGHTS')\"\n\t\t\t\t\t\t:subtitle=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MAX_ACCESS_RIGHTS_SUBTITLE')\"\n\t\t\t\t\t\t@click=\"onSetMaxValuesClick\"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\tv-if=\"isMinValueSet\"\n\t\t\t\t\t\t:icon=\"RichMenuItemIcon['red-lock']\"\n\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MIN_ACCESS_RIGHTS')\"\n\t\t\t\t\t\t:subtitle=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MIN_ACCESS_RIGHTS_SUBTITLE')\"\n\t\t\t\t\t\t@click=\"onSetMinValuesClick\"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t:icon=\"RichMenuItemIcon.pencil\"\n\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_RENAME')\"\n\t\t\t\t\t\t:subtitle=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_RENAME_SUBTITLE')\"\n\t\t\t\t\t\t@click=\"onEnableEditClick\"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t:icon=\"RichMenuItemIcon.copy\"\n\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY')\"\n\t\t\t\t\t\t:subtitle=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY_ROLE_SUBTITLE')\"\n\t\t\t\t\t\t:disabled=\"isMaxVisibleUserGroupsReached\"\n\t\t\t\t\t\t:hint=\"\n\t\t\t\t\t\t\tisMaxVisibleUserGroupsReached\n\t\t\t\t\t\t\t\t? $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_COPYING_DISABLED', {\n\t\t\t\t\t\t\t\t\t'#COUNT#': maxVisibleUserGroups,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\"\n\t\t\t\t\t\t@click=\"onCopyRoleClick\"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t:icon=\"RichMenuItemIcon['trash-bin']\"\n\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_REMOVE')\"\n\t\t\t\t\t\t:subtitle=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_REMOVE_SUBTITLE')\"\n\t\t\t\t\t\t@click=\"onDeleteRoleClick\"\n\t\t\t\t\t/>\n\t\t\t\t</RichMenuPopup>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","export const CellLayout = {\n\ttemplate: `\n\t\t<div class='ui-access-rights-v2-column-item'>\n\t\t\t<slot/>\n\t\t</div>\n\t`,\n};\n","export const ColumnLayout = {\n\ttemplate: `\n\t\t<div class='ui-access-rights-v2-column'>\n\t\t\t<slot/>\n\t\t</div>\n\t`,\n};\n","import { type BaseEvent } from 'main.core.event';\nimport { Dialog, type ItemOptions } from 'ui.entity-selector';\nimport { RichMenuItem, RichMenuItemIcon, RichMenuPopup } from 'ui.vue3.components.rich-menu';\nimport { mapGetters, mapState } from 'ui.vue3.vuex';\nimport type { UserGroup } from '../../store/model/user-groups-model';\nimport { CellLayout } from '../layout/cell-layout';\nimport { ColumnLayout } from '../layout/column-layout';\nimport '../../css/header/roles-control.css';\n\nexport const RolesControl = {\n\tname: 'RolesControl',\n\tcomponents: { CellLayout, ColumnLayout, RichMenuPopup, RichMenuItem },\n\tprops: {\n\t\tuserGroups: {\n\t\t\ttype: Map,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tviewDialog: null,\n\tcomputed: {\n\t\tRichMenuItemIcon: () => RichMenuItemIcon,\n\t\t...mapState({\n\t\t\tallUserGroups: (state) => state.userGroups.collection,\n\t\t\tmaxVisibleUserGroups: (state) => state.application.options.maxVisibleUserGroups,\n\t\t\tguid: (state) => state.application.guid,\n\t\t}),\n\t\t...mapGetters({\n\t\t\tisMaxVisibleUserGroupsSet: 'application/isMaxVisibleUserGroupsSet',\n\t\t\tisMaxVisibleUserGroupsReached: 'userGroups/isMaxVisibleUserGroupsReached',\n\t\t}),\n\t\tshownGroupsCounter(): string {\n\t\t\treturn this.$Bitrix.Loc.getMessage(\n\t\t\t\t'JS_UI_ACCESSRIGHTS_V2_ROLE_COUNTER',\n\t\t\t\t{\n\t\t\t\t\t'#VISIBLE_ROLES#': this.userGroups.size,\n\t\t\t\t\t'#ALL_ROLES#': this.allUserGroups.size,\n\t\t\t\t\t'#GREY_START#': '<span style=\"opacity: var(--ui-opacity-30)\">',\n\t\t\t\t\t'#GREY_FINISH#': '</span>',\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tcopyDialogItems(): ItemOptions[] {\n\t\t\tconst result: ItemOptions[] = [];\n\n\t\t\tfor (const userGroup: UserGroup of this.allUserGroups.values())\n\t\t\t{\n\t\t\t\tresult.push({\n\t\t\t\t\tid: userGroup.id,\n\t\t\t\t\tentityId: 'accessrights-user-group',\n\t\t\t\t\ttitle: userGroup.title || this.$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_NAME'),\n\t\t\t\t\ttabs: [\n\t\t\t\t\t\t'recents',\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tviewDialogItems(): ItemOptions[] {\n\t\t\tconst result: ItemOptions[] = [];\n\n\t\t\tfor (const copyDialogItem of this.copyDialogItems)\n\t\t\t{\n\t\t\t\tresult.push({\n\t\t\t\t\t...copyDialogItem,\n\t\t\t\t\tselected: this.userGroups.has(copyDialogItem.id),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tisPopupShown: false,\n\t\t};\n\t},\n\tmethods: {\n\t\tonCreateNewRoleClick(): void {\n\t\t\tif (this.isMaxVisibleUserGroupsReached)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tthis.$store.dispatch('userGroups/addUserGroup');\n\t\t},\n\t\tonRoleViewClick(): void {\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tthis.showViewDialog(this.$refs.configure);\n\t\t},\n\t\tonCopyRoleClick(): void {\n\t\t\tif (this.isMaxVisibleUserGroupsReached)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tthis.showCopyDialog();\n\t\t},\n\t\tshowCopyDialog(): void {\n\t\t\tconst copyDialog = new Dialog({\n\t\t\t\tcontext: 'ui.accessrights.v2~role-selector',\n\t\t\t\ttargetNode: this.$refs.configure,\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tenableSearch: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tshowAvatars: false,\n\t\t\t\titems: this.copyDialogItems,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (dialogEvent: BaseEvent) => {\n\t\t\t\t\t\tconst { item } = dialogEvent.getData();\n\n\t\t\t\t\t\tthis.$store.dispatch('userGroups/copyUserGroup', { userGroupId: item.getId() });\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tcopyDialog.show();\n\t\t},\n\t\tshowViewDialog(target: HTMLElement): void {\n\t\t\tthis.viewDialog = new Dialog({\n\t\t\t\tcontext: 'ui.accessrights.v2~role-selector',\n\t\t\t\tfooter: this.isMaxVisibleUserGroupsSet ? this.$Bitrix.Loc.getMessage(\n\t\t\t\t\t'JS_UI_ACCESSRIGHTS_V2_ROLE_SELECTOR_MAX_VISIBLE_WARNING',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#COUNT#': this.maxVisibleUserGroups,\n\t\t\t\t\t},\n\t\t\t\t) : null,\n\t\t\t\ttargetNode: target,\n\t\t\t\tmultiple: true,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tenableSearch: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tshowAvatars: false,\n\t\t\t\titems: this.viewDialogItems,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onBeforeSelect': (dialogEvent: BaseEvent) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tthis.isMaxVisibleUserGroupsSet\n\t\t\t\t\t\t\t&& this.viewDialog.getSelectedItems().length >= this.maxVisibleUserGroups\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdialogEvent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onSelect': (dialogEvent: BaseEvent) => {\n\t\t\t\t\t\tconst { item } = dialogEvent.getData();\n\n\t\t\t\t\t\tthis.$store.dispatch('userGroups/showUserGroup', { userGroupId: item.getId() });\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onDeselect': (dialogEvent: BaseEvent) => {\n\t\t\t\t\t\tconst { item } = dialogEvent.getData();\n\n\t\t\t\t\t\tthis.$store.dispatch('userGroups/hideUserGroup', { userGroupId: item.getId() });\n\t\t\t\t\t},\n\t\t\t\t\tonHide: () => {\n\t\t\t\t\t\tthis.viewDialog = null;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.viewDialog.show();\n\t\t},\n\t\ttoggleViewDialog(target: HTMLElement): void {\n\t\t\tif (this.viewDialog)\n\t\t\t{\n\t\t\t\tthis.viewDialog.hide();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showViewDialog(target);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ColumnLayout v-memo=\"[shownGroupsCounter]\">\n\t\t\t<CellLayout class=\"ui-access-rights-v2-header-roles-control\">\n\t\t\t\t<div class='ui-access-rights-v2-column-item-text ui-access-rights-v2-header-roles-control-header'>\n\t\t\t\t\t<div>{{ $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLES') }}</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref=\"configure\"\n\t\t\t\t\t\tclass=\"ui-icon-set --more ui-access-rights-v2-role-menu\"\n\t\t\t\t\t\t@click=\"isPopupShown = true\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<RichMenuPopup v-if=\"isPopupShown\" @close=\"isPopupShown = false\" :popup-options=\"{bindElement: $refs.configure}\">\n\t\t\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t\t\t:icon=\"RichMenuItemIcon.role\"\n\t\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_NEW_ROLE')\"\n\t\t\t\t\t\t\t\t:subtitle=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_NEW_ROLE_SUBTITLE')\"\n\t\t\t\t\t\t\t\t:disabled=\"isMaxVisibleUserGroupsReached\"\n\t\t\t\t\t\t\t\t:hint=\"\n\t\t\t\t\t\t\t\t\tisMaxVisibleUserGroupsReached\n\t\t\t\t\t\t\t\t\t\t? $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_ADDING_DISABLED', {\n\t\t\t\t\t\t\t\t\t\t\t'#COUNT#': maxVisibleUserGroups,\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t@click=\"onCreateNewRoleClick\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t\t\t:icon=\"RichMenuItemIcon.copy\"\n\t\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY_ROLE')\"\n\t\t\t\t\t\t\t\t:subtitle=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY_ROLE_SUBTITLE')\"\n\t\t\t\t\t\t\t\t:disabled=\"isMaxVisibleUserGroupsReached\"\n\t\t\t\t\t\t\t\t:hint=\"\n\t\t\t\t\t\t\t\t\tisMaxVisibleUserGroupsReached\n\t\t\t\t\t\t\t\t\t\t? $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_COPYING_DISABLED', {\n\t\t\t\t\t\t\t\t\t\t\t'#COUNT#': maxVisibleUserGroups,\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t@click=\"onCopyRoleClick\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t\t\t:icon=\"RichMenuItemIcon['opened-eye']\"\n\t\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_VIEW')\"\n\t\t\t\t\t\t\t\t:subtitle=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_VIEW_SUBTITLE')\"\n\t\t\t\t\t\t\t\t@click=\"onRoleViewClick\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</RichMenuPopup>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-access-rights-v2-header-roles-control-actions\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref=\"counter\"\n\t\t\t\t\t\tclass=\"ui-access-rights-v2-header-roles-control-counter\"\n\t\t\t\t\t\t@click=\"toggleViewDialog($refs.counter)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-icon-set --opened-eye\" style=\"--ui-icon-set__icon-size: 15px;\"></div>\n\t\t\t\t\t\t<span v-html=\"shownGroupsCounter\"></span>\n\t\t\t\t\t\t<div class=\"ui-icon-set --chevron-down ui-access-rights-v2-header-roles-control-chevron\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-access-rights-v2-header-roles-control-expander\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"ui-icon-set --collapse\"\n\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COLLAPSE_ALL_SECTIONS')\"\n\t\t\t\t\t\t\t@click=\"$store.dispatch('accessRights/collapseAllSections')\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass=\"ui-icon-set --expand-1\"\n\t\t\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_EXPAND_ALL_SECTIONS')\"\n\t\t\t\t\t\t\t@click=\"$store.dispatch('accessRights/expandAllSections')\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</CellLayout>\n\t\t</ColumnLayout>\n\t`,\n};\n","import { Text } from 'main.core';\nimport { type BaseEvent } from 'main.core.events';\nimport { mapState } from 'ui.vue3.vuex';\n\nconst isMaxListenersSet: Map<string, boolean> = new Map();\nconst lastScrollLeft: Map<string, number> = new Map();\n\n/**\n * A div without styling that synchronizes horizontal scroll of all elements wrapped in this component with other\n * wrapped elements in this Vue application.\n */\nexport const SyncHorizontalScroll = {\n\tname: 'SyncHorizontalScroll',\n\tdata(): Object {\n\t\treturn {\n\t\t\tcomponentGuid: Text.getRandom(16),\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapState({\n\t\t\tguid: (state) => state.application.guid,\n\t\t}),\n\t},\n\tthrottledEmitScrollEvent: null,\n\tcreated()\n\t{\n\t\tthis.throttledEmitScrollEvent = requestAnimationFrameThrottle(this.emitScrollEvent);\n\t},\n\tmounted(): void {\n\t\tif (!isMaxListenersSet.has(this.guid))\n\t\t{\n\t\t\t// + 1 for header\n\t\t\tconst sectionsNumber = this.$store.state.accessRights.collection.size + 1;\n\n\t\t\t// correctly notify about memory leak\n\t\t\tthis.$Bitrix.eventEmitter.incrementMaxListeners('ui:accessrights:v2:syncScroll', sectionsNumber);\n\n\t\t\tisMaxListenersSet.set(this.guid, true);\n\t\t}\n\n\t\tthis.$Bitrix.eventEmitter.subscribe('ui:accessrights:v2:syncScroll', this.handleScrollEvent);\n\n\t\tvoid this.$nextTick(() => {\n\t\t\tif (lastScrollLeft.has(this.guid))\n\t\t\t{\n\t\t\t\tthis.syncScroll(lastScrollLeft.get(this.guid));\n\t\t\t}\n\t\t});\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.$Bitrix.eventEmitter.unsubscribe('ui:accessrights:v2:syncScroll', this.handleScrollEvent);\n\t},\n\tmethods: {\n\t\temitScrollEvent(event): void {\n\t\t\t// this component instance is being scrolled, we need to notify other instances\n\t\t\tconst { scrollLeft, scrollWidth, clientWidth, offsetWidth } = event.target;\n\n\t\t\tconst scrollLeftOffset = scrollWidth - clientWidth;\n\t\t\tconst scrollBarWidth = offsetWidth - clientWidth;\n\n\t\t\tif (scrollLeftOffset > scrollBarWidth)\n\t\t\t{\n\t\t\t\tlastScrollLeft.set(this.guid, scrollLeft);\n\n\t\t\t\t// emit global application event so other SyncHorizontalScroll instances receive it\n\t\t\t\tthis.$Bitrix.eventEmitter.emit('ui:accessrights:v2:syncScroll', {\n\t\t\t\t\tscrollLeft,\n\t\t\t\t\tcomponentGuid: this.componentGuid,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\thandleScrollEvent(event: BaseEvent): void {\n\t\t\tconst { scrollLeft, componentGuid } = event.getData();\n\t\t\tif (this.componentGuid === componentGuid)\n\t\t\t{\n\t\t\t\t// this event was sent by this exact instance\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.syncScroll(scrollLeft);\n\t\t},\n\t\tsyncScroll(scrollLeft: number): void {\n\t\t\t// magic hack - don't update the element if value not changed.\n\t\t\t// I'm not sure whether this works, but why not\n\t\t\tif (this.$el.scrollLeft !== scrollLeft)\n\t\t\t{\n\t\t\t\tthis.$el.scrollLeft = scrollLeft;\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div @scroll=\"throttledEmitScrollEvent\">\n\t\t\t<slot/>\n\t\t</div>\n\t`,\n};\n\n/**\n * Same as `Runtime.throttle`, but uses `requestAnimationFrame` instead of setTimeout.\n * Why? To sync wait time with display refresh rate for smother animations.\n */\nfunction requestAnimationFrameThrottle(func: Function): Function\n{\n\tlet callbackSet = false;\n\tlet invoke = false;\n\n\treturn function wrapper(...args)\n\t{\n\t\tinvoke = true;\n\n\t\tif (!callbackSet)\n\t\t{\n\t\t\tconst q = function q()\n\t\t\t{\n\t\t\t\tif (invoke)\n\t\t\t\t{\n\t\t\t\t\tfunc(...args);\n\t\t\t\t\tinvoke = false;\n\t\t\t\t\trequestAnimationFrame(q);\n\t\t\t\t\tcallbackSet = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcallbackSet = false;\n\t\t\t\t}\n\t\t\t};\n\t\t\tq();\n\t\t}\n\t};\n}\n","import { Members } from './header/members';\nimport { RoleHeading } from './header/role-heading';\nimport { RolesControl } from './header/roles-control';\nimport { CellLayout } from './layout/cell-layout';\nimport { ColumnLayout } from './layout/column-layout';\nimport { SyncHorizontalScroll } from './util/sync-horizontal-scroll';\n\n/**\n * A special case of Section\n */\nexport const Header = {\n\tname: 'Header',\n\tcomponents: { RoleHeading, SyncHorizontalScroll, Members, RolesControl, ColumnLayout, CellLayout },\n\tprops: {\n\t\tuserGroups: {\n\t\t\ttype: Map,\n\t\t\trequired: true,\n\t\t},\n\t},\n\t// data attributes are needed for e2e automated tests\n\ttemplate: `\n\t\t<div class=\"ui-access-rights-v2-section ui-access-rights-v2--head-section\">\n\t\t\t<div class='ui-access-rights-v2-section-container'>\n\t\t\t\t<div class='ui-access-rights-v2-section-head'>\n\t\t\t\t\t<RolesControl :user-groups=\"userGroups\"/>\n\t\t\t\t</div>\n\t\t\t\t<div class='ui-access-rights-v2-section-content'>\n\t\t\t\t\t<SyncHorizontalScroll class='ui-access-rights-v2-section-wrapper'>\n\t\t\t\t\t\t<ColumnLayout\n\t\t\t\t\t\t\tv-for=\"[groupId, group] in userGroups\" \n\t\t\t\t\t\t\t:key=\"groupId\"\n\t\t\t\t\t\t\t:data-accessrights-user-group-id=\"groupId\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CellLayout class=\"ui-access-rights-v2-header-role-cell\">\n\t\t\t\t\t\t\t\t<RoleHeading :user-group=\"group\"/>\n\t\t\t\t\t\t\t\t<Members :user-group=\"group\"/>\n\t\t\t\t\t\t\t</CellLayout>\n\t\t\t\t\t\t</ColumnLayout>\n\t\t\t\t\t</SyncHorizontalScroll>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Runtime } from 'main.core';\n\nexport const SearchBox = {\n\tname: 'SearchBox',\n\tdebouncedSetSearchQuery: null,\n\tcreated()\n\t{\n\t\tconst setSearchQuery = (query) => {\n\t\t\tthis.$store.dispatch('accessRights/search', { query });\n\t\t};\n\n\t\tthis.debouncedSetSearchQuery = Runtime.debounce(setSearchQuery, 200);\n\t},\n\tcomputed: {\n\t\tsearchQuery: {\n\t\t\tget(): string {\n\t\t\t\treturn this.$store.state.accessRights.searchQuery;\n\t\t\t},\n\t\t\tset(query: string): void {\n\t\t\t\tthis.debouncedSetSearchQuery(query);\n\t\t\t},\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-round\">\n\t\t\t<input\n\t\t\t\ttype=\"text\"\n\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox\"\n\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SEARCH_PLACEHOLDER')\"\n\t\t\t\tv-model=\"searchQuery\"\n\t\t\t>\n\t\t\t<a class=\"ui-ctl-after ui-ctl-icon-search\"></a>\n\t\t</div>\n\t`,\n};\n","import { Loc, Text, Type } from 'main.core';\nimport type { AccessRightItem, Variable, VariableCollection } from './store/model/access-rights-model';\n\nexport function shouldRowBeRendered(accessRightItem: AccessRightItem): boolean\n{\n\tif (!accessRightItem.isShown)\n\t{\n\t\treturn false;\n\t}\n\n\treturn !accessRightItem.group || accessRightItem.isGroupExpanded;\n}\n\nexport function getMultipleSelectedVariablesTitle(selectedVariables: VariableCollection): string\n{\n\tconst lastVariable: Variable = [...selectedVariables.values()].pop();\n\n\tif (selectedVariables.size === 1)\n\t{\n\t\treturn cutLongTitle(lastVariable.title);\n\t}\n\n\treturn Loc.getMessage(\n\t\t'JS_UI_ACCESSRIGHTS_V2_HAS_SELECTED_ITEMS',\n\t\t{\n\t\t\t'#FIRST_ITEM_NAME#': cutLongTitle(lastVariable.title),\n\t\t\t'#COUNT_REST_ITEMS#': selectedVariables.size - 1,\n\t\t},\n\t);\n}\n\nfunction cutLongTitle(title: string): string\n{\n\tconst VARIABLE_TITLE_MAX_LENGTH = 15;\n\n\tif (title.length > VARIABLE_TITLE_MAX_LENGTH)\n\t{\n\t\treturn `${title.slice(0, VARIABLE_TITLE_MAX_LENGTH)}...`;\n\t}\n\n\treturn title;\n}\n\nexport function getMultipleSelectedVariablesHintHtml(\n\tselectedVariables: VariableCollection,\n\thintTitle: string,\n\tallVariables: VariableCollection,\n): string\n{\n\tif (selectedVariables.size < 2)\n\t{\n\t\treturn '';\n\t}\n\n\tlet listItems = '';\n\tfor (const value of makeSortedVariablesArray(selectedVariables, allVariables))\n\t{\n\t\tlistItems += `<li>${Text.encode(value.title)}</li>`;\n\t}\n\n\treturn `\n\t\t<p>${Text.encode(hintTitle)}</p>\n\t\t<ul>${listItems}</ul>\n\t`;\n}\n\nfunction makeSortedVariablesArray(toSort: VariableCollection, example: VariableCollection): Variable[]\n{\n\tconst orderMap = new Map();\n\n\tlet index = 0;\n\tfor (const [variableId] of example)\n\t{\n\t\torderMap.set(variableId, index);\n\n\t\tindex++;\n\t}\n\n\treturn [...toSort.values()].sort((a, b) => {\n\t\tconst indexA = orderMap.get(a.id);\n\t\tconst indexB = orderMap.get(b.id);\n\n\t\tif (Type.isNil(indexA))\n\t\t{\n\t\t\treturn 1;\n\t\t}\n\n\t\tif (Type.isNil(indexB))\n\t\t{\n\t\t\treturn -1;\n\t\t}\n\n\t\treturn indexA - indexB;\n\t});\n}\n\nexport const DEFAULT_ALIAS_SEPARATOR = '|';\n\nexport function parseAliasKey(key: string, separator = DEFAULT_ALIAS_SEPARATOR): Set<string>\n{\n\tconst parts = key.split(separator);\n\n\treturn new Set(parts);\n}\n\nexport function compileAliasKey(parts: Set<string>, separator = DEFAULT_ALIAS_SEPARATOR): string\n{\n\tconst sortedParts = [...parts].sort();\n\n\treturn sortedParts.join(separator);\n}\n\nexport function normalizeAliasKey(key: string, separator = DEFAULT_ALIAS_SEPARATOR): string\n{\n\tconst parsed = parseAliasKey(key, separator);\n\n\treturn compileAliasKey(parsed, separator);\n}\n","import { Runtime, Type } from 'main.core';\nimport { type ActionTree, BuilderModel, GetterTree, type MutationTree } from 'ui.vue3.vuex';\nimport { compileAliasKey } from '../../utils';\n\nexport type AccessRightsState = {\n\tcollection: AccessRightsCollection,\n\tsearchQuery: string,\n}\n\nexport type AccessRightsCollection = Map<string, AccessRightSection>;\n\nexport type AccessRightSection = {\n\tsectionTitle: string,\n\tsectionSubTitle: ?string,\n\tsectionCode: string, // not sent to backend, frontend uses it only for indexing\n\tsectionHint: ?string,\n\tsectionIcon?: AccessRightSectionIcon,\n\trights: Map<string, AccessRightItem>,\n\tisExpanded: boolean,\n\tisShown: boolean,\n};\n\nexport type AccessRightSectionIcon = {\n\ttype: string, // icon name from 'ui.icon-set'\n\tbgColor: string, // hex or --ui-color-palette-* variable name\n};\n\nexport type AccessRightItem = {\n\tid: string,\n\ttype: string,\n\ttitle: string,\n\thint: ?string, // hint for row title in the title column\n\tgroup: ?string, // id of parent item id\n\tgroupHead: boolean,\n\tisGroupExpanded: ?boolean, // only for group head and grouped items\n\tisShown: boolean,\n\tminValue?: Set<string>,\n\tmaxValue?: Set<string>,\n\tdefaultValue?: Set<string>,\n\temptyValue?: Set<string>,\n\tsetEmptyOnGroupActions?: boolean,\n\n\tvariables: VariableCollection, // options to choose from in variable-like controls\n\n\t// only for multivariable\n\tallSelectedCode: ?string,\n\tselectedVariablesAliases: Map<string, string>,\n\tselectedVariablesAliasesSeparator: ?string,\n\tenableSearch?: boolean,\n\tshowAvatars?: boolean,\n\tcompactView?: boolean,\n\tdisableSelectAll?: boolean,\n\thintTitle: ?string, // title for 'already selected values' hint in multivariable and dependent-variables selector\n};\n\nexport type VariableCollection = Map<string, Variable>;\n\nexport type Variable = {\n\tid: string,\n\ttitle: string,\n\t// used only in multivariable selector\n\tentityId: ?string,\n\tsupertitle: ?string,\n\tavatar: ?string,\n\tavatarOptions: ?Object,\n\tselectionStrategy?: 'mutually-exclusive', // can perform some action after this option was selected\n\t// used only in dependent-variables\n\tconflictsWith?: Set<string>,\n\trequires?: Set<string>,\n\tsecondary: ?boolean, // switcher color and size for dependent-variables\n}\n\nexport class AccessRightsModel extends BuilderModel\n{\n\t#initialRights: AccessRightsCollection = new Map();\n\n\tgetName(): string\n\t{\n\t\treturn 'accessRights';\n\t}\n\n\tsetInitialAccessRights(rights: AccessRightsCollection): AccessRightsModel\n\t{\n\t\tthis.#initialRights = rights;\n\n\t\treturn this;\n\t}\n\n\tgetState(): AccessRightsState\n\t{\n\t\treturn {\n\t\t\tcollection: Runtime.clone(this.#initialRights),\n\t\t\tsearchQuery: '',\n\t\t};\n\t}\n\n\tgetElementState(params = {}): AccessRightSection\n\t{\n\t\tthrow new Error('Cant create AccessRightSection. You are doing something wrong');\n\t}\n\n\tgetGetters(): GetterTree<AccessRightsState>\n\t{\n\t\treturn {\n\t\t\tshown: (state): AccessRightsCollection => {\n\t\t\t\tconst result = new Map();\n\n\t\t\t\tfor (const [sectionCode, section] of state.collection)\n\t\t\t\t{\n\t\t\t\t\tif (section.isShown)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.set(sectionCode, section);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tisMinValueSet: (state): boolean => {\n\t\t\t\tfor (const section of state.collection.values())\n\t\t\t\t{\n\t\t\t\t\tfor (const item of section.rights.values())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!Type.isNil(item.minValue))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tisMaxValueSet: (state): boolean => {\n\t\t\t\tfor (const section of state.collection.values())\n\t\t\t\t{\n\t\t\t\t\tfor (const item of section.rights.values())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!Type.isNil(item.maxValue))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tgetEmptyValue: (state) => (sectionCode: string, valueId: string): Set<string> => {\n\t\t\t\tconst item = state.collection.get(sectionCode)?.rights.get(valueId);\n\n\t\t\t\tif (item?.type === 'toggler')\n\t\t\t\t{\n\t\t\t\t\tconst isFalsy = !item.emptyValue || !item.emptyValue[0];\n\t\t\t\t\tif (isFalsy)\n\t\t\t\t\t{\n\t\t\t\t\t\t// use explicit '0' for correctly identify modifications\n\t\t\t\t\t\treturn new Set(['0']);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn item.emptyValue ?? new Set();\n\t\t\t},\n\t\t\tgetSelectedVariablesAlias: (state) => (sectionCode: string, valueId: string, values: Set<string>): ?string => {\n\t\t\t\tconst item = state.collection.get(sectionCode)?.rights.get(valueId);\n\t\t\t\tif (!item)\n\t\t\t\t{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst key = compileAliasKey(values, item.selectedVariablesAliasesSeparator);\n\n\t\t\t\treturn item.selectedVariablesAliases.get(key);\n\t\t\t},\n\t\t};\n\t}\n\n\tgetActions(): ActionTree<AccessRightsState>\n\t{\n\t\treturn {\n\t\t\ttoggleSection: (store, { sectionCode }): void => {\n\t\t\t\tif (!store.state.collection.has(sectionCode))\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('ui.accessrights.v2: Attempt to toggle section that dont exists', { sectionCode });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('toggleSection', { sectionCode });\n\t\t\t},\n\t\t\texpandAllSections: (store): void => {\n\t\t\t\tfor (const sectionCode of store.state.collection.keys())\n\t\t\t\t{\n\t\t\t\t\tstore.commit('expandSection', { sectionCode });\n\t\t\t\t}\n\t\t\t},\n\t\t\tcollapseAllSections: (store): void => {\n\t\t\t\tfor (const sectionCode of store.state.collection.keys())\n\t\t\t\t{\n\t\t\t\t\tstore.commit('collapseSection', { sectionCode });\n\t\t\t\t}\n\t\t\t},\n\t\t\ttoggleGroup: (store, { sectionCode, groupId }): void => {\n\t\t\t\tconst item = store.state.collection.get(sectionCode)?.rights.get(groupId);\n\t\t\t\tif (!item)\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('ui.accessrights.v2: Attempt to toggle group that dont exists', { groupId });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!item.groupHead)\n\t\t\t\t{\n\t\t\t\t\tconsole.warn('ui.accessrights.v2: Attempt to toggle group that is not group head', { groupId });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('toggleGroup', { sectionCode, groupId });\n\t\t\t},\n\t\t\tsearch: (store, payload): void => {\n\t\t\t\tthis.#searchAction(store, payload);\n\t\t\t},\n\t\t};\n\t}\n\n\t#searchAction(store, { query }): void\n\t{\n\t\tif (!Type.isString(query))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: attempt to search with non-string search query');\n\n\t\t\treturn;\n\t\t}\n\n\t\tstore.commit('setSearchQuery', { query });\n\t\tif (query === '')\n\t\t{\n\t\t\tstore.commit('showAll');\n\n\t\t\treturn;\n\t\t}\n\n\t\tstore.commit('hideAll');\n\n\t\tconst lowerQuery = query.toLowerCase();\n\n\t\tfor (const section: AccessRightSection of store.state.collection.values())\n\t\t{\n\t\t\tif (\n\t\t\t\tsection.sectionTitle.toLowerCase().includes(lowerQuery)\n\t\t\t\t|| section.sectionSubTitle?.toLowerCase().includes(lowerQuery)\n\t\t\t)\n\t\t\t{\n\t\t\t\tstore.commit('showSection', { sectionCode: section.sectionCode });\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (const item: AccessRightItem of section.rights.values())\n\t\t\t{\n\t\t\t\tif (!item.title.toLowerCase().includes(lowerQuery))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (item.groupHead)\n\t\t\t\t{\n\t\t\t\t\tstore.commit('showGroup', { sectionCode: section.sectionCode, groupId: item.id });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstore.commit('showItem', { sectionCode: section.sectionCode, itemId: item.id });\n\t\t\t\t\tif (item.group)\n\t\t\t\t\t{\n\t\t\t\t\t\tstore.commit('expandGroup', { sectionCode: section.sectionCode, groupId: item.group });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetMutations(): MutationTree<AccessRightsState>\n\t{\n\t\treturn {\n\t\t\ttoggleSection: (state, { sectionCode }): void => {\n\t\t\t\tconst section = state.collection.get(sectionCode);\n\n\t\t\t\tsection.isExpanded = !section.isExpanded;\n\t\t\t},\n\t\t\texpandSection: (state, { sectionCode }): void => {\n\t\t\t\tconst section = state.collection.get(sectionCode);\n\n\t\t\t\tsection.isExpanded = true;\n\t\t\t},\n\t\t\tcollapseSection: (state, { sectionCode }): void => {\n\t\t\t\tconst section = state.collection.get(sectionCode);\n\n\t\t\t\tsection.isExpanded = false;\n\t\t\t},\n\t\t\ttoggleGroup: (state, { sectionCode, groupId }): void => {\n\t\t\t\tconst section = state.collection.get(sectionCode);\n\n\t\t\t\tfor (const item of section.rights.values())\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\t(item.id === groupId && item.groupHead)\n\t\t\t\t\t\t|| item.group === groupId\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\titem.isGroupExpanded = !item.isGroupExpanded;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\texpandGroup: (state, { sectionCode, groupId }): void => {\n\t\t\t\tconst section = state.collection.get(sectionCode);\n\n\t\t\t\tsection.isExpanded = true;\n\n\t\t\t\tfor (const item of section.rights.values())\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\t(item.id === groupId && item.groupHead)\n\t\t\t\t\t\t|| item.group === groupId\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\titem.isGroupExpanded = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowItem: (state, { sectionCode, itemId }): void => {\n\t\t\t\tconst section = state.collection.get(sectionCode);\n\t\t\t\tsection.isShown = true;\n\n\t\t\t\tconst item = section.rights.get(itemId);\n\t\t\t\titem.isShown = true;\n\t\t\t\tif (item.group)\n\t\t\t\t{\n\t\t\t\t\tsection.rights.get(item.group).isShown = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowGroup: (state, { sectionCode, groupId }): void => {\n\t\t\t\tconst section = state.collection.get(sectionCode);\n\n\t\t\t\tsection.isShown = true;\n\n\t\t\t\tfor (const item of section.rights.values())\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\t(item.id === groupId && item.groupHead)\n\t\t\t\t\t\t|| item.group === groupId\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\titem.isShown = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowSection: (state, { sectionCode }): void => {\n\t\t\t\tconst section = state.collection.get(sectionCode);\n\t\t\t\tsection.isShown = true;\n\t\t\t\tfor (const item of section.rights.values())\n\t\t\t\t{\n\t\t\t\t\titem.isShown = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\tshowAll: (state): void => {\n\t\t\t\tfor (const section of state.collection.values())\n\t\t\t\t{\n\t\t\t\t\tsection.isShown = true;\n\t\t\t\t\tfor (const item of section.rights.values())\n\t\t\t\t\t{\n\t\t\t\t\t\titem.isShown = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\thideAll: (state): void => {\n\t\t\t\tfor (const section of state.collection.values())\n\t\t\t\t{\n\t\t\t\t\tsection.isShown = false;\n\t\t\t\t\tfor (const item of section.rights.values())\n\t\t\t\t\t{\n\t\t\t\t\t\titem.isShown = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tsetSearchQuery: (state, { query }): void => {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tstate.searchQuery = String(query);\n\t\t\t},\n\t\t};\n\t}\n}\n","import { hint } from 'ui.vue3.directives.hint';\n\n/**\n * A special case of Hint. We don't need interactivity here, but we do need to wrap slot with a hint.\n * Combine these properties in a single vue hint wrapper is impossible.\n */\nexport const SelectedHint = {\n\tname: 'SelectedHint',\n\tprops: {\n\t\thtml: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tisRendered: true,\n\t\t};\n\t},\n\twatch: {\n\t\thtml(): void {\n\t\t\t// force hint directive to re-render\n\t\t\tthis.isRendered = false;\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.isRendered = true;\n\t\t\t});\n\t\t},\n\t},\n\tdirectives: {\n\t\thint,\n\t},\n\t// offsetTop is needed to fix infinite mouseenter/mouseleave loop in chromium. issue 204272\n\ttemplate: `\n\t\t<div v-if=\"isRendered\" v-hint=\"{\n\t\t\thtml,\n\t\t\tpopupOptions: {\n\t\t\t\toffsetTop: 3,\n\t\t\t},\n\t\t}\" data-hint-init=\"vue\">\n\t\t\t<slot/>\n\t\t</div>\n\t`,\n};\n","export const Icon = {\n\tname: 'Icon',\n\tinject: ['section'],\n\tcomputed: {\n\t\ticonBgColor(): string {\n\t\t\tif (this.section.sectionIcon.bgColor.startsWith('--'))\n\t\t\t{\n\t\t\t\t// css variable\n\t\t\t\treturn `var(${this.section.sectionIcon.bgColor})`;\n\t\t\t}\n\n\t\t\t// we assume its hex\n\t\t\treturn this.section.sectionIcon.bgColor;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"section.sectionIcon\" class=\"ui-access-rights-v2-section-header-icon\" :style=\"{\n\t\t\tbackgroundColor: iconBgColor,\n\t\t}\">\n\t\t\t<div class=\"ui-icon-set\" :class=\"'--' + section.sectionIcon.type\"></div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { Switcher } from 'ui.vue3.components.switcher';\nimport { Icon as SectionIcon } from '../../../icon';\nimport '../../../../../css/cell/dependent-variables/popup-header.css';\n\nexport const PopupHeader = {\n\tname: 'PopupHeader',\n\tcomponents: { Switcher, SectionIcon },\n\temits: ['setMax', 'setMin'],\n\tprops: {\n\t\t// later in a row menu here should be passed text 'All roles'\n\t\tuserGroupTitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tvalues: {\n\t\t\t/** @type Set<string> */\n\t\t\ttype: Set,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tinject: ['section', 'right'],\n\tcomputed: {\n\t\trightOrGroupTitle(): string {\n\t\t\tif (!this.right.group)\n\t\t\t{\n\t\t\t\treturn this.right.title;\n\t\t\t}\n\n\t\t\tconst groupHead = this.section.rights.get(this.right.group);\n\n\t\t\treturn groupHead?.title;\n\t\t},\n\t\tisMinMaxValuesSet(): boolean {\n\t\t\treturn !Type.isNil(this.right.minValue) && !Type.isNil(this.right.maxValue);\n\t\t},\n\t\tisSelectedAnythingBesidesMin(): boolean {\n\t\t\tif (this.values.size <= 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfor (const variableId of this.values)\n\t\t\t{\n\t\t\t\tif (!this.right.minValue.has(variableId))\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tswitcherOptions(): Object {\n\t\t\treturn {\n\t\t\t\tsize: 'small',\n\t\t\t\tcolor: 'green',\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-access-rights-v2-cell-popup-header\">\n\t\t\t<div class=\"ui-access-rights-v2-cell-popup-header-locator\">\n\t\t\t\t<SectionIcon/>\n\t\t\t\t<span\n\t\t\t\t\tclass=\"ui-access-rights-v2-text-ellipsis\"\n\t\t\t\t\t:title=\"section.sectionTitle\"\n\t\t\t\t>{{ section.sectionTitle }}</span>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"section.sectionSubTitle\" \n\t\t\t\t\tclass=\"ui-access-rights-v2-text-ellipsis\"\n\t\t\t\t\t:title=\"section.sectionSubTitle\"\n\t\t\t\t\tstyle=\"margin-left: 5px; color: var(--ui-color-palette-gray-70);\"\n\t\t\t\t>{{ section.sectionSubTitle }}</span>\n\t\t\t\t<div class=\"ui-icon-set --chevron-right ui-access-rights-v2-cell-popup-header-chevron\"></div>\n\t\t\t\t<template v-if=\"rightOrGroupTitle !== right.title\">\n\t\t\t\t\t<span class=\"ui-access-rights-v2-text-ellipsis\" :title=\"right.title\">{{ right.title }}</span>\n\t\t\t\t\t<div class=\"ui-icon-set --chevron-right ui-access-rights-v2-cell-popup-header-chevron\"></div>\n\t\t\t\t</template>\n\t\t\t\t<span class=\"ui-access-rights-v2-text-ellipsis\" :title=\"rightOrGroupTitle\">{{ rightOrGroupTitle }}</span>\n\t\t\t</div>\n\t\t\t<div class=\"ui-access-rights-v2-cell-popup-header-role-line\">\n\t\t\t\t<div class=\"ui-access-rights-v2-cell-popup-header-role-container\">\n\t\t\t\t\t<span class=\"ui-icon ui-icon-square ui-icon-xs ui-access-rights-v2-cell-popup-header-role-icon\">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"ui-access-rights-v2-cell-popup-header-role-caption\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"ui-access-rights-v2-cell-popup-header-role-title ui-access-rights-v2-text-ellipsis\"\n\t\t\t\t\t\t\t:title=\"userGroupTitle\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ userGroupTitle }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"isMinMaxValuesSet\" class=\"ui-access-rights-v2-cell-popup-header-toggle-container\">\n\t\t\t\t\t<span class=\"ui-access-rights-v2-cell-popup-header-toggle-caption\">{{\n\t\t\t\t\t\t$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ACCESS')\n\t\t\t\t\t}}</span>\n\t\t\t\t\t<Switcher\n\t\t\t\t\t\t:is-checked=\"isSelectedAnythingBesidesMin\"\n\t\t\t\t\t\t@check=\"$emit('setMax')\"\n\t\t\t\t\t\t@uncheck=\"$emit('setMin')\"\n\t\t\t\t\t\t:options=\"switcherOptions\"\n\t\t\t\t\t\tdata-accessrights-min-max\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Runtime, Type } from 'main.core';\nimport '../../../../../css/cell/dependent-variables/popup-content.css';\nimport 'ui.icon';\nimport 'ui.icon-set.actions';\nimport { ApplyButton, ButtonColor, CancelButton } from 'ui.buttons';\nimport { Switcher } from 'ui.vue3.components.switcher';\nimport type { Variable, VariableCollection } from '../../../../../store/model/access-rights-model';\nimport { PopupHeader } from './popup-header';\n\nexport const PopupContent = {\n\tname: 'PopupContent',\n\temits: ['close'],\n\tcomponents: { Switcher, PopupHeader },\n\tprops: {\n\t\t// value for selector is id of a selected variable\n\t\tvalue: {\n\t\t\t/** @type AccessRightValue */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\t// values modified during popup lifetime and not yet dispatched to store\n\t\t\tnotSavedValues: Runtime.clone(this.value.values),\n\t\t};\n\t},\n\tinject: ['section', 'userGroup', 'right'],\n\tcomputed: {\n\t\tisMinMaxValuesSet(): boolean {\n\t\t\treturn !Type.isNil(this.right.minValue) && !Type.isNil(this.right.maxValue);\n\t\t},\n\t\tvariablesShownInList(): VariableCollection {\n\t\t\tif (!this.isMinMaxValuesSet)\n\t\t\t{\n\t\t\t\treturn this.right.variables;\n\t\t\t}\n\n\t\t\tconst variablesWithoutMin: VariableCollection = Runtime.clone(this.right.variables);\n\t\t\tfor (const variableId of this.right.minValue)\n\t\t\t{\n\t\t\t\tvariablesWithoutMin.delete(variableId);\n\t\t\t}\n\n\t\t\tfor (const [variableId: string, variable: Variable] of variablesWithoutMin)\n\t\t\t{\n\t\t\t\tif (variable.secondary)\n\t\t\t\t{\n\t\t\t\t\tvariablesWithoutMin.delete(variableId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn variablesWithoutMin;\n\t\t},\n\t\tsecondaryVariables(): VariableCollection {\n\t\t\tconst result: VariableCollection = new Map();\n\n\t\t\tfor (const [variableId, variable] of this.right.variables)\n\t\t\t{\n\t\t\t\tif (variable.secondary)\n\t\t\t\t{\n\t\t\t\t\tresult.set(variableId, variable);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\temptyValues(): ?Set<string> {\n\t\t\treturn this.$store.getters['accessRights/getEmptyValue'](this.section.sectionCode, this.value.id);\n\t\t},\n\t\tswitcherOptions(): Object {\n\t\t\treturn {\n\t\t\t\tsize: 'small',\n\t\t\t\tcolor: 'primary',\n\t\t\t};\n\t\t},\n\t\tsecondarySwitcherOptions(): Object {\n\t\t\treturn {\n\t\t\t\tsize: 'extra-small',\n\t\t\t\tcolor: 'green',\n\t\t\t};\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tconst applyButton = new ApplyButton({\n\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\tonclick: () => {\n\t\t\t\tthis.apply();\n\t\t\t\tthis.$emit('close');\n\t\t\t},\n\t\t});\n\t\tapplyButton.renderTo(this.$refs['button-container']);\n\n\t\tconst cancelButton = new CancelButton({\n\t\t\tonclick: () => {\n\t\t\t\tthis.$emit('close');\n\t\t\t},\n\t\t});\n\t\tcancelButton.renderTo(this.$refs['button-container']);\n\t},\n\tmethods: {\n\t\taddValue(variableId: string): void {\n\t\t\tconst variable: ?Variable = this.right.variables.get(variableId);\n\t\t\tif (!variable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.notSavedValues.add(variableId);\n\n\t\t\tif (!Type.isNil(variable.requires))\n\t\t\t{\n\t\t\t\tfor (const requiredId of variable.requires)\n\t\t\t\t{\n\t\t\t\t\tthis.notSavedValues.add(requiredId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!Type.isNil(variable.conflictsWith))\n\t\t\t{\n\t\t\t\t// remove old variables that conflict with variable we want to add\n\t\t\t\tfor (const conflictId of variable.conflictsWith)\n\t\t\t\t{\n\t\t\t\t\tthis.notSavedValues.delete(conflictId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const otherVariable of this.right.variables.values())\n\t\t\t{\n\t\t\t\tif (otherVariable.id === variableId)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// if one of the current variables conflicts with newly added variables, we remove old variable\n\t\t\t\tif (this.notSavedValues.has(otherVariable.id) && !Type.isNil(otherVariable.conflictsWith))\n\t\t\t\t{\n\t\t\t\t\tfor (const conflictId of otherVariable.conflictsWith)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.notSavedValues.has(conflictId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.notSavedValues.delete(otherVariable.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tremoveValue(variableId: string): void {\n\t\t\tthis.notSavedValues.delete(variableId);\n\n\t\t\tfor (const otherVariableId of this.notSavedValues)\n\t\t\t{\n\t\t\t\tif (otherVariableId === variableId)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst otherVariable: ?Variable = this.right.variables.get(otherVariableId);\n\t\t\t\tif (!otherVariable)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (!Type.isNil(otherVariable.requires) && otherVariable.requires.has(variableId))\n\t\t\t\t{\n\t\t\t\t\tthis.notSavedValues.delete(otherVariableId);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsetMaxValue(): void {\n\t\t\tfor (const variableId of this.right.maxValue)\n\t\t\t{\n\t\t\t\tthis.addValue(variableId);\n\t\t\t}\n\t\t},\n\t\tsetMinValue(): void {\n\t\t\tfor (const variableId of this.right.minValue)\n\t\t\t{\n\t\t\t\tthis.addValue(variableId);\n\t\t\t}\n\t\t},\n\t\tapply(): void {\n\t\t\tlet values = this.notSavedValues;\n\t\t\tif (values.size <= 0)\n\t\t\t{\n\t\t\t\tvalues = this.emptyValues;\n\t\t\t}\n\n\t\t\tthis.$store.dispatch('userGroups/setAccessRightValues', {\n\t\t\t\tsectionCode: this.section.sectionCode,\n\t\t\t\tuserGroupId: this.userGroup.id,\n\t\t\t\tvalueId: this.value.id,\n\t\t\t\tvalues,\n\t\t\t});\n\t\t},\n\t},\n\t// data attributes are needed for e2e automated tests\n\ttemplate: `\n\t\t<div>\n\t\t\t<PopupHeader\n\t\t\t\t:values=\"notSavedValues\"\n\t\t\t\t:user-group-title=\"userGroup.title\" \n\t\t\t\t@set-max=\"setMaxValue\"\n\t\t\t\t@set-min=\"setMinValue\"\n\t\t\t/>\n\t\t\t<div class=\"ui-access-rights-v2-dv-popup--line-container\">\n\t\t\t\t<div \n\t\t\t\t\tv-for=\"[variableId, variable] in variablesShownInList\"\n\t\t\t\t\t:key=\"variableId\"\n\t\t\t\t\tclass=\"ui-access-rights-v2-dv-popup--line\"\n\t\t\t\t>\n\t\t\t\t\t<span class=\"ui-access-rights-v2-text-ellipsis\">{{ variable.title }}</span>\n\t\t\t\t\t<Switcher\n\t\t\t\t\t\t:is-checked=\"notSavedValues.has(variable.id)\"\n\t\t\t\t\t\t@check=\"addValue(variable.id)\"\n\t\t\t\t\t\t@uncheck=\"removeValue(variable.id)\"\n\t\t\t\t\t\t:options=\"switcherOptions\"\n\t\t\t\t\t\t:data-accessrights-variable-id=\"variable.id\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"[variableId, variable] in secondaryVariables\"\n\t\t\t\t\t:key=\"variableId\"\n\t\t\t\t\tclass=\"ui-access-rights-v2-dv-popup--line --secondary\"\n\t\t\t\t>\n\t\t\t\t\t<Switcher\n\t\t\t\t\t\t:is-checked=\"notSavedValues.has(variable.id)\"\n\t\t\t\t\t\t@check=\"addValue(variable.id)\"\n\t\t\t\t\t\t@uncheck=\"removeValue(variable.id)\"\n\t\t\t\t\t\t:options=\"secondarySwitcherOptions\"\n\t\t\t\t\t\tstyle=\"padding-right: 5px;\"\n\t\t\t\t\t\t:data-accessrights-variable-id=\"variable.id\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"ui-access-rights-v2-text-ellipsis\">{{ variable.title }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div ref=\"button-container\" class=\"ui-access-rights-v2-dv-popup--buttons\"></div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport type { PopupOptions } from 'main.popup';\nimport { Popup } from 'ui.vue3.components.popup';\nimport type { VariableCollection } from '../../../../store/model/access-rights-model';\nimport { getMultipleSelectedVariablesHintHtml, getMultipleSelectedVariablesTitle } from '../../../../utils';\nimport { SelectedHint } from './../../../util/selected-hint';\nimport { PopupContent } from './dependent-variables/popup-content';\n\nexport const DependentVariables = {\n\tname: 'DependentVariables',\n\tcomponents: { Popup, PopupContent, SelectedHint },\n\tprops: {\n\t\t// value for selector is id of a selected variable\n\t\tvalue: {\n\t\t\t/** @type AccessRightValue */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object {\n\t\treturn {\n\t\t\tisPopupShown: false,\n\t\t};\n\t},\n\tinject: ['section', 'right'],\n\tcomputed: {\n\t\tselectedVariables(): VariableCollection {\n\t\t\tconst selected = new Map();\n\n\t\t\tfor (const [variableId, variable] of this.right.variables)\n\t\t\t{\n\t\t\t\tif (this.value.values.has(variableId))\n\t\t\t\t{\n\t\t\t\t\tselected.set(variableId, variable);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn selected;\n\t\t},\n\t\tcurrentAlias(): ?string {\n\t\t\treturn this.$store.getters['accessRights/getSelectedVariablesAlias'](this.section.sectionCode, this.value.id, this.value.values);\n\t\t},\n\t\ttitle(): string {\n\t\t\tif (Type.isString(this.currentAlias))\n\t\t\t{\n\t\t\t\treturn this.currentAlias;\n\t\t\t}\n\n\t\t\tif (this.selectedVariables.size <= 0)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ADD');\n\t\t\t}\n\n\t\t\treturn getMultipleSelectedVariablesTitle(this.selectedVariables);\n\t\t},\n\t\thintHtml(): string {\n\t\t\treturn getMultipleSelectedVariablesHintHtml(this.selectedVariables, this.hintTitle, this.right.variables);\n\t\t},\n\t\thintTitle(): string {\n\t\t\tif (Type.isString(this.right.hintTitle))\n\t\t\t{\n\t\t\t\treturn this.right.hintTitle;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SELECTED_ITEMS_TITLE');\n\t\t},\n\t\tpopupOptions(): PopupOptions {\n\t\t\treturn {\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseEsc: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tminWidth: 466,\n\t\t\t\tpadding: 18,\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class='ui-access-rights-v2-column-item-text-link' :class=\"{\n\t\t\t'ui-access-rights-v2-text-ellipsis': !hintHtml\n\t\t}\" @click=\"isPopupShown = true\">\n\t\t\t<SelectedHint v-if=\"hintHtml\" :html=\"hintHtml\">{{title}}</SelectedHint>\n\t\t\t<div v-else :title=\"title\">{{title}}</div>\n\t\t\t<Popup v-if=\"isPopupShown\" @close=\"isPopupShown = false\" :options=\"popupOptions\">\n\t\t\t\t<PopupContent \n\t\t\t\t\t@close=\"isPopupShown = false\"\n\t\t\t\t\t:value=\"value\"\n\t\t\t\t/>\n\t\t\t</Popup>\n\t\t</div>\n\t`,\n};\n","import { Dom, Event, Loc, Tag } from 'main.core';\nimport { DefaultFooter, Dialog, Item } from 'ui.entity-selector';\n\nexport default class Footer extends DefaultFooter\n{\n\tconstructor(dialog: Dialog, options: { [option: string]: any })\n\t{\n\t\tsuper(dialog, options);\n\n\t\tthis.selectAllButton = Tag.render`<div class=\"ui-selector-footer-link ui-selector-search-footer-label--hide\">${\n\t\t\tLoc.getMessage('JS_UI_ACCESSRIGHTS_V2_ALL_SELECT_LABEL')\n\t\t}</div>`;\n\t\tEvent.bind(this.selectAllButton, 'click', this.selectAll.bind(this));\n\t\tthis.deselectAllButton = Tag.render`<div class=\"ui-selector-footer-link ui-selector-search-footer-label--hide\">${\n\t\t\tLoc.getMessage('JS_UI_ACCESSRIGHTS_V2_ALL_DESELECT_LABEL')\n\t\t}</div>`;\n\t\tEvent.bind(this.deselectAllButton, 'click', this.deselectAll.bind(this));\n\n\t\tthis.getDialog().subscribe('Item:onSelect', this.onItemStatusChange.bind(this));\n\t\tthis.getDialog().subscribe('Item:onDeselect', this.onItemStatusChange.bind(this));\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tthis.toggleSelectButtons();\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-selector-search-footer-box\">\n\t\t\t\t${this.selectAllButton}\n\t\t\t\t${this.deselectAllButton}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\ttoggleSelectButtons(): void\n\t{\n\t\tif (this.getDialog().getSelectedItems().length === this.getDialog().getItems().length)\n\t\t{\n\t\t\tif (Dom.hasClass(this.deselectAllButton, 'ui-selector-search-footer-label--hide'))\n\t\t\t{\n\t\t\t\tDom.addClass(this.selectAllButton, 'ui-selector-search-footer-label--hide');\n\t\t\t\tDom.removeClass(this.deselectAllButton, 'ui-selector-search-footer-label--hide');\n\t\t\t}\n\t\t}\n\t\telse if (Dom.hasClass(this.selectAllButton, 'ui-selector-search-footer-label--hide'))\n\t\t{\n\t\t\tDom.addClass(this.deselectAllButton, 'ui-selector-search-footer-label--hide');\n\t\t\tDom.removeClass(this.selectAllButton, 'ui-selector-search-footer-label--hide');\n\t\t}\n\t}\n\n\tselectAll(): void\n\t{\n\t\tif (this.getDialog().getSelectedItems().length === this.getDialog().getItems().length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis\n\t\t\t.getDialog()\n\t\t\t.getItems()\n\t\t\t.forEach((item: Item) => {\n\t\t\t\titem.select();\n\t\t\t})\n\t\t;\n\t}\n\n\tdeselectAll(): void\n\t{\n\t\tthis\n\t\t\t.getDialog()\n\t\t\t.getSelectedItems()\n\t\t\t.forEach((item: Item) => {\n\t\t\t\titem.deselect();\n\t\t\t})\n\t\t;\n\t}\n\n\tonItemStatusChange(): void\n\t{\n\t\tthis.toggleSelectButtons();\n\t}\n}\n","import { Runtime, Type } from 'main.core';\nimport type { BaseEvent } from 'main.core.events';\nimport { Dialog, type Item, type ItemOptions } from 'ui.entity-selector';\nimport Footer from '../../../../integration/entity-selector/footer';\nimport type { Variable, VariableCollection } from '../../../../store/model/access-rights-model';\nimport { getMultipleSelectedVariablesHintHtml, getMultipleSelectedVariablesTitle } from '../../../../utils';\nimport { SelectedHint } from './../../../util/selected-hint';\n\nexport const Multivariables = {\n\tname: 'Multivariables',\n\tcomponents: {\n\t\tSelectedHint,\n\t},\n\tprops: {\n\t\t// value for selector is id of a selected variable\n\t\tvalue: {\n\t\t\t/** @type AccessRightValue */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tinject: ['section', 'userGroup', 'right'],\n\tcomputed: {\n\t\tisAllSelected(): boolean {\n\t\t\treturn this.value.values.has(this.right.allSelectedCode);\n\t\t},\n\t\tselectedVariables(): VariableCollection {\n\t\t\tif (this.isAllSelected)\n\t\t\t{\n\t\t\t\treturn this.right.variables;\n\t\t\t}\n\n\t\t\tconst selected = new Map();\n\n\t\t\tfor (const [variableId, variable] of this.right.variables)\n\t\t\t{\n\t\t\t\tif (this.value.values.has(variableId))\n\t\t\t\t{\n\t\t\t\t\tselected.set(variableId, variable);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn selected;\n\t\t},\n\t\temptyValues(): Set<string> {\n\t\t\treturn this.$store.getters['accessRights/getEmptyValue'](this.section.sectionCode, this.value.id);\n\t\t},\n\t\tcurrentAlias(): ?string {\n\t\t\treturn this.$store.getters['accessRights/getSelectedVariablesAlias'](this.section.sectionCode, this.value.id, this.value.values);\n\t\t},\n\t\ttitle(): string {\n\t\t\tif (Type.isString(this.currentAlias))\n\t\t\t{\n\t\t\t\treturn this.currentAlias;\n\t\t\t}\n\n\t\t\tif (this.isAllSelected)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ALL_ACCEPTED');\n\t\t\t}\n\n\t\t\tif (this.selectedVariables.size <= 0)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ADD');\n\t\t\t}\n\n\t\t\treturn getMultipleSelectedVariablesTitle(this.selectedVariables);\n\t\t},\n\t\thintHtml(): string {\n\t\t\treturn getMultipleSelectedVariablesHintHtml(this.selectedVariables, this.hintTitle, this.right.variables);\n\t\t},\n\t\thintTitle(): string {\n\t\t\tif (Type.isString(this.right.hintTitle))\n\t\t\t{\n\t\t\t\treturn this.right.hintTitle;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SELECTED_ITEMS_TITLE');\n\t\t},\n\t\tdialogItems(): ItemOptions[] {\n\t\t\tconst items: ItemOptions[] = [];\n\n\t\t\tfor (const variable: Variable of this.right.variables.values())\n\t\t\t{\n\t\t\t\tconst item = Runtime.clone(variable);\n\t\t\t\titem.entityId = item.entityId || 'editor-right-item';\n\t\t\t\titem.tabs = 'recents';\n\t\t\t\tif (item.selectionStrategy)\n\t\t\t\t{\n\t\t\t\t\titem.customData = { ...item.customData, selectionStrategy: item.selectionStrategy };\n\t\t\t\t}\n\n\t\t\t\titems.push(item);\n\t\t\t}\n\n\t\t\treturn items;\n\t\t},\n\t\tselectedDialogItems(): ItemOptions[] {\n\t\t\treturn this.dialogItems.filter((item) => this.selectedVariables.has(item.id));\n\t\t},\n\t},\n\tmethods: {\n\t\tshowSelector(): void {\n\t\t\tconst dialog = new Dialog({\n\t\t\t\ttargetNode: this.$el,\n\t\t\t\theight: 300,\n\t\t\t\tcontext: 'editor-right-items',\n\t\t\t\tenableSearch: this.right.enableSearch,\n\t\t\t\tmultiple: true,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tcompactView: this.right.compactView,\n\t\t\t\tshowAvatars: this.right.showAvatars,\n\t\t\t\tselectedItems: this.selectedDialogItems,\n\t\t\t\tsearchOptions: {\n\t\t\t\t\tallowCreateItem: false,\n\t\t\t\t},\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onItemSelect,\n\t\t\t\t\t'Item:onDeselect': this.onItemDeselect,\n\t\t\t\t\tonHide: this.setEmptyValueIfNoneSelected,\n\t\t\t\t},\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'editor-right-item',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\titems: this.dialogItems,\n\t\t\t\tfooter: this.right.disableSelectAll ? null : Footer,\n\t\t\t});\n\n\t\t\tdialog.show();\n\t\t},\n\t\tonItemSelect(event: BaseEvent): void {\n\t\t\tconst addedItem: Item = event.getData().item;\n\n\t\t\tthis.processSelectionLogic(addedItem);\n\n\t\t\tconst addedValue = String(addedItem.getId());\n\n\t\t\t/**\n\t\t\t * Multivariables has complex logic that takes into account current values. And those values can be changed\n\t\t\t * multiple times during a single `onItemSelect` call (deselect for items with `selectionStrategy`).\n\t\t\t * Vue caches props changes. We would receive new `this.value.values` only after `onItemSelect` returned\n\t\t\t * completely. Therefore, if we do all mutations in a single event loop message, all mutations will operate\n\t\t\t * with `this.value.values` that have yet to be updated, and our resulting values will be a mess.\n\t\t\t * Delaying mutation to a next event loop message ensures that we will operate with updated `this.value.values`.\n\t\t\t */\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.addValue(addedValue);\n\t\t\t});\n\t\t},\n\t\tprocessSelectionLogic(addedItem: Item): void {\n\t\t\tconst selected: Item[] = addedItem.getDialog().getSelectedItems();\n\n\t\t\t// clear other selected items\n\t\t\tif (addedItem.customData.get('selectionStrategy') === 'mutually-exclusive')\n\t\t\t{\n\t\t\t\tfor (const item of selected)\n\t\t\t\t{\n\t\t\t\t\tif (addedItem.getId() !== item.getId())\n\t\t\t\t\t{\n\t\t\t\t\t\titem.deselect();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const item of selected)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\titem.customData.get('selectionStrategy') === 'mutually-exclusive'\n\t\t\t\t\t&& addedItem.getId() !== item.getId()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\titem.deselect();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonItemDeselect(event: BaseEvent): void {\n\t\t\tconst removedItem: Item = event.getData().item;\n\n\t\t\tconst removedValue = String(removedItem.getId());\n\n\t\t\t/**\n\t\t\t * Multivariables has complex logic that takes into account current values. And those values can be changed\n\t\t\t * multiple times during a single `onItemSelect` call (deselect for items with `selectionStrategy`).\n\t\t\t * Vue caches props changes. We would receive new `this.value.values` only after `onItemSelect` returned\n\t\t\t * completely. Therefore, if we do all mutations in a single event loop message, all mutations will operate\n\t\t\t * with `this.value.values` that have yet to be updated, and our resulting values will be a mess.\n\t\t\t * Delaying mutation to a next event loop message ensures that we will operate with updated `this.value.values`.\n\t\t\t */\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.removeValue(removedValue);\n\t\t\t});\n\t\t},\n\t\taddValue(value: string): void {\n\t\t\tconst newValues = Runtime.clone(this.value.values);\n\n\t\t\tnewValues.add(value);\n\n\t\t\tif (newValues.length >= this.right.variables.size)\n\t\t\t{\n\t\t\t\tthis.setValues(new Set([this.right.allSelectedCode]));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setValues(newValues);\n\t\t\t}\n\t\t},\n\t\tremoveValue(value: string): void {\n\t\t\tif (this.value.values.has(this.right.allSelectedCode))\n\t\t\t{\n\t\t\t\tconst allVariablesIds = [...this.right.variables.values()].map((variable: Variable) => variable.id);\n\n\t\t\t\tconst allVariablesIdsWithoutRemoved = new Set(allVariablesIds);\n\t\t\t\tallVariablesIdsWithoutRemoved.delete(value);\n\n\t\t\t\tthis.setValues(allVariablesIdsWithoutRemoved);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst newValues = [...this.value.values].filter((candidate) => candidate !== value);\n\n\t\t\t\tthis.setValues(new Set(newValues));\n\t\t\t}\n\t\t},\n\t\tsetEmptyValueIfNoneSelected(): void {\n\t\t\tif (this.value.values.size <= 0)\n\t\t\t{\n\t\t\t\tfor (const empty of this.emptyValues)\n\t\t\t\t{\n\t\t\t\t\tthis.addValue(empty);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tsetValues(newValues: Set<string>): void {\n\t\t\tthis.$store.dispatch('userGroups/setAccessRightValues', {\n\t\t\t\tsectionCode: this.section.sectionCode,\n\t\t\t\tuserGroupId: this.userGroup.id,\n\t\t\t\tvalueId: this.value.id,\n\t\t\t\tvalues: newValues,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<SelectedHint \n\t\t\tv-if=\"hintHtml\"\n\t\t\t:html=\"hintHtml\" \n\t\t\tclass='ui-access-rights-v2-column-item-text-link'\n\t\t\t@click=\"showSelector\"\n\t\t>\n\t\t\t{{ title }}\n\t\t</SelectedHint>\n\t\t<div \n\t\t\tv-else\n\t\t\tclass='ui-access-rights-v2-column-item-text-link ui-access-rights-v2-text-ellipsis'\n\t\t\t@click=\"showSelector\"\n\t\t\t:title=\"title\"\n\t\t>\n\t\t\t{{ title }}\n\t\t</div>\n\t`,\n};\n","import { Switcher } from 'ui.vue3.components.switcher';\n\nexport const Toggler = {\n\tname: 'Toggler',\n\tcomponents: { Switcher },\n\tprops: {\n\t\tvalue: {\n\t\t\t/** @type AccessRightValue */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tinject: ['section', 'userGroup'],\n\tcomputed: {\n\t\tisChecked(): boolean {\n\t\t\treturn this.value.values.has('1');\n\t\t},\n\t},\n\tmethods: {\n\t\tsetValue(value): void {\n\t\t\tthis.$store.dispatch('userGroups/setAccessRightValues', {\n\t\t\t\tuserGroupId: this.userGroup.id,\n\t\t\t\tsectionCode: this.section.sectionCode,\n\t\t\t\tvalueId: this.value.id,\n\t\t\t\tvalues: new Set([value]),\n\t\t\t});\n\t\t},\n\t},\n\t// eslint-disable-next-line quotes\n\ttemplate: `\n\t\t<Switcher\n\t\t\t:is-checked=\"isChecked\"\n\t\t\t@check=\"setValue('1')\"\n\t\t\t@uncheck=\"setValue('0')\"\n\t\t\t:options=\"{\n\t\t\t\tsize: 'extra-small',\n\t\t\t\tcolor: 'green',\n\t\t\t}\"\n\t\t/>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { MenuManager } from 'main.popup';\n\nconst POPUP_ID = 'ui-access-rights-v2-column-item-popup-variables';\n\nexport const Variables = {\n\tname: 'Variables',\n\tprops: {\n\t\t// value for selector is id of a selected variable\n\t\tvalue: {\n\t\t\t/** @type AccessRightValue */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tinject: ['section', 'userGroup', 'right'],\n\tcomputed: {\n\t\temptyVariableId(): ?string {\n\t\t\tconst emptyValue: Set<string> = this.$store.getters['accessRights/getEmptyValue'](\n\t\t\t\tthis.section.sectionCode,\n\t\t\t\tthis.value.id,\n\t\t\t);\n\n\t\t\treturn emptyValue[0];\n\t\t},\n\t\tcurrentVariableId(): ?string {\n\t\t\tif (this.value.values.size <= 0)\n\t\t\t{\n\t\t\t\treturn this.emptyVariableId;\n\t\t\t}\n\n\t\t\tconst [firstItem] = this.value.values;\n\n\t\t\treturn firstItem;\n\t\t},\n\t\tcurrentAlias(): ?string {\n\t\t\treturn this.$store.getters['accessRights/getSelectedVariablesAlias'](this.section.sectionCode, this.value.id, this.value.values);\n\t\t},\n\t\tcurrentVariableTitle(): string {\n\t\t\tif (Type.isString(this.currentAlias))\n\t\t\t{\n\t\t\t\treturn this.currentAlias;\n\t\t\t}\n\n\t\t\tconst variable = this.right.variables.get(this.currentVariableId);\n\t\t\tif (!variable)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ADD');\n\t\t\t}\n\n\t\t\treturn variable.title;\n\t\t},\n\t},\n\tmethods: {\n\t\tshowSelector(event: PointerEvent): void {\n\t\t\tconst menuItems = [];\n\t\t\tfor (const variable of this.right.variables.values())\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\tid: variable.id,\n\t\t\t\t\ttext: variable.title,\n\t\t\t\t\tonclick: (innerEvent, item) => {\n\t\t\t\t\t\titem\n\t\t\t\t\t\t\t.getMenuWindow()\n\t\t\t\t\t\t\t?.close()\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\tthis.setValue(variable.id);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tMenuManager.show({\n\t\t\t\tid: POPUP_ID,\n\t\t\t\tbindElement: event.target,\n\t\t\t\titems: menuItems,\n\t\t\t\tautoHide: true,\n\t\t\t\tcacheable: false,\n\t\t\t});\n\t\t},\n\t\tsetValue(value): void {\n\t\t\tthis.$store.dispatch('userGroups/setAccessRightValues', {\n\t\t\t\tsectionCode: this.section.sectionCode,\n\t\t\t\tuserGroupId: this.userGroup.id,\n\t\t\t\tvalueId: this.value.id,\n\t\t\t\tvalues: new Set([value]),\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass='ui-access-rights-v2-column-item-text-link ui-access-rights-v2-text-ellipsis'\n\t\t\t:title=\"currentVariableTitle\"\n\t\t\t@click=\"showSelector\"\n\t\t>\n\t\t\t{{ currentVariableTitle }}\n\t\t</div>\n\t`,\n};\n","import type { AccessRightItem } from '../../../../store/model/access-rights-model';\nimport { DependentVariables } from './dependent-variables';\nimport { Multivariables } from './multivariables';\nimport { Toggler } from './toggler';\nimport { Variables } from './variables';\n\nexport const Cells = Object.freeze({\n\tToggler,\n\tVariables,\n\tMultivariables,\n\tDependentVariables,\n});\n\nexport function getCellComponent(accessRightItem: AccessRightItem): string\n{\n\tif (accessRightItem.type === 'toggler')\n\t{\n\t\treturn 'Toggler';\n\t}\n\n\tif (accessRightItem.type === 'variables')\n\t{\n\t\treturn 'Variables';\n\t}\n\n\tif (accessRightItem.type === 'multivariables')\n\t{\n\t\treturn 'Multivariables';\n\t}\n\n\tif (accessRightItem.type === 'dependent_variables')\n\t{\n\t\treturn 'DependentVariables';\n\t}\n\n\tconsole.warn('ui.accessrights.v2: Unknown access right type', accessRightItem);\n\n\t// vue will render empty cell\n\treturn '';\n}\n","import type { AccessRightItem } from '../../../store/model/access-rights-model';\nimport type { AccessRightValue } from '../../../store/model/user-groups-model';\nimport { CellLayout } from '../../layout/cell-layout';\nimport { Cells, getCellComponent } from './cell/registry';\n\nexport const ValueCell = {\n\tname: 'ValueCell',\n\tcomponents: {\n\t\tCellLayout,\n\t\t...Cells,\n\t},\n\tprops: {\n\t\tright: {\n\t\t\t/** @type AccessRightItem */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tinject: ['section', 'userGroup'],\n\tprovide(): Object {\n\t\treturn {\n\t\t\tright: this.right,\n\t\t};\n\t},\n\tcomputed: {\n\t\tvalue(): AccessRightValue\n\t\t{\n\t\t\tconst value = this.userGroup.accessRights.get(this.right.id);\n\n\t\t\treturn value || this.$store.getters['userGroups/getEmptyAccessRightValue'](this.userGroup.id, this.section.sectionCode, this.right.id);\n\t\t},\n\t\tcellComponent(): string\n\t\t{\n\t\t\treturn getCellComponent(this.right);\n\t\t},\n\t},\n\t// data attributes are needed for e2e automated tests\n\ttemplate: `\n\t\t<CellLayout\n\t\t\t:class=\"{\n\t\t\t\t'ui-access-rights-v2-group-children': right.group,\n\t\t\t\t'--modified': value.isModified\n\t\t\t}\"\n\t\t\tv-memo=\"[userGroup.id, value.values, value.isModified]\"\n\t\t>\n\t\t\t<Component\n\t\t\t\t:is=\"cellComponent\"\n\t\t\t\t:value=\"value\"\n\t\t\t\t:data-accessrights-right-id=\"right.id\"\n\t\t\t/>\n\t\t</CellLayout>\n\t`,\n};\n","import { computed } from 'ui.vue3';\nimport { AccessRightItem } from '../../store/model/access-rights-model';\nimport type { UserGroup } from '../../store/model/user-groups-model';\nimport { shouldRowBeRendered } from '../../utils';\nimport { ColumnLayout } from '../layout/column-layout';\nimport { ValueCell } from './column/value-cell';\n\nexport const Column = {\n\tname: 'Column',\n\tcomponents: {\n\t\tColumnLayout,\n\t\tValueCell,\n\t},\n\tprops: {\n\t\tuserGroup: {\n\t\t\t/** @type UserGroup */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\trights: {\n\t\t\ttype: Map,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tprovide(): Object {\n\t\treturn {\n\t\t\tuserGroup: computed(() => this.userGroup),\n\t\t};\n\t},\n\tcomputed: {\n\t\trenderedRights(): Map<string, AccessRightItem> {\n\t\t\tconst result = new Map();\n\t\t\tfor (const [rightId: string, right: AccessRightItem] of this.rights)\n\t\t\t{\n\t\t\t\tif (shouldRowBeRendered(right))\n\t\t\t\t{\n\t\t\t\t\tresult.set(rightId, right);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ColumnLayout>\n\t\t\t<ValueCell\n\t\t\t\tv-for=\"[rightId, accessRightItem] in renderedRights\"\n\t\t\t\t:key=\"rightId\"\n\t\t\t\t:right=\"accessRightItem\"\n\t\t\t/>\n\t\t</ColumnLayout>\n\t`,\n};\n","import { Cache } from 'main.core';\n\n/**\n * `BX.UI.Hint.createInstance` takes up to 30% of CPU time when multiple hints are mounted on page\n * (e.g. on a load, search), probably because of `Manager.initByClassName` call in `new Manager`.\n * therefore, we share a Manager instance across all hints in the app\n */\nexport class HintLocator\n{\n\tstatic #cache = new Cache.MemoryCache();\n\n\tstatic get(appGuid: string): BX.UI.Hint\n\t{\n\t\treturn this.#cache.remember(appGuid, () => {\n\t\t\treturn BX.UI.Hint.createInstance({\n\t\t\t\tid: `ui-access-rights-v2-hint-${appGuid}`,\n\t\t\t\tpopupParameters: {\n\t\t\t\t\tclassName: 'ui-access-rights-v2-popup-pointer-events ui-hint-popup',\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tmaxWidth: 280,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\toffsetLeft: 8,\n\t\t\t\t\tangle: true,\n\t\t\t\t\tanimation: 'fading-slide',\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Dom, Tag } from 'main.core';\nimport 'ui.hint';\nimport { mapState } from 'ui.vue3.vuex';\nimport { HintLocator } from '../../integration/hint/hint-locator';\n\n/**\n * A special case of Hint that provides interactivity and reactivity.\n */\nexport const Hint = {\n\tname: 'Hint',\n\tprops: {\n\t\thtml: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\t...mapState({\n\t\t\tguid: (state) => state.application.guid,\n\t\t}),\n\t},\n\tmounted()\n\t{\n\t\tthis.renderHint();\n\t},\n\twatch: {\n\t\thtml(): void {\n\t\t\t// make ui.hint reactive :(\n\t\t\tDom.clean(this.$refs.container);\n\t\t\tthis.renderHint();\n\t\t},\n\t},\n\tmethods: {\n\t\trenderHint(): void {\n\t\t\tconst hintIconWrapper = Tag.render`<span data-hint-html=\"true\" data-hint-interactivity=\"true\"></span>`;\n\t\t\t// Tag.render cant set prop value with HTML properly :(\n\t\t\thintIconWrapper.setAttribute('data-hint', this.html);\n\n\t\t\tDom.append(\n\t\t\t\thintIconWrapper,\n\t\t\t\tthis.$refs.container,\n\t\t\t);\n\n\t\t\tthis.getHintManager().init(this.$refs.container);\n\t\t},\n\t\tgetHintManager(): BX.UI.Hint {\n\t\t\treturn HintLocator.get(this.guid);\n\t\t},\n\t},\n\ttemplate: '<span ref=\"container\"></span>',\n};\n","import { Hint } from '../util/hint';\nimport { Icon } from './icon';\nimport '../../css/section/header.css';\n\nexport const Header = {\n\tname: 'Header',\n\tcomponents: { Hint, Icon },\n\tinject: ['section'],\n\tmethods: {\n\t\ttoggleSection(): void {\n\t\t\tthis.$store.dispatch('accessRights/toggleSection', { sectionCode: this.section.sectionCode });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t@click=\"toggleSection\"\n\t\t\tclass='ui-access-rights-v2-section-header'\n\t\t\t:class=\"{\n\t\t\t\t'--expanded': section.isExpanded,\n\t\t\t}\" \n\t\t\tv-memo=\"[section.isExpanded]\"\n\t\t>\n\t\t\t<div class=\"ui-access-rights-v2-section-header-expander\">\n\t\t\t\t<div class='ui-icon-set' :class=\"{\n\t\t\t\t\t'--chevron-up': section.isExpanded,\n\t\t\t\t\t'--chevron-down': !section.isExpanded,\n\t\t\t\t}\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<Icon/>\n\t\t\t<span \n\t\t\t\tclass=\"ui-access-rights-v2-text-ellipsis ui-access-rights-v2-section-title\"\n\t\t\t\t:title=\"section.sectionTitle\"\n\t\t\t>{{ section.sectionTitle }}</span>\n\t\t\t<span\n\t\t\t\tv-if=\"section.sectionSubTitle\"\n\t\t\t\tclass=\"ui-access-rights-v2-text-ellipsis ui-access-rights-v2-section-subtitle\"\n\t\t\t\t:title=\"section.sectionSubTitle\"\n\t\t\t>\n\t\t\t\t{{ section.sectionSubTitle }}\n\t\t\t</span>\n\t\t\t<Hint v-if=\"section.sectionHint\" :html=\"section.sectionHint\"/>\n\t\t</div>\n\t`,\n};\n","import { Hint } from '../../util/hint';\n\nexport const TitleCell = {\n\tname: 'TitleCell',\n\tcomponents: { Hint },\n\tprops: {\n\t\tright: {\n\t\t\t/** @type AccessRightItem */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tinject: ['section'],\n\tmethods: {\n\t\ttoggleGroup(): void\n\t\t{\n\t\t\tif (!this.right.groupHead)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$store.dispatch('accessRights/toggleGroup', { sectionCode: this.section.sectionCode, groupId: this.right.id });\n\t\t},\n\t},\n\t// data attributes are needed for e2e automated tests\n\ttemplate: `\n\t\t<div\n\t\t\tclass='ui-access-rights-v2-column-item-text ui-access-rights-v2-column-item-title'\n\t\t\t@click=\"toggleGroup\"\n\t\t\t:title=\"right.title\"\n\t\t\t:style=\"{\n\t\t\t\tcursor: right.groupHead ? 'pointer' : null,\n\t\t\t}\"\n\t\t\tv-memo=\"[right.isGroupExpanded]\"\n\t\t\t:data-accessrights-right-id=\"right.id\"\n\t\t>\n\t\t\t<span\n\t\t\t\tv-if=\"right.groupHead\"\n\t\t\t\tclass=\"ui-icon-set\"\n\t\t\t\t:class=\"{\n\t\t\t\t\t'--minus-in-circle': right.isGroupExpanded,\n\t\t\t\t\t'--plus-in-circle': !right.isGroupExpanded,\n\t\t\t\t}\"\n\t\t\t></span>\n\t\t\t<span class=\"ui-access-rights-v2-text-ellipsis\" :style=\"{\n\t\t\t\t'margin-left': !right.groupHead && !right.group ? '23px' : null,\n\t\t\t}\">{{ right.title }}</span>\n\t\t\t<Hint v-once v-if=\"right.hint\" :html=\"right.hint\" />\n\t\t</div>\n\t`,\n};\n","import { AccessRightItem } from '../../store/model/access-rights-model';\nimport { shouldRowBeRendered } from '../../utils';\nimport { CellLayout } from '../layout/cell-layout';\nimport { ColumnLayout } from '../layout/column-layout';\nimport { TitleCell } from './title-column/title-cell';\n\nexport const TitleColumn = {\n\tname: 'TitleColumn',\n\tcomponents: { TitleCell, ColumnLayout, CellLayout },\n\tprops: {\n\t\trights: {\n\t\t\ttype: Map,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\trenderedRights(): Map<string, AccessRightItem> {\n\t\t\tconst result = new Map();\n\t\t\tfor (const [rightId: string, right: AccessRightItem] of this.rights)\n\t\t\t{\n\t\t\t\tif (shouldRowBeRendered(right))\n\t\t\t\t{\n\t\t\t\t\tresult.set(rightId, right);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ColumnLayout>\n\t\t\t<CellLayout\n\t\t\t\tv-for=\"[rightId, accessRightItem] in renderedRights\"\n\t\t\t\t:key=\"rightId\"\n\t\t\t\t:class=\"{\n\t\t\t\t\t'ui-access-rights-v2-group-children': accessRightItem.group,\n\t\t\t\t}\"\n\t\t\t>\n\t\t\t\t<TitleCell :right=\"accessRightItem\" />\n\t\t\t</CellLayout>\n\t\t</ColumnLayout>\n\t`,\n};\n","import { Dom, Event, Runtime } from 'main.core';\nimport { Ears } from 'ui.ears';\nimport { computed } from 'ui.vue3';\nimport { Column } from './section/column';\nimport { Header } from './section/header';\nimport { TitleColumn } from './section/title-column';\nimport { SyncHorizontalScroll } from './util/sync-horizontal-scroll';\n\nexport const Section = {\n\tname: 'Section',\n\tcomponents: { Column, SyncHorizontalScroll, TitleColumn, Header },\n\tprops: {\n\t\tuserGroups: {\n\t\t\ttype: Map,\n\t\t\trequired: true,\n\t\t},\n\t\trights: {\n\t\t\ttype: Map,\n\t\t\trequired: true,\n\t\t},\n\t\tcode: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisExpanded: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsubTitle: {\n\t\t\ttype: String,\n\t\t},\n\t\thint: {\n\t\t\ttype: String,\n\t\t},\n\t\ticon: {\n\t\t\t/** @type AccessRightSectionIcon */\n\t\t\ttype: Object,\n\t\t},\n\t},\n\tthrottledScrollHandler: null,\n\tthrottledResizeHandler: null,\n\tears: null,\n\tisEarsInited: false,\n\tdata(): Object {\n\t\treturn {\n\t\t\tisLeftShadowShown: false,\n\t\t\tisRightShadowShown: false,\n\t\t};\n\t},\n\tprovide(): Object {\n\t\treturn {\n\t\t\tsection: computed(() => {\n\t\t\t\treturn {\n\t\t\t\t\tsectionCode: this.code,\n\t\t\t\t\tsectionTitle: this.title,\n\t\t\t\t\tsectionSubTitle: this.subTitle,\n\t\t\t\t\tsectionIcon: this.icon,\n\t\t\t\t\tsectionHint: this.hint,\n\t\t\t\t\tisExpanded: this.isExpanded,\n\t\t\t\t\trights: this.rights,\n\t\t\t\t};\n\t\t\t}),\n\t\t};\n\t},\n\tcreated()\n\t{\n\t\tthis.throttledScrollHandler = Runtime.throttle(this.adjustShadowsVisibility, 200);\n\t\tthis.throttledResizeHandler = Runtime.throttle(() => {\n\t\t\tthis.adjustShadowsVisibility();\n\t\t\tthis.adjustEars();\n\t\t}, 200);\n\t},\n\tmounted()\n\t{\n\t\tEvent.bind(window, 'resize', this.throttledResizeHandler);\n\t\tthis.adjustShadowsVisibility();\n\n\t\tthis.initEars();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.destroyEars();\n\n\t\tEvent.unbind(window, 'resize', this.throttledResizeHandler);\n\t},\n\twatch: {\n\t\tuserGroups(newValue: Map, oldValue: Map): void {\n\t\t\tif (newValue.size !== oldValue.size)\n\t\t\t{\n\t\t\t\tthis.adjustShadowsVisibility();\n\t\t\t\tthis.adjustEars();\n\t\t\t}\n\t\t},\n\t\tisExpanded(newValue): void {\n\t\t\tif (newValue === true)\n\t\t\t{\n\t\t\t\tvoid this.$nextTick(() => {\n\t\t\t\t\tthis.initEars();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.destroyEars();\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\tcalculateShadowsVisibility(): { isLeftShadowShown: boolean, isRightShadowShown: boolean } {\n\t\t\tif (!this.$refs['column-container'])\n\t\t\t{\n\t\t\t\t// in case it's accidentally called before mount or after unmount\n\t\t\t\treturn { isLeftShadowShown: false, isRightShadowShown: false };\n\t\t\t}\n\n\t\t\tconst scrollLeft = this.$refs['column-container'].$el.scrollLeft;\n\n\t\t\tconst isLeftShadowShown = scrollLeft > 0;\n\n\t\t\tconst offsetWidth = this.$refs['column-container'].$el.offsetWidth;\n\n\t\t\treturn {\n\t\t\t\tisLeftShadowShown,\n\t\t\t\tisRightShadowShown: this.$refs['column-container'].$el.scrollWidth > (Math.round(scrollLeft + offsetWidth)),\n\t\t\t};\n\t\t},\n\t\tadjustShadowsVisibility(): void {\n\t\t\t// avoid \"forced synchronous layout\"\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tconst { isLeftShadowShown, isRightShadowShown } = this.calculateShadowsVisibility();\n\t\t\t\tthis.isLeftShadowShown = isLeftShadowShown;\n\t\t\t\tthis.isRightShadowShown = isRightShadowShown;\n\t\t\t});\n\t\t},\n\t\tadjustEars(): void {\n\t\t\tif (!this.isEarsInited)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// avoid \"forced synchronous layout\"\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\t// force ears to recalculate its visibility\n\t\t\t\tthis.ears.toggleEars();\n\t\t\t});\n\t\t},\n\t\tinitEars(): void {\n\t\t\tif (!this.$refs['column-container'])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.ears)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.ears = new Ears({\n\t\t\t\tcontainer: this.$refs['column-container'].$el,\n\t\t\t\timmediateInit: true,\n\t\t\t\tsmallSize: true,\n\t\t\t});\n\n\t\t\t// chrome is not happy when we query DOM values (scrollLeft, offsetWidth, ...) just after we've changed them\n\t\t\t// avoid \"forced synchronous layout\"\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tif (!this.ears || !this.$refs['column-container'])\n\t\t\t\t{\n\t\t\t\t\tthis.ears = null;\n\n\t\t\t\t\t// sometimes the callback is fired after the component is unmounted\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst scrollLeft = this.$refs['column-container'].$el.scrollLeft;\n\t\t\t\tthis.ears.init();\n\n\t\t\t\t// Ears add wrapper around the container, and it breaks our markup a little. Fix it\n\t\t\t\tDom.style(this.ears.getWrapper(), 'flex', 1);\n\t\t\t\tif (scrollLeft > 0)\n\t\t\t\t{\n\t\t\t\t\t// ears.init resets scrollLeft to 0\n\t\t\t\t\tthis.$refs['column-container'].$el.scrollLeft = scrollLeft;\n\t\t\t\t}\n\n\t\t\t\tthis.isEarsInited = true;\n\t\t\t});\n\t\t},\n\t\tdestroyEars(): void {\n\t\t\tthis.ears?.destroy();\n\t\t\tthis.isEarsInited = false;\n\t\t\tthis.ears = null;\n\t\t},\n\t},\n\t// data attributes are needed for e2e automated tests\n\ttemplate: `\n\t\t<div class=\"ui-access-rights-v2-section\" :data-accessrights-section-code=\"code\">\n\t\t\t<Header/>\n\t\t\t<div v-if=\"isExpanded\" class='ui-access-rights-v2-section-container'>\n\t\t\t\t<div class='ui-access-rights-v2-section-head'>\n\t\t\t\t\t<TitleColumn :rights=\"rights\" />\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass='ui-access-rights-v2-section-content'\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'ui-access-rights-v2-section-shadow-left-shown': isLeftShadowShown,\n\t\t\t\t\t\t'ui-access-rights-v2-section-shadow-right-shown': isRightShadowShown,\n\t\t\t\t\t}\"\n\t\t\t\t>\n\t\t\t\t\t<SyncHorizontalScroll\n\t\t\t\t\t\tref=\"column-container\"\n\t\t\t\t\t\tclass='ui-access-rights-v2-section-wrapper'\n\t\t\t\t\t\t@scroll=\"throttledScrollHandler\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Column \n\t\t\t\t\t\t\tv-for=\"[groupId, group] in userGroups\"\n\t\t\t\t\t\t\t:key=\"groupId\"\n\t\t\t\t\t\t\t:user-group=\"group\"\n\t\t\t\t\t\t\t:rights=\"rights\"\n\t\t\t\t\t\t\t:data-accessrights-user-group-id=\"groupId\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</SyncHorizontalScroll>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loader } from 'main.loader';\nimport { mapGetters, mapState } from 'ui.vue3.vuex';\nimport { Header } from './header';\nimport { SearchBox } from './searchbox';\nimport { Section } from './section';\n\nexport const Grid = {\n\tname: 'Grid',\n\tcomponents: { Section, Header, SearchBox },\n\tloader: null,\n\tcomputed: {\n\t\t...mapState({\n\t\t\tisSaving: (state) => state.application.isSaving,\n\t\t\tsearchContainerSelector: (state) => state.application.options.searchContainerSelector,\n\t\t}),\n\t\t...mapGetters({\n\t\t\tshownSections: 'accessRights/shown',\n\t\t\tshownUserGroups: 'userGroups/shown',\n\t\t}),\n\t},\n\tmounted()\n\t{\n\t\tthis.loader = new Loader({\n\t\t\ttarget: this.$refs.container,\n\t\t});\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.loader.destroy();\n\t},\n\twatch: {\n\t\tisSaving(newValue): void {\n\t\t\tif (newValue)\n\t\t\t{\n\t\t\t\tthis.loader.show();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.loader.hide();\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Teleport v-if=\"searchContainerSelector\" :to=\"searchContainerSelector\">\n\t\t\t<SearchBox/>\n\t\t</Teleport>\n\t\t<div ref=\"container\" class='ui-access-rights-v2' :class=\"{\n\t\t\t'ui-access-rights-v2-block': isSaving,\n\t\t}\">\n\t\t\t<Header :user-groups=\"shownUserGroups\"/>\n\t\t\t<Section\n\t\t\t\tv-for=\"[sectionCode, accessRightSection] in shownSections\"\n\t\t\t\t:key=\"sectionCode\"\n\t\t\t\t:code=\"accessRightSection.sectionCode\"\n\t\t\t\t:is-expanded=\"accessRightSection.isExpanded\"\n\t\t\t\t:title=\"accessRightSection.sectionTitle\"\n\t\t\t\t:sub-title=\"accessRightSection.sectionSubTitle\"\n\t\t\t\t:hint=\"accessRightSection.sectionHint\"\n\t\t\t\t:icon=\"accessRightSection.sectionIcon\"\n\t\t\t\t:rights=\"accessRightSection.rights\"\n\t\t\t\t:user-groups=\"shownUserGroups\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { BuilderModel, type GetterTree, type MutationTree } from 'ui.vue3.vuex';\n\nexport type ApplicationState = {\n\toptions: Readonly<Options>,\n\tguid: string,\n\tisSaving: boolean,\n}\n\nexport type Options = {\n\tcomponent: string,\n\tactionSave: string,\n\tmode: string,\n\tbodyType?: 'json' | 'data',\n\tadditionalSaveParams: Object,\n\tisSaveOnlyChangedRights: boolean,\n\tmaxVisibleUserGroups: ?number,\n\tsearchContainerSelector: ?string,\n}\n\nexport const ACTION_SAVE = 'save';\nexport const MODE = 'ajax';\nexport const BODY_TYPE = 'data';\n\nexport class ApplicationModel extends BuilderModel\n{\n\t#guid: string;\n\t#options: Readonly<Options>;\n\n\tgetName(): string\n\t{\n\t\treturn 'application';\n\t}\n\n\tsetOptions(options: Options): ApplicationModel\n\t{\n\t\tthis.#options = options;\n\n\t\treturn this;\n\t}\n\n\tsetGuid(guid: string): ApplicationModel\n\t{\n\t\tthis.#guid = guid;\n\n\t\treturn this;\n\t}\n\n\tgetState(): ApplicationState\n\t{\n\t\treturn {\n\t\t\toptions: this.#options,\n\t\t\tguid: this.#guid,\n\t\t\tisSaving: false,\n\t\t};\n\t}\n\n\tgetGetters(): GetterTree<ApplicationState>\n\t{\n\t\treturn {\n\t\t\tisMaxVisibleUserGroupsSet: (state): boolean => {\n\t\t\t\treturn state.options.maxVisibleUserGroups > 0;\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMutations(): MutationTree<ApplicationState>\n\t{\n\t\treturn {\n\t\t\tsetSaving: (state, isSaving: boolean): void => {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tstate.isSaving = Boolean(isSaving);\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Loc, Runtime, Text, Type } from 'main.core';\nimport { type ActionTree, BuilderModel, type GetterTree, type MutationTree, type Store } from 'ui.vue3.vuex';\nimport type { AccessRightItem, AccessRightSection } from './access-rights-model';\n\nexport type UserGroupsState = {\n\tcollection: UserGroupsCollection,\n\tdeleted: Set<string>,\n}\n\nexport type UserGroupsStore = Store<UserGroupsState>;\n\nexport type UserGroupsCollection = Map<string, UserGroup>;\n\n// aka Role\nexport type UserGroup = {\n\tid: string,\n\tisNew: boolean,\n\tisModified: boolean, // whether group metadata is modified - title, members\n\tisShown: boolean,\n\ttitle: string,\n\taccessRights: Map<string, AccessRightValue>,\n\tmembers: MemberCollection, // access code => member\n};\n\nexport type AccessRightValue = {\n\tid: string,\n\tvalues: Set<string>,\n\tisModified: boolean,\n};\n\nexport type MemberCollection = Map<string, Member>; // access code => member\n\n// user/group/department/set of users\nexport type Member = {\n\ttype: string, // see main/install/components/bitrix/main.ui.selector/templates/.default/script.js\n\tid: string,\n\tname: string,\n\tavatar: ?string,\n};\n\ntype SetAccessRightValuesPayload = {\n\tuserGroupId: string,\n\tsectionCode: string,\n\tvalueId: string,\n\tvalues: Set<string>,\n};\n\nexport const NEW_USER_GROUP_ID_PREFIX = 'new~~~';\n\nexport class UserGroupsModel extends BuilderModel\n{\n\t#initialUserGroups: UserGroupsCollection = new Map();\n\n\tgetName(): string\n\t{\n\t\treturn 'userGroups';\n\t}\n\n\tsetInitialUserGroups(groups: UserGroupsCollection): UserGroupsModel\n\t{\n\t\tthis.#initialUserGroups = groups;\n\n\t\treturn this;\n\t}\n\n\tgetState(): UserGroupsState\n\t{\n\t\treturn {\n\t\t\tcollection: Runtime.clone(this.#initialUserGroups),\n\t\t\tdeleted: new Set(),\n\t\t};\n\t}\n\n\tgetElementState(params = {}): UserGroup\n\t{\n\t\treturn {\n\t\t\tid: `${NEW_USER_GROUP_ID_PREFIX}${Text.getRandom()}`,\n\t\t\tisNew: true,\n\t\t\tisModified: true,\n\t\t\tisShown: true,\n\t\t\ttitle: Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_NAME'),\n\t\t\taccessRights: new Map(),\n\t\t\tmembers: new Map(),\n\t\t};\n\t}\n\n\tgetGetters(): GetterTree<UserGroupsState>\n\t{\n\t\treturn {\n\t\t\tshown: (state): UserGroupsCollection => {\n\t\t\t\tconst result = new Map();\n\n\t\t\t\tfor (const [userGroupId, userGroup] of state.collection)\n\t\t\t\t{\n\t\t\t\t\tif (userGroup.isShown)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.set(userGroupId, userGroup);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tgetEmptyAccessRightValue: (state, getters, rootState, rootGetters) => (userGroupId: string, sectionCode: string, valueId: string): AccessRightValue => {\n\t\t\t\tconst values = rootGetters['accessRights/getEmptyValue'](sectionCode, valueId);\n\n\t\t\t\treturn {\n\t\t\t\t\tid: valueId,\n\t\t\t\t\tvalues,\n\t\t\t\t\tisModified: state.collection.get(userGroupId).isNew,\n\t\t\t\t};\n\t\t\t},\n\t\t\tdefaultAccessRightValues: (state, getters, rootState): Map<string, AccessRightValue> => {\n\t\t\t\tconst result = new Map();\n\n\t\t\t\tfor (const section of rootState.accessRights.collection.values())\n\t\t\t\t{\n\t\t\t\t\tfor (const [rightId, right] of section.rights)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Type.isNil(right.defaultValue))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult.set(rightId, {\n\t\t\t\t\t\t\tid: rightId,\n\t\t\t\t\t\t\tvalues: right.defaultValue,\n\t\t\t\t\t\t\tisModified: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tisModified: (state): boolean => {\n\t\t\t\tif (state.deleted.size > 0)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tfor (const userGroup of state.collection.values())\n\t\t\t\t{\n\t\t\t\t\tif (userGroup.isNew || userGroup.isModified)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const value of userGroup.accessRights.values())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (value.isModified)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tisMaxVisibleUserGroupsReached: (state, getters, rootState, rootGetters): boolean => {\n\t\t\t\tif (!rootGetters['application/isMaxVisibleUserGroupsSet'])\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn getters.shown.size >= rootState.application.options.maxVisibleUserGroups;\n\t\t\t},\n\t\t};\n\t}\n\n\tgetActions(): ActionTree<UserGroupsState>\n\t{\n\t\treturn {\n\t\t\tsetAccessRightValues: (store, payload): void => {\n\t\t\t\tthis.#setAccessRightValuesAction(store, payload);\n\t\t\t},\n\t\t\tsetMinAccessRightValuesForUserGroup: (store, payload): void => {\n\t\t\t\tthis.#setMinAccessRightValuesForUserGroupAction(store, payload);\n\t\t\t},\n\t\t\tsetMaxAccessRightValuesForUserGroup: (store, payload): void => {\n\t\t\t\tthis.#setMaxAccessRightValuesForUserGroupAction(store, payload);\n\t\t\t},\n\t\t\tsetRoleTitle: (store, payload): void => {\n\t\t\t\tthis.#setRoleTitleAction(store, payload);\n\t\t\t},\n\t\t\taddMember: (store, payload): void => {\n\t\t\t\tthis.#addMemberAction(store, payload);\n\t\t\t},\n\t\t\tremoveMember: (store, payload): void => {\n\t\t\t\tthis.#removeMemberAction(store, payload);\n\t\t\t},\n\t\t\tcopyUserGroup: (store, payload): void => {\n\t\t\t\tthis.#copyUserGroupAction(store, payload);\n\t\t\t},\n\t\t\taddUserGroup: (store): void => {\n\t\t\t\tthis.#addUserGroupAction(store);\n\t\t\t},\n\t\t\tremoveUserGroup: (store, payload): void => {\n\t\t\t\tthis.#removeUserGroupAction(store, payload);\n\t\t\t},\n\t\t\tshowUserGroup: (store, payload): void => {\n\t\t\t\tthis.#showUserGroupAction(store, payload);\n\t\t\t},\n\t\t\thideUserGroup: (store, payload): void => {\n\t\t\t\tthis.#hideUserGroupAction(store, payload);\n\t\t\t},\n\t\t};\n\t}\n\n\t#setAccessRightValuesAction(store: UserGroupsStore, payload: SetAccessRightValuesPayload): void\n\t{\n\t\tif (!Type.isSet(payload.values))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to set not-Set values', payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#isUserGroupExists(store, payload.userGroupId))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to set value to a user group that dont exists', payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#isValueExistsInStructure(store, payload.sectionCode, payload.valueId))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to set value to a right that dont exists in structure', payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tstore.commit('setAccessRightValues', {\n\t\t\tuserGroupId: payload.userGroupId,\n\t\t\tvalueId: payload.valueId,\n\t\t\tvalues: payload.values,\n\t\t\tisModified: this.#isValueModified(\n\t\t\t\tpayload.userGroupId,\n\t\t\t\tpayload.valueId,\n\t\t\t\tpayload.values,\n\t\t\t\tstore.rootGetters['accessRights/getEmptyValue'](payload.sectionCode, payload.valueId),\n\t\t\t),\n\t\t});\n\t}\n\n\t#setMinAccessRightValuesForUserGroupAction(store: UserGroupsStore, { userGroupId }): void\n\t{\n\t\tfor (const section: AccessRightSection of store.rootState.accessRights.collection.values())\n\t\t{\n\t\t\tfor (const item of section.rights.values())\n\t\t\t{\n\t\t\t\tconst valueToSet = this.#getMinValueForGroupAction(\n\t\t\t\t\titem,\n\t\t\t\t\tstore.rootGetters['accessRights/getEmptyValue'](section.sectionCode, item.id),\n\t\t\t\t);\n\t\t\t\tif (Type.isNil(valueToSet))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tvoid store.dispatch('setAccessRightValues', {\n\t\t\t\t\tuserGroupId,\n\t\t\t\t\tsectionCode: section.sectionCode,\n\t\t\t\t\tvalueId: item.id,\n\t\t\t\t\tvalues: valueToSet,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tvoid store.dispatch('accessRights/expandAllSections', null, { root: true });\n\t}\n\n\t#getMinValueForGroupAction(item: AccessRightItem, emptyValue: Set<string>): ?Set<string>\n\t{\n\t\tconst setEmpty = Type.isBoolean(item.setEmptyOnGroupActions) && item.setEmptyOnGroupActions;\n\t\tif (setEmpty)\n\t\t{\n\t\t\treturn emptyValue;\n\t\t}\n\n\t\tif (!Type.isNil(item.minValue))\n\t\t{\n\t\t\treturn item.minValue;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#setMaxAccessRightValuesForUserGroupAction(store: UserGroupsStore, { userGroupId }): void\n\t{\n\t\tfor (const section: AccessRightSection of store.rootState.accessRights.collection.values())\n\t\t{\n\t\t\tfor (const item of section.rights.values())\n\t\t\t{\n\t\t\t\tconst valueToSet = this.#getMaxValueForGroupAction(\n\t\t\t\t\titem,\n\t\t\t\t\tstore.rootGetters['accessRights/getEmptyValue'](section.sectionCode, item.id),\n\t\t\t\t);\n\t\t\t\tif (Type.isNil(valueToSet))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tvoid store.dispatch('setAccessRightValues', {\n\t\t\t\t\tuserGroupId,\n\t\t\t\t\tsectionCode: section.sectionCode,\n\t\t\t\t\tvalueId: item.id,\n\t\t\t\t\tvalues: valueToSet,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tvoid store.dispatch('accessRights/expandAllSections', null, { root: true });\n\t}\n\n\t#getMaxValueForGroupAction(item: AccessRightItem, emptyValue: Set<string>): ?Set<string>\n\t{\n\t\tconst setEmpty = Type.isBoolean(item.setEmptyOnGroupActions) && item.setEmptyOnGroupActions;\n\t\tif (setEmpty)\n\t\t{\n\t\t\treturn emptyValue;\n\t\t}\n\n\t\tif (!Type.isNil(item.maxValue))\n\t\t{\n\t\t\treturn item.maxValue;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#setRoleTitleAction(store: UserGroupsStore, payload: {userGroupId: string, title: string}): void\n\t{\n\t\tif (!Type.isString(payload.title))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to set role title with something other than string', payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#isUserGroupExists(store, payload.userGroupId))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to update user group that dont exists', payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tstore.commit('setRoleTitle', payload);\n\t}\n\n\t#addMemberAction(store: UserGroupsStore, payload: {userGroupId: string, accessCode: string, member: Member }): void\n\t{\n\t\tif (!this.#isUserGroupExists(store, payload.userGroupId))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to add member to a user group that dont exists', payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!Type.isStringFilled(payload.accessCode)\n\t\t\t|| !Type.isStringFilled(payload.member.id)\n\t\t\t|| !Type.isStringFilled(payload.member.type)\n\t\t\t|| !Type.isStringFilled(payload.member.name)\n\t\t\t|| !(Type.isNil(payload.member.avatar) || Type.isStringFilled(payload.member.avatar))\n\t\t)\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to add member with invalid payload', payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tstore.commit('addMember', payload);\n\t}\n\n\t#removeMemberAction(store: UserGroupsStore, payload: {userGroupId: string, accessCode: string }): void\n\t{\n\t\tif (!this.#isUserGroupExists(store, payload.userGroupId))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to remove member from a user group that dont exists', payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isStringFilled(payload.accessCode))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to remove member with invalid payload', payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tstore.commit('removeMember', payload);\n\t}\n\n\t#copyUserGroupAction(store: UserGroupsStore, { userGroupId }): void\n\t{\n\t\tconst sourceGroup = this.#getUserGroup(store.state, userGroupId);\n\n\t\tif (!sourceGroup)\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to copy user group that dont exists', { userGroupId });\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst emptyGroup = this.getElementState();\n\n\t\tconst copy: UserGroup = {\n\t\t\t...Runtime.clone(sourceGroup),\n\t\t\tid: emptyGroup.id,\n\t\t\ttitle: Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPIED_ROLE_NAME', {\n\t\t\t\t'#ORIGINAL#': sourceGroup.title,\n\t\t\t}),\n\t\t\tisNew: true,\n\t\t\tisModified: true,\n\t\t\tisShown: true,\n\t\t};\n\n\t\tfor (const value of copy.accessRights.values())\n\t\t{\n\t\t\t// is a new group all values are modified\n\t\t\tvalue.isModified = true;\n\t\t}\n\n\t\tstore.commit('addUserGroup', {\n\t\t\tuserGroup: copy,\n\t\t});\n\t}\n\n\t#addUserGroupAction(store: UserGroupsStore): void\n\t{\n\t\tconst newGroup = this.getElementState();\n\t\tnewGroup.accessRights = Runtime.clone(store.getters.defaultAccessRightValues);\n\n\t\tstore.commit('addUserGroup', {\n\t\t\tuserGroup: newGroup,\n\t\t});\n\t}\n\n\t#removeUserGroupAction(store: UserGroupsStore, { userGroupId }): void\n\t{\n\t\tconst userGroup = this.#getUserGroup(store.state, userGroupId);\n\t\tif (!userGroup)\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to remove user group that dont exists', { userGroupId });\n\n\t\t\treturn;\n\t\t}\n\n\t\tstore.commit('removeUserGroup', { userGroupId });\n\t\tif (!userGroup.isNew)\n\t\t{\n\t\t\tstore.commit('markUserGroupForDeletion', { userGroupId });\n\t\t}\n\t}\n\n\t#showUserGroupAction(store: UserGroupsState, { userGroupId }): void\n\t{\n\t\tif (!this.#isUserGroupExists(store, userGroupId))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to show user group that dont exists', { userGroupId });\n\n\t\t\treturn;\n\t\t}\n\n\t\tstore.commit('showUserGroup', { userGroupId });\n\t}\n\n\t#hideUserGroupAction(store: UserGroupsState, { userGroupId }): void\n\t{\n\t\tif (!this.#isUserGroupExists(store, userGroupId))\n\t\t{\n\t\t\tconsole.warn('ui.accessrights.v2: Attempt to shrink user group that dont exists', { userGroupId });\n\n\t\t\treturn;\n\t\t}\n\n\t\tstore.commit('hideUserGroup', { userGroupId });\n\t}\n\n\t#isUserGroupExists(store, userGroupId: string): boolean\n\t{\n\t\tconst group = this.#getUserGroup(store.state, userGroupId);\n\n\t\treturn Boolean(group);\n\t}\n\n\t#getUserGroup(state: UserGroupsState, userGroupId: string): ?UserGroup\n\t{\n\t\treturn state.collection.get(userGroupId);\n\t}\n\n\t#isValueExistsInStructure(store, sectionCode: string, valueId: string): boolean\n\t{\n\t\tconst section: ?AccessRightSection = store.rootState.accessRights.collection.get(sectionCode);\n\n\t\treturn section?.rights.has(valueId);\n\t}\n\n\tgetMutations(): MutationTree<UserGroupsState>\n\t{\n\t\treturn {\n\t\t\tsetAccessRightValues: (state, { userGroupId, valueId, values, isModified }) => {\n\t\t\t\tconst userGroup = this.#getUserGroup(state, userGroupId);\n\n\t\t\t\tconst accessRightValue = userGroup.accessRights.get(valueId);\n\n\t\t\t\tif (!accessRightValue)\n\t\t\t\t{\n\t\t\t\t\tuserGroup.accessRights.set(\n\t\t\t\t\t\tvalueId,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: valueId,\n\t\t\t\t\t\t\tvalues,\n\t\t\t\t\t\t\tisModified,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\taccessRightValue.values = values;\n\t\t\t\taccessRightValue.isModified = isModified;\n\t\t\t},\n\t\t\tsetRoleTitle: (state, { userGroupId, title }) => {\n\t\t\t\tconst userGroup = this.#getUserGroup(state, userGroupId);\n\t\t\t\tuserGroup.title = title;\n\t\t\t\tuserGroup.isModified = this.#isUserGroupModified(userGroup);\n\t\t\t},\n\t\t\taddMember: (state, { userGroupId, accessCode, member }) => {\n\t\t\t\tconst userGroup = this.#getUserGroup(state, userGroupId);\n\t\t\t\tuserGroup.members.set(accessCode, member);\n\t\t\t\tuserGroup.isModified = this.#isUserGroupModified(userGroup);\n\t\t\t},\n\t\t\tremoveMember: (state, { userGroupId, accessCode }) => {\n\t\t\t\tconst userGroup = this.#getUserGroup(state, userGroupId);\n\t\t\t\tuserGroup.members.delete(accessCode);\n\t\t\t\tuserGroup.isModified = this.#isUserGroupModified(userGroup);\n\t\t\t},\n\t\t\taddUserGroup: (state, { userGroup }) => {\n\t\t\t\tstate.collection.set(userGroup.id, userGroup);\n\t\t\t},\n\t\t\tremoveUserGroup: (state, { userGroupId }) => {\n\t\t\t\tstate.collection.delete(userGroupId);\n\t\t\t},\n\t\t\tmarkUserGroupForDeletion: (state, { userGroupId }) => {\n\t\t\t\tstate.deleted.add(userGroupId);\n\t\t\t},\n\t\t\tshowUserGroup: (state, { userGroupId }) => {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tstate.collection.get(userGroupId).isShown = true;\n\t\t\t},\n\t\t\thideUserGroup: (state, { userGroupId }) => {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tstate.collection.get(userGroupId).isShown = false;\n\t\t\t},\n\t\t};\n\t}\n\n\t#isValueModified(userGroupId: string, valueId: string, values: Set<string>, emptyValue: Set<string>): boolean\n\t{\n\t\tconst initialGroup = this.#initialUserGroups.get(userGroupId);\n\t\tif (!initialGroup)\n\t\t{\n\t\t\t// its a newly created group, all values are modified\n\n\t\t\treturn true;\n\t\t}\n\n\t\tconst initialValues = initialGroup.accessRights.get(valueId)?.values ?? emptyValue;\n\n\t\t// use native Sets instead of Vue-wrapped proxy-sets, they throw an error on `symmetricDifference`\n\t\treturn !this.#isSetsEqual(new Set(initialValues), new Set(values));\n\t}\n\n\t#isSetsEqual(a: Set, b: Set): boolean\n\t{\n\t\tif (Type.isFunction(a.symmetricDifference))\n\t\t{\n\t\t\t// native way to compare sets for modern browsers\n\t\t\treturn a.symmetricDifference(b).size === 0;\n\t\t}\n\n\t\t// polyfill\n\n\t\tif (a.size !== b.size)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (const value of a)\n\t\t{\n\t\t\tif (!b.has(value))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (const value of b)\n\t\t{\n\t\t\tif (!a.has(value))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#isUserGroupModified(userGroup: UserGroup): boolean\n\t{\n\t\tif (userGroup.isNew)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst initialGroup = this.#initialUserGroups.get(userGroup.id);\n\t\tif (!initialGroup)\n\t\t{\n\t\t\tthrow new Error('ui.accessrights.v2: initial user group not found');\n\t\t}\n\n\t\tif (userGroup.title !== initialGroup.title)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst initialAccessCodes = new Set(initialGroup.members.keys());\n\t\tconst currentAccessCodes = new Set(userGroup.members.keys());\n\n\t\treturn !this.#isSetsEqual(initialAccessCodes, currentAccessCodes);\n\t}\n}\n","import { Builder, type Store } from 'ui.vue3.vuex';\nimport type { AccessRightsCollection } from './model/access-rights-model';\nimport { AccessRightsModel } from './model/access-rights-model';\nimport { ApplicationModel, type Options } from './model/application-model';\nimport type { UserGroupsCollection } from './model/user-groups-model';\nimport { UserGroupsModel } from './model/user-groups-model';\n\nexport function createStore(\n\toptions: Readonly<Options>,\n\tuserGroups: UserGroupsCollection,\n\taccessRights: AccessRightsCollection,\n\tappGuid: string | number,\n): {\n\tstore: Store,\n\tresetState: () => Promise<void>,\n\tuserGroupsModel: UserGroupsModel,\n\taccessRightsModel: AccessRightsModel,\n}\n{\n\tconst userGroupsModel = UserGroupsModel.create()\n\t\t.setInitialUserGroups(userGroups)\n\t;\n\tconst accessRightsModel = AccessRightsModel.create()\n\t\t.setInitialAccessRights(accessRights)\n\t;\n\n\tconst { store, builder } = Builder\n\t\t.init()\n\t\t.addModel(\n\t\t\tApplicationModel.create()\n\t\t\t\t.setOptions(options)\n\t\t\t\t.setGuid(appGuid)\n\t\t\t,\n\t\t)\n\t\t.addModel(userGroupsModel)\n\t\t.addModel(accessRightsModel)\n\t\t.syncBuild()\n\t;\n\n\treturn {\n\t\tstore,\n\t\tresetState: () => builder.clearModelState(),\n\t\tuserGroupsModel,\n\t\taccessRightsModel,\n\t};\n}\n","import type { AccessRightValue, Member, UserGroup, UserGroupsCollection } from '../../../user-groups-model';\nimport { NEW_USER_GROUP_ID_PREFIX } from '../../../user-groups-model';\nimport type { ExternalAccessRightValue, ExternalUserGroup } from '../../internalizer/user-groups-internalizer';\n\nexport type UserGroupSaveData = ExternalUserGroup & {\n\tmembers: null,\n\taccessCodes: { [accessCode: string]: string },\n};\n\n/**\n * @abstract\n */\nexport class BaseUserGroupsExporter implements Transformer<UserGroupsCollection, UserGroupSaveData[]>\n{\n\ttransform(source: UserGroupsCollection): UserGroupSaveData[]\n\t{\n\t\tconst result: UserGroupSaveData[] = [];\n\n\t\tfor (const userGroup of source.values())\n\t\t{\n\t\t\tresult.push({\n\t\t\t\tid: userGroup.id.startsWith(NEW_USER_GROUP_ID_PREFIX) ? '0' : userGroup.id,\n\t\t\t\ttitle: userGroup.title,\n\t\t\t\taccessCodes: this.#transformAccessCodes(userGroup.members),\n\t\t\t\taccessRights: this.#transformAccessRightValues(userGroup),\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#transformAccessCodes(members: Map<string, Member>): { [accessCode: string]: string }\n\t{\n\t\tconst result = {};\n\n\t\tfor (const [accessCode, member] of members)\n\t\t{\n\t\t\tresult[accessCode] = member.type;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#transformAccessRightValues(userGroup: UserGroup): ExternalAccessRightValue[]\n\t{\n\t\tconst result: ExternalAccessRightValue[] = [];\n\n\t\tfor (const accessRightValue of userGroup.accessRights.values())\n\t\t{\n\t\t\tif (!this.shouldBeIncludedInExport(userGroup, accessRightValue))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (const singleValue of accessRightValue.values)\n\t\t\t{\n\t\t\t\tresult.push({\n\t\t\t\t\tid: accessRightValue.id,\n\t\t\t\t\tvalue: singleValue,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * @abstract\n\t * @protected\n\t */\n\tshouldBeIncludedInExport(userGroup: UserGroup, accessRightValue: AccessRightValue): boolean\n\t{\n\t\tthrow new Error('Not implemented');\n\t}\n}\n","import type { AccessRightValue, UserGroup } from '../../../user-groups-model';\nimport { BaseUserGroupsExporter } from './base-user-groups-exporter';\n\nexport class AllUserGroupsExporter extends BaseUserGroupsExporter\n{\n\tshouldBeIncludedInExport(userGroup: UserGroup, accessRightValue: AccessRightValue): boolean\n\t{\n\t\treturn true;\n\t}\n}\n","import type { AccessRightValue, UserGroup } from '../../../user-groups-model';\nimport { BaseUserGroupsExporter } from './base-user-groups-exporter';\n\nexport class OnlyChangedUserGroupsExporter extends BaseUserGroupsExporter\n{\n\tshouldBeIncludedInExport(userGroup: UserGroup, accessRightValue: AccessRightValue): boolean\n\t{\n\t\treturn userGroup.isNew || accessRightValue.isModified;\n\t}\n}\n","import { Text, Type } from 'main.core';\nimport { DEFAULT_ALIAS_SEPARATOR, normalizeAliasKey } from '../../../../utils';\nimport type {\n\tAccessRightItem,\n\tAccessRightsCollection,\n\tAccessRightSection,\n\tAccessRightSectionIcon,\n\tVariable,\n} from '../../access-rights-model';\nimport type { Transformer } from '../transformer';\n\nexport type ExternalAccessRightSection = {\n\tsectionTitle: ?any,\n\tsectionSubTitle: ?any,\n\tsectionCode: ?any,\n\tsectionHint: ?any,\n\tsectionIcon: ?any,\n\trights: ExternalAccessRightItem[],\n};\n\nexport type ExternalAccessRightItem = {\n\tid: any,\n\ttype: any,\n\ttitle: any,\n\thint: ?any,\n\tgroup: ?any,\n\tgroupHead: ?any,\n\tminValue?: any | any[],\n\tmaxValue?: any | any[],\n\tdefaultValue?: any | any[],\n\tsetEmptyOnGroupActions: ?any,\n\n\tvariables?: ExternalVariable[],\n\n\tallSelectedCode: ?any,\n\tselectedVariablesAliases: {[key: string]: string} & {separator?: string},\n\tenableSearch?: any,\n\tshowAvatars?: any,\n\tcompactView?: any,\n\tdisableSelectAll?: any,\n\thintTitle: ?any,\n};\n\nexport type ExternalVariable = {\n\tid: any,\n\ttitle: any,\n\tentityId: ?any,\n\tsupertitle: ?any,\n\tavatar: ?any,\n\tavatarOptions: ?any,\n\tselectionStrategy: ?any,\n\tconflictsWith?: any[],\n\trequires?: any[],\n\tsecondary: ?any,\n}\n\nexport class AccessRightsInternalizer implements Transformer<ExternalAccessRightSection[], AccessRightsCollection>\n{\n\ttransform(externalSource: ExternalAccessRightSection[]): AccessRightsCollection\n\t{\n\t\tconst result: AccessRightsCollection = new Map();\n\n\t\tfor (const external of externalSource)\n\t\t{\n\t\t\tconst internalized = this.#internalizeExternalSection(external);\n\t\t\tresult.set(internalized.sectionCode, internalized);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#internalizeExternalSection(externalSection: ExternalAccessRightSection): AccessRightSection\n\t{\n\t\tconst internalizedSection: AccessRightSection = {\n\t\t\tsectionCode: Type.isStringFilled(externalSection.sectionCode)\n\t\t\t\t? externalSection.sectionCode\n\t\t\t\t: Text.getRandom(),\n\t\t\tsectionTitle: String(externalSection.sectionTitle),\n\t\t\tsectionSubTitle: Type.isStringFilled(externalSection.sectionSubTitle)\n\t\t\t\t? externalSection.sectionSubTitle\n\t\t\t\t: null,\n\t\t\tsectionHint: Type.isStringFilled(externalSection.sectionHint)\n\t\t\t\t? externalSection.sectionHint\n\t\t\t\t: null,\n\t\t\tsectionIcon: this.#internalizeExternalIcon(externalSection.sectionIcon),\n\t\t\trights: new Map(),\n\t\t\tisExpanded: true,\n\t\t\tisShown: true,\n\t\t};\n\n\t\tfor (const externalItem of externalSection.rights)\n\t\t{\n\t\t\tconst internalizedItem = this.#internalizeExternalItem(externalItem);\n\n\t\t\tinternalizedSection.rights.set(internalizedItem.id, internalizedItem);\n\t\t}\n\n\t\treturn internalizedSection;\n\t}\n\n\t#internalizeExternalIcon(externalIcon: ?any): ?AccessRightSectionIcon\n\t{\n\t\tif (Type.isStringFilled(externalIcon?.type) && Type.isStringFilled(externalIcon?.bgColor))\n\t\t{\n\t\t\treturn {\n\t\t\t\ttype: externalIcon.type,\n\t\t\t\tbgColor: externalIcon.bgColor,\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#internalizeExternalItem(externalItem: ExternalAccessRightItem): AccessRightItem\n\t{\n\t\tconst [aliases, separator] = this.#internalizeSelectedVariablesAliases(externalItem.selectedVariablesAliases);\n\n\t\tconst normalizedItem: AccessRightItem = {\n\t\t\tid: String(externalItem.id),\n\t\t\ttype: String(externalItem.type),\n\t\t\ttitle: String(externalItem.title),\n\t\t\thint: Type.isStringFilled(externalItem.hint) ? externalItem.hint : null,\n\t\t\tgroup: Type.isNil(externalItem.group) ? null : String(externalItem.group),\n\t\t\tgroupHead: Type.isBoolean(externalItem.groupHead) ? externalItem.groupHead : false,\n\t\t\tisShown: true,\n\t\t\tminValue: this.#internalizeValueSet(externalItem.minValue),\n\t\t\tmaxValue: this.#internalizeValueSet(externalItem.maxValue),\n\t\t\tdefaultValue: this.#internalizeValueSet(externalItem.defaultValue),\n\t\t\temptyValue: this.#internalizeValueSet(externalItem.emptyValue),\n\t\t\tsetEmptyOnGroupActions: Type.isBoolean(externalItem.setEmptyOnGroupActions)\n\t\t\t\t? externalItem.setEmptyOnGroupActions\n\t\t\t\t: null,\n\t\t\tvariables: Type.isArray(externalItem.variables) ? new Map() : null,\n\n\t\t\tallSelectedCode: Type.isStringFilled(externalItem.allSelectedCode) ? externalItem.allSelectedCode : null,\n\t\t\tselectedVariablesAliases: aliases,\n\t\t\tselectedVariablesAliasesSeparator: separator,\n\t\t\tenableSearch: Type.isBoolean(externalItem.enableSearch) ? externalItem.enableSearch : null,\n\t\t\tshowAvatars: Type.isBoolean(externalItem.showAvatars) ? externalItem.showAvatars : null,\n\t\t\tcompactView: Type.isBoolean(externalItem.compactView) ? externalItem.compactView : null,\n\t\t\tdisableSelectAll: Type.isBoolean(externalItem.disableSelectAll) ? externalItem.disableSelectAll : null,\n\t\t\thintTitle: Type.isStringFilled(externalItem.hintTitle) ? externalItem.hintTitle : null,\n\t\t};\n\t\tif (normalizedItem.groupHead || normalizedItem.group)\n\t\t{\n\t\t\tnormalizedItem.isGroupExpanded = false;\n\t\t}\n\n\t\tif (Type.isArray(externalItem.variables))\n\t\t{\n\t\t\tfor (const variable of externalItem.variables)\n\t\t\t{\n\t\t\t\tconst normalizedVariable = this.#internalizeExternalVariable(variable);\n\n\t\t\t\tnormalizedItem.variables.set(normalizedVariable.id, normalizedVariable);\n\t\t\t}\n\t\t}\n\n\t\treturn normalizedItem;\n\t}\n\n\t#internalizeSelectedVariablesAliases(externalAliases: {[key: string]: string} & {separator?: string}): [Map, string]\n\t{\n\t\tif (!Type.isPlainObject(externalAliases))\n\t\t{\n\t\t\treturn [new Map(), DEFAULT_ALIAS_SEPARATOR];\n\t\t}\n\n\t\tconst separator = Type.isString(externalAliases.separator) ? externalAliases.separator : DEFAULT_ALIAS_SEPARATOR;\n\n\t\tconst result = new Map();\n\t\tfor (const [key, value] of Object.entries(externalAliases))\n\t\t{\n\t\t\tif (key === 'separator')\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tresult.set(normalizeAliasKey(key, separator), String(value));\n\t\t}\n\n\t\treturn [result, separator];\n\t}\n\n\t#internalizeValueSet(value: any | any[] | undefined): ?Set<string>\n\t{\n\t\tif (Type.isNil(value))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (Type.isArray(value))\n\t\t{\n\t\t\treturn new Set(value.map((item) => String(item)));\n\t\t}\n\n\t\treturn new Set([String(value)]);\n\t}\n\n\t#internalizeExternalVariable(externalVariable: ExternalVariable): Variable\n\t{\n\t\treturn {\n\t\t\tid: String(externalVariable.id),\n\t\t\ttitle: String(externalVariable.title),\n\t\t\tentityId: Type.isStringFilled(externalVariable.entityId) ? externalVariable.entityId : null,\n\t\t\tsupertitle: Type.isStringFilled(externalVariable.supertitle) ? externalVariable.supertitle : null,\n\t\t\tavatar: Type.isStringFilled(externalVariable.avatar) ? externalVariable.avatar : null,\n\t\t\tavatarOptions: Type.isPlainObject(externalVariable.avatarOptions) ? externalVariable.avatarOptions : null,\n\t\t\tselectionStrategy: Type.isStringFilled(externalVariable.selectionStrategy)\n\t\t\t\t? externalVariable.selectionStrategy\n\t\t\t\t: null,\n\t\t\tconflictsWith: Type.isArray(externalVariable.conflictsWith)\n\t\t\t\t? new Set(externalVariable.conflictsWith.map((x) => String(x)))\n\t\t\t\t: null,\n\t\t\trequires: Type.isArray(externalVariable.requires)\n\t\t\t\t? new Set(externalVariable.requires.map((x) => String(x)))\n\t\t\t\t: null,\n\t\t\tsecondary: Type.isBoolean(externalVariable.secondary) ? externalVariable.secondary : null,\n\t\t};\n\t}\n}\n","import { Type } from 'main.core';\nimport { ACTION_SAVE, BODY_TYPE, MODE, type Options } from '../../application-model';\nimport type { Transformer } from '../transformer';\n\nexport class ApplicationInternalizer implements Transformer<Options, Readonly<Options>>\n{\n\t// noinspection OverlyComplexFunctionJS\n\ttransform(externalSource: Options): Readonly<Options>\n\t{\n\t\t// freeze tells vue that we don't need reactivity on this state\n\t\t// and prevents accidental modification as well\n\t\treturn this.#deepFreeze({\n\t\t\tcomponent: String(externalSource.component),\n\t\t\tactionSave: Type.isStringFilled(externalSource.actionSave) ? externalSource.actionSave : ACTION_SAVE,\n\t\t\tmode: Type.isStringFilled(externalSource.mode) ? externalSource.mode : MODE,\n\t\t\tbodyType: Type.isStringFilled(externalSource.bodyType) ? externalSource.bodyType : BODY_TYPE,\n\t\t\tadditionalSaveParams: Type.isPlainObject(externalSource.additionalSaveParams)\n\t\t\t\t? externalSource.additionalSaveParams\n\t\t\t\t: null,\n\t\t\tisSaveOnlyChangedRights: Type.isBoolean(externalSource.isSaveOnlyChangedRights)\n\t\t\t\t? externalSource.isSaveOnlyChangedRights\n\t\t\t\t: false,\n\t\t\tmaxVisibleUserGroups: Type.isInteger(externalSource.maxVisibleUserGroups)\n\t\t\t\t? externalSource.maxVisibleUserGroups\n\t\t\t\t: null,\n\t\t\tsearchContainerSelector: Type.isStringFilled(externalSource.searchContainerSelector)\n\t\t\t\t? externalSource.searchContainerSelector\n\t\t\t\t: null,\n\t\t});\n\t}\n\n\t#deepFreeze(target: Object): Readonly<Object>\n\t{\n\t\tif (Type.isObject(target))\n\t\t{\n\t\t\tObject.values(target).forEach((value) => {\n\t\t\t\tthis.#deepFreeze(value);\n\t\t\t});\n\n\t\t\treturn Object.freeze(target);\n\t\t}\n\n\t\treturn target;\n\t}\n}\n","import { Type } from 'main.core';\nimport type { AccessRightValue, UserGroupsCollection } from '../../user-groups-model';\nimport { Member, UserGroup } from '../../user-groups-model';\nimport type { Transformer } from '../transformer';\n\nexport type ExternalUserGroup = {\n\tid: any,\n\ttitle: any,\n\taccessRights: ExternalAccessRightValue[],\n\tmembers: {[accessCode: string]: ExternalMember},\n}\n\nexport type ExternalAccessRightValue = {\n\tid: any,\n\tvalue: any | any[],\n};\n\nexport type ExternalMember = {\n\ttype: any,\n\tid: any,\n\tname: any,\n\tavatar: any,\n};\n\nexport class UserGroupsInternalizer implements Transformer<ExternalUserGroup[], UserGroupsCollection>\n{\n\t#maxVisibleUserGroups: ?number = null;\n\n\tconstructor(maxVisibleUserGroups: ?number)\n\t{\n\t\tif (Type.isInteger(maxVisibleUserGroups))\n\t\t{\n\t\t\tthis.#maxVisibleUserGroups = maxVisibleUserGroups;\n\t\t}\n\t}\n\n\ttransform(externalSource: ExternalUserGroup[]): UserGroupsCollection\n\t{\n\t\tconst result = new Map();\n\n\t\tfor (const externalGroup of externalSource)\n\t\t{\n\t\t\tconst internalGroup = this.#internalizeExternalGroup(externalGroup);\n\t\t\tif (this.#maxVisibleUserGroups > 0 && result.size >= this.#maxVisibleUserGroups)\n\t\t\t{\n\t\t\t\tinternalGroup.isShown = false;\n\t\t\t}\n\n\t\t\tresult.set(internalGroup.id, internalGroup);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#internalizeExternalGroup(externalGroup: ExternalUserGroup): UserGroup\n\t{\n\t\tconst internalizedGroup: UserGroup = {\n\t\t\tid: String(externalGroup.id),\n\t\t\tisNew: false,\n\t\t\tisModified: false,\n\t\t\tisShown: true,\n\t\t\ttitle: String(externalGroup.title),\n\t\t\taccessRights: new Map(),\n\t\t\tmembers: new Map(),\n\t\t};\n\n\t\tfor (const externalValue: ExternalAccessRightValue of externalGroup.accessRights)\n\t\t{\n\t\t\tconst internalizedValue = this.#internalizeExternalAccessRightsValue(externalValue);\n\n\t\t\tif (internalizedGroup.accessRights.has(internalizedValue.id))\n\t\t\t{\n\t\t\t\tfor (const previousValue of internalizedGroup.accessRights.get(internalizedValue.id).values)\n\t\t\t\t{\n\t\t\t\t\tinternalizedValue.values.add(previousValue);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tinternalizedGroup.accessRights.set(internalizedValue.id, internalizedValue);\n\t\t}\n\n\t\tfor (const [accessCode: string, externalMember: ExternalMember] of Object.entries(externalGroup.members))\n\t\t{\n\t\t\tconst internalizedAccessCode = this.#internalizeExternalAccessCode(accessCode);\n\n\t\t\tinternalizedGroup.members.set(internalizedAccessCode, this.#internalizeExternalMember(externalMember));\n\t\t}\n\n\t\treturn internalizedGroup;\n\t}\n\n\t#internalizeExternalAccessRightsValue(externalAccessRightsValue: ExternalAccessRightValue): AccessRightValue\n\t{\n\t\tconst valueId = String(externalAccessRightsValue.id);\n\n\t\tconst internalized: AccessRightValue = {\n\t\t\tid: valueId,\n\t\t\tisModified: false,\n\t\t};\n\n\t\tconst values: Array<any> = Type.isArray(externalAccessRightsValue.value)\n\t\t\t? externalAccessRightsValue.value\n\t\t\t: [externalAccessRightsValue.value];\n\n\t\tinternalized.values = new Set(values.map((x) => String(x)));\n\n\t\treturn internalized;\n\t}\n\n\t#internalizeExternalAccessCode(accessCode: any): string\n\t{\n\t\tlet stringAccessCode = String(accessCode);\n\n\t\tif (/^IU(\\d+)$/.test(stringAccessCode))\n\t\t{\n\t\t\t// `IU` and `U` are basically the same in this extension. differentiation between them is not supported\n\t\t\t// for data consistency, force `U`\n\t\t\tstringAccessCode = stringAccessCode.replace('IU', 'U');\n\t\t}\n\n\t\treturn stringAccessCode;\n\t}\n\n\t#internalizeExternalMember(externalMember: ExternalMember): Member\n\t{\n\t\treturn {\n\t\t\ttype: String(externalMember.type),\n\t\t\tid: String(externalMember.id),\n\t\t\tname: String(externalMember.name),\n\t\t\tavatar: Type.isStringFilled(externalMember.avatar) ? externalMember.avatar : null,\n\t\t};\n\t}\n}\n","import { Type } from 'main.core';\nimport type { UserGroupsCollection } from '../user-groups-model';\nimport type { Transformer } from './transformer';\n\nexport class ShownUserGroupsCopier implements Transformer<UserGroupsCollection, UserGroupsCollection>\n{\n\t#srcUserGroups: UserGroupsCollection;\n\t#maxVisibleUserGroups: ?number = null;\n\n\tconstructor(srcUserGroups: UserGroupsCollection, maxVisibleUserGroups: ?number)\n\t{\n\t\tthis.#srcUserGroups = srcUserGroups;\n\t\tif (Type.isInteger(maxVisibleUserGroups))\n\t\t{\n\t\t\tthis.#maxVisibleUserGroups = maxVisibleUserGroups;\n\t\t}\n\t}\n\n\t/**\n\t * WARNING! Mutates `externalSource`. Src is not copied for perf reasons, since we don't need it functionally\n\t */\n\ttransform(externalSource: UserGroupsCollection): UserGroupsCollection\n\t{\n\t\tfor (const [userGroupId, userGroup] of externalSource)\n\t\t{\n\t\t\tconst srcUserGroup = this.#srcUserGroups.get(userGroupId);\n\t\t\tif (srcUserGroup)\n\t\t\t{\n\t\t\t\tuserGroup.isShown = srcUserGroup.isShown;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// likely it's a just created user group\n\t\t\t\tuserGroup.isShown = true;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#maxVisibleUserGroups > 0)\n\t\t{\n\t\t\tthis.#ensureThatNoMoreUserGroupsThanMaxIsShown(externalSource);\n\t\t}\n\n\t\treturn externalSource;\n\t}\n\n\t#ensureThatNoMoreUserGroupsThanMaxIsShown(userGroups: UserGroupsCollection): void\n\t{\n\t\tlet shownCount = 0;\n\t\tfor (const userGroup of userGroups.values())\n\t\t{\n\t\t\tif (!userGroup.isShown)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tshownCount++;\n\n\t\t\tif (shownCount > this.#maxVisibleUserGroups)\n\t\t\t{\n\t\t\t\tuserGroup.isShown = false;\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ajax as Ajax, type AjaxResponse, Dom, type JsonObject, Loc, Runtime, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Button, ButtonColor, ButtonSize, CancelButton } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { BitrixVue, type VueCreateAppResult } from 'ui.vue3';\nimport type { Store } from 'ui.vue3.vuex';\nimport { Grid } from './components/grid';\nimport 'ui.notification';\nimport { createStore } from './store/index';\nimport type { AccessRightsCollection, AccessRightsModel } from './store/model/access-rights-model';\nimport type { Options } from './store/model/application-model';\nimport { AllUserGroupsExporter } from './store/model/transformation/backend-exporter/user-groups/all-user-groups-exporter';\nimport { OnlyChangedUserGroupsExporter } from './store/model/transformation/backend-exporter/user-groups/only-changed-user-groups-exporter';\nimport type { ExternalAccessRightSection } from './store/model/transformation/internalizer/access-rights-internalizer';\nimport { AccessRightsInternalizer } from './store/model/transformation/internalizer/access-rights-internalizer';\nimport { ApplicationInternalizer } from './store/model/transformation/internalizer/application-internalizer';\nimport type { ExternalUserGroup } from './store/model/transformation/internalizer/user-groups-internalizer';\nimport { UserGroupsInternalizer } from './store/model/transformation/internalizer/user-groups-internalizer';\nimport { ShownUserGroupsCopier } from './store/model/transformation/shown-user-groups-copier';\nimport type { UserGroupsCollection, UserGroupsModel } from './store/model/user-groups-model';\n\nexport type AppConstructOptions = Options & {\n\trenderTo: HTMLElement;\n\tuserGroups: ExternalUserGroup[];\n\taccessRights: ExternalAccessRightSection[];\n};\n\ntype SaveAjaxResponse = AjaxResponse<{ACCESS_RIGHTS: JsonObject, USER_GROUPS: JsonObject}>;\n\n/**\n * @memberOf BX.UI.AccessRights.V2\n */\nexport class App\n{\n\t#options: AppConstructOptions = {};\n\t#renderTo: HTMLElement;\n\t#buttonPanel: BX.UI.ButtonPanel;\n\n\t#guid: string;\n\t#isUserConfirmedClose: boolean = false;\n\n\t#handleSliderClose: (BaseEvent<BX.SidePanel.Event[]>) => void;\n\n\t#app: VueCreateAppResult;\n\t#store: Store;\n\t#resetState: () => void;\n\t#unwatch: () => void;\n\t#userGroupsModel: UserGroupsModel;\n\t#accessRightsModel: AccessRightsModel;\n\n\tconstructor(options: AppConstructOptions)\n\t{\n\t\tthis.#options = options || {};\n\t\tthis.#renderTo = this.#options.renderTo;\n\t\tthis.#buttonPanel = BX.UI.ButtonPanel || null;\n\n\t\tthis.#guid = Text.getRandom(16);\n\n\t\tthis.#bindEvents();\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tthis.#handleSliderClose = (event: BaseEvent<BX.SidePanel.Event[]>): void => {\n\t\t\tconst [sliderEvent] = event.getData();\n\n\t\t\tconst isSliderBelongsToThisApp = BX.SidePanel?.Instance?.getSliderByWindow(window) === sliderEvent?.getSlider();\n\n\t\t\tif (!isSliderBelongsToThisApp)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#confirmBeforeClosingModifiedSlider(sliderEvent);\n\t\t};\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', this.#handleSliderClose);\n\t}\n\n\t#unbindEvents(): void\n\t{\n\t\tEventEmitter.unsubscribe('SidePanel.Slider:onClose', this.#handleSliderClose);\n\n\t\tthis.#handleSliderClose = null;\n\t}\n\n\tfireEventReset(): void\n\t{\n\t\tconst box = MessageBox.create({\n\t\t\tmessage: Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_MODIFIED_CANCEL_WARNING'),\n\t\t\tmodal: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\t\ttext: Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_MODIFIED_CANCEL_YES_CANCEL'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.#resetState();\n\t\t\t\t\t\tbox.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\tcolor: ButtonColor.LINK,\n\t\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\t\ttext: Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_MODIFIED_CANCEL_NO_CANCEL'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tbox.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tbox.show();\n\t}\n\n\t#tryShowFeaturePromoter(response: SaveAjaxResponse): boolean\n\t{\n\t\tif (!Type.isArrayFilled(response?.errors))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (const error of response.errors)\n\t\t{\n\t\t\tif (Type.isStringFilled(error?.customData?.sliderCode))\n\t\t\t{\n\t\t\t\tRuntime.loadExtension('ui.info-helper').then(({ FeaturePromotersRegistry }) => {\n\t\t\t\t\t/** @see BX.UI.FeaturePromotersRegistry */\n\t\t\t\t\tFeaturePromotersRegistry.getPromoter({ code: error.customData.sliderCode }).show();\n\t\t\t\t}).catch((loadError) => {\n\t\t\t\t\tconsole.error('ui.accessrights.v2: could not load ui.info-helper', loadError);\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#showNotification(title): void\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: title,\n\t\t\tposition: 'top-right',\n\t\t\tautoHideDelay: 3000,\n\t\t});\n\t}\n\n\tsendActionRequest(): void\n\t{\n\t\tif (this.#store.state.application.isSaving || !this.#store.getters['userGroups/isModified'])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.commit('application/setSaving', true);\n\n\t\tthis.#runSaveAjaxRequest()\n\t\t\t.then(({ userGroups, accessRights }) => {\n\t\t\t\tthis.#userGroupsModel.setInitialUserGroups(userGroups);\n\t\t\t\tthis.#accessRightsModel.setInitialAccessRights(accessRights);\n\n\t\t\t\t// reset modification flags and stuff\n\t\t\t\tthis.#resetState();\n\n\t\t\t\tthis.#showNotification(Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SETTINGS_HAVE_BEEN_SAVED'));\n\t\t\t})\n\t\t\t.catch((response: SaveAjaxResponse) => {\n\t\t\t\tconsole.warn('ui.accessrights.v2: error during save', response);\n\n\t\t\t\tif (this.#tryShowFeaturePromoter(response))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#showNotification(response?.errors?.[0]?.message || 'Something went wrong');\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tconst waitContainer = this.#buttonPanel?.getContainer().querySelector('.ui-btn-wait');\n\t\t\t\tDom.removeClass(waitContainer, 'ui-btn-wait');\n\t\t\t\tthis.#store.commit('application/setSaving', false);\n\t\t\t})\n\t\t;\n\t}\n\n\t#runSaveAjaxRequest(): Promise<{ userGroups: UserGroupsCollection, accessRights: AccessRightsCollection }>\n\t{\n\t\tconst internalUserGroups = this.#store.state.userGroups.collection;\n\n\t\tlet userGroups = null;\n\t\tif (this.#store.state.application.options.isSaveOnlyChangedRights)\n\t\t{\n\t\t\tuserGroups = (new OnlyChangedUserGroupsExporter()).transform(internalUserGroups);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tuserGroups = (new AllUserGroupsExporter()).transform(internalUserGroups);\n\t\t}\n\n\t\tconst bodyType = this.#store.state.application.options.bodyType;\n\n\t\t// wrap ajax in native promise\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runComponentAction(\n\t\t\t\tthis.#store.state.application.options.component,\n\t\t\t\tthis.#store.state.application.options.actionSave,\n\t\t\t\t{\n\t\t\t\t\tmode: this.#store.state.application.options.mode,\n\t\t\t\t\t[bodyType]: {\n\t\t\t\t\t\tuserGroups,\n\t\t\t\t\t\tdeletedUserGroups: [...this.#store.state.userGroups.deleted.values()],\n\t\t\t\t\t\tparameters: this.#store.state.application.options.additionalSaveParams,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t)\n\t\t\t\t.then((response: SaveAjaxResponse) => {\n\t\t\t\t\tconst maxVisibleUserGroups = this.#store.state.application.options.maxVisibleUserGroups;\n\n\t\t\t\t\tconst newUserGroups = (new UserGroupsInternalizer(maxVisibleUserGroups))\n\t\t\t\t\t\t.transform(response.data.USER_GROUPS)\n\t\t\t\t\t;\n\n\t\t\t\t\t(new ShownUserGroupsCopier(internalUserGroups, maxVisibleUserGroups)).transform(newUserGroups);\n\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tuserGroups: newUserGroups,\n\t\t\t\t\t\taccessRights: (new AccessRightsInternalizer()).transform(response.data.ACCESS_RIGHTS),\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(reject)\n\t\t\t;\n\t\t});\n\t}\n\n\t#confirmBeforeClosingModifiedSlider(sliderEvent: BX.SidePanel.Event): void\n\t{\n\t\tif (!this.#store.getters['userGroups/isModified'] || this.#isUserConfirmedClose)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsliderEvent.denyAction();\n\n\t\tconst box = MessageBox.create({\n\t\t\ttitle: Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_MODIFIED_CLOSE_WARNING_TITLE'),\n\t\t\tmessage: Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_MODIFIED_CLOSE_WARNING'),\n\t\t\tmodal: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\t\ttext: Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_MODIFIED_CLOSE_YES_CLOSE'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.#isUserConfirmedClose = true;\n\t\t\t\t\t\tbox.close();\n\t\t\t\t\t\tsliderEvent.getSlider().close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew CancelButton({\n\t\t\t\t\tsize: ButtonSize.SMALL,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tbox.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tbox.show();\n\t}\n\n\tdraw(): void\n\t{\n\t\tconst applicationOptions = (new ApplicationInternalizer()).transform(this.#options);\n\n\t\tconst { store, resetState, accessRightsModel, userGroupsModel } = createStore(\n\t\t\tapplicationOptions,\n\t\t\t(new UserGroupsInternalizer(applicationOptions.maxVisibleUserGroups)).transform(this.#options.userGroups),\n\t\t\t(new AccessRightsInternalizer()).transform(this.#options.accessRights),\n\t\t\tthis.#guid,\n\t\t);\n\n\t\tthis.#store = store;\n\t\tthis.#resetState = resetState;\n\t\tthis.#userGroupsModel = userGroupsModel;\n\t\tthis.#accessRightsModel = accessRightsModel;\n\n\t\tthis.#unwatch = this.#store.watch(\n\t\t\t(state, getters) => getters['userGroups/isModified'],\n\t\t\t(newValue) => {\n\t\t\t\tif (newValue)\n\t\t\t\t{\n\t\t\t\t\tthis.#buttonPanel?.show();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#buttonPanel?.hide();\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\n\t\tthis.#app = BitrixVue.createApp(Grid);\n\t\tthis.#app.use(this.#store);\n\n\t\tDom.clean(this.#renderTo);\n\t\tthis.#app.mount(this.#renderTo);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#app.unmount();\n\t\tthis.#app = null;\n\n\t\tthis.#unbindEvents();\n\n\t\tthis.#unwatch();\n\t\tthis.#unwatch = null;\n\n\t\tthis.#store = null;\n\t\tthis.#resetState = null;\n\t\tthis.#userGroupsModel = null;\n\t\tthis.#accessRightsModel = null;\n\t\tthis.#options = null;\n\t\tthis.#buttonPanel = null;\n\n\t\tDom.clean(this.#renderTo);\n\t\tthis.#renderTo = null;\n\t}\n}\n"],"names":["Selector","name","emits","props","userGroup","type","Object","required","bindNode","HTMLElement","computed","selectedItems","result","accessCode","members","keys","push","getItemIdByAccessCode","mounted","Dialog","enableSearch","context","alwaysShowLabels","entities","id","options","intranetUsersOnly","emailUsers","inviteEmployeeLink","inviteGuestLink","selectMode","allowSelectRootDepartment","allowFlatDepartments","dynamicLoad","addProjectMetaUsers","itemOptions","default","link","linkTitle","dynamicSearch","targetNode","preselectedItems","cacheable","events","onMemberAdd","onMemberRemove","onHide","$emit","show","methods","test","match","userId","departmentId","groupId","projectId","postfix","event","member","getMemberFromEvent","$store","dispatch","userGroupId","item","getData","getAccessCodeByItem","getMemberTypeByItem","title","text","avatar","Type","isStringFilled","entityId","isString","endsWith","originalId","subType","customData","get","template","SingleMember","avatarBackgroundImage","encodeURI","noAvatarClass","MAX_SHOWN_MEMBERS","Members","components","data","isSelectorShown","isSelectedMembersPopupShown","popup","shownMembers","size","shownKeyValuePairs","slice","Map","notShownMembersCount","$refs","container","RoleHeading","RichMenuPopup","RichMenuItem","isEdit","isPopupShown","RichMenuItemIcon","mapState","isSaving","state","application","guid","maxVisibleUserGroups","mapGetters","isMaxVisibleUserGroupsReached","isMaxValueSet","isMinValueSet","set","watch","newValue","bindClickedOutsideHandler","$nextTick","input","scrollIntoView","behavior","block","inline","focus","select","unbindClickedOutsideHandler","isNew","beforeUnmount","Event","bind","window","turnOffEditWhenClickedOutside","capture","unbind","target","showDeleteConfirmation","Popup","bindElement","width","overlay","contentPadding","content","$Bitrix","Loc","getMessage","className","animation","buttons","Button","ButtonSize","SMALL","color","ButtonColor","PRIMARY","click","destroy","CancelButton","showActionsMenu","onSetMaxValuesClick","onSetMinValuesClick","onEnableEditClick","onCopyRoleClick","onDeleteRoleClick","CellLayout","ColumnLayout","RolesControl","userGroups","viewDialog","allUserGroups","collection","isMaxVisibleUserGroupsSet","shownGroupsCounter","copyDialogItems","values","tabs","viewDialogItems","copyDialogItem","selected","has","onCreateNewRoleClick","onRoleViewClick","showViewDialog","configure","showCopyDialog","copyDialog","multiple","dropdownMode","showAvatars","items","dialogEvent","getId","footer","getSelectedItems","length","preventDefault","toggleViewDialog","hide","isMaxListenersSet","lastScrollLeft","SyncHorizontalScroll","componentGuid","Text","getRandom","throttledEmitScrollEvent","created","requestAnimationFrameThrottle","emitScrollEvent","sectionsNumber","accessRights","eventEmitter","incrementMaxListeners","subscribe","handleScrollEvent","syncScroll","unsubscribe","scrollLeft","scrollWidth","clientWidth","offsetWidth","scrollLeftOffset","scrollBarWidth","emit","$el","func","callbackSet","invoke","wrapper","args","q","requestAnimationFrame","Header","SearchBox","debouncedSetSearchQuery","setSearchQuery","query","Runtime","debounce","searchQuery","shouldRowBeRendered","accessRightItem","isShown","group","isGroupExpanded","getMultipleSelectedVariablesTitle","selectedVariables","lastVariable","pop","cutLongTitle","VARIABLE_TITLE_MAX_LENGTH","getMultipleSelectedVariablesHintHtml","hintTitle","allVariables","listItems","value","makeSortedVariablesArray","encode","toSort","example","orderMap","index","variableId","sort","a","b","indexA","indexB","isNil","DEFAULT_ALIAS_SEPARATOR","parseAliasKey","key","separator","parts","split","Set","compileAliasKey","sortedParts","join","normalizeAliasKey","parsed","AccessRightsModel","BuilderModel","getName","setInitialAccessRights","rights","getState","clone","getElementState","params","Error","getGetters","shown","sectionCode","section","minValue","maxValue","getEmptyValue","valueId","isFalsy","emptyValue","getSelectedVariablesAlias","selectedVariablesAliasesSeparator","selectedVariablesAliases","getActions","toggleSection","store","console","warn","commit","expandAllSections","collapseAllSections","toggleGroup","groupHead","search","payload","getMutations","isExpanded","expandSection","collapseSection","expandGroup","showItem","itemId","showGroup","showSection","showAll","hideAll","String","lowerQuery","toLowerCase","sectionTitle","includes","sectionSubTitle","SelectedHint","html","isRendered","directives","hint","Icon","inject","iconBgColor","sectionIcon","bgColor","startsWith","PopupHeader","Switcher","SectionIcon","userGroupTitle","rightOrGroupTitle","right","isMinMaxValuesSet","isSelectedAnythingBesidesMin","switcherOptions","PopupContent","notSavedValues","variablesShownInList","variables","variablesWithoutMin","delete","variable","secondary","secondaryVariables","emptyValues","getters","secondarySwitcherOptions","applyButton","ApplyButton","onclick","apply","renderTo","cancelButton","addValue","add","requires","requiredId","conflictsWith","conflictId","otherVariable","removeValue","otherVariableId","setMaxValue","setMinValue","DependentVariables","currentAlias","hintHtml","popupOptions","autoHide","closeEsc","minWidth","padding","Footer","DefaultFooter","constructor","dialog","selectAllButton","Tag","render","selectAll","deselectAllButton","deselectAll","getDialog","onItemStatusChange","getContent","toggleSelectButtons","getItems","Dom","hasClass","addClass","removeClass","forEach","deselect","Multivariables","isAllSelected","allSelectedCode","dialogItems","selectionStrategy","selectedDialogItems","filter","showSelector","height","compactView","searchOptions","allowCreateItem","onItemSelect","onItemDeselect","setEmptyValueIfNoneSelected","disableSelectAll","addedItem","processSelectionLogic","addedValue","setTimeout","removedItem","removedValue","newValues","setValues","allVariablesIds","map","allVariablesIdsWithoutRemoved","candidate","empty","Toggler","isChecked","setValue","POPUP_ID","Variables","emptyVariableId","currentVariableId","firstItem","currentVariableTitle","menuItems","innerEvent","getMenuWindow","close","MenuManager","Cells","freeze","getCellComponent","ValueCell","provide","cellComponent","Column","renderedRights","rightId","HintLocator","appGuid","remember","BX","UI","Hint","createInstance","popupParameters","darkMode","maxWidth","offsetTop","offsetLeft","angle","Cache","MemoryCache","renderHint","clean","hintIconWrapper","setAttribute","append","getHintManager","init","TitleCell","TitleColumn","Section","code","Boolean","subTitle","icon","throttledScrollHandler","throttledResizeHandler","ears","isEarsInited","isLeftShadowShown","isRightShadowShown","sectionHint","throttle","adjustShadowsVisibility","adjustEars","initEars","destroyEars","oldValue","calculateShadowsVisibility","Math","round","toggleEars","Ears","immediateInit","smallSize","style","getWrapper","Grid","loader","searchContainerSelector","shownSections","shownUserGroups","Loader","ACTION_SAVE","MODE","BODY_TYPE","ApplicationModel","setOptions","setGuid","setSaving","NEW_USER_GROUP_ID_PREFIX","UserGroupsModel","setInitialUserGroups","groups","deleted","isModified","getEmptyAccessRightValue","rootState","rootGetters","defaultAccessRightValues","defaultValue","setAccessRightValues","setMinAccessRightValuesForUserGroup","setMaxAccessRightValuesForUserGroup","setRoleTitle","addMember","removeMember","copyUserGroup","addUserGroup","removeUserGroup","showUserGroup","hideUserGroup","accessRightValue","markUserGroupForDeletion","isSet","valueToSet","root","setEmpty","isBoolean","setEmptyOnGroupActions","sourceGroup","emptyGroup","copy","newGroup","initialGroup","initialValues","isFunction","symmetricDifference","initialAccessCodes","currentAccessCodes","createStore","userGroupsModel","create","accessRightsModel","builder","Builder","addModel","syncBuild","resetState","clearModelState","BaseUserGroupsExporter","transform","source","accessCodes","shouldBeIncludedInExport","singleValue","AllUserGroupsExporter","OnlyChangedUserGroupsExporter","AccessRightsInternalizer","externalSource","external","internalized","externalSection","internalizedSection","externalItem","internalizedItem","externalIcon","aliases","normalizedItem","isArray","normalizedVariable","externalAliases","isPlainObject","entries","externalVariable","supertitle","avatarOptions","x","ApplicationInternalizer","component","actionSave","mode","bodyType","additionalSaveParams","isSaveOnlyChangedRights","isInteger","isObject","UserGroupsInternalizer","externalGroup","internalGroup","internalizedGroup","externalValue","internalizedValue","previousValue","externalMember","internalizedAccessCode","externalAccessRightsValue","stringAccessCode","replace","ShownUserGroupsCopier","srcUserGroups","srcUserGroup","shownCount","App","ButtonPanel","fireEventReset","box","MessageBox","message","modal","LINK","sendActionRequest","then","catch","response","errors","finally","waitContainer","getContainer","querySelector","draw","applicationOptions","BitrixVue","createApp","use","mount","unmount","sliderEvent","isSliderBelongsToThisApp","SidePanel","Instance","getSliderByWindow","getSlider","EventEmitter","isArrayFilled","error","sliderCode","loadExtension","FeaturePromotersRegistry","getPromoter","loadError","Notification","Center","notify","position","autoHideDelay","internalUserGroups","Promise","resolve","reject","Ajax","runComponentAction","deletedUserGroups","parameters","newUserGroups","USER_GROUPS","ACCESS_RIGHTS","denyAction"],"mappings":"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"}