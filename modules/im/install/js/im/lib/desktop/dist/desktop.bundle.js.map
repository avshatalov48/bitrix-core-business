{"version":3,"file":"desktop.bundle.js","sources":["../src/desktop.js"],"sourcesContent":["import {Type} from 'main.core';\n\nexport class Desktop\n{\n\tclientVersion = 0;\n\teventHandlers = {};\n\thtmlWrapperHead = null;\n\n\taddCustomEvent(eventName: string, eventHandler: Function): boolean\n\t{\n\t\tconst realHandler = (event) =>\n\t\t{\n\t\t\teventHandler.apply(window, [...Object.values(event.detail)]);\n\t\t};\n\n\t\tif (!this.eventHandlers[eventName])\n\t\t{\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\t}\n\n\t\tthis.eventHandlers[eventName].push(realHandler);\n\t\twindow.addEventListener(eventName, realHandler);\n\n\t\treturn true;\n\t}\n\n\tremoveCustomEvents(eventName: string): boolean\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.eventHandlers[eventName].forEach(eventHandler =>\n\t\t{\n\t\t\twindow.removeEventListener(eventName, eventHandler);\n\t\t});\n\t\tthis.eventHandlers[eventName] = [];\n\n\t\treturn true;\n\t}\n\n\tonCustomEvent(windowTarget, eventName: string, eventParams: Array<any>): boolean\n\t{\n\t\tif (arguments.length === 2)\n\t\t{\n\t\t\teventParams = eventName\n\t\t\teventName = windowTarget;\n\t\t\twindowTarget = 'all';\n\t\t}\n\t\telse if (arguments.length < 2)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst convertedEventParams = {...eventParams};\n\n\t\tif (windowTarget === 'all')\n\t\t{\n\t\t\tconst mainWindow = opener? opener: top;\n\t\t\tmainWindow.BXWindows.forEach(windowItem => {\n\t\t\t\tif (\n\t\t\t\t\twindowItem &&\n\t\t\t\t\twindowItem.name !== '' &&\n\t\t\t\t\twindowItem.BXDesktopWindow &&\n\t\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent(eventName, convertedEventParams);\n\t\t\t\t}\n\t\t\t});\n\t\t\tmainWindow.BXDesktopWindow.DispatchCustomEvent(eventName, convertedEventParams);\n\t\t}\n\t\telse if (Type.isObject(windowTarget) && windowTarget.hasOwnProperty(\"BXDesktopWindow\"))\n\t\t{\n\t\t\twindowTarget.BXDesktopWindow.DispatchCustomEvent(eventName, convertedEventParams);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst existingWindow = this.findWindow(windowTarget);\n\t\t\tif (existingWindow)\n\t\t\t{\n\t\t\t\texistingWindow.BXDesktopWindow.DispatchCustomEvent(eventName, convertedEventParams);\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfindWindow(name: string = 'main'): Object | void\n\t{\n\t\tconst mainWindow = opener? opener: top;\n\t\tif (name === 'main')\n\t\t{\n\t\t\treturn mainWindow;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn mainWindow.BXWindows.find(windowItem => {\n\t\t\t\treturn windowItem.name === name;\n\t\t\t});\n\t\t}\n\t}\n\n\tsetWindowResizable(enabled: boolean = true): boolean\n\t{\n\t\tBXDesktopWindow.SetProperty(\"resizable\", enabled);\n\n\t\treturn true;\n\t}\n\n\tsetWindowClosable(enabled: boolean = true): boolean\n\t{\n\t\tBXDesktopWindow.SetProperty(\"closable\", enabled);\n\n\t\treturn true;\n\t}\n\n\tsetWindowTitle(title: string): boolean\n\t{\n\t\tif (Type.isUndefined(title))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\ttitle = title.trim();\n\t\tif (title.length <= 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tBXDesktopWindow.SetProperty(\"title\", title);\n\n\t\treturn true;\n\t}\n\n\tsetWindowPosition(params: Object): boolean\n\t{\n\t\tBXDesktopWindow.SetProperty(\"position\", params);\n\n\t\treturn true;\n\t}\n\n\tsetWindowMinSize(params: Object): boolean\n\t{\n\t\tif (!params.Width || !params.Height)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tBXDesktopWindow.SetProperty(\"minClientSize\", params);\n\n\t\treturn true;\n\t}\n\n\tgetHtmlPage(content, jsContent, initImJs, bodyClass: string = ''): string\n\t{\n\t\tif (window.BXIM)\n\t\t{\n\t\t\treturn window.BXIM.desktop.getHtmlPage(content, jsContent, initImJs, bodyClass);\n\t\t}\n\n\t\tcontent = content || '';\n\t\tjsContent = jsContent || '';\n\t\tbodyClass = bodyClass || '';\n\n\t\tif (Type.isDomNode(content))\n\t\t{\n\t\t\tcontent = content.outerHTML;\n\t\t}\n\n\t\tif (Type.isDomNode(jsContent))\n\t\t{\n\t\t\tjsContent = jsContent.outerHTML;\n\t\t}\n\n\t\tif (jsContent !== '')\n\t\t{\n\t\t\tjsContent = '<script type=\"text/javascript\">BX.ready(function(){'+jsContent+'});</script>';\n\t\t}\n\n\t\tif (this.isPopupPageLoaded())\n\t\t{\n\t\t\treturn '<div class=\"im-desktop im-desktop-popup '+bodyClass+'\">'+content+jsContent+'</div>';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.htmlWrapperHead == null)\n\t\t\t{\n\t\t\t\tthis.htmlWrapperHead = document.head.outerHTML.replace(/BX\\.PULL\\.start\\([^)]*\\);/g, '');\n\t\t\t}\n\n\t\t\treturn '<!DOCTYPE html><html>'+this.htmlWrapperHead+'<body class=\"im-desktop im-desktop-popup '+bodyClass+'\">'+content+jsContent+'</body></html>';\n\t\t}\n\t}\n\n\tisPopupPageLoaded(): boolean\n\t{\n\t\tif (!this.enableInVersion(45))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (window.BXIM && !window.BXIM.isUtfMode)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!BXInternals)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!BXInternals.PopupTemplate)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (BXInternals.PopupTemplate === '#PLACEHOLDER#')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tenableInVersion(version: number)\n\t{\n\t\tif (Type.isUndefined(BXDesktopSystem))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.getApiVersion() >= parseInt(version);\n\t}\n\n\tgetApiVersion(): number\n\t{\n\t\tif (Type.isUndefined(BXDesktopSystem))\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!this.clientVersion)\n\t\t{\n\t\t\tthis.clientVersion = BXDesktopSystem.GetProperty('versionParts');\n\t\t}\n\n\t\treturn this.clientVersion[3];\n\t}\n\n\tisReady()\n\t{\n\t\treturn typeof(BXDesktopSystem) != \"undefined\";\n\t}\n}"],"names":["Desktop","eventName","eventHandler","realHandler","event","apply","window","Object","values","detail","eventHandlers","push","addEventListener","forEach","removeEventListener","windowTarget","eventParams","arguments","length","convertedEventParams","mainWindow","opener","top","BXWindows","windowItem","name","BXDesktopWindow","DispatchCustomEvent","Type","isObject","hasOwnProperty","existingWindow","findWindow","find","enabled","SetProperty","title","isUndefined","trim","params","Width","Height","content","jsContent","initImJs","bodyClass","BXIM","desktop","getHtmlPage","isDomNode","outerHTML","isPopupPageLoaded","htmlWrapperHead","document","head","replace","enableInVersion","isUtfMode","BXInternals","PopupTemplate","version","BXDesktopSystem","getApiVersion","parseInt","clientVersion","GetProperty"],"mappings":"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"}