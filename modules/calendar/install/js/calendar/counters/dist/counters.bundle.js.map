{"version":3,"file":"counters.bundle.js","sources":["../src/counters.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { CounterPanel } from 'ui.counterpanel';\nimport { EventEmitter } from 'main.core.events';\n\nexport class Counters extends CounterPanel\n{\n\tstatic TYPE_INVITATION = 'invitation';\n\tstatic TYPE_GROUP_INVITATION_TPL = 'calendar_group_invites_\\\\d';\n\n\tconstructor(options)\n\t{\n\t\tsuper({\n\t\t\ttarget: options.countersWrap,\n\t\t\titems: Counters.getCountersValue(options.counters),\n\t\t\tmultiselect: false,\n\t\t});\n\n\t\tthis.search = options.search;\n\t\tthis.userId = options.userId;\n\t\tthis.counters = options.counters;\n\t\tthis.countersWrap = options.countersWrap;\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:activate', this.onActivateItem.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:deactivate', this.onDeactivateItem.bind(this));\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t}\n\n\tonActivateItem(event): void\n\t{\n\t\tconst item = event.getData();\n\t\tconst shouldSetPreset = item.id === Counters.TYPE_INVITATION\n\t\t\t|| Counters.checkCounterIsForGroup(item.id)\n\t\t;\n\n\t\tif (shouldSetPreset)\n\t\t{\n\t\t\tthis.search.setPresetInvitation();\n\t\t}\n\t}\n\n\tonDeactivateItem(): void\n\t{\n\t\tthis.search.resetPreset();\n\t}\n\n\trecalculateCounters(): void\n\t{\n\t\tObject.entries(this.counters).forEach(([code, data]): void => {\n\t\t\tconst item = this.getItemById(code);\n\t\t\titem?.updateValue(data.value);\n\t\t\titem?.updateColor(data.color);\n\t\t});\n\t}\n\n\tmarkCounters(): void\n\t{\n\t\tObject.entries(this.counters).forEach(([code, data]): void => {\n\t\t\tconst item = this.getItemById(code);\n\n\t\t\tif (\n\t\t\t\titem.id === 'invitation'\n\t\t\t\t|| item.id.includes('calendar_group_invites_')\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.fields.MEETING_STATUS === 'Q'\n\t\t\t\t\t? item.activate(false)\n\t\t\t\t\t: item.deactivate(false)\n\t\t\t\t;\n\t\t\t}\n\t\t});\n\t}\n\n\tsetCountersValue(counters): void\n\t{\n\t\tthis.counters = counters;\n\t\tthis.recalculateCounters();\n\t}\n\n\tonFilterApply(): void\n\t{\n\t\tthis.fields = this.search.filter.getFilterFieldsValues();\n\t\tthis.markCounters();\n\t}\n\n\tstatic checkCounterIsForGroup(counterName: string): boolean\n\t{\n\t\treturn new RegExp(Counters.TYPE_GROUP_INVITATION_TPL).test(counterName);\n\t}\n\n\tstatic getCountersValue(counters): Object\n\t{\n\t\treturn Object.entries(counters).map(([code, item]) => {\n\t\t\treturn {\n\t\t\t\tid: code,\n\t\t\t\ttitle: Counters.getCountersName(code),\n\t\t\t\tvalue: item.value,\n\t\t\t\tcolor: item.color,\n\t\t\t};\n\t\t});\n\t}\n\n\tstatic getCountersName(type: string): string | null\n\t{\n\t\tif (\n\t\t\ttype === Counters.TYPE_INVITATION\n\t\t\t|| Counters.checkCounterIsForGroup(type)\n\t\t)\n\t\t{\n\t\t\treturn Loc.getMessage('EC_COUNTER_INVITATION');\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstatic getCounterNameByGroupId(groupId: number): string\n\t{\n\t\treturn Counters.TYPE_GROUP_INVITATION_TPL.replace('\\\\d', groupId);\n\t}\n}\n"],"names":["Counters","CounterPanel","constructor","options","target","countersWrap","items","getCountersValue","counters","multiselect","search","userId","bindEvents","EventEmitter","subscribe","onActivateItem","bind","onDeactivateItem","onFilterApply","event","item","getData","shouldSetPreset","id","TYPE_INVITATION","checkCounterIsForGroup","setPresetInvitation","resetPreset","recalculateCounters","Object","entries","forEach","code","data","getItemById","updateValue","value","updateColor","color","markCounters","includes","fields","MEETING_STATUS","activate","deactivate","setCountersValue","filter","getFilterFieldsValues","counterName","RegExp","TYPE_GROUP_INVITATION_TPL","test","map","title","getCountersName","type","Loc","getMessage","getCounterNameByGroupId","groupId","replace"],"mappings":"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"}
