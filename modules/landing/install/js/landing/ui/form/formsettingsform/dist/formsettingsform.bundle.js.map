{"version":3,"file":"formsettingsform.bundle.js","sources":["../src/formsettingsform.js"],"sourcesContent":["import {Cache, Dom, Tag, Text, Type} from 'main.core';\nimport {BaseForm, BaseFormOptions} from 'landing.ui.form.baseform';\nimport {SmallSwitch} from 'landing.ui.field.smallswitch';\nimport {BaseEvent} from 'main.core.events';\nimport {Link} from 'landing.ui.component.link';\nimport {fetchEventsFromOptions} from 'landing.ui.component.internal';\n\nimport './css/style.css';\n\n/**\n * @memberOf BX.Landing.UI.Form\n */\nexport class FormSettingsForm extends BaseForm\n{\n\tstatic ToggleableType = {\n\t\tLink: 'link',\n\t\tSwitch: 'switch',\n\t};\n\n\tconstructor(\n\t\toptions: BaseFormOptions | {\n\t\t\ttoggleable: boolean,\n\t\t\ttoggleableType: $Values<FormSettingsForm.ToggleableType>,\n\t\t\topened?: boolean,\n\t\t},\n\t)\n\t{\n\t\tsuper({opened: true, ...options});\n\t\tthis.setEventNamespace('BX.Landing.UI.Form.FormSettingsForm');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\t\tDom.addClass(this.layout, 'landing-ui-form-form-settings');\n\n\t\tthis.onFieldChange = this.onFieldChange.bind(this);\n\t\tthis.onSwitchChange = this.onSwitchChange.bind(this);\n\t\tthis.cache = new Cache.MemoryCache();\n\n\t\tif (this.options.toggleable)\n\t\t{\n\t\t\tthis.onSwitchChange(this.options.opened);\n\n\t\t\tif (\n\t\t\t\t!this.options.toggleableType\n\t\t\t\t|| this.options.toggleableType === FormSettingsForm.ToggleableType.Switch\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.getSwitch().setValue(this.options.opened);\n\t\t\t\tDom.prepend(this.getSwitch().getNode(), this.header);\n\t\t\t}\n\n\t\t\tif (this.options.toggleableType === FormSettingsForm.ToggleableType.Link)\n\t\t\t{\n\t\t\t\tDom.clean(this.header);\n\t\t\t\tDom.append(this.getLink().getLayout(), this.header);\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isPlainObject(this.options.help))\n\t\t{\n\t\t\tDom.append(this.getHelp(this.options.help), this.footer);\n\t\t}\n\t}\n\n\tgetHelp(options: {href: string, text: string}): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('help', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-form-help\">\n\t\t\t\t\t<a href=\"${options.href}\" target=\"_blank\">${options.text}</a>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\taddField(field: BaseField)\n\t{\n\t\tif (Type.isFunction(field.subscribe))\n\t\t{\n\t\t\tfield.subscribe('onChange', this.onFieldChange.bind(this));\n\t\t}\n\n\t\tsuper.addField(field);\n\t}\n\n\treplaceField(oldField, newField) {\n\t\tif (Type.isFunction(newField.subscribe))\n\t\t{\n\t\t\tnewField.subscribe('onChange', this.onFieldChange.bind(this));\n\t\t}\n\n\t\tsuper.replaceField(oldField, newField);\n\t}\n\n\tonFieldChange(event: BaseEvent)\n\t{\n\t\tthis.emit('onChange', event.getData());\n\t}\n\n\tgetSwitch(): SmallSwitch\n\t{\n\t\treturn this.cache.remember('switch', () => {\n\t\t\tconst switchField = new SmallSwitch({\n\t\t\t\tvalue: this.options.opened,\n\t\t\t});\n\t\t\tswitchField.subscribe('onChange', (event: BaseEvent) => {\n\t\t\t\tthis.onSwitchChange(event.getTarget().getValue());\n\t\t\t});\n\t\t\treturn switchField;\n\t\t});\n\t}\n\n\tgetLink(): Link\n\t{\n\t\treturn this.cache.remember('link', () => {\n\t\t\treturn new Link({\n\t\t\t\ttext: this.options.title,\n\t\t\t\tcolor: Link.Colors.Grey,\n\t\t\t\tonClick: () => {\n\t\t\t\t\tthis.onSwitchChange(Dom.style(this.body, 'display') === 'none');\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tonSwitchChange(state: boolean)\n\t{\n\t\tif (!state)\n\t\t{\n\t\t\tthis.cache.set('isOpened', false);\n\t\t\tDom.style(this.body, 'display', 'none');\n\t\t\tDom.style(this.layout, 'margin-bottom', '20px');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.cache.set('isOpened', true);\n\t\t\tDom.style(this.body, 'display', null);\n\t\t\tDom.style(this.layout, 'margin-bottom', null);\n\t\t}\n\n\t\tthis.emit('onChange');\n\t}\n\n\tisOpened(): boolean\n\t{\n\t\treturn Text.toBoolean(this.cache.get('isOpened'));\n\t}\n\n\tsetOffsetTop(offset: number)\n\t{\n\t\tDom.style(this.getLayout(), 'margin-top', `${offset}px`);\n\t}\n\n\tclear()\n\t{\n\t\tthis.fields.forEach((field) => {\n\t\t\tif (Type.isFunction(field.getLayout))\n\t\t\t{\n\t\t\t\tDom.remove(field.getLayout());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.remove(field.layout);\n\t\t\t}\n\n\t\t\tfield.unsubscribeAll('onChange');\n\t\t});\n\n\t\tthis.fields.clear();\n\t}\n}"],"names":["FormSettingsForm","options","opened","setEventNamespace","subscribeFromOptions","fetchEventsFromOptions","Dom","addClass","layout","onFieldChange","bind","onSwitchChange","cache","Cache","MemoryCache","toggleable","toggleableType","ToggleableType","Switch","getSwitch","setValue","prepend","getNode","header","Link","clean","append","getLink","getLayout","Type","isPlainObject","help","getHelp","footer","remember","Tag","render","href","text","field","isFunction","subscribe","oldField","newField","event","emit","getData","switchField","SmallSwitch","value","getTarget","getValue","title","color","Colors","Grey","onClick","style","body","state","set","Text","toBoolean","get","offset","fields","forEach","remove","unsubscribeAll","clear","BaseForm"],"mappings":"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"}