this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};this.BX.Calendar.Sync=this.BX.Calendar.Sync||{};(function(exports,ui_dialogs_messagebox,calendar_util,main_core_events,ui_tilegrid,ui_forms,main_popup,main_core){"use strict";function _templateObject5(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="calendar-sync-popup-footer-status">',"</span>\n\t\t"]);_templateObject5=function t(){return e};return e}function _templateObject4(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button class="calendar-sync-popup-footer-btn">',"</button>\n\t\t"]);_templateObject4=function t(){return e};return e}function _templateObject3(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-popup-footer-wrap">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);_templateObject3=function t(){return e};return e}function _templateObject2(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-sync-popup-item">\n\t\t\t\t\t<span class="calendar-sync-popup-item-text ','">','</span>\n\t\t\t\t\t<div class="calendar-sync-popup-item-detail">\n\t\t\t\t\t\t<span class="calendar-sync-popup-item-time">','</span>\n\t\t\t\t\t\t<span class="calendar-sync-popup-item-status ','"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t']);_templateObject2=function t(){return e};return e}function _templateObject(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-popup-list"></div>\n\t\t']);_templateObject=function t(){return e};return e}var SyncStatusPopup=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));n.setEventNamespace("BX.Calendar.Sync.Interface.SyncStatusPopup");n.connections=e.connections;n.withUpdateButton=e.withUpdateButton;n.node=e.node;n.id=e.id;n.init();return n}babelHelpers.createClass(t,[{key:"init",value:function e(){this.setPopupContent()}},{key:"createPopup",value:function e(){this.popup=new main_popup.Popup({className:this.id,bindElement:this.node,content:this.container,angle:true,width:360,offsetLeft:60,offsetTop:5,padding:7,darkMode:true,autoHide:true,zIndexAbsolute:3010})}},{key:"show",value:function e(){this.createPopup();this.popup.show()}},{key:"setPopupContent",value:function e(){var n=this;this.container=main_core.Tag.render(_templateObject());this.connections.forEach(function(e){if(e.getConnectStatus()!==true){return}var t={};t.syncTime=n.getTime(e.getSyncTimestamp());t.classStatus=e.getSyncStatus()?"calendar-sync-popup-item-status-success":"calendar-sync-popup-item-status-fail";t.classLable="calendar-sync-popup-item-text-"+e.getClassLable();t.title=e.getConnectionName();var a=n.getSyncElement(t);n.container.append(a)});if(this.withUpdateButton){this.container.append(this.getContentRefreshBlock());if(t.IS_RUN_REFRESH){this.showRefreshStatus()}}return this.container}},{key:"hide",value:function e(){this.popup.destroy()}},{key:"getContainer",value:function e(){return this.container}},{key:"getPopup",value:function e(){return this.popup}},{key:"getTime",value:function e(t){var n=[["tommorow","tommorow, H:i:s"],["s",main_core.Loc.getMessage("CAL_JUST")],["i","iago"],["H","Hago"],["d","dago"],["m100","mago"],["m","mago"],["-",""]];return BX.date.format(n,t)}},{key:"getSyncElement",value:function e(t){return main_core.Tag.render(_templateObject2(),t.classLable,BX.util.htmlspecialchars(t.title),t.syncTime,t.classStatus)}},{key:"refresh",value:function e(t){this.connections=t;this.popup.setContent(this.setPopupContent());this.setRefreshStatusBlock()}},{key:"setRefreshStatusBlock",value:function e(){var n=this;setTimeout(function(){n.removeRefreshStatusBlock();n.enableRefreshButton();t.IS_RUN_REFRESH=false},3e5)}},{key:"removeRefreshStatusBlock",value:function e(){this.refreshStatusBlock.remove()}},{key:"enableRefreshButton",value:function e(){this.refreshButton.className="calendar-sync-popup-footer-btn"}},{key:"disableRefreshButton",value:function e(){this.refreshButton.className="calendar-sync-popup-footer-btn calendar-sync-popup-footer-btn-disabled"}},{key:"getContentRefreshBlock",value:function e(){this.footerWrapper=main_core.Tag.render(_templateObject3(),this.getContentRefreshButton());return this.footerWrapper}},{key:"getContentRefreshButton",value:function e(){var n=this;this.refreshButton=main_core.Tag.render(_templateObject4(),main_core.Loc.getMessage("CAL_REFRESH"));this.refreshButton.addEventListener("click",function(){main_core.Dom.addClass(n.refreshButton,"calendar-sync-popup-footer-btn-load");t.IS_RUN_REFRESH=true;n.refreshButton.innerText=main_core.Loc.getMessage("CAL_REFRESHING");n.runRefresh()});return this.refreshButton}},{key:"showRefreshStatus",value:function e(){this.disableRefreshButton();this.footerWrapper.prepend(this.getRefreshStatus())}},{key:"getRefreshStatus",value:function e(){this.refreshStatusBlock=main_core.Tag.render(_templateObject5(),main_core.Loc.getMessage("CAL_REFRESH_JUST"));return this.refreshStatusBlock}},{key:"runRefresh",value:function e(){this.emit("onRefresh",{})}},{key:"getId",value:function e(){return this.id}}],[{key:"createInstance",value:function e(t){return new this(t)}}]);return t}(main_core_events.EventEmitter);babelHelpers.defineProperty(SyncStatusPopup,"IS_RUN_REFRESH",false);function _templateObject5$1(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-status-block" id="calendar-sync-status-block">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);_templateObject5$1=function t(){return e};return e}function _templateObject4$1(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-status-subtitle">\n\t\t\t\t<span data-hint=""></span>\n\t\t\t\t<span class="calendar-sync-status-text">',":</span>\n\t\t\t</div>\n\t\t"]);_templateObject4$1=function t(){return e};return e}function _templateObject3$1(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="status-info-block" class="ui-alert ui-alert-primary calendar-sync-status-info">\n\t\t\t\t\t<span class="ui-alert-message">',"</span>\n\t\t\t\t</div>\n\t\t\t"]);_templateObject3$1=function t(){return e};return e}function _templateObject2$1(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="status-info-block" class="ui-alert ui-alert-danger calendar-sync-status-info">\n\t\t\t\t\t<span class="ui-alert-message">',"</span>\n\t\t\t\t</div>\n\t\t\t"]);_templateObject2$1=function t(){return e};return e}function _templateObject$1(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div id="status-info-block" class="ui-alert ui-alert-success calendar-sync-status-info">\n\t\t\t\t\t<span class="ui-alert-message">',"</span>\n\t\t\t\t</div>\n\t\t\t"]);_templateObject$1=function t(){return e};return e}var StatusBlock=function(){function e(t){babelHelpers.classCallCheck(this,e);this.status=t.status;this.connections=t.connections;this.withStatus=t.withStatus;this.popupWithUpdateButton=t.popupWithUpdateButton;this.popupId=t.id}babelHelpers.createClass(e,[{key:"getContentStatusBlock",value:function e(){var t=this;var n;if(this.status==="success"){n=main_core.Tag.render(_templateObject$1(),main_core.Loc.getMessage("SYNC_STATUS_SUCCESS"))}else if(this.status==="failed"){n=main_core.Tag.render(_templateObject2$1(),main_core.Loc.getMessage("SYNC_STATUS_ALERT"))}else{n=main_core.Tag.render(_templateObject3$1(),main_core.Loc.getMessage("SYNC_STATUS_NOT_CONNECTED"))}n.addEventListener("mouseenter",function(e){t.handlerMouseEnter(n)});n.addEventListener("mouseleave",function(e){t.handlerMouseLeave()});var a=main_core.Tag.render(_templateObject4$1(),main_core.Loc.getMessage("LABEL_STATUS_INFO"));return main_core.Tag.render(_templateObject5$1(),this.withStatus?a:"",n)}},{key:"handlerMouseEnter",value:function e(t){var n=this;clearTimeout(this.statusBlockEnterTimeout);this.buttonEnterTimeout=setTimeout(function(){n.statusBlockEnterTimeout=null;n.showPopup(t)},500)}},{key:"handlerMouseLeave",value:function e(){var t=this;if(this.statusBlockEnterTimeout!==null){clearTimeout(this.statusBlockEnterTimeout);this.statusBlockEnterTimeout=null;return}this.statusBlockLeaveTimeout=setTimeout(function(){t.hidePopup()},500)}},{key:"showPopup",value:function e(t){var n=this;if(this.status!=="not_connected"){this.popup=SyncStatusPopup.createInstance({connections:this.connections,withUpdateButton:this.popupWithUpdateButton,node:t,id:this.popupId});this.popup.show();this.popup.getPopup().getPopupContainer().addEventListener("mouseenter",function(e){clearTimeout(n.statusBlockEnterTimeout);clearTimeout(n.statusBlockLeaveTimeout)});this.popup.getPopup().getPopupContainer().addEventListener("mouseleave",function(){n.hidePopup()})}}},{key:"hidePopup",value:function e(){if(this.popup){this.popup.hide()}}}],[{key:"createInstance",value:function e(t){return new this(t)}}]);return e}();var ConnectionItem=function(){function e(t){babelHelpers.classCallCheck(this,e);this.syncTimestamp=t.syncTimestamp;this.connectionName=t.connectionName;this.status=t.status;this.connected=t.connected;this.addParams=t.addParams;this.type=t.type;this.id=t.type}babelHelpers.createClass(e,[{key:"getSyncTimestamp",value:function e(){return this.syncTimestamp}},{key:"getConnectionName",value:function e(){return this.connectionName}},{key:"getSyncStatus",value:function e(){return this.status}},{key:"getConnectStatus",value:function e(){return this.connected}},{key:"getStatus",value:function e(){if(this.connected){return this.status?"success":"failed"}else{return"not_connected"}}},{key:"getClassLable",value:function e(){return this.type}},{key:"getSections",value:function e(){return this.addParams.sections}},{key:"getId",value:function e(){return this.addParams.id}},{key:"getType",value:function e(){return this.type}}],[{key:"createInstance",value:function e(t){return new this(t)}}]);return e}();function _templateObject6(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-wrap">\n\t\t\t\t<div class="calendar-sync-header">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);_templateObject6=function t(){return e};return e}function _templateObject5$2(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="calendar-sync-mobile" class="calendar-sync-mobile"></div>\n\t\t']);_templateObject5$2=function t(){return e};return e}function _templateObject4$2(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div id="calendar-sync-web" class="calendar-sync-web"></div>\n\t\t']);_templateObject4$2=function t(){return e};return e}function _templateObject3$2(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-title">',"</div>\n\t\t"]);_templateObject3$2=function t(){return e};return e}function _templateObject2$2(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-title">',"</div>\n\t\t"]);_templateObject2$2=function t(){return e};return e}function _templateObject$2(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="calendar-sync-header-text">',"</span>\n\t\t"]);_templateObject$2=function t(){return e};return e}var SyncPanel=function(){function e(t){babelHelpers.classCallCheck(this,e);this.status=t.status;this.connectionsProviders=t.connectionsProviders;this.userId=t.userId;this.statusBlockEnterTimeout=null;this.statusBlockLeaveTimeout=null}babelHelpers.createClass(e,[{key:"showContent",value:function e(){var t=main_core.Tag.render(_templateObject$2(),main_core.Loc.getMessage("SYNC_CALENDAR_HEADER"));var n=this.getConnections();this.blockStatus=StatusBlock.createInstance({status:this.status,connections:n,withStatus:true,popupWithUpdateButton:true,popupId:"calendar-syncPanel-status"}).getContentStatusBlock();var a=main_core.Tag.render(_templateObject2$2(),main_core.Loc.getMessage("SYNC_WEB_HEADER"));var s=main_core.Tag.render(_templateObject3$2(),main_core.Loc.getMessage("SYNC_MOBILE_HEADER"));var i=main_core.Tag.render(_templateObject4$2());var r=main_core.Tag.render(_templateObject5$2());return main_core.Tag.render(_templateObject6(),t,this.blockStatus,s,r,a,i)}},{key:"getConnections",value:function e(){var t=[];var n=Object.values(this.connectionsProviders);n.forEach(function(e){var n=e.getConnections();if(n.length>0){n.forEach(function(e){if(e instanceof ConnectionItem){if(e.getConnectStatus()===true){t.push(e)}}})}});return t}},{key:"setGridContent",value:function e(){var t=Object.values(this.connectionsProviders);var n=t.filter(function(e){return e.getViewClassification()==="mobile"});var a=t.filter(function(e){return e.getViewClassification()==="web"});this.showWebGridContent(a);this.showMobileGridContent(n)}},{key:"showWebGridContent",value:function e(t){var n=new BX.TileGrid.Grid({id:"calendar_sync",items:t,container:document.getElementById("calendar-sync-web"),sizeRatio:"55%",itemMinWidth:180,tileMargin:7,itemType:"BX.Calendar.Sync.Interface.GridUnit",userId:this.userId});n.draw()}},{key:"showMobileGridContent",value:function e(t){var n=new BX.TileGrid.Grid({id:"calendar_sync",items:t,container:document.getElementById("calendar-sync-mobile"),sizeRatio:"55%",itemMinWidth:180,tileMargin:7,itemType:"BX.Calendar.Sync.Interface.GridUnit"});n.draw()}},{key:"refresh",value:function e(t,n){this.status=t;this.connectionsProviders=n}}]);return e}();var SyncButton=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"SLIDER_WIDTH",684);babelHelpers.defineProperty(this,"LOADER_NAME","calendar:loader");babelHelpers.defineProperty(this,"BUTTON_SIZE",BX.UI.Button.Size.EXTRA_SMALL);babelHelpers.defineProperty(this,"BUTTON_ROUND",true);this.connectionsProviders=t.connectionsProviders;this.wrapper=t.wrapper;this.userId=t.userId;this.status=t.status;this.buttonEnterTimeout=null;this.buttonLeaveTimeout=null}babelHelpers.createClass(e,[{key:"show",value:function e(){var t=this;var n=this.getButtonData();this.button=new BX.UI.Button({text:n.text,round:this.BUTTON_ROUND,size:this.BUTTON_SIZE,color:n.color,className:"ui-btn-themes "+(n.iconClass||""),onclick:function e(){t.handleClick()},events:{mouseenter:this.handlerMouseEnter.bind(this),mouseleave:this.handlerMouseLeave.bind(this)}});this.button.renderTo(this.wrapper)}},{key:"showPopup",value:function e(t){var n=this;if(this.status!=="not_connected"){var a=[];var s=Object.values(this.connectionsProviders);s.forEach(function(e){var t=e.getConnections();if(t.length>0){t.forEach(function(e){if(e.getConnectStatus()===true){a.push(e)}})}});this.popup=SyncStatusPopup.createInstance({connections:a,withUpdateButton:true,node:t.getContainer(),id:"calendar-syncPanel-status"});this.popup.show();this.popup.getPopup().getPopupContainer().addEventListener("mouseenter",function(e){clearTimeout(n.buttonEnterTimeout);clearTimeout(n.buttonLeaveTimeout)});this.popup.getPopup().getPopupContainer().addEventListener("mouseleave",function(){n.hidePopup()})}}},{key:"hidePopup",value:function e(){if(this.popup){this.popup.hide()}}},{key:"refresh",value:function e(t,n){this.status=t;this.connectionsProviders=n;var a=this.getButtonData();this.button.setColor(a.color);this.button.setText(a.text);this.button.removeClass("ui-btn-icon-fail ui-btn-icon-success");this.button.addClass(a.iconClass)}},{key:"handleClick",value:function e(){var t=this;clearTimeout(this.buttonEnterTimeout);this.syncPanel=new SyncPanel({connectionsProviders:this.connectionsProviders,userId:this.userId,status:this.status});var n=this.syncPanel;BX.SidePanel.Instance.open("calendar:sync-slider",{contentCallback:function e(t){return new Promise(function(e,t){e(n.showContent())})},allowChangeHistory:false,events:{onLoad:function e(n){t.syncPanel.setGridContent()}},cacheable:false,width:this.SLIDER_WIDTH,loader:this.LOADER_NAME})}},{key:"handlerMouseEnter",value:function e(t){var n=this;clearTimeout(this.buttonEnterTimeout);this.buttonEnterTimeout=setTimeout(function(){n.buttonEnterTimeout=null;n.showPopup(t)},500)}},{key:"handlerMouseLeave",value:function e(){var t=this;if(this.buttonEnterTimeout!==null){clearTimeout(this.buttonEnterTimeout);this.buttonEnterTimeout=null;return}this.buttonLeaveTimeout=setTimeout(function(){t.hidePopup()},500)}},{key:"getButtonData",value:function e(){if(this.status==="success"){return{text:main_core.Loc.getMessage("STATUS_BUTTON_SYNCHRONIZATION"),color:BX.UI.Button.Color.LIGHT_BORDER,iconClass:"ui-btn-icon-success"}}else if(this.status==="failed"){return{text:main_core.Loc.getMessage("STATUS_BUTTON_FAILED"),color:BX.UI.Button.Color.LIGHT_BORDER,iconClass:"ui-btn-icon-fail"}}return{text:main_core.Loc.getMessage("STATUS_BUTTON_SYNC_CALENDAR"),color:BX.UI.Button.Color.PRIMARY}}},{key:"getSyncPanel",value:function e(){return this.syncPanel}}],[{key:"createInstance",value:function e(t){return new this(t)}}]);return e}();var SyncPanelItem=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.options=e;return n}babelHelpers.createClass(t,[{key:"getContent",value:function e(){if(this.options.className){var t=main_core.Reflection.getClass(this.options.className);if(main_core.Type.isFunction(t)){var n=new t(this.options);return n.getInnerContent()}return""}}}]);return t}(BX.TileGrid.Item);function _templateObject6$1(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-form-btn"></div>\n\t\t']);_templateObject6$1=function t(){return e};return e}function _templateObject5$3(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button id="edit-connect-button" class="calendar-sync-slider-btn ui-btn ui-btn-light-border">',"</button>\n\t\t"]);_templateObject5$3=function t(){return e};return e}function _templateObject4$3(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button id="disconnect-button" class="calendar-sync-slider-btn ui-btn ui-btn-light-border">',"</button>\n\t\t"]);_templateObject4$3=function t(){return e};return e}function _templateObject3$3(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<button id="connect-button" class="ui-btn ui-btn-light-border">',"</button>\n\t\t"]);_templateObject3$3=function t(){return e};return e}function _templateObject2$3(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<form class="calendar-sync-slider-form" action="">\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder="','" name="name" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder="','" name="server" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder="','" name="user_name" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="password" class="ui-ctl-element" name="password" placeholder="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t'],['\n\t\t\t<form class="calendar-sync-slider-form" action="">\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder=\\"','\\" name="name" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder=\\"','\\" name="server" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="text" class="ui-ctl-element" placeholder=\\"','\\" name="user_name" value="','">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-field">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">\n\t\t\t\t\t\t<input type="password" class="ui-ctl-element" name="password" placeholder=\\"','\\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t']);_templateObject2$3=function t(){return e};return e}function _templateObject$3(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section calendar-sync-slider-section-form"></div>\n\t\t']);_templateObject$3=function t(){return e};return e}var ConnectionControls=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"userName",null);babelHelpers.defineProperty(this,"server",null);babelHelpers.defineProperty(this,"connectionName",null);this.addButtonText=main_core.Loc.getMessage("CAL_UPPER_CONNECT");this.removeButtonText=main_core.Loc.getMessage("CAL_UPPER_DISCONNECT");this.saveButtonText=main_core.Loc.getMessage("CAL_UPPER_SAVE");if(t!==null){this.userName=BX.util.htmlspecialchars(t.userName);this.server=BX.util.htmlspecialchars(t.server);this.connectionName=BX.util.htmlspecialchars(t.connectionName)}}babelHelpers.createClass(e,[{key:"getWrapper",value:function e(){return main_core.Tag.render(_templateObject$3())}},{key:"getForm",value:function e(){return main_core.Tag.render(_templateObject2$3(),main_core.Loc.getMessage("CAL_TEXT_NAME"),this.connectionName||"",main_core.Loc.getMessage("CAL_TEXT_SERVER_ADDRESS"),this.server||"",main_core.Loc.getMessage("CAL_TEXT_USER_NAME"),this.userName||"",main_core.Loc.getMessage("CAL_TEXT_PASSWORD"))}},{key:"getAddButton",value:function e(){return main_core.Tag.render(_templateObject3$3(),this.addButtonText)}},{key:"getDisconnectButton",value:function e(){return main_core.Tag.render(_templateObject4$3(),this.removeButtonText)}},{key:"getSaveButton",value:function e(){return main_core.Tag.render(_templateObject5$3(),this.saveButtonText)}},{key:"getButtonWrapper",value:function e(){return main_core.Tag.render(_templateObject6$1())}}]);return e}();function _templateObject2$4(){var e=babelHelpers.taggedTemplateLiteral(['<span class="calendar-notice-mobile-banner" data-hint="','" data-hint-no-icon="Y"></span>']);_templateObject2$4=function t(){return e};return e}function _templateObject$4(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t",'\n\t\t\t<div class="calendar-sync-qr-popup-content">\n\t\t\t\t<div class="calendar-sync-qr-popup-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-content">\n\t\t\t\t\t<img class="calendar-sync-slider-phone-img" src="/bitrix/images/calendar/sync/qr-background.svg" alt="">\n\t\t\t\t\t<div class="calendar-sync-slider-qr">\n\t\t\t\t\t\t<div class="','">','</div>\n\t\t\t\t\t\t<span class="calendar-sync-slider-logo"></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="calendar-sync-slider-instruction">\n\t\t\t\t\t\t\x3c!--<div class="calendar-sync-slider-instruction-subtitle"></div>--\x3e\n\t\t\t\t\t\t<div class="calendar-sync-slider-instruction-title">'," ",'</div>\n\t\t\t\t\t\t<div class="calendar-sync-slider-instruction-notice">','</div>\n\t\t\t\t\t\t<a href="javascript:void(0);" \n\t\t\t\t\t\t\t\tonclick="BX.Helper.show(\'redirect=detail&code=\' + ',',{zIndex:3100,}); event.preventDefault();" \n\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-success ui-btn-round">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);_templateObject$4=function t(){return e};return e}var MobileSyncBanner=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"zIndex",3100);babelHelpers.defineProperty(this,"DOM",{});babelHelpers.defineProperty(this,"QRCODE_SIZE",128);babelHelpers.defineProperty(this,"QRCODE_COLOR_LIGHT","#ffffff");babelHelpers.defineProperty(this,"QRCODE_COLOR_DARK","#000000");babelHelpers.defineProperty(this,"QRCODE_WRAP_CLASS","calendar-sync-slider-qr-container");babelHelpers.defineProperty(this,"QRC",null);this.type=t.type;this.helpDeskCode=t.helpDeskCode||"11828176"}babelHelpers.createClass(e,[{key:"show",value:function e(){}},{key:"showInPopup",value:function e(){this.popup=new main_popup.Popup({className:"calendar-sync-qr-popup",draggable:true,content:this.getContainer(),width:580,zIndexAbsolute:this.zIndex,cacheable:false,closeByEsc:true,closeIcon:true});this.popup.show();this.initQrCode().then(this.drawQRCode.bind(this))}},{key:"close",value:function e(){this.popup.close()}},{key:"getContainer",value:function e(){this.DOM.container=main_core.Tag.render(_templateObject$4(),this.getSliderContentInfoBlock,this.getTitle(),this.QRCODE_WRAP_CLASS,calendar_util.Util.getLoader(this.QRCODE_SIZE),main_core.Loc.getMessage("SYNC_MOBILE_NOTICE_HOW_TO"),this.type!=="iphone"?main_core.Tag.render(_templateObject2$4(),main_core.Loc.getMessage("CAL_ANDROID_QR_CODE_HINT")):"",main_core.Loc.getMessage("SYNC_MOBILE_NOTICE"),this.getHelpdeskCode(),main_core.Loc.getMessage("SYNC_MOBILE_ABOUT_BTN"));this.DOM.mobileHintIcon=this.DOM.container.querySelector(".calendar-notice-mobile-banner");if(this.DOM.mobileHintIcon&&BX.UI.Hint){BX.UI.Hint.initNode(this.DOM.mobileHintIcon)}return this.DOM.container}},{key:"getInnerContainer",value:function e(){return this.DOM.container.querySelector("."+this.QRCODE_WRAP_CLASS)}},{key:"initQrCode",value:function e(){return new Promise(function(e){main_core.Runtime.loadExtension(["main.qrcode"]).then(function(t){if(t&&t.QRCode){e()}})})}},{key:"drawQRCode",value:function e(t){var n=this;if(!main_core.Type.isDomNode(t)){t=this.getInnerContainer()}this.getMobileSyncUrl().then(function(e){main_core.Dom.clean(t);n.QRC=new QRCode(t,{text:e,width:n.getSize(),height:n.getSize(),colorDark:n.QRCODE_COLOR_DARK,colorLight:n.QRCODE_COLOR_LIGHT,correctLevel:QRCode.CorrectLevel.H})})}},{key:"getTitle",value:function e(){return main_core.Loc.getMessage("SYNC_BANNER_MOBILE_TITLE")}},{key:"getMobileSyncUrl",value:function e(){return new Promise(function(e,t){BX.ajax.runAction("calendar.api.calendarajax.getAuthLink").then(function(t){e(t.data.link)},t)})}},{key:"getSize",value:function e(){return this.QRCODE_SIZE}},{key:"getDetailHelpUrl",value:function e(){return"https://helpdesk.bitrix24.ru/open/"+this.getHelpdeskCode()}},{key:"getHelpdeskCode",value:function e(){return this.helpDeskCode}}]);return e}();function _templateObject8(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section">\n\t\t\t\t<div class="calendar-sync-slider-header-icon ','"></div>\n\t\t\t\t<div class="calendar-sync-slider-header">\n\t\t\t\t<div class="calendar-sync-slider-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">\n\t\t\t\t\t\t<a class="calendar-sync-slider-info-link" href="javascript:void(0);" onclick="','">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t"]);_templateObject8=function t(){return e};return e}function _templateObject7(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section">\n\t\t\t\t<div class="calendar-sync-slider-header-icon ','"></div>\n\t\t\t\t<div class="calendar-sync-slider-header">\n\t\t\t\t<div class="calendar-sync-slider-title">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">\n\t\t\t\t\t\t<a class="calendar-sync-slider-info-link" href="javascript:void(0);" onclick="','">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t"]);_templateObject7=function t(){return e};return e}function _templateObject6$2(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t"]);_templateObject6$2=function t(){return e};return e}function _templateObject5$4(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-header">\n\t\t\t\t<span class="calendar-sync-header-text">',"</span>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);_templateObject5$4=function t(){return e};return e}function _templateObject4$4(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t"]);_templateObject4$4=function t(){return e};return e}function _templateObject3$4(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-header">\n\t\t\t\t<span class="calendar-sync-header-text">',"</span>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);_templateObject3$4=function t(){return e};return e}function _templateObject2$5(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-wrap calendar-sync-wrap-detail">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);_templateObject2$5=function t(){return e};return e}function _templateObject$5(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-wrap calendar-sync-wrap-detail">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"]);_templateObject$5=function t(){return e};return e}var InterfaceTemplate=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"sliderWidth",840);n.setEventNamespace("BX.Calendar.Sync.Interface.InterfaceTemplate");n.title=e.title;n.helpdeskCode=e.helpDeskCode;n.titleInfoHeader=e.titleInfoHeader;n.descriptionInfoHeader=e.descriptionInfoHeader;n.titleActiveHeader=e.titleActiveHeader;n.descriptionActiveHeader=e.descriptionActiveHeader;n.sliderIconClass=e.sliderIconClass;n.iconPath=e.iconPath;n.color=e.color;n.provider=e.provider;n.connection=e.connection;n.popupWithUpdateButton=e.popupWithUpdateButton;return n}babelHelpers.createClass(t,[{key:"getInfoConnectionContent",value:function e(){return main_core.Tag.render(_templateObject$5(),this.getContentInfoHeader(),this.getContentInfoBody())}},{key:"getActiveConnectionContent",value:function e(){return main_core.Tag.render(_templateObject2$5(),this.getContentActiveHeader(),this.getContentActiveBody())}},{key:"getContentInfoHeader",value:function e(){var t=StatusBlock.createInstance({status:"not_connected",connections:[this.connection],withStatus:false,popupWithUpdateButton:this.popupWithUpdateButton,popupId:"calendar-interfaceTemplate-status"});return main_core.Tag.render(_templateObject3$4(),this.getHeaderTitle(),t.getContentStatusBlock())}},{key:"getContentInfoBody",value:function e(){return main_core.Tag.render(_templateObject4$4(),this.getContentInfoBodyHeader())}},{key:"getContentActiveHeader",value:function e(){var t=StatusBlock.createInstance({status:this.connection.getStatus(),connections:[this.connection],withStatus:false,popupWithUpdateButton:this.popupWithUpdateButton,popupId:"calendar-interfaceTemplate-status"});return main_core.Tag.render(_templateObject5$4(),this.getHeaderTitle(),t.getContentStatusBlock())}},{key:"getContentActiveBody",value:function e(){return main_core.Tag.render(_templateObject6$2(),this.getContentActiveBodyHeader())}},{key:"showHelp",value:function e(){if(BX.Helper){BX.Helper.show("redirect=detail&code="+this.helpdeskCode);event.preventDefault()}}},{key:"getHelpdeskLink",value:function e(){return"https://helpdesk.bitrix24.ru/open/"+this.helpdeskCode}},{key:"getHeaderTitle",value:function e(){return this.title}},{key:"getContentInfoBodyHeader",value:function e(){return main_core.Tag.render(_templateObject7(),this.sliderIconClass,this.titleInfoHeader,this.descriptionInfoHeader,this.showHelp.bind(this),main_core.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"))}},{key:"getContentActiveBodyHeader",value:function e(){return main_core.Tag.render(_templateObject8(),this.sliderIconClass,this.titleActiveHeader,this.descriptionActiveHeader,this.showHelp.bind(this),main_core.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"))}},{key:"setProvider",value:function e(t){this.provider=t}},{key:"setConnection",value:function e(t){this.connection=t}},{key:"sendRequestRemoveConnection",value:function e(t){BX.ajax.runAction("calendar.api.calendarajax.removeConnection",{data:{connectionId:t}}).then(function(){BX.reload()})}},{key:"runUpdateInfo",value:function e(){var t=this;main_core.ajax.runAction("calendar.api.calendarajax.setSectionStatus",{data:{sectionStatus:this.sectionStatusObject}}).then(function(e){t.emit("reDrawCalendarGrid",{})})}}],[{key:"createInstance",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return new this(t,n)}}]);return t}(main_core_events.EventEmitter);babelHelpers.defineProperty(InterfaceTemplate,"SLIDER_WIDTH",606);babelHelpers.defineProperty(InterfaceTemplate,"SLIDER_PREFIX","calendar:connection-sync-");function _templateObject2$6(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t"]);_templateObject2$6=function t(){return e};return e}function _templateObject$6(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t"]);_templateObject$6=function t(){return e};return e}var CaldavInterfaceTemplate=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e))}babelHelpers.createClass(t,[{key:"getContentInfoBody",value:function e(){var t=this;var n=new ConnectionControls;var a=n.getWrapper();var s=n.getForm();var i=n.getAddButton();var r=n.getButtonWrapper();var c=this.getContentInfoBodyHeader();i.addEventListener("click",function(e){main_core.Dom.addClass(i,["ui-btn-clock","ui-btn-disabled"]);e.preventDefault();t.sendRequestAddConnection(s)});main_core.Dom.append(i,r);main_core.Dom.append(r,s);main_core.Dom.append(s,a);return main_core.Tag.render(_templateObject$6(),c,a)}},{key:"getContentActiveBody",value:function e(){var t=this;var n=new ConnectionControls({server:this.connection.addParams.server,userName:this.connection.addParams.userName,connectionName:this.connection.connectionName});var a=n.getWrapper();var s=n.getForm();var i=n.getDisconnectButton();var r=n.getButtonWrapper();var c=this.getContentActiveBodyHeader();i.addEventListener("click",function(e){main_core.Dom.addClass(i,["ui-btn-clock","ui-btn-disabled"]);e.preventDefault();t.sendRequestRemoveConnection(t.connection.getId())});main_core.Dom.append(i,r);main_core.Dom.append(r,s);main_core.Dom.append(s,a);return main_core.Tag.render(_templateObject2$6(),c,a)}},{key:"sendRequestEditConnection",value:function e(t,n){BX.ajax.runAction("calendar.api.calendarajax.editConnection",{data:{form:new FormData(t),connectionId:n.connectionId}}).then(function(){BX.reload()})}},{key:"sendRequestAddConnection",value:function e(t){var n=this;var a=new FormData(t);BX.ajax.runAction("calendar.api.calendarajax.addConnection",{data:{name:a.get("name"),server:a.get("server"),userName:a.get("user_name"),pass:a.get("password")}}).then(function(e){BX.reload()},function(e){var a=t.querySelector("#connect-button");n.showAlertPopup(e.errors[0],a)})}},{key:"showAlertPopup",value:function e(t,n){var a="";if(t.code==="incorrect_parameters"){a=main_core.Loc.getMessage("CAL_TEXT_ALERT_INCORRECT_PARAMETERS")}else if(t.code==="tech_problem"){a=main_core.Loc.getMessage("CAL_TEXT_ALERT_TECH_PROBLEM")}else{a=main_core.Loc.getMessage("CAL_TEXT_ALERT_DEFAULT")}var s=new BX.UI.Dialogs.MessageBox({message:a,title:t.message,buttons:BX.UI.Dialogs.MessageBoxButtons.OK,okCaption:main_core.Loc.getMessage("CAL_TEXT_BUTTON_RETURN_TO_SETTINGS"),minWidth:358,mediumButtonSize:false,popupOptions:{zIndex:3021,height:166,width:358,className:"calendar-alert-popup-connection"},onOk:function e(){main_core.Dom.removeClass(n,["ui-btn-clock","ui-btn-disabled"]);return true}});s.show()}}]);return t}(InterfaceTemplate);var CaldavTemplate=function(e){babelHelpers.inherits(t,e);function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{title:main_core.Loc.getMessage("CALENDAR_TITLE_CALDAV"),helpDeskCode:"5697365",titleInfoHeader:main_core.Loc.getMessage("CAL_CONNECT_CALDAV_CALENDAR"),descriptionInfoHeader:main_core.Loc.getMessage("CAL_CALDAV_CONNECT_DESCRIPTION"),titleActiveHeader:main_core.Loc.getMessage("CAL_CALDAV_CALENDAR_IS_CONNECT"),descriptionActiveHeader:main_core.Loc.getMessage("CAL_CALDAV_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-caldav",iconPath:"/bitrix/images/calendar/sync/caldav.svg",color:"#1eae43",provider:e,connection:n,popupWithUpdateButton:true}))}return t}(CaldavInterfaceTemplate);var ExchangeTemplate=function(e){babelHelpers.inherits(t,e);function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{title:main_core.Loc.getMessage("CALENDAR_TITLE_EXCHANGE"),helpDeskCode:"11864622",titleInfoHeader:main_core.Loc.getMessage("CAL_CONNECT_EXCHANGE_CALENDAR_TITLE"),descriptionInfoHeader:main_core.Loc.getMessage("CAL_EXCHANGE_CONNECT_DESCRIPTION"),titleActiveHeader:main_core.Loc.getMessage("CAL_SYNC_CONNECTED_EXCHANGE_TITLE"),descriptionActiveHeader:main_core.Loc.getMessage("CAL_EXCHANGE_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-office",iconPath:"/bitrix/images/calendar/sync/exchange.svg",color:"#54d0df",provider:e,connection:n,popupWithUpdateButton:true}))}return t}(InterfaceTemplate);function _templateObject5$5(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<li class="calendar-sync-slider-item">\n\t\t\t\t\t<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">\n\t\t\t\t\t\t<input type="checkbox" class="ui-ctl-element" value="','" onclick="','" ','>\n\t\t\t\t\t\t<div class="ui-ctl-label-text">',"</div>\n\t\t\t\t\t</label>\n\t\t\t\t</li>\n\t\t\t"]);_templateObject5$5=function t(){return e};return e}function _templateObject4$5(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section calendar-sync-slider-section-col">\n\t\t\t\t<div class="calendar-sync-slider-header">\n\t\t\t\t\t<div class="calendar-sync-slider-subtitle">','</div>\n\t\t\t\t</div>\n\t\t\t\t<ul class="calendar-sync-slider-list">\n\t\t\t\t\t',"\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t"]);_templateObject4$5=function t(){return e};return e}function _templateObject3$5(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section">\n\t\t\t\t<div class="calendar-sync-slider-header-icon calendar-sync-slider-header-icon-google"></div>\n\t\t\t\t<div class="calendar-sync-slider-header">\n\t\t\t\t\t<div class="calendar-sync-slider-title">','</div>\n\t\t\t\t\t<span class="calendar-sync-slider-account">\n\t\t\t\t\t\t<span class="calendar-sync-slider-account-avatar"></span>\n\t\t\t\t\t\t<span class="calendar-sync-slider-account-email">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">\n\t\t\t\t\t\t\t<a class="calendar-sync-slider-info-link" href="javascript:void(0);" onclick="','">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t"]);_templateObject3$5=function t(){return e};return e}function _templateObject2$7(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t"]);_templateObject2$7=function t(){return e};return e}function _templateObject$7(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t"]);_templateObject$7=function t(){return e};return e}var GoogleTemplate=function(e){babelHelpers.inherits(t,e);function t(e){var n;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{title:main_core.Loc.getMessage("CALENDAR_TITLE_GOOGLE"),helpDeskCode:"6030429",titleInfoHeader:main_core.Loc.getMessage("CAL_CONNECT_GOOGLE_CALENDAR"),descriptionInfoHeader:main_core.Loc.getMessage("CAL_GOOGLE_CONNECT_DESCRIPTION"),titleActiveHeader:main_core.Loc.getMessage("CAL_GOOGLE_CALENDAR_IS_CONNECT"),descriptionActiveHeader:main_core.Loc.getMessage("CAL_GOOGLE_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-google",iconPath:"/bitrix/images/calendar/sync/google.svg",color:"#387ced",provider:e,connection:a,popupWithUpdateButton:true}));n.sectionStatusObject={};return n}babelHelpers.createClass(t,[{key:"createConnection",value:function e(){BX.util.popup(this.provider.getSyncLink(),500,600)}},{key:"getContentInfoBody",value:function e(){var t=this;var n=new ConnectionControls;var a=n.getAddButton();var s=n.getButtonWrapper();var i=this.getContentInfoBodyHeader();var r=i.querySelector(".calendar-sync-slider-header");if(this.provider.hasSetSyncCaldavSettings()){a.addEventListener("click",function(){t.createConnection()})}else{a.addEventListener("click",function(){t.showAlertPopup()})}main_core.Dom.append(a,s);main_core.Dom.append(s,r);return main_core.Tag.render(_templateObject$7(),i)}},{key:"getContentActiveBody",value:function e(){return main_core.Tag.render(_templateObject2$7(),this.getContentActiveBodyHeader(),this.getContentActiveBodySectionsManager())}},{key:"getContentActiveBodyHeader",value:function e(){var t=this;var n=new ConnectionControls;var a=n.getDisconnectButton();a.addEventListener("click",function(e){e.preventDefault();t.sendRequestRemoveConnection(t.connection.getId())});return main_core.Tag.render(_templateObject3$5(),main_core.Loc.getMessage("CAL_GOOGLE_CALENDAR_IS_CONNECT"),BX.util.htmlspecialchars(this.connection.getConnectionName()),this.showHelp.bind(this),main_core.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"),a)}},{key:"getContentActiveBodySectionsManager",value:function e(){return main_core.Tag.render(_templateObject4$5(),main_core.Loc.getMessage("CAL_AVAILABLE_CALENDAR"),this.getContentActiveBodySections(this.connection.getId()))}},{key:"getContentActiveBodySections",value:function e(t){var n=this;var a=[];this.provider.getConnection().getSections().forEach(function(e){a.push(main_core.Tag.render(_templateObject5$5(),BX.util.htmlspecialchars(e["ID"]),n.onClickCheckSection.bind(n),e["ACTIVE"]==="Y"?"checked":"",BX.util.htmlspecialchars(e["NAME"])))});return a}},{key:"onClickCheckSection",value:function e(t){this.sectionStatusObject[t.target.value]=t.target.checked;this.runUpdateInfo()}},{key:"showAlertPopup",value:function e(){var t=new ui_dialogs_messagebox.MessageBox({className:this.id,message:main_core.Loc.getMessage("GOOGLE_IS_NOT_CALDAV_SETTINGS_WARNING_MESSAGE"),width:500,offsetLeft:60,offsetTop:5,padding:7,onOk:function e(){t.close()},okCaption:"OK",buttons:BX.UI.Dialogs.MessageBoxButtons.OK,popupOptions:{zIndexAbsolute:4020,autoHide:true}});t.show()}}]);return t}(InterfaceTemplate);function _templateObject3$6(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section calendar-sync-slider-section-col">\n\t\t\t\t<div class="calendar-sync-slider-header calendar-sync-slider-header-divide">\n\t\t\t\t\t<div class="calendar-sync-slider-subtitle">','</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">',':</span>\n\t\t\t\t\t<ol class="calendar-sync-slider-info-list">\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="calendar-sync-slider-info-item">\n\t\t\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ol>\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">',"</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"]);_templateObject3$6=function t(){return e};return e}function _templateObject2$8(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t"]);_templateObject2$8=function t(){return e};return e}function _templateObject$8(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t","\n\t\t\t","\n\t\t"]);_templateObject$8=function t(){return e};return e}var MacTemplate=function(e){babelHelpers.inherits(t,e);function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{title:main_core.Loc.getMessage("CALENDAR_TITLE_MAC"),helpDeskCode:"5684075",titleInfoHeader:main_core.Loc.getMessage("CAL_CONNECT_MAC_CALENDAR_TITLE"),descriptionInfoHeader:main_core.Loc.getMessage("CAL_MAC_CONNECT_DESCRIPTION"),titleActiveHeader:main_core.Loc.getMessage("CAL_MAC_CALENDAR_IS_CONNECT_TITLE"),descriptionActiveHeader:main_core.Loc.getMessage("CAL_MAC_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-mac",iconPath:"/bitrix/images/calendar/sync/mac.svg",color:"#ff5752",provider:e,connection:n,popupWithUpdateButton:false}))}babelHelpers.createClass(t,[{key:"getPortalAddress",value:function e(){return this.portalAddress}},{key:"getContentInfoBody",value:function e(){return main_core.Tag.render(_templateObject$8(),this.getContentInfoBodyHeader(),this.getContentBodyConnect())}},{key:"getContentActiveBody",value:function e(){return main_core.Tag.render(_templateObject2$8(),this.getContentActiveBodyHeader(),this.getContentBodyConnect())}},{key:"getContentBodyConnect",value:function e(){return main_core.Tag.render(_templateObject3$6(),main_core.Loc.getMessage("CAL_MAC_INSTRUCTION_HEADER"),main_core.Loc.getMessage("CAL_MAC_INSTRUCTION_DESCRIPTION"),main_core.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_FIRST"),main_core.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_SECOND"),main_core.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_THIRD"),main_core.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_FOURTH"),main_core.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_FIFTH").replace(/#PORTAL_ADDRESS#/gi,this.provider.getPortalAddress()),main_core.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_SIXTH"),main_core.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_SEVENTH"),main_core.Loc.getMessage("CAL_MAC_INSTRUCTION_CONCLUSION"))}}]);return t}(InterfaceTemplate);var OutlookTemplate=function(e){babelHelpers.inherits(t,e);function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{title:main_core.Loc.getMessage("CALENDAR_TITLE_MAC"),helpDeskCode:"5684075",titleInfoHeader:main_core.Loc.getMessage("CAL_CONNECT_MAC_CALENDAR_TITLE"),descriptionInfoHeader:main_core.Loc.getMessage("CAL_MAC_CONNECT_DESCRIPTION"),titleActiveHeader:main_core.Loc.getMessage("CAL_MAC_CALENDAR_IS_CONNECT_TITLE"),descriptionActiveHeader:main_core.Loc.getMessage("CAL_MAC_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-mac",iconPath:"/bitrix/images/calendar/sync/mac.svg",color:"#ff5752",provider:e,connection:n,popupWithUpdateButton:false}))}return t}(InterfaceTemplate);var YandexTemplate=function(e){babelHelpers.inherits(t,e);function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{title:main_core.Loc.getMessage("CALENDAR_TITLE_YANDEX"),helpDeskCode:"10930170",titleInfoHeader:main_core.Loc.getMessage("CAL_CONNECT_YANDEX_CALENDAR"),descriptionInfoHeader:main_core.Loc.getMessage("CAL_YANDEX_CONNECT_DESCRIPTION"),titleActiveHeader:main_core.Loc.getMessage("CAL_YANDEX_CALENDAR_IS_CONNECT"),descriptionActiveHeader:main_core.Loc.getMessage("CAL_YANDEX_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-yandex",iconPath:"/bitrix/images/calendar/sync/yandex.svg",color:"#f9c500",provider:e,connection:n,popupWithUpdateButton:true}))}return t}(CaldavInterfaceTemplate);function _templateObject3$7(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-slider-section">\n\t\t\t\t<div class="calendar-sync-slider-header-icon ','"></div>\n\t\t\t\t<div class="calendar-sync-slider-header">\n\t\t\t\t<div class="calendar-sync-slider-title">','</div>\n\t\t\t\t<div class="calendar-sync-slider-info">\n\t\t\t\t\t<span class="calendar-sync-slider-info-text">','</span>\n\t\t\t\t\t<span class="calendar-sync-slider-info-time">','</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-sync-slider-desc">','</div>\n\t\t\t\t\t<a class="calendar-sync-slider-link" href="javascript:void(0);" onclick="','">',"</a>\n\t\t\t\t</div>\n\t\t\t</div>"]);_templateObject3$7=function t(){return e};return e}function _templateObject2$9(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t",'\n\t\t\t<div class="calendar-sync-slider-section calendar-sync-slider-section-banner">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);_templateObject2$9=function t(){return e};return e}function _templateObject$9(){var e=babelHelpers.taggedTemplateLiteral(["\n\t\t\t",'\n\t\t\t<div class="calendar-sync-slider-section calendar-sync-slider-section-banner">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"]);_templateObject$9=function t(){return e};return e}var MobileInterfaceTemplate=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));n.banner=new MobileSyncBanner({type:n.provider.getType(),helpDeskCode:e.helpDeskCode});if(n.status){n.syncDate=main_core.Type.isDate(n.data.syncDate)?n.data.syncDate:calendar_util.Util.parseDate(n.data.syncDate)}return n}babelHelpers.createClass(t,[{key:"getContentInfoBody",value:function e(){return main_core.Tag.render(_templateObject$9(),this.getContentInfoBodyHeader(),this.getContentBodyConnect())}},{key:"getContentActiveBody",value:function e(){return main_core.Tag.render(_templateObject2$9(),this.getContentActiveBodyHeader(),this.getContentBodyConnect())}},{key:"getContentActiveBodyHeader",value:function e(){return main_core.Tag.render(_templateObject3$7(),this.sliderIconClass,this.titleActiveHeader,main_core.Loc.getMessage("CAL_SYNC_LAST_SYNC_DATE"),calendar_util.Util.formatDateUsable(this.connection.getSyncTimestamp())+" "+calendar_util.Util.formatTime(this.connection.getSyncTimestamp()),main_core.Loc.getMessage("CAL_SYNC_DISABLE"),this.showHelp.bind(this),main_core.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"))}},{key:"getContentBodyConnect",value:function e(){this.banner.initQrCode().then(this.banner.drawQRCode.bind(this.banner));return this.banner.getContainer()}}]);return t}(InterfaceTemplate);var AndroidTemplate=function(e){babelHelpers.inherits(t,e);function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{title:main_core.Loc.getMessage("CALENDAR_TITLE_ANDROID"),helpDeskCode:"5686179",titleInfoHeader:main_core.Loc.getMessage("CAL_CONNECT_ANDROID_CALENDAR_TITLE"),descriptionInfoHeader:main_core.Loc.getMessage("CAL_ANDROID_CONNECT_DESCRIPTION"),titleActiveHeader:main_core.Loc.getMessage("CAL_SYNC_CONNECTED_ANDROID_TITLE"),descriptionActiveHeader:main_core.Loc.getMessage("CAL_ANDROID_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-android",iconPath:"/bitrix/images/calendar/sync/android.svg",color:"#9ece03",provider:e,connection:n,popupWithUpdateButton:false}))}return t}(MobileInterfaceTemplate);var IphoneTemplate=function(e){babelHelpers.inherits(t,e);function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{title:main_core.Loc.getMessage("CALENDAR_TITLE_IPHONE"),helpDeskCode:"5686207",titleInfoHeader:main_core.Loc.getMessage("CAL_CONNECT_IPHONE_CALENDAR_TITLE"),descriptionInfoHeader:main_core.Loc.getMessage("CAL_IPHONE_CONNECT_DESCRIPTION"),titleActiveHeader:main_core.Loc.getMessage("CAL_SYNC_CONNECTED_IPHONE_TITLE"),descriptionActiveHeader:main_core.Loc.getMessage("CAL_IPHONE_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-iphone",iconPath:"/bitrix/images/calendar/sync/iphone.svg",color:"#2fc6f6",provider:e,connection:n,popupWithUpdateButton:false}))}return t}(MobileInterfaceTemplate);var ConnectionProvider=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"SLIDER_WIDTH",606);this.status=t.status;this.connected=t.connected;this.connections=t.connections;this.gridTitle=t.gridTitle;this.gridColor=t.gridColor;this.gridIcon=t.gridIcon;this.type=t.type;this.viewClassification=t.viewClassification;this.templateClass=t.templateClass;this.connections=[]}babelHelpers.createClass(e,[{key:"isActive",value:function e(){return this.connected}},{key:"hasMenu",value:function e(){return false}},{key:"setAdditionalParams",value:function e(t){this.additionalParams=t}},{key:"getGridTitle",value:function e(){return this.gridTitle}},{key:"getGridColor",value:function e(){return this.gridColor}},{key:"getGridIcon",value:function e(){return this.gridIcon}},{key:"setConnections",value:function e(){this.connections.push(ConnectionItem.createInstance({syncTimestamp:this.syncTimestamp,connectionName:this.connectionName,status:this.status,connected:this.connected,addParams:{sections:this.sections,id:this.id||this.type},type:this.type}))}},{key:"getConnections",value:function e(){return this.connections}},{key:"getConnection",value:function e(){return this.connections[0]}},{key:"getType",value:function e(){return this.type}},{key:"getViewClassification",value:function e(){return this.viewClassification}},{key:"getConnectStatus",value:function e(){return this.connected}},{key:"getSyncStatus",value:function e(){return this.status}},{key:"getStatus",value:function e(){if(this.connected){return this.status?"success":"failed"}else{return"not_connected"}}},{key:"getTemplateClass",value:function e(){return this.templateClass}},{key:"openSlider",value:function e(t){var n=this;BX.SidePanel.Instance.open(t.sliderId,{contentCallback:function e(n){return new Promise(function(e,n){e(t.content)})},data:t.data||{},cacheable:t.cacheable,width:this.SLIDER_WIDTH,allowChangeHistory:false,events:{onLoad:function e(t){n.itemSlider=t.getSlider()}}})}},{key:"openInfoConnectionSlider",value:function e(){var t=this.getClassTemplateItem().createInstance(this).getInfoConnectionContent();this.openSlider({sliderId:"calendar:item-sync-connect-"+this.type,content:t,cacheable:false,data:{provider:this}})}},{key:"openActiveConnectionSlider",value:function e(t){var n=this.getClassTemplateItem().createInstance(this,t);var a=n.getActiveConnectionContent();this.openSlider({sliderId:"calendar:item-sync-"+t.id,content:a,cacheable:false,data:{provider:this,connection:t,itemInterface:n}})}},{key:"getClassTemplateItem",value:function e(){var t=main_core.Reflection.getClass(this.getTemplateClass());if(main_core.Type.isFunction(t)){return t}return null}},{key:"getConnectionById",value:function e(t){var n=this.getConnections();if(n.length>0){n.forEach(function(e){if(e.getId()===t){return e}})}return this.getConnection()}}],[{key:"createInstance",value:function e(t){return new this(t)}}]);return e}();var MacProvider=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{status:e.syncInfo.status,connected:e.syncInfo.connected,gridTitle:main_core.Loc.getMessage("CALENDAR_TITLE_MAC"),gridColor:"#ff5752",gridIcon:"/bitrix/images/calendar/sync/mac.svg",type:"mac",viewClassification:"web",templateClass:"BX.Calendar.Sync.Interface.MacTemplate"}));n.syncTimestamp=e.syncInfo.syncTimestamp;n.portalAddress=e.portalAddress;n.connectionName=main_core.Loc.getMessage("CALENDAR_TITLE_MAC");n.setConnections();return n}babelHelpers.createClass(t,[{key:"getPortalAddress",value:function e(){return this.portalAddress}}]);return t}(ConnectionProvider);var OutlookProvider=function(_ConnectionProvider){babelHelpers.inherits(OutlookProvider,_ConnectionProvider);function OutlookProvider(e){var t;babelHelpers.classCallCheck(this,OutlookProvider);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(OutlookProvider).call(this,{status:e.syncInfo.status,connected:e.syncInfo.connected,gridTitle:main_core.Loc.getMessage("CALENDAR_TITLE_OUTLOOK"),gridColor:"#ffa900",gridIcon:"/bitrix/images/calendar/sync/outlook.svg",type:"outlook",viewClassification:"web",templateClass:"BX.Calendar.Sync.Interface.OutlookTemplate"}));t.syncTimestamp=e.syncInfo.syncTimestamp;t.connectionName=main_core.Loc.getMessage("CALENDAR_TITLE_OUTLOOK");t.sections=e.sections;t.infoBySections=e.infoBySections;t.setConnections();return t}babelHelpers.createClass(OutlookProvider,[{key:"hasMenu",value:function e(){return this.sections.length>0}},{key:"showMenu",value:function showMenu(bindElement){var _this2=this;if(this.hasMenu()){if(this.menu){this.menu.getPopupWindow().setBindElement(bindElement);this.menu.show()}else{var menuItems=this.getConnection().getSections();menuItems.forEach(function(item){if(_this2.infoBySections[item.id]){item.className="calendar-sync-outlook-popup-item"}item.onclick=function(){if(item&&item.connectURL){try{eval(item.connectURL)}catch(e){}}}});this.menu=new main_popup.Menu({className:"calendar-sync-popup-status",bindElement:bindElement,items:menuItems,width:this.MENU_WIDTH,padding:7,autoHide:true,closeByEsc:true,zIndexAbsolute:3020,id:this.getType()+"-menu"});this.menu.getMenuContainer().addEventListener("click",function(){_this2.menu.close()});this.menu.show()}}}}]);return OutlookProvider}(ConnectionProvider);var AndroidProvider=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{status:e.syncInfo.status,connected:e.syncInfo.connected,gridTitle:main_core.Loc.getMessage("CALENDAR_TITLE_ANDROID"),gridColor:"#9ece03",gridIcon:"/bitrix/images/calendar/sync/android.svg",type:"android",viewClassification:"mobile",templateClass:"BX.Calendar.Sync.Interface.AndroidTemplate"}));n.syncTimestamp=e.syncInfo.syncTimestamp;n.connectionName=main_core.Loc.getMessage("CALENDAR_TITLE_ANDROID");n.setConnections();return n}return t}(ConnectionProvider);function _templateObject4$6(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-sync-item-status"></div>\n\t\t\t']);_templateObject4$6=function t(){return e};return e}function _templateObject3$8(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-sync-item-image">\n\t\t\t\t<div class="calendar-sync-item-image-item" style="background-image: ','"></div>\n\t\t\t</div>']);_templateObject3$8=function t(){return e};return e}function _templateObject2$a(){var e=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-sync-item-title">',"</div>"]);_templateObject2$a=function t(){return e};return e}function _templateObject$a(){var e=babelHelpers.taggedTemplateLiteral(['<div class="calendar-sync-item ','" style="','">\n\t\t\t<div class="calendar-item-content">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</div>\n\t\t</div>"]);_templateObject$a=function t(){return e};return e}var GridUnit=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{id:e.type}));n.item=e;return n}babelHelpers.createClass(t,[{key:"getContent",value:function e(){this.gridUnit=main_core.Tag.render(_templateObject$a(),this.getAdditionalContentClass(),this.getContentStyles(),this.getImage(),this.getTitle(),this.isActive()?this.getStatus():"");this.gridUnit.addEventListener("click",this.onClick.bind(this));return this.gridUnit}},{key:"getTitle",value:function e(){if(!this.layout.title){this.layout.title=main_core.Tag.render(_templateObject2$a(),BX.util.htmlspecialchars(this.item.getGridTitle()))}return this.layout.title}},{key:"getImage",value:function e(){return main_core.Tag.render(_templateObject3$8(),"url("+this.item.getGridIcon()+")")}},{key:"getStatus",value:function e(){if(this.isActive()){return main_core.Tag.render(_templateObject4$6())}return""}},{key:"isActive",value:function e(){return this.item.getConnectStatus()}},{key:"getAdditionalContentClass",value:function e(){if(this.isActive()){if(this.item.getSyncStatus()){return"calendar-sync-item-selected"}else{return"calendar-sync-item-failed"}}else{return""}}},{key:"getContentStyles",value:function e(){if(this.isActive()){return"background-color:"+this.item.getGridColor()+";"}else{return""}}},{key:"onClick",value:function e(){if(this.item.hasMenu()){this.item.showMenu(this.gridUnit)}else if(this.item.getConnectStatus()){this.item.openActiveConnectionSlider(this.item.getConnection())}else{this.item.openInfoConnectionSlider()}}}]);return t}(BX.TileGrid.Item);babelHelpers.defineProperty(GridUnit,"MENU_WIDTH",200);babelHelpers.defineProperty(GridUnit,"MENU_PADDING",7);babelHelpers.defineProperty(GridUnit,"MENU_INDEX",3020);var CaldavConnection=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e))}babelHelpers.createClass(t,[{key:"hasMenu",value:function e(){return this.connected}},{key:"showMenu",value:function e(t){if(this.menu){this.menu.getPopupWindow().setBindElement(t);this.menu.show();return}var n=this.getMenuItems();n.push.apply(n,babelHelpers.toConsumableArray(this.getMenuItemConnect()));this.menu=this.getMenu(t,n);this.addMenuHandler();this.menu.show()}},{key:"addMenuHandler",value:function e(){var t=this;if(this.menu){this.menu.getMenuContainer().addEventListener("click",function(){t.menu.close()})}}},{key:"getMenuItems",value:function e(){var t=this;var n=this.connections;n.forEach(function(e){e.type=t.type;e.id=e.addParams.id;e.text=e.connectionName;e.onclick=function(){t.openActiveConnectionSlider(e)}});return n}},{key:"getMenuItemConnect",value:function e(){var t=this;return[{delimiter:true},{id:"connect",text:main_core.Loc.getMessage("ADD_MENU_CONNECTION"),onclick:function e(){t.openInfoConnectionSlider()}}]}},{key:"getMenu",value:function e(t,n){return new main_popup.Menu({className:"calendar-sync-popup-status",bindElement:t,items:n,width:GridUnit.MENU_WIDTH,padding:GridUnit.MENU_PADDING,autoHide:true,closeByEsc:true,zIndexAbsolute:GridUnit.MENU_INDEX,id:this.getType()+"-menu"})}},{key:"setConnections",value:function e(){var t=this;if(this.connectionsSyncInfo.length>0){this.connectionsSyncInfo.forEach(function(e){t.connections.push(ConnectionItem.createInstance({syncTimestamp:e.syncInfo.syncTimestamp,connectionName:e.syncInfo.connectionName,status:e.syncInfo.status,connected:e.syncInfo.connected,addParams:{sections:e.sections,id:e.syncInfo.id,userName:e.syncInfo.userName,server:e.syncInfo.server},type:t.type}))})}}}],[{key:"calculateStatus",value:function e(t){if(t.length===0){return false}for(var n in t){if(this.isFailedConnections(t[n])){return false}}return true}},{key:"isFailedConnections",value:function e(t){if(t.syncInfo.connected===true&&t.syncInfo.status===false){return true}return false}}]);return t}(ConnectionProvider);var CaldavProvider=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{status:e.status,connected:e.connected,gridTitle:main_core.Loc.getMessage("CALENDAR_TITLE_CALDAV"),gridColor:"#1eae43",gridIcon:"/bitrix/images/calendar/sync/caldav.svg",type:"caldav",viewClassification:"web",templateClass:"BX.Calendar.Sync.Interface.CaldavTemplate"}));n.connectionsSyncInfo=e.connections;n.setConnections(e);return n}return t}(CaldavConnection);var ExchangeProvider=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{status:e.syncInfo.status||false,connected:e.syncInfo.connected||false,gridTitle:main_core.Loc.getMessage("CALENDAR_TITLE_EXCHANGE"),gridColor:"#54d0df",gridIcon:"/bitrix/images/calendar/sync/exchange.svg",type:"exchange",viewClassification:"web",templateClass:"BX.Calendar.Sync.Interface.ExchangeTemplate"}));n.syncTimestamp=e.syncInfo.syncTimestamp;n.connectionName=main_core.Loc.getMessage("CALENDAR_TITLE_EXCHANGE");n.sections=e.sections;n.setConnections();return n}return t}(ConnectionProvider);var GoogleProvider=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{status:e.syncInfo.status||false,connected:e.syncInfo.connected||false,gridTitle:main_core.Loc.getMessage("CALENDAR_TITLE_GOOGLE"),gridColor:"#387ced",gridIcon:"/bitrix/images/calendar/sync/google.svg",type:"google",interfaceClassName:"",viewClassification:"web",templateClass:"BX.Calendar.Sync.Interface.GoogleTemplate"}));n.syncTimestamp=e.syncInfo.syncTimestamp;n.connectionName=e.syncInfo.userName?e.syncInfo.userName:main_core.Loc.getMessage("CALENDAR_TITLE_GOOGLE");n.id=e.syncInfo.id;n.isSetSyncCaldavSettings=e.isSetSyncCaldavSettings;n.syncLink=e.syncLink;n.sections=e.sections;n.setConnections();return n}babelHelpers.createClass(t,[{key:"getSyncLink",value:function e(){return this.syncLink}},{key:"hasSetSyncCaldavSettings",value:function e(){return this.isSetSyncCaldavSettings}}]);return t}(ConnectionProvider);var IphoneProvider=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{status:e.syncInfo.status,connected:e.syncInfo.connected,gridTitle:main_core.Loc.getMessage("CALENDAR_TITLE_IPHONE"),gridColor:"#2fc6f6",gridIcon:"/bitrix/images/calendar/sync/iphone.svg",type:"iphone",viewClassification:"mobile",templateClass:"BX.Calendar.Sync.Interface.IphoneTemplate"}));n.syncTimestamp=e.syncInfo.syncTimestamp;n.connectionName=main_core.Loc.getMessage("CALENDAR_TITLE_IPHONE");n.setConnections();return n}return t}(ConnectionProvider);var YandexProvider=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{status:e.status,connected:e.connected,gridTitle:main_core.Loc.getMessage("CALENDAR_TITLE_YANDEX"),gridColor:"#f9c500",gridIcon:"/bitrix/images/calendar/sync/yandex.svg",type:"yandex",viewClassification:"web",templateClass:"BX.Calendar.Sync.Interface.YandexTemplate"}));n.connectionsSyncInfo=e.connections;n.setConnections(e);return n}return t}(CaldavConnection);var SyncInterfaceManager=function(e){babelHelpers.inherits(t,e);function t(e){var n;babelHelpers.classCallCheck(this,t);n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(n),"status","not_connected");n.setEventNamespace("BX.Calendar.Sync.Interface.SyncInterfaceManager");n.wrapper=e.wrapper;n.syncInfo=e.syncInfo;n.userId=e.userId;n.syncLinks=e.syncLinks;n.sections=e.sections;n.portalAddress=e.portalAddress;n.isRuZone=e.isRuZone;n.calendarInstance=e.calendar;n.isSetSyncCaldavSettings=e.isSetSyncCaldavSettings;n.init();main_core_events.EventEmitter.subscribe("BX.Calendar.Sync.Interface.SyncStatusPopup:onRefresh",function(e){n.refresh(e)});main_core_events.EventEmitter.subscribe("BX.Calendar.Sync.Interface.InterfaceTemplate:reDrawCalendarGrid",function(e){n.reDrawCalendarGrid()});return n}babelHelpers.createClass(t,[{key:"showSyncButton",value:function e(){this.syncButton=SyncButton.createInstance({status:this.status,wrapper:this.wrapper,connectionsProviders:this.connectionsProviders,userId:this.userId});this.syncButton.show()}},{key:"init",value:function e(){this.connectionsProviders={};this.webItems=[];this.mobileItems=[];var t=[];var n=[];var a=this.syncInfo;var s=this.sortSections();for(var i in a){switch(a[i].type){case"yandex":t.push({syncInfo:a[i],sections:s.caldav["caldav"+a[i].id],isRuZone:this.isRuZone});break;case"caldav":n.push({syncInfo:a[i],sections:s.caldav["caldav"+a[i].id]});break}if(a[i].connected===true){if(a[i].status===true&&this.status!=="failed"){this.status="success"}else if(a[i].status===false){this.status="failed"}}}this.connectionsProviders={google:GoogleProvider.createInstance({syncInfo:a.google||{},sections:s.google||{},syncLink:this.syncLinks.google||null,isSetSyncCaldavSettings:this.isSetSyncCaldavSettings}),caldav:CaldavProvider.createInstance({status:CaldavConnection.calculateStatus(n),connected:n.length>0,connections:n}),iphone:IphoneProvider.createInstance({syncInfo:a.iphone}),android:AndroidProvider.createInstance({syncInfo:a.android}),mac:MacProvider.createInstance({syncInfo:a.mac,portalAddress:this.portalAddress})};if(this.isRuZone){this.connectionsProviders.yandex=YandexProvider.createInstance({status:CaldavConnection.calculateStatus(t),connected:t.length>0,connections:t})}if(!BX.browser.IsMac()){this.connectionsProviders.outlook=OutlookProvider.createInstance({syncInfo:a.outlook,sections:s.outlook,infoBySections:a.outlook.infoBySections||{}})}var r=Object.prototype.hasOwnProperty;if(r.call(a,"exchange")){this.connectionsProviders.exchange=ExchangeProvider.createInstance({syncInfo:a.exchange})}}},{key:"sortSections",value:function e(){var t=this.sections;var n=[];var a=[];var s={};var i=[];s.caldav={};t.forEach(function(e){if(e.belongsToView()&&e.data.OUTLOOK_JS){i.push({id:e.id,connectURL:e.data.OUTLOOK_JS,text:e.name})}if(e.data["IS_EXCHANGE"]===true){n.push(e.data)}else if(e.data["GAPI_CALENDAR_ID"]&&e.data["CAL_DAV_CON"]){a.push(e.data)}else if(e.data["CAL_DAV_CON"]&&e.data["CAL_DAV_CAL"]){s.caldav["caldav"+e.data["CAL_DAV_CON"]]=e.data}});s.google=a;s.exchange=n;s.outlook=i;return s}},{key:"refresh",value:function e(t){var n=this;var a=t.getTarget();BX.ajax.runAction("calendar.api.calendarajax.updateConnection",{data:{type:"user"}}).then(function(e){n.syncInfo=e.data;n.init();n.refreshCalendarGrid();n.refreshSyncButton();n.refreshActivePopup(a);n.refreshOpenSliders(a)})}},{key:"refreshCalendarGrid",value:function e(){this.calendarInstance.reload()}},{key:"refreshSyncButton",value:function e(){this.syncButton.refresh(this.status,this.connectionsProviders)}},{key:"refreshActivePopup",value:function e(t){if(t.getId()==="calendar-syncPanel-status"){t.refresh(this.getConnections())}}},{key:"refreshOpenSliders",value:function e(t){var n=this;var a=BX.SidePanel.Instance.getOpenSliders();if(a.length>0){var s=this.syncButton.getSyncPanel();a.forEach(function(e){if(e.getUrl()==="calendar:sync-slider"){n.refreshMainSlider(s,e)}else{n.refreshConnectionSlider(e,t)}})}}},{key:"refreshConnectionSlider",value:function e(t,n){var a=t.getData().get("itemInterface");var s=t.getData().get("connection");var i=this.connectionsProviders[s.getType()].getConnectionById(s.getId());n.refresh([i]);a.setConnection(i);t.reload()}},{key:"refreshMainSlider",value:function e(t,n){t.refresh(this.status,this.connectionsProviders);n.reload()}},{key:"getConnections",value:function e(){var t=[];var n=Object.values(this.connectionsProviders);n.forEach(function(e){var n=e.getConnections();if(n.length>0){n.forEach(function(e){if(e.getConnectStatus()===true){t.push(e)}})}});return t}},{key:"reDrawCalendarGrid",value:function e(){this.calendarInstance.reload()}}]);return t}(main_core_events.EventEmitter);exports.SyncInterfaceManager=SyncInterfaceManager;exports.SyncButton=SyncButton;exports.SyncPanelItem=SyncPanelItem;exports.ConnectionControls=ConnectionControls;exports.MobileSyncBanner=MobileSyncBanner;exports.SyncPanel=SyncPanel;exports.GridUnit=GridUnit;exports.YandexTemplate=YandexTemplate;exports.CaldavTemplate=CaldavTemplate;exports.MacTemplate=MacTemplate;exports.ExchangeTemplate=ExchangeTemplate;exports.GoogleTemplate=GoogleTemplate;exports.OutlookTemplate=OutlookTemplate;exports.IphoneTemplate=IphoneTemplate;exports.AndroidTemplate=AndroidTemplate})(this.BX.Calendar.Sync.Interface=this.BX.Calendar.Sync.Interface||{},BX.UI.Dialogs,BX.Calendar,BX.Event,BX,BX,BX.Main,BX);
//# sourceMappingURL=syncinterface.bundle.map.js