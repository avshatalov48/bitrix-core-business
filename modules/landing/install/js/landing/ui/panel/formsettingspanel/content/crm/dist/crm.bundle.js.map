{"version":3,"file":"crm.bundle.js","sources":["../src/internal/stagefield/stagefield.js","../src/crm.js"],"sourcesContent":["import {BaseField} from 'landing.ui.field.basefield';\nimport {Loc} from 'landing.loc';\nimport {Dom, Tag, Type} from 'main.core';\n\nimport './css/style.css';\n\nconst fetchId = (item) => {\n\treturn !Type.isNil(item.ID) ? item.ID : item.id;\n};\n\nconst fetchName = (item) => {\n\treturn !Type.isNil(item.NAME) ? item.NAME : item.name;\n};\n\nexport default class StageField extends BaseField\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tDom.replace(this.input, this.getInner());\n\t}\n\n\tgetInner()\n\t{\n\t\treturn this.cache.remember('inner', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-field-stages\">\n\t\t\t\t\t${this.getCategoriesDropdown().getLayout()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetCategoriesDropdown(): BX.Landing.UI.Field.Dropdown\n\t{\n\t\treturn this.cache.remember('categoriesDropdown', () => {\n\t\t\treturn new BX.Landing.UI.Field.Dropdown({\n\t\t\t\ttitle: this.options.listTitle || Loc.getMessage('LANDING_FORM_SETTINGS_CATEGORIES_FIELD_TITLE'),\n\t\t\t\tcontent: this.options.value.category,\n\t\t\t\titems: this.options.categories.map((category) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: fetchName(category),\n\t\t\t\t\t\tvalue: fetchId(category),\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tonChange: this.onCategoryChange.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCurrentCategory()\n\t{\n\t\tconst currentCategoryId = this.getCategoriesDropdown().getValue();\n\n\t\treturn this.options.categories.find((category) => {\n\t\t\treturn String(fetchId(category)) === String(currentCategoryId);\n\t\t});\n\t}\n\n\tonCategoryChange()\n\t{\n\t\tthis.emit('onChange');\n\t}\n\n\tgetValue()\n\t{\n\t\treturn {\n\t\t\tcategory: this.getCategoriesDropdown().getValue(),\n\t\t\tstage: '',\n\t\t};\n\t}\n\n\tsetValue(value, preventEvent = false)\n\t{\n\t\tthis.getCategoriesDropdown().setValue(value.category);\n\n\t\tif (!preventEvent)\n\t\t{\n\t\t\tthis.emit('onChange');\n\t\t}\n\t}\n}","import {Loc} from 'landing.loc';\nimport {Button, ButtonColor} from 'ui.buttons';\nimport {HeaderCard} from 'landing.ui.card.headercard';\nimport {ContentWrapper} from 'landing.ui.panel.basepresetpanel';\nimport {RadioButtonField} from 'landing.ui.field.radiobuttonfield';\nimport {BaseEvent} from 'main.core.events';\nimport {FormSettingsForm} from 'landing.ui.form.formsettingsform';\nimport {Text, Type} from 'main.core';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport StageField from './internal/stagefield/stagefield';\nimport { SchemeManager } from 'landing.ui.panel.formsettingspanel.content.crm.schememanager';\n\nimport './css/style.css';\n\ntype CrmField = {\n\ttype: 'list' | 'string' | 'checkbox' | 'date' | 'text' | 'typed_string' | 'file',\n\tentity_field_name: string,\n\tentity_name: string,\n\tname: string,\n\tcaption: string,\n\tmultiple: boolean,\n\trequired: boolean,\n\thidden: boolean,\n\titems: Array<{ID: any, VALUE: any}>,\n};\n\nexport default class CrmContent extends ContentWrapper\n{\n\t#schemeManager: SchemeManager;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel.CrmContent');\n\n\t\tthis.#schemeManager = new SchemeManager([ ...options.dictionary.document.schemes ]);\n\n\t\tthis.addItem(this.getHeader());\n\t\tthis.addItem(this.getTypesField());\n\t\tif (this.isDynamicAvailable())\n\t\t{\n\t\t\tthis.addItem(this.getDynamicEntitySettingsForm());\n\t\t}\n\n\t\tthis.addItem(this.getExpertSettingsForm());\n\t\tthis.addItem(this.getOrderSettingsForm());\n\n\t\tthis.setLastScheme(this.options.formOptions.document.scheme);\n\t\tthis.setLastDealCategory(this.options.formOptions.document.deal.category);\n\t}\n\n\tisDynamicAvailable(): boolean\n\t{\n\t\treturn Type.isArrayFilled(this.options.dictionary.document.dynamic);\n\t}\n\n\tgetHeader(): HeaderCard\n\t{\n\t\treturn this.cache.remember('header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TITLE'),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDuplicatesField(): BX.Landing.UI.Field.Radio\n\t{\n\t\treturn this.cache.remember('duplicatesField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Radio({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_FIELD_TITLE'),\n\t\t\t\tselector: 'duplicateMode',\n\t\t\t\tvalue: [this.options.formOptions.document.duplicateMode ? this.options.formOptions.document.duplicateMode : 'ALLOW'],\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_ALLOW'),\n\t\t\t\t\t\tvalue: 'ALLOW',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_REPLACE'),\n\t\t\t\t\t\tvalue: 'REPLACE',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_DUPLICATES_MERGE'),\n\t\t\t\t\t\tvalue: 'MERGE',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetOrderSettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('formSettingsForm', () => {\n\t\t\tconst scheme = this.getSchemeById(this.options.formOptions.document.scheme);\n\t\t\tconst isOpened = (() => {\n\t\t\t\tif (scheme && scheme.dynamic === true)\n\t\t\t\t{\n\t\t\t\t\treturn String(scheme.id).endsWith('1');\n\t\t\t\t}\n\n\t\t\t\treturn Text.toNumber(this.options.formOptions.document.scheme) > 4;\n\t\t\t})();\n\n\t\t\treturn new FormSettingsForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_ORDER_HEADER'),\n\t\t\t\ttoggleable: true,\n\t\t\t\topened: isOpened,\n\t\t\t\tfields: [],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType1Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type1header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_1').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType2Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type2header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_2').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType3Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type3header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_3').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType4Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type4header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_4').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetType6Header(): HeaderCard\n\t{\n\t\treturn this.cache.remember('type6header', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_6').replace('&nbsp;', ' '),\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDynamicHeader(headerText: string): HeaderCard\n\t{\n\t\tconst header = this.cache.remember('dynamicHeader', () => {\n\t\t\treturn new HeaderCard({\n\t\t\t\ttitle: '',\n\t\t\t\tlevel: 2,\n\t\t\t});\n\t\t});\n\n\t\tif (Type.isString(headerText))\n\t\t{\n\t\t\theader.setTitle(headerText);\n\t\t}\n\n\t\treturn header;\n\t}\n\n\tgetDynamicEntitiesField(): BX.Landing.UI.Field.Dropdown\n\t{\n\t\treturn this.cache.remember('dynamicEntitiesField', () => {\n\t\t\tconst currentScheme = this.getSchemeById(this.options.formOptions.document.scheme);\n\n\t\t\treturn new BX.Landing.UI.Field.Dropdown({\n\t\t\t\tselector: 'dynamicScheme',\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_SMART_ENTITY_LIST'),\n\t\t\t\titems: this.options.dictionary.document.dynamic.map((scheme) => {\n\t\t\t\t\treturn {name: scheme.name, value: scheme.id};\n\t\t\t\t}),\n\t\t\t\tcontent: currentScheme.mainEntity,\n\t\t\t\tonChange: () => {\n\t\t\t\t\tthis.onTypeChange(\n\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\t\t\tid: this.getSelectedSchemeId(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDynamicEntitySettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('dynamicEntitySettingsForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\topened: true,\n\t\t\t\thidden: true,\n\t\t\t\tfields: [\n\t\t\t\t\tthis.getDynamicEntitiesField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetExpertSettingsForm(): FormSettingsForm\n\t{\n\t\treturn this.cache.remember('expertSettingsForm', () => {\n\t\t\treturn new FormSettingsForm({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_EXPERT_MODE'),\n\t\t\t\ttoggleable: true,\n\t\t\t\ttoggleableType: FormSettingsForm.ToggleableType.Link,\n\t\t\t\topened: false,\n\t\t\t\tfields: [\n\t\t\t\t\tnew HeaderCard({\n\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_1').replace('&nbsp;', ' '),\n\t\t\t\t\t\tlevel: 2,\n\t\t\t\t\t}),\n\t\t\t\t\tthis.getDuplicatesField(),\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTypesField(): RadioButtonField\n\t{\n\t\treturn this.cache.remember('typesField', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.onTypeChange(\n\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\t\tid: this.options.formOptions.document.scheme,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tconst items = [\n\t\t\t\t{\n\t\t\t\t\tid: '2',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_2'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type2',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: '3',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_3'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type3',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: '4',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_4'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type4',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: '310',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_310'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type310',\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tif (this.isDynamicAvailable())\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\tid: 'smart',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_5'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type5',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.options.isLeadEnabled)\n\t\t\t{\n\t\t\t\titems.unshift({\n\t\t\t\t\tid: '1',\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_TYPE_1'),\n\t\t\t\t\ticon: 'landing-ui-crm-entity-type1',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn new RadioButtonField({\n\t\t\t\tselector: 'scheme',\n\t\t\t\tvalue: (() => {\n\t\t\t\t\tconst schemeId = Text.toNumber(this.options.formOptions.document.scheme);\n\t\t\t\t\tif (this.#schemeManager.isDefaultScheme(schemeId) && this.#schemeManager.isInvoice(schemeId))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.#schemeManager.getSpecularSchemeId(schemeId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (String(this.options.formOptions.document.scheme) === '310')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 310;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst scheme = this.getSchemeById(this.options.formOptions.document.scheme);\n\t\t\t\t\tif (Type.isPlainObject(scheme) && scheme.dynamic === true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 'smart';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn String(schemeId);\n\t\t\t\t})(),\n\t\t\t\titems,\n\t\t\t\tonChange: this.onTypeChange.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDealCategoryField()\n\t{\n\t\treturn this.cache.remember('dealCategoryField', () => {\n\t\t\treturn new StageField({\n\t\t\t\tcategories: this.options.categories,\n\t\t\t\tvalue: {\n\t\t\t\t\tcategory: this.options.formOptions.document.deal.category,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDynamicCategoriesField(schemeId: string | number)\n\t{\n\t\treturn this.cache.remember(`dynamicCategories#${schemeId}`, () => {\n\t\t\tconst scheme = this.getDynamicSchemeById(schemeId);\n\t\t\treturn new StageField({\n\t\t\t\tlistTitle: Loc.getMessage('LANDING_FORM_SETTINGS_SMART_STAGES_FIELD_TITLE'),\n\t\t\t\tcategories: scheme.categories,\n\t\t\t\tvalue: {\n\t\t\t\t\tcategory: this.options.formOptions.document.dynamic.category,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDuplicatesEnabledField()\n\t{\n\t\treturn this.cache.remember('duplicatesEnabledField', () => {\n\t\t\treturn new BX.Landing.UI.Field.Checkbox({\n\t\t\t\tselector: 'duplicatesEnabled',\n\t\t\t\tcompact: true,\n\t\t\t\tvalue: [this.options.formOptions.document.deal.duplicatesEnabled || 'Y'],\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: Loc.getMessage('LANDING_FORM_SETTINGS_CRM_DUPLICATES_ENABLED'),\n\t\t\t\t\t\tvalue: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSchemeById(id: number)\n\t{\n\t\treturn this.options.dictionary.document.schemes.find((scheme) => {\n\t\t\treturn (\n\t\t\t\t(String(scheme.id) === String(id))\n\t\t\t\t|| (\n\t\t\t\t\tid === 'smart'\n\t\t\t\t\t&& scheme.dynamic\n\t\t\t\t\t&& String(scheme.id) === String(this.getSelectedSchemeId())\n\t\t\t\t)\n\t\t\t);\n\t\t});\n\t}\n\n\tgetDynamicSchemeById(id: number)\n\t{\n\t\tconst {mainEntity} = this.getSchemeById(id);\n\t\treturn this.options.dictionary.document.dynamic.find((scheme) => {\n\t\t\treturn String(scheme.id) === String(mainEntity);\n\t\t});\n\t}\n\n\tsetLastScheme(schemeId: number)\n\t{\n\t\tthis.cache.set('lastScheme', schemeId);\n\t}\n\n\tgetLastScheme(): number\n\t{\n\t\treturn this.cache.get('lastScheme');\n\t}\n\n\tsetLastDealCategory(categoryId: number)\n\t{\n\t\tthis.cache.set('lastDealCategory', categoryId);\n\t}\n\n\tgetLastDealCategory(): ?number\n\t{\n\t\treturn this.cache.get('lastDealCategory', null);\n\t}\n\n\tonTypeChange(event: BaseEvent)\n\t{\n\t\tconst {item} = event.getData();\n\t\tconst scheme = this.getSchemeById(item.id);\n\n\t\tthis.clear();\n\n\t\tthis.addItem(this.getHeader());\n\t\tthis.addItem(this.getTypesField());\n\t\tif (this.isDynamicAvailable())\n\t\t{\n\t\t\tthis.addItem(this.getDynamicEntitySettingsForm());\n\t\t\tthis.getDynamicEntitySettingsForm().hide();\n\t\t}\n\n\t\tconst expertSettingsForm = this.getExpertSettingsForm();\n\t\texpertSettingsForm.clear();\n\n\t\tif (String(item.id) === '1' || String(item.id) === '8')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType1Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (String(item.id) === '2' || String(item.id) === '5')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType2Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (String(item.id) === '3' || String(item.id) === '6')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType3Header());\n\t\t\texpertSettingsForm.addField(this.getDealCategoryField());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesEnabledField());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (String(item.id) === '4' || String(item.id) === '7')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType4Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\t\tif (String(item.id) === '310')\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getType6Header());\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\t\t}\n\n\t\tif (\n\t\t\t(\n\t\t\t\tText.toNumber(item.id) > 4\n\t\t\t\t&& Type.isPlainObject(scheme)\n\t\t\t\t&& scheme.dynamic !== true && String(item.id)  !== '9'\n\t\t\t)\n\t\t\t|| this.getOrderSettingsForm().isOpened()\n\t\t)\n\t\t{\n\t\t\tthis.getOrderSettingsForm().onSwitchChange(true);\n\t\t}\n\n\t\tif (\n\t\t\tType.isPlainObject(scheme)\n\t\t\t&& (String(item.id) === 'smart' || scheme.dynamic === true)\n\t\t\t&& this.isDynamicAvailable()\n\t\t)\n\t\t{\n\t\t\texpertSettingsForm.addField(this.getDynamicHeader(scheme.name));\n\t\t\tconst dynamicScheme = this.getDynamicSchemeById(scheme.id);\n\t\t\tif (dynamicScheme && dynamicScheme.categories)\n\t\t\t{\n\t\t\t\texpertSettingsForm.addField(this.getDynamicCategoriesField(scheme.id));\n\t\t\t}\n\t\t\texpertSettingsForm.addField(this.getDuplicatesField());\n\n\t\t\tif (String(scheme.id).endsWith('1'))\n\t\t\t{\n\t\t\t\tthis.getOrderSettingsForm().onSwitchChange(true);\n\t\t\t}\n\n\t\t\tthis.getDynamicEntitySettingsForm().show();\n\t\t}\n\n\t\tthis.addItem(expertSettingsForm);\n\t\tif (String(item.id) !== '310')\n\t\t{\n\t\t\tthis.addItem(this.getOrderSettingsForm());\n\t\t}\n\t}\n\n\tsetAdditionalValue(value: {[key: string]: any})\n\t{\n\t\tthis.cache.set('additionalValue', value);\n\t}\n\n\tgetAdditionalValue(): {[key: string]: any}\n\t{\n\t\treturn this.cache.get('additionalValue', {});\n\t}\n\n\tgetEntityChangeConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('entityChangeConfirm', () => {\n\t\t\treturn new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDealCategoryChangeConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('dealCategoryChangeConfirm', () => {\n\t\t\treturn new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCreateOrderChangeConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('createOrderChangeConfirm', () => {\n\t\t\treturn new MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CREATE_ORDER_CHANGE_CONFIRM_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tmessage: Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_CREATE_ORDER_MESSAGE_BOX_TITLE_1')\n\t\t\t});\n\t\t});\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tconst value = this.getValue();\n\t\tconst scheme = this.getSchemeById(value.document.scheme);\n\n\t\tif (Type.isPlainObject(scheme))\n\t\t{\n\t\t\tconst allowedEntities = scheme.entities;\n\t\t\tconst removedFields = this.options.formOptions.presetFields\n\t\t\t\t.filter((presetField) => {\n\t\t\t\t\treturn !allowedEntities.includes(presetField.entityName);\n\t\t\t\t})\n\t\t\t\t.map((presetField) => {\n\t\t\t\t\treturn this.getCrmFieldById(\n\t\t\t\t\t\t`${presetField.entityName}_${presetField.fieldName}`,\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\tif (Type.isArrayFilled(removedFields))\n\t\t\t{\n\t\t\t\tconst itemTemplate = Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_ITEM_TEMPLATE');\n\t\t\t\tconst entityName = Text.encode(itemTemplate.replace('{text}', scheme.name));\n\n\t\t\t\tconst messageText = (() => {\n\t\t\t\t\tconst fields = removedFields.map((field) => {\n\t\t\t\t\t\treturn itemTemplate.replace('{text}', Text.encode(field.caption));\n\t\t\t\t\t});\n\n\t\t\t\t\tif (removedFields.length > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst lastField = fields.pop();\n\n\t\t\t\t\t\treturn Loc\n\t\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TEXT')\n\t\t\t\t\t\t\t.replace('{fieldsList}', fields.join(', '))\n\t\t\t\t\t\t\t.replace('{lastField}', Text.encode(lastField))\n\t\t\t\t\t\t\t.replaceAll('{entityName}', entityName);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Loc\n\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_SCHEME_CHANGE_CONFIRM_TEXT_1')\n\t\t\t\t\t\t.replace('{fieldName}', fields.join(', '))\n\t\t\t\t\t\t.replaceAll('{entityName}', entityName);\n\t\t\t\t})();\n\n\t\t\t\tconst entityChangeConfirm = this.getEntityChangeConfirm();\n\n\t\t\t\tentityChangeConfirm.setOkCallback(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tentityChangeConfirm.close();\n\t\t\t\t\t\tentityChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\tentityChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\tconst filteredFields = this.options.formOptions.presetFields.filter((presetField) => {\n\t\t\t\t\t\t\treturn allowedEntities.includes(presetField.entityName);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.setLastScheme(scheme.id);\n\t\t\t\t\t\tthis.setAdditionalValue({\n\t\t\t\t\t\t\tpresetFields: filteredFields,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.options.formOptions.presetFields = filteredFields;\n\n\t\t\t\t\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\n\t\t\t\t\t\tthis.setAdditionalValue({});\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tentityChangeConfirm.setCancelCallback(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tentityChangeConfirm.close();\n\t\t\t\t\t\tentityChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\tentityChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\tconst lastScheme = this.getSchemeById(this.getLastScheme());\n\n\t\t\t\t\t\tif (lastScheme.dynamic)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getTypesField().setValue('smart', true);\n\t\t\t\t\t\t\tthis.getDynamicEntitiesField().setValue(lastScheme.mainEntity, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getTypesField().setValue(lastScheme.id);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.onTypeChange(\n\t\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\t\t\t\tid: lastScheme.id,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tentityChangeConfirm.setMessage(messageText);\n\n\t\t\t\tentityChangeConfirm.show();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tString(scheme.id) === '3'\n\t\t\t\t|| String(scheme.id) === '6'\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst lastDealCategory = this.getLastDealCategory();\n\t\t\t\tif (Text.toNumber(value.document.deal.category) !== Text.toNumber(lastDealCategory))\n\t\t\t\t{\n\t\t\t\t\tconst dealStageField = this.options.formOptions.presetFields.find((presetField) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tpresetField.entityName === 'DEAL'\n\t\t\t\t\t\t\t&& presetField.fieldName === 'STAGE_ID'\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (dealStageField)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst crmField = this.getCrmFieldById('DEAL_STAGE_ID');\n\t\t\t\t\t\tconst dealCategoryChangeConfirm = this.getDealCategoryChangeConfirm();\n\n\t\t\t\t\t\tconst fieldName = Loc\n\t\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_ITEM_TEMPLATE')\n\t\t\t\t\t\t\t.replace('{text}', Text.encode(crmField.caption));\n\t\t\t\t\t\tconst messageText = Loc\n\t\t\t\t\t\t\t.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_CATEGORY_CHANGE_CONFIRM_TEXT')\n\t\t\t\t\t\t\t.replace('{fieldName}', fieldName);\n\n\t\t\t\t\t\tdealCategoryChangeConfirm.setMessage(messageText);\n\t\t\t\t\t\tdealCategoryChangeConfirm.setOkCallback(\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.close();\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\t\t\tconst filteredFields = (\n\t\t\t\t\t\t\t\t\tthis.options.formOptions.presetFields.filter((presetField) => {\n\t\t\t\t\t\t\t\t\t\treturn presetField !== dealStageField;\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tthis.options.formOptions.presetFields = filteredFields;\n\n\t\t\t\t\t\t\t\tthis.setLastDealCategory(value.document.deal.category);\n\t\t\t\t\t\t\t\tthis.setAdditionalValue({\n\t\t\t\t\t\t\t\t\tpresetFields: filteredFields,\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t\t\t\t\t\t\t\tthis.setAdditionalValue({});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tdealCategoryChangeConfirm.setCancelCallback(\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.close();\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\t\t\tdealCategoryChangeConfirm.getCancelButton().setDisabled(false);\n\n\t\t\t\t\t\t\t\tthis.getDealCategoryField().setValue({\n\t\t\t\t\t\t\t\t\tcategory: this.getLastDealCategory(),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.setAdditionalValue({});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tdealCategoryChangeConfirm.show();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!this.#schemeManager.isInvoice(scheme.id) && value.document.payment.use)\n\t\t{\n\t\t\tconst createOrderMessageBox = this.getCreateOrderChangeConfirm();\n\t\t\tcreateOrderMessageBox.setButtons(\n\t\t\t\t[\n\t\t\t\t\t(new Button())\n\t\t\t\t\t\t.setColor(ButtonColor.PRIMARY)\n\t\t\t\t\t\t.setText(Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_CREATE_ORDER_MESSAGE_BOX_CANCEL'))\n\t\t\t\t\t\t.setNoCaps(true)\n\t\t\t\t\t\t.bindEvent('click', (button) => {\n\t\t\t\t\t\t\tcreateOrderMessageBox.close();\n\t\t\t\t\t\t\tbutton.setDisabled(false)\n\n\t\t\t\t\t\t\tconst orderSettingsSwitch = this.getOrderSettingsForm().getSwitch();\n\t\t\t\t\t\t\torderSettingsSwitch.setValue(true);\n\t\t\t\t\t\t\torderSettingsSwitch.onChange();\n\n\t\t\t\t\t\t\tthis.onChange(event);\n\t\t\t\t\t\t}),\n\t\t\t\t\t(new Button())\n\t\t\t\t\t\t.setColor(ButtonColor.LIGHT)\n\t\t\t\t\t\t.setText(Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_CRM_CREATE_ORDER_MESSAGE_BOX_OK'))\n\t\t\t\t\t\t.setNoCaps(true)\n\t\t\t\t\t\t.bindEvent('click', (button) => {\n\t\t\t\t\t\t\tcreateOrderMessageBox.close();\n\t\t\t\t\t\t\tbutton.setDisabled(false);\n\n\t\t\t\t\t\t\tthis.options.formOptions.payment.use = false;\n\n\t\t\t\t\t\t\tthis.onChange(event);\n\t\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t);\n\t\t\tcreateOrderMessageBox.show();\n\t\t}\n\n\t\tthis.emit('onChange', {...event.getData(), skipPrepare: true});\n\t}\n\n\tgetCrmFieldById(id: string): ?CrmField\n\t{\n\t\treturn Object.values(this.options.crmFields)\n\t\t\t.reduce((acc, category) => {\n\t\t\t\treturn [...acc, ...category.FIELDS];\n\t\t\t}, [])\n\t\t\t.find((currentField) => {\n\t\t\t\treturn currentField.name === id;\n\t\t\t});\n\t}\n\n\tgetSelectedSchemeId(): number\n\t{\n\t\tconst typeId = this.getTypesField().getValue();\n\t\tif (String(typeId) === 'smart')\n\t\t{\n\t\t\tconst entityId = this.getDynamicEntitiesField().getValue();\n\t\t\tif (this.getOrderSettingsForm().isOpened())\n\t\t\t{\n\t\t\t\treturn `${entityId}1`;\n\t\t\t}\n\n\t\t\treturn `${entityId}0`;\n\t\t}\n\n\t\treturn typeId;\n\t}\n\n\tvalueReducer(value: {[p: string]: any}): {[p: string]: any}\n\t{\n\t\tconst duplicateMode = this.getDuplicatesField().getValue()[0];\n\t\tconst reducedValue = {\n\t\t\tduplicateMode: duplicateMode === 'ALLOW' ? '' : duplicateMode,\n\t\t\tscheme: this.getSelectedSchemeId(),\n\t\t\tdeal: {\n\t\t\t\tduplicatesEnabled: Text.toBoolean(this.getDuplicatesEnabledField().getValue()[0]),\n\t\t\t},\n\t\t\tpayment: {\n\t\t\t\tuse: this.options.formOptions.payment.use,\n\t\t\t\tpayer: this.options.formOptions.payment.payer,\n\t\t\t\tdisabledSystems: this.options.formOptions.payment.disabledSystems,\n\t\t\t},\n\t\t\tdynamic: {\n\t\t\t\tcategory: null,\n\t\t\t},\n\t\t};\n\n\t\tif (this.getOrderSettingsForm().isOpened())\n\t\t{\n\t\t\tif (String(reducedValue.scheme) === '1')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '8';\n\t\t\t}\n\n\t\t\tif (String(reducedValue.scheme) === '2')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '5';\n\t\t\t}\n\n\t\t\tif (String(reducedValue.scheme) === '3')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '6';\n\t\t\t}\n\n\t\t\tif (String(reducedValue.scheme) === '4')\n\t\t\t{\n\t\t\t\treducedValue.scheme = '7';\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tString(reducedValue.scheme) === '3'\n\t\t\t|| String(reducedValue.scheme) === '6'\n\t\t)\n\t\t{\n\t\t\treducedValue.deal.category = this.getDealCategoryField().getValue().category;\n\t\t}\n\n\t\tconst scheme = this.getSchemeById(reducedValue.scheme);\n\t\tconst dynamicScheme = this.getDynamicSchemeById(reducedValue.scheme);\n\t\tif (Type.isPlainObject(scheme) && scheme.dynamic && dynamicScheme && dynamicScheme.categories)\n\t\t{\n\t\t\treducedValue.dynamic.category = this.getDynamicCategoriesField(scheme.id).getValue().category;\n\t\t}\n\n\t\treturn {\n\t\t\tdocument: reducedValue,\n\t\t\t...this.getAdditionalValue(),\n\t\t};\n\t}\n}"],"names":["fetchId","item","Type","isNil","ID","id","fetchName","NAME","name","StageField","options","Dom","replace","input","getInner","cache","remember","Tag","render","getCategoriesDropdown","getLayout","BX","Landing","UI","Field","Dropdown","title","listTitle","Loc","getMessage","content","value","category","items","categories","map","onChange","onCategoryChange","bind","currentCategoryId","getValue","find","String","emit","stage","preventEvent","setValue","BaseField","CrmContent","setEventNamespace","SchemeManager","dictionary","document","schemes","addItem","getHeader","getTypesField","isDynamicAvailable","getDynamicEntitySettingsForm","getExpertSettingsForm","getOrderSettingsForm","setLastScheme","formOptions","scheme","setLastDealCategory","deal","isArrayFilled","dynamic","HeaderCard","Radio","selector","duplicateMode","getSchemeById","isOpened","endsWith","Text","toNumber","FormSettingsForm","toggleable","opened","fields","level","headerText","header","isString","setTitle","currentScheme","mainEntity","onTypeChange","BaseEvent","data","getSelectedSchemeId","hidden","getDynamicEntitiesField","toggleableType","ToggleableType","Link","getDuplicatesField","setTimeout","icon","push","isLeadEnabled","unshift","RadioButtonField","schemeId","isDefaultScheme","isInvoice","getSpecularSchemeId","isPlainObject","getDynamicSchemeById","Checkbox","compact","duplicatesEnabled","set","get","categoryId","event","getData","clear","hide","expertSettingsForm","addField","getType1Header","getType2Header","getType3Header","getDealCategoryField","getDuplicatesEnabledField","getType4Header","getType6Header","onSwitchChange","getDynamicHeader","dynamicScheme","getDynamicCategoriesField","show","MessageBox","buttons","MessageBoxButtons","OK_CANCEL","message","allowedEntities","entities","removedFields","presetFields","filter","presetField","includes","entityName","getCrmFieldById","fieldName","itemTemplate","encode","messageText","field","caption","length","lastField","pop","join","replaceAll","entityChangeConfirm","getEntityChangeConfirm","setOkCallback","close","getOkButton","setDisabled","getCancelButton","filteredFields","setAdditionalValue","skipPrepare","setCancelCallback","lastScheme","getLastScheme","setMessage","lastDealCategory","getLastDealCategory","dealStageField","crmField","dealCategoryChangeConfirm","getDealCategoryChangeConfirm","payment","use","createOrderMessageBox","getCreateOrderChangeConfirm","setButtons","Button","setColor","ButtonColor","PRIMARY","setText","setNoCaps","bindEvent","button","orderSettingsSwitch","getSwitch","LIGHT","Object","values","crmFields","reduce","acc","FIELDS","currentField","typeId","entityId","reducedValue","toBoolean","payer","disabledSystems","getAdditionalValue","ContentWrapper"],"mappings":"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"}