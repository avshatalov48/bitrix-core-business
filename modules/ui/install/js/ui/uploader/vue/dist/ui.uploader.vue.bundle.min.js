this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,s,t,a,l){"use strict";var r=babelHelpers.classPrivateFieldLooseKey("uploader");var i=babelHelpers.classPrivateFieldLooseKey("items");var o=babelHelpers.classPrivateFieldLooseKey("uploaderError");var d=babelHelpers.classPrivateFieldLooseKey("removeFilesFromServer");var p=babelHelpers.classPrivateFieldLooseKey("handleFileAdd");var n=babelHelpers.classPrivateFieldLooseKey("handleFileRemove");var b=babelHelpers.classPrivateFieldLooseKey("handleFileStateChange");var h=babelHelpers.classPrivateFieldLooseKey("handleFileComplete");var c=babelHelpers.classPrivateFieldLooseKey("handleFileError");var v=babelHelpers.classPrivateFieldLooseKey("handleError");var u=babelHelpers.classPrivateFieldLooseKey("handleUploadStart");var P=babelHelpers.classPrivateFieldLooseKey("handleUploadComplete");class F extends l.EventEmitter{constructor(e){super();Object.defineProperty(this,P,{value:E});Object.defineProperty(this,u,{value:O});Object.defineProperty(this,v,{value:g});Object.defineProperty(this,c,{value:f});Object.defineProperty(this,h,{value:H});Object.defineProperty(this,b,{value:B});Object.defineProperty(this,n,{value:m});Object.defineProperty(this,p,{value:L});Object.defineProperty(this,r,{writable:true,value:null});Object.defineProperty(this,i,{writable:true,value:null});Object.defineProperty(this,o,{writable:true,value:null});Object.defineProperty(this,d,{writable:true,value:true});this.setEventNamespace("BX.UI.Uploader.Vue.Adapter");babelHelpers.classPrivateFieldLooseBase(this,i)[i]=s.ref([]);babelHelpers.classPrivateFieldLooseBase(this,o)[o]=s.shallowRef(null);const l={[t.UploaderEvent.FILE_ADD_START]:babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this),[t.UploaderEvent.FILE_REMOVE]:babelHelpers.classPrivateFieldLooseBase(this,n)[n].bind(this),[t.UploaderEvent.FILE_STATE_CHANGE]:babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this),[t.UploaderEvent.FILE_COMPLETE]:babelHelpers.classPrivateFieldLooseBase(this,h)[h].bind(this),[t.UploaderEvent.FILE_ERROR]:babelHelpers.classPrivateFieldLooseBase(this,c)[c].bind(this),[t.UploaderEvent.ERROR]:babelHelpers.classPrivateFieldLooseBase(this,v)[v].bind(this),[t.UploaderEvent.UPLOAD_START]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].bind(this),[t.UploaderEvent.UPLOAD_COMPLETE]:babelHelpers.classPrivateFieldLooseBase(this,P)[P].bind(this)};if(e instanceof t.Uploader){babelHelpers.classPrivateFieldLooseBase(this,r)[r]=e;if(babelHelpers.classPrivateFieldLooseBase(this,r)[r].getFileCount()>0){throw new Error("VueUploaderAdapter: an uploader have some files. We cannot create an adapter.")}Object.keys(l).forEach((e=>{const s=[...babelHelpers.classPrivateFieldLooseBase(this,r)[r].getListeners(e).keys()];babelHelpers.classPrivateFieldLooseBase(this,r)[r].unsubscribeAll(e);babelHelpers.classPrivateFieldLooseBase(this,r)[r].subscribe(e,l[e]);s.forEach((s=>{babelHelpers.classPrivateFieldLooseBase(this,r)[r].subscribe(e,s)}))}))}else{const s=a.Type.isPlainObject(e)?{...e}:{};const i=s.events;s.events=l;babelHelpers.classPrivateFieldLooseBase(this,r)[r]=new t.Uploader(s);babelHelpers.classPrivateFieldLooseBase(this,r)[r].subscribeFromOptions(i)}}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,r)[r]}getReactiveItems(){return babelHelpers.classPrivateFieldLooseBase(this,i)[i]}getUploaderError(){return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}getItems(){return babelHelpers.classPrivateFieldLooseBase(this,i)[i].value}getItem(e){return this.getItems().find((s=>s.id===e))||null}setRemoveFilesFromServerWhenDestroy(e=true){babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e}destroy(){babelHelpers.classPrivateFieldLooseBase(this,r)[r].destroy({removeFilesFromServer:babelHelpers.classPrivateFieldLooseBase(this,d)[d]});babelHelpers.classPrivateFieldLooseBase(this,r)[r]=null}}function L(e){const s=e.getData().file;const t=s.getState();this.emit("Item:onBeforeAdd",{item:t});this.getItems().push(t);this.emit("Item:onAdd",{item:t})}function m(e){const s=e.getData().file;const t=this.getItems().findIndex((e=>e.id===s.getId()));if(t>=0){const e=this.getItems().splice(t,1);this.emit("Item:onRemove",{item:e[0]})}}function B(e){const s=e.getData().file;const t=this.getItem(s.getId());if(t){Object.assign(t,s.getState())}}function H(e){const s=e.getData().file;const t=s.getState();this.emit("Item:onComplete",{item:t})}function f(e){const s=e.getData().file;const t=e.getData().error;const a=s.getState();this.emit("Item:onError",{item:a,error:t})}function g(e){const{error:s}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,o)[o].value=s.toJSON();this.emit("Uploader:onError",new l.BaseEvent({data:e.getData()}))}function O(e){this.emit("Uploader:onUploadStart",new l.BaseEvent({data:e.getData()}))}function E(e){this.emit("Uploader:onUploadComplete",new l.BaseEvent({data:e.getData()}))}var y=babelHelpers.classPrivateFieldLooseKey("vueAdapter");var U=babelHelpers.classPrivateFieldLooseKey("uploaderOptions");var I=babelHelpers.classPrivateFieldLooseKey("widgetOptions");var A=babelHelpers.classPrivateFieldLooseKey("vueApp");var w=babelHelpers.classPrivateFieldLooseKey("rootComponent");class j extends l.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,y,{writable:true,value:null});Object.defineProperty(this,U,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:{}});Object.defineProperty(this,A,{writable:true,value:null});Object.defineProperty(this,w,{writable:true,value:null});this.setEventNamespace("BX.UI.Uploader.Vue.Widget");babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=s}defineComponent(){return null}getAdapter(){if(babelHelpers.classPrivateFieldLooseBase(this,y)[y]===null){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new F(babelHelpers.classPrivateFieldLooseBase(this,U)[U])}return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}getUploader(){return this.getAdapter().getUploader()}getVueApp(){if(babelHelpers.classPrivateFieldLooseBase(this,A)[A]!==null){return babelHelpers.classPrivateFieldLooseBase(this,A)[A]}babelHelpers.classPrivateFieldLooseBase(this,A)[A]=s.BitrixVue.createApp(this.defineComponent(),{uploaderOptions:babelHelpers.classPrivateFieldLooseBase(this,U)[U],widgetOptions:babelHelpers.classPrivateFieldLooseBase(this,I)[I],uploaderAdapter:this.getAdapter()});return babelHelpers.classPrivateFieldLooseBase(this,A)[A]}getRootComponent(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w]}renderTo(e){if(a.Type.isDomNode(e)&&babelHelpers.classPrivateFieldLooseBase(this,w)[w]===null){babelHelpers.classPrivateFieldLooseBase(this,w)[w]=this.getVueApp().mount(e)}return babelHelpers.classPrivateFieldLooseBase(this,w)[w]}}const K={name:"VueUploaderComponent",props:{uploaderOptions:{type:Object},widgetOptions:{type:Object,default:{}},uploaderAdapter:{type:Object,default:null}},data:()=>({items:[],uploaderError:null}),provide(){return{uploader:this.uploader,adapter:this.adapter,widgetOptions:this.widgetOptions,emitter:this.emitter}},beforeCreate(){if(this.uploaderAdapter===null){this.hasOwnAdapter=true;const e={...a.Type.isPlainObject(this.customUploaderOptions)?this.customUploaderOptions:{},...this.uploaderOptions};this.adapter=new F(e)}else{this.hasOwnAdapter=false;this.adapter=this.uploaderAdapter}this.uploader=this.adapter.getUploader();this.emitter=new l.EventEmitter(this,`BX.UI.Uploader.${this.$options.name}`);this.emitter.subscribeFromOptions(this.widgetOptions.events)},created(){this.items=this.adapter.getReactiveItems();this.uploaderError=this.adapter.getUploaderError()},unmounted(){if(this.hasOwnAdapter){this.adapter.destroy();this.adapter=null;this.uploader=null}}};e.VueUploaderAdapter=F;e.VueUploaderWidget=j;e.VueUploaderComponent=K})(this.BX.UI.Uploader=this.BX.UI.Uploader||{},BX.Vue3,BX.UI.Uploader,BX,BX.Event);
//# sourceMappingURL=ui.uploader.vue.bundle.map.js