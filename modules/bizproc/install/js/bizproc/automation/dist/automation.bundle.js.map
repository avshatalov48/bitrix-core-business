{"version":3,"file":"automation.bundle.js","sources":["../src/template-scope.js","../src/templates-scheme.js","../src/context/base-context.js","../src/context/context.js","../src/view-mode.js","../src/trigger.js","../src/helper.js","../src/designer.js","../src/trigger-manager.js","../src/document/document.js","../src/delay-interval.js","../src/help-hint.js","../src/workflow/types.js","../src/tracker/tracking-entry.js","../src/tracker/types.js","../src/tracker/robot-entry.js","../src/tracker/trigger-entry.js","../src/tracker/tracking-entry-builder.js","../src/tracker/tracker.js","../src/robot.js","../src/user-options.js","../src/views/execution-queue-popup.js","../src/template.js","../src/condition/condition.js","../src/condition/condition-group.js","../src/selectors/condition-selector.js","../src/selectors/condition-group-selector.js","../src/selectors/inline-selector.js","../src/selectors/inline-time-selector.js","../src/selectors/manager.js","../src/selectors/inline-selector-condition.js","../src/selectors/inline-selector-html.js","../src/selectors/save-state-checkbox.js","../src/selectors/user-selector.js","../src/selectors/file-selector.js","../src/selectors/time-selector.js","../src/delay-interval-selector.js","../src/context/selector-context.js","../src/automation-globals.js","../src/statuses.js","../src/tourguide/beginning-guide.js","../src/tourguide/automation-guide.js","../src/automation.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { DocumentType, DocumentCategory, DocumentStatus } from './document/types';\n\nexport class TemplateScope\n{\n\t#documentType: DocumentType;\n\t#category: DocumentCategory | null;\n\t#status: DocumentStatus;\n\n\tconstructor(rawTemplateScope: {\n\t\tDocumentType: {\n\t\t\tType: string,\n\t\t\tName: string,\n\t\t},\n\t\tCategory: {\n\t\t\tId: string | null,\n\t\t\tName: string | null,\n\t\t},\n\t\tStatus: {\n\t\t\tId: string,\n\t\t\tName: string,\n\t\t\tColor: string,\n\t\t}\n\t})\n\t{\n\t\tthis.#documentType = rawTemplateScope.DocumentType;\n\t\tthis.#category = !Type.isNil(rawTemplateScope.Category.Id) ? rawTemplateScope.Category : null;\n\t\tthis.#status = rawTemplateScope.Status;\n\t}\n\n\tgetId()\n\t{\n\t\tif (this.hasCategory())\n\t\t{\n\t\t\treturn `${this.#documentType.Type}_${this.#category.Id}_${this.#status.Id}`;\n\t\t}\n\n\t\treturn `${this.#documentType.Type}_${this.#status.Id}`;\n\t}\n\n\tgetDocumentType(): DocumentType\n\t{\n\t\treturn this.#documentType;\n\t}\n\n\tgetDocumentCategory(): DocumentCategory\n\t{\n\t\treturn this.#category;\n\t}\n\n\tgetDocumentStatus(): DocumentStatus\n\t{\n\t\treturn this.#status;\n\t}\n\n\thasCategory(): boolean\n\t{\n\t\treturn !Type.isNull(this.#category);\n\t}\n}","import {Type} from 'main.core';\nimport {DocumentType, DocumentCategory, DocumentStatus} from './document/types';\nimport {TemplateScope} from './template-scope';\n\nexport default class TemplatesScheme\n{\n\t#scheme: Array<TemplateScope>;\n\n\tconstructor(scheme: Array<TemplateScope>)\n\t{\n\t\tthis.#scheme = [];\n\n\t\tif (Type.isArray(scheme))\n\t\t{\n\t\t\tscheme.forEach(rawScope => {\n\t\t\t\tconst scope = new TemplateScope(rawScope);\n\t\t\t\tthis.#scheme.push(scope);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetDocumentTypes(): Array<DocumentType>\n\t{\n\t\tconst documentTypes = new Map();\n\n\t\tfor (const scope of this.#scheme)\n\t\t{\n\t\t\tdocumentTypes.set(scope.getDocumentType().Type, scope.getDocumentType());\n\t\t}\n\n\t\treturn Array.from(documentTypes.values());\n\t}\n\n\tgetTypeCategories(documentType: DocumentType): Array<DocumentCategory>\n\t{\n\t\tconst documentCategories = new Map();\n\n\t\tfor (const scope of this.#scheme)\n\t\t{\n\t\t\tif (scope.hasCategory() && scope.getDocumentType().Type === documentType.Type)\n\t\t\t{\n\t\t\t\tconst category = scope.getDocumentCategory();\n\t\t\t\tdocumentCategories.set(category.Id, category);\n\t\t\t}\n\t\t}\n\n\t\treturn Array.from(documentCategories.values());\n\t}\n\n\tgetTypeStatuses(documentType: DocumentType, documentCategory: DocumentCategory | null): Array<DocumentStatus>\n\t{\n\t\tconst takenStatuses = new Set();\n\t\tif (Type.isNil(documentCategory))\n\t\t{\n\t\t\tdocumentCategory = {Id: null};\n\t\t}\n\n\t\tconst predicate = scope => {\n\t\t\tconst shouldBeTaken = (\n\t\t\t\tscope.getDocumentType().Type === documentType.Type\n\t\t\t\t&& (scope.hasCategory() ? scope.getDocumentCategory().Id === documentCategory.Id : true)\n\t\t\t\t&& !takenStatuses.has(scope.getDocumentStatus().Id)\n\t\t\t);\n\n\t\t\tif (shouldBeTaken)\n\t\t\t{\n\t\t\t\ttakenStatuses.add(scope.getDocumentStatus().Id);\n\t\t\t}\n\n\t\t\treturn shouldBeTaken;\n\t\t};\n\n\t\treturn Array.from(this.#filterBy(predicate)).map(scope => scope.getDocumentStatus());\n\t}\n\n\t#filterBy(predicate: (TemplateScope) => boolean): Iterable<TemplateScope>\n\t{\n\t\tconst generator = function*(scheme)\n\t\t{\n\t\t\tfor (const scope of scheme)\n\t\t\t{\n\t\t\t\tif (predicate(scope))\n\t\t\t\t{\n\t\t\t\t\tyield scope;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn generator(this.#scheme);\n\t}\n}","import { Type, clone } from \"main.core\";\nimport { EventEmitter, BaseEvent } from \"main.core.events\";\n\nexport class BaseContext extends EventEmitter\n{\n\t#values: Object<string, any>;\n\n\tconstructor(defaultValue: Object<string, any>)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Bizproc.Automation.Context');\n\t\tif (Type.isPlainObject(defaultValue))\n\t\t{\n\t\t\tthis.#values = defaultValue;\n\t\t}\n\t}\n\n\tclone(): this\n\t{\n\t\treturn new BaseContext(clone(this.#values));\n\t}\n\n\tgetValues(): object\n\t{\n\t\treturn this.#values;\n\t}\n\n\tset(name: string, value: any): this\n\t{\n\t\tconst isValueChanged = this.has(name);\n\t\tthis.#values[name] = value;\n\t\tthis.emit(isValueChanged ? 'valueChanged' : 'valueAdded', {name, value})\n\n\t\treturn this;\n\t}\n\n\tget(name: string): any\n\t{\n\t\treturn this.#values[name];\n\t}\n\n\thas(name: string): boolean\n\t{\n\t\treturn this.#values.hasOwnProperty(name);\n\t}\n\n\tsubsribeValueChanges(name: string, listener: (BaseEvent) => void): this\n\t{\n\t\tthis.subscribe('valueChanged', (event) => {\n\t\t\tif (event.data.name === name)\n\t\t\t{\n\t\t\t\tlistener(event);\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n}","import { Type, Runtime } from \"main.core\";\nimport { BaseContext } from \"./base-context\";\nimport {Document, UserOptions, Tracker, AutomationGlobals} from \"bizproc.automation\";\nexport class Context extends BaseContext\n{\n\tconstructor(props: {\n\t\tdocument: Document,\n\t\tsignedDocument: string,\n\t\tajaxUrl: string,\n\t\tavailableRobots?: Array<Object>,\n\t\tavailableTriggers?: Array<Object>,\n\t\tcanManage?: boolean,\n\t\tcanEdit?: boolean,\n\t\tuserOptions?: UserOptions,\n\t\ttracker?: Tracker,\n\n\t\tbizprocEditorUrl?: string,\n\t\tconstantsEditorUrl?: string,\n\t\tparametersEditorUrl?: string,\n\n\t\tmarketplaceRobotCategory?: string,\n\t})\n\t{\n\t\tsuper(props);\n\t}\n\n\tclone(): this\n\t{\n\t\t// TODO - clone Tracker object when the corresponding method appears\n\t\treturn (new Context(Runtime.clone(this.getValues())))\n\t\t\t.set('document', this.document.clone())\n\t\t\t.set('userOptions', this.userOptions?.clone())\n\t\t;\n\t}\n\n\tget document(): ?Document\n\t{\n\t\treturn this.get('document');\n\t}\n\n\tget signedDocument(): string\n\t{\n\t\treturn this.get('signedDocument') ?? '';\n\t}\n\n\tget ajaxUrl(): string\n\t{\n\t\treturn this.get('ajaxUrl') ?? '';\n\t}\n\n\tget availableRobots(): Array<Object>\n\t{\n\t\tconst availableRobots = this.get('availableRobots');\n\t\tif (Type.isArray(availableRobots))\n\t\t{\n\t\t\treturn availableRobots;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tget availableTriggers(): Array<Object>\n\t{\n\t\tconst availableTriggers = this.get('availableTriggers');\n\t\tif (Type.isArray(availableTriggers))\n\t\t{\n\t\t\treturn availableTriggers;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tget canManage(): boolean\n\t{\n\t\tconst canManage = this.get('canManage');\n\n\t\treturn Type.isBoolean(canManage) && canManage;\n\t}\n\n\tget canEdit(): boolean\n\t{\n\t\tconst canEdit = this.get('canEdit');\n\n\t\treturn Type.isBoolean(canEdit) && canEdit;\n\t}\n\n\tget userOptions(): ?UserOptions\n\t{\n\t\treturn this.get('userOptions');\n\t}\n\n\tget tracker(): ?Tracker\n\t{\n\t\treturn this.get('tracker');\n\t}\n\n\tset tracker(tracker: Tracker)\n\t{\n\t\tthis.set('tracker', tracker);\n\t}\n\n\tget bizprocEditorUrl(): ?string\n\t{\n\t\treturn this.get('bizprocEditorUrl');\n\t}\n\n\tget constantsEditorUrl(): ?string\n\t{\n\t\treturn this.get('constantsEditorUrl');\n\t}\n\n\tget parametersEditorUrl(): ?string\n\t{\n\t\treturn this.get('parametersEditorUrl');\n\t}\n\n\tgetAvailableTrigger(code: string): ?Object\n\t{\n\t\treturn this.availableTriggers.find(trigger => trigger['CODE'] === code);\n\t}\n\n\tget automationGlobals(): ?AutomationGlobals\n\t{\n\t\treturn this.get('automationGlobals');\n\t}\n}\n","export class ViewMode\n{\n\t#mode: number;\n\t#properties: Object;\n\n\tstatic #none = 0;\n\tstatic #view = 1;\n\tstatic #edit = 2;\n\tstatic #manage = 3;\n\n\tconstructor(mode: number)\n\t{\n\t\tthis.#mode = mode;\n\t\tthis.#properties = {};\n\t}\n\n\tstatic none(): ViewMode\n\t{\n\t\treturn new ViewMode(ViewMode.#none)\n\t}\n\n\tisNone(): boolean\n\t{\n\t\treturn this.#mode === ViewMode.#none;\n\t}\n\n\tstatic view(): ViewMode\n\t{\n\t\treturn new ViewMode(ViewMode.#view);\n\t}\n\n\tisView(): boolean\n\t{\n\t\treturn this.#mode === ViewMode.#view;\n\t}\n\n\tstatic edit(): ViewMode\n\t{\n\t\treturn new ViewMode(ViewMode.#edit);\n\t}\n\n\tisEdit(): boolean\n\t{\n\t\treturn this.#mode === ViewMode.#edit;\n\t}\n\n\tstatic manage(): ViewMode\n\t{\n\t\treturn new ViewMode(ViewMode.#manage);\n\t}\n\n\tisManage(): boolean\n\t{\n\t\treturn this.#mode === ViewMode.#manage;\n\t}\n\n\tsetProperty(name: string, value: any): ViewMode\n\t{\n\t\tthis.#properties[name] = value;\n\n\t\treturn this;\n\t}\n\n\tgetProperty(name: string, defaultValue: any = null): ?any\n\t{\n\t\tif (this.#properties.hasOwnProperty(name))\n\t\t{\n\t\t\treturn this.#properties[name];\n\t\t}\n\n\t\treturn defaultValue;\n\t}\n\n\tstatic fromRaw(mode: number): ViewMode\n\t{\n\t\tif (ViewMode.getAll().includes(mode))\n\t\t{\n\t\t\treturn new ViewMode(mode);\n\t\t}\n\n\t\treturn ViewMode.none();\n\t}\n\n\tintoRaw(): number\n\t{\n\t\treturn this.#mode;\n\t}\n\n\tstatic getAll(): Array<number>\n\t{\n\t\treturn [\n\t\t\tthis.#none,\n\t\t\tthis.#view,\n\t\t\tthis.#edit,\n\t\t\tthis.#manage,\n\t\t];\n\t}\n}\n","import {clone, Type, Dom, Loc, Event, Tag} from \"main.core\";\nimport { EventEmitter } from \"main.core.events\";\nimport { ViewMode } from \"./view-mode\";\nimport { getGlobalContext, ConditionGroup, TrackingStatus, HelpHint } from \"bizproc.automation\";\n\nexport class Trigger extends EventEmitter\n{\n\tdraft: boolean;\n\n\t#data: Object<string, any>;\n\t#deleted: boolean;\n\t#viewMode: ViewMode;\n\t#condition: ConditionGroup;\n\t#node: ?HTMLDivElement;\n\t#draggableItem: ?HTMLElement;\n\t#droppableItem: ?HTMLElement;\n\t#droppableColumn: ?HTMLElement;\n\t#stub: ?HTMLElement;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation');\n\n\t\tthis.draft = false;\n\t\tthis.#data = {};\n\t\tthis.#deleted = false;\n\t\tthis.#viewMode = ViewMode.none();\n\t\tthis.#condition = new ConditionGroup();\n\t}\n\n\tget node(): HTMLDivElement\n\t{\n\t\treturn this.#node;\n\t}\n\n\tget deleted(): boolean\n\t{\n\t\treturn this.#deleted;\n\t}\n\n\tget documentStatus(): string\n\t{\n\t\treturn this.#data['DOCUMENT_STATUS'] ?? '';\n\t}\n\n\tinit(data: Object<string, any>, viewMode: ?ViewMode): void\n\t{\n\t\tthis.#data = clone(data);\n\n\t\tif (Type.isString(this.#data['ID']))\n\t\t{\n\t\t\tconst id = parseInt(this.#data['ID']);\n\t\t\tthis.#data['ID'] = Type.isNumber(id) ? id : 0;\n\t\t}\n\t\tif (!Type.isPlainObject(this.#data['APPLY_RULES']))\n\t\t{\n\t\t\tthis.#data['APPLY_RULES'] = {};\n\t\t}\n\n\t\tif (this.#data['APPLY_RULES'].Condition)\n\t\t{\n\t\t\tthis.#condition = new ConditionGroup(this.#data['APPLY_RULES'].Condition);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#condition = new ConditionGroup();\n\t\t}\n\n\t\tthis.#viewMode = Type.isNil(viewMode) ? ViewMode.edit() : viewMode;\n\t\tthis.#node = this.createNode();\n\t}\n\n\treInit(data: Object<string, any>, viewMode: ?ViewMode)\n\t{\n\t\tconst node = this.#node;\n\t\tthis.#node = this.createNode();\n\t\tif (node.parentNode)\n\t\t{\n\t\t\tnode.parentNode.replaceChild(this.#node, node);\n\t\t}\n\t}\n\n\tcanEdit()\n\t{\n\t\treturn getGlobalContext().canEdit;\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.#data['ID'] || 0;\n\t}\n\n\tgetStatusId(): string\n\t{\n\t\treturn String(this.#data['DOCUMENT_STATUS'] || '');\n\t}\n\n\tgetStatus(): ?object\n\t{\n\t\treturn getGlobalContext().document.statusList.find(status => String(status.STATUS_ID) === this.getStatusId());\n\t}\n\n\tgetCode(): string\n\t{\n\t\treturn this.#data['CODE'] ?? '';\n\t}\n\n\tgetName(): string\n\t{\n\t\tlet triggerName = this.#data['NAME'];\n\t\tif (!triggerName)\n\t\t{\n\t\t\tconst code = this.getCode();\n\t\t\tconst trigger = getGlobalContext().availableTriggers.find((trigger) => code === trigger['CODE']);\n\t\t\ttriggerName = trigger?.NAME ?? code;\n\t\t}\n\n\t\treturn triggerName;\n\t}\n\n\tsetName(name: string): this\n\t{\n\t\tif (Type.isString(name))\n\t\t{\n\t\t\tthis.#data['NAME'] = name;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetApplyRules()\n\t{\n\t\treturn this.#data['APPLY_RULES'];\n\t}\n\n\tsetApplyRules(rules: Object): this\n\t{\n\t\tthis.#data['APPLY_RULES'] = rules;\n\n\t\treturn this;\n\t}\n\n\tgetLogStatus()\n\t{\n\t\tconst log = getGlobalContext().tracker.getTriggerLog(this.getId());\n\t\treturn log ? log.status : null;\n\t}\n\n\tgetCondition(): ConditionGroup\n\t{\n\t\treturn this.#condition;\n\t}\n\n\tsetCondition(condition: ConditionGroup): this\n\t{\n\t\tthis.#condition = condition;\n\t\treturn this;\n\t}\n\n\tisBackwardsAllowed(): boolean\n\t{\n\t\treturn this.#data['APPLY_RULES']['ALLOW_BACKWARDS'] === 'Y';\n\t}\n\n\tsetAllowBackwards(flag: boolean): this\n\t{\n\t\tthis.#data['APPLY_RULES']['ALLOW_BACKWARDS'] = flag ? 'Y' : 'N';\n\n\t\treturn this;\n\t}\n\n\tgetExecuteBy(): string\n\t{\n\t\treturn this.#data['APPLY_RULES']['ExecuteBy'] || '';\n\t}\n\n\tsetExecuteBy(userId: number): this\n\t{\n\t\tthis.#data['APPLY_RULES']['ExecuteBy'] = userId;\n\n\t\treturn this;\n\t}\n\n\tenableManageMode(isActive: boolean): void\n\t{\n\t\tthis.#viewMode = ViewMode.manage().setProperty('isActive', isActive);\n\n\t\t// const checkboxNode = Tag.render`<div class=\"bizproc-automation-trigger-checkbox\"></div>`\n\t\tconst checkboxNode = Tag.render`<div class=\"ui-ctl ui-ctl-inline bizproc-automation-trigger-checkbox\">\n\t\t\t<input class=\"ui-ctl-checkbox\" type=\"checkbox\" name=\"name\">\n\t\t</div>`;\n\t\tconst deleteButton = this.#node.querySelector('[data-role=\"btn-delete-trigger\"]');\n\t\tDom.hide(deleteButton);\n\n\t\tif (isActive && deleteButton)\n\t\t{\n\t\t\tDom.append(checkboxNode, this.#node);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.#node, '--locked-node');\n\t\t}\n\t}\n\n\tdisableManageMode()\n\t{\n\t\tthis.#viewMode = ViewMode.edit();\n\n\t\tconst checkboxNode = this.#node.querySelector('.bizproc-automation-trigger-checkbox');\n\t\tconst deleteButton = this.#node.querySelector('[data-role=\"btn-delete-trigger\"]');\n\n\t\tthis.#node.onclick = undefined;\n\n\t\tthis.#viewMode = ViewMode.edit();\n\t\tthis.unselectNode();\n\n\t\tDom.removeClass(this.#node, '--locked-node');\n\t\tDom.remove(checkboxNode);\n\t\tDom.show(deleteButton);\n\t}\n\n\tselectNode()\n\t{\n\t\tif (this.#node)\n\t\t{\n\t\t\tDom.addClass(this.#node, '--selected');\n\n\t\t\tconst checkboxNode = this.#node.querySelector('input');\n\t\t\tif (checkboxNode)\n\t\t\t{\n\t\t\t\tcheckboxNode.checked = true;\n\t\t\t}\n\n\t\t\tthis.emit('Trigger:selected');\n\t\t}\n\t}\n\n\tunselectNode()\n\t{\n\t\tif (this.#node)\n\t\t{\n\t\t\tDom.removeClass(this.#node, '--selected');\n\n\t\t\tconst checkboxNode = this.#node.querySelector('input');\n\t\t\tif (checkboxNode)\n\t\t\t{\n\t\t\t\tcheckboxNode.checked = false;\n\t\t\t}\n\n\t\t\tthis.emit('Trigger:unselected');\n\t\t}\n\t}\n\n\tisSelected(): boolean\n\t{\n\t\treturn this.#viewMode.isManage() && Dom.hasClass(this.node, '--selected');\n\t}\n\n\tcreateNode()\n\t{\n\t\tlet wrapperClass = 'bizproc-automation-trigger-item-wrapper';\n\n\t\tif (this.#viewMode.isEdit() && this.canEdit())\n\t\t{\n\t\t\twrapperClass += ' bizproc-automation-trigger-item-wrapper-draggable';\n\t\t}\n\n\t\tlet settingsBtn = null;\n\t\tlet copyBtn = null;\n\t\tif (this.#viewMode.isEdit())\n\t\t{\n\t\t\tsettingsBtn = Dom.create(\"div\", {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: \"bizproc-automation-trigger-item-wrapper-edit\"\n\t\t\t\t},\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_EDIT')\n\t\t\t});\n\n\t\t\tcopyBtn = Dom.create('div', {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bizproc-automation-trigger-btn-copy'\n\t\t\t\t},\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_COPY') || 'copy'\n\t\t\t});\n\n\t\t\tEvent.bind(copyBtn, 'click', this.onCopyButtonClick.bind(this, copyBtn));\n\t\t}\n\n\t\tif (this.getLogStatus() === TrackingStatus.COMPLETED)\n\t\t{\n\t\t\twrapperClass += ' bizproc-automation-trigger-item-wrapper-complete';\n\t\t}\n\t\telse if (getGlobalContext().document.getPreviousStatusIdList().includes(this.getStatusId()))\n\t\t{\n\t\t\twrapperClass += ' bizproc-automation-trigger-item-wrapper-complete-light';\n\t\t}\n\n\t\tconst triggerName = this.getName();\n\n\t\tlet containerClass = 'bizproc-automation-trigger-item';\n\n\t\tif (this.getLogStatus() === TrackingStatus.COMPLETED)\n\t\t{\n\t\t\tcontainerClass += ' --complete';\n\t\t}\n\t\telse if (this.draft)\n\t\t{\n\t\t\tcontainerClass += ' --draft';\n\t\t}\n\n\t\tconst div = Dom.create('DIV', {\n\t\t\tattrs: {\n\t\t\t\t'data-role': 'trigger-container',\n\t\t\t\t'className': containerClass,\n\t\t\t\t'data-type': 'item-trigger'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: wrapperClass\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\tclassName: \"bizproc-automation-trigger-item-wrapper-text\",\n\t\t\t\t\t\t\t\ttitle: triggerName,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: triggerName\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tcopyBtn,\n\t\t\t\tsettingsBtn,\n\t\t\t]\n\t\t});\n\n\t\tif (!this.#viewMode.isEdit())\n\t\t{\n\t\t\treturn div;\n\t\t}\n\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.registerItem(div);\n\t\t}\n\n\t\tconst deleteBtn = Dom.create('SPAN', {\n\t\t\tattrs: {\n\t\t\t\t'data-role': 'btn-delete-trigger',\n\t\t\t\t'className': 'bizproc-automation-trigger-btn-delete',\n\t\t\t}\n\t\t});\n\n\t\tEvent.bind(deleteBtn, 'click', this.onDeleteButtonClick.bind(this, deleteBtn));\n\n\t\tdiv.appendChild(deleteBtn);\n\n\t\tif (this.#viewMode.isEdit())\n\t\t{\n\t\t\tEvent.bind(div, 'click', this.onSettingsButtonClick.bind(this, div));\n\t\t}\n\n\t\tEvent.bind(div, 'click', () => {\n\t\t\tif (this.#viewMode.isManage() && this.#viewMode.getProperty('isActive', false))\n\t\t\t{\n\t\t\t\tif (!this.isSelected())\n\t\t\t\t{\n\t\t\t\t\tthis.selectNode();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.unselectNode();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn div;\n\t}\n\n\tonSettingsButtonClick(button)\n\t{\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tthis.emit('Trigger:onSettingsOpen', {trigger: this});\n\t\t}\n\t}\n\n\tonCopyButtonClick(button: HTMLElement, event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tconst trigger = new Trigger();\n\t\t\tconst initData = this.serialize();\n\t\t\tdelete initData['ID'];\n\n\t\t\tconst clearRules = this.getSettingProperties()\n\t\t\t\t.filter((property) => property.Copyable === false)\n\t\t\t\t.map((property) => property.Id)\n\t\t\t;\n\n\t\t\tclearRules.forEach(key => delete initData['APPLY_RULES'][key]);\n\n\t\t\ttrigger.init(initData, this.#viewMode);\n\t\t\tthis.emit('Trigger:copied', {trigger});\n\t\t}\n\t}\n\tonSearch(event)\n\t{\n\t\tif (!this.#node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst query = event.getData().queryString;\n\t\tconst match = !query || this.getName().toLowerCase().indexOf(query) >= 0;\n\n\t\tDom[match ? 'removeClass' : 'addClass'](this.#node, '--search-mismatch');\n\t}\n\n\tregisterItem(object)\n\t{\n\t\tif (Type.isNil(object[\"__bxddid\"]))\n\t\t{\n\t\t\tobject.onbxdragstart = BX.proxy(this.dragStart, this);\n\t\t\tobject.onbxdrag = BX.proxy(this.dragMove, this);\n\t\t\tobject.onbxdragstop = BX.proxy(this.dragStop, this);\n\t\t\tobject.onbxdraghover = BX.proxy(this.dragOver, this);\n\t\t\tjsDD.registerObject(object);\n\t\t\tjsDD.registerDest(object, 1);\n\t\t}\n\t}\n\n\tunregisterItem(object)\n\t{\n\t\tobject.onbxdragstart = undefined;\n\t\tobject.onbxdrag = undefined;\n\t\tobject.onbxdragstop = undefined;\n\t\tobject.onbxdraghover = undefined;\n\t\tjsDD.unregisterObject(object);\n\t\tjsDD.unregisterDest(object);\n\t}\n\n\tdragStart()\n\t{\n\t\tthis.#draggableItem = BX.proxy_context;\n\n\t\tif (!this.#draggableItem)\n\t\t{\n\t\t\tjsDD.stopCurrentDrag();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#stub)\n\t\t{\n\t\t\tconst itemWidth = this.#draggableItem.offsetWidth;\n\t\t\tthis.#stub = this.#draggableItem.cloneNode(true);\n\t\t\tthis.#stub.style.position = \"absolute\";\n\t\t\tthis.#stub.classList.add(\"bizproc-automation-trigger-item-drag\");\n\t\t\tthis.#stub.style.width = itemWidth + \"px\";\n\t\t\tdocument.body.appendChild(this.#stub);\n\t\t}\n\t}\n\n\tdragMove(x, y)\n\t{\n\t\tthis.#stub.style.left = x + \"px\";\n\t\tthis.#stub.style.top = y + \"px\";\n\t}\n\n\tdragOver(destination, x, y)\n\t{\n\t\tif (this.#droppableItem)\n\t\t{\n\t\t\tthis.#droppableItem.classList.remove(\"bizproc-automation-trigger-item-pre\");\n\t\t}\n\n\t\tif (this.#droppableColumn)\n\t\t{\n\t\t\tthis.#droppableColumn.classList.remove(\"bizproc-automation-trigger-list-pre\");\n\t\t}\n\n\t\tconst type = destination.getAttribute(\"data-type\");\n\n\t\tif (type === \"item-trigger\")\n\t\t{\n\t\t\tthis.#droppableItem = destination;\n\t\t\tthis.#droppableColumn = null;\n\t\t}\n\n\t\tif (type === \"column-trigger\")\n\t\t{\n\t\t\tthis.#droppableColumn = destination.querySelector('[data-role=\"trigger-list\"]');\n\t\t\tthis.#droppableItem = null;\n\t\t}\n\n\t\tif (this.#droppableItem)\n\t\t{\n\t\t\tthis.#droppableItem.classList.add(\"bizproc-automation-trigger-item-pre\");\n\t\t}\n\n\t\tif (this.#droppableColumn)\n\t\t{\n\t\t\tthis.#droppableColumn.classList.add(\"bizproc-automation-trigger-list-pre\");\n\t\t}\n\t}\n\n\tdragStop(x, y, event)\n\t{\n\t\tevent = event || window.event;\n\t\tlet trigger = null;\n\t\tconst isCopy = event && (event.ctrlKey || event.metaKey);\n\t\tconst copyTrigger = (parent, statusId) => {\n\t\t\tconst trigger = new Trigger();\n\t\t\tconst initData = parent.serialize();\n\t\t\tdelete initData['ID'];\n\n\t\t\tconst clearRules = this.getSettingProperties()\n\t\t\t\t.filter((property) => property.Copyable === false)\n\t\t\t\t.map((property) => property.Id)\n\t\t\t;\n\n\t\t\tclearRules.forEach(key => delete initData['APPLY_RULES'][key]);\n\n\t\t\tinitData['DOCUMENT_STATUS'] = statusId;\n\t\t\ttrigger.init(initData, parent.#viewMode);\n\n\t\t\treturn trigger;\n\t\t};\n\n\t\tif (this.#draggableItem)\n\t\t{\n\t\t\tif (this.#droppableItem)\n\t\t\t{\n\t\t\t\tthis.#droppableItem.classList.remove(\"bizproc-automation-trigger-item-pre\");\n\t\t\t\tconst thisColumn = this.#droppableItem.parentNode;\n\t\t\t\tif (!isCopy)\n\t\t\t\t{\n\t\t\t\t\tthisColumn.insertBefore(this.#draggableItem, this.#droppableItem);\n\t\t\t\t\tthis.moveTo(thisColumn.getAttribute('data-status-id'));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttrigger = copyTrigger(this, thisColumn.getAttribute('data-status-id'));\n\t\t\t\t\tthisColumn.insertBefore(trigger.#node, this.#droppableItem);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.#droppableColumn)\n\t\t\t{\n\t\t\t\tthis.#droppableColumn.classList.remove(\"bizproc-automation-trigger-list-pre\");\n\t\t\t\tif (!isCopy)\n\t\t\t\t{\n\t\t\t\t\tthis.#droppableColumn.appendChild(this.#draggableItem);\n\t\t\t\t\tthis.moveTo(this.#droppableColumn.getAttribute('data-status-id'));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttrigger = copyTrigger(this, this.#droppableColumn.getAttribute('data-status-id'));\n\t\t\t\t\tthis.#droppableColumn.appendChild(trigger.#node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (trigger)\n\t\t\t{\n\t\t\t\tthis.emit('Trigger:copied', {\n\t\t\t\t\ttrigger,\n\t\t\t\t\tskipInsert: true,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#stub.parentNode.removeChild(this.#stub);\n\t\tthis.#stub = null;\n\t\tthis.#draggableItem = null;\n\t\tthis.#droppableItem = null;\n\t}\n\n\tonDeleteButtonClick(button: HTMLElement, event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tDom.remove(button.parentNode);\n\t\t\tthis.emit('Trigger:deleted', {trigger: this});\n\t\t}\n\t}\n\n\tupdateData(data: Object<string, any>): void\n\t{\n\t\tif (Type.isPlainObject(data))\n\t\t{\n\t\t\tthis.#data = data;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow 'Invalid data';\n\t\t}\n\t}\n\n\tmarkDeleted(): this\n\t{\n\t\tthis.#deleted = true;\n\n\t\treturn this;\n\t}\n\n\tserialize(): Object<string, any>\n\t{\n\t\tconst data = clone(this.#data);\n\t\tif (this.#deleted)\n\t\t{\n\t\t\tdata['DELETED'] = 'Y';\n\t\t}\n\n\t\tif (!Type.isPlainObject(data.APPLY_RULES))\n\t\t{\n\t\t\tdata.APPLY_RULES = {};\n\t\t}\n\n\t\tif (!this.#condition.items.length)\n\t\t{\n\t\t\tdelete data.APPLY_RULES.Condition;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.APPLY_RULES.Condition = this.#condition.serialize();\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tmoveTo(statusId)\n\t{\n\t\tthis.#data['DOCUMENT_STATUS'] = statusId;\n\t\tthis.emit('Trigger:modified', {trigger: this});\n\t}\n\n\tgetReturnProperties()\n\t{\n\t\tconst triggerData = getGlobalContext().availableTriggers.find(trigger => trigger['CODE'] === this.getCode());\n\n\t\treturn triggerData && Type.isArray(triggerData.RETURN) ? triggerData.RETURN : [];\n\t}\n\n\tgetSettingProperties(): Array\n\t{\n\t\tconst triggerData = getGlobalContext().availableTriggers.find(trigger => trigger['CODE'] === this.getCode());\n\n\t\tif (triggerData.SETTINGS && triggerData.SETTINGS.Properties)\n\t\t{\n\t\t\treturn triggerData.SETTINGS.Properties;\n\t\t}\n\n\t\treturn [];\n\t}\n}","import { Type } from \"main.core\";\n\nexport class Helper\n{\n\tstatic #idIncrement = 0;\n\n\tstatic generateUniqueId()\n\t{\n\t\t++Helper.#idIncrement;\n\t\treturn 'bizproc-automation-cmp-' + Helper.#idIncrement;\n\t}\n\n\tstatic toJsonString(data)\n\t{\n\t\treturn JSON.stringify(data, function (i, v)\n\t\t{\n\t\t\tif (typeof(v) == 'boolean')\n\t\t\t{\n\t\t\t\treturn v ? '1' : '0';\n\t\t\t}\n\t\t\treturn v;\n\t\t});\n\t}\n\n\tstatic getResponsibleUserExpression(fields: Array<Object>): ?string\n\t{\n\t\tif (Type.isArray(fields))\n\t\t{\n\t\t\tfor (const field of fields)\n\t\t\t{\n\t\t\t\tif (field['Id'] === 'ASSIGNED_BY_ID' || field['Id'] === 'RESPONSIBLE_ID')\n\t\t\t\t{\n\t\t\t\t\treturn '{{'+field['Name']+'}}';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t};\n}","export class Designer\n{\n\tstatic #instance;\n\n\trobotSettingsDialog;\n\tcomponent;\n\trobot;\n\ttriggerSettingsDialog;\n\n\tstatic getInstance()\n\t{\n\t\tif (!Designer.#instance)\n\t\t{\n\t\t\tDesigner.#instance = new Designer();\n\t\t}\n\n\t\treturn Designer.#instance;\n\t}\n\n\tsetRobotSettingsDialog(dialog)\n\t{\n\t\tthis.robotSettingsDialog = dialog;\n\t\tthis.robot = dialog ? dialog.robot : null;\n\t}\n\n\tgetRobotSettingsDialog()\n\t{\n\t\treturn this.robotSettingsDialog;\n\t}\n\n\tsetTriggerSettingsDialog(dialog)\n\t{\n\t\tthis.triggerSettingsDialog = dialog;\n\t}\n\n\tgetTriggerSettingsDialog()\n\t{\n\t\treturn this.triggerSettingsDialog;\n\t}\n}","import { Type, Event, Loc, Dom, Text, Uri, ajax, Tag, onCustomEvent } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { ViewMode } from './view-mode';\nimport { Trigger } from './trigger';\nimport { Helper } from './helper';\nimport { Designer } from './designer';\nimport { getGlobalContext, ConditionGroup, ConditionGroupSelector, UserOptions } from 'bizproc.automation';\nimport { Alert, AlertColor, AlertIcon } from 'ui.alerts';\nimport { Popup, MenuManager } from 'main.popup';\nimport { SaveButton, CancelButton } from 'ui.buttons';\n\nimport 'ui.hint';\n\nexport class TriggerManager extends EventEmitter\n{\n\t#triggersContainerNode: HTMLElement;\n\t#userOptions: ?UserOptions;\n\t#viewMode: ViewMode;\n\t#triggers: Array<Trigger>;\n\t#triggersData: Array<Object<string, any>>;\n\t#columnNodes: NodeList;\n\t#listNodes: NodeList;\n\t#modified: boolean;\n\t#triggerEventsListeners: Object<string, (event: BaseEvent) => void> = {};\n\n\tconstructor(triggersContainerNode: HTMLElement, params: { userOptions: ?UserOptions } = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation');\n\n\t\tthis.#triggersContainerNode = triggersContainerNode;\n\t\tthis.#userOptions = params.userOptions;\n\t}\n\n\tasync fetchTriggers()\n\t{\n\t\tconst self = this;\n\n\t\treturn new Promise((resolve, reject) => ajax({\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\turl: getGlobalContext().ajaxUrl,\n\t\t\tdata: {\n\t\t\t\tajax_action: 'get_triggers',\n\t\t\t\tdocument_signed: getGlobalContext().signedDocument,\n\t\t\t},\n\t\t\tonsuccess(response)\n\t\t\t{\n\t\t\t\tif (response.SUCCESS)\n\t\t\t\t{\n\t\t\t\t\tself.reInit({ TRIGGERS: response.DATA.triggers }, self.#viewMode);\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonerror()\n\t\t\t{\n\t\t\t\treject();\n\t\t\t},\n\t\t}));\n\t}\n\n\tinit(data: ?Object<string, any>, viewMode: ViewMode)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tthis.#viewMode = viewMode.isNone() ? ViewMode.edit() : viewMode;\n\t\tthis.#triggersData = Type.isArray(data.TRIGGERS) ? data.TRIGGERS : [];\n\t\tthis.#columnNodes = document.querySelectorAll('[data-type=\"column-trigger\"]');\n\t\tthis.#listNodes = this.#triggersContainerNode.querySelectorAll('[data-role=\"trigger-list\"]');\n\t\tthis.#modified = false;\n\t\tthis.initTriggers();\n\n\t\tthis.markModified(false);\n\n\t\t// register DD\n\t\tthis.#columnNodes.forEach((columnNode) => jsDD.registerDest(columnNode, 10));\n\n\t\ttop.BX.addCustomEvent(\n\t\t\ttop,\n\t\t\t'Rest:AppLayout:ApplicationInstall',\n\t\t\tthis.onRestAppInstall.bind(this),\n\t\t);\n\t}\n\n\treInit(data: ?Object<string, any>, viewMode: ?ViewMode)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tthis.#viewMode = viewMode || ViewMode.none();\n\t\tthis.#listNodes.forEach((node) => Dom.clean(node));\n\n\t\tthis.#triggersData = Type.isArray(data.TRIGGERS) ? data.TRIGGERS : [];\n\n\t\tthis.initTriggers();\n\n\t\tthis.markModified(false);\n\t}\n\n\tinitTriggers()\n\t{\n\t\tthis.#triggers = [];\n\t\tthis.#triggersData.forEach((triggerData) => {\n\t\t\tconst trigger = new Trigger();\n\t\t\ttrigger.init(triggerData, this.#viewMode);\n\t\t\tthis.subscribeTriggerEvents(trigger);\n\t\t\tthis.insertTriggerNode(trigger.getStatusId(), trigger.node);\n\t\t\tthis.#triggers.push(trigger);\n\t\t});\n\t}\n\n\tsubscribeTriggerEvents(trigger: Trigger)\n\t{\n\t\ttrigger.subscribe('Trigger:copied', (event) => {\n\t\t\tconst trigger = event.data.trigger;\n\n\t\t\tthis.#triggers.push(trigger);\n\t\t\tif (!event.data.skipInsert)\n\t\t\t{\n\t\t\t\tthis.insertTriggerNode(trigger.getStatusId(), trigger.node);\n\t\t\t}\n\t\t\tthis.subscribeTriggerEvents(trigger);\n\t\t\tthis.markModified();\n\t\t});\n\t\ttrigger.subscribe('Trigger:modified', () => this.markModified());\n\t\ttrigger.subscribe('Trigger:onSettingsOpen', (event) => {\n\t\t\tthis.openTriggerSettingsDialog(event.data.trigger);\n\t\t});\n\t\ttrigger.subscribe('Trigger:deleted', (event) => this.deleteTrigger(event.data.trigger));\n\n\t\tObject\n\t\t\t.entries(this.#triggerEventsListeners)\n\t\t\t.forEach(([eventName, listener]) => trigger.subscribe(eventName, listener));\n\t}\n\n\tonTriggerEvent(eventName: string, listener: (event: BaseEvent, trigger: Trigger) => void)\n\t{\n\t\tthis.#triggerEventsListeners[eventName] = listener;\n\n\t\tthis.#triggers.forEach((trigger: Trigger) => {\n\t\t\ttrigger.subscribe(eventName, (event) => listener(event, trigger));\n\t\t});\n\t}\n\n\tgetSelectedTriggers(): Array<Trigger>\n\t{\n\t\treturn this.#triggers.filter((trigger) => trigger.isSelected());\n\t}\n\n\tonSearch(event)\n\t{\n\t\tthis.#triggers.forEach((trigger) => trigger.onSearch(event));\n\t}\n\n\tenableManageMode(status)\n\t{\n\t\tthis.#viewMode = ViewMode.manage();\n\n\t\tdocument.querySelectorAll('[data-role=\"trigger-list\"]').forEach((listNode) => {\n\t\t\tif (listNode.dataset.statusId === status)\n\t\t\t{\n\t\t\t\tDom.addClass(listNode, '--multiselect-mode');\n\t\t\t}\n\t\t});\n\t\tthis.#triggers.forEach((trigger) => {\n\t\t\ttrigger.enableManageMode(trigger.documentStatus === status);\n\t\t});\n\t}\n\n\tdisableManageMode()\n\t{\n\t\tthis.#viewMode = ViewMode.edit();\n\n\t\tdocument.querySelectorAll('[data-role=\"trigger-list\"]').forEach((listNode) => {\n\t\t\tDom.removeClass(listNode, '--multiselect-mode');\n\t\t});\n\n\t\tthis.#triggers.forEach((trigger) => trigger.disableManageMode());\n\t}\n\n\taddTrigger(triggerData: ?Object<string, any>, callback)\n\t{\n\t\tconst trigger = new Trigger();\n\t\ttrigger.draft = true;\n\t\ttrigger.init(triggerData, this.#viewMode);\n\t\tthis.subscribeTriggerEvents(trigger);\n\t\tif (callback)\n\t\t{\n\t\t\tcallback.call(this, trigger);\n\t\t}\n\t\tthis.emit('TriggerManager:trigger:add', { trigger });\n\t}\n\n\tdeleteTrigger(trigger: Trigger, callback)\n\t{\n\t\tif (trigger.getId() > 0)\n\t\t{\n\t\t\ttrigger.markDeleted();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (let i = 0; i < this.#triggers.length; ++i)\n\t\t\t{\n\t\t\t\tif (this.#triggers[i] === trigger)\n\t\t\t\t{\n\t\t\t\t\tthis.#triggers.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (callback)\n\t\t{\n\t\t\tcallback(trigger);\n\t\t}\n\n\t\tthis.emit('TriggerManager:trigger:delete', { trigger });\n\n\t\tthis.markModified();\n\t}\n\n\tenableDragAndDrop()\n\t{\n\t\tthis.#triggers.forEach((trigger) => trigger.registerItem(trigger.node));\n\t\tthis.#triggersContainerNode\n\t\t\t.querySelectorAll('.bizproc-automation-trigger-item-wrapper')\n\t\t\t.forEach((node) => {\n\t\t\t\tDom.addClass(node, 'bizproc-automation-trigger-item-wrapper-draggable');\n\t\t\t})\n\t\t;\n\t}\n\n\tdisableDragAndDrop()\n\t{\n\t\tthis.#triggers.forEach((trigger) => trigger.unregisterItem(trigger.node));\n\t\tthis.#triggersContainerNode\n\t\t\t.querySelectorAll('.bizproc-automation-trigger-item-wrapper')\n\t\t\t.forEach((node) => {\n\t\t\t\tDom.removeClass(node, 'bizproc-automation-trigger-item-wrapper-draggable');\n\t\t\t})\n\t\t;\n\t}\n\n\tinsertTrigger(trigger)\n\t{\n\t\tthis.#triggers.push(trigger);\n\t\tthis.markModified(true);\n\t}\n\n\tinsertTriggerNode(documentStatus: string, triggerNode)\n\t{\n\t\tconst listNode = this.#triggersContainerNode.querySelector(`[data-role=\"trigger-list\"][data-status-id=\"${documentStatus}\"]`);\n\t\tif (listNode)\n\t\t{\n\t\t\tDom.append(triggerNode, listNode);\n\t\t}\n\t}\n\n\tserialize(): Array<Object<string, any>>\n\t{\n\t\treturn this.#triggers.map((trigger) => trigger.serialize());\n\t}\n\n\tcountAllTriggers(): number\n\t{\n\t\treturn this.#triggers.filter((trigger) => !trigger.deleted).length;\n\t}\n\n\tfindTriggerById(id: number): Trigger | undefined\n\t{\n\t\treturn this.#triggers.find((trigger) => trigger.getId() === id);\n\t}\n\n\tfindTriggersByDocumentStatus(statusId: string): Array<Trigger>\n\t{\n\t\treturn this.#triggers.filter((trigger) => trigger.getStatusId() === statusId);\n\t}\n\n\tgetTriggerName(code: string)\n\t{\n\t\treturn getGlobalContext().availableTriggers.find((trigger) => code === trigger.CODE)?.NAME ?? code;\n\t}\n\n\tgetAvailableTrigger(code): ?Object\n\t{\n\t\tconst availableTriggers = getGlobalContext().availableTriggers;\n\t\tfor (const availableTrigger of availableTriggers)\n\t\t{\n\t\t\tif (code === availableTrigger.CODE)\n\t\t\t{\n\t\t\t\treturn availableTrigger;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn getGlobalContext().canEdit;\n\t}\n\n\tcanSetExecuteBy(): boolean\n\t{\n\t\treturn getGlobalContext().get('TRIGGER_CAN_SET_EXECUTE_BY') ?? false;\n\t}\n\n\tneedSave()\n\t{\n\t\treturn this.#modified;\n\t}\n\n\tmarkModified(modified: boolean)\n\t{\n\t\tthis.#modified = modified !== false;\n\t\tif (this.#modified)\n\t\t{\n\t\t\tthis.emit('TriggerManager:dataModified');\n\t\t}\n\t}\n\n\topenTriggerSettingsDialog(trigger, context)\n\t{\n\t\tif (Designer.getInstance().getTriggerSettingsDialog())\n\t\t{\n\t\t\tif (context && context.changeTrigger)\n\t\t\t{\n\t\t\t\tDesigner.getInstance().getTriggerSettingsDialog().popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst formName = 'bizproc_automation_trigger_dialog';\n\n\t\tconst title = this.getTriggerName(trigger.getCode());\n\t\tconst form = Tag.render`\n\t\t\t<form name=\"${formName}\" style=\"min-width: 540px;\">\n\t\t\t\t${this.renderConditionSettings(trigger)}\n\t\t\t\t<span class=\"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\">\n\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_TRIGGER_NAME')}:\n\t\t\t\t</span>\n\t\t\t\t<div class=\"bizproc-automation-popup-settings\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tclass=\"bizproc-automation-popup-input\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tname=\"name\"\n\t\t\t\t\t\tvalue=\"${Text.encode(trigger.getName() || title)}\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t`;\n\n\t\tconst triggerData = this.getAvailableTrigger(trigger.getCode());\n\n\t\tif (triggerData && triggerData.SETTINGS)\n\t\t{\n\t\t\tthis.#renderTriggerProperties(trigger, triggerData.SETTINGS.Properties, form);\n\t\t}\n\n\t\tonCustomEvent(\n\t\t\t`BX.Bizproc.Automation.TriggerManager:onOpenSettingsDialog-${trigger.getCode()}`,\n\t\t\t[trigger, form],\n\t\t);\n\n\t\tif (this.canSetExecuteBy())\n\t\t{\n\t\t\tthis.renderExecuteByControl(trigger, form);\n\t\t}\n\n\t\tthis.renderAllowBackwardsControl(trigger, form);\n\n\t\tDom.addClass(this.#triggersContainerNode, 'automation-base-blocked');\n\n\t\tDesigner.getInstance().setTriggerSettingsDialog({\n\t\t\ttriggerManager: this,\n\t\t\ttrigger,\n\t\t\tform,\n\t\t});\n\n\t\tconst popup = new Popup({\n\t\t\tid: Helper.generateUniqueId(),\n\t\t\tbindElement: null,\n\t\t\tcontent: form,\n\t\t\tcloseByEsc: true,\n\t\t\tbuttons: [\n\t\t\t\tnew SaveButton({\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tconst formData = ajax.prepareForm(form);\n\t\t\t\t\t\ttrigger.setName(formData.data.name);\n\n\t\t\t\t\t\tif (triggerData.SETTINGS)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#setTriggerProperties(trigger, triggerData.SETTINGS.Properties, form);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tonCustomEvent(\n\t\t\t\t\t\t\t`BX.Bizproc.Automation.TriggerManager:onSaveSettings-${trigger.getCode()}`,\n\t\t\t\t\t\t\t[trigger, formData],\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.setConditionSettingsFromForm(formData.data, trigger);\n\t\t\t\t\t\ttrigger.setAllowBackwards(formData.data.allow_backwards === 'Y');\n\n\t\t\t\t\t\tif (this.canSetExecuteBy())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttrigger.setExecuteBy(formData.data.execute_by);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// analytics\n\t\t\t\t\t\tajax.runAction(\n\t\t\t\t\t\t\t'bizproc.analytics.push',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tanalyticsLabel: `automation_trigger${trigger.draft ? '_draft' : ''}_save_${trigger.getCode().toLowerCase()}`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tdelete trigger.draft;\n\n\t\t\t\t\t\ttrigger.reInit();\n\t\t\t\t\t\tthis.markModified();\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew CancelButton({\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t\twidth: 590,\n\t\t\tcontentPadding: 12,\n\t\t\tcloseIcon: true,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tDesigner.getInstance().setTriggerSettingsDialog(null);\n\t\t\t\t\tthis.destroySettingsDialogControls();\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t\tDom.removeClass(this.#triggersContainerNode, 'automation-base-blocked');\n\t\t\t\t\tthis.emit('TriggerManager:onCloseTriggerSettingsDialog');\n\t\t\t\t},\n\t\t\t},\n\t\t\ttitleBar: title,\n\t\t\toverlay: false,\n\t\t\tdraggable: { restrict: false },\n\t\t});\n\n\t\tDesigner.getInstance().getTriggerSettingsDialog().popup = popup;\n\t\tpopup.show();\n\n\t\t// analytics\n\t\tajax.runAction(\n\t\t\t'bizproc.analytics.push',\n\t\t\t{\n\t\t\t\tanalyticsLabel: `automation_trigger${trigger.draft ? '_draft' : ''}_settings_${trigger.getCode().toLowerCase()}`,\n\t\t\t},\n\t\t);\n\t}\n\n\t#renderTriggerProperties(trigger: Trigger, properties: [], form: Element)\n\t{\n\t\tproperties.forEach((property) => {\n\t\t\tconst value = trigger.getApplyRules()[property.Id];\n\n\t\t\tif (property.Type === '@condition-group-selector')\n\t\t\t{\n\t\t\t\tthis.#renderConditionGroupSelector(property, value, form);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (property.Type === '@webhook-code')\n\t\t\t{\n\t\t\t\tthis.#renderWebhookCodeProperty(property, value, form);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (property.Type === '@field-selector')\n\t\t\t{\n\t\t\t\tthis.#renderFieldSelectorProperty(property, value, form);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst toRenderProperty = { AllowSelection: false, ...property };\n\n\t\t\tif (toRenderProperty.Type === '@robot-select')\n\t\t\t{\n\t\t\t\tthis.#prepareRobotSelectProperty(toRenderProperty);\n\t\t\t}\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-top bizproc-automation-popup-settings-title-autocomplete\"\n\t\t\t\t\t>${Text.encode(property.Name)}:</span>\n\t\t\t\t`,\n\t\t\t\tform,\n\t\t\t);\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"bizproc-automation-popup-settings\">\n\t\t\t\t\t\t${BX.Bizproc.FieldType.renderControl(\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t...getGlobalContext().document.getRawType(),\n\t\t\t\t\t\t\tgetGlobalContext().document.getCategoryId(),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\ttoRenderProperty,\n\t\t\t\t\t\tproperty.Id,\n\t\t\t\t\t\tvalue || '',\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tform,\n\t\t\t);\n\t\t});\n\t}\n\n\t#prepareRobotSelectProperty(property)\n\t{\n\t\tconst cmp = Designer.getInstance().component;\n\t\tproperty.Options = [];\n\t\tconst filter = property.Settings.Filter;\n\t\tconst check = (robot) => {\n\t\t\tfor (const field in filter)\n\t\t\t{\n\t\t\t\tif (robot.data[field] !== filter[field])\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\n\t\tcmp.templateManager.templates.forEach((template) => {\n\t\t\ttemplate.robots.forEach((robot) => {\n\t\t\t\tif (check(robot))\n\t\t\t\t{\n\t\t\t\t\tproperty.Options.push(\n\t\t\t\t\t\t{ value: robot.getId(), name: robot.getProperty(property.Settings.OptionNameProperty) },\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tdelete property.Settings;\n\t\tproperty.Type = 'select';\n\t}\n\n\t#setTriggerProperties(trigger: Trigger, properties: [], form: Element)\n\t{\n\t\tconst values = {};\n\n\t\tproperties.forEach((property) => {\n\t\t\tif (property.Type === '@condition-group-selector')\n\t\t\t{\n\t\t\t\tvalues[property.Id] = this.#setConditionGroupValue(property, form);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst formData = BX.ajax.prepareForm(form);\n\t\t\tvalues[property.Id] = formData.data[property.Id];\n\t\t});\n\n\t\ttrigger.setApplyRules(values);\n\t}\n\n\trenderConditionSettings(trigger: Trigger)\n\t{\n\t\tconst conditionGroup = trigger.getCondition().clone();\n\n\t\tthis.conditionSelector = new ConditionGroupSelector(\n\t\t\tconditionGroup,\n\t\t\t{\n\t\t\t\tfields: getGlobalContext().document.getFields(),\n\t\t\t\tshowValuesSelector: false,\n\t\t\t\tcaption: {\n\t\t\t\t\thead: Loc.getMessage('BIZPROC_JS_AUTOMATION_ROBOT_CONDITION_TITLE'),\n\t\t\t\t},\n\t\t\t\tisExpanded: (\n\t\t\t\t\tthis.#userOptions && this.#userOptions.get('defaults', 'isConditionGroupExpanded', 'N') === 'Y'\n\t\t\t\t),\n\t\t\t},\n\t\t);\n\n\t\tif (this.#userOptions)\n\t\t{\n\t\t\tthis.conditionSelector.subscribe('onToggleGroupViewClick', (event: BaseEvent) => {\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#userOptions.set('defaults', 'isConditionGroupExpanded', data.isExpanded ? 'Y' : 'N');\n\t\t\t});\n\t\t}\n\n\t\treturn this.conditionSelector.createNode();\n\t}\n\n\t#renderConditionGroupSelector(property, value, form)\n\t{\n\t\tconst selector = new ConditionGroupSelector(new ConditionGroup(value), {\n\t\t\tfields: property.Settings.Fields,\n\t\t\tfieldPrefix: property.Id,\n\t\t\tshowValuesSelector: false,\n\t\t\tcaption: {\n\t\t\t\thead: property.Name,\n\t\t\t},\n\t\t});\n\n\t\tDom.append(selector.createNode(), form);\n\t}\n\n\t#setConditionGroupValue(property, form)\n\t{\n\t\tconst formData = BX.ajax.prepareForm(form);\n\t\tconst conditionGroup = ConditionGroup.createFromForm(formData.data, property.Id);\n\n\t\treturn conditionGroup.serialize();\n\t}\n\n\t#renderWebhookCodeProperty(property, value, form)\n\t{\n\t\tif (!value)\n\t\t{\n\t\t\tvalue = Text.getRandom(5);\n\t\t}\n\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<span class=\"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\">\n\t\t\t\t\t${Text.encode(property.Name)}:\n\t\t\t\t</span>\n\t\t\t`,\n\t\t\tform,\n\t\t);\n\t\tDom.append(Tag.render`<input type=\"hidden\" value=\"${Text.encode(value)}\" name=\"code\"/>`, form);\n\n\t\tconst hookLinkTextarea = Tag.render`\n\t\t\t<textarea class=\"bizproc-automation-popup-textarea\" placeholder=\"...\" readonly=\"readonly\" name=\"webhook_handler\">\n\t\t\t</textarea>\n\t\t`;\n\t\tEvent.bind(hookLinkTextarea, 'click', () => {\n\t\t\tthis.select();\n\t\t});\n\n\t\tDom.append(Tag.render`<div class=\"bizproc-automation-popup-settings\">${hookLinkTextarea}</div>`, form);\n\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<span class=\"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\">\n\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_WEBHOOK_ID')}\n\t\t\t\t</span>\n\t\t\t`,\n\t\t\tform,\n\t\t);\n\n\t\tif (property.Settings.Handler)\n\t\t{\n\t\t\tlet url = window.location.protocol + '//' + window.location.host + property.Settings.Handler;\n\t\t\turl = Uri.addParam(url, { code: value });\n\t\t\turl = url.replace('{{DOCUMENT_TYPE}}', getGlobalContext().document.getRawType()[2]);\n\t\t\turl = url.replace('{{USER_ID}}', Loc.getMessage('USER_ID'));\n\n\t\t\tif (property.Settings.Password)\n\t\t\t{\n\t\t\t\turl = url.replace('{{PASSWORD}}', property.Settings.Password);\n\t\t\t}\n\n\t\t\thookLinkTextarea.value = url;\n\t\t}\n\n\t\tif (!property.Settings.Password && property.Settings.PasswordLoader)\n\t\t{\n\t\t\tconst myAlertText = (\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_WEBHOOK_PASSWORD_ALERT')\n\t\t\t\t\t.replace(\n\t\t\t\t\t\t'#A1#',\n\t\t\t\t\t\t'<a class=\"bizproc-automation-popup-settings-link '\n\t\t\t\t\t\t+ 'bizproc-automation-popup-settings-link-light\" data-role=\"token-gen\">',\n\t\t\t\t\t)\n\t\t\t\t\t.replace('#A2#', '</a>')\n\t\t\t);\n\n\t\t\tconst passwordAlert = new Alert({\n\t\t\t\tcolor: AlertColor.WARNING,\n\t\t\t\ticon: AlertIcon.WARNING,\n\t\t\t\ttext: myAlertText,\n\t\t\t});\n\n\t\t\tEvent.bind(\n\t\t\t\tpasswordAlert.getTextContainer().querySelector('[data-role=\"token-gen\"]'),\n\t\t\t\t'click',\n\t\t\t\t() => {\n\t\t\t\t\tconst loaderConfig = property.Settings.PasswordLoader;\n\n\t\t\t\t\tajax.runComponentAction(\n\t\t\t\t\t\tloaderConfig.component,\n\t\t\t\t\t\tloaderConfig.action,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmode: loaderConfig.mode || undefined,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tdocumentType: [\n\t\t\t\t\t\t\t\t\t...getGlobalContext().document.getRawType(),\n\t\t\t\t\t\t\t\t\tgetGlobalContext().document.getCategoryId(),\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t).then(\n\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\tif (response.data.error)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\twindow.alert(response.data.error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (response.data.password)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tproperty.Settings.Password = response.data.password;\n\t\t\t\t\t\t\t\thookLinkTextarea.value = hookLinkTextarea\n\t\t\t\t\t\t\t\t\t.value.replace('{{PASSWORD}}', property.Settings.Password)\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t\tpasswordAlert.handleCloseBtnClick();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tDom.append(passwordAlert.getContainer(), form);\n\t\t}\n\t}\n\n\t#renderFieldSelectorProperty(property, value, form)\n\t{\n\t\tconst menuId = `@field-selector${Math.random()}`;\n\t\tconst fieldName = `${property.Id}[]`;\n\n\t\tconst fieldsList = property.Settings.Fields;\n\n\t\tconst renderFieldCheckbox = function(field, listNode)\n\t\t{\n\t\t\tconst exists = listNode.querySelector(`[data-field=\"${field.Id}\"]`);\n\t\t\tif (exists)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"bizproc-automation-popup-checkbox-item\" data-field=\"${Text.encode(field.Id)}\">\n\t\t\t\t\t\t<label class=\"bizproc-automation-popup-chk-label\">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-chk\"\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\tname=\"${Text.encode(fieldName)}\"\n\t\t\t\t\t\t\t\tvalue=\"${Text.encode(field.Id)}\"\n\t\t\t\t\t\t\t\tchecked\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t${Text.encode(field.Name)}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tlistNode,\n\t\t\t);\n\t\t};\n\n\t\tconst fieldSelectorHandler = function(targetNode, listNode)\n\t\t{\n\t\t\tif (BX.Main.MenuManager.getMenuById(menuId))\n\t\t\t{\n\t\t\t\treturn BX.Main.MenuManager.getMenuById(menuId).show();\n\t\t\t}\n\n\t\t\tconst menuItems = [];\n\n\t\t\tfieldsList.forEach((field) => {\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: Text.encode(field.Name),\n\t\t\t\t\tfield,\n\t\t\t\t\tonclick(event, item)\n\t\t\t\t\t{\n\t\t\t\t\t\trenderFieldCheckbox(item.field, listNode);\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tMenuManager.show(\n\t\t\t\tmenuId,\n\t\t\t\ttargetNode,\n\t\t\t\tmenuItems,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\toffsetLeft: (Dom.getPosition(this).width / 2),\n\t\t\t\t\tangle: { position: 'top', offset: 0 },\n\t\t\t\t\tzIndex: 200,\n\t\t\t\t\tclassName: 'bizproc-automation-inline-selector-menu',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonPopupClose: (popup) => {\n\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t};\n\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<span class=\"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\">\n\t\t\t\t\t${Text.encode(property.Name)}:\n\t\t\t\t</span>\n\t\t\t`,\n\t\t\tform,\n\t\t);\n\n\t\tconst fieldListNode = Tag.render`<div class=\"bizproc-automation-popup-checkbox\"></div>`;\n\t\tDom.append(fieldListNode, form);\n\n\t\tconst fieldSelectorNode = Tag.render`\n\t\t\t<span class=\"bizproc-automation-popup-settings-link\">${Text.encode(property.Settings.ChooseFieldLabel)}</span>\n\t\t`;\n\t\tEvent.bind(fieldSelectorNode, 'click', function() {\n\t\t\tfieldSelectorHandler(this, fieldListNode);\n\t\t});\n\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"bizproc-automation-popup-settings bizproc-automation-popup-settings-text\">\n\t\t\t\t\t${fieldSelectorNode}\n\t\t\t\t</div>\n\t\t\t`,\n\t\t\tform,\n\t\t);\n\n\t\tif (Type.isArray(value))\n\t\t{\n\t\t\tvalue.forEach((field) => {\n\t\t\t\tconst foundField = fieldsList.find((fld) => fld.Id === field);\n\t\t\t\tif (foundField)\n\t\t\t\t{\n\t\t\t\t\trenderFieldCheckbox(foundField, fieldListNode);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\trenderExecuteByControl(trigger, form)\n\t{\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<span class=\"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-top bizproc-automation-popup-settings-title-autocomplete\">\n\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_TRIGGER_EXECUTE_BY')}:\n\t\t\t\t</span>\n\t\t\t`,\n\t\t\tform,\n\t\t);\n\n\t\tconst documentType = [...getGlobalContext().document.getRawType(), getGlobalContext().document.getCategoryId()];\n\t\tconst property = { Type: 'user' };\n\t\tconst value = (\n\t\t\ttrigger.draft\n\t\t\t\t? Helper.getResponsibleUserExpression(getGlobalContext().document.getFields())\n\t\t\t\t: trigger.getExecuteBy()\n\t\t);\n\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"bizproc-automation-popup-settings\">\n\t\t\t\t\t${BX.Bizproc.FieldType.renderControl(documentType, property, 'execute_by', value)}\n\t\t\t\t</div>\n\t\t\t`,\n\t\t\tform,\n\t\t);\n\t}\n\n\trenderAllowBackwardsControl(trigger, form)\n\t{\n\t\tDom.append(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"bizproc-automation-popup-checkbox\">\n\t\t\t\t\t<div class=\"bizproc-automation-popup-checkbox-item\">\n\t\t\t\t\t\t<label class=\"bizproc-automation-popup-chk-label\">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-chk\"\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\tname=\"allow_backwards\"\n\t\t\t\t\t\t\t\tvalue=\"Y\"\n\t\t\t\t\t\t\t\t${trigger.isBackwardsAllowed() ? 'checked' : ''}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_TRIGGER_ALLOW_REVERSE')}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`,\n\t\t\tform,\n\t\t);\n\t}\n\n\tsetConditionSettingsFromForm(formFields: Object, trigger: Trigger): this\n\t{\n\t\ttrigger.setCondition(ConditionGroup.createFromForm(formFields));\n\n\t\treturn this;\n\t}\n\n\tonRestAppInstall(installed, eventResult)\n\t{\n\t\teventResult.redirect = false;\n\n\t\tsetTimeout(() => {\n\t\t\tajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: getGlobalContext().ajaxUrl,\n\t\t\t\tdata: {\n\t\t\t\t\tajax_action: 'get_available_triggers',\n\t\t\t\t\tdocument_signed: getGlobalContext().signedDocument,\n\t\t\t\t},\n\t\t\t\tonsuccess(response)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isArray(response.DATA))\n\t\t\t\t\t{\n\t\t\t\t\t\tgetGlobalContext().set('availableTriggers', response.DATA);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t}, 1500);\n\t}\n\n\tinitSettingsDialogControls(node)\n\t{\n\t\tif (!Type.isArray(this.settingsDialogControls))\n\t\t{\n\t\t\tthis.settingsDialogControls = [];\n\t\t}\n\n\t\tconst controlNodes = node.querySelectorAll('[data-role]');\n\t\tfor (const controlNode of controlNodes)\n\t\t{\n\t\t\tlet control = null;\n\t\t\tconst role = controlNode.getAttribute('data-role');\n\n\t\t\tif (role === 'user-selector')\n\t\t\t{\n\t\t\t\tcontrol = BX.Bizproc.UserSelector.decorateNode(controlNode);\n\t\t\t}\n\n\t\t\tBX.UI.Hint.init(controlNode);\n\n\t\t\tif (control)\n\t\t\t{\n\t\t\t\tthis.settingsDialogControls.push(control);\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroySettingsDialogControls()\n\t{\n\t\tif (this.conditionSelector)\n\t\t{\n\t\t\tthis.conditionSelector.destroy();\n\t\t\tthis.conditionSelector = null;\n\t\t}\n\n\t\tif (Type.isArray(this.settingsDialogControls))\n\t\t{\n\t\t\tfor (let i = 0; i < this.settingsDialogControls.length; ++i)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(this.settingsDialogControls[i].destroy))\n\t\t\t\t{\n\t\t\t\t\tthis.settingsDialogControls[i].destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.settingsDialogControls = null;\n\t}\n\n\tgetListByDocumentStatus(statusId): Array<Trigger>\n\t{\n\t\tconst result = [];\n\t\tthis.#triggers.forEach((trigger) => {\n\t\t\tif (trigger.getStatusId() === statusId)\n\t\t\t{\n\t\t\t\tresult.push(trigger);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetReturnProperties(statusId): Array<Object>\n\t{\n\t\tconst result = [];\n\t\tconst exists = {};\n\t\tconst triggers = this.getListByDocumentStatus(statusId);\n\n\t\ttriggers.forEach((trigger) => {\n\t\t\tconst props = trigger.deleted ? [] : trigger.getReturnProperties();\n\t\t\tif (props.length > 0)\n\t\t\t{\n\t\t\t\tprops.forEach((property) => {\n\t\t\t\t\tif (!exists[property.Id])\n\t\t\t\t\t{\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\tId: property.Id,\n\t\t\t\t\t\t\tObjectId: 'Template',\n\t\t\t\t\t\t\tName: property.Name,\n\t\t\t\t\t\t\tObjectName: trigger.getName(),\n\t\t\t\t\t\t\tType: property.Type,\n\t\t\t\t\t\t\tExpression: `{{~*:${property.Id}}}`,\n\t\t\t\t\t\t\tSystemExpression: `{=Template:${property.Id}}`,\n\t\t\t\t\t\t});\n\t\t\t\t\t\texists[property.Id] = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetReturnProperty(statusId, propertyId): ?Object\n\t{\n\t\tconst properties = this.getReturnProperties(statusId);\n\t\tfor (const property of properties)\n\t\t{\n\t\t\tif (property.Id === propertyId)\n\t\t\t{\n\t\t\t\treturn property;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import { Type, Runtime } from 'main.core';\n\nexport class Document\n{\n\t#rawType: Array<string>;\n\t#id: number;\n\t#title: ?string;\n\t#categoryId: ?number;\n\t#statusList: ?Array<Object>;\n\t#currentStatusIndex: number;\n\n\t#fields: ?Array<Object>;\n\n\tconstructor(options: {\n\t\trawDocumentType: Array<string>,\n\t\tdocumentId: number,\n\t\tcategoryId?: number,\n\t\tstatusId?: string,\n\n\t\tstatusList: Array<Object>,\n\n\t\tdocumentFields?: Array<Object>;\n\t\ttitle?: string,\n\t})\n\t{\n\t\tthis.#rawType = options.rawDocumentType;\n\t\tthis.#id = options.documentId;\n\t\tthis.#title = options.title;\n\t\tthis.#categoryId = options.categoryId;\n\n\t\tthis.#statusList = [];\n\t\tthis.#currentStatusIndex = 0;\n\t\tif (Type.isArray(options.statusList))\n\t\t{\n\t\t\tthis.#statusList = options.statusList.map((status) => {\n\t\t\t\tstatus.STATUS_ID = String(status.STATUS_ID);\n\n\t\t\t\treturn status;\n\t\t\t})\n\t\t\tthis.#currentStatusIndex = this.#statusList.findIndex(status => status.STATUS_ID === options.statusId)\n\t\t}\n\t\telse if (Type.isStringFilled(options.statusId))\n\t\t{\n\t\t\tthis.#statusList.push(options.statusId);\n\t\t}\n\n\t\tif (this.#currentStatusIndex < 0)\n\t\t{\n\t\t\tthis.#currentStatusIndex = 0;\n\t\t}\n\n\t\tthis.#fields = Type.isArray(options.documentFields) ? options.documentFields : [];\n\t}\n\n\tclone(): this\n\t{\n\t\treturn new Document({\n\t\t\trawDocumentType: Runtime.clone(this.#rawType),\n\t\t\tdocumentId: this.#id,\n\t\t\tcategoryId: this.#categoryId,\n\t\t\tstatusId: this.getCurrentStatusId(),\n\n\t\t\tstatusList: Runtime.clone(this.#statusList),\n\n\t\t\tdocumentFields: Runtime.clone(this.#fields),\n\t\t\ttitle: this.#title,\n\t\t});\n\t}\n\n\tget title(): ?string\n\t{\n\t\treturn this.#title;\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.#id;\n\t}\n\n\tgetRawType(): Array<string>\n\t{\n\t\treturn this.#rawType;\n\t}\n\n\tgetCategoryId(): ?number\n\t{\n\t\treturn this.#categoryId;\n\t}\n\n\tgetCurrentStatusId(): ?string\n\t{\n\t\tconst documentStatus = this.#statusList[this.#currentStatusIndex]?.STATUS_ID;\n\n\t\treturn !Type.isNil(documentStatus) ? String(documentStatus) : documentStatus;\n\t}\n\n\tgetSortedStatusId(index: number): ?string\n\t{\n\t\tif (index >= 0 && index < this.#statusList.length)\n\t\t{\n\t\t\treturn this.#statusList[index].STATUS_ID;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetNextStatusIdList(): Array<string>\n\t{\n\t\treturn this.#statusList.slice(this.#currentStatusIndex + 1).map(status => status.STATUS_ID);\n\t}\n\n\tgetPreviousStatusIdList(): Array<string>\n\t{\n\t\treturn this.#statusList.slice(0, this.#currentStatusIndex).map(status => status.STATUS_ID);\n\t}\n\n\tsetStatus(statusId: string): Document\n\t{\n\t\tconst newStatusId = this.#statusList.findIndex(status => status.STATUS_ID === statusId);\n\t\tif (newStatusId >= 0)\n\t\t{\n\t\t\tthis.#currentStatusIndex = newStatusId;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetFields(): Array<Object>\n\t{\n\t\treturn this.#fields;\n\t}\n\n\tsetFields(documentFields: Array<object>): this\n\t{\n\t\tthis.#fields = documentFields;\n\n\t\treturn this;\n\t}\n\n\tsetStatusList(statusList: Array<Object>): this\n\t{\n\t\tif (Type.isArrayFilled(statusList))\n\t\t{\n\t\t\tthis.#statusList = statusList;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tget statusList(): ?Array<Object>\n\t{\n\t\treturn this.#statusList;\n\t}\n}","import { Type, Loc } from 'main.core';\n\nexport class DelayInterval\n{\n\tstatic BASIS_TYPE = {\n\t\tCurrentDate: '{=System:Date}',\n\t\tCurrentDateTime: '{=System:Now}',\n\t\tCurrentDateTimeLocal: '{=System:NowLocal}',\n\t};\n\n\tstatic DELAY_TYPE = {\n\t\tAfter: 'after',\n\t\tBefore: 'before',\n\t\tIn: 'in',\n\t};\n\n\t#basis: string = DelayInterval.BASIS_TYPE.CurrentDateTime;\n\t#type: string = DelayInterval.DELAY_TYPE.After;\n\t#value: number = 0;\n\t#valueType: string = 'i';\n\t#workTime: boolean = false;\n\t#waitWorkDay: boolean = false;\n\t#inTime: ?Array<[number, number]>;\n\n\tconstructor(params: ?Object)\n\t{\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tif (params.type)\n\t\t\t{\n\t\t\t\tthis.setType(params.type);\n\t\t\t}\n\n\t\t\tif (params.value)\n\t\t\t{\n\t\t\t\tthis.setValue(params.value);\n\t\t\t}\n\n\t\t\tif (params.valueType)\n\t\t\t{\n\t\t\t\tthis.setValueType(params.valueType);\n\t\t\t}\n\n\t\t\tif (params.basis)\n\t\t\t{\n\t\t\t\tthis.setBasis(params.basis);\n\t\t\t}\n\n\t\t\tif (params.workTime)\n\t\t\t{\n\t\t\t\tthis.setWorkTime(params.workTime);\n\t\t\t}\n\n\t\t\tif (params.waitWorkDay)\n\t\t\t{\n\t\t\t\tthis.setWaitWorkDay(params.waitWorkDay);\n\t\t\t}\n\n\t\t\tif (params.inTime)\n\t\t\t{\n\t\t\t\tthis.setInTime(params.inTime);\n\t\t\t}\n\t\t}\n\t}\n\n\tget basis()\n\t{\n\t\treturn this.#basis;\n\t}\n\n\tget type()\n\t{\n\t\treturn this.#type;\n\t}\n\n\tget value()\n\t{\n\t\treturn this.#value;\n\t}\n\n\tget valueType()\n\t{\n\t\treturn this.#valueType;\n\t}\n\n\tget workTime()\n\t{\n\t\treturn this.#workTime;\n\t}\n\n\tget waitWorkDay()\n\t{\n\t\treturn this.#waitWorkDay;\n\t}\n\n\tget inTime()\n\t{\n\t\treturn this.#inTime;\n\t}\n\n\tget inTimeString(): string\n\t{\n\t\tif (!this.#inTime)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn `${('0' + this.#inTime[0]).slice(-2)}:${('0' + this.#inTime[1]).slice(-2)}`;\n\t}\n\n\tclone()\n\t{\n\t\treturn new DelayInterval({\n\t\t\ttype: this.#type,\n\t\t\tvalue: this.#value,\n\t\t\tvalueType: this.#valueType,\n\t\t\tbasis: this.#basis,\n\t\t\tworkTime: this.#workTime,\n\t\t\twaitWorkDay: this.#waitWorkDay,\n\t\t\tinTime: this.#inTime,\n\t\t});\n\t}\n\n\tstatic isSystemBasis(basis: string): boolean\n\t{\n\t\treturn (\n\t\t\tbasis === this.BASIS_TYPE.CurrentDate\n\t\t\t|| basis === this.BASIS_TYPE.CurrentDateTime\n\t\t\t|| basis === this.BASIS_TYPE.CurrentDateTimeLocal\n\t\t);\n\t}\n\n\tstatic fromString(intervalString, basisFields): this\n\t{\n\t\tif (!intervalString)\n\t\t{\n\t\t\treturn new DelayInterval();\n\t\t}\n\n\t\tintervalString = intervalString.toString().trimStart().replace(/^=/, '');\n\t\tconst params = {\n\t\t\tbasis: DelayInterval.BASIS_TYPE.CurrentDateTime,\n\t\t\tworkTime: false,\n\t\t\tinTime: null,\n\t\t};\n\n\t\tconst values = {\n\t\t\ti: 0,\n\t\t\th: 0,\n\t\t\td: 0,\n\t\t};\n\n\t\tif (intervalString.indexOf('settime(') === 0)\n\t\t{\n\t\t\tintervalString = intervalString.substring(8, intervalString.length - 1);\n\n\t\t\tconst setTimeArgs = intervalString.split(',');\n\t\t\tconst minute = parseInt(setTimeArgs.pop().trim(), 10);\n\t\t\tconst hour = parseInt(setTimeArgs.pop().trim(), 10);\n\n\t\t\tparams.inTime = [hour || 0, minute || 0];\n\t\t\tintervalString = setTimeArgs.join(',');\n\t\t}\n\n\t\tif (intervalString.indexOf('dateadd(') === 0 || intervalString.indexOf('workdateadd(') === 0)\n\t\t{\n\t\t\tif (intervalString.indexOf('workdateadd(') === 0)\n\t\t\t{\n\t\t\t\tintervalString = intervalString.substring(12, intervalString.length - 1);\n\t\t\t\tparams.workTime = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintervalString = intervalString.substring(8, intervalString.length - 1);\n\t\t\t}\n\n\t\t\tconst fnArgs = intervalString.split(',');\n\t\t\tparams.basis = fnArgs[0].trim();\n\t\t\tfnArgs[1] = (fnArgs[1] || '').replace(/['\")]+/g, '');\n\t\t\tparams.type = fnArgs[1].indexOf('-') === 0 ? DelayInterval.DELAY_TYPE.Before : DelayInterval.DELAY_TYPE.After;\n\n\t\t\tlet match;\n\t\t\tconst re = /s*([\\d]+)\\s*(i|h|d)\\s*/ig;\n\t\t\twhile (match = re.exec(fnArgs[1]))\n\t\t\t{\n\t\t\t\tvalues[match[2]] = parseInt(match[1], 10);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams.basis = intervalString;\n\n\t\t\tif (params.basis === DelayInterval.BASIS_TYPE.CurrentDateTime)\n\t\t\t{\n\t\t\t\tparams.type = DelayInterval.DELAY_TYPE.After;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tparams.type = DelayInterval.DELAY_TYPE.In;\n\t\t\t}\n\t\t}\n\n\t\tif (!DelayInterval.isSystemBasis(params.basis) && BX.type.isArray(basisFields))\n\t\t{\n\t\t\tlet found = false;\n\t\t\tfor (let i = 0, s = basisFields.length; i < s; ++i)\n\t\t\t{\n\t\t\t\tif (params.basis === basisFields[i].SystemExpression || params.basis === basisFields[i].Expression)\n\t\t\t\t{\n\t\t\t\t\tparams.basis = basisFields[i].SystemExpression;\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!found)\n\t\t\t{\n\t\t\t\tparams.basis = DelayInterval.BASIS_TYPE.CurrentDateTime;\n\t\t\t}\n\t\t}\n\n\t\tconst minutes = values.i + values.h * 60 + values.d * 60 * 24;\n\n\t\tif (minutes % 1440 === 0)\n\t\t{\n\t\t\tparams.value = minutes / 1440;\n\t\t\tparams.valueType = 'd';\n\t\t}\n\t\telse if (minutes % 60 === 0)\n\t\t{\n\t\t\tparams.value = minutes / 60;\n\t\t\tparams.valueType = 'h';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparams.value = minutes;\n\t\t\tparams.valueType = 'i';\n\t\t}\n\n\t\tif (\n\t\t\t!params.value\n\t\t\t&& (\n\t\t\t\tparams.basis !== DelayInterval.BASIS_TYPE.CurrentDateTime\n\t\t\t\t|| params.inTime\n\t\t\t)\n\t\t\t&& params.basis\n\t\t)\n\t\t{\n\t\t\tparams.type = DelayInterval.DELAY_TYPE.In;\n\t\t}\n\n\t\treturn new DelayInterval(params);\n\t}\n\n\tstatic fromMinutes(minutes): Array<string>\n\t{\n\t\tlet value;\n\t\tlet type;\n\n\t\tif (minutes % 1440 === 0)\n\t\t{\n\t\t\tvalue = minutes / 1440;\n\t\t\ttype = 'd';\n\t\t}\n\t\telse if (minutes % 60 === 0)\n\t\t{\n\t\t\tvalue = minutes / 60;\n\t\t\ttype = 'h';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalue = minutes;\n\t\t\ttype = 'i';\n\t\t}\n\n\t\treturn [value, type];\n\t}\n\n\tstatic toMinutes(value, valueType): number\n\t{\n\t\tlet result = 0;\n\n\t\tswitch (valueType)\n\t\t{\n\t\t\tcase 'i':\n\t\t\t\tresult = value;\n\t\t\t\tbreak;\n\t\t\tcase 'h':\n\t\t\t\tresult = value * 60;\n\t\t\t\tbreak;\n\t\t\tcase 'd':\n\t\t\t\tresult = value * 60 * 24;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tresult = 0;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetType(type): this\n\t{\n\t\tif (\n\t\t\ttype !== DelayInterval.DELAY_TYPE.After\n\t\t\t&& type !== DelayInterval.DELAY_TYPE.Before\n\t\t\t&& type !== DelayInterval.DELAY_TYPE.In\n\t\t)\n\t\t{\n\t\t\ttype = DelayInterval.DELAY_TYPE.After;\n\t\t}\n\t\tthis.#type = type;\n\n\t\treturn this;\n\t}\n\n\tsetValue(value): this\n\t{\n\t\tvalue = parseInt(value, 10);\n\t\tthis.#value = value >= 0 ? value : 0;\n\n\t\treturn this;\n\t}\n\n\tsetValueType(valueType: string): this\n\t{\n\t\tif (valueType !== 'i' && valueType !== 'h' && valueType !== 'd')\n\t\t{\n\t\t\tvalueType = 'i';\n\t\t}\n\n\t\tthis.#valueType = valueType;\n\n\t\treturn this;\n\t}\n\n\tsetBasis(basis: string): this\n\t{\n\t\tif (Type.isString(basis) && basis !== '')\n\t\t{\n\t\t\tthis.#basis = basis;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetWorkTime(flag): this\n\t{\n\t\tthis.#workTime = Boolean(flag);\n\n\t\treturn this;\n\t}\n\n\tsetWaitWorkDay(flag): this\n\t{\n\t\tthis.#waitWorkDay = Boolean(flag);\n\n\t\treturn this;\n\t}\n\n\tsetInTime(value: ?Array<[number, number]>): this\n\t{\n\t\tthis.#inTime = value;\n\n\t\treturn this;\n\t}\n\n\tisNow(): boolean\n\t{\n\t\treturn (\n\t\t\tthis.#type === DelayInterval.DELAY_TYPE.After\n\t\t\t&& this.#basis === DelayInterval.BASIS_TYPE.CurrentDateTime\n\t\t\t&& !this.#value\n\t\t\t&& !this.workTime\n\t\t\t&& !this.inTime\n\t\t);\n\t}\n\n\tsetNow(): void\n\t{\n\t\tthis.setType(DelayInterval.DELAY_TYPE.After);\n\t\tthis.setValue(0);\n\t\tthis.setValueType('i');\n\t\tthis.setBasis(DelayInterval.BASIS_TYPE.CurrentDateTime);\n\t\tthis.setInTime(null);\n\t}\n\n\tserialize(): Object\n\t{\n\t\treturn {\n\t\t\ttype: this.#type,\n\t\t\tvalue: this.#value,\n\t\t\tvalueType: this.#valueType,\n\t\t\tbasis: this.#basis,\n\t\t\tworkTime: this.#workTime ? 1 : 0,\n\t\t\twaitWorkDay: this.#waitWorkDay ? 1 : 0,\n\t\t\tinTime: this.#inTime || null,\n\t\t};\n\t}\n\n\ttoExpression(basisFields, workerExpression): string\n\t{\n\t\tlet basis = this.#basis ?? DelayInterval.BASIS_TYPE.CurrentDate;\n\n\t\tif (!DelayInterval.isSystemBasis(basis) && Type.isArray(basisFields))\n\t\t{\n\t\t\tfor (let i = 0, s = basisFields.length; i < s; ++i)\n\t\t\t{\n\t\t\t\tif (basis === basisFields[i].SystemExpression)\n\t\t\t\t{\n\t\t\t\t\tbasis = basisFields[i].Expression;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.isNow() || this.#type === DelayInterval.DELAY_TYPE.In && !this.#workTime && !this.#inTime)\n\t\t{\n\t\t\treturn basis;\n\t\t}\n\n\t\tlet days = 0;\n\t\tlet hours = 0;\n\t\tlet minutes = 0;\n\n\t\tswitch (this.#valueType)\n\t\t{\n\t\t\tcase 'i':\n\t\t\t\tminutes = this.#value;\n\t\t\t\tbreak;\n\t\t\tcase 'h':\n\t\t\t\thours = this.#value;\n\t\t\t\tbreak;\n\t\t\tcase 'd':\n\t\t\t\tdays = this.#value;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tlet add = '';\n\n\t\tif (days > 0)\n\t\t{\n\t\t\tadd += `${days}d`;\n\t\t}\n\n\t\tif (hours > 0)\n\t\t{\n\t\t\tadd += `${hours}h`;\n\t\t}\n\n\t\tif (minutes > 0)\n\t\t{\n\t\t\tadd += `${minutes}i`;\n\t\t}\n\n\t\tif (add !== '' && this.#type === DelayInterval.DELAY_TYPE.Before)\n\t\t{\n\t\t\tadd = `-${add}`;\n\t\t}\n\n\t\tconst fn = this.#workTime ? 'workdateadd' : 'dateadd';\n\n\t\tif (fn === 'workdateadd' && add === '')\n\t\t{\n\t\t\tadd = '0d';\n\t\t}\n\n\t\tlet worker = '';\n\t\tif (fn === 'workdateadd' && workerExpression)\n\t\t{\n\t\t\tworker = workerExpression;\n\t\t}\n\n\t\tlet result = basis;\n\t\tlet isFunctionInResult = false;\n\t\tif (add !== '')\n\t\t{\n\t\t\tresult = `${fn}(${basis},\"${add}\"${worker ? ',' + worker : ''})`;\n\t\t\tisFunctionInResult = true;\n\t\t}\n\n\t\tif (this.#inTime)\n\t\t{\n\t\t\tresult = `settime(${result}, ${this.#inTime[0] || 0}, ${this.#inTime[1] || 0})`;\n\t\t\tisFunctionInResult = true;\n\t\t}\n\n\t\treturn isFunctionInResult ? `=${result}` : result;\n\t}\n\n\tformat(emptyText, fields)\n\t{\n\t\tlet str = emptyText;\n\n\t\tif (this.#type === DelayInterval.DELAY_TYPE.In)\n\t\t{\n\t\t\tstr = Loc.getMessage('BIZPROC_AUTOMATION_CMP_IN_TIME_2');\n\t\t\tif (Type.isArray(fields))\n\t\t\t{\n\t\t\t\tfor (const field of fields)\n\t\t\t\t{\n\t\t\t\t\tif (this.#basis === field.SystemExpression)\n\t\t\t\t\t{\n\t\t\t\t\t\tstr += ` ${field.Name}`;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.inTime)\n\t\t\t{\n\t\t\t\tstr += ` ${this.inTimeString}`;\n\t\t\t}\n\t\t}\n\t\telse if (this.#value)\n\t\t{\n\t\t\tconst prefix = (\n\t\t\t\tthis.#type === DelayInterval.DELAY_TYPE.After\n\t\t\t\t\t? Loc.getMessage('BIZPROC_AUTOMATION_CMP_THROUGH_3')\n\t\t\t\t\t: Loc.getMessage('BIZPROC_AUTOMATION_CMP_FOR_TIME_3')\n\t\t\t);\n\n\t\t\tstr = `${prefix} ${this.getFormattedPeriodLabel(this.#value, this.#valueType)}`;\n\n\t\t\tif (Type.isArray(fields))\n\t\t\t{\n\t\t\t\tconst fieldSuffix = (\n\t\t\t\t\tthis.#type === DelayInterval.DELAY_TYPE.After\n\t\t\t\t\t\t? Loc.getMessage('BIZPROC_AUTOMATION_CMP_AFTER')\n\t\t\t\t\t\t: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BEFORE_1')\n\t\t\t\t);\n\t\t\t\tfor (const field of fields)\n\t\t\t\t{\n\t\t\t\t\tif (this.#basis === field.SystemExpression)\n\t\t\t\t\t{\n\t\t\t\t\t\tstr += ` ${fieldSuffix} ${field.Name}`;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.#workTime)\n\t\t{\n\t\t\tstr += `, ${Loc.getMessage('BIZPROC_AUTOMATION_CMP_IN_WORKTIME')}`;\n\t\t}\n\n\t\treturn str;\n\t}\n\n\tgetFormattedPeriodLabel(value, type)\n\t{\n\t\tconst label = `${value} `;\n\t\tlet labelIndex = 0;\n\t\tif (value > 20)\n\t\t{\n\t\t\tvalue %= 10;\n\t\t}\n\n\t\tif (value === 1)\n\t\t{\n\t\t\tlabelIndex = 0;\n\t\t}\n\t\telse if (value > 1 && value < 5)\n\t\t{\n\t\t\tlabelIndex = 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlabelIndex = 2;\n\t\t}\n\n\t\tconst labels = DelayInterval.getPeriodLabels(type);\n\n\t\treturn label + (labels ? labels[labelIndex] : '');\n\t}\n\n\tstatic getPeriodLabels(period)\n\t{\n\t\tlet labels = [];\n\t\tswitch (period)\n\t\t{\n\t\t\tcase 'i': {\n\t\t\t\tlabels = [\n\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_MIN1'),\n\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_MIN2'),\n\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_MIN3'),\n\t\t\t\t];\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'h': {\n\t\t\t\tlabels = [\n\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_HOUR1'),\n\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_HOUR2'),\n\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_HOUR3'),\n\t\t\t\t];\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'd': {\n\t\t\t\tlabels = [\n\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_DAY1'),\n\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_DAY2'),\n\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_DAY3'),\n\t\t\t\t];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tlabels = [];\n\t\t}\n\n\t\treturn labels;\n\t}\n}\n","import { Event, Text, Type, Dom, Loc } from 'main.core';\n\nexport class HelpHint\n{\n\tstatic popupHint;\n\tstatic timeout;\n\n\tstatic bindAll(node)\n\t{\n\t\tnode.querySelectorAll('[data-text]').forEach((element) => HelpHint.bindToNode(element));\n\t}\n\n\tstatic bindToNode(node)\n\t{\n\t\tEvent.bind(node, 'mouseover', this.showHint.bind(this, node));\n\t\tEvent.bind(node, 'mouseout', this.hideHint.bind(this));\n\t}\n\n\tstatic isBindedToNode(node): boolean\n\t{\n\t\treturn !!this.popupHint?.bindElement?.isSameNode(node);\n\t}\n\n\tstatic showHint(node)\n\t{\n\t\tconst rawText = node.getAttribute('data-text');\n\t\tif (!rawText)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet text = Text.encode(rawText);\n\t\ttext = BX.util.nl2br(text);\n\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.hideHint();\n\n\t\tthis.popupHint = new BX.PopupWindow('bizproc-automation-help-tip', node, {\n\t\t\tlightShadow: true,\n\t\t\tautoHide: false,\n\t\t\tdarkMode: true,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 2,\n\t\t\tbindOptions: {position: \"top\"},\n\t\t\tevents : {\n\t\t\t\tonPopupClose()\n\t\t\t\t{\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t},\n\t\t\tcontent : Dom.create('div', {\n\t\t\t\tattrs : {\n\t\t\t\t\tstyle : 'padding-right: 5px; width: 250px;'\n\t\t\t\t},\n\t\t\t\thtml: text\n\t\t\t}),\n\t\t});\n\t\tthis.popupHint.setAngle({offset: 32, position: 'bottom'});\n\t\tthis.popupHint.show();\n\n\t\treturn true;\n\t}\n\n\tstatic showNoPermissionsHint(node)\n\t{\n\t\tthis.showAngleHint(node, Loc.getMessage('BIZPROC_AUTOMATION_RIGHTS_ERROR'));\n\t}\n\n\tstatic showAngleHint(node, text)\n\t{\n\t\tif (this.timeout)\n\t\t{\n\t\t\tclearTimeout(this.timeout);\n\t\t}\n\n\t\tthis.popupHint = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\twidth: 334,\n\t\t\t\theight: 104,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tangle: {offset: Dom.getPosition(node).width / 2},\n\t\t\t\tbindOptions: {position: 'top'},\n\t\t\t}\n\t\t});\n\n\t\tthis.popupHint.close = function ()\n\t\t{\n\t\t\tthis.hide();\n\t\t};\n\t\tthis.popupHint.show(node, text);\n\t\tthis.timeout = setTimeout(this.hideHint.bind(this), 5000);\n\t}\n\n\tstatic hideHint()\n\t{\n\t\tif (this.popupHint)\n\t\t{\n\t\t\tthis.popupHint.close();\n\t\t}\n\t\tthis.popupHint = null;\n\t}\n}","export class WorkflowStatus\n{\n\tstatic CREATED = 0;\n\tstatic RUNNING = 1;\n\tstatic COMPLETED = 2;\n\tstatic SUSPENDED = 3;\n\tstatic TERMINATED = 4;\n}","import {WorkflowStatus} from \"../workflow/types\";\n\nexport class TrackingEntry\n{\n\tstatic UNKNOWN_ACTIVITY_TYPE = 0;\n\tstatic EXECUTE_ACTIVITY_TYPE = 1;\n\tstatic CLOSE_ACTIVITY_TYPE = 2;\n\tstatic CANCEL_ACTIVITY_TYPE = 3;\n\tstatic FAULT_ACTIVITY_TYPE = 4;\n\tstatic CUSTOM_ACTIVITY_TYPE = 5;\n\tstatic REPORT_ACTIVITY_TYPE = 6;\n\tstatic ATTACHED_ENTITY_TYPE = 7;\n\tstatic TRIGGER_ACTIVITY_TYPE = 8;\n\tstatic ERROR_ACTIVITY_TYPE = 9;\n\tstatic DEBUG_ACTIVITY_TYPE = 10;\n\tstatic DEBUG_AUTOMATION_TYPE = 11;\n\tstatic DEBUG_DESIGNER_TYPE = 12;\n\tstatic DEBUG_LINK_TYPE = 13;\n\n\tid: number;\n\tworkflowId: string;\n\t#type: number;\n\tname: string;\n\ttitle: string;\n\tnote: string;\n\t// TODO - convert string to Date\n\tdatetime: string;\n\t#workflowStatus: number;\n\n\tget type(): number\n\t{\n\t\treturn this.#type;\n\t}\n\n\tget workflowStatus(): number\n\t{\n\t\treturn this.#workflowStatus;\n\t}\n\n\tset type(entryType: number)\n\t{\n\t\tif (TrackingEntry.getAllActivityTypes().includes(entryType))\n\t\t{\n\t\t\tthis.#type = entryType;\n\t\t}\n\t}\n\n\tset workflowStatus(entryWorkflowStatus: number)\n\t{\n\t\tif (TrackingEntry.getAllWorkflowStatuses().includes(entryWorkflowStatus))\n\t\t{\n\t\t\tthis.#workflowStatus = entryWorkflowStatus;\n\t\t}\n\t}\n\n\tisTriggerEntry(): boolean\n\t{\n\t\treturn this.type === TrackingEntry.TRIGGER_ACTIVITY_TYPE;\n\t}\n\n\tstatic getAllActivityTypes(): Array<number>\n\t{\n\t\treturn [\n\t\t\tTrackingEntry.UNKNOWN_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.EXECUTE_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.CLOSE_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.CANCEL_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.FAULT_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.CUSTOM_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.REPORT_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.ATTACHED_ENTITY_TYPE,\n\t\t\tTrackingEntry.TRIGGER_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.ERROR_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.DEBUG_ACTIVITY_TYPE,\n\t\t\tTrackingEntry.DEBUG_AUTOMATION_TYPE,\n\t\t\tTrackingEntry.DEBUG_DESIGNER_TYPE,\n\t\t\tTrackingEntry.DEBUG_LINK_TYPE,\n\t\t];\n\t}\n\n\tstatic isKnownActivityType(typeId: number): boolean\n\t{\n\t\treturn TrackingEntry.getAllActivityTypes().includes(typeId);\n\t}\n\n\tstatic getAllWorkflowStatuses(): Array<number>\n\t{\n\t\treturn [\n\t\t\tWorkflowStatus.CREATED,\n\t\t\tWorkflowStatus.RUNNING,\n\t\t\tWorkflowStatus.COMPLETED,\n\t\t\tWorkflowStatus.SUSPENDED,\n\t\t\tWorkflowStatus.TERMINATED,\n\t\t];\n\t}\n\n\tstatic isKnownWorkflowStatus(statusId: number): boolean\n\t{\n\t\treturn TrackingEntry.getAllWorkflowStatuses().includes(statusId);\n\t}\n}","export class TrackingStatus\n{\n\tstatic WAITING = 0;\n\tstatic RUNNING = 1;\n\tstatic COMPLETED = 2;\n\tstatic AUTOCOMPLETED = 3;\n}","import {Type} from 'main.core';\nimport { TrackingEntry } from 'bizproc.automation';\nimport { TrackingStatus } from './types';\nimport {WorkflowStatus} from \"../workflow/types\";\n\nexport class RobotEntry\n{\n\tid: string = '';\n\tstatus: string = TrackingStatus.WAITING;\n\t// TODO - change string to Date when Date appear in TrackingEntry\n\tmodified: ?string = undefined;\n\tnotes: Array<string> = [];\n\terrors: Array<string> = [];\n\t#entryId: number = -1;\n\tworkflowStatus: number = WorkflowStatus.CREATED;\n\n\tconstructor(entries: ?Array<TrackingEntry>)\n\t{\n\t\tif (Type.isArray(entries))\n\t\t{\n\t\t\tfor (const entry of entries)\n\t\t\t{\n\t\t\t\tthis.addEntry(entry);\n\t\t\t}\n\t\t}\n\t}\n\n\taddEntry(entry: TrackingEntry)\n\t{\n\t\tthis.id = entry.name;\n\n\t\tif (this.#entryId < entry.id)\n\t\t{\n\t\t\tthis.#entryId = entry.id;\n\t\t\tthis.modified = entry.datetime;\n\t\t\tthis.workflowStatus = entry.workflowStatus;\n\n\t\t\tif (entry.type === TrackingEntry.CLOSE_ACTIVITY_TYPE)\n\t\t\t{\n\t\t\t\tthis.status = TrackingStatus.COMPLETED;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.status = TrackingStatus.RUNNING;\n\t\t\t}\n\t\t}\n\n\t\tif (entry.type === TrackingEntry.ERROR_ACTIVITY_TYPE)\n\t\t{\n\t\t\tthis.errors.push(entry.note);\n\t\t}\n\t\telse if (entry.type === TrackingEntry.CUSTOM_ACTIVITY_TYPE)\n\t\t{\n\t\t\tthis.notes.push(entry.note);\n\t\t}\n\t}\n}","import { TrackingEntry } from 'bizproc.automation';\nimport { TrackingStatus } from './types';\n\nexport class TriggerEntry\n{\n\tid: string = '';\n\tstatus: number = TrackingStatus.COMPLETED;\n\t// TODO - change string to Date when Date appear in TrackingEntry\n\tmodified: ?string = undefined;\n\n\tconstructor(entry: TrackingEntry)\n\t{\n\t\tif (entry.isTriggerEntry())\n\t\t{\n\t\t\tthis.id = entry.note;\n\t\t\tthis.modified = entry.datetime;\n\t\t}\n\t}\n}","import { Type } from 'main.core';\nimport { TrackingEntry } from './tracking-entry';\nimport { WorkflowStatus } from \"../workflow/types\";\n\nexport class TrackingEntryBuilder\n{\n\t#defaultSettings = {\n\t\tid: TrackingEntry.UNKNOWN_ACTIVITY_TYPE,\n\t\tworkflowId: '',\n\t\ttype: TrackingEntry.EXECUTE_ACTIVITY_TYPE,\n\t\tname: '',\n\t\ttitle: '',\n\t\tdatetime: '',\n\t\tnote: '',\n\t\tworkflowStatus: WorkflowStatus.CREATED,\n\t};\n\t#entrySettings: Object<string, string | number>;\n\n\tconstructor()\n\t{\n\t\tthis.#entrySettings = this.#defaultSettings;\n\t}\n\n\tsetLogEntry(logEntry: Object<string, any>): this\n\t{\n\t\tthis.#entrySettings = Object.assign({}, this.#defaultSettings);\n\t\tlogEntry = Object.assign({}, logEntry);\n\n\t\tif (Type.isStringFilled(logEntry['ID']))\n\t\t{\n\t\t\tlogEntry['ID'] = parseInt(logEntry['ID']);\n\t\t}\n\t\tif (Type.isStringFilled(logEntry['TYPE']))\n\t\t{\n\t\t\tlogEntry['TYPE'] = parseInt(logEntry['TYPE']);\n\t\t}\n\n\t\tif (Type.isNumber(logEntry['ID']))\n\t\t{\n\t\t\tthis.#entrySettings.id = logEntry['ID'];\n\t\t}\n\t\tif (Type.isStringFilled(logEntry['WORKFLOW_ID']))\n\t\t{\n\t\t\tthis.#entrySettings.workflowId = logEntry['WORKFLOW_ID'];\n\t\t}\n\t\tif (Type.isNumber(logEntry['TYPE']) && TrackingEntry.isKnownActivityType(logEntry['TYPE']))\n\t\t{\n\t\t\tthis.#entrySettings.type = logEntry['TYPE'];\n\t\t}\n\t\tif (Type.isStringFilled(logEntry['MODIFIED']))\n\t\t{\n\t\t\tthis.#entrySettings.datetime = logEntry['MODIFIED'];\n\t\t}\n\t\tif (Type.isNumber(logEntry['WORKFLOW_STATUS']) && TrackingEntry.isKnownWorkflowStatus(logEntry['WORKFLOW_STATUS']))\n\t\t{\n\t\t\tthis.#entrySettings.workflowStatus = logEntry['WORKFLOW_STATUS'];\n\t\t}\n\n\t\tthis.#entrySettings.name = String(logEntry['ACTION_NAME']);\n\t\tthis.#entrySettings.title = String(logEntry['ACTION_TITLE']);\n\t\tthis.#entrySettings.note = String(logEntry['ACTION_NOTE']);\n\n\t\treturn this;\n\t}\n\n\tsetStatus(status: string): this\n\t{\n\t\tthis.#entrySettings.status = status;\n\n\t\treturn this;\n\t}\n\n\tbuild(): TrackingEntry\n\t{\n\t\tconst entry = new TrackingEntry();\n\n\t\tentry.id = this.#entrySettings.id;\n\t\tentry.workflowId = this.#entrySettings.workflowId;\n\t\tentry.type = this.#entrySettings.type;\n\t\tentry.name = this.#entrySettings.name;\n\t\tentry.title = this.#entrySettings.title;\n\t\tentry.note = this.#entrySettings.note;\n\t\tentry.datetime = this.#entrySettings.datetime;\n\t\tentry.workflowStatus = this.#entrySettings.workflowStatus;\n\n\t\treturn entry;\n\t}\n}","import { Type } from 'main.core';\nimport { TrackingEntry } from './tracking-entry';\nimport { RobotEntry } from './robot-entry';\nimport { TriggerEntry } from './trigger-entry';\nimport { TrackingEntryBuilder } from './tracking-entry-builder';\nimport { Document } from 'bizproc.automation';\nimport { TrackingStatus } from './types';\nimport { WorkflowStatus } from \"../workflow/types\";\n\nexport {\n\tRobotEntry,\n\tTriggerEntry,\n\tTrackingEntryBuilder,\n\tTrackingEntry,\n\tTrackingStatus,\n}\n\nexport class Tracker\n{\n\t#ajaxUrl: string;\n\t#document: ?Document;\n\n\t#triggerLogs: Object<string, TrackingEntry>;\n\t#robotLogs: Object<string, RobotEntry>;\n\n\tconstructor(document: ?Document, ajaxUrl: string)\n\t{\n\t\tthis.#ajaxUrl = ajaxUrl;\n\t\tthis.#document = document;\n\t}\n\n\tinit(log)\n\t{\n\t\tthis.#triggerLogs = {};\n\t\tthis.#robotLogs = {};\n\n\t\tthis.addLogs(log);\n\t}\n\n\treInit(log)\n\t{\n\t\tthis.init(log);\n\t}\n\n\taddLogs(log: Object<string, Array<Object<string, any>>>)\n\t{\n\t\tif (!Type.isPlainObject(log))\n\t\t{\n\t\t\tlog = {};\n\t\t}\n\n\t\tconst logEntryBuilder = new TrackingEntryBuilder();\n\n\t\tfor (const [statusId, entries] of Object.entries(log))\n\t\t{\n\t\t\tif (!Type.isArray(entries))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (const rawEntry of entries)\n\t\t\t{\n\t\t\t\tconst entry = logEntryBuilder.setLogEntry(rawEntry).build();\n\n\t\t\t\tif (entry.isTriggerEntry())\n\t\t\t\t{\n\t\t\t\t\tthis.addTriggerEntry(entry);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.addRobotEntry(entry);\n\t\t\t\t\tconst robotEntry = this.#robotLogs[entry.name];\n\n\t\t\t\t\tif (!Type.isNil(this.#document))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst isRobotRunning = (robotEntry.status === TrackingStatus.RUNNING);\n\t\t\t\t\t\tconst isWorkflowCompleted =\n\t\t\t\t\t\t\t(robotEntry.workflowStatus === WorkflowStatus.COMPLETED)\n\t\t\t\t\t\t;\n\t\t\t\t\t\tconst isCurrentStatus = (this.#document.getCurrentStatusId() === statusId);\n\n\t\t\t\t\t\tconst isRobotRunningAtAnotherStatus = isRobotRunning && !isCurrentStatus;\n\t\t\t\t\t\tconst isRobotRunningAndCurrentWorkflowCompleted =\n\t\t\t\t\t\t\tisRobotRunning && isWorkflowCompleted && isCurrentStatus\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\tif (isRobotRunningAtAnotherStatus || isRobotRunningAndCurrentWorkflowCompleted)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trobotEntry.status = TrackingStatus.COMPLETED;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\taddTriggerEntry(entry: TrackingEntry)\n\t{\n\t\tif (entry.isTriggerEntry())\n\t\t{\n\t\t\tthis.#triggerLogs[entry.note] = new TriggerEntry(entry);\n\t\t}\n\t}\n\n\taddRobotEntry(entry: TrackingEntry)\n\t{\n\t\tif (entry.isTriggerEntry())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#robotLogs[entry.name])\n\t\t{\n\t\t\tthis.#robotLogs[entry.name] = new RobotEntry([entry]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#robotLogs[entry.name].addEntry(entry);\n\t\t}\n\t}\n\n\tgetRobotLog(id: string): ?RobotEntry\n\t{\n\t\treturn this.#robotLogs[id] || null;\n\t}\n\n\tgetTriggerLog(id: string): ?TriggerEntry\n\t{\n\t\treturn this.#triggerLogs[id] || null;\n\t}\n\n\tupdate(documentSigned: string)\n\t{\n\t\treturn BX.ajax({\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\turl: this.#ajaxUrl,\n\t\t\tdata: {\n\t\t\t\tajax_action: 'get_log',\n\t\t\t\tdocument_signed: documentSigned\n\t\t\t},\n\t\t\tonsuccess: (response) => {\n\t\t\t\tif (response.DATA && response.DATA.LOG)\n\t\t\t\t{\n\t\t\t\t\tthis.reInit(response.DATA.LOG);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n","import { Dom, Type, Event, Text, Loc, Runtime, Tag } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Document } from './document/document';\nimport { Template } from './template';\nimport { DelayInterval } from './delay-interval';\nimport { ViewMode } from './view-mode';\nimport { HelpHint } from './help-hint';\nimport { ConditionGroup, Helper } from 'bizproc.automation';\nimport { Tracker } from './tracker/tracker'\nimport { TrackingStatus } from './tracker/types';\nimport { Menu, MenuItem } from 'main.popup';\n\nexport class Robot extends EventEmitter\n{\n\tSYSTEM_EXPRESSION_PATTERN = '\\\\{=\\\\s*(?<object>[a-z0-9_]+)\\\\s*\\\\:\\\\s*(?<field>[a-z0-9_\\\\.]+)(\\\\s*>\\\\s*(?<mod1>[a-z0-9_\\\\:]+)(\\\\s*,\\\\s*(?<mod2>[a-z0-9_]+))?)?\\\\s*\\\\}';\n\n\t#data: Object<string, any>;\n\t#document: Document;\n\t#template: ?Template;\n\t#tracker: ?Object;\n\t#delay: DelayInterval;\n\t#node: HTMLElement;\n\t#condition: ConditionGroup;\n\t#isDraft: boolean;\n\n\t#isFrameMode: boolean;\n\t#viewMode: ViewMode;\n\n\tconstructor(params: {\n\t\tdocument: Document,\n\t\ttemplate: ?Template,\n\t\tisFrameMode: boolean,\n\t\ttracker: Tracker,\n\t})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation');\n\n\t\tthis.#document = params.document;\n\t\tif (!Type.isNil(params.template))\n\t\t{\n\t\t\tthis.#template = params.template;\n\t\t}\n\t\tthis.#isFrameMode = params.isFrameMode;\n\t\tthis.#viewMode = ViewMode.none();\n\t\tthis.#tracker = params.tracker;\n\t\tthis.#isDraft = false;\n\n\t\tthis.#delay = new DelayInterval();\n\t}\n\n\tget node()\n\t{\n\t\treturn this.#node;\n\t}\n\n\tget data()\n\t{\n\t\treturn {\n\t\t\t...this.#data,\n\t\t\tCondition: this.#condition.serialize(),\n\t\t\tDelay: this.#delay.serialize(),\n\t\t};\n\t}\n\n\tget draft()\n\t{\n\t\treturn this.#isDraft;\n\t}\n\n\tset draft(draft: boolean)\n\t{\n\t\tthis.#isDraft = draft;\n\t}\n\n\tget template()\n\t{\n\t\treturn this.#template;\n\t}\n\n\thasTemplate(): boolean\n\t{\n\t\treturn !Type.isNil(this.#template);\n\t}\n\n\tgetTemplate(): ?Template\n\t{\n\t\treturn this.#template;\n\t}\n\n\tgetDocument(): Document\n\t{\n\t\treturn this.#document;\n\t}\n\n\tstatic generateName(): string\n\t{\n\t\treturn (\n\t\t\t'A' + parseInt(Math.random() * 100000)\n\t\t\t+ '_' + parseInt(Math.random() * 100000)\n\t\t\t+ '_' + parseInt(Math.random() * 100000)\n\t\t\t+ '_' + parseInt(Math.random() * 100000)\n\t\t);\n\t}\n\n\tclone(): Robot\n\t{\n\t\tconst clonedRobot = new Robot({\n\t\t\tdocument: this.#document,\n\t\t\ttemplate: this.#template,\n\t\t\tisFrameMode: this.#isFrameMode,\n\t\t\ttracker: this.#tracker,\n\t\t});\n\n\t\tconst robotData = {\n\t\t\t...BX.clone(this.#data),\n\t\t\tName: Robot.generateName(),\n\t\t\tDelay: this.getDelayInterval().serialize(),\n\t\t\tCondition: this.getCondition().serialize(),\n\t\t};\n\t\tclonedRobot.init(robotData, this.#viewMode);\n\n\t\treturn clonedRobot;\n\t}\n\n\tisEqual(other: Robot): boolean\n\t{\n\t\treturn this.#data.Name === other.#data.Name;\n\t}\n\n\tinit(data: Object, viewMode: ?ViewMode): void\n\t{\n\t\tif (Type.isPlainObject(data))\n\t\t{\n\t\t\tthis.#data = Object.assign({}, data);\n\t\t}\n\t\tif (!this.#data.Name)\n\t\t{\n\t\t\tthis.#data.Name = Robot.generateName();\n\t\t}\n\t\tthis.#data.Activated = !Type.isNil(this.#data.Activated) ? Text.toBoolean(this.#data.Activated) : true;\n\n\t\tthis.#delay = new DelayInterval(this.#data.Delay);\n\t\tthis.#condition = new ConditionGroup(this.#data.Condition);\n\t\tif (!this.#data.Condition)\n\t\t{\n\t\t\tthis.#condition.type = ConditionGroup.CONDITION_TYPE.Mixed;\n\t\t}\n\n\t\tdelete this.#data.Condition;\n\t\tdelete this.#data.Delay;\n\n\t\tthis.#viewMode = Type.isNil(viewMode) ? ViewMode.edit() : viewMode;\n\t\tif (!this.#viewMode.isNone())\n\t\t{\n\t\t\tthis.#node = this.createNode();\n\t\t}\n\t}\n\n\treInit(data: Object, viewMode: ?ViewMode): void\n\t{\n\t\tif (Type.isNil(viewMode) && this.#viewMode.isNone())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst node = this.#node;\n\t\tthis.#node = this.createNode();\n\t\tif (node.parentNode)\n\t\t{\n\t\t\tnode.parentNode.replaceChild(this.#node, node);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tDom.remove(this.#node);\n\t\tthis.emit('Robot:destroyed');\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.#template.canEdit();\n\t}\n\n\tgetProperties(): Object\n\t{\n\t\tif (this.#data && Type.isPlainObject(this.#data.Properties))\n\t\t{\n\t\t\treturn this.#data.Properties;\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tgetProperty(name: string): ?Object\n\t{\n\t\treturn this.getProperties()[name] || null;\n\t}\n\n\thasProperty(name: string): boolean\n\t{\n\t\treturn this.getProperties().hasOwnProperty(name);\n\t}\n\n\tsetProperty(name: string, value: any): Robot\n\t{\n\t\tthis.#data.Properties[name] = value;\n\n\t\treturn this;\n\t}\n\n\tgetId(): ?string\n\t{\n\t\treturn this.#data.Name || null;\n\t}\n\n\tgetLogStatus(): number\n\t{\n\t\tlet status = TrackingStatus.WAITING;\n\t\tlet log = this.#tracker.getRobotLog(this.getId());\n\n\t\tif (log)\n\t\t{\n\t\t\tstatus = log.status;\n\t\t}\n\t\telse if (this.#data.DelayName)\n\t\t{\n\t\t\tlog = this.#tracker.getRobotLog(this.#data.DelayName);\n\t\t\tif (log && log.status === TrackingStatus.RUNNING)\n\t\t\t{\n\t\t\t\tstatus = TrackingStatus.RUNNING;\n\t\t\t}\n\t\t}\n\n\t\treturn status;\n\t}\n\n\tgetLogErrors(): Array<string>\n\t{\n\t\tlet errors = [];\n\t\tconst log = this.#tracker.getRobotLog(this.getId());\n\t\tif (log && log.errors)\n\t\t{\n\t\t\terrors = log.errors;\n\t\t}\n\n\t\treturn errors;\n\t}\n\n\tgetDelayNotes(): Array<string>\n\t{\n\t\tif (this.#data.DelayName)\n\t\t{\n\t\t\tconst log = this.#tracker.getRobotLog(this.#data.DelayName);\n\t\t\tif (log && log.status === TrackingStatus.RUNNING)\n\t\t\t{\n\t\t\t\treturn log.notes;\n\t\t\t}\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tselectNode(): void\n\t{\n\t\tif (this.#node)\n\t\t{\n\t\t\tDom.addClass(this.#node, '--selected');\n\n\t\t\tconst checkboxNode = this.#node.querySelector('input');\n\t\t\tif (checkboxNode)\n\t\t\t{\n\t\t\t\tcheckboxNode.checked = true;\n\t\t\t}\n\n\t\t\tthis.emit('Robot:selected');\n\t\t}\n\t}\n\n\tunselectNode()\n\t{\n\t\tif (this.#node)\n\t\t{\n\t\t\tDom.removeClass(this.#node, '--selected');\n\n\t\t\tconst checkboxNode = this.#node.querySelector('input');\n\t\t\tif (checkboxNode)\n\t\t\t{\n\t\t\t\tcheckboxNode.checked = false;\n\t\t\t}\n\n\t\t\tthis.emit('Robot:unselected');\n\t\t}\n\t}\n\n\tisSelected()\n\t{\n\t\treturn this.#node && Dom.hasClass(this.#node, '--selected');\n\t}\n\n\tisActivated(): boolean\n\t{\n\t\treturn Text.toBoolean(this.#data.Activated);\n\t}\n\n\tisInvalid(): boolean\n\t{\n\t\treturn this.#data.viewData?.isInvalid === true;\n\t}\n\n\tsetActivated(activated: boolean): this\n\t{\n\t\tthis.#data.Activated = Text.toBoolean(activated);\n\t\tthis.emit(this.#data.Activated === true ? 'Robot:onAfterActivated' : 'Robot:onAfterDeactivated');\n\n\t\treturn this;\n\t}\n\n\tenableManageMode(isActive: boolean)\n\t{\n\t\tthis.#viewMode = ViewMode.manage().setProperty('isActive', isActive);\n\n\t\tif (!isActive)\n\t\t{\n\t\t\tDom.addClass(this.#node, '--locked-node');\n\t\t}\n\n\t\tconst deleteButton = this.#node.querySelector('.bizproc-automation-robot-btn-delete');\n\t\tDom.hide(deleteButton);\n\n\t\tthis.#node.onclick = () => {\n\t\t\tif (!this.#viewMode.isManage() || !this.#viewMode.getProperty('isActive', false))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.isSelected())\n\t\t\t{\n\t\t\t\tthis.selectNode();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.unselectNode();\n\t\t\t}\n\t\t};\n\t}\n\n\tdisableManageMode()\n\t{\n\t\tthis.#viewMode = ViewMode.edit();\n\t\tthis.unselectNode();\n\t\tDom.removeClass(this.#node, '--locked-node');\n\n\t\tconst deleteButton = this.#node.querySelector('.bizproc-automation-robot-btn-delete');\n\t\tDom.show(deleteButton);\n\n\t\tthis.#node.onclick = undefined;\n\t}\n\n\tcreateNode(): HTMLElement\n\t{\n\t\tlet wrapperClass = 'bizproc-automation-robot-container-wrapper';\n\t\tlet containerClass = 'bizproc-automation-robot-container';\n\n\t\tif (this.#viewMode.isEdit() && this.canEdit() && this.#canEditRobot())\n\t\t{\n\t\t\twrapperClass += ' bizproc-automation-robot-container-wrapper-draggable';\n\t\t}\n\n\t\tif (this.isActivated() === false)\n\t\t{\n\t\t\tcontainerClass += ' --deactivated';\n\t\t\twrapperClass += ' --deactivated';\n\t\t}\n\n\t\tif (this.isInvalid())\n\t\t{\n\t\t\tcontainerClass += ' --invalid';\n\t\t\twrapperClass += ' --invalid';\n\t\t}\n\n\t\tif (this.draft)\n\t\t{\n\t\t\tcontainerClass += ' --draft';\n\t\t}\n\n\t\tconst targetLabel = Loc.getMessage('BIZPROC_AUTOMATION_CMP_TO');\n\t\tconst targetNode = Tag.render`\n\t\t\t<a\n\t\t\t\tclass=\"bizproc-automation-robot-settings-name ${(this.#viewMode.isView() ? '--mode-view' : '')}\"\n\t\t\t\ttitle=\"${Loc.getMessage('BIZPROC_AUTOMATION_CMP_AUTOMATICALLY')}\"\n\t\t\t>${Loc.getMessage('BIZPROC_AUTOMATION_CMP_AUTOMATICALLY')}</a>\n\t\t`;\n\n\t\tif (Type.isPlainObject(this.#data.viewData) && this.#data.viewData.responsibleLabel)\n\t\t{\n\t\t\tlet labelText = (\n\t\t\t\tthis.#data.viewData.responsibleLabel\n\t\t\t\t\t.replace('{=Document:ASSIGNED_BY_ID}', Loc.getMessage('BIZPROC_AUTOMATION_CMP_RESPONSIBLE'))\n\t\t\t\t\t.replace('author', Loc.getMessage('BIZPROC_AUTOMATION_CMP_RESPONSIBLE'))\n\t\t\t\t\t.replace(/\\{=Constant\\:Constant[0-9]+\\}/, Loc.getMessage('BIZPROC_AUTOMATION_ASK_CONSTANT'))\n\t\t\t\t\t.replace(/\\{\\{~&\\:Constant[0-9]+\\}\\}/, Loc.getMessage('BIZPROC_AUTOMATION_ASK_CONSTANT'))\n\t\t\t\t\t.replace(/\\{=Template\\:Parameter[0-9]+\\}/, Loc.getMessage('BIZPROC_AUTOMATION_ASK_PARAMETER'))\n\t\t\t\t\t.replace(/\\{\\{~&:\\:Parameter[0-9]+\\}\\}/, Loc.getMessage('BIZPROC_AUTOMATION_ASK_PARAMETER'))\n\t\t\t);\n\n\t\t\tif (labelText.indexOf('{=Document') >= 0)\n\t\t\t{\n\t\t\t\tthis.#document.getFields().forEach((field) => {\n\t\t\t\t\tlabelText = labelText.replace(field['SystemExpression'], field['Name']);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (labelText.indexOf('{=A') >= 0)\n\t\t\t{\n\t\t\t\tthis.#template.robots.forEach((robot) => {\n\t\t\t\t\trobot.getReturnFieldsDescription().forEach((field) => {\n\t\t\t\t\t\tif (field['Type'] === 'user')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabelText = labelText.replace(\n\t\t\t\t\t\t\t\tfield['SystemExpression'],\n\t\t\t\t\t\t\t\trobot.getTitle() + ': ' + field['Name'],\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (labelText.indexOf('{=GlobalVar:') >= 0 && Type.isArrayFilled(this.#template.globalVariables))\n\t\t\t{\n\t\t\t\tthis.#template.globalVariables.forEach((variable) => {\n\t\t\t\t\tlabelText = labelText.replace(variable.SystemExpression, variable.Name);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (labelText.indexOf('{=GlobalConst:') >= 0 && Type.isArrayFilled(this.#template.globalConstants))\n\t\t\t{\n\t\t\t\tthis.#template.globalConstants.forEach((constant) => {\n\t\t\t\t\tlabelText = labelText.replace(constant.SystemExpression, constant.Name);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttargetNode.textContent = labelText;\n\t\t\ttargetNode.setAttribute('title', labelText);\n\n\t\t\tif (this.#data.viewData.responsibleUrl)\n\t\t\t{\n\t\t\t\ttargetNode.href = this.#data.viewData.responsibleUrl;\n\t\t\t\tif (this.#isFrameMode)\n\t\t\t\t{\n\t\t\t\t\ttargetNode.setAttribute('target', '_blank');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.#viewMode.isEdit() && parseInt(this.#data.viewData.responsibleId) > 0)\n\t\t\t{\n\t\t\t\ttargetNode.setAttribute('bx-tooltip-user-id', this.#data.viewData.responsibleId);\n\t\t\t}\n\t\t}\n\n\t\tlet delayLabel = this.getDelayInterval().format(\n\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_AT_ONCE'),\n\t\t\tthis.#document.getFields(),\n\t\t);\n\n\t\tif (this.isExecuteAfterPrevious())\n\t\t{\n\t\t\tdelayLabel = (delayLabel === Loc.getMessage('BIZPROC_AUTOMATION_CMP_AT_ONCE')) ? '' : `${delayLabel}, `;\n\t\t\tdelayLabel += Loc.getMessage('BIZPROC_AUTOMATION_CMP_AFTER_PREVIOUS');\n\t\t}\n\n\t\tif (this.getCondition().items.length > 0)\n\t\t{\n\t\t\tdelayLabel += `, ${Loc.getMessage('BIZPROC_AUTOMATION_CMP_BY_CONDITION')}`;\n\t\t}\n\n\t\tconst delayNode = Dom.create(\n\t\t\t(this.#canEditRobot()) ? 'a' : 'span',\n\t\t\t{\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: this.#canEditRobot() ? 'bizproc-automation-robot-link' : 'bizproc-automation-robot-text',\n\t\t\t\t\ttitle: delayLabel,\n\t\t\t\t},\n\t\t\t\ttext: delayLabel,\n\t\t\t},\n\t\t);\n\n\t\tconst statusNode = Tag.render`<div class=\"bizproc-automation-robot-information\"></div>`;\n\t\tthis.subscribeOnce('Robot:destroyed', () => {\n\t\t\tif (HelpHint.isBindedToNode(statusNode))\n\t\t\t{\n\t\t\t\tHelpHint.hideHint();\n\t\t\t}\n\t\t});\n\n\t\tswitch (this.getLogStatus())\n\t\t{\n\t\t\tcase TrackingStatus.RUNNING:\n\t\t\t\tif (this.#document.getCurrentStatusId() === this.#template.getStatusId())\n\t\t\t\t{\n\t\t\t\t\tstatusNode.classList.add('--loader');\n\n\t\t\t\t\tconst delayNotes = this.getDelayNotes();\n\t\t\t\t\tif (delayNotes.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tstatusNode.setAttribute('data-text', delayNotes.join('\\n'));\n\t\t\t\t\t\tHelpHint.bindToNode(statusNode);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase TrackingStatus.COMPLETED:\n\t\t\tcase TrackingStatus.AUTOCOMPLETED:\n\t\t\t\tcontainerClass += ' --complete';\n\t\t\t\tstatusNode.classList.add('--complete');\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst errors = this.getLogErrors();\n\t\tif (errors.length > 0)\n\t\t{\n\t\t\tstatusNode.classList.add('--errors');\n\t\t\tstatusNode.setAttribute('data-text', errors.join('\\n'));\n\t\t\tHelpHint.bindToNode(statusNode);\n\t\t}\n\n\t\tlet titleClassName = 'bizproc-automation-robot-title-text';\n\t\tif (this.#canEditRobot() && this.canEdit())\n\t\t{\n\t\t\ttitleClassName += ' bizproc-automation-robot-title-text-editable';\n\t\t}\n\n\t\tconst { root: div, titleNode } = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"${containerClass}\"\n\t\t\t\tdata-role=\"robot-container\"\n\t\t\t\tdata-type=\"item-robot\"\n\t\t\t\tdata-id=\"${Text.encode(this.getId())}\"\n\t\t\t>\n\t\t\t\t${this.#renderCheckbox()}\n\t\t\t\t${this.#renderDeactivatedInfoBlock()}\n\t\t\t\t${this.#renderInvalidInfoBlock()}\n\t\t\t\t<div class=\"${wrapperClass}\">\n\t\t\t\t\t<div class=\"bizproc-automation-robot-deadline\">${delayNode}</div>\n\t\t\t\t\t<div class=\"bizproc-automation-robot-title\">\n\t\t\t\t\t\t<div ref=\"titleNode\" class=\"${titleClassName}\" title=\"${Text.encode(this.getTitle())}\">\n\t\t\t\t\t\t\t${this.clipTitle(this.getTitle())}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-automation-robot-settings\">\n\t\t\t\t\t\t<div class=\"bizproc-automation-robot-settings-title\">${targetLabel}:</div>\n\t\t\t\t\t\t${targetNode}\n\t\t\t\t\t</div>\n\t\t\t\t\t${statusNode}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(titleNode, 'click', (event) => {\n\t\t\tif (this.#canEditRobot() && this.canEdit() && !this.#viewMode.isManage())\n\t\t\t{\n\t\t\t\tthis.onTitleEditClick(event);\n\t\t\t}\n\t\t});\n\n\t\tif (this.canEdit() && this.#canEditRobot())\n\t\t{\n\t\t\tthis.registerItem(div);\n\t\t}\n\n\t\tif (this.#viewMode.isEdit())\n\t\t{\n\t\t\tconst deleteBtn = Tag.render`<span class=\"bizproc-automation-robot-btn-delete\"></span>`;\n\t\t\tEvent.bind(deleteBtn, 'click', this.onDeleteButtonClick.bind(this, deleteBtn));\n\t\t\tDom.append(deleteBtn, div.lastChild);\n\n\t\t\tif (this.isInvalid())\n\t\t\t{\n\t\t\t\tconst deleteBottomButton = Tag.render`\n\t\t\t\t\t<div class=\"bizproc-automation-robot-btn-settings\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_DELETE_BUTTON_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\tEvent.bind(deleteBottomButton, 'click', this.onDeleteButtonClick.bind(this, deleteBottomButton));\n\t\t\t\tDom.append(deleteBottomButton, div);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst actionsButton = Tag.render`\n\t\t\t\t\t<div class=\"bizproc-automation-robot-btn-copy\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_ACTIONS_BUTTON_TEXT')}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\tEvent.bind(actionsButton, 'click', this.#onActionsButtonClick.bind(this, actionsButton));\n\t\t\t\tDom.append(actionsButton, div);\n\n\t\t\t\tconst settingsBtn = Tag.render`\n\t\t\t\t\t<div class=\"bizproc-automation-robot-btn-settings\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_EDIT')}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\tEvent.bind(div, 'click', this.onSettingsButtonClick.bind(this, div));\n\t\t\t\tDom.append(settingsBtn, div);\n\t\t\t}\n\t\t}\n\n\t\treturn div;\n\t}\n\n\t#renderCheckbox(): string | HTMLElement\n\t{\n\t\tif (this.isInvalid())\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-ctl ui-ctl-inline bizproc-automation-robot-container-checkbox\">\n\t\t\t\t<input class=\"ui-ctl-checkbox\" type=\"checkbox\" name=\"name\"/>\n\t\t\t</div>\n\t\t`\n\t}\n\n\t#canEditRobot(): boolean\n\t{\n\t\treturn this.#viewMode.isEdit() && !this.isInvalid();\n\t}\n\n\t#renderDeactivatedInfoBlock()\n\t{\n\t\tif (this.#data.Activated === true)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-automation-robot-deactivated\">\n\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_DEACTIVATED_ROBOT_BLOCK_TITLE')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderInvalidInfoBlock()\n\t{\n\t\tif (!this.isInvalid())\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-automation-robot-invalid\">\n\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_INVALID_REST_ROBOT_BLOCK_TITLE')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tonDeleteButtonClick(button, event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tDom.remove(this.#node);\n\t\t\tthis.#template.deleteRobot(this);\n\t\t}\n\t}\n\n\tonSettingsButtonClick(button)\n\t{\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tthis.#template.openRobotSettingsDialog(this, this.#data.DialogContext ?? null);\n\t\t}\n\t}\n\n\t#onActionsButtonClick(button, event)\n\t{\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tevent.stopPropagation();\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#viewMode.isManage())\n\t\t{\n\t\t\tevent.stopPropagation();\n\t\t\tconst buttonText = (\n\t\t\t\tthis.#data.Activated\n\t\t\t\t\t? Loc.getMessage('BIZPROC_AUTOMATION_ACTIONS_DEACTIVATE_BUTTON_TEXT')\n\t\t\t\t\t: Loc.getMessage('BIZPROC_AUTOMATION_ACTIONS_ACTIVATE_BUTTON_TEXT')\n\t\t\t);\n\n\t\t\tconst menu = new Menu({\n\t\t\t\tbindElement: button,\n\t\t\t\twidth: 150,\n\t\t\t\theight: 90,\n\t\t\t\tautoHide: true,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: (Dom.getPosition(button).width / 2) + 23,\n\t\t\t\t},\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_ACTIONS_COPY_BUTTON_TEXT'),\n\t\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_ACTIONS_COPY_BUTTON_TEXT'),\n\t\t\t\t\t\tonclick: (e: PointerEvent, menuItem: MenuItem) => {\n\t\t\t\t\t\t\tthis.onCopyButtonClick(menuItem, e);\n\t\t\t\t\t\t\tmenu.destroy();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: buttonText,\n\t\t\t\t\t\ttitle: buttonText,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis.#onDeactivateButtonClick();\n\t\t\t\t\t\t\tmenu.destroy();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tmenu.show();\n\t\t}\n\t}\n\n\tonCopyButtonClick(button, event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\t\t}\n\t\telse if (!this.#viewMode.isManage())\n\t\t{\n\t\t\tconst copiedRobot = this.clone();\n\t\t\tconst robotTitle = copiedRobot.getProperty('Title');\n\t\t\tif (!Type.isNil(robotTitle))\n\t\t\t{\n\t\t\t\tconst newTitle = robotTitle + ' ' + ' ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_COPY_CAPTION');\n\t\t\t\tcopiedRobot.setProperty('Title', newTitle);\n\t\t\t\tcopiedRobot.reInit();\n\t\t\t}\n\n\t\t\tTemplate.copyRobotTo(this.#template, copiedRobot, this.#template.getNextRobot(this));\n\t\t}\n\t}\n\n\t#onDeactivateButtonClick()\n\t{\n\t\tthis.setActivated(!this.isActivated());\n\t\tthis.reInit();\n\t}\n\n\tonTitleEditClick(e)\n\t{\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tconst formName = 'bizproc_automation_robot_title_dialog';\n\n\t\tconst form = Dom.create('form', {\n\t\t\tprops: {\n\t\t\t\tname: formName\n\t\t\t},\n\t\t\tstyle: {\"min-width\": '540px'}\n\t\t});\n\n\t\tform.appendChild(Dom.create(\"span\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete\" },\n\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_ROBOT_NAME') + ':'\n\t\t}));\n\n\t\tform.appendChild(Dom.create(\"div\", {\n\t\t\tattrs: { className: \"bizproc-automation-popup-settings\" },\n\t\t\tchildren: [BX.create(\"input\", {\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bizproc-automation-popup-input',\n\t\t\t\t\ttype: \"text\",\n\t\t\t\t\tname: \"name\",\n\t\t\t\t\tvalue: this.getTitle()\n\t\t\t\t}\n\t\t\t})]\n\t\t}));\n\n\t\tthis.emit('Robot:title:editStart');\n\n\t\tconst self = this;\n\t\tconst popup = new BX.PopupWindow(Helper.generateUniqueId(), null, {\n\t\t\ttitleBar: Loc.getMessage('BIZPROC_AUTOMATION_CMP_ROBOT_NAME'),\n\t\t\tcontent: form,\n\t\t\tcloseIcon: true,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: true,\n\t\t\tdraggable: {restrict: false},\n\t\t\toverlay: false,\n\t\t\tevents: {\n\t\t\t\tonPopupClose(popup)\n\t\t\t\t{\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t\tself.emit('Robot:title:editCompleted');\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuttons: [\n\t\t\t\tnew BX.PopupWindowButton({\n\t\t\t\t\ttext : Loc.getMessage('JS_CORE_WINDOW_SAVE'),\n\t\t\t\t\tclassName : \"popup-window-button-accept\",\n\t\t\t\t\tevents : {\n\t\t\t\t\t\tclick()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst nameNode = form.elements.name;\n\t\t\t\t\t\t\tself.setProperty('Title', nameNode.value);\n\t\t\t\t\t\t\tself.reInit();\n\t\t\t\t\t\t\tself.#template.markModified();\n\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.PopupWindowButtonLink({\n\t\t\t\t\ttext : Loc.getMessage('JS_CORE_WINDOW_CANCEL'),\n\t\t\t\t\tclassName : \"popup-window-button-link-cancel\",\n\t\t\t\t\tevents : {\n\t\t\t\t\t\tclick()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.popupWindow.close()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tpopup.show();\n\t}\n\n\tonSearch(event)\n\t{\n\t\tif (!this.#node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst query = event.getData().queryString;\n\t\tconst match = !query || this.getTitle().toLowerCase().indexOf(query) >= 0;\n\n\t\tif (match)\n\t\t{\n\t\t\tDom.removeClass(this.#node, '--search-mismatch');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.#node, '--search-mismatch');\n\t\t}\n\t}\n\n\tclipTitle(fullTitle: string)\n\t{\n\t\tlet title = Text.encode(fullTitle);\n\t\tconst arrTitle = title.split(\" \");\n\t\tconst lastWord = \"<span>\" + arrTitle[arrTitle.length - 1] + \"</span>\";\n\n\t\tarrTitle.splice(arrTitle.length - 1);\n\n\t\ttitle = arrTitle.join(\" \") + \" \" + lastWord;\n\n\t\treturn title;\n\t}\n\n\tupdateData(data)\n\t{\n\t\tif (Type.isPlainObject(data))\n\t\t{\n\t\t\tthis.#data = data;\n\t\t\tthis.#data.Activated = !Type.isNil(this.#data.Activated) ? Text.toBoolean(this.#data.Activated) : true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow 'Invalid data';\n\t\t}\n\t}\n\n\tserialize()\n\t{\n\t\tconst result = BX.clone(this.#data);\n\t\tdelete result['viewData'];\n\t\tdelete result['DialogContext'];\n\t\tresult.Delay = this.#delay.serialize();\n\t\tresult.Condition = this.#condition.serialize();\n\t\tresult.Activated = result.Activated ? 'Y' : 'N';\n\n\t\treturn result;\n\t}\n\n\tgetDelayInterval(): DelayInterval\n\t{\n\t\treturn this.#delay;\n\t}\n\n\tsetDelayInterval(delay): Robot\n\t{\n\t\tthis.#delay = delay;\n\n\t\treturn this;\n\t}\n\n\tgetCondition(): ConditionGroup\n\t{\n\t\treturn this.#condition;\n\t}\n\n\tsetCondition(condition)\n\t{\n\t\tthis.#condition = condition;\n\n\t\treturn this;\n\t}\n\n\tsetExecuteAfterPrevious(flag)\n\t{\n\t\tthis.#data.ExecuteAfterPrevious = flag ? 1 : 0;\n\n\t\treturn this;\n\t}\n\n\tisExecuteAfterPrevious()\n\t{\n\t\treturn (this.#data.ExecuteAfterPrevious === 1 || this.#data.ExecuteAfterPrevious === '1')\n\t}\n\n\tregisterItem(object)\n\t{\n\t\tif (Type.isNil(object[\"__bxddid\"]))\n\t\t{\n\t\t\tobject.onbxdragstart = BX.proxy(this.dragStart, this);\n\t\t\tobject.onbxdrag = BX.proxy(this.dragMove, this);\n\t\t\tobject.onbxdragstop = BX.proxy(this.dragStop, this);\n\t\t\tobject.onbxdraghover = BX.proxy(this.dragOver, this);\n\t\t\tjsDD.registerObject(object);\n\t\t\tjsDD.registerDest(object, 1);\n\t\t}\n\t}\n\n\tunregisterItem(object)\n\t{\n\t\tobject.onbxdragstart = undefined;\n\t\tobject.onbxdrag = undefined;\n\t\tobject.onbxdragstop = undefined;\n\t\tobject.onbxdraghover = undefined;\n\t\tjsDD.unregisterObject(object);\n\t\tjsDD.unregisterDest(object);\n\t}\n\n\tdragStart()\n\t{\n\t\tthis.draggableItem = BX.proxy_context;\n\n\t\tif (!this.draggableItem)\n\t\t{\n\t\t\tjsDD.stopCurrentDrag();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.stub)\n\t\t{\n\t\t\tconst itemWidth = this.draggableItem.offsetWidth;\n\t\t\tthis.stub = this.draggableItem.cloneNode(true);\n\t\t\tthis.stub.style.position = \"absolute\";\n\t\t\tthis.stub.classList.add(\"bizproc-automation-robot-container-drag\");\n\t\t\tthis.stub.style.width = itemWidth + \"px\";\n\t\t\tdocument.body.appendChild(this.stub);\n\t\t}\n\t}\n\n\tdragMove(x,y)\n\t{\n\t\tthis.stub.style.left = x + \"px\";\n\t\tthis.stub.style.top = y + \"px\";\n\t}\n\n\tdragOver(destination, x, y)\n\t{\n\t\tif (this.droppableItem)\n\t\t{\n\t\t\tthis.droppableItem.classList.remove(\"bizproc-automation-robot-container-pre\");\n\t\t}\n\n\t\tif (this.droppableColumn)\n\t\t{\n\t\t\tthis.droppableColumn.classList.remove(\"bizproc-automation-robot-list-pre\");\n\t\t}\n\n\t\tconst type = destination.getAttribute(\"data-type\");\n\n\t\tif (type === \"item-robot\")\n\t\t{\n\t\t\tthis.droppableItem = destination;\n\t\t\tthis.droppableColumn = null;\n\t\t}\n\n\t\tif (type === \"column-robot\")\n\t\t{\n\t\t\tthis.droppableColumn = destination.querySelector('[data-role=\"robot-list\"]');\n\t\t\tthis.droppableItem = null;\n\t\t}\n\n\t\tif (this.droppableItem)\n\t\t{\n\t\t\tthis.droppableItem.classList.add(\"bizproc-automation-robot-container-pre\");\n\t\t}\n\n\t\tif (this.droppableColumn)\n\t\t{\n\t\t\tthis.droppableColumn.classList.add(\"bizproc-automation-robot-list-pre\");\n\t\t}\n\t}\n\n\tdragStop(x, y, event)\n\t{\n\t\tevent = event || window.event;\n\t\tconst isCopy = event && (event.ctrlKey || event.metaKey);\n\n\t\tif (this.draggableItem)\n\t\t{\n\t\t\tif (this.droppableItem)\n\t\t\t{\n\t\t\t\tthis.droppableItem.classList.remove(\"bizproc-automation-robot-container-pre\");\n\t\t\t\tthis.emit('Robot:manage', {\n\t\t\t\t\ttemplateNode: this.droppableItem.parentNode,\n\t\t\t\t\tisCopy,\n\t\t\t\t\tdroppableItem: this.droppableItem,\n\t\t\t\t\trobot: this,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (this.droppableColumn)\n\t\t\t{\n\t\t\t\tthis.droppableColumn.classList.remove(\"bizproc-automation-robot-list-pre\");\n\t\t\t\tthis.emit('Robot:manage', {\n\t\t\t\t\ttemplateNode: this.droppableColumn,\n\t\t\t\t\tisCopy,\n\t\t\t\t\trobot: this,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.stub.parentNode.removeChild(this.stub);\n\t\tthis.stub = null;\n\t\tthis.draggableItem = null;\n\t\tthis.droppableItem = null;\n\t}\n\n\tmoveTo(template, beforeRobot)\n\t{\n\t\tDom.remove(this.#node);\n\t\tthis.#template.deleteRobot(this);\n\t\tthis.#template = template;\n\n\t\tthis.#template.insertRobot(this, beforeRobot);\n\t\tthis.#node = this.createNode();\n\t\tthis.#template.insertRobotNode(this.#node, beforeRobot ? beforeRobot.node : null);\n\t}\n\n\tcopyTo(template, beforeRobot)\n\t{\n\t\tconst robot = new Robot({\n\t\t\tdocument: this.#document,\n\t\t\ttemplate,\n\t\t\tisFrameMode: this.#isFrameMode,\n\t\t\ttracker: this.#tracker,\n\t\t});\n\n\t\tconst robotData = this.serialize();\n\t\tdelete robotData['Name'];\n\t\tdelete robotData['DelayName'];\n\n\t\trobot.init(robotData, this.#viewMode);\n\n\t\ttemplate.insertRobot(robot, beforeRobot);\n\t\ttemplate.insertRobotNode(robot.node, beforeRobot ? beforeRobot.node : null);\n\n\t\treturn robot;\n\t}\n\n\tgetTitle()\n\t{\n\t\treturn this.getProperty('Title') || this.getDescriptionTitle();\n\t}\n\n\tgetDescriptionTitle()\n\t{\n\t\tlet name = 'untitled';\n\t\tconst description = this.template?.getRobotDescription(this.#data['Type']) ?? {};\n\t\tif (description['NAME'])\n\t\t{\n\t\t\tname = description['NAME'];\n\t\t}\n\t\tif (description['ROBOT_SETTINGS'] && description['ROBOT_SETTINGS']['TITLE'])\n\t\t{\n\t\t\tname = description['ROBOT_SETTINGS']['TITLE'];\n\t\t}\n\n\t\treturn name;\n\t}\n\n\thasTitle(): boolean\n\t{\n\t\treturn this.getTitle() !== 'untitled';\n\t}\n\n\thasReturnFields(): boolean\n\t{\n\t\tconst description = this.template.getRobotDescription(this.#data['Type']);\n\t\tconst props = this.#data['Properties'];\n\n\t\tif (!Type.isObject(description))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst hasReturnProperties = () => (\n\t\t\tType.isObject(description['RETURN'])\n\t\t\t&& Type.isArrayFilled(Object.values(description['RETURN']))\n\t\t);\n\n\t\tconst hasAdditionalResultProperties = () => (\n\t\t\tType.isArray(description['ADDITIONAL_RESULT'])\n\t\t\t&& description['ADDITIONAL_RESULT'].some(addProperty => Object.values(props[addProperty] ?? []).length > 0)\n\t\t);\n\n\t\treturn hasReturnProperties() || hasAdditionalResultProperties();\n\t}\n\n\tgetReturnFieldsDescription()\n\t{\n\t\tconst fields = [];\n\t\tconst description = this.template.getRobotDescription(this.#data['Type']);\n\n\t\tif (description && description['RETURN'])\n\t\t{\n\t\t\tfor (const fieldId in description['RETURN'])\n\t\t\t{\n\t\t\t\tif (description['RETURN'].hasOwnProperty(fieldId))\n\t\t\t\t{\n\t\t\t\t\tconst field = description['RETURN'][fieldId];\n\t\t\t\t\tfields.push({\n\t\t\t\t\t\tId: fieldId,\n\t\t\t\t\t\tObjectId: this.getId(),\n\t\t\t\t\t\tObjectName: this.getTitle(),\n\t\t\t\t\t\tName: field['NAME'],\n\t\t\t\t\t\tType: field['TYPE'],\n\t\t\t\t\t\tOptions: field['OPTIONS'] || null,\n\t\t\t\t\t\tExpression: '{{~'+this.getId()+':'+fieldId+' # '+this.getTitle()+': '+field['NAME']+'}}',\n\t\t\t\t\t\tSystemExpression: '{='+this.getId()+':'+fieldId+'}'\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!this.appendPropertyMods)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t//generate printable version\n\t\t\t\t\tif (\n\t\t\t\t\t\tfield['TYPE'] === 'user'\n\t\t\t\t\t\t||\n\t\t\t\t\t\tfield['TYPE'] === 'bool'\n\t\t\t\t\t\t||\n\t\t\t\t\t\tfield['TYPE'] === 'file'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst printableTag = (field['TYPE'] === 'user') ? 'friendly' : 'printable';\n\t\t\t\t\t\tfields.push({\n\t\t\t\t\t\t\tId: fieldId + '_printable',\n\t\t\t\t\t\t\tObjectId: this.getId(),\n\t\t\t\t\t\t\tName: field['NAME'] + ' ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX'),\n\t\t\t\t\t\t\tType: 'string',\n\t\t\t\t\t\t\tExpression: `{{~${this.getId()}:${fieldId} > ${printableTag} # ${this.getTitle()}: ${field['NAME']}}}`,\n\t\t\t\t\t\t\tSystemExpression: `{=${this.getId()}:${fieldId}>${printableTag}}`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (description && Type.isArray(description['ADDITIONAL_RESULT']))\n\t\t{\n\t\t\tconst props = this.#data['Properties'];\n\n\t\t\tdescription['ADDITIONAL_RESULT'].forEach((addProperty) => {\n\t\t\t\tif (props[addProperty])\n\t\t\t\t{\n\t\t\t\t\tfor (const fieldId in props[addProperty])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (props[addProperty].hasOwnProperty(fieldId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst field = props[addProperty][fieldId];\n\t\t\t\t\t\t\tfields.push({\n\t\t\t\t\t\t\t\tId: fieldId,\n\t\t\t\t\t\t\t\tObjectId: this.getId(),\n\t\t\t\t\t\t\t\tName: field['Name'],\n\t\t\t\t\t\t\t\tType: field['Type'],\n\t\t\t\t\t\t\t\tOptions: field['Options'] || null,\n\t\t\t\t\t\t\t\tExpression: `{{~${this.getId()}:${fieldId} # ${this.getTitle()}: ${field['Name']}}}`,\n\t\t\t\t\t\t\t\tSystemExpression: '{=' + this.getId() + ':' + fieldId + '}',\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t//generate printable version\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tfield['Type'] === 'user'\n\t\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t\tfield['Type'] === 'bool'\n\t\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t\tfield['Type'] === 'file'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst printableTag = (field['Type'] === 'user') ? 'friendly' : 'printable';\n\t\t\t\t\t\t\t\tconst expression = `{{~${this.getId()}:${fieldId} > ${printableTag} # ${this.getTitle()}: ${field['Name']}}}`;\n\t\t\t\t\t\t\t\tfields.push({\n\t\t\t\t\t\t\t\t\tId: fieldId + '_printable',\n\t\t\t\t\t\t\t\t\tObjectId: this.getId(),\n\t\t\t\t\t\t\t\t\tName: field['Name'] + ' ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX'),\n\t\t\t\t\t\t\t\t\tType: 'string',\n\t\t\t\t\t\t\t\t\tExpression: expression,\n\t\t\t\t\t\t\t\t\tSystemExpression: '{=' + this.getId() + ':' + fieldId + '>' + printableTag + '}',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tgetReturnProperty(id): Array<Object>\n\t{\n\t\tconst fields = this.getReturnFieldsDescription();\n\t\tfor (let i = 0; i < fields.length; ++i)\n\t\t{\n\t\t\tif (fields[i]['Id'] === id)\n\t\t\t{\n\t\t\t\treturn fields[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tcollectUsages()\n\t{\n\t\tconst properties = this.getProperties();\n\t\tconst usages = {\n\t\t\tDocument: new Set(),\n\t\t\tConstant: new Set(),\n\t\t\tVariable: new Set(),\n\t\t\tParameter: new Set(),\n\t\t\tGlobalConstant: new Set(),\n\t\t\tGlobalVariable: new Set(),\n\t\t\tActivity: new Set()\n\t\t};\n\n\t\tObject.values(properties).forEach(property => this.collectExpressions(property, usages));\n\n\t\tconst conditions = this.getCondition().serialize();\n\t\tconditions.items.forEach(item => this.collectParsedExpressions(item[0], usages));\n\n\t\treturn usages;\n\t}\n\n\tcollectExpressions(value, usages)\n\t{\n\t\tif (Type.isArray(value))\n\t\t{\n\t\t\tvalue.forEach(v => this.collectExpressions(v, usages));\n\t\t}\n\t\telse if (Type.isPlainObject(value))\n\t\t{\n\t\t\tObject.values(value).forEach(value => this.collectExpressions(value, usages));\n\t\t}\n\t\telse if (Type.isStringFilled(value))\n\t\t{\n\t\t\tlet found;\n\t\t\tconst systemExpressionRegExp = new RegExp(this.SYSTEM_EXPRESSION_PATTERN, 'ig');\n\t\t\twhile ((found = systemExpressionRegExp.exec(value)) !== null)\n\t\t\t{\n\t\t\t\tthis.collectParsedExpressions(found.groups, usages);\n\t\t\t}\n\t\t}\n\t}\n\n\tcollectParsedExpressions(parsedUsage, usages)\n\t{\n\t\tif (Type.isPlainObject(parsedUsage) && parsedUsage['object'] && parsedUsage['field'])\n\t\t{\n\t\t\tswitch (parsedUsage['object'])\n\t\t\t{\n\t\t\t\tcase 'Document':\n\t\t\t\t\tusages.Document.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'Constant':\n\t\t\t\t\tusages.Constant.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'Variable':\n\t\t\t\t\tusages.Variable.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'Template':\n\t\t\t\t\tusages.Parameter.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'GlobalConst':\n\t\t\t\t\tusages.GlobalConstant.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'GlobalVar':\n\t\t\t\t\tusages.GlobalVariable.add(parsedUsage['field']);\n\t\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst activityRegExp = new RegExp(/^A[_0-9]+$/, 'ig');\n\t\t\tif (activityRegExp.exec(parsedUsage['object']))\n\t\t\t{\n\t\t\t\tusages.Activity.add([parsedUsage['object'], parsedUsage['field']]);\n\t\t\t}\n\t\t}\n\t}\n\n\thasBrokenLink(): boolean\n\t{\n\t\treturn this.getBrokenLinks().length > 0;\n\t}\n\n\tgetBrokenLinks(): []\n\t{\n\t\tconst usages = Runtime.clone(this.collectUsages());\n\n\t\tif (!this.template)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst objectsData = {\n\t\t\tDocument: this.#document.getFields(),\n\t\t\tConstant: this.#template.getConstants(),\n\t\t\tVariable: this.#template.getVariables(),\n\t\t\tGlobalConstant: this.#template.globalConstants,\n\t\t\tGlobalVariable: this.#template.globalVariables,\n\t\t\tParameter: this.#template.getParameters(),\n\t\t\tActivity: this.#template.getSerializedRobots()\n\t\t};\n\n\t\tconst brokenLinks = [];\n\t\tfor (const object in usages)\n\t\t{\n\t\t\tif (usages[object].size > 0)\n\t\t\t{\n\t\t\t\tconst source = new Set();\n\n\t\t\t\tfor (const key in objectsData[object])\n\t\t\t\t{\n\t\t\t\t\tif (objectsData[object][key]['Id'])\n\t\t\t\t\t{\n\t\t\t\t\t\tsource.add(objectsData[object][key]['Id']);\n\t\t\t\t\t}\n\t\t\t\t\telse if (objectsData[object][key]['Name'])\n\t\t\t\t\t{\n\t\t\t\t\t\tsource.add(objectsData[object][key]['Name']);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (const value of usages[object].values())\n\t\t\t\t{\n\t\t\t\t\tlet searchInSource = value;\n\t\t\t\t\tlet id = value;\n\n\t\t\t\t\tif (Type.isArray(searchInSource))\n\t\t\t\t\t{\n\t\t\t\t\t\tsearchInSource = value[0];\n\t\t\t\t\t\tid = value[1];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!source.has(searchInSource))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (object === 'Activity')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbrokenLinks.push('{=' + searchInSource + ':' + id + '}');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet brokenLinkObject = object;\n\n\t\t\t\t\t\t\tif (brokenLinkObject === 'GlobalVariable')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbrokenLinkObject = 'GlobalVar';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (brokenLinkObject === 'GlobalConstant')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbrokenLinkObject = 'GlobalConst';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (brokenLinkObject === 'Parameter')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbrokenLinkObject = 'Template';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbrokenLinks.push('{=' + brokenLinkObject + ':' + searchInSource + '}');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (object === 'Activity')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst robot = this.#template.getRobotById(searchInSource);\n\t\t\t\t\t\tif (!robot.getReturnProperty(id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbrokenLinks.push('{=' + searchInSource + ':' + id + '}');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn brokenLinks;\n\t}\n}\n","import { Type, Runtime } from 'main.core';\n\nexport class UserOptions\n{\n\t#options: Object<string, any>;\n\n\tconstructor(options: Object<string, any>)\n\t{\n\t\tthis.#options = options;\n\t}\n\n\tclone(): this\n\t{\n\t\treturn new UserOptions(Runtime.clone(this.#options));\n\t}\n\n\tset(category: string, key: string, value: any): UserOptions\n\t{\n\t\tif (!Type.isPlainObject(this.#options[category]))\n\t\t{\n\t\t\tthis.#options[category] = {};\n\t\t}\n\t\tconst storedValue = this.#options[category][key];\n\n\t\tif (storedValue !== value)\n\t\t{\n\t\t\tBX.userOptions.save(\n\t\t\t\t'bizproc.automation',\n\t\t\t\tcategory,\n\t\t\t\tkey,\n\t\t\t\tvalue,\n\t\t\t\tfalse,\n\t\t\t);\n\n\t\t\tthis.#options[category][key] = value;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tget(category: string, key: string, defaultValue: any): any\n\t{\n\t\tlet result = defaultValue;\n\t\tif (this.has(category, key))\n\t\t{\n\t\t\tresult = this.#options[category][key];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\thas(category: string, key: string): boolean\n\t{\n\t\treturn Type.isPlainObject(this.#options[category]) && Object.keys(this.#options[category]).includes(key);\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text, Type } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Helper } from 'bizproc.automation';\nimport { Button } from 'ui.buttons';\n\nconst renderAfterPreviousImageBlock = () => {\n\treturn Tag.render`\n\t\t<svg \n\t\t\tclass=\"bizproc-automation_execution-queue_in-turn\"\n\t\t\twidth=\"97\"\n\t\t\theight=\"121\"\n\t\t\tviewBox=\"0 0 97 121\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\txmlns:xlink=\"http://www.w3.org/1999/xlink\"\n\t\t>\n\t\t\t<rect width=\"97\" height=\"121\" fill=\"url(#pattern0)\"/>\n\t\t\t<path\n\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\td=\"M12.25 27C11.5596 27 11 26.4404 11 25.75V18.25C11 17.5596 11.5596 17 12.25 17H15.6875H16H79.75H81.3125H82.7275C83.2009 17 83.6338 17.2675 83.8455 17.691L86 22L83.8455 26.309C83.6338 26.7325 83.2009 27 82.7275 27H81.3125H79.75H16H15.6875H12.25Z\"\n\t\t\t\tfill=\"#DFE0E3\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\td=\"M12.25 27C11.5596 27 11 26.4404 11 25.75V18.25C11 17.5596 11.5596 17 12.25 17H15.6875H16H79.75H81.3125H82.7275C83.2009 17 83.6338 17.2675 83.8455 17.691L86 22L83.8455 26.309C83.6338 26.7325 83.2009 27 82.7275 27H81.3125H79.75H16H15.6875H12.25Z\"\n\t\t\t\tfill=\"#55D0E0\"\n\t\t\t/>\n\t\t\t<g filter=\"url(#filter0_d_272_90944)\" class=\"bizproc-automation_execution-queue_transform-element --one\">\n\t\t\t\t<rect\n\t\t\t\t\tx=\"11\"\n\t\t\t\t\ty=\"32\"\n\t\t\t\t\twidth=\"75\"\n\t\t\t\t\theight=\"34\"\n\t\t\t\t\trx=\"4\"\n\t\t\t\t\tfill=\"white\"\n\t\t\t\t\tfill-opacity=\"0.9\"\n\t\t\t\t\tshape-rendering=\"crispEdges\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td=\"M11 56H86V62C86 64.2091 84.2091 66 82 66H15C12.7909 66 11 64.2091 11 62V56Z\"\n\t\t\t\t\tfill=\"#C5F8FF\"\n\t\t\t\t/>\n\t\t\t\t<rect x=\"22\" y=\"37\" width=\"21\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"15\" y=\"45\" width=\"54\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"72\" y=\"45\" width=\"8\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"55\" y=\"59\" width=\"28\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<g class=\"bizproc-automation_execution-queue_checked --one\">\n\t\t\t\t\t<circle cx=\"15\" cy=\"38\" r=\"8\" fill=\"#739F00\"/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M11.7084 37.089L15.4796 40.8602L13.9711 42.3687L10.1999 38.5975L11.7084 37.089Z\"\n\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M20.0051 36.3347L13.9711 42.3687L12.4627 40.8602L18.4966 34.8262L20.0051 36.3347Z\"\n\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t\t<g filter=\"url(#filter1_d_272_90944)\" class=\"bizproc-automation_execution-queue_transform-element --two\">\n\t\t\t\t<rect\n\t\t\t\t\tx=\"11\"\n\t\t\t\t\ty=\"71\"\n\t\t\t\t\twidth=\"75\"\n\t\t\t\t\theight=\"34\"\n\t\t\t\t\trx=\"4\"\n\t\t\t\t\tfill=\"white\"\n\t\t\t\t\tfill-opacity=\"0.9\"\n\t\t\t\t\tshape-rendering=\"crispEdges\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td=\"M11 95H86V101C86 103.209 84.2091 105 82 105H15C12.7909 105 11 103.209 11 101V95Z\"\n\t\t\t\t\tfill=\"#C5F8FF\"\n\t\t\t\t/>\n\t\t\t\t<rect x=\"15\" y=\"84\" width=\"54\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"72\" y=\"84\" width=\"8\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"55\" y=\"98\" width=\"28\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"22\" y=\"76\" width=\"21\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<g class=\"bizproc-automation_execution-queue_checked --two\">\n\t\t\t\t\t<circle cx=\"15\" cy=\"77\" r=\"8\" fill=\"#739F00\"/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M11.7084 76.089L15.4796 79.8602L13.9711 81.3687L10.1999 77.5975L11.7084 76.089Z\"\n\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M20.0051 75.3347L13.9711 81.3687L12.4627 79.8602L18.4966 73.8262L20.0051 75.3347Z\"\n\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t</svg>\n\t`;\n};\n\nconst renderParallelImageBlock = () => {\n\treturn Tag.render`\n\t\t<svg\n\t\t\tclass=\"bizproc-automation_execution-queue_simultaneously\"\n\t\t\twidth=\"97\"\n\t\t\theight=\"121\"\n\t\t\tviewBox=\"0 0 97 121\"\n\t\t\tfill=\"none\"\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\txmlns:xlink=\"http://www.w3.org/1999/xlink\"\n\t\t>\n\t\t\t<rect width=\"97\" height=\"121\" fill=\"url(#pattern0)\"/>\n\t\t\t<path\n\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\td=\"M12.25 27C11.5596 27 11 26.4404 11 25.75V18.25C11 17.5596 11.5596 17 12.25 17H15.6875H16H79.75H81.3125H82.7275C83.2009 17 83.6338 17.2675 83.8455 17.691L86 22L83.8455 26.309C83.6338 26.7325 83.2009 27 82.7275 27H81.3125H79.75H16H15.6875H12.25Z\"\n\t\t\t\tfill=\"#DFE0E3\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\td=\"M12.25 27C11.5596 27 11 26.4404 11 25.75V18.25C11 17.5596 11.5596 17 12.25 17H15.6875H16H79.75H81.3125H82.7275C83.2009 17 83.6338 17.2675 83.8455 17.691L86 22L83.8455 26.309C83.6338 26.7325 83.2009 27 82.7275 27H81.3125H79.75H16H15.6875H12.25Z\"\n\t\t\t\tfill=\"#55D0E0\"\n\t\t\t/>\n\t\t\t<g\n\t\t\t\tfilter=\"url(#filter0_d_272_90944)\"\n\t\t\t\tclass=\"bizproc-automation_execution-queue_transform-element\"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tx=\"11\"\n\t\t\t\t\ty=\"32\"\n\t\t\t\t\twidth=\"75\"\n\t\t\t\t\theight=\"34\"\n\t\t\t\t\trx=\"4\"\n\t\t\t\t\tfill=\"white\"\n\t\t\t\t\tfill-opacity=\"0.9\"\n\t\t\t\t\tshape-rendering=\"crispEdges\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td=\"M11 56H86V62C86 64.2091 84.2091 66 82 66H15C12.7909 66 11 64.2091 11 62V56Z\"\n\t\t\t\t\tfill=\"#C5F8FF\"\n\t\t\t\t/>\n\t\t\t\t<rect x=\"22\" y=\"37\" width=\"21\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"15\" y=\"45\" width=\"54\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"72\" y=\"45\" width=\"8\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"55\" y=\"59\" width=\"28\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<g class=\"bizproc-automation_execution-queue_checked\">\n\t\t\t\t\t<circle cx=\"15\" cy=\"38\" r=\"8\" fill=\"#739F00\"/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M11.7084 37.089L15.4796 40.8602L13.9711 42.3687L10.1999 38.5975L11.7084 37.089Z\"\n\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M20.0051 36.3347L13.9711 42.3687L12.4627 40.8602L18.4966 34.8262L20.0051 36.3347Z\"\n\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t\t<g\n\t\t\t\tfilter=\"url(#filter1_d_272_90944)\"\n\t\t\t\tclass=\"bizproc-automation_execution-queue_transform-element\"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tx=\"11\"\n\t\t\t\t\ty=\"71\"\n\t\t\t\t\twidth=\"75\"\n\t\t\t\t\theight=\"34\"\n\t\t\t\t\trx=\"4\"\n\t\t\t\t\tfill=\"white\"\n\t\t\t\t\tfill-opacity=\"0.9\"\n\t\t\t\t\tshape-rendering=\"crispEdges\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td=\"M11 95H86V101C86 103.209 84.2091 105 82 105H15C12.7909 105 11 103.209 11 101V95Z\"\n\t\t\t\t\tfill=\"#C5F8FF\"\n\t\t\t\t/>\n\t\t\t\t<rect x=\"15\" y=\"84\" width=\"54\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"72\" y=\"84\" width=\"8\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"55\" y=\"98\" width=\"28\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<rect x=\"22\" y=\"76\" width=\"21\" height=\"4\" rx=\"2\" fill=\"#999999\" fill-opacity=\"0.33\"/>\n\t\t\t\t<g class=\"bizproc-automation_execution-queue_checked\">\n\t\t\t\t\t<circle cx=\"15\" cy=\"77\" r=\"8\" fill=\"#739F00\"/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M11.7084 76.089L15.4796 79.8602L13.9711 81.3687L10.1999 77.5975L11.7084 76.089Z\"\n\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M20.0051 75.3347L13.9711 81.3687L12.4627 79.8602L18.4966 73.8262L20.0051 75.3347Z\"\n\t\t\t\t\t\tfill=\"white\"\n\t\t\t\t\t/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t</svg>\n\t`;\n};\n\nconst renderRow = (\n\tisActive: boolean,\n\tuid: string,\n\tcontent: {\n\t\ttitle: string,\n\t\tdescription: string,\n\t\timageRenderFunction: () => Element,\n\t\tvalue: string,\n\t},\n) => {\n\tconst { root, radio } = Tag.render`\n\t\t<label\n\t\t\tclass=\"bizproc-automation-popup-select__wrapper-flex ${isActive ? '--active' : ''} ui-ctl ui-ctl-radio ui-ctl-w100\"\n\t\t\tfor=\"${uid}\"\n\t\t\tdata-role=\"execution-queue-row\"\n\t\t>\n\t\t\t<div class=\"bizproc-automation-popup-select__wrapper-info-block\">\n\t\t\t\t<div class=\"bizproc-automation-popup-select__header-input\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref=\"radio\"\n\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\tid=\"${uid}\"\n\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\tvalue=\"${Text.encode(content.value)}\"\n\t\t\t\t\t\tname=\"execution\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"bizproc-automation-popup-settings__input-title\">${Text.encode(content.title)}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bizproc-automation-popup-settings__description\">${Text.encode(content.description)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"bizproc-automation-popup-settings__image-block\">\n\t\t\t\t${content.imageRenderFunction()}\n\t\t\t</div>\n\t\t</label>\n\t`;\n\tEvent.bind(radio, 'change', () => {\n\t\tdocument.querySelectorAll('[data-role=\"execution-queue-row\"]').forEach((node) => {\n\t\t\tDom.removeClass(node, '--active');\n\t\t});\n\t\tDom.addClass(root, '--active');\n\t});\n\n\tif (isActive)\n\t{\n\t\tDom.attr(radio, 'checked', 'checked');\n\t}\n\n\treturn root;\n};\n\ntype ExecutionQueuePopupSettings = {\n\tbindElement: HTMLElement,\n\tcurrentValue: '1' | '0',\n\tonSubmitButtonClick?: (form: FormData) => void,\n};\n\nconst showExecutionQueuePopup = (\n\tsettings: ExecutionQueuePopupSettings,\n) => {\n\tconst afterPreviousContent = {\n\t\ttitle: Loc.getMessage('BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_AFTER_PREVIOUS_TITLE'),\n\t\tdescription: Loc.getMessage('BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_AFTER_PREVIOUS_DESCRIPTION'),\n\t\timageRenderFunction: renderAfterPreviousImageBlock,\n\t\tvalue: 'afterPrevious',\n\t};\n\tconst parallelContent = {\n\t\ttitle: Loc.getMessage('BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_PARALLEL_TITLE'),\n\t\tdescription: Loc.getMessage('BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_PARALLEL_DESCRIPTION'),\n\t\timageRenderFunction: renderParallelImageBlock,\n\t\tvalue: 'parallel',\n\t};\n\n\tconst content = Tag.render`\n\t\t<form class=\"bizproc-automation-popup-select-block\">\n\t\t\t<div class=\"bizproc-automation-popup-select-item\">\n\t\t\t\t${renderRow(settings.currentValue === '1', 'bizproc-automation-cmp1', afterPreviousContent)}\n\t\t\t</div>\n\t\t\t<div class=\"bizproc-automation-popup-select-item\">\n\t\t\t\t${renderRow(settings.currentValue !== '1', 'bizproc-automation-cmp2', parallelContent)}\n\t\t\t</div>\n\t\t</form>\n\t`;\n\n\tconst popup = new Popup({\n\t\tid: Helper.generateUniqueId(),\n\t\tbindElement: settings.bindElement,\n\t\tcontent,\n\t\tcloseByEsc: true,\n\t\tbuttons: [\n\t\t\tnew Button({\n\t\t\t\tcolor: Button.Color.PRIMARY,\n\t\t\t\ttext: Loc.getMessage('BIZPROC_JS_AUTOMATION_CHOOSE_BUTTON_CAPS'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tif (Type.isFunction(settings.onSubmitButtonClick))\n\t\t\t\t\t{\n\t\t\t\t\t\tsettings.onSubmitButtonClick(new FormData(content));\n\t\t\t\t\t}\n\n\t\t\t\t\tpopup.close();\n\t\t\t\t},\n\t\t\t}),\n\t\t\tnew Button({\n\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\ttext: Loc.getMessage('BIZPROC_JS_AUTOMATION_CANCEL_BUTTON_CAPS'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tpopup.close();\n\t\t\t\t},\n\t\t\t}),\n\t\t],\n\t\twidth: 482,\n\t\tpadding: 20,\n\t\tcloseIcon: false,\n\t\tautoHide: true,\n\t\ttitleBar: false,\n\t\tangle: {\n\t\t\toffset: (settings.bindElement.clientWidth + 33) / 2,\n\t\t},\n\t\toverlay: { backgroundColor: 'transparent' },\n\t\tevents: {\n\t\t\tonClose: () => {\n\t\t\t\tpopup.destroy();\n\t\t\t},\n\t\t},\n\t});\n\n\tpopup.show();\n};\n\nexport default showExecutionQueuePopup;\n","import { Type, Dom, Loc, Event, Runtime, Uri, Text, Tag, ajax } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport {\n\tContext,\n\tSelectorContext,\n\tgetGlobalContext,\n\tTracker,\n\tDesigner,\n\tConditionGroupSelector,\n\tConditionGroup,\n\tDelayIntervalSelector,\n\tSelectorManager,\n} from 'bizproc.automation';\nimport { SaveButton, BaseButton, CancelButton } from 'ui.buttons';\nimport { Robot } from './robot';\nimport { UserOptions } from './user-options';\nimport { ViewMode } from './view-mode';\nimport { Helper } from './helper';\nimport { HelpHint } from './help-hint';\nimport { DelayInterval } from './delay-interval';\nimport { Popup } from 'main.popup';\n\nimport 'ui.hint';\nimport showExecutionQueuePopup from './views/execution-queue-popup';\n\nexport class Template extends EventEmitter\n{\n\t#context: Context;\n\n\tconstants: Object<string, any>;\n\tvariables: Object<string, any>;\n\trobotSettingsControls;\n\n\t#delayMinLimitM: number;\n\t#userOptions: UserOptions | null;\n\t#tracker: Tracker;\n\t#viewMode: ViewMode;\n\n\t#templateContainerNode: Element;\n\t#templateNode: ?Element;\n\t#listNode: Element | undefined;\n\t#buttonsNode: Element | undefined;\n\n\t#robots: Array<Robot>;\n\t#data: Object;\n\n\tconstructor(params: {\n\t\tcontext: ?Context,\n\t\ttemplateContainerNode: Element,\n\t\tconstants: Object<string, any>,\n\t\tvariables: Object<string, any>,\n\t\tuserOptions: ?UserOptions,\n\t\tdelayMinLimitM: number,\n\t})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation');\n\n\t\tthis.#context = params.context ?? getGlobalContext();\n\t\tthis.constants = params.constants;\n\t\tthis.variables = params.variables;\n\n\t\tthis.#templateContainerNode = params.templateContainerNode;\n\t\tthis.#delayMinLimitM = params.delayMinLimitM;\n\t\tthis.#userOptions = params.userOptions;\n\t\tthis.#tracker = this.#context.tracker;\n\t\tthis.#data = {};\n\t\tthis.#robots = [];\n\t\tthis.#viewMode = ViewMode.none();\n\t}\n\n\tinit(data: Object, viewMode: number)\n\t{\n\t\tif (Type.isPlainObject(data))\n\t\t{\n\t\t\tthis.#data = data;\n\t\t\tif (!Type.isPlainObject(this.#data.CONSTANTS))\n\t\t\t{\n\t\t\t\tthis.#data.CONSTANTS = {};\n\t\t\t}\n\n\t\t\tif (!Type.isPlainObject(this.#data.PARAMETERS))\n\t\t\t{\n\t\t\t\tthis.#data.PARAMETERS = {};\n\t\t\t}\n\n\t\t\tif (!Type.isPlainObject(this.#data.VARIABLES))\n\t\t\t{\n\t\t\t\tthis.#data.VARIABLES = {};\n\t\t\t}\n\n\t\t\tif (!Type.isNil(this.#data.DOCUMENT_STATUS))\n\t\t\t{\n\t\t\t\tthis.#data.DOCUMENT_STATUS = String(this.#data.DOCUMENT_STATUS);\n\t\t\t}\n\n\t\t\tthis.markExternalModified(this.#data.IS_EXTERNAL_MODIFIED);\n\t\t\tthis.markModified(false);\n\t\t}\n\n\t\tthis.#viewMode = ViewMode.fromRaw(viewMode);\n\n\t\tif (!this.#viewMode.isNone())\n\t\t{\n\t\t\tthis.#templateNode = this.#templateContainerNode.querySelector(\n\t\t\t\t`[data-role=\"automation-template\"][data-status-id=\"${this.#data.DOCUMENT_STATUS}\"]`,\n\t\t\t);\n\t\t\tthis.#listNode = this.#templateNode.querySelector('[data-role=\"robot-list\"]');\n\t\t\tthis.#buttonsNode = this.#templateNode.querySelector('[data-role=\"buttons\"]');\n\n\t\t\tthis.initRobots();\n\t\t\tthis.initButtons();\n\n\t\t\tif (!this.isExternalModified() && this.canEdit())\n\t\t\t{\n\t\t\t\t// register DD\n\t\t\t\tjsDD.registerDest(this.#templateNode, 10);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tjsDD.unregisterDest(this.#templateNode);\n\t\t\t}\n\t\t}\n\t}\n\n\treInit(data: Object, viewMode: number)\n\t{\n\t\tDom.clean(this.#listNode);\n\t\tDom.clean(this.#buttonsNode);\n\n\t\tthis.destroy();\n\t\tthis.init(data, viewMode);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#robots.forEach((robot) => robot.destroy());\n\t}\n\n\tstatic copyRobotTo(dstTemplate: Template, robot: Robot, beforeRobot: ?Robot): Robot\n\t{\n\t\tconst copiedRobot = robot.copyTo(dstTemplate, beforeRobot);\n\t\tdstTemplate.emit('Template:robot:add', { robot: copiedRobot });\n\t}\n\n\tcanEdit(): boolean\n\t{\n\t\treturn this.#context.canEdit;\n\t}\n\n\tinitRobots()\n\t{\n\t\tthis.#robots = [];\n\n\t\tif (Type.isArray(this.#data.ROBOTS))\n\t\t{\n\t\t\tfor (let i = 0; i < this.#data.ROBOTS.length; ++i)\n\t\t\t{\n\t\t\t\tconst robot = new Robot({\n\t\t\t\t\tdocument: this.#context.document,\n\t\t\t\t\ttemplate: this,\n\t\t\t\t\tisFrameMode: this.#context.get('isFrameMode'),\n\t\t\t\t\ttracker: this.#tracker,\n\t\t\t\t});\n\t\t\t\trobot.init(this.#data.ROBOTS[i], this.#viewMode);\n\t\t\t\tthis.insertRobotNode(robot.node);\n\t\t\t\tthis.#robots.push(robot);\n\t\t\t}\n\t\t}\n\t}\n\n\tget robots(): Array<Robot>\n\t{\n\t\treturn this.#robots;\n\t}\n\n\tget userOptions(): ?UserOptions\n\t{\n\t\treturn this.#userOptions;\n\t}\n\n\tgetSelectedRobotNames(): Array<Robot>\n\t{\n\t\tconst selectedRobots = [];\n\n\t\tthis.#robots.forEach((robot) => {\n\t\t\tif (robot.isSelected())\n\t\t\t{\n\t\t\t\tselectedRobots.push(robot.data.Name);\n\t\t\t}\n\t\t});\n\n\t\treturn selectedRobots;\n\t}\n\n\tgetActivatedRobotNames(): Array<string>\n\t{\n\t\tconst activatedRobots = [];\n\t\tthis.#robots.forEach((robot) => {\n\t\t\tif (robot.isActivated())\n\t\t\t{\n\t\t\t\tactivatedRobots.push(robot.data.Name);\n\t\t\t}\n\t\t});\n\n\t\treturn activatedRobots;\n\t}\n\n\tgetDeactivatedRobotNames(): Array<string>\n\t{\n\t\tconst deactivatedRobots = [];\n\t\tthis.#robots.forEach((robot) => {\n\t\t\tif (!robot.isActivated())\n\t\t\t{\n\t\t\t\tdeactivatedRobots.push(robot.data.Name);\n\t\t\t}\n\t\t});\n\n\t\treturn deactivatedRobots;\n\t}\n\n\tgetSerializedRobots(): []\n\t{\n\t\tconst serialized = [];\n\t\tthis.#robots.forEach((robot) => serialized.push(robot.serialize()));\n\n\t\treturn serialized;\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.#data.ID;\n\t}\n\n\tgetStatusId(): ?string\n\t{\n\t\treturn this.#data.DOCUMENT_STATUS;\n\t}\n\n\tgetStatus(): ?{}\n\t{\n\t\treturn this.#context.document.statusList.find((status) => String(status.STATUS_ID) === this.getStatusId());\n\t}\n\n\tgetTemplateId(): number\n\t{\n\t\tconst id = parseInt(this.#data.ID, 10);\n\n\t\treturn Number.isNaN(id) ? 0 : id;\n\t}\n\n\tinitButtons()\n\t{\n\t\tif (this.isExternalModified())\n\t\t{\n\t\t\tthis.createExternalLocker();\n\t\t\tthis.createManageModeButton();\n\t\t}\n\t\telse if (this.#viewMode.isEdit() && this.getTemplateId() > 0)\n\t\t{\n\t\t\tthis.createConstantsEditButton();\n\t\t\tthis.createParametersEditButton();\n\t\t\tthis.createExternalEditTemplateButton();\n\t\t\tthis.createManageModeButton();\n\t\t}\n\t}\n\n\tenableManageMode(isActive: boolean)\n\t{\n\t\tif (this.#listNode)\n\t\t{\n\t\t\tthis.#viewMode = ViewMode.manage().setProperty('isActive', isActive);\n\n\t\t\tif (isActive)\n\t\t\t{\n\t\t\t\tDom.addClass(this.#listNode, '--multiselect-mode');\n\t\t\t}\n\n\t\t\tif (this.isExternalModified())\n\t\t\t{\n\t\t\t\tDom.addClass(this.#listNode, '--locked-node');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#robots.forEach((robot) => {\n\t\t\t\t\tif (robot.isInvalid())\n\t\t\t\t\t{\n\t\t\t\t\t\trobot.enableManageMode(false);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\trobot.enableManageMode(isActive);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tdisableManageMode()\n\t{\n\t\tif (this.#listNode)\n\t\t{\n\t\t\tthis.#viewMode = ViewMode.edit();\n\t\t\tDom.removeClass(this.#listNode, '--multiselect-mode');\n\t\t\tif (this.isExternalModified())\n\t\t\t{\n\t\t\t\tDom.removeClass(this.#listNode, '--locked-node');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#robots.forEach((robot) => {\n\t\t\t\t\trobot.disableManageMode()\n\n\t\t\t\t\tif (!robot.isInvalid())\n\t\t\t\t\t{\n\t\t\t\t\t\tconst draggableNode = robot.node.querySelector('.bizproc-automation-robot-container-wrapper');\n\t\t\t\t\t\tif (draggableNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDom.addClass(draggableNode, 'bizproc-automation-robot-container-wrapper-draggable');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tenableDragAndDrop()\n\t{\n\t\tthis.#robots.forEach((robot) => {\n\t\t\tif (!robot.isInvalid())\n\t\t\t{\n\t\t\t\trobot.registerItem(robot.node);\n\n\t\t\t\tconst draggableNode = robot.node.querySelector('.bizproc-automation-robot-container-wrapper');\n\t\t\t\tif (draggableNode)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(draggableNode, 'bizproc-automation-robot-container-wrapper-draggable');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tdisableDragAndDrop()\n\t{\n\t\tthis.#robots.forEach((robot) => robot.unregisterItem(robot.node));\n\n\t\tthis.#templateNode.querySelectorAll('.bizproc-automation-robot-container-wrapper').forEach((node) => {\n\t\t\tDom.removeClass(node, 'bizproc-automation-robot-container-wrapper-draggable');\n\t\t});\n\t}\n\n\tcreateExternalEditTemplateButton(): undefined | boolean\n\t{\n\t\tif (Type.isNil(this.#context.bizprocEditorUrl))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst anchor = Tag.render`\n\t\t\t<a class=\"bizproc-automation-robot-btn-set\" href=\"#\" target=\"_top\">\n\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT')}\n\t\t\t</a>\n\t\t`;\n\t\tEvent.bind(anchor, 'click', (event) => {\n\t\t\tevent.preventDefault();\n\n\t\t\tif (!this.#viewMode.isManage())\n\t\t\t{\n\t\t\t\tthis.onExternalEditTemplateButtonClick(anchor);\n\t\t\t}\n\t\t});\n\n\t\tif (this.#context.bizprocEditorUrl.length === 0)\n\t\t{\n\t\t\tDom.addClass(anchor, 'bizproc-automation-robot-btn-set-locked');\n\t\t}\n\n\t\tDom.append(anchor, this.#buttonsNode);\n\t}\n\n\tcreateManageModeButton()\n\t{\n\t\tif (!this.#context.canManage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst manageButton = Tag.render`\n\t\t\t<a class=\"bizproc-automation-robot-btn-set\" target=\"_top\" style=\"cursor: pointer\">\n\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_MANAGE_ROBOTS_1')}\n\t\t\t</a>\n\t\t`;\n\t\tEvent.bind(manageButton, 'click', (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tthis.onManageModeButtonClick(manageButton);\n\t\t});\n\n\t\tDom.append(manageButton, this.#buttonsNode);\n\t}\n\n\tonManageModeButtonClick(manageButtonNode: HTMLElement)\n\t{\n\t\tif (this.canEdit())\n\t\t{\n\t\t\tthis.emit('Template:enableManageMode', {\n\t\t\t\tdocumentStatus: this.#data.DOCUMENT_STATUS,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(manageButtonNode);\n\t\t}\n\t}\n\n\tcreateConstantsEditButton(): boolean | undefined\n\t{\n\t\tif (Type.isNil(this.#context.constantsEditorUrl))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst url = (\n\t\t\tthis.#viewMode.isManage()\n\t\t\t\t? '#'\n\t\t\t\t: this.#context.constantsEditorUrl.replace('#ID#', this.getTemplateId())\n\t\t);\n\n\t\tif (url.length === 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst anchor = Tag.render`\n\t\t\t<a class=\"bizproc-automation-robot-btn-set\" href=\"${Text.encode(url)}\">\n\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_CONSTANTS_EDIT')}\n\t\t\t</a>\n\t\t`;\n\t\tDom.append(anchor, this.#buttonsNode);\n\t}\n\n\tcreateParametersEditButton(): boolean | undefined\n\t{\n\t\tif (Type.isNil(this.#context.parametersEditorUrl))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst url = this.#context.parametersEditorUrl.replace('#ID#', this.getTemplateId());\n\n\t\tif (url.length === 0 || this.#viewMode.isManage())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst anchor = Tag.render`\n\t\t\t<a class=\"bizproc-automation-robot-btn-set\" href=\"${Text.encode(url)}\">\n\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_PARAMETERS_EDIT')}\n\t\t\t</a>\n\t\t`;\n\t\tDom.append(anchor, this.#buttonsNode);\n\t}\n\n\tcreateExternalLocker()\n\t{\n\t\tconst div = Tag.render`\n\t\t\t<div class=\"bizproc-automation-robot-container\">\n\t\t\t\t<div class=\"bizproc-automation-robot-container-wrapper bizproc-automation-robot-container-wrapper-lock\">\n\t\t\t\t\t<div class=\"bizproc-automation-robot-deadline\"></div>\n\t\t\t\t\t<div class=\"bizproc-automation-robot-title\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT_TEXT')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (this.#viewMode.isEdit())\n\t\t{\n\t\t\tconst settingsBtn = Tag.render`\n\t\t\t\t<div class=\"bizproc-automation-robot-btn-settings\">\n\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_EDIT')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tEvent.bind(div, 'click', (event) => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tif (!this.#viewMode.isManage())\n\t\t\t\t{\n\t\t\t\t\tthis.onExternalEditTemplateButtonClick(div);\n\t\t\t\t}\n\t\t\t});\n\t\t\tDom.append(settingsBtn, div);\n\n\t\t\tconst deleteBtn = Tag.render`<span class=\"bizproc-automation-robot-btn-delete\"></span>`;\n\t\t\tEvent.bind(deleteBtn, 'click', (event) => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tif (!this.#viewMode.isManage())\n\t\t\t\t{\n\t\t\t\t\tthis.onUnsetExternalModifiedClick(deleteBtn);\n\t\t\t\t}\n\t\t\t});\n\t\t\tDom.append(deleteBtn, div.lastChild);\n\t\t}\n\n\t\tDom.append(div, this.#listNode);\n\t\tthis.#templateNode = div;\n\t}\n\n\tonSearch(event: BaseEvent)\n\t{\n\t\tif (this.isExternalModified())\n\t\t{\n\t\t\tthis.onExternalModifiedSearch(event);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#robots.forEach((robot) => robot.onSearch(event));\n\t\t}\n\t}\n\n\tonExternalModifiedSearch(event)\n\t{\n\t\tif (this.#templateNode)\n\t\t{\n\t\t\tconst query = event.getData().queryString;\n\t\t\tDom[query ? 'addClass' : 'removeClass'](this.#templateNode, '--search-mismatch');\n\t\t}\n\t}\n\n\tonExternalEditTemplateButtonClick(button)\n\t{\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#context.bizprocEditorUrl.length === 0)\n\t\t{\n\t\t\tif (top.BX.UI && top.BX.UI.InfoHelper)\n\t\t\t{\n\t\t\t\ttop.BX.UI.InfoHelper.show('limit_office_bp_designer');\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst templateId = this.getTemplateId();\n\t\tif (templateId > 0)\n\t\t{\n\t\t\tthis.openBizprocEditor(templateId);\n\t\t}\n\t}\n\n\tonUnsetExternalModifiedClick(button)\n\t{\n\t\tif (!this.canEdit())\n\t\t{\n\t\t\tHelpHint.showNoPermissionsHint(button);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#templateNode = null;\n\n\t\tthis.markExternalModified(false);\n\t\tthis.markModified();\n\t\tthis.reInit(null, this.#viewMode.intoRaw());\n\t}\n\n\topenBizprocEditor(templateId)\n\t{\n\t\ttop.window.location.href = this.#context.bizprocEditorUrl.replace('#ID#', templateId);\n\t}\n\n\taddRobot(robotData, callback)\n\t{\n\t\tconst robot = new Robot({\n\t\t\tdocument: this.#context.document,\n\t\t\ttemplate: this,\n\t\t\tisFrameMode: this.#context.get('isFrameMode'),\n\t\t\ttracker: this.#tracker,\n\t\t});\n\t\tconst initData = {\n\t\t\tType: robotData.CLASS,\n\t\t\tProperties: {\n\t\t\t\tTitle: robotData.NAME,\n\t\t\t},\n\t\t\tDialogContext: robotData.DIALOG_CONTEXT,\n\t\t};\n\n\t\tif (this.#robots.length > 0)\n\t\t{\n\t\t\tconst parentRobot = this.#robots[this.#robots.length - 1];\n\t\t\tif (!parentRobot.getDelayInterval().isNow() || parentRobot.isExecuteAfterPrevious())\n\t\t\t{\n\t\t\t\tinitData.Delay = parentRobot.getDelayInterval().serialize();\n\t\t\t\tinitData.ExecuteAfterPrevious = 1;\n\t\t\t}\n\t\t}\n\n\t\trobot.draft = true;\n\t\trobot.init(initData, this.#viewMode);\n\n\t\tthis.insertRobot(robot);\n\t\tthis.insertRobotNode(robot.node);\n\t\tthis.emit('Template:robot:add', { robot });\n\n\t\tif (callback)\n\t\t{\n\t\t\tcallback.call(this, robot);\n\t\t}\n\t}\n\n\tinsertRobot(robot, beforeRobot)\n\t{\n\t\tif (beforeRobot)\n\t\t{\n\t\t\tfor (let i = 0; i < this.#robots.length; ++i)\n\t\t\t{\n\t\t\t\tif (this.#robots[i] !== beforeRobot)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.#robots.splice(i, 0, robot);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#robots.push(robot);\n\t\t}\n\n\t\tthis.markModified();\n\t}\n\n\tgetNextRobot(robot)\n\t{\n\t\tfor (let i = 0; i < this.#robots.length; ++i)\n\t\t{\n\t\t\tif (this.#robots[i] === robot)\n\t\t\t{\n\t\t\t\treturn (this.#robots[i + 1] || null);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tdeleteRobot(robot, callback)\n\t{\n\t\tfor (let i = 0; i < this.#robots.length; ++i)\n\t\t{\n\t\t\tif (this.#robots[i].isEqual(robot))\n\t\t\t{\n\t\t\t\tthis.#robots.splice(i, 1);\n\n\t\t\t\tif (callback)\n\t\t\t\t{\n\t\t\t\t\tcallback(robot);\n\t\t\t\t}\n\n\t\t\t\tthis.markModified();\n\t\t\t\tthis.emit('Template:robot:delete', { robot });\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tinsertRobotNode(robotNode, beforeNode)\n\t{\n\t\tif (beforeNode)\n\t\t{\n\t\t\tthis.#listNode.insertBefore(robotNode, beforeNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(robotNode, this.#listNode);\n\t\t}\n\t}\n\n\topenRobotSettingsDialog(robot: Robot, context?: Object, saveCallback: (Robot) => void)\n\t{\n\t\tif (!Type.isPlainObject(context))\n\t\t{\n\t\t\tcontext = {};\n\t\t}\n\n\t\tif (Designer.getInstance().getRobotSettingsDialog())\n\t\t{\n\t\t\tif (context.changeRobot)\n\t\t\t{\n\t\t\t\tDesigner.getInstance().getRobotSettingsDialog().popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst robotBrokenLinks = robot.getBrokenLinks();\n\n\t\tconst formName = 'bizproc_automation_robot_dialog';\n\t\tconst form = Tag.render`\n\t\t\t<form name=\"${formName}\">\n\t\t\t\t${this.#renderExecutionQueue(robot)}\n\t\t\t\t${this.renderDelaySettings(robot)}\n\t\t\t\t${this.renderConditionSettings(robot)}\n\t\t\t\t${robotBrokenLinks.length > 0 ? this.renderBrokenLinkAlert(robotBrokenLinks) : ''}\n\t\t\t</form>\n\t\t`;\n\n\t\tDesigner.getInstance().setRobotSettingsDialog({\n\t\t\ttemplate: this,\n\t\t\tcontext,\n\t\t\trobot,\n\t\t\tform,\n\t\t});\n\n\t\tcontext.DOCUMENT_CATEGORY_ID = this.#context.document.getCategoryId();\n\t\tif (\n\t\t\tType.isPlainObject(robot.data.DialogContext)\n\t\t\t&& !Type.isNil(robot.data.DialogContext.addMenuGroup)\n\t\t)\n\t\t{\n\t\t\tcontext.addMenuGroup = robot.data.DialogContext.addMenuGroup;\n\t\t}\n\n\t\tajax({\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'html',\n\t\t\turl: Uri.addParam(\n\t\t\t\tthis.#context.ajaxUrl,\n\t\t\t\t{\n\t\t\t\t\tanalyticsLabel: `automation_robot${robot.draft ? '_draft' : ''}_settings_${robot.data.Type.toLowerCase()}`,\n\t\t\t\t},\n\t\t\t),\n\t\t\tdata: {\n\t\t\t\tajax_action: 'get_robot_dialog',\n\t\t\t\tdocument_signed: this.#context.signedDocument,\n\t\t\t\tdocument_status: this.#context.document.getCurrentStatusId(),\n\t\t\t\tcontext,\n\t\t\t\trobot_json: Helper.toJsonString(robot.serialize()),\n\t\t\t\tform_name: formName,\n\t\t\t},\n\t\t\tonsuccess: (html) => {\n\t\t\t\tif (html)\n\t\t\t\t{\n\t\t\t\t\tconst dialogRows = Dom.create('div', { html });\n\t\t\t\t\tDom.append(dialogRows, form);\n\t\t\t\t}\n\n\t\t\t\tthis.showRobotSettingsPopup(robot, form, saveCallback);\n\t\t\t},\n\t\t});\n\t}\n\n\tshowRobotSettingsPopup(robot: Robot, form: HTMLFormElement, saveCallback: (Robot) => void)\n\t{\n\t\tlet popupMinWidth = 580;\n\t\tlet popupWidth = popupMinWidth;\n\n\t\tif (this.#userOptions)\n\t\t{\n\t\t\t// TODO move from if?\n\t\t\tthis.emit('Template:robot:showSettings');\n\t\t\tpopupWidth = parseInt(\n\t\t\t\tthis.#userOptions.get('defaults', 'robot_settings_popup_width', 580),\n\t\t\t\t10,\n\t\t\t);\n\t\t}\n\n\t\tthis.initRobotSettingsControls(robot, form);\n\n\t\tif (\n\t\t\trobot.data.Type === 'CrmSendEmailActivity'\n\t\t\t|| robot.data.Type === 'MailActivity'\n\t\t\t|| robot.data.Type === 'RpaApproveActivity'\n\t\t)\n\t\t{\n\t\t\tpopupMinWidth += 170;\n\t\t\tif (popupWidth < popupMinWidth)\n\t\t\t{\n\t\t\t\tpopupWidth = popupMinWidth;\n\t\t\t}\n\t\t}\n\n\t\tlet robotTitle = Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_SETTINGS_TITLE');\n\t\tlet descriptionTitle = Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_SETTINGS_TITLE');\n\n\t\tif (robot.hasTitle())\n\t\t{\n\t\t\trobotTitle = robot.getTitle();\n\t\t\tdescriptionTitle = robot.getDescriptionTitle();\n\n\t\t\tif (descriptionTitle === 'untitled')\n\t\t\t{\n\t\t\t\tdescriptionTitle = robotTitle;\n\t\t\t}\n\t\t}\n\n\t\tconst titleBarContent = Tag.render`\n\t\t\t<div class=\"popup-window-titlebar-text bizproc-automation-robot-settings-popup-titlebar\">\n\t\t\t\t<span class=\"bizproc-automation-robot-settings-popup-titlebar-text\">${Text.encode(robotTitle)}</span>\n\t\t\t\t<div class=\"ui-hint\">\n\t\t\t\t\t<span class=\"ui-hint-icon\" data-text=\"${Text.encode(descriptionTitle)}\"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tHelpHint.bindAll(titleBarContent);\n\n\t\tconst popup = new Popup({\n\t\t\tid: Helper.generateUniqueId(),\n\t\t\tbindElement: null,\n\t\t\tcontent: form,\n\t\t\tcloseByEsc: true,\n\t\t\tbuttons: [\n\t\t\t\tnew SaveButton({\n\t\t\t\t\tonclick: (button: BaseButton) => {\n\t\t\t\t\t\tconst isNewRobot = robot.draft;\n\t\t\t\t\t\tconst callback = () => {\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\tif (isNewRobot)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.emit('Template:robot:add', { robot });\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (saveCallback)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsaveCallback(robot);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis.saveRobotSettings(form, robot, callback, button.getContainer());\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew CancelButton({\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_JS_AUTOMATION_CANCEL_BUTTON_CAPS'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t\twidth: popupWidth,\n\t\t\tminWidth: popupMinWidth,\n\t\t\tminHeight: 100,\n\t\t\tcontentPadding: 12,\n\t\t\tresizable: true,\n\t\t\tcloseIcon: true,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tDesigner.getInstance().setRobotSettingsDialog(null);\n\t\t\t\t\tthis.destroyRobotSettingsControls();\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t\tthis.emit('Template:robot:closeSettings');\n\t\t\t\t},\n\t\t\t\tonPopupResize: () => {\n\t\t\t\t\tthis.onResizeRobotSettings();\n\t\t\t\t},\n\t\t\t\tonPopupResizeEnd: () => {\n\t\t\t\t\tif (this.#userOptions)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#userOptions.set('defaults', 'robot_settings_popup_width', popup.getWidth());\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\ttitleBar: {\n\t\t\t\tcontent: titleBarContent,\n\t\t\t},\n\t\t\tdraggable: { restrict: false },\n\t\t});\n\n\t\tDesigner.getInstance().getRobotSettingsDialog().popup = popup;\n\t\tpopup.show();\n\t}\n\n\tinitRobotSettingsControls(robot, node)\n\t{\n\t\tif (!Type.isArray(this.robotSettingsControls))\n\t\t{\n\t\t\tthis.robotSettingsControls = [];\n\t\t}\n\n\t\tconst controlNodes = node.querySelectorAll('[data-role]');\n\t\tfor (const controlNode of controlNodes)\n\t\t{\n\t\t\tthis.initRobotSettingsControl(robot, controlNode);\n\t\t}\n\t}\n\n\tinitRobotSettingsControl(robot, controlNode)\n\t{\n\t\tif (!Type.isArray(this.robotSettingsControls))\n\t\t{\n\t\t\tthis.robotSettingsControls = [];\n\t\t}\n\n\t\tconst role = controlNode.getAttribute('data-role');\n\n\t\tconst controlProps = {\n\t\t\tcontext: new SelectorContext({\n\t\t\t\tfields: Runtime.clone(this.#context.document.getFields()),\n\t\t\t\tuseSwitcherMenu: this.#context.get('showTemplatePropertiesMenuOnSelecting'),\n\t\t\t\trootGroupTitle: this.#context.document.title,\n\t\t\t\tuserOptions: this.#context.userOptions,\n\t\t\t}),\n\t\t\tneedSync: robot.draft,\n\t\t\tcheckbox: controlNode,\n\t\t};\n\n\t\tif (role === SelectorManager.SELECTOR_ROLE_USER)\n\t\t{\n\t\t\tconst fieldProperty = JSON.parse(controlNode.getAttribute('data-property'));\n\t\t\tcontrolProps.context.set('additionalUserFields', [\n\t\t\t\t...this.#getUserSelectorAdditionalFields(fieldProperty),\n\t\t\t\t...this.globalConstants.filter((constant) => constant.Type === 'user').map((constant) => ({\n\t\t\t\t\tid: constant.Expression,\n\t\t\t\t\ttitle: constant.Name,\n\t\t\t\t})),\n\t\t\t\t...this.globalVariables.filter((variable) => variable.Type === 'user').map((variable) => ({\n\t\t\t\t\tid: variable.Expression,\n\t\t\t\t\ttitle: variable.Name,\n\t\t\t\t})),\n\t\t\t]);\n\t\t}\n\t\telse if (role === SelectorManager.SELECTOR_ROLE_FILE)\n\t\t{\n\t\t\tthis.robots.forEach((robot) => {\n\t\t\t\tcontrolProps.context.fields.push(\n\t\t\t\t\t...robot\n\t\t\t\t\t\t.getReturnFieldsDescription()\n\t\t\t\t\t\t.filter((field) => field.Type === 'file')\n\t\t\t\t\t\t.map((field) => ({\n\t\t\t\t\t\t\tId: `{{~${robot.getId()}:${field.Id}}}`,\n\t\t\t\t\t\t\tName: `${robot.getTitle()}: ${field.Name}`,\n\t\t\t\t\t\t\tType: 'file',\n\t\t\t\t\t\t\tExpression: `{{~${robot.getId()}:${field.Id}}}`,\n\t\t\t\t\t\t})),\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\tconst control = SelectorManager.createSelectorByRole(role, controlProps);\n\n\t\tif (control && role !== SelectorManager.SELECTOR_ROLE_SAVE_STATE)\n\t\t{\n\t\t\tcontrol.renderTo(controlNode);\n\n\t\t\tcontrol.subscribe('onAskConstant', (event) => {\n\t\t\t\tconst { fieldProperty } = event.getData();\n\t\t\t\tcontrol.onFieldSelect(this.addConstant(fieldProperty));\n\t\t\t});\n\t\t\tcontrol.subscribe('onAskParameter', (event) => {\n\t\t\t\tconst { fieldProperty } = event.getData();\n\t\t\t\tcontrol.onFieldSelect(this.addParameter(fieldProperty));\n\t\t\t});\n\t\t\tcontrol.subscribe('onOpenFieldMenu', (event) => this.onOpenMenu(event, robot));\n\t\t\tcontrol.subscribe('onOpenMenu', (event) => this.onOpenMenu(event, robot));\n\t\t}\n\n\t\tBX.UI.Hint.init(controlNode);\n\n\t\tif (control)\n\t\t{\n\t\t\tthis.robotSettingsControls.push(control);\n\t\t}\n\t}\n\n\t#getUserSelectorAdditionalFields(fieldProperty): Array<object>\n\t{\n\t\tconst additionalFields = (\n\t\t\tthis\n\t\t\t\t.#getRobotsWithReturnFields()\n\t\t\t\t.flatMap((robot) => (\n\t\t\t\t\trobot\n\t\t\t\t\t\t.getReturnFieldsDescription()\n\t\t\t\t\t\t.filter((field) => field.Type === 'user')\n\t\t\t\t\t\t.map((field) => ({\n\t\t\t\t\t\t\tid: `{{~${robot.getId()}:${field.Id}}}`,\n\t\t\t\t\t\t\ttitle: `${robot.getTitle()}: ${field.Name}`,\n\t\t\t\t\t\t}))\n\t\t\t\t))\n\t\t);\n\n\t\tif (this.#context.get('showTemplatePropertiesMenuOnSelecting') && fieldProperty)\n\t\t{\n\t\t\tconst ask = this.addConstant(Runtime.clone(fieldProperty));\n\n\t\t\tadditionalFields.push({\n\t\t\t\tid: ask.Expression,\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_ASK_CONSTANT'),\n\t\t\t\ttabs: ['recents', 'bpuserroles'],\n\t\t\t\tsort: 1,\n\t\t\t});\n\n\t\t\tconst param = this.addParameter(Runtime.clone(fieldProperty));\n\n\t\t\tadditionalFields.push({\n\t\t\t\tid: param.Expression,\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_ASK_PARAMETER'),\n\t\t\t\ttabs: ['recents', 'bpuserroles'],\n\t\t\t\tsort: 2,\n\t\t\t});\n\t\t}\n\n\t\treturn additionalFields;\n\t}\n\n\t#addRobotReturnFieldsToSelector(event: BaseEvent, skipRobot: ?Robot)\n\t{\n\t\tconst selector = event.getData().selector;\n\t\tconst isMixedCondition = event.getData().isMixedCondition;\n\n\t\tif (Type.isBoolean(isMixedCondition) && !isMixedCondition)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst robotMenuItems = (\n\t\t\tthis\n\t\t\t\t.#getRobotsWithReturnFields(skipRobot)\n\t\t\t\t.map((robot) => ({\n\t\t\t\t\tid: robot.getId(),\n\t\t\t\t\ttitle: robot.getTitle(),\n\t\t\t\t\tchildren: robot.getReturnFieldsDescription().map((field) => ({\n\t\t\t\t\t\tid: field.Expression,\n\t\t\t\t\t\ttitle: field.Name,\n\t\t\t\t\t\tcustomData: { field },\n\t\t\t\t\t})),\n\t\t\t\t}))\n\t\t);\n\n\t\tif (robotMenuItems.length > 0)\n\t\t{\n\t\t\tselector.addGroup('__RESULT', {\n\t\t\t\tid: '__RESULT',\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_ROBOT_LIST'),\n\t\t\t\tchildren: robotMenuItems,\n\t\t\t});\n\t\t}\n\t}\n\n\t#addConstantsToSelector(event: BaseEvent)\n\t{\n\t\tconst selector = event.getData().selector;\n\t\tconst isMixedCondition = event.getData().isMixedCondition;\n\n\t\tif (Type.isBoolean(isMixedCondition) && !isMixedCondition)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO - test !this.showTemplatePropertiesMenuOnSelecting\n\t\tconst constants = this.getConstants().map((constant) => {\n\t\t\treturn {\n\t\t\t\tid: constant.SystemExpression,\n\t\t\t\ttitle: constant.Name,\n\t\t\t\tsupertitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_TEMPLATE_CONSTANTS_LIST'),\n\t\t\t\tcustomData: { field: constant },\n\t\t\t};\n\t\t});\n\n\t\tthis.globalConstants.forEach((constant) => {\n\t\t\tconstants.push({\n\t\t\t\tid: constant.SystemExpression,\n\t\t\t\ttitle: constant.Name,\n\t\t\t\tsupertitle: constant.SuperTitle,\n\t\t\t\tcustomData: { field: constant },\n\t\t\t});\n\t\t});\n\n\t\tif (Type.isArrayFilled(constants))\n\t\t{\n\t\t\tselector.addGroup(\n\t\t\t\t'__CONSTANTS',\n\t\t\t\t{\n\t\t\t\t\tid: '__CONSTANTS',\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_CONSTANTS_LIST'),\n\t\t\t\t\tchildren: constants,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\t#addVariablesToSelector(event: BaseEvent)\n\t{\n\t\tconst selector = event.getData().selector;\n\t\tconst isMixedCondition = event.getData().isMixedCondition;\n\n\t\tif (Type.isBoolean(isMixedCondition) && !isMixedCondition)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst gVariables = this.globalVariables.map((variable) => {\n\t\t\treturn {\n\t\t\t\tid: variable.SystemExpression,\n\t\t\t\ttitle: variable.Name,\n\t\t\t\tsupertitle: variable.SuperTitle,\n\t\t\t\tcustomData: { field: variable },\n\t\t\t};\n\t\t});\n\n\t\tif (Type.isArrayFilled(gVariables))\n\t\t{\n\t\t\tselector.addGroup(\n\t\t\t\t'__GLOB_VARIABLES',\n\t\t\t\t{\n\t\t\t\t\tid: '__GLOB_VARIABLES',\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_GLOB_VARIABLES_LIST_1'),\n\t\t\t\t\tchildren: gVariables,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\t#getRobotsWithReturnFields(skipRobot: ?Robot): Array<Robot>\n\t{\n\t\tconst skipId = skipRobot?.getId() || '';\n\n\t\treturn this\n\t\t\t.robots\n\t\t\t.filter((templateRobot) => (\n\t\t\t\ttemplateRobot.getId() !== skipId && templateRobot.hasReturnFields()\n\t\t\t))\n\t\t;\n\t}\n\n\tdestroyRobotSettingsControls()\n\t{\n\t\tif (this.conditionSelector)\n\t\t{\n\t\t\tthis.conditionSelector.destroy();\n\t\t\tthis.conditionSelector = null;\n\t\t}\n\n\t\tif (Type.isArray(this.robotSettingsControls))\n\t\t{\n\t\t\tfor (let i = 0; i < this.robotSettingsControls.length; ++i)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(this.robotSettingsControls[i].destroy))\n\t\t\t\t{\n\t\t\t\t\tthis.robotSettingsControls[i].destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.robotSettingsControls = null;\n\t}\n\n\tonBeforeSaveRobotSettings()\n\t{\n\t\tif (Type.isArray(this.robotSettingsControls))\n\t\t{\n\t\t\tfor (let i = 0; i < this.robotSettingsControls.length; ++i)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(this.robotSettingsControls[i].onBeforeSave))\n\t\t\t\t{\n\t\t\t\t\tthis.robotSettingsControls[i].onBeforeSave();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonResizeRobotSettings()\n\t{\n\t\tif (Type.isArray(this.robotSettingsControls))\n\t\t{\n\t\t\tfor (let i = 0; i < this.robotSettingsControls.length; ++i)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(this.robotSettingsControls[i].onPopupResize))\n\t\t\t\t{\n\t\t\t\t\tthis.robotSettingsControls[i].onPopupResize();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\trenderDelaySettings(robot)\n\t{\n\t\tconst delay = robot.getDelayInterval().clone();\n\n\t\tconst {\n\t\t\troot,\n\t\t\tdelayTypeNode,\n\t\t\tdelayValueNode,\n\t\t\tdelayValueTypeNode,\n\t\t\tdelayBasisNode,\n\t\t\tdelayWorkTimeNode,\n\t\t\tdelayWaitWorkDayNode,\n\t\t\tdelayInTimeNode,\n\t\t\tdelayIntervalLabelNode,\n\t\t} = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings\">\n\t\t\t\t<div class=\"bizproc-automation-popup-settings-block\">\n\t\t\t\t\t<span class=\"bizproc-automation-popup-settings-title-wrapper\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref=\"delayTypeNode\"\n\t\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\t\tname=\"delay_type\"\n\t\t\t\t\t\t\tvalue=\"${Text.encode(delay.type)}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref=\"delayValueNode\"\n\t\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\t\tname=\"delay_value\"\n\t\t\t\t\t\t\tvalue=\"${Text.encode(delay.value)}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref=\"delayValueTypeNode\"\n\t\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\t\tname=\"delay_value_type\"\n\t\t\t\t\t\t\tvalue=\"${Text.encode(delay.valueType)}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref=\"delayBasisNode\"\n\t\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\t\tname=\"delay_basis\"\n\t\t\t\t\t\t\tvalue=\"${Text.encode(delay.basis)}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\tref=\"delayWorkTimeNode\"\n\t\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\t\tname=\"delay_worktime\"\n\t\t\t\t\t\t\tvalue=\"${delay.workTime ? 1 : 0}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref=\"delayWaitWorkDayNode\"\n\t\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\t\tname=\"delay_wait_workday\"\n\t\t\t\t\t\t\tvalue=\"${delay.waitWorkDay ? 1 : 0}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref=\"delayInTimeNode\"\n\t\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\t\tname=\"delay_in_time\"\n\t\t\t\t\t\t\tvalue=\"${Text.encode(delay.inTimeString)}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-left\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_AUTOMATION_TO_EXECUTE_TITLE')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tref=\"delayIntervalLabelNode\"\n\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis\"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst basisFields = [];\n\n\t\tconst docFields = this.#context.document.getFields();\n\t\tconst minLimitM = this.#delayMinLimitM;\n\n\t\tif (Type.isArray(docFields))\n\t\t{\n\t\t\tfor (const field of docFields)\n\t\t\t{\n\t\t\t\tif (field.Type === 'date' || field.Type === 'datetime')\n\t\t\t\t{\n\t\t\t\t\tbasisFields.push(field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst delayIntervalSelector = new DelayIntervalSelector({\n\t\t\tlabelNode: delayIntervalLabelNode,\n\t\t\tonchange(delay) {\n\t\t\t\tdelayTypeNode.value = delay.type;\n\t\t\t\tdelayValueNode.value = delay.value;\n\t\t\t\tdelayValueTypeNode.value = delay.valueType;\n\t\t\t\tdelayBasisNode.value = delay.basis;\n\t\t\t\tdelayWorkTimeNode.value = delay.workTime ? 1 : 0;\n\t\t\t\tdelayWaitWorkDayNode.value = delay.waitWorkDay ? 1 : 0;\n\t\t\t\tdelayInTimeNode.value = delay.inTimeString;\n\t\t\t},\n\t\t\tbasisFields,\n\t\t\tminLimitM,\n\t\t\tuseAfterBasis: true,\n\t\t\tshowWaitWorkDay: true,\n\t\t});\n\t\tdelayIntervalSelector.init(delay);\n\n\t\treturn root;\n\t}\n\n\tsetDelaySettingsFromForm(formFields, robot)\n\t{\n\t\tconst delay = new DelayInterval();\n\t\tdelay.setType(formFields.delay_type);\n\t\tdelay.setValue(formFields.delay_value);\n\t\tdelay.setValueType(formFields.delay_value_type);\n\t\tdelay.setBasis(formFields.delay_basis);\n\t\tdelay.setWorkTime(formFields.delay_worktime === '1');\n\t\tdelay.setWaitWorkDay(formFields.delay_wait_workday === '1');\n\t\tdelay.setInTime(formFields.delay_in_time ? formFields.delay_in_time.split(':') : null);\n\t\trobot.setDelayInterval(delay);\n\n\t\tif (robot.hasTemplate())\n\t\t{\n\t\t\trobot.setExecuteAfterPrevious(\n\t\t\t\tformFields.execute_after_previous && (formFields.execute_after_previous) === '1',\n\t\t\t);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\trenderConditionSettings(robot)\n\t{\n\t\tconst conditionGroup = robot.getCondition();\n\t\tthis.conditionSelector = new ConditionGroupSelector(conditionGroup, {\n\t\t\tfields: this.#context.document.getFields(),\n\t\t\tonOpenFieldMenu: (event) => this.onOpenMenu(event, robot),\n\t\t\tonOpenMenu: (event) => this.onOpenMenu(event, robot),\n\t\t\tcaption: {\n\t\t\t\thead: Loc.getMessage('BIZPROC_JS_AUTOMATION_ROBOT_CONDITION_TITLE'),\n\t\t\t},\n\t\t\tisExpanded: this.#userOptions?.get('defaults', 'isConditionGroupExpanded', 'N') === 'Y',\n\t\t});\n\n\t\tthis.conditionSelector.subscribe('onToggleGroupViewClick', (event: BaseEvent) => {\n\t\t\tconst data = event.getData();\n\t\t\tthis.#userOptions.set('defaults', 'isConditionGroupExpanded', data.isExpanded ? 'Y' : 'N');\n\t\t});\n\n\t\treturn this.conditionSelector.createNode();\n\t}\n\n\t#renderExecutionQueue(robot): HTMLDivElement\n\t{\n\t\tconst title = (\n\t\t\trobot.isExecuteAfterPrevious()\n\t\t\t\t? Loc.getMessage('BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_AFTER_PREVIOUS_TITLE')\n\t\t\t\t: Loc.getMessage('BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_PARALLEL_TITLE')\n\t\t);\n\t\tconst value = robot.isExecuteAfterPrevious() ? '1' : '0';\n\n\t\tconst { root, executionQueueLink, input } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings\">\n\t\t\t\t<div class=\"bizproc-automation-popup-settings-block\">\n\t\t\t\t\t<span class=\"bizproc-automation-popup-settings-title\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_TITLE')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"bizproc-automation-popup-settings-link-wrapper\">\n\t\t\t\t\t\t<a ref=\"executionQueueLink\" class=\"bizproc-automation-popup-settings-link\">${title}</a>\n\t\t\t\t\t</span>\n\t\t\t\t\t<input ref=\"input\" type=\"hidden\" value=\"${value}\" name=\"execute_after_previous\"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(executionQueueLink, 'click', () => {\n\t\t\tshowExecutionQueuePopup({\n\t\t\t\tbindElement: executionQueueLink,\n\t\t\t\tcurrentValue: input.value,\n\t\t\t\tonSubmitButtonClick: (formData: FormData) => {\n\t\t\t\t\tconst afterPrevious = formData.get('execution') === 'afterPrevious';\n\t\t\t\t\tDom.adjust(input, { attrs: { value: afterPrevious ? '1' : '0' } });\n\t\t\t\t\tDom.adjust(\n\t\t\t\t\t\texecutionQueueLink,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: (\n\t\t\t\t\t\t\t\tafterPrevious\n\t\t\t\t\t\t\t\t\t? Loc.getMessage('BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_AFTER_PREVIOUS_TITLE')\n\t\t\t\t\t\t\t\t\t: Loc.getMessage('BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_PARALLEL_TITLE')\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\treturn root;\n\t}\n\n\tonOpenMenu(event: BaseEvent, robot: Robot): void\n\t{\n\t\tthis.#addRobotReturnFieldsToSelector(event, robot);\n\t\tthis.#addConstantsToSelector(event);\n\t\tthis.#addVariablesToSelector(event);\n\n\t\tthis.emit(\n\t\t\t'Template:onSelectorMenuOpen',\n\t\t\t{\n\t\t\t\ttemplate: this,\n\t\t\t\trobot,\n\t\t\t\t...event.getData(),\n\t\t\t},\n\t\t);\n\t}\n\n\tsetConditionSettingsFromForm(formFields, robot)\n\t{\n\t\trobot.setCondition(ConditionGroup.createFromForm(formFields));\n\n\t\treturn this;\n\t}\n\n\trenderBrokenLinkAlert(brokenLinks: [] = []): HTMLDivElement\n\t{\n\t\tconst moreInfoNode = Tag.render`\n\t\t\t<div class=\"bizproc-automation-robot-broken-link-full-info\">\n\t\t\t\t${brokenLinks\n\t\t\t\t\t.map((value) => Text.encode(value))\n\t\t\t\t\t.join('<br>')\n\t\t\t\t}\n\t\t\t</div>\n\t\t`;\n\n\t\tconst showMoreLabel = Tag.render`\n\t\t\t<span class=\"bizproc-automation-robot-broken-link-show-more\">\n\t\t\t\t${Loc.getMessage('JS_BIZPROC_AUTOMATION_BROKEN_LINK_MESSAGE_ERROR_MORE_INFO')}\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bindOnce(showMoreLabel, 'click', () => {\n\t\t\tDom.style(moreInfoNode, 'height', `${moreInfoNode.scrollHeight}px`);\n\t\t\tDom.remove(showMoreLabel);\n\t\t});\n\n\t\tconst closeBtn = Tag.render`<span class=\"ui-alert-close-btn\"></span>`;\n\n\t\tconst alert = Tag.render`\n\t\t\t<div class=\"ui-alert ui-alert-warning ui-alert-icon-info\">\n\t\t\t\t<div class=\"ui-alert-message\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span>${Loc.getMessage('BIZPROC_AUTOMATION_BROKEN_LINK_MESSAGE_ERROR')}</span>\n\t\t\t\t\t\t${showMoreLabel}\n\t\t\t\t\t</div>\n\t\t\t\t\t${moreInfoNode}\n\t\t\t\t</div>\n\t\t\t\t${closeBtn}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bindOnce(closeBtn, 'click', () => {\n\t\t\tDom.remove(alert);\n\t\t});\n\n\t\treturn alert;\n\t}\n\n\tsaveRobotSettings(form, robot, callback, btnNode)\n\t{\n\t\tif (btnNode)\n\t\t{\n\t\t\tDom.addClass(btnNode, 'ui-btn-wait');\n\t\t}\n\n\t\tthis.onBeforeSaveRobotSettings();\n\t\tconst formData = BX.ajax.prepareForm(form);\n\n\t\tconst ajaxUrl = this.#context.ajaxUrl;\n\t\tconst documentSigned = this.#context.signedDocument;\n\t\tajax({\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\turl: Uri.addParam(\n\t\t\t\tajaxUrl,\n\t\t\t\t{\n\t\t\t\t\tanalyticsLabel: `automation_robot${robot.draft ? '_draft' : ''}_save_${robot.data.Type.toLowerCase()}`,\n\t\t\t\t},\n\t\t\t),\n\t\t\tdata: {\n\t\t\t\tajax_action: 'save_robot_settings',\n\t\t\t\tdocument_signed: documentSigned,\n\t\t\t\trobot_json: Helper.toJsonString(robot.serialize()),\n\t\t\t\tform_data_json: Helper.toJsonString(formData.data),\n\t\t\t\tform_data: formData.data, /** @bug 0135641 */\n\t\t\t},\n\t\t\tonsuccess: (response) => {\n\t\t\t\tif (btnNode)\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(btnNode, 'ui-btn-wait');\n\t\t\t\t}\n\n\t\t\t\tif (response.SUCCESS)\n\t\t\t\t{\n\t\t\t\t\trobot.updateData(response.DATA.robot);\n\t\t\t\t\tthis.setDelaySettingsFromForm(formData.data, robot);\n\t\t\t\t\tthis.setConditionSettingsFromForm(formData.data, robot);\n\n\t\t\t\t\trobot.draft = false;\n\n\t\t\t\t\trobot.reInit();\n\t\t\t\t\tthis.markModified();\n\t\t\t\t\tif (callback)\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback(response.DATA);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\talert(response.ERRORS[0]);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tserialize()\n\t{\n\t\tconst data = Runtime.clone(this.#data);\n\t\tdata.IS_EXTERNAL_MODIFIED = this.isExternalModified() ? 1 : 0;\n\t\tdata.ROBOTS = [];\n\n\t\tfor (let i = 0; i < this.#robots.length; ++i)\n\t\t{\n\t\t\tdata.ROBOTS.push(this.#robots[i].serialize());\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tisExternalModified()\n\t{\n\t\treturn (this.externalModified === true);\n\t}\n\n\tmarkExternalModified(modified)\n\t{\n\t\tthis.externalModified = modified !== false;\n\t}\n\n\tgetRobotById(id)\n\t{\n\t\treturn this.#robots.find((robot) => robot.getId() === id);\n\t}\n\n\tisModified()\n\t{\n\t\treturn this.modified;\n\t}\n\n\tmarkModified(modified)\n\t{\n\t\tthis.modified = modified !== false;\n\n\t\tif (this.modified)\n\t\t{\n\t\t\tthis.emit('Template:modified');\n\t\t}\n\t}\n\n\tgetConstants(): []\n\t{\n\t\tconst constants = [];\n\n\t\tObject.keys(this.#data.CONSTANTS).forEach((id) => {\n\t\t\tconst constant = Runtime.clone(this.#data.CONSTANTS[id]);\n\n\t\t\tconstant.Id = id;\n\t\t\tconstant.ObjectId = 'Constant';\n\t\t\tconstant.SystemExpression = `{=Constant:${id}}`;\n\t\t\tconstant.Expression = `{{~&:${id}}}`;\n\n\t\t\tconstants.push(constant);\n\t\t});\n\n\t\treturn constants;\n\t}\n\n\tgetConstant(id)\n\t{\n\t\tconst constants = this.getConstants();\n\n\t\tfor (const constant of constants)\n\t\t{\n\t\t\tif (constant.Id === id)\n\t\t\t{\n\t\t\t\treturn constant;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddConstant(property)\n\t{\n\t\tconst id = property.Id || this.generatePropertyId('Constant', this.#data.CONSTANTS);\n\n\t\tif (this.#data.CONSTANTS[id])\n\t\t{\n\t\t\tthrow `Constant with id \"${id}\" is already exists`;\n\t\t}\n\n\t\tthis.#data.CONSTANTS[id] = property;\n\n\t\tthis.emit('Template:constant:add');\n\t\t// if (this.component)\n\t\t// {\n\t\t// \tBX.onCustomEvent(this.component, 'onTemplateConstantAdd', [this, this.getConstant(id)]);\n\t\t// }\n\n\t\treturn this.getConstant(id);\n\t}\n\n\tupdateConstant(id, property)\n\t{\n\t\tif (!this.#data.CONSTANTS[id])\n\t\t{\n\t\t\tthrow `Constant with id \"${id}\" does not exists`;\n\t\t}\n\n\t\t//TODO: only Description yet.\n\t\tthis.#data.CONSTANTS[id].Description = property.Description;\n\n\t\tthis.emit('Template:constant:update', { constant: this.getConstant(id) });\n\t\t// if (this.component)\n\t\t// {\n\t\t// \tBX.onCustomEvent(this.component, 'onTemplateConstantUpdate', [this, this.getConstant(id)]);\n\t\t// }\n\n\t\treturn this.getConstant(id);\n\t}\n\n\tdeleteConstant(id)\n\t{\n\t\tdelete this.#data.CONSTANTS[id];\n\n\t\treturn true;\n\t}\n\n\tsetConstantValue(id, value)\n\t{\n\t\tif (this.#data.CONSTANTS[id])\n\t\t{\n\t\t\tthis.#data.CONSTANTS[id].Default = value;\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetParameters()\n\t{\n\t\tconst params = [];\n\n\t\tObject.keys(this.#data.PARAMETERS).forEach((id) => {\n\t\t\tconst param = Runtime.clone(this.#data.PARAMETERS[id]);\n\n\t\t\tparam.Id = id;\n\t\t\tparam.ObjectId = 'Template';\n\t\t\tparam.SystemExpression = `{=Template:${id}}`;\n\t\t\tparam.Expression = `{{~*:${id}}}`;\n\n\t\t\tparams.push(param);\n\t\t});\n\n\t\treturn params;\n\t}\n\n\tgetParameter(id)\n\t{\n\t\tconst params = this.getParameters();\n\n\t\tfor (const param of params)\n\t\t{\n\t\t\tif (param.Id === id)\n\t\t\t{\n\t\t\t\treturn param;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddParameter(property)\n\t{\n\t\tconst id = property.Id || this.generatePropertyId('Parameter', this.#data.PARAMETERS);\n\n\t\tif (this.#data.PARAMETERS[id])\n\t\t{\n\t\t\tthrow `Parameter with id \"${id}\" is already exists`;\n\t\t}\n\n\t\tthis.#data.PARAMETERS[id] = property;\n\n\t\tthis.emit('Template:parameter:add', { parameter: this.getParameter(id) });\n\t\t// if (this.component)\n\t\t// {\n\t\t// \tBX.onCustomEvent(this.component, 'onTemplateParameterAdd', [this, this.getParameter(id)]);\n\t\t// }\n\n\t\treturn this.getParameter(id);\n\t}\n\n\tupdateParameter(id, property)\n\t{\n\t\tif (!this.#data.PARAMETERS[id])\n\t\t{\n\t\t\tthrow `Parameter with id \"${id}\" does not exists`;\n\t\t}\n\n\t\t// TODO: only Description yet.\n\t\tthis.#data.PARAMETERS[id].Description = property.Description;\n\n\t\tthis.emit('Template:parameter:update', { parameter: this.getParameter(id) });\n\t\t// if (this.component)\n\t\t// {\n\t\t// \tBX.onCustomEvent(this.component, 'onTemplateParameterUpdate', [this, this.getParameter(id)]);\n\t\t// }\n\n\t\treturn this.getParameter(id);\n\t}\n\n\tdeleteParameter(id)\n\t{\n\t\tdelete this.#data.PARAMETERS[id];\n\n\t\treturn true;\n\t}\n\n\tsetParameterValue(id, value)\n\t{\n\t\tif (this.#data.PARAMETERS[id])\n\t\t{\n\t\t\tthis.#data.PARAMETERS[id].Default = value;\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetVariables(): []\n\t{\n\t\tconst variables = [];\n\n\t\tObject.keys(this.#data.VARIABLES).forEach((id) => {\n\t\t\tconst variable = Runtime.clone(this.#data.VARIABLES[id]);\n\n\t\t\tvariable.Id = id;\n\t\t\tvariable.ObjectId = 'Variable';\n\t\t\tvariable.SystemExpression = `{=Variable:${id}}`;\n\t\t\tvariable.Expression = `{=Variable:${id}}`;\n\n\t\t\tvariables.push(variable);\n\t\t});\n\n\t\treturn variables;\n\t}\n\n\tgeneratePropertyId(prefix, existsList)\n\t{\n\t\tlet index;\n\t\tfor (index = 1; index <= 1000; ++index)\n\t\t{\n\t\t\tif (!existsList[prefix + index])\n\t\t\t{\n\t\t\t\tbreak; // found\n\t\t\t}\n\t\t}\n\n\t\treturn prefix + index;\n\t}\n\n\tcollectUsages()\n\t{\n\t\tconst usages = {\n\t\t\tDocument: new Set(),\n\t\t\tConstant: new Set(),\n\t\t\tVariable: new Set(),\n\t\t\tParameter: new Set(),\n\t\t\tGlobalConstant: new Set(),\n\t\t\tGlobalVariable: new Set(),\n\t\t\tActivity: new Set(),\n\t\t};\n\n\t\tthis.#robots.forEach((robot) => {\n\t\t\tconst robotUsages = robot.collectUsages();\n\n\t\t\tObject.keys(usages).forEach((key) => {\n\t\t\t\trobotUsages[key].forEach((usage) => {\n\t\t\t\t\tif (!usages[key].has(usage))\n\t\t\t\t\t{\n\t\t\t\t\t\tusages[key].add(usage);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn usages;\n\t}\n\n\tsubscribeRobotEvents(eventName: string, listener: (BaseEvent) => void): this\n\t{\n\t\tthis.#robots.forEach((robot) => robot.subscribe(eventName, listener));\n\n\t\treturn this;\n\t}\n\n\tunsubscribeRobotEvents(eventName: string, listener: (BaseEvent) => void)\n\t{\n\t\tthis.#robots.forEach((robot) => robot.unsubscribe(eventName, listener));\n\n\t\treturn this;\n\t}\n\n\tgetRobotDescription(type: string): ?object\n\t{\n\t\treturn this.#context.availableRobots.find((item) => item.CLASS === type);\n\t}\n\n\tget globalConstants(): []\n\t{\n\t\treturn this.#context.automationGlobals ? this.#context.automationGlobals.globalConstants : [];\n\t}\n\n\tget globalVariables(): []\n\t{\n\t\treturn this.#context.automationGlobals ? this.#context.automationGlobals.globalVariables : [];\n\t}\n}\n","import { Type } from 'main.core';\nimport { Operator } from 'bizproc.condition';\n\nexport class Condition\n{\n\t#object: string;\n\t#field: string;\n\t#operator: string;\n\t#value: string;\n\n\tparentGroup;\n\n\tconstructor(params: ?Object, group)\n\t{\n\t\tthis.#object = 'Document';\n\t\tthis.#field = '';\n\t\tthis.#operator = '!empty';\n\t\tthis.#value = '';\n\n\t\tthis.parentGroup = null;\n\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tif (params.object)\n\t\t\t{\n\t\t\t\tthis.setObject(params.object);\n\t\t\t}\n\n\t\t\tif (params.field)\n\t\t\t{\n\t\t\t\tthis.setField(params.field);\n\t\t\t}\n\n\t\t\tif (params.operator)\n\t\t\t{\n\t\t\t\tthis.setOperator(params.operator);\n\t\t\t}\n\n\t\t\tif ('value' in params)\n\t\t\t{\n\t\t\t\tthis.setValue(params.value);\n\t\t\t}\n\t\t}\n\n\t\tif (group)\n\t\t{\n\t\t\tthis.parentGroup = group;\n\t\t}\n\t}\n\n\tclone(): Condition\n\t{\n\t\treturn new Condition(\n\t\t\t{\n\t\t\t\tobject: this.#object,\n\t\t\t\tfield: this.#field,\n\t\t\t\toperator: this.#operator,\n\t\t\t\tvalue: this.#value,\n\t\t\t},\n\t\t\tthis.parentGroup,\n\t\t);\n\t}\n\n\tsetObject(object)\n\t{\n\t\tif (Type.isStringFilled(object))\n\t\t{\n\t\t\tthis.#object = object;\n\t\t}\n\t}\n\n\tget object()\n\t{\n\t\treturn this.#object;\n\t}\n\n\tsetField(field)\n\t{\n\t\tif (Type.isStringFilled(field))\n\t\t{\n\t\t\tthis.#field = field;\n\t\t}\n\t}\n\n\tget field()\n\t{\n\t\treturn this.#field;\n\t}\n\n\tsetOperator(operator)\n\t{\n\t\tthis.#operator = operator ?? Operator.EQUAL;\n\t}\n\n\tget operator(): string\n\t{\n\t\treturn this.#operator;\n\t}\n\n\tsetValue(value)\n\t{\n\t\tthis.#value = value;\n\t\tif (this.#operator === Operator.EQUAL && this.#value === '')\n\t\t{\n\t\t\tthis.#operator = 'empty';\n\t\t}\n\t\telse if (this.#operator === Operator.NOT_EQUAL && this.#value === '')\n\t\t{\n\t\t\tthis.#operator = '!empty';\n\t\t}\n\t}\n\n\tget value()\n\t{\n\t\treturn this.#value;\n\t}\n\n\tserialize(): Object\n\t{\n\t\treturn {\n\t\t\tobject: this.#object,\n\t\t\tfield: this.#field,\n\t\t\toperator: this.#operator,\n\t\t\tvalue: this.#value,\n\t\t};\n\t}\n}\n","import { Type, Loc } from 'main.core';\nimport { Condition } from './condition';\nimport { ConditionNames } from './types';\nimport { Operator } from 'bizproc.condition';\n\nexport class ConditionGroup\n{\n\tstatic CONDITION_TYPE = {\n\t\tField: 'field',\n\t\tMixed: 'mixed',\n\t};\n\n\tstatic JOINER = {\n\t\tAnd: 'AND',\n\t\tOr: 'OR',\n\n\t\tmessage(type)\n\t\t{\n\t\t\tif (type === this.Or)\n\t\t\t{\n\t\t\t\treturn Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_CONDITION_OR');\n\t\t\t}\n\n\t\t\treturn Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_CONDITION_AND');\n\t\t},\n\t};\n\n\t#type: string;\n\t#items: Array<[Condition, string]>;\n\t#activityNames: ?ConditionNames;\n\n\tconstructor(params: ?Object)\n\t{\n\t\tthis.#type = ConditionGroup.CONDITION_TYPE.Field;\n\t\tthis.#items = [];\n\n\t\tif (Type.isPlainObject(params))\n\t\t{\n\t\t\tif (params.type)\n\t\t\t{\n\t\t\t\tthis.#type = params.type;\n\t\t\t}\n\n\t\t\tif (Type.isArray(params.items))\n\t\t\t{\n\t\t\t\tparams.items.forEach((item) => {\n\t\t\t\t\tconst condition = new Condition(item[0], this);\n\t\t\t\t\tthis.addItem(condition, item[1]);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(params.activityNames))\n\t\t\t{\n\t\t\t\tthis.#activityNames = params.activityNames;\n\t\t\t}\n\t\t}\n\t}\n\n\tclone()\n\t{\n\t\tconst clonedGroup = new ConditionGroup({ type: this.#type });\n\t\tthis.#items.forEach(([condition, joiner]) => {\n\t\t\tconst clonedCondition = condition.clone();\n\t\t\tclonedCondition.parentGroup = clonedGroup;\n\n\t\t\tclonedGroup.addItem(clonedCondition, joiner);\n\t\t});\n\n\t\treturn clonedGroup;\n\t}\n\n\tget conditionNamesList(): Array<string>\n\t{\n\t\tif (Type.isPlainObject(this.#activityNames))\n\t\t{\n\t\t\treturn [\n\t\t\t\tthis.#activityNames.Activity,\n\t\t\t\tthis.#activityNames.Branch1,\n\t\t\t\tthis.#activityNames.Branch2,\n\t\t\t];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tget type()\n\t{\n\t\treturn this.#type;\n\t}\n\n\tset type(type: string)\n\t{\n\t\tif (Object.values(ConditionGroup.CONDITION_TYPE).includes(type))\n\t\t{\n\t\t\tthis.#type = type;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tget items()\n\t{\n\t\treturn this.#items;\n\t}\n\n\tstatic createFromForm(formFields, prefix)\n\t{\n\t\tconst conditionGroup = new ConditionGroup();\n\t\tif (!prefix)\n\t\t{\n\t\t\tprefix = 'condition_';\n\t\t}\n\n\t\tif (Type.isArray(formFields[prefix + 'field']))\n\t\t{\n\t\t\tfor (let i = 0, valueIndex = 0; i < formFields[prefix + 'field'].length; ++i, ++valueIndex)\n\t\t\t{\n\t\t\t\tif (formFields[prefix + 'field'][i] === '')\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst condition = new Condition({}, conditionGroup);\n\t\t\t\tcondition.setObject(formFields[prefix + 'object'][i]);\n\t\t\t\tcondition.setField(formFields[prefix + 'field'][i]);\n\t\t\t\tcondition.setOperator(formFields[prefix + 'operator'][i]);\n\n\t\t\t\tconst value = (\n\t\t\t\t\tcondition.operator === Operator.BETWEEN\n\t\t\t\t\t\t? [formFields[prefix + 'value'][valueIndex], formFields[prefix + 'value'][valueIndex + 1]]\n\t\t\t\t\t\t: formFields[prefix + 'value'][valueIndex]\n\t\t\t\t);\n\t\t\t\tcondition.setValue(value);\n\n\t\t\t\tlet joiner = ConditionGroup.JOINER.And;\n\t\t\t\tif (formFields[prefix + 'joiner'] && formFields[prefix + 'joiner'][i] === ConditionGroup.JOINER.Or)\n\t\t\t\t{\n\t\t\t\t\tjoiner = ConditionGroup.JOINER.Or;\n\t\t\t\t}\n\n\t\t\t\tif (condition.operator === Operator.BETWEEN)\n\t\t\t\t{\n\t\t\t\t\tvalueIndex++;\n\t\t\t\t}\n\n\t\t\t\tconditionGroup.addItem(condition, joiner);\n\t\t\t}\n\t\t}\n\n\t\treturn conditionGroup;\n\t}\n\n\taddItem(condition, joiner)\n\t{\n\t\tthis.#items.push([condition, joiner]);\n\t}\n\n\tgetItems(): Array<Array<Condition, string>>\n\t{\n\t\treturn this.#items;\n\t}\n\n\tserialize()\n\t{\n\t\tconst itemsArray = [];\n\n\t\tthis.#items.forEach((item) => {\n\t\t\tif (item.field !== '')\n\t\t\t{\n\t\t\t\titemsArray.push([item[0].serialize(), item[1]]);\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\ttype: this.#type,\n\t\t\titems: itemsArray,\n\t\t\tactivityNames: this.#activityNames,\n\t\t};\n\t}\n}\n","import {\n\tCondition,\n\tConditionGroup,\n\tDesigner,\n\tgetGlobalContext,\n\tInlineSelectorCondition,\n\tSelectorContext,\n\tSelectorManager,\n} from 'bizproc.automation';\nimport { Dom, Type, Event, Loc, Runtime, Tag, Text } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Button, CancelButton } from 'ui.buttons';\n\nimport type { ConditionSelectorOptions } from './types';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Operator } from 'bizproc.condition';\n\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.actions';\n\nexport class ConditionSelector extends EventEmitter\n{\n\t#condition: ?Condition;\n\t#fields: Array<Object>;\n\t#joiner: string;\n\t#fieldPrefix: string;\n\t#rootGroupTitle: ?string;\n\t#onOpenFieldMenu: ?(BaseEvent) => void;\n\t#onOpenMenu: ?(BaseEvent) => void;\n\t#showValuesSelector: boolean;\n\n\tnode: ?HTMLElement;\n\tobjectNode: ?HTMLElement;\n\tfieldNode: ?HTMLElement;\n\tjoinerNode: ?HTMLElement;\n\tlabelNode: ?HTMLElement;\n\tvalueNode: ?HTMLElement;\n\t#valueNode2: ?HTMLElement = null;\n\n\tpopup: Popup;\n\tfieldDialog: ?InlineSelectorCondition;\n\t#selectedField;\n\n\tconstructor(condition, options: ?ConditionSelectorOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation.Condition');\n\n\t\tthis.#condition = condition;\n\t\tthis.#fields = [];\n\t\tthis.#joiner = ConditionGroup.JOINER.And;\n\t\tthis.#fieldPrefix = 'condition_';\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tif (Type.isArray(options.fields))\n\t\t\t{\n\t\t\t\tthis.#fields = options.fields.map((field) => {\n\t\t\t\t\tfield.ObjectId = 'Document';\n\n\t\t\t\t\treturn field;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (options.joiner && options.joiner === ConditionGroup.JOINER.Or)\n\t\t\t{\n\t\t\t\tthis.#joiner = ConditionGroup.JOINER.Or;\n\t\t\t}\n\n\t\t\tif (options.fieldPrefix)\n\t\t\t{\n\t\t\t\tthis.#fieldPrefix = options.fieldPrefix;\n\t\t\t}\n\n\t\t\tthis.#rootGroupTitle = options.rootGroupTitle;\n\t\t\tthis.#onOpenFieldMenu = options.onOpenFieldMenu;\n\t\t\tthis.#onOpenMenu = options.onOpenMenu;\n\t\t\tthis.#showValuesSelector = options.showValuesSelector ?? true;\n\t\t}\n\t}\n\n\tcreateNode()\n\t{\n\t\tconst value = Type.isArrayFilled(this.#condition.value) ? this.#condition.value[0] : this.#condition.value;\n\t\tconst conditionValueNode = this.#createValueNode(value);\n\n\t\tconst conditionValueNode2 = (\n\t\t\tthis.#condition.operator === Operator.BETWEEN\n\t\t\t\t? this.#createValueNode(\n\t\t\t\t\tType.isArrayFilled(this.#condition.value) && this.#condition.value.length > 1\n\t\t\t\t\t\t? this.#condition.value[1]\n\t\t\t\t\t\t: '',\n\t\t\t\t)\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst {\n\t\t\troot,\n\t\t\tconditionObjectNode,\n\t\t\tconditionFieldNode,\n\t\t\tconditionOperatorNode,\n\t\t\tlabelNode,\n\t\t} = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings__condition-selector ui-draggable--item\">\n\t\t\t\t<div class=\"bizproc-automation-popup-settings__condition-item\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref=\"conditionObjectNode\"\n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\tname=\"${Text.encode(`${this.#fieldPrefix}object[]`)}\"\n\t\t\t\t\t\tvalue=\"${Text.encode(this.#condition.object)}\"\n\t\t\t\t\t/>\n\t\t\t\t\t<input\n\t\t\t\t\t\tref=\"conditionFieldNode\"\n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\tname=\"${Text.encode(`${this.#fieldPrefix}field[]`)}\"\n\t\t\t\t\t\tvalue=\"${Text.encode(this.#condition.field)}\"\n\t\t\t\t\t/>\n\t\t\t\t\t<input\n\t\t\t\t\t\tref=\"conditionOperatorNode\"\n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\tname=\"${Text.encode(`${this.#fieldPrefix}operator[]`)}\"\n\t\t\t\t\t\tvalue=\"${Text.encode(this.#condition.operator)}\"\n\t\t\t\t\t/>\n\t\t\t\t\t${conditionValueNode}\n\t\t\t\t\t${conditionValueNode2}\n\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__condition-item_draggable\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --more-points\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref=\"labelNode\"\n\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings__condition-item_content\"\n\t\t\t\t\t></div>\n\t\t\t\t\t${this.#createRemoveButton()}\n\t\t\t\t</div>\n\t\t\t\t${this.#createJoinerSwitcher()}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.node = root;\n\t\tthis.objectNode = conditionObjectNode;\n\t\tthis.fieldNode = conditionFieldNode;\n\t\tthis.operatorNode = conditionOperatorNode;\n\t\tthis.valueNode = conditionValueNode;\n\t\tthis.#valueNode2 = conditionValueNode2 === '' ? null : conditionValueNode2;\n\t\tthis.labelNode = labelNode;\n\n\t\tthis.setLabelText();\n\t\tthis.bindLabelNode();\n\n\t\treturn this.node;\n\t}\n\n\t#createValueNode(value: string): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<input\n\t\t\t\ttype=\"hidden\"\n\t\t\t\tname=\"${Text.encode(`${this.#fieldPrefix}value[]`)}\"\n\t\t\t\tvalue=\"${Text.encode(value)}\"\n\t\t\t>\n\t\t`;\n\t}\n\n\t#createRemoveButton(): HTMLDivElement\n\t{\n\t\tconst { root, removeButtonNode } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings__condition-item_close\">\n\t\t\t\t<div ref=\"removeButtonNode\" class=\"ui-icon-set --cross-20\"></div>\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(removeButtonNode, 'click', this.removeCondition.bind(this));\n\n\t\treturn root;\n\t}\n\n\t#createJoinerSwitcher(): HTMLDivElement\n\t{\n\t\tconst { root, switcherBtnAnd, switcherBtnOr, inputNode } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings__condition-switcher\">\n\t\t\t\t<div class=\"bizproc-automation-popup-settings__condition-switcher_wrapper\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tref=\"switcherBtnAnd\"\n\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings__condition-switcher_btn ${this.#joiner === 'AND' ? '--active' : ''}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_CONDITION_AND')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tref=\"switcherBtnOr\"\n\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings__condition-switcher_btn ${this.#joiner === 'OR' ? '--active' : ''}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_CONDITION_OR')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<input\n\t\t\t\t\tref=\"inputNode\"\n\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\tname=\"${Text.encode(`${this.#fieldPrefix}joiner[]`)}\"\n\t\t\t\t\tvalue=\"${Text.encode(this.#joiner)}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\t\tthis.joinerNode = inputNode;\n\n\t\tEvent.bind(root, 'click', () => {\n\t\t\tthis.#joiner = (this.#joiner === ConditionGroup.JOINER.Or ? ConditionGroup.JOINER.And : ConditionGroup.JOINER.Or);\n\t\t\tif (this.joinerNode)\n\t\t\t{\n\t\t\t\tthis.joinerNode.value = this.#joiner;\n\t\t\t}\n\n\t\t\tDom.toggleClass(switcherBtnOr, '--active');\n\t\t\tDom.toggleClass(switcherBtnAnd, '--active');\n\t\t});\n\n\t\treturn root;\n\t}\n\n\tinit(condition: Condition)\n\t{\n\t\tthis.#condition = condition;\n\t\tthis.setLabelText();\n\t\tthis.bindLabelNode();\n\t}\n\n\tsetLabelText()\n\t{\n\t\tif (!this.labelNode || !this.#condition)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.clean(this.labelNode);\n\n\t\tif (this.#condition.field === '')\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<span class=\"bizproc-automation-popup-settings__condition-text\">\n\t\t\t\t\t\t${Text.encode(this.getOperatorLabel(Operator.EMPTY))}\n\t\t\t\t\t</span>\n\t\t\t\t`,\n\t\t\t\tthis.labelNode,\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst field = this.getField(this.#condition.object, this.#condition.field) || '?';\n\t\t\tconst valueLabel = this.#getValueLabel(field);\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`<span class=\"bizproc-automation-popup-settings__condition-text\">${Text.encode(field.Name)}</span>`,\n\t\t\t\tthis.labelNode,\n\t\t\t);\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<span class=\"bizproc-automation-popup-settings__condition-text\">\n\t\t\t\t\t\t${Text.encode(this.getOperatorLabel(this.#condition.operator))}\n\t\t\t\t\t</span>\n\t\t\t\t`,\n\t\t\t\tthis.labelNode,\n\t\t\t);\n\n\t\t\tif (valueLabel)\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<span class=\"bizproc-automation-popup-settings__condition-text\">${Text.encode(valueLabel)}</span>`,\n\t\t\t\t\tthis.labelNode,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t#getValueLabel(field): ?string\n\t{\n\t\tconst operator = this.#condition.operator;\n\t\tconst value = this.#condition.value;\n\n\t\tif (operator === 'between')\n\t\t{\n\t\t\treturn (\n\t\t\t\tLoc.getMessage(\n\t\t\t\t\t'BIZPROC_AUTOMATION_ROBOT_CONDITION_BETWEEN_VALUE_1',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#VALUE_1#': BX.Bizproc.FieldType.formatValuePrintable(\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tType.isArrayFilled(value) ? value[0] : value,\n\t\t\t\t\t\t),\n\t\t\t\t\t\t'#VALUE_2#': BX.Bizproc.FieldType.formatValuePrintable(\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tType.isArrayFilled(value) ? value[1] : '',\n\t\t\t\t\t\t),\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tif (!operator.includes('empty'))\n\t\t{\n\t\t\treturn BX.Bizproc.FieldType.formatValuePrintable(field, value);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tbindLabelNode()\n\t{\n\t\tif (this.labelNode)\n\t\t{\n\t\t\tEvent.bind(this.labelNode, 'click', this.onLabelClick.bind(this));\n\t\t}\n\t}\n\n\tonLabelClick()\n\t{\n\t\tthis.showPopup();\n\t}\n\n\tshowPopup()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst fields = this.filterFields();\n\n\t\tconst objectSelect = Tag.render`<input type=\"hidden\" class=\"bizproc-automation-popup-settings-dropdown\"/>`;\n\t\tconst { root: fieldSelectLabel, fieldSelect } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings-dropdown\" readonly=\"readonly\">\n\t\t\t\t<input ref=\"fieldSelect\" type=\"hidden\" class=\"bizproc-automation-popup-settings-dropdown\"/>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(\n\t\t\tfieldSelectLabel,\n\t\t\t'click',\n\t\t\tthis.onFieldSelectorClick.bind(this, fieldSelectLabel, fieldSelect, fields, objectSelect),\n\t\t);\n\n\t\tlet selectedField = this.getField(this.#condition.object, this.#condition.field);\n\t\tif (!this.#condition.field)\n\t\t{\n\t\t\tselectedField = fields[0];\n\t\t}\n\n\t\tthis.#selectedField = selectedField;\n\n\t\tfieldSelect.value = selectedField.Id;\n\t\tobjectSelect.value = selectedField.ObjectId;\n\t\tfieldSelectLabel.textContent = selectedField.Name;\n\n\t\tconst valueInput = this.#getValueNode(selectedField, this.#condition.value, this.#condition.operator);\n\t\tconst valueWrapper = Tag.render`<div class=\"bizproc-automation-popup-settings\">${valueInput}</div>`;\n\n\t\tconst operatorSelect = this.createOperatorNode(selectedField, valueWrapper);\n\t\tif (this.#condition.field !== '')\n\t\t{\n\t\t\toperatorSelect.value = this.#condition.operator;\n\t\t}\n\n\t\tconst { root: form, operatorWrapper } = Tag.render`\n\t\t\t<form class=\"bizproc-automation-popup-select-block\">\n\t\t\t\t<div class=\"bizproc-automation-popup-settings\">${fieldSelectLabel}</div>\n\t\t\t\t<div ref=\"operatorWrapper\" class=\"bizproc-automation-popup-settings\">${operatorSelect}</div>\n\t\t\t\t${valueWrapper}\n\t\t\t</form>\n\t\t`;\n\t\tEvent.bind(fieldSelect, 'change', this.onFieldChange.bind(\n\t\t\tthis,\n\t\t\tfieldSelect,\n\t\t\toperatorWrapper,\n\t\t\tvalueWrapper,\n\t\t\tobjectSelect,\n\t\t));\n\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bizproc-automation-popup-set',\n\t\t\tbindElement: this.labelNode,\n\t\t\tcontent: form,\n\t\t\tcloseByEsc: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\tcolor: Button.Color.PRIMARY,\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_JS_AUTOMATION_CHOOSE_BUTTON_CAPS'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.#condition.setObject(objectSelect.value);\n\t\t\t\t\t\tthis.#condition.setField(fieldSelect.value);\n\t\t\t\t\t\tthis.#condition.setOperator(operatorWrapper.firstChild.value);\n\n\t\t\t\t\t\tconst valueInputs = valueWrapper.querySelectorAll(`[name^=\"${this.#fieldPrefix}value\"]`);\n\n\t\t\t\t\t\tif (valueInputs.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet value = valueInputs[valueInputs.length - 1].value;\n\n\t\t\t\t\t\t\tif (this.#condition.operator === Operator.BETWEEN && valueInputs.length > 1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvalue = [valueInputs[0].value, valueInputs[1].value];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.#condition.setValue(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#condition.setValue('');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setLabelText();\n\n\t\t\t\t\t\tconst field = this.getField(this.#condition.object, this.#condition.field);\n\t\t\t\t\t\tif (field && field.Type === 'UF:address')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst input = valueWrapper.querySelector(`[name=\"${this.#fieldPrefix}value\"]`);\n\t\t\t\t\t\t\tthis.#condition.setValue(input ? input.value : '');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.updateValueNode();\n\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew CancelButton({\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_JS_AUTOMATION_CANCEL_BUTTON_CAPS'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t\tclassName: 'bizproc-automation-popup-set',\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: false,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.popup.destroy();\n\t\t\t\t\tif (this.fieldDialog)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.fieldDialog.destroy();\n\t\t\t\t\t\tdelete this.fieldDialog;\n\t\t\t\t\t}\n\n\t\t\t\t\tdelete this.popup;\n\t\t\t\t},\n\t\t\t},\n\t\t\ttitleBar: false,\n\t\t\tangle: true,\n\t\t\toverlay: { backgroundColor: 'transparent' },\n\t\t\toffsetLeft: 45,\n\t\t});\n\n\t\tthis.popup.show();\n\t}\n\n\tonFieldSelectorClick(fieldSelectLabel, fieldSelect, fields, objectSelect, event)\n\t{\n\t\tif (!this.fieldDialog)\n\t\t{\n\t\t\tconst globalContext = getGlobalContext();\n\t\t\tconst fields = Runtime.clone(\n\t\t\t\tType.isArrayFilled(this.#fields) ? this.#fields : globalContext.document.getFields(),\n\t\t\t);\n\n\t\t\tthis.fieldDialog = new InlineSelectorCondition({\n\t\t\t\tcontext: new SelectorContext({\n\t\t\t\t\tfields,\n\t\t\t\t\trootGroupTitle: globalContext.document.title,\n\t\t\t\t}),\n\t\t\t\tcondition: this.#condition,\n\t\t\t});\n\n\t\t\tif (Type.isFunction(this.#onOpenFieldMenu))\n\t\t\t{\n\t\t\t\tthis.fieldDialog.subscribe('onOpenMenu', this.#onOpenFieldMenu);\n\t\t\t}\n\n\t\t\tthis.fieldDialog.subscribe('change', (event) => {\n\t\t\t\tconst property = event.getData().field;\n\t\t\t\tfieldSelectLabel.textContent = property.Name;\n\t\t\t\tfieldSelect.value = property.Id;\n\t\t\t\tobjectSelect.value = property.ObjectId;\n\t\t\t\tBX.fireEvent(fieldSelect, 'change');\n\t\t\t});\n\n\t\t\tthis.fieldDialog.renderTo(fieldSelectLabel);\n\t\t}\n\n\t\tthis.fieldDialog.openMenu(event);\n\t}\n\n\tupdateValueNode()\n\t{\n\t\tif (this.#condition)\n\t\t{\n\t\t\tif (this.objectNode)\n\t\t\t{\n\t\t\t\tthis.objectNode.value = this.#condition.object;\n\t\t\t}\n\n\t\t\tif (this.fieldNode)\n\t\t\t{\n\t\t\t\tthis.fieldNode.value = this.#condition.field;\n\t\t\t}\n\n\t\t\tif (this.operatorNode)\n\t\t\t{\n\t\t\t\tthis.operatorNode.value = this.#condition.operator;\n\t\t\t}\n\n\t\t\tif (this.valueNode)\n\t\t\t{\n\t\t\t\tthis.valueNode.value = (\n\t\t\t\t\tType.isArrayFilled(this.#condition.value)\n\t\t\t\t\t\t? this.#condition.value[0]\n\t\t\t\t\t\t: this.#condition.value\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (this.#condition.operator === Operator.BETWEEN)\n\t\t\t{\n\t\t\t\tconst value2 = this.#condition.value[1] || '';\n\t\t\t\tif (this.#valueNode2)\n\t\t\t\t{\n\t\t\t\t\tthis.#valueNode2.value = value2;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#valueNode2 = this.#createValueNode(value2);\n\t\t\t\t\tDom.append(this.#valueNode2, this.node);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (Type.isDomNode(this.#valueNode2))\n\t\t\t{\n\t\t\t\tDom.remove(this.#valueNode2);\n\t\t\t\tthis.#valueNode2 = null;\n\t\t\t}\n\t\t}\n\t}\n\n\tonFieldChange(selectNode: Node, conditionWrapper: Node, valueWrapper: Node, objectSelect)\n\t{\n\t\tconst field = this.getField(objectSelect.value, selectNode.value);\n\t\tconst operatorNode = this.createOperatorNode(field, valueWrapper);\n\n\t\t// clean value if field types are different\n\t\tif (field.Type !== this.#selectedField?.Type)\n\t\t{\n\t\t\tDom.clean(valueWrapper);\n\t\t}\n\t\tthis.#selectedField = field;\n\n\t\t// keep selected operator if possible\n\t\tif (this.getOperators(field.Type, field.Multiple)[conditionWrapper.firstChild.value])\n\t\t{\n\t\t\toperatorNode.value = conditionWrapper.firstChild.value;\n\t\t}\n\n\t\tconditionWrapper.replaceChild(operatorNode, conditionWrapper.firstChild);\n\t\tthis.onOperatorChange(operatorNode, field, valueWrapper);\n\t}\n\n\tonOperatorChange(selectNode: Node, field: Object, valueWrapper: HTMLElement)\n\t{\n\t\tconst valueInput = valueWrapper.querySelector(`[name^=\"${this.#fieldPrefix}value\"]`);\n\t\tDom.clean(valueWrapper);\n\n\t\tDom.append(\n\t\t\tthis.#getValueNode(field, valueInput?.value || this.#condition.value, selectNode.value),\n\t\t\tvalueWrapper,\n\t\t);\n\t}\n\n\t#getValueNode(field: {}, value, operator: string): any\n\t{\n\t\tif (operator === Operator.BETWEEN)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t${this.createValueNode(field, Type.isArrayFilled(value) ? value[0] : value)}\n\t\t\t\t\t<div style=\"height: 8px;\"></div>\n\t\t\t\t\t${this.createValueNode(field, Type.isArrayFilled(value) ? value[1] : '')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (!operator.includes('empty'))\n\t\t{\n\t\t\treturn this.createValueNode(field, value);\n\t\t}\n\n\t\treturn '';\n\t}\n\n\t// TODO - fix this method\n\tgetField(object, id)\n\t{\n\t\tlet field;\n\t\tconst robot = Designer.getInstance().robot;\n\t\tconst component = Designer.getInstance().component;\n\t\tconst tpl = robot ? robot.getTemplate() : null;\n\n\t\tswitch (object)\n\t\t{\n\t\t\tcase 'Document':\n\t\t\t\tfor (let i = 0; i < this.#fields.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tif (id === this.#fields[i].Id)\n\t\t\t\t\t{\n\t\t\t\t\t\tfield = this.#fields[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'Template':\n\t\t\t\tif (tpl && component && component.triggerManager)\n\t\t\t\t{\n\t\t\t\t\tfield = component.triggerManager.getReturnProperty(tpl.getStatusId(), id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'Constant':\n\t\t\t\tif (tpl)\n\t\t\t\t{\n\t\t\t\t\tfield = tpl.getConstant(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'GlobalConst':\n\t\t\t\tif (component)\n\t\t\t\t{\n\t\t\t\t\tfield = component.getConstant(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'GlobalVar':\n\t\t\t\tif (component)\n\t\t\t\t{\n\t\t\t\t\tfield = component.getGVariable(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tvar foundRobot = tpl? tpl.getRobotById(object) : null;\n\t\t\t\tif (foundRobot)\n\t\t\t\t{\n\t\t\t\t\tfield = foundRobot.getReturnProperty(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn field || {\n\t\t\tId: id,\n\t\t\tObjectId: object,\n\t\t\tName: id,\n\t\t\tType: 'string',\n\t\t\tExpression: id,\n\t\t\tSystemExpression: `{=${object}:${id}}`,\n\t\t};\n\t}\n\n\tgetOperators(fieldType, multiple): {}\n\t{\n\t\tconst allLabels = Operator.getAllLabels();\n\n\t\tlet list = {\n\t\t\t'!empty': allLabels[Operator.NOT_EMPTY],\n\t\t\t'empty': allLabels[Operator.EMPTY],\n\t\t\t'=': allLabels[Operator.EQUAL],\n\t\t\t'!=': allLabels[Operator.NOT_EQUAL],\n\t\t};\n\t\tswitch (fieldType)\n\t\t{\n\t\t\tcase 'file':\n\t\t\tcase 'UF:crm':\n\t\t\tcase 'UF:resourcebooking':\n\t\t\tcase 'email':\n\t\t\tcase 'phone':\n\t\t\tcase 'web':\n\t\t\tcase 'im':\n\t\t\t\tlist = {\n\t\t\t\t\t'!empty': allLabels[Operator.NOT_EMPTY],\n\t\t\t\t\t'empty': allLabels[Operator.EMPTY],\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase 'bool':\n\t\t\tcase 'select':\n\t\t\t\tif (multiple)\n\t\t\t\t{\n\t\t\t\t\tlist[Operator.CONTAIN] = allLabels[Operator.CONTAIN];\n\t\t\t\t\tlist[Operator.NOT_CONTAIN] = allLabels[Operator.NOT_CONTAIN];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t//TODO: render multiple select in value selector\n\t\t\t\t\t//list['in'] = Loc.getMessage('BIZPROC_AUTOMATION_ROBOT_CONDITION_IN');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'user':\n\t\t\t\tlist[Operator.IN] = allLabels[Operator.IN];\n\t\t\t\tlist[Operator.NOT_IN] = allLabels[Operator.NOT_IN];\n\t\t\t\tlist[Operator.CONTAIN] = allLabels[Operator.CONTAIN];\n\t\t\t\tlist[Operator.NOT_CONTAIN] = allLabels[Operator.NOT_CONTAIN];\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlist[Operator.IN] = allLabels[Operator.IN];\n\t\t\t\tlist[Operator.NOT_IN] = allLabels[Operator.NOT_IN];\n\t\t\t\tlist[Operator.CONTAIN] = allLabels[Operator.CONTAIN];\n\t\t\t\tlist[Operator.NOT_CONTAIN] = allLabels[Operator.NOT_CONTAIN];\n\t\t\t\tlist[Operator.GREATER_THEN] = allLabels[Operator.GREATER_THEN];\n\t\t\t\tlist[Operator.GREATER_THEN_OR_EQUAL] = allLabels[Operator.GREATER_THEN_OR_EQUAL];\n\t\t\t\tlist[Operator.LESS_THEN] = allLabels[Operator.LESS_THEN];\n\t\t\t\tlist[Operator.LESS_THEN_OR_EQUAL] = allLabels[Operator.LESS_THEN_OR_EQUAL];\n\t\t}\n\n\t\tif (['time', 'date', 'datetime', 'int', 'double'].includes(fieldType) || Type.isUndefined(fieldType))\n\t\t{\n\t\t\tlist[Operator.BETWEEN] = allLabels[Operator.BETWEEN];\n\t\t}\n\n\t\treturn list;\n\t}\n\n\tgetOperatorLabel(id): string\n\t{\n\t\treturn Operator.getOperatorLabel(id);\n\t}\n\n\tfilterFields()\n\t{\n\t\tconst filtered = [];\n\t\tfor (let i = 0; i < this.#fields.length; ++i)\n\t\t{\n\t\t\tconst type = this.#fields[i].Type;\n\n\t\t\tif (\n\t\t\t\ttype === 'bool'\n\t\t\t\t|| type === 'date'\n\t\t\t\t|| type === 'datetime'\n\t\t\t\t|| type === 'double'\n\t\t\t\t|| type === 'file'\n\t\t\t\t|| type === 'int'\n\t\t\t\t|| type === 'select'\n\t\t\t\t|| type === 'string'\n\t\t\t\t|| type === 'text'\n\t\t\t\t|| type === 'user'\n\t\t\t\t|| type === 'UF:money'\n\t\t\t\t|| type === 'UF:crm'\n\t\t\t\t|| type === 'UF:resourcebooking'\n\t\t\t\t|| type === 'UF:url'\n\t\t\t)\n\t\t\t{\n\t\t\t\tfiltered.push(this.#fields[i]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// TODO add support of custom types\n\t\t\t}\n\t\t}\n\n\t\treturn filtered;\n\t}\n\n\tcreateValueNode(docField, value)\n\t{\n\t\tconst currentDocument = (\n\t\t\tDesigner.getInstance().component\n\t\t\t\t? Designer.getInstance().component.document\n\t\t\t\t: getGlobalContext().document\n\t\t);\n\n\t\tconst docType = [...currentDocument.getRawType(), currentDocument.getCategoryId()];\n\n\t\tconst field = Runtime.clone(docField);\n\t\tfield.Multiple = false;\n\n\t\tconst valueNodes = BX.Bizproc.FieldType.renderControlPublic(\n\t\t\tdocType,\n\t\t\tfield,\n\t\t\t`${this.#fieldPrefix}value`,\n\t\t\tvalue,\n\t\t\tfalse,\n\t\t);\n\n\t\tvalueNodes.querySelectorAll('[data-role]').forEach((node) => {\n\t\t\tconst selector = SelectorManager.createSelectorByRole(node.dataset.role, {\n\t\t\t\tcontext: new SelectorContext({\n\t\t\t\t\tfields: getGlobalContext().document.getFields(),\n\t\t\t\t\tuseSwitcherMenu: false,\n\t\t\t\t\trootGroupTitle: this.#rootGroupTitle ?? getGlobalContext().document.title,\n\t\t\t\t}),\n\t\t\t});\n\n\t\t\tif (selector)\n\t\t\t{\n\t\t\t\tif (this.#showValuesSelector === true)\n\t\t\t\t{\n\t\t\t\t\tif (Type.isFunction(this.#onOpenMenu))\n\t\t\t\t\t{\n\t\t\t\t\t\tselector.subscribe('onOpenMenu', this.#onOpenMenu);\n\t\t\t\t\t}\n\t\t\t\t\tselector.renderTo(node);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tselector.targetInput = node;\n\t\t\t\t\tselector.parseTargetProperties();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn valueNodes;\n\t}\n\n\tcreateOperatorNode(field, valueWrapper)\n\t{\n\t\tconst select = Dom.create('select', {\n\t\t\tattrs: { className: 'bizproc-automation-popup-settings-dropdown' },\n\t\t});\n\n\t\tconst operatorList = this.getOperators(field.Type, field.Multiple);\n\t\tfor (const operatorId in operatorList)\n\t\t{\n\t\t\tif (!operatorList.hasOwnProperty(operatorId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<option value=\"${Text.encode(operatorId)}\">${Text.encode(operatorList[operatorId])}</option>\n\t\t\t\t`,\n\t\t\t\tselect,\n\t\t\t);\n\t\t}\n\n\t\tEvent.bind(select, 'change', this.onOperatorChange.bind(\n\t\t\tthis,\n\t\t\tselect,\n\t\t\tfield,\n\t\t\tvalueWrapper,\n\t\t));\n\n\t\treturn select;\n\t}\n\n\tremoveCondition(event: Event)\n\t{\n\t\tthis.emit('onRemoveConditionClick', new BaseEvent({ data: { conditionSelector: this } }));\n\n\t\tthis.#condition = null;\n\t\tDom.remove(this.node);\n\n\t\tthis.labelNode = null;\n\t\tthis.fieldNode = null;\n\t\tthis.operatorNode = null;\n\t\tthis.valueNode = null;\n\t\tthis.#valueNode2 = null;\n\t\tthis.node = null;\n\n\t\tevent.stopPropagation();\n\t}\n\n\tchangeJoiner(btn: Element, event: Event)\n\t{}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n}\n","import { Type, Dom, Event, Tag, Loc, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { Condition, ConditionGroup } from 'bizproc.automation';\nimport { ConditionSelector } from './condition-selector';\nimport { Draggable } from 'ui.draganddrop.draggable';\n\ntype ConditionGroupSelectorOptions = {\n\tfields: Array<Object>,\n\tfieldPrefix: string,\n\trootGroupTitle: string,\n\tonOpenFieldMenu: ?(BaseEvent) => void,\n\tonOpenMenu: ?(BaseEvent) => void,\n\tshowValuesSelector: boolean,\n\tcaption: ?{\n\t\thead: string,\n\t\tadd: string,\n\t\tcollapsed: string,\n\t},\n\tisExpanded: boolean,\n};\n\nexport class ConditionGroupSelector extends EventEmitter\n{\n\tmodern: boolean = true;// todo: remove 2024\n\n\t#conditionGroup: ConditionGroup;\n\t#fields: Array<Object>;\n\t#fieldPrefix: string;\n\t#itemSelectors: Array<ConditionSelector>;\n\t#onOpenFieldMenu: ?(BaseEvent) => void;\n\t#onOpenMenu: ?(BaseEvent) => void;\n\t#showValuesSelector: boolean;\n\t#rootGroupTitle: ?string;\n\n\t#options: ConditionGroupSelectorOptions = {};\n\t#toggleButtonNode: HTMLDivElement;\n\t#draggableNode: HTMLDivElement;\n\n\tconstructor(conditionGroup: ConditionGroup, options: ConditionGroupSelectorOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation.Condition');\n\n\t\tthis.#conditionGroup = conditionGroup;\n\t\tthis.#fields = [];\n\t\tthis.#fieldPrefix = 'condition_';\n\t\tthis.#itemSelectors = [];\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tif (Type.isArray(options.fields))\n\t\t\t{\n\t\t\t\tthis.#fields = options.fields;\n\t\t\t}\n\n\t\t\tif (options.fieldPrefix)\n\t\t\t{\n\t\t\t\tthis.#fieldPrefix = options.fieldPrefix;\n\t\t\t}\n\n\t\t\tthis.#rootGroupTitle = options.rootGroupTitle;\n\t\t\tthis.#onOpenFieldMenu = options.onOpenFieldMenu;\n\t\t\tthis.#onOpenMenu = options.onOpenMenu;\n\t\t\tthis.#showValuesSelector = options.showValuesSelector ?? true;\n\n\t\t\tthis.#options = options;\n\t\t}\n\t}\n\n\tcreateNode()\n\t{\n\t\tthis.#conditionGroup.getItems().forEach((item) => {\n\t\t\tconst conditionSelector = new ConditionSelector(item[0], {\n\t\t\t\tfields: this.#fields,\n\t\t\t\tjoiner: item[1],\n\t\t\t\tfieldPrefix: this.#fieldPrefix,\n\t\t\t\trootGroupTitle: this.#rootGroupTitle,\n\t\t\t\tonOpenFieldMenu: this.#onOpenFieldMenu,\n\t\t\t\tonOpenMenu: this.#onOpenMenu,\n\t\t\t\tshowValuesSelector: this.#showValuesSelector,\n\t\t\t});\n\t\t\tconditionSelector.subscribe('onRemoveConditionClick', this.#onRemoveConditionClick.bind(this));\n\n\t\t\tthis.#itemSelectors.push(conditionSelector);\n\t\t});\n\n\t\tconst hasConditions = this.#conditionGroup.items.length > 0;\n\t\tconst isCollapsed = this.#options.isExpanded !== true && hasConditions;\n\n\t\tconst collapseButtonTitle = (\n\t\t\tisCollapsed\n\t\t\t\t? Loc.getMessage('BIZPROC_JS_AUTOMATION_EXPAND_CONDITION')\n\t\t\t\t: Loc.getMessage('BIZPROC_JS_AUTOMATION_COLLAPSE_CONDITION')\n\t\t);\n\n\t\tconst { root, conditionContent, btnToggleList, btnTextNode, addButton, draggableNode } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings\">\n\t\t\t\t<div\n\t\t\t\t\tref=\"conditionContent\"\n\t\t\t\t\tclass=\"bizproc-automation-popup-settings__condition-content ${isCollapsed ? '' : '--active'}\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__condition-header\">\n\t\t\t\t\t\t<span class=\"bizproc-automation-popup-settings-title\">\n\t\t\t\t\t\t\t${Text.encode(this.#options.caption?.head)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tref=\"btnToggleList\"\n\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings__btn-toggle ${hasConditions ? '' : '--disabled'}\"\n\t\t\t\t\t\t\tdata-role=\"condition-toggle\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span ref=\"btnTextNode\" class=\"bizproc-automation-popup-settings-title\">\n\t\t\t\t\t\t\t\t${collapseButtonTitle}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<div class=\"ui-icon-set --chevron-down\" style=\"--ui-icon-set__icon-size: 16px;\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__transition-height-wrapper\">\n\t\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__transition-height-content\">\n\t\t\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__condition-body\">\n\t\t\t\t\t\t\t\t<div ref=\"draggableNode\" class=\"bizproc-automation-popup-settings__condition\">\n\t\t\t\t\t\t\t\t\t${this.#itemSelectors.map((selector) => selector.createNode())}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span class=\"bizproc-automation-popup-settings-link-wrapper\">\n\t\t\t\t\t\t\t\t\t<a ref=\"addButton\" class=\"bizproc-automation-popup-settings-link\">\n\t\t\t\t\t\t\t\t\t\t${Text.encode(this.#options.caption?.add || Loc.getMessage('BIZPROC_JS_AUTOMATION_ADD_CONDITION'))}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__transition-height-wrapper --revert\">\n\t\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__transition-height-content\">\n\t\t\t\t\t\t\t<div class=\"bizproc-automation-popup-settings__condition-help\">\n\t\t\t\t\t\t\t\t${Text.encode(this.#options.caption?.collapsed || Loc.getMessage('BIZPROC_JS_AUTOMATION_CONDITION_COLLAPSED_TITLE_1'))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tthis.#toggleButtonNode = btnToggleList;\n\t\tthis.#draggableNode = draggableNode;\n\n\t\tEvent.bind(btnToggleList, 'click', this.#onToggleGroupViewClick.bind(this, conditionContent, btnTextNode));\n\t\tEvent.bind(addButton, 'click', this.addItem.bind(this));\n\t\tthis.#initDragNDrop();\n\n\t\treturn root;\n\t}\n\n\t#onToggleGroupViewClick(content, toggleText)\n\t{\n\t\tDom.toggleClass(content, '--active');\n\t\tconst isExpanded = Dom.hasClass(content, '--active');\n\n\t\tDom.adjust(\n\t\t\ttoggleText,\n\t\t\t{\n\t\t\t\ttext: (\n\t\t\t\t\tisExpanded\n\t\t\t\t\t\t? Loc.getMessage('BIZPROC_JS_AUTOMATION_COLLAPSE_CONDITION')\n\t\t\t\t\t\t: Loc.getMessage('BIZPROC_JS_AUTOMATION_EXPAND_CONDITION')\n\t\t\t\t),\n\t\t\t},\n\t\t);\n\n\t\tthis.emit(\n\t\t\t'onToggleGroupViewClick',\n\t\t\tnew BaseEvent({ data: { isCollapsed: !isExpanded, isExpanded } }),\n\t\t);\n\t}\n\n\t#initDragNDrop()\n\t{\n\t\tnew Draggable({\n\t\t\tcontainer: this.#draggableNode,\n\t\t\ttype: Draggable.CLONE,\n\t\t\tdraggable: '.bizproc-automation-popup-settings__condition-selector',\n\t\t\tdragElement: '.bizproc-automation-popup-settings__condition-item_draggable',\n\t\t});\n\t}\n\n\taddItem()\n\t{\n\t\tconst conditionSelector = new ConditionSelector(new Condition({}, this.#conditionGroup), {\n\t\t\tfields: this.#fields,\n\t\t\tfieldPrefix: this.#fieldPrefix,\n\t\t\trootGroupTitle: this.#rootGroupTitle,\n\t\t\tonOpenFieldMenu: this.#onOpenFieldMenu,\n\t\t\tonOpenMenu: this.#onOpenMenu,\n\t\t\tshowValuesSelector: this.#showValuesSelector,\n\t\t});\n\t\tconditionSelector.subscribe('onRemoveConditionClick', this.#onRemoveConditionClick.bind(this));\n\t\tthis.#itemSelectors.push(conditionSelector);\n\n\t\tDom.append(conditionSelector.createNode(), this.#draggableNode);\n\t\tif (Dom.hasClass(this.#toggleButtonNode, '--disabled'))\n\t\t{\n\t\t\tDom.removeClass(this.#toggleButtonNode, '--disabled');\n\t\t}\n\t}\n\n\t#onRemoveConditionClick(event: BaseEvent)\n\t{\n\t\tconst conditionSelector = event.getData().conditionSelector;\n\t\tif (conditionSelector)\n\t\t{\n\t\t\tconst index = this.#itemSelectors.indexOf(conditionSelector);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tthis.#itemSelectors.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\tif (this.#itemSelectors.length <= 0 && !Dom.hasClass(this.#toggleButtonNode, '--disabled'))\n\t\t{\n\t\t\tDom.addClass(this.#toggleButtonNode, '--disabled');\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#itemSelectors.forEach((selector) => selector.destroy());\n\t\tthis.#itemSelectors = [];\n\t}\n}\n","import { SelectorContext, DelayIntervalSelector, Helper, DelayInterval } from 'bizproc.automation';\nimport { Dom, Event, Type, Loc, Tag, Runtime } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Field, MenuGroupItem } from './types';\nimport { MenuManager, Menu } from 'main.popup';\nimport { Dialog } from 'ui.entity-selector';\n\nexport class InlineSelector extends EventEmitter\n{\n\tcontext: SelectorContext;\n\tfieldProperty: ?Field = null;\n\treplaceOnWrite: boolean = false;\n\tmenuButton: ?HTMLSpanElement = null;\n\ttargetInput: ?HTMLElement = null;\n\t#menuGroups: Object<string, MenuGroupItem> = {};\n\tbasisFields: Array<Object> = [];\n\t#dialog: ?Dialog = null;\n\t#switcherDialog: ?Menu = null;\n\n\tconstructor(props: { context: SelectorContext })\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Bizproc.Automation.Selector');\n\n\t\tthis.context = props.context;\n\t\tthis.basisFields = this.context.fields;\n\t}\n\n\thasGroup(groupId: string): boolean\n\t{\n\t\treturn this.#menuGroups.hasOwnProperty(groupId);\n\t}\n\n\taddGroup(groupId: string, group: MenuGroupItem)\n\t{\n\t\tthis.#menuGroups[groupId] = this.#normalizeGroup(group);\n\t}\n\n\taddGroupItem(groupId: string, item: MenuGroupItem)\n\t{\n\t\tif (this.hasGroup(groupId))\n\t\t{\n\t\t\tthis.#menuGroups[groupId].children.push(this.#normalizeGroup(item));\n\t\t}\n\t}\n\n\t#normalizeGroup(group: MenuGroupItem)\n\t{\n\t\tif (!Type.isArray(group.children))\n\t\t{\n\t\t\tgroup.children = [];\n\t\t}\n\n\t\tgroup.children = (\n\t\t\tgroup\n\t\t\t\t.children\n\t\t\t\t.filter(item => item.customData?.field ? this.#shouldShowField(item.customData.field) : true)\n\t\t\t\t.map(childGroup => this.#normalizeGroup(childGroup))\n\t\t);\n\n\t\treturn {\n\t\t\tentityId: 'bp',\n\t\t\ttabs: 'recents',\n\t\t\t...group\n\t\t};\n\t}\n\n\trenderWith(targetInput: Element): HTMLDivElement\n\t{\n\t\tthis.targetInput = Runtime.clone(targetInput);\n\t\tthis.targetInput.setAttribute('autocomplete', 'off');\n\n\t\tthis.menuButton = Tag.render`\n\t\t\t<span \n\t\t\t\tonclick=\"${this.openMenu.bind(this)}\"\n\t\t\t\tclass=\"bizproc-automation-popup-select-dotted\"\n\t\t\t></span>\n\t\t`;\n\n\t\tthis.parseTargetProperties();\n\n\t\tthis.replaceOnWrite |= (this.targetInput.getAttribute('data-select-mode') === 'replace');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-select\">\n\t\t\t\t${this.targetInput}\n\t\t\t\t${this.menuButton}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderTo(targetInput: Element): void\n\t{\n\t\ttargetInput.parentNode.replaceChild(this.renderWith(targetInput), targetInput);\n\t}\n\n\tbindTargetEvents(): void\n\t{\n\t\tEvent.bind(this.targetInput, 'keydown', this.#onKeyDown.bind(this));\n\t}\n\n\tparseTargetProperties(): void\n\t{\n\t\tthis.fieldProperty = JSON.parse(this.targetInput.getAttribute('data-property'));\n\t\tconst propertyType = this.targetInput.getAttribute('data-selector-type');\n\n\t\tif (!this.fieldProperty && propertyType)\n\t\t{\n\t\t\tthis.fieldProperty = { Type: propertyType };\n\t\t}\n\n\t\tif (this.fieldProperty)\n\t\t{\n\t\t\tthis.fieldProperty.Type = this.fieldProperty.Type || propertyType;\n\t\t\tthis.#prepareSelectorUsingFieldType();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.context.useSwitcherMenu = false;\n\t\t}\n\n\t\tthis.replaceOnWrite |= (this.targetInput.getAttribute('data-select-mode') === 'replace');\n\t}\n\n\t#prepareSelectorUsingFieldType(): void\n\t{\n\t\tthis.basisFields = this.basisFields.filter((field) => this.#shouldShowField(field));\n\n\t\tconst type = this.fieldProperty?.Type;\n\t\tif (type === 'file')\n\t\t{\n\t\t\tthis.replaceOnWrite = true;\n\t\t}\n\t\telse if (type === 'date' || type === 'datetime')\n\t\t{\n\t\t\tthis.replaceOnWrite = true;\n\n\t\t\tconst delayIntervalSelector = new DelayIntervalSelector({\n\t\t\t\tlabelNode: this.targetInput,\n\t\t\t\tbasisFields: this.basisFields,\n\t\t\t\tuseAfterBasis: true,\n\t\t\t\tonchange: (function(delay)\n\t\t\t\t{\n\t\t\t\t\tthis.targetInput.value = delay.toExpression(\n\t\t\t\t\t\tthis.basisFields,\n\t\t\t\t\t\tHelper.getResponsibleUserExpression(this.context.fields),\n\t\t\t\t\t);\n\t\t\t\t}).bind(this),\n\t\t\t});\n\n\t\t\tdelayIntervalSelector.init(DelayInterval.fromString(this.targetInput.value, this.basisFields));\n\t\t}\n\t}\n\n\t#shouldShowField(field: Field): boolean\n\t{\n\t\tconst fieldType = this.fieldProperty?.Type;\n\t\tif (fieldType === 'file')\n\t\t{\n\t\t\treturn field.Type === 'file';\n\t\t}\n\t\telse if (fieldType === 'date' || fieldType === 'datetime')\n\t\t{\n\t\t\treturn field.Type === 'date' || field.Type === 'datetime';\n\t\t}\n\t\telse if (fieldType === 'time')\n\t\t{\n\t\t\treturn field.Type === 'date' || field.Type === 'datetime' || field.Type === 'time';\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#onKeyDown(event: KeyboardEvent)\n\t{\n\t\tif (event.keyCode === 45 && event.altKey === false && event.ctrlKey === false && event.shiftKey === false)\n\t\t{\n\t\t\tthis.openMenu(event);\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\topenMenu(event: KeyboardEvent, skipPropertiesSwitcher: boolean = false)\n\t{\n\t\tif (!skipPropertiesSwitcher && this.context.useSwitcherMenu && !this.targetInput.value)\n\t\t{\n\t\t\treturn this.openPropertiesSwitcherMenu();\n\t\t}\n\n\t\tif (this.#dialog)\n\t\t{\n\t\t\tthis.#dialog.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fillGroups();\n\t\tthis.onMenuOpen();\n\n\t\tlet menuItems = [];\n\t\tfor (const group of Object.values(this.#menuGroups))\n\t\t{\n\t\t\tif (group.children.length > 0)\n\t\t\t{\n\t\t\t\tmenuItems.push(group);\n\t\t\t}\n\t\t}\n\n\t\tif (menuItems.length === 1)\n\t\t{\n\t\t\tmenuItems = menuItems[0].children;\n\t\t}\n\n\t\tlet menuId = this.menuButton.getAttribute('data-selector-id');\n\t\tif (!menuId)\n\t\t{\n\t\t\tmenuId = Helper.generateUniqueId();\n\t\t\tthis.menuButton.setAttribute('data-selector-id', menuId);\n\t\t}\n\n\t\tthis.#dialog = new Dialog({\n\t\t\ttargetNode: this.menuButton,\n\t\t\twidth: 500,\n\t\t\theight: 300,\n\t\t\tmultiple: false,\n\t\t\tdropdownMode: true,\n\t\t\tenableSearch: true,\n\t\t\titems: this.injectDialogMenuTitles(menuItems),\n\t\t\tshowAvatars: false,\n\t\t\tevents: {\n\t\t\t\t'Item:onBeforeSelect': (event) => {\n\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\tconst item = event.getData().item;\n\t\t\t\t\tthis.onFieldSelect(item.getCustomData().get('field'));\n\t\t\t\t}\n\t\t\t},\n\t\t\tcompactView: true,\n\t\t});\n\n\t\tthis.#dialog.show();\n\t}\n\n\tfillGroups(): void\n\t{\n\t\tthis.fillFieldsGroups();\n\t\tthis.fillFileGroup();\n\t}\n\n\tfillFieldsGroups(): void\n\t{\n\t\tthis.addGroup('ROOT', {\n\t\t\tid: 'ROOT',\n\t\t\ttitle: this.context.rootGroupTitle,\n\t\t\tsearchable: false,\n\t\t});\n\n\t\tthis.getFields().forEach((field) => {\n\t\t\tlet groupKey = field.Id.indexOf('.') < 0 ? 'ROOT' : field.Id.split('.')[0];\n\t\t\tlet groupName = '';\n\t\t\tlet fieldName = field.Name;\n\n\t\t\tif (field.Name && groupKey !== 'ROOT' && field.Name.indexOf(': ') >= 0)\n\t\t\t{\n\t\t\t\tconst names = field.Name.split(': ');\n\t\t\t\tgroupName = names.shift();\n\t\t\t\tfieldName = names.join(': ');\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tfield['Id'].indexOf('ASSIGNED_BY_') === 0\n\t\t\t\t&& field['Id'] !== 'ASSIGNED_BY_ID'\n\t\t\t\t&& field['Id'] !== 'ASSIGNED_BY_PRINTABLE'\n\t\t\t)\n\t\t\t{\n\t\t\t\tgroupKey = 'ASSIGNED_BY';\n\t\t\t\tconst names = field.Name.split(' ');\n\t\t\t\tgroupName = names.shift();\n\t\t\t\tfieldName = names.join(' ').replace('(', '').replace(')', '');\n\t\t\t}\n\n\t\t\tif (!this.hasGroup(groupKey))\n\t\t\t{\n\t\t\t\tthis.addGroup(groupKey, {\n\t\t\t\t\tid: groupKey,\n\t\t\t\t\ttitle: groupName,\n\t\t\t\t\tsearchable: false,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.addGroupItem(groupKey, {\n\t\t\t\tid: field.SystemExpression,\n\t\t\t\ttitle: fieldName || field.Id,\n\t\t\t\tcustomData: {field},\n\t\t\t});\n\t\t});\n\t}\n\n\tfillFileGroup(): void\n\t{\n\t\tconst fileFields = this.getFields().filter((field) => field.Type === 'file');\n\n\t\tif (fileFields.length > 0)\n\t\t{\n\t\t\tthis.addGroup('__FILES', {\n\t\t\t\tid: '__FILES',\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_CMP_FILES_LINKS'),\n\t\t\t\tchildren: this.#prepareFilesMenu(fileFields),\n\t\t\t\tsearchable: false,\n\t\t\t});\n\t\t}\n\t}\n\n\t#prepareFilesMenu(fileFields: Array<Field>): Array<MenuGroupItem>\n\t{\n\t\treturn fileFields.map((field) => {\n\t\t\tconst exp = (\n\t\t\t\tfield['ObjectId'] === 'Document'\n\t\t\t\t\t? '{{'+field['Name']+' > shortlink}}'\n\t\t\t\t\t: '{{~'+field['ObjectId']+':'+field['Id']+' > shortlink}}'\n\t\t\t);\n\n\t\t\tlet title = field.Name || field.Id;\n\n\t\t\tif (field.ObjectName)\n\t\t\t{\n\t\t\t\ttitle = field.ObjectName + ': ' + title;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttitle: title,\n\t\t\t\tcustomData: {\n\t\t\t\t\tfield: {\n\t\t\t\t\t\tId: field['Id'] + '_shortlink',\n\t\t\t\t\t\tObjectId: field['ObjectId'],\n\t\t\t\t\t\tName: field['Name'],\n\t\t\t\t\t\tType: 'string',\n\t\t\t\t\t\tExpression: exp,\n\t\t\t\t\t\tSystemExpression: '{='+field['ObjectId']+':'+field['Id']+' > shortlink}'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tid: exp,\n\t\t\t};\n\t\t});\n\t}\n\n\tonMenuOpen(): void\n\t{\n\t\tthis.emit('onOpenMenu', { selector: this });\n\t}\n\n\topenPropertiesSwitcherMenu()\n\t{\n\t\tconst self = this;\n\n\t\tMenuManager.show(\n\t\t\tHelper.generateUniqueId(),\n\t\t\tthis.menuButton,\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_ASK_CONSTANT'),\n\t\t\t\t\tdisabled: self.fieldProperty?.Type === 'file',\n\t\t\t\t\tonclick(event) {\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\tself.emit('onAskConstant', {fieldProperty: self.fieldProperty});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_ASK_PARAMETER'),\n\t\t\t\t\tonclick(event) {\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\tself.emit('onAskParameter', {fieldProperty: self.fieldProperty});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_ASK_MANUAL'),\n\t\t\t\t\tonclick(event) {\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\tself.openMenu(event, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: 20,\n\t\t\t\tangle: { position: 'top'},\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.#switcherDialog = MenuManager.currentItem;\n\n\t\treturn true;\n\t}\n\n\tinjectDialogMenuTitles(items)\n\t{\n\t\titems.forEach((parent) => {\n\t\t\tif (Type.isArray(parent.children))\n\t\t\t{\n\t\t\t\tthis.injectDialogMenuSupertitles(parent.title, parent.children);\n\t\t\t}\n\t\t});\n\n\t\treturn items;\n\t}\n\n\tinjectDialogMenuSupertitles(title: string, children)\n\t{\n\t\tchildren.forEach((child) => {\n\t\t\tif (!child.supertitle)\n\t\t\t{\n\t\t\t\tchild.supertitle = title;\n\t\t\t}\n\t\t\tif (Type.isArrayFilled(child.children))\n\t\t\t{\n\t\t\t\tthis.injectDialogMenuSupertitles(child.title, child.children);\n\t\t\t}\n\t\t});\n\t}\n\n\tonFieldSelect(field: ?Field): void\n\t{\n\t\tif (!field)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst inputType = this.targetInput.tagName.toLowerCase();\n\n\t\tif (inputType === 'select')\n\t\t{\n\t\t\tlet expressionOption = this.targetInput.querySelector('[data-role=\"expression\"]');\n\t\t\tif (!expressionOption)\n\t\t\t{\n\t\t\t\texpressionOption = (\n\t\t\t\t\tthis.targetInput.appendChild(\n\t\t\t\t\t\tDom.create(\n\t\t\t\t\t\t\t'option',\n\t\t\t\t\t\t\t{attrs: {'data-role': 'expression'}}\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\texpressionOption.setAttribute('value', field.Expression);\n\t\t\texpressionOption.textContent = field['Expression'];\n\n\t\t\texpressionOption.selected = true;\n\t\t}\n\t\telse if (inputType === 'label')\n\t\t{\n\t\t\tthis.targetInput.textContent = field.Expression;\n\t\t\tconst hiddenInput = document.getElementById(this.targetInput.getAttribute('for'));\n\t\t\tif (hiddenInput)\n\t\t\t{\n\t\t\t\thiddenInput.value = field.Expression;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.replaceOnWrite)\n\t\t\t{\n\t\t\t\tthis.targetInput.value = field.Expression;\n\t\t\t\tthis.targetInput.selectionEnd = this.targetInput.value.length;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet beforePart = '';\n\t\t\t\tconst middlePart = field.Expression;\n\t\t\t\tlet afterPart = '';\n\t\t\t\tif (Type.isStringFilled(this.targetInput.value))\n\t\t\t\t{\n\t\t\t\t\tbeforePart = this.targetInput.value.substr(0, this.targetInput.selectionEnd);\n\t\t\t\t\tafterPart = this.targetInput.value.substr(this.targetInput.selectionEnd);\n\t\t\t\t}\n\n\t\t\t\tthis.targetInput.value = beforePart + middlePart + afterPart;\n\t\t\t\tthis.targetInput.selectionEnd = beforePart.length + middlePart.length;\n\t\t\t}\n\t\t}\n\n\t\tBX.fireEvent(this.targetInput, 'change');\n\t\tthis.emit('Field:Selected', { field });\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.#dialog)\n\t\t{\n\t\t\tthis.#dialog.destroy();\n\t\t}\n\t\tif (this.#switcherDialog)\n\t\t{\n\t\t\tthis.#switcherDialog.destroy();\n\t\t}\n\t}\n\n\tgetFields(): Array<Field>\n\t{\n\t\tconst printablePrefix = Loc.getMessage('BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX');\n\t\tconst names = this.context.fields.map(field => field.Name).join('\\n');\n\n\t\tconst fields = [];\n\t\tthis.basisFields.forEach((field) => {\n\t\t\tfield.ObjectId = 'Document';\n\n\t\t\tconst custom = (field['BaseType'] === 'string' && field['Type'] !== 'string');\n\n\t\t\tif (!custom)\n\t\t\t{\n\t\t\t\tfields.push(field);\n\t\t\t}\n\n\t\t\t//generate printable version\n\t\t\tif (\n\t\t\t\tfield['Type'] === 'user'\n\t\t\t\t||\n\t\t\t\tfield['Type'] === 'bool'\n\t\t\t\t||\n\t\t\t\tfield['Type'] === 'file'\n\t\t\t\t||\n\t\t\t\tcustom\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst printableName = field['Name'] + ' ' + printablePrefix;\n\n\t\t\t\tif (names.indexOf(printableName) < 0)\n\t\t\t\t{\n\t\t\t\t\tconst printableField = BX.clone(field);\n\t\t\t\t\tconst printableTag = (field['Type'] === 'user') ? 'friendly' : 'printable';\n\n\t\t\t\t\tprintableField['Name'] = printableName;\n\t\t\t\t\tprintableField['Type'] = 'string';\n\t\t\t\t\tprintableField['SystemExpression'] = '{=Document:'+printableField['Id']+' > '+printableTag+'}';\n\t\t\t\t\tprintableField['Expression'] = '{{'+field['Name']+' > '+printableTag+'}}';\n\n\t\t\t\t\tfields.push(printableField);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (field['BaseType'] === 'date' || field['BaseType'] === 'datetime' || field['BaseType'] === 'time')\n\t\t\t{\n\t\t\t\tconst serverField = BX.clone(field);\n\t\t\t\tserverField['Name'] += ' ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_MOD_DATE_BY_SERVER');\n\t\t\t\tserverField['Type'] = 'string';\n\t\t\t\tserverField['SystemExpression'] = `{=Document:${serverField['Id']} > server}`;\n\t\t\t\tserverField['Expression'] = `{{${field['Name']} > server}}`;\n\n\t\t\t\tfields.push(serverField);\n\n\t\t\t\tconst responsibleField = BX.clone(field);\n\t\t\t\tresponsibleField['Name'] += ' ' + Loc.getMessage('BIZPROC_AUTOMATION_CMP_MOD_DATE_BY_RESPONSIBLE');\n\t\t\t\tresponsibleField['Type'] = 'string';\n\t\t\t\tresponsibleField['SystemExpression'] = `{=Document:${serverField['Id']} > responsible}`;\n\t\t\t\tresponsibleField['Expression'] = `{{${field['Name']} > responsible}}`;\n\n\t\t\t\tfields.push(responsibleField);\n\t\t\t}\n\t\t});\n\n\t\treturn fields;\n\t}\n}\n","import { Type, Loc, Text, Dom, Tag, Runtime, Event } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport { Menu, MenuItem } from 'main.popup';\nimport { InlineSelector } from './inline-selector';\nimport { SelectorContext } from 'bizproc.automation';\n\nexport class InlineTimeSelector extends InlineSelector\n{\n\t#labelNode: HTMLElement = null;\n\t#inputNode: HTMLInputElement = null;\n\t#showDottedSelector: boolean;\n\n\t#timeValues: [] = [];\n\t#timeFormat: string;\n\n\t#selector: Menu;\n\t#chevron: HTMLSpanElement;\n\n\tconstructor(props: { context: SelectorContext, showValuesSelector: boolean })\n\t{\n\t\tsuper(props);\n\n\t\tthis.#fillTimeFormat();\n\t\tthis.#fillTimeValues();\n\n\t\tthis.#showDottedSelector = Type.isNil(props.showValuesSelector) ? true : Text.toBoolean(props.showValuesSelector);\n\t}\n\n\t#fillTimeFormat()\n\t{\n\t\tconst getFormat = (formatId) => (\n\t\t\tBX.Main.Date.convertBitrixFormat(Loc.getMessage(formatId)).replace(/:?\\s*s/, '')\n\t\t);\n\n\t\tconst dateFormat = getFormat('FORMAT_DATE');\n\t\tconst dateTimeFormat = getFormat('FORMAT_DATETIME');\n\t\tthis.#timeFormat = dateTimeFormat.replace(dateFormat, '').trim();\n\t}\n\n\t#fillTimeValues()\n\t{\n\t\tconst onclick = (event, item: MenuItem) => {\n\t\t\tevent.preventDefault();\n\t\t\tthis.#inputNode.value = Text.encode(item.text);\n\t\t\titem.getMenuWindow().close();\n\t\t};\n\n\t\tfor (let hour = 0; hour < 24; hour++)\n\t\t{\n\t\t\tthis.#timeValues.push({\n\t\t\t\tid: hour * 60,\n\t\t\t\ttext: this.#formatTime(hour, 0),\n\t\t\t\tonclick,\n\t\t\t}, {\n\t\t\t\tid: hour * 60 + 30,\n\t\t\t\ttext: this.#formatTime(hour, 30),\n\t\t\t\tonclick,\n\t\t\t});\n\t\t}\n\t}\n\n\t#formatTime(hour, minute): string\n\t{\n\t\tconst date = new Date();\n\t\tdate.setHours(hour, minute);\n\n\t\treturn DateTimeFormat.format(this.#timeFormat, date.getTime() / 1000);\n\t}\n\n\trenderWith(targetInput: Element): HTMLDivElement\n\t{\n\t\tthis.targetInput = Runtime.clone(targetInput);\n\t\tthis.targetInput.setAttribute('autocomplete', 'off');\n\n\t\tthis.parseTargetProperties();\n\t\tthis.replaceOnWrite = true;\n\n\t\tif (this.#showDottedSelector === false)\n\t\t{\n\t\t\treturn this.#labelNode;\n\t\t}\n\n\t\tconst { root, menuButton } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-select\">\n\t\t\t\t${this.#labelNode}\n\t\t\t\t<span\n\t\t\t\t\tref=\"menuButton\"\n\t\t\t\t\tonclick=\"${this.openMenu.bind(this)}\"\n\t\t\t\t\tclass=\"bizproc-automation-popup-select-dotted\"\n\t\t\t\t></span>\n\t\t\t</div>\n\t\t`;\n\t\tthis.menuButton = menuButton;\n\n\t\treturn root;\n\t}\n\n\tparseTargetProperties()\n\t{\n\t\tsuper.parseTargetProperties();\n\t\tthis.#init();\n\t}\n\n\t#init()\n\t{\n\t\tconst targetInput = this.targetInput;\n\t\tconst hasParentNode = Type.isDomNode(this.targetInput.parentNode);\n\t\tif (hasParentNode)\n\t\t{\n\t\t\tthis.targetInput = Runtime.clone(targetInput);\n\t\t}\n\n\t\tconst { root, chevron } = Tag.render`\n\t\t\t<span onclick=\"${this.#onLabelClick.bind(this)}\" style=\"width: 100%; position: relative\">\n\t\t\t\t${this.targetInput}\n\t\t\t\t<span \n\t\t\t\t\tref=\"chevron\"\n\t\t\t\t\tclass=\"ui-icon-set --chevron-down bizproc-automation-inline-time-selector-chevron\"\n\t\t\t\t></span>\n\t\t\t</span>\n\t\t`;\n\n\t\tthis.#labelNode = root;\n\t\tthis.#inputNode = this.targetInput;\n\t\tthis.#chevron = chevron;\n\n\t\tif (hasParentNode)\n\t\t{\n\t\t\tDom.replace(targetInput, this.#labelNode);\n\t\t}\n\t}\n\n\t#onLabelClick(event)\n\t{\n\t\tthis.#showTimeSelector();\n\t\tevent.preventDefault();\n\t}\n\n\t#showTimeSelector()\n\t{\n\t\tif (Type.isNil(this.#selector))\n\t\t{\n\t\t\tthis.#selector = new Menu({\n\t\t\t\tautoHide: true,\n\t\t\t\tbindElement: this.#labelNode,\n\t\t\t\titems: this.#timeValues,\n\t\t\t\tmaxHeight: 230,\n\t\t\t\twidth: this.#labelNode.offsetWidth || this.#labelNode.clientWidth || 100,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => {\n\t\t\t\t\t\tif (Dom.hasClass(this.#chevron, '--chevron-up'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDom.toggleClass(this.#chevron, ['--chevron-down', '--chevron-up']);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tthis.#selector.show();\n\t\tif (Dom.hasClass(this.#chevron, '--chevron-down'))\n\t\t{\n\t\t\tDom.toggleClass(this.#chevron, ['--chevron-down', '--chevron-up']);\n\t\t}\n\t}\n}\n","import {\n\tDesigner,\n\tFileSelector,\n\tInlineSelector,\n\tInlineSelectorHtml,\n\tSaveStateCheckbox,\n\tTimeSelector,\n\tUserSelector,\n} from 'bizproc.automation';\nimport { Type } from 'main.core';\nimport { InlineTimeSelector } from './inline-time-selector';\n\nexport class Manager\n{\n\tstatic SELECTOR_ROLE_USER = 'user-selector';\n\tstatic SELECTOR_ROLE_FILE = 'file-selector';\n\tstatic SELECTOR_ROLE_INLINE = 'inline-selector-target';\n\tstatic SELECTOR_ROLE_INLINE_HTML = 'inline-selector-html';\n\tstatic SELECTOR_ROLE_TIME = 'time-selector';\n\tstatic SELECTOR_ROLE_SAVE_STATE = 'save-state-checkbox';\n\tstatic SELECTOR_ROLE_INLINE_TIME = 'inline-selector-time';\n\n\tstatic getSelectorByTarget(targetInput: HTMLElement): ?InlineSelector\n\t{\n\t\t// TODO - save created selectors with Manager\n\t\tconst template = Designer.getInstance().getRobotSettingsDialog()?.template;\n\n\t\tif (template && Type.isArray(template.robotSettingsControls))\n\t\t{\n\t\t\treturn template.robotSettingsControls.find(selector => selector.targetInput === targetInput);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tstatic createSelectorByRole(role: string, selectorProps: object): InlineSelector | SaveStateCheckbox\n\t{\n\t\tif (role === this.SELECTOR_ROLE_USER)\n\t\t{\n\t\t\treturn new UserSelector(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_FILE)\n\t\t{\n\t\t\treturn new FileSelector(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_INLINE)\n\t\t{\n\t\t\treturn new InlineSelector(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_INLINE_HTML)\n\t\t{\n\t\t\treturn new InlineSelectorHtml(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_INLINE_TIME)\n\t\t{\n\t\t\treturn new InlineTimeSelector(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_TIME)\n\t\t{\n\t\t\treturn new TimeSelector(selectorProps);\n\t\t}\n\t\telse if (role === this.SELECTOR_ROLE_SAVE_STATE)\n\t\t{\n\t\t\treturn new SaveStateCheckbox(selectorProps);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n","import { SelectorContext, Condition, ConditionGroup } from 'bizproc.automation';\nimport { InlineSelector } from './inline-selector';\nimport { Field } from './types';\n\nexport class InlineSelectorCondition extends InlineSelector\n{\n\t#condition: Condition;\n\n\tconstructor(props: {\n\t\tcontext: SelectorContext,\n\t\tcondition: Condition,\n\t})\n\t{\n\t\tsuper(props);\n\n\t\tthis.#condition = props.condition;\n\t}\n\n\trenderTo(target: Element)\n\t{\n\t\tthis.targetInput = target;\n\t\tthis.menuButton = target;\n\n\t\tthis.parseTargetProperties();\n\t\tthis.bindTargetEvents();\n\t}\n\n\tfillGroups(): void\n\t{\n\t\tthis.fillFieldsGroups();\n\t}\n\n\tonMenuOpen(): void\n\t{\n\t\tthis.emit('onOpenMenu', {\n\t\t\tselector: this,\n\t\t\t// TODO - rename\n\t\t\tisMixedCondition: this.#isMixedConditionGroup(),\n\t\t});\n\t}\n\n\tonFieldSelect(field: ?Field)\n\t{\n\t\tthis.emit('change', { field });\n\t}\n\n\t#isMixedConditionGroup(): boolean\n\t{\n\t\treturn (\n\t\t\tthis.#condition\n\t\t\t&& this.#condition.parentGroup\n\t\t\t&& this.#condition.parentGroup.type === ConditionGroup.CONDITION_TYPE.Mixed\n\t\t);\n\t}\n\n\tgetFields(): Array<Field>\n\t{\n\t\treturn this.context.fields.map((field) => ({\n\t\t\t...field,\n\t\t\tObjectId: 'Document',\n\t\t}));\n\t}\n}","import { Tag } from 'main.core';\nimport { Field } from './types';\nimport { InlineSelector } from './inline-selector';\n\nexport class InlineSelectorHtml extends InlineSelector\n{\n\t#editorNode: ?BXHtmlEditor;\n\t#eventHandlers = {\n\t\t'OnEditorInitedAfter': this.#bindEditorHooks.bind(this),\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#unbindEvents();\n\t}\n\n\trenderTo(targetInput: Element)\n\t{\n\t\tthis.targetInput = targetInput;\n\t\tthis.#editorNode = targetInput.querySelector('.bx-html-editor');\n\t\tthis.menuButton = Tag.render`\n\t\t\t<span\n\t\t\t\tonclick=\"${this.openMenu.bind(this)}\"\n\t\t\t\tclass=\"bizproc-automation-popup-select-dotted\"\n\t\t\t></span>\n\t\t`;\n\n\t\tthis.parseTargetProperties();\n\t\tthis.bindTargetEvents()\n\n\t\ttargetInput.firstElementChild.appendChild(this.menuButton);\n\n\t\tthis.#bindEvents();\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tfor (const [name, handler] of Object.entries(this.#eventHandlers))\n\t\t{\n\t\t\tBX.addCustomEvent(name, handler);\n\t\t}\n\t}\n\n\t#unbindEvents(): void\n\t{\n\t\tfor (const [name, handler] of Object.entries(this.#eventHandlers))\n\t\t{\n\t\t\tBX.removeCustomEvent(name, handler);\n\t\t}\n\t}\n\n\t#bindEditorHooks(editor): void\n\t{\n\t\tif (editor.dom.cont !== this.#editorNode)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet header = '';\n\t\tlet footer = '';\n\n\t\tconst cutHeader = (content: string, shouldSaveHeader: boolean = false) => {\n\t\t\treturn content.replace(/(^[\\s\\S]*?)(<body.*?>)/i, (str) => {\n\t\t\t\tif (shouldSaveHeader)\n\t\t\t\t{\n\t\t\t\t\theader = str;\n\t\t\t\t}\n\n\t\t\t\treturn '';\n\t\t\t});\n\t\t};\n\n\t\tconst cutFooter = (content: string, shouldSaveFooter: boolean = false) => {\n\t\t\treturn content.replace(/(<\\/body>[\\s\\S]*?$)/i, (str) => {\n\t\t\t\tif (shouldSaveFooter)\n\t\t\t\t{\n\t\t\t\t\tfooter = str;\n\t\t\t\t}\n\n\t\t\t\treturn '';\n\t\t\t});\n\t\t}\n\n\t\tBX.addCustomEvent(editor, 'OnParse', function (mode)\n\t\t{\n\t\t\tif (!mode)\n\t\t\t{\n\t\t\t\tthis.content = cutFooter(cutHeader(this.content, true), true);\n\t\t\t}\n\t\t});\n\n\t\tBX.addCustomEvent(editor, 'OnAfterParse', function (mode)\n\t\t{\n\t\t\tif (mode)\n\t\t\t{\n\t\t\t\tlet content = cutFooter(cutHeader(this.content));\n\n\t\t\t\tif (header !== '' && footer !== '')\n\t\t\t\t{\n\t\t\t\t\tcontent = header + content + footer;\n\t\t\t\t}\n\n\t\t\t\tthis.content = content;\n\t\t\t}\n\t\t});\n\t}\n\n\tonFieldSelect(field: ?Field): void\n\t{\n\t\tconst insertText = field.Expression;\n\t\tconst editor = this.#getEditor();\n\n\t\tif (editor && editor.InsertHtml)\n\t\t{\n\t\t\tif (editor.synchro.IsFocusedOnTextarea())\n\t\t\t{\n\t\t\t\teditor.textareaView.Focus();\n\t\t\t\teditor.textareaView.WrapWith('', '', insertText);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\teditor.InsertHtml(insertText);\n\t\t\t}\n\t\t\teditor.synchro.Sync();\n\t\t}\n\t}\n\n\tonBeforeSave(): void\n\t{\n\t\tconst editor = this.#getEditor();\n\t\tif (editor && editor.SaveContent)\n\t\t{\n\t\t\teditor.SaveContent();\n\t\t}\n\t}\n\n\tonPopupResize()\n\t{\n\t\tconst editor = this.#getEditor();\n\t\tif (editor && editor.ResizeSceleton)\n\t\t{\n\t\t\teditor.ResizeSceleton();\n\t\t}\n\t}\n\n\t#getEditor(): ?BXHtmlEditor\n\t{\n\t\tif (this.#editorNode)\n\t\t{\n\t\t\tconst editorId = this.#editorNode.id.split('-');\n\t\t\treturn BXHtmlEditor.Get(editorId[editorId.length - 1]);\n\t\t}\n\n\t\treturn null;\n\t}\n}","import { SelectorContext } from 'bizproc.automation';\n\nexport class SaveStateCheckbox\n{\n\t#context: SelectorContext;\n\t#checkbox: Element;\n\t#needSync: boolean;\n\n\tconstructor(props: {\n\t\tcontext: SelectorContext,\n\t\tcheckbox: Element,\n\t\tneedSync: boolean,\n\t})\n\t{\n\t\tthis.#context = props.context;\n\t\tthis.#checkbox = props.checkbox;\n\t\tthis.#needSync = props.needSync;\n\n\t\tif (props.needSync)\n\t\t{\n\t\t\tconst category = 'save_state_checkbox';\n\t\t\tconst savedState = this.#context.get('userOptions').get(category, this.#getKey(), 'N');\n\t\t\tif (savedState === 'Y')\n\t\t\t{\n\t\t\t\tthis.#checkbox.checked = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy(): void\n\t{\n\t\tif (this.#needSync)\n\t\t{\n\t\t\tthis.#context.get('userOptions').set('save_state_checkboxes', this.#getKey(), this.#getValue());\n\t\t}\n\t}\n\n\t#getKey(): ?string\n\t{\n\t\treturn this.#checkbox.getAttribute('data-save-state-key');\n\t}\n\n\t#getValue(): string\n\t{\n\t\treturn this.#checkbox.checked ? 'Y'\t : 'N';\n\t}\n}","import { Type } from 'main.core';\nimport { InlineSelector } from './inline-selector';\n\nexport class UserSelector extends InlineSelector\n{\n\trenderTo(targetInput: Element)\n\t{\n\t\tthis.targetInput = targetInput;\n\t\tthis.menuButton = targetInput;\n\n\t\tthis.fieldProperty = JSON.parse(targetInput.getAttribute('data-property'));\n\t\tif (!this.fieldProperty)\n\t\t{\n\t\t\tthis.context.useSwitcherMenu = false;\n\t\t}\n\n\t\tconst additionalUserFields = this.context.get('additionalUserFields');\n\t\tthis.userSelector = BX.Bizproc.UserSelector.decorateNode(\n\t\t\ttargetInput,\n\t\t\t{\n\t\t\t\tadditionalFields: Type.isArray(additionalUserFields) ? additionalUserFields : [],\n\t\t\t},\n\t\t);\n\t}\n\n\tdestroy()\n\t{\n\t\tsuper.destroy();\n\n\t\tif (this.userSelector)\n\t\t{\n\t\t\tthis.userSelector.destroy();\n\t\t\tthis.userSelector = null;\n\t\t}\n\t}\n}","import { Type, Runtime, Tag, Dom, Event, Text, Loc } from 'main.core';\nimport { MenuManager } from 'main.popup';\nimport { SelectorContext, Helper } from 'bizproc.automation';\nimport { InlineSelector } from './inline-selector';\n\nexport class FileSelector extends InlineSelector\n{\n\tstatic TYPE = {\n\t\tNone: '',\n\t\tDisk: 'disk',\n\t\tFile: 'file',\n\t}\n\n\t#type: string = FileSelector.TYPE.None;\n\t#multiple: boolean = false;\n\t#required: boolean = false;\n\t#valueInputName: string = '';\n\t#typeInputName: string = '';\n\t#useDisk: boolean = false;\n\t#label: string = '';\n\t#labelFile: string = '';\n\t#labelDisk: string = '';\n\n\t#diskUploader: ?BX.Bizproc.Automation.DiskUploader = null;\n\n\t#diskControllerNode: ?HTMLDivElement = null;\n\t#fileItemsNode: ?HTMLSpanElement = null;\n\t#fileControllerNode: ?HTMLDivElement = null;\n\n\t#menuId: ?string;\n\n\tconstructor(props: { context: SelectorContext })\n\t{\n\t\tsuper(props);\n\n\t\tthis.context.set(\n\t\t\t'fileFields',\n\t\t\tthis.context.fields.filter(field => field.Type === 'file'),\n\t\t);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.menu)\n\t\t{\n\t\t\tthis.menu.popupWindow.close();\n\t\t}\n\t}\n\n\trenderTo(targetInput: Element)\n\t{\n\t\tthis.targetInput = targetInput;\n\n\t\tconst selected = this.parseTargetProperties();\n\n\t\tthis.targetInput.appendChild(this.#createBaseNode());\n\t\tthis.#showTypeControlLayout(selected);\n\t\t// this.setFileFields()\n\t\t// this.createDom\n\t}\n\n\tparseTargetProperties()\n\t{\n\t\tlet config = JSON.parse(this.targetInput.getAttribute('data-config'));\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\n\t\tthis.#type = config.type || FileSelector.TYPE.File;\n\t\tif (config.selected && !config.selected.length)\n\t\t{\n\t\t\tthis.#type = FileSelector.TYPE.None;\n\t\t}\n\n\t\tthis.#multiple = config.multiple || false;\n\t\tthis.#required = config.required || false;\n\t\tthis.#valueInputName = config.valueInputName || '';\n\t\tthis.#typeInputName = config.typeInputName || '';\n\t\tthis.#useDisk = config.useDisk || false;\n\t\tthis.#label = config.label || 'Attachment';\n\t\tthis.#labelFile = config.labelFile || 'File';\n\t\tthis.#labelDisk = config.labelDisk || 'Disk';\n\n\t\tif (config.selected && config.selected.length > 0)\n\t\t{\n\t\t\treturn Runtime.clone(config.selected);\n\t\t}\n\t}\n\n\t#createBaseNode(): HTMLDivElement\n\t{\n\t\tconst idSalt = Helper.generateUniqueId();\n\t\tlet fileRadio = null;\n\n\t\tconst fileTypeOptions = [];\n\n\t\tif (this.context.get('fileFields').length > 0)\n\t\t{\n\t\t\tfileRadio = Tag.render`\n\t\t\t\t<input\n\t\t\t\t\tid=\"type-1${idSalt}\"\n\t\t\t\t\tclass=\"bizproc-automation-popup-select-input\"\n\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\tname=\"${this.#typeInputName}\"\n\t\t\t\t\tvalue=\"${FileSelector.TYPE.File}\"\n\t\t\t\t\t${this.#type === FileSelector.TYPE.File ? 'checked' : ''}\n\t\t\t\t/>\n\t\t\t`;\n\t\t}\n\n\t\tconst diskFileRadio = Tag.render`\n\t\t\t<input\n\t\t\t\tid=\"type-2${idSalt}\"\n\t\t\t\tclass=\"bizproc-automation-popup-select-input\"\n\t\t\t\ttype=\"radio\"\n\t\t\t\tname=\"${this.#typeInputName}\"\n\t\t\t\tvalue=\"${FileSelector.TYPE.Disk}\"\n\t\t\t\t${this.#type === FileSelector.TYPE.Disk ? 'checked' : ''}\n\t\t\t/>\n\t\t`;\n\n\t\tfileTypeOptions.push(Tag.render`\n\t\t\t<span class=\"bizproc-automation-popup-settings-title\">${this.#label}:</span>\n\t\t`);\n\n\t\tif (fileRadio)\n\t\t{\n\t\t\tfileTypeOptions.push(fileRadio, Tag.render`\n\t\t\t\t<label\n\t\t\t\t\tclass=\"bizproc-automation-popup-settings-link\"\n\t\t\t\t\tfor=\"type-1${idSalt}\"\n\t\t\t\t\tonclick=\"${this.#onTypeChange.bind(this, FileSelector.TYPE.File)}\"\n\t\t\t\t>\n\t\t\t\t${this.#labelFile}\n\t\t\t\t</label>\n\t\t\t`);\n\t\t}\n\n\t\tfileTypeOptions.push(diskFileRadio, Tag.render`\n\t\t\t<label\n\t\t\t\tclass=\"bizproc-automation-popup-settings-link\"\n\t\t\t\tfor=\"type-2${idSalt}\"\n\t\t\t\tonclick=\"${this.#onTypeChange.bind(this, FileSelector.TYPE.Disk)}\"\n\t\t\t>\n\t\t\t${this.#labelDisk}\n\t\t\t</label>\n\t\t`);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings-block\">\n\t\t\t\t${fileTypeOptions}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#showTypeControlLayout(selected: Array): void\n\t{\n\t\tif (this.#type === FileSelector.TYPE.Disk)\n\t\t{\n\t\t\tthis.#hideFileControllerLayout();\n\t\t\tthis.#showDiskControllerLayout(selected);\n\t\t}\n\t\telse if (this.#type === FileSelector.TYPE.File)\n\t\t{\n\t\t\tthis.#hideDiskControllerLayout();\n\t\t\tthis.#showFileControllerLayout(selected);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#hideFileControllerLayout();\n\t\t\tthis.#hideDiskControllerLayout();\n\t\t}\n\t}\n\n\t#showDiskControllerLayout(selected: Array): void\n\t{\n\t\tif (!this.#diskControllerNode)\n\t\t{\n\t\t\tthis.#diskControllerNode = Dom.create('div');\n\n\t\t\tthis.targetInput.appendChild(this.#diskControllerNode);\n\n\t\t\tconst diskUploader = this.#getDiskUploader();\n\t\t\tdiskUploader.layout(this.#diskControllerNode);\n\t\t\tdiskUploader.show(true);\n\n\t\t\tif (selected)\n\t\t\t{\n\t\t\t\tthis.addItems(selected);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.#diskControllerNode);\n\t\t}\n\t}\n\n\t#hideDiskControllerLayout(): void\n\t{\n\t\tif (this.#diskControllerNode)\n\t\t{\n\t\t\tDom.hide(this.#diskControllerNode);\n\t\t}\n\t}\n\n\t#showFileControllerLayout(selected: Array): void\n\t{\n\t\tif (!this.#fileControllerNode)\n\t\t{\n\t\t\tthis.#fileItemsNode = Dom.create('span');\n\t\t\tthis.#fileControllerNode = Dom.create('div', {children: [this.#fileItemsNode]});\n\t\t\tthis.targetInput.appendChild(this.#fileControllerNode);\n\t\t\tconst addButtonNode = Dom.create('a', {\n\t\t\t\tattrs: {className: 'bizproc-automation-popup-settings-link bizproc-automation-popup-settings-link-thin'},\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_ADD')\n\t\t\t});\n\n\t\t\tthis.#fileControllerNode.appendChild(addButtonNode);\n\n\t\t\tEvent.bind(addButtonNode, 'click', this.#onFileFieldAddClick.bind(this, addButtonNode));\n\n\t\t\tif (selected)\n\t\t\t{\n\t\t\t\tthis.addItems(selected);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(this.#fileControllerNode);\n\t\t}\n\t}\n\n\t#hideFileControllerLayout(): void\n\t{\n\t\tif (this.#fileControllerNode)\n\t\t{\n\t\t\tDom.hide(this.#fileControllerNode);\n\t\t}\n\t}\n\n\t#getDiskUploader(): BX.Bizproc.Automation.DiskUploader\n\t{\n\t\tif (!this.#diskUploader)\n\t\t{\n\t\t\tthis.#diskUploader = BX.Bizproc.Automation.DiskUploader.create(\n\t\t\t\t'',\n\t\t\t\t{\n\t\t\t\t\tmsg: {\n\t\t\t\t\t\t'diskAttachFiles' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_ATTACH_FILE'),\n\t\t\t\t\t\t'diskAttachedFiles' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_ATTACHED_FILES'),\n\t\t\t\t\t\t'diskSelectFile' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE'),\n\t\t\t\t\t\t'diskSelectFileLegend' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE_LEGEND'),\n\t\t\t\t\t\t'diskUploadFile' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE'),\n\t\t\t\t\t\t'diskUploadFileLegend' : Loc.getMessage('BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE_LEGEND')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.#diskUploader.setMode(1);\n\t\t}\n\n\t\treturn this.#diskUploader;\n\t}\n\n\t#onTypeChange(newType: string): void\n\t{\n\t\tif (this.#type !== newType)\n\t\t{\n\t\t\tthis.#type = newType;\n\t\t\tthis.#showTypeControlLayout();\n\t\t}\n\t}\n\n\t#addFileItem(item)\n\t{\n\t\tif (this.#isFileItemSelected(item))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst node = this.#createFileItemNode(item);\n\t\tif (!this.#multiple)\n\t\t{\n\t\t\tDom.clean(this.#fileItemsNode)\n\t\t}\n\n\t\tthis.#fileItemsNode.appendChild(node);\n\t}\n\n\t#isFileItemSelected(item: object)\n\t{\n\t\treturn !!this.#fileItemsNode.querySelector(`[data-file-id=\"${item.id}\"]`);\n\t}\n\n\taddItems(items: Array<object>)\n\t{\n\t\tif (this.#type === FileSelector.TYPE.File)\n\t\t{\n\t\t\tfor(const fileItem of items)\n\t\t\t{\n\t\t\t\tthis.#addFileItem(fileItem)\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis\n\t\t\t\t.#getDiskUploader()\n\t\t\t\t.setValues(\n\t\t\t\t\tFileSelector.#convertToDiskItems(items)\n\t\t\t\t);\n\t\t}\n\t}\n\n\tstatic #convertToDiskItems(items: Array<object>)\n\t{\n\t\treturn items.map((item) => ({\n\t\t\tID: item['id'],\n\t\t\tNAME: item['name'],\n\t\t\tSIZE: item['size'],\n\t\t\tVIEW_URL: '',\n\t\t}));\n\t}\n\n\t#removeFileItem(item)\n\t{\n\t\tconst itemNode = this.#fileItemsNode.querySelector(`[data-file-id=\"${item.id}\"]`);\n\t\tif (itemNode)\n\t\t{\n\t\t\tthis.#fileItemsNode.removeChild(itemNode);\n\t\t}\n\t}\n\n\t#onFileFieldAddClick(addButtonNode, event)\n\t{\n\t\tconst self = this;\n\n\t\tif (!this.#menuId)\n\t\t{\n\t\t\tthis.#menuId = Helper.generateUniqueId();\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tthis.#menuId,\n\t\t\taddButtonNode,\n\t\t\tthis.context.get('fileFields').map((field) => ({\n\t\t\t\ttext: Text.encode(field.Name),\n\t\t\t\tfield,\n\t\t\t\tonclick(event, item)\n\t\t\t\t{\n\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\tself.onFieldSelect(field);\n\t\t\t\t}\n\t\t\t})),\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: Dom.getPosition(addButtonNode)['width'] / 2,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 0,\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\n\t\t// this.#menu = MenuManager.currentItem;\n\t\tevent.preventDefault();\n\t}\n\n\tonFieldSelect(field)\n\t{\n\t\tthis.#addFileItem({\n\t\t\tid: field.Id,\n\t\t\texpression: field.Expression,\n\t\t\tname: field.Name,\n\t\t\ttype: FileSelector.TYPE.File\n\t\t});\n\t}\n\n\t#createFileItemNode(item)\n\t{\n\t\tconst itemField = this.context.get('fileFields').find(field => field.Expression === item.expression);\n\t\tconst label = itemField?.Name || '';\n\n\t\treturn Tag.render`\n\t\t\t<span\n\t\t\t\tclass=\"bizproc-automation-popup-autocomplete-item\"\n\t\t\t\tdata-file-id=\"${item.id}\"\n\t\t\t\tdata-file-expression=\"${item.expression}\"\n\t\t\t>\n\t\t\t\t<span class=\"bizproc-automation-popup-autocomplete-name\">${label}</span>\n\t\t\t\t<span\n\t\t\t\t\tclass=\"bizproc-automation-popup-autocomplete-delete\"\n\t\t\t\t\tonclick=\"${this.#removeFileItem.bind(this, item)}\"\n\t\t\t\t></span>\n\t\t\t</span>\n\t\t`;\n\t}\n\n\tonBeforeSave()\n\t{\n\t\tlet ids = [];\n\t\tif (this.#type === FileSelector.TYPE.Disk)\n\t\t{\n\t\t\tids = this.#getDiskUploader().getValues();\n\t\t}\n\t\telse if (this.#type === FileSelector.TYPE.File)\n\t\t{\n\t\t\tids = (\n\t\t\t\tArray.from(this.#fileItemsNode.childNodes)\n\t\t\t\t\t.map(node => node.getAttribute('data-file-expression'))\n\t\t\t\t\t.filter(id => id !== '')\n\t\t\t);\n\t\t}\n\n\t\tfor (const id of ids)\n\t\t{\n\t\t\tthis.targetInput.appendChild(Tag.render`\n\t\t\t\t<input\n\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\tname=\"${this.#valueInputName + (this.#multiple ? '[]' : '')}\"\n\t\t\t\t\tvalue=\"${id}\"\n\t\t\t\t/>\n\t\t\t`);\n\t\t}\n\t}\n}\n","import { Event, Loc } from 'main.core';\nimport { InlineSelector } from './inline-selector';\n\nexport class TimeSelector extends InlineSelector\n{\n\t#clockInstance;\n\n\tdestroy()\n\t{\n\t\tif (this.#clockInstance)\n\t\t{\n\t\t\tthis.#clockInstance.closeWnd();\n\t\t}\n\t}\n\n\trenderTo(targetInput: Element)\n\t{\n\t\tthis.targetInput = targetInput; //this.targetInput = Runtime.clone(targetInput);\n\n\t\tconst datetime = new Date();\n\t\tdatetime.setHours(0, 0, 0, 0);\n\t\tdatetime.setTime(datetime.getTime() + this.#getCurrentTime() * 1000);\n\n\t\tthis.targetInput.value = this.constructor.#formatTime(datetime);\n\n\t\tEvent.bind(targetInput, 'click', this.showClock.bind(this));\n\t}\n\n\tshowClock(): void\n\t{\n\t\tif (!this.#clockInstance)\n\t\t{\n\t\t\tthis.#clockInstance = new BX.CClockSelector({\n\t\t\t\tstart_time: this.#getCurrentTime(),\n\t\t\t\tnode: this.targetInput,\n\t\t\t\tcallback: this.#onTimeSelect.bind(this),\n\t\t\t});\n\t\t}\n\n\t\tthis.#clockInstance.Show();\n\t}\n\n\t#onTimeSelect(time): void\n\t{\n\t\tthis.targetInput.value = time;\n\t\tBX.fireEvent(this.targetInput, 'change');\n\t\tthis.#clockInstance.closeWnd();\n\t}\n\n\t#getCurrentTime(): number\n\t{\n\t\treturn this.#convertTimeToSeconds(this.targetInput.value);\n\t}\n\n\t#convertTimeToSeconds(time: string): number\n\t{\n\t\tconst timeParts = time.split(/[\\s:]+/).map(part => parseInt(part));\n\n\t\tlet [hours, minutes] = timeParts;\n\t\tif (timeParts.length === 3)\n\t\t{\n\t\t\tconst period = timeParts[2];\n\n\t\t\tif (period === 'pm' && hours < 12)\n\t\t\t{\n\t\t\t\thours += 12;\n\t\t\t}\n\t\t\telse if (period === 'am' && hours === 12)\n\t\t\t{\n\t\t\t\thours = 0;\n\t\t\t}\n\t\t}\n\n\t\treturn hours * 3600 + minutes * 60;\n\t}\n\n\tstatic #formatTime(datetime: Date): string\n\t{\n\t\tconst getFormat = (formatId) => (\n\t\t\tBX.date.convertBitrixFormat(Loc.getMessage(formatId)).replace(/:?\\s*s/, '')\n\t\t);\n\n\t\tconst dateFormat = getFormat('FORMAT_DATE');\n\t\tconst timeFormat = getFormat('FORMAT_DATETIME').replace(dateFormat, '').trim();\n\n\t\treturn BX.date.format(timeFormat, datetime);\n\t}\n}","import { Type, Loc, Event, Dom, Text, Tag } from 'main.core';\nimport { Helper } from './helper';\nimport { DelayInterval } from './delay-interval';\nimport { InlineTimeSelector } from './selectors/inline-time-selector';\nimport { MenuManager, Popup, MenuItem } from 'main.popup';\nimport { getGlobalContext } from './automation';\nimport { Button } from 'ui.buttons';\nimport { DateTimeFormat } from 'main.date';\n\nimport 'ui.forms';\nimport 'ui.icon-set.actions';\nimport 'ui.hint';\n\nexport class DelayIntervalSelector\n{\n\tbasisFields: Array;\n\tonchange: () => void;\n\tlabelNode;\n\tuseAfterBasis;\n\tminLimitM;\n\tshowWaitWorkDay;\n\n\tdelay;\n\n\tconstructor(options)\n\t{\n\t\tthis.basisFields = [];\n\t\tthis.onchange = null;\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.labelNode = options.labelNode;\n\t\t\tthis.useAfterBasis = options.useAfterBasis;\n\n\t\t\tif (Type.isArray(options.basisFields))\n\t\t\t{\n\t\t\t\tthis.basisFields = options.basisFields;\n\t\t\t}\n\t\t\tthis.onchange = options.onchange;\n\t\t\tthis.minLimitM = options.minLimitM;\n\t\t\tthis.showWaitWorkDay = options.showWaitWorkDay;\n\t\t}\n\t}\n\n\tinit(delay)\n\t{\n\t\tthis.delay = delay;\n\t\tthis.setLabelText();\n\t\tthis.bindLabelNode();\n\t\tthis.prepareBasisFields();\n\t}\n\n\tsetLabelText()\n\t{\n\t\tif (this.delay && this.labelNode)\n\t\t{\n\t\t\tthis.labelNode.textContent = this.delay.format(\n\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_CMP_AT_ONCE_2'),\n\t\t\t\tthis.basisFields,\n\t\t\t);\n\t\t}\n\t}\n\n\tbindLabelNode()\n\t{\n\t\tif (this.labelNode)\n\t\t{\n\t\t\tEvent.bind(this.labelNode, 'click', this.onLabelClick.bind(this));\n\t\t}\n\t}\n\n\tonLabelClick(event)\n\t{\n\t\tthis.showDelayIntervalPopup();\n\t\tevent.preventDefault();\n\t}\n\n\tshowDelayIntervalPopup()\n\t{\n\t\tconst delay = this.delay;\n\t\tconst uid = Helper.generateUniqueId();\n\n\t\tconst { root: form, workTimeCheckBox } = Tag.render`\n\t\t\t <form class=\"bizproc-automation-popup-select-block\">\n\t\t\t\t${this.#createNowControlNode(uid)}\n\t\t\t\t${this.createAfterControlNode()}\n\t\t\t\t${this.basisFields.length > 0 ? this.createBeforeControlNode() : ''}\n\t\t\t\t${this.basisFields.length > 0 ? this.createInControlNode() : ''}\n\t\t\t\t<div class=\"bizproc-automation-popup-settings__subtitle ui-typography-heading-h6\">\n\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_AUTOMATION_DELAY_INTERVAL_ADDITIONAL_SETTINGS')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bizproc-automation-popup-settings__checkbox-label\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref=\"workTimeCheckBox\"\n\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings__checkbox\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tid=\"${uid}worktime\"\n\t\t\t\t\t\tname=\"worktime\"\n\t\t\t\t\t\tvalue=\"1\"\n\t\t\t\t\t\tstyle=\"vertical-align: middle\"\n\t\t\t\t\t/>\n\t\t\t\t\t<label for=\"${uid}worktime\" class=\"bizproc-automation-popup-settings-lbl\">\n\t\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_DELAY_WORK_TIME_MSGVER_1')}\n\t\t\t\t\t</label>\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass=\"bizproc-automation-status-help bizproc-automation-status-help-right\"\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('BIZPROC_AUTOMATION_DELAY_WORK_TIME_HELP')}\"\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\t\t\t\t${this.showWaitWorkDay ? this.#createWaitWorkDayNode() : ''}\n\t\t\t</form>\n\t\t`;\n\t\tif (delay.workTime)\n\t\t{\n\t\t\tDom.attr(workTimeCheckBox, 'checked', 'checked');\n\t\t}\n\t\tBX.UI.Hint.init(form);\n\n\t\tconst popup = new Popup({\n\t\t\tid: Helper.generateUniqueId(),\n\t\t\tbindElement: this.labelNode,\n\t\t\tcontent: form,\n\t\t\tcloseByEsc: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\tcolor: Button.Color.PRIMARY,\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_JS_AUTOMATION_CHOOSE_BUTTON_CAPS'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.saveFormData(new FormData(form));\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_JS_AUTOMATION_CANCEL_BUTTON_CAPS'),\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t\twidth: 482,\n\t\t\tpadding: 20,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tif (this.fieldsMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.fieldsMenu.popupWindow.close();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.valueTypeMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.valueTypeMenu.popupWindow.close();\n\t\t\t\t\t}\n\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t},\n\t\t\t},\n\t\t\ttitleBar: false,\n\t\t\tangle: {\n\t\t\t\toffset: 40,\n\t\t\t},\n\t\t\toverlay: { backgroundColor: 'transparent' },\n\t\t});\n\t\tpopup.show();\n\t}\n\n\t#createNowControlNode(uid: string): HTMLDivElement\n\t{\n\t\tconst labelText = Loc.getMessage(\n\t\t\tthis.useAfterBasis\n\t\t\t\t? 'BIZPROC_AUTOMATION_CMP_BASIS_NOW'\n\t\t\t\t: 'BIZPROC_AUTOMATION_CMP_AT_ONCE_2',\n\t\t);\n\n\t\tconst hintText = Loc.getMessage(\n\t\t\tthis.useAfterBasis\n\t\t\t\t? 'BIZPROC_AUTOMATION_CMP_DELAY_NOW_HELP_2'\n\t\t\t\t: 'BIZPROC_AUTOMATION_CMP_DELAY_NOW_HELP',\n\t\t);\n\n\t\tconst { root, labelAfter, radioNow } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-select-item\">\n\t\t\t\t<label\n\t\t\t\t\tref=\"labelAfter\"\n\t\t\t\t\tclass=\"bizproc-automation-popup-select__wrapper --first ui-ctl ui-ctl-radio ui-ctl-w100\"\n\t\t\t\t\tfor=\"${uid}now\"\n\t\t\t\t\tdata-role=\"select-item\"\n\t\t\t\t>\n\t\t\t\t\t<input \n\t\t\t\t\t\tref=\"radioNow\"\n\t\t\t\t\t\tclass=\"bizproc-automation-popup-select__input ui-ctl-element\"\n\t\t\t\t\t\tid=\"${uid}now\"\n\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\tvalue=\"now\"\n\t\t\t\t\t\tname=\"type\"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class=\"bizproc-automation-popup-settings__text --first\">${labelText}</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"bizproc-automation-status__help\"\n\t\t\t\t\t\tdata-hint=\"${hintText}\"\n\t\t\t\t\t></span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(radioNow, 'change', this.#onChangeDelayIntervalType.bind(this, labelAfter));\n\n\t\tif (this.delay.isNow())\n\t\t{\n\t\t\tradioNow.setAttribute('checked', 'checked');\n\t\t\tDom.addClass(labelAfter, '--active');\n\t\t}\n\n\t\treturn root;\n\t}\n\n\t#onChangeDelayIntervalType(labelNode)\n\t{\n\t\tdocument.querySelectorAll('[data-role=\"select-item\"]').forEach((node) => {\n\t\t\tDom.removeClass(node, '--active');\n\t\t});\n\t\tDom.addClass(labelNode, '--active');\n\t}\n\n\tsaveFormData(formData: FormData)\n\t{\n\t\tthis.#saveDelayIntervalTypeFromForm(formData);\n\n\t\tif (!this.delay.isNow())\n\t\t{\n\t\t\tconst timeName = `basis_in_time_${Text.encode(this.delay.type)}`;\n\t\t\tthis.delay.setInTime(this.#parseInTimeValue(formData.get(timeName)));\n\t\t}\n\t\tthis.delay.setWorkTime(formData.get('worktime'));\n\t\tthis.delay.setWaitWorkDay(formData.get('wait_workday'));\n\t\tthis.setLabelText();\n\n\t\tif (this.onchange)\n\t\t{\n\t\t\tthis.onchange(this.delay);\n\t\t}\n\t}\n\n\t#saveDelayIntervalTypeFromForm(formData: FormData)\n\t{\n\t\tconst type = formData.get('type');\n\n\t\tif (type === 'now')\n\t\t{\n\t\t\tthis.delay.setNow();\n\t\t}\n\t\telse if (type === DelayInterval.DELAY_TYPE.In)\n\t\t{\n\t\t\tthis.delay.setType(DelayInterval.DELAY_TYPE.In);\n\t\t\tthis.delay.setValue(0);\n\t\t\tthis.delay.setValueType('i');\n\t\t\tthis.delay.setBasis(formData.get('basis_in'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.delay.setType(type);\n\t\t\tthis.delay.setValue(formData.get(`value_${type}`));\n\t\t\tthis.delay.setValueType(formData.get(`value_type_${type}`));\n\n\t\t\tif (type === DelayInterval.DELAY_TYPE.After)\n\t\t\t{\n\t\t\t\tif (this.useAfterBasis)\n\t\t\t\t{\n\t\t\t\t\tthis.delay.setBasis(formData.get('basis_after'));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.delay.setBasis(DelayInterval.BASIS_TYPE.CurrentDateTime);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.minLimitM > 0\n\t\t\t\t\t&& this.delay.basis === DelayInterval.BASIS_TYPE.CurrentDateTime\n\t\t\t\t\t&& this.delay.valueType === 'i'\n\t\t\t\t\t&& this.delay.value < this.minLimitM\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('BIZPROC_AUTOMATION_DELAY_MIN_LIMIT_LABEL'),\n\t\t\t\t\t});\n\t\t\t\t\tthis.delay.setValue(this.minLimitM);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.delay.setBasis(formData.get('basis_before'));\n\t\t\t}\n\t\t}\n\t}\n\n\t#parseInTimeValue(value): ?[]\n\t{\n\t\tif (Type.isStringFilled(value))\n\t\t{\n\t\t\tconst result: string = value.trim();\n\n\t\t\tif (/^\\d{2}:\\d{2}\\s?[ap]?m?$/.test(result))\n\t\t\t{\n\t\t\t\tif (result.includes('am'))\n\t\t\t\t{\n\t\t\t\t\treturn [\n\t\t\t\t\t\tString(Text.toInteger(result.slice(0, 2)) % 12).padStart(2, '0'),\n\t\t\t\t\t\tString(Text.toInteger(result.slice(3)) % 60).padStart(2, '0'),\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tif (result.includes('pm'))\n\t\t\t\t{\n\t\t\t\t\treturn [\n\t\t\t\t\t\tString((Text.toInteger(result.slice(0, 2)) % 12) + 12).padStart(2, '0'),\n\t\t\t\t\t\tString(Text.toInteger(result.slice(3)) % 60).padStart(2, '0'),\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\treturn [\n\t\t\t\t\tString(Text.toInteger(result.slice(0, 2)) % 24).padStart(2, '0'),\n\t\t\t\t\tString(Text.toInteger(result.slice(3)) % 60).padStart(2, '0'),\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tcreateAfterControlNode(): HTMLElement\n\t{\n\t\tconst delay = this.delay;\n\t\tconst uid = Helper.generateUniqueId();\n\n\t\tconst valueAfter = (\n\t\t\tdelay.type === DelayInterval.DELAY_TYPE.After && delay.value\n\t\t\t\t? delay.value\n\t\t\t\t: (this.minLimitM || 5)\n\t\t);\n\n\t\tconst hiddenRow = this.#createHiddenRow(DelayInterval.DELAY_TYPE.After, 'value_type_after');\n\t\tconst chevron = this.#createShowHiddenRowChevron(hiddenRow, delay.valueType !== 'd', 'value_type_after');\n\n\t\tconst { root, labelAfter, radioAfter } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-select-item\">\n\t\t\t\t<label\n\t\t\t\t\tref=\"labelAfter\" \n\t\t\t\t\tclass=\"bizproc-automation-popup-select__wrapper ui-ctl ui-ctl-radio ui-ctl-w100\"\n\t\t\t\t\tfor=\"${uid}\"\n\t\t\t\t\tdata-role=\"select-item\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bizproc-automation-popup-select__visible-row\">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\tref=\"radioAfter\"\n\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\tid=\"${uid}\"\n\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-select__input ui-ctl-element\"\n\t\t\t\t\t\t\tvalue=\"${DelayInterval.DELAY_TYPE.After}\"\n\t\t\t\t\t\t\tname=\"type\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class=\"bizproc-automation-popup-settings__text --first\">\n\t\t\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_THROUGH_3')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tname=\"value_after\"\n\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings__input\"\n\t\t\t\t\t\t\tvalue=\"${Text.encode(valueAfter)}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t${this.createValueTypeSelector('value_type_after')}\n\t\t\t\t\t\t${this.#createAfterBasis()}\n\t\t\t\t\t\t${this.useAfterBasis ? chevron : ''}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.useAfterBasis ? hiddenRow : ''}\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(radioAfter, 'change', this.#onChangeDelayIntervalType.bind(this, labelAfter));\n\n\t\tif (delay.type === DelayInterval.DELAY_TYPE.After && delay.value > 0)\n\t\t{\n\t\t\tradioAfter.setAttribute('checked', 'checked');\n\t\t\tDom.addClass(labelAfter, '--active');\n\n\t\t\tif (delay.valueType === 'd' && this.delay.inTime)\n\t\t\t{\n\t\t\t\tDom.addClass(hiddenRow, '--visible');\n\t\t\t\tDom.addClass(chevron, '--active');\n\t\t\t}\n\t\t}\n\n\t\treturn root;\n\t}\n\n\t#createHiddenRow(delayIntervalType: string, role: string): HTMLDivElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-select__hidden-row\" data-role=\"hidden_row_${role}\">\n\t\t\t\t${this.#createTimeSelector(delayIntervalType)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createShowHiddenRowChevron(hiddenRow: HTMLElement, disabled: boolean, type: string): HTMLDivElement\n\t{\n\t\tconst chevron = Tag.render`\n\t\t\t<div \n\t\t\t\tclass=\"ui-icon-set --chevron-down bizproc-automation-popup-select__chevron\"\n\t\t\t\tdata-role=\"chevron_${type}\"\n\t\t\t\tstyle=\"display: none; /* TODO: fix this */\"\n\t\t\t></div>\n\t\t`;\n\n\t\tif (disabled)\n\t\t{\n\t\t\tthis.#disableSetTimeRow(chevron, hiddenRow);\n\t\t}\n\n\t\tEvent.bind(chevron, 'click', () => {\n\t\t\tif (Dom.hasClass(chevron, '--disabled'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.toggleClass(chevron, '--active');\n\t\t\tDom.toggleClass(hiddenRow, '--visible');\n\t\t});\n\n\t\treturn chevron;\n\t}\n\n\t#disableSetTimeRow(chevron, hiddenRow)\n\t{\n\t\tDom.removeClass(chevron, '--active');\n\t\tDom.addClass(chevron, '--disabled');\n\t\tDom.attr(chevron, {\n\t\t\t'data-hint-html': 'Y',\n\t\t\t'data-hint-no-icon': 'Y',\n\t\t});\n\t\tchevron.dataset.hint = Loc.getMessage('BIZPROC_JS_AUTOMATION_DELAY_INTERVAL_CHEVRON_DISABLED');\n\t\tDom.removeClass(hiddenRow, '--visible');\n\t\tBX.UI.Hint.initNode(chevron);\n\t}\n\n\t#enableSetTimeRow(chevron, hiddenRow)\n\t{\n\t\tDom.replace(\n\t\t\tchevron,\n\t\t\tthis.#createShowHiddenRowChevron(\n\t\t\t\thiddenRow,\n\t\t\t\tfalse,\n\t\t\t\tDom.attr(chevron, 'data-role').replace('chevron_', ''),\n\t\t\t),\n\t\t);\n\t}\n\n\t#createAfterBasis()\n\t{\n\t\tif (!this.useAfterBasis)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst delay = this.delay;\n\n\t\tlet basisField = this.getBasisField(delay.basis, true);\n\t\tlet basisValue = delay.basis;\n\t\tif (!basisField)\n\t\t{\n\t\t\tbasisField = this.getBasisField(DelayInterval.BASIS_TYPE.CurrentDateTime, true);\n\t\t\tbasisValue = basisField.SystemExpression;\n\t\t}\n\n\t\tconst beforeBasisNodeText = (\n\t\t\tbasisField\n\t\t\t\t? Text.encode(basisField.Name)\n\t\t\t\t: Loc.getMessage('BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD')\n\t\t);\n\n\t\tconst { root, beforeBasisValueNode, beforeBasisNode } = Tag.render`\n\t\t\t<span class=\"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-auto-width\">\n\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_AFTER')}\n\t\t\t</span>\n\t\t\t<input ref=\"beforeBasisValueNode\" type=\"hidden\" name=\"basis_after\" value=\"${Text.encode(basisValue)}\">\n\t\t\t<span class=\"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis\">\n\t\t\t\t<span ref=\"beforeBasisNode\">\n\t\t\t\t\t${Text.encode(beforeBasisNodeText)}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bind(beforeBasisNode, 'click', (event) => {\n\t\t\tconst callback = (field) => {\n\t\t\t\tbeforeBasisNode.textContent = Text.encode(field.Name);\n\t\t\t\tbeforeBasisValueNode.value = field.SystemExpression;\n\t\t\t};\n\t\t\tthis.onBasisClick(event, beforeBasisNode, callback, DelayInterval.DELAY_TYPE.After);\n\t\t});\n\n\t\treturn root;\n\t}\n\n\tcreateBeforeControlNode()\n\t{\n\t\tconst delay = this.delay;\n\t\tconst uid = Helper.generateUniqueId();\n\n\t\tconst valueBefore = (\n\t\t\tdelay.type === DelayInterval.DELAY_TYPE.Before && delay.value\n\t\t\t\t? delay.value\n\t\t\t\t: (this.minLimitM || 5)\n\t\t);\n\n\t\tconst hiddenRow = this.#createHiddenRow(DelayInterval.DELAY_TYPE.Before, 'value_type_before');\n\t\tconst chevron = this.#createShowHiddenRowChevron(hiddenRow, delay.valueType !== 'd', 'value_type_before');\n\n\t\tconst { root, labelBefore, radioBefore } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-select-item\">\n\t\t\t\t<label\n\t\t\t\t\tref=\"labelBefore\"\n\t\t\t\t\tclass=\"bizproc-automation-popup-select__wrapper ui-ctl ui-ctl-radio ui-ctl-w100\"\n\t\t\t\t\tfor=\"${uid}\"\n\t\t\t\t\tdata-role=\"select-item\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bizproc-automation-popup-select__visible-row\"> \n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref=\"radioBefore\"\n\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\tid=\"${uid}\"\n\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-select__input ui-ctl-element\"\n\t\t\t\t\t\t\tvalue=\"${DelayInterval.DELAY_TYPE.Before}\"\n\t\t\t\t\t\t\tname=\"type\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class=\"bizproc-automation-popup-settings__text --first\">\n\t\t\t\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_FOR_TIME_3')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tname=\"value_before\"\n\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings__input\"\n\t\t\t\t\t\t\tvalue=\"${Text.encode(valueBefore)}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t${this.createValueTypeSelector('value_type_before')}\n\t\t\t\t\t\t${this.#createBeforeBasis()}\n\t\t\t\t\t\t${chevron}\n\t\t\t\t\t</div>\n\t\t\t\t\t${hiddenRow}\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(radioBefore, 'change', this.#onChangeDelayIntervalType.bind(this, labelBefore));\n\n\t\tif (delay.type === DelayInterval.DELAY_TYPE.Before)\n\t\t{\n\t\t\tradioBefore.setAttribute('checked', 'checked');\n\t\t\tDom.addClass(labelBefore, '--active');\n\n\t\t\tif (delay.valueType === 'd' && this.delay.inTime)\n\t\t\t{\n\t\t\t\tDom.addClass(hiddenRow, '--visible');\n\t\t\t\tDom.addClass(chevron, '--active');\n\t\t\t}\n\t\t}\n\n\t\treturn root;\n\t}\n\n\t#createBeforeBasis()\n\t{\n\t\tconst delay = this.delay;\n\n\t\tlet basisField = this.getBasisField(delay.basis);\n\t\tlet basisValue = delay.basis;\n\t\tif (!basisField)\n\t\t{\n\t\t\tbasisField = this.basisFields[0];\n\t\t\tbasisValue = basisField.SystemExpression;\n\t\t}\n\n\t\tconst { root, beforeBasisValueNode, beforeBasisNode } = Tag.render`\n\t\t\t<span class=\"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-auto-width\">\n\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_BEFORE_1')}\n\t\t\t</span>\n\t\t\t<input ref=\"beforeBasisValueNode\" type=\"hidden\" name=\"basis_before\" value=\"${basisValue}\">\n\t\t\t<span class=\"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis\">\n\t\t\t\t<span ref=\"beforeBasisNode\">\n\t\t\t\t\t${basisField ? basisField.Name : Loc.getMessage('BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD')}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bind(beforeBasisNode, 'click', (event) => {\n\t\t\tconst callback = (field) => {\n\t\t\t\tbeforeBasisNode.textContent = Text.encode(field.Name);\n\t\t\t\tbeforeBasisValueNode.value = Text.encode(field.SystemExpression);\n\t\t\t};\n\t\t\tthis.onBasisClick(event, beforeBasisNode, callback, DelayInterval.DELAY_TYPE.Before);\n\t\t});\n\n\t\treturn root;\n\t}\n\n\tcreateInControlNode()\n\t{\n\t\tconst delay = this.delay;\n\t\tconst uid = Helper.generateUniqueId();\n\n\t\tconst hiddenRow = this.#createHiddenRow(DelayInterval.DELAY_TYPE.In, 'value_type_in');\n\t\tconst chevron = this.#createShowHiddenRowChevron(hiddenRow, false, 'value_type_in');\n\n\t\tconst { root, labelIn, radioIn } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-select-item\">\n\t\t\t\t<label\n\t\t\t\t\tref=\"labelIn\"\n\t\t\t\t\tclass=\"bizproc-automation-popup-select__wrapper --last ui-ctl ui-ctl-radio ui-ctl-w100\"\n\t\t\t\t\tfor=\"${uid}\"\n\t\t\t\t\tdata-role=\"select-item\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bizproc-automation-popup-select__visible-row\">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\tref=\"radioIn\"\n\t\t\t\t\t\t\tclass=\"bizproc-automation-popup-select__input ui-ctl-element\" \n\t\t\t\t\t\t\tid=\"${uid}\" \n\t\t\t\t\t\t\ttype=\"radio\" \n\t\t\t\t\t\t\tvalue=\"${DelayInterval.DELAY_TYPE.In}\" \n\t\t\t\t\t\t\tname=\"type\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t${this.#createInBasis()}\n\t\t\t\t\t\t${chevron}\n\t\t\t\t\t</div>\n\t\t\t\t\t${hiddenRow}\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`;\n\t\tEvent.bind(radioIn, 'change', this.#onChangeDelayIntervalType.bind(this, labelIn));\n\n\t\tif (delay.type === DelayInterval.DELAY_TYPE.In)\n\t\t{\n\t\t\tradioIn.setAttribute('checked', 'checked');\n\t\t\tDom.addClass(labelIn, '--active');\n\n\t\t\tif (this.delay.inTime)\n\t\t\t{\n\t\t\t\tDom.addClass(hiddenRow, '--visible');\n\t\t\t\tDom.addClass(chevron, '--active');\n\t\t\t}\n\t\t}\n\n\t\treturn root;\n\t}\n\n\t#createInBasis()\n\t{\n\t\tconst delay = this.delay;\n\n\t\tlet basisField = this.getBasisField(delay.basis, true);\n\t\tlet basisValue = delay.basis;\n\t\tif (!basisField)\n\t\t{\n\t\t\tbasisField = this.basisFields[0];\n\t\t\tbasisValue = basisField.SystemExpression;\n\t\t}\n\n\t\tconst { root, inBasisValueNode, inBasisNode } = Tag.render`\n\t\t\t<span class=\"bizproc-automation-popup-settings__text --first\">\n\t\t\t\t${Loc.getMessage('BIZPROC_AUTOMATION_CMP_IN_TIME_2')}\n\t\t\t</span>\n\t\t\t<input ref=\"inBasisValueNode\" type=\"hidden\" name=\"basis_in\" value=\"${basisValue}\"/>\n\t\t\t<span class=\"bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis\">\n\t\t\t\t<span ref=\"inBasisNode\">\n\t\t\t\t\t${basisField ? basisField.Name : Loc.getMessage('BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD')}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t`;\n\t\tEvent.bind(inBasisNode, 'click', (event) => {\n\t\t\tconst callback = (field) => {\n\t\t\t\tinBasisNode.textContent = Text.encode(field.Name);\n\t\t\t\tinBasisValueNode.value = Text.encode(field.SystemExpression);\n\t\t\t};\n\t\t\tthis.onBasisClick(event, inBasisNode, callback, DelayInterval.DELAY_TYPE.In);\n\t\t});\n\n\t\treturn root;\n\t}\n\n\t#createTimeSelector(delayType: string): HTMLSpanElement\n\t{\n\t\tconst value: [] = delayType === this.delay.type ? this.delay.inTime : [];\n\t\tconst formattedValue = this.#formatTimeToString(value ?? []);\n\n\t\tconst { root, input } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-settings__text\">\n\t\t\t\t<span style=\"margin-right: 10px\">\n\t\t\t\t\t${Loc.getMessage('BIZPROC_JS_AUTOMATION_DELAY_INTERVAL_SET_TIME_LABEL')}\n\t\t\t\t</span>\n\t\t\t\t<input\n\t\t\t\t\tref=\"input\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tname=\"basis_in_time_${Text.encode(delayType)}\"\n\t\t\t\t\tclass=\"bizproc-automation-delay-interval-set-time bizproc-automation-popup-settings__input\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tvalue=\"${Text.encode(formattedValue)}\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;\n\n\t\t(new InlineTimeSelector({ context: { fields: [] }, showValuesSelector: false })).renderTo(input);\n\n\t\treturn root;\n\t}\n\n\t#formatTimeToString(time: []): string\n\t{\n\t\tconst dateFormat = (\n\t\t\tBX.Main.Date.convertBitrixFormat(Loc.getMessage('FORMAT_DATE'))\n\t\t\t\t.replace(/:?\\s*s/, '')\n\t\t);\n\t\tconst timeFormat = (\n\t\t\tBX.Main.Date.convertBitrixFormat(Loc.getMessage('FORMAT_DATETIME'))\n\t\t\t\t.replace(`${dateFormat} `, '')\n\t\t\t\t.replace(':s', '')\n\t\t);\n\n\t\tconst date = new Date();\n\t\tdate.setHours(time[0] ?? 0, time[1] ?? 0, 0, 0);\n\n\t\treturn Type.isArrayFilled(time) ? DateTimeFormat.format(timeFormat, date) : '';\n\t}\n\n\tcreateValueTypeSelector(name)\n\t{\n\t\tconst delay = this.delay;\n\t\tconst labelTexts = {\n\t\t\ti: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_M'),\n\t\t\th: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_H'),\n\t\t\td: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_D'),\n\t\t};\n\n\t\tconst { root, label, input } = Tag.render`\n\t\t\t<span>\n\t\t\t\t<label ref=\"label\" class=\"bizproc-automation-popup-settings-link\">\n\t\t\t\t\t${Text.encode(labelTexts[delay.valueType])}\n\t\t\t\t</label>\n\t\t\t\t<input ref=\"input\" type=\"hidden\" name=\"${Text.encode(name)}\" value=\"${Text.encode(delay.valueType)}\"/>\n\t\t\t</span>\n\t\t`;\n\n\t\tEvent.bind(label, 'click', this.onValueTypeSelectorClick.bind(this, label, input));\n\n\t\treturn root;\n\t}\n\n\tonValueTypeSelectorClick(label, input)\n\t{\n\t\tconst uid = Helper.generateUniqueId();\n\n\t\tconst handler = (event, item: MenuItem) => {\n\t\t\titem.getMenuWindow().close();\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinput.value = item.valueId;\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tlabel.textContent = item.text;\n\n\t\t\tif (item.valueId === 'd')\n\t\t\t{\n\t\t\t\tthis.#enableSetTimeRow(\n\t\t\t\t\tdocument.querySelector(`[data-role=\"chevron_${input.name}\"]`),\n\t\t\t\t\tdocument.querySelector(`[data-role=\"hidden_row_${input.name}\"]`),\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#disableSetTimeRow(\n\t\t\t\t\tdocument.querySelector(`[data-role=\"chevron_${input.name}\"]`),\n\t\t\t\t\tdocument.querySelector(`[data-role=\"hidden_row_${input.name}\"]`),\n\t\t\t\t);\n\t\t\t}\n\t\t};\n\n\t\tconst menuItems = [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_M'),\n\t\t\t\tvalueId: 'i',\n\t\t\t\tonclick: handler,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_H'),\n\t\t\t\tvalueId: 'h',\n\t\t\t\tonclick: handler,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_INTERVAL_D'),\n\t\t\t\tvalueId: 'd',\n\t\t\t\tonclick: handler,\n\t\t\t},\n\t\t];\n\n\t\tMenuManager.show(\n\t\t\tuid,\n\t\t\tlabel,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: 25,\n\t\t\t\tangle: { position: 'top' },\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\toverlay: { backgroundColor: 'transparent' },\n\t\t\t},\n\t\t);\n\n\t\tthis.valueTypeMenu = MenuManager.currentItem;\n\t}\n\n\tonBasisClick(event, labelNode, callback, delayType)\n\t{\n\t\tconst menuItems = [];\n\n\t\tconst onMenuItemClick = (e, item: MenuItem) => {\n\t\t\tif (callback)\n\t\t\t{\n\t\t\t\tcallback(item.field || item.options.field);\n\t\t\t}\n\n\t\t\titem.getMenuWindow().close();\n\t\t};\n\n\t\tif (delayType === DelayInterval.DELAY_TYPE.After || delayType === DelayInterval.DELAY_TYPE.In)\n\t\t{\n\t\t\tmenuItems.push(\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_NOW'),\n\t\t\t\t\tfield: {\n\t\t\t\t\t\tName: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_NOW'),\n\t\t\t\t\t\tSystemExpression: DelayInterval.BASIS_TYPE.CurrentDateTime,\n\t\t\t\t\t},\n\t\t\t\t\tonclick: onMenuItemClick,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_DATE'),\n\t\t\t\t\tfield: {\n\t\t\t\t\t\tName: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_DATE'),\n\t\t\t\t\t\tSystemExpression: DelayInterval.BASIS_TYPE.CurrentDate,\n\t\t\t\t\t},\n\t\t\t\t\tonclick: onMenuItemClick,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tdelimiter: true,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tfor (let i = 0; i < this.basisFields.length; ++i)\n\t\t{\n\t\t\tif (\n\t\t\t\tdelayType !== DelayInterval.DELAY_TYPE.After\n\t\t\t\t&& this.basisFields[i].Id.includes('DATE_CREATE')\n\t\t\t)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Text.encode(this.basisFields[i].Name),\n\t\t\t\tfield: this.basisFields[i],\n\t\t\t\tonclick: onMenuItemClick,\n\t\t\t});\n\t\t}\n\n\t\tlet menuId = labelNode.getAttribute('data-menu-id');\n\t\tif (!menuId)\n\t\t{\n\t\t\tmenuId = Helper.generateUniqueId();\n\t\t\tlabelNode.setAttribute('data-menu-id', menuId);\n\t\t}\n\n\t\tMenuManager.show(\n\t\t\tmenuId,\n\t\t\tlabelNode,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: (Dom.getPosition(labelNode).width / 2),\n\t\t\t\tangle: { position: 'top', offset: 0 },\n\t\t\t\toverlay: { backgroundColor: 'transparent' },\n\t\t\t},\n\t\t);\n\n\t\tthis.fieldsMenu = MenuManager.currentItem;\n\t}\n\n\tgetBasisField(basis, system)\n\t{\n\t\tif (\n\t\t\tsystem\n\t\t\t&& (\n\t\t\t\tbasis === DelayInterval.BASIS_TYPE.CurrentDateTime\n\t\t\t\t|| basis === DelayInterval.BASIS_TYPE.CurrentDateTimeLocal\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn {\n\t\t\t\tName: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_NOW'),\n\t\t\t\tSystemExpression: DelayInterval.BASIS_TYPE.CurrentDateTime,\n\t\t\t};\n\t\t}\n\n\t\tif (system && basis === DelayInterval.BASIS_TYPE.CurrentDate)\n\t\t{\n\t\t\treturn {\n\t\t\t\tName: Loc.getMessage('BIZPROC_AUTOMATION_CMP_BASIS_DATE'),\n\t\t\t\tSystemExpression: DelayInterval.BASIS_TYPE.CurrentDate,\n\t\t\t};\n\t\t}\n\n\t\tlet field = null;\n\t\tfor (let i = 0; i < this.basisFields.length; ++i)\n\t\t{\n\t\t\tif (basis === this.basisFields[i].SystemExpression)\n\t\t\t{\n\t\t\t\tfield = this.basisFields[i];\n\t\t\t}\n\t\t}\n\n\t\treturn field;\n\t}\n\n\tprepareBasisFields()\n\t{\n\t\tconst fields = [];\n\t\tfor (let i = 0; i < this.basisFields.length; ++i)\n\t\t{\n\t\t\tconst fld = this.basisFields[i];\n\t\t\tif (\n\t\t\t\t!fld.Id.includes('DATE_MODIFY')\n\t\t\t\t&& !fld.Id.includes('EVENT_DATE')\n\t\t\t\t&& !fld.Id.includes('BIRTHDATE')\n\t\t\t)\n\t\t\t{\n\t\t\t\tfields.push(fld);\n\t\t\t}\n\t\t}\n\n\t\tthis.basisFields = fields;\n\t}\n\n\t#createWaitWorkDayNode()\n\t{\n\t\tconst delay = this.delay;\n\t\tconst uid = Helper.generateUniqueId();\n\t\tconst isAvailable = this.#isWorkTimeAvailable();\n\n\t\tconst { root, workDayCheckbox } = Tag.render`\n\t\t\t<div class=\"bizproc-automation-popup-select-item\">\n\t\t\t\t<div class=\"bizproc-automation-popup-settings__checkbox-label\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref=\"workDayCheckbox\"\n\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings__checkbox\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tid=\"${`${uid}wait_workday`}\"\n\t\t\t\t\t\tname=\"wait_workday\"\n\t\t\t\t\t\tvalue=\"1\"\n\t\t\t\t\t\tstyle=\"vertical-align: middle\"\n\t\t\t\t\t/>\n\t\t\t\t\t<label\n\t\t\t\t\t\tclass=\"bizproc-automation-popup-settings-lbl ${isAvailable ? '' : 'bizproc-automation-robot-btn-set-locked'}\"\n\t\t\t\t\t\tfor=\"${`${uid}wait_workday`}\"\n\t\t\t\t\t>${Loc.getMessage('BIZPROC_AUTOMATION_DELAY_WAIT_WORK_DAY_MSGVER_1')}</label>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"bizproc-automation-status-help bizproc-automation-status-help-right\"\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('BIZPROC_AUTOMATION_DELAY_WAIT_WORK_DAY_HELP')}\"\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tif (delay.waitWorkDay && isAvailable)\n\t\t{\n\t\t\tDom.attr(workDayCheckbox, 'checked', 'checked');\n\t\t}\n\n\t\tif (!isAvailable)\n\t\t{\n\t\t\tEvent.bind(root, 'click', () => {\n\t\t\t\tif (top.BX.UI && top.BX.UI.InfoHelper)\n\t\t\t\t{\n\t\t\t\t\ttop.BX.UI.InfoHelper.show('limit_office_worktime_responsible');\n\t\t\t\t}\n\t\t\t});\n\t\t\tworkDayCheckbox.disabled = true;\n\t\t}\n\n\t\treturn root;\n\t}\n\n\t#isWorkTimeAvailable(): boolean\n\t{\n\t\treturn getGlobalContext().get('IS_WORKTIME_AVAILABLE') ?? false;\n\t}\n}\n","import { Type } from 'main.core';\nimport { BaseContext } from './base-context';\nimport { Field } from '../selectors/types';\n\nexport class SelectorContext extends BaseContext\n{\n\tconstructor(props: {\n\t\tfields: Array<Field>,\n\t\tuseSwitcherMenu: boolean,\n\t\trootGroupTitle: string,\n\t})\n\t{\n\t\tsuper(props);\n\t}\n\n\tget fields(): Array<Field>\n\t{\n\t\tconst fields = this.get('fields');\n\n\t\treturn Type.isArray(fields) ? fields : [];\n\t}\n\n\tget useSwitcherMenu(): boolean\n\t{\n\t\treturn Type.isBoolean(this.get('useSwitcherMenu')) ? this.get('useSwitcherMenu') : false;\n\t}\n\n\tset useSwitcherMenu(value: boolean)\n\t{\n\t\tthis.set('useSwitcherMenu', value);\n\t}\n\n\tget rootGroupTitle(): string\n\t{\n\t\treturn this.get('rootGroupTitle') ?? '';\n\t}\n}","import {Type} from 'main.core';\nimport {Globals} from \"bizproc.globals\";\n\nexport class AutomationGlobals\n{\n\t#globalVariables: [] = [];\n\t#globalConstants: [] = [];\n\n\tconstructor(parameters: {\n\t\tvariables: ?[],\n\t\tconstants: ?[],\n\t})\n\t{\n\t\tif (Type.isArrayFilled(parameters.variables))\n\t\t{\n\t\t\tconst variables = [];\n\t\t\tparameters.variables.forEach((property) => {\n\t\t\t\tvariables.push(\n\t\t\t\t\tthis.#getAutomationGlobalsProperty(property.Id, property, Globals.Manager.Instance.mode.variable)\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tthis.#globalVariables = variables;\n\t\t}\n\n\t\tif (Type.isArrayFilled(parameters.constants))\n\t\t{\n\t\t\tconst constants = [];\n\t\t\tparameters.constants.forEach((property) => {\n\t\t\t\tconstants.push(\n\t\t\t\t\tthis.#getAutomationGlobalsProperty(property.Id, property, Globals.Manager.Instance.mode.constant)\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tthis.#globalConstants = constants;\n\t\t}\n\t}\n\n\tget globalVariables(): []\n\t{\n\t\treturn this.#globalVariables;\n\t}\n\n\tset globalVariables(variables: [])\n\t{\n\t\tif (!Type.isArray(variables))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#globalVariables = variables;\n\t}\n\n\tget globalConstants(): []\n\t{\n\t\treturn this.#globalConstants;\n\t}\n\n\tset globalConstants(constants: [])\n\t{\n\t\tif (!Type.isArray(constants))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#globalConstants = constants;\n\t}\n\n\t#isCorrectMode(mode): boolean\n\t{\n\t\treturn Type.isStringFilled(mode) && Object.values(Globals.Manager.Instance.mode).includes(mode);\n\t}\n\n\t#getAutomationGlobalsProperty(id: string, property: {}, mode: string): {\n\t\tObjectId: string,\n\t\tSuperTitle: string,\n\t\tId: string,\n\t\tName: string,\n\t\tType: string,\n\t\tBaseType: string,\n\t\tExpression: string,\n\t\tSystemExpression: string,\n\t\tOptions: any,\n\t\tMultiple: boolean,\n\t\tVisibility: string,\n\t}\n\t{\n\t\treturn {\n\t\t\tObjectId: this.#getObjectId(mode),\n\t\t\tSuperTitle: String(property.VisibilityName),\n\t\t\tId: String(id),\n\t\t\tName: String(property.Name),\n\t\t\tType: String(property.Type),\n\t\t\tBaseType: String(property.BaseType || property.Type),\n\t\t\tExpression:\n\t\t\t\tType.isStringFilled(property.Expression)\n\t\t\t\t\t? property.Expression\n\t\t\t\t\t: this.#getExpression(property.Name, property.VisibilityName)\n\t\t\t,\n\t\t\tSystemExpression:\n\t\t\t\tType.isStringFilled(property.SystemExpression)\n\t\t\t\t\t? property.SystemExpression\n\t\t\t\t\t: this.#getSystemExpression(mode, id)\n\t\t\t,\n\t\t\tOptions: property.Options,\n\t\t\tMultiple: Type.isBoolean(property.Multiple) ? property.Multiple : property.Multiple === 'Y',\n\t\t\tVisibility: String(property.Visibility),\n\t\t};\n\t}\n\n\t#getExpression(name, visibilityName): string\n\t{\n\t\treturn '{{' + String(visibilityName) + ': ' + String(name) + '}}'\n\t}\n\n\t#getSystemExpression(mode, id): string\n\t{\n\t\treturn '{=' + this.#getObjectId(mode) + ':' + String(id) + '}';\n\t}\n\n\t#getObjectId(mode): string\n\t{\n\t\treturn (mode === Globals.Manager.Instance.mode.variable) ? 'GlobalVar' : 'GlobalConst'\n\t}\n\n\tupdateGlobals(mode: string, updatedGlobals: {})\n\t{\n\t\tif (!this.#isCorrectMode(mode) || Object.keys(updatedGlobals).length < 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet globals = this.#getGlobals(mode);\n\n\t\tconst newGlobals = [];\n\t\tfor (const id in updatedGlobals)\n\t\t{\n\t\t\tconst property = updatedGlobals[id];\n\t\t\tconst index = globals.findIndex(prop => prop.Id === id);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tif (globals[index].Name !== property.Name)\n\t\t\t\t{\n\t\t\t\t\tglobals[index].Name = property.Name;\n\t\t\t\t\tglobals[index].Expression = this.#getExpression(property.Name, property.VisibilityName);\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnewGlobals.push(this.#getAutomationGlobalsProperty(id, property, mode));\n\t\t}\n\n\t\tif (Type.isArrayFilled(newGlobals))\n\t\t{\n\t\t\tglobals = globals.concat(newGlobals);\n\t\t}\n\n\t\tthis.#setGlobals(mode, globals);\n\t}\n\n\tdeleteGlobals(mode: string, deletedGlobals: [])\n\t{\n\t\tif (!this.#isCorrectMode(mode) || !Type.isArrayFilled(deletedGlobals))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst globals = this.#getGlobals(mode);\n\n\t\tdeletedGlobals.forEach((id) => {\n\t\t\tconst index = globals.findIndex((prop) => prop.Id === id);\n\t\t\tif (index > -1)\n\t\t\t{\n\t\t\t\tglobals.splice(index, 1);\n\t\t\t}\n\t\t});\n\n\t\tthis.#setGlobals(mode, globals);\n\t}\n\n\t#getGlobals(mode): []\n\t{\n\t\tif (mode === Globals.Manager.Instance.mode.variable)\n\t\t{\n\t\t\treturn this.globalVariables;\n\t\t}\n\n\t\tif (mode === Globals.Manager.Instance.mode.constant)\n\t\t{\n\t\t\treturn this.globalConstants;\n\t\t}\n\t}\n\n\t#setGlobals(mode, globals)\n\t{\n\t\tif (mode === Globals.Manager.Instance.mode.variable)\n\t\t{\n\t\t\tthis.#globalVariables = globals;\n\t\t}\n\n\t\tif (mode === Globals.Manager.Instance.mode.constant)\n\t\t{\n\t\t\tthis.#globalConstants = globals;\n\t\t}\n\t}\n}","import {Dom} from 'main.core';\nimport {getGlobalContext, TrackingStatus, Template} from \"bizproc.automation\";\n\nexport class Statuses\n{\n\t#nodes: Array<HTMLElement> = [];\n\t#lastColorStatusIndex: number = -1;\n\t#defaultStatusColor: string = '#d4d6da';\n\n\tconstructor(stagesContainerNode: HTMLElement)\n\t{\n\t\tconst stagesContainer = stagesContainerNode.querySelector('.bizproc-automation-status-list');\n\t\tif (stagesContainer)\n\t\t{\n\t\t\tthis.#nodes = stagesContainer.querySelectorAll('[data-role=\"automation-status-title\"]');\n\t\t}\n\t}\n\n\tinit(templates: Array<Template>): void\n\t{\n\t\tconst context = getGlobalContext();\n\t\tif (context.document.getId() <= 0)\n\t\t{\n\t\t\tthis.#lastColorStatusIndex = this.#nodes.length - 1;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#lastColorStatusIndex = templates.findIndex((template) => (\n\t\t\t\ttemplate.getStatusId() === context.document.getCurrentStatusId()\n\t\t\t));\n\t\t}\n\t}\n\n\tfixColors(): void\n\t{\n\t\tthis.#fixBackgroundColors();\n\t\tthis.#fixTitleColors();\n\t}\n\n\t#fixBackgroundColors(): void\n\t{\n\t\tthis.#nodes.forEach((statusNode, index) => {\n\t\t\tconst backgroundNode = statusNode.querySelector('.bizproc-automation__status--bg');\n\n\t\t\tif (backgroundNode)\n\t\t\t{\n\t\t\t\tconst color = (\n\t\t\t\t\tthis.#isColorStatus(index) && statusNode.dataset.bgcolor\n\t\t\t\t\t\t? statusNode.dataset.bgcolor\n\t\t\t\t\t\t: this.#defaultStatusColor\n\t\t\t\t);\n\n\t\t\t\tDom.style(backgroundNode, {\n\t\t\t\t\tbackgroundColor: color,\n\t\t\t\t\tborderColor: color,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t#fixTitleColors(): void\n\t{\n\t\tthis.#nodes.forEach((statusNode, index) => {\n\t\t\tif (!this.#isColorStatus(index))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst backgroundColor = statusNode.dataset.bgcolor;\n\t\t\tif (backgroundColor)\n\t\t\t{\n\t\t\t\tconst bigint = parseInt(backgroundColor, 16);\n\t\t\t\tconst red = (bigint >> 16) & 255;\n\t\t\t\tconst green = (bigint >> 8) & 255;\n\t\t\t\tconst blue = bigint & 255;\n\n\t\t\t\tconst isDarkColor = 0.21 * red + 0.72 * green + 0.07 * blue < 145;\n\t\t\t\tif (isDarkColor)\n\t\t\t\t{\n\t\t\t\t\tDom.style(statusNode, 'color', 'white');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t#isColorStatus(index: number): boolean\n\t{\n\t\treturn index <= this.#lastColorStatusIndex;\n\t}\n}","import {Loc, Type, Text} from 'main.core';\nimport {Guide} from 'ui.tour';\n\nexport class BeginningGuide\n{\n\t#guide: Guide;\n\n\tconstructor(options: {target: HTMLElement, text?: string, article?: string})\n\t{\n\t\tif (!Type.isElementNode(options.target))\n\t\t{\n\t\t\tthrow 'options.target must be Node Element';\n\t\t}\n\n\t\tconst text =\n\t\t\tType.isStringFilled(options.text)\n\t\t\t\t? options.text\n\t\t\t\t: Loc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_SUBTITLE_1')\n\t\t;\n\t\tconst article = Type.isStringFilled(options.article) ? Text.toInteger(options.article) : '';\n\n\t\tthis.#guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: options.target,\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_TITLE'),\n\t\t\t\t\ttext,\n\t\t\t\t\tarticle,\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: true,\n\t\t\t\t\t\tbottom: false,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\n\t\tthis.#guide.getPopup().setAutoHide(true);\n\t}\n\n\tstart()\n\t{\n\t\tthis.#guide.showNextStep();\n\t}\n}","import { Loc, Type, Text } from 'main.core';\nimport { Guide } from 'ui.tour';\n\nimport '../css/tourguide.css';\n\nexport class AutomationGuide\n{\n\t#isShownRobotGuide: boolean = true;\n\t#isShownTriggerGuide: boolean = true;\n\n\t#isShownSupportingRobotGuide: boolean = false;\n\n\t#showRobotGuide: boolean = false;\n\t#showTriggerGuide: boolean = false;\n\t#showSupportingRobotGuide: boolean = false;\n\n\t#guideTargets: {\n\t\ttrigger?: Element,\n\t\tsupportingRobot?: Element,\n\t\trobot?: Element,\n\t} = {};\n\n\tconstructor(options: {\n\t\tisShownRobotGuide: boolean,\n\t\tisShownTriggerGuide: boolean,\n\t})\n\t{\n\t\tif (Type.isBoolean(options.isShownRobotGuide))\n\t\t{\n\t\t\tthis.#isShownRobotGuide = options.isShownRobotGuide;\n\t\t}\n\t\tif (Type.isBoolean(options.isShownTriggerGuide))\n\t\t{\n\t\t\tthis.#isShownTriggerGuide = options.isShownTriggerGuide;\n\t\t}\n\t}\n\n\tget isShownRobotGuide(): boolean\n\t{\n\t\treturn this.#isShownRobotGuide;\n\t}\n\n\tget isShownTriggerGuide(): boolean\n\t{\n\t\treturn this.#isShownTriggerGuide;\n\t}\n\n\tsetShowRobotGuide(show: boolean, target?: Element)\n\t{\n\t\tthis.#showRobotGuide = show;\n\n\t\tif (show)\n\t\t{\n\t\t\tthis.#guideTargets['robot'] = target ?? null;\n\t\t}\n\t}\n\n\tsetShowTriggerGuide(show: boolean, target?: Element)\n\t{\n\t\tthis.#showTriggerGuide = show;\n\n\t\tif (show)\n\t\t{\n\t\t\tthis.#guideTargets['trigger'] = target ?? null;\n\t\t}\n\t}\n\n\tsetShowSupportingRobotGuide(show: boolean, target?: Element)\n\t{\n\t\tthis.#showSupportingRobotGuide = show;\n\n\t\tif (show)\n\t\t{\n\t\t\tthis.#guideTargets['supportingRobot'] = target ?? null;\n\t\t}\n\t}\n\n\t#resolveShowGuides()\n\t{\n\t\t// settings\n\t\tif (this.#isShownTriggerGuide)\n\t\t{\n\t\t\tthis.#showTriggerGuide = false;\n\t\t}\n\n\t\tif (this.#isShownSupportingRobotGuide)\n\t\t{\n\t\t\tthis.#showSupportingRobotGuide = false;\n\t\t\tthis.#isShownRobotGuide = true;\n\t\t}\n\n\t\tif (this.#isShownRobotGuide)\n\t\t{\n\t\t\tthis.#showRobotGuide = false;\n\t\t}\n\n\t\t// logic\n\t\tif (this.#showSupportingRobotGuide)\n\t\t{\n\t\t\tthis.#isShownRobotGuide = true;\n\t\t}\n\t}\n\n\t#getGuide(): ?Guide\n\t{\n\t\tlet guide = null;\n\n\t\tif (this.#showSupportingRobotGuide)\n\t\t{\n\t\t\tif (Type.isDomNode(this.#guideTargets['supportingRobot']))\n\t\t\t{\n\t\t\t\tguide = this.#getSupportingRobotGuide();\n\t\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\t}\n\n\t\t\treturn guide;\n\t\t}\n\n\t\tif (this.#showTriggerGuide)\n\t\t{\n\t\t\tif (Type.isDomNode(this.#guideTargets['trigger']))\n\t\t\t{\n\t\t\t\tguide = this.#getTriggerGuide();\n\t\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\t}\n\n\t\t\treturn guide;\n\t\t}\n\n\t\tif (this.#showRobotGuide)\n\t\t{\n\t\t\tif (Type.isDomNode(this.#guideTargets['robot']))\n\t\t\t{\n\t\t\t\tguide = this.#getRobotGuide();\n\t\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\t}\n\n\t\t\treturn guide;\n\t\t}\n\n\t\treturn guide;\n\t}\n\n\tstart()\n\t{\n\t\tthis.#resolveShowGuides();\n\t\tconst guide = this.#getGuide();\n\t\tif (guide)\n\t\t{\n\t\t\tconst bindElement = guide.getCurrentStep().target;\n\t\t\tif (Type.isDomNode(bindElement) && document.body.contains(bindElement))\n\t\t\t{\n\t\t\t\tguide.showNextStep();\n\t\t\t}\n\t\t}\n\t}\n\n\t#getRobotGuide(): Guide\n\t{\n\t\treturn new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#guideTargets['robot'],\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_TITLE_1'),\n\t\t\t\t\ttext: this.constructor.#getText([\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_SUBTITLE_1'),\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_SUBTITLE_2')\n\t\t\t\t\t]),\n\t\t\t\t\tarticle: '16547618',\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'onShow': () => {\n\t\t\t\t\t\t\tthis.#isShownRobotGuide = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t}\n\n\t#getTriggerGuide(): Guide\n\t{\n\t\treturn new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#guideTargets['trigger'],\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_TITLE_1'),\n\t\t\t\t\ttext: this.constructor.#getText([\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_SUBTITLE_1'),\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_SUBTITLE_2')\n\t\t\t\t\t]),\n\t\t\t\t\tarticle: '16547632',\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'onShow': () => {\n\t\t\t\t\t\t\tthis.#isShownTriggerGuide = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t}\n\n\t#getSupportingRobotGuide(): Guide\n\t{\n\t\treturn new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#guideTargets['supportingRobot'],\n\t\t\t\t\ttitle: Loc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_TITLE'),\n\t\t\t\t\ttext: this.constructor.#getText([\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_SUBTITLE_1'),\n\t\t\t\t\t\tLoc.getMessage('BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_SUBTITLE_2'),\n\t\t\t\t\t]),\n\t\t\t\t\tarticle: '16547644',\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t'onShow': () => {\n\t\t\t\t\t\t\tthis.#isShownSupportingRobotGuide = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tonEvents: true,\n\t\t});\n\t}\n\n\tstatic #getText(subtitles: Array): Element\n\t{\n\t\tlet text = `<ul class=\"bizproc-automation-tour-guide-list\">`;\n\n\t\tfor (const subtitle of subtitles)\n\t\t{\n\t\t\ttext += `<li class=\"bizproc-automation-tour-guide-list-item\"> ${Text.encode(subtitle)} </li>`;\n\t\t}\n\n\t\ttext += `</ul>`;\n\n\t\treturn text;\n\t}\n}","import TemplatesScheme from './templates-scheme';\nimport { Context } from './context/context';\n\nexport { TemplateScope } from './template-scope';\nexport { TriggerManager } from './trigger-manager';\nexport { Trigger } from './trigger';\nexport { Template } from './template';\nexport { Robot } from './robot';\nexport { UserOptions } from './user-options';\nexport { Document } from './document/document';\nexport { ViewMode } from './view-mode';\nexport { ConditionGroup } from './condition/condition-group';\nexport { ConditionGroupSelector } from './selectors/condition-group-selector';\nexport { Condition } from './condition/condition';\nexport { Designer } from './designer';\nexport * from './tracker/tracker';\nexport * from './workflow/types';\nexport { Manager as SelectorManager } from './selectors/manager';\nexport { InlineSelector } from './selectors/inline-selector';\nexport { InlineSelectorCondition } from './selectors/inline-selector-condition';\nexport { InlineSelectorHtml } from './selectors/inline-selector-html';\nexport { SaveStateCheckbox } from './selectors/save-state-checkbox';\nexport { UserSelector } from './selectors/user-selector';\nexport { FileSelector } from './selectors/file-selector';\nexport { TimeSelector } from './selectors/time-selector';\nexport { DelayInterval } from './delay-interval';\nexport { DelayIntervalSelector } from './delay-interval-selector';\nexport { HelpHint } from './help-hint';\nexport { SelectorContext } from './context/selector-context';\nexport { AutomationGlobals } from './automation-globals';\nexport { Statuses } from './statuses';\n\nexport { Helper } from './helper';\n\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\nimport './css/style.css';\n\nexport {\n\tTemplatesScheme,\n\tContext,\n};\n\nexport { BeginningGuide } from './tourguide/beginning-guide';\nexport { AutomationGuide } from './tourguide/automation-guide';\n\nlet contextInstance: ?Context;\n\nexport function getGlobalContext(): Context\n{\n\tif (contextInstance instanceof Context)\n\t{\n\t\treturn contextInstance;\n\t}\n\n\tthrow new Error('Context is not initialized yet');\n}\n\nexport function tryGetGlobalContext(): ?Context\n{\n\ttry\n\t{\n\t\treturn getGlobalContext();\n\t}\n\tcatch (error)\n\t{\n\t\treturn null;\n\t}\n}\n\nexport function setGlobalContext(context: Context): Context\n{\n\tif (context instanceof Context)\n\t{\n\t\tcontextInstance = context;\n\t}\n\telse\n\t{\n\t\tthrow new Error('Unsupported Context');\n\t}\n\n\treturn context;\n}\n"],"names":["TemplateScope","rawTemplateScope","DocumentType","Type","isNil","Category","Id","Status","hasCategory","isNull","TemplatesScheme","scheme","_classPrivateFieldInitSpec","isArray","forEach","rawScope","scope","push","documentTypes","Map","set","getDocumentType","Array","from","values","documentType","documentCategories","category","getDocumentCategory","documentCategory","takenStatuses","Set","predicate","shouldBeTaken","has","getDocumentStatus","add","map","generator","BaseContext","defaultValue","setEventNamespace","isPlainObject","clone","name","value","isValueChanged","emit","hasOwnProperty","listener","subscribe","event","data","EventEmitter","Context","props","Runtime","getValues","document","userOptions","code","availableTriggers","find","trigger","get","availableRobots","canManage","isBoolean","canEdit","tracker","ViewMode","mode","getAll","includes","none","Trigger","draft","ConditionGroup","viewMode","isString","id","parseInt","isNumber","Condition","edit","createNode","node","parentNode","replaceChild","getGlobalContext","String","statusList","status","STATUS_ID","getStatusId","triggerName","getCode","NAME","rules","log","getTriggerLog","getId","condition","flag","userId","isActive","manage","setProperty","checkboxNode","Tag","render","deleteButton","querySelector","Dom","hide","append","addClass","onclick","undefined","unselectNode","removeClass","remove","show","checked","isManage","hasClass","wrapperClass","isEdit","settingsBtn","copyBtn","create","attrs","className","text","Loc","getMessage","Event","bind","onCopyButtonClick","getLogStatus","TrackingStatus","COMPLETED","getPreviousStatusIdList","getName","containerClass","div","children","title","registerItem","deleteBtn","onDeleteButtonClick","appendChild","onSettingsButtonClick","getProperty","isSelected","selectNode","button","HelpHint","showNoPermissionsHint","stopPropagation","initData","serialize","clearRules","getSettingProperties","filter","property","Copyable","key","init","query","getData","queryString","match","toLowerCase","indexOf","object","onbxdragstart","BX","proxy","dragStart","onbxdrag","dragMove","onbxdragstop","dragStop","onbxdraghover","dragOver","jsDD","registerObject","registerDest","unregisterObject","unregisterDest","proxy_context","stopCurrentDrag","itemWidth","offsetWidth","cloneNode","style","position","classList","width","body","x","y","left","top","destination","type","getAttribute","window","isCopy","ctrlKey","metaKey","copyTrigger","parent","statusId","thisColumn","insertBefore","moveTo","skipInsert","removeChild","APPLY_RULES","items","length","triggerData","RETURN","SETTINGS","Properties","Helper","JSON","stringify","i","v","fields","field","Designer","dialog","robotSettingsDialog","robot","triggerSettingsDialog","_classStaticPrivateFieldSpecSet","TriggerManager","triggersContainerNode","params","_classPrivateMethodInitSpec","self","Promise","resolve","reject","ajax","method","dataType","url","ajaxUrl","ajax_action","document_signed","signedDocument","onsuccess","response","SUCCESS","reInit","TRIGGERS","DATA","triggers","onerror","isNone","querySelectorAll","initTriggers","markModified","columnNode","addCustomEvent","onRestAppInstall","clean","subscribeTriggerEvents","insertTriggerNode","openTriggerSettingsDialog","deleteTrigger","Object","entries","eventName","onSearch","listNode","dataset","enableManageMode","documentStatus","disableManageMode","callback","call","markDeleted","splice","unregisterItem","triggerNode","deleted","CODE","availableTrigger","modified","context","getInstance","getTriggerSettingsDialog","changeTrigger","popup","close","formName","getTriggerName","form","renderConditionSettings","Text","encode","getAvailableTrigger","_classPrivateMethodGet","onCustomEvent","canSetExecuteBy","renderExecuteByControl","renderAllowBackwardsControl","setTriggerSettingsDialog","triggerManager","Popup","generateUniqueId","bindElement","content","closeByEsc","buttons","SaveButton","formData","prepareForm","setName","setConditionSettingsFromForm","setAllowBackwards","allow_backwards","setExecuteBy","execute_by","runAction","analyticsLabel","CancelButton","contentPadding","closeIcon","events","onPopupClose","destroySettingsDialogControls","destroy","titleBar","overlay","draggable","restrict","conditionGroup","getCondition","conditionSelector","ConditionGroupSelector","getFields","showValuesSelector","caption","head","isExpanded","getRawType","getCategoryId","getResponsibleUserExpression","getExecuteBy","Bizproc","FieldType","renderControl","isBackwardsAllowed","formFields","setCondition","createFromForm","installed","eventResult","redirect","setTimeout","settingsDialogControls","controlNodes","controlNode","control","role","UserSelector","decorateNode","UI","Hint","isFunction","result","exists","getListByDocumentStatus","getReturnProperties","ObjectId","Name","ObjectName","Expression","SystemExpression","propertyId","properties","getApplyRules","toRenderProperty","AllowSelection","cmp","component","Options","Settings","Filter","check","templateManager","templates","template","robots","OptionNameProperty","setApplyRules","selector","Fields","fieldPrefix","getRandom","hookLinkTextarea","select","Handler","location","protocol","host","Uri","addParam","replace","Password","PasswordLoader","myAlertText","passwordAlert","Alert","color","AlertColor","WARNING","icon","AlertIcon","getTextContainer","loaderConfig","runComponentAction","action","then","error","alert","password","handleCloseBtnClick","getContainer","menuId","Math","random","fieldName","fieldsList","renderFieldCheckbox","fieldSelectorHandler","targetNode","Main","MenuManager","getMenuById","menuItems","item","popupWindow","autoHide","offsetLeft","getPosition","angle","offset","zIndex","fieldListNode","fieldSelectorNode","ChooseFieldLabel","foundField","fld","Document","options","rawDocumentType","documentId","categoryId","findIndex","isStringFilled","documentFields","getCurrentStatusId","index","slice","newStatusId","isArrayFilled","DelayInterval","BASIS_TYPE","CurrentDateTime","DELAY_TYPE","After","setType","setValue","valueType","setValueType","basis","setBasis","workTime","setWorkTime","waitWorkDay","setWaitWorkDay","inTime","setInTime","Before","In","Boolean","basisFields","workerExpression","CurrentDate","isSystemBasis","s","isNow","days","hours","minutes","fn","worker","isFunctionInResult","emptyText","str","inTimeString","prefix","getFormattedPeriodLabel","fieldSuffix","label","labelIndex","labels","getPeriodLabels","CurrentDateTimeLocal","intervalString","toString","trimStart","h","d","substring","setTimeArgs","split","minute","pop","trim","hour","join","fnArgs","re","exec","found","period","element","bindToNode","showHint","hideHint","popupHint","isSameNode","rawText","util","nl2br","PopupWindow","lightShadow","darkMode","offsetTop","bindOptions","html","setAngle","showAngleHint","timeout","clearTimeout","createInstance","popupParameters","height","WorkflowStatus","TrackingEntry","TRIGGER_ACTIVITY_TYPE","entryType","getAllActivityTypes","entryWorkflowStatus","getAllWorkflowStatuses","UNKNOWN_ACTIVITY_TYPE","EXECUTE_ACTIVITY_TYPE","CLOSE_ACTIVITY_TYPE","CANCEL_ACTIVITY_TYPE","FAULT_ACTIVITY_TYPE","CUSTOM_ACTIVITY_TYPE","REPORT_ACTIVITY_TYPE","ATTACHED_ENTITY_TYPE","ERROR_ACTIVITY_TYPE","DEBUG_ACTIVITY_TYPE","DEBUG_AUTOMATION_TYPE","DEBUG_DESIGNER_TYPE","DEBUG_LINK_TYPE","typeId","CREATED","RUNNING","SUSPENDED","TERMINATED","RobotEntry","WAITING","entry","addEntry","datetime","workflowStatus","errors","note","notes","TriggerEntry","isTriggerEntry","TrackingEntryBuilder","workflowId","logEntry","assign","isKnownActivityType","isKnownWorkflowStatus","Tracker","addLogs","logEntryBuilder","rawEntry","setLogEntry","build","addTriggerEntry","addRobotEntry","robotEntry","isRobotRunning","isWorkflowCompleted","isCurrentStatus","isRobotRunningAtAnotherStatus","isRobotRunningAndCurrentWorkflowCompleted","documentSigned","LOG","Robot","isFrameMode","clonedRobot","robotData","generateName","Delay","getDelayInterval","other","Activated","toBoolean","CONDITION_TYPE","Mixed","getProperties","getRobotLog","DelayName","viewData","isInvalid","activated","isActivated","targetLabel","isView","responsibleLabel","labelText","getReturnFieldsDescription","getTitle","globalVariables","variable","globalConstants","constant","textContent","setAttribute","responsibleUrl","href","responsibleId","delayLabel","format","isExecuteAfterPrevious","delayNode","statusNode","subscribeOnce","isBindedToNode","delayNotes","getDelayNotes","AUTOCOMPLETED","getLogErrors","titleClassName","clipTitle","root","titleNode","onTitleEditClick","lastChild","deleteBottomButton","actionsButton","deleteRobot","openRobotSettingsDialog","DialogContext","copiedRobot","robotTitle","newTitle","Template","copyRobotTo","getNextRobot","e","preventDefault","PopupWindowButton","click","nameNode","elements","PopupWindowButtonLink","fullTitle","arrTitle","lastWord","delay","ExecuteAfterPrevious","draggableItem","stub","droppableItem","droppableColumn","templateNode","beforeRobot","insertRobot","insertRobotNode","getDescriptionTitle","description","getRobotDescription","isObject","hasReturnProperties","hasAdditionalResultProperties","some","addProperty","fieldId","appendPropertyMods","printableTag","expression","usages","Constant","Variable","Parameter","GlobalConstant","GlobalVariable","Activity","collectExpressions","conditions","collectParsedExpressions","systemExpressionRegExp","RegExp","SYSTEM_EXPRESSION_PATTERN","groups","parsedUsage","activityRegExp","getBrokenLinks","collectUsages","objectsData","getConstants","getVariables","getParameters","getSerializedRobots","brokenLinks","size","source","searchInSource","brokenLinkObject","getRobotById","getReturnProperty","buttonText","menu","Menu","menuItem","setActivated","UserOptions","storedValue","save","keys","renderAfterPreviousImageBlock","renderParallelImageBlock","renderRow","uid","imageRenderFunction","radio","attr","showExecutionQueuePopup","settings","afterPreviousContent","parallelContent","currentValue","Button","Color","PRIMARY","onSubmitButtonClick","FormData","LINK","padding","clientWidth","backgroundColor","onClose","constants","variables","templateContainerNode","delayMinLimitM","CONSTANTS","PARAMETERS","VARIABLES","DOCUMENT_STATUS","markExternalModified","IS_EXTERNAL_MODIFIED","fromRaw","initRobots","initButtons","isExternalModified","ROBOTS","selectedRobots","activatedRobots","deactivatedRobots","serialized","ID","Number","isNaN","createExternalLocker","createManageModeButton","getTemplateId","createConstantsEditButton","createParametersEditButton","createExternalEditTemplateButton","draggableNode","bizprocEditorUrl","anchor","onExternalEditTemplateButtonClick","manageButton","onManageModeButtonClick","manageButtonNode","constantsEditorUrl","parametersEditorUrl","onUnsetExternalModifiedClick","onExternalModifiedSearch","InfoHelper","templateId","openBizprocEditor","intoRaw","CLASS","Title","DIALOG_CONTEXT","parentRobot","isEqual","robotNode","beforeNode","saveCallback","getRobotSettingsDialog","changeRobot","robotBrokenLinks","renderDelaySettings","renderBrokenLinkAlert","setRobotSettingsDialog","DOCUMENT_CATEGORY_ID","addMenuGroup","document_status","robot_json","toJsonString","form_name","dialogRows","showRobotSettingsPopup","popupMinWidth","popupWidth","initRobotSettingsControls","descriptionTitle","hasTitle","titleBarContent","bindAll","isNewRobot","saveRobotSettings","minWidth","minHeight","resizable","destroyRobotSettingsControls","onPopupResize","onResizeRobotSettings","onPopupResizeEnd","getWidth","robotSettingsControls","initRobotSettingsControl","controlProps","SelectorContext","useSwitcherMenu","rootGroupTitle","needSync","checkbox","SelectorManager","SELECTOR_ROLE_USER","fieldProperty","parse","SELECTOR_ROLE_FILE","createSelectorByRole","SELECTOR_ROLE_SAVE_STATE","renderTo","onFieldSelect","addConstant","addParameter","onOpenMenu","onBeforeSave","delayTypeNode","delayValueNode","delayValueTypeNode","delayBasisNode","delayWorkTimeNode","delayWaitWorkDayNode","delayInTimeNode","delayIntervalLabelNode","docFields","minLimitM","delayIntervalSelector","DelayIntervalSelector","labelNode","onchange","useAfterBasis","showWaitWorkDay","delay_type","delay_value","delay_value_type","delay_basis","delay_worktime","delay_wait_workday","delay_in_time","setDelayInterval","hasTemplate","setExecuteAfterPrevious","execute_after_previous","onOpenFieldMenu","moreInfoNode","showMoreLabel","bindOnce","scrollHeight","closeBtn","btnNode","onBeforeSaveRobotSettings","form_data_json","form_data","updateData","setDelaySettingsFromForm","ERRORS","externalModified","generatePropertyId","getConstant","Description","Default","param","parameter","getParameter","existsList","robotUsages","usage","unsubscribe","automationGlobals","dstTemplate","copyTo","additionalFields","flatMap","ask","tabs","sort","skipRobot","isMixedCondition","robotMenuItems","customData","addGroup","supertitle","SuperTitle","gVariables","skipId","templateRobot","hasReturnFields","executionQueueLink","input","afterPrevious","adjust","group","parentGroup","setObject","setField","operator","setOperator","Operator","EQUAL","NOT_EQUAL","Field","addItem","activityNames","clonedGroup","joiner","clonedCondition","itemsArray","Branch1","Branch2","valueIndex","BETWEEN","JOINER","And","Or","message","ConditionSelector","conditionValueNode","conditionValueNode2","conditionObjectNode","conditionFieldNode","conditionOperatorNode","objectNode","fieldNode","operatorNode","valueNode","setLabelText","bindLabelNode","getOperatorLabel","EMPTY","getField","valueLabel","onLabelClick","showPopup","filterFields","objectSelect","fieldSelectLabel","fieldSelect","onFieldSelectorClick","selectedField","valueInput","valueWrapper","operatorSelect","createOperatorNode","operatorWrapper","onFieldChange","firstChild","valueInputs","updateValueNode","fieldDialog","globalContext","InlineSelectorCondition","fireEvent","openMenu","value2","isDomNode","conditionWrapper","getOperators","Multiple","onOperatorChange","tpl","getTemplate","getGVariable","foundRobot","fieldType","multiple","allLabels","getAllLabels","list","NOT_EMPTY","CONTAIN","NOT_CONTAIN","IN","NOT_IN","GREATER_THEN","GREATER_THEN_OR_EQUAL","LESS_THEN","LESS_THEN_OR_EQUAL","isUndefined","filtered","docField","currentDocument","docType","valueNodes","renderControlPublic","targetInput","parseTargetProperties","operatorList","operatorId","BaseEvent","btn","removeButtonNode","removeCondition","switcherBtnAnd","switcherBtnOr","inputNode","joinerNode","toggleClass","formatValuePrintable","createValueNode","getItems","hasConditions","isCollapsed","collapseButtonTitle","collapsed","conditionContent","btnToggleList","btnTextNode","addButton","toggleText","Draggable","container","CLONE","dragElement","InlineSelector","groupId","hasGroup","menuButton","replaceOnWrite","renderWith","propertyType","skipPropertiesSwitcher","openPropertiesSwitcherMenu","fillGroups","onMenuOpen","Dialog","dropdownMode","enableSearch","injectDialogMenuTitles","showAvatars","getCustomData","compactView","fillFieldsGroups","fillFileGroup","searchable","groupKey","groupName","names","shift","addGroupItem","fileFields","disabled","currentItem","injectDialogMenuSupertitles","child","inputType","tagName","expressionOption","selected","hiddenInput","getElementById","selectionEnd","beforePart","middlePart","afterPart","substr","printablePrefix","custom","printableName","printableField","serverField","responsibleField","childGroup","entityId","toExpression","fromString","keyCode","altKey","shiftKey","exp","InlineTimeSelector","getFormat","formatId","Date","convertBitrixFormat","dateFormat","dateTimeFormat","getMenuWindow","date","setHours","DateTimeFormat","getTime","hasParentNode","chevron","maxHeight","Manager","selectorProps","FileSelector","SELECTOR_ROLE_INLINE","SELECTOR_ROLE_INLINE_HTML","InlineSelectorHtml","SELECTOR_ROLE_INLINE_TIME","SELECTOR_ROLE_TIME","TimeSelector","SaveStateCheckbox","target","bindTargetEvents","firstElementChild","insertText","editor","InsertHtml","synchro","IsFocusedOnTextarea","textareaView","Focus","WrapWith","Sync","SaveContent","ResizeSceleton","handler","removeCustomEvent","dom","cont","header","footer","cutHeader","shouldSaveHeader","cutFooter","shouldSaveFooter","editorId","BXHtmlEditor","Get","savedState","additionalUserFields","userSelector","TYPE","None","config","File","required","valueInputName","typeInputName","useDisk","labelFile","labelDisk","fileItem","setValues","ids","Disk","childNodes","idSalt","fileRadio","fileTypeOptions","diskFileRadio","diskUploader","layout","addItems","addButtonNode","Automation","DiskUploader","msg","setMode","newType","SIZE","VIEW_URL","itemNode","itemField","closeWnd","setTime","constructor","showClock","CClockSelector","start_time","Show","time","timeParts","part","timeFormat","prepareBasisFields","showDelayIntervalPopup","createAfterControlNode","createBeforeControlNode","createInControlNode","workTimeCheckBox","saveFormData","fieldsMenu","valueTypeMenu","timeName","valueAfter","hiddenRow","createValueTypeSelector","labelAfter","radioAfter","valueBefore","labelBefore","radioBefore","labelIn","radioIn","labelTexts","onValueTypeSelectorClick","valueId","delayType","onMenuItemClick","delimiter","system","hintText","radioNow","setNow","Notification","Center","notify","test","toInteger","padStart","delayIntervalType","hint","initNode","basisField","getBasisField","basisValue","beforeBasisNodeText","beforeBasisValueNode","beforeBasisNode","onBasisClick","inBasisValueNode","inBasisNode","formattedValue","isAvailable","workDayCheckbox","AutomationGlobals","parameters","Globals","Instance","updatedGlobals","globals","newGlobals","prop","VisibilityName","concat","deletedGlobals","BaseType","Visibility","visibilityName","Statuses","stagesContainerNode","stagesContainer","backgroundNode","bgcolor","borderColor","bigint","red","green","blue","isDarkColor","BeginningGuide","isElementNode","article","Guide","steps","bottom","onEvents","getPopup","setAutoHide","showNextStep","AutomationGuide","isShownRobotGuide","isShownTriggerGuide","guide","getCurrentStep","contains","subtitles","subtitle","contextInstance","Error","tryGetGlobalContext","setGlobalContext"],"mappings":"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"}