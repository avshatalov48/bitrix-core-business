{"version":3,"file":"faces.bundle.js","sources":["../src/helpers/validators.js","../src/faces.js"],"sourcesContent":["import { Text, Type } from 'main.core';\nimport type { FacesData, WorkflowFacesData } from '../types/workflow-faces';\n\nexport function workflowFacesDataValidator(data: WorkflowFacesData): boolean\n{\n\tif (!Type.isPlainObject(data))\n\t{\n\t\treturn false;\n\t}\n\n\tif (!Type.isStringFilled(data.workflowId))\n\t{\n\t\treturn false;\n\t}\n\n\tif (!Type.isDomNode(data.target))\n\t{\n\t\treturn false;\n\t}\n\n\tif (!Type.isInteger(data.targetUserId) || data.targetUserId <= 0)\n\t{\n\t\treturn false;\n\t}\n\n\treturn validateFacesData(data.data);\n}\n\nexport function validateFacesData(data: FacesData): boolean\n{\n\tif (!Type.isPlainObject(data))\n\t{\n\t\treturn false;\n\t}\n\n\t// avatars\n\tconst avatars = data.avatars;\n\tif (\n\t\t!Type.isPlainObject(avatars)\n\t\t|| !Type.isArrayFilled(avatars.author)\n\t\t|| !Type.isArray(avatars.running)\n\t\t|| !Type.isArray(avatars.completed)\n\t\t|| !Type.isArray(avatars.done)\n\t)\n\t{\n\t\treturn false;\n\t}\n\n\t// statuses\n\tconst statuses = data.statuses;\n\tif (!Type.isPlainObject(statuses))\n\t{\n\t\treturn false;\n\t}\n\n\t// time\n\tconst time = data.time;\n\tif (\n\t\t!Type.isPlainObject(time)\n\t\t|| !timeValidator(time.author)\n\t\t|| !timeValidator(time.running)\n\t\t|| !timeValidator(time.completed)\n\t\t|| !timeValidator(time.done)\n\t\t|| !timeValidator(time.total)\n\t)\n\t{\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nconst timeValidator = (time) => {\n\treturn (Type.isNull(time) || time === 0 || Text.toInteger(time) > 0);\n};\n","import { Type, Loc, Text, Dom, Tag, ajax } from 'main.core';\nimport { Summary } from 'bizproc.workflow.faces.summary';\nimport { ImageStackSteps, headerTypeEnum, footerTypeEnum, imageTypeEnum, stackStatusEnum } from 'ui.image-stack-steps';\nimport type { StepType, FooterType } from 'ui.image-stack-steps';\n\nimport type { FacesData, WorkflowFacesData, Avatar } from './types/workflow-faces';\nexport type { FacesData, WorkflowFacesData, Avatar };\nimport { workflowFacesDataValidator, validateFacesData } from './helpers/validators';\n\nimport 'ui.design-tokens';\nimport 'ui.icons';\nimport 'ui.icon-set.main';\n\nimport './css/style.css';\n\nexport class WorkflowFaces\n{\n\t#target: HTMLElement;\n\t#data: FacesData = {};\n\t#showArrow: boolean = false;\n\t#showTimeline: boolean = false;\n\t#workflowId: string;\n\t#targetUserId: number;\n\n\t#stack: ImageStackSteps;\n\t#unsubscribePushCallback = null;\n\t#node: null;\n\t#timelineNode: null;\n\t#errorNode: null;\n\n\tconstructor(data: WorkflowFacesData)\n\t{\n\t\tif (!workflowFacesDataValidator(data))\n\t\t{\n\t\t\tthrow new TypeError('Bizproc.Workflow.Faces: data must be correct plain object', data);\n\t\t}\n\n\t\tthis.#workflowId = data.workflowId;\n\t\tthis.#target = data.target;\n\t\tthis.#targetUserId = data.targetUserId;\n\t\tthis.#data = data.data;\n\n\t\tif (Type.isBoolean(data.showArrow))\n\t\t{\n\t\t\tthis.#showArrow = data.showArrow;\n\t\t}\n\n\t\tif (Type.isBoolean(data.showTimeline))\n\t\t{\n\t\t\tthis.#showTimeline = data.showTimeline;\n\t\t}\n\n\t\tthis.#initStack();\n\t\tif (data.subscribeToPushes)\n\t\t{\n\t\t\tthis.#subscribeToPushes();\n\t\t}\n\t}\n\n\t#initStack()\n\t{\n\t\tthis.#stack = new ImageStackSteps({ steps: this.#getStackSteps() });\n\t}\n\n\t#getStackSteps(): []\n\t{\n\t\tconst steps = [this.#getAuthorStep()];\n\n\t\tif (Type.isArrayFilled(this.#data.avatars.completed))\n\t\t{\n\t\t\tsteps.push(this.#getCompletedStep());\n\t\t}\n\n\t\tif (this.#data.workflowIsCompleted)\n\t\t{\n\t\t\tsteps.push(this.#getDoneStep());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsteps.push(this.#getRunningStep());\n\t\t}\n\n\t\tif (steps.length === 2)\n\t\t{\n\t\t\tsteps.push(this.#getStubStep());\n\t\t}\n\n\t\treturn steps.map((step, index) => ({ ...step, id: `step-${index}` }));\n\t}\n\n\t#getAuthorStep(): StepType\n\t{\n\t\tconst stack = {\n\t\t\timages: [{\n\t\t\t\ttype: imageTypeEnum.ICON,\n\t\t\t\tdata: { icon: 'bp', color: 'var(--ui-color-palette-gray-20)' },\n\t\t\t}],\n\t\t};\n\n\t\tconst avatar = this.#data.avatars.author[0];\n\t\tconst authorId = Text.toInteger(avatar.id);\n\t\tif (authorId > 0)\n\t\t{\n\t\t\tstack.images = [{\n\t\t\t\ttype: imageTypeEnum.USER,\n\t\t\t\tdata: { src: String(avatar.avatarUrl || ''), userId: authorId },\n\t\t\t}];\n\t\t}\n\n\t\tconst step = {\n\t\t\tid: 'author',\n\t\t\theader: {\n\t\t\t\ttype: headerTypeEnum.TEXT,\n\t\t\t\tdata: { text: Loc.getMessage('BIZPROC_JS_WORKFLOW_FACES_COLUMN_AUTHOR') },\n\t\t\t},\n\t\t\tstack,\n\t\t\tfooter: this.#getFooterDuration(this.#data.time.author),\n\t\t};\n\n\t\tconst hiddenTaskCount = this.#getHiddenTaskCount();\n\t\tif (hiddenTaskCount > 0)\n\t\t{\n\t\t\tstep.progressBox = {\n\t\t\t\ttitle: Loc.getMessage('BIZPROC_JS_WORKFLOW_COMPLETED_TASK_COUNT', { '#COUNT#': hiddenTaskCount }),\n\t\t\t};\n\t\t}\n\n\t\treturn step;\n\t}\n\n\t#getHiddenTaskCount(): number\n\t{\n\t\tconst completedTaskCount = Text.toInteger(this.#data.completedTaskCount);\n\n\t\tif (this.#data.workflowIsCompleted)\n\t\t{\n\t\t\treturn completedTaskCount > 2 ? completedTaskCount - 2 : 0;\n\t\t}\n\n\t\treturn completedTaskCount > 1 ? completedTaskCount - 1 : 0;\n\t}\n\n\t#getRunningStep(): StepType\n\t{\n\t\tconst stack = {\n\t\t\timages: [{\n\t\t\t\ttype: imageTypeEnum.ICON,\n\t\t\t\tdata: {\n\t\t\t\t\ticon: 'black-clock',\n\t\t\t\t\tcolor: 'var(--ui-color-palette-blue-60)',\n\t\t\t\t},\n\t\t\t}],\n\t\t};\n\n\t\tconst images = this.#getStackUserImages(this.#data.avatars.running);\n\t\tif (Type.isArrayFilled(images))\n\t\t{\n\t\t\tstack.images = images;\n\t\t\tstack.status = { type: stackStatusEnum.WAIT };\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'running',\n\t\t\theader: {\n\t\t\t\ttype: headerTypeEnum.TEXT,\n\t\t\t\tdata: { text: Loc.getMessage('BIZPROC_JS_WORKFLOW_FACES_COLUMN_RUNNING') },\n\t\t\t},\n\t\t\tstack,\n\t\t\tfooter: {\n\t\t\t\ttype: footerTypeEnum.DURATION,\n\t\t\t\tdata: {\n\t\t\t\t\tduration: this.#data.time.running,\n\t\t\t\t\trealtime: true,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\t#getCompletedStep(): StepType\n\t{\n\t\tconst isSuccess = Text.toBoolean(this.#data.statuses.completedSuccess);\n\n\t\tconst stack = {\n\t\t\timages: [{\n\t\t\t\ttype: imageTypeEnum.ICON,\n\t\t\t\tdata: {\n\t\t\t\t\ticon: isSuccess ? 'circle-check' : 'cross-circle-60',\n\t\t\t\t\tcolor: isSuccess ? 'var(--ui-color-primary-alt)' : 'var(--ui-color-base-35)',\n\t\t\t\t},\n\t\t\t}],\n\t\t};\n\n\t\tconst images = this.#getStackUserImages(this.#data.avatars.completed);\n\t\tif (Type.isArrayFilled(images))\n\t\t{\n\t\t\tstack.images = images;\n\t\t\tstack.status = { type: isSuccess ? stackStatusEnum.OK : stackStatusEnum.CANCEL };\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'completed',\n\t\t\theader: {\n\t\t\t\ttype: headerTypeEnum.TEXT,\n\t\t\t\tdata: { text: Loc.getMessage('BIZPROC_JS_WORKFLOW_FACES_COLUMN_COMPLETED') },\n\t\t\t},\n\t\t\tstack,\n\t\t\tfooter: this.#getFooterDuration(this.#data.time.completed),\n\t\t};\n\t}\n\n\t#getDoneStep(): StepType\n\t{\n\t\tconst stack = {\n\t\t\timages: [{\n\t\t\t\ttype: imageTypeEnum.ICON,\n\t\t\t\tdata: { icon: 'circle-check', color: 'var(--ui-color-primary-alt)' },\n\t\t\t}],\n\t\t};\n\n\t\tconst images = this.#getStackUserImages(this.#data.avatars.done);\n\t\tif (Type.isArrayFilled(images))\n\t\t{\n\t\t\tconst isSuccess = Text.toBoolean(this.#data.statuses.doneSuccess);\n\n\t\t\tstack.images = images;\n\t\t\tstack.status = { type: isSuccess ? stackStatusEnum.OK : stackStatusEnum.CANCEL };\n\t\t}\n\n\t\treturn {\n\t\t\tid: 'done',\n\t\t\theader: {\n\t\t\t\ttype: headerTypeEnum.TEXT,\n\t\t\t\tdata: { text: Loc.getMessage('BIZPROC_JS_WORKFLOW_FACES_COLUMN_DONE') },\n\t\t\t},\n\t\t\tstack,\n\t\t\tfooter: this.#getFooterDuration(this.#data.time.done),\n\t\t};\n\t}\n\n\t#getStubStep(): StepType\n\t{\n\t\treturn {\n\t\t\tid: 'stub',\n\t\t\theader: { type: headerTypeEnum.STUB },\n\t\t\tstack: { images: [{ type: imageTypeEnum.USER_STUB }] },\n\t\t\tfooter: { type: footerTypeEnum.STUB },\n\t\t};\n\t}\n\n\t#getStackUserImages(avatars): []\n\t{\n\t\tconst images = [];\n\t\tif (Type.isArrayFilled(avatars))\n\t\t{\n\t\t\tavatars.forEach((avatar) => {\n\t\t\t\tconst userId = Text.toInteger(avatar.id);\n\t\t\t\tif (userId > 0)\n\t\t\t\t{\n\t\t\t\t\timages.push({\n\t\t\t\t\t\ttype: imageTypeEnum.USER,\n\t\t\t\t\t\tdata: { userId, src: String(avatar.avatarUrl || '') },\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn images;\n\t}\n\n\t#getFooterDuration(time): FooterType\n\t{\n\t\tif (Type.isNumber(time) && time > 0)\n\t\t{\n\t\t\treturn {\n\t\t\t\ttype: footerTypeEnum.DURATION,\n\t\t\t\tdata: { duration: time, realtime: false },\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\ttype: footerTypeEnum.TEXT,\n\t\t\tdata: { text: Loc.getMessage('BIZPROC_JS_WORKFLOW_FACES_EMPTY_TIME') },\n\t\t};\n\t}\n\n\t#subscribeToPushes()\n\t{\n\t\tif (!this.#data.workflowIsCompleted && BX.PULL)\n\t\t{\n\t\t\tthis.#unsubscribePushCallback = BX.PULL.subscribe({\n\t\t\t\tmoduleId: 'bizproc',\n\t\t\t\tcommand: 'workflow',\n\t\t\t\tcallback: this.#onWorkflowPush.bind(this),\n\t\t\t});\n\t\t}\n\t}\n\n\t#onWorkflowPush(params)\n\t{\n\t\tif (params && params.eventName === 'UPDATED' && Type.isArrayFilled(params.items))\n\t\t{\n\t\t\tfor (const item of params.items)\n\t\t\t{\n\t\t\t\tif (String(item.id) === this.#workflowId)\n\t\t\t\t{\n\t\t\t\t\tthis.#loadWorkflowFaces();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#loadWorkflowFaces()\n\t{\n\t\tif (this.#target && Type.isDomNode(this.#target) && this.#target.clientHeight > 0)\n\t\t{\n\t\t\tajax.runAction('bizproc.workflow.faces.load', {\n\t\t\t\tdata: {\n\t\t\t\t\tworkflowId: this.#workflowId,\n\t\t\t\t\trunningTaskId: this.#data.runningTaskId || 0,\n\t\t\t\t\tuserId: this.#targetUserId,\n\t\t\t\t},\n\t\t\t}).then(({ data }) => {\n\t\t\t\tif (Type.isDomNode(this.#errorNode))\n\t\t\t\t{\n\t\t\t\t\tDom.replace(this.#errorNode, this.#node);\n\t\t\t\t\tthis.#errorNode = null;\n\t\t\t\t}\n\n\t\t\t\tthis.updateData(data);\n\t\t\t}).catch(({ errors }) => {\n\t\t\t\tif (Type.isArrayFilled(errors))\n\t\t\t\t{\n\t\t\t\t\tconst firstError = errors.pop();\n\t\t\t\t\tif (firstError.code === 'ACCESS_DENIED')\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.replace(\n\t\t\t\t\t\t\tthis.#node,\n\t\t\t\t\t\t\tthis.#renderError(firstError.message),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tthis.errorMessage = firstError.message;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t#unsubscribeToPushes()\n\t{\n\t\tif (Type.isFunction(this.#unsubscribePushCallback))\n\t\t{\n\t\t\tthis.#unsubscribePushCallback();\n\t\t\tthis.#unsubscribePushCallback = null;\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tif (this.#node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#node = Tag.render`<div class=\"bp-workflow-faces\"></div>`;\n\t\tDom.append(this.#node, this.#target);\n\t\tthis.#stack.renderTo(this.#node);\n\n\t\tif (this.#showArrow)\n\t\t{\n\t\t\tDom.append(Tag.render`<div class=\"bp-workflow-faces-arrow\"></div>`, this.#node);\n\t\t}\n\n\t\tif (this.#showTimeline)\n\t\t{\n\t\t\tDom.append(this.#renderTimeline(), this.#node);\n\t\t}\n\t}\n\n\tupdateData(data: FacesData)\n\t{\n\t\tif (!validateFacesData(data))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#data = data;\n\n\t\tthis.#getStackSteps().forEach((step) => {\n\t\t\tthis.#stack.updateStep(step, step.id);\n\t\t});\n\n\t\tif (this.#data.workflowIsCompleted)\n\t\t{\n\t\t\tthis.#unsubscribeToPushes();\n\t\t\tif (this.#showTimeline)\n\t\t\t{\n\t\t\t\tDom.replace(this.#timelineNode, this.#renderTimeline());\n\t\t\t}\n\t\t}\n\t}\n\n\t#renderTimeline(): HTMLElement\n\t{\n\t\tconst timeline = new Summary({\n\t\t\tworkflowId: this.#workflowId,\n\t\t\ttime: this.#data.time.total,\n\t\t\tworkflowIsCompleted: this.#data.workflowIsCompleted,\n\t\t\tshowArrow: false,\n\t\t});\n\t\tthis.#timelineNode = timeline.render();\n\n\t\treturn this.#timelineNode;\n\t}\n\n\t#renderError(message: string): HTMLElement\n\t{\n\t\tthis.#errorNode = Tag.render`\n\t\t\t<div class=\"bp-workflow-faces\">\n\t\t\t\t<span class=\"bp-workflow-faces-error-message\">\n\t\t\t\t\t${Text.encode(message)}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#errorNode;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#unsubscribeToPushes();\n\n\t\tthis.#stack.destroy();\n\t\tthis.#stack = null;\n\n\t\tthis.#target = null;\n\t\tthis.#data = null;\n\t\tthis.#workflowId = null;\n\n\t\tDom.clean(this.#timelineNode);\n\t\tthis.#timelineNode = null;\n\t}\n}\n"],"names":["workflowFacesDataValidator","data","Type","isPlainObject","isStringFilled","workflowId","isDomNode","target","isInteger","targetUserId","validateFacesData","avatars","isArrayFilled","author","isArray","running","completed","done","statuses","time","timeValidator","total","isNull","Text","toInteger","WorkflowFaces","constructor","TypeError","isBoolean","showArrow","showTimeline","subscribeToPushes","render","Tag","Dom","append","renderTo","updateData","forEach","step","updateStep","id","workflowIsCompleted","replace","destroy","clean","ImageStackSteps","steps","push","length","map","index","stack","images","type","imageTypeEnum","ICON","icon","color","avatar","authorId","USER","src","String","avatarUrl","userId","header","headerTypeEnum","TEXT","text","Loc","getMessage","footer","hiddenTaskCount","progressBox","title","completedTaskCount","status","stackStatusEnum","WAIT","footerTypeEnum","DURATION","duration","realtime","isSuccess","toBoolean","completedSuccess","OK","CANCEL","doneSuccess","STUB","USER_STUB","isNumber","BX","PULL","subscribe","moduleId","command","callback","bind","params","eventName","items","item","clientHeight","ajax","runAction","runningTaskId","then","catch","errors","firstError","pop","code","message","errorMessage","isFunction","timeline","Summary","encode"],"mappings":"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"}