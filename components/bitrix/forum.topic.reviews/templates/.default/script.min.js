(function(e){BX.namespace("BX.Forum");var t=function(e){this.id="FTRList"+e.form.id;this.mess={};this.form=e.form;if(!!e["id"]){for(var t=0;t<e["id"].length;t++){this.bind(e["id"][t])}}this.params={preorder:e.preorder=="Y",pageNumber:e.pageNumber,pageCount:e.pageCount};BX.addCustomEvent(this.form,"onAdd",BX.delegate(this.add,this));BX.addCustomEvent(this.form,"onRequest",BX.delegate(function(){if(typeof this.params.pageNumber!="undefined"){var e=this.form.elements["pageNumber"];if(!e){e=BX.create("input",{props:{type:"hidden",name:"pageNumber"}});this.form.appendChild(e)}e.value=this.params.pageNumber}if(typeof this.params.pageCount!="undefined"){var t=BX.findChild(this.form,{attr:{name:"pageCount"}});if(!t){t=BX.create("input",{props:{type:"hidden",name:"pageCount"}});this.form.appendChild(t)}t.value=this.params.pageCount}},this));BX.addCustomEvent(this.form,"onResponse",BX.delegate(function(){var e=BX.findChild(this.form,{attr:{name:"pageNumber"}},true);if(e){BX.remove(e)}},this))};t.prototype={add:function(t,i){var s=BX(this.form.id+"container"),r,a={className:/reviews-reply-form|reviews-collapse/},o=e.fTextToNode(i.message);if(!s){s=BX.create("div",{attrs:{id:this.form.id+"container"},props:{className:"reviews-block-container reviews-reviews-block-container"},children:[BX.create("div",{props:{className:"reviews-block-outer"},children:[BX.create("div",{props:{className:"reviews-block-inner"}})]})]});e.fReplaceOrInsertNode(s,null,BX.findChild(document,a,true).parentNode,a);s=BX(this.form.id+"container")}r=s?BX.findChild(s,{className:"reviews-block-inner"},true):null;if(o&&r){if(!!i["allMessages"]){e.fReplaceOrInsertNode(o,r,BX.findChild(document,a,true).parentNode,a);if(!!i.navigation&&!!i.pageNumber){var n=e.fTextToNode(i.navigation),l,d=n?BX.findChildren(s.parentNode,{className:"reviews-navigation-box"},true):null;if(n){if(!d){s.parentNode.insertBefore(BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-top"}}),s);var f=s;do{f=f.nextSibling}while(f&&f.nodeType!=1);var h=BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-bottom"}});if(f)s.parentNode.insertBefore(h,f);else s.parentNode.appendChild(h);d=BX.findChildren(s.parentNode,{className:"reviews-navigation-box"},true)}for(l=0;l<d.length;l++)d[l].innerHTML=n.innerHTML}this.params.pageNumber=i.pageNumber;this.params.pageCount=i.pageCount}if(i["messagesID"]&&typeof i["messagesID"]=="object"){for(var u=0;u<i["messagesID"].length;u++){if(i["messagesID"][u]!=t)this.bind(i["messagesID"][u])}}}else if(typeof i.message!="undefined"){if(this.params.preorder)r.appendChild(o);else r.insertBefore(o,r.firstChild)}e.fRunScripts(i.message);this.bind(t)}},bind:function(e){var t=BX("message"+e);if(!!t){this.mess["m"+e]={node:t,author:{id:t.getAttribute("bx-author-id"),name:t.getAttribute("bx-author-name")}};var i=BX.findChildren(t,{tagName:"A",className:"reviews-button-small"},true),s=BX.delegate(function(){var t=BX.proxy_context;this.act(t.getAttribute("bx-act"),e)},this),r=BX.delegate(function(){this.act("reply",e)},this),a=BX.delegate(function(){this.act("quote",e)},this);if(!!i&&i.length>0){for(var o=0;o<i.length;o++){if(i[o].getAttribute("bx-act")=="moderate"||i[o].getAttribute("bx-act")=="del"){BX.adjust(i[o],{events:{click:s},attrs:{"bx-href":i[o].getAttribute("href"),href:"javascript:void(0);"}})}else if(!!this.form){if(i[o].getAttribute("bx-act")=="reply"){BX.bind(i[o],"click",r)}else if(i[o].getAttribute("bx-act")=="quote"){BX.bind(i[o],"mousedown",a)}}}}}},act:function(t,i){if(!i||!this.mess["m"+i]){BX.DoNothing()}else if(t=="quote"){var s=e.GetSelection();if(document["getSelection"]){s=s.replace(/\r\n\r\n/gi,"_newstringhere_").replace(/\r\n/gi," ");s=s.replace(/  /gi,"").replace(/_newstringhere_/gi,"\r\n\r\n")}if(s===""&&i>0&&BX("message_text_"+i,true)){var r=BX("message_text_"+i,true);if(typeof r=="object"&&r)s=r.innerHTML}s=s.replace(/[\n|\r]*<br(\s)*(\/)*>/gi,"\n");var a=function(e,t){var i=" ";var s=/showWMVPlayer.*?bx_wmv_player.*?file:[\s'"]*([^"']*).*?width:[\s'"]*([^"']*).*?height:[\s'"]*([^'"]*).*?/gi;var r=s.exec(t);if(r)i="[VIDEO WIDTH="+r[2]+" HEIGHT="+r[3]+"]"+r[1]+"[/VIDEO]";if(i==" "){var a=/bxPlayerOnload[\s\S]*?[\s'"]*file[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*height[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*width[\s'"]*:[\s'"]*([^"']*)/gi;r=a.exec(t);if(r)i="[VIDEO WIDTH="+r[3]+" HEIGHT="+r[2]+"]"+r[1]+"[/VIDEO]"}return i};s=s.replace(/<script[^>]*>/gi,"").replace(/<\/script[^>]*>/gi,"");s=s.replace(/\001([^\002]*)\002/gi,a);s=s.replace(/<noscript[^>]*>/gi,"").replace(/<\/noscript[^>]*>/gi,"");s=s.replace(/\003([^\004]*)\004/gi," ");s=s.replace(/<table class\=[\"]*forum-quote[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"");s=s.replace(/<table class\=[\"]*forum-code[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"");s=s.replace(/<table class\=[\"]*data-table[\"]*>[^<]*<tbody>/gi,"");s=s.replace(/<\/td>[^<]*<\/tr>(<\/tbody>)*<\/table>/gi,"");s=s.replace(/[\r|\n]{2,}([\001|\002])/gi,"\n$1");var o=0;while(o++<50&&(s.search(/\002([^\002\003]*)\003/gi)>=0||s.search(/\001([^\001\003]*)\003/gi)>=0)){s=s.replace(/\002([^\002\003]*)\003/gi,"[CODE]$1[/CODE]").replace(/\001([^\001\003]*)\003/gi,"[QUOTE]$1[/QUOTE]")}var n=function(e,t,i){var s=new RegExp("([^]*)("+t+")([^]*)","i");var r=new RegExp("((?:)(?:[^]*))("+t+")((?:[^]*)(?:))","i");var a=0;while(a++<300&&e.search(s)>=0)e=e.replace(r,"$1"+i+"$3");return e};o=0;while(o++<10&&s.search(/\004([^\004\003]*)\003/gi)>=0){s=n(s,"<tr>","[TR]");s=n(s,"</tr>","[/TR]");s=n(s,"<td>","[TD]");s=n(s,"</td>","[/TD]");s=s.replace(/\004([^\004\003]*)\003/gi,"[TABLE]$1[/TD][/TR][/TABLE]")}if(BX.browser.IsIE())s=s.replace(/<img(?:(?:\s+alt\s*=\s*\"?smile([^\"\s]+)\"?)|(?:\s+\w+\s*=\s*[^\s>]*))*>/gi,"$1");else s=s.replace(/<img.*?alt=[\"]*smile([^\"\s]+)[\"]*[^>]*>/gi,"$1");s=s.replace(/<a[^>]+href=[\"]([^\"]+)\"[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]");s=s.replace(/<a[^>]+href=[\']([^\']+)\'[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]");s=s.replace(/<[^>]+>/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"');s=s.replace(/(smile(?=[:;8]))/g,"");s=s.replace(/\&shy;/gi,"");s=s.replace(/\&nbsp;/gi," ");BX.onCustomEvent(this.form,"onQuote",[{author:this.mess["m"+i]["author"],id:i,text:s}])}else if(t=="reply"){BX.onCustomEvent(this.form,"onReply",[{author:this.mess["m"+i]["author"],id:i}])}else if(t=="del"&&!confirm(BX.message("f_cdm"))){BX.DoNothing()}else if(t=="moderate"||t=="del"){var l=BX.proxy_context,d=l.getAttribute("bx-href").replace(/.AJAX_CALL=Y/g,"").replace(/.sessid=[^&]*/g,""),f=BX.findParent(l,{tag:"table"}),h=BX.create("a",{attrs:{className:"reply-action-note"}}),u=function(){BX.remove(h);BX.show(l.parentNode)};BX.hide(l.parentNode);h.innerHTML=BX.message("f_wait");l.parentNode.parentNode.appendChild(h);BX.ajax.loadJSON(d,{AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},BX.delegate(function(i){if(i.status&&!!f){BX.onCustomEvent(e,"onForumCommentAJAXAction",[t]);if(t=="del"){var s=e["curpage"]||top.window.location.href;BX.fx.hide(f,"scroll",{time:.15,callback_complete:BX.delegate(function(){BX.remove(f);u();var e=BX.findChild(BX(this.form.id+"container"),{"class":"reviews-post-table"},true,true);if(!e||e.length<1)if(this.params.pageNumber>1)BX.reload(s)},this)})}else{var r=BX.hasClass(f,"reviews-post-hidden");var a=r?BX.message("f_hide"):BX.message("f_show");var o=BX.findChild(f,{className:"reviews-text"},true);BX.fx.hide(o,"fade",{time:.1,callback_complete:function(){BX.toggleClass(f,"reviews-post-hidden");l.innerHTML=a;d=d.replace(new RegExp("REVIEW_ACTION="+(r?"SHOW":"HIDE")),"REVIEW_ACTION="+(r?"HIDE":"SHOW"));l.setAttribute("bx-href",d);BX.fx.show(o,"fade",{time:.1});u();BX.style(o,"background-color",r?"#FFFFFF":"#E5F8E3")}})}}else{BX.addClass(h,"error");h.innerHTML='<span class="errortext">'+i.message+"</span>"}},this))}return false}};var i=function(){var t=function(e,t){this.id="FTRForm"+e.form.id;this.form=e.form;this.editor=t;this.windowEvents={};this.params={messageMax:64e3};this.onsuccess=BX.delegate(this.onsuccess,this);this.onfailure=BX.delegate(this.onfailure,this);this.submit=BX.delegate(this.submit,this);BX.bind(this.form,"submit",this.submit);this.isAjax=e["ajaxPost"]=="Y";if(e["captcha"]=="Y"){var i=new Captcha(this.form);BX.addCustomEvent(t,"OnContentChanged",BX.proxy(i.Show,i));BX.ready(function(){BX.bind(BX("forum-refresh-captcha"),"click",BX.proxy(i.Update,i))});if(e["bVarsFromForm"]=="Y")i.Show()}BX.addCustomEvent(this.form,"onQuote",BX.delegate(function(e){this.show();this.quote(e)},this));BX.addCustomEvent(this.form,"onReply",BX.delegate(function(e){this.show();this.paste(e)},this));BX.addCustomEvent(this.form,"onTransverse",BX.delegate(this.transverse,this))};t.prototype={submit:function(e){if(this.validate()){this.prepareForm();this.disableButtons(true);if(!this.isAjax)return true;this.send()}return BX.PreventDefault(e)},prepareForm:function(){},disableButtons:function(e){var t=this.form.getElementsByTagName("input");for(var i=0;i<t.length;i++){if(t[i].getAttribute("type")=="submit")t[i].disabled=e!==false}},validate:function(){this.editor.SaveContent();var e="",t=this.editor.GetContent(),i=t.length,s=64e3;if(this.form.TITLE&&this.form.TITLE.value.length<=0)e+=BX.message("no_topic_name");if(i<=0)e+=BX.message("no_message");else if(i>s)e+=BX.message("max_len").replace(/#MAX_LENGTH#/gi,s).replace(/#LENGTH#/gi,i);if(e!==""){alert(e);return false}return true},busy:false,send:function(){if(this.busy===true)return false;this.busy=true;if(!this.form.elements["dataType"])this.form.appendChild(BX.create("input",{props:{type:"hidden",name:"dataType",value:"json"}}));BX.onCustomEvent(this.form,"onRequest",[this.form,this]);BX.ajax.submitAjax(this.form,{method:"POST",url:this.form.action,dataType:"json",onsuccess:this.onsuccess,onfailure:this.onfailure});return true},onsuccess:function(e){this.busy=false;this.disableButtons(false);BX.onCustomEvent(this.form,"onResponse",[this.form,this]);this.get(e)},onfailure:function(){BX.onCustomEvent(this.form,"onResponse",[this.form,this]);BX.reload()},get:function(t){e["curpage"]=e["curpage"]||top.window.location.href;BX.onCustomEvent(e,"onForumCommentAJAXPost",[t,this.form]);if(typeof t=="undefined"||t.reload){BX.reload(e["curpage"]);return}if(t["status"]){if(!!t["allMessages"]||typeof t["message"]!="undefined"){BX.onCustomEvent(this.form,"onAdd",[t["messageID"],t]);this.clear()}else if(!!t["previewMessage"]){var i=BX.findChild(document,{className:"reviews-preview"},true),s=BX.findChild(document,{className:/reviews-reply-form|reviews-collapse/},true).parentNode,r=e.fTextToNode(t["previewMessage"]);e.fReplaceOrInsertNode(r,i,s,{className:/reviews-reply-form|reviews-collapse/});e.PostFormAjaxStatus("");e.fRunScripts(t["previewMessage"])}var a=!!t["messageID"]?BX("message"+t["messageID"]):null;if(a){BX.scrollToNode(a)}}if(t["statusMessage"])e.PostFormAjaxStatus(t["statusMessage"])},clear:function(){this.editor.CheckAndReInit("");if(this.editor.fAutosave)BX.bind(this.editor.pEditorDocument,"keydown",BX.proxy(this.editor.fAutosave.Init,this.editor.fAutosave));var e=BX.findChild(document,{className:"reviews-preview"},true);if(e)BX.remove(e);var t=0,i,s,r;while((i=BX("upload_files_"+t++ +"_"+this.form.index.value))&&i){if((s=BX.findChild(i,{tagName:"input"},true))&&BX(s)){r=BX.clone(s);r.value="";s.parentNode.insertBefore(r,s);s.parentNode.removeChild(s)}BX.hide(i)}var a=BX.findChild(this.form,{className:"forum-upload-file-attach"},true);if(a)BX.show(a);var o=BX.findChild(this.form,{className:"reviews-upload-info"},true);if(o)BX.hide(o);var n=null,l=BX.findChild(this.form,{attr:{name:"captcha_code"}},true),d=BX.findChild(this.form,{attr:{name:"captcha_word"}},true),f=BX.findChild(this.form,{className:"reviews-reply-field-captcha-image"},true);if(f)n=BX.findChild(f,{tag:"img"});if(l&&d&&n){d.value="";BX.ajax.getCaptcha(function(e){l.value=e["captcha_sid"];n.src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"]})}},show:function(){BX.onCustomEvent(this.form,"onBeforeShow",[this]);BX.show(this.form.parentNode);BX.scrollToNode(BX.findChild(this.form,{attribute:{name:"send_button"}},true));setTimeout(BX.delegate(function(){this.editor.Focus();BX.defer(this.editor.Focus,this.editor)()},this),100);BX.onCustomEvent(this.form,"onAfterShow",[this]);return false},hide:function(){BX.onCustomEvent(this.form,"onBeforeHide",[this]);BX.hide(this.form.parentNode);BX.onCustomEvent(this.form,"onAfterHide",[this]);return false},transverse:function(){if(this.form.parentNode.style.display=="none")this.show();else this.hide();return false},quote:function(e){BX.onCustomEvent(this.form,"onPaste",[e,"QUOTE",this]);var t=e["author"]||null,i=e["text"]||"",s=i;if(this.editor.GetViewMode()=="wysiwyg"){s=s.replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/\n/g,"<br/>");if(t){if(t.id>0)t='<span id="'+this.editor.SetBxTag(false,{tag:"postuser",params:{value:t.id}})+'" class="bxhtmled-metion">'+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>";else t="<span>"+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>";t=t!==""?t+BX.message("f_author")+"<br/>":"";s=t+s}}else if(this.editor.bbCode&&t){if(t.id>0)t="[USER="+t.id+"]"+t.name+"[/USER]";else t=t.name;t=t!==""?t+BX.message("f_author")+"\n":"";s=t+s}this.editor.action.actions.quote.setExternalSelection(s);this.editor.action.Exec("quote")},paste:function(e){BX.onCustomEvent(this.form,"onPaste",[e,"REPLY",this]);var t=e["author"]||null;if(t){if(this.editor.GetViewMode()=="wysiwyg"){var i=this.editor.GetIframeDoc(),s=this.editor.selection.GetRange(),r=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},i),a=BX.create("SPAN",{html:",&nbsp;"},i);this.editor.SetBxTag(r,{tag:"postuser",params:{value:t.id}});this.editor.selection.InsertNode(r,s);if(r&&r.parentNode){var o=BX.findParent(r,{className:"bxhtmled-metion"},i.body);if(o){this.editor.util.InsertAfter(r,o)}}if(r&&r.parentNode){this.editor.util.InsertAfter(a,r);this.editor.selection.SetAfter(a)}}else if(this.editor.GetViewMode()=="code"&&this.editor.bbCode){this.editor.textareaView.Focus();this.editor.textareaView.WrapWith(false,false,"[USER="+t.id+"]"+t.name+"[/USER],")}}}};return t}(),s=[];BX.Forum.Init=function(i){if(!i||typeof i!="object")return;new t(i);var a,o;while((a=s.pop())&&a)BX.removeCustomEvent(e,"OnEditorInitedAfter",a);o=function(t){r(t,i);BX.removeCustomEvent(e,"OnEditorInitedAfter",o)};s.push(o);BX.addCustomEvent(e,"OnEditorInitedAfter",o)};var r=function(e,t){if(e.id==t.lheId){e.insertImageAfterUpload=true;BX.bind(BX("post_message_hidden"),"focus",function(){e.Focus()});new i(t,e)}};BX.ready(function(){if(BX.browser.IsIE()){var e=BX.findChildren(document,{className:"reviews-post-table"},true),t,i,s;if(!e)return;for(t=0;t<e.length;t++){i=e[t].getElementsByTagName("*");s=i.length;while(s--){if(i[s].scrollWidth>i[s].offsetWidth){i[s].style["paddingBottom"]="20px";i[s].style["overflowY"]="hidden"}}}}});e.fTextToNode=function(e){var t=BX.create("div");t.innerHTML=e;if(t.childNodes.length>0)return t;else return null};e.PostFormAjaxStatus=function(t){var i=BX.findChild(document,{className:"reviews-note-box"},true,true),s;if(i)for(s=0;s<=i.length;s++)BX.remove(i[s]);var r=BX.findChild(document,{className:"reviews-block-container"},true);if(!r)return;if(t.length<1)return;var a=e.fTextToNode(t);if(!a)return;var o=["reviews-reply-form","reviews-collapse"];var n=r;while((n=n.nextSibling)&&!!n){if(n.nodeType==1){var l=false;for(s=0;s<o.length;s++){if(BX.hasClass(n,o[s])){l=true;break}}if(l){n.parentNode.insertBefore(a,n);break}}}};e.SetReviewsAjaxPostTmp=function(t){e.forumAjaxPostTmp=t};e.fReplaceOrInsertNode=function(t,i,s,r){var a=null;if(!BX.type.isDomNode(s))return false;if(!BX.type.isDomNode(t)&&!BX.type.isArray(t)&&t.length>0)if(!(t=e.fTextToNode(t)))return false;if(BX.type.isDomNode(i)){s=i.parentNode;a=i.nextSibling;s.removeChild(i)}if(!a)a=BX.findChild(s,r,true);if(a){a.parentNode.insertBefore(t,a)}else{s.appendChild(t)}return true};e.fRunScripts=function(e){var t=BX.processHTML(e,true);BX.ajax.processScripts(t.SCRIPT,true)};e.ShowLastEditReason=function(e,t){if(t){if(e)t.style.display="block";else t.style.display="none"}};e.AttachFile=function(e,t,i,s){var r=null;var a=false;e=parseInt(e);t=parseInt(t);document.getElementById("upload_files_info_"+i).style.display="block";for(var o=e;o<e+t;o++){r=document.getElementById("upload_files_"+o+"_"+i);if(!r||typeof r===null)break;if(r.style.display=="none"){a=true;r.style.display="block";break}}var n=!a?true:o>=e+t-1;if(n===true)s.style.display="none"};e.GetSelection=function(){var t,i="";if(e.getSelection){t=e.getSelection();i=t.toString()}else if(document.selection){t=document.selection;i=t.createRange().text}return i}})(window);
//# sourceMappingURL=script.map.js