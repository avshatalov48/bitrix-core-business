this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,s,t,l,a,i,r){"use strict";var o=babelHelpers.classPrivateFieldLooseKey("moduleId");var c=babelHelpers.classPrivateFieldLooseKey("entity");var n=babelHelpers.classPrivateFieldLooseKey("documentId");class d{constructor(e,s,t){Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,c,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});if(!a.Type.isStringFilled(e)||!a.Type.isStringFilled(s)||!(a.Type.isStringFilled(t)||a.Type.isNumber(t))){throw new TypeError("incorrect complex document id")}babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=s;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=t}get moduleId(){return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}get entity(){return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}get documentId(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}}var p=babelHelpers.classPrivateFieldLooseKey("moduleId");var b=babelHelpers.classPrivateFieldLooseKey("entity");var u=babelHelpers.classPrivateFieldLooseKey("documentType");class v{constructor(e,s,t){Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});if(!a.Type.isStringFilled(e)||!a.Type.isStringFilled(s)||!a.Type.isStringFilled(t)){throw new TypeError("incorrect complex document type")}babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=s;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=t}get moduleId(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}get entity(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}get documentType(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}isEqual(e){if(a.Type.isString(e)){return e.includes(this.moduleId)&&e.includes(this.entity)&&e.includes(this.documentType)}if(a.Type.isObjectLike(e)){return this.moduleId===e.moduleId&&this.entity===e.entity&&this.documentType===e.documentType}return false}}const y=Object.freeze({load:"get_templates",start:"start_workflow",check_parameters:"check_parameters"});const h=Object.freeze({load:"getTemplates",start:"startWorkflow",check_parameters:"checkParameters"});var m=babelHelpers.classPrivateFieldLooseKey("defaultData");var P=babelHelpers.classPrivateFieldLooseKey("ajaxUrl");var F=babelHelpers.classPrivateFieldLooseKey("controller");var f=babelHelpers.classPrivateFieldLooseKey("fillDefaultData");var L=babelHelpers.classPrivateFieldLooseKey("hasAjaxUrl");var T=babelHelpers.classPrivateFieldLooseKey("callAjax");var H=babelHelpers.classPrivateFieldLooseKey("callController");class B{constructor(e){Object.defineProperty(this,H,{value:D});Object.defineProperty(this,T,{value:I});Object.defineProperty(this,L,{get:w,set:void 0});Object.defineProperty(this,f,{value:g});Object.defineProperty(this,m,{writable:true,value:{}});Object.defineProperty(this,P,{writable:true,value:""});Object.defineProperty(this,F,{writable:true,value:"bizproc.workflow.starter"});babelHelpers.classPrivateFieldLooseBase(this,f)[f](e);if(a.Type.isStringFilled(e.customAjaxUrl)){babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e.customAjaxUrl}else if(!a.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,m)[m].signed_document_type)){console.warn(`\n\t\t\t\tBizproc.Workflow.Starter: \n\t\t\t\tUsing the document type in parts has been deprecated and will soon cease to be supported. \n\t\t\t\tPlease use a signed document type\n\t\t\t`);babelHelpers.classPrivateFieldLooseBase(this,P)[P]="/bitrix/components/bitrix/bizproc.workflow.start/ajax.php"}}callAction(e,s={}){const t=babelHelpers.classPrivateFieldLooseBase(this,L)[L]?y[e]:h[e];if(!a.Type.isStringFilled(t)){return Promise.reject(new Error("incorrect action"))}const l=this.addData(babelHelpers.classPrivateFieldLooseBase(this,m)[m],s);return babelHelpers.classPrivateFieldLooseBase(this,L)[L]?babelHelpers.classPrivateFieldLooseBase(this,T)[T](t,l):babelHelpers.classPrivateFieldLooseBase(this,H)[H](t,l)}addData(e,s={}){const t=s;const l=a.Type.isPlainObject(t);Object.entries(e).forEach((([e,s])=>{const i=babelHelpers.classPrivateFieldLooseBase(this,L)[L]?e:a.Text.toCamelCase(e);if(l){t[i]=s;return}t.set(i,s)}));return t}}function g(e){var s,t,l,i;if(!a.Type.isNil(e.signedDocumentType)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].signed_document_type=e.signedDocumentType}if(!a.Type.isNil(e.signedDocumentId)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].signed_document_id=e.signedDocumentId}if(!a.Type.isNil((s=e.complexDocumentType)==null?void 0:s.moduleId)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].module_id=e.complexDocumentType.moduleId}if(!a.Type.isNil((t=e.complexDocumentType)==null?void 0:t.entity)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].entity=e.complexDocumentType.entity}if(!a.Type.isNil((l=e.complexDocumentType)==null?void 0:l.documentType)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].document_type=e.complexDocumentType.documentType}if(!a.Type.isNil((i=e.complexDocumentId)==null?void 0:i.documentId)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].document_id=e.complexDocumentId.documentId}}function w(){return a.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,P)[P])}function I(e,s={}){const t=this.addData({sessid:a.Loc.getMessage("bitrix_sessid"),site:a.Loc.getMessage("SITE_ID"),ajax_action:e},s);return new Promise(((e,s)=>{const l={method:"POST",dataType:"json",url:babelHelpers.classPrivateFieldLooseBase(this,P)[P],data:t,onsuccess:t=>{if(t.success){e(t)}else{s(t)}},onfailure:()=>{s()}};if(!a.Type.isPlainObject(t)){l.preparePost=false}a.ajax(l)}))}function D(e,s={}){return new Promise(((t,l)=>{a.ajax.runAction(`${babelHelpers.classPrivateFieldLooseBase(this,F)[F]}.${e}`,{data:s}).then(t).catch(l)}))}var S=babelHelpers.classPrivateFieldLooseKey("messages");var x=babelHelpers.classPrivateFieldLooseKey("setMessages");var j=babelHelpers.classPrivateFieldLooseKey("showMessages");var O=babelHelpers.classPrivateFieldLooseKey("defaultErrorMessage");class E{constructor(e){Object.defineProperty(this,O,{get:_,set:void 0});Object.defineProperty(this,j,{value:k});Object.defineProperty(this,x,{value:K});Object.defineProperty(this,S,{writable:true,value:[]});if(a.Type.isArrayFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,x)[x](e)}}show(){babelHelpers.classPrivateFieldLooseBase(this,j)[j](i.MessageBox)}showToWindow(e){e.BX.Runtime.loadExtension("ui.dialogs.messagebox").then((()=>{babelHelpers.classPrivateFieldLooseBase(this,j)[j](e.BX.UI.Dialogs.MessageBox)})).catch((()=>{}))}}function K(e){e.forEach((e=>{if(a.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,S)[S].push(a.Text.encode(e))}else if(a.Type.isPlainObject(e)&&a.Type.isStringFilled(e.message)){if(a.Type.isStringFilled(e.code)&&e.code==="NETWORK_ERROR"){babelHelpers.classPrivateFieldLooseBase(this,S)[S].push(a.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,O)[O]))}else{babelHelpers.classPrivateFieldLooseBase(this,S)[S].push(a.Text.encode(e.message))}}}))}function k(e){if(!e){return}if(a.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,S)[S])){e.alert(babelHelpers.classPrivateFieldLooseBase(this,S)[S].join("<br>"));return}e.alert(a.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,O)[O]))}function _(){return a.Loc.getMessage("BIZPROC_JS_WORKFLOW_STARTER_REQUEST_FAILED")}var A=babelHelpers.classPrivateFieldLooseKey("templates");var U=babelHelpers.classPrivateFieldLooseKey("signedDocumentType");var N=babelHelpers.classPrivateFieldLooseKey("signedDocumentId");var W=babelHelpers.classPrivateFieldLooseKey("complexDocumentType");var X=babelHelpers.classPrivateFieldLooseKey("complexDocumentId");var M=babelHelpers.classPrivateFieldLooseKey("templatesSelector");var R=babelHelpers.classPrivateFieldLooseKey("callActionHelper");var z=babelHelpers.classPrivateFieldLooseKey("hasCustomAjaxUrl");var C=babelHelpers.classPrivateFieldLooseKey("setDocumentType");var q=babelHelpers.classPrivateFieldLooseKey("setDocumentId");var J=babelHelpers.classPrivateFieldLooseKey("showTemplatesSlider");var Z=babelHelpers.classPrivateFieldLooseKey("loadTemplates");var $=babelHelpers.classPrivateFieldLooseKey("initTemplateSelector");var G=babelHelpers.classPrivateFieldLooseKey("onTemplateSelect");var Q=babelHelpers.classPrivateFieldLooseKey("showStepByStepSlider");var V=babelHelpers.classPrivateFieldLooseKey("createStepByStepSliderUrl");var Y=babelHelpers.classPrivateFieldLooseKey("callAction");var ee=babelHelpers.classPrivateFieldLooseKey("showErrors");class se extends r.EventEmitter{constructor(e){super();Object.defineProperty(this,ee,{value:pe});Object.defineProperty(this,Y,{value:de});Object.defineProperty(this,V,{value:ne});Object.defineProperty(this,Q,{value:ce});Object.defineProperty(this,G,{value:oe});Object.defineProperty(this,$,{value:re});Object.defineProperty(this,Z,{value:ie});Object.defineProperty(this,J,{value:ae});Object.defineProperty(this,q,{value:le});Object.defineProperty(this,C,{value:te});Object.defineProperty(this,A,{writable:true,value:null});Object.defineProperty(this,U,{writable:true,value:null});Object.defineProperty(this,N,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:null});Object.defineProperty(this,X,{writable:true,value:null});Object.defineProperty(this,M,{writable:true,value:null});Object.defineProperty(this,R,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:false});this.setEventNamespace("BX.Bizproc.Workflow.Starter");babelHelpers.classPrivateFieldLooseBase(this,C)[C](e);if(a.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,W)[W])&&a.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,U)[U])){throw new TypeError("document type is empty")}babelHelpers.classPrivateFieldLooseBase(this,q)[q](e);if(a.Type.isArray(e.templates)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e.templates}babelHelpers.classPrivateFieldLooseBase(this,z)[z]=a.Type.isStringFilled(e.ajaxUrl);babelHelpers.classPrivateFieldLooseBase(this,R)[R]=new B({complexDocumentType:babelHelpers.classPrivateFieldLooseBase(this,W)[W],signedDocumentType:babelHelpers.classPrivateFieldLooseBase(this,U)[U],complexDocumentId:babelHelpers.classPrivateFieldLooseBase(this,X)[X],signedDocumentId:babelHelpers.classPrivateFieldLooseBase(this,N)[N],customAjaxUrl:babelHelpers.classPrivateFieldLooseBase(this,z)[z]?e.ajaxUrl:null});Pe.put(this)}static singleStart(e,s){const t=a.Text.toInteger(e==null?void 0:e.templateId);if(t<=0){return}let l=null;try{l=new se({moduleId:e.moduleId,entity:e.entity,documentType:e.documentType,documentId:e.documentId,signedDocumentType:e.signedDocumentType,signedDocumentId:e.signedDocumentId,templates:e.templates||null,ajaxUrl:e.ajaxUrl||""})}catch(e){console.error(e);return}if(a.Type.isFunction(s)){r.EventEmitter.subscribe(l,"onAfterStartWorkflow",s)}l.beginStartWorkflow(t).then((()=>{Pe.remove(l)})).catch((()=>{}))}static showTemplates(e,s){let t=null;try{t=new se({signedDocumentType:e.signedDocumentType,signedDocumentId:e.signedDocumentId})}catch(e){console.error(e);return}babelHelpers.classPrivateFieldLooseBase(t,J)[J]((()=>{if(a.Type.isFunction(s.callback)){s.callback()}Pe.remove(t)}))}get signedDocumentType(){return babelHelpers.classPrivateFieldLooseBase(this,U)[U]}get complexDocumentType(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W]}showTemplatesMenu(e){if(a.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,U)[U])&&!babelHelpers.classPrivateFieldLooseBase(this,z)[z]){babelHelpers.classPrivateFieldLooseBase(this,J)[J]();return}if(!a.Type.isElementNode(e)&&!a.Type.isNull(e)){return}if(a.Type.isArray(babelHelpers.classPrivateFieldLooseBase(this,A)[A])){if(!babelHelpers.classPrivateFieldLooseBase(this,M)[M]){babelHelpers.classPrivateFieldLooseBase(this,$)[$](e)}babelHelpers.classPrivateFieldLooseBase(this,M)[M].show();return}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]().then((()=>{this.showTemplatesMenu(e)})).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](e==null?void 0:e.errors)}))}showParametersPopup(e){this.beginStartWorkflow(e).then((()=>{})).catch((()=>{}))}beginStartWorkflow(e){if(a.Text.toInteger(e)<=0){return Promise.resolve()}return new Promise(((s,t)=>{babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]({templateId:e,autoExecuteType:null}).then((e=>{if(a.Type.isStringFilled(e.workflowId)){Pe.fireEvent(this,"onAfterStartWorkflow",{workflowId:e.workflowId})}s()})).catch(t)}))}showAutoStartParametersPopup(e,s={}){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]({templateId:null,autoExecuteType:e}).then((e=>{if(a.Type.isFunction(s==null?void 0:s.callback)){if(a.Type.isString(e.signedParameters)){s.callback({parameters:e.signedParameters});return}s.callback({parameters:null})}})).catch((()=>{}))}}function te(e){if(a.Type.isStringFilled(e.moduleId)&&a.Type.isStringFilled(e.entity)&&a.Type.isStringFilled(e.documentType)){babelHelpers.classPrivateFieldLooseBase(this,W)[W]=new v(e.moduleId,e.entity,e.documentType)}if(a.Type.isStringFilled(e.signedDocumentType)){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e.signedDocumentType}}function le(e){if(a.Type.isStringFilled(e.moduleId)&&a.Type.isStringFilled(e.entity)&&(a.Type.isStringFilled(e.documentId)||a.Type.isNumber(e.documentId))){babelHelpers.classPrivateFieldLooseBase(this,X)[X]=new d(e.moduleId,e.entity,e.documentId)}if(a.Type.isStringFilled(e.signedDocumentId)){babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e.signedDocumentId}}function ae(e=null){const s={width:970,cacheable:false,events:{onCloseComplete:a.Type.isFunction(e)?e:()=>{}}};const t={signedDocumentType:babelHelpers.classPrivateFieldLooseBase(this,U)[U],signedDocumentId:babelHelpers.classPrivateFieldLooseBase(this,N)[N]};const l=BX.Uri.addParam("/bitrix/components/bitrix/bizproc.workflow.start.list/",t);BX.SidePanel.Instance.open(l,s)}function ie(){return new Promise(((e,s)=>{babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]("load").then((s=>{babelHelpers.classPrivateFieldLooseBase(this,A)[A]=a.Type.isArray(s.data.templates)?s.data.templates:[];e(s)})).catch(s)}))}function re(e){const t=[];if(a.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,A)[A])){babelHelpers.classPrivateFieldLooseBase(this,A)[A].forEach((e=>{if(a.Text.toInteger(e.id)>0&&a.Type.isStringFilled(e.name)){t.push({id:e.id,title:e.name,subtitle:e.description||"",entityId:"template",tabs:"recents",customData:e})}}))}babelHelpers.classPrivateFieldLooseBase(this,M)[M]=new s.Dialog({targetNode:e,context:"bp_workflow_starter",items:t,multiple:false,dropdownMode:true,enableSearch:true,hideOnSelect:true,clearSearchOnSelect:true,hideByEsc:true,cacheable:true,focusOnFirst:true,showAvatars:false,compactView:false,events:{"Item:onSelect":e=>{var s;babelHelpers.classPrivateFieldLooseBase(this,M)[M].deselectAll();const t=(s=e.getData().item)==null?void 0:s.getCustomData();if(t){babelHelpers.classPrivateFieldLooseBase(this,G)[G](t)}}},recentTabOptions:{stub:true,stubOptions:{title:a.Loc.getMessage("BIZPROC_JS_WORKFLOW_STARTER_EMPTY_TEMPLATES")}}})}function oe(e){this.beginStartWorkflow(e.get("id")).then((()=>{})).catch((()=>{}))}function ce(e){return new Promise((s=>{BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldLooseBase(this,V)[V](e),{width:900,cacheable:false,allowChangeHistory:false,events:{onCloseComplete:e=>{const t=e.getSlider();const l=t?t.getData():null;let a={};if(l&&l.has("data")){a={workflowId:l.get("data").workflowId||null,signedParameters:l.get("data").signedParameters||null}}s(a)}}})}))}function ne(e){var s,t;let l=a.Uri.addParam("/bitrix/components/bitrix/bizproc.workflow.start/",{sessid:a.Loc.getMessage("bitrix_sessid")});const i=a.Text.toInteger(e.templateId);if(i>0){l=a.Uri.addParam(l,{templateId:i})}const r=a.Text.toInteger(e.autoExecuteType);if(!a.Type.isNil(e.autoExecuteType)&&r>=0){l=a.Uri.addParam(l,{autoExecuteType:r})}if((s=babelHelpers.classPrivateFieldLooseBase(this,W)[W])!=null&&s.moduleId){l=a.Uri.addParam(l,{moduleId:babelHelpers.classPrivateFieldLooseBase(this,W)[W].moduleId,entity:babelHelpers.classPrivateFieldLooseBase(this,W)[W].entity,documentType:babelHelpers.classPrivateFieldLooseBase(this,W)[W].documentType})}if(babelHelpers.classPrivateFieldLooseBase(this,U)[U]){l=a.Uri.addParam(l,{signedDocumentType:babelHelpers.classPrivateFieldLooseBase(this,U)[U]})}if((t=babelHelpers.classPrivateFieldLooseBase(this,X)[X])!=null&&t.documentId){l=a.Uri.addParam(l,{documentId:babelHelpers.classPrivateFieldLooseBase(this,X)[X].documentId})}if(babelHelpers.classPrivateFieldLooseBase(this,N)[N]){l=a.Uri.addParam(l,{signedDocumentId:babelHelpers.classPrivateFieldLooseBase(this,N)[N]})}return l}function de(e,s={},t={}){return babelHelpers.classPrivateFieldLooseBase(this,R)[R].callAction(e,babelHelpers.classPrivateFieldLooseBase(this,R)[R].addData(t,s))}function pe(e,s){const t=new E(e);const l=a.Type.isNil(s)?"show":"showToWindow";t[l](s)}var be=babelHelpers.classPrivateFieldLooseKey("instances");var ue=babelHelpers.classPrivateFieldLooseKey("findSimilar");var ve=babelHelpers.classPrivateFieldLooseKey("isEqual");class ye{constructor(){Object.defineProperty(this,ve,{value:me});Object.defineProperty(this,ue,{value:he});Object.defineProperty(this,be,{writable:true,value:new Set})}put(e){babelHelpers.classPrivateFieldLooseBase(this,be)[be].add(e);return this}remove(e){babelHelpers.classPrivateFieldLooseBase(this,be)[be].delete(e)}fireEvent(e,s,t){const l=babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](e);l.forEach((e=>{e.emit(s,t);r.EventEmitter.emit(e,s,t,{useGlobalNaming:true})}))}}function he(e){const s=[e];babelHelpers.classPrivateFieldLooseBase(this,be)[be].forEach((t=>{if(t!==e&&babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](e,t)){s.push(t)}}));return s}function me(e,s){if(e.signedDocumentType&&s.signedDocumentType){return e.signedDocumentType===s.signedDocumentType}if(e.complexDocumentType){return e.complexDocumentType.isEqual(s.complexDocumentType||s.signedDocumentType)}return s.complexDocumentType.isEqual(e.complexDocumentType||e.signedDocumentType)}const Pe=new ye;e.Starter=se;e.managerInstance=Pe})(this.BX.Bizproc.Workflow=this.BX.Bizproc.Workflow||{},BX.UI.EntitySelector,BX,BX,BX,BX.UI.Dialogs,BX.Event);
//# sourceMappingURL=starter.bundle.map.js