this.BX=this.BX||{};this.BX.Mail=this.BX.Mail||{};(function(e,t,a,r,n,i){"use strict";var o,l,s,c,d,u,f,v,g;function p(e,t){var a=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=E(e))||t&&e&&typeof e.length==="number"){if(a)e=a;var r=0;var n=function e(){};return{s:n,n:function t(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function e(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,o=false,l;return{s:function t(){a=a.call(e)},n:function e(){var t=a.next();i=t.done;return t},e:function e(t){o=true;l=t},f:function e(){try{if(!i&&a["return"]!=null)a["return"]()}finally{if(o)throw l}}}}function E(e,t){if(!e)return;if(typeof e==="string")return m(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return m(e,t)}function m(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function b(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?b(Object(a),!0).forEach((function(t){babelHelpers.defineProperty(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var h=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getCheckedFields",value:function e(a){var r=a.querySelector('[data-role="email-container"]');var n=r.querySelector('[data-role="input-field"]');var i=n.value;var o=a.querySelector('[data-role="name-container"]');var l=o.querySelector('[data-role="input-field"]');var s=l.value;var c=true;if(!t.Validation.isEmail(i)){c=false;r.showError(0)}else if(s.length<1){s=i.split("@")[0]}var d={name:s,email:i};if(c){return d}return false}},{key:"openRemoveDialog",value:function e(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{id:""};var n=new BX.Promise;var i=this.removeContact;var o=BX.SidePanel.Instance.getTopSlider();var l=1;if(o!=null){l+=o.getZindex()}var s=new r.MessageBox({title:t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_REMOVE_DIALOG_TITLE"),message:t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_REMOVE_DIALOG_MESSAGE"),buttons:BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,popupOptions:{zIndex:l},onOk:function e(){i(a["id"]).then((function(){return n.fulfill()}));s.close()},onCancel:function e(){n.reject();s.close()}});s.show();return n}},{key:"removeContact",value:function e(t){return BX.ajax.runAction("mail.addressbook.removecontacts",{data:{idSet:[t]}})}},{key:"saveContact",value:function e(t,a){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"new";var i=n.Avatar.getAvatarData({fullName:t,email:a});var o={NAME:t,EMAIL:a,COLOR:i["color"],INITIALS:i["abbreviation"]};if(r!==undefined){o["ID"]=r}return BX.ajax.runAction("mail.addressbook.savecontact",{data:{contactData:o}})}},{key:"showError",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;this.emailInputWrapper.classList.add("ui-ctl-danger");BX.show(this.errorTitle[t])}},{key:"hideError",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"all";this.emailInputWrapper.classList.remove("ui-ctl-danger");if(t==="all"){this.errorTitle.forEach((function(e){BX.hide(e)}));return}BX.hide(this.errorTitle[t])}},{key:"showErrorEmailAlreadyExists",value:function e(t,a,r){var n=this;var i=this.getLastOfMatchingContactFromError(t);var o=i.contactID,l=i.contactData;if(i!==null){a.onclick=function(){n.openEditDialog({contactID:o,contactData:l})};r.showError(1);return true}return false}},{key:"openDialog",value:function e(r,n){var p=this;var E=n.contactID,m=E===void 0?"new":E,b=n.showEmailError,I=b===void 0?false:b,h=n.prefixId,A=n.contactData,T=n.responseError;var _="dialogEditContact_"+m;if(h!==undefined){_+="_"+h}var L="";var D="";var O="";var y="";if(A!==undefined){D=A.name;L=A.email;if(m!=="new"){O="ui-ctl-disabled";y="disabled"}}var C=t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<input data-role="input-field" type="text" class="ui-ctl-element" value="" placeholder="info@example.com"  ',">"])),y);var M=t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-textbox ui-ctl-w100 ','">\n\t\t\t',"\n\t\t</div>"])),O,C);C.value=L;var B=t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['<div class="ui-alert ui-alert-danger mail-addressbook-error-box">\n\t\t\t<span class="ui-alert-message">',"</span>\n\t\t</div>"])),t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_EMAIL_ERROR"));var k=t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['<div class="ui-alert ui-alert-danger mail-addressbook-error-box">\n\t\t\t<span class="ui-alert-message">',"</span>\n\t\t\t<br>\n\t\t</div>"])),t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_EMAIL_ERROR_EMAIL_IS_ALREADY_EXISTS"));var w=k.querySelector('[data-role="contact-email"]');var x=t.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['<div data-role="email-container" class="mail-addressbook-dialogeditcontact-item">\n\t\t\t<label class="mail-addressbook-dialogeditcontact-lable">','\n\t\t\t\t<div id="mail-addressbook-dialogeditcontact-contact-email-container" class="ui-ctl ui-ctl-textbox mail-addressbook-dialogeditcontact-field">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t\t","\n\t\t\t","\n\t\t</div>"])),t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_EMAIL_TITLE"),M,B,k);var S=t.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['<input data-role="input-field" type="text" class="ui-ctl-element" value="" placeholder="">'])));var X=t.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t',"\n\t\t</div>"])),S);S.value=D;var N=t.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<div data-role="name-container" class="mail-addressbook-dialogeditcontact-item">\n\t\t\t<label class="mail-addressbook-dialogeditcontact-lable">','\n\t\t\t\t<div id="mail-addressbook-dialogeditcontact-contact-email-container" class="ui-ctl ui-ctl-textbox mail-addressbook-dialogeditcontact-field">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t</div>"])),t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_NAME_TITLE"),X);var j=t.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(["\n\t\t<div>\n\t\t\t","\n\t\t\t","\n\t\t</div>"])),N,x);x.errorTitle=[B,k];x.emailInputWrapper=M;x.showError=this.showError;x.hideError=this.hideError;x.hideError();if(I===true){x.showError()}C.oninput=function(){return x.hideError()};if(T!==undefined){this.showErrorEmailAlreadyExists(T,w,x)}a.SidePanelWrapper.open({id:_,titleText:r,footerIsActive:true,content:j,cancelButton:{text:t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_BUTTON_CANCEL")},consentButton:{text:t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_BUTTON_SAVE"),function:function e(t){var a=p.getCheckedFields(j);if(a){t.setClocking(true);p.saveContact(a["name"],a["email"],n["contactID"]).then((function(e){i.EventEmitter.emit("BX.DialogEditContact:onSaveContact",new i.BaseEvent({data:{items:e.data,prefixId:n.prefixId}}));BX.SidePanel.Instance.postMessageAll(_,"dialogEditContact::reloadList",{});BX.SidePanel.Instance.close()}))["catch"]((function(e){if(p.showErrorEmailAlreadyExists(e,w,x)){t.setClocking(false)}else{BX.SidePanel.Instance.postMessageAll(_,"dialogEditContact::reloadList",{});BX.SidePanel.Instance.close()}}))}}}});return m}},{key:"openCreateDialog",value:function e(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var r=a.responseError,n=a.prefixId;if(r!==undefined){var i=this.getLastOfMatchingContactFromError(r);return this.openEditDialog(I({prefixId:n},i))}return this.openDialog(t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_TITLE_BAR_ADD_MSGVER_1"),a)}},{key:"getLastOfMatchingContactFromError",value:function e(t){var a=null;var r=p(t.errors),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.code==="ALL_CONTACTS_ALREADY_ADDED"){a=i.customData.lastFound[0];break}}}catch(e){r.e(e)}finally{r.f()}if(a!==null){return{contactID:Number(a["ID"]),contactData:{name:a["NAME"],email:a["EMAIL"]}}}return null}},{key:"openEditDialog",value:function e(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{contactID:"",contactData:{name:"",email:""}};return this.openDialog(t.Loc.getMessage("MAIL_DIALOG_EDIT_CONTACT_TITLE_BAR_EDIT_MSGVER_1"),a)}}]);return e}();e.DialogEditContact=h})(this.BX.Mail.AddressBook=this.BX.Mail.AddressBook||{},BX,BX.Mail,BX.UI.Dialogs,BX.Mail,BX.Event);
//# sourceMappingURL=dialogeditcontact.bundle.map.js