(function(e,t,a,r){"use strict";var i=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"grid",null);babelHelpers.defineProperty(this,"totalWrapper",null);this.gridId=t.gridId;this.grid=BX.Main.gridManager.getInstanceById(this.gridId);this.signedParameters=t.signedParameters;this.totalWrapperId=t.totalWrapperId||null;this.inventoryManagementLink=t.inventoryManagementLink||null;this.productId=t.productId;this.reservedDealsSliderLink=t.reservedDealsSliderLink;if(this.totalWrapperId){this.totalWrapper=BX(this.totalWrapperId);this.refreshTotalWrapper()}this.subscribeEvents();this.bindSliderToReservedQuantityNodes()}babelHelpers.createClass(e,[{key:"subscribeEvents",value:function e(){this.onGridUpdatedHandler=this.onGridUpdated.bind(this);a.EventEmitter.subscribe("Grid::updated",this.onGridUpdatedHandler)}},{key:"bindSliderToReservedQuantityNodes",value:function e(){var a=this;var r=this.grid.getRows().getRows();r.forEach((function(e){if(e.isBodyChild()&&!e.isTemplate()){var r=e.getNode().querySelector(".main-grid-cell-content-store-amount-reserved-quantity");if(t.Type.isDomNode(r)){t.Event.bind(r,"click",a.openDealsWithReservedProductSlider.bind(a,a.productId,e.getId()))}}}))}},{key:"openDealsWithReservedProductSlider",value:function e(a){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(!this.reservedDealsSliderLink){return}var i=new t.Uri(this.reservedDealsSliderLink);i.setQueryParam("productId",a);if(r>0){i.setQueryParam("storeId",r)}BX.SidePanel.Instance.open(i.toString(),{allowChangeHistory:false,cacheable:false})}},{key:"onGridUpdated",value:function e(t){var a=t.getCompatData(),r=babelHelpers.slicedToArray(a,2),i=r[0],n=r[1];if(!i||i.getId()!==this.getGridId()){return}this.refreshTotalWrapper()}},{key:"getGridId",value:function e(){return this.gridId}},{key:"reloadGrid",value:function e(){if(this.grid){this.grid.reload()}}},{key:"setTotalData",value:function e(t){for(var a in t){if(t.hasOwnProperty(a)){this.setTotalDataBySelector("#".concat(a),t[a])}}}},{key:"setTotalDataBySelector",value:function e(t,a){if(this.totalWrapper){var r=this.totalWrapper.querySelector(t);if(r){r.innerHTML=a;return true}}return false}},{key:"hideTotalData",value:function e(){BX.hide(this.totalWrapper)}},{key:"showTotalData",value:function e(){BX.show(this.totalWrapper)}},{key:"refreshTotalWrapper",value:function e(){var t=this;if(this.totalWrapper){BX.ajax.runComponentAction("bitrix:catalog.productcard.store.amount","getStoreAmountTotal",{mode:"ajax",data:{signedParameters:this.signedParameters}}).then((function(e){var a=e.data.AMOUNT||"";var r=e.data.QUANTITY||"";var i=e.data.QUANTITY_RESERVED||"";var n=e.data.QUANTITY_COMMON||"";if(a||r||n||i){var o={total_amount:a,total_quantity:r,total_quantity_common:n,total_quantity_reserved:i};t.setTotalData(o);if(BX.isNodeHidden(t.totalWrapper)){t.showTotalData()}}else{t.hideTotalData()}}))}}},{key:"openInventoryManagementSlider",value:function e(){if(this.inventoryManagementLink){(new r.Slider).open(this.inventoryManagementLink,{data:{openGridOnDone:false},events:{onCloseComplete:function e(t){var a=t.getSlider();if(!a){return}if(a.getData().get("isInventoryManagementEnabled")){window.top.location.reload()}}}})}}}]);return e}();t.Reflection.namespace("BX.Catalog").ProductStoreGridManager=i})(this.window=this.window||{},BX,BX.Event,BX.Catalog.StoreUse);
//# sourceMappingURL=script.map.js