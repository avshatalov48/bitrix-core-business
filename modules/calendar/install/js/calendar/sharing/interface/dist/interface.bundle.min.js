this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(e,s,t,i,a,l,r,o,n,d,h,c,u,p,b,g,v,L,P){"use strict";let _=e=>e,B,m;var S=babelHelpers.classPrivateFieldLooseKey("popup");var y=babelHelpers.classPrivateFieldLooseKey("loader");var H=babelHelpers.classPrivateFieldLooseKey("layout");var T=babelHelpers.classPrivateFieldLooseKey("qrCode");var F=babelHelpers.classPrivateFieldLooseKey("context");class w{constructor(e){this.QRCODE_SIZE=114;this.QRCODE_COLOR_LIGHT="#fff";this.QRCODE_COLOR_DARK="#000";Object.defineProperty(this,S,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,S)[S]=null;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=null;babelHelpers.classPrivateFieldLooseBase(this,H)[H]={qr:null};babelHelpers.classPrivateFieldLooseBase(this,T)[T]=null;babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.context;this.sharingUrl=e.sharingUrl}getPopup(){if(!babelHelpers.classPrivateFieldLooseBase(this,S)[S]){babelHelpers.classPrivateFieldLooseBase(this,S)[S]=new h.Popup({className:"calendar-sharing__qr",width:315,padding:0,content:this.getContent(),closeIcon:true,closeByEsc:true,autoHide:true,overlay:true,animation:"fading-slide"})}return babelHelpers.classPrivateFieldLooseBase(this,S)[S]}getLoader(){if(!babelHelpers.classPrivateFieldLooseBase(this,y)[y]){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=new s.Loader({size:95})}return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}getNodeQr(){if(!babelHelpers.classPrivateFieldLooseBase(this,H)[H].qr){babelHelpers.classPrivateFieldLooseBase(this,H)[H].qr=o.Tag.render(B||(B=_`
				<div class="calendar-sharing__qr-block"></div>
			`));this.getLoader().show(babelHelpers.classPrivateFieldLooseBase(this,H)[H].qr);this.showQr()}return babelHelpers.classPrivateFieldLooseBase(this,H)[H].qr}async showQr(){await this.initQrCode();this.QRCode=new QRCode(babelHelpers.classPrivateFieldLooseBase(this,H)[H].qr,{text:this.sharingUrl,width:this.QRCODE_SIZE,height:this.QRCODE_SIZE,colorDark:this.QRCODE_COLOR_DARK,colorLight:this.QRCODE_COLOR_LIGHT,correctLevel:QRCode.CorrectLevel.H});await this.getLoader().hide()}async initQrCode(){await o.Runtime.loadExtension(["main.qrcode"])}getContent(){return o.Tag.render(m||(m=_`
			<div class="calendar-sharing__qr-content">
				<div class="calendar-sharing__qr-title">${0}</div>
				${0}
				<div class="calendar-sharing__qr-info">${0}</div>
				<a class="calendar-sharing__dialog-link" href="${0}" target="_blank">${0}</a>
			</div>
		`),this.getPhraseDependsOnContext("SHARING_INFO_POPUP_QR_TITLE"),this.getNodeQr(),o.Loc.getMessage("SHARING_INFO_POPUP_QR_INFO"),this.sharingUrl,o.Loc.getMessage("SHARING_INFO_POPUP_QR_OPEN_LINK"))}isShown(){return this.getPopup().isShown()}close(){this.getPopup().close()}show(){this.getPopup().show()}destroy(){this.getPopup().destroy()}getPhraseDependsOnContext(e){return o.Loc.getMessage(`${e}_${babelHelpers.classPrivateFieldLooseBase(this,F)[F].toUpperCase()}`)}}let f=e=>e,E;class C{constructor(e){this.wrap=null;this.name=e.name;this.index=e.index;this.active=e.active;this.onSelected=o.Type.isFunction(e.onSelected)?e.onSelected:()=>{};this.onDiscarded=o.Type.isFunction(e.onDiscarded)?e.onDiscarded:()=>{};this.onMouseDown=o.Type.isFunction(e.onMouseDown)?e.onMouseDown:()=>{};this.canBeDiscarded=o.Type.isFunction(e.canBeDiscarded)?e.canBeDiscarded:()=>{}}render(){const e=this.active?"--selected":"";this.wrap=o.Tag.render(E||(E=f`
			<div class="calendar-sharing__settings-popup-weekday ${0}" onmousedown="${0}">
				<div class="calendar-sharing__settings-popup-weekday-text">${0}</div>
				<div class="calendar-sharing__settings-popup-weekday-icon"></div>
			</div>
		`),e,(e=>this.handleMouseDown(e)),this.name);return this.wrap}handleMouseDown(e){if(this.active){this.discard()}else{this.select()}this.onMouseDown(e,this)}select(){this.active=true;o.Dom.addClass(this.wrap,"--selected");this.onSelected()}discard(){if(!this.canBeDiscarded()){return}this.active=false;o.Dom.removeClass(this.wrap,"--selected");this.onDiscarded()}}let k=e=>e,A,N,R,I,O,D,U;class M{constructor(e){this.layout={wrap:null,weekdaysSelect:null,startSelect:null,endSelect:null};this.readOnly=e.readOnly;this.weekStart=e.weekStart;this.workDays=e.workDays;this.getSlotSize=e.getSlotSize;this.rule={from:e.from,to:e.to,weekdays:this.getSortedWeekdays(e.weekdays)};this.ruleUpdated=o.Type.isFunction(e.ruleUpdated)?e.ruleUpdated:()=>{};this.addRange=o.Type.isFunction(e.addRange)?e.addRange:()=>{};this.removeRange=o.Type.isFunction(e.removeRange)?e.removeRange:()=>{};this.showReadOnlyPopup=o.Type.isFunction(e.showReadOnlyPopup)?e.showReadOnlyPopup:()=>{};this.show=e.show;this.deletable=false}getRule(){return this.rule}settingPopupShown(){const e=o.Dom.hasClass(this.layout.weekdaysSelect,"--active");const s=o.Dom.hasClass(this.layout.fromTimeSelect,"--active");const t=o.Dom.hasClass(this.layout.toTimeSelect,"--active");return e||s||t}getWrap(){return this.layout.wrap}disableAnimation(){this.show=false}render(){this.layout.wrap=o.Tag.render(A||(A=k`
			<div class="calendar-sharing__settings-range">
				${0}
				<div class="calendar-sharing__settings-time-interval">
					${0}
					<div class="calendar-sharing__settings-dash"></div>
					${0}
				</div>
				${0}
			</div>
		`),this.renderWeekdaysSelect(),this.renderTimeFromSelect(),this.renderTimeToSelect(),this.renderButton());if(this.show){o.Dom.addClass(this.layout.wrap,"--animate-show");setTimeout((()=>o.Dom.removeClass(this.layout.wrap,"--animate-show")),300)}return this.layout.wrap}renderButton(){this.layout.button=this.getButton();return this.layout.button}update(){const e=24*60-this.getSlotSize();if(this.rule.from>e){this.rule.from=e;if(this.layout.fromTimeSelect){this.layout.fromTimeSelect.innerHTML=this.formatAmPmSpan(this.formatMinutes(this.rule.from))}this.rule.to=24*60;if(this.layout.toTimeSelect){this.layout.toTimeSelect.innerHTML=this.formatAmPmSpan(this.formatMinutes(this.rule.to))}}else{this.updateTo()}}updateTo(){const e=this.rule.from+this.getSlotSize();if(e>this.rule.to){this.rule.to=e;if(this.layout.toTimeSelect){this.layout.toTimeSelect.innerHTML=this.formatAmPmSpan(this.formatMinutes(this.rule.to))}}}setDeletable(e){this.deletable=e;const s=this.layout.button;this.layout.button=this.getButton();s==null?void 0:s.replaceWith(this.layout.button)}getButton(){let e;if(this.deletable){e=o.Tag.render(N||(N=k`
				<div class="calendar-sharing__settings-delete"></div>
			`));o.Event.bind(e,"click",this.onDeleteButtonClickHandler.bind(this))}else{e=o.Tag.render(R||(R=k`
				<div class="calendar-sharing__settings-add"></div>
			`));o.Event.bind(e,"click",this.onAddButtonClickHandler.bind(this))}return e}onDeleteButtonClickHandler(){if(this.readOnly){this.showReadOnlyPopup(this.layout.button)}else{this.remove()}}onAddButtonClickHandler(){if(this.readOnly){this.showReadOnlyPopup(this.layout.button)}else{this.addRange(this)}}hideButton(){o.Dom.addClass(this.layout.button,"--hidden")}showButton(){o.Dom.removeClass(this.layout.button,"--hidden")}remove(){if(!this.removeRange(this)){return}o.Dom.addClass(this.layout.wrap,"--animate-remove");setTimeout((()=>this.layout.wrap.remove()),300)}renderWeekdaysSelect(){const e=n.Util.getWeekdaysLoc().map(((e,s)=>({loc:e,index:s,active:this.rule.weekdays.includes(s)})));e.push(...e.splice(0,this.weekStart));this.layout.weekdaysSelect=o.Tag.render(I||(I=k`
			<div
				class="calendar-sharing__settings-weekdays calendar-sharing__settings-select calendar-sharing__settings-select-arrow"
				title="${0}"
			>
				${0}
			</div>
		`),this.formatWeekdays(false),this.getWeekdaysTitle());o.Event.bind(this.layout.weekdaysSelect,"click",this.onWeekdaysSelectClickHandler.bind(this));this.weekdays=e.map((e=>this.createWeekday(e)));this.weekdaysMenu=new h.Popup({id:`calendar-sharing-settings-weekdays${Date.now()}`,bindElement:this.layout.weekdaysSelect,content:o.Tag.render(O||(O=k`
				<div class="calendar-sharing__settings-popup-weekdays">
					${0}
				</div>
			`),this.weekdays.map((e=>e.render()))),autoHide:true,closeByEsc:true,angle:{position:"top",offset:105},autoHideHandler:()=>this.weekdaysMenu.canBeClosed,events:{onPopupShow:()=>o.Dom.addClass(this.layout.weekdaysSelect,"--active"),onPopupClose:()=>o.Dom.removeClass(this.layout.weekdaysSelect,"--active")}});this.weekdaysMenu.canBeClosed=true;return this.layout.weekdaysSelect}createWeekday(e){return new C({name:e.loc,index:e.index,active:e.active,onSelected:()=>{if(this.rule.weekdays.includes(e.index)){return}this.rule.weekdays.push(e.index);this.rule.weekdays=this.getSortedWeekdays(this.rule.weekdays);this.layout.weekdaysSelect.title=this.formatWeekdays();this.layout.weekdaysSelect.innerText=this.getWeekdaysTitle();this.ruleUpdated()},onDiscarded:()=>{const s=this.rule.weekdays.indexOf(e.index);if(s<0){return}this.rule.weekdays.splice(s,1);this.layout.weekdaysSelect.title=this.formatWeekdays();this.layout.weekdaysSelect.innerText=this.getWeekdaysTitle();this.ruleUpdated()},canBeDiscarded:()=>this.rule.weekdays.length>1,onMouseDown:this.onWeekdayMouseDown.bind(this)})}onWeekdayMouseDown(e,s){this.weekdaysMenu.canBeClosed=false;const t=e.clientX;const i=s.active;this.controllableWeekdays=[];this.collectIntersectedWeekdays=e=>{for(const s of this.weekdays){const i=s.wrap.getBoundingClientRect().right;const a=s.wrap.getBoundingClientRect().left;if(t>i&&e.clientX<i||t<a&&e.clientX>a||a<t&&t<i){if(!this.controllableWeekdays.includes(s)){this.controllableWeekdays.push(s)}s.intersected=true}}};this.onMouseMove=e=>{this.controllableWeekdays.forEach((e=>{e.intersected=false}));this.collectIntersectedWeekdays(e);for(const e of this.controllableWeekdays){if(e.intersected&&i||!e.intersected&&!i){e.select()}else{e.discard()}}};o.Event.bind(document,"mousemove",this.onMouseMove);o.Event.bind(document,"mouseup",(()=>{o.Event.unbind(document,"mousemove",this.onMouseMove);setTimeout((()=>{this.weekdaysMenu.canBeClosed=true}),0)}))}renderTimeFromSelect(){const e=this.formatMinutes(this.rule.from);this.layout.fromTimeSelect=this.renderTimeSelect(e,{isSelected:e=>this.rule.from===e,onItemSelected:e=>{this.rule.from=e;this.updateTo()},getMaxMinutes:()=>24*60-this.getSlotSize()},"calendar-sharing-settings-range-from");return this.layout.fromTimeSelect}renderTimeToSelect(){const e=this.formatMinutes(this.rule.to);this.layout.toTimeSelect=this.renderTimeSelect(e,{isSelected:e=>this.rule.to===e,onItemSelected:e=>{this.rule.to=e},getMinMinutes:()=>this.rule.from+this.getSlotSize()},"calendar-sharing-settings-range-to");return this.layout.toTimeSelect}renderTimeSelect(e,s,t){const i=o.Tag.render(D||(D=k`
			<div
				class="calendar-sharing__settings-select calendar-sharing__settings-time calendar-sharing__settings-select-arrow"
				data-id="${0}"
			>
				${0}
			</div>
		`),t,this.formatAmPmSpan(e));o.Event.bind(i,"click",(()=>this.onTimeSelectClickHandler(i,s)));return i}showTimeMenu(e,s){const t=[];for(let e=0;e<=24;e++){if((!o.Type.isFunction(s.getMinMinutes)||e*60>=s.getMinMinutes())&&(!o.Type.isFunction(s.getMaxMinutes)||e*60<=s.getMaxMinutes())){t.push({minutes:e*60,label:this.formatAmPmSpan(n.Util.formatTime(e,0))})}if(e!==24&&(!o.Type.isFunction(s.getMinMinutes)||e*60+30>=s.getMinMinutes())&&(!o.Type.isFunction(s.getMaxMinutes)||e*60+30<=s.getMaxMinutes())){t.push({minutes:e*60+30,label:this.formatAmPmSpan(n.Util.formatTime(e,30))})}}let i;const a=t.map((t=>({html:o.Tag.render(U||(U=k`
					<div class="calendar-sharing__am-pm-container">${0}</div>
				`),t.label),className:s.isSelected(t.minutes)?"menu-popup-no-icon --selected":"menu-popup-no-icon",onclick:()=>{e.innerHTML=t.label;s.onItemSelected(t.minutes);this.ruleUpdated();i.close()}})));i=h.MenuManager.create({id:`calendar-sharing-settings-time-menu${Date.now()}`,className:"calendar-sharing-settings-time-menu",bindElement:e,items:a,autoHide:true,closeByEsc:true,events:{onShow:()=>o.Dom.addClass(e,"--active"),onClose:()=>o.Dom.removeClass(e,"--active")},maxHeight:300,minWidth:e.offsetWidth});i.show();const l=i.getPopupWindow();const r=l.getContentContainer();const d=r.querySelector(".menu-popup-item.--selected");r.scrollTop=d.offsetTop-d.offsetHeight*2}onWeekdaysSelectClickHandler(){if(this.readOnly){this.showReadOnlyPopup(this.layout.weekdaysSelect)}else{this.weekdaysMenu.show()}}onTimeSelectClickHandler(e,s){if(this.readOnly){this.showReadOnlyPopup(e)}else if(!o.Dom.hasClass(e,"--active")){this.showTimeMenu(e,s)}}formatAmPmSpan(e){return e.toLowerCase().replace(/(am|pm)/g,'<span class="calendar-sharing__settings-time-am-pm">$1</span>')}formatMinutes(e){const s=new Date(n.Util.parseDate("01.01.2000").getTime()+e*60*1e3);return n.Util.formatTime(s)}getWeekdaysTitle(){if([...this.rule.weekdays].sort().toString()===this.workDays.sort().toString()){return o.Loc.getMessage("CALENDAR_SHARING_SETTINGS_WORKDAYS")}return this.formatWeekdays()}formatWeekdays(e=true){if(e&&this.rule.weekdays.length===1){return n.Util.getWeekdaysLoc(true)[this.rule.weekdays[0]]}const s=n.Util.getWeekdaysLoc();return this.rule.weekdays.map((e=>s[e])).reduce(((e,s)=>`${e}, ${s}`))}getSortedWeekdays(e){return e.map((e=>e<this.weekStart?e+10:e)).sort(((e,s)=>e-s)).map((e=>e%10))}}let W=e=>e,x,$,G,j,K,z,X,q,Y;class Q{constructor(e){this.AVAILABLE_INTERVALS=[30,45,60,90,120,180];this.MAX_RANGES=5;this.layout={};this.readOnly=e.readOnly;this.collapsed=!e.readOnly&&e.collapsed;if(!o.Type.isBoolean(e.collapsed)){this.notExpandable=true}this.workTimeStart=e.workTimeStart;this.workTimeEnd=e.workTimeEnd;this.workDays=e.workDays;this.weekStart=e.weekStart;this.rule={slotSize:e.rule.slotSize};this.ranges=[];for(const s of e.rule.ranges){this.ranges.push(this.getRange({...s,show:false}))}if(!o.Type.isArrayFilled(this.ranges)){this.ranges=[this.getRange()]}this.sortRanges();this.updateRanges()}getRule(){const e=this.ranges.map((e=>e.getRule()));e.sort(((e,s)=>this.compareRanges(e,s)));return JSON.parse(JSON.stringify({ranges:e,...this.rule}))}sortRanges(){this.ranges.sort(((e,s)=>this.compareRanges(e.getRule(),s.getRule())))}compareRanges(e,s){const t=this.getWeekdaysWeight(e.weekdays);const i=this.getWeekdaysWeight(s.weekdays);if(t!==i){return t-i}if(e.from!==s.from){return e.from-s.from}return e.to-s.to}getWeekdaysWeight(e){return e.map((e=>e<this.weekStart?e+10:e)).sort(((e,s)=>e-s)).reduce(((e,s,t)=>e+s*10**(10-t)),0)}settingPopupShown(){var e,s;const t=(e=this.ranges.filter((e=>e.settingPopupShown())))!=null?e:[];const i=t.length>0;const a=o.Dom.hasClass(this.layout.slotSizeSelect,"--active");const l=(s=this.readOnlyPopup)==null?void 0:s.isShown();return i||a||l}render(){const e=this.readOnly?"--read-only":"";const s=this.collapsed?"--hide":"";this.layout.wrap=o.Tag.render(x||(x=W`
			<div class="calendar-sharing__settings ${0} ${0}">
				${0}
				${0}
			</div>
		`),e,s,this.renderHeader(),this.renderRule());return this.layout.wrap}renderHeader(){return o.Tag.render($||($=W`
			<div class="calendar-sharing__settings-header-container">
				<div class="calendar-sharing__settings-header">
					<div class="calendar-sharing__settings-title">
						${0}
					</div>
					${0}
				</div>
				<div class="calendar-sharing__settings-header-button">
					${0}
				</div>
			</div>
		`),o.Loc.getMessage("CALENDAR_SHARING_SETTINGS_TITLE_V2"),this.renderSubtitle(),this.renderExpandRuleButton())}renderSubtitle(){this.layout.subtitle=o.Tag.render(G||(G=W`
			<div class="calendar-sharing__settings-subtitle">
				${0}
			</div>
		`),this.getSubtitleText());return this.layout.subtitle}updateSubtitle(){if(!this.layout.subtitle){return}this.layout.subtitle.innerText=this.getSubtitleText()}getSubtitleText(){if(this.isDefaultRule()){return o.Loc.getMessage("CALENDAR_SHARING_SETTINGS_SUBTITLE_DEFAULT")}return o.Loc.getMessage("CALENDAR_SHARING_SETTINGS_SUBTITLE_PERSONAL")}renderExpandRuleButton(){if(this.readOnly||this.notExpandable){return""}this.layout.expandRuleArrow=o.Tag.render(j||(j=W`
			<div class="calendar-sharing__settings-select-arrow ${0}"></div>
		`),this.collapsed?"":"--active");this.layout.expandRuleButton=o.Tag.render(K||(K=W`
			<div class="calendar-sharing__settings-expand">
				${0}
			</div>
		`),this.layout.expandRuleArrow);o.Event.bind(this.layout.expandRuleButton,"click",this.toggle.bind(this));return this.layout.expandRuleButton}renderRule(){this.layout.rule=o.Tag.render(z||(z=W`
			<div class="calendar-sharing__settings-rule">
				${0}
				<div class="calendar-sharing__settings-slotSize">
					<span class="calendar-sharing__settings-slotSize-title">${0}</span>
					${0}
				</div>
			</div>
		`),this.renderRanges(),o.Loc.getMessage("CALENDAR_SHARING_SETTINGS_SLOT_SIZE_V2"),this.getSettingsSlotSizeSelect());return this.layout.rule}toggle(){this.updateRuleHeight();setTimeout((()=>{o.Dom.toggleClass(this.layout.wrap,"--hide");o.Dom.toggleClass(this.layout.expandRuleArrow,"--active");this.updateSharingSettingsCollapsedAction(o.Dom.hasClass(this.layout.wrap,"--hide"))}),0)}updateSharingSettingsCollapsedAction(e){BX.ajax.runAction("calendar.api.sharingajax.updateSharingSettingsCollapsed",{data:{collapsed:e?"Y":"N"}})}renderRanges(){this.ranges.forEach((e=>e.disableAnimation()));const e=o.Tag.render(X||(X=W`
			<div class="calendar-sharing__settings-range-list">
				${0}
			</div>
		`),this.ranges.map((e=>e.render())));if(this.ranges.length===this.MAX_RANGES){this.ranges[0].hideButton()}if(o.Type.isDomNode(this.layout.rangesContainer)){this.layout.rangesContainer.replaceWith(e)}this.layout.rangesContainer=e;return e}getRange(e){var s;const t=(new Date).toDateString();const i=new Date(`${t} ${`${this.workTimeStart}`.replace(".",":")}:00`);const a=new Date(`${t} ${`${this.workTimeEnd}`.replace(".",":")}:00`);const l=((s=this.ranges)==null?void 0:s.length)>=1;return new M({getSlotSize:()=>this.rule.slotSize,from:this.getMinutesFromDate(i),to:this.getMinutesFromDate(a),weekdays:this.workDays,weekStart:this.weekStart,workDays:this.workDays,addRange:e=>this.addRange(e),removeRange:e=>this.removeRange(e),showReadOnlyPopup:e=>this.showReadOnlyPopup(e),ruleUpdated:()=>this.ruleUpdated(),show:l,readOnly:this.readOnly,...e})}addRange(e){if(this.ranges.length>=this.MAX_RANGES){return}const s=this.getRange();this.ranges.push(s);e.getWrap().after(s.render());this.updateRanges()}removeRange(e){if(this.ranges.length<=1){return false}this.ranges=this.ranges.filter((s=>s!==e));this.updateRanges();return true}getSettingsSlotSizeSelect(){this.layout.slotSizeText=o.Tag.render(q||(q=W`
			<span class="calendar-sharing__settings-select-link">
				${0}
			</span>
		`),n.Util.formatDuration(this.rule.slotSize));this.layout.slotSizeSelect=o.Tag.render(Y||(Y=W`
			<span class="calendar-sharing__settings-select-arrow --small-arrow">
				${0}
			</span>
		`),this.layout.slotSizeText);o.Event.bind(this.layout.slotSizeSelect,"click",this.slotSizeSelectClickHandler.bind(this));const e=this.AVAILABLE_INTERVALS.map((e=>({text:n.Util.formatDuration(e),onclick:()=>{this.rule.slotSize=e;this.layout.slotSizeText.innerHTML=n.Util.formatDuration(this.rule.slotSize);this.slotSizeMenu.close();this.updateRanges()}})));this.slotSizeMenu=h.MenuManager.create({id:`calendar-sharing-settings-slotSize${Date.now()}`,bindElement:this.layout.slotSizeSelect,items:e,closeByEsc:true,events:{onShow:()=>o.Dom.addClass(this.layout.slotSizeSelect,"--active"),onClose:()=>o.Dom.removeClass(this.layout.slotSizeSelect,"--active")}});return this.layout.slotSizeSelect}updateRanges(){for(const e of this.ranges.slice(0,-1)){e.setDeletable(true);e.update()}const e=this.ranges.slice(-1)[0];e.setDeletable(this.ranges.length===5);e.update();this.ruleUpdated()}ruleUpdated(){this.updateSubtitle();this.removeRuleHeight()}updateRuleHeight(){o.Dom.style(this.layout.rule,"height",`${this.calculateRuleHeight()}px`)}calculateRuleHeight(){const e=10;const s=2;const t=e+s;const i=15;const a=45;return a*this.ranges.length+(t+i)}removeRuleHeight(){o.Dom.style(this.layout.rule,"height",null)}slotSizeSelectClickHandler(){if(this.readOnly){this.showReadOnlyPopup(this.layout.slotSizeSelect)}else{this.slotSizeMenu.show()}}showReadOnlyPopup(e){this.closeReadOnlyPopup();this.getReadOnlyPopup(e).show()}getReadOnlyPopup(e){this.readOnlyPopup=new h.Popup({bindElement:e,className:"calendar-sharing__settings-read-only-hint",content:o.Loc.getMessage("CALENDAR_SHARING_SETTINGS_READ_ONLY_HINT"),angle:{offset:0},width:300,offsetLeft:e.offsetWidth/2,darkMode:true,autoHide:true});o.Event.bind(this.readOnlyPopup.popupContainer,"click",(()=>this.closeReadOnlyPopup()));clearTimeout(this.closePopupTimeout);this.closePopupTimeout=setTimeout((()=>this.closeReadOnlyPopup()),3e3);return this.readOnlyPopup}closeReadOnlyPopup(){var e;(e=this.readOnlyPopup)==null?void 0:e.destroy()}getMinutesFromDate(e){const s=n.Util.parseTime(a.DateTimeFormat.format(a.DateTimeFormat.getFormat("SHORT_TIME_FORMAT"),e/1e3));return s.h*60+s.m}isDefaultRule(){return!this.isDifferentFrom(this.getDefaultRule())}isDifferentFrom(e){return!this.objectsEqual(e,this.getRule())}getChanges(){const e=this.getDefaultRule();const s=this.getRule();const t=s.slotSize!==e.slotSize;const i=JSON.stringify(s.ranges)!==JSON.stringify(e.ranges);const a=[];if(i){a.push(l.Analytics.ruleChanges.custom_days)}if(t){a.push(l.Analytics.ruleChanges.custom_length)}return a}getDefaultRule(){return{slotSize:60,ranges:[this.getRange().getRule()]}}objectsEqual(e,s){return JSON.stringify(this.sortKeys(e))===JSON.stringify(this.sortKeys(s))}sortKeys(e){return Object.keys(e).sort().reduce(((s,t)=>{s[t]=e[t];return s}),{})}}let J=e=>e,V;var Z=babelHelpers.classPrivateFieldLooseKey("bindElement");var ee=babelHelpers.classPrivateFieldLooseKey("layout");var se=babelHelpers.classPrivateFieldLooseKey("popup");class te{constructor(e){Object.defineProperty(this,Z,{writable:true,value:void 0});Object.defineProperty(this,ee,{writable:true,value:void 0});Object.defineProperty(this,se,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e.bindElement;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]={};babelHelpers.classPrivateFieldLooseBase(this,se)[se]=new h.Popup({bindElement:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z],bindOptions:{position:"top"},angle:{offset:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].offsetWidth/2+24},borderRadius:"24px",width:425,content:this.getContent(),animation:"fading-slide"})}getContent(){if(!babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].wrapper){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].wrapper=o.Tag.render(V||(V=J`
				<div class="calendar-sharing__user-selector-hint-wrapper">
					<div class="calendar-sharing__user-selector-hint-text-wrapper">
						<div class="calendar-sharing__user-selector-hint-text-title">
							${0}
						</div>
						<div class="calendar-sharing__user-selector-hint-text-desc">
							${0}
						</div>
					</div>
					<div class="calendar-sharing__user-selector-hint-icon"></div>
				</div>
			`),o.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_HINT_TITLE"),o.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_HINT_DESC"))}return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].wrapper}show(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,se)[se])==null?void 0:e.show()}close(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,se)[se])==null?void 0:e.close()}}let ie=e=>e,ae,le,re,oe,ne,de;var he=babelHelpers.classPrivateFieldLooseKey("layout");var ce=babelHelpers.classPrivateFieldLooseKey("userSelectorDialog");var ue=babelHelpers.classPrivateFieldLooseKey("selectedEntityList");var pe=babelHelpers.classPrivateFieldLooseKey("selectedEntityNodeList");var be=babelHelpers.classPrivateFieldLooseKey("defaultUserEntity");var ge=babelHelpers.classPrivateFieldLooseKey("isOpened");var ve=babelHelpers.classPrivateFieldLooseKey("onMembersAdded");class Le{constructor(e={}){Object.defineProperty(this,he,{writable:true,value:void 0});Object.defineProperty(this,ce,{writable:true,value:void 0});Object.defineProperty(this,ue,{writable:true,value:void 0});Object.defineProperty(this,pe,{writable:true,value:void 0});Object.defineProperty(this,be,{writable:true,value:void 0});Object.defineProperty(this,ge,{writable:true,value:void 0});Object.defineProperty(this,ve,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,he)[he]={};babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=null;babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]={};babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]={};babelHelpers.classPrivateFieldLooseBase(this,be)[be]=e.userInfo||{};babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]=false;babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=e.onMembersAdded;this.openEntitySelector=this.openEntitySelector.bind(this)}render(){if(!babelHelpers.classPrivateFieldLooseBase(this,he)[he].wrapper){babelHelpers.classPrivateFieldLooseBase(this,he)[he].wrapper=o.Tag.render(ae||(ae=ie`
				<div class="calendar-sharing__user-selector-main">
					<div class="calendar-sharing__user-selector-title">
						${0}
					</div>
					${0}
				</div>
			`),this.renderTitle(),this.renderUserSelectorWrapper())}return babelHelpers.classPrivateFieldLooseBase(this,he)[he].wrapper}renderTitle(){if(!babelHelpers.classPrivateFieldLooseBase(this,he)[he].title){babelHelpers.classPrivateFieldLooseBase(this,he)[he].title=o.Tag.render(le||(le=ie`
				<div class="calendar-sharing__user-selector-title-text">
					${0}
				</div>
			`),o.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_TITLE_V2"));const e=babelHelpers.classPrivateFieldLooseBase(this,he)[he].title.querySelector('[ data-role="calendar-sharing_popup-joint-slots"]');if(e){let s;let t;o.Event.bind(e,"mouseenter",(()=>{t=setTimeout((()=>{if(!s){s=new te({bindElement:e})}s.show()}),1e3)}));o.Event.bind(e,"mouseleave",(()=>{clearTimeout(t);if(s){s.close()}}))}}return babelHelpers.classPrivateFieldLooseBase(this,he)[he].title}renderUserSelectorWrapper(){if(!babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelectorWrapper){babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelectorWrapper=o.Tag.render(re||(re=ie`
				<div class="calendar-sharing__user-selector-wrapper">
					${0}
					<div class="calendar-sharing__user-selector-add">
				</div>
			`),this.renderUserSelector());o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelectorWrapper,"click",this.openEntitySelector)}return babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelectorWrapper}renderUserSelector(){if(!babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelector){const e=this.getDefaultEntityNode();babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelector=o.Tag.render(oe||(oe=ie`
				<div class="calendar-sharing__user-selector-container" data-id="calendar-sharing-members">
					${0}
				</div>
			`),e)}return babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelector}getDefaultEntityNode(){const e=this.renderUserEntity(babelHelpers.classPrivateFieldLooseBase(this,be)[be]);const s=this.getEntityKey(babelHelpers.classPrivateFieldLooseBase(this,be)[be].id);babelHelpers.classPrivateFieldLooseBase(this,ue)[ue][s]=babelHelpers.classPrivateFieldLooseBase(this,be)[be];babelHelpers.classPrivateFieldLooseBase(this,pe)[pe][s]=e;return e}renderUserEntity(e){if(this.hasAvatar(e.avatar)){return o.Tag.render(ne||(ne=ie`
				<div class="calendar-sharing__user-selector-entity-container">
					<img class="calendar-sharing__user-selector-entity" title="${0}" src="${0}" alt="">
				</div>
			`),o.Text.encode(e.name),e.avatar)}return o.Tag.render(de||(de=ie`
			<div class="ui-icon ui-icon-common-user calendar-sharing__user-selector-entity" title="${0}"><i></i></div>
		`),o.Text.encode(e==null?void 0:e.name))}hasAvatar(e){return e&&e!=="/bitrix/images/1.gif"}openEntitySelector(){if(!babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelector){return}const e=["user",babelHelpers.classPrivateFieldLooseBase(this,be)[be].id];if(!babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]){babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=new r.Dialog({width:340,targetNode:babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelector,context:"CALENDAR_SHARING",preselectedItems:[e],enableSearch:true,zIndex:4200,events:{"Item:onSelect":e=>{this.onUserSelectorSelect(e)},"Item:onDeselect":e=>{this.onUserSelectorDeselect(e)},onHide:()=>{if(this.hasChanges()){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]()}}},entities:[{id:"user",options:{intranetUsersOnly:true,emailUsers:false,inviteEmployeeLink:false,inviteGuestLink:false},filters:[{id:"calendar.jointSharingFilter"}]}]})}babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].show()}isUserSelectorDialogOpened(){if(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]){return babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].isOpen()}return false}onUserSelectorSelect(e){var s;const t=e.data.item;const i={id:t.id,avatar:t.avatar,name:`${t.customData.get("name")} ${(s=t.customData.get("lastName"))!=null?s:""}`.trim()};const a=this.renderUserEntity(i);if(babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelector){o.Dom.append(a,babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelector)}const l=this.getEntityKey(i.id);babelHelpers.classPrivateFieldLooseBase(this,ue)[ue][l]=i;babelHelpers.classPrivateFieldLooseBase(this,pe)[pe][l]=a}onUserSelectorDeselect(e){const s=e.data.item;const t=this.getEntityKey(s.id);const i=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe][t];if(i){o.Dom.remove(i);delete babelHelpers.classPrivateFieldLooseBase(this,ue)[ue][t];delete babelHelpers.classPrivateFieldLooseBase(this,pe)[pe][t]}}clearSelectedUsers(){if(babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelector){o.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelector);babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]={};babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]={};const e=this.getDefaultEntityNode();o.Dom.append(e,babelHelpers.classPrivateFieldLooseBase(this,he)[he].userSelector)}if(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]){babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].destroy();babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=null}}hasChanges(){return this.getPeopleCount()>1}getPeopleCount(){return Object.keys(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]).length}getSelectedUserIdList(){const e=[];Object.values(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]).forEach((s=>{e.push(s.id)}));return e}getEntityKey(e){return`user-${e}`}}let Pe=e=>e,_e,Be,me,Se,ye,He,Te,Fe,we,fe;const Ee=4;var Ce=babelHelpers.classPrivateFieldLooseKey("props");var ke=babelHelpers.classPrivateFieldLooseKey("layout");var Ae=babelHelpers.classPrivateFieldLooseKey("avatarPopup");var Ne=babelHelpers.classPrivateFieldLooseKey("deletePopup");class Re{constructor(e){Object.defineProperty(this,Ce,{writable:true,value:void 0});Object.defineProperty(this,ke,{writable:true,value:void 0});Object.defineProperty(this,Ae,{writable:true,value:void 0});Object.defineProperty(this,Ne,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=e;babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]={};babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]=null;babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]=null;this.openAvatarList=this.openAvatarList.bind(this);this.onCopyButtonClick=this.onCopyButtonClick.bind(this);this.onDeleteButtonClick=this.onDeleteButtonClick.bind(this)}render(){if(!babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].wrapper){babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].wrapper=o.Tag.render(_e||(_e=Pe`
				<div class="calendar-sharing__dialog-link-list-item">
					${0}
					${0}
					${0}
					${0}
				</div>
			`),this.renderAvatarContainer(),this.renderDate(),this.renderCopyButton(),this.renderDeleteButton())}return babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].wrapper}renderAvatarContainer(){if(!babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].avatarContainer){const e=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].members.length>Ee;const s=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].members.length-Ee;babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].avatarContainer=o.Tag.render(Be||(Be=Pe`
				<div class="calendar-sharing__dialog-link-list-item-avatar-container">
					${0}
					${0}
					${0}
				</div>
			`),this.renderAvatar(babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].userInfo),babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].members.slice(0,Ee).map((e=>this.renderAvatar(e))),e?this.renderMore(s):null);o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].avatarContainer,"click",this.openAvatarList)}return babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].avatarContainer}renderAvatar(e){var s;const t=`${e.name} ${(s=e.lastName)!=null?s:""}`.trim();if(this.hasAvatar(e.avatar)){return o.Tag.render(me||(me=Pe`
				<img class="calendar-sharing__dialog-link-list-item-avatar" title="${0}" alt="" src="${0}">
			`),o.Text.encode(t),e.avatar)}return o.Tag.render(Se||(Se=Pe`
			<div class="ui-icon ui-icon-common-user calendar-sharing__dialog-link-list-item-avatar" title="${0}"><i></i></div>
		`),o.Text.encode(t))}hasAvatar(e){return e&&e!=="/bitrix/images/1.gif"}renderMore(e){return o.Tag.render(ye||(ye=Pe`
			<div class="calendar-sharing__dialog-link-list-item-more">
				<div class="calendar-sharing__dialog-link-list-item-more-text">${0}</div>
			</div>
		`),"+"+e)}openAvatarList(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]){const e=BX.util.getRandomString(6);babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]=h.MenuManager.create({id:"calendar-sharing-dialog_"+e,bindElement:babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].avatarContainer,bindOptions:{position:"top"},autoHide:true,closeByEsc:true,className:"calendar-sharing__dialog-link-list-user-popup-container",items:this.getAvatarPopupItems(),maxHeight:250,maxWidth:300});babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].getPopupWindow().subscribe("onClose",(()=>{this.setPopupState(false)}));const s=babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].getMenuContainer();let t;o.Event.bind(s,"mouseleave",(()=>{clearTimeout(t);t=setTimeout((()=>{this.closeAvatarList()}),500)}));o.Event.bind(s,"mouseenter",(()=>{clearTimeout(t)}))}babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].show();this.setPopupState(true)}closeAvatarList(){if(babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]){babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].close()}}getAvatarPopupItems(){const e=[];e.push(this.getAvatarPopupItem(babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].userInfo));babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].members.forEach((s=>{e.push(this.getAvatarPopupItem(s))}));return e}getAvatarPopupItem(e){var s;const t=e.avatar;const i=`${e.name} ${(s=e.lastName)!=null?s:""}`.trim();const a=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].pathToUser.replace("#USER_ID#",e.id);return{html:o.Tag.render(He||(He=Pe`
				<a href="${0}" target="_blank" class="calendar-sharing__dialog-link-list-user-popup-item">
					<span class="ui-icon ui-icon-common-user calendar-sharing__dialog-link-list-user-popup-item-avatar">
						<i style="${0}"></i>
					</span>
					<div class="calendar-sharing__dialog-link-list-user-popup-item-text">
						${0}
					</div>
				</a>
			`),a,this.hasAvatar(t)?`background-image: url('${t}')`:"",o.Text.encode(i))}}renderDate(){if(!babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].date){const e=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].dateCreate?new Date(babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].dateCreate):new Date;const s=n.Util.formatDate(e);babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].date=o.Tag.render(Te||(Te=Pe`
				<div class="calendar-sharing__dialog-link-list-item-date" title="${0}">${0}</div>
			`),o.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_DATE_CREATE"),s)}return babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].date}renderCopyButton(){if(!babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].copyButton){const e=new d.Icon({icon:d.Main.LINK_3,size:14});babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].copyButton=o.Tag.render(Fe||(Fe=Pe`
				<div class="calendar-sharing__dialog-link-list-item-copy-container">
					${0}
					<div class="calendar-sharing__dialog-link-list-item-copy-text">${0}</div>
				</div>
			`),e.render(),o.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_COPY"));o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].copyButton,"click",this.onCopyButtonClick)}return babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].copyButton}onCopyButtonClick(){p.EventEmitter.emit("CalendarSharing:onJointLinkCopy",{id:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].id,shortUrl:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].shortUrl,hash:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].hash,members:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].members})}renderDeleteButton(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].members.length){return o.Tag.render(we||(we=Pe`<div class="calendar-sharing__dialog-link-list-item-delete"></div>`))}if(!babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].deleteButton){const e=new d.Icon({icon:d.Actions.CROSS_30,size:18});babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].deleteButton=o.Tag.render(fe||(fe=Pe`
				<div class="calendar-sharing__dialog-link-list-item-delete">
					${0}
				</div>
			`),e.render());o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].deleteButton,"click",this.onDeleteButtonClick)}return babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].deleteButton}onDeleteButtonClick(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]){babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]=new c.MessageBox({title:o.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_DELETE_MESSAGE_TITLE_MSGVER_1"),message:o.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_DELETE_MESSAGE_DESC_MSGVER_1"),buttons:this.getDeletePopupButtons(),popupOptions:{autoHide:true,closeByEsc:true,draggable:false,closeIcon:true,minWidth:365,maxWidth:385,minHeight:180}})}babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne].show();this.setPopupState(true)}getDeletePopupButtons(){return[new u.Button({size:u.ButtonSize.MEDIUM,color:u.ButtonColor.DANGER,text:o.Loc.getMessage("SHARING_WARNING_POPUP_SUBMIT_BUTTON_NEW_MSGVER_1"),events:{click:()=>{this.deleteLink();babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne].close();this.setPopupState(false)}}}),new u.Button({size:u.ButtonSize.MEDIUM,color:u.ButtonColor.LIGHT_BORDER,text:o.Loc.getMessage("SHARING_WARNING_POPUP_CANCEL_BUTTON"),events:{click:()=>{babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne].close();this.setPopupState(false)}}})]}deleteLink(){if(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].wrapper){BX.ajax.runAction("calendar.api.sharingajax.disableUserLink",{data:{hash:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].hash}});o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].wrapper,"--animate-delete");setTimeout((()=>{o.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke].wrapper)}),300);p.EventEmitter.emit("CalendarSharing:onJointLinkDelete",{id:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].id})}}setPopupState(e){var s;(s=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce])==null?void 0:s.setListItemPopupState(e)}}let Ie=e=>e,Oe,De,Ue,Me,We,xe,$e,Ge;const je=300;const Ke=45;var ze=babelHelpers.classPrivateFieldLooseKey("props");var Xe=babelHelpers.classPrivateFieldLooseKey("layout");var qe=babelHelpers.classPrivateFieldLooseKey("linkList");var Ye=babelHelpers.classPrivateFieldLooseKey("popupOpenState");var Qe=babelHelpers.classPrivateFieldLooseKey("sortByFrequentUse");var Je=babelHelpers.classPrivateFieldLooseKey("pathToUser");class Ve{constructor(e){Object.defineProperty(this,ze,{writable:true,value:void 0});Object.defineProperty(this,Xe,{writable:true,value:void 0});Object.defineProperty(this,qe,{writable:true,value:void 0});Object.defineProperty(this,Ye,{writable:true,value:false});Object.defineProperty(this,Qe,{writable:true,value:true});Object.defineProperty(this,Je,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=e;babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]={};babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]=null;babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=null;this.getLinkListInfo();this.setListItemPopupState=this.setListItemPopupState.bind(this);this.eventSubscribe()}eventSubscribe(){p.EventEmitter.subscribe("CalendarSharing:onJointLinkCopy",(e=>{this.onJointLinkCopy(e)}));p.EventEmitter.subscribe("CalendarSharing:onJointLinkDelete",(e=>{this.onJointLinkDelete(e)}))}getLinkListInfo(){BX.ajax.runAction("calendar.api.sharingajax.getAllUserLink").then((e=>{if(e&&e.data){babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]=e.data.userLinks;babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=e.data.pathToUser;this.updateLinkList();if(this.isListEmpty()){this.hideSortingButton();return}if(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]){this.showSortingButton()}}}))}render(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].wrapper){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].wrapper=o.Tag.render(Oe||(Oe=Ie`
				<div class="calendar-sharing__dialog-link-list-wrapper">
					${0}
					${0}
				</div>
			`),this.getTitleNode(),this.getListNode())}return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].wrapper}getTitleNode(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].title){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].title=o.Tag.render(De||(De=Ie`
				<div class="calendar-sharing__dialog-link-list-title-wrapper">
					<div class="calendar-sharing__dialog-link-list-title">
						${0}
						<div class="calendar-sharing__dialog-link-list-title-text">
							${0}
						</div>
					</div>
					${0}
				</div>
			`),this.getChevronBackIcon(),o.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_TITLE"),this.getSortingButton())}return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].title}getChevronBackIcon(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].backButton){const e=new d.Icon({icon:d.Actions.CHEVRON_LEFT,size:24});babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].backButton=o.Tag.render(Ue||(Ue=Ie`
				<div class="calendar-sharing__dialog-link-list-back-button">
					${0}
				</div>
			`),e.render());o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].backButton,"click",this.close.bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].backButton}getSortingButton(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButton){const e=new d.Icon({icon:d.Actions.SORT,size:14,color:"#2066b0"});babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButton=o.Tag.render(Me||(Me=Ie`
				<div class="calendar-sharing__dialog-link-list-sorting-button">
					${0}
					${0}
				</div>
			`),e.render(),this.getSortingButtonText());o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButton,"click",this.changeListSort.bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButton}getSortingButtonText(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButtonText){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButtonText=o.Tag.render(We||(We=Ie`
				<div class="calendar-sharing__dialog-link-list-sorting-button-text">
					${0}
				</div>
			`),o.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_SORT_RECENT"))}return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButtonText}getListNode(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].list){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].list=o.Tag.render(xe||(xe=Ie`
				<div class="calendar-sharing__dialog-link-list-container">
					${0}
				</div>
			`),this.getListItemsNode())}return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].list}getListItemsNode(){if(this.isListEmpty()){return this.getEmptyStateNode()}const e=this.getListItems();return o.Tag.render($e||($e=Ie`
			<div class="calendar-sharing__dialog-link-list">
				${0}
			</div>
		`),e.map((e=>e.render())))}getEmptyStateNode(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].emptyState){babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].emptyState=o.Tag.render(Ge||(Ge=Ie`
				<div class="calendar-sharing__dialog-link-list-empty-state-wrapper">
					<div class="calendar-sharing__dialog-link-list-empty-state-icon"></div>
					<div class="calendar-sharing__dialog-link-list-empty-state-text">${0}</div>
				</div>
			`),o.Loc.getMessage("CALENDAR_SHARING_LIST_EMPTY_TITLE"))}return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].emptyState}getListItems(){if(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]){return this.getSortedByFrequentUseListItems()}return this.getSortedByDateListItems()}getSortedByFrequentUseListItems(){return Object.values(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]).sort(((e,s)=>{if(e.frequentUse>s.frequentUse){return-1}if(e.frequentUse<s.frequentUse){return 1}if(e.id>s.id){return-1}if(e.id<s.id){return 1}return 0})).map((e=>new Re({...e,userInfo:babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].userInfo,pathToUser:babelHelpers.classPrivateFieldLooseBase(this,Je)[Je],setListItemPopupState:this.setListItemPopupState})))}getSortedByDateListItems(){return Object.keys(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]).sort(((e,s)=>s-e)).map((e=>new Re({...babelHelpers.classPrivateFieldLooseBase(this,qe)[qe][e],userInfo:babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].userInfo,pathToUser:babelHelpers.classPrivateFieldLooseBase(this,Je)[Je],setListItemPopupState:this.setListItemPopupState})))}show(e){if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].list&&e){o.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].list,"max-height",`${e-Ke}px`)}if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].wrapper){o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].wrapper,"--show")}}close(){if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].list){o.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].list,"max-height",`${je}px`)}if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].wrapper){o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].wrapper,"--show")}if(babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].onLinkListClose){babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].onLinkListClose()}}updateLinkList(){if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].list){o.Dom.clean(this.getListNode());const e=this.getListItemsNode();o.Dom.append(e,babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].list)}}changeListSort(){babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]=!babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe];const e=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]?o.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_SORT_RECENT"):o.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_SORT_DATE");if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButtonText){o.Dom.adjust(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButtonText,{text:e})}this.updateLinkList()}setListItemPopupState(e){babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=e}isOpenListItemPopup(){return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]}onJointLinkCopy(e){const s=e.data.id;const t=e.data.hash;setTimeout((()=>{if(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe][s]){babelHelpers.classPrivateFieldLooseBase(this,qe)[qe][s].frequentUse=babelHelpers.classPrivateFieldLooseBase(this,qe)[qe][s].frequentUse+1;this.updateLinkList()}}),1e3);BX.ajax.runAction("calendar.api.sharingajax.increaseFrequentUse",{data:{hash:t}})}onJointLinkDelete(e){const s=e.data.id;if(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe][s]){delete babelHelpers.classPrivateFieldLooseBase(this,qe)[qe][s]}if(this.isListEmpty()){this.updateLinkList();this.hideSortingButton()}}isListEmpty(){return o.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe])||o.Type.isArray(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe])&&!o.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe])||o.Type.isObject(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe])&&!Object.keys(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]).length}hideSortingButton(){if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButton){o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButton,"--hide")}}showSortingButton(){if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButton){o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe].sortingButton,"--hide")}}}let Ze=e=>e,es,ss,ts,is,as,ls,rs;var os=babelHelpers.classPrivateFieldLooseKey("popup");var ns=babelHelpers.classPrivateFieldLooseKey("layout");var ds=babelHelpers.classPrivateFieldLooseKey("dialogQr");var hs=babelHelpers.classPrivateFieldLooseKey("context");var cs=babelHelpers.classPrivateFieldLooseKey("settings");var us=babelHelpers.classPrivateFieldLooseKey("calendarContext");var ps=babelHelpers.classPrivateFieldLooseKey("crmContext");var bs=babelHelpers.classPrivateFieldLooseKey("settingsControl");var gs=babelHelpers.classPrivateFieldLooseKey("userSelectorControl");var vs=babelHelpers.classPrivateFieldLooseKey("linkList");class Ls{constructor(e){var s,t,i;this.HELP_DESK_CODE_CALENDAR=17198666;this.HELP_DESK_CODE_CRM=17502612;Object.defineProperty(this,os,{writable:true,value:void 0});Object.defineProperty(this,ns,{writable:true,value:void 0});Object.defineProperty(this,ds,{writable:true,value:void 0});Object.defineProperty(this,hs,{writable:true,value:void 0});Object.defineProperty(this,cs,{writable:true,value:void 0});Object.defineProperty(this,us,{writable:true,value:"calendar"});Object.defineProperty(this,ps,{writable:true,value:"crm"});Object.defineProperty(this,bs,{writable:true,value:void 0});Object.defineProperty(this,gs,{writable:true,value:void 0});Object.defineProperty(this,vs,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,os)[os]=null;babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]=null;babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]={wrapper:null,contentWrapper:null,contentTop:null,contentBody:null,contentBottom:null,listWrapper:null,buttonCopy:null,buttonHistory:null,buttonWhatSeeUsers:null};babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]=e.context;babelHelpers.classPrivateFieldLooseBase(this,bs)[bs]=null;babelHelpers.classPrivateFieldLooseBase(this,gs)[gs]=null;babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]=null;const a=new Set(e.calendarSettings.weekHolidays.map((e=>n.Util.getIndByWeekDay(e))));babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]={readOnly:(s=e.readOnly)!=null?s:false,rule:{slotSize:(t=e.sharingRule.slotSize)!=null?t:60,ranges:(i=e.sharingRule.ranges)!=null?i:[]},weekStart:n.Util.getIndByWeekDay(e.calendarSettings.weekStart),workDays:[0,1,2,3,4,5,6].filter((e=>!a.has(e))),workTimeStart:e.calendarSettings.workTimeStart,workTimeEnd:e.calendarSettings.workTimeEnd,collapsed:e.settingsCollapsed};this.bindElement=e.bindElement||null;this.sharingUrl=e.sharingUrl||null;this.linkHash=e.linkHash;this.userInfo=e.userInfo||null;this.onPopupClose=this.onPopupClose.bind(this);this.onCopyButtonClick=this.onCopyButtonClick.bind(this);p.EventEmitter.subscribe("CalendarSharing:onJointLinkCopy",(e=>{const s=e.data.shortUrl;if(this.copyLink(s)){this.onSuccessfulCopyingLink()}l.Analytics.sendLinkCopiedList(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs],{peopleCount:e.data.members.length+1,ruleChanges:babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].getChanges()})}));this.bindEvents()}bindEvents(){o.Event.bind(window,"beforeunload",this.saveSharingRule.bind(this))}getPopup(){if(!babelHelpers.classPrivateFieldLooseBase(this,os)[os]){babelHelpers.classPrivateFieldLooseBase(this,os)[os]=new h.Popup({bindElement:this.bindElement,className:"calendar-sharing__dialog",closeByEsc:true,autoHide:true,padding:0,width:470,angle:{offset:this.bindElement.offsetWidth/2+16},autoHideHandler:e=>this.canBeClosed(e),content:this.getPopupWrapper(),animation:"fading-slide",events:{onPopupShow:this.onPopupShow.bind(this),onPopupClose:this.onPopupClose.bind(this)}})}return babelHelpers.classPrivateFieldLooseBase(this,os)[os]}onPopupShow(){o.Dom.addClass(this.bindElement,"ui-btn-hover");l.Analytics.sendPopupOpened(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs])}onPopupClose(){o.Dom.removeClass(this.bindElement,"ui-btn-hover");this.saveSharingRule();this.clearSelectedUsers();this.closeLinkList()}canBeClosed(e){var s,t,i;const a=babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].wrapper.contains(e.target);const l=(s=babelHelpers.classPrivateFieldLooseBase(this,ds)[ds])==null?void 0:s.isShown();const r=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].settingPopupShown();const o=(t=babelHelpers.classPrivateFieldLooseBase(this,gs)[gs])==null?void 0:t.isUserSelectorDialogOpened();const d=(i=babelHelpers.classPrivateFieldLooseBase(this,vs)[vs])==null?void 0:i.isOpenListItemPopup();const h=babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]===babelHelpers.classPrivateFieldLooseBase(this,us)[us]?n.Util.getBX().SidePanel.Instance.getTopSlider():false;return!a&&!l&&!r&&!o&&!d&&!h}getDialogQr(){if(!babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]){babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]=new w({sharingUrl:this.sharingUrl,context:babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]})}return babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]}getPopupWrapper(){if(!babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].wrapper){babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].wrapper=o.Tag.render(es||(es=Ze`
				<div class="calendar-sharing__dialog-wrapper">
					${0}
					${0}
				</div>
			`),this.getPopupContentMain(),this.getPopupContentList())}return babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].wrapper}getPopupContentMain(){if(!babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentWrapper){babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentWrapper=o.Tag.render(ss||(ss=Ze`
				<div class="calendar-sharing__dialog-content-wrapper --show">
					${0}
						<div class="calendar-sharing__dialog-body">
							<div class="calendar-sharing__dialog-message">
								<div class="calendar-sharing__dialog-info-icon-container">
									<div class="calendar-sharing__dialog-info-icon"></div>
								</div>
								<div class="calendar-sharing__dialog-notify" onclick="${0}">
									${0}
								</div>
							</div>
							${0}
							${0}
						</div>
					${0}
				</div>
			`),this.getPopupContentTop(),this.onOpenLink.bind(this),o.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_4_V3",{"#LINK#":this.sharingUrl}),this.getSettingsNode(),this.getUserSelectorNode(),this.getPopupContentBottom())}return babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentWrapper}getPopupContentList(){if(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]===babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]){return}if(!babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]){babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]=new Ve({userInfo:this.userInfo,onLinkListClose:this.onLinkListClose.bind(this)})}return babelHelpers.classPrivateFieldLooseBase(this,vs)[vs].render()}getPopupCopyLinkButton(){if(!babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonCopy){babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonCopy=o.Tag.render(ts||(ts=Ze`
				<span class="ui-btn ui-btn-success ui-btn-round ui-btn-no-caps calendar-sharing__dialog-copy">
					${0}
				</span>
			`),o.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_COPY_LINK_BUTTON"));o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonCopy,"click",this.onCopyButtonClick)}return babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonCopy}getPopupLinkHistoryButton(){if(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]===babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]){return}if(!babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonHistory){babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonHistory=o.Tag.render(is||(is=Ze`
				<span
					class="ui-btn ui-btn-round ui-btn-light ui-btn-no-caps calendar-sharing__dialog-people"
					data-id="calendar-sharing-history-btn"
				>
					${0}
				</span>
			`),o.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_JOINT_SLOTS_BUTTON"));o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonHistory,"click",this.openLinkList.bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonHistory}getPopupWhatSeeUsersButton(){if(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]===babelHelpers.classPrivateFieldLooseBase(this,us)[us]){return}if(!babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonWhatSeeUsers){const e=()=>{this.saveSharingRule();this.getDialogQr().show()};babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonWhatSeeUsers=o.Tag.render(as||(as=Ze`
				<span onclick="${0}" class="calendar-sharing__dialog-link">
					${0}
				</span>
			`),e,o.Loc.getMessage("SHARING_INFO_POPUP_WHAT_SEE_USERS"));o.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonWhatSeeUsers,"click",e)}return babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonWhatSeeUsers}onCopyButtonClick(){var e,s;const t={peopleCount:(e=(s=babelHelpers.classPrivateFieldLooseBase(this,gs)[gs])==null?void 0:s.getPeopleCount())!=null?e:1,ruleChanges:babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].getChanges()};if(babelHelpers.classPrivateFieldLooseBase(this,gs)[gs]&&babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].hasChanges()){l.Analytics.sendLinkCopied(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs],l.Analytics.linkTypes.multiple,t);this.saveJointLink()}else if(this.copyLink(this.sharingUrl)){l.Analytics.sendLinkCopied(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs],l.Analytics.linkTypes.solo,t);if(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]===babelHelpers.classPrivateFieldLooseBase(this,us)[us]){BX.ajax.runAction("calendar.api.sharingajax.increaseFrequentUse",{data:{hash:this.linkHash}})}this.onSuccessfulCopyingLink()}}async saveJointLink(){if(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonCopy&&o.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonCopy,"ui-btn-clock")){return}o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonCopy,"ui-btn-clock");const e=babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].getSelectedUserIdList();const s=await BX.ajax.runAction("calendar.api.sharingajax.generateUserJointSharingLink",{data:{memberIds:e}});if(s&&s.data){var t;o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].buttonCopy,"ui-btn-clock");const{url:e}=s.data;if(this.copyLink(e)){this.onSuccessfulCopyingLink()}(t=babelHelpers.classPrivateFieldLooseBase(this,vs)[vs])==null?void 0:t.getLinkListInfo()}}clearSelectedUsers(){if(babelHelpers.classPrivateFieldLooseBase(this,gs)[gs]){babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].clearSelectedUsers()}}openLinkList(){if(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentWrapper&&babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]){o.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentWrapper,"--show");babelHelpers.classPrivateFieldLooseBase(this,vs)[vs].show(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentWrapper.offsetHeight)}}closeLinkList(){if(babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]){setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,vs)[vs].close()}),200)}}onLinkListClose(){if(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentWrapper){o.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentWrapper,"--show")}}copyLink(e){if(!e){return}const s=BX.clipboard.copy(e);if(s){n.Util.showNotification(o.Loc.getMessage("SHARING_COPY_LINK_NOTIFICATION"));p.EventEmitter.emit("CalendarSharing:LinkCopied")}return s}async onOpenLink(){await this.saveSharingRule();window.open(this.sharingUrl,"_blank").focus()}onSuccessfulCopyingLink(){this.getPopup().close()}getSettingsNode(){babelHelpers.classPrivateFieldLooseBase(this,bs)[bs]=new Q(babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]);babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].rule=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].getRule();return babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].render()}getUserSelectorNode(){if(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]===babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]){return}babelHelpers.classPrivateFieldLooseBase(this,gs)[gs]=new Le({userInfo:this.userInfo,onMembersAdded:()=>l.Analytics.sendMembersAdded(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs],babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].getPeopleCount())});return babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].render()}getPopupContentBottom(){if(!babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentBottom){babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentBottom=o.Tag.render(ls||(ls=Ze`
				<div class="calendar-sharing__dialog-bottom">
					${0}
					${0}
					${0}
				</div>
			`),this.getPopupCopyLinkButton(),this.getPopupLinkHistoryButton(),this.getPopupWhatSeeUsersButton())}return babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentBottom}getPopupContentTop(){if(!babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentTop){const e=()=>{top.BX.Helper.show(`redirect=detail&code=${this.getHelpDeskCodeDependsOnContext()}`)};babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentTop=o.Tag.render(rs||(rs=Ze`
				<div class="calendar-sharing__dialog-top">
					<div class="calendar-sharing__dialog-title">
						<span>${0}</span>
						<span onclick="${0}" class="calendar-sharing__dialog-title-help" title="${0}"></span>
					</div>
					<div class="calendar-sharing__dialog-info">${0}</div>
				</div>
			`),o.Loc.getMessage("SHARING_BUTTON_TITLE"),e,o.Loc.getMessage("SHARING_INFO_POPUP_HOW_IT_WORK"),`${this.getPhraseDependsOnContext("SHARING_INFO_POPUP_CONTENT_3")} `);const s=babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentTop.querySelector('[ data-role="calendar-sharing_popup-open-link"]');if(s){let e;let t;o.Event.bind(s,"mouseenter",(()=>{t=setTimeout((()=>{if(!e){e=new h.Popup({bindElement:s,angle:{offset:s.offsetWidth/2+16},width:410,darkMode:true,content:o.Loc.getMessage("SHARING_INFO_POPUP_SLOT_DESC"),animation:"fading-slide"})}e.show()}),1e3)}));o.Event.bind(s,"mouseleave",(()=>{clearTimeout(t);if(e){e.close()}}))}}return babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].contentTop}isShown(){return this.getPopup().isShown()}show(){var e,s,t;if(!this.bindElement){console.warn('BX.Calendar.Sharing: "bindElement" is not defined');return}(e=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs])==null?void 0:e.sortRanges();(s=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs])==null?void 0:s.updateRanges();(t=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs])==null?void 0:t.renderRanges();this.getPopup().show()}destroy(){this.getPopup().destroy();this.getDialogQr().destroy()}getPhraseDependsOnContext(e){return o.Loc.getMessage(`${e}_${babelHelpers.classPrivateFieldLooseBase(this,hs)[hs].toUpperCase()}`)}getHelpDeskCodeDependsOnContext(){let e;switch(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]){case babelHelpers.classPrivateFieldLooseBase(this,us)[us]:{e=this.HELP_DESK_CODE_CALENDAR;break}case babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]:{e=this.HELP_DESK_CODE_CRM;break}default:e=0}return e}saveSharingRule(){if(!babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].isDifferentFrom(babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].rule)){return}const e=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].getChanges();l.Analytics.sendRuleUpdated(babelHelpers.classPrivateFieldLooseBase(this,hs)[hs],e);const s=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs].getRule();BX.ajax.runAction("calendar.api.sharingajax.saveLinkRule",{data:{linkHash:this.linkHash,ruleArray:s}}).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].rule=s;p.EventEmitter.emit("CalendarSharing:RuleUpdated")}),(e=>{console.error(e)}))}getSettingsControlRule(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,bs)[bs])==null?void 0:e.getRule()}}let Ps=e=>e,_s,Bs,ms;class Ss{constructor(e={}){var s,t,i;this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY=1e3;this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST="first-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_NEW="new-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND="remind-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_JOINT="joint-sharing";this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS=[this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST];this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS=[this.PAY_ATTENTION_TO_NEW_FEATURE_NEW,this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND];this.AVAILABLE_PAY_ATTENTION_TO_NEW_FEATURE_MODS=[...this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS,...this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS];this.wrap=e.wrap;this.userInfo=e.userInfo||null;this.sharingConfig=n.Util.getSharingConfig();this.sharingUrl=((s=this.sharingConfig)==null?void 0:s.url)||null;this.linkHash=((t=this.sharingConfig)==null?void 0:t.hash)||null;this.sharingRule=((i=this.sharingConfig)==null?void 0:i.rule)||null;this.payAttentionToNewFeatureMode=e.payAttentionToNewFeature;this.sharingFeatureLimit=e.sharingFeatureLimit;this.sharingSettingsCollapsed=e.sharingSettingsCollapsed}show(){o.Dom.addClass(this.wrap,"calendar-sharing__btn-wrap");this.button=new u.Button({text:o.Loc.getMessage("SHARING_BUTTON_TITLE"),round:true,size:u.ButtonSize.EXTRA_SMALL,color:u.ButtonColor.LIGHT_BORDER,icon:this.sharingFeatureLimit?u.ButtonIcon.LOCK:null,className:"ui-btn-themes calendar-sharing__btn",onclick:(e,s)=>{if(!this.switcher.getNode().contains(s.target)){this.handleSharingButtonClick()}}});this.button.renderTo(this.wrap);this.renderSwitcher();if(this.payAttentionToNewFeatureMode===this.PAY_ATTENTION_TO_NEW_FEATURE_JOINT){setTimeout((()=>{if(BX.SidePanel.Instance.getTopSlider()===null){this.payAttentionToNewFeatureWithText();BX.ajax.runAction("calendar.api.sharingajax.disableOptionPayAttentionToNewSharingFeature")}}),this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY)}}handleSharingButtonClick(){if(this.sharingFeatureLimit){top.BX.UI.InfoHelper.show("limit_office_calendar_free_slots");return}if(this.isSharingEnabled()){this.openDialog()}else{this.switcher.toggle()}}getSwitcherContainer(){return o.Tag.render(_s||(_s=Ps`
			<div class="calendar-sharing__switcher"></div>
		`))}getSwitcherDivider(){return o.Tag.render(Bs||(Bs=Ps`
			<div class="calendar-sharing__switcher_divider"></div>
		`))}renderSwitcher(){o.Dom.append(this.getSwitcherDivider(),this.wrap);this.switcherWrap=o.Tag.render(ms||(ms=Ps`<div class="calendar-sharing__switcher-wrap"></div>`));o.Dom.append(this.switcherWrap,this.wrap);o.Event.bind(this.switcherWrap,"click",this.handleSwitcherWrapClick.bind(this),{capture:true});this.switcher=new BX.UI.Switcher({node:this.getSwitcherContainer(),checked:this.isSharingEnabled()&&!this.sharingFeatureLimit,color:"green",size:"small",handlers:{toggled:()=>this.handleSwitcherToggled()}});this.switcher.renderTo(this.switcherWrap)}handleSwitcherWrapClick(e){if(this.switcher.isChecked()){this.showWarningPopup();e.stopPropagation()}}handleSwitcherToggled(){if(this.sharingFeatureLimit&&this.switcher.isChecked()){top.BX.UI.InfoHelper.show("limit_office_calendar_free_slots");this.switcher.toggle();return}if(this.isToggledAfterErrorOccurred()){return}if(this.switcher.isChecked()){this.enableSharing()}else{this.disableSharing()}}isToggledAfterErrorOccurred(){return this.switcher.isChecked()===this.isSharingEnabled()}isSharingEnabled(){return o.Type.isString(this.sharingUrl)}enableSharing(){const e="calendar.api.sharingajax.enableUserSharing";const s="Calendar.Sharing.copyLinkButton:onSharingEnabled";BX.ajax.runAction(e).then((e=>{this.sharingUrl=e.data.url;this.linkHash=e.data.hash;this.sharingRule=e.data.rule;this.openDialog();p.EventEmitter.emit(s,{isChecked:this.switcher.isChecked(),url:e.data.url})})).catch((()=>{this.switcher.toggle()}))}openDialog(){var e;(e=this.pulsar)==null?void 0:e.close();o.Dom.remove(this.counterNode);if(!this.newDialog){this.newDialog=new Ls({bindElement:this.button.getContainer(),sharingUrl:this.sharingUrl,linkHash:this.linkHash,sharingRule:this.sharingRule,context:"calendar",calendarSettings:{weekHolidays:n.Util.config.week_holidays,weekStart:n.Util.config.week_start,workTimeStart:n.Util.config.work_time_start,workTimeEnd:n.Util.config.work_time_end},userInfo:this.userInfo,settingsCollapsed:this.sharingSettingsCollapsed})}if(!this.newDialog.isShown()){this.newDialog.show()}}disableSharing(){const e="calendar.api.sharingajax.disableUserSharing";const s="Calendar.Sharing.copyLinkButton:onSharingDisabled";this.warningPopup.close();BX.ajax.runAction(e).then((()=>{this.sharingUrl=null;if(this.newDialog){this.newDialog.destroy();this.newDialog=null}p.EventEmitter.emit(s,{isChecked:this.switcher.isChecked()})})).catch((()=>{this.switcher.toggle()}))}showWarningPopup(){if(!this.warningPopup){this.warningPopup=new c.MessageBox({title:o.Loc.getMessage("SHARING_WARNING_POPUP_TITLE_1"),message:o.Loc.getMessage("SHARING_WARNING_POPUP_CONTENT_2"),buttons:this.getWarningPopupButtons(),popupOptions:{autoHide:true,closeByEsc:true,draggable:false,closeIcon:true,minWidth:365,maxWidth:385,minHeight:180}})}this.warningPopup.show()}getWarningPopupButtons(){return[this.getSubmitButton(),this.getCancelButton()]}getSubmitButton(){return new u.Button({size:u.ButtonSize.MEDIUM,color:u.ButtonColor.DANGER,text:o.Loc.getMessage("SHARING_WARNING_POPUP_SUBMIT_BUTTON_NEW_MSGVER_1"),events:{click:()=>this.handleSubmitButtonClick()}})}getCancelButton(){return new u.Button({size:u.ButtonSize.MEDIUM,color:u.ButtonColor.LIGHT_BORDER,text:o.Loc.getMessage("SHARING_WARNING_POPUP_CANCEL_BUTTON"),events:{click:()=>this.handleCancelButtonClick()}})}handleSubmitButtonClick(){this.switcher.toggle();this.warningPopup.close()}handleCancelButtonClick(){this.warningPopup.close()}payAttentionToNewFeature(e){if(this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS.includes(e)){this.payAttentionToNewFeatureWithoutText()}if(this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS.includes(e)){this.payAttentionToNewFeatureWithText()}}payAttentionToNewFeatureWithoutText(){this.pulsar=this.getPulsar(this.wrap,false);this.pulsar.show();o.Event.bind(this.pulsar.container,"click",(()=>{this.handleSharingButtonClick()}));this.counterNode=new P.Counter({value:1,color:P.Counter.Color.DANGER,size:P.Counter.Size.MEDIUM,animation:false}).getContainer();o.Dom.addClass(this.counterNode,"calendar-sharing__new-feature-counter");o.Dom.append(this.counterNode,this.wrap)}payAttentionToNewFeatureWithText(){const e=o.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_JOINT_TITLE");const s=o.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_JOINT_TEXT");const t=this.getGuide(e,s);const i=this.getPulsar(this.wrap);t.showNextStep();t.getPopup().setAngle({offset:210});i.show()}getGuide(e,s){const t=new L.Guide({simpleMode:true,onEvents:true,steps:[{target:this.wrap,title:e,text:s,position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});const i=t.getPopup();o.Dom.addClass(i.popupContainer,"calendar-popup-ui-tour-animate");i.setWidth(400);o.Dom.style(i.getContentContainer(),"paddingRight",getComputedStyle(i.closeIcon).width);return t}getPulsar(e,s=true){const t=new BX.SpotLight({targetElement:e,targetVertex:"middle-center",lightMode:true});if(s){t.bindEvents({onTargetEnter:()=>t.close()})}return t}}class ys{constructor(e){var s,t,i;this.buttonWrap=e.buttonWrap;this.userInfo=e.userInfo||null;this.payAttentionToNewFeature=(s=e.payAttentionToNewFeature)!=null?s:false;this.sharingFeatureLimit=(t=e.sharingFeatureLimit)!=null?t:false;this.sharingSettingsCollapsed=(i=e.sharingSettingsCollapsed)!=null?i:false}showSharingButton(){this.sharingButton=new Ss({wrap:this.buttonWrap,userInfo:this.userInfo,payAttentionToNewFeature:this.payAttentionToNewFeature,sharingFeatureLimit:this.sharingFeatureLimit,sharingSettingsCollapsed:this.sharingSettingsCollapsed});this.sharingButton.show()}}e.Interface=ys;e.SharingButton=Ss;e.DialogNew=Ls;e.DialogQr=w})(this.BX.Calendar.Sharing=this.BX.Calendar.Sharing||{},BX,BX,BX,BX.Main,BX.Calendar.Sharing,BX.UI.EntitySelector,BX,BX.Calendar,BX.UI.IconSet,BX.Main,BX.UI.Dialogs,BX.UI,BX.Event,BX,BX.UI,BX,BX.UI.Tour,BX.UI);
//# sourceMappingURL=interface.bundle.map.js