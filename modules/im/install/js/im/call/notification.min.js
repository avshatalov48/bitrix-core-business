(function(){BX.namespace("BX.Call");if(BX.Call.Notification){return}const e={onButtonClick:"CallNotification::onButtonClick"};const t={setHasCamera:"CallNotification::setHasCamera",contentReady:"CallNotification::contentReady"};BX.Call.Notification=function(o){this.popup=null;this.window=null;this.callerAvatar=BX.type.isNotEmptyString(o.callerAvatar)?o.callerAvatar:"";if(this.callerAvatar=="/bitrix/js/im/images/blank.gif"){this.callerAvatar=""}this.callerName=o.callerName;this.callerType=o.callerType;this.callerColor=o.callerColor;this.video=o.video;this.hasCamera=o.hasCamera==true;this.contentReady=false;this.postponedEvents=[];this.callbacks={onClose:BX.type.isFunction(o.onClose)?o.onClose:BX.DoNothing,onDestroy:BX.type.isFunction(o.onDestroy)?o.onDestroy:BX.DoNothing,onButtonClick:BX.type.isFunction(o.onButtonClick)?o.onButtonClick:BX.DoNothing};this._onContentButtonClickHandler=this._onContentButtonClick.bind(this);this._onContentReadyHandler=this._onContentReady.bind(this);if(BX.desktop){BX.desktop.addCustomEvent(e.onButtonClick,this._onContentButtonClickHandler);BX.desktop.addCustomEvent(t.contentReady,this._onContentReadyHandler)}};BX.Call.Notification.prototype.show=function(){if(BX.desktop){var e={video:this.video,hasCamera:this.hasCamera,callerAvatar:this.callerAvatar,callerName:this.callerName,callerType:this.callerType,callerColor:this.callerColor};if(this.window){this.window.BXDesktopWindow.ExecuteCommand("show")}else{this.window=BXDesktopSystem.ExecuteCommand("topmost.show.html",BX.desktop.getHtmlPage("","window.callNotification = new BX.Call.NotificationContent("+JSON.stringify(e)+"); window.callNotification.showInDesktop();"))}}else{this.content=new BX.Call.NotificationContent({video:this.video,hasCamera:this.hasCamera,callerAvatar:this.callerAvatar,callerName:this.callerName,callerType:this.callerType,callerColor:this.callerColor,onClose:this.callbacks.onClose,onDestroy:this.callbacks.onDestroy,onButtonClick:this.callbacks.onButtonClick});this.createPopup(this.content.render());this.popup.show()}};BX.Call.Notification.prototype.createPopup=function(e){this.popup=new BX.PopupWindow("bx-messenger-call-notify",null,{targetContainer:document.body,content:e,closeIcon:false,noAllPaddings:true,zIndex:BX.MessengerCommon.getDefaultZIndex()+200,offsetLeft:0,offsetTop:0,closeByEsc:false,draggable:{restrict:false},overlay:{backgroundColor:"black",opacity:30},events:{onPopupClose:function(){this.callbacks.onClose()}.bind(this),onPopupDestroy:function(){this.popup=null}.bind(this)}})};BX.Call.Notification.prototype.setHasCamera=function(e){if(this.window){if(this.contentReady){BX.desktop.onCustomEvent(t.setHasCamera,[e])}else{this.postponedEvents.push({name:t.setHasCamera,params:[e]})}}else if(this.content){this.content.setHasCamera(e)}};BX.Call.Notification.prototype.sendPostponedEvents=function(){this.postponedEvents.forEach((e=>{BX.desktop.onCustomEvent(e.name,e.params)}));this.postponedEvents=[]};BX.Call.Notification.prototype.close=function(){if(this.popup){this.popup.close()}if(this.window){this.window.BXDesktopWindow.ExecuteCommand("hide")}this.callbacks.onClose()};BX.Call.Notification.prototype.destroy=function(){if(this.popup){this.popup.destroy();this.popup=null}if(this.window){this.window.BXDesktopWindow.ExecuteCommand("close");this.window=null}if(BX.desktop){BX.desktop.removeCustomEvents(e.onButtonClick)}this.callbacks.onDestroy()};BX.Call.Notification.prototype._onContentButtonClick=function(e){this.callbacks.onButtonClick(e)};BX.Call.Notification.prototype._onContentReady=function(){this.contentReady=true;this.sendPostponedEvents()};BX.Call.NotificationContent=function(e){this.video=!!e.video;this.hasCamera=!!e.hasCamera;this.callerAvatar=e.callerAvatar||"";this.callerName=e.callerName||BX.message("IM_M_CALL_VIDEO_HD");this.callerType=e.callerType||"chat";this.callerColor=e.callerColor||"";this.elements={root:null,avatar:null,buttons:{answerVideo:null}};this.callbacks={onClose:BX.type.isFunction(e.onClose)?e.onClose:BX.DoNothing,onDestroy:BX.type.isFunction(e.onDestroy)?e.onDestroy:BX.DoNothing,onButtonClick:BX.type.isFunction(e.onButtonClick)?e.onButtonClick:BX.DoNothing};if(BX.desktop){BX.desktop.addCustomEvent(t.setHasCamera,(e=>this.setHasCamera(e)));BX.desktop.onCustomEvent("main",t.contentReady,[])}};BX.Call.NotificationContent.prototype.render=function(){var e=this.callerAvatar||"/bitrix/js/im/images/default-call-background.png";var t;var o;if(this.video){if(this.callerType==="private"){o=BX.message("IM_M_VIDEO_CALL_FROM")}else{o=BX.message("IM_M_VIDEO_CALL_FROM_CHAT")}}else{if(this.callerType==="private"){o=BX.message("IM_M_CALL_FROM")}else{o=BX.message("IM_M_CALL_FROM_CHAT")}}var n="";var s="";var a={};if(this.callerAvatar){a={backgroundImage:"url('"+this.callerAvatar+"')",backgroundColor:"#fff",backgroundSize:"cover"}}else{var i=this.callerType==="private"?"user":this.callerType;n="bx-messenger-panel-avatar-"+i;a={backgroundColor:this.callerColor||"#525252",backgroundSize:"40px",backgroundPosition:"center center"};s="bx-messenger-panel-avatar-img-default"}this.elements.root=BX.create("div",{props:{className:"bx-messenger-call-window"},children:[BX.create("div",{props:{className:"bx-messenger-call-window-background"},style:{backgroundImage:"url('"+e+"')"}}),BX.create("div",{props:{className:"bx-messenger-call-window-background-blur"}}),BX.create("div",{props:{className:"bx-messenger-call-window-background-gradient"},style:{backgroundImage:"url('/bitrix/js/im/images/call-background-gradient.png')"}}),BX.create("div",{props:{className:"bx-messenger-call-window-bottom-background"}}),BX.create("div",{props:{className:"bx-messenger-call-window-body"},children:[BX.create("div",{props:{className:"bx-messenger-call-window-top"},children:[BX.create("div",{props:{className:"bx-messenger-call-window-photo"},children:[BX.create("div",{props:{className:"bx-messenger-call-window-photo-left "+n},children:[this.elements.avatar=BX.create("div",{props:{className:"bx-messenger-call-window-photo-block "+s},style:a})]})]}),BX.create("div",{props:{className:"bx-messenger-call-window-title"},children:[BX.create("div",{props:{className:"bx-messenger-call-window-title-block"},children:[BX.create("div",{props:{className:"bx-messenger-call-overlay-title-caller-prefix"},text:o}),BX.create("div",{props:{className:"bx-messenger-call-overlay-title-caller"},text:BX.util.htmlspecialcharsback(this.callerName)})]})]})]}),BX.create("div",{props:{className:"bx-messenger-call-window-bottom"},children:[BX.create("div",{props:{className:"bx-messenger-call-window-buttons"},children:[BX.create("div",{props:{className:"bx-messenger-call-window-buttons-block"},children:[this.elements.buttons.answerVideo=BX.create("div",{props:{className:"bx-messenger-call-window-button"+(!this.hasCamera?" bx-messenger-call-window-button-disabled":"")},children:[BX.create("div",{props:{className:"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-camera"}}),BX.create("div",{props:{className:"bx-messenger-call-window-button-text"},text:BX.message("IM_M_CALL_BTN_ANSWER_VIDEO")})],events:{click:this._onAnswerWithVideoButtonClick.bind(this)}}),BX.create("div",{props:{className:"bx-messenger-call-window-button"},children:[BX.create("div",{props:{className:"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-up"}}),BX.create("div",{props:{className:"bx-messenger-call-window-button-text"},text:BX.message("IM_M_CALL_BTN_ANSWER")})],events:{click:this._onAnswerButtonClick.bind(this)}}),BX.create("div",{props:{className:"bx-messenger-call-window-button bx-messenger-call-window-button-danger"},children:[BX.create("div",{props:{className:"bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-down"}}),BX.create("div",{props:{className:"bx-messenger-call-window-button-text"},text:BX.message("IM_M_CALL_BTN_DECLINE")})],events:{click:this._onDeclineButtonClick.bind(this)}})]})]})]})]})]});return this.elements.root};BX.Call.NotificationContent.prototype.showInDesktop=function(){if(!window.opener.BXIM.callController.callNotification){BXDesktopWindow.ExecuteCommand("close");return}this.render();document.body.appendChild(this.elements.root);BX.desktop.setWindowPosition({X:STP_CENTER,Y:STP_VCENTER,Width:351,Height:510})};BX.Call.NotificationContent.prototype.setHasCamera=function(e){this.hasCamera=!!e;if(this.elements.buttons.answerVideo){this.elements.buttons.answerVideo.classList.toggle("bx-messenger-call-window-button-disabled",!this.hasCamera)}};BX.Call.NotificationContent.prototype._onAnswerButtonClick=function(t){if(BX.desktop){BXDesktopWindow.ExecuteCommand("close");BX.desktop.onCustomEvent("main",e.onButtonClick,[{button:"answer",video:false}])}else{this.callbacks.onButtonClick({button:"answer",video:false})}};BX.Call.NotificationContent.prototype._onAnswerWithVideoButtonClick=function(t){if(!this.hasCamera){return}if(BX.desktop){BXDesktopWindow.ExecuteCommand("close");BX.desktop.onCustomEvent("main",e.onButtonClick,[{button:"answer",video:true}])}else{this.callbacks.onButtonClick({button:"answer",video:true})}};BX.Call.NotificationContent.prototype._onDeclineButtonClick=function(t){if(BX.desktop){BXDesktopWindow.ExecuteCommand("close");BX.desktop.onCustomEvent("main",e.onButtonClick,[{button:"decline"}])}else{this.callbacks.onButtonClick({button:"decline"})}}})();
//# sourceMappingURL=notification.map.js