this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(e,s,t,a,i,l,r,o,n,d,c,h,b,p,u,v,g,P,L,F,H){"use strict";var B=babelHelpers.classPrivateFieldLooseKey("calendarSettings");var y=babelHelpers.classPrivateFieldLooseKey("getSlotSize");class f extends H.EventEmitter{constructor(e){super();Object.defineProperty(this,y,{value:m});Object.defineProperty(this,B,{writable:true,value:void 0});this.setEventNamespace("Calendar.Sharing.Range");const{id:s,range:t,rule:a,calendarSettings:i,isNew:l}=e;this.id=s;this.rule=a;this.from=t.from;this.to=t.to;this.new=l;this.deletable=false;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=i;this.setWeekDays(t.weekdays)}toArray(){return{from:this.getFrom(),to:this.to,weekdays:this.getWeekDays()}}getRule(){return this.rule}getId(){return this.id}getFromFormatted(){return this.formatMinutes(this.getFrom())}getFrom(){return this.from}setFrom(e){this.from=parseInt(e,10);if(this.from+babelHelpers.classPrivateFieldLooseBase(this,y)[y]()>this.to){this.to=this.from+babelHelpers.classPrivateFieldLooseBase(this,y)[y]()}this.updated()}getToFormatted(){return this.formatMinutes(this.getTo())}getTo(){return this.to}setTo(e){this.to=e;this.updated()}updateSlotSize(){const e=24*60-babelHelpers.classPrivateFieldLooseBase(this,y)[y]();if(this.from>e){this.from=e;this.to=this.from+babelHelpers.classPrivateFieldLooseBase(this,y)[y]()}else if(this.from+babelHelpers.classPrivateFieldLooseBase(this,y)[y]()>this.to){this.to=this.from+babelHelpers.classPrivateFieldLooseBase(this,y)[y]()}this.updated()}addWeekday(e){if(this.weekdays.includes(e)){return}this.setWeekDays([...this.weekdays,e])}removeWeekday(e){this.setWeekDays(this.weekdays.filter((s=>s!==e)))}getWeekDays(){return this.weekdays}setWeekDays(e){this.weekdays=this.sortWeekdays(e);this.updated()}getWeekdaysTitle(e=false){if([...this.weekdays].sort().join(",")===[1,2,3,4,5].sort().join(",")){return P.Loc.getMessage("CALENDAR_SHARING_SETTINGS_WORKDAYS_MSGVER_1")}return this.formatWeekdays(e)}formatWeekdays(e){const s=g.Util.getWeekdaysLoc(e||this.weekdays.length===1);const t=this.getWeekDays();if(t.length===0){return""}return t.map((e=>s[e])).reduce(((e,s)=>`${e}, ${s}`))}sortWeekdays(e){return e.map((e=>e<babelHelpers.classPrivateFieldLooseBase(this,B)[B].weekStart?e+10:e)).sort(((e,s)=>e-s)).map((e=>e%10))}getAvailableTimeFrom(){const e=[];const s=24*60-babelHelpers.classPrivateFieldLooseBase(this,y)[y]();for(let t=0;t<=24;t++){if(t*60<=s){e.push({value:t*60,name:g.Util.formatTime(t,0)})}if(t!==24&&t*60+30<=s){e.push({value:t*60+30,name:g.Util.formatTime(t,30)})}}return e}getAvailableTimeTo(){const e=[];for(let s=0;s<=24;s++){if(s*60>=this.from+babelHelpers.classPrivateFieldLooseBase(this,y)[y]()){e.push({value:s*60,name:g.Util.formatTime(s,0)})}if(s!==24&&s*60+30>=this.from+babelHelpers.classPrivateFieldLooseBase(this,y)[y]()){e.push({value:s*60+30,name:g.Util.formatTime(s,30)})}}return e}isDeletable(){return this.deletable}setDeletable(e){this.deletable=e}isNew(){return this.new}setNew(e){this.new=e}getWeekStart(){return babelHelpers.classPrivateFieldLooseBase(this,B)[B].weekStart}formatMinutes(e){const s=new Date(g.Util.parseDate("01.01.2000").getTime()+e*60*1e3);return g.Util.formatTime(s)}updated(){this.emit("updated");this.getRule().updated()}}function m(){return this.rule.getSlotSize()}var _=babelHelpers.classPrivateFieldLooseKey("calendarSettings");var S=babelHelpers.classPrivateFieldLooseKey("updateRanges");class T extends H.EventEmitter{constructor(e){super();Object.defineProperty(this,S,{value:w});this.AVAILABLE_INTERVALS=[30,45,60,90,120,180];this.MAX_RANGES=5;this.DEFAULT_SLOT_SIZE=60;Object.defineProperty(this,_,{writable:true,value:void 0});this.setEventNamespace("Calendar.Sharing.Rule");const{rule:s,calendarSettings:t}=e;babelHelpers.classPrivateFieldLooseBase(this,_)[_]=t;this.ranges=[];for(const e of s.ranges){this.addRange(e,false)}this.setSlotSize(s.slotSize);this.sortRanges()}toArray(){return{slotSize:this.getSlotSize(),ranges:this.getSortedRanges().map((e=>e.toArray()))}}getDefaultRule(){return new T({rule:{slotSize:this.DEFAULT_SLOT_SIZE,ranges:[{from:babelHelpers.classPrivateFieldLooseBase(this,_)[_].workTimeStart,to:babelHelpers.classPrivateFieldLooseBase(this,_)[_].workTimeEnd,weekdays:babelHelpers.classPrivateFieldLooseBase(this,_)[_].workDays}]},calendarSettings:babelHelpers.classPrivateFieldLooseBase(this,_)[_]})}getAvailableIntervals(){return this.AVAILABLE_INTERVALS}getFormattedSlotSize(){return g.Util.formatDuration(this.getSlotSize())}getSlotSize(){return this.slotSize}setSlotSize(e){const s=parseInt(e,10);this.slotSize=this.getAvailableIntervals().includes(s)?s:this.DEFAULT_SLOT_SIZE;for(const e of this.getRanges()){e.updateSlotSize()}}getRanges(){return this.ranges}sortRanges(){this.ranges=this.getSortedRanges()}getSortedRanges(){return[...this.ranges].sort(((e,s)=>this.compareRanges(e,s)))}compareRanges(e,s){const t=this.getWeekdaysWeight(e.getWeekDays());const a=this.getWeekdaysWeight(s.getWeekDays());if(t!==a){return t-a}if(e.getFrom()!==s.getFrom()){return e.getFrom()-s.getFrom()}return e.getTo()-s.getTo()}getWeekdaysWeight(e){return e.reduce(((e,s,t)=>e+s*10**(10-t)),0)}addRange(e,s=true){var t;if(!this.canAddRange()){return}(t=this.internalRangeId)!=null?t:this.internalRangeId=1;this.ranges.push(new f({id:this.internalRangeId++,range:e!=null?e:this.getDefaultRule().getRanges()[0],calendarSettings:babelHelpers.classPrivateFieldLooseBase(this,_)[_],isNew:s,rule:this}));babelHelpers.classPrivateFieldLooseBase(this,S)[S]();this.updated()}removeRange(e){if(!this.canRemoveRange()){return false}this.ranges=this.ranges.filter((s=>s.getId()!==e.getId()));babelHelpers.classPrivateFieldLooseBase(this,S)[S]();this.rangeDeleted();return true}canAddRange(){return this.ranges.length<this.MAX_RANGES}canRemoveRange(){return this.ranges.length>1}updated(){this.emit("updated")}rangeDeleted(){this.emit("rangeDeleted")}}function w(){for(const e of this.ranges.slice(0,-1)){e.setDeletable(true)}this.ranges.slice(-1)[0].setDeletable(this.ranges.length===5)}var C=babelHelpers.classPrivateFieldLooseKey("params");var E=babelHelpers.classPrivateFieldLooseKey("rule");var k=babelHelpers.classPrivateFieldLooseKey("memberIds");var O=babelHelpers.classPrivateFieldLooseKey("createRuleModel");var A=babelHelpers.classPrivateFieldLooseKey("updateSortByFrequentUse");class I{constructor(e){Object.defineProperty(this,A,{value:R});Object.defineProperty(this,O,{value:N});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;const{rule:s,calendarSettings:t}=e;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=babelHelpers.classPrivateFieldLooseBase(this,O)[O](s,t)}getMinutesFromTime(e){const t=(new Date).toDateString();const a=new Date(`${t} ${`${e}`.replace(".",":")}:00`);const i=s.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const l=g.Util.parseTime(s.DateTimeFormat.format(i,a/1e3));return l.h*60+l.m}getWorkingDays(e){const s=new Set(e.map((e=>g.Util.getIndByWeekDay(e))));return[0,1,2,3,4,5,6].filter((e=>!s.has(e)))}isDefaultRule(){return!this.isDifferentFrom(this.getRule().getDefaultRule())}isDifferentFrom(e){return this.getChanges(e,this.getRule()).length>0}getChanges(e){const s=this.getRule().toArray();const a=(e!=null?e:this.getRule().getDefaultRule()).toArray();const i=s.slotSize!==a.slotSize;const l=JSON.stringify(s.ranges)!==JSON.stringify(a.ranges);const r=[];if(l){r.push(t.Analytics.ruleChanges.custom_days)}if(i){r.push(t.Analytics.ruleChanges.custom_length)}return r}sortRanges(){this.getRule().sortRanges()}getRule(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E]}getUserInfo(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].userInfo}getContext(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].context}getLinkHash(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].linkHash}getSharingUrl(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].sharingUrl}isCollapsed(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].collapsed}sortJointLinksByFrequentUse(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].sortJointLinksByFrequentUse}getCalendarContext(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].calendarContext}changeSortJointLinksByFrequentUse(){babelHelpers.classPrivateFieldLooseBase(this,C)[C].sortJointLinksByFrequentUse=!babelHelpers.classPrivateFieldLooseBase(this,C)[C].sortJointLinksByFrequentUse;babelHelpers.classPrivateFieldLooseBase(this,A)[A]()}setMemberIds(e){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e}getMemberIds(){return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}async saveJointLink(){var e,s;const t=((e=babelHelpers.classPrivateFieldLooseBase(this,C)[C].calendarContext)==null?void 0:e.sharingObjectType)==="group"?"calendar.api.sharinggroupajax.generateJointSharingLink":"calendar.api.sharingajax.generateUserJointSharingLink";const a=await BX.ajax.runAction(t,{data:{memberIds:this.getMemberIds(),groupId:(s=babelHelpers.classPrivateFieldLooseBase(this,C)[C].calendarContext)==null?void 0:s.sharingObjectId}});return a.data}save(){if(!this.isDifferentFrom(babelHelpers.classPrivateFieldLooseBase(this,O)[O](babelHelpers.classPrivateFieldLooseBase(this,C)[C].rule,babelHelpers.classPrivateFieldLooseBase(this,C)[C].calendarSettings))){return null}const e=this.getChanges();t.Analytics.sendRuleUpdated(this.getContext(),e);const s=this.getRule().toArray();return new Promise(((e,t)=>{BX.ajax.runAction("calendar.api.sharingajax.saveLinkRule",{data:{linkHash:this.getLinkHash(),ruleArray:s}}).then((()=>{H.EventEmitter.emit("CalendarSharing:RuleUpdated");babelHelpers.classPrivateFieldLooseBase(this,C)[C].rule=s;e()}),(e=>{console.error(e);t()}))}))}increaseFrequentUse(){void BX.ajax.runAction("calendar.api.sharingajax.increaseFrequentUse",{data:{hash:this.getLinkHash()}})}updateCollapsed(e){void BX.ajax.runAction("calendar.api.sharingajax.updateSharingSettingsCollapsed",{data:{collapsed:e?"Y":"N"}})}}function N(e,s){const{weekStart:t,weekHolidays:a,workTimeStart:i,workTimeEnd:l}=s;return new T({rule:e,calendarSettings:{weekStart:g.Util.getIndByWeekDay(t),workTimeStart:this.getMinutesFromTime(i),workTimeEnd:this.getMinutesFromTime(l),workDays:this.getWorkingDays(a)}})}function R(){BX.ajax.runAction("calendar.api.sharingajax.setSortJointLinksByFrequentUse",{data:{sortByFrequentUse:babelHelpers.classPrivateFieldLooseBase(this,C)[C].sortJointLinksByFrequentUse?"Y":"N"}})}let D=e=>e,U;class x{constructor(e){this.wrap=null;this.name=e.name;this.index=e.index;this.active=e.active;this.onSelected=P.Type.isFunction(e.onSelected)?e.onSelected:()=>{};this.onDiscarded=P.Type.isFunction(e.onDiscarded)?e.onDiscarded:()=>{};this.onMouseDown=P.Type.isFunction(e.onMouseDown)?e.onMouseDown:()=>{};this.canBeDiscarded=P.Type.isFunction(e.canBeDiscarded)?e.canBeDiscarded:()=>{}}render(){const e=this.active?"--selected":"";this.wrap=P.Tag.render(U||(U=D`
			<div class="calendar-sharing__settings-popup-weekday ${0}" onmousedown="${0}">
				<div class="calendar-sharing__settings-popup-weekday-text">${0}</div>
				<div class="calendar-sharing__settings-popup-weekday-icon"></div>
			</div>
		`),e,(e=>this.handleMouseDown(e)),this.name);return this.wrap}handleMouseDown(e){if(this.active){this.discard()}else{this.select()}this.onMouseDown(e,this)}select(){this.active=true;P.Dom.addClass(this.wrap,"--selected");this.onSelected()}discard(){if(!this.canBeDiscarded()){return}this.active=false;P.Dom.removeClass(this.wrap,"--selected");this.onDiscarded()}}let j=e=>e,M,K,W,$,G,X,z,q;var J=babelHelpers.classPrivateFieldLooseKey("params");var Y=babelHelpers.classPrivateFieldLooseKey("layout");var Q=babelHelpers.classPrivateFieldLooseKey("model");var V=babelHelpers.classPrivateFieldLooseKey("bindEvents");var Z=babelHelpers.classPrivateFieldLooseKey("unbindEvents");var ee=babelHelpers.classPrivateFieldLooseKey("onRangeUpdated");var se=babelHelpers.classPrivateFieldLooseKey("animate");var te=babelHelpers.classPrivateFieldLooseKey("getButton");var ae=babelHelpers.classPrivateFieldLooseKey("onDeleteButtonClickHandler");var ie=babelHelpers.classPrivateFieldLooseKey("onAddButtonClickHandler");var le=babelHelpers.classPrivateFieldLooseKey("add");var re=babelHelpers.classPrivateFieldLooseKey("remove");var oe=babelHelpers.classPrivateFieldLooseKey("renderWeekdaysSelect");var ne=babelHelpers.classPrivateFieldLooseKey("getTextNodeWidth");var de=babelHelpers.classPrivateFieldLooseKey("createWeekdaysPopup");var ce=babelHelpers.classPrivateFieldLooseKey("createWeekday");var he=babelHelpers.classPrivateFieldLooseKey("onWeekdayMouseDown");var be=babelHelpers.classPrivateFieldLooseKey("renderTimeFromSelect");var pe=babelHelpers.classPrivateFieldLooseKey("renderTimeToSelect");var ue=babelHelpers.classPrivateFieldLooseKey("renderTimeSelect");var ve=babelHelpers.classPrivateFieldLooseKey("onTimeSelectClickHandler");var ge=babelHelpers.classPrivateFieldLooseKey("showTimeMenu");var Pe=babelHelpers.classPrivateFieldLooseKey("onWeekdaysSelectClickHandler");class Le{constructor(e){Object.defineProperty(this,Pe,{value:xe});Object.defineProperty(this,ge,{value:Ue});Object.defineProperty(this,ve,{value:De});Object.defineProperty(this,ue,{value:Re});Object.defineProperty(this,pe,{value:Ne});Object.defineProperty(this,be,{value:Ie});Object.defineProperty(this,he,{value:Ae});Object.defineProperty(this,ce,{value:Oe});Object.defineProperty(this,de,{value:ke});Object.defineProperty(this,ne,{value:Ee});Object.defineProperty(this,oe,{value:Ce});Object.defineProperty(this,re,{value:we});Object.defineProperty(this,le,{value:Te});Object.defineProperty(this,ie,{value:Se});Object.defineProperty(this,ae,{value:_e});Object.defineProperty(this,te,{value:me});Object.defineProperty(this,se,{value:fe});Object.defineProperty(this,ee,{value:ye});Object.defineProperty(this,Z,{value:Be});Object.defineProperty(this,V,{value:He});Object.defineProperty(this,Q,{get:Fe,set:void 0});Object.defineProperty(this,J,{writable:true,value:void 0});Object.defineProperty(this,Y,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,J)[J]=e;babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]={};this.showReadOnlyPopup=P.Type.isFunction(e.showReadOnlyPopup)?e.showReadOnlyPopup:()=>{};this.onRangeUpdated=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].bind(this);babelHelpers.classPrivateFieldLooseBase(this,V)[V]()}hasShownPopups(){const e=this.weekdaysMenu.isShown();const s=P.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].fromTimeSelect,"--active");const t=P.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].toTimeSelect,"--active");return e||s||t}destroy(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].wrap.remove();babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]()}render(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].wrap=P.Tag.render(M||(M=j`
			<div class="calendar-sharing__settings-range">
				${0}
				<div class="calendar-sharing__settings-time-interval">
					${0}
					<div class="calendar-sharing__settings-dash"></div>
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](),babelHelpers.classPrivateFieldLooseBase(this,be)[be](),babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](),this.renderButton());if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].isNew()){babelHelpers.classPrivateFieldLooseBase(this,se)[se]()}return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].wrap}renderButton(){var e;const s=babelHelpers.classPrivateFieldLooseBase(this,te)[te]();(e=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].button)==null?void 0:e.replaceWith(s);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].button=s;return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].button}updateWeekdaysTitle(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect.title=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].formatWeekdays(false);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect.innerText=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getWeekdaysTitle(true);const e=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect.offsetWidth-32;const s=babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect.firstChild);const t=e<s;if(t){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect.innerText=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getWeekdaysTitle(false)}}formatAmPmSpan(e){return e.toLowerCase().replace(/(am|pm)/g,'<span class="calendar-sharing__settings-time-am-pm">$1</span>')}}function Fe(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J].model}function He(){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].subscribe("updated",this.onRangeUpdated)}function Be(){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].unsubscribe("updated",this.onRangeUpdated)}function ye(){this.updateWeekdaysTitle()}function fe(){P.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].wrap,"--animate-show");setTimeout((()=>{P.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].wrap,"--animate-show");babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].setNew(false)}),300)}function me(){if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].isDeletable()){return P.Tag.render(K||(K=j`
				<div
					class="calendar-sharing__settings-delete"
					onclick="${0}"
				></div>
			`),babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].bind(this))}return P.Tag.render(W||(W=j`
			<div
				class="calendar-sharing__settings-add"
				onclick="${0}"
			></div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].bind(this))}function _e(){if(babelHelpers.classPrivateFieldLooseBase(this,J)[J].readOnly){this.showReadOnlyPopup(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].button)}else{babelHelpers.classPrivateFieldLooseBase(this,re)[re]()}}function Se(){if(babelHelpers.classPrivateFieldLooseBase(this,J)[J].readOnly){this.showReadOnlyPopup(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].button)}else{babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}}function Te(){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getRule().addRange()}function we(){if(!babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getRule().removeRange(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q])){return}P.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].wrap,"--animate-remove");setTimeout((()=>this.destroy()),300)}function Ce(){const e=g.Util.getWeekdaysLoc().map(((e,s)=>({loc:e,index:s,active:babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getWeekDays().includes(s)})));e.push(...e.splice(0,babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getWeekStart()));babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect=P.Tag.render($||($=j`
			<div
				class="calendar-sharing__settings-weekdays calendar-sharing__settings-select calendar-sharing__settings-select-arrow"
				title="${0}"
			>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].formatWeekdays(),babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getWeekdaysTitle());const s=new IntersectionObserver((()=>{if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect.offsetWidth>0){this.updateWeekdaysTitle()}}));s.observe(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect);P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect,"click",babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].bind(this));this.weekdays=e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e)));const t=`calendar-sharing-settings-weekdays-${babelHelpers.classPrivateFieldLooseBase(this,J)[J].model.id}`;this.weekdaysMenu=L.PopupManager.getPopupById(t);if(!this.weekdaysMenu){this.weekdaysMenu=babelHelpers.classPrivateFieldLooseBase(this,de)[de](t);this.weekdaysMenu.canBeClosed=true}this.weekdaysMenu.setBindElement(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect);return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect}function Ee(e){const s=BX.Tag.render(G||(G=j`<span style="position: absolute;">${0}</span>`),e.cloneNode());e.replaceWith(s);const t=s.offsetWidth;s.replaceWith(e);return t}function ke(e){return new L.Popup({id:e,content:P.Tag.render(X||(X=j`
				<div class="calendar-sharing__settings-popup-weekdays">
					${0}
				</div>
			`),this.weekdays.map((e=>e.render()))),autoHide:true,closeByEsc:true,angle:{position:"top",offset:105},autoHideHandler:()=>this.weekdaysMenu.canBeClosed,events:{onPopupShow:()=>P.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect,"--active"),onPopupClose:()=>P.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect,"--active")}})}function Oe(e){return new x({name:e.loc,index:e.index,active:e.active,onSelected:()=>babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].addWeekday(e.index),onDiscarded:()=>babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].removeWeekday(e.index),canBeDiscarded:()=>babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getWeekDays().length>1,onMouseDown:babelHelpers.classPrivateFieldLooseBase(this,he)[he].bind(this)})}function Ae(e,s){this.weekdaysMenu.canBeClosed=false;const t=e.clientX;const a=s.active;this.controllableWeekdays=[];this.collectIntersectedWeekdays=e=>{for(const s of this.weekdays){const a=s.wrap.getBoundingClientRect().right;const i=s.wrap.getBoundingClientRect().left;if(t>a&&e.clientX<a||t<i&&e.clientX>i||i<t&&t<a){if(!this.controllableWeekdays.includes(s)){this.controllableWeekdays.push(s)}s.intersected=true}}};this.onMouseMove=e=>{this.controllableWeekdays.forEach((e=>{e.intersected=false}));this.collectIntersectedWeekdays(e);for(const e of this.controllableWeekdays){if(e.intersected&&a||!e.intersected&&!a){e.select()}else{e.discard()}}};P.Event.bind(document,"mousemove",this.onMouseMove);P.Event.bind(document,"mouseup",(()=>{P.Event.unbind(document,"mousemove",this.onMouseMove);setTimeout((()=>{this.weekdaysMenu.canBeClosed=true}),0)}))}function Ie(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].fromTimeSelect=babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getFromFormatted(),{getTimeStamps:()=>babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getAvailableTimeFrom(),isSelected:e=>babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getFrom()===e,onItemSelected:e=>babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].setFrom(e)},"calendar-sharing-settings-range-from");return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].fromTimeSelect}function Ne(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].toTimeSelect=babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getToFormatted(),{getTimeStamps:()=>babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getAvailableTimeTo(),isSelected:e=>babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].getTo()===e,onItemSelected:e=>babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].setTo(e)},"calendar-sharing-settings-range-to");return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].toTimeSelect}function Re(e,s,t){const a=P.Tag.render(z||(z=j`
			<div
				class="calendar-sharing__settings-select calendar-sharing__settings-time calendar-sharing__settings-select-arrow"
				data-id="${0}"
			>
				${0}
			</div>
		`),t,this.formatAmPmSpan(e));P.Event.bind(a,"click",(()=>babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](a,s)));return a}function De(e,s){if(babelHelpers.classPrivateFieldLooseBase(this,J)[J].readOnly){this.showReadOnlyPopup(e)}else if(!P.Dom.hasClass(e,"--active")){babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](e,s)}}function Ue(e,s){let t;const a=s.getTimeStamps().map((a=>({html:P.Tag.render(q||(q=j`
					<div class="calendar-sharing__am-pm-container">${0}</div>
				`),a.name),className:s.isSelected(a.value)?"menu-popup-no-icon --selected":"menu-popup-no-icon",onclick:()=>{e.innerHTML=a.name;s.onItemSelected(a.value);t.close()}})));t=L.MenuManager.create({id:`calendar-sharing-settings-time-menu${Date.now()}`,className:"calendar-sharing-settings-time-menu",bindElement:e,items:a,autoHide:true,closeByEsc:true,events:{onShow:()=>P.Dom.addClass(e,"--active"),onClose:()=>P.Dom.removeClass(e,"--active")},maxHeight:300,minWidth:e.offsetWidth});t.show();const i=t.getPopupWindow();const l=i.getContentContainer();const r=l.querySelector(".menu-popup-item.--selected");l.scrollTop=r.offsetTop-r.offsetHeight*2}function xe(){if(babelHelpers.classPrivateFieldLooseBase(this,J)[J].readOnly){this.showReadOnlyPopup(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].weekdaysSelect)}else{this.weekdaysMenu.show()}}let je=e=>e,Me,Ke,We,$e,Ge,Xe,ze,qe,Je;var Ye=babelHelpers.classPrivateFieldLooseKey("params");var Qe=babelHelpers.classPrivateFieldLooseKey("layout");var Ve=babelHelpers.classPrivateFieldLooseKey("model");var Ze=babelHelpers.classPrivateFieldLooseKey("rule");var es=babelHelpers.classPrivateFieldLooseKey("bindEvents");var ss=babelHelpers.classPrivateFieldLooseKey("onRuleUpdated");var ts=babelHelpers.classPrivateFieldLooseKey("onRangeDeleted");var as=babelHelpers.classPrivateFieldLooseKey("renderHeader");var is=babelHelpers.classPrivateFieldLooseKey("renderSubtitle");var ls=babelHelpers.classPrivateFieldLooseKey("updateSubtitle");var rs=babelHelpers.classPrivateFieldLooseKey("getSubtitleText");var os=babelHelpers.classPrivateFieldLooseKey("renderExpandRuleButton");var ns=babelHelpers.classPrivateFieldLooseKey("renderRule");var ds=babelHelpers.classPrivateFieldLooseKey("toggleExpand");var cs=babelHelpers.classPrivateFieldLooseKey("updateRuleHeight");var hs=babelHelpers.classPrivateFieldLooseKey("renderRanges");var bs=babelHelpers.classPrivateFieldLooseKey("createRange");var ps=babelHelpers.classPrivateFieldLooseKey("renderSettingsSlotSizeSelect");var us=babelHelpers.classPrivateFieldLooseKey("calculateRuleHeight");var vs=babelHelpers.classPrivateFieldLooseKey("removeRuleHeight");var gs=babelHelpers.classPrivateFieldLooseKey("slotSizeSelectClickHandler");var Ps=babelHelpers.classPrivateFieldLooseKey("showReadOnlyPopup");var Ls=babelHelpers.classPrivateFieldLooseKey("getReadOnlyPopup");var Fs=babelHelpers.classPrivateFieldLooseKey("closeReadOnlyPopup");class Hs{constructor(e){Object.defineProperty(this,Fs,{value:Ks});Object.defineProperty(this,Ls,{value:Ms});Object.defineProperty(this,Ps,{value:js});Object.defineProperty(this,gs,{value:xs});Object.defineProperty(this,vs,{value:Us});Object.defineProperty(this,us,{value:Ds});Object.defineProperty(this,ps,{value:Rs});Object.defineProperty(this,bs,{value:Ns});Object.defineProperty(this,hs,{value:Is});Object.defineProperty(this,cs,{value:As});Object.defineProperty(this,ds,{value:Os});Object.defineProperty(this,ns,{value:ks});Object.defineProperty(this,os,{value:Es});Object.defineProperty(this,rs,{value:Cs});Object.defineProperty(this,ls,{value:ws});Object.defineProperty(this,is,{value:Ts});Object.defineProperty(this,as,{value:Ss});Object.defineProperty(this,ts,{value:_s});Object.defineProperty(this,ss,{value:ms});Object.defineProperty(this,es,{value:fs});Object.defineProperty(this,Ze,{get:ys,set:void 0});Object.defineProperty(this,Ve,{get:Bs,set:void 0});Object.defineProperty(this,Ye,{writable:true,value:void 0});Object.defineProperty(this,Qe,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=e;babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]={};this.readOnly=e.readOnly;babelHelpers.classPrivateFieldLooseBase(this,es)[es]()}hasShownPopups(){var e,s;const t=(e=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].ranges.filter((e=>e.hasShownPopups())))!=null?e:[];const a=t.length>0;const i=P.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeSelect,"--active");const l=(s=this.readOnlyPopup)==null?void 0:s.isShown();return a||i||l}render(){const e=this.readOnly?"--read-only":"";const s=babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].isCollapsed()?"--hide":"";const t=`--${babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].getContext()}`;babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].wrap=P.Tag.render(Me||(Me=je`
			<div class="calendar-sharing__settings ${0} ${0} ${0}">
				${0}
				${0}
			</div>
		`),e,s,t,babelHelpers.classPrivateFieldLooseBase(this,as)[as](),babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]());return babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].wrap}}function Bs(){return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].model}function ys(){return babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].getRule()}function fs(){babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].subscribe("updated",babelHelpers.classPrivateFieldLooseBase(this,ss)[ss].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].subscribe("rangeDeleted",babelHelpers.classPrivateFieldLooseBase(this,ts)[ts].bind(this))}function ms(){babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]();babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]();babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]()}function _s(){babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]();babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]();babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].ranges.forEach((e=>e.renderButton()))}function Ss(){return P.Tag.render(Ke||(Ke=je`
			<div class="calendar-sharing__settings-header-container">
				<div class="calendar-sharing__settings-header">
					<div class="calendar-sharing__settings-title">
						${0}
					</div>
					${0}
				</div>
				<div class="calendar-sharing__settings-header-button">
					${0}
				</div>
			</div>
		`),P.Loc.getMessage("CALENDAR_SHARING_SETTINGS_TITLE_V2"),babelHelpers.classPrivateFieldLooseBase(this,is)[is](),babelHelpers.classPrivateFieldLooseBase(this,os)[os]())}function Ts(){babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].subtitle=P.Tag.render(We||(We=je`
			<div class="calendar-sharing__settings-subtitle">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]());return babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].subtitle}function ws(){if(!babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].subtitle){return}babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].subtitle.innerText=babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]()}function Cs(){if(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].isDefaultRule()){return P.Loc.getMessage("CALENDAR_SHARING_SETTINGS_SUBTITLE_DEFAULT")}return P.Loc.getMessage("CALENDAR_SHARING_SETTINGS_SUBTITLE_PERSONAL")}function Es(){if(this.readOnly){return""}babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].expandRuleArrow=P.Tag.render($e||($e=je`
			<div class="calendar-sharing__settings-select-arrow ${0}"></div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].isCollapsed()?"":"--active");babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].expandRuleButton=P.Tag.render(Ge||(Ge=je`
			<div class="calendar-sharing__settings-expand">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].expandRuleArrow);P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].expandRuleButton,"click",babelHelpers.classPrivateFieldLooseBase(this,ds)[ds].bind(this));return babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].expandRuleButton}function ks(){babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].rule=P.Tag.render(Xe||(Xe=je`
			<div class="calendar-sharing__settings-rule">
				${0}
				<div class="calendar-sharing__settings-slotSize">
					<span class="calendar-sharing__settings-slotSize-title">${0}</span>
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,hs)[hs](),P.Loc.getMessage("CALENDAR_SHARING_SETTINGS_SLOT_SIZE_V2"),babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]());return babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].rule}function Os(){babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]();setTimeout((()=>{P.Dom.toggleClass(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].wrap,"--hide");P.Dom.toggleClass(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].expandRuleArrow,"--active");babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].updateCollapsed(P.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].wrap,"--hide"))}),0)}function As(){P.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].rule,"height",`${babelHelpers.classPrivateFieldLooseBase(this,us)[us]()}px`)}function Is(){var e,s;(e=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].ranges)==null?void 0:e.forEach((e=>e.destroy()));babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].ranges=babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].getRanges().map((e=>babelHelpers.classPrivateFieldLooseBase(this,bs)[bs](e)));const t=P.Tag.render(ze||(ze=je`
			<div class="calendar-sharing__settings-range-list">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].ranges.map((e=>e.render())));(s=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].rangesContainer)==null?void 0:s.replaceWith(t);babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].rangesContainer=t;babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].ranges.forEach((e=>e.updateWeekdaysTitle()));return t}function Ns(e){return new Le({model:e,readOnly:this.readOnly,showReadOnlyPopup:babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps].bind(this)})}function Rs(){babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeText=P.Tag.render(qe||(qe=je`
			<span class="calendar-sharing__settings-select-link">
				${0}
			</span>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].getFormattedSlotSize());babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeSelect=P.Tag.render(Je||(Je=je`
			<span class="calendar-sharing__settings-select-arrow --small-arrow">
				${0}
			</span>
		`),babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeText);P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeSelect,"click",babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].bind(this));this.slotSizeMenu=L.MenuManager.create({id:`calendar-sharing-settings-slotSize${Date.now()}`,bindElement:babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeSelect,items:babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].getRule().getAvailableIntervals().map((e=>({text:g.Util.formatDuration(e),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].setSlotSize(e);babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeText.innerHTML=babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].getFormattedSlotSize();this.slotSizeMenu.close()}}))),closeByEsc:true,events:{onShow:()=>P.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeSelect,"--active"),onClose:()=>P.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeSelect,"--active")}});return babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeSelect}function Ds(){const e=10;const s=2;const t=e+s;const a=15;const i=45;return i*babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].getRule().getRanges().length+(t+a)}function Us(){P.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].rule,"height",null)}function xs(){if(this.readOnly){babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps](babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].slotSizeSelect)}else{this.slotSizeMenu.show()}}function js(e){babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs]();babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls](e).show()}function Ms(e){var s;const t=((s=babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].getCalendarContext())==null?void 0:s.sharingObjectType)==="group"?"CALENDAR_SHARING_SETTINGS_READ_ONLY_HINT_GROUP":"CALENDAR_SHARING_SETTINGS_READ_ONLY_HINT";this.readOnlyPopup=new L.Popup({bindElement:e,className:"calendar-sharing__settings-read-only-hint",content:P.Loc.getMessage(t),angle:{offset:0},width:300,offsetLeft:e.offsetWidth/2,darkMode:true,autoHide:true});P.Event.bind(this.readOnlyPopup.popupContainer,"click",(()=>babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs]()));clearTimeout(this.closePopupTimeout);this.closePopupTimeout=setTimeout((()=>babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs]()),3e3);return this.readOnlyPopup}function Ks(){var e;(e=this.readOnlyPopup)==null?void 0:e.destroy()}let Ws=e=>e,$s;var Gs=babelHelpers.classPrivateFieldLooseKey("bindElement");var Xs=babelHelpers.classPrivateFieldLooseKey("layout");var zs=babelHelpers.classPrivateFieldLooseKey("popup");class qs{constructor(e){Object.defineProperty(this,Gs,{writable:true,value:void 0});Object.defineProperty(this,Xs,{writable:true,value:void 0});Object.defineProperty(this,zs,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs]=e.bindElement;babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs]={};babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]=new L.Popup({bindElement:babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs],bindOptions:{position:"top"},angle:{offset:babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs].offsetWidth/2+24},borderRadius:"24px",width:425,content:this.getContent(),animation:"fading-slide"})}getContent(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs].wrapper){babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs].wrapper=P.Tag.render($s||($s=Ws`
				<div class="calendar-sharing__user-selector-hint-wrapper">
					<div class="calendar-sharing__user-selector-hint-text-wrapper">
						<div class="calendar-sharing__user-selector-hint-text-title">
							${0}
						</div>
						<div class="calendar-sharing__user-selector-hint-text-desc">
							${0}
						</div>
					</div>
					<div class="calendar-sharing__user-selector-hint-icon"></div>
				</div>
			`),P.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_HINT_TITLE"),P.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_HINT_DESC"))}return babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs].wrapper}show(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,zs)[zs])==null?void 0:e.show()}close(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,zs)[zs])==null?void 0:e.close()}}let Js=e=>e,Ys,Qs,Vs,Zs,et,st,tt;var at=babelHelpers.classPrivateFieldLooseKey("layout");var it=babelHelpers.classPrivateFieldLooseKey("userSelectorDialog");var lt=babelHelpers.classPrivateFieldLooseKey("selectedEntityList");var rt=babelHelpers.classPrivateFieldLooseKey("selectedEntityNodeList");var ot=babelHelpers.classPrivateFieldLooseKey("defaultUserEntity");var nt=babelHelpers.classPrivateFieldLooseKey("onMembersAdded");var dt=babelHelpers.classPrivateFieldLooseKey("model");var ct=babelHelpers.classPrivateFieldLooseKey("renderTitle");var ht=babelHelpers.classPrivateFieldLooseKey("getTitleText");var bt=babelHelpers.classPrivateFieldLooseKey("renderCollabAvatar");class pt{constructor(e={}){Object.defineProperty(this,bt,{value:gt});Object.defineProperty(this,ht,{value:vt});Object.defineProperty(this,ct,{value:ut});Object.defineProperty(this,at,{writable:true,value:void 0});Object.defineProperty(this,it,{writable:true,value:void 0});Object.defineProperty(this,lt,{writable:true,value:void 0});Object.defineProperty(this,rt,{writable:true,value:void 0});Object.defineProperty(this,ot,{writable:true,value:void 0});Object.defineProperty(this,nt,{writable:true,value:void 0});Object.defineProperty(this,dt,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,at)[at]={};babelHelpers.classPrivateFieldLooseBase(this,it)[it]=null;babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]={};babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]={};babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]=e.model;babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].getUserInfo();babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=e.onMembersAdded;this.openEntitySelector=this.openEntitySelector.bind(this)}render(){if(!babelHelpers.classPrivateFieldLooseBase(this,at)[at].wrapper){const e=`--${babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].getContext()}`;babelHelpers.classPrivateFieldLooseBase(this,at)[at].wrapper=P.Tag.render(Ys||(Ys=Js`
				<div class="calendar-sharing__user-selector-main ${0}">
					${0}
					${0}
				</div>
			`),e,babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](),this.renderUserSelectorWrapper())}return babelHelpers.classPrivateFieldLooseBase(this,at)[at].wrapper}renderUserSelectorWrapper(){if(!babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelectorWrapper){babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelectorWrapper=P.Tag.render(Qs||(Qs=Js`
				<div class="calendar-sharing__user-selector-wrapper">
					${0}
					<div class="calendar-sharing__user-selector-add">
						<div class="ui-icon-set --plus-20"></div>
					</div>
				</div>
			`),this.renderUserSelector());P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelectorWrapper,"click",this.openEntitySelector)}return babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelectorWrapper}renderUserSelector(){if(!babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelector){const e=this.getDefaultEntityNode();babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelector=P.Tag.render(Vs||(Vs=Js`
				<div class="calendar-sharing__user-selector-container" data-id="calendar-sharing-members">
					${0}
				</div>
			`),e)}return babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelector}getDefaultEntityNode(){const e=this.renderUserEntity(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]);const s=this.getEntityKey(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].id);babelHelpers.classPrivateFieldLooseBase(this,lt)[lt][s]=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot];babelHelpers.classPrivateFieldLooseBase(this,rt)[rt][s]=e;babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].setMemberIds(this.getSelectedUserIdList());return e}renderUserEntity(e){if(e.isCollabUser){return P.Tag.render(Zs||(Zs=Js`
				<div class="calendar-sharing__user-selector-entity-container">
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,bt)[bt](e))}if(this.hasAvatar(e.avatar)){return P.Tag.render(et||(et=Js`
				<div class="calendar-sharing__user-selector-entity-container">
					<img class="calendar-sharing__user-selector-entity" title="${0}" src="${0}" alt="">
				</div>
			`),P.Text.encode(e.name),e.avatar)}return P.Tag.render(st||(st=Js`
			<div class="ui-icon ui-icon-common-user calendar-sharing__user-selector-entity" title="${0}"><i></i></div>
		`),P.Text.encode(e==null?void 0:e.name))}hasAvatar(e){return e&&e!=="/bitrix/images/1.gif"}openEntitySelector(){if(!babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelector){return}const e=["user",babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].id];if(!babelHelpers.classPrivateFieldLooseBase(this,it)[it]){var s;babelHelpers.classPrivateFieldLooseBase(this,it)[it]=new a.Dialog({width:340,targetNode:babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelector,context:"CALENDAR_SHARING",preselectedItems:[e],enableSearch:true,zIndex:4200,events:{"Item:onSelect":e=>{this.onUserSelectorSelect(e)},"Item:onDeselect":e=>{this.onUserSelectorDeselect(e)},onHide:()=>{if(this.hasChanges()){babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]()}}},entities:[{id:"user",options:{intranetUsersOnly:!(((s=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].getCalendarContext())==null?void 0:s.sharingObjectType)==="group"),emailUsers:false,inviteEmployeeLink:false,inviteGuestLink:false,analyticsSource:"calendar"},filters:[{id:"calendar.jointSharingFilter"}]}]})}babelHelpers.classPrivateFieldLooseBase(this,it)[it].show()}isUserSelectorDialogOpened(){if(babelHelpers.classPrivateFieldLooseBase(this,it)[it]){return babelHelpers.classPrivateFieldLooseBase(this,it)[it].isOpen()}return false}onUserSelectorSelect(e){var s;const t=e.data.item;const a=t.customData.get("name")?`${t.customData.get("name")} ${(s=t.customData.get("lastName"))!=null?s:""}`.trim():String(t.customData.get("login"));const i={id:t.id,avatar:t.avatar,name:a,isCollabUser:t.entityType==="collaber"};const l=this.renderUserEntity(i);if(babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelector){P.Dom.append(l,babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelector)}const r=this.getEntityKey(i.id);babelHelpers.classPrivateFieldLooseBase(this,lt)[lt][r]=i;babelHelpers.classPrivateFieldLooseBase(this,rt)[rt][r]=l;babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].setMemberIds(this.getSelectedUserIdList())}onUserSelectorDeselect(e){const s=e.data.item;const t=this.getEntityKey(s.id);const a=babelHelpers.classPrivateFieldLooseBase(this,rt)[rt][t];if(a){P.Dom.remove(a);delete babelHelpers.classPrivateFieldLooseBase(this,lt)[lt][t];delete babelHelpers.classPrivateFieldLooseBase(this,rt)[rt][t]}babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].setMemberIds(this.getSelectedUserIdList())}clearSelectedUsers(){if(babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelector){P.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelector);babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]={};babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]={};const e=this.getDefaultEntityNode();P.Dom.append(e,babelHelpers.classPrivateFieldLooseBase(this,at)[at].userSelector)}if(babelHelpers.classPrivateFieldLooseBase(this,it)[it]){babelHelpers.classPrivateFieldLooseBase(this,it)[it].destroy();babelHelpers.classPrivateFieldLooseBase(this,it)[it]=null}}hasChanges(){return this.getPeopleCount()>1}getPeopleCount(){return Object.keys(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]).length}getSelectedUserIdList(){const e=[];Object.values(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]).forEach((s=>{e.push(s.id)}));return e}getEntityKey(e){return`user-${e}`}}function ut(){if(!babelHelpers.classPrivateFieldLooseBase(this,at)[at].title){babelHelpers.classPrivateFieldLooseBase(this,at)[at].title=P.Tag.render(tt||(tt=Js`
				<div class="calendar-sharing__user-selector-title">
					<div class="calendar-sharing__user-selector-title-icon"></div>
					<div class="calendar-sharing__user-selector-title-text">
						${0}
					</div>
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]());const e=babelHelpers.classPrivateFieldLooseBase(this,at)[at].title.querySelector('[ data-role="calendar-sharing_popup-joint-slots"]');if(e){let s;let t;P.Event.bind(e,"mouseenter",(()=>{t=setTimeout((()=>{if(!s){s=new qs({bindElement:e})}s.show()}),1e3)}));P.Event.bind(e,"mouseleave",(()=>{clearTimeout(t);if(s){s.close()}}))}}return babelHelpers.classPrivateFieldLooseBase(this,at)[at].title}function vt(){switch(babelHelpers.classPrivateFieldLooseBase(this,dt)[dt].getContext()){case"calendar":return P.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_TITLE_V2");case"crm":return P.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_TITLE_CRM");default:return""}}function gt(e){return new i.AvatarRoundGuest({size:36,userName:e.name,userpicPath:this.hasAvatar(e.avatar)&&e.avatar,baseColor:"#19cc45"}).getContainer()}let Pt=e=>e,Lt,Ft,Ht,Bt,yt,ft,mt,_t,St,Tt;const wt=4;var Ct=babelHelpers.classPrivateFieldLooseKey("props");var Et=babelHelpers.classPrivateFieldLooseKey("layout");var kt=babelHelpers.classPrivateFieldLooseKey("avatarPopup");var Ot=babelHelpers.classPrivateFieldLooseKey("deletePopup");class At{constructor(e){Object.defineProperty(this,Ct,{writable:true,value:void 0});Object.defineProperty(this,Et,{writable:true,value:void 0});Object.defineProperty(this,kt,{writable:true,value:void 0});Object.defineProperty(this,Ot,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=e;babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]={};babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=null;babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]=null;this.openAvatarList=this.openAvatarList.bind(this);this.onCopyButtonClick=this.onCopyButtonClick.bind(this);this.onDeleteButtonClick=this.onDeleteButtonClick.bind(this)}render(){if(!babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].wrapper){babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].wrapper=P.Tag.render(Lt||(Lt=Pt`
				<div class="calendar-sharing__dialog-link-list-item">
					${0}
					${0}
					${0}
					${0}
				</div>
			`),this.renderAvatarContainer(),this.renderDate(),this.renderCopyButton(),this.renderDeleteButton())}return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].wrapper}renderAvatarContainer(){if(!babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].avatarContainer){const e=babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].members.length>wt;const s=babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].members.length-wt;babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].avatarContainer=P.Tag.render(Ft||(Ft=Pt`
				<div class="calendar-sharing__dialog-link-list-item-avatar-container">
					${0}
					${0}
					${0}
				</div>
			`),this.renderAvatar(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].userInfo),babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].members.slice(0,wt).map((e=>this.renderAvatar(e))),e?this.renderMore(s):null);P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].avatarContainer,"click",this.openAvatarList)}return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].avatarContainer}renderAvatar(e){var s;const t=`${e.name} ${(s=e.lastName)!=null?s:""}`.trim();if(this.hasAvatar(e.avatar)){return P.Tag.render(Ht||(Ht=Pt`
				<img class="calendar-sharing__dialog-link-list-item-avatar" title="${0}" alt="" src="${0}">
			`),P.Text.encode(t),e.avatar)}return P.Tag.render(Bt||(Bt=Pt`
			<div class="ui-icon ui-icon-common-user calendar-sharing__dialog-link-list-item-avatar" title="${0}"><i></i></div>
		`),P.Text.encode(t))}hasAvatar(e){return e&&e!=="/bitrix/images/1.gif"}renderMore(e){return P.Tag.render(yt||(yt=Pt`
			<div class="calendar-sharing__dialog-link-list-item-more">
				<div class="calendar-sharing__dialog-link-list-item-more-text">${0}</div>
			</div>
		`),`+${e}`)}openAvatarList(){if(!babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]){const e=BX.util.getRandomString(6);babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=L.MenuManager.create({id:`calendar-sharing-dialog_${e}`,bindElement:babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].avatarContainer,bindOptions:{position:"top"},autoHide:true,closeByEsc:true,className:"calendar-sharing__dialog-link-list-user-popup-container",items:this.getAvatarPopupItems(),maxHeight:250,maxWidth:300});babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].getPopupWindow().subscribe("onClose",(()=>{this.setPopupState(false)}));const s=babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].getMenuContainer();let t;P.Event.bind(s,"mouseleave",(()=>{clearTimeout(t);t=setTimeout((()=>{this.closeAvatarList()}),500)}));P.Event.bind(s,"mouseenter",(()=>{clearTimeout(t)}))}babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].show();this.setPopupState(true)}closeAvatarList(){if(babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt].close()}}getAvatarPopupItems(){const e=[];e.push(this.getAvatarPopupItem(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].userInfo));babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].members.forEach((s=>{e.push(this.getAvatarPopupItem(s))}));return e}getAvatarPopupItem(e){var s;const t=e.avatar;const a=`${e.name} ${(s=e.lastName)!=null?s:""}`.trim();const i=babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].pathToUser.replace("#USER_ID#",e.id);return{html:P.Tag.render(ft||(ft=Pt`
				<a href="${0}" target="_blank" class="calendar-sharing__dialog-link-list-user-popup-item">
					<span class="ui-icon ui-icon-common-user calendar-sharing__dialog-link-list-user-popup-item-avatar">
						<i style="${0}"></i>
					</span>
					<div class="calendar-sharing__dialog-link-list-user-popup-item-text">
						${0}
					</div>
				</a>
			`),i,this.hasAvatar(t)?`background-image: url('${t}')`:"",P.Text.encode(a))}}renderDate(){if(!babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].date){const e=babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].dateCreate?new Date(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].dateCreate):new Date;const s=g.Util.formatDate(e);babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].date=P.Tag.render(mt||(mt=Pt`
				<div class="calendar-sharing__dialog-link-list-item-date" title="${0}">${0}</div>
			`),P.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_DATE_CREATE"),s)}return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].date}renderCopyButton(){if(!babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].copyButton){const e=new l.Icon({icon:l.Main.LINK_3,size:14});babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].copyButton=P.Tag.render(_t||(_t=Pt`
				<div class="calendar-sharing__dialog-link-list-item-copy-container">
					${0}
					<div class="calendar-sharing__dialog-link-list-item-copy-text">${0}</div>
				</div>
			`),e.render(),P.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_COPY"));P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].copyButton,"click",this.onCopyButtonClick)}return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].copyButton}onCopyButtonClick(){H.EventEmitter.emit("CalendarSharing:onJointLinkCopy",{id:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].id,shortUrl:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].shortUrl,hash:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].hash,members:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].members})}renderDeleteButton(){if(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].members.length===0){return P.Tag.render(St||(St=Pt`<div class="calendar-sharing__dialog-link-list-item-delete"></div>`))}if(!babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].deleteButton){const e=new l.Icon({icon:l.Actions.CROSS_30,size:18});babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].deleteButton=P.Tag.render(Tt||(Tt=Pt`
				<div class="calendar-sharing__dialog-link-list-item-delete">
					${0}
				</div>
			`),e.render());P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].deleteButton,"click",this.onDeleteButtonClick)}return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].deleteButton}onDeleteButtonClick(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]){babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]=new r.MessageBox({title:P.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_DELETE_MESSAGE_TITLE_MSGVER_1"),message:P.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_DELETE_MESSAGE_DESC_MSGVER_1"),buttons:this.getDeletePopupButtons(),popupOptions:{autoHide:true,closeByEsc:true,draggable:false,closeIcon:true,minWidth:365,maxWidth:385,minHeight:180}})}babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].show();this.setPopupState(true)}getDeletePopupButtons(){return[new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.DANGER,text:P.Loc.getMessage("SHARING_WARNING_POPUP_SUBMIT_BUTTON_NEW_MSGVER_1"),events:{click:()=>{this.deleteLink();babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].close();this.setPopupState(false)}}}),new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:P.Loc.getMessage("SHARING_WARNING_POPUP_CANCEL_BUTTON"),events:{click:()=>{babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].close();this.setPopupState(false)}}})]}deleteLink(){if(babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].wrapper){BX.ajax.runAction("calendar.api.sharingajax.disableUserLink",{data:{hash:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].hash}});P.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].wrapper,"--animate-delete");setTimeout((()=>{P.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].wrapper)}),300);H.EventEmitter.emit("CalendarSharing:onJointLinkDelete",{id:babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].id})}}setPopupState(e){var s;(s=babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct])==null?void 0:s.setListItemPopupState(e)}}let It=e=>e,Nt,Rt,Dt,Ut,xt,jt,Mt,Kt;const Wt=300;const $t=45;var Gt=babelHelpers.classPrivateFieldLooseKey("props");var Xt=babelHelpers.classPrivateFieldLooseKey("layout");var zt=babelHelpers.classPrivateFieldLooseKey("linkList");var qt=babelHelpers.classPrivateFieldLooseKey("popupOpenState");var Jt=babelHelpers.classPrivateFieldLooseKey("pathToUser");var Yt=babelHelpers.classPrivateFieldLooseKey("model");var Qt=babelHelpers.classPrivateFieldLooseKey("getSortingName");class Vt{constructor(e){Object.defineProperty(this,Qt,{value:ea});Object.defineProperty(this,Yt,{get:Zt,set:void 0});Object.defineProperty(this,Gt,{writable:true,value:void 0});Object.defineProperty(this,Xt,{writable:true,value:void 0});Object.defineProperty(this,zt,{writable:true,value:void 0});Object.defineProperty(this,qt,{writable:true,value:false});Object.defineProperty(this,Jt,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]=e;babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]={};babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]=null;babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt]=null;this.getLinkListInfo();this.setListItemPopupState=this.setListItemPopupState.bind(this);this.eventSubscribe()}eventSubscribe(){H.EventEmitter.subscribe("CalendarSharing:onJointLinkCopy",(e=>{this.onJointLinkCopy(e)}));H.EventEmitter.subscribe("CalendarSharing:onJointLinkDelete",(e=>{this.onJointLinkDelete(e)}))}getLinkListInfo(){BX.ajax.runAction("calendar.api.sharingajax.getAllUserLink").then((e=>{if(e&&e.data){babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]=e.data.userLinks;babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt]=e.data.pathToUser;this.updateLinkList();if(this.isListEmpty()){this.hideSortingButton();return}if(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]){this.showSortingButton()}}}))}render(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].wrapper){babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].wrapper=P.Tag.render(Nt||(Nt=It`
				<div class="calendar-sharing__dialog-link-list-wrapper">
					${0}
					${0}
				</div>
			`),this.getTitleNode(),this.getListNode())}return babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].wrapper}getTitleNode(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].title){babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].title=P.Tag.render(Rt||(Rt=It`
				<div class="calendar-sharing__dialog-link-list-title-wrapper">
					<div class="calendar-sharing__dialog-link-list-title">
						${0}
						<div class="calendar-sharing__dialog-link-list-title-text">
							${0}
						</div>
					</div>
					${0}
				</div>
			`),this.getChevronBackIcon(),P.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_TITLE"),this.getSortingButton())}return babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].title}getChevronBackIcon(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].backButton){const e=new l.Icon({icon:l.Actions.CHEVRON_LEFT,size:24});babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].backButton=P.Tag.render(Dt||(Dt=It`
				<div class="calendar-sharing__dialog-link-list-back-button">
					${0}
				</div>
			`),e.render());P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].backButton,"click",this.close.bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].backButton}getSortingButton(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButton){const e=new l.Icon({icon:l.Actions.SORT,size:14,color:"#2066b0"});babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButton=P.Tag.render(Ut||(Ut=It`
				<div class="calendar-sharing__dialog-link-list-sorting-button">
					${0}
					${0}
				</div>
			`),e.render(),this.getSortingButtonText());P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButton,"click",this.changeListSort.bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButton}getSortingButtonText(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButtonText){babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButtonText=P.Tag.render(xt||(xt=It`
				<div class="calendar-sharing__dialog-link-list-sorting-button-text">
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]())}return babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButtonText}getListNode(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].list){babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].list=P.Tag.render(jt||(jt=It`
				<div class="calendar-sharing__dialog-link-list-container">
					${0}
				</div>
			`),this.getListItemsNode())}return babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].list}getListItemsNode(){if(this.isListEmpty()){return this.getEmptyStateNode()}const e=this.getListItems();return P.Tag.render(Mt||(Mt=It`
			<div class="calendar-sharing__dialog-link-list">
				${0}
			</div>
		`),e.map((e=>e.render())))}getEmptyStateNode(){if(!babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].emptyState){babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].emptyState=P.Tag.render(Kt||(Kt=It`
				<div class="calendar-sharing__dialog-link-list-empty-state-wrapper">
					<div class="calendar-sharing__dialog-link-list-empty-state-icon"></div>
					<div class="calendar-sharing__dialog-link-list-empty-state-text">${0}</div>
				</div>
			`),P.Loc.getMessage("CALENDAR_SHARING_LIST_EMPTY_TITLE"))}return babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].emptyState}getListItems(){if(babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].sortJointLinksByFrequentUse()){return this.getSortedByFrequentUseListItems()}return this.getSortedByDateListItems()}getSortedByFrequentUseListItems(){return Object.values(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]).sort(((e,s)=>{if(e.frequentUse>s.frequentUse){return-1}if(e.frequentUse<s.frequentUse){return 1}if(e.id>s.id){return-1}if(e.id<s.id){return 1}return 0})).map((e=>new At({...e,userInfo:babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].getUserInfo(),pathToUser:babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt],setListItemPopupState:this.setListItemPopupState})))}getSortedByDateListItems(){return Object.keys(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]).sort(((e,s)=>s-e)).map((e=>new At({...babelHelpers.classPrivateFieldLooseBase(this,zt)[zt][e],userInfo:babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].getUserInfo(),pathToUser:babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt],setListItemPopupState:this.setListItemPopupState})))}show(e){if(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].list&&e){P.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].list,"max-height",`${e-$t}px`)}if(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].wrapper){P.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].wrapper,"--show")}}close(){if(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].list){P.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].list,"max-height",`${Wt}px`)}if(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].wrapper){P.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].wrapper,"--show")}if(babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].onLinkListClose){babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].onLinkListClose()}}updateLinkList(){if(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].list){P.Dom.clean(this.getListNode());const e=this.getListItemsNode();P.Dom.append(e,babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].list)}}changeListSort(){babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].changeSortJointLinksByFrequentUse();if(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButtonText){P.Dom.adjust(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButtonText,{text:babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]()})}this.updateLinkList()}setListItemPopupState(e){babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]=e}isOpenListItemPopup(){return babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]}onJointLinkCopy(e){const s=e.data.id;const t=e.data.hash;setTimeout((()=>{if(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt][s]){babelHelpers.classPrivateFieldLooseBase(this,zt)[zt][s].frequentUse=babelHelpers.classPrivateFieldLooseBase(this,zt)[zt][s].frequentUse+1;this.updateLinkList()}}),1e3);BX.ajax.runAction("calendar.api.sharingajax.increaseFrequentUse",{data:{hash:t}})}onJointLinkDelete(e){const s=e.data.id;if(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt][s]){delete babelHelpers.classPrivateFieldLooseBase(this,zt)[zt][s]}if(this.isListEmpty()){this.updateLinkList();this.hideSortingButton()}}isListEmpty(){return P.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt])||P.Type.isArray(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt])&&!P.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt])||P.Type.isObject(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt])&&!Object.keys(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]).length}hideSortingButton(){if(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButton){P.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButton,"--hide")}}showSortingButton(){if(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButton){P.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortingButton,"--hide")}}}function Zt(){return babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].model}function ea(){return babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].sortJointLinksByFrequentUse()?P.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_SORT_RECENT"):P.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_SORT_DATE")}let sa=e=>e,ta,aa,ia,la,ra,oa,na,da;var ca=babelHelpers.classPrivateFieldLooseKey("params");var ha=babelHelpers.classPrivateFieldLooseKey("layout");var ba=babelHelpers.classPrivateFieldLooseKey("settingsControl");var pa=babelHelpers.classPrivateFieldLooseKey("userSelectorControl");var ua=babelHelpers.classPrivateFieldLooseKey("linkList");var va=babelHelpers.classPrivateFieldLooseKey("settingsModel");var ga=babelHelpers.classPrivateFieldLooseKey("bindEvents");var Pa=babelHelpers.classPrivateFieldLooseKey("renderMain");var La=babelHelpers.classPrivateFieldLooseKey("renderDialogMessage");var Fa=babelHelpers.classPrivateFieldLooseKey("onOpenLink");var Ha=babelHelpers.classPrivateFieldLooseKey("renderTop");var Ba=babelHelpers.classPrivateFieldLooseKey("renderHowDoesItWorkIcon");var ya=babelHelpers.classPrivateFieldLooseKey("openHelpDesk");var fa=babelHelpers.classPrivateFieldLooseKey("getSharingInfoMessage");var ma=babelHelpers.classPrivateFieldLooseKey("getContextHelpDeskCode");var _a=babelHelpers.classPrivateFieldLooseKey("renderSettings");var Sa=babelHelpers.classPrivateFieldLooseKey("renderMembers");var Ta=babelHelpers.classPrivateFieldLooseKey("renderMainBottom");var wa=babelHelpers.classPrivateFieldLooseKey("renderCopyLinkButton");var Ca=babelHelpers.classPrivateFieldLooseKey("onButtonCopyClick");var Ea=babelHelpers.classPrivateFieldLooseKey("renderLinkHistoryButton");var ka=babelHelpers.classPrivateFieldLooseKey("renderLinkList");var Oa=babelHelpers.classPrivateFieldLooseKey("getLinkList");var Aa=babelHelpers.classPrivateFieldLooseKey("openLinkList");var Ia=babelHelpers.classPrivateFieldLooseKey("closeLinkList");var Na=babelHelpers.classPrivateFieldLooseKey("copyToClipboard");class Ra{constructor(e){var s;Object.defineProperty(this,Na,{value:ai});Object.defineProperty(this,Ia,{value:ti});Object.defineProperty(this,Aa,{value:si});Object.defineProperty(this,Oa,{value:ei});Object.defineProperty(this,ka,{value:Za});Object.defineProperty(this,Ea,{value:Va});Object.defineProperty(this,Ca,{value:Qa});Object.defineProperty(this,wa,{value:Ya});Object.defineProperty(this,Ta,{value:Ja});Object.defineProperty(this,Sa,{value:qa});Object.defineProperty(this,_a,{value:za});Object.defineProperty(this,ma,{value:Xa});Object.defineProperty(this,fa,{value:Ga});Object.defineProperty(this,ya,{value:$a});Object.defineProperty(this,Ba,{value:Wa});Object.defineProperty(this,Ha,{value:Ka});Object.defineProperty(this,Fa,{value:Ma});Object.defineProperty(this,La,{value:ja});Object.defineProperty(this,Pa,{value:xa});Object.defineProperty(this,ga,{value:Ua});Object.defineProperty(this,va,{get:Da,set:void 0});this.HELP_DESK_CODE_CALENDAR=17198666;this.HELP_DESK_CODE_CRM=17502612;this.CONTEXT={CRM:"crm",CALENDAR:"calendar"};Object.defineProperty(this,ca,{writable:true,value:void 0});Object.defineProperty(this,ha,{writable:true,value:void 0});Object.defineProperty(this,ba,{writable:true,value:void 0});Object.defineProperty(this,pa,{writable:true,value:void 0});Object.defineProperty(this,ua,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ca)[ca]=e;babelHelpers.classPrivateFieldLooseBase(this,ha)[ha]={};babelHelpers.classPrivateFieldLooseBase(this,ga)[ga]();this.isGroupContext=((s=e.settingsModel.getCalendarContext())==null?void 0:s.sharingObjectType)==="group"}reset(){var e;void babelHelpers.classPrivateFieldLooseBase(this,va)[va].save();(e=babelHelpers.classPrivateFieldLooseBase(this,pa)[pa])==null?void 0:e.clearSelectedUsers();setTimeout((()=>{var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,ua)[ua])==null?void 0:e.close()}),200)}hasShownPopups(){var e,s;const t=babelHelpers.classPrivateFieldLooseBase(this,ba)[ba].hasShownPopups();const a=(e=babelHelpers.classPrivateFieldLooseBase(this,pa)[pa])==null?void 0:e.isUserSelectorDialogOpened();const i=(s=babelHelpers.classPrivateFieldLooseBase(this,ua)[ua])==null?void 0:s.isOpenListItemPopup();return t||a||i}render(){babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].wrap=P.Tag.render(ta||(ta=sa`
			<div class="calendar-sharing__dialog-wrapper">
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Pa)[Pa](),this.isGroupContext?null:babelHelpers.classPrivateFieldLooseBase(this,ka)[ka]());return babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].wrap}async saveJointLink(){var e;if(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonCopy&&P.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonCopy,"ui-btn-clock")){return}P.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonCopy,"ui-btn-clock");const s=await babelHelpers.classPrivateFieldLooseBase(this,va)[va].saveJointLink();P.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonCopy,"ui-btn-clock");await this.copyLink(s.url,s.hash);(e=babelHelpers.classPrivateFieldLooseBase(this,ua)[ua])==null?void 0:e.getLinkListInfo()}async copyLink(e,s){if(!e){return false}try{await babelHelpers.classPrivateFieldLooseBase(this,Na)[Na](e)}catch{return false}g.Util.showNotification(P.Loc.getMessage("SHARING_COPY_LINK_NOTIFICATION"));H.EventEmitter.emit("CalendarSharing:LinkCopied",{url:e,hash:s});return true}}function Da(){return babelHelpers.classPrivateFieldLooseBase(this,ca)[ca].settingsModel}function Ua(){P.Event.bind(window,"beforeunload",(()=>babelHelpers.classPrivateFieldLooseBase(this,va)[va].save()));H.EventEmitter.subscribe("CalendarSharing:onJointLinkCopy",(async e=>{const s=e.data.shortUrl;const a=e.data.hash;await this.copyLink(s,a);t.Analytics.sendLinkCopiedList(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getContext(),{peopleCount:e.data.members.length+1,ruleChanges:babelHelpers.classPrivateFieldLooseBase(this,va)[va].getChanges()})}))}function xa(){var e,s;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,ha)[ha]).main)!=null?s:e.main=P.Tag.render(aa||(aa=sa`
			<div class="calendar-sharing__dialog-content-wrapper --show">
				${0}
				<div class="calendar-sharing__dialog-body">
					${0}
					${0}
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ha)[Ha](),babelHelpers.classPrivateFieldLooseBase(this,La)[La](),babelHelpers.classPrivateFieldLooseBase(this,_a)[_a](),babelHelpers.classPrivateFieldLooseBase(this,Sa)[Sa](),babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta]());return babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].main}function ja(){if(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getContext()===this.CONTEXT.CRM||this.isGroupContext){return""}return P.Tag.render(ia||(ia=sa`
			<div class="calendar-sharing__dialog-message">
				<div class="calendar-sharing__dialog-info-icon-container">
					<div class="calendar-sharing__dialog-info-icon"></div>
				</div>
				<div class="calendar-sharing__dialog-notify" onclick="${0}">
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa].bind(this),P.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_4_V3",{"#LINK#":babelHelpers.classPrivateFieldLooseBase(this,va)[va].getSharingUrl()}))}async function Ma(){await babelHelpers.classPrivateFieldLooseBase(this,va)[va].save();window.open(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getSharingUrl(),"_blank").focus()}function Ka(){if(!babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].mainTop){var e;babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].mainTop=P.Tag.render(la||(la=sa`
				<div class="calendar-sharing__dialog-top">
					<div class="calendar-sharing__dialog-title">
						<span>${0}</span>
						${0}
						${0}
					</div>
					<div class="calendar-sharing__dialog-info">
						${0}
					</div>
				</div>
			`),P.Loc.getMessage("SHARING_BUTTON_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba](),(e=babelHelpers.classPrivateFieldLooseBase(this,ca)[ca].externalIcon)!=null?e:"",babelHelpers.classPrivateFieldLooseBase(this,fa)[fa]());const s=babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].mainTop.querySelector('[data-role="calendar-sharing-how-does-it-work"]');P.Event.bind(s,"click",babelHelpers.classPrivateFieldLooseBase(this,ya)[ya].bind(this));const t=babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].mainTop.querySelector('[data-role="calendar-sharing_popup-open-link"]');if(t){let e;let s;P.Event.bind(t,"mouseenter",(()=>{s=setTimeout((()=>{if(!e){e=new L.Popup({bindElement:t,angle:{offset:t.offsetWidth/2+16},width:410,darkMode:true,content:P.Loc.getMessage("SHARING_INFO_POPUP_SLOT_DESC"),animation:"fading-slide"})}e.show()}),1e3)}));P.Event.bind(t,"mouseleave",(()=>{clearTimeout(s);if(e){e.close()}}))}}return babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].mainTop}function Wa(){if(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getContext()===this.CONTEXT.CRM){return""}const e=P.Tag.render(ra||(ra=sa`
			<span
				class="calendar-sharing__dialog-title-help"
				title="${0}"
			></span>
		`),P.Loc.getMessage("SHARING_INFO_POPUP_HOW_IT_WORK"));P.Event.bind(e,"click",babelHelpers.classPrivateFieldLooseBase(this,ya)[ya].bind(this));return e}function $a(){top.BX.Helper.show(`redirect=detail&code=${babelHelpers.classPrivateFieldLooseBase(this,ma)[ma]()}`)}function Ga(){switch(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getContext()){case this.CONTEXT.CALENDAR:return P.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_3_CALENDAR");case this.CONTEXT.CRM:return P.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_3_CRM_MSGVER_2");default:return""}}function Xa(){switch(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getContext()){case this.CONTEXT.CALENDAR:return this.HELP_DESK_CODE_CALENDAR;case this.CONTEXT.CRM:return this.HELP_DESK_CODE_CRM;default:return 0}}function za(){babelHelpers.classPrivateFieldLooseBase(this,ba)[ba]=new Hs({readOnly:babelHelpers.classPrivateFieldLooseBase(this,ca)[ca].readOnly,model:babelHelpers.classPrivateFieldLooseBase(this,va)[va]});return babelHelpers.classPrivateFieldLooseBase(this,ba)[ba].render()}function qa(){babelHelpers.classPrivateFieldLooseBase(this,pa)[pa]=new pt({model:babelHelpers.classPrivateFieldLooseBase(this,va)[va],onMembersAdded:()=>t.Analytics.sendMembersAdded(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getContext(),babelHelpers.classPrivateFieldLooseBase(this,pa)[pa].getPeopleCount())});return babelHelpers.classPrivateFieldLooseBase(this,pa)[pa].render()}function Ja(){var e,s;if(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getContext()===this.CONTEXT.CRM){return""}(s=(e=babelHelpers.classPrivateFieldLooseBase(this,ha)[ha]).mainBottom)!=null?s:e.mainBottom=P.Tag.render(oa||(oa=sa`
			<div class="calendar-sharing__dialog-bottom">
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,wa)[wa](),this.isGroupContext?null:babelHelpers.classPrivateFieldLooseBase(this,Ea)[Ea]());return babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].mainBottom}function Ya(){if(!babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonCopy){babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonCopy=P.Tag.render(na||(na=sa`
				<span class="ui-btn ui-btn-success ui-btn-round ui-btn-no-caps calendar-sharing__dialog-copy">
					${0}
				</span>
			`),P.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_COPY_LINK_BUTTON"));P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonCopy,"click",babelHelpers.classPrivateFieldLooseBase(this,Ca)[Ca].bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonCopy}async function Qa(){var e,s;const a={peopleCount:(e=(s=babelHelpers.classPrivateFieldLooseBase(this,pa)[pa])==null?void 0:s.getPeopleCount())!=null?e:1,ruleChanges:babelHelpers.classPrivateFieldLooseBase(this,va)[va].getChanges()};if(babelHelpers.classPrivateFieldLooseBase(this,pa)[pa]&&babelHelpers.classPrivateFieldLooseBase(this,pa)[pa].hasChanges()){t.Analytics.sendLinkCopied(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getContext(),t.Analytics.linkTypes.multiple,a);void this.saveJointLink()}else if(await this.copyLink(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getSharingUrl())){t.Analytics.sendLinkCopied(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getContext(),t.Analytics.linkTypes.solo,a);if(!this.isGroupContext){babelHelpers.classPrivateFieldLooseBase(this,va)[va].increaseFrequentUse()}}}function Va(){if(!babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonHistory){babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonHistory=P.Tag.render(da||(da=sa`
				<span
					class="ui-btn ui-btn-round ui-btn-light ui-btn-no-caps calendar-sharing__dialog-people"
					data-id="calendar-sharing-history-btn"
				>
					${0}
				</span>
			`),P.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_JOINT_SLOTS_BUTTON"));P.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonHistory,"click",babelHelpers.classPrivateFieldLooseBase(this,Aa)[Aa].bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].buttonHistory}function Za(){if(babelHelpers.classPrivateFieldLooseBase(this,va)[va].getContext()===this.CONTEXT.CRM){return null}return babelHelpers.classPrivateFieldLooseBase(this,Oa)[Oa]().render()}function ei(){var e,s;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,ua))[ua])!=null?s:e[ua]=new Vt({model:babelHelpers.classPrivateFieldLooseBase(this,va)[va],onLinkListClose:babelHelpers.classPrivateFieldLooseBase(this,Ia)[Ia].bind(this)});return babelHelpers.classPrivateFieldLooseBase(this,ua)[ua]}function si(){P.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].main,"--show");babelHelpers.classPrivateFieldLooseBase(this,ua)[ua].show(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].main.offsetHeight)}function ti(){P.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].main,"--show")}async function ai(e){var s;if(!P.Type.isString(e)){return Promise.reject()}if(navigator.clipboard){return new Promise(((s,t)=>{setTimeout((()=>navigator.clipboard.writeText(e).then((()=>s())).catch((e=>t(e)))),0)}))}return(s=BX.clipboard)!=null&&s.copy(e)?Promise.resolve():Promise.reject()}var ii=babelHelpers.classPrivateFieldLooseKey("popup");var li=babelHelpers.classPrivateFieldLooseKey("layout");var ri=babelHelpers.classPrivateFieldLooseKey("dialogLayout");var oi=babelHelpers.classPrivateFieldLooseKey("settingsModel");var ni=babelHelpers.classPrivateFieldLooseKey("isExternalSharing");var di=babelHelpers.classPrivateFieldLooseKey("getAngleConfig");class ci{constructor(e){Object.defineProperty(this,di,{value:bi});Object.defineProperty(this,ni,{value:hi});Object.defineProperty(this,ii,{writable:true,value:void 0});Object.defineProperty(this,li,{writable:true,value:void 0});Object.defineProperty(this,ri,{writable:true,value:void 0});Object.defineProperty(this,oi,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,li)[li]={};babelHelpers.classPrivateFieldLooseBase(this,li)[li].bindElement=e.bindElement;babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]=new I({context:e.context,linkHash:e.linkHash,sharingUrl:e.sharingUrl,userInfo:e.userInfo,rule:e.sharingRule,calendarSettings:e.calendarSettings,collapsed:e.settingsCollapsed,sortJointLinksByFrequentUse:e.sortJointLinksByFrequentUse,calendarContext:e.calendarContext});this.bindEvents()}bindEvents(){H.EventEmitter.subscribe("CalendarSharing:LinkCopied",this.onSuccessfulCopyingLink.bind(this));H.EventEmitter.subscribe("SidePanel.Slider:onClose",(e=>this.checkAndClosePopupOnSlider(e)))}getPopup(){if(!babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]){babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]=new L.Popup({bindElement:babelHelpers.classPrivateFieldLooseBase(this,li)[li].bindElement,targetContainer:document.body,className:"calendar-sharing__dialog",closeByEsc:true,autoHide:true,padding:0,width:470,angle:babelHelpers.classPrivateFieldLooseBase(this,di)[di](),autoHideHandler:e=>this.canBeClosed(e),content:this.getPopupWrapper(),animation:"fading-slide",events:{onPopupShow:this.onPopupShow.bind(this),onPopupClose:this.onPopupClose.bind(this)}})}return babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]}onPopupShow(){P.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,li)[li].bindElement,"ui-btn-hover");t.Analytics.sendPopupOpened(babelHelpers.classPrivateFieldLooseBase(this,oi)[oi].getContext())}onPopupClose(){P.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,li)[li].bindElement,"ui-btn-hover");babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].reset()}canBeClosed(e){const s=babelHelpers.classPrivateFieldLooseBase(this,li)[li].wrapper.contains(e.target);const t=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].hasShownPopups();const a=this.getTopSlider();const i=a&&this.getCalendarSliderParams(a);return!s&&!t&&(!a||i||babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]())}getPopupWrapper(){if(!babelHelpers.classPrivateFieldLooseBase(this,li)[li].wrapper){var e;babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]=new Ra({readOnly:((e=babelHelpers.classPrivateFieldLooseBase(this,oi)[oi].getCalendarContext())==null?void 0:e.sharingObjectType)==="group",settingsModel:babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]});babelHelpers.classPrivateFieldLooseBase(this,li)[li].wrapper=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].render()}babelHelpers.classPrivateFieldLooseBase(this,li)[li].wrapper=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri].render();return babelHelpers.classPrivateFieldLooseBase(this,li)[li].wrapper}onSuccessfulCopyingLink(){this.closePopup()}closePopup(){this.getPopup().close()}isShown(){return this.getPopup().isShown()}show(){babelHelpers.classPrivateFieldLooseBase(this,oi)[oi].sortRanges();this.getPopup().adjustPosition({forceBindPosition:true});this.getPopup().show()}destroy(){this.getPopup().destroy()}getTopSlider(){return babelHelpers.classPrivateFieldLooseBase(this,oi)[oi].getContext()==="calendar"?BX.SidePanel.Instance.getTopSlider():false}getCalendarSliderParams(e){var s;return(s=e.iframeSrc)==null?void 0:s.match(/\/workgroups\/group\/(\d+)\/calendar\//i)}checkAndClosePopupOnSlider(e){var s;if(!this.isShown()){return}const t=e.getData()&&((s=e.getData()[0])==null?void 0:s.slider);const a=t&&this.getCalendarSliderParams(t);if(!a){return}const i=parseInt(a[1],10);if(!i){return}const l=babelHelpers.classPrivateFieldLooseBase(this,oi)[oi].getCalendarContext().sharingObjectId;if(i!==l){return}this.closePopup()}}function hi(){var e;return Boolean((e=babelHelpers.classPrivateFieldLooseBase(this,oi)[oi].getCalendarContext())==null?void 0:e.externalSharing)}function bi(){if(babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]()){return null}return{offset:babelHelpers.classPrivateFieldLooseBase(this,li)[li].bindElement.offsetWidth/2+16}}let pi=e=>e,ui,vi,gi;class Pi{constructor(e={}){var s,t,a;this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY=1e3;this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST="first-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_NEW="new-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND="remind-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_JOINT="joint-sharing";this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS=[this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST];this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS=[this.PAY_ATTENTION_TO_NEW_FEATURE_NEW,this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND];this.wrap=e.wrap;this.userInfo=e.userInfo||null;this.sharingConfig=g.Util.getSharingConfig();this.sharingUrl=((s=this.sharingConfig)==null?void 0:s.url)||null;this.linkHash=((t=this.sharingConfig)==null?void 0:t.hash)||null;this.sharingRule=((a=this.sharingConfig)==null?void 0:a.rule)||null;this.payAttentionToNewFeatureMode=e.payAttentionToNewFeature;this.sharingFeatureLimit=e.sharingFeatureLimit;this.sharingSettingsCollapsed=e.sharingSettingsCollapsed;this.sortJointLinksByFrequentUse=e.sortJointLinksByFrequentUse}show(){P.Dom.addClass(this.wrap,"calendar-sharing__btn-wrap");this.button=new o.Button({text:P.Loc.getMessage("SHARING_BUTTON_TITLE"),round:true,size:o.ButtonSize.EXTRA_SMALL,color:o.ButtonColor.LIGHT_BORDER,icon:this.sharingFeatureLimit?o.ButtonIcon.LOCK:null,className:"ui-btn-themes calendar-sharing__btn",onclick:(e,s)=>{if(!this.switcher.getNode().contains(s.target)){this.handleSharingButtonClick()}}});this.button.renderTo(this.wrap);this.renderSwitcher();if(this.payAttentionToNewFeatureMode===this.PAY_ATTENTION_TO_NEW_FEATURE_JOINT){setTimeout((()=>{if(BX.SidePanel.Instance.getTopSlider()===null){this.payAttentionToNewFeatureWithText();BX.ajax.runAction("calendar.api.sharingajax.disableOptionPayAttentionToNewSharingFeature")}}),this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY)}}handleSharingButtonClick(){if(this.sharingFeatureLimit){v.FeaturePromotersRegistry.getPromoter({featureId:"calendar_sharing"}).show();return}if(this.isSharingEnabled()){this.openDialog()}else{this.switcher.toggle()}}getSwitcherContainer(){return P.Tag.render(ui||(ui=pi`
			<div class="calendar-sharing__switcher"></div>
		`))}getSwitcherDivider(){return P.Tag.render(vi||(vi=pi`
			<div class="calendar-sharing__switcher_divider"></div>
		`))}renderSwitcher(){P.Dom.append(this.getSwitcherDivider(),this.wrap);this.switcherWrap=P.Tag.render(gi||(gi=pi`<div class="calendar-sharing__switcher-wrap"></div>`));P.Dom.append(this.switcherWrap,this.wrap);P.Event.bind(this.switcherWrap,"click",this.handleSwitcherWrapClick.bind(this),{capture:true});this.switcher=new BX.UI.Switcher({node:this.getSwitcherContainer(),checked:this.isSharingEnabled()&&!this.sharingFeatureLimit,color:"green",size:"small",handlers:{toggled:()=>this.handleSwitcherToggled()}});this.switcher.renderTo(this.switcherWrap)}handleSwitcherWrapClick(e){if(this.switcher.isChecked()){this.showWarningPopup();e.stopPropagation()}}handleSwitcherToggled(){if(this.sharingFeatureLimit&&this.switcher.isChecked()){v.FeaturePromotersRegistry.getPromoter({featureId:"calendar_sharing"}).show();this.switcher.toggle();return}if(this.isToggledAfterErrorOccurred()){return}if(this.switcher.isChecked()){this.enableSharing()}else{this.disableSharing()}}isToggledAfterErrorOccurred(){return this.switcher.isChecked()===this.isSharingEnabled()}isSharingEnabled(){return P.Type.isString(this.sharingUrl)}enableSharing(){const e="calendar.api.sharingajax.enableUserSharing";const s="Calendar.Sharing.copyLinkButton:onSharingEnabled";BX.ajax.runAction(e).then((e=>{this.sharingUrl=e.data.url;this.linkHash=e.data.hash;this.sharingRule=e.data.rule;this.openDialog();H.EventEmitter.emit(s,{isChecked:this.switcher.isChecked(),url:e.data.url})})).catch((()=>{this.switcher.toggle()}))}openDialog(){var e;(e=this.pulsar)==null?void 0:e.close();P.Dom.remove(this.counterNode);if(!this.newDialog){this.newDialog=new ci({bindElement:this.button.getContainer(),sharingUrl:this.sharingUrl,linkHash:this.linkHash,sharingRule:this.sharingRule,context:"calendar",calendarSettings:{weekHolidays:g.Util.config.week_holidays,weekStart:g.Util.config.week_start,workTimeStart:g.Util.config.work_time_start,workTimeEnd:g.Util.config.work_time_end},userInfo:this.userInfo,settingsCollapsed:this.sharingSettingsCollapsed,sortJointLinksByFrequentUse:this.sortJointLinksByFrequentUse})}if(!this.newDialog.isShown()){this.newDialog.show()}}disableSharing(){const e="calendar.api.sharingajax.disableUserSharing";const s="Calendar.Sharing.copyLinkButton:onSharingDisabled";this.warningPopup.close();BX.ajax.runAction(e).then((()=>{this.sharingUrl=null;if(this.newDialog){this.newDialog.destroy();this.newDialog=null}H.EventEmitter.emit(s,{isChecked:this.switcher.isChecked()})})).catch((()=>{this.switcher.toggle()}))}showWarningPopup(){if(!this.warningPopup){this.warningPopup=new r.MessageBox({title:P.Loc.getMessage("SHARING_WARNING_POPUP_TITLE_1"),message:P.Loc.getMessage("SHARING_WARNING_POPUP_CONTENT_2"),buttons:this.getWarningPopupButtons(),popupOptions:{autoHide:true,closeByEsc:true,draggable:false,closeIcon:true,minWidth:365,maxWidth:385,minHeight:180}})}this.warningPopup.show()}getWarningPopupButtons(){return[this.getSubmitButton(),this.getCancelButton()]}getSubmitButton(){return new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.DANGER,text:P.Loc.getMessage("SHARING_WARNING_POPUP_SUBMIT_BUTTON_NEW_MSGVER_1"),events:{click:()=>this.handleSubmitButtonClick()}})}getCancelButton(){return new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:P.Loc.getMessage("SHARING_WARNING_POPUP_CANCEL_BUTTON"),events:{click:()=>this.handleCancelButtonClick()}})}handleSubmitButtonClick(){this.switcher.toggle();this.warningPopup.close()}handleCancelButtonClick(){this.warningPopup.close()}payAttentionToNewFeature(e){if(this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS.includes(e)){this.payAttentionToNewFeatureWithoutText()}if(this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS.includes(e)){this.payAttentionToNewFeatureWithText()}}payAttentionToNewFeatureWithoutText(){this.pulsar=this.getPulsar(this.wrap,false);this.pulsar.show();P.Event.bind(this.pulsar.container,"click",(()=>{this.handleSharingButtonClick()}));this.counterNode=new u.Counter({value:1,color:u.Counter.Color.DANGER,size:u.Counter.Size.MEDIUM,animation:false}).getContainer();P.Dom.addClass(this.counterNode,"calendar-sharing__new-feature-counter");P.Dom.append(this.counterNode,this.wrap)}payAttentionToNewFeatureWithText(){const e=P.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_JOINT_TITLE");const s=P.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_JOINT_TEXT");const t=this.getGuide(e,s);const a=this.getPulsar(this.wrap);t.showNextStep();t.getPopup().setAngle({offset:210});a.show()}getGuide(e,s){const t=new p.Guide({simpleMode:true,onEvents:true,steps:[{target:this.wrap,title:e,text:s,position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});const a=t.getPopup();P.Dom.addClass(a.popupContainer,"calendar-popup-ui-tour-animate");a.setWidth(400);P.Dom.style(a.getContentContainer(),"paddingRight",getComputedStyle(a.closeIcon).width);return t}getPulsar(e,s=true){const t=new BX.SpotLight({targetElement:e,targetVertex:"middle-center",lightMode:true});if(s){t.bindEvents({onTargetEnter:()=>t.close()})}return t}}class Li extends Pi{constructor(e={}){super(e);this.calendarContext=e.calendarContext}openDialog(){var e;(e=this.pulsar)==null?void 0:e.close();P.Dom.remove(this.counterNode);if(!this.newDialog){this.newDialog=new ci({bindElement:this.button.getContainer(),sharingUrl:this.sharingUrl,linkHash:this.linkHash,sharingRule:this.sharingRule,context:"calendar",calendarSettings:{weekHolidays:g.Util.config.week_holidays,weekStart:g.Util.config.week_start,workTimeStart:g.Util.config.work_time_start,workTimeEnd:g.Util.config.work_time_end},userInfo:this.userInfo,settingsCollapsed:this.sharingSettingsCollapsed,sortJointLinksByFrequentUse:this.sortJointLinksByFrequentUse,calendarContext:this.calendarContext})}if(!this.newDialog.isShown()){this.newDialog.show()}}enableSharing(){const e="Calendar.Sharing.copyLinkButton:onSharingEnabled";BX.ajax.runAction("calendar.api.sharinggroupajax.enableSharing",{data:{groupId:this.calendarContext.sharingObjectId}}).then((s=>{this.sharingUrl=s.data.url;this.linkHash=s.data.hash;this.sharingRule=s.data.rule;this.openDialog();H.EventEmitter.emit(e,{isChecked:this.switcher.isChecked(),url:s.data.url})})).catch((()=>{this.switcher.toggle()}))}disableSharing(){const e="Calendar.Sharing.copyLinkButton:onSharingDisabled";this.warningPopup.close();BX.ajax.runAction("calendar.api.sharinggroupajax.disableSharing",{data:{groupId:this.calendarContext.sharingObjectId}}).then((()=>{this.sharingUrl=null;if(this.newDialog){this.newDialog.destroy();this.newDialog=null}H.EventEmitter.emit(e,{isChecked:this.switcher.isChecked()})})).catch((()=>{this.switcher.toggle()}))}}class Fi{constructor(e){var s,t,a,i,l;this.buttonWrap=e.buttonWrap;this.userInfo=e.userInfo||null;this.payAttentionToNewFeature=(s=e.payAttentionToNewFeature)!=null?s:false;this.sharingFeatureLimit=(t=e.sharingFeatureLimit)!=null?t:false;this.sharingSettingsCollapsed=(a=e.sharingSettingsCollapsed)!=null?a:false;this.sortJointLinksByFrequentUse=(i=e.sortJointLinksByFrequentUse)!=null?i:false;this.calendarContext=(l=e.calendarContext)!=null?l:null}showSharingButton(){this.sharingButton=new Pi({wrap:this.buttonWrap,userInfo:this.userInfo,payAttentionToNewFeature:this.payAttentionToNewFeature,sharingFeatureLimit:this.sharingFeatureLimit,sharingSettingsCollapsed:this.sharingSettingsCollapsed,sortJointLinksByFrequentUse:this.sortJointLinksByFrequentUse});this.sharingButton.show()}showGroupSharingButton(){this.sharingButton=new Li({wrap:this.buttonWrap,userInfo:this.userInfo,payAttentionToNewFeature:this.payAttentionToNewFeature,sharingFeatureLimit:this.sharingFeatureLimit,sharingSettingsCollapsed:this.sharingSettingsCollapsed,sortJointLinksByFrequentUse:this.sortJointLinksByFrequentUse,calendarContext:this.calendarContext});this.sharingButton.show()}}let Hi=e=>e,Bi,yi;var fi=babelHelpers.classPrivateFieldLooseKey("popup");var mi=babelHelpers.classPrivateFieldLooseKey("loader");var _i=babelHelpers.classPrivateFieldLooseKey("layout");var Si=babelHelpers.classPrivateFieldLooseKey("qrCode");var Ti=babelHelpers.classPrivateFieldLooseKey("context");class wi{constructor(e){this.QRCODE_SIZE=114;this.QRCODE_COLOR_LIGHT="#fff";this.QRCODE_COLOR_DARK="#000";Object.defineProperty(this,fi,{writable:true,value:void 0});Object.defineProperty(this,mi,{writable:true,value:void 0});Object.defineProperty(this,_i,{writable:true,value:void 0});Object.defineProperty(this,Si,{writable:true,value:void 0});Object.defineProperty(this,Ti,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]=null;babelHelpers.classPrivateFieldLooseBase(this,mi)[mi]=null;babelHelpers.classPrivateFieldLooseBase(this,_i)[_i]={qr:null};babelHelpers.classPrivateFieldLooseBase(this,Si)[Si]=null;babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti]=e.context;this.sharingUrl=e.sharingUrl}getPopup(){if(!babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]){babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]=new L.Popup({className:"calendar-sharing__qr",width:315,padding:0,content:this.getContent(),closeIcon:true,closeByEsc:true,autoHide:true,overlay:true,animation:"fading-slide"})}return babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]}getLoader(){if(!babelHelpers.classPrivateFieldLooseBase(this,mi)[mi]){babelHelpers.classPrivateFieldLooseBase(this,mi)[mi]=new F.Loader({size:95})}return babelHelpers.classPrivateFieldLooseBase(this,mi)[mi]}getNodeQr(){if(!babelHelpers.classPrivateFieldLooseBase(this,_i)[_i].qr){babelHelpers.classPrivateFieldLooseBase(this,_i)[_i].qr=P.Tag.render(Bi||(Bi=Hi`
				<div class="calendar-sharing__qr-block"></div>
			`));this.getLoader().show(babelHelpers.classPrivateFieldLooseBase(this,_i)[_i].qr);this.showQr()}return babelHelpers.classPrivateFieldLooseBase(this,_i)[_i].qr}async showQr(){await this.initQrCode();this.QRCode=new QRCode(babelHelpers.classPrivateFieldLooseBase(this,_i)[_i].qr,{text:this.sharingUrl,width:this.QRCODE_SIZE,height:this.QRCODE_SIZE,colorDark:this.QRCODE_COLOR_DARK,colorLight:this.QRCODE_COLOR_LIGHT,correctLevel:QRCode.CorrectLevel.H});await this.getLoader().hide()}async initQrCode(){await P.Runtime.loadExtension(["main.qrcode"])}getContent(){return P.Tag.render(yi||(yi=Hi`
			<div class="calendar-sharing__qr-content">
				<div class="calendar-sharing__qr-title">${0}</div>
				${0}
				<div class="calendar-sharing__qr-info">${0}</div>
				<a class="calendar-sharing__dialog-link" href="${0}" target="_blank">${0}</a>
			</div>
		`),this.getPhraseDependsOnContext("SHARING_INFO_POPUP_QR_TITLE"),this.getNodeQr(),P.Loc.getMessage("SHARING_INFO_POPUP_QR_INFO"),this.sharingUrl,P.Loc.getMessage("SHARING_INFO_POPUP_QR_OPEN_LINK"))}isShown(){return this.getPopup().isShown()}close(){this.getPopup().close()}show(){this.getPopup().show()}destroy(){this.getPopup().destroy()}getPhraseDependsOnContext(e){return P.Loc.getMessage(`${e}_${babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti].toUpperCase()}`)}}class Ci extends Li{constructor(e={}){super(e);this.bindElement=e.bindElement;this.calendarSettings=e.calendarSettings;this.context=e.context;if(e.sharingConfig){var s,t,a;this.sharingConfig=e.sharingConfig;this.sharingUrl=((s=this.sharingConfig)==null?void 0:s.url)||null;this.linkHash=((t=this.sharingConfig)==null?void 0:t.hash)||null;this.sharingRule=((a=this.sharingConfig)==null?void 0:a.rule)||null}}openDialog(){if(!this.newDialog){this.newDialog=new ci({bindElement:this.bindElement,sharingUrl:this.sharingUrl,linkHash:this.linkHash,sharingRule:this.sharingRule,context:this.context,calendarSettings:{weekHolidays:this.calendarSettings.week_holidays,weekStart:this.calendarSettings.week_start,workTimeStart:this.calendarSettings.work_time_start,workTimeEnd:this.calendarSettings.work_time_end},userInfo:this.userInfo,settingsCollapsed:this.sharingSettingsCollapsed,sortJointLinksByFrequentUse:this.sortJointLinksByFrequentUse,calendarContext:this.calendarContext})}if(!this.newDialog.isShown()){this.newDialog.show()}}enableSharing(){const e="Calendar.Sharing.copyLinkButton:onSharingEnabled";const s="calendar.api.sharinggroupajax.enableSharing";const t={groupId:this.calendarContext.sharingObjectId};BX.ajax.runAction(s,{data:t}).then((s=>{H.EventEmitter.emit(e,{isChecked:true,url:s.data.url})}))}}var Ei=babelHelpers.classPrivateFieldLooseKey("groupSharing");var ki=babelHelpers.classPrivateFieldLooseKey("groupId");var Oi=babelHelpers.classPrivateFieldLooseKey("bindElement");var Ai=babelHelpers.classPrivateFieldLooseKey("config");var Ii=babelHelpers.classPrivateFieldLooseKey("getSharingConfig");var Ni=babelHelpers.classPrivateFieldLooseKey("requestSharingConfig");class Ri{static async getGroupSharing(e,s){if(babelHelpers.classPrivateFieldLooseBase(Ri,Ei)[Ei]&&babelHelpers.classPrivateFieldLooseBase(Ri,ki)[ki]===e&&babelHelpers.classPrivateFieldLooseBase(Ri,Oi)[Oi]===s){return babelHelpers.classPrivateFieldLooseBase(Ri,Ei)[Ei]}const t=await babelHelpers.classPrivateFieldLooseBase(this,Ii)[Ii](e);babelHelpers.classPrivateFieldLooseBase(Ri,Ei)[Ei]=new Ci({bindElement:s,context:"calendar",calendarContext:{sharingObjectType:"group",sharingObjectId:e,externalSharing:true},userInfo:{id:t.user.id,name:t.user.name,avatar:t.user.avatar,isCollabUser:t.user.isCollabUser},sharingConfig:t.link,calendarSettings:t.userCalendarSettings});babelHelpers.classPrivateFieldLooseBase(Ri,Ai)[Ai]=t;babelHelpers.classPrivateFieldLooseBase(Ri,ki)[ki]=e;babelHelpers.classPrivateFieldLooseBase(Ri,Oi)[Oi]=s;return babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei]}}async function Di(e){if(babelHelpers.classPrivateFieldLooseBase(this,ki)[ki]===e&&babelHelpers.classPrivateFieldLooseBase(this,Ai)[Ai]){return new Promise((e=>{void e(babelHelpers.classPrivateFieldLooseBase(this,Ai)[Ai])}))}return babelHelpers.classPrivateFieldLooseBase(this,Ni)[Ni](e)}async function Ui(e){const s="calendar.api.sharinggroupajax.enableAndGetSharingConfig";const t=await BX.ajax.runAction(s,{data:{groupId:e}});return t.data}Object.defineProperty(Ri,Ni,{value:Ui});Object.defineProperty(Ri,Ii,{value:Di});Object.defineProperty(Ri,Ei,{writable:true,value:null});Object.defineProperty(Ri,ki,{writable:true,value:null});Object.defineProperty(Ri,Oi,{writable:true,value:null});Object.defineProperty(Ri,Ai,{writable:true,value:null});e.Interface=Fi;e.SharingButton=Pi;e.DialogNew=ci;e.DialogQr=wi;e.Layout=Ra;e.RuleModel=T;e.RangeModel=f;e.SettingsModel=I;e.GroupSharing=Ci;e.GroupSharingController=Ri})(this.BX.Calendar.Sharing=this.BX.Calendar.Sharing||{},BX.Main,BX.Calendar.Sharing,BX.UI.EntitySelector,BX.UI,BX.UI.IconSet,BX.UI.Dialogs,BX.UI,BX,BX,BX,BX.UI,BX,BX.UI.Tour,BX.UI,BX.UI,BX.Calendar,BX,BX.Main,BX,BX.Event);
//# sourceMappingURL=interface.bundle.map.js