{"version":3,"file":"attach.bundle.js","sources":["../src/types/delimiter.js","../src/types/file.js","../src/mixin/attachLinks.js","../src/types/grid.js","../src/types/html.js","../src/types/image.js","../src/types/link.js","../src/types/message.js","../src/types/rich.js","../src/types/user.js","../src/attach.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Vue component\n *\n * Delimiter (attach type)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport \"./delimiter.css\";\n\nexport const AttachTypeDelimiter =\n{\n\tproperty: 'DELIMITER',\n\tname: 'bx-im-view-element-attach-delimiter',\n\tcomponent:\n\t{\n\t\tprops:\n\t\t{\n\t\t\tconfig: {type: Object, default: {}},\n\t\t\tcolor: {type: String, default: 'transparent'},\n\t\t},\n\t\tcomputed:\n\t\t{\n\t\t\tstyles()\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\twidth: this.config.DELIMITER.SIZE? this.config.DELIMITER.SIZE+'px': '',\n\t\t\t\t\tbackgroundColor: this.config.DELIMITER.COLOR? this.config.DELIMITER.COLOR: this.color,\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\ttemplate: `<div class=\"bx-im-element-attach-type-delimiter\" :style=\"styles\"></div>`\n\t},\n};","/**\n * Bitrix Messenger\n * Vue component\n *\n * File (attach type)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport \"./file.css\";\nimport {Vue} from \"ui.vue\";\nimport {FilesModel} from \"im.model\";\nimport {Utils} from \"im.lib.utils\";\nimport \"ui.icons.disk\";\n\nexport const AttachTypeFile =\n{\n\tproperty: 'FILE',\n\tname: 'bx-im-element-attach-file',\n\tcomponent:\n\t{\n\t\tprops:\n\t\t{\n\t\t\tconfig: {type: Object, default: {}},\n\t\t\tcolor: {type: String, default: 'transparent'},\n\t\t},\n\t\tmethods:\n\t\t{\n\t\t\topenLink(element)\n\t\t\t{\n\t\t\t\tUtils.platform.openNewPage(element.LINK);\n\t\t\t},\n\t\t\tfile()\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tname: this.config.FILE.NAME,\n\t\t\t\t\textension: this.config.FILE.NAME.split('.').splice(-1)[0],\n\t\t\t\t\tsize: this.config.FILE.SIZE,\n\t\t\t\t};\n\t\t\t},\n\t\t\tfileName(element)\n\t\t\t{\n\t\t\t\tlet maxLength = 70;\n\n\t\t\t\tif (!element.NAME || element.NAME.length < maxLength)\n\t\t\t\t{\n\t\t\t\t\treturn element.NAME;\n\t\t\t\t}\n\n\t\t\t\tlet endWordLength = 10;\n\n\t\t\t\tlet extension = element.NAME.split('.').splice(-1)[0];\n\t\t\t\tlet secondPart = element.NAME.substring(element.NAME.length-1 - (extension.length+1+endWordLength));\n\t\t\t\tlet firstPart = element.NAME.substring(0, maxLength-secondPart.length-3);\n\n\t\t\t\treturn firstPart.trim()+'...'+secondPart.trim();\n\t\t\t},\n\t\t\tfileNameFull(element)\n\t\t\t{\n\t\t\t\treturn element.NAME;\n\t\t\t},\n\t\t\tfileSize(element)\n\t\t\t{\n\t\t\t\tlet size = element.SIZE;\n\n\t\t\t\tif (size <= 0)\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tlet sizes = [\"BYTE\", \"KB\", \"MB\", \"GB\", \"TB\"];\n\t\t\t\tlet position = 0;\n\n\t\t\t\twhile (size >= 1024 && position < 4)\n\t\t\t\t{\n\t\t\t\t\tsize /= 1024;\n\t\t\t\t\tposition++;\n\t\t\t\t}\n\n\t\t\t\treturn Math.round(size) + \" \" + this.$Bitrix.Loc.getMessage('IM_MESSENGER_ATTACH_FILE_SIZE_'+sizes[position]);\n\t\t\t},\n\t\t\tfileIcon(element)\n\t\t\t{\n\t\t\t\treturn FilesModel.getIconType(element.NAME.split('.').splice(-1)[0]);\n\t\t\t}\n\t\t},\n\t\ttemplate: `\n\t\t\t<div class=\"bx-im-element-attach-type-file-element\">\n\t\t\t\t<template v-for=\"(element, index) in config.FILE\">\n\t\t\t\t\t<div class=\"bx-im-element-attach-type-file\" @click=\"openLink(element)\">\n\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-file-icon\">\n\t\t\t\t\t\t\t<div :class=\"['ui-icon', 'ui-icon-file-'+fileIcon(element)]\"><i></i></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-file-block\">\n\t\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-file-name\" :title=\"fileNameFull(element)\">\n\t\t\t\t\t\t\t\t{{fileName(element)}}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-file-size\">{{fileSize(element)}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t`\n\t},\n};","import { Utils } from \"im.lib.utils\";\n\nexport const AttachLinks = {\n\tmethods:\n\t{\n\t\topenLink(event)\n\t\t{\n\t\t\tconst element = event.element;\n\t\t\tconst eventData = event.event;\n\n\t\t\tif (!Utils.platform.isBitrixMobile() && element.LINK)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (element.LINK && eventData.target.tagName !== 'A')\n\t\t\t{\n\t\t\t\tUtils.platform.openNewPage(element.LINK);\n\t\t\t}\n\t\t\telse if (!element.LINK)\n\t\t\t{\n\t\t\t\tconst entity = {\n\t\t\t\t\tid: null,\n\t\t\t\t\ttype: null\n\t\t\t\t};\n\t\t\t\tif (element.hasOwnProperty('USER_ID') && element.USER_ID > 0)\n\t\t\t\t{\n\t\t\t\t\tentity.id = element.USER_ID;\n\t\t\t\t\tentity.type = 'user';\n\t\t\t\t}\n\t\t\t\tif (element.hasOwnProperty('CHAT_ID') && element.CHAT_ID > 0)\n\t\t\t\t{\n\t\t\t\t\tentity.id = element.CHAT_ID;\n\t\t\t\t\tentity.type = 'chat';\n\t\t\t\t}\n\n\t\t\t\tif (entity.id && entity.type && window.top['BXIM'])\n\t\t\t\t{\n\t\t\t\t\tconst popupAngle = !BX.MessengerTheme.isDark();\n\t\t\t\t\twindow.top['BXIM'].messenger.openPopupExternalData(\n\t\t\t\t\t\teventData.target,\n\t\t\t\t\t\tentity.type,\n\t\t\t\t\t\tpopupAngle,\n\t\t\t\t\t\t{'ID': entity.id}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (navigator.userAgent.toLowerCase().includes('bitrixmobile'))\n\t\t\t\t{\n\t\t\t\t\tlet dialogId = '';\n\t\t\t\t\tif (entity.type === 'chat')\n\t\t\t\t\t{\n\t\t\t\t\t\tdialogId = `chat${entity.id}`;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tdialogId = entity.id;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dialogId !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tBXMobileApp.Events.postToComponent(\"onOpenDialog\", [{dialogId: dialogId}, true], 'im.recent');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};","/**\n * Bitrix Messenger\n * Vue component\n *\n * Grid (attach type)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport \"./grid.css\";\nimport {Utils} from \"im.lib.utils\";\nimport {MessagesModel} from \"im.model\";\nimport { AttachLinks } from \"../mixin/attachLinks\";\n\nexport const AttachTypeGrid =\n{\n\tproperty: 'GRID',\n\tname: 'bx-im-view-element-attach-grid',\n\tcomponent:\n\t{\n\t\tmixins: [\n\t\t\tAttachLinks\n\t\t],\n\t\tprops:\n\t\t{\n\t\t\tconfig: {type: Object, default: {}},\n\t\t\tcolor: {type: String, default: 'transparent'},\n\t\t},\n\t\tcreated()\n\t\t{\n\t\t\tif (Utils.platform.isBitrixMobile())\n\t\t\t{\n\t\t\t\tthis.maxCellWith = Math.floor(Math.min(screen.availWidth, screen.availHeight)/4);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.maxCellWith = null;\n\t\t\t}\n\t\t},\n\t\tmethods:\n\t\t{\n\t\t\tgetWidth(element)\n\t\t\t{\n\t\t\t\tif (element.DISPLAY !== 'row')\n\t\t\t\t{\n\t\t\t\t\treturn element.WIDTH? element.WIDTH+'px': '';\n\t\t\t\t}\n\n\t\t\t\tif (!element.VALUE)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (this.maxCellWith && element.WIDTH > this.maxCellWith)\n\t\t\t\t{\n\t\t\t\t\treturn this.maxCellWith+'px';\n\t\t\t\t}\n\n\t\t\t\treturn element.WIDTH? element.WIDTH+'px': '';\n\t\t\t},\n\n\t\t\tgetValue(element)\n\t\t\t{\n\t\t\t\tif (!element.VALUE)\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tlet text = Utils.text.htmlspecialchars(element.VALUE);\n\n\t\t\t\ttext = text.replace(/\\[USER=([0-9]{1,})\\](.*?)\\[\\/USER\\]/ig, (whole, userId, userName) => {\n\t\t\t\t\tconst user = this.$store.getters['users/get'](userId);\n\t\t\t\t\tuserName = user? Utils.text.htmlspecialchars(user.name): userName;\n\t\t\t\t\treturn '<span class=\"bx-im-mention\" data-type=\"USER\" data-value=\"'+userId+'\">'+userName+'</span>'\n\t\t\t\t});\n\n\t\t\t\treturn MessagesModel.decodeBbCode({text});\n\t\t\t},\n\t\t},\n\t\t//language=Vue\n\t\ttemplate: `\n\t\t\t<div class=\"bx-im-element-attach-type-grid\">\n\t\t\t\t<template v-for=\"(element, index) in config.GRID\">\n\t\t\t\t\t<template v-if=\"element.DISPLAY.toLowerCase() === 'block'\">\n\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-grid-display bx-im-element-attach-type-display-block\" :style=\"{width: getWidth(element)}\">\n\t\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-grid-element-name\">{{element.NAME}}</div>\n\t\t\t\t\t\t\t<template v-if=\"element.LINK\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"bx-im-element-attach-type-grid-element-value bx-im-element-attach-type-grid-element-value-link\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<a :href=\"element.LINK\" target=\"_blank\" @click=\"openLink({element: element, event: $event})\" v-html=\"getValue(element)\"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-grid-element-value\" v-html=\"getValue(element)\"></div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"element.DISPLAY.toLowerCase() === 'line'\">\n\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-grid-display bx-im-element-attach-type-display-card\" :style=\"{width: getWidth(element)}\">\n\t\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-grid-element-name\">{{element.NAME}}</div>\n\t\t\t\t\t\t\t<template v-if=\"element.LINK\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"bx-im-element-attach-type-grid-element-value bx-im-element-attach-type-grid-element-value-link\"\n\t\t\t\t\t\t\t\t\t:style=\"{color: element.COLOR? element.COLOR: ''}\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<a :href=\"element.LINK\" target=\"_blank\" @click=\"openLink({element: element, event: $event})\" v-html=\"getValue(element)\"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-grid-element-value\" :style=\"{color: element.COLOR? element.COLOR: ''}\" v-html=\"getValue(element)\"></div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"element.DISPLAY.toLowerCase() === 'row'\">\n\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-grid-display bx-im-element-attach-type-display-column\">\n\t\t\t\t\t\t\t<table class=\"bx-im-element-attach-type-display-column-table\">\n\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<template v-if=\"element.NAME\">\n\t\t\t\t\t\t\t\t\t\t\t<td class=\"bx-im-element-attach-type-grid-element-name\" :colspan=\"element.VALUE? 1: 2\" :style=\"{width: getWidth(element)}\">{{element.NAME}}</td>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t<template v-if=\"element.VALUE\">\n\t\t\t\t\t\t\t\t\t\t\t<template v-if=\"element.LINK\">\n\t\t\t\t\t\t\t\t\t\t\t\t<td\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bx-im-element-attach-type-grid-element-value bx-im-element-attach-type-grid-element-value-link\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t:colspan=\"element.NAME? 1: 2\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t:style=\"{color: element.COLOR? element.COLOR: ''}\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a :href=\"element.LINK\" target=\"_blank\" @click=\"openLink({element: element, event: $event})\" v-html=\"getValue(element)\"></a>\n\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t\t\t\t<td class=\"bx-im-element-attach-type-grid-element-value\" :colspan=\"element.NAME? 1: 2\" :style=\"{color: element.COLOR? element.COLOR: ''}\" v-html=\"getValue(element)\"></td>\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t`\n\t},\n};","/**\n * Bitrix Messenger\n * Vue component\n *\n * Rich Attach type\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport \"./html.css\";\n\nexport const AttachTypeHtml =\n{\n\tproperty: 'HTML',\n\tname: 'bx-im-view-element-attach-html',\n\tcomponent:\n\t{\n\t\tprops:\n\t\t{\n\t\t\tconfig: {type: Object, default: {}},\n\t\t\tcolor: {type: String, default: 'transparent'},\n\t\t},\n\t\ttemplate: `<div class=\"bx-im-element-attach-type-html\" v-html=\"config.HTML\"></div>`\n\t},\n};","/**\n * Bitrix Messenger\n * Vue component\n *\n * Image (attach type)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport \"./image.css\";\nimport {Utils} from \"im.lib.utils\";\nimport 'ui.vue.directives.lazyload';\n\nexport const AttachTypeImage =\n{\n\tproperty: 'IMAGE',\n\tname: 'bx-im-view-element-attach-image',\n\tcomponent:\n\t{\n\t\tprops:\n\t\t{\n\t\t\tconfig: {type: Object, default: {}},\n\t\t\tcolor: {type: String, default: 'transparent'},\n\t\t},\n\t\tmethods:\n\t\t{\n\t\t\topen(file)\n\t\t\t{\n\t\t\t\tif (!file)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (Utils.platform.isBitrixMobile())\n\t\t\t\t{\n\t\t\t\t\t// TODO add multiply\n\t\t\t\t\tBXMobileApp.UI.Photo.show({photos: [{url: file}], default_photo: file})\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\twindow.open(file, '_blank');\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetImageSize(width, height, maxWidth)\n\t\t\t{\n\t\t\t\tlet aspectRatio;\n\n\t\t\t\tif (width > maxWidth)\n\t\t\t\t{\n\t\t\t\t\taspectRatio = maxWidth / width;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\taspectRatio = 1;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\twidth: width * aspectRatio,\n\t\t\t\t\theight: height * aspectRatio\n\t\t\t\t};\n\t\t\t},\n\t\t\tgetElementSource(element)\n\t\t\t{\n\t\t\t\treturn element.PREVIEW? element.PREVIEW: element.LINK;\n\t\t\t},\n\t\t\tgetElementTitle(element)\n\t\t\t{\n\t\t\t\treturn Utils.text.htmlspecialcharsback(element.NAME);\n\t\t\t},\n\t\t\tlazyLoadCallback(event)\n\t\t\t{\n\t\t\t\tif (!event.element.style.width)\n\t\t\t\t{\n\t\t\t\t\tevent.element.style.width = event.element.offsetWidth+'px';\n\t\t\t\t}\n\t\t\t\tif (!event.element.style.height)\n\t\t\t\t{\n\t\t\t\t\tevent.element.style.height = event.element.offsetHeight+'px';\n\t\t\t\t}\n\t\t\t},\n\t\t\tstyleFileSizes(image)\n\t\t\t{\n\t\t\t\tif (!(image.WIDTH && image.HEIGHT))\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tmaxHeight: '100%',\n\t\t\t\t\t\tbackgroundSize: 'contain'\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet sizes = this.getImageSize(image.WIDTH, image.HEIGHT, 250);\n\n\t\t\t\treturn {\n\t\t\t\t\twidth: sizes.width+'px',\n\t\t\t\t\theight: sizes.height+'px',\n\t\t\t\t\tbackgroundSize: sizes.width < 100 || sizes.height < 100? 'contain': 'initial'\n\t\t\t\t}\n\t\t\t},\n\t\t\tstyleBoxSizes(image)\n\t\t\t{\n\t\t\t\tif (!(image.WIDTH && image.HEIGHT))\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\theight: '150px'\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (parseInt(this.styleFileSizes(image).height) <= 250)\n\t\t\t\t{\n\t\t\t\t\treturn {};\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\theight: '280px'\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\ttemplate: `\n\t\t\t<div class=\"bx-im-element-attach-type-image\">\n\t\t\t\t<template v-for=\"(image, index) in config.IMAGE\">\n\t\t\t\t\t<div class=\"bx-im-element-attach-type-image-block\" @click=\"open(image.LINK)\" :style=\"styleBoxSizes(image)\" :key=\"index\">\n\t\t\t\t\t\t<img v-bx-lazyload=\"{callback: lazyLoadCallback}\"\n\t\t\t\t\t\t\tclass=\"bx-im-element-attach-type-image-source\"\n\t\t\t\t\t\t\t:data-lazyload-src=\"getElementSource(image)\"\n\t\t\t\t\t\t\t:style=\"styleFileSizes(image)\"\n\t\t\t\t\t\t\t:title=\"getElementTitle(image)\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t`\n\t},\n};","/**\n * Bitrix Messenger\n * Vue component\n *\n * Link (attach type)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport \"./link.css\";\nimport {AttachTypeImage} from \"./image\";\nimport { AttachLinks } from \"../mixin/attachLinks\";\n\nexport const AttachTypeLink =\n{\n\tproperty: 'LINK',\n\tname: 'bx-im-view-element-attach-link',\n\tcomponent:\n\t{\n\t\tmixins: [\n\t\t\tAttachLinks\n\t\t],\n\t\tprops:\n\t\t{\n\t\t\tconfig: {type: Object, default: {}},\n\t\t\tcolor: {type: String, default: 'transparent'},\n\t\t},\n\t\tmethods:\n\t\t{\n\t\t\tgetImageConfig(element)\n\t\t\t{\n\t\t\t\treturn {IMAGE: [{\n\t\t\t\t\tNAME: element.NAME,\n\t\t\t\t\tPREVIEW: element.PREVIEW,\n\t\t\t\t\tWIDTH: element.WIDTH,\n\t\t\t\t\tHEIGHT: element.HEIGHT,\n\t\t\t\t}]};\n\t\t\t},\n\t\t\tgetLinkName(element)\n\t\t\t{\n\t\t\t\treturn element.NAME? element.NAME: element.LINK;\n\t\t\t},\n\t\t},\n\t\tcomputed:\n\t\t{\n\t\t\timageComponentName()\n\t\t\t{\n\t\t\t\treturn AttachTypeImage.name;\n\t\t\t},\n\t\t},\n\t\tcomponents:\n\t\t{\n\t\t\t[AttachTypeImage.name]: AttachTypeImage.component\n\t\t},\n\t\t//language=Vue\n\t\ttemplate: `\n\t\t\t<div class=\"bx-im-element-attach-type-link\">\n\t\t\t\t<template v-for=\"(element, index) in config.LINK\">\n\t\t\t\t\t<div class=\"bx-im-element-attach-type-link-element\" :key=\"index\">\n\t\t\t\t\t\t<a \n\t\t\t\t\t\t\tv-if=\"element.LINK\"\n\t\t\t\t\t\t\t:href=\"element.LINK\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\tclass=\"bx-im-element-attach-type-link-name\" \n\t\t\t\t\t\t\t@click=\"openLink({element: element, event: $event})\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{getLinkName(element)}}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"bx-im-element-attach-type-ajax-link\"\n\t\t\t\t\t\t\t@click=\"openLink({element: element, event: $event})\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{getLinkName(element)}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div v-if=\"element.DESC\" class=\"bx-im-element-attach-type-link-desc\">{{element.DESC}}</div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tv-if=\"element.PREVIEW\" \n\t\t\t\t\t\t\tclass=\"bx-im-element-attach-type-link-image\"\n\t\t\t\t\t\t\t@click=\"openLink({element: element, event: $event})\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<component :is=\"imageComponentName\" :config=\"getImageConfig(element)\" :color=\"color\"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t`\n\t},\n};","/**\n * Bitrix Messenger\n * Vue component\n *\n * Message (attach type)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport {MessagesModel} from \"im.model\";\nimport {Utils} from \"im.lib.utils\";\n\nexport const AttachTypeMessage =\n{\n\tproperty: 'MESSAGE',\n\tname: 'bx-im-view-element-attach-message',\n\tcomponent:\n\t{\n\t\tprops:\n\t\t{\n\t\t\tconfig: {type: Object, default: {}},\n\t\t\tcolor: {type: String, default: 'transparent'},\n\t\t},\n\t\tcomputed:\n\t\t{\n\t\t\tmessage()\n\t\t\t{\n\t\t\t\tlet text = Utils.text.htmlspecialchars(this.config.MESSAGE);\n\n\t\t\t\ttext = text.replace(/\\[USER=([0-9]{1,})\\](.*?)\\[\\/USER\\]/ig, (whole, userId, userName) => {\n\t\t\t\t\tconst user = this.$store.getters['users/get'](userId);\n\t\t\t\t\tuserName = user? Utils.text.htmlspecialchars(user.name): userName;\n\t\t\t\t\treturn '<span class=\"bx-im-mention\" data-type=\"USER\" data-value=\"'+userId+'\">'+userName+'</span>'\n\t\t\t\t});\n\n\t\t\t\treturn MessagesModel.decodeBbCode({text});\n\t\t\t}\n\t\t},\n\t\ttemplate: `<div class=\"bx-im-element-attach-type-message\" v-html=\"message\"></div>`\n\t},\n};","/**\n * Bitrix Messenger\n * Vue component\n *\n * Rich (attach type)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport \"./rich.css\";\nimport {AttachTypeImage} from \"./image\";\nimport { AttachLinks } from \"../mixin/attachLinks\";\n\nexport const AttachTypeRich =\n{\n\tproperty: 'RICH_LINK',\n\tname: 'bx-im-view-element-attach-rich',\n\tcomponent:\n\t{\n\t\tmixins: [\n\t\t\tAttachLinks\n\t\t],\n\t\tprops:\n\t\t{\n\t\t\tconfig: {type: Object, default: {}},\n\t\t\tcolor: {type: String, default: 'transparent'},\n\t\t},\n\t\tmethods:\n\t\t{\n\t\t\tgetImageConfig(element)\n\t\t\t{\n\t\t\t\treturn {IMAGE: [{\n\t\t\t\t\tNAME: element.NAME,\n\t\t\t\t\tPREVIEW: element.PREVIEW,\n\t\t\t\t\tWIDTH: element.WIDTH,\n\t\t\t\t\tHEIGHT: element.HEIGHT,\n\t\t\t\t}]};\n\t\t\t},\n\t\t},\n\t\tcomputed:\n\t\t{\n\t\t\timageComponentName()\n\t\t\t{\n\t\t\t\treturn AttachTypeImage.name;\n\t\t\t}\n\t\t},\n\t\tcomponents:\n\t\t{\n\t\t\t[AttachTypeImage.name]: AttachTypeImage.component\n\t\t},\n\t\t//language=Vue\n\t\ttemplate: `\n\t\t\t<div class=\"bx-im-element-attach-type-rich\">\n\t\t\t\t<template v-for=\"(element, index) in config.RICH_LINK\">\n\t\t\t\t\t<div class=\"bx-im-element-attach-type-rich-element\" :key=\"index\">\n\t\t\t\t\t\t<div v-if=\"element.PREVIEW\" class=\"bx-im-element-attach-type-rich-image\" @click=\"openLink({element: element, event: $event})\">\n\t\t\t\t\t\t\t<component :is=\"imageComponentName\" :config=\"getImageConfig(element)\" :color=\"color\"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-rich-name\" @click=\"openLink({element: element, event: $event})\">{{element.NAME}}</div>\n\t\t\t\t\t\t<div v-if=\"element.DESC\" class=\"bx-im-element-attach-type-rich-desc\">{{element.DESC}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t`\n\t},\n};","/**\n * Bitrix Messenger\n * Vue component\n *\n * User (Attach type)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport \"./user.css\";\nimport { AttachLinks } from \"../mixin/attachLinks\";\n\nexport const AttachTypeUser =\n{\n\tproperty: 'USER',\n\tname: 'bx-im-view-element-attach-user',\n\tcomponent:\n\t{\n\t\tmixins: [\n\t\t\tAttachLinks\n\t\t],\n\t\tprops:\n\t\t{\n\t\t\tconfig: {type: Object, default: {}},\n\t\t\tcolor: {type: String, default: 'transparent'},\n\t\t},\n\t\tmethods:\n\t\t{\n\t\t\tgetAvatarType(element)\n\t\t\t{\n\t\t\t\tif (element.AVATAR)\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tlet avatarType = 'user';\n\n\t\t\t\tif (element.AVATAR_TYPE === 'CHAT')\n\t\t\t\t{\n\t\t\t\t\tavatarType = 'chat';\n\t\t\t\t}\n\t\t\t\telse if (element.AVATAR_TYPE === 'BOT')\n\t\t\t\t{\n\t\t\t\t\tavatarType = 'bot';\n\t\t\t\t}\n\n\t\t\t\treturn 'bx-im-element-attach-type-user-avatar-type-'+avatarType;\n\t\t\t}\n\t\t},\n\t\t//language=Vue\n\t\ttemplate: `\n\t\t\t<div class=\"bx-im-element-attach-type-user\">\n\t\t\t\t<template v-for=\"(element, index) in config.USER\">\n\t\t\t\t\t<div class=\"bx-im-element-attach-type-user-body\">\n\t\t\t\t\t\t<div class=\"bx-im-element-attach-type-user-avatar\">\n\t\t\t\t\t\t\t<div :class=\"['bx-im-element-attach-type-user-avatar-type', getAvatarType(element)]\" :style=\"{backgroundColor: element.AVATAR? '': color}\">\n\t\t\t\t\t\t\t\t<img v-if=\"element.AVATAR\" \n\t\t\t\t\t\t\t\t\tv-bx-lazyload\n\t\t\t\t\t\t\t\t\tclass=\"bx-im-element-attach-type-user-avatar-source\"\n\t\t\t\t\t\t\t\t\t:data-lazyload-src=\"element.AVATAR\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\tv-if=\"element.LINK\"\n\t\t\t\t\t\t\t:href=\"element.LINK\" \n\t\t\t\t\t\t\tclass=\"bx-im-element-attach-type-user-name\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t@click=\"openLink({element: element, event: $event})\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{element.NAME}}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<span v-else @click.prevent=\"openLink({element: element, event: $event})\">\n\t\t\t\t\t\t\t{{element.NAME}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t`\n\t},\n};","/**\n * Bitrix Messenger\n * Attach element Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './attach.css';\n\nimport {AttachTypeDelimiter} from './types/delimiter';\nimport {AttachTypeFile} from './types/file';\nimport {AttachTypeGrid} from './types/grid';\nimport {AttachTypeHtml} from './types/html';\nimport {AttachTypeImage} from './types/image';\nimport {AttachTypeLink} from './types/link';\nimport {AttachTypeMessage} from './types/message';\nimport {AttachTypeRich} from './types/rich';\nimport {AttachTypeUser} from './types/user';\n\nimport {BitrixVue} from 'ui.vue';\n\nconst AttachTypes = [\n\tAttachTypeDelimiter,\n\tAttachTypeFile,\n\tAttachTypeGrid,\n\tAttachTypeHtml,\n\tAttachTypeImage,\n\tAttachTypeLink,\n\tAttachTypeMessage,\n\tAttachTypeRich,\n\tAttachTypeUser\n];\n\nconst AttachComponents = {};\nAttachTypes.forEach(attachType => {\n\tAttachComponents[attachType.name] = attachType.component;\n});\n\nBitrixVue.component('bx-im-view-element-attach',\n{\n\tprops:\n\t{\n\t\tconfig: {type: Object, default: {}},\n\t\tbaseColor: {type: String, default: '#17a3ea'},\n\t},\n\tmethods:\n\t{\n\t\tgetComponentForBlock(block)\n\t\t{\n\t\t\tfor (let attachType of AttachTypes)\n\t\t\t{\n\t\t\t\tif (typeof block[attachType.property] !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\treturn attachType.name;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn '';\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tcolor()\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof(this.config.COLOR) === 'undefined'\n\t\t\t\t|| !this.config.COLOR\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn this.baseColor;\n\t\t\t}\n\n\t\t\tif (this.config.COLOR === 'transparent')\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.config.COLOR;\n\t\t},\n\t},\n\tcomponents: AttachComponents,\n\ttemplate: `\n\t\t<div class=\"bx-im-element-attach\">\n\t\t\t<div v-if=\"color\" class=\"bx-im-element-attach-border\" :style=\"{borderColor: color}\"></div>\n\t\t\t<div class=\"bx-im-element-attach-content\">\n\t\t\t\t<template v-for=\"(block, index) in config.BLOCKS\">\n\t\t\t\t\t<component :is=\"getComponentForBlock(block)\" :config=\"block\" :color=\"color\" :key=\"index\" />\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["AttachTypeDelimiter","property","name","component","props","config","type","Object","default","color","String","computed","styles","width","DELIMITER","SIZE","backgroundColor","COLOR","template","AttachTypeFile","methods","openLink","element","Utils","platform","openNewPage","LINK","file","FILE","NAME","extension","split","splice","size","fileName","maxLength","length","endWordLength","secondPart","substring","firstPart","trim","fileNameFull","fileSize","sizes","position","Math","round","$Bitrix","Loc","getMessage","fileIcon","FilesModel","getIconType","AttachLinks","event","eventData","isBitrixMobile","target","tagName","entity","id","hasOwnProperty","USER_ID","CHAT_ID","window","top","popupAngle","BX","MessengerTheme","isDark","messenger","openPopupExternalData","navigator","userAgent","toLowerCase","includes","dialogId","BXMobileApp","Events","postToComponent","AttachTypeGrid","mixins","created","maxCellWith","floor","min","screen","availWidth","availHeight","getWidth","DISPLAY","WIDTH","VALUE","getValue","text","htmlspecialchars","replace","whole","userId","userName","user","$store","getters","MessagesModel","decodeBbCode","AttachTypeHtml","AttachTypeImage","open","UI","Photo","show","photos","url","default_photo","getImageSize","height","maxWidth","aspectRatio","getElementSource","PREVIEW","getElementTitle","htmlspecialcharsback","lazyLoadCallback","style","offsetWidth","offsetHeight","styleFileSizes","image","HEIGHT","maxHeight","backgroundSize","styleBoxSizes","parseInt","AttachTypeLink","getImageConfig","IMAGE","getLinkName","imageComponentName","components","AttachTypeMessage","message","MESSAGE","AttachTypeRich","AttachTypeUser","getAvatarType","AVATAR","avatarType","AVATAR_TYPE","AttachTypes","AttachComponents","forEach","attachType","BitrixVue","baseColor","getComponentForBlock","block"],"mappings":"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"}