{"version":3,"file":"timer.bundle.js","sources":["../src/timer.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Timer manager\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nclass Timer\n{\n\tconstructor()\n\t{\n\t\tthis.list = {};\n\n\t\tthis.updateInterval = 1000;\n\n\t\tclearInterval(this.updateIntervalId);\n\t\tthis.updateIntervalId = setInterval(this.worker.bind(this), this.updateInterval);\n\t}\n\n\tstart(name, id = 'default', time = 1, callback = null, callbackParams = {})\n\t{\n\t\tid = id == null? 'default': id;\n\n\t\ttime = parseFloat(time);\n\t\tif (isNaN(time) || time <= 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\ttime = time*1000;\n\n\t\tif (typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\tthis.list[name] = {};\n\t\t}\n\n\t\tthis.list[name][id] = {\n\t\t\t'dateStop': new Date().getTime()+time,\n\t\t\t'callback': typeof callback === 'function'? callback: function() {},\n\t\t\t'callbackParams': callbackParams\n\t\t};\n\n\t\treturn true;\n\t}\n\n\thas(name, id = 'default')\n\t{\n\t\tid = id == null? 'default': id;\n\t\tif (id.toString().length <= 0 || typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!this.list[name][id];\n\t}\n\n\tstop(name, id = 'default', skipCallback)\n\t{\n\t\tid = id == null? 'default': id;\n\n\t\tif (id.toString().length <= 0 || typeof this.list[name] === 'undefined')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.list[name][id])\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (skipCallback !== true)\n\t\t{\n\t\t\tthis.list[name][id]['callback'](id, this.list[name][id]['callbackParams']);\n\t\t}\n\n\t\tdelete this.list[name][id];\n\n\t\treturn true;\n\t}\n\n\tstopAll(skipCallback)\n\t{\n\t\tfor (let name in this.list)\n\t\t{\n\t\t\tif (this.list.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tfor (let id in this.list[name])\n\t\t\t\t{\n\t\t\t\t\tif(this.list[name].hasOwnProperty(id))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.stop(name, id, skipCallback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tworker()\n\t{\n\t\tfor (let name in this.list)\n\t\t{\n\t\t\tif (!this.list.hasOwnProperty(name))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (let id in this.list[name])\n\t\t\t{\n\t\t\t\tif(!this.list[name].hasOwnProperty(id) || this.list[name][id]['dateStop'] > new Date())\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.stop(name, id);\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tclean()\n\t{\n\t\tclearInterval(this.updateIntervalId);\n\t\tthis.stopAll(true);\n\n\t\treturn true;\n\t}\n}\n\nexport {Timer};\n"],"names":["Timer","constructor","list","updateInterval","clearInterval","updateIntervalId","setInterval","worker","bind","start","name","id","time","callback","callbackParams","parseFloat","isNaN","Date","getTime","has","toString","length","stop","skipCallback","stopAll","hasOwnProperty","clean"],"mappings":"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"}