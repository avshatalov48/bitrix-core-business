this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,a,i,n,o,r,l,c,g,d,u,h,m,M,p,v,b,I,_,L,C,f,y,B,A,E,F,x,P,S,T,H,k,D,O,G,w,N,U,X,K,R,j,$,V,Y,q,z,Q,W,Z,J){"use strict";const ee={name:"DialogLoader",props:{fullHeight:{type:Boolean,default:true}},data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-dialog-loader__container" :class="{'--full-height': fullHeight}">\n\t\t\t<div class="bx-im-dialog-loader__spinner"></div>\n\t\t\t<div class="bx-im-dialog-loader__text">{{ loc('IM_DIALOG_CHAT_LOADER_TEXT') }}</div>\n\t\t</div>\n\t`};class te extends o.UserMenu{constructor(){super();this.id="bx-im-avatar-context-menu"}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:21}}getMenuItems(){return[this.getMentionItem(),this.getSendItem(),this.getProfileItem(),this.getKickItem()]}}var se=babelHelpers.classPrivateFieldLooseKey("isOwnMessage");var ae=babelHelpers.classPrivateFieldLooseKey("isDeletedMessage");var ie=babelHelpers.classPrivateFieldLooseKey("getFirstFile");var ne=babelHelpers.classPrivateFieldLooseKey("isSingleFile");var oe=babelHelpers.classPrivateFieldLooseKey("isForwardedMessage");var re=babelHelpers.classPrivateFieldLooseKey("isRealMessage");var le=babelHelpers.classPrivateFieldLooseKey("onDelete");var ce=babelHelpers.classPrivateFieldLooseKey("isDeletionCancelled");var ge=babelHelpers.classPrivateFieldLooseKey("getDownloadSingleFileItem");var de=babelHelpers.classPrivateFieldLooseKey("getDownloadSeveralFilesItem");class ue extends o.BaseMenu{constructor(){super();Object.defineProperty(this,de,{value:Ce});Object.defineProperty(this,ge,{value:Le});Object.defineProperty(this,ce,{value:_e});Object.defineProperty(this,le,{value:Ie});Object.defineProperty(this,re,{value:be});Object.defineProperty(this,oe,{value:ve});Object.defineProperty(this,ne,{value:pe});Object.defineProperty(this,ie,{value:Me});Object.defineProperty(this,ae,{value:me});Object.defineProperty(this,se,{value:he});this.id="bx-im-message-context-menu";this.diskService=new c.DiskService;this.marketManager=g.MarketManager.getInstance()}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:11}}getMenuItems(){return[this.getReplyItem(),this.getCopyItem(),this.getCopyLinkItem(),this.getCopyFileItem(),this.getPinItem(),this.getForwardItem(),this.getDelimiter(),this.getMarkItem(),this.getFavoriteItem(),this.getDelimiter(),this.getCreateItem(),this.getDelimiter(),this.getDownloadFileItem(),this.getSaveToDiskItem(),this.getDelimiter(),this.getEditItem(),this.getDeleteItem(),this.getDelimiter(),this.getSelectItem()]}getSelectItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()||!babelHelpers.classPrivateFieldLooseBase(this,re)[re]()){return null}return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_SELECT"),onclick:()=>{I.EventEmitter.emit(f.EventType.dialog.openBulkActionsMode,{messageId:this.context.id});this.menuInstance.close()}}}getReplyItem(){return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_REPLY"),onclick:()=>{I.EventEmitter.emit(f.EventType.textarea.replyMessage,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getForwardItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()||!babelHelpers.classPrivateFieldLooseBase(this,re)[re]()){return null}return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_FORWARD"),onclick:()=>{I.EventEmitter.emit(f.EventType.dialog.showForwardPopup,{messagesIds:[this.context.id]});this.menuInstance.close()}}}getCopyItem(){if(this.context.text.trim().length===0){return null}return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY"),onclick:async()=>{const e=r.Parser.prepareCopy(this.context);await d.Utils.text.copyToClipboard(e);BX.UI.Notification.Center.notify({content:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_SUCCESS")});this.menuInstance.close()}}}getCopyLinkItem(){return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_LINK_MSGVER_1"),onclick:()=>{var e;const t=d.Utils.text.getMessageLink(this.context.dialogId,this.context.id);if((e=BX.clipboard)!=null&&e.copy(t)){BX.UI.Notification.Center.notify({content:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_LINK_SUCCESS")})}this.menuInstance.close()}}}getCopyFileItem(){if(this.context.files.length!==1){return null}return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_FILE"),onclick:()=>{var e;const t=r.Parser.prepareCopyFile(this.context);if((e=BX.clipboard)!=null&&e.copy(t)){BX.UI.Notification.Center.notify({content:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_FILE_SUCCESS")})}this.menuInstance.close()}}}getPinItem(){const e=v.PermissionManager.getInstance().canPerformActionByRole(f.ActionByRole.pinMessage,this.context.dialogId);if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()||!e){return null}const t=this.store.getters["messages/pin/isPinned"]({chatId:this.context.chatId,messageId:this.context.id});return{text:t?b.Loc.getMessage("IM_DIALOG_CHAT_MENU_UNPIN"):b.Loc.getMessage("IM_DIALOG_CHAT_MENU_PIN"),onclick:()=>{const e=new c.MessageService({chatId:this.context.chatId});if(t){e.unpinMessage(this.context.chatId,this.context.id)}else{e.pinMessage(this.context.chatId,this.context.id)}this.menuInstance.close()}}}getFavoriteItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()){return null}const e=this.store.getters["sidebar/favorites/isFavoriteMessage"](this.context.chatId,this.context.id);const t=e?b.Loc.getMessage("IM_DIALOG_CHAT_MENU_REMOVE_FROM_SAVED"):b.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE");return{text:t,onclick:()=>{const t=new c.MessageService({chatId:this.context.chatId});if(e){t.removeMessageFromFavorite(this.context.id)}else{t.addMessageToFavorite(this.context.id)}this.menuInstance.close()}}}getMarkItem(){const e=this.context.viewed&&!babelHelpers.classPrivateFieldLooseBase(this,se)[se]();const t=this.store.getters["chats/getByChatId"](this.context.chatId);const s=this.context.id===t.markedId;if(!e||s){return null}return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_MARK"),onclick:()=>{const e=new c.MessageService({chatId:this.context.chatId});e.markMessage(this.context.id);this.menuInstance.close()}}}getCreateItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()){return null}return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE"),items:[this.getCreateTaskItem(),this.getCreateMeetingItem(),...this.getMarketItems()]}}getCreateTaskItem(){return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_TASK"),onclick:()=>{const e=new l.EntityCreator(this.context.chatId);void e.createTaskForMessage(this.context.id);this.menuInstance.close()}}}getCreateMeetingItem(){return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_MEETING"),onclick:()=>{const e=new l.EntityCreator(this.context.chatId);void e.createMeetingForMessage(this.context.id);this.menuInstance.close()}}}getEditItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,se)[se]()||babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()||babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]()){return null}return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_EDIT"),onclick:()=>{I.EventEmitter.emit(f.EventType.textarea.editMessage,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getDeleteItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()){return null}const e=v.PermissionManager.getInstance();const t=e.canPerformActionByRole(f.ActionByRole.deleteOthersMessage,this.context.dialogId);if(!babelHelpers.classPrivateFieldLooseBase(this,se)[se]()&&!t){return null}return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_DELETE"),className:"menu-popup-no-icon bx-im-dialog-chat__message-menu_delete",onclick:babelHelpers.classPrivateFieldLooseBase(this,le)[le].bind(this)}}getMarketItems(){const{dialogId:e,id:t}=this.context;const s=this.marketManager.getAvailablePlacementsByType(f.PlacementType.contextMenu,e);const a=[];if(s.length>0){a.push(this.getDelimiter())}const i={messageId:t,dialogId:e};s.forEach((e=>{a.push({text:e.title,onclick:()=>{g.MarketManager.openSlider(e,i);this.menuInstance.close()}})}));const n=11;return a.slice(0,n)}getDownloadFileItem(){if(!b.Type.isArrayFilled(this.context.files)){return null}if(babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]()){return babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]()}return babelHelpers.classPrivateFieldLooseBase(this,de)[de]()}getSaveToDiskItem(){if(!b.Type.isArrayFilled(this.context.files)){return null}const e=babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]()?b.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ON_DISK_MSGVER_1"):b.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ALL_ON_DISK");const t=babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]()?b.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ON_DISK_SUCCESS_MSGVER_1"):b.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ALL_ON_DISK_SUCCESS");return{text:e,onclick:function(){_.Analytics.getInstance().messageFiles.onClickSaveOnDisk({messageId:this.context.id,dialogId:this.context.dialogId});void this.diskService.save(this.context.files).then((()=>{BX.UI.Notification.Center.notify({content:t})}));this.menuInstance.close()}.bind(this)}}getDelimiter(){return{delimiter:true}}}function he(){return this.context.authorId===C.Core.getUserId()}function me(){return this.context.isDeleted}function Me(){return this.store.getters["files/get"](this.context.files[0])}function pe(){return this.context.files.length===1}function ve(){return b.Type.isStringFilled(this.context.forward.id)}function be(){return this.store.getters["messages/isRealMessage"](this.context.id)}async function Ie(){const{id:e,dialogId:t,chatId:s}=this.context;_.Analytics.getInstance().messageDelete.onClickDelete({messageId:e,dialogId:t});this.menuInstance.close();if(await babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]()){return}const a=new c.MessageService({chatId:s});void a.deleteMessage(e)}async function _e(){const{id:e,dialogId:t}=this.context;if(!n.ChannelManager.isChannel(t)){return false}const s=await u.showDeleteChannelPostConfirm();if(!s){_.Analytics.getInstance().messageDelete.onCancel({messageId:e,dialogId:t});return true}return false}function Le(){const e=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]();return{html:d.Utils.file.createDownloadLink(b.Loc.getMessage("IM_DIALOG_CHAT_MENU_DOWNLOAD_FILE"),e.urlDownload,e.name),onclick:function(){_.Analytics.getInstance().messageFiles.onClickDownload({messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}.bind(this)}}function Ce(){const e=this.context.files.map((e=>this.store.getters["files/get"](e)));return{text:b.Loc.getMessage("IM_DIALOG_CHAT_MENU_DOWNLOAD_FILES"),onclick:async()=>{var t;_.Analytics.getInstance().messageFiles.onClickDownload({messageId:this.context.id,dialogId:this.context.dialogId});d.Utils.file.downloadFiles(e);const s=i.PromoManager.getInstance().needToShow(f.PromoId.downloadSeveralFiles);if(s&&d.Utils.browser.isChrome()&&!d.Utils.platform.isBitrixDesktop()){var a;(a=this.menuInstance)==null?void 0:a.close();await u.showDownloadAllFilesConfirm();void i.PromoManager.getInstance().markAsWatched(f.PromoId.downloadSeveralFiles)}(t=this.menuInstance)==null?void 0:t.close()}}}var fe=babelHelpers.classPrivateFieldLooseKey("dialogId");var ye=babelHelpers.classPrivateFieldLooseKey("observer");var Be=babelHelpers.classPrivateFieldLooseKey("initObserver");var Ae=babelHelpers.classPrivateFieldLooseKey("sendVisibleEvent");var Ee=babelHelpers.classPrivateFieldLooseKey("sendNotVisibleEvent");var Fe=babelHelpers.classPrivateFieldLooseKey("getThreshold");var xe=babelHelpers.classPrivateFieldLooseKey("getMessageIdFromElement");class Pe{constructor(e){Object.defineProperty(this,xe,{value:De});Object.defineProperty(this,Fe,{value:ke});Object.defineProperty(this,Ee,{value:He});Object.defineProperty(this,Ae,{value:Te});Object.defineProperty(this,Be,{value:Se});Object.defineProperty(this,fe,{writable:true,value:void 0});Object.defineProperty(this,ye,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]=e;babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]()}observeMessage(e){babelHelpers.classPrivateFieldLooseBase(this,ye)[ye].observe(e)}unobserveMessage(e){babelHelpers.classPrivateFieldLooseBase(this,ye)[ye].unobserve(e)}}function Se(){babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]=new IntersectionObserver((e=>{e.forEach((e=>{const t=babelHelpers.classPrivateFieldLooseBase(this,xe)[xe](e.target);if(!t||!e.rootBounds){return}const s=e.isIntersecting&&e.intersectionRatio>=.99;const a=e.intersectionRect.height>=e.rootBounds.height/2.2;if(s||a){babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae](t)}else{babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee](t)}}))}),{threshold:babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]()})}function Te(e){I.EventEmitter.emit(f.EventType.dialog.onMessageIsVisible,{messageId:e,dialogId:babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]})}function He(e){I.EventEmitter.emit(f.EventType.dialog.onMessageIsNotVisible,{messageId:e,dialogId:babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]})}function ke(){const e=Array.from({length:101}).fill(0);return e.map(((e,t)=>t*.01))}function De(e){return Number(e.dataset.id)}const Oe={props:{title:{type:String,required:true}},data(){return{}},template:`\n\t\t<div class="bx-im-message-list-date-group-title__container">\n\t\t\t<div class="bx-im-message-list-date-group-title__text">{{ title }}</div>\n\t\t</div>\n\t`};const Ge={name:"DateGroup",components:{DateGroupTitle:Oe},props:{item:{type:Object,required:true}},data(){return{}},computed:{BlockType:()=>f.DialogBlockType,dateGroup(){return this.item}},template:`\n\t\t<div class="bx-im-message-list-date-group__container">\n\t\t\t<DateGroupTitle :title="dateGroup.dateTitle" />\n\t\t\t<template v-for="dateGroupItem in dateGroup.items" >\n\t\t\t\t<slot\n\t\t\t\t\tname="dateGroupItem"\n\t\t\t\t\t:dateGroupItem="dateGroupItem"\n\t\t\t\t\t:isMarkedBlock="dateGroupItem.type === BlockType.markedMessages"\n\t\t\t\t\t:isNewMessagesBlock="dateGroupItem.type === BlockType.newMessages"\n\t\t\t\t\t:isAuthorBlock="dateGroupItem.type === BlockType.authorGroup"\n\t\t\t\t></slot>\n\t\t\t</template>\n\t\t</div>\n\t`};const we=new Set([f.MessageComponent.default,f.MessageComponent.copilotMessage,f.MessageComponent.checkIn,f.MessageComponent.FeedbackFormMessage,f.MessageComponent.ImOpenLinesMessage,f.MessageComponent.ImOpenLinesForm]);const Ne={name:"MessageSelectButton",props:{message:{type:Object,required:true}},computed:{messageItem(){return this.message},selectedMessages(){return this.$store.getters["messages/select/getCollection"]},bulkActionMessageLimit(){const e=b.Extension.getSettings("im.v2.component.message-list");return e.get("multipleActionMessageLimit")},isMessageSelected(){return this.$store.getters["messages/select/isMessageSelected"](this.messageItem.id)},isSelectionLimitReached(){return this.selectedMessages.size===this.bulkActionMessageLimit&&!this.isMessageSelected},isRealMessage(){return this.$store.getters["messages/isRealMessage"](this.messageItem.id)},canSelectMessage(){if(this.messageItem.isDeleted||!this.isRealMessage){return false}return we.has(this.messageItem.componentId)}},methods:{onSelectMessage(){if(!this.canSelectMessage){return}if(this.isSelectionLimitReached){this.showNotification(this.loc("IM_MESSAGE_LIST_MAX_LIMIT_SELECTED_MESSAGES"));return}this.$store.dispatch("messages/select/toggle",this.messageItem.id)},showNotification(e){BX.UI.Notification.Center.notify({content:e})},loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div @click="onSelectMessage" class="bx-im-message-list-select-button__container">\n\t\t\t<div\n\t\t\t\tv-if="canSelectMessage"\n\t\t\t\tclass="bx-im-message-list-select-button__checkbox-circle"\n\t\t\t\t:class="{'--selected': isMessageSelected}"\n\t\t\t/>\n\t\t</div>\n\t`};const Ue={name:"AuthorGroup",components:{MessageAvatar:M.MessageAvatar,MessageSelectButton:Ne},props:{item:{type:Object,required:true},contextDialogId:{type:String,required:true},withAvatarMenu:{type:Boolean,default:true}},emits:["avatarClick"],computed:{AvatarSize:()=>M.AvatarSize,contextDialog(){return this.$store.getters["chats/get"](this.contextDialogId,true)},contextUser(){return this.$store.getters["users/get"](this.contextDialogId,true)},isUser(){return this.contextDialog.type===f.ChatType.user},isBulkActionsMode(){return this.$store.getters["messages/select/getBulkActionsMode"]},authorGroup(){return this.item},authorDialogId(){return this.authorGroup.avatar.avatarId},firstMessageIdInAuthorGroup(){return this.authorGroup.messages[0].id},avatarMenuAvailable(){if(!this.withAvatarMenu){return false}const e=this.$store.getters["users/get"](this.authorDialogId);if(!e){return false}const t=new p.CopilotManager;if(t.isCopilotBot(this.authorDialogId)){return false}const s=e.id===C.Core.getUserId();if(s){return false}const a=this.isUser&&this.contextUser.type===f.UserType.bot;if(a){return false}const i=v.PermissionManager.getInstance();return i.canPerformActionByRole(f.ActionByRole.openAvatarMenu,this.contextDialogId)},containerClasses(){const e=[`--${this.authorGroup.messageType}`];if(!this.avatarMenuAvailable){e.push("--no-menu")}if(this.isBulkActionsMode){e.push("--is-bulk-actions-mode")}if(this.authorGroup.avatar.isNeeded){e.push("--has-avatar")}return e}},methods:{isAvatarNeeded(e){const t=this.authorGroup.messages.length-1;return this.authorGroup.avatar.isNeeded&&e===t},onAvatarClick(e){if(!this.avatarMenuAvailable){return}this.$emit("avatarClick",{dialogId:this.authorGroup.avatar.avatarId,$event:e})},loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-author-group__container" :class="containerClasses">\n\t\t\t<template v-for="(message, index) in authorGroup.messages">\n\t\t\t\t<Transition name="bx-im-select-button-transition">\n\t\t\t\t\t<MessageSelectButton v-if="isBulkActionsMode" :message="message" />\n\t\t\t\t</Transition>\n\t\t\t\t<div v-if="isAvatarNeeded(index)" class="bx-im-message-list-author-group__avatar">\n\t\t\t\t\t<MessageAvatar\n\t\t\t\t\t\t:messageId="firstMessageIdInAuthorGroup"\n\t\t\t\t\t\t:authorId="authorGroup.avatar.avatarId"\n\t\t\t\t\t\t:size="AvatarSize.L"\n\t\t\t\t\t\t@click="onAvatarClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<slot name="message" :message="message" :index="index"></slot>\n\t\t\t</template>\n\t\t</div>\n\t`};const Xe={data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-new-message__container">\n\t\t\t<div class="bx-im-message-list-new-message__text">\n\t\t\t\t{{ loc('IM_DIALOG_CHAT_BLOCK_NEW_MESSAGES_2') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const Ke={data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-new-message__container">\n\t\t\t<div class="bx-im-message-list-new-message__text">\n\t\t\t\t{{ loc('IM_DIALOG_CHAT_BLOCK_MARKED_MESSAGES') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const Re=[b.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_1"),b.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_2"),b.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_3"),b.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_4"),b.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_5")];const je={name:"EmptyState",props:{dialogId:{type:String,required:true}},data(){return{}},computed:{defaultMessages:()=>Re},methods:{onMessageClick(e){I.EventEmitter.emit(f.EventType.textarea.insertText,{text:e,dialogId:this.dialogId})},loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-empty-state__container">\n\t\t\t<div class="bx-im-message-list-empty-state__content">\n\t\t\t\t<div class="bx-im-message-list-empty-state__icon"></div>\n\t\t\t\t<div class="bx-im-message-list-empty-state__title">{{ loc('IM_MESSAGE_LIST_EMPTY_STATE_TITLE') }}</div>\n\t\t\t\t<div class="bx-im-message-list-empty-state__action-list">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for="(message, index) in defaultMessages"\n\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\t@click="onMessageClick(message)"\n\t\t\t\t\t\tclass="bx-im-message-list-empty-state__action-list_item"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ message }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const $e={name:"HistoryLimitBanner",props:{noMessages:{type:Boolean,required:true},dialogId:{type:String,required:true}},computed:{title(){return L.FeatureManager.chatHistory.getLimitTitle()},subtitle(){return L.FeatureManager.chatHistory.getLimitSubtitle()},buttonText(){return L.FeatureManager.chatHistory.getLearnMoreText()}},mounted(){this.sendAnalytics()},methods:{onButtonClick(){_.Analytics.getInstance().historyLimit.onDialogBannerClick({dialogId:this.dialogId});L.FeatureManager.chatHistory.openFeatureSlider()},sendAnalytics(){_.Analytics.getInstance().historyLimit.onDialogLimitExceeded({dialogId:this.dialogId,noMessages:this.noMessages})}},template:`\n\t\t<div class="bx-im-message-list-history-banner__container" :class="{'--no-messages': noMessages}">\n\t\t\t<div class="bx-im-message-list-history-banner__left">\n\t\t\t\t<div class="bx-im-message-list-history-banner__title">\n\t\t\t\t\t<div class="bx-im-message-list-history-banner__icon bx-im-messenger__lock-icon"></div>\n\t\t\t\t\t<div class="bx-im-message-list-history-banner__title_text --ellipsis" :title="title">\n\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-message-list-history-banner__subtitle --line-clamp-2" :title="subtitle">\n\t\t\t\t\t{{ subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-message-list-history-banner__right">\n\t\t\t\t<div class="bx-im-message-list-history-banner__button" @click="onButtonClick">\n\t\t\t\t\t{{ buttonText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};var Ve=babelHelpers.classPrivateFieldLooseKey("getAvatarConfig");var Ye=babelHelpers.classPrivateFieldLooseKey("getMessageType");var qe=babelHelpers.classPrivateFieldLooseKey("checkIfAvatarIsNeeded");class ze{constructor(){Object.defineProperty(this,qe,{value:Ze});Object.defineProperty(this,Ye,{value:We});Object.defineProperty(this,Ve,{value:Qe})}getAuthorBlock(e){return{type:f.DialogBlockType.authorGroup,userId:e.authorId,avatar:babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve](e),messageType:babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye](e)}}getMarkedBlock(){return{type:f.DialogBlockType.markedMessages}}getNewMessagesBlock(){return{type:f.DialogBlockType.newMessages}}}function Qe(e){return{isNeeded:babelHelpers.classPrivateFieldLooseBase(this,qe)[qe](e),avatarId:e.authorId.toString()}}function We(e){if(!e.authorId){return f.MessageType.system}if(e.authorId===C.Core.getUserId()){return f.MessageType.self}return f.MessageType.opponent}function Ze(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye](e);const s=t===f.MessageType.system;if(s){return false}const a=t===f.MessageType.self;const i=C.Core.getStore().getters["application/settings/get"](f.Settings.appearance.alignment);if(i===f.DialogAlignment.center){return!a}return true}var Je=babelHelpers.classPrivateFieldLooseKey("blockManager");var et=babelHelpers.classPrivateFieldLooseKey("collection");var tt=babelHelpers.classPrivateFieldLooseKey("currentDateTitles");var st=babelHelpers.classPrivateFieldLooseKey("markedIndicatorInserted");var at=babelHelpers.classPrivateFieldLooseKey("lastDateItems");var it=babelHelpers.classPrivateFieldLooseKey("lastAuthorId");var nt=babelHelpers.classPrivateFieldLooseKey("lastAuthorItems");var ot=babelHelpers.classPrivateFieldLooseKey("clearLastAuthor");class rt{constructor(){Object.defineProperty(this,ot,{value:lt});Object.defineProperty(this,Je,{writable:true,value:void 0});Object.defineProperty(this,et,{writable:true,value:[]});Object.defineProperty(this,tt,{writable:true,value:new Set});Object.defineProperty(this,st,{writable:true,value:false});Object.defineProperty(this,at,{writable:true,value:[]});Object.defineProperty(this,it,{writable:true,value:null});Object.defineProperty(this,nt,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=new ze}get(){return babelHelpers.classPrivateFieldLooseBase(this,et)[et]}hasDateTitle(e){return babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].has(e)}addDateGroup(e){babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].add(e);babelHelpers.classPrivateFieldLooseBase(this,at)[at]=[];babelHelpers.classPrivateFieldLooseBase(this,et)[et].push({dateTitle:e,items:babelHelpers.classPrivateFieldLooseBase(this,at)[at]});babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]()}addAuthorGroup(e){babelHelpers.classPrivateFieldLooseBase(this,it)[it]=e.authorId;babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=[];babelHelpers.classPrivateFieldLooseBase(this,at)[at].push({...babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].getAuthorBlock(e),messages:babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]})}addMessage(e){babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].push(e)}addMarkedIndicator(){babelHelpers.classPrivateFieldLooseBase(this,at)[at].push(babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].getMarkedBlock());babelHelpers.classPrivateFieldLooseBase(this,st)[st]=true;babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]()}addNewMessagesIndicator(){if(babelHelpers.classPrivateFieldLooseBase(this,st)[st]){return}babelHelpers.classPrivateFieldLooseBase(this,at)[at].push(babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].getNewMessagesBlock());babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]()}getLastAuthorId(){return babelHelpers.classPrivateFieldLooseBase(this,it)[it]}}function lt(){babelHelpers.classPrivateFieldLooseBase(this,it)[it]=null}var ct=babelHelpers.classPrivateFieldLooseKey("getLocalShortDate");class gt{constructor(){Object.defineProperty(this,ct,{value:dt});this.cachedDateGroups={}}getDateTitle(e){const t=babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](e);if(this.cachedDateGroups[t]){return this.cachedDateGroups[t]}this.cachedDateGroups[t]=y.DateFormatter.formatByTemplate(e,y.DateTemplate.dateGroup);return this.cachedDateGroups[t]}}function dt(e){const t=e.getTime()-e.getTimezoneOffset()*6e4;const s=new Date(t).toJSON();const a=10;return s.slice(0,a)}var ut=babelHelpers.classPrivateFieldLooseKey("setInitialValues");var ht=babelHelpers.classPrivateFieldLooseKey("handleMarkedMessageId");var mt=babelHelpers.classPrivateFieldLooseKey("getLastReadMessageId");var Mt=babelHelpers.classPrivateFieldLooseKey("getDialog");class pt{constructor(e){Object.defineProperty(this,Mt,{value:_t});Object.defineProperty(this,mt,{value:It});Object.defineProperty(this,ht,{value:bt});Object.defineProperty(this,ut,{value:vt});this.firstIteration=true;this.dialogId=e;this.dateManager=new gt}formatMessageCollection(e){const t=new rt;babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]();babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]();e.forEach(((s,a)=>{const i=this.dateManager.getDateTitle(s.date);if(!t.hasDateTitle(i)){t.addDateGroup(i)}if(s.id===this.markedMessageId){t.addMarkedIndicator()}if(s.authorId!==t.getLastAuthorId()){t.addAuthorGroup(s)}t.addMessage(s);const n=a===e.length-1;if(!n&&s.id===this.lastReadMessageId){t.addNewMessagesIndicator()}}));const{inited:s}=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]();if(s){this.firstIteration=false}return t.get()}formatAuthorGroup(e){const t=new ze;return{...t.getAuthorBlock(e),messages:[e]}}}function vt(){if(!this.firstIteration){return}const{markedId:e}=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]();this.lastReadMessageId=babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]();this.markedMessageId=e}function bt(){const{markedId:e}=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]();if(e===this.markedMessageId||e===0){return}this.markedMessageId=e;this.lastReadMessageId=null}function It(){const{lastMessageId:e}=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]();const t=C.Core.getStore().getters["chats/getLastReadId"](this.dialogId);if(t===e){return 0}return t}function _t(){return C.Core.getStore().getters["chats/get"](this.dialogId)}const Lt={DefaultMessage:A.DefaultMessage,FileMessage:B.FileMessage,SmileMessage:P.SmileMessage,CallInviteMessage:E.CallInviteMessage,DeletedMessage:F.DeletedMessage,SystemMessage:S.SystemMessage,UnsupportedMessage:x.UnsupportedMessage,ChatCreationMessage:T.ChatCreationMessage,OwnChatCreationMessage:j.OwnChatCreationMessage,ChatCopilotCreationMessage:H.ChatCopilotCreationMessage,CopilotMessage:k.CopilotMessage,SupportVoteMessage:O.SupportVoteMessage,SupportSessionNumberMessage:G.SupportSessionNumberMessage,SupportChatCreationMessage:w.SupportChatCreationMessage,ConferenceCreationMessage:N.ConferenceCreationMessage,ZoomInviteMessage:$.ZoomInviteMessage,CheckInMessage:R.CheckInMessage,SupervisorUpdateFeatureMessage:U.SupervisorUpdateFeatureMessage,SupervisorEnableFeatureMessage:X.SupervisorEnableFeatureMessage,ChatCopilotAddedUsersMessage:D.ChatCopilotAddedUsersMessage,SignMessage:K.SignMessage,GeneralChatCreationMessage:V.GeneralChatCreationMessage,GeneralChannelCreationMessage:Y.GeneralChannelCreationMessage,ChannelCreationMessage:q.ChannelCreationMessage,CallMessage:Z.CallMessage,StartDialogMessage:z.StartDialogMessage,FeedbackFormMessage:W.FeedbackFormMessage,HiddenMessage:Q.HiddenMessage,VoteMessage:J.VoteMessage};const Ct={name:"MessageList",directives:{"message-observer":{mounted(e,t){t.instance.observer.observeMessage(e)},beforeUnmount(e,t){t.instance.observer.unobserveMessage(e)}}},components:{DateGroup:Ge,AuthorGroup:Ue,NewMessagesBlock:Xe,MarkedMessagesBlock:Ke,DialogStatus:M.DialogStatus,DialogLoader:ee,EmptyState:je,FadeAnimation:s.FadeAnimation,HistoryLimitBanner:$e,...Lt},props:{dialogId:{type:String,required:true},messageMenuClass:{type:Function,default:ue}},data(){return{windowFocused:false,messageMenuIsActiveForId:0}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},user(){return this.$store.getters["users/get"](this.dialogId,true)},messageCollection(){return this.$store.getters["messages/getByChatId"](this.dialog.chatId)},isUser(){return this.dialog.type===f.ChatType.user},dialogInited(){return this.dialog.inited},formattedCollection(){if(!this.dialogInited&&this.messageCollection.length===0){return[]}return this.getCollectionManager().formatMessageCollection(this.messageCollection)},noMessages(){return this.formattedCollection.length===0},isHistoryLimitExceeded(){return!L.FeatureManager.chatHistory.isAvailable()&&this.dialog.tariffRestrictions.isHistoryLimitExceeded},showDialogStatus(){return this.messageCollection.some((e=>e.id===this.dialog.lastMessageId))},showEmptyState(){return this.dialogInited&&this.noMessages&&this.isUser&&!this.isHistoryLimitExceeded}},created(){this.initContextMenu();this.initCollectionManager();this.initObserverManager()},mounted(){this.subscribeToEvents()},beforeUnmount(){this.unsubscribeFromEvents()},methods:{subscribeToEvents(){I.EventEmitter.subscribe(f.EventType.dialog.onClickMessageContextMenu,this.onMessageContextMenuClick)},unsubscribeFromEvents(){I.EventEmitter.unsubscribe(f.EventType.dialog.onClickMessageContextMenu,this.onMessageContextMenuClick)},insertTextQuote(e){I.EventEmitter.emit(f.EventType.textarea.insertText,{text:t.Quote.prepareQuoteText(e),withNewLine:true,replace:false,dialogId:this.dialogId})},insertMention(e){I.EventEmitter.emit(f.EventType.textarea.insertMention,{mentionText:e.name,mentionReplacement:d.Utils.text.getMentionBbCode(e.id,e.name),dialogId:this.dialogId})},openReplyPanel(e){I.EventEmitter.emit(f.EventType.textarea.replyMessage,{messageId:e,dialogId:this.dialogId})},onAvatarClick(e){const{dialogId:t,$event:s}=e;const a=this.$store.getters["users/get"](t);if(d.Utils.key.isAltOrOption(s)){this.insertMention(a);return}this.avatarMenu.openMenu({user:a,dialog:this.dialog},s.currentTarget)},onMessageContextMenuClick(e){const t=v.PermissionManager.getInstance();if(!t.canPerformActionByRole(f.ActionByRole.openMessageMenu,this.dialogId)){return}const{message:s,event:a,dialogId:i}=e.getData();if(i!==this.dialogId){return}if(d.Utils.key.isCombination(a,["Alt+Ctrl"])){this.insertTextQuote(s);return}if(d.Utils.key.isCmdOrCtrl(a)){this.openReplyPanel(s.id);return}const n={dialogId:this.dialogId,...s};this.messageMenu.openMenu(n,a.currentTarget);this.messageMenuIsActiveForId=s.id},async onMessageMouseUp(e,t){await d.Utils.browser.waitForSelectionToUpdate();const s=window.getSelection().toString().trim();if(s.length===0){return}I.EventEmitter.emit(f.EventType.dialog.showQuoteButton,{message:e,event:t})},initObserverManager(){this.observer=new Pe(this.dialogId)},initContextMenu(){const e=this.messageMenuClass;this.messageMenu=new e;this.messageMenu.subscribe(ue.events.onCloseMenu,(()=>{this.messageMenuIsActiveForId=0}));this.avatarMenu=new te},getMessageComponentName(e){return new a.MessageComponentManager(e).getName()},initCollectionManager(){this.collectionManager=new pt(this.dialogId)},getCollectionManager(){return this.collectionManager}},template:`\n\t\t<slot v-if="!dialogInited" name="loader">\n\t\t\t<DialogLoader />\n\t\t</slot>\n\t\t<FadeAnimation :duration="200">\n\t\t\t<div v-if="dialogInited" class="bx-im-message-list__container">\n\t\t\t\t<EmptyState v-if="showEmptyState" :dialogId="dialogId" />\n\t\t\t\t<slot name="before-messages" :getMessageComponentName="getMessageComponentName"></slot>\n\t\t\t\t<HistoryLimitBanner v-if="isHistoryLimitExceeded" :dialogId="dialogId" :noMessages="noMessages" />\n\t\t\t\t<DateGroup v-for="dateGroup in formattedCollection" :key="dateGroup.dateTitle" :item="dateGroup">\n\t\t\t\t\t\x3c!-- Slot for every date group item --\x3e\n\t\t\t\t\t<template #dateGroupItem="{ dateGroupItem, isMarkedBlock, isNewMessagesBlock, isAuthorBlock }">\n\t\t\t\t\t\t<MarkedMessagesBlock v-if="isMarkedBlock" data-id="newMessages" />\n\t\t\t\t\t\t<NewMessagesBlock v-else-if="isNewMessagesBlock" data-id="newMessages" />\n\t\t\t\t\t\t<AuthorGroup \n\t\t\t\t\t\t\tv-else-if="isAuthorBlock" \n\t\t\t\t\t\t\t:item="dateGroupItem"\n\t\t\t\t\t\t\t:contextDialogId="dialogId"\n\t\t\t\t\t\t\t@avatarClick="onAvatarClick"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\x3c!-- Slot for every message --\x3e\n\t\t\t\t\t\t\t<template #message="{ message, index }">\n\t\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\t\tv-message-observer\n\t\t\t\t\t\t\t\t\t:is="getMessageComponentName(message)"\n\t\t\t\t\t\t\t\t\t:withTitle="index === 0"\n\t\t\t\t\t\t\t\t\t:item="message"\n\t\t\t\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t\t\t\t:key="message.id"\n\t\t\t\t\t\t\t\t\t:menuIsActiveForId="messageMenuIsActiveForId"\n\t\t\t\t\t\t\t\t\t:data-viewed="message.viewed"\n\t\t\t\t\t\t\t\t\t@mouseup="onMessageMouseUp(message, $event)"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</component>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</AuthorGroup>\n\t\t\t\t\t</template>\n\t\t\t\t</DateGroup>\n\t\t\t\t<DialogStatus v-if="showDialogStatus" :dialogId="dialogId" />\n\t\t\t</div>\n\t\t</FadeAnimation>\n\t`};e.MessageList=Ct;e.AvatarMenu=te;e.MessageMenu=ue;e.AuthorGroup=Ue;e.MessageComponents=Lt;e.CollectionManager=pt})(this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Animation,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.OpenLines.v2.Component.Message,BX.OpenLines.v2.Component.Message,BX.OpenLines.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message);
//# sourceMappingURL=message-list.bundle.map.js