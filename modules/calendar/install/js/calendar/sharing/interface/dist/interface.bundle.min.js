this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(e,s,t,a,i,l,r,o,n,d,c,b,h,p,v,u,g,L,P,F){"use strict";var H=babelHelpers.classPrivateFieldLooseKey("calendarSettings");var B=babelHelpers.classPrivateFieldLooseKey("getSlotSize");class y extends n.EventEmitter{constructor(e){super();Object.defineProperty(this,B,{value:m});Object.defineProperty(this,H,{writable:true,value:void 0});this.setEventNamespace("Calendar.Sharing.Range");const{id:s,range:t,rule:a,calendarSettings:i,isNew:l}=e;this.id=s;this.rule=a;this.from=t.from;this.to=t.to;this.new=l;this.deletable=false;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=i;this.setWeekDays(t.weekdays)}toArray(){return{from:this.getFrom(),to:this.to,weekdays:this.getWeekDays()}}getRule(){return this.rule}getId(){return this.id}getFromFormatted(){return this.formatMinutes(this.getFrom())}getFrom(){return this.from}setFrom(e){this.from=parseInt(e,10);if(this.from+babelHelpers.classPrivateFieldLooseBase(this,B)[B]()>this.to){this.to=this.from+babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}this.updated()}getToFormatted(){return this.formatMinutes(this.getTo())}getTo(){return this.to}setTo(e){this.to=e;this.updated()}updateSlotSize(){const e=24*60-babelHelpers.classPrivateFieldLooseBase(this,B)[B]();if(this.from>e){this.from=e;this.to=this.from+babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}else if(this.from+babelHelpers.classPrivateFieldLooseBase(this,B)[B]()>this.to){this.to=this.from+babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}this.updated()}addWeekday(e){if(this.weekdays.includes(e)){return}this.setWeekDays([...this.weekdays,e])}removeWeekday(e){this.setWeekDays(this.weekdays.filter((s=>s!==e)))}getWeekDays(){return this.weekdays}setWeekDays(e){this.weekdays=this.sortWeekdays(e);this.updated()}getWeekdaysTitle(e=false){if([...this.weekdays].sort().join(",")===[1,2,3,4,5].sort().join(",")){return L.Loc.getMessage("CALENDAR_SHARING_SETTINGS_WORKDAYS_MSGVER_1")}return this.formatWeekdays(e)}formatWeekdays(e){const s=i.Util.getWeekdaysLoc(e||this.weekdays.length===1);const t=this.getWeekDays();if(t.length===0){return""}return t.map((e=>s[e])).reduce(((e,s)=>`${e}, ${s}`))}sortWeekdays(e){return e.map((e=>e<babelHelpers.classPrivateFieldLooseBase(this,H)[H].weekStart?e+10:e)).sort(((e,s)=>e-s)).map((e=>e%10))}getAvailableTimeFrom(){const e=[];const s=24*60-babelHelpers.classPrivateFieldLooseBase(this,B)[B]();for(let t=0;t<=24;t++){if(t*60<=s){e.push({value:t*60,name:i.Util.formatTime(t,0)})}if(t!==24&&t*60+30<=s){e.push({value:t*60+30,name:i.Util.formatTime(t,30)})}}return e}getAvailableTimeTo(){const e=[];for(let s=0;s<=24;s++){if(s*60>=this.from+babelHelpers.classPrivateFieldLooseBase(this,B)[B]()){e.push({value:s*60,name:i.Util.formatTime(s,0)})}if(s!==24&&s*60+30>=this.from+babelHelpers.classPrivateFieldLooseBase(this,B)[B]()){e.push({value:s*60+30,name:i.Util.formatTime(s,30)})}}return e}isDeletable(){return this.deletable}setDeletable(e){this.deletable=e}isNew(){return this.new}setNew(e){this.new=e}getWeekStart(){return babelHelpers.classPrivateFieldLooseBase(this,H)[H].weekStart}formatMinutes(e){const s=new Date(i.Util.parseDate("01.01.2000").getTime()+e*60*1e3);return i.Util.formatTime(s)}updated(){this.emit("updated");this.getRule().updated()}}function m(){return this.rule.getSlotSize()}var _=babelHelpers.classPrivateFieldLooseKey("calendarSettings");var f=babelHelpers.classPrivateFieldLooseKey("updateRanges");class S extends n.EventEmitter{constructor(e){super();Object.defineProperty(this,f,{value:T});this.AVAILABLE_INTERVALS=[30,45,60,90,120,180];this.MAX_RANGES=5;this.DEFAULT_SLOT_SIZE=60;Object.defineProperty(this,_,{writable:true,value:void 0});this.setEventNamespace("Calendar.Sharing.Rule");const{rule:s,calendarSettings:t}=e;babelHelpers.classPrivateFieldLooseBase(this,_)[_]=t;this.ranges=[];for(const e of s.ranges){this.addRange(e,false)}this.setSlotSize(s.slotSize);this.sortRanges()}toArray(){return{slotSize:this.getSlotSize(),ranges:this.getSortedRanges().map((e=>e.toArray()))}}getDefaultRule(){return new S({rule:{slotSize:this.DEFAULT_SLOT_SIZE,ranges:[{from:babelHelpers.classPrivateFieldLooseBase(this,_)[_].workTimeStart,to:babelHelpers.classPrivateFieldLooseBase(this,_)[_].workTimeEnd,weekdays:babelHelpers.classPrivateFieldLooseBase(this,_)[_].workDays}]},calendarSettings:babelHelpers.classPrivateFieldLooseBase(this,_)[_]})}getAvailableIntervals(){return this.AVAILABLE_INTERVALS}getFormattedSlotSize(){return i.Util.formatDuration(this.getSlotSize())}getSlotSize(){return this.slotSize}setSlotSize(e){const s=parseInt(e,10);this.slotSize=this.getAvailableIntervals().includes(s)?s:this.DEFAULT_SLOT_SIZE;for(const e of this.getRanges()){e.updateSlotSize()}}getRanges(){return this.ranges}sortRanges(){this.ranges=this.getSortedRanges()}getSortedRanges(){return[...this.ranges].sort(((e,s)=>this.compareRanges(e,s)))}compareRanges(e,s){const t=this.getWeekdaysWeight(e.getWeekDays());const a=this.getWeekdaysWeight(s.getWeekDays());if(t!==a){return t-a}if(e.getFrom()!==s.getFrom()){return e.getFrom()-s.getFrom()}return e.getTo()-s.getTo()}getWeekdaysWeight(e){return e.reduce(((e,s,t)=>e+s*10**(10-t)),0)}addRange(e,s=true){var t;if(!this.canAddRange()){return}(t=this.internalRangeId)!=null?t:this.internalRangeId=1;this.ranges.push(new y({id:this.internalRangeId++,range:e!=null?e:this.getDefaultRule().getRanges()[0],calendarSettings:babelHelpers.classPrivateFieldLooseBase(this,_)[_],isNew:s,rule:this}));babelHelpers.classPrivateFieldLooseBase(this,f)[f]();this.updated()}removeRange(e){if(!this.canRemoveRange()){return false}this.ranges=this.ranges.filter((s=>s.getId()!==e.getId()));babelHelpers.classPrivateFieldLooseBase(this,f)[f]();this.rangeDeleted();return true}canAddRange(){return this.ranges.length<this.MAX_RANGES}canRemoveRange(){return this.ranges.length>1}updated(){this.emit("updated")}rangeDeleted(){this.emit("rangeDeleted")}}function T(){for(const e of this.ranges.slice(0,-1)){e.setDeletable(true)}this.ranges.slice(-1)[0].setDeletable(this.ranges.length===5)}var w=babelHelpers.classPrivateFieldLooseKey("params");var E=babelHelpers.classPrivateFieldLooseKey("rule");var C=babelHelpers.classPrivateFieldLooseKey("memberIds");var k=babelHelpers.classPrivateFieldLooseKey("createRuleModel");var O=babelHelpers.classPrivateFieldLooseKey("updateSortByFrequentUse");class A{constructor(e){Object.defineProperty(this,O,{value:I});Object.defineProperty(this,k,{value:N});Object.defineProperty(this,w,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,w)[w]=e;const{rule:s,calendarSettings:t}=e;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=babelHelpers.classPrivateFieldLooseBase(this,k)[k](s,t)}getMinutesFromTime(e){const t=(new Date).toDateString();const a=new Date(`${t} ${`${e}`.replace(".",":")}:00`);const l=s.DateTimeFormat.getFormat("SHORT_TIME_FORMAT");const r=i.Util.parseTime(s.DateTimeFormat.format(l,a/1e3));return r.h*60+r.m}getWorkingDays(e){const s=new Set(e.map((e=>i.Util.getIndByWeekDay(e))));return[0,1,2,3,4,5,6].filter((e=>!s.has(e)))}isDefaultRule(){return!this.isDifferentFrom(this.getRule().getDefaultRule())}isDifferentFrom(e){return this.getChanges(e,this.getRule()).length>0}getChanges(e){const s=this.getRule().toArray();const a=(e!=null?e:this.getRule().getDefaultRule()).toArray();const i=s.slotSize!==a.slotSize;const l=JSON.stringify(s.ranges)!==JSON.stringify(a.ranges);const r=[];if(l){r.push(t.Analytics.ruleChanges.custom_days)}if(i){r.push(t.Analytics.ruleChanges.custom_length)}return r}sortRanges(){this.getRule().sortRanges()}getRule(){return babelHelpers.classPrivateFieldLooseBase(this,E)[E]}getUserInfo(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].userInfo}getContext(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].context}getLinkHash(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].linkHash}getSharingUrl(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].sharingUrl}isCollapsed(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].collapsed}sortJointLinksByFrequentUse(){return babelHelpers.classPrivateFieldLooseBase(this,w)[w].sortJointLinksByFrequentUse}changeSortJointLinksByFrequentUse(){babelHelpers.classPrivateFieldLooseBase(this,w)[w].sortJointLinksByFrequentUse=!babelHelpers.classPrivateFieldLooseBase(this,w)[w].sortJointLinksByFrequentUse;babelHelpers.classPrivateFieldLooseBase(this,O)[O]()}setMemberIds(e){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e}getMemberIds(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C]}async saveJointLink(){const e=await BX.ajax.runAction("calendar.api.sharingajax.generateUserJointSharingLink",{data:{memberIds:this.getMemberIds()}});return e.data}save(){if(!this.isDifferentFrom(babelHelpers.classPrivateFieldLooseBase(this,k)[k](babelHelpers.classPrivateFieldLooseBase(this,w)[w].rule,babelHelpers.classPrivateFieldLooseBase(this,w)[w].calendarSettings))){return}const e=this.getChanges();t.Analytics.sendRuleUpdated(this.getContext(),e);const s=this.getRule().toArray();return new Promise(((e,t)=>{BX.ajax.runAction("calendar.api.sharingajax.saveLinkRule",{data:{linkHash:this.getLinkHash(),ruleArray:s}}).then((()=>{n.EventEmitter.emit("CalendarSharing:RuleUpdated");babelHelpers.classPrivateFieldLooseBase(this,w)[w].rule=s;e()}),(e=>{console.error(e);t()}))}))}increaseFrequentUse(){void BX.ajax.runAction("calendar.api.sharingajax.increaseFrequentUse",{data:{hash:this.getLinkHash()}})}updateCollapsed(e){void BX.ajax.runAction("calendar.api.sharingajax.updateSharingSettingsCollapsed",{data:{collapsed:e?"Y":"N"}})}}function N(e,s){const{weekStart:t,weekHolidays:a,workTimeStart:l,workTimeEnd:r}=s;return new S({rule:e,calendarSettings:{weekStart:i.Util.getIndByWeekDay(t),workTimeStart:this.getMinutesFromTime(l),workTimeEnd:this.getMinutesFromTime(r),workDays:this.getWorkingDays(a)}})}function I(){BX.ajax.runAction("calendar.api.sharingajax.setSortJointLinksByFrequentUse",{data:{sortByFrequentUse:babelHelpers.classPrivateFieldLooseBase(this,w)[w].sortJointLinksByFrequentUse?"Y":"N"}})}let R=e=>e,D;class U{constructor(e){this.wrap=null;this.name=e.name;this.index=e.index;this.active=e.active;this.onSelected=L.Type.isFunction(e.onSelected)?e.onSelected:()=>{};this.onDiscarded=L.Type.isFunction(e.onDiscarded)?e.onDiscarded:()=>{};this.onMouseDown=L.Type.isFunction(e.onMouseDown)?e.onMouseDown:()=>{};this.canBeDiscarded=L.Type.isFunction(e.canBeDiscarded)?e.canBeDiscarded:()=>{}}render(){const e=this.active?"--selected":"";this.wrap=L.Tag.render(D||(D=R`
			<div class="calendar-sharing__settings-popup-weekday ${0}" onmousedown="${0}">
				<div class="calendar-sharing__settings-popup-weekday-text">${0}</div>
				<div class="calendar-sharing__settings-popup-weekday-icon"></div>
			</div>
		`),e,(e=>this.handleMouseDown(e)),this.name);return this.wrap}handleMouseDown(e){if(this.active){this.discard()}else{this.select()}this.onMouseDown(e,this)}select(){this.active=true;L.Dom.addClass(this.wrap,"--selected");this.onSelected()}discard(){if(!this.canBeDiscarded()){return}this.active=false;L.Dom.removeClass(this.wrap,"--selected");this.onDiscarded()}}let M=e=>e,j,K,W,x,$,G,X,z;var q=babelHelpers.classPrivateFieldLooseKey("params");var J=babelHelpers.classPrivateFieldLooseKey("layout");var Y=babelHelpers.classPrivateFieldLooseKey("model");var Q=babelHelpers.classPrivateFieldLooseKey("bindEvents");var V=babelHelpers.classPrivateFieldLooseKey("unbindEvents");var Z=babelHelpers.classPrivateFieldLooseKey("onRangeUpdated");var ee=babelHelpers.classPrivateFieldLooseKey("animate");var se=babelHelpers.classPrivateFieldLooseKey("getButton");var te=babelHelpers.classPrivateFieldLooseKey("onDeleteButtonClickHandler");var ae=babelHelpers.classPrivateFieldLooseKey("onAddButtonClickHandler");var ie=babelHelpers.classPrivateFieldLooseKey("add");var le=babelHelpers.classPrivateFieldLooseKey("remove");var re=babelHelpers.classPrivateFieldLooseKey("renderWeekdaysSelect");var oe=babelHelpers.classPrivateFieldLooseKey("getTextNodeWidth");var ne=babelHelpers.classPrivateFieldLooseKey("createWeekdaysPopup");var de=babelHelpers.classPrivateFieldLooseKey("createWeekday");var ce=babelHelpers.classPrivateFieldLooseKey("onWeekdayMouseDown");var be=babelHelpers.classPrivateFieldLooseKey("renderTimeFromSelect");var he=babelHelpers.classPrivateFieldLooseKey("renderTimeToSelect");var pe=babelHelpers.classPrivateFieldLooseKey("renderTimeSelect");var ve=babelHelpers.classPrivateFieldLooseKey("onTimeSelectClickHandler");var ue=babelHelpers.classPrivateFieldLooseKey("showTimeMenu");var ge=babelHelpers.classPrivateFieldLooseKey("onWeekdaysSelectClickHandler");class Le{constructor(e){Object.defineProperty(this,ge,{value:Ue});Object.defineProperty(this,ue,{value:De});Object.defineProperty(this,ve,{value:Re});Object.defineProperty(this,pe,{value:Ie});Object.defineProperty(this,he,{value:Ne});Object.defineProperty(this,be,{value:Ae});Object.defineProperty(this,ce,{value:Oe});Object.defineProperty(this,de,{value:ke});Object.defineProperty(this,ne,{value:Ce});Object.defineProperty(this,oe,{value:Ee});Object.defineProperty(this,re,{value:we});Object.defineProperty(this,le,{value:Te});Object.defineProperty(this,ie,{value:Se});Object.defineProperty(this,ae,{value:fe});Object.defineProperty(this,te,{value:_e});Object.defineProperty(this,se,{value:me});Object.defineProperty(this,ee,{value:ye});Object.defineProperty(this,Z,{value:Be});Object.defineProperty(this,V,{value:He});Object.defineProperty(this,Q,{value:Fe});Object.defineProperty(this,Y,{get:Pe,set:void 0});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,J,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e;babelHelpers.classPrivateFieldLooseBase(this,J)[J]={};this.showReadOnlyPopup=L.Type.isFunction(e.showReadOnlyPopup)?e.showReadOnlyPopup:()=>{};this.onRangeUpdated=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]()}hasShownPopups(){const e=this.weekdaysMenu.isShown();const s=L.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,J)[J].fromTimeSelect,"--active");const t=L.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,J)[J].toTimeSelect,"--active");return e||s||t}destroy(){babelHelpers.classPrivateFieldLooseBase(this,J)[J].wrap.remove();babelHelpers.classPrivateFieldLooseBase(this,V)[V]()}render(){babelHelpers.classPrivateFieldLooseBase(this,J)[J].wrap=L.Tag.render(j||(j=M`
			<div class="calendar-sharing__settings-range">
				${0}
				<div class="calendar-sharing__settings-time-interval">
					${0}
					<div class="calendar-sharing__settings-dash"></div>
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,re)[re](),babelHelpers.classPrivateFieldLooseBase(this,be)[be](),babelHelpers.classPrivateFieldLooseBase(this,he)[he](),this.renderButton());if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].isNew()){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()}return babelHelpers.classPrivateFieldLooseBase(this,J)[J].wrap}renderButton(){var e;const s=babelHelpers.classPrivateFieldLooseBase(this,se)[se]();(e=babelHelpers.classPrivateFieldLooseBase(this,J)[J].button)==null?void 0:e.replaceWith(s);babelHelpers.classPrivateFieldLooseBase(this,J)[J].button=s;return babelHelpers.classPrivateFieldLooseBase(this,J)[J].button}updateWeekdaysTitle(){babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect.title=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].formatWeekdays(false);babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect.innerText=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getWeekdaysTitle(true);const e=babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect.offsetWidth-32;const s=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect.firstChild);const t=e<s;if(t){babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect.innerText=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getWeekdaysTitle(false)}}formatAmPmSpan(e){return e.toLowerCase().replace(/(am|pm)/g,'<span class="calendar-sharing__settings-time-am-pm">$1</span>')}}function Pe(){return babelHelpers.classPrivateFieldLooseBase(this,q)[q].model}function Fe(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].subscribe("updated",this.onRangeUpdated)}function He(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].unsubscribe("updated",this.onRangeUpdated)}function Be(){this.updateWeekdaysTitle()}function ye(){L.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,J)[J].wrap,"--animate-show");setTimeout((()=>{L.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,J)[J].wrap,"--animate-show");babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].setNew(false)}),300)}function me(){if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].isDeletable()){return L.Tag.render(K||(K=M`
				<div
					class="calendar-sharing__settings-delete"
					onclick="${0}"
				></div>
			`),babelHelpers.classPrivateFieldLooseBase(this,te)[te].bind(this))}return L.Tag.render(W||(W=M`
			<div
				class="calendar-sharing__settings-add"
				onclick="${0}"
			></div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].bind(this))}function _e(){if(babelHelpers.classPrivateFieldLooseBase(this,q)[q].readOnly){this.showReadOnlyPopup(babelHelpers.classPrivateFieldLooseBase(this,J)[J].button)}else{babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}}function fe(){if(babelHelpers.classPrivateFieldLooseBase(this,q)[q].readOnly){this.showReadOnlyPopup(babelHelpers.classPrivateFieldLooseBase(this,J)[J].button)}else{babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]()}}function Se(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getRule().addRange()}function Te(){if(!babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getRule().removeRange(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y])){return}L.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,J)[J].wrap,"--animate-remove");setTimeout((()=>this.destroy()),300)}function we(){const e=i.Util.getWeekdaysLoc().map(((e,s)=>({loc:e,index:s,active:babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getWeekDays().includes(s)})));e.push(...e.splice(0,babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getWeekStart()));babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect=L.Tag.render(x||(x=M`
			<div
				class="calendar-sharing__settings-weekdays calendar-sharing__settings-select calendar-sharing__settings-select-arrow"
				title="${0}"
			>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].formatWeekdays(),babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getWeekdaysTitle());const s=new IntersectionObserver((()=>{if(babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect.offsetWidth>0){this.updateWeekdaysTitle()}}));s.observe(babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect);L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect,"click",babelHelpers.classPrivateFieldLooseBase(this,ge)[ge].bind(this));this.weekdays=e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,de)[de](e)));const t=`calendar-sharing-settings-weekdays-${babelHelpers.classPrivateFieldLooseBase(this,q)[q].model.id}`;this.weekdaysMenu=P.PopupManager.getPopupById(t);if(!this.weekdaysMenu){this.weekdaysMenu=babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](t);this.weekdaysMenu.canBeClosed=true}this.weekdaysMenu.setBindElement(babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect);return babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect}function Ee(e){const s=BX.Tag.render($||($=M`<span style="position: absolute;">${0}</span>`),e.cloneNode());e.replaceWith(s);const t=s.offsetWidth;s.replaceWith(e);return t}function Ce(e){return new P.Popup({id:e,content:L.Tag.render(G||(G=M`
				<div class="calendar-sharing__settings-popup-weekdays">
					${0}
				</div>
			`),this.weekdays.map((e=>e.render()))),autoHide:true,closeByEsc:true,angle:{position:"top",offset:105},autoHideHandler:()=>this.weekdaysMenu.canBeClosed,events:{onPopupShow:()=>L.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect,"--active"),onPopupClose:()=>L.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect,"--active")}})}function ke(e){return new U({name:e.loc,index:e.index,active:e.active,onSelected:()=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].addWeekday(e.index),onDiscarded:()=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].removeWeekday(e.index),canBeDiscarded:()=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getWeekDays().length>1,onMouseDown:babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].bind(this)})}function Oe(e,s){this.weekdaysMenu.canBeClosed=false;const t=e.clientX;const a=s.active;this.controllableWeekdays=[];this.collectIntersectedWeekdays=e=>{for(const s of this.weekdays){const a=s.wrap.getBoundingClientRect().right;const i=s.wrap.getBoundingClientRect().left;if(t>a&&e.clientX<a||t<i&&e.clientX>i||i<t&&t<a){if(!this.controllableWeekdays.includes(s)){this.controllableWeekdays.push(s)}s.intersected=true}}};this.onMouseMove=e=>{this.controllableWeekdays.forEach((e=>{e.intersected=false}));this.collectIntersectedWeekdays(e);for(const e of this.controllableWeekdays){if(e.intersected&&a||!e.intersected&&!a){e.select()}else{e.discard()}}};L.Event.bind(document,"mousemove",this.onMouseMove);L.Event.bind(document,"mouseup",(()=>{L.Event.unbind(document,"mousemove",this.onMouseMove);setTimeout((()=>{this.weekdaysMenu.canBeClosed=true}),0)}))}function Ae(){babelHelpers.classPrivateFieldLooseBase(this,J)[J].fromTimeSelect=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getFromFormatted(),{getTimeStamps:()=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getAvailableTimeFrom(),isSelected:e=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getFrom()===e,onItemSelected:e=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].setFrom(e)},"calendar-sharing-settings-range-from");return babelHelpers.classPrivateFieldLooseBase(this,J)[J].fromTimeSelect}function Ne(){babelHelpers.classPrivateFieldLooseBase(this,J)[J].toTimeSelect=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getToFormatted(),{getTimeStamps:()=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getAvailableTimeTo(),isSelected:e=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].getTo()===e,onItemSelected:e=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].setTo(e)},"calendar-sharing-settings-range-to");return babelHelpers.classPrivateFieldLooseBase(this,J)[J].toTimeSelect}function Ie(e,s,t){const a=L.Tag.render(X||(X=M`
			<div
				class="calendar-sharing__settings-select calendar-sharing__settings-time calendar-sharing__settings-select-arrow"
				data-id="${0}"
			>
				${0}
			</div>
		`),t,this.formatAmPmSpan(e));L.Event.bind(a,"click",(()=>babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](a,s)));return a}function Re(e,s){if(babelHelpers.classPrivateFieldLooseBase(this,q)[q].readOnly){this.showReadOnlyPopup(e)}else if(!L.Dom.hasClass(e,"--active")){babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](e,s)}}function De(e,s){let t;const a=s.getTimeStamps().map((a=>({html:L.Tag.render(z||(z=M`
					<div class="calendar-sharing__am-pm-container">${0}</div>
				`),a.name),className:s.isSelected(a.value)?"menu-popup-no-icon --selected":"menu-popup-no-icon",onclick:()=>{e.innerHTML=a.name;s.onItemSelected(a.value);t.close()}})));t=P.MenuManager.create({id:`calendar-sharing-settings-time-menu${Date.now()}`,className:"calendar-sharing-settings-time-menu",bindElement:e,items:a,autoHide:true,closeByEsc:true,events:{onShow:()=>L.Dom.addClass(e,"--active"),onClose:()=>L.Dom.removeClass(e,"--active")},maxHeight:300,minWidth:e.offsetWidth});t.show();const i=t.getPopupWindow();const l=i.getContentContainer();const r=l.querySelector(".menu-popup-item.--selected");l.scrollTop=r.offsetTop-r.offsetHeight*2}function Ue(){if(babelHelpers.classPrivateFieldLooseBase(this,q)[q].readOnly){this.showReadOnlyPopup(babelHelpers.classPrivateFieldLooseBase(this,J)[J].weekdaysSelect)}else{this.weekdaysMenu.show()}}let Me=e=>e,je,Ke,We,xe,$e,Ge,Xe,ze,qe;var Je=babelHelpers.classPrivateFieldLooseKey("params");var Ye=babelHelpers.classPrivateFieldLooseKey("layout");var Qe=babelHelpers.classPrivateFieldLooseKey("model");var Ve=babelHelpers.classPrivateFieldLooseKey("rule");var Ze=babelHelpers.classPrivateFieldLooseKey("bindEvents");var es=babelHelpers.classPrivateFieldLooseKey("onRuleUpdated");var ss=babelHelpers.classPrivateFieldLooseKey("onRangeDeleted");var ts=babelHelpers.classPrivateFieldLooseKey("renderHeader");var as=babelHelpers.classPrivateFieldLooseKey("renderSubtitle");var is=babelHelpers.classPrivateFieldLooseKey("updateSubtitle");var ls=babelHelpers.classPrivateFieldLooseKey("getSubtitleText");var rs=babelHelpers.classPrivateFieldLooseKey("renderExpandRuleButton");var os=babelHelpers.classPrivateFieldLooseKey("renderRule");var ns=babelHelpers.classPrivateFieldLooseKey("toggleExpand");var ds=babelHelpers.classPrivateFieldLooseKey("updateRuleHeight");var cs=babelHelpers.classPrivateFieldLooseKey("renderRanges");var bs=babelHelpers.classPrivateFieldLooseKey("createRange");var hs=babelHelpers.classPrivateFieldLooseKey("renderSettingsSlotSizeSelect");var ps=babelHelpers.classPrivateFieldLooseKey("calculateRuleHeight");var vs=babelHelpers.classPrivateFieldLooseKey("removeRuleHeight");var us=babelHelpers.classPrivateFieldLooseKey("slotSizeSelectClickHandler");var gs=babelHelpers.classPrivateFieldLooseKey("showReadOnlyPopup");var Ls=babelHelpers.classPrivateFieldLooseKey("getReadOnlyPopup");var Ps=babelHelpers.classPrivateFieldLooseKey("closeReadOnlyPopup");class Fs{constructor(e){Object.defineProperty(this,Ps,{value:Ks});Object.defineProperty(this,Ls,{value:js});Object.defineProperty(this,gs,{value:Ms});Object.defineProperty(this,us,{value:Us});Object.defineProperty(this,vs,{value:Ds});Object.defineProperty(this,ps,{value:Rs});Object.defineProperty(this,hs,{value:Is});Object.defineProperty(this,bs,{value:Ns});Object.defineProperty(this,cs,{value:As});Object.defineProperty(this,ds,{value:Os});Object.defineProperty(this,ns,{value:ks});Object.defineProperty(this,os,{value:Cs});Object.defineProperty(this,rs,{value:Es});Object.defineProperty(this,ls,{value:ws});Object.defineProperty(this,is,{value:Ts});Object.defineProperty(this,as,{value:Ss});Object.defineProperty(this,ts,{value:fs});Object.defineProperty(this,ss,{value:_s});Object.defineProperty(this,es,{value:ms});Object.defineProperty(this,Ze,{value:ys});Object.defineProperty(this,Ve,{get:Bs,set:void 0});Object.defineProperty(this,Qe,{get:Hs,set:void 0});Object.defineProperty(this,Je,{writable:true,value:void 0});Object.defineProperty(this,Ye,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=e;babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]={};this.readOnly=e.readOnly;babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]()}hasShownPopups(){var e,s;const t=(e=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].ranges.filter((e=>e.hasShownPopups())))!=null?e:[];const a=t.length>0;const i=L.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeSelect,"--active");const l=(s=this.readOnlyPopup)==null?void 0:s.isShown();return a||i||l}render(){const e=this.readOnly?"--read-only":"";const s=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].isCollapsed()?"--hide":"";const t=`--${babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].getContext()}`;babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].wrap=L.Tag.render(je||(je=Me`
			<div class="calendar-sharing__settings ${0} ${0} ${0}">
				${0}
				${0}
			</div>
		`),e,s,t,babelHelpers.classPrivateFieldLooseBase(this,ts)[ts](),babelHelpers.classPrivateFieldLooseBase(this,os)[os]());return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].wrap}}function Hs(){return babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].model}function Bs(){return babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].getRule()}function ys(){babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].subscribe("updated",babelHelpers.classPrivateFieldLooseBase(this,es)[es].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].subscribe("rangeDeleted",babelHelpers.classPrivateFieldLooseBase(this,ss)[ss].bind(this))}function ms(){babelHelpers.classPrivateFieldLooseBase(this,is)[is]();babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]();babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]()}function _s(){babelHelpers.classPrivateFieldLooseBase(this,is)[is]();babelHelpers.classPrivateFieldLooseBase(this,vs)[vs]();babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].ranges.forEach((e=>e.renderButton()))}function fs(){return L.Tag.render(Ke||(Ke=Me`
			<div class="calendar-sharing__settings-header-container">
				<div class="calendar-sharing__settings-header">
					<div class="calendar-sharing__settings-title">
						${0}
					</div>
					${0}
				</div>
				<div class="calendar-sharing__settings-header-button">
					${0}
				</div>
			</div>
		`),L.Loc.getMessage("CALENDAR_SHARING_SETTINGS_TITLE_V2"),babelHelpers.classPrivateFieldLooseBase(this,as)[as](),babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]())}function Ss(){babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].subtitle=L.Tag.render(We||(We=Me`
			<div class="calendar-sharing__settings-subtitle">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]());return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].subtitle}function Ts(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].subtitle){return}babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].subtitle.innerText=babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]()}function ws(){if(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].isDefaultRule()){return L.Loc.getMessage("CALENDAR_SHARING_SETTINGS_SUBTITLE_DEFAULT")}return L.Loc.getMessage("CALENDAR_SHARING_SETTINGS_SUBTITLE_PERSONAL")}function Es(){if(this.readOnly){return""}babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].expandRuleArrow=L.Tag.render(xe||(xe=Me`
			<div class="calendar-sharing__settings-select-arrow ${0}"></div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].isCollapsed()?"":"--active");babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].expandRuleButton=L.Tag.render($e||($e=Me`
			<div class="calendar-sharing__settings-expand">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].expandRuleArrow);L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].expandRuleButton,"click",babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].bind(this));return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].expandRuleButton}function Cs(){babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].rule=L.Tag.render(Ge||(Ge=Me`
			<div class="calendar-sharing__settings-rule">
				${0}
				<div class="calendar-sharing__settings-slotSize">
					<span class="calendar-sharing__settings-slotSize-title">${0}</span>
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,cs)[cs](),L.Loc.getMessage("CALENDAR_SHARING_SETTINGS_SLOT_SIZE_V2"),babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]());return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].rule}function ks(){babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]();setTimeout((()=>{L.Dom.toggleClass(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].wrap,"--hide");L.Dom.toggleClass(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].expandRuleArrow,"--active");babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].updateCollapsed(L.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].wrap,"--hide"))}),0)}function Os(){L.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].rule,"height",`${babelHelpers.classPrivateFieldLooseBase(this,ps)[ps]()}px`)}function As(){var e,s;(e=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].ranges)==null?void 0:e.forEach((e=>e.destroy()));babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].ranges=babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].getRanges().map((e=>babelHelpers.classPrivateFieldLooseBase(this,bs)[bs](e)));const t=L.Tag.render(Xe||(Xe=Me`
			<div class="calendar-sharing__settings-range-list">
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].ranges.map((e=>e.render())));(s=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].rangesContainer)==null?void 0:s.replaceWith(t);babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].rangesContainer=t;babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].ranges.forEach((e=>e.updateWeekdaysTitle()));return t}function Ns(e){return new Le({model:e,readOnly:this.readOnly,showReadOnlyPopup:babelHelpers.classPrivateFieldLooseBase(this,gs)[gs].bind(this)})}function Is(){babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeText=L.Tag.render(ze||(ze=Me`
			<span class="calendar-sharing__settings-select-link">
				${0}
			</span>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].getFormattedSlotSize());babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeSelect=L.Tag.render(qe||(qe=Me`
			<span class="calendar-sharing__settings-select-arrow --small-arrow">
				${0}
			</span>
		`),babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeText);L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeSelect,"click",babelHelpers.classPrivateFieldLooseBase(this,us)[us].bind(this));this.slotSizeMenu=P.MenuManager.create({id:`calendar-sharing-settings-slotSize${Date.now()}`,bindElement:babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeSelect,items:babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].getRule().getAvailableIntervals().map((e=>({text:i.Util.formatDuration(e),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].setSlotSize(e);babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeText.innerHTML=babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve].getFormattedSlotSize();this.slotSizeMenu.close()}}))),closeByEsc:true,events:{onShow:()=>L.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeSelect,"--active"),onClose:()=>L.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeSelect,"--active")}});return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeSelect}function Rs(){const e=10;const s=2;const t=e+s;const a=15;const i=45;return i*babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].getRule().getRanges().length+(t+a)}function Ds(){L.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].rule,"height",null)}function Us(){if(this.readOnly){babelHelpers.classPrivateFieldLooseBase(this,gs)[gs](babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye].slotSizeSelect)}else{this.slotSizeMenu.show()}}function Ms(e){babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]();babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls](e).show()}function js(e){this.readOnlyPopup=new P.Popup({bindElement:e,className:"calendar-sharing__settings-read-only-hint",content:L.Loc.getMessage("CALENDAR_SHARING_SETTINGS_READ_ONLY_HINT"),angle:{offset:0},width:300,offsetLeft:e.offsetWidth/2,darkMode:true,autoHide:true});L.Event.bind(this.readOnlyPopup.popupContainer,"click",(()=>babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]()));clearTimeout(this.closePopupTimeout);this.closePopupTimeout=setTimeout((()=>babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps]()),3e3);return this.readOnlyPopup}function Ks(){var e;(e=this.readOnlyPopup)==null?void 0:e.destroy()}let Ws=e=>e,xs;var $s=babelHelpers.classPrivateFieldLooseKey("bindElement");var Gs=babelHelpers.classPrivateFieldLooseKey("layout");var Xs=babelHelpers.classPrivateFieldLooseKey("popup");class zs{constructor(e){Object.defineProperty(this,$s,{writable:true,value:void 0});Object.defineProperty(this,Gs,{writable:true,value:void 0});Object.defineProperty(this,Xs,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,$s)[$s]=e.bindElement;babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs]={};babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs]=new P.Popup({bindElement:babelHelpers.classPrivateFieldLooseBase(this,$s)[$s],bindOptions:{position:"top"},angle:{offset:babelHelpers.classPrivateFieldLooseBase(this,$s)[$s].offsetWidth/2+24},borderRadius:"24px",width:425,content:this.getContent(),animation:"fading-slide"})}getContent(){if(!babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs].wrapper){babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs].wrapper=L.Tag.render(xs||(xs=Ws`
				<div class="calendar-sharing__user-selector-hint-wrapper">
					<div class="calendar-sharing__user-selector-hint-text-wrapper">
						<div class="calendar-sharing__user-selector-hint-text-title">
							${0}
						</div>
						<div class="calendar-sharing__user-selector-hint-text-desc">
							${0}
						</div>
					</div>
					<div class="calendar-sharing__user-selector-hint-icon"></div>
				</div>
			`),L.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_HINT_TITLE"),L.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_HINT_DESC"))}return babelHelpers.classPrivateFieldLooseBase(this,Gs)[Gs].wrapper}show(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs])==null?void 0:e.show()}close(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,Xs)[Xs])==null?void 0:e.close()}}let qs=e=>e,Js,Ys,Qs,Vs,Zs,et;var st=babelHelpers.classPrivateFieldLooseKey("layout");var tt=babelHelpers.classPrivateFieldLooseKey("userSelectorDialog");var at=babelHelpers.classPrivateFieldLooseKey("selectedEntityList");var it=babelHelpers.classPrivateFieldLooseKey("selectedEntityNodeList");var lt=babelHelpers.classPrivateFieldLooseKey("defaultUserEntity");var rt=babelHelpers.classPrivateFieldLooseKey("isOpened");var ot=babelHelpers.classPrivateFieldLooseKey("onMembersAdded");var nt=babelHelpers.classPrivateFieldLooseKey("model");var dt=babelHelpers.classPrivateFieldLooseKey("renderTitle");var ct=babelHelpers.classPrivateFieldLooseKey("getTitleText");class bt{constructor(e={}){Object.defineProperty(this,ct,{value:pt});Object.defineProperty(this,dt,{value:ht});Object.defineProperty(this,st,{writable:true,value:void 0});Object.defineProperty(this,tt,{writable:true,value:void 0});Object.defineProperty(this,at,{writable:true,value:void 0});Object.defineProperty(this,it,{writable:true,value:void 0});Object.defineProperty(this,lt,{writable:true,value:void 0});Object.defineProperty(this,rt,{writable:true,value:void 0});Object.defineProperty(this,ot,{writable:true,value:void 0});Object.defineProperty(this,nt,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,st)[st]={};babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=null;babelHelpers.classPrivateFieldLooseBase(this,at)[at]={};babelHelpers.classPrivateFieldLooseBase(this,it)[it]={};babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=e.model;babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]=babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].getUserInfo();babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=false;babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=e.onMembersAdded;this.openEntitySelector=this.openEntitySelector.bind(this)}render(){if(!babelHelpers.classPrivateFieldLooseBase(this,st)[st].wrapper){const e=`--${babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].getContext()}`;babelHelpers.classPrivateFieldLooseBase(this,st)[st].wrapper=L.Tag.render(Js||(Js=qs`
				<div class="calendar-sharing__user-selector-main ${0}">
					${0}
					${0}
				</div>
			`),e,babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](),this.renderUserSelectorWrapper())}return babelHelpers.classPrivateFieldLooseBase(this,st)[st].wrapper}renderUserSelectorWrapper(){if(!babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelectorWrapper){babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelectorWrapper=L.Tag.render(Ys||(Ys=qs`
				<div class="calendar-sharing__user-selector-wrapper">
					${0}
					<div class="calendar-sharing__user-selector-add">
						<div class="ui-icon-set --plus-20"></div>
					</div>
				</div>
			`),this.renderUserSelector());L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelectorWrapper,"click",this.openEntitySelector)}return babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelectorWrapper}renderUserSelector(){if(!babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelector){const e=this.getDefaultEntityNode();babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelector=L.Tag.render(Qs||(Qs=qs`
				<div class="calendar-sharing__user-selector-container" data-id="calendar-sharing-members">
					${0}
				</div>
			`),e)}return babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelector}getDefaultEntityNode(){const e=this.renderUserEntity(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]);const s=this.getEntityKey(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].id);babelHelpers.classPrivateFieldLooseBase(this,at)[at][s]=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt];babelHelpers.classPrivateFieldLooseBase(this,it)[it][s]=e;babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].setMemberIds(this.getSelectedUserIdList());return e}renderUserEntity(e){if(this.hasAvatar(e.avatar)){return L.Tag.render(Vs||(Vs=qs`
				<div class="calendar-sharing__user-selector-entity-container">
					<img class="calendar-sharing__user-selector-entity" title="${0}" src="${0}" alt="">
				</div>
			`),L.Text.encode(e.name),e.avatar)}return L.Tag.render(Zs||(Zs=qs`
			<div class="ui-icon ui-icon-common-user calendar-sharing__user-selector-entity" title="${0}"><i></i></div>
		`),L.Text.encode(e==null?void 0:e.name))}hasAvatar(e){return e&&e!=="/bitrix/images/1.gif"}openEntitySelector(){if(!babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelector){return}const e=["user",babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].id];if(!babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]){babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=new a.Dialog({width:340,targetNode:babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelector,context:"CALENDAR_SHARING",preselectedItems:[e],enableSearch:true,zIndex:4200,events:{"Item:onSelect":e=>{this.onUserSelectorSelect(e)},"Item:onDeselect":e=>{this.onUserSelectorDeselect(e)},onHide:()=>{if(this.hasChanges()){babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]()}}},entities:[{id:"user",options:{intranetUsersOnly:true,emailUsers:false,inviteEmployeeLink:false,inviteGuestLink:false,analyticsSource:"calendar"},filters:[{id:"calendar.jointSharingFilter"}]}]})}babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].show()}isUserSelectorDialogOpened(){if(babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]){return babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].isOpen()}return false}onUserSelectorSelect(e){var s;const t=e.data.item;const a={id:t.id,avatar:t.avatar,name:`${t.customData.get("name")} ${(s=t.customData.get("lastName"))!=null?s:""}`.trim()};const i=this.renderUserEntity(a);if(babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelector){L.Dom.append(i,babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelector)}const l=this.getEntityKey(a.id);babelHelpers.classPrivateFieldLooseBase(this,at)[at][l]=a;babelHelpers.classPrivateFieldLooseBase(this,it)[it][l]=i;babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].setMemberIds(this.getSelectedUserIdList())}onUserSelectorDeselect(e){const s=e.data.item;const t=this.getEntityKey(s.id);const a=babelHelpers.classPrivateFieldLooseBase(this,it)[it][t];if(a){L.Dom.remove(a);delete babelHelpers.classPrivateFieldLooseBase(this,at)[at][t];delete babelHelpers.classPrivateFieldLooseBase(this,it)[it][t]}babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].setMemberIds(this.getSelectedUserIdList())}clearSelectedUsers(){if(babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelector){L.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelector);babelHelpers.classPrivateFieldLooseBase(this,at)[at]={};babelHelpers.classPrivateFieldLooseBase(this,it)[it]={};const e=this.getDefaultEntityNode();L.Dom.append(e,babelHelpers.classPrivateFieldLooseBase(this,st)[st].userSelector)}if(babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]){babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].destroy();babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=null}}hasChanges(){return this.getPeopleCount()>1}getPeopleCount(){return Object.keys(babelHelpers.classPrivateFieldLooseBase(this,at)[at]).length}getSelectedUserIdList(){const e=[];Object.values(babelHelpers.classPrivateFieldLooseBase(this,at)[at]).forEach((s=>{e.push(s.id)}));return e}getEntityKey(e){return`user-${e}`}}function ht(){if(!babelHelpers.classPrivateFieldLooseBase(this,st)[st].title){babelHelpers.classPrivateFieldLooseBase(this,st)[st].title=L.Tag.render(et||(et=qs`
				<div class="calendar-sharing__user-selector-title">
					<div class="calendar-sharing__user-selector-title-icon"></div>
					<div class="calendar-sharing__user-selector-title-text">
						${0}
					</div>
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]());const e=babelHelpers.classPrivateFieldLooseBase(this,st)[st].title.querySelector('[ data-role="calendar-sharing_popup-joint-slots"]');if(e){let s;let t;L.Event.bind(e,"mouseenter",(()=>{t=setTimeout((()=>{if(!s){s=new zs({bindElement:e})}s.show()}),1e3)}));L.Event.bind(e,"mouseleave",(()=>{clearTimeout(t);if(s){s.close()}}))}}return babelHelpers.classPrivateFieldLooseBase(this,st)[st].title}function pt(){switch(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt].getContext()){case"calendar":return L.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_TITLE_V2");case"crm":return L.Loc.getMessage("CALENDAR_SHARING_USER_SELECTOR_TITLE_CRM");default:return""}}let vt=e=>e,ut,gt,Lt,Pt,Ft,Ht,Bt,yt,mt,_t;const ft=4;var St=babelHelpers.classPrivateFieldLooseKey("props");var Tt=babelHelpers.classPrivateFieldLooseKey("layout");var wt=babelHelpers.classPrivateFieldLooseKey("avatarPopup");var Et=babelHelpers.classPrivateFieldLooseKey("deletePopup");class Ct{constructor(e){Object.defineProperty(this,St,{writable:true,value:void 0});Object.defineProperty(this,Tt,{writable:true,value:void 0});Object.defineProperty(this,wt,{writable:true,value:void 0});Object.defineProperty(this,Et,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,St)[St]=e;babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]={};babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]=null;babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]=null;this.openAvatarList=this.openAvatarList.bind(this);this.onCopyButtonClick=this.onCopyButtonClick.bind(this);this.onDeleteButtonClick=this.onDeleteButtonClick.bind(this)}render(){if(!babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].wrapper){babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].wrapper=L.Tag.render(ut||(ut=vt`
				<div class="calendar-sharing__dialog-link-list-item">
					${0}
					${0}
					${0}
					${0}
				</div>
			`),this.renderAvatarContainer(),this.renderDate(),this.renderCopyButton(),this.renderDeleteButton())}return babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].wrapper}renderAvatarContainer(){if(!babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].avatarContainer){const e=babelHelpers.classPrivateFieldLooseBase(this,St)[St].members.length>ft;const s=babelHelpers.classPrivateFieldLooseBase(this,St)[St].members.length-ft;babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].avatarContainer=L.Tag.render(gt||(gt=vt`
				<div class="calendar-sharing__dialog-link-list-item-avatar-container">
					${0}
					${0}
					${0}
				</div>
			`),this.renderAvatar(babelHelpers.classPrivateFieldLooseBase(this,St)[St].userInfo),babelHelpers.classPrivateFieldLooseBase(this,St)[St].members.slice(0,ft).map((e=>this.renderAvatar(e))),e?this.renderMore(s):null);L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].avatarContainer,"click",this.openAvatarList)}return babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].avatarContainer}renderAvatar(e){var s;const t=`${e.name} ${(s=e.lastName)!=null?s:""}`.trim();if(this.hasAvatar(e.avatar)){return L.Tag.render(Lt||(Lt=vt`
				<img class="calendar-sharing__dialog-link-list-item-avatar" title="${0}" alt="" src="${0}">
			`),L.Text.encode(t),e.avatar)}return L.Tag.render(Pt||(Pt=vt`
			<div class="ui-icon ui-icon-common-user calendar-sharing__dialog-link-list-item-avatar" title="${0}"><i></i></div>
		`),L.Text.encode(t))}hasAvatar(e){return e&&e!=="/bitrix/images/1.gif"}renderMore(e){return L.Tag.render(Ft||(Ft=vt`
			<div class="calendar-sharing__dialog-link-list-item-more">
				<div class="calendar-sharing__dialog-link-list-item-more-text">${0}</div>
			</div>
		`),`+${e}`)}openAvatarList(){if(!babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]){const e=BX.util.getRandomString(6);babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]=P.MenuManager.create({id:`calendar-sharing-dialog_${e}`,bindElement:babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].avatarContainer,bindOptions:{position:"top"},autoHide:true,closeByEsc:true,className:"calendar-sharing__dialog-link-list-user-popup-container",items:this.getAvatarPopupItems(),maxHeight:250,maxWidth:300});babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].getPopupWindow().subscribe("onClose",(()=>{this.setPopupState(false)}));const s=babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].getMenuContainer();let t;L.Event.bind(s,"mouseleave",(()=>{clearTimeout(t);t=setTimeout((()=>{this.closeAvatarList()}),500)}));L.Event.bind(s,"mouseenter",(()=>{clearTimeout(t)}))}babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].show();this.setPopupState(true)}closeAvatarList(){if(babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]){babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].close()}}getAvatarPopupItems(){const e=[];e.push(this.getAvatarPopupItem(babelHelpers.classPrivateFieldLooseBase(this,St)[St].userInfo));babelHelpers.classPrivateFieldLooseBase(this,St)[St].members.forEach((s=>{e.push(this.getAvatarPopupItem(s))}));return e}getAvatarPopupItem(e){var s;const t=e.avatar;const a=`${e.name} ${(s=e.lastName)!=null?s:""}`.trim();const i=babelHelpers.classPrivateFieldLooseBase(this,St)[St].pathToUser.replace("#USER_ID#",e.id);return{html:L.Tag.render(Ht||(Ht=vt`
				<a href="${0}" target="_blank" class="calendar-sharing__dialog-link-list-user-popup-item">
					<span class="ui-icon ui-icon-common-user calendar-sharing__dialog-link-list-user-popup-item-avatar">
						<i style="${0}"></i>
					</span>
					<div class="calendar-sharing__dialog-link-list-user-popup-item-text">
						${0}
					</div>
				</a>
			`),i,this.hasAvatar(t)?`background-image: url('${t}')`:"",L.Text.encode(a))}}renderDate(){if(!babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].date){const e=babelHelpers.classPrivateFieldLooseBase(this,St)[St].dateCreate?new Date(babelHelpers.classPrivateFieldLooseBase(this,St)[St].dateCreate):new Date;const s=i.Util.formatDate(e);babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].date=L.Tag.render(Bt||(Bt=vt`
				<div class="calendar-sharing__dialog-link-list-item-date" title="${0}">${0}</div>
			`),L.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_DATE_CREATE"),s)}return babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].date}renderCopyButton(){if(!babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].copyButton){const e=new l.Icon({icon:l.Main.LINK_3,size:14});babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].copyButton=L.Tag.render(yt||(yt=vt`
				<div class="calendar-sharing__dialog-link-list-item-copy-container">
					${0}
					<div class="calendar-sharing__dialog-link-list-item-copy-text">${0}</div>
				</div>
			`),e.render(),L.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_COPY"));L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].copyButton,"click",this.onCopyButtonClick)}return babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].copyButton}onCopyButtonClick(){n.EventEmitter.emit("CalendarSharing:onJointLinkCopy",{id:babelHelpers.classPrivateFieldLooseBase(this,St)[St].id,shortUrl:babelHelpers.classPrivateFieldLooseBase(this,St)[St].shortUrl,hash:babelHelpers.classPrivateFieldLooseBase(this,St)[St].hash,members:babelHelpers.classPrivateFieldLooseBase(this,St)[St].members})}renderDeleteButton(){if(babelHelpers.classPrivateFieldLooseBase(this,St)[St].members.length===0){return L.Tag.render(mt||(mt=vt`<div class="calendar-sharing__dialog-link-list-item-delete"></div>`))}if(!babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].deleteButton){const e=new l.Icon({icon:l.Actions.CROSS_30,size:18});babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].deleteButton=L.Tag.render(_t||(_t=vt`
				<div class="calendar-sharing__dialog-link-list-item-delete">
					${0}
				</div>
			`),e.render());L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].deleteButton,"click",this.onDeleteButtonClick)}return babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].deleteButton}onDeleteButtonClick(){if(!babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]){babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]=new r.MessageBox({title:L.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_DELETE_MESSAGE_TITLE_MSGVER_1"),message:L.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_DELETE_MESSAGE_DESC_MSGVER_1"),buttons:this.getDeletePopupButtons(),popupOptions:{autoHide:true,closeByEsc:true,draggable:false,closeIcon:true,minWidth:365,maxWidth:385,minHeight:180}})}babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].show();this.setPopupState(true)}getDeletePopupButtons(){return[new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.DANGER,text:L.Loc.getMessage("SHARING_WARNING_POPUP_SUBMIT_BUTTON_NEW_MSGVER_1"),events:{click:()=>{this.deleteLink();babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].close();this.setPopupState(false)}}}),new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:L.Loc.getMessage("SHARING_WARNING_POPUP_CANCEL_BUTTON"),events:{click:()=>{babelHelpers.classPrivateFieldLooseBase(this,Et)[Et].close();this.setPopupState(false)}}})]}deleteLink(){if(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].wrapper){BX.ajax.runAction("calendar.api.sharingajax.disableUserLink",{data:{hash:babelHelpers.classPrivateFieldLooseBase(this,St)[St].hash}});L.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].wrapper,"--animate-delete");setTimeout((()=>{L.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt].wrapper)}),300);n.EventEmitter.emit("CalendarSharing:onJointLinkDelete",{id:babelHelpers.classPrivateFieldLooseBase(this,St)[St].id})}}setPopupState(e){var s;(s=babelHelpers.classPrivateFieldLooseBase(this,St)[St])==null?void 0:s.setListItemPopupState(e)}}let kt=e=>e,Ot,At,Nt,It,Rt,Dt,Ut,Mt;const jt=300;const Kt=45;var Wt=babelHelpers.classPrivateFieldLooseKey("props");var xt=babelHelpers.classPrivateFieldLooseKey("layout");var $t=babelHelpers.classPrivateFieldLooseKey("linkList");var Gt=babelHelpers.classPrivateFieldLooseKey("popupOpenState");var Xt=babelHelpers.classPrivateFieldLooseKey("pathToUser");var zt=babelHelpers.classPrivateFieldLooseKey("model");var qt=babelHelpers.classPrivateFieldLooseKey("getSortingName");class Jt{constructor(e){Object.defineProperty(this,qt,{value:Qt});Object.defineProperty(this,zt,{get:Yt,set:void 0});Object.defineProperty(this,Wt,{writable:true,value:void 0});Object.defineProperty(this,xt,{writable:true,value:void 0});Object.defineProperty(this,$t,{writable:true,value:void 0});Object.defineProperty(this,Gt,{writable:true,value:false});Object.defineProperty(this,Xt,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]=e;babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]={};babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]=null;babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]=null;this.getLinkListInfo();this.setListItemPopupState=this.setListItemPopupState.bind(this);this.eventSubscribe()}eventSubscribe(){n.EventEmitter.subscribe("CalendarSharing:onJointLinkCopy",(e=>{this.onJointLinkCopy(e)}));n.EventEmitter.subscribe("CalendarSharing:onJointLinkDelete",(e=>{this.onJointLinkDelete(e)}))}getLinkListInfo(){BX.ajax.runAction("calendar.api.sharingajax.getAllUserLink").then((e=>{if(e&&e.data){babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]=e.data.userLinks;babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]=e.data.pathToUser;this.updateLinkList();if(this.isListEmpty()){this.hideSortingButton();return}if(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]){this.showSortingButton()}}}))}render(){if(!babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].wrapper){babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].wrapper=L.Tag.render(Ot||(Ot=kt`
				<div class="calendar-sharing__dialog-link-list-wrapper">
					${0}
					${0}
				</div>
			`),this.getTitleNode(),this.getListNode())}return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].wrapper}getTitleNode(){if(!babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].title){babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].title=L.Tag.render(At||(At=kt`
				<div class="calendar-sharing__dialog-link-list-title-wrapper">
					<div class="calendar-sharing__dialog-link-list-title">
						${0}
						<div class="calendar-sharing__dialog-link-list-title-text">
							${0}
						</div>
					</div>
					${0}
				</div>
			`),this.getChevronBackIcon(),L.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_TITLE"),this.getSortingButton())}return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].title}getChevronBackIcon(){if(!babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].backButton){const e=new l.Icon({icon:l.Actions.CHEVRON_LEFT,size:24});babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].backButton=L.Tag.render(Nt||(Nt=kt`
				<div class="calendar-sharing__dialog-link-list-back-button">
					${0}
				</div>
			`),e.render());L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].backButton,"click",this.close.bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].backButton}getSortingButton(){if(!babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButton){const e=new l.Icon({icon:l.Actions.SORT,size:14,color:"#2066b0"});babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButton=L.Tag.render(It||(It=kt`
				<div class="calendar-sharing__dialog-link-list-sorting-button">
					${0}
					${0}
				</div>
			`),e.render(),this.getSortingButtonText());L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButton,"click",this.changeListSort.bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButton}getSortingButtonText(){if(!babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButtonText){babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButtonText=L.Tag.render(Rt||(Rt=kt`
				<div class="calendar-sharing__dialog-link-list-sorting-button-text">
					${0}
				</div>
			`),babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]())}return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButtonText}getListNode(){if(!babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].list){babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].list=L.Tag.render(Dt||(Dt=kt`
				<div class="calendar-sharing__dialog-link-list-container">
					${0}
				</div>
			`),this.getListItemsNode())}return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].list}getListItemsNode(){if(this.isListEmpty()){return this.getEmptyStateNode()}const e=this.getListItems();return L.Tag.render(Ut||(Ut=kt`
			<div class="calendar-sharing__dialog-link-list">
				${0}
			</div>
		`),e.map((e=>e.render())))}getEmptyStateNode(){if(!babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].emptyState){babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].emptyState=L.Tag.render(Mt||(Mt=kt`
				<div class="calendar-sharing__dialog-link-list-empty-state-wrapper">
					<div class="calendar-sharing__dialog-link-list-empty-state-icon"></div>
					<div class="calendar-sharing__dialog-link-list-empty-state-text">${0}</div>
				</div>
			`),L.Loc.getMessage("CALENDAR_SHARING_LIST_EMPTY_TITLE"))}return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].emptyState}getListItems(){if(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt].sortJointLinksByFrequentUse()){return this.getSortedByFrequentUseListItems()}return this.getSortedByDateListItems()}getSortedByFrequentUseListItems(){return Object.values(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]).sort(((e,s)=>{if(e.frequentUse>s.frequentUse){return-1}if(e.frequentUse<s.frequentUse){return 1}if(e.id>s.id){return-1}if(e.id<s.id){return 1}return 0})).map((e=>new Ct({...e,userInfo:babelHelpers.classPrivateFieldLooseBase(this,zt)[zt].getUserInfo(),pathToUser:babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt],setListItemPopupState:this.setListItemPopupState})))}getSortedByDateListItems(){return Object.keys(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]).sort(((e,s)=>s-e)).map((e=>new Ct({...babelHelpers.classPrivateFieldLooseBase(this,$t)[$t][e],userInfo:babelHelpers.classPrivateFieldLooseBase(this,zt)[zt].getUserInfo(),pathToUser:babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt],setListItemPopupState:this.setListItemPopupState})))}show(e){if(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].list&&e){L.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].list,"max-height",`${e-Kt}px`)}if(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].wrapper){L.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].wrapper,"--show")}}close(){if(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].list){L.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].list,"max-height",`${jt}px`)}if(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].wrapper){L.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].wrapper,"--show")}if(babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].onLinkListClose){babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].onLinkListClose()}}updateLinkList(){if(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].list){L.Dom.clean(this.getListNode());const e=this.getListItemsNode();L.Dom.append(e,babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].list)}}changeListSort(){babelHelpers.classPrivateFieldLooseBase(this,zt)[zt].changeSortJointLinksByFrequentUse();if(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButtonText){L.Dom.adjust(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButtonText,{text:babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]()})}this.updateLinkList()}setListItemPopupState(e){babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]=e}isOpenListItemPopup(){return babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]}onJointLinkCopy(e){const s=e.data.id;const t=e.data.hash;setTimeout((()=>{if(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t][s]){babelHelpers.classPrivateFieldLooseBase(this,$t)[$t][s].frequentUse=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t][s].frequentUse+1;this.updateLinkList()}}),1e3);BX.ajax.runAction("calendar.api.sharingajax.increaseFrequentUse",{data:{hash:t}})}onJointLinkDelete(e){const s=e.data.id;if(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t][s]){delete babelHelpers.classPrivateFieldLooseBase(this,$t)[$t][s]}if(this.isListEmpty()){this.updateLinkList();this.hideSortingButton()}}isListEmpty(){return L.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t])||L.Type.isArray(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t])&&!L.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t])||L.Type.isObject(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t])&&!Object.keys(babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]).length}hideSortingButton(){if(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButton){L.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButton,"--hide")}}showSortingButton(){if(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButton){L.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,xt)[xt].sortingButton,"--hide")}}}function Yt(){return babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].model}function Qt(){return babelHelpers.classPrivateFieldLooseBase(this,zt)[zt].sortJointLinksByFrequentUse()?L.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_SORT_RECENT"):L.Loc.getMessage("CALENDAR_SHARING_LINK_LIST_SORT_DATE")}let Vt=e=>e,Zt,ea,sa,ta,aa,ia,la,ra;var oa=babelHelpers.classPrivateFieldLooseKey("params");var na=babelHelpers.classPrivateFieldLooseKey("layout");var da=babelHelpers.classPrivateFieldLooseKey("settingsControl");var ca=babelHelpers.classPrivateFieldLooseKey("userSelectorControl");var ba=babelHelpers.classPrivateFieldLooseKey("linkList");var ha=babelHelpers.classPrivateFieldLooseKey("settingsModel");var pa=babelHelpers.classPrivateFieldLooseKey("bindEvents");var va=babelHelpers.classPrivateFieldLooseKey("renderMain");var ua=babelHelpers.classPrivateFieldLooseKey("renderDialogMessage");var ga=babelHelpers.classPrivateFieldLooseKey("onOpenLink");var La=babelHelpers.classPrivateFieldLooseKey("renderTop");var Pa=babelHelpers.classPrivateFieldLooseKey("renderHowDoesItWorkIcon");var Fa=babelHelpers.classPrivateFieldLooseKey("openHelpDesk");var Ha=babelHelpers.classPrivateFieldLooseKey("getSharingInfoMessage");var Ba=babelHelpers.classPrivateFieldLooseKey("getContextHelpDeskCode");var ya=babelHelpers.classPrivateFieldLooseKey("renderSettings");var ma=babelHelpers.classPrivateFieldLooseKey("renderMembers");var _a=babelHelpers.classPrivateFieldLooseKey("renderMainBottom");var fa=babelHelpers.classPrivateFieldLooseKey("renderCopyLinkButton");var Sa=babelHelpers.classPrivateFieldLooseKey("onButtonCopyClick");var Ta=babelHelpers.classPrivateFieldLooseKey("renderLinkHistoryButton");var wa=babelHelpers.classPrivateFieldLooseKey("renderLinkList");var Ea=babelHelpers.classPrivateFieldLooseKey("getLinkList");var Ca=babelHelpers.classPrivateFieldLooseKey("openLinkList");var ka=babelHelpers.classPrivateFieldLooseKey("closeLinkList");class Oa{constructor(e){Object.defineProperty(this,ka,{value:Va});Object.defineProperty(this,Ca,{value:Qa});Object.defineProperty(this,Ea,{value:Ya});Object.defineProperty(this,wa,{value:Ja});Object.defineProperty(this,Ta,{value:qa});Object.defineProperty(this,Sa,{value:za});Object.defineProperty(this,fa,{value:Xa});Object.defineProperty(this,_a,{value:Ga});Object.defineProperty(this,ma,{value:$a});Object.defineProperty(this,ya,{value:xa});Object.defineProperty(this,Ba,{value:Wa});Object.defineProperty(this,Ha,{value:Ka});Object.defineProperty(this,Fa,{value:ja});Object.defineProperty(this,Pa,{value:Ma});Object.defineProperty(this,La,{value:Ua});Object.defineProperty(this,ga,{value:Da});Object.defineProperty(this,ua,{value:Ra});Object.defineProperty(this,va,{value:Ia});Object.defineProperty(this,pa,{value:Na});Object.defineProperty(this,ha,{get:Aa,set:void 0});this.HELP_DESK_CODE_CALENDAR=17198666;this.HELP_DESK_CODE_CRM=17502612;this.CONTEXT={CRM:"crm",CALENDAR:"calendar"};Object.defineProperty(this,oa,{writable:true,value:void 0});Object.defineProperty(this,na,{writable:true,value:void 0});Object.defineProperty(this,da,{writable:true,value:void 0});Object.defineProperty(this,ca,{writable:true,value:void 0});Object.defineProperty(this,ba,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,oa)[oa]=e;babelHelpers.classPrivateFieldLooseBase(this,na)[na]={};babelHelpers.classPrivateFieldLooseBase(this,pa)[pa]()}reset(){var e;void babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].save();(e=babelHelpers.classPrivateFieldLooseBase(this,ca)[ca])==null?void 0:e.clearSelectedUsers();setTimeout((()=>{var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,ba)[ba])==null?void 0:e.close()}),200)}hasShownPopups(){var e,s;const t=babelHelpers.classPrivateFieldLooseBase(this,da)[da].hasShownPopups();const a=(e=babelHelpers.classPrivateFieldLooseBase(this,ca)[ca])==null?void 0:e.isUserSelectorDialogOpened();const i=(s=babelHelpers.classPrivateFieldLooseBase(this,ba)[ba])==null?void 0:s.isOpenListItemPopup();return t||a||i}render(){babelHelpers.classPrivateFieldLooseBase(this,na)[na].wrap=L.Tag.render(Zt||(Zt=Vt`
			<div class="calendar-sharing__dialog-wrapper">
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,va)[va](),babelHelpers.classPrivateFieldLooseBase(this,wa)[wa]());return babelHelpers.classPrivateFieldLooseBase(this,na)[na].wrap}async saveJointLink(){var e;if(babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonCopy&&L.Dom.hasClass(babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonCopy,"ui-btn-clock")){return}L.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonCopy,"ui-btn-clock");const s=await babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].saveJointLink();L.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonCopy,"ui-btn-clock");this.copyLink(s.url,s.hash);(e=babelHelpers.classPrivateFieldLooseBase(this,ba)[ba])==null?void 0:e.getLinkListInfo()}copyLink(e,s){if(!e){return}const t=BX.clipboard.copy(e);if(t){i.Util.showNotification(L.Loc.getMessage("SHARING_COPY_LINK_NOTIFICATION"));n.EventEmitter.emit("CalendarSharing:LinkCopied",{url:e,hash:s})}return t}}function Aa(){return babelHelpers.classPrivateFieldLooseBase(this,oa)[oa].settingsModel}function Na(){L.Event.bind(window,"beforeunload",(()=>babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].save()));n.EventEmitter.subscribe("CalendarSharing:onJointLinkCopy",(e=>{const s=e.data.shortUrl;const a=e.data.hash;this.copyLink(s,a);t.Analytics.sendLinkCopiedList(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getContext(),{peopleCount:e.data.members.length+1,ruleChanges:babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getChanges()})}))}function Ia(){var e,s;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,na)[na]).main)!=null?s:e.main=L.Tag.render(ea||(ea=Vt`
			<div class="calendar-sharing__dialog-content-wrapper --show">
				${0}
				<div class="calendar-sharing__dialog-body">
					${0}
					${0}
					${0}
				</div>
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,La)[La](),babelHelpers.classPrivateFieldLooseBase(this,ua)[ua](),babelHelpers.classPrivateFieldLooseBase(this,ya)[ya](),babelHelpers.classPrivateFieldLooseBase(this,ma)[ma](),babelHelpers.classPrivateFieldLooseBase(this,_a)[_a]());return babelHelpers.classPrivateFieldLooseBase(this,na)[na].main}function Ra(){if(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getContext()===this.CONTEXT.CRM){return""}return L.Tag.render(sa||(sa=Vt`
			<div class="calendar-sharing__dialog-message">
				<div class="calendar-sharing__dialog-info-icon-container">
					<div class="calendar-sharing__dialog-info-icon"></div>
				</div>
				<div class="calendar-sharing__dialog-notify" onclick="${0}">
					${0}
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,ga)[ga].bind(this),L.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_4_V3",{"#LINK#":babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getSharingUrl()}))}async function Da(){await babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].save();window.open(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getSharingUrl(),"_blank").focus()}function Ua(){if(!babelHelpers.classPrivateFieldLooseBase(this,na)[na].mainTop){var e;babelHelpers.classPrivateFieldLooseBase(this,na)[na].mainTop=L.Tag.render(ta||(ta=Vt`
				<div class="calendar-sharing__dialog-top">
					<div class="calendar-sharing__dialog-title">
						<span>${0}</span>
						${0}
						${0}
					</div>
					<div class="calendar-sharing__dialog-info">
						${0}
					</div>
				</div>
			`),L.Loc.getMessage("SHARING_BUTTON_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,Pa)[Pa](),(e=babelHelpers.classPrivateFieldLooseBase(this,oa)[oa].externalIcon)!=null?e:"",babelHelpers.classPrivateFieldLooseBase(this,Ha)[Ha]());const s=babelHelpers.classPrivateFieldLooseBase(this,na)[na].mainTop.querySelector('[data-role="calendar-sharing-how-does-it-work"]');L.Event.bind(s,"click",babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa].bind(this));const t=babelHelpers.classPrivateFieldLooseBase(this,na)[na].mainTop.querySelector('[data-role="calendar-sharing_popup-open-link"]');if(t){let e;let s;L.Event.bind(t,"mouseenter",(()=>{s=setTimeout((()=>{if(!e){e=new P.Popup({bindElement:t,angle:{offset:t.offsetWidth/2+16},width:410,darkMode:true,content:L.Loc.getMessage("SHARING_INFO_POPUP_SLOT_DESC"),animation:"fading-slide"})}e.show()}),1e3)}));L.Event.bind(t,"mouseleave",(()=>{clearTimeout(s);if(e){e.close()}}))}}return babelHelpers.classPrivateFieldLooseBase(this,na)[na].mainTop}function Ma(){if(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getContext()===this.CONTEXT.CRM){return""}const e=L.Tag.render(aa||(aa=Vt`
			<span
				class="calendar-sharing__dialog-title-help"
				title="${0}"
			></span>
		`),L.Loc.getMessage("SHARING_INFO_POPUP_HOW_IT_WORK"));L.Event.bind(e,"click",babelHelpers.classPrivateFieldLooseBase(this,Fa)[Fa].bind(this));return e}function ja(){top.BX.Helper.show(`redirect=detail&code=${babelHelpers.classPrivateFieldLooseBase(this,Ba)[Ba]()}`)}function Ka(){switch(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getContext()){case this.CONTEXT.CALENDAR:return L.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_3_CALENDAR");case this.CONTEXT.CRM:return L.Loc.getMessage("SHARING_INFO_POPUP_CONTENT_3_CRM_MSGVER_2");default:return""}}function Wa(){switch(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getContext()){case this.CONTEXT.CALENDAR:return this.HELP_DESK_CODE_CALENDAR;case this.CONTEXT.CRM:return this.HELP_DESK_CODE_CRM;default:return 0}}function xa(){babelHelpers.classPrivateFieldLooseBase(this,da)[da]=new Fs({readOnly:babelHelpers.classPrivateFieldLooseBase(this,oa)[oa].readOnly,model:babelHelpers.classPrivateFieldLooseBase(this,ha)[ha]});return babelHelpers.classPrivateFieldLooseBase(this,da)[da].render()}function $a(){babelHelpers.classPrivateFieldLooseBase(this,ca)[ca]=new bt({model:babelHelpers.classPrivateFieldLooseBase(this,ha)[ha],onMembersAdded:()=>t.Analytics.sendMembersAdded(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getContext(),babelHelpers.classPrivateFieldLooseBase(this,ca)[ca].getPeopleCount())});return babelHelpers.classPrivateFieldLooseBase(this,ca)[ca].render()}function Ga(){var e,s;if(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getContext()===this.CONTEXT.CRM){return""}(s=(e=babelHelpers.classPrivateFieldLooseBase(this,na)[na]).mainBottom)!=null?s:e.mainBottom=L.Tag.render(ia||(ia=Vt`
			<div class="calendar-sharing__dialog-bottom">
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,fa)[fa](),babelHelpers.classPrivateFieldLooseBase(this,Ta)[Ta]());return babelHelpers.classPrivateFieldLooseBase(this,na)[na].mainBottom}function Xa(){if(!babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonCopy){babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonCopy=L.Tag.render(la||(la=Vt`
				<span class="ui-btn ui-btn-success ui-btn-round ui-btn-no-caps calendar-sharing__dialog-copy">
					${0}
				</span>
			`),L.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_COPY_LINK_BUTTON"));L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonCopy,"click",babelHelpers.classPrivateFieldLooseBase(this,Sa)[Sa].bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonCopy}function za(){var e,s;const a={peopleCount:(e=(s=babelHelpers.classPrivateFieldLooseBase(this,ca)[ca])==null?void 0:s.getPeopleCount())!=null?e:1,ruleChanges:babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getChanges()};if(babelHelpers.classPrivateFieldLooseBase(this,ca)[ca]&&babelHelpers.classPrivateFieldLooseBase(this,ca)[ca].hasChanges()){t.Analytics.sendLinkCopied(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getContext(),t.Analytics.linkTypes.multiple,a);void this.saveJointLink()}else if(this.copyLink(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getSharingUrl())){t.Analytics.sendLinkCopied(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getContext(),t.Analytics.linkTypes.solo,a);babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].increaseFrequentUse()}}function qa(){if(!babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonHistory){babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonHistory=L.Tag.render(ra||(ra=Vt`
				<span
					class="ui-btn ui-btn-round ui-btn-light ui-btn-no-caps calendar-sharing__dialog-people"
					data-id="calendar-sharing-history-btn"
				>
					${0}
				</span>
			`),L.Loc.getMessage("SHARING_DIALOG_SHARING_BLOCK_JOINT_SLOTS_BUTTON"));L.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonHistory,"click",babelHelpers.classPrivateFieldLooseBase(this,Ca)[Ca].bind(this))}return babelHelpers.classPrivateFieldLooseBase(this,na)[na].buttonHistory}function Ja(){if(babelHelpers.classPrivateFieldLooseBase(this,ha)[ha].getContext()===this.CONTEXT.CRM){return}return babelHelpers.classPrivateFieldLooseBase(this,Ea)[Ea]().render()}function Ya(){var e,s;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,ba))[ba])!=null?s:e[ba]=new Jt({model:babelHelpers.classPrivateFieldLooseBase(this,ha)[ha],onLinkListClose:babelHelpers.classPrivateFieldLooseBase(this,ka)[ka].bind(this)});return babelHelpers.classPrivateFieldLooseBase(this,ba)[ba]}function Qa(){L.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,na)[na].main,"--show");babelHelpers.classPrivateFieldLooseBase(this,ba)[ba].show(babelHelpers.classPrivateFieldLooseBase(this,na)[na].main.offsetHeight)}function Va(){L.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,na)[na].main,"--show")}var Za=babelHelpers.classPrivateFieldLooseKey("popup");var ei=babelHelpers.classPrivateFieldLooseKey("layout");var si=babelHelpers.classPrivateFieldLooseKey("dialogLayout");var ti=babelHelpers.classPrivateFieldLooseKey("settingsModel");class ai{constructor(e){Object.defineProperty(this,Za,{writable:true,value:void 0});Object.defineProperty(this,ei,{writable:true,value:void 0});Object.defineProperty(this,si,{writable:true,value:void 0});Object.defineProperty(this,ti,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]={};babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].bindElement=e.bindElement;babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]=new A({context:e.context,linkHash:e.linkHash,sharingUrl:e.sharingUrl,userInfo:e.userInfo,rule:e.sharingRule,calendarSettings:e.calendarSettings,collapsed:e.settingsCollapsed,sortJointLinksByFrequentUse:e.sortJointLinksByFrequentUse});this.bindEvents()}bindEvents(){n.EventEmitter.subscribe("CalendarSharing:LinkCopied",this.onSuccessfulCopyingLink.bind(this))}getPopup(){if(!babelHelpers.classPrivateFieldLooseBase(this,Za)[Za]){babelHelpers.classPrivateFieldLooseBase(this,Za)[Za]=new P.Popup({bindElement:babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].bindElement,className:"calendar-sharing__dialog",closeByEsc:true,autoHide:true,padding:0,width:470,angle:{offset:babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].bindElement.offsetWidth/2+16},autoHideHandler:e=>this.canBeClosed(e),content:this.getPopupWrapper(),animation:"fading-slide",events:{onPopupShow:this.onPopupShow.bind(this),onPopupClose:this.onPopupClose.bind(this)}})}return babelHelpers.classPrivateFieldLooseBase(this,Za)[Za]}onPopupShow(){L.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].bindElement,"ui-btn-hover");t.Analytics.sendPopupOpened(babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].getContext())}onPopupClose(){L.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].bindElement,"ui-btn-hover");babelHelpers.classPrivateFieldLooseBase(this,si)[si].reset()}canBeClosed(e){const s=babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].wrapper.contains(e.target);const t=babelHelpers.classPrivateFieldLooseBase(this,si)[si].hasShownPopups();const a=babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].getContext()==="calendar"?BX.SidePanel.Instance.getTopSlider():false;return!s&&!t&&!a}getPopupWrapper(){if(!babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].wrapper){babelHelpers.classPrivateFieldLooseBase(this,si)[si]=new Oa({settingsModel:babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]});babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].wrapper=babelHelpers.classPrivateFieldLooseBase(this,si)[si].render()}return babelHelpers.classPrivateFieldLooseBase(this,ei)[ei].wrapper=babelHelpers.classPrivateFieldLooseBase(this,si)[si].render()}onSuccessfulCopyingLink(){this.getPopup().close()}isShown(){return this.getPopup().isShown()}show(){babelHelpers.classPrivateFieldLooseBase(this,ti)[ti].sortRanges();this.getPopup().show()}destroy(){this.getPopup().destroy()}getSettingsControlRule(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,ti)[ti])==null?void 0:e.getRule().toArray()}}let ii=e=>e,li,ri,oi;class ni{constructor(e={}){var s,t,a;this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY=1e3;this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST="first-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_NEW="new-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND="remind-feature";this.PAY_ATTENTION_TO_NEW_FEATURE_JOINT="joint-sharing";this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS=[this.PAY_ATTENTION_TO_NEW_FEATURE_FIRST];this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS=[this.PAY_ATTENTION_TO_NEW_FEATURE_NEW,this.PAY_ATTENTION_TO_NEW_FEATURE_REMIND];this.wrap=e.wrap;this.userInfo=e.userInfo||null;this.sharingConfig=i.Util.getSharingConfig();this.sharingUrl=((s=this.sharingConfig)==null?void 0:s.url)||null;this.linkHash=((t=this.sharingConfig)==null?void 0:t.hash)||null;this.sharingRule=((a=this.sharingConfig)==null?void 0:a.rule)||null;this.payAttentionToNewFeatureMode=e.payAttentionToNewFeature;this.sharingFeatureLimit=e.sharingFeatureLimit;this.sharingSettingsCollapsed=e.sharingSettingsCollapsed;this.sortJointLinksByFrequentUse=e.sortJointLinksByFrequentUse}show(){L.Dom.addClass(this.wrap,"calendar-sharing__btn-wrap");this.button=new o.Button({text:L.Loc.getMessage("SHARING_BUTTON_TITLE"),round:true,size:o.ButtonSize.EXTRA_SMALL,color:o.ButtonColor.LIGHT_BORDER,icon:this.sharingFeatureLimit?o.ButtonIcon.LOCK:null,className:"ui-btn-themes calendar-sharing__btn",onclick:(e,s)=>{if(!this.switcher.getNode().contains(s.target)){this.handleSharingButtonClick()}}});this.button.renderTo(this.wrap);this.renderSwitcher();if(this.payAttentionToNewFeatureMode===this.PAY_ATTENTION_TO_NEW_FEATURE_JOINT){setTimeout((()=>{if(BX.SidePanel.Instance.getTopSlider()===null){this.payAttentionToNewFeatureWithText();BX.ajax.runAction("calendar.api.sharingajax.disableOptionPayAttentionToNewSharingFeature")}}),this.PAY_ATTENTION_TO_NEW_FEATURE_DELAY)}}handleSharingButtonClick(){if(this.sharingFeatureLimit){g.FeaturePromotersRegistry.getPromoter({featureId:"calendar_sharing"}).show();return}if(this.isSharingEnabled()){this.openDialog()}else{this.switcher.toggle()}}getSwitcherContainer(){return L.Tag.render(li||(li=ii`
			<div class="calendar-sharing__switcher"></div>
		`))}getSwitcherDivider(){return L.Tag.render(ri||(ri=ii`
			<div class="calendar-sharing__switcher_divider"></div>
		`))}renderSwitcher(){L.Dom.append(this.getSwitcherDivider(),this.wrap);this.switcherWrap=L.Tag.render(oi||(oi=ii`<div class="calendar-sharing__switcher-wrap"></div>`));L.Dom.append(this.switcherWrap,this.wrap);L.Event.bind(this.switcherWrap,"click",this.handleSwitcherWrapClick.bind(this),{capture:true});this.switcher=new BX.UI.Switcher({node:this.getSwitcherContainer(),checked:this.isSharingEnabled()&&!this.sharingFeatureLimit,color:"green",size:"small",handlers:{toggled:()=>this.handleSwitcherToggled()}});this.switcher.renderTo(this.switcherWrap)}handleSwitcherWrapClick(e){if(this.switcher.isChecked()){this.showWarningPopup();e.stopPropagation()}}handleSwitcherToggled(){if(this.sharingFeatureLimit&&this.switcher.isChecked()){g.FeaturePromotersRegistry.getPromoter({featureId:"calendar_sharing"}).show();this.switcher.toggle();return}if(this.isToggledAfterErrorOccurred()){return}if(this.switcher.isChecked()){this.enableSharing()}else{this.disableSharing()}}isToggledAfterErrorOccurred(){return this.switcher.isChecked()===this.isSharingEnabled()}isSharingEnabled(){return L.Type.isString(this.sharingUrl)}enableSharing(){const e="calendar.api.sharingajax.enableUserSharing";const s="Calendar.Sharing.copyLinkButton:onSharingEnabled";BX.ajax.runAction(e).then((e=>{this.sharingUrl=e.data.url;this.linkHash=e.data.hash;this.sharingRule=e.data.rule;this.openDialog();n.EventEmitter.emit(s,{isChecked:this.switcher.isChecked(),url:e.data.url})})).catch((()=>{this.switcher.toggle()}))}openDialog(){var e;(e=this.pulsar)==null?void 0:e.close();L.Dom.remove(this.counterNode);if(!this.newDialog){this.newDialog=new ai({bindElement:this.button.getContainer(),sharingUrl:this.sharingUrl,linkHash:this.linkHash,sharingRule:this.sharingRule,context:"calendar",calendarSettings:{weekHolidays:i.Util.config.week_holidays,weekStart:i.Util.config.week_start,workTimeStart:i.Util.config.work_time_start,workTimeEnd:i.Util.config.work_time_end},userInfo:this.userInfo,settingsCollapsed:this.sharingSettingsCollapsed,sortJointLinksByFrequentUse:this.sortJointLinksByFrequentUse})}if(!this.newDialog.isShown()){this.newDialog.show()}}disableSharing(){const e="calendar.api.sharingajax.disableUserSharing";const s="Calendar.Sharing.copyLinkButton:onSharingDisabled";this.warningPopup.close();BX.ajax.runAction(e).then((()=>{this.sharingUrl=null;if(this.newDialog){this.newDialog.destroy();this.newDialog=null}n.EventEmitter.emit(s,{isChecked:this.switcher.isChecked()})})).catch((()=>{this.switcher.toggle()}))}showWarningPopup(){if(!this.warningPopup){this.warningPopup=new r.MessageBox({title:L.Loc.getMessage("SHARING_WARNING_POPUP_TITLE_1"),message:L.Loc.getMessage("SHARING_WARNING_POPUP_CONTENT_2"),buttons:this.getWarningPopupButtons(),popupOptions:{autoHide:true,closeByEsc:true,draggable:false,closeIcon:true,minWidth:365,maxWidth:385,minHeight:180}})}this.warningPopup.show()}getWarningPopupButtons(){return[this.getSubmitButton(),this.getCancelButton()]}getSubmitButton(){return new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.DANGER,text:L.Loc.getMessage("SHARING_WARNING_POPUP_SUBMIT_BUTTON_NEW_MSGVER_1"),events:{click:()=>this.handleSubmitButtonClick()}})}getCancelButton(){return new o.Button({size:o.ButtonSize.MEDIUM,color:o.ButtonColor.LIGHT_BORDER,text:L.Loc.getMessage("SHARING_WARNING_POPUP_CANCEL_BUTTON"),events:{click:()=>this.handleCancelButtonClick()}})}handleSubmitButtonClick(){this.switcher.toggle();this.warningPopup.close()}handleCancelButtonClick(){this.warningPopup.close()}payAttentionToNewFeature(e){if(this.PAY_ATTENTION_TO_NEW_FEATURE_WITHOUT_TEXT_MODS.includes(e)){this.payAttentionToNewFeatureWithoutText()}if(this.PAY_ATTENTION_TO_NEW_FEATURE_WITH_TEXT_MODS.includes(e)){this.payAttentionToNewFeatureWithText()}}payAttentionToNewFeatureWithoutText(){this.pulsar=this.getPulsar(this.wrap,false);this.pulsar.show();L.Event.bind(this.pulsar.container,"click",(()=>{this.handleSharingButtonClick()}));this.counterNode=new u.Counter({value:1,color:u.Counter.Color.DANGER,size:u.Counter.Size.MEDIUM,animation:false}).getContainer();L.Dom.addClass(this.counterNode,"calendar-sharing__new-feature-counter");L.Dom.append(this.counterNode,this.wrap)}payAttentionToNewFeatureWithText(){const e=L.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_JOINT_TITLE");const s=L.Loc.getMessage("CALENDAR_PAY_ATTENTION_TO_NEW_FEATURE_JOINT_TEXT");const t=this.getGuide(e,s);const a=this.getPulsar(this.wrap);t.showNextStep();t.getPopup().setAngle({offset:210});a.show()}getGuide(e,s){const t=new v.Guide({simpleMode:true,onEvents:true,steps:[{target:this.wrap,title:e,text:s,position:"bottom",condition:{top:true,bottom:false,color:"primary"}}]});const a=t.getPopup();L.Dom.addClass(a.popupContainer,"calendar-popup-ui-tour-animate");a.setWidth(400);L.Dom.style(a.getContentContainer(),"paddingRight",getComputedStyle(a.closeIcon).width);return t}getPulsar(e,s=true){const t=new BX.SpotLight({targetElement:e,targetVertex:"middle-center",lightMode:true});if(s){t.bindEvents({onTargetEnter:()=>t.close()})}return t}}class di{constructor(e){var s,t,a,i;this.buttonWrap=e.buttonWrap;this.userInfo=e.userInfo||null;this.payAttentionToNewFeature=(s=e.payAttentionToNewFeature)!=null?s:false;this.sharingFeatureLimit=(t=e.sharingFeatureLimit)!=null?t:false;this.sharingSettingsCollapsed=(a=e.sharingSettingsCollapsed)!=null?a:false;this.sortJointLinksByFrequentUse=(i=e.sortJointLinksByFrequentUse)!=null?i:false}showSharingButton(){this.sharingButton=new ni({wrap:this.buttonWrap,userInfo:this.userInfo,payAttentionToNewFeature:this.payAttentionToNewFeature,sharingFeatureLimit:this.sharingFeatureLimit,sharingSettingsCollapsed:this.sharingSettingsCollapsed,sortJointLinksByFrequentUse:this.sortJointLinksByFrequentUse});this.sharingButton.show()}}let ci=e=>e,bi,hi;var pi=babelHelpers.classPrivateFieldLooseKey("popup");var vi=babelHelpers.classPrivateFieldLooseKey("loader");var ui=babelHelpers.classPrivateFieldLooseKey("layout");var gi=babelHelpers.classPrivateFieldLooseKey("qrCode");var Li=babelHelpers.classPrivateFieldLooseKey("context");class Pi{constructor(e){this.QRCODE_SIZE=114;this.QRCODE_COLOR_LIGHT="#fff";this.QRCODE_COLOR_DARK="#000";Object.defineProperty(this,pi,{writable:true,value:void 0});Object.defineProperty(this,vi,{writable:true,value:void 0});Object.defineProperty(this,ui,{writable:true,value:void 0});Object.defineProperty(this,gi,{writable:true,value:void 0});Object.defineProperty(this,Li,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]=null;babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]=null;babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]={qr:null};babelHelpers.classPrivateFieldLooseBase(this,gi)[gi]=null;babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]=e.context;this.sharingUrl=e.sharingUrl}getPopup(){if(!babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]){babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]=new P.Popup({className:"calendar-sharing__qr",width:315,padding:0,content:this.getContent(),closeIcon:true,closeByEsc:true,autoHide:true,overlay:true,animation:"fading-slide"})}return babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]}getLoader(){if(!babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]){babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]=new F.Loader({size:95})}return babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]}getNodeQr(){if(!babelHelpers.classPrivateFieldLooseBase(this,ui)[ui].qr){babelHelpers.classPrivateFieldLooseBase(this,ui)[ui].qr=L.Tag.render(bi||(bi=ci`
				<div class="calendar-sharing__qr-block"></div>
			`));this.getLoader().show(babelHelpers.classPrivateFieldLooseBase(this,ui)[ui].qr);this.showQr()}return babelHelpers.classPrivateFieldLooseBase(this,ui)[ui].qr}async showQr(){await this.initQrCode();this.QRCode=new QRCode(babelHelpers.classPrivateFieldLooseBase(this,ui)[ui].qr,{text:this.sharingUrl,width:this.QRCODE_SIZE,height:this.QRCODE_SIZE,colorDark:this.QRCODE_COLOR_DARK,colorLight:this.QRCODE_COLOR_LIGHT,correctLevel:QRCode.CorrectLevel.H});await this.getLoader().hide()}async initQrCode(){await L.Runtime.loadExtension(["main.qrcode"])}getContent(){return L.Tag.render(hi||(hi=ci`
			<div class="calendar-sharing__qr-content">
				<div class="calendar-sharing__qr-title">${0}</div>
				${0}
				<div class="calendar-sharing__qr-info">${0}</div>
				<a class="calendar-sharing__dialog-link" href="${0}" target="_blank">${0}</a>
			</div>
		`),this.getPhraseDependsOnContext("SHARING_INFO_POPUP_QR_TITLE"),this.getNodeQr(),L.Loc.getMessage("SHARING_INFO_POPUP_QR_INFO"),this.sharingUrl,L.Loc.getMessage("SHARING_INFO_POPUP_QR_OPEN_LINK"))}isShown(){return this.getPopup().isShown()}close(){this.getPopup().close()}show(){this.getPopup().show()}destroy(){this.getPopup().destroy()}getPhraseDependsOnContext(e){return L.Loc.getMessage(`${e}_${babelHelpers.classPrivateFieldLooseBase(this,Li)[Li].toUpperCase()}`)}}e.Interface=di;e.SharingButton=ni;e.DialogNew=ai;e.DialogQr=Pi;e.Layout=Oa;e.RuleModel=S;e.RangeModel=y;e.SettingsModel=A})(this.BX.Calendar.Sharing=this.BX.Calendar.Sharing||{},BX.Main,BX.Calendar.Sharing,BX.UI.EntitySelector,BX.Calendar,BX.UI.IconSet,BX.UI.Dialogs,BX.UI,BX.Event,BX,BX,BX,BX.UI,BX,BX.UI.Tour,BX.UI,BX.UI,BX,BX.Main,BX);
//# sourceMappingURL=interface.bundle.map.js