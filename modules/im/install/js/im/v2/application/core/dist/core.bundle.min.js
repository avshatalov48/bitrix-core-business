this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,i,s,l,n,r,a,o,u){"use strict";class c{constructor(){this.applicationData={};this.inited=false;this.initPromise=new Promise((e=>{this.initPromiseResolver=e}));this.offline=false;this.vuexAdditionalModel=[];this.store=null;this.storeBuilder=null;this.prepareVariables();this.initRestClient()}start(){this.initStorage().then((()=>this.initPull())).then((()=>this.initComplete())).catch((e=>{u.Logger.error("Core: error starting core application",e)}))}prepareVariables(){var e,i,s,l;this.localize=BX?{...BX.message}:{};this.host=location.origin;this.userId=(e=Number.parseInt(t.Loc.getMessage("USER_ID"),10))!=null?e:0;this.siteId=(i=t.Loc.getMessage("SITE_ID"))!=null?i:"s1";this.siteDir=(s=t.Loc.getMessage("SITE_DIR"))!=null?s:"s1";this.languageId=(l=t.Loc.getMessage("LANGUAGE_ID"))!=null?l:"en"}initRestClient(){this.restInstance=BX.RestClient;this.restClient=BX.rest}initStorage(){const e=s.Builder.init().addModel(a.ApplicationModel.create()).addModel(a.MessagesModel.create()).addModel(a.ChatsModel.create()).addModel(a.FilesModel.create()).addModel(a.UsersModel.create()).addModel(a.RecentModel.create()).addModel(a.CountersModel.create()).addModel(a.NotificationsModel.create()).addModel(a.SidebarModel.create()).addModel(a.MarketModel.create());return e.build().then((e=>{this.store=e.store;this.storeBuilder=e.builder;return true}))}initPull(){this.pullInstance=BX.PullClient;this.pullClient=BX.PULL;if(!this.pullClient){return Promise.reject(new Error("Core: error setting pull client"))}this.pullClient.subscribe(new o.BasePullHandler);this.pullClient.subscribe(new o.RecentPullHandler);this.pullClient.subscribe(new o.NotificationPullHandler);this.pullClient.subscribe(new o.NotifierPullHandler);this.pullClient.subscribe(new o.LinesPullHandler);this.pullClient.subscribe(new o.OnlinePullHandler);this.pullClient.subscribe({type:this.pullInstance.SubscriptionType.Status,callback:this.onPullStatusChange.bind(this)});return Promise.resolve()}initComplete(){this.inited=true;this.initPromiseResolver(this)}onPullStatusChange(e){if(e.status===this.pullInstance.PullStatus.Online){this.offline=false}else if(e.status===this.pullInstance.PullStatus.Offline){this.offline=true}}createVue(e,t={}){const s={};if(t.el){s.el=t.el}if(t.template){s.template=t.template}if(t.name){s.name=t.name}if(t.components){s.components=t.components}return new Promise((t=>{s.created=function(){t(this)};const l=i.BitrixVue.createApp(s);l.config.errorHandler=function(e,t,i){console.error(e,i)};l.config.warnHandler=function(e,t,i){console.warn(e,i)};e.bitrixVue=l;l.use(this.store).mount(s.el)}))}getHost(){return this.host}getUserId(){return this.userId}getSiteId(){return this.siteId}getLanguageId(){return this.languageId}getStore(){return this.store}getRestClient(){return this.restClient}getPullClient(){return this.pullClient}setApplicationData(e){this.applicationData={...this.applicationData,...e}}getApplicationData(){return this.applicationData}isOnline(){return!this.offline}isCloud(){const e=t.Extension.getSettings("im.v2.application.core");return e.get("isCloud")}ready(){if(this.inited){return Promise.resolve(this)}d.start();return this.initPromise}}const d=new c;e.Core=d;e.CoreApplication=c})(this.BX.Messenger.v2.Application=this.BX.Messenger.v2.Application||{},BX,BX.Vue3,BX.Vue3.Vuex,BX,BX,BX.Messenger.v2.Application,BX.Messenger.v2.Model,BX.Messenger.v2.Provider.Pull,BX.Messenger.v2.Lib);
//# sourceMappingURL=core.bundle.map.js