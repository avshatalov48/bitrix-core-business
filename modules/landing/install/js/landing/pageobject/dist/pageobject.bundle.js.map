{"version":3,"file":"pageobject.bundle.js","sources":["../src/pageobject.js"],"sourcesContent":["import {Type, Cache} from 'main.core';\n\n/**\n * @memberOf BX.Landing\n */\nexport class PageObject\n{\n\tstatic cache = new Cache.MemoryCache();\n\tstatic instance = null;\n\tstore = {};\n\n\tstatic getInstance(): PageObject\n\t{\n\t\tif (Type.isNil(PageObject.instance))\n\t\t{\n\t\t\tPageObject.instance = new PageObject();\n\t\t}\n\n\t\treturn PageObject.instance;\n\t}\n\n\tstatic getRootWindow(): Window\n\t{\n\t\treturn this.cache.remember('rootWindow', () => {\n\t\t\tconst frames = window.top.frames;\n\t\t\tfor (let i = frames.length - 1; i >= 0; i--)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tif (frames[i].document.body && frames[i].document.body.querySelector('.landing-ui-view'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn frames[i];\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn window.top;\n\t\t});\n\t}\n\n\tstatic getEditorWindow(): ?Window\n\t{\n\t\treturn this.cache.remember('editorWindow', () => {\n\t\t\tconst rootWindow = this.getRootWindow();\n\t\t\tconst rootDocument = rootWindow.document;\n\t\t\tconst editorFrame: HTMLIFrameElement = rootDocument.querySelector('.landing-ui-view');\n\n\t\t\tif (editorFrame && editorFrame.contentWindow)\n\t\t\t{\n\t\t\t\treturn editorFrame.contentWindow;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t});\n\t}\n\n\tstatic getTopPanel(): ?HTMLDivElement\n\t{\n\t\treturn this.cache.remember('topPanel', () => {\n\t\t\treturn this.getRootWindow().document.querySelector('.landing-ui-panel-top');\n\t\t});\n\t}\n\n\tstatic getEditPanelContent(): ?HTMLDivElement\n\t{\n\t\treturn this.cache.remember('editPanel', () => {\n\t\t\treturn this.getRootWindow()\n\t\t\t\t.document\n\t\t\t\t.querySelector(\n\t\t\t\t\t'.landing-ui-panel-content.landing-ui-panel-content-edit .landing-ui-panel-content-body-content'\n\t\t\t\t);\n\t\t});\n\t}\n\n\tstatic getStylePanelContent(): ?HTMLDivElement\n\t{\n\t\treturn this.cache.remember('stylePanel', () => {\n\t\t\treturn this.getRootWindow()\n\t\t\t\t.document\n\t\t\t\t.querySelector(\n\t\t\t\t\t'.landing-ui-panel-content.landing-ui-panel-style .landing-ui-panel-content-body-content'\n\t\t\t\t);\n\t\t});\n\t}\n\n\tstatic getBlocks(): BX.Landing.Collection.BlockCollection\n\t{\n\t\treturn this.getRootWindow().BX.Landing.Block.storage;\n\t}\n\n\t/**\n\t * @deprecated\n\t * @see PageObject.getTopPanel()\n\t * @return {Promise}\n\t */\n\ttop(): ?HTMLDivElement\n\t{\n\t\treturn new Promise(((resolve, reject) => {\n\t\t\tif (!this.store.topPanel)\n\t\t\t{\n\t\t\t\tthis.store.topPanel = PageObject.getTopPanel();\n\t\t\t}\n\n\t\t\tif (this.store.topPanel)\n\t\t\t{\n\t\t\t\tresolve(this.store.topPanel);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treject(new Error('Top panel unavailable'));\n\t\t\tconsole.warn('Top panel unavailable');\n\t\t}));\n\t}\n\n\t/**\n\t * @deprecated\n\t * @see BX.Landing.UI.Panel.StylePanel.getInstance()\n\t * @return {Promise}\n\t */\n\tdesign(): Promise<any>\n\t{\n\t\treturn Promise.resolve(BX.Landing.UI.Panel.StylePanel.getInstance());\n\t}\n\n\t/**\n\t * @deprecated\n\t * @see BX.Landing.UI.Panel.ContentEdit.getInstance()\n\t * @return {Promise}\n\t */\n\tcontent(): Promise<any>\n\t{\n\t\treturn Promise.resolve(BX.Landing.UI.Panel.ContentEdit.getInstance());\n\t}\n\n\t/**\n\t * @deprecated\n\t * @see BX.Landing.UI.Panel.EditorPanel.getInstance()\n\t * @return {Promise}\n\t */\n\tinlineEditor(): Promise<any>\n\t{\n\t\treturn Promise.resolve(BX.Landing.UI.Panel.EditorPanel.getInstance());\n\t}\n\n\t/**\n\t * @deprecated\n\t * @see PageObject.getEditorWindow()\n\t * @return {Promise}\n\t */\n\tview(): HTMLIFrameElement\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!this.store.view)\n\t\t\t{\n\t\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\t\tthis.store.view = rootWindow.document.querySelector('.landing-ui-view');\n\t\t\t}\n\n\t\t\tif (this.store.view)\n\t\t\t{\n\t\t\t\tresolve(this.store.view);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treject(new Error('View iframe unavailable'));\n\t\t\tconsole.warn('View iframe unavailable');\n\t\t});\n\t}\n\n\t/**\n\t * @deprecated\n\t * @see BX.Landing.Block.storage\n\t * @return {Promise}\n\t */\n\tblocks(): Promise<Array<BX.Landing.Block>>\n\t{\n\t\treturn Promise.resolve(PageObject.getRootWindow().BX.Landing.Block.storage);\n\t}\n}\n"],"names":["PageObject","Promise","resolve","reject","store","topPanel","getTopPanel","Error","console","warn","BX","Landing","UI","Panel","StylePanel","getInstance","ContentEdit","EditorPanel","view","rootWindow","getRootWindow","document","querySelector","Block","storage","Type","isNil","instance","cache","remember","frames","window","top","i","length","body","e","rootDocument","editorFrame","contentWindow","Cache","MemoryCache"],"mappings":";;;;;CAEA;CACA;CACA;AACA,KAAaA,UAAU;GAAA;KAAA;KAAA,2CAId,EAAE;;GAAA;KAAA;;CAkFX;CACA;CACA;CACA;KAJC,sBAMA;OAAA;OACC,OAAO,IAAIC,OAAO,CAAE,UAACC,OAAO,EAAEC,MAAM,EAAK;SACxC,IAAI,CAAC,KAAI,CAACC,KAAK,CAACC,QAAQ,EACxB;WACC,KAAI,CAACD,KAAK,CAACC,QAAQ,GAAGL,UAAU,CAACM,WAAW,EAAE;;SAG/C,IAAI,KAAI,CAACF,KAAK,CAACC,QAAQ,EACvB;WACCH,OAAO,CAAC,KAAI,CAACE,KAAK,CAACC,QAAQ,CAAC;WAC5B;;SAGDF,MAAM,CAAC,IAAII,KAAK,CAAC,uBAAuB,CAAC,CAAC;SAC1CC,OAAO,CAACC,IAAI,CAAC,uBAAuB,CAAC;QACrC,CAAE;;;CAIL;CACA;CACA;CACA;;KAJC;KAAA,yBAMA;OACC,OAAOR,OAAO,CAACC,OAAO,CAACQ,EAAE,CAACC,OAAO,CAACC,EAAE,CAACC,KAAK,CAACC,UAAU,CAACC,WAAW,EAAE,CAAC;;;CAItE;CACA;CACA;CACA;;KAJC;KAAA,0BAMA;OACC,OAAOd,OAAO,CAACC,OAAO,CAACQ,EAAE,CAACC,OAAO,CAACC,EAAE,CAACC,KAAK,CAACG,WAAW,CAACD,WAAW,EAAE,CAAC;;;CAIvE;CACA;CACA;CACA;;KAJC;KAAA,+BAMA;OACC,OAAOd,OAAO,CAACC,OAAO,CAACQ,EAAE,CAACC,OAAO,CAACC,EAAE,CAACC,KAAK,CAACI,WAAW,CAACF,WAAW,EAAE,CAAC;;;CAIvE;CACA;CACA;CACA;;KAJC;KAAA,uBAMA;OAAA;OACC,OAAO,IAAId,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;SACvC,IAAI,CAAC,MAAI,CAACC,KAAK,CAACc,IAAI,EACpB;WACC,IAAMC,UAAU,GAAGnB,UAAU,CAACoB,aAAa,EAAE;WAC7C,MAAI,CAAChB,KAAK,CAACc,IAAI,GAAGC,UAAU,CAACE,QAAQ,CAACC,aAAa,CAAC,kBAAkB,CAAC;;SAGxE,IAAI,MAAI,CAAClB,KAAK,CAACc,IAAI,EACnB;WACChB,OAAO,CAAC,MAAI,CAACE,KAAK,CAACc,IAAI,CAAC;WACxB;;SAGDf,MAAM,CAAC,IAAII,KAAK,CAAC,yBAAyB,CAAC,CAAC;SAC5CC,OAAO,CAACC,IAAI,CAAC,yBAAyB,CAAC;QACvC,CAAC;;;CAIJ;CACA;CACA;CACA;;KAJC;KAAA,yBAMA;OACC,OAAOR,OAAO,CAACC,OAAO,CAACF,UAAU,CAACoB,aAAa,EAAE,CAACV,EAAE,CAACC,OAAO,CAACY,KAAK,CAACC,OAAO,CAAC;;;KAC3E;KAAA,8BArKD;OACC,IAAIC,cAAI,CAACC,KAAK,CAAC1B,UAAU,CAAC2B,QAAQ,CAAC,EACnC;SACC3B,UAAU,CAAC2B,QAAQ,GAAG,IAAI3B,UAAU,EAAE;;OAGvC,OAAOA,UAAU,CAAC2B,QAAQ;;;KAC1B;KAAA,gCAGD;OACC,OAAO,IAAI,CAACC,KAAK,CAACC,QAAQ,CAAC,YAAY,EAAE,YAAM;SAC9C,IAAMC,MAAM,GAAGC,MAAM,CAACC,GAAG,CAACF,MAAM;SAChC,KAAK,IAAIG,CAAC,GAAGH,MAAM,CAACI,MAAM,GAAG,CAAC,EAAED,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAC3C;WACC,IACA;aACC,IAAIH,MAAM,CAACG,CAAC,CAAC,CAACZ,QAAQ,CAACc,IAAI,IAAIL,MAAM,CAACG,CAAC,CAAC,CAACZ,QAAQ,CAACc,IAAI,CAACb,aAAa,CAAC,kBAAkB,CAAC,EACxF;eACC,OAAOQ,MAAM,CAACG,CAAC,CAAC;;YAEjB,CAAC,OAAOG,CAAC,EAAE;;SAGb,OAAOL,MAAM,CAACC,GAAG;QACjB,CAAC;;;KACF;KAAA,kCAGD;OAAA;OACC,OAAO,IAAI,CAACJ,KAAK,CAACC,QAAQ,CAAC,cAAc,EAAE,YAAM;SAChD,IAAMV,UAAU,GAAG,MAAI,CAACC,aAAa,EAAE;SACvC,IAAMiB,YAAY,GAAGlB,UAAU,CAACE,QAAQ;SACxC,IAAMiB,WAA8B,GAAGD,YAAY,CAACf,aAAa,CAAC,kBAAkB,CAAC;SAErF,IAAIgB,WAAW,IAAIA,WAAW,CAACC,aAAa,EAC5C;WACC,OAAOD,WAAW,CAACC,aAAa;;SAGjC,OAAO,IAAI;QACX,CAAC;;;KACF;KAAA,8BAGD;OAAA;OACC,OAAO,IAAI,CAACX,KAAK,CAACC,QAAQ,CAAC,UAAU,EAAE,YAAM;SAC5C,OAAO,MAAI,CAACT,aAAa,EAAE,CAACC,QAAQ,CAACC,aAAa,CAAC,uBAAuB,CAAC;QAC3E,CAAC;;;KACF;KAAA,sCAGD;OAAA;OACC,OAAO,IAAI,CAACM,KAAK,CAACC,QAAQ,CAAC,WAAW,EAAE,YAAM;SAC7C,OAAO,MAAI,CAACT,aAAa,EAAE,CACzBC,QAAQ,CACRC,aAAa,CACb,gGAAgG,CAChG;QACF,CAAC;;;KACF;KAAA,uCAGD;OAAA;OACC,OAAO,IAAI,CAACM,KAAK,CAACC,QAAQ,CAAC,YAAY,EAAE,YAAM;SAC9C,OAAO,MAAI,CAACT,aAAa,EAAE,CACzBC,QAAQ,CACRC,aAAa,CACb,yFAAyF,CACzF;QACF,CAAC;;;KACF;KAAA,4BAGD;OACC,OAAO,IAAI,CAACF,aAAa,EAAE,CAACV,EAAE,CAACC,OAAO,CAACY,KAAK,CAACC,OAAO;;;GACpD;CAAA;CA0FD,4BA7KYxB,UAAU,WAEP,IAAIwC,eAAK,CAACC,WAAW,EAAE;CAAA,4BAF1BzC,UAAU,cAGJ,IAAI;;;;;;;;"}