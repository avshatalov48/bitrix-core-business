if(typeof oObject!="object"){window.oObject={}}var Errors={result_unval:"Error in result",result_empty:"Empty result"};function JsTc(oHandler,arSites,sParser,arParams){var t=this;t.oObj=typeof oHandler=="object"?oHandler:document.getElementById("TAGS");t.arSites=arSites;t.arParams=BX.type.isPlainObject(arParams)?arParams:{};t.selfFolderUrl=t.arParams.selfFolderUrl||"/bitrix/admin/";if(sParser){t.sExp=new RegExp("["+sParser+"]+","i")}else{t.sExp=new RegExp(",")}t.oLast={str:false,arr:false};t.oThis={str:false,arr:false};t.oEl={start:false,end:false};t.oUnfinedWords={};t.bReady=true;t.eFocus=true;t.aDiv=null;t.oDiv=null;t.oActive=null;t.oPointer=[];t.oPointer_default=[];t.oPointer_this="input_field";t.oObj.onblur=function(){t.eFocus=false};t.oObj.onfocus=function(){if(!t.eFocus){t.eFocus=true;setTimeout((function(){t.CheckModif("focus")}),500)}};t.oLast["arr"]=t.oObj.value.split(t.sExp);t.oLast["str"]=t.oLast["arr"].join(":");setTimeout((function(){t.CheckModif("this")}),500);this.CheckModif=function(e){var o=false;var r=0;var i=false;var n="";var a={};if(!t.eFocus){return}if(t.bReady&&t.oObj.value.length>0){t.oThis["arr"]=t.oObj.value.split(t.sExp);t.oThis["str"]=t.oThis["arr"].join(":");if(t.oThis["str"]&&t.oThis["str"]!=t.oLast["str"]){a["position"]=TCJsUtils.getCursorPosition(t.oObj);if(a["position"]["end"]>0&&!t.sExp.test(t.oObj.value.substr(a["position"]["end"]-1,1))){a["arr"]=t.oObj.value.substr(0,a["position"]["end"]).split(t.sExp);o=t.oThis["arr"][a["arr"].length-1];t.oEl["start"]=a["position"]["end"]-a["arr"][a["arr"].length-1].length;t.oEl["end"]=t.oEl["start"]+o.length;t.oEl["content"]=o;t.oLast["arr"]=t.oThis["arr"];t.oLast["str"]=t.oThis["str"]}}if(o){for(r=2;r<=o.length;r++){n=o.substr(0,r);if(t.oUnfinedWords[n]=="!fined"){i=true;break}}if(!i){t.Send(o)}}}setTimeout((function(){t.CheckModif("this")}),500)};t.Send=function(sSearch){if(!sSearch){return}var queryString=t.selfFolderUrl+"search_tags.php?search="+encodeURIComponent(sSearch);try{if(t.arSites&&t.arSites.constructor.toString().indexOf("Array")!=-1){for(var i=0,length=t.arSites.length;i<length;i++){queryString+="&site_id[]="+encodeURIComponent(t.arSites[i])}}var checkBox=document.getElementById("ck_"+oHandler.id);if(checkBox&&checkBox.checked){queryString+="&order_by=NAME"}}catch{}BX.ajax.post(queryString,"",BX.delegate((function(data){var oError={};var result={};t.bReady=true;try{eval("result = "+data+";")}catch(t){oError["result_unval"]=t}if(TCJsUtils.empty(result)){oError["result_empty"]=Errors["result_empty"]}try{if(TCJsUtils.empty(oError)&&typeof result=="object"){if(!(result.length==1&&result[0]["NAME"]==t.oEl["content"])){t.Show(result)}}else{t.oUnfinedWords[t.oEl["content"]]="!fined"}}catch(t){oError["unknown_error"]=t}}),t))};t.Show=function(e){t.Destroy();var o=BX.pos(t.oObj);t.oDiv=document.body.appendChild(document.createElement("DIV"));t.oDiv.id=t.oObj.id+"_div";t.oDiv.className="bx-popup-menu";t.oDiv.style.position="absolute";t.aDiv=t.Print(e,["NAME","CNT"]);if(t.oDiv.offsetWidth<300){t.oDiv.style.width=t.oDiv.offsetWidth+"px"}else{t.oDiv.style.width="300px"}t.oDiv.style.zIndex=5e3;jsFloatDiv.Show(t.oDiv,o["left"],o["bottom"]);BX.bind(document,"click",t.CheckMouse);BX.bind(document,"keydown",t.CheckKeyword)};t.Print=function(e,o){var r=null;var i="";var n=[];var a=[];var l=0;i=t.oDiv.id;var s='<table cellspacing="0" cellpadding="0" border="0"><tr><td class="popupmenu">'+'<table cellspacing="0" cellpadding="0" border="0" width="100%">';for(var c=0,u=e.length;c<u;c++){r=e[c];a=[];a["ID"]=r["ID"]&&r["ID"].length>0?r["ID"]:l++;a["GID"]=i+"_"+a["ID"];a["NAME"]=TCJsUtils.htmlspecialcharsEx(r["NAME"]);a["CNT"]=r["CNT"];n[a["GID"]]=a;t.oPointer.push(a["GID"]);s+="<tr><td>"+'<table cellspacing="0" cellpadding="0" border="0" class="popupitem" '+'onmouseout="window.oObject.'+t.oObj.id+".Init(); this.className='popupitem';\" "+'onmouseover="window.oObject.'+t.oObj.id+".Init(); this.className='popupitem popupitemover'\" "+'onclick="window.oObject.'+t.oObj.id+'.oActive=this.id;" '+'id="'+a["GID"]+'" name="'+i+'_table">'+'<tr><td class="gutter"><div></div></td>'+'<td class="item" id="'+a["GID"]+'_NAME" width="90%">'+a["NAME"]+"</td>"+'<td class="item" id="'+a["GID"]+'_CNT" width="10%" align="right">'+a["CNT"]+"</td>"+"</tr></table></td></tr>"}s+="</table></td></tr></table>";t.oPointer.push("input_field");t.oPointer_default=t.oPointer;t.oDiv.innerHTML=s;return n};t.Destroy=function(){try{jsFloatDiv.Close(t.oDiv);t.oDiv.parentNode.removeChild(t.oDiv)}catch{}t.oPointer=[];t.oPointer_default=[];t.oPointer_this="input_field";t.oDiv=null;t.aDiv=null;t.oActive=null;BX.unbind(document,"click",t.CheckMouse);BX.unbind(document,"keydown",t.CheckKeyword)};t.Replace=function(){if(typeof t.oActive=="string"){var e=t.aDiv[t.oActive];var o="";if(typeof e=="object"){var r=document.createElement("span");r.innerHTML=e["NAME"].replaceAll("&quot;",'"').replaceAll("&amp;","&");o=r.innerHTML}var i=t.oEl["start"];while(i<t.oObj.value.length&&t.oObj.value.substring(i,i+1)==" "){i++}t.oObj.value=t.oObj.value.substring(0,i)+o.replaceAll("&lt;","<").replaceAll("&gt;",">")+t.oObj.value.substr(t.oEl["end"]);TCJsUtils.setCursorPosition(t.oObj,i+o.length)}};t.Init=function(){t.oActive=false;t.oPointer=t.oPointer_default;t.Clear();t.oPointer_this="input_pointer"};t.Clear=function(){var e={};var o="";e=t.oDiv.getElementsByTagName("table");if(e.length>0&&typeof e=="object"){for(o in e){if(e.hasOwnProperty(o)){var r=e[o];if(r.name==t.oDiv.id+"_table"||t.aDiv[r.id]){r.className="popupitem"}}}}};t.CheckMouse=function(){t.Replace();t.Destroy()};t.CheckKeyword=function(e){if(!e){e=window.event}var o=null;var r=null;if(e.keyCode>37&&e.keyCode<41||e.keyCode==13){t.Clear();switch(e.keyCode){case 38:o=t.oPointer.pop();if(t.oPointer_this==o){t.oPointer.unshift(o);o=t.oPointer.pop()}if(o!="input_field"){t.oActive=o;r=document.getElementById(o);if(typeof r=="object"){r.className="popupitem popupitemover"}}t.oPointer.unshift(o);break;case 40:o=t.oPointer.shift();if(t.oPointer_this==o){t.oPointer.push(o);o=t.oPointer.shift()}if(o!="input_field"){t.oActive=o;r=document.getElementById(o);if(typeof r=="object"){r.className="popupitem popupitemover"}}t.oPointer.push(o);break;case 39:t.Replace();t.Destroy();break;case 13:t.Replace();t.Destroy();if(BX.browser.IsIE()){e.returnValue=false;e.cancelBubble=true}else{e.preventDefault();e.stopPropagation()}break;default:break}t.oPointer_this=o}else{t.Destroy()}return true}}var TCJsUtils={getCursorPosition:function(t){var e={start:0,end:0};if(!t||typeof t!="object"){return e}try{if(document.selection!=null&&t.selectionStart==null){t.focus();var o=document.selection.createRange();var r=o.parentElement();var i=o.getBookmark();var n=t.value;var a=t.value;var l="__"+Math.random()+"__";while(n.indexOf(l)!=-1){l="__"+Math.random()+"__"}if(!r||r===null||r.type!="textarea"&&r.type!="text"){return e}o.text=l+o.text+l;n=t.value;e["start"]=n.indexOf(l);n=n.replace(l,"");e["end"]=n.indexOf(l);t.value=a;o.moveToBookmark(i);o.select();return e}return{start:t.selectionStart,end:t.selectionEnd}}catch{}return e},setCursorPosition:function(t,e){if(typeof t!="object"){return false}t.focus();try{if(document.selection!==null&&t.selectionStart===null){var o=document.selection.createRange();o.select()}else{t.selectionStart=e;t.selectionEnd=e}return true}catch{return false}},empty:function(t){var e=true;if(t){for(var o in t){if(t.hasOwnProperty(o)){e=false;break}}}return e},htmlspecialcharsEx:function(t){return t.replaceAll("&amp;","&amp;amp;").replaceAll("&lt;","&amp;lt;").replaceAll("&gt;","&amp;gt;").replaceAll("&quot;","&amp;quot;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;")},htmlspecialcharsback:function(t){return t.replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&quot;",'"').replaceAll("&amp;","&")}};
//# sourceMappingURL=tags.map.js