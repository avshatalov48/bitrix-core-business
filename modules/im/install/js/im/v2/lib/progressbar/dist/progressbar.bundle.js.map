{"version":3,"file":"progressbar.bundle.js","sources":["../src/progressbar.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\nimport {Loc} from 'main.core';\nimport {Uploader as ProgressBar} from 'ui.progressbarjs.uploader';\n\nimport {FileStatus} from 'im.v2.const';\n\ntype UploadState = {\n\tprogress: number,\n\tstatus: string,\n\tsize: number\n};\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.CallBackground.ProgressBar';\nconst SIZE_LOWER_THRESHOLD = 1024 * 1024 * 2;\nconst CONTAINER_WIDTH_LOWER_THRESHOLD = 240;\nconst CONTAINER_HEIGHT_LOWER_THRESHOLD = 54;\nconst STARTING_PROGRESS = 5;\n\nexport class ProgressBarManager extends EventEmitter\n{\n\tstatic event = {\n\t\tcancel: 'cancel',\n\t\tdestroy: 'destroy'\n\t};\n\n\tcontainer: HTMLElement;\n\tuploadState: UploadState;\n\n\tconstructor(params: {container: HTMLElement, uploadState: UploadState, customConfig: Object})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tconst {container, uploadState, customConfig = {}} = params;\n\t\tthis.container = container;\n\t\tthis.uploadState = uploadState;\n\n\t\tthis.progressBar = new ProgressBar({\n\t\t\t...this.#getProgressBarParams(customConfig),\n\t\t\tcontainer\n\t\t});\n\n\t\tthis.#adjustProgressBarTitleVisibility();\n\t}\n\n\tstart()\n\t{\n\t\tthis.progressBar.start();\n\t\tthis.update();\n\t}\n\n\tupdate()\n\t{\n\t\tif (this.uploadState.status === FileStatus.error)\n\t\t{\n\t\t\tthis.progressBar.setProgress(0);\n\t\t\tthis.progressBar.setCancelDisable(false);\n\t\t\tthis.progressBar.setIcon(ProgressBar.icon.error);\n\t\t\tthis.progressBar.setProgressTitle(Loc.getMessage('IM_LIB_PROGRESSBAR_FILE_UPLOAD_ERROR'));\n\t\t}\n\t\telse if (this.uploadState.status === FileStatus.wait)\n\t\t{\n\t\t\tthis.progressBar.setProgress(this.uploadState.progress > STARTING_PROGRESS? this.uploadState.progress: STARTING_PROGRESS);\n\t\t\tthis.progressBar.setCancelDisable(true);\n\t\t\tthis.progressBar.setIcon(ProgressBar.icon.cloud);\n\t\t\tthis.progressBar.setProgressTitle(Loc.getMessage('IM_LIB_PROGRESSBAR_FILE_UPLOAD_SAVING'));\n\t\t}\n\t\telse if (this.uploadState.progress === 100)\n\t\t{\n\t\t\tthis.progressBar.setProgress(100);\n\t\t}\n\t\telse if (this.uploadState.progress === -1)\n\t\t{\n\t\t\tthis.progressBar.setProgress(10);\n\t\t\tthis.progressBar.setProgressTitle(Loc.getMessage('IM_LIB_PROGRESSBAR_FILE_UPLOAD_WAITING'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.uploadState.progress === 0)\n\t\t\t{\n\t\t\t\tthis.progressBar.setIcon(ProgressBar.icon.cancel);\n\t\t\t}\n\t\t\tconst progress = this.uploadState.progress > STARTING_PROGRESS ? this.uploadState.progress: STARTING_PROGRESS;\n\t\t\tthis.progressBar.setProgress(progress);\n\n\t\t\tif (this.#isSmallSizeFile())\n\t\t\t{\n\t\t\t\tthis.progressBar.setProgressTitle(Loc.getMessage('IM_LIB_PROGRESSBAR_FILE_UPLOAD_LOADING'));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst byteSent = (this.uploadState.size / 100) * this.uploadState.progress;\n\t\t\t\tthis.progressBar.setByteSent(byteSent, this.uploadState.size);\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.progressBar.destroy(false);\n\t}\n\n\t#getProgressBarParams(customConfig: Object)\n\t{\n\t\tconst defaultConfig = {\n\t\t\t// direction: this.container.offsetHeight > CONTAINER_HEIGHT_LOWER_THRESHOLD? ProgressBar.direction.vertical: ProgressBar.direction.horizontal,\n\t\t\tsizes: {\n\t\t\t\tcircle: this.container.offsetHeight > CONTAINER_HEIGHT_LOWER_THRESHOLD? 54: 38,\n\t\t\t\tprogress: this.container.offsetHeight > CONTAINER_HEIGHT_LOWER_THRESHOLD? 4: 8,\n\t\t\t},\n\t\t\tlabels: {\n\t\t\t\tloading: Loc.getMessage('IM_LIB_PROGRESSBAR_FILE_UPLOAD_LOADING'),\n\t\t\t\tcompleted: Loc.getMessage('IM_LIB_PROGRESSBAR_FILE_UPLOAD_COMPLETED'),\n\t\t\t\tcanceled: Loc.getMessage('IM_LIB_PROGRESSBAR_FILE_UPLOAD_CANCELED'),\n\t\t\t\tcancelTitle: Loc.getMessage('IM_LIB_PROGRESSBAR_FILE_UPLOAD_CANCEL_TITLE'),\n\t\t\t\tmegabyte: Loc.getMessage('IM_LIB_PROGRESSBAR_FILE_SIZE_MB'),\n\t\t\t},\n\t\t\tcancelCallback: () => {\n\t\t\t\tthis.emit(ProgressBarManager.event.cancel);\n\t\t\t},\n\t\t\tdestroyCallback: () => {\n\t\t\t\tthis.emit(ProgressBarManager.event.destroy);\n\t\t\t}\n\t\t};\n\n\t\treturn {...defaultConfig, ...customConfig};\n\t}\n\n\t#adjustProgressBarTitleVisibility()\n\t{\n\t\tif (this.#isSmallSizeFile() || this.#isSmallContainer())\n\t\t{\n\t\t\tthis.progressBar.setProgressTitleVisibility(false);\n\t\t}\n\t}\n\n\t#isSmallSizeFile(): boolean\n\t{\n\t\treturn this.uploadState.size < SIZE_LOWER_THRESHOLD;\n\t}\n\n\t#isSmallContainer(): boolean\n\t{\n\t\treturn this.container.offsetHeight <= CONTAINER_HEIGHT_LOWER_THRESHOLD && this.container.offsetWidth < CONTAINER_WIDTH_LOWER_THRESHOLD;\n\t}\n}"],"names":["EVENT_NAMESPACE","SIZE_LOWER_THRESHOLD","CONTAINER_WIDTH_LOWER_THRESHOLD","CONTAINER_HEIGHT_LOWER_THRESHOLD","STARTING_PROGRESS","ProgressBarManager","EventEmitter","constructor","params","setEventNamespace","container","uploadState","customConfig","progressBar","ProgressBar","start","update","status","FileStatus","error","setProgress","setCancelDisable","setIcon","icon","setProgressTitle","Loc","getMessage","wait","progress","cloud","cancel","byteSent","size","setByteSent","destroy","defaultConfig","sizes","circle","offsetHeight","labels","loading","completed","canceled","cancelTitle","megabyte","cancelCallback","emit","event","destroyCallback","setProgressTitleVisibility","offsetWidth"],"mappings":"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"}