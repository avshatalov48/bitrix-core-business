(function(){if(window["SBPETabs"])return;window.SBPEFullForm=function(){this.lazyLoad=null;this.ajaxUrl="";this.inited=false;this.loaded=false;this.container=null;this.containerMicro=null;this.containerMicroInner=null;this.clickDisabled=false;this.lastWait=[];this.animationStartHeight=0};window.SBPEFullForm.instance=null;window.SBPEFullForm.getInstance=function(){if(window.SBPEFullForm.instance==null){window.SBPEFullForm.instance=new SBPEFullForm}return window.SBPEFullForm.instance};window.SBPEFullForm.prototype={init:function(e){if(this.inited!==true){this.inited=true;this.lazyLoad=typeof e.lazyLoad!="undefined"?e.lazyLoad:null;this.ajaxUrl=typeof e.ajaxUrl!="undefined"?e.ajaxUrl:"";this.container=typeof e.container!="undefined"?e.container:null;this.containerMicro=typeof e.containerMicro!="undefined"?e.containerMicro:null;this.containerMicroInner=typeof e.containerMicroInner!="undefined"?e.containerMicroInner:null}},get:function(e){var t=this;if(t.clickDisabled){return}if(t.lazyLoad&&!t.loaded){t.clickDisabled=true;t.animationStartHeight=this.containerMicro.offsetHeight;t.containerMicroInner.style.display="none";t.showWait(t.containerMicro);BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{action:"SBPE_get_full_form",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(o){t.loaded=true;t.clickDisabled=false;t.closeWait();if(o.success){t.processAjaxBlock(o.PROPS,e.callback)}else{}}),onfailure:function(e){t.clickDisabled=false;t.closeWait();t.containerMicroInner.style.display="block"}})}else{e.callback()}},processAjaxBlock:function(e,t){if(!e){return}var o=this;var s=false;var i=false;a(n);l(r);function a(t){if(BX.type.isArray(e.CSS)&&e.CSS.length>0){BX.load(e.CSS,t)}else{t()}}function n(){o.container.appendChild(BX.create("DIV",{html:e.CONTENT}));s=true;if(i){r()}}function l(t){if(BX.type.isArray(e.JS)&&e.JS.length>0){BX.load(e.JS,t)}else{t()}}function r(){i=true;if(s){BX.ajax.processRequestData(e.CONTENT,{scriptsRunFirst:false,dataType:"HTML"});t()}}},showWait:function(e){e=BX(e)||document.body||document.documentElement;var t=e.bxmsg=document.body.appendChild(BX.create("DIV",{props:{id:"wait_"+e.id,className:"feed-add-post-loader-cont"},html:'<svg class="feed-add-post-loader" viewBox="25 25 50 50"><circle class="feed-add-post-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle><circle class="feed-add-post-loader-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle></svg>'}));setTimeout(BX.delegate(this.adjustWait,e),10);this.lastWait[this.lastWait.length]=t;return t},adjustWait:function(){if(!this.bxmsg)return;var e=BX.pos(this),t=e.top+15;if(t<BX.GetDocElement().scrollTop)t=BX.GetDocElement().scrollTop+5;this.bxmsg.style.top=t+5+"px";if(this==BX.GetDocElement()){this.bxmsg.style.right="5px"}else{this.bxmsg.style.left=e.left+parseInt((e.width-this.bxmsg.offsetWidth)/2)+"px"}},closeWait:function(){var e=this.containerMicro;obMsg=e.bxmsg;if(obMsg&&obMsg.parentNode){for(var t=0,o=this.lastWait.length;t<o;t++){if(obMsg==this.lastWait[t]){this.lastWait=BX.util.deleteFromArray(this.lastWait,t);break}}obMsg.parentNode.removeChild(obMsg);if(e)e.bxmsg=null;BX.cleanNode(obMsg,true)}},tasksTaskEvent:function(e){this.showTaskPopup(e)},showTaskPopup:function(e){this.createTaskPopup=new BX.PopupWindow("blogPostEditCreateTaskPopup",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:false,lightShadow:true,closeIcon:{right:"12px",top:"10px"},draggable:{restrict:true},closeByEsc:false,contentColor:"white",contentNoPaddings:true,buttons:[],content:BX.create("DIV",{attrs:{id:"blogPostEditCreateTaskPopup_content"},props:{className:"feed-create-task-popup-content"}}),events:{onAfterPopupShow:BX.proxy(function(){this.setTaskPopupContent(BX.create("DIV",{children:[BX.create("DIV",{props:{className:"feed-create-task-popup-title"},html:BX.message("sonetBPECreateTaskSuccessTitle")}),BX.create("DIV",{props:{className:"feed-create-task-popup-description"},html:BX.message("sonetBPECreateTaskSuccessDescription")})]}));this.createTaskPopup.setButtons([new BX.PopupWindowButton({text:BX.message("sonetBPECreateTaskButtonTitle"),events:{click:BX.proxy(function(){this.createTaskPopup.destroy();var t=BX.message("PATH_TO_USER_TASKS_TASK").replace("#user_id#",BX.message("USER_ID")).replace("#task_id#",e).replace("#action#","view");if(typeof BX.Bitrix24!="undefined"&&typeof BX.Bitrix24.PageSlider!="undefined"){BX.Bitrix24.PageSlider.open(t)}else{window.open(t,"_blank")}},this)}})])},this),onPopupClose:BX.proxy(function(){this.createTaskPopup.destroy()},this)}});this.createTaskPopup.params.zIndex=BX.WindowManager?BX.WindowManager.GetZIndex():0;this.createTaskPopup.show()},setTaskPopupContent:function(e){if(BX("blogPostEditCreateTaskPopup_content")){var t=BX("blogPostEditCreateTaskPopup_content");BX.cleanNode(t);t.appendChild(e)}}};window.SBPETabs=function(){if(window.SBPETabs.instance!=null){throw"SBPETabs is a singleton. Use SBPETabs.getInstance to get an object."}this.tabs={};this.bodies={};this.active=null;this.animation=null;this.animationStartHeight=0;this.menu=null;this.menuItems=[];this.lastWait=[];this.clickDisabled=false;this.createTaskPopup=null;if(this.inited!==true)this.init();window.SBPETabs.instance=this};window.SBPETabs.instance=null;window.SBPETabs.getInstance=function(){if(window.SBPETabs.instance==null){window.SBPETabs.instance=new SBPETabs}return window.SBPETabs.instance};window.SBPETabs.changePostFormTab=function(e,t){var o=window.SBPETabs.getInstance();if(o.clickDisabled)return false;return o.setActive(e,t)};window.SBPETabs.prototype={_createOnclick:function(e,t,o){return function(){var s=BX("feed-add-post-form-link-more",true);var i=BX("feed-add-post-form-link-text",true);i.innerHTML=t;if(e!="lists"){s.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-link-active feed-add-post-form-"+e+"-link";window.SBPETabs.changePostFormTab(e)}else{s.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-"+e+"-link"}if(BX.type.isNotEmptyString(o)){BX.evalGlobal(o)}this.popupWindow.close()}},init:function(){this.tabContainer=BX("feed-add-post-form-tab");var e=BX.findChildren(this.tabContainer,{tag:"span",className:"feed-add-post-form-link"},true);this.arrow=BX("feed-add-post-form-tab-arrow");this.tabs={};this.bodies={};for(var t=0;t<e.length;t++){var o=e[t].getAttribute("id").replace("feed-add-post-form-tab-","");this.tabs[o]=e[t];if(this.tabs[o].style.display=="none"){this.menuItems.push({tabId:o,text:e[t].getAttribute("data-name"),className:"menu-popup-no-icon feed-add-post-form-"+o+" feed-add-post-form-"+o+"-more",onclick:this._createOnclick(o,e[t].getAttribute("data-name"),e[t].getAttribute("data-onclick"))});this.tabs[o]=this.tabs[o].parentNode}this.bodies[o]=BX("feed-add-post-content-"+o)}if(!!this.tabs["file"])this.bodies["file"]=[this.bodies["message"]];if(!!this.tabs["calendar"])this.bodies["calendar"]=[this.bodies["calendar"]];if(!!this.tabs["vote"])this.bodies["vote"]=[this.bodies["message"],this.bodies["vote"]];if(!!this.tabs["more"])this.bodies["more"]=null;if(!!this.tabs["important"])this.bodies["important"]=[this.bodies["message"],this.bodies["important"]];if(!!this.tabs["grat"])this.bodies["grat"]=[this.bodies["message"],this.bodies["grat"]];if(!!this.tabs["lists"])this.bodies["lists"]=[this.bodies["lists"]];if(!!this.tabs["tasks"])this.bodies["tasks"]=[this.bodies["tasks"]];for(var s in this.bodies){if(this.bodies.hasOwnProperty(s)&&BX.type.isDomNode(this.bodies[s]))this.bodies[s]=[this.bodies[s]]}this.inited=true;this.previousTab=false;if(BX("bx-b-uploadfile-blogPostForm")){BX("bx-b-uploadfile-blogPostForm").setAttribute("bx-press","pressOut");BX.bind(BX("bx-b-uploadfile-blogPostForm"),"mousedown",BX.delegate(function(){BX("bx-b-uploadfile-blogPostForm").setAttribute("bx-press",BX("bx-b-uploadfile-blogPostForm").getAttribute("bx-press")=="pressOut"?"pressOn":"pressOut")},this))}BX.onCustomEvent(this.tabContainer,"onObjectInit",[this]);var i=BX("blogPostForm");if(i){if(!i.changePostFormTab){i.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"changePostFormTab",value:""}}))}BX.addCustomEvent(window,"changePostFormTab",function(e){if(e!="more"){i.changePostFormTab.value=e}});if(i["UF_BLOG_POST_IMPRTNT"]){BX.addCustomEvent(window,"changePostFormTab",function(e){if(e!="more"){i["UF_BLOG_POST_IMPRTNT"].value=e=="important"?1:0}})}}},setActive:function(e,t){if(e==null||this.active==e&&e!="lists")return this.active;else if(!this.tabs[e])return false;var o,s;var i=e!=="tasks"||this.isTaskTabLoaded();if(i){this.startAnimation()}for(o in this.tabs){if(this.tabs.hasOwnProperty(o)&&o!=e){BX.removeClass(this.tabs[o],"feed-add-post-form-link-active");if(this.bodies[o]==null||this.bodies[e]==null)continue;for(s=0;s<this.bodies[o].length;s++){if(this.bodies[e][s]!=this.bodies[o][s])BX.adjust(this.bodies[o][s],{style:{display:"none"}})}}}if(!!this.tabs[e]){this.active=e;var a=BX.pos(this.tabs[e],true);this.arrow.style.display="block";this.arrow.style.top=a.bottom+"px";var n=parseInt(this.arrow.style.left)||0;var l=parseInt(this.arrow.style.width)||0;new BX.easing({duration:200,start:{left:n,width:l},finish:{left:a.left,width:a.width},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:BX.proxy(function(e){this.arrow.style.left=e.left+"px";this.arrow.style.width=e.width+"px"},this),complete:BX.proxy(function(){this.arrow.style.display="none";BX.addClass(this.tabs[e],"feed-add-post-form-link-active")},this)}).animate();if(this.previousTab=="file"||e=="file"){var r=null,d=null,c=false,f=false,u=BX("divoPostFormLHE_blogPostForm");if(!!u&&!!u.childNodes&&u.childNodes.length>0){for(o in u.childNodes){if(u.childNodes.hasOwnProperty(o)&&u.childNodes[o].className=="file-selectdialog"){r=u.childNodes[o];var p=BX.findChild(r,{className:"file-placeholder-tbody"},true),m=BX.findChildren(r,{className:"feed-add-photo-block"},true);if(p.rows>0||!!m&&m.length>1)c=true}else if(BX.type.isNotEmptyString(u.childNodes[o].className)&&(u.childNodes[o].className.indexOf("wduf-selectdialog")>=0||u.childNodes[o].className.indexOf("diskuf-selectdialog")>=0)){d=u.childNodes[o];var h=BX.findChildren(d,{className:"wd-inline-file"},true);f=!!h&&h.length>0}else if(BX.type.isElementNode(u.childNodes[o])&&!BX.hasClass(u.childNodes[o],"urlpreview")){BX.adjust(u.childNodes[o],{style:{display:e=="file"?"none":""}})}}if(e=="file"){if(!!window["PlEditorblogPostForm"]){if(!window["PlEditorblogPostForm"]["SBPEBinded"]){window["PlEditorblogPostForm"].SBPEBinded=true;BX.addCustomEvent(window["PlEditorblogPostForm"].eventNode,"onUploadsHasBeenChanged",function(e){if(e.dialogName=="AttachFileDialog"&&e.urlUpload.indexOf("&dropped=Y")<0){e.urlUpload=e.agent.uploadFileUrl=e.urlUpload.replace("&random_folder=Y","&dropped=Y")}BX("bx-b-uploadfile-blogPostForm").setAttribute("bx-press","pressOn");window.SBPETabs.changePostFormTab("message")})}window["PlEditorblogPostForm"].controllerInit("show")}window["PlEditorblogPostForm"].controllerInit("show");BX.addClass(u,"feed-add-post-form");BX.addClass(u,"feed-add-post-edit-form");BX.addClass(u,"feed-add-post-edit-form-file")}else{BX.removeClass(u,"feed-add-post-form");BX.removeClass(u,"feed-add-post-edit-form");BX.removeClass(u,"feed-add-post-edit-form-file");if(!c&&!f&&BX("bx-b-uploadfile-blogPostForm").getAttribute("bx-press")=="pressOut"&&!!window["PlEditorblogPostForm"]){window["PlEditorblogPostForm"].controllerInit("hide")}}}}if(BX("divoPostFormLHE_blogPostForm")&&BX("divoPostFormLHE_blogPostForm").style.display=="none"){BX.onCustomEvent(BX("divoPostFormLHE_blogPostForm"),"OnShowLHE",["justShow"])}if(e=="lists"){BX.onCustomEvent("onDisplayClaimLiveFeed",[t])}this.previousTab=e;if(!!this.bodies[e]){for(s=0;s<this.bodies[e].length;s++){if(!!this.bodies[e][s]){BX.adjust(this.bodies[e][s],{style:{display:"block"}})}}}}if(i){this.endAnimation()}if(e!="lists")this.restoreMoreMenu();BX.onCustomEvent(window,"changePostFormTab",[e]);return this.active},startAnimation:function(){if(this.animation){this.animation.stop()}var e=BX("microblog-form",true);if(!e){return false}if(window.SBPEFullForm.getInstance().animationStartHeight>0){this.animationStartHeight=window.SBPEFullForm.getInstance().animationStartHeight;window.SBPEFullForm.getInstance().animationStartHeight=0}else{this.animationStartHeight=e.parentNode.offsetHeight}e.parentNode.style.height=this.animationStartHeight+"px";e.parentNode.style.overflowY="hidden";e.parentNode.style.position="relative";e.style.opacity=0},endAnimation:function(){var e=BX("microblog-form",true);if(!e){return false}this.animation=new BX.easing({duration:500,start:{height:this.animationStartHeight,opacity:0},finish:{height:e.offsetHeight+e.offsetTop,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(t){e.parentNode.style.height=t.height+"px";e.style.opacity=t.opacity/100},complete:BX.proxy(function(){e.style.cssText="";e.parentNode.style.cssText="";this.animation=null},this)});this.animation.animate()},collapse:function(){window.SBPETabs.changePostFormTab("message");if(window.SBPEFullForm.getInstance().containerMicroInner){window.SBPEFullForm.getInstance().containerMicroInner.style.display="block"}this.startAnimation();BX.onCustomEvent(BX("divoPostFormLHE_blogPostForm"),"OnShowLHE",[false]);BX.onCustomEvent(window,"onExtAutoSaveReset_blogPostForm",[]);this.endAnimation();this.active=null},showMoreMenu:function(){if(!this.menu){this.menu=BX.PopupMenu.create("feed-add-post-form-popup",BX("feed-add-post-form-link-text"),this.menuItems,{className:"feed-add-post-form-popup",closeByEsc:true,offsetTop:5,offsetLeft:3,angle:true})}this.menu.popupWindow.show()},restoreMoreMenu:function(){var e=this.menuItems.length;if(e<1){return}for(var t=0;t<e;t++){if(this.active==this.menuItems[t]["tabId"]){return}}var o=BX("feed-add-post-form-link-more",true);var s=BX("feed-add-post-form-link-text",true);o.className="feed-add-post-form-link feed-add-post-form-link-more";s.innerHTML=BX.message("SBPE_MORE")},getLists:function(){var e=BX("feed-add-post-form-tab-lists")&&BX("feed-add-post-form-tab-lists").style.display!="none"?BX("feed-add-post-form-tab-lists"):BX("feed-add-post-form-link-more"),t=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists"},true),o=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists-default"},true),s=[],i=[];if(t.length){i=this.getMenuItems(t,this.createOnclickLists);s=this.getMenuItemsDefault(o);i=i.concat(s);this.showMoreMenuLists(i)}else{var a=this.showMoreMenuLists,n=this.getMenuItems,l=this.getMenuItemsDefault,r=this.createOnclickLists,d=null;if(BX("bx-lists-select-site-id")){d=BX("bx-lists-select-site-id").value}BX.ajax({method:"POST",dataType:"json",url:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/post.ajax.php",data:{bitrix_processes:1,siteId:d,sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(d){if(d.success){var c=null;for(c in d.lists){if(d.lists.hasOwnProperty(c)){e.appendChild(BX.create("span",{attrs:{"data-name":d.lists[c].NAME,"data-picture":d.lists[c].PICTURE,"data-description":d.lists[c].DESCRIPTION,"data-picture-small":d.lists[c].PICTURE_SMALL,"data-code":d.lists[c].CODE,iblockId:d.lists[c].ID},props:{className:"feed-add-post-form-link-lists",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}}t=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists"},true);i=n(t,r);if(!o.length){for(c in d.permissions){if(d.permissions.hasOwnProperty(c)){var f;if(c=="new"){f='document.location.href = "'+BX("bx-lists-lists-page").value+'0/edit/"'}else if(c=="market"){if(d.admin&&BX("bx-lists-lists-page")){f='document.location.href = "'+BX("bx-lists-lists-page").value+'?bp_catalog=y"'}else{if(BX("bx-lists-random-string")){f='BX.Lists["LiveFeedClass_'+BX("bx-lists-random-string").value+'"].errorPopup("'+BX.message("LISTS_CATALOG_PROCESSES_ACCESS_DENIED")+'");'}}}else if(c=="settings"){f='document.location.href = "'+BX("bx-lists-lists-page").value+'"'}e.appendChild(BX.create("span",{attrs:{"data-name":d.permissions[c],"data-picture-small":"","data-key":c,"data-onclick":f},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}}o=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists-default"},true)}s=l(o);i=i.concat(s);a(i)}else{e.appendChild(BX.create("span",{attrs:{"data-name":d.error,"data-picture-small":""},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}));t=BX.findChildren(e,{tag:"span",className:"feed-add-post-form-link-lists-default"},true);i=n(t,0);a(i)}})})}},isTaskTabLoaded:function(){var e=BX("feed-add-post-content-tasks-container");return e&&e.children.length},getTaskForm:function(){var e=BX("feed-add-post-form-tab-tasks")&&BX("feed-add-post-form-tab-tasks").style.display!="none"?BX("feed-add-post-form-tab-tasks"):BX("feed-add-post-form-link-more"),t=BX("feed-add-post-content-tasks"),o=BX("feed-add-post-content-tasks-container");if(o&&o.innerHTML.length<=0&&!this.clickDisabled){this.clickDisabled=true;window.SBPEFullForm.getInstance().showWait(o);this.startAnimation();var s={GROUP_ID:BX.message("TASK_SOCNET_GROUP_ID"),PATH_TO_USER_TASKS:BX.message("PATH_TO_USER_TASKS"),PATH_TO_USER_TASKS_TASK:BX.message("PATH_TO_USER_TASKS_TASK"),PATH_TO_GROUP_TASKS:BX.message("PATH_TO_GROUP_TASKS"),PATH_TO_GROUP_TASKS_TASK:BX.message("PATH_TO_GROUP_TASKS_TASK"),PATH_TO_USER_PROFILE:BX.message("PATH_TO_USER_PROFILE"),PATH_TO_GROUP:BX.message("PATH_TO_GROUP"),PATH_TO_USER_TASKS_PROJECTS_OVERVIEW:BX.message("PATH_TO_USER_TASKS_PROJECTS_OVERVIEW"),PATH_TO_USER_TASKS_TEMPLATES:BX.message("PATH_TO_USER_TASKS_TEMPLATES"),PATH_TO_USER_TEMPLATES_TEMPLATE:BX.message("PATH_TO_USER_TEMPLATES_TEMPLATE"),ENABLE_FOOTER:"N",TEMPLATE_CONTROLLER_ID:"lifefeed_task_form",ENABLE_FORM:"N",BACKURL:BX.message("TASK_SUBMIT_BACKURL")};BX.Tasks.Util.Query.runOnce("ui.task.edit",{parameters:{COMPONENT_PARAMETERS:s}}).then(BX.proxy(function(e){if(e.isSuccess()){BX.html(o,e.getData());BX.adjust(t,{style:{display:"block"}});return true}else{this.closeWait(o);this.endAnimation();throw new Error}},this),BX.proxy(function(e){this.closeWait(o);this.endAnimation();throw new Error},this)).then(BX.proxy(function(){this.clickDisabled=false;this.closeWait(o);this.endAnimation()},this))}else{this.startAnimation();this.endAnimation()}BX.onCustomEvent(BX("lifefeed_task_form"),"OnShowLHE",["justShow"])},closeWait:function(e){obMsg=e.bxmsg;if(obMsg&&obMsg.parentNode){for(var t=0,o=this.lastWait.length;t<o;t++){if(obMsg==this.lastWait[t]){this.lastWait=BX.util.deleteFromArray(this.lastWait,t);break}}obMsg.parentNode.removeChild(obMsg);if(e)e.bxmsg=null;BX.cleanNode(obMsg,true)}},getMenuItems:function(e,t){var o=[];for(var s=0;s<e.length;s++){var i=e[s].getAttribute("id").replace("feed-add-post-form-tab-","");if(t){o.push({tabId:i,text:BX.util.htmlspecialchars(e[s].getAttribute("data-name")),className:"feed-add-post-form-"+i+"feed-add-post-form-"+i+"-item",onclick:t(i,[e[s].getAttribute("iblockId"),e[s].getAttribute("data-name"),e[s].getAttribute("data-description"),e[s].getAttribute("data-picture"),e[s].getAttribute("data-code")])})}else{o.push({tabId:i,text:e[s].getAttribute("data-name"),className:"feed-add-post-form-"+i,onclick:""})}}return o},getMenuItemsDefault:function(e){var t=[];for(var o=0;o<e.length;o++){t.push({text:BX.util.htmlspecialchars(e[o].getAttribute("data-name")),className:"feed-add-post-form-lists-default-"+e[o].getAttribute("data-key"),onclick:e[o].getAttribute("data-onclick")})}return t},showMoreMenuLists:function(e){var t=BX("feed-add-post-form-tab-lists").style.display!="none"?BX("feed-add-post-form-tab-lists"):BX("feed-add-post-form-link-more");var o=BX.PopupMenu.create("lists",t,e,{closeByEsc:true,offsetTop:5,offsetLeft:12,angle:true});var s=BX.findChildren(BX("popup-window-content-menu-popup-lists"),{tag:"span",className:"menu-popup-item-icon"},true),i=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists"},true),a=BX.findChildren(t,{tag:"span",className:"feed-add-post-form-link-lists-default"},true);i=i.concat(a);for(var n=0;n<s.length;n++){if(i[n].getAttribute("data-picture-small")){s[n].innerHTML=i[n].getAttribute("data-picture-small")}}o.popupWindow.show()},createOnclickLists:function(e,t){return function(){window.SBPETabs.changePostFormTab(e,t);this.popupWindow.close()}}};window.BXfpGratSelectCallback=function(e){BXfpGratMedalSelectCallback(e,"grat")};window.BXfpMedalSelectCallback=function(e){BXfpGratMedalSelectCallback(e,"medal")};window.BXfpGratMedalSelectCallback=function(e,t){if(t!="grat")t="medal";var o="U";BX("feed-add-post-"+t+"-item").appendChild(BX.create("span",{attrs:{"data-id":e.id},props:{className:"feed-add-post-"+t+" feed-add-post-destination-users"},children:[BX.create("input",{attrs:{type:"hidden",name:(t=="grat"?"GRAT":"MEDAL")+"["+o+"][]",value:e.id}}),BX.create("span",{props:{className:"feed-add-post-"+t+"-text"},html:e.name}),BX.create("span",{props:{className:"feed-add-post-del-but"},events:{click:function(t){BX.SocNetLogDestination.deleteItem(e.id,"users",window["BXSocNetLogGratFormName"]);BX.PreventDefault(t)},mouseover:function(){BX.addClass(this.parentNode,"feed-add-post-"+t+"-hover")},mouseout:function(){BX.removeClass(this.parentNode,"feed-add-post-"+t+"-hover")}}})]}));BX("feed-add-post-"+t+"-input").value="";BX.SocNetLogDestination.BXfpSetLinkName({formName:t=="grat"?window["BXSocNetLogGratFormName"]:window["BXSocNetLogMedalFormName"],tagInputName:"bx-"+t+"-tag",tagLink1:BX.message("BX_FPGRATMEDAL_LINK_1"),tagLink2:BX.message("BX_FPGRATMEDAL_LINK_2")})};if(!!BX.SocNetGratSelector)return;BX.SocNetGratSelector={popupWindow:null,obWindowCloseIcon:{},sendEvent:true,obCallback:{},gratsContentElement:null,itemSelectedImageItem:{},itemSelectedInput:{},searchTimeout:null,obDepartmentEnable:{},obSonetgroupsEnable:{},obLastEnable:{},obWindowClass:{},obPathToAjax:{},obDepartmentLoad:{},obDepartmentSelectDisable:{},obItems:{},obItemsLast:{},obItemsSelected:{},obElementSearchInput:{},obElementBindMainPopup:{},obElementBindSearchPopup:{}};BX.SocNetGratSelector.init=function(e){if(!e.name)e.name="lm";BX.SocNetGratSelector.obCallback[e.name]=e.callback;BX.SocNetGratSelector.obWindowCloseIcon[e.name]=typeof e.obWindowCloseIcon=="undefined"?true:e.obWindowCloseIcon;BX.SocNetGratSelector.itemSelectedImageItem[e.name]=e.itemSelectedImageItem;BX.SocNetGratSelector.itemSelectedInput[e.name]=e.itemSelectedInput};BX.SocNetGratSelector.openDialog=function(e){if(!e)e="lm";if(BX.SocNetGratSelector.popupWindow!=null){BX.SocNetGratSelector.popupWindow.close();return false}var t=[];for(var o=0;o<arGrats.length;o++){t[t.length]=BX.create("span",{props:{className:"feed-add-grat-box "+arGrats[o].style},attrs:{title:arGrats[o].title},events:{click:BX.delegate(function(t){BX.SocNetGratSelector.selectItem(e,this.code,this.style,this.title);BX.PreventDefault(t)},arGrats[o])}})}var s=[];var i=1;for(o=0;o<t.length;o++){if(o>=t.length/2)i=2;if(s[i]==null||s[i]=="undefined")s[i]=BX.create("div",{props:{className:"feed-add-grat-list-row"}});s[i].appendChild(t[o])}BX.SocNetGratSelector.gratsContentElement=BX.create("div",{children:[BX.create("div",{props:{className:"feed-add-grat-list-title"},html:BX.message("BLOG_GRAT_POPUP_TITLE")}),BX.create("div",{props:{className:"feed-add-grat-list"},children:s})]});BX.SocNetGratSelector.popupWindow=new BX.PopupWindow("BXSocNetGratSelector",BX("feed-add-post-grat-type-selected"),{autoHide:true,offsetLeft:25,bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:BX.SocNetGratSelector.obWindowCloseIcon[e]?{top:"5px",right:"10px"}:false,events:{onPopupShow:function(){if(BX.SocNetGratSelector.sendEvent&&BX.SocNetGratSelector.obCallback[e]&&BX.SocNetGratSelector.obCallback[e].openDialog)BX.SocNetGratSelector.obCallback[e].openDialog()},onPopupClose:function(){this.destroy()},onPopupDestroy:BX.proxy(function(){BX.SocNetGratSelector.popupWindow=null;if(BX.SocNetGratSelector.sendEvent&&BX.SocNetGratSelector.obCallback[e]&&BX.SocNetGratSelector.obCallback[e].closeDialog)BX.SocNetGratSelector.obCallback[e].closeDialog()},this)},content:BX.SocNetGratSelector.gratsContentElement,angle:{position:"bottom",offset:20},lightShadow:true});BX.SocNetGratSelector.popupWindow.setAngle({});BX.SocNetGratSelector.popupWindow.show();return true};BX.SocNetGratSelector.selectItem=function(e,t,o,s){var i=BX.findChild(BX.SocNetGratSelector.itemSelectedImageItem[e],{tag:"span"},false,false);if(typeof i!="undefined"&&i){i.className="feed-add-grat-box "+o}BX.SocNetGratSelector.itemSelectedImageItem[e].title=s;BX.SocNetGratSelector.itemSelectedInput[e].value=t;BX.SocNetGratSelector.popupWindow.close()};var e=function(e,t){var o="blogPostForm",s=BX(o),i="POST_TITLE",a=BX(i),n=BX(o).TAGS,l=function(e){BX.bind(a,"keydown",BX.proxy(e.Init,e));BX.bind(n,"keydown",BX.proxy(e.Init,e))};if(!s)return;t=typeof t!="undefined"?!!t:true;BX.addCustomEvent(s,"onAutoSavePrepare",function(e){e.DISABLE_STANDARD_NOTIFY=true;var t=e;setTimeout(function(){l(t)},100)});BX.addCustomEvent(s,"onAutoSave",function(e,t){t["TAGS"]=BX(o).TAGS.value;delete t["POST_MESSAGE"]});if(e=="Y"){BX.addCustomEvent(s,"onAutoSaveRestoreFound",function(e,t){var s=BX.util.trim(t["text"+o])||"",a=BX.util.trim(t[i])||"";if(s.length<1&&a.length<1)return;e.Restore()})}else{BX.addCustomEvent(s,"onAutoSaveRestoreFound",BX.delegate(function(e,t){var s=BX.util.trim(t["text"+o])||"",a=BX.util.trim(t[i])||"";if(s.length<1&&a.length<1)return;var n=BX("microoPostFormLHE_blogPostForm"),l=BX.create("DIV",{attrs:{className:"feed-add-successfully"},children:[BX.create("SPAN",{attrs:{className:"feed-add-info-icon"}}),BX.create("A",{attrs:{className:"feed-add-info-text",href:"#"},events:{click:function(){e.Restore();l.parentNode.removeChild(l);return false}},text:BX.message("BLOG_POST_AUTOSAVE2")})]});if(n){n.parentNode.insertBefore(l,n)}},this))}if(t){BX.addCustomEvent(s,"onAutoSaveRestore",function(e,t){BX(i).value=t[i];if(t[i].length>0&&t[i]!=BX(i).getAttribute("placeholder")){if(BX("divoPostFormLHE_blogPostForm").style.display!="none")window["showPanelTitle_"+o](true);else window["bShowTitle"]=true;if(!!BX(i).__onchange)BX(i).__onchange()}var s=window["BXPostFormTags_"+o];if(t["TAGS"].length>0&&s){var a=s.addTag(t["TAGS"]);if(a.length>0){BX.show(s.tagsArea)}}if(BX.SocNetLogDestination){var n;if(t["SPERM[DR][]"]){for(n=0;n<t["SPERM[DR][]"].length;n++){BX.SocNetLogDestination.selectItem(BXSocNetLogDestinationFormName,"",3,t["SPERM[DR][]"][n],"department",false)}}if(t["SPERM[SG][]"]){for(n=0;n<t["SPERM[SG][]"].length;n++){BX.SocNetLogDestination.selectItem(BXSocNetLogDestinationFormName,"",3,t["SPERM[SG][]"][n],"sonetgroups",false)}}if(t["SPERM[U][]"]){for(n=0;n<t["SPERM[U][]"].length;n++){BX.SocNetLogDestination.selectItem(BXSocNetLogDestinationFormName,"",3,t["SPERM[U][]"][n],"users",false)}}if(!t["SPERM[UA][]"]){BX.SocNetLogDestination.deleteItem("UA","groups",BXSocNetLogDestinationFormName)}}l(e)})}},t={},o=function(e){if(t[e]&&t[e]["editorID"]){if(t[e]["editor"])t[e]["editor"](t[e]["text"]);else setTimeout(function(){o(e)},50)}};BX.SocnetBlogPostInit=function(s,i){t[s]={editorID:i["editorID"],showTitle:!!i["showTitle"],submitted:false,text:i["text"],autoSave:i["autoSave"],handler:LHEPostForm&&LHEPostForm.getHandler(i["editorID"]),editor:LHEPostForm&&LHEPostForm.getEditor(i["editorID"]),restoreAutosave:!!i["restoreAutosave"]};window["showPanelTitle_"+s]=function(e,o){e=e===true||e===false?e:BX("blog-title").style.display=="none";o=o!==false;var i=t[s]["showTitle"],a=BX("lhe_button_title_"+s),n=BX("feed-add-post-block"+s),l=BX("show_title")||{};if(e){BX.show(BX("blog-title"));BX.focus(BX("POST_TITLE"));t[s]["showTitle"]=true;l.value="Y";if(a){BX.addClass(a,"feed-add-post-form-btn-active")}if(n){BX.addClass(n,"blog-post-edit-open")}}else{BX.hide(BX("blog-title"));t[s]["showTitle"]=false;l.value="N";if(a)BX.removeClass(a,"feed-add-post-form-btn-active")}if(o)BX.userOptions.save("socialnetwork","postEdit","showTitle",t[s]["showTitle"]?"Y":"N");else t[s]["showTitle"]=i};window["setBlogPostFormSubmitted"]=function(e){if(BX("blog-submit-button-save")){if(e){BX.addClass(BX("blog-submit-button-save"),"ui-btn-clock")}else{BX.removeClass(BX("blog-submit-button-save"),"ui-btn-clock")}}t[s]["submitted"]=e};window["submitBlogPostForm"]=function(e,o){if(typeof e!="object"){o=e;e=LHEPostForm.getEditor(t[s]["editorID"])}if(e&&e.id==t[s]["editorID"]){if(t[s]["submitted"])return false;e.SaveContent();if(!o){o="save"}if(BX("blog-title").style.display=="none"){BX("POST_TITLE").value=""}if(o=="save"&&BX("blog-submit-button-save")){BX.addClass(BX("blog-submit-button-save"),"ui-btn-clock");BX.addClass(BX("blog-submit-button-save"),"ui-btn-disabled");BX("blog-submit-button-save").disabled=true}if(o=="draft"&&BX("blog-submit-button-draft")){BX.addClass(BX("blog-submit-button-draft"),"ui-btn-clock");BX.addClass(BX("blog-submit-button-draft"),"ui-btn-disabled");BX("blog-submit-button-draft").disabled=true}BX.submit(BX(s),o);t[s]["submitted"]=true}};var a=function(e,o){if(o==s){t[s]["handler"]=e;BX.addCustomEvent(e.eventNode,"OnControlClick",function(){window.SBPETabs.changePostFormTab("message")});var i=function(){var e=[BX("feed-add-post-form-notice-blockblogPostForm"),BX("feed-add-buttons-blockblogPostForm"),BX("feed-add-post-content-message-add-ins")];for(var o=0;o<e.length;o++){if(!!e[o]){BX.adjust(e[o],{style:{display:"block",height:"auto",opacity:1}})}}if(t[s]["showTitle"])window["showPanelTitle_"+s](true,false)},a=function(){var e,o=[BX("feed-add-post-form-notice-blockblogPostForm"),BX("feed-add-buttons-blockblogPostForm"),BX("feed-add-post-content-message-add-ins")];for(e=0;e<o.length;e++){if(!!o[e]){BX.adjust(o[e],{style:{display:"block",height:"0px",opacity:0}})}}if(t[s]["showTitle"])window["showPanelTitle_"+s](false,false)};BX.addCustomEvent(e.eventNode,"OnAfterShowLHE",i);BX.addCustomEvent(e.eventNode,"OnAfterHideLHE",a);if(e.eventNode.style.display=="none")a();else i()}},n=function(o){if(o.id==t[s]["editorID"]){t[s]["editor"]=o;if(t[s]["autoSave"]!="N")new e(t[s]["autoSave"],t[s]["restoreAutosave"]);var i=window[o.id+"Files"],a=LHEPostForm.getHandler(o.id),n,l,r,d=[],c=null;for(l in a["controllers"]){if(a["controllers"].hasOwnProperty(l)){if(a["controllers"][l]["parser"]&&a["controllers"][l]["parser"]["bxTag"]=="postimage"){c=a["controllers"][l];break}}}var f=function(e,t){return function(){e.insertFile(t)}},u=function(e,t,o){return function(){if(c){c.deleteFile(t,{});BX.remove(BX("wd-doc"+t));BX.ajax({method:"GET",url:o})}else{e.deleteFile(t,o,e,{controlID:"common"})}}};for(n in i){if(i.hasOwnProperty(n)){if(c){c.addFile(i[n])}else{l=a.checkFile(n,"common",i[n]);d.push(n);if(!!l&&BX("wd-doc"+n)&&!BX("wd-doc"+n).hasOwnProperty("bx-bound")){BX("wd-doc"+n).setAttribute("bx-bound","Y");if((r=BX.findChild(BX("wd-doc"+n),{className:"feed-add-img-wrap"},true,false))&&r){BX.bind(r,"click",f(a,l));r.style.cursor="pointer"}if((r=BX.findChild(BX("wd-doc"+n),{className:"feed-add-img-title"},true,false))&&r){BX.bind(r,"click",f(a,l));r.style.cursor="pointer"}if((r=BX.findChild(BX("wd-doc"+n),{className:"feed-add-post-del-but"},true,false))&&r){BX.bind(r,"click",u(a,n,i[n]["del_url"]));r.style.cursor="pointer"}}}if((r=BX.findChild(BX("wd-doc"+n),{className:"feed-add-post-del-but"},true,false))&&r){BX.bind(r,"click",u(a,n,i[n]["del_url"]));r.style.cursor="pointer"}}}if(d.length>0){o.SaveContent();var p=o.GetContent();p=p.replace(new RegExp("\\&\\#91\\;IMG ID=("+d.join("|")+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"[IMG ID=$1$2]");o.SetContent(p);o.Focus()}}};BX.addCustomEvent(window,"onInitialized",a);if(t[s]["handler"])a(t[s]["handler"],s);BX.addCustomEvent(window,"OnEditorInitedAfter",n);if(t[s]["editor"])n(t[s]["editor"]);BX.addCustomEvent(window,"onSocNetLogMoveBody",function(e){if(e=="sonet_log_microblog_container"){o(s)}});BX.ready(function(){if(BX.browser.IsIE()&&BX("POST_TITLE")){var e=function(e){if(!this.value||this.value==this.getAttribute("placeholder")){this.value=this.getAttribute("placeholder");BX.removeClass(this,"feed-add-post-inp-active")}};BX.bind(BX("POST_TITLE"),"blur",e);e.apply(BX("POST_TITLE"));BX("POST_TITLE").__onchange=BX.delegate(function(e){if(this.value==this.getAttribute("placeholder")){this.value=""}if(this.className.indexOf("feed-add-post-inp-active")<0){BX.addClass(this,"feed-add-post-inp-active")}},BX("POST_TITLE"));BX.bind(BX("POST_TITLE"),"click",BX("POST_TITLE").__onchange);BX.bind(BX("POST_TITLE"),"keydown",BX("POST_TITLE").__onchange);BX.bind(BX("POST_TITLE").form,"submit",function(){if(BX("POST_TITLE").value==BX("POST_TITLE").getAttribute("placeholder")){BX("POST_TITLE").value=""}})}if(i["activeTab"]!=="")window.SBPETabs.changePostFormTab(i["activeTab"])})}})();