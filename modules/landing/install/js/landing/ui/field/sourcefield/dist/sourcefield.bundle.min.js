this.BX=this.BX||{};this.BX.Landing=this.BX.Landing||{};this.BX.Landing.UI=this.BX.Landing.UI||{};(function(e,t,r,i,n){"use strict";function l(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var t=e;if(t===""){t=i.Loc.getMessage("LANDING_BLOCK__SOURCE_FILTER_STUB")}return{key:"filterStub",name:t,value:""}}function a(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";if(n.Type.isArray(e)){return e.reduce((function(e,r){if(n.Type.isPlainObject(r)&&n.Type.isString(r.name)&&n.Type.isString(r.value)){var i=n.Runtime.clone(r);if(!n.Type.isArray(i.filter)||i.filter.length<=0){i.filter=[n.Runtime.clone(l(t))]}if(!n.Type.isPlainObject(i.sort)||!n.Type.isArray(i.sort.items)){i.sort={items:[]}}return[].concat(babelHelpers.toConsumableArray(e),[i])}return e}),[])}return[]}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){babelHelpers.defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t){return e.reduce((function(e,r){if(n.Type.isPlainObject(r)){return[].concat(babelHelpers.toConsumableArray(e),[s(s({},r),{},{url:t.url})])}return e}),[])}function c(e,t){var r=babelHelpers.slicedToArray(t,1),i=r[0];if(!n.Type.isPlainObject(e)){return{source:i.value,filter:u(babelHelpers.toConsumableArray(i.filter),i),sort:{by:i.sort.items[0].key,order:"DESC"}}}var l=t.find((function(t){return t.value===e.source}));if(!n.Type.isArray(e.filter)||e.filter.length<=0){if(l){e.filter=babelHelpers.toConsumableArray(l.filter)}}e.filter=u(e.filter,l);if(!n.Type.isPlainObject(e.sort)){e.sort={}}if(!n.Type.isString(e.sort.by)){if(l){e.sort.by=l.sort.items[0].value}}if(!n.Type.isString(e.sort.order)){e.sort.order="DESC"}return e}var d,p,f,g,v,h;function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){babelHelpers.defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=function(e){babelHelpers.inherits(r,e);function r(e){var t;var i;babelHelpers.classCallCheck(this,r);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).call(this,e));n.Dom.addClass(i.layout,"landing-ui-field-source");i.items=a(e.items,e.stubText);i.value=c(e.value,i.items);i.cache=new n.Cache.MemoryCache;i.linkType=(t=e.linkType)!==null&&t!==void 0?t:"";i.onButtonClick=i.onButtonClick.bind(babelHelpers.assertThisInitialized(i));i.onMenuItemClick=i.onMenuItemClick.bind(babelHelpers.assertThisInitialized(i));i.onSliderMessage=i.onSliderMessage.bind(babelHelpers.assertThisInitialized(i));i.onPlaceholderRemoveClick=i.onPlaceholderRemoveClick.bind(babelHelpers.assertThisInitialized(i));i.onPlaceholderClick=i.onPlaceholderClick.bind(babelHelpers.assertThisInitialized(i));n.Dom.append(i.getGrid(),i.layout);if(!e.hideSort){n.Dom.append(i.getSortByField().layout,i.layout);n.Dom.append(i.getSortOrderField().layout,i.layout)}if(e.useLink){n.Dom.append(i.getLink(),i.layout)}if(e.showValueInHeader&&e.showValueInHeader!==false){n.Dom.append(i.getValueLayoutWrapper(),i.header)}i.setValue(i.value);window.top.BX.addCustomEvent("SidePanel.Slider:onMessage",i.onSliderMessage);return i}babelHelpers.createClass(r,[{key:"getItem",value:function e(t){return this.items.find((function(e){return e.value===t}))}},{key:"getButtonField",value:function e(){var t=this;return this.getMenuItems().length>1?this.cache.remember("buttonField",(function(){new BX.Landing.UI.Button.BaseButton("dropdown_button",{text:i.Loc.getMessage("LINK_URL_SUGGESTS_SELECT"),className:"landing-ui-button-select-link",onClick:t.onButtonClick})})):null}},{key:"getSortByField",value:function e(){var t=this;return this.cache.remember("sortByField",(function(){var e=t.getItem(t.value.source);return new BX.Landing.UI.Field.DropdownInline({title:i.Loc.getMessage("LANDING_CARDS__SOURCE_FIELD_SORT_TITLE").toLowerCase(),items:e.sort.items,content:t.value.sort.by})}))}},{key:"getSortOrderField",value:function e(){var t=this;return this.cache.remember("sortOrderField",(function(){return new BX.Landing.UI.Field.DropdownInline({title:", ",items:[{name:i.Loc.getMessage("LANDING_CARDS__SOURCE_FIELD_SORT_DESC"),value:"DESC"},{name:i.Loc.getMessage("LANDING_CARDS__SOURCE_FIELD_SORT_ASC"),value:"ASC"}],content:t.value.sort.order})}))}},{key:"getValueLayout",value:function e(){return this.cache.remember("valueLayout",(function(){return n.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(["<span></span>"])))}))}},{key:"getValueLayoutWrapper",value:function e(){var t=this;return this.cache.remember("valueLayoutWrapper",(function(){return n.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(["<span>&nbsp;(",")</span>"])),t.getValueLayout())}))}},{key:"getInput",value:function e(){return this.input}},{key:"getGrid",value:function e(){var t=this;return this.cache.remember("grid",(function(){var e;return n.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-field-source-grid">\n\t\t\t\t\t<div class="landing-ui-field-source-grid-left">','</div>\n\t\t\t\t\t<div class="landing-ui-field-source-grid-right">',"</div>\n\t\t\t\t</div>\n\t\t\t"])),t.getInput(),(e=t.getButtonField())===null||e===void 0?void 0:e.layout)}))}},{key:"onButtonClick",value:function e(){this.getMenu().show()}},{key:"onMenuItemClick",value:function e(t){var r=c({source:t.value},this.items);this.setValue(r);this.getMenu().close();this.openSourceFilterSlider(t.url)}},{key:"onPlaceholderClick",value:function e(t,r){r.preventDefault();this.openSourceFilterSlider(t.url)}},{key:"onPlaceholderRemoveClick",value:function e(t,r){r.preventDefault();r.stopPropagation();var i=r.currentTarget;if(n.Type.isDomNode(i)){var l=i.closest(".landing-ui-field-source-placeholder");if(l){n.Dom.remove(l)}if(this.getPlaceholders().length<=0){var a=c({source:this.getValue().source},this.items);this.prepareLink(a);this.value=a;this.setFilter(a.filter)}this.value.filter=this.getPlaceholders().map((function(e){return n.Dom.attr(e,"data-item")}))}}},{key:"onSliderMessage",value:function e(t){if(t.getEventId()==="save"){var r=b(b({},this.getValue()),{},{filter:t.getData().filter});var i=c(r,this.items);this.prepareLink(i);this.value=i;this.setFilter(i.filter)}}},{key:"openSourceFilterSlider",value:function e(r){if(n.Type.isString(r)){var i=t.Env.getInstance().getOptions().site_id;BX.SidePanel.Instance.open(r,{cacheable:false,requestMethod:"post",requestParams:{filter:this.getValue().filter,landingParams:{siteId:i}}})}}},{key:"getMenuItems",value:function e(){var t=this;return this.cache.remember("menuItems",(function(){return t.items.map((function(e){return{id:e.value,text:n.Text.encode(e.name),onclick:function r(){return t.onMenuItemClick(e)}}}))}))}},{key:"getMenu",value:function e(){var t=this;return this.cache.remember("menu",(function(){var e;var r=t.input.closest(".landing-ui-field-source");var i=new BX.PopupMenuWindow({id:"".concat(t.selector,"_").concat(n.Text.getRandom()),bindElement:(e=t.getButtonField())===null||e===void 0?void 0:e.layout,autoHide:true,items:t.getMenuItems(),className:"landing-ui-field-source-popup",events:{onPopupShow:function e(){var l;var a=n.Dom.getRelativePosition((l=t.getButtonField())===null||l===void 0?void 0:l.layout,r);var o=0;var s=a.bottom;requestAnimationFrame((function(){n.Dom.style(i.popupWindow.popupContainer,{top:"".concat(s,"px"),left:"auto",right:"".concat(o,"px")})}))}}});n.Dom.append(i.popupWindow.popupContainer,r);return i}))}},{key:"addPlaceholder",value:function e(t){var r=n.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="landing-ui-field-source-placeholder">\n\t\t\t\t<span class="landing-ui-field-source-placeholder-text">',"</span>\n\t\t\t</div>\n\t\t"])),n.Text.encode(t.name));n.Dom.attr(r,{"data-item":t,title:t.name});if(!t.url){n.Dom.addClass(r.firstElementChild,"landing-ui-field-source-placeholder-text-plain")}if(t.url){var i=n.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="landing-ui-field-source-placeholder-remove"></span>\n\t\t\t'])));n.Dom.append(i,r);n.Event.bind(r,"click",this.onPlaceholderClick.bind(this,t));n.Event.bind(i,"click",this.onPlaceholderRemoveClick.bind(this,t))}n.Dom.append(r,this.input)}},{key:"getPlaceholders",value:function e(){return babelHelpers.toConsumableArray(this.input.querySelectorAll(".landing-ui-field-source-placeholder"))}},{key:"setFilter",value:function e(t){var r=this;n.Dom.clean(this.getInput());t.forEach((function(e){r.addPlaceholder(e)}))}},{key:"setSource",value:function e(t){var r=t.value,i=t.name;var l=this.getValueLayout();n.Dom.attr(l,"data-value",r);l.innerText=i}},{key:"setSortByItems",value:function e(t){if(n.Type.isArray(t)){this.getSortByField().setItems(t)}}},{key:"setValue",value:function e(t,r){var i=c(t,this.items);var l=this.getItem(t.source);if(n.Type.isPlainObject(l)){if(i.source!==this.value.source||this.getPlaceholders().length<=0){this.value=n.Runtime.clone(i);this.setFilter(i.filter);this.setSource(l);var a=this.getSortByField();a.setItems(l.sort.items);a.setValue(i.sort.by);var o=this.getSortOrderField();o.setValue(i.sort.order);if(!r){this.onValueChangeHandler(this)}}}}},{key:"getValue",value:function e(){var t=n.Runtime.clone(this.value);t.filter=t.filter.filter((function(e){return e.key!==l().key})).map((function(e){Reflect.deleteProperty(e,"url");return e}));t.sort.by=this.getSortByField().getValue();t.sort.order=this.getSortOrderField().getValue();return t}},{key:"getCurrentSource",value:function e(){var t=this.getValue();return this.getItem(t.source)}},{key:"isDetailPageAllowed",value:function e(){var t=this.getCurrentSource();return!n.Type.isPlainObject(t)||!n.Type.isPlainObject(t.settings)||t.settings.detailPage!==false}},{key:"getLink",value:function e(){var t,r,i,l;var a="#";var o="";var s=(t=(r=this.value)===null||r===void 0?void 0:(i=r.filter)===null||i===void 0?void 0:(l=i[0])===null||l===void 0?void 0:l.value)!==null&&t!==void 0?t:null;if(this.linkType==="group"&&s&&s.startsWith("SG")){a="/workgroups/group/".concat(s.slice(2),"/");o='href="'.concat(a,'"')}return this.cache.remember("linkLayout",(function(){var e=BX.Landing.Loc.getMessage("LANDING_SOURCEFIELD_LINK_TEXT");return n.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="landing-ui-field-link-container">\n\t\t\t\t\t<a ',' target="_blank" class="landing-ui-field-link">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t"])),o,e)}))}},{key:"prepareLink",value:function e(t){var r=this.layout.querySelector(".landing-ui-field-link");if(r&&this.linkType==="group"){var i,n,l;var a=(i=t===null||t===void 0?void 0:(n=t.filter)===null||n===void 0?void 0:(l=n[0])===null||l===void 0?void 0:l.value)!==null&&i!==void 0?i:null;if(a!==null&&a.startsWith("SG")){r.href="/workgroups/group/".concat(a.slice(2),"/")}else{r.removeAttribute("href")}}}}]);return r}(r.BaseField);e.SourceField=m})(this.BX.Landing.UI.Field=this.BX.Landing.UI.Field||{},BX.Landing,BX.Landing.UI.Field,BX.Landing,BX);
//# sourceMappingURL=sourcefield.bundle.map.js