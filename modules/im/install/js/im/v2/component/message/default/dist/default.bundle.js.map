{"version":3,"file":"default.bundle.js","sources":["../src/components/reply.js","../src/default.js"],"sourcesContent":["import { Type } from 'main.core';\n\nimport { Parser } from 'im.v2.lib.parser';\n\nimport type { ImModelChat, ImModelMessage, ImModelUser } from 'im.v2.model';\n\nconst NO_CONTEXT_TAG = 'none';\n\n// @vue/component\nexport const Reply = {\n\tname: 'ReplyComponent',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\treplyId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tisForward: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\treplyMessage(): ?ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.replyId);\n\t\t},\n\t\treplyMessageChat(): ?ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/getByChatId'](this.replyMessage?.chatId);\n\t\t},\n\t\treplyAuthor(): ?ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.replyMessage.authorId);\n\t\t},\n\t\treplyTitle(): string\n\t\t{\n\t\t\treturn this.replyAuthor ? this.replyAuthor.name : this.loc('IM_DIALOG_CHAT_QUOTE_DEFAULT_TITLE');\n\t\t},\n\t\treplyText(): string\n\t\t{\n\t\t\tlet text = Parser.prepareQuote(this.replyMessage);\n\t\t\ttext = Parser.decodeText(text);\n\n\t\t\treturn text;\n\t\t},\n\t\tisQuoteFromTheSameChat(): boolean\n\t\t{\n\t\t\treturn this.replyMessage?.chatId === this.dialog.chatId;\n\t\t},\n\t\treplyContext(): string\n\t\t{\n\t\t\tif (!this.isQuoteFromTheSameChat)\n\t\t\t{\n\t\t\t\treturn NO_CONTEXT_TAG;\n\t\t\t}\n\n\t\t\tif (!this.isForward)\n\t\t\t{\n\t\t\t\treturn `${this.dialogId}/${this.replyId}`;\n\t\t\t}\n\n\t\t\treturn `${this.replyMessageChat.dialogId}/${this.replyId}`;\n\t\t},\n\t\tcanShowReply(): boolean\n\t\t{\n\t\t\treturn !Type.isNil(this.replyMessage) && !Type.isNil(this.replyMessageChat);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"canShowReply\" class=\"bx-im-message-quote\" :data-context=\"replyContext\">\n\t\t\t<div class=\"bx-im-message-quote__wrap\">\n\t\t\t\t<div class=\"bx-im-message-quote__name\">\n\t\t\t\t\t<div class=\"bx-im-message-quote__name-text\">{{ replyTitle }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-message-quote__text\" v-html=\"replyText\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { DefaultMessageContent, MessageHeader, ReactionSelector, MessageKeyboard, MessageFooter } from 'im.v2.component.message.elements';\nimport { BaseMessage } from 'im.v2.component.message.base';\n\nimport { Reply } from './components/reply';\n\nimport './css/default.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const DefaultMessage = {\n\tname: 'DefaultMessage',\n\tcomponents: {\n\t\tMessageHeader,\n\t\tMessageFooter,\n\t\tBaseMessage,\n\t\tDefaultMessageContent,\n\t\tReactionSelector,\n\t\tReply,\n\t\tMessageKeyboard,\n\t},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tisReply(): boolean\n\t\t{\n\t\t\treturn this.message.replyId !== 0;\n\t\t},\n\t\tisForward(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/isForward'](this.message.id);\n\t\t},\n\t\thasKeyboard(): boolean\n\t\t{\n\t\t\treturn this.message.keyboard.length > 0;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BaseMessage :item=\"item\" :dialogId=\"dialogId\" :afterMessageWidthLimit=\"false\">\n\t\t\t<template #before-message v-if=\"$slots['before-message']\">\n\t\t\t\t<slot name=\"before-message\"></slot>\n\t\t\t</template>\n\t\t\t<div class=\"bx-im-message-default__container\">\n\t\t\t\t<MessageHeader :withTitle=\"withTitle\" :item=\"item\" />\n\t\t\t\t<Reply v-if=\"isReply\" :dialogId=\"dialogId\" :replyId=\"message.replyId\" :isForward=\"isForward\" />\n\t\t\t\t<DefaultMessageContent :item=\"item\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t\t<MessageFooter :item=\"item\" :dialogId=\"dialogId\" />\n\t\t\t<template #after-message v-if=\"hasKeyboard\">\n\t\t\t\t<MessageKeyboard :item=\"item\" :dialogId=\"dialogId\" />\n\t\t\t</template>\n\t\t</BaseMessage>\n\t`,\n};\n"],"names":["NO_CONTEXT_TAG","Reply","name","props","dialogId","type","String","required","replyId","Number","isForward","Boolean","default","computed","dialog","$store","getters","replyMessage","replyMessageChat","chatId","replyAuthor","authorId","replyTitle","loc","replyText","text","Parser","prepareQuote","decodeText","isQuoteFromTheSameChat","replyContext","canShowReply","Type","isNil","methods","phraseCode","$Bitrix","Loc","getMessage","template","DefaultMessage","components","MessageHeader","MessageFooter","BaseMessage","DefaultMessageContent","ReactionSelector","MessageKeyboard","item","Object","withTitle","message","isReply","id","hasKeyboard","keyboard","length"],"mappings":"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"}