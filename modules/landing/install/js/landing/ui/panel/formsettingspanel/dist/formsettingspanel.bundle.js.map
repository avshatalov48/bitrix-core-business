{"version":3,"file":"formsettingspanel.bundle.js","sources":["../src/formsettingspanel.js"],"sourcesContent":["import {BasePresetPanel, Preset, ContentWrapper, PresetCategory} from 'landing.ui.panel.basepresetpanel';\nimport {PageObject} from 'landing.pageobject';\nimport {Loc} from 'landing.loc';\nimport {Dom, Reflection, Runtime, Tag, Text, Type, Uri, Cache, Event} from 'main.core';\nimport type {BaseEvent} from 'main.core.events';\nimport {Backend} from 'landing.backend';\nimport {Loader} from 'main.loader';\nimport {FormClient} from 'crm.form.client';\nimport {Button} from 'ui.buttons';\nimport {Env} from 'landing.env';\nimport {StylePanel} from 'landing.ui.panel.stylepanel';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport type {FormDictionary, FormOptions} from 'crm.form.type';\nimport {Alert, AlertColor} from 'ui.alerts';\nimport {SidebarButton} from 'landing.ui.button.sidebarbutton';\nimport {Guide} from 'ui.tour';\nimport {FieldsPanel} from 'landing.ui.panel.fieldspanel';\nimport {PhoneVerify} from 'bitrix24.phoneverify'\nimport 'ui.switcher';\nimport 'ui.hint';\n\nimport 'ui.fonts.opensans';\nimport './css/style.css';\nimport {History} from 'landing.history';\n\ntype CrmField = {\n\ttype: 'list' | 'string' | 'checkbox' | 'date' | 'text' | 'typed_string' | 'file',\n\tentity_field_name: string,\n\tentity_name: string,\n\tname: string,\n\tcaption: string,\n\tmultiple: boolean,\n\trequired: boolean,\n\thidden: boolean,\n\titems: Array<{ID: any, VALUE: any}>,\n};\n\ntype CrmFieldsList = {\n\t[categoryId: string]: {\n\t\tCAPTION: string,\n\t\tFIELDS: Array<CrmField>\n\t},\n};\n\ntype CrmCompany = {\n\tID: string,\n\tTITLE: string,\n};\n\ntype CrmCategory = {\n\n};\n\ntype ResponseErrors = Array<{\n\tcode: string,\n\tmessage: string,\n\tcustomData: any\n}>;\n\nconst PHONE_VERIFY_FORM_ENTITY = 'crm_webform';\n\n/**\n * @memberOf BX.Landing.UI.Panel\n */\nexport class FormSettingsPanel extends BasePresetPanel\n{\n\tstatic getInstance(): FormSettingsPanel\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tconst rootWindowPanel = rootWindow.BX.Landing.UI.Panel.FormSettingsPanel;\n\t\tif (!rootWindowPanel.instance && !FormSettingsPanel.instance)\n\t\t{\n\t\t\trootWindowPanel.instance = new FormSettingsPanel();\n\t\t}\n\n\t\treturn (rootWindowPanel.instance || FormSettingsPanel.instance);\n\t}\n\n\tadjustActionsPanels = false;\n\t#phoneDoesntVerifiedResponseCode = 'PHONE_NOT_VERIFIED';\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel');\n\t\tthis.setTitle(Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_TITLE'));\n\n\t\tthis.lsCache = new Cache.LocalStorageCache();\n\n\t\tDom.addClass(this.layout, 'landing-ui-panel-form-settings');\n\n\t\tthis.subscribe('onCancel', () => {\n\t\t\tBX.onCustomEvent(this, 'BX.Landing.Block:onFormSettingsClose', [this.getCurrentBlock().id]);\n\t\t});\n\n\t\tthis.disableOverlay();\n\n\t\tif (this.isCrmFormPage())\n\t\t{\n\t\t\tconst {dictionary} = Env.getInstance().getOptions().formEditorData;\n\n\t\t\tconst preparedSidebarButtons = dictionary.sidebarButtons.map((buttonOptions) => {\n\t\t\t\treturn new SidebarButton({...buttonOptions, child: true});\n\t\t\t});\n\t\t\tthis.setSidebarButtons(preparedSidebarButtons);\n\n\t\t\tconst preparedPresets = dictionary.scenarios.map((presetOptions) => {\n\t\t\t\treturn new Preset(presetOptions);\n\t\t\t});\n\t\t\tthis.setPresets(preparedPresets);\n\n\t\t\tconst preparedPresetCategories = dictionary.scenarioCategories.map((categoryOptions) => {\n\t\t\t\treturn new PresetCategory(categoryOptions);\n\t\t\t});\n\t\t\tthis.setCategories(preparedPresetCategories);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(this.getBlockSettingsButton().render(), this.getRightHeaderControls());\n\t\t}\n\n\t\tthis.subscribe('onCancel', this.onCancelClick.bind(this));\n\n\t\tDom.append(this.getExpertSwitcherLayout(), this.layout);\n\t}\n\n\tgetExpertSwitcherLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('switcherLayout', () => {\n\t\t\tconst onClick = () => {\n\t\t\t\tthis.getExpertModeSwitcher().node.click();\n\t\t\t};\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-expert-switcher\">\n\t\t\t\t\t${this.getExpertModeSwitcher().node}\n\t\t\t\t\t<span onclick=\"${onClick}\" class=\"landing-ui-expert-switcher-label\">\n\t\t\t\t\t\t${Loc.getMessage('LANDING_FORM_EXPERT_MODE_SWITCHER_LABEL')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetExpertModeSwitcher(): Switcher\n\t{\n\t\treturn this.cache.remember('expertModeSwitcher', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\tconst switcher = new rootWindow.BX.UI.Switcher({\n\t\t\t\tchecked: this.isExpertModeEnabled(),\n\t\t\t});\n\n\t\t\tDom.addClass(switcher.node, 'ui-switcher-size-sm ui-switcher-color-green');\n\n\t\t\tEvent.bind(switcher.node, 'click', this.onExpertSwitcherClick.bind(this));\n\n\t\t\treturn switcher;\n\t\t});\n\t}\n\n\tonExpertSwitcherClick()\n\t{\n\t\tthis.lsCache.set('formEditorExpertMode', this.getExpertModeSwitcher().isChecked());\n\t\tthis.onExpertModeChange();\n\t}\n\n\tgetCurrentPreset(): ?Preset\n\t{\n\t\tconst {templateId} = this.getFormOptions();\n\t\tconst preset = this.getPresets().find((currentPreset) => {\n\t\t\treturn currentPreset.options.id === templateId;\n\t\t});\n\n\t\tif (preset)\n\t\t{\n\t\t\treturn preset;\n\t\t}\n\n\t\treturn this.getPresets().find((currentPreset) => {\n\t\t\treturn currentPreset.options.id === 'expert';\n\t\t});\n\t}\n\n\tonExpertModeChange()\n\t{\n\t\tconst currentPreset = this.getCurrentPreset();\n\n\t\tif (\n\t\t\tthis.getExpertModeSwitcher().isChecked()\n\t\t\t&& Type.isArrayFilled(currentPreset.options.expertModeItems)\n\t\t)\n\t\t{\n\t\t\tthis.clearSidebar();\n\t\t\tthis.getSidebarButtons()\n\t\t\t\t.filter((button) => {\n\t\t\t\t\treturn currentPreset.options.expertModeItems.includes(button.id);\n\t\t\t\t})\n\t\t\t\t.forEach((button) => {\n\t\t\t\t\tif (!currentPreset.options.items.includes(button.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tbutton.deactivate();\n\t\t\t\t\t}\n\t\t\t\t\tthis.appendSidebarButton(button);\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentSidebarButton = this.getSidebarButtons().find((button) => {\n\t\t\t\treturn button.isActive();\n\t\t\t});\n\n\t\t\tconst buttons = this.getSidebarButtons().filter((button) => {\n\t\t\t\treturn currentPreset.options.items.includes(button.id);\n\t\t\t});\n\n\t\t\tthis.clearSidebar();\n\t\t\tbuttons.forEach((button) => {\n\t\t\t\tthis.appendSidebarButton(button);\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\tcurrentSidebarButton\n\t\t\t\t&& !currentPreset.options.items.includes(currentSidebarButton.id)\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst defaultSection = (() => {\n\t\t\t\t\tif (Type.isStringFilled(currentPreset.options.defaultSection))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn currentPreset.options.defaultSection;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn 'fields';\n\t\t\t\t})();\n\n\t\t\t\tconst defaultSectionButton = this.getSidebarButtons().find((button) => {\n\t\t\t\t\treturn button.id === defaultSection;\n\t\t\t\t});\n\n\t\t\t\tif (defaultSectionButton)\n\t\t\t\t{\n\t\t\t\t\tdefaultSectionButton.getLayout().click();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tisExpertModeEnabled(): boolean\n\t{\n\t\treturn this.lsCache.get('formEditorExpertMode', false);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tisCrmFormPage(): boolean\n\t{\n\t\treturn Env.getInstance().getOptions().specialType === 'crm_forms';\n\t}\n\n\tgetFormDesignButton()\n\t{\n\t\treturn this.cache.remember('formDesignButton', () => {\n\t\t\treturn new Button({\n\t\t\t\ttext: Loc.getMessage('LANDING_FORM_DESIGN_BUTTON'),\n\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\tround: true,\n\t\t\t\tclassName: 'landing-ui-panel-top-button',\n\t\t\t\tonclick: this.onFormDesignButtonClick.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetBlockSettingsButton()\n\t{\n\t\treturn this.cache.remember('blockSettingsButton', () => {\n\t\t\treturn new Button({\n\t\t\t\ttext: Loc.getMessage('LANDING_FORM_SETTINGS_BLOCK_SETTINGS_BUTTON_TEXT'),\n\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\tround: true,\n\t\t\t\tclassName: 'landing-ui-panel-top-button',\n\t\t\t\tonclick: this.onBlockSettingsButtonClick.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tonBlockSettingsButtonClick()\n\t{\n\t\tif (this.getCurrentBlock())\n\t\t{\n\t\t\tthis.hide()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.getCurrentBlock().showContentPanel();\n\t\t\t\t});\n\t\t}\n\t}\n\n\tonFormDesignButtonClick()\n\t{\n\t\tif (this.getCurrentBlock())\n\t\t{\n\t\t\tthis.getCurrentBlock().onFormDesignClick();\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\treturn this.cache.remember('loader', () => {\n\t\t\treturn new Loader({\n\t\t\t\ttarget: this.body,\n\t\t\t});\n\t\t});\n\t}\n\n\tshowLoader()\n\t{\n\t\tDom.addClass(this.layout, 'landing-ui-panel-state-content-load');\n\t\tvoid this.getLoader().show();\n\t\tDom.hide(this.sidebar);\n\t\tDom.hide(this.content);\n\t\tDom.hide(this.getExpertSwitcherLayout());\n\t}\n\n\thideLoader()\n\t{\n\t\tDom.removeClass(this.layout, 'landing-ui-panel-state-content-load');\n\t\tthis.getLoader().hide();\n\t\tDom.show(this.sidebar);\n\t\tDom.show(this.content);\n\n\t\tif (Type.isArrayFilled(this.getCurrentPreset().options.expertModeItems))\n\t\t{\n\t\t\tDom.show(this.getExpertSwitcherLayout());\n\t\t}\n\t}\n\n\tshowContentLoader()\n\t{\n\t\tDom.addClass(this.layout, 'landing-ui-panel-state-body-load');\n\t\tsuper.showContentLoader();\n\t}\n\n\thideContentLoader()\n\t{\n\t\tDom.removeClass(this.layout, 'landing-ui-panel-state-body-load');\n\t\tsuper.hideContentLoader();\n\t}\n\n\tload(options = {}): Promise<any>\n\t{\n\t\tif (options.showWithOptions)\n\t\t{\n\t\t\tconst editorData = Env.getInstance().getOptions().formEditorData;\n\t\t\tconst {dictionary} = editorData;\n\n\t\t\tconst preparedSidebarButtons = dictionary.sidebarButtons.map((buttonOptions) => {\n\t\t\t\treturn new SidebarButton({...buttonOptions, child: true});\n\t\t\t});\n\t\t\tthis.setSidebarButtons(preparedSidebarButtons);\n\n\t\t\tconst preparedPresets = dictionary.scenarios.map((presetOptions) => {\n\t\t\t\treturn new Preset(presetOptions);\n\t\t\t});\n\t\t\tthis.setPresets(preparedPresets);\n\n\t\t\tconst preparedPresetCategories = dictionary.scenarioCategories.map((categoryOptions) => {\n\t\t\t\treturn new PresetCategory(categoryOptions);\n\t\t\t});\n\t\t\tthis.setCategories(preparedPresetCategories);\n\n\t\t\tthis.setCrmFields(editorData.crmFields);\n\t\t\tthis.setCrmCompanies(editorData.crmCompanies);\n\t\t\tthis.setCrmCategories(editorData.crmCategories);\n\t\t\tthis.setAgreements(editorData.agreements);\n\n\t\t\tconst currentOptions = Runtime.clone(editorData.formOptions);\n\t\t\tif (currentOptions.agreements.use !== true)\n\t\t\t{\n\t\t\t\tcurrentOptions.agreements.use = true;\n\t\t\t\tcurrentOptions.data.agreements = [];\n\t\t\t}\n\n\t\t\tthis.setFormOptions(currentOptions);\n\t\t\tthis.setFormDictionary(editorData.dictionary);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst crmData = Backend.getInstance()\n\t\t\t.batch('Form::getCrmFields', {\n\t\t\t\tcrmFields: {\n\t\t\t\t\taction: 'Form::getCrmFields',\n\t\t\t\t\tdata: null,\n\t\t\t\t},\n\t\t\t\tcrmCompanies: {\n\t\t\t\t\taction: 'Form::getCrmCompanies',\n\t\t\t\t\tdata: null,\n\t\t\t\t},\n\t\t\t\tcrmCategories: {\n\t\t\t\t\taction: 'Form::getCrmCategories',\n\t\t\t\t\tdata: null,\n\t\t\t\t},\n\t\t\t\tagreements: {\n\t\t\t\t\taction: 'Form::getAgreements',\n\t\t\t\t\tdata: null,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((result) => {\n\t\t\t\tthis.setCrmFields(result.crmFields.result);\n\t\t\t\tthis.setCrmCompanies(result.crmCompanies.result);\n\t\t\t\tthis.setCrmCategories(result.crmCategories.result);\n\t\t\t\tthis.setAgreements(result.agreements.result);\n\t\t\t});\n\n\t\tconst formOptions = FormClient.getInstance()\n\t\t\t.getOptions(this.getCurrentFormId())\n\t\t\t.then((options) => {\n\t\t\t\tconst currentOptions = Runtime.clone(options);\n\t\t\t\tif (currentOptions.agreements.use !== true)\n\t\t\t\t{\n\t\t\t\t\tcurrentOptions.agreements.use = true;\n\t\t\t\t\tcurrentOptions.data.agreements = [];\n\t\t\t\t}\n\n\t\t\t\tthis.setFormOptions(currentOptions);\n\t\t\t});\n\n\t\tconst formDictionary = FormClient.getInstance()\n\t\t\t.getDictionary()\n\t\t\t.then((dictionary) => {\n\t\t\t\tthis.setFormDictionary(dictionary);\n\n\t\t\t\tconst preparedSidebarButtons = dictionary.sidebarButtons.map((buttonOptions) => {\n\t\t\t\t\treturn new SidebarButton({...buttonOptions, child: true});\n\t\t\t\t});\n\t\t\t\tthis.setSidebarButtons(preparedSidebarButtons);\n\n\t\t\t\tconst preparedPresets = dictionary.scenarios.map((presetOptions) => {\n\t\t\t\t\treturn new Preset(presetOptions);\n\t\t\t\t});\n\t\t\t\tthis.setPresets(preparedPresets);\n\n\t\t\t\tconst preparedPresetCategories = dictionary.scenarioCategories.map((categoryOptions) => {\n\t\t\t\t\treturn new PresetCategory(categoryOptions);\n\t\t\t\t});\n\t\t\t\tthis.setCategories(preparedPresetCategories);\n\t\t\t});\n\n\t\treturn Promise.all([\n\t\t\tcrmData,\n\t\t\tformOptions,\n\t\t\tformDictionary,\n\t\t]);\n\t}\n\n\tsetAgreements(agreements)\n\t{\n\t\tthis.cache.set('agreements', Runtime.orderBy(agreements, ['id'], ['asc']));\n\t}\n\n\tgetAgreements(): Array<{[key: string]: any}>\n\t{\n\t\treturn this.cache.get('agreements');\n\t}\n\n\tisLeadEnabled(): boolean\n\t{\n\t\treturn this.getFormDictionary().document.lead.enabled;\n\t}\n\n\tsetCurrentBlock(block: BX.Landing.Block)\n\t{\n\t\tthis.cache.set('currentBlock', block);\n\t}\n\n\tgetCurrentBlock(): ?BX.Landing.Block\n\t{\n\t\treturn this.cache.get('currentBlock');\n\t}\n\n\tgetSaveOriginalFileNameAlert(): HTMLElement\n\t{\n\t\treturn this.cache.remember('saveOriginalFileNameAlert', () => {\n\t\t\tconst alert = new Alert({\n\t\t\t\ttext: Loc.getMessage('LANDING_CRM_FORM_MAIN_OPTION_WARNING'),\n\t\t\t\tcolor: AlertColor.WARNING,\n\t\t\t});\n\n\t\t\treturn alert.render();\n\t\t});\n\t}\n\n\tshow(\n\t\toptions: {\n\t\t\tformId: number,\n\t\t\tinstanceId: number,\n\t\t\tstate?: 'presets',\n\t\t\tformOptions?: ?{[key: string]: any},\n\t\t\tshowWithOptions: true,\n\t\t} = {\n\t\t\tformOptions: {},\n\t\t},\n\t): Promise<any>\n\t{\n\t\tif (!this.layout.parentNode)\n\t\t{\n\t\t\tthis.enableToggleMode();\n\t\t}\n\n\t\tif (!this.isFormCreated())\n\t\t{\n\t\t\tthis.disableTransparentMode();\n\t\t}\n\n\t\tconst {mainOptions} = Env.getInstance().getOptions();\n\t\tif (mainOptions.saveOriginalFileName === false)\n\t\t{\n\t\t\tthis.prependContent(\n\t\t\t\tthis.getSaveOriginalFileNameAlert(),\n\t\t\t);\n\n\t\t\tconst closeButtonTop = Text.toNumber(Dom.style(this.closeButton.getLayout(), 'top'));\n\t\t\tconst alertHeight = this.getSaveOriginalFileNameAlert().getBoundingClientRect().height;\n\n\t\t\tDom.style(this.closeButton.getLayout(), 'top', `${closeButtonTop + alertHeight}px`);\n\t\t}\n\n\t\tthis.setCurrentBlock(options.block);\n\t\tthis.setCurrentFormId(options.formId);\n\t\tthis.setCurrentFormInstanceId(options.instanceId);\n\n\t\tthis.showLoader();\n\n\t\tthis.load(options)\n\t\t\t.then(() => {\n\t\t\t\tthis.hideLoader();\n\n\t\t\t\tconst formOptions = this.getFormOptions();\n\t\t\t\tif (Type.isPlainObject(options.formOptions))\n\t\t\t\t{\n\t\t\t\t\tconst formOptions = Runtime.merge(\n\t\t\t\t\t\tthis.getFormOptions(),\n\t\t\t\t\t\toptions.formOptions,\n\t\t\t\t\t);\n\t\t\t\t\tthis.setFormOptions(formOptions);\n\t\t\t\t}\n\n\t\t\t\tif (options.state === 'presets')\n\t\t\t\t{\n\t\t\t\t\tconst presetFromRequest = this.getPresetIdFromRequest();\n\t\t\t\t\tlet preset = false;\n\n\t\t\t\t\tif (presetFromRequest)\n\t\t\t\t\t{\n\t\t\t\t\t\tpreset = this.getPresets().find((item) => {\n\t\t\t\t\t\t\treturn item.options.id === presetFromRequest;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (preset)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.applyPreset(preset);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onPresetFieldClick();\n\t\t\t\t\t\tthis.activatePreset(formOptions.templateId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlet preset = this.getPresets().find((item) => {\n\t\t\t\t\t\treturn item.options.id === formOptions.templateId;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!preset)\n\t\t\t\t\t{\n\t\t\t\t\t\tpreset = this.getPresets().find((item) => {\n\t\t\t\t\t\t\treturn item.options.id === 'expert';\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isFormCreated())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.applyPreset(preset);\n\t\t\t\t\t\tthis.onPresetFieldClick();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.applyPreset(preset, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.setInitialFormOptions(\n\t\t\t\t\tRuntime.clone(this.getFormOptions()),\n\t\t\t\t);\n\n\t\t\t\tif (!this.isFormCreated())\n\t\t\t\t{\n\t\t\t\t\tthis.onExpertModeChange();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tif (Type.isArrayFilled(error))\n\t\t\t\t{\n\t\t\t\t\tconst accessDeniedCode = 510;\n\t\t\t\t\tconst isAccessDenied = error.some((errorItem) => {\n\t\t\t\t\t\treturn String(errorItem.code) === String(accessDeniedCode);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (isAccessDenied)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getLoader().hide();\n\t\t\t\t\t\tDom.show(this.sidebar);\n\t\t\t\t\t\tDom.show(this.content);\n\t\t\t\t\t\tDom.hide(this.footer);\n\t\t\t\t\t\tDom.append(this.getAccessError(), this.content);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\n\t\tconst editorWindow = PageObject.getEditorWindow();\n\t\tDom.addClass(editorWindow.document.body, 'landing-ui-hide-action-panels-form');\n\n\t\tvoid StylePanel.getInstance().hide();\n\n\t\tthis.disableHistory();\n\n\t\treturn super.show(options).then(() => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst y = this.getCurrentBlock().node.offsetTop;\n\t\t\t\tPageObject.getEditorWindow().scrollTo(0, y);\n\t\t\t}, 300);\n\n\t\t\tBX.onCustomEvent(this, 'BX.Landing.Block:onFormSettingsOpen', [this.getCurrentBlock().id]);\n\n\t\t\treturn Promise.resolve(true);\n\t\t});\n\t}\n\n\tgetHistoryHint(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('historyHint', () => {\n\t\t\tconst layout = Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"landing-ui-history-hint\"\n\t\t\t\t\tdata-hint=\"${Text.encode(Loc.getMessage('LANDING_FORM_HISTORY_DISABLED_HINT'))}\"\n\t\t\t\t\tdata-hint-no-icon\n\t\t\t\t></span>\n\t\t\t`;\n\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\trootWindow.BX.UI.Hint.initNode(layout);\n\n\t\t\treturn layout;\n\t\t});\n\t}\n\n\tdisableHistory()\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tconst TopPanel: BX.Landing.UI.Panel.Top = rootWindow.BX.Landing.UI.Panel.Top;\n\t\tif (TopPanel)\n\t\t{\n\t\t\tconst {undoButton, redoButton} = TopPanel.getInstance();\n\t\t\tDom.addClass(undoButton, 'landing-ui-disabled-from-form');\n\t\t\tDom.addClass(redoButton, 'landing-ui-disabled-from-form');\n\n\t\t\tDom.append(this.getHistoryHint(), undoButton.parentElement);\n\t\t}\n\t}\n\n\tenableHistory()\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tconst TopPanel: BX.Landing.UI.Panel.Top = rootWindow.BX.Landing.UI.Panel.Top;\n\t\tif (TopPanel)\n\t\t{\n\t\t\tconst {undoButton, redoButton} = TopPanel.getInstance();\n\t\t\tDom.removeClass(undoButton, 'landing-ui-disabled-from-form');\n\t\t\tDom.removeClass(redoButton, 'landing-ui-disabled-from-form');\n\t\t\tDom.remove(this.getHistoryHint());\n\t\t}\n\t}\n\n\tgetAccessError(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('accessErrorMessage', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-access-error-message\">\n\t\t\t\t\t<div class=\"landing-ui-access-error-message-text\">\n\t\t\t\t\t\t${Loc.getMessage('LANDING_CRM_ACCESS_ERROR_MESSAGE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tgetPresetIdFromRequest(): ?string\n\t{\n\t\tconst uri = new Uri(window.top.location.href);\n\t\treturn uri.getQueryParam('preset');\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tisFormCreated(): boolean\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tconst uri = new Uri(rootWindow.location.href);\n\t\treturn Text.toBoolean(uri.getQueryParam('formCreated'));\n\t}\n\n\tsetCurrentFormId(formId: number)\n\t{\n\t\tthis.cache.set('currentFormId', Text.toNumber(formId));\n\t}\n\n\tgetCurrentFormId(): number\n\t{\n\t\treturn this.cache.get('currentFormId');\n\t}\n\n\tsetCurrentFormInstanceId(formId: number)\n\t{\n\t\tthis.cache.set('currentFormInstanceId', formId);\n\t}\n\n\tgetCurrentFormInstanceId(): number\n\t{\n\t\treturn this.cache.get('currentFormInstanceId');\n\t}\n\n\tsetCrmFields(fields)\n\t{\n\t\tthis.cache.set('fields', fields);\n\t}\n\n\tgetCrmFields(): CrmFieldsList\n\t{\n\t\treturn this.cache.get('fields') || {};\n\t}\n\n\tsetCrmCompanies(companies: Array<CrmCompany>)\n\t{\n\t\tthis.cache.set('companies', companies);\n\t}\n\n\tgetCrmCompanies(): Array<CrmCompany>\n\t{\n\t\treturn this.cache.get('companies') || [];\n\t}\n\n\tsetCrmCategories(categories: Array<CrmCategory>)\n\t{\n\t\tthis.cache.set('crmCategories', categories);\n\t}\n\n\tgetCrmCategories(): Array<CrmCategory>\n\t{\n\t\treturn this.cache.get('crmCategories') || [];\n\t}\n\n\tsetFormOptions(options: FormOptions)\n\t{\n\t\tthis.cache.set('formOptions', options);\n\t}\n\n\tgetFormOptions(): FormOptions\n\t{\n\t\treturn Runtime.clone(this.cache.get('formOptions') || {});\n\t}\n\n\tsetFormDictionary(dictionary: FormDictionary)\n\t{\n\t\tthis.cache.set('formDictionary', dictionary);\n\t}\n\n\tgetFormDictionary(): FormDictionary\n\t{\n\t\treturn this.cache.get('formDictionary') || {};\n\t}\n\n\tsetInitialFormOptions(options: FormOptions)\n\t{\n\t\tthis.cache.set('initialFormOptions', Runtime.clone(options));\n\t}\n\n\tgetInitialFormOptions(): FormOptions\n\t{\n\t\treturn this.cache.get('initialFormOptions');\n\t}\n\n\t// eslint-disable-next-line\n\tgetCrmForm()\n\t{\n\t\tconst formApp = Reflection.getClass('b24form.App');\n\t\tif (formApp)\n\t\t{\n\t\t\tif (this.getCurrentFormInstanceId())\n\t\t\t{\n\t\t\t\treturn formApp.get(this.getCurrentFormInstanceId());\n\t\t\t}\n\n\t\t\tlet tmpIndex = -1;\n\t\t\tconst currentFormIndex = [\n\t\t\t\t...this.getCurrentBlock().node.parentElement.childNodes,\n\t\t\t].reduce((acc, item) => {\n\t\t\t\tif (Dom.attr(item, 'data-subtype') === 'form')\n\t\t\t\t{\n\t\t\t\t\ttmpIndex += 1;\n\t\t\t\t\tif (item === this.getCurrentBlock().node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn tmpIndex;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, 0);\n\n\t\t\treturn formApp.list()[currentFormIndex];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tconst eventData = event.getData();\n\t\tconst eventTargetValue = event.getTarget().getValue();\n\n\t\tPromise\n\t\t\t.resolve(eventTargetValue)\n\t\t\t.then((value) => {\n\t\t\t\tif (eventData.skipPrepare)\n\t\t\t\t{\n\t\t\t\t\tconst formOptions = this.getFormOptions();\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tReflect.has(value, 'presetFields')\n\t\t\t\t\t\t|| Reflect.has(value, 'document')\n\t\t\t\t\t\t|| Reflect.has(value, 'result')\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst additionalValue = {};\n\t\t\t\t\t\tif (Reflect.has(value, 'document'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tadditionalValue.payment = value.document.payment;\n\t\t\t\t\t\t\tdelete value.document.payment;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...formOptions,\n\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t\t...additionalValue,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tReflect.has(value, 'embedding')\n\t\t\t\t\t\t|| Reflect.has(value, 'callback')\n\t\t\t\t\t\t|| Reflect.has(value, 'whatsapp')\n\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\tReflect.has(value, 'name')\n\t\t\t\t\t\t\t&& Reflect.has(value, 'data')\n\t\t\t\t\t\t\t&& Reflect.has(value.data, 'useSign')\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst mergedOptions = Runtime.merge(\n\t\t\t\t\t\t\tformOptions,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (Reflect.has(value, 'responsible'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmergedOptions.responsible.users = value.responsible.users;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn mergedOptions;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Reflect.has(value, 'recaptcha'))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst {key, secret} = value.recaptcha;\n\t\t\t\t\t\tdelete value.recaptcha.key;\n\t\t\t\t\t\tdelete value.recaptcha.secret;\n\t\t\t\t\t\tconst captcha = {};\n\n\t\t\t\t\t\tif (!Type.isNil(key))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcaptcha.key = key;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!Type.isNil(secret))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcaptcha.secret = secret;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...formOptions,\n\t\t\t\t\t\t\tcaptcha: {\n\t\t\t\t\t\t\t\t...formOptions.captcha,\n\t\t\t\t\t\t\t\t...captcha,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t...formOptions.data,\n\t\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...formOptions,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t...formOptions.data,\n\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn FormClient.getInstance()\n\t\t\t\t\t.prepareOptions(this.getFormOptions(), value)\n\t\t\t\t\t.then(result => {\n\t\t\t\t\t\tif (value.agreements)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresult.data = Runtime.merge(result.data, value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value.integration)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresult.integration = value.integration;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value.fields)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresult.data.fields = result.data.fields.map((field, index) => {\n\t\t\t\t\t\t\t\treturn Runtime.merge(field, value.fields[index]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.then((result) => {\n\t\t\t\tBX.Landing.UI.Panel.Top\n\t\t\t\t\t.getInstance()\n\t\t\t\t\t.setFormName(result.name);\n\t\t\t\tthis.setFormOptions(result);\n\t\t\t\tthis.getCrmForm().adjust(Runtime.clone(result.data));\n\t\t\t});\n\t}\n\n\tstatic sanitize(value: any): any\n\t{\n\t\tif (Type.isStringFilled(value))\n\t\t{\n\t\t\treturn Text.decode(value)\n\t\t\t\t.replace(/<style[^>]*>.*<\\/style>/gm, '')\n\t\t\t\t.replace(/<script[^>]*>.*<\\/script>/gm, '')\n\t\t\t\t.replace(/<[^>]+>/gm, '');\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tgetPersonalizationVariables(): Array<{name: string, value: string}>\n\t{\n\t\treturn this.cache.remember('personalizationVariables', () => {\n\t\t\treturn this.getFormDictionary().personalization.list.map((item) => {\n\t\t\t\treturn {name: item.name, value: item.id};\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDefaultValuesVariables(): Array<{name: string, value: string}>\n\t{\n\t\treturn this.cache.remember('personalizationVariables', () => {\n\t\t\tconst {properties} = this.getFormDictionary();\n\t\t\tif (Type.isPlainObject(properties) && Type.isArrayFilled(properties.list))\n\t\t\t{\n\t\t\t\treturn properties.list.map((item) => {\n\t\t\t\t\treturn {name: item.name, value: item.id};\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn [];\n\t\t});\n\t}\n\n\tgetContent(id: string): Promise<ContentWrapper>\n\t{\n\t\tconst currentButton = this.getSidebarButtons().find((button) => {\n\t\t\treturn id === button.options.id;\n\t\t});\n\n\t\tconst {extension} = currentButton.options.data;\n\n\t\tconst contentExtension = this.cache.remember(extension, () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\treturn rootWindow.BX.Runtime\n\t\t\t\t.loadExtension(extension)\n\t\t\t\t.then((exports) => {\n\t\t\t\t\treturn exports.default;\n\t\t\t\t});\n\t\t});\n\n\t\treturn contentExtension.then((ContentWrapperClass) => {\n\t\t\tif (Type.isFunction(ContentWrapperClass))\n\t\t\t{\n\t\t\t\treturn new ContentWrapperClass({\n\t\t\t\t\tformOptions: this.getFormOptions(),\n\t\t\t\t\tdictionary: this.getFormDictionary(),\n\t\t\t\t\tcrmFields: this.getCrmFields(),\n\t\t\t\t\tcompanies: this.getCrmCompanies(),\n\t\t\t\t\tcategories: this.getCrmCategories(),\n\t\t\t\t\tagreements: this.getAgreements(),\n\t\t\t\t\tisLeadEnabled: this.isLeadEnabled(),\n\t\t\t\t\tform: this.getCrmForm(),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn null;\n\t\t});\n\t}\n\n\tonPresetClick(event: BaseEvent)\n\t{\n\t\tif (event.getTarget().options.openable)\n\t\t{\n\t\t\tthis.disableTransparentMode();\n\t\t}\n\n\t\tconst uri = new Uri(window.top.location.toString());\n\t\turi.removeQueryParam('formCreated');\n\t\turi.removeQueryParam('preset');\n\t\twindow.top.history.replaceState(null, document.title, uri.toString());\n\n\t\tthis.applyPreset(event.getTarget());\n\t}\n\n\tgetCheckActionConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('checkActionConfirm', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\treturn new rootWindow.BX.UI.Dialogs.MessageBox({\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyPreset(preset: Preset, skipOptions = false)\n\t{\n\t\tconst lastPreset = this.getPresets().find((currentPreset: Preset) => {\n\t\t\treturn Dom.hasClass(currentPreset.getLayout(), 'landing-ui-panel-preset-active');\n\t\t});\n\n\t\tthis.getPresets().forEach((currentPreset) => {\n\t\t\tcurrentPreset.deactivate();\n\t\t});\n\n\t\tif (!skipOptions)\n\t\t{\n\t\t\tconst runAction = (() => {\n\t\t\t\tif (Type.isArrayFilled(preset.options.actions))\n\t\t\t\t{\n\t\t\t\t\treturn Promise.all(\n\t\t\t\t\t\tpreset.options.actions.map((action) => {\n\t\t\t\t\t\t\tif (action.id === 'showTour')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\t\t\t\t\t\tconst guide = new rootWindow.BX.UI.Tour.Guide({\n\t\t\t\t\t\t\t\t\tonEvents: false,\n\t\t\t\t\t\t\t\t\tsteps: action.data.steps,\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tguide.start();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (action.id === 'showHelp')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (window.top.BX.Helper)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\twindow.top.BX.Helper.show(action.data.href);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (action.id === 'check')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn FormClient\n\t\t\t\t\t\t\t\t\t.getInstance()\n\t\t\t\t\t\t\t\t\t.check({\n\t\t\t\t\t\t\t\t\t\ttemplateId: preset.options.id,\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\t\t\tif (result.success === false)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tconst checkActionConfirm = this.getCheckActionConfirm();\n\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setTitle(result.message.title);\n\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setMessage(result.message.description);\n\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setOkCaption(result.message.confirmButton);\n\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setCancelCaption(result.message.cancelButton);\n\n\t\t\t\t\t\t\t\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setOkCallback(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.getCancelButton().setDisabled(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setCancelCallback(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.getCancelButton().setDisabled(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.show();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn Promise.resolve(true);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.resolve();\n\t\t\t})();\n\n\t\t\tif (preset.options.openable)\n\t\t\t{\n\t\t\t\tthis.showLoader();\n\n\t\t\t\tvoid runAction\n\t\t\t\t\t.then((actions) => {\n\t\t\t\t\t\tconst actionsResult = (() => {\n\t\t\t\t\t\t\tif (Type.isArrayFilled(preset.options.actions))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn preset.options.actions.reduce((acc, item, index) => {\n\t\t\t\t\t\t\t\t\treturn {...acc, [item.id]: actions[index]};\n\t\t\t\t\t\t\t\t}, {});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn {};\n\t\t\t\t\t\t})();\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tReflect.has(actionsResult, 'check')\n\t\t\t\t\t\t\t\t&& actionsResult.check === true\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\t\t!Reflect.has(actionsResult, 'check')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getPresets().forEach((currentPreset) => {\n\t\t\t\t\t\t\t\tcurrentPreset.deactivate();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tpreset.activate();\n\n\t\t\t\t\t\t\tFormClient.getInstance()\n\t\t\t\t\t\t\t\t.prepareOptions(this.getFormOptions(), {templateId: preset.options.id})\n\t\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\t\treturn Backend.getInstance()\n\t\t\t\t\t\t\t\t\t\t.action('Form::getCrmFields')\n\t\t\t\t\t\t\t\t\t\t.then((crmFields) => {\n\t\t\t\t\t\t\t\t\t\t\tthis.setCrmFields(crmFields);\n\t\t\t\t\t\t\t\t\t\t\tFieldsPanel.getInstance().setCrmFields(crmFields);\n\t\t\t\t\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\t\tBX.Landing.UI.Panel.Top\n\t\t\t\t\t\t\t\t\t\t.getInstance()\n\t\t\t\t\t\t\t\t\t\t.setFormName(result.name);\n\t\t\t\t\t\t\t\t\tthis.setFormOptions({\n\t\t\t\t\t\t\t\t\t\t...result,\n\t\t\t\t\t\t\t\t\t\ttemplateId: preset.options.id,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tthis.getCrmForm().adjust(Runtime.clone(result.data));\n\t\t\t\t\t\t\t\t\tif (this.isFormCreated())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.onPresetFieldClick();\n\t\t\t\t\t\t\t\t\t\tthis.activatePreset(preset.options.id);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tsuper.applyPreset(preset);\n\n\t\t\t\t\t\t\t\t\t\tif (Type.isArrayFilled(preset.options.expertModeItems))\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tDom.show(this.getExpertSwitcherLayout());\n\t\t\t\t\t\t\t\t\t\t\tthis.onExpertModeChange();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tDom.hide(this.getExpertSwitcherLayout());\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tthis.hideLoader();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.hideLoader();\n\t\t\t\t\t\t\tthis.enableTransparentMode();\n\n\t\t\t\t\t\t\tif (lastPreset)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlastPreset.activate();\n\t\t\t\t\t\t\t\tpreset.deactivate();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (preset.options.openable)\n\t\t\t{\n\t\t\t\tsuper.applyPreset(preset);\n\t\t\t\tif (Type.isArrayFilled(preset.options.expertModeItems))\n\t\t\t\t{\n\t\t\t\t\tDom.show(this.getExpertSwitcherLayout());\n\t\t\t\t\tthis.onExpertModeChange();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.hide(this.getExpertSwitcherLayout());\n\t\t\t\t}\n\t\t\t\tthis.hideLoader();\n\t\t\t}\n\n\t\t\tpreset.activate();\n\t\t}\n\t}\n\n\tgetFormNode(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('formNode', () => {\n\t\t\treturn this.getCurrentBlock().node.querySelector('[data-b24form-use-style]');\n\t\t});\n\t}\n\n\tuseBlockDesign(): boolean\n\t{\n\t\treturn this.cache.remember('useBlockDesign', () => {\n\t\t\treturn Text.toBoolean(Dom.attr(this.getFormNode(), 'data-b24form-use-style'));\n\t\t});\n\t}\n\n\tgetCurrentCrmEntityName(): string\n\t{\n\t\tconst {scheme} = this.getFormOptions().document;\n\t\tconst schemeItem = this.getFormDictionary().document.schemes.find((item) => {\n\t\t\treturn String(scheme) === String(item.id);\n\t\t});\n\n\t\treturn schemeItem.name;\n\t}\n\n\tgetNotSynchronizedFields(): Promise<any>\n\t{\n\t\treturn FormClient\n\t\t\t.getInstance()\n\t\t\t.checkFields(this.getFormOptions())\n\t\t\t.then((result) => {\n\t\t\t\treturn result;\n\t\t\t});\n\t}\n\n\tshowSynchronizationPopup(notSynchronizedFields: Array<string>): Promise<boolean>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst onOk = (messageBox: MessageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tresolve(true);\n\t\t\t};\n\n\t\t\tconst onCancel = (messageBox: MessageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tresolve(false);\n\t\t\t};\n\n\t\t\tconst messageDescription = (() => {\n\t\t\t\tconst entityName = Loc.getMessage('LANDING_SYNCHRONIZATION_POPUP_ENTITY_TEMPLATE')\n\t\t\t\t\t.replace('{entityName}', Text.encode(this.getCurrentCrmEntityName()));\n\n\t\t\t\treturn Loc.getMessage('LANDING_SYNCHRONIZATION_POPUP_DESCRIPTION')\n\t\t\t\t\t.replace('{entityName}', Text.encode(entityName));\n\t\t\t})();\n\n\t\t\tconst messageText = (() => {\n\t\t\t\tconst fields = [...notSynchronizedFields].map((field) => {\n\t\t\t\t\treturn Loc.getMessage('LANDING_SYNCHRONIZATION_POPUP_FIELD_TEMPLATE')\n\t\t\t\t\t\t.replace('{fieldName}', Text.encode(field));\n\t\t\t\t});\n\n\t\t\t\tif (notSynchronizedFields.length > 1)\n\t\t\t\t{\n\t\t\t\t\tconst lastField = fields.pop();\n\n\t\t\t\t\treturn Loc\n\t\t\t\t\t\t.getMessage('LANDING_SYNCHRONIZATION_POPUP_TEXT')\n\t\t\t\t\t\t.replace('{fieldsList}', fields.join(', '))\n\t\t\t\t\t\t.replace('{lastField}', lastField);\n\t\t\t\t}\n\n\t\t\t\treturn Loc\n\t\t\t\t\t.getMessage('LANDING_SYNCHRONIZATION_POPUP_TEXT_1')\n\t\t\t\t\t.replace('{field}', fields.join(', '));\n\t\t\t})();\n\n\t\t\twindow.top.BX.UI.Dialogs.MessageBox.confirm(\n\t\t\t\t`${messageDescription}<br><br>${messageText}`,\n\t\t\t\tLoc.getMessage('LANDING_SYNCHRONIZATION_POPUP_TITLE'),\n\t\t\t\tonOk,\n\t\t\t\tLoc.getMessage('LANDING_SYNCHRONIZATION_POPUP_OK_BUTTON_LABEL'),\n\t\t\t\tonCancel,\n\t\t\t);\n\t\t});\n\t}\n\n\tshowSynchronizationErrorPopup(errors: Array<string>)\n\t{\n\t\tconst message = errors.reduce((acc, item) => {\n\t\t\treturn `${acc}\\n\\n${item}`;\n\t\t}, '');\n\n\t\twindow.top.BX.UI.Dialogs.MessageBox.alert(message);\n\t}\n\n\tgetErrorAlert(): MessageBox\n\t{\n\t\treturn this.cache.remember('errorAlert', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\treturn new rootWindow.BX.UI.Dialogs.MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SAVE_ERROR_ALERT_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tmaxHeight: 310,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tonSaveClick()\n\t{\n\t\tconst dictionary = this.getFormDictionary();\n\n\t\tBX.onCustomEvent(this, 'BX.Landing.Block:onFormSave', [this.getCurrentBlock().id]);\n\n\t\tif (\n\t\t\tType.isPlainObject(dictionary.permissions)\n\t\t\t&& Type.isPlainObject(dictionary.permissions.form)\n\t\t\t&& dictionary.permissions.form.edit === false\n\t\t)\n\t\t{\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\trootWindow.BX.UI.Dialogs.MessageBox.alert(Loc.getMessage('LANDING_FORM_SAVE_PERMISSION_DENIED'));\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.getSaveButton().layout, 'ui-btn-wait');\n\n\t\tthis.getNotSynchronizedFields()\n\t\t\t.then((result) => {\n\t\t\t\tif (Type.isPlainObject(result.sync))\n\t\t\t\t{\n\t\t\t\t\tif (Type.isArrayFilled(result.sync.errors))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showSynchronizationErrorPopup(result.sync.errors);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Type.isArrayFilled(result.sync.fields))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst fieldLabels = result.sync.fields.map((field) => {\n\t\t\t\t\t\t\treturn field.label;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this.showSynchronizationPopup(fieldLabels);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t.then((isConfirmed) => {\n\t\t\t\tif (isConfirmed)\n\t\t\t\t{\n\t\t\t\t\tconst uri = new Uri(window.top.location.toString());\n\t\t\t\t\turi.removeQueryParam('formCreated');\n\t\t\t\t\twindow.top.history.replaceState(null, document.title, uri.toString());\n\n\t\t\t\t\tconst initialOptions = this.getInitialFormOptions();\n\t\t\t\t\tconst currentOptions = this.getFormOptions();\n\t\t\t\t\tconst options = (() => {\n\t\t\t\t\t\tif (!this.isCrmFormPage())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst clonedOptions = Runtime.clone(currentOptions);\n\t\t\t\t\t\t\tclonedOptions.data.design = Runtime.clone(initialOptions.data.design);\n\t\t\t\t\t\t\treturn clonedOptions;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn currentOptions;\n\t\t\t\t\t})();\n\n\t\t\t\t\tif (\n\t\t\t\t\t\toptions.data.recaptcha.use\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t!this.getFormDictionary().captcha.hasKeys\n\t\t\t\t\t\t\t&& !options.captcha.hasDefaults\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\toptions.data.recaptcha.use = false;\n\n\t\t\t\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\t\t\t\tconst alert: MessageBox = new rootWindow.BX.UI.Dialogs.MessageBox({\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SAVE_CAPTCHA_ALERT_TITLE'),\n\t\t\t\t\t\t\tmessage: Loc.getMessage('LANDING_FORM_SAVE_CAPTCHA_ALERT_TEXT_2'),\n\t\t\t\t\t\t\tbuttons: MessageBoxButtons.OK,\n\t\t\t\t\t\t\tonOk: () => {\n\t\t\t\t\t\t\t\talert.close();\n\t\t\t\t\t\t\t\tDom.removeClass(this.getSaveButton().layout, 'ui-btn-wait');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\talert.show();\n\t\t\t\t\t}\n\n\t\t\t\t\tvoid FormClient.getInstance()\n\t\t\t\t\t\t.saveOptions(options)\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tBX.onCustomEvent(this, 'BX.Landing.Block:onAfterFormSave', [this.getCurrentBlock().id]);\n\n\t\t\t\t\t\t\tthis.setFormOptions(result);\n\t\t\t\t\t\t\tthis.setInitialFormOptions(result);\n\t\t\t\t\t\t\tFormClient.getInstance().resetCache(result.id);\n\t\t\t\t\t\t\tDom.removeClass(this.getSaveButton().layout, 'ui-btn-wait');\n\n\t\t\t\t\t\t\tconst activeButton = this.getSidebarButtons().find((button) => {\n\t\t\t\t\t\t\t\treturn button.isActive();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn Backend.getInstance()\n\t\t\t\t\t\t\t\t.action('Form::getCrmFields')\n\t\t\t\t\t\t\t\t.then((crmFields) => {\n\t\t\t\t\t\t\t\t\tthis.setCrmFields(crmFields);\n\t\t\t\t\t\t\t\t\tFieldsPanel.getInstance().setCrmFields(crmFields);\n\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tactiveButton\n\t\t\t\t\t\t\t\t\t\t&& !Dom.hasClass(this.layout, 'landing-ui-panel-mode-transparent')\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tactiveButton.getLayout().click();\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (this.isCrmFormPage())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tDom.addClass(this.getSaveButton().layout, 'ui-btn-icon-done');\n\t\t\t\t\t\t\t\tconst currentButtonText = this.getSaveButton().layout.innerText;\n\t\t\t\t\t\t\t\tthis.getSaveButton().setText(Loc.getMessage('LANDING_FORM_EDITOR_SAVE_BUTTON_STATE_SAVED'));\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tDom.removeClass(this.getSaveButton().layout, 'ui-btn-icon-done');\n\t\t\t\t\t\t\t\t\tthis.getSaveButton().setText(currentButtonText);\n\t\t\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvoid this.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((errors) => {\n\t\t\t\t\t\t\tif (Type.isArrayFilled(errors))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (this.#isPhoneValidationError(errors))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.#showPhoneVerifySlider()\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tconst errorMessage = errors\n\t\t\t\t\t\t\t\t\t\t.map((item) => {\n\t\t\t\t\t\t\t\t\t\t\treturn Text.encode(item.message);\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.join('<br><br>');\n\n\t\t\t\t\t\t\t\t\tconst errorAlert = this.getErrorAlert();\n\t\t\t\t\t\t\t\t\terrorAlert.setMessage(errorMessage);\n\t\t\t\t\t\t\t\t\terrorAlert.show();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\t\t\t\t\t\trootWindow.BX.UI.Dialogs.MessageBox.alert(\n\t\t\t\t\t\t\t\t\tLoc.getMessage('LANDING_FORM_SAVE_UNKNOWN_ERROR_ALERT_TEXT'),\n\t\t\t\t\t\t\t\t\tLoc.getMessage('LANDING_FORM_SAVE_ERROR_ALERT_TITLE'),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tDom.removeClass(this.getSaveButton().layout, 'ui-btn-wait');\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (this.useBlockDesign() && this.isCrmFormPage())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.disableUseBlockDesign();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(this.getSaveButton().layout, 'ui-btn-wait');\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t#isPhoneValidationError(errors: ResponseErrors): boolean\n\t{\n\t\treturn errors.some((error) => {\n\t\t\t\treturn error.code === this.#phoneDoesntVerifiedResponseCode;\n\t\t\t}\n\t\t);\n\t}\n\n\t#showPhoneVerifySlider(): void\n\t{\n\t\tif (typeof PhoneVerify !== 'undefined')\n\t\t{\n\t\t\tPhoneVerify\n\t\t\t\t.getInstance()\n\t\t\t\t.setEntityType(PHONE_VERIFY_FORM_ENTITY)\n\t\t\t\t.setEntityId(this.getCurrentFormId())\n\t\t\t\t.startVerify({\n\t\t\t\t\tsliderTitle: Loc.getMessage('LANDING_FORM_EDITOR_PHONE_VERIFY_CUSTOM_SLIDER_TITLE'),\n\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_EDITOR_PHONE_VERIFY_CUSTOM_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('LANDING_FORM_EDITOR_PHONE_VERIFY_CUSTOM_DESCRIPTION'),\n\t\t\t\t});\n\t\t}\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn JSON.stringify(this.getFormOptions()) !== JSON.stringify(this.getInitialFormOptions());\n\t}\n\n\tdisableUseBlockDesign()\n\t{\n\t\tDom.attr(this.getFormNode(), 'data-b24form-use-style', 'N');\n\t\tthis.cache.set('useBlockDesign', false);\n\n\t\tBackend\n\t\t\t.getInstance()\n\t\t\t.action(\n\t\t\t\t'Landing\\\\Block::updateNodes',\n\t\t\t\t{\n\t\t\t\t\tblock: this.getCurrentBlock().id,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\t'.bitrix24forms': {\n\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t'data-b24form-use-style': 'N',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tlid: this.getCurrentBlock().lid,\n\t\t\t\t\tsiteId: this.getCurrentBlock().siteId,\n\t\t\t\t},\n\t\t\t\t{code: this.getCurrentBlock().manifest.code},\n\t\t\t)\n\t\t\t.then(result => {\n\t\t\t\treturn History.getInstance().push();\n\t\t\t});\n\t}\n\n\tonCancelClick()\n\t{\n\t\tconst initialFormOptions = this.getInitialFormOptions();\n\t\tthis.getCrmForm().adjust(initialFormOptions.data);\n\t\tBX.Landing.UI.Panel.Top\n\t\t\t.getInstance()\n\t\t\t.setFormName(initialFormOptions.name);\n\n\t\tvoid this.hide();\n\t}\n\n\thide(): Promise<*>\n\t{\n\t\tconst editorWindow = PageObject.getEditorWindow();\n\t\tDom.removeClass(editorWindow.document.body, 'landing-ui-hide-action-panels-form');\n\t\tthis.enableHistory();\n\t\treturn super.hide();\n\t}\n\n\tonSidebarButtonClick(event: BaseEvent)\n\t{\n\t\tconst target = event.getTarget();\n\t\tif (target.options.id === 'design')\n\t\t{\n\t\t\tthis.onFormDesignButtonClick();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsuper.onSidebarButtonClick(event);\n\t\t}\n\t}\n}\n"],"names":["PHONE_VERIFY_FORM_ENTITY","FormSettingsPanel","rootWindow","PageObject","getRootWindow","rootWindowPanel","BX","Landing","UI","Panel","instance","setEventNamespace","setTitle","Loc","getMessage","lsCache","Cache","LocalStorageCache","Dom","addClass","layout","subscribe","onCustomEvent","getCurrentBlock","id","disableOverlay","isCrmFormPage","dictionary","Env","getInstance","getOptions","formEditorData","preparedSidebarButtons","sidebarButtons","map","buttonOptions","SidebarButton","child","setSidebarButtons","preparedPresets","scenarios","presetOptions","Preset","setPresets","preparedPresetCategories","scenarioCategories","categoryOptions","PresetCategory","setCategories","append","getBlockSettingsButton","render","getRightHeaderControls","onCancelClick","bind","getExpertSwitcherLayout","cache","remember","onClick","getExpertModeSwitcher","node","click","Tag","switcher","Switcher","checked","isExpertModeEnabled","Event","onExpertSwitcherClick","set","isChecked","onExpertModeChange","getFormOptions","templateId","preset","getPresets","find","currentPreset","options","getCurrentPreset","Type","isArrayFilled","expertModeItems","clearSidebar","getSidebarButtons","filter","button","includes","forEach","items","deactivate","appendSidebarButton","currentSidebarButton","isActive","buttons","defaultSection","isStringFilled","defaultSectionButton","getLayout","get","specialType","Button","text","color","Color","LIGHT_BORDER","round","className","onclick","onFormDesignButtonClick","onBlockSettingsButtonClick","hide","then","showContentPanel","onFormDesignClick","Loader","target","body","getLoader","show","sidebar","content","removeClass","showWithOptions","editorData","setCrmFields","crmFields","setCrmCompanies","crmCompanies","setCrmCategories","crmCategories","setAgreements","agreements","currentOptions","Runtime","clone","formOptions","use","data","setFormOptions","setFormDictionary","Promise","resolve","crmData","Backend","batch","action","result","FormClient","getCurrentFormId","formDictionary","getDictionary","all","orderBy","getFormDictionary","document","lead","enabled","block","alert","Alert","AlertColor","WARNING","parentNode","enableToggleMode","isFormCreated","disableTransparentMode","mainOptions","saveOriginalFileName","prependContent","getSaveOriginalFileNameAlert","closeButtonTop","Text","toNumber","style","closeButton","alertHeight","getBoundingClientRect","height","setCurrentBlock","setCurrentFormId","formId","setCurrentFormInstanceId","instanceId","showLoader","load","hideLoader","isPlainObject","merge","state","presetFromRequest","getPresetIdFromRequest","item","applyPreset","onPresetFieldClick","activatePreset","setInitialFormOptions","error","accessDeniedCode","isAccessDenied","some","errorItem","String","code","footer","getAccessError","console","editorWindow","getEditorWindow","StylePanel","disableHistory","setTimeout","y","offsetTop","scrollTo","encode","Hint","initNode","TopPanel","Top","undoButton","redoButton","getHistoryHint","parentElement","remove","uri","Uri","window","top","location","href","getQueryParam","toBoolean","fields","companies","categories","formApp","Reflection","getClass","getCurrentFormInstanceId","tmpIndex","currentFormIndex","childNodes","reduce","acc","attr","list","event","eventData","getData","eventTargetValue","getTarget","getValue","value","skipPrepare","Reflect","has","additionalValue","payment","mergedOptions","responsible","users","recaptcha","key","secret","captcha","isNil","prepareOptions","integration","field","index","setFormName","name","getCrmForm","adjust","personalization","properties","currentButton","extension","contentExtension","loadExtension","exports","ContentWrapperClass","isFunction","getCrmFields","getCrmCompanies","getCrmCategories","getAgreements","isLeadEnabled","form","openable","toString","removeQueryParam","history","replaceState","title","Dialogs","MessageBox","MessageBoxButtons","OK_CANCEL","skipOptions","lastPreset","hasClass","runAction","actions","guide","Tour","Guide","onEvents","steps","start","Helper","check","success","checkActionConfirm","getCheckActionConfirm","message","setMessage","description","setOkCaption","confirmButton","setCancelCaption","cancelButton","setOkCallback","getOkButton","setDisabled","getCancelButton","close","setCancelCallback","actionsResult","activate","FieldsPanel","enableTransparentMode","querySelector","getFormNode","scheme","schemeItem","schemes","checkFields","notSynchronizedFields","onOk","messageBox","onCancel","messageDescription","entityName","replace","getCurrentCrmEntityName","messageText","length","lastField","pop","join","confirm","errors","OK","popupOptions","maxHeight","permissions","edit","getSaveButton","getNotSynchronizedFields","sync","showSynchronizationErrorPopup","fieldLabels","label","showSynchronizationPopup","isConfirmed","initialOptions","getInitialFormOptions","clonedOptions","design","hasKeys","hasDefaults","saveOptions","resetCache","activeButton","currentButtonText","innerText","setText","errorMessage","errorAlert","getErrorAlert","useBlockDesign","disableUseBlockDesign","JSON","stringify","attrs","lid","siteId","manifest","History","push","initialFormOptions","enableHistory","decode","BasePresetPanel","PhoneVerify","setEntityType","setEntityId","startVerify","sliderTitle"],"mappings":"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"}