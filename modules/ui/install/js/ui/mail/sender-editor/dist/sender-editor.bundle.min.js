this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,s,i,a,n,r,l){"use strict";let o=e=>e,d,c,u,v,h,p,b,m,L,I,S;const f=BX.SidePanel;const P=/\S+@\S+\.\S+/;const g="mail-mailbox-config-delete";const _="sender";var F=babelHelpers.classPrivateFieldLooseKey("setFieldData");var y=babelHelpers.classPrivateFieldLooseKey("showDisconnectDialog");var E=babelHelpers.classPrivateFieldLooseKey("save");var T=babelHelpers.classPrivateFieldLooseKey("disconnect");var M=babelHelpers.classPrivateFieldLooseKey("saveSender");var B=babelHelpers.classPrivateFieldLooseKey("createContentContainer");var D=babelHelpers.classPrivateFieldLooseKey("createAlertNode");var A=babelHelpers.classPrivateFieldLooseKey("createSenderSection");var w=babelHelpers.classPrivateFieldLooseKey("createSmtpServerSection");var H=babelHelpers.classPrivateFieldLooseKey("createSmtpEmailRow");var C=babelHelpers.classPrivateFieldLooseKey("createSmtpServerRow");var x=babelHelpers.classPrivateFieldLooseKey("createSmtpPortAndSafeConnectionRow");var N=babelHelpers.classPrivateFieldLooseKey("createSmtpLoginRow");var R=babelHelpers.classPrivateFieldLooseKey("createSmtpPasswordRow");var O=babelHelpers.classPrivateFieldLooseKey("createLimitSection");var U=babelHelpers.classPrivateFieldLooseKey("showAlertNode");var j=babelHelpers.classPrivateFieldLooseKey("hideAlertNode");var k=babelHelpers.classPrivateFieldLooseKey("prepareNecessaryFields");var K=babelHelpers.classPrivateFieldLooseKey("hasInvalidFields");var $=babelHelpers.classPrivateFieldLooseKey("clearInvalidFields");var X=babelHelpers.classPrivateFieldLooseKey("isInvalidField");var G=babelHelpers.classPrivateFieldLooseKey("getErrorMessage");var q=babelHelpers.classPrivateFieldLooseKey("setUserName");class V{constructor(e){var s;Object.defineProperty(this,q,{value:me});Object.defineProperty(this,G,{value:be});Object.defineProperty(this,X,{value:pe});Object.defineProperty(this,$,{value:he});Object.defineProperty(this,K,{value:ve});Object.defineProperty(this,k,{value:ue});Object.defineProperty(this,j,{value:ce});Object.defineProperty(this,U,{value:de});Object.defineProperty(this,O,{value:oe});Object.defineProperty(this,R,{value:le});Object.defineProperty(this,N,{value:re});Object.defineProperty(this,x,{value:ne});Object.defineProperty(this,C,{value:ae});Object.defineProperty(this,H,{value:ie});Object.defineProperty(this,w,{value:se});Object.defineProperty(this,A,{value:te});Object.defineProperty(this,D,{value:ee});Object.defineProperty(this,B,{value:Q});Object.defineProperty(this,M,{value:J});Object.defineProperty(this,T,{value:z});Object.defineProperty(this,E,{value:Z});Object.defineProperty(this,y,{value:W});Object.defineProperty(this,F,{value:Y});if(e){var i,a;if(e.senderId&&t.Type.isInteger(e.senderId)&&e.senderId>0){this.title=t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_EDIT_TITLE");this.senderId=e.senderId}else{this.title=t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_ADD_TITLE")}this.setSender=(i=e.setSenderCallback)!=null?i:null;this.addSender=(a=e.addSenderCallback)!=null?a:null}this.onCloseAction=(s=e.onClose)!=null?s:null;babelHelpers.classPrivateFieldLooseBase(this,B)[B]();babelHelpers.classPrivateFieldLooseBase(this,k)[k]()}static openSlider(e){const s=new V(e);f.Instance.open("smtpSender",{width:760,cacheable:false,contentCallback:()=>s.getContentCallback(),events:{onLoad:()=>{t.ready((()=>{new l.LayoutForm({container:s.limitSection})}))}}})}getContentCallback(){return s.Layout.createContent({extensions:["ui.mail.sender-editor"],title:this.title,design:{section:false,margin:false},content:()=>{if(this.senderId>0){return this.loadSender(this.senderId)}return t.ajax.runAction("main.api.mail.sender.getDefaultSenderName").then((e=>{babelHelpers.classPrivateFieldLooseBase(this,q)[q](e.data);return this.getContentContainer()})).catch((()=>this.getContentContainer()))},buttons:({cancelButton:e,Button:s})=>{const i=[];const a=new n.SaveButton({onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,E)[E](a)}});i.push(a);if(this.senderId>0){this.disconnectButton=new s({text:t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_DISCONNECT_BUTTON"),color:BX.UI.Button.Color.DANGER,onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,y)[y]()}});i.push(this.disconnectButton)}i.push(e);return i}})}loadSender(e){return t.ajax.runAction("main.api.mail.sender.getSenderData",{data:{senderId:e}}).then((e=>{babelHelpers.classPrivateFieldLooseBase(this,F)[F](e.data);return this.getContentContainer()})).catch((()=>this.getContentContainer()))}getContentContainer(){return this.contentContainer}}function Y(e){this.nameField.value=e.name;this.accessField.checked=e.isPublic;this.emailField.value=e.email;this.serverField.value=e.server;this.portField.value=e.port;this.loginField.value=e.login;if(e.protocol==="smtps"){this.sslField.checked=true}if(t.Type.isNumber(e.limit)&&e.limit>0){this.senderLimitCheckbox.checked=true;this.senderLimitField.value=e.limit}}function W(){top.BX.UI.Dialogs.MessageBox.show({message:t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_DISCONNECT_MESSAGE"),modal:true,buttons:BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,onOk:e=>{babelHelpers.classPrivateFieldLooseBase(this,T)[T]();e.close()},onCancel:e=>{e.close()}})}function Z(e){babelHelpers.classPrivateFieldLooseBase(this,$)[$]();if(babelHelpers.classPrivateFieldLooseBase(this,K)[K]()){return}babelHelpers.classPrivateFieldLooseBase(this,j)[j]();e.setClocking();babelHelpers.classPrivateFieldLooseBase(this,M)[M]().then((e=>{const t=e.data;if(this.setSender){this.setSender(t.senderId,t.name,this.email)}if(this.addSender){const e=[];e.name=t.name;e.email=this.email;this.addSender(e)}BX.SidePanel.Instance.getTopSlider().close();if(!this.senderId&&!this.addSender){pt.openSlider({senderId:t.senderId,email:this.email,setSenderCallback:this.setSender,onClose:this.onCloseAction})}})).catch((t=>{babelHelpers.classPrivateFieldLooseBase(this,U)[U](t.errors[0].message);e.setClocking(false)}))}function z(){t.Dom.addClass(this.disconnectButton,"ui-btn-wait");t.ajax.runAction("main.api.mail.sender.deleteSender",{data:{senderId:this.senderId}}).then((()=>{t.Dom.removeClass(this.disconnectButton,"ui-btn-wait");f.Instance.getTopSlider().close();top.BX.SidePanel.Instance.postMessage(window,g,{id:this.senderId,type:_})})).catch((()=>{t.Dom.removeClass(this.disconnectButton,"ui-btn-wait")}))}function J(){var e;this.email=this.emailField.value;const s={id:(e=this.senderId)!=null?e:null,name:this.nameField.value,email:this.email,smtp:{},public:this.accessField.checked?"Y":"N"};s.smtp={server:this.serverField.value,port:this.portField.value,ssl:this.sslField.checked?this.sslField.value:"",login:this.loginField.value,password:this.passwordField.value,limit:this.senderLimitCheckbox.checked?this.senderLimitField.value:null};return t.ajax.runAction("main.api.mail.sender.submitSender",{data:{data:s}}).then((e=>e))}function Q(){babelHelpers.classPrivateFieldLooseBase(this,D)[D]();babelHelpers.classPrivateFieldLooseBase(this,A)[A]();babelHelpers.classPrivateFieldLooseBase(this,w)[w]();babelHelpers.classPrivateFieldLooseBase(this,O)[O]();this.contentContainer=t.Tag.render(d||(d=o`
			<div class="ui-form">
				${0}
				${0}
				${0}
				${0}
			</div>
		`),this.alertNode,this.senderSection,this.smtpServerSection,this.limitSection)}function ee(){this.alertNode=t.Tag.render(c||(c=o`
			<div class="ui-alert ui-alert-danger ui-alert-icon-warning" style="display: none">
				<span class="ui-alert-message"></span>
			</div>
		`))}function te(){var e;const{root:s,nameField:i,accessField:a}=t.Tag.render(u||(u=o`
			<div class="ui-slider-section">
				<div class="ui-slider-content-box">
					<div class="ui-slider-heading-4">${0}</div>
					<div class="ui-form-row">
						<div class="ui-ctl-top smtp-sender-name">
							<div class="ui-form-label">${0}</div>
							<span data-hint="${0}"></span>
						</div>
						<div class="ui-form-row-inline ui-ctl-w100">
							<div class="ui-form-row">
								<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">
									<input type="text" data-name="name" value="" class="ui-ctl-element" ref="nameField">
								</div>
							</div>
							<div class="ui-form-row">
								<label class="ui-ctl ui-ctl-checkbox">
									<input type="checkbox" class="ui-ctl-element" data-name="access" ref="accessField">
									<div class="ui-ctl-label-text">${0}</div>
									<span data-hint="${0}"></span>
								</label>
							</div>
						</div>
					</div>
				</div>
			</div>
		`),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_SENDER_MAIN_SECTION_TITLE"),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_SENDER_NAME"),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_NAME_HINT"),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_SENDER_AVAILABLE_TOGGLE"),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_SENDER_AVAILABLE_TOGGLE_HINT"));this.senderSection=s;this.nameField=i;this.accessField=a;this.hintInstence=(e=top.BX.UI.Hint)==null?void 0:e.createInstance();this.hintInstence.init(this.senderSection)}function se(){babelHelpers.classPrivateFieldLooseBase(this,H)[H]();babelHelpers.classPrivateFieldLooseBase(this,C)[C]();babelHelpers.classPrivateFieldLooseBase(this,x)[x]();babelHelpers.classPrivateFieldLooseBase(this,N)[N]();babelHelpers.classPrivateFieldLooseBase(this,R)[R]();this.smtpServerSection=t.Tag.render(v||(v=o`
			<div class="ui-slider-section">
				<div class="ui-slider-content-box">
					<div class="ui-slider-heading-4">${0}</div>
					${0}
					${0}
					${0}
					${0}
					${0}
				</div>
			</div>
		`),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_SMTP_SECTION_TITLE"),this.smtpEmailRow,this.smtpServerRow,this.smtpPortAndSafeConnectionRow,this.smtpLoginRow,this.smtpPasswordRow)}function ie(){const{root:e,emailField:s}=t.Tag.render(h||(h=o`
			<div class="ui-form-row">
				<div class="ui-ctl-top">
					<div class="ui-form-label">${0}</div>
				</div>
				<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">
					<input type="email" name="email" class="ui-ctl-element" data-name="email" placeholder="info@example.com" ref="emailField">
				</div>
			</div>
		`),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_EMAIL"));this.smtpEmailRow=e;this.emailField=s}function ae(){const{root:e,serverField:s}=t.Tag.render(p||(p=o`
			<div class="ui-form-row">
				<div class="ui-ctl-top">
					<div class="ui-form-label">${0}</div>
				</div>
				<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">
					<input type="text" name="server" class="ui-ctl-element" data-name="server" placeholder="smtp.example.com" ref="serverField">
				</div>
			</div>
		`),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_SERVER"));this.smtpServerRow=e;this.serverField=s}function ne(){const{root:e,portField:s,sslField:i}=t.Tag.render(b||(b=o`
			<div class="ui-form-row">
				<div class="ui-ctl-top">
					<div class="ui-form-label">${0}</div>
				</div>
				<div class="ui-form-row-inline" style="margin-bottom: 0">
					<div class="ui-form-row">
						<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">
						<input type="text" 
							class="ui-ctl-element" 
							data-name="port" 
							placeholder="555"
							ref="portField"
						>
						</div>
					</div>
					<div class="ui-form-row">
						<label class="ui-ctl ui-ctl-checkbox">
							<input type="checkbox" class="ui-ctl-element" value="Y" data-name="ssl" ref="sslField">
							<div class="ui-ctl-label-text">${0}</div>
						</label>
					</div>
				</div>
			</div>
		`),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_PORT"),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_SSL"));this.smtpPortAndSafeConnectionRow=e;this.portField=s;this.sslField=i}function re(){const{root:e,loginField:s}=t.Tag.render(m||(m=o`
			<div class="ui-form-row">
				<div class="ui-ctl-top">
					<div class="ui-form-label">${0}</div>
				</div>
				<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">
					<input type="text" class="ui-ctl-element" data-name="login" ref="loginField">
				</div>
			</div>
		`),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_LOGIN"));this.smtpLoginRow=e;this.loginField=s;t.Event.bind(this.emailField,"input",(()=>{this.loginField.value=this.emailField.value}))}function le(){const{root:e,passwordField:s}=t.Tag.render(L||(L=o`
			<div class="ui-form-row">
				<div class="ui-ctl-top">
					<div class="ui-form-label">${0}</div>
				</div>
				<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">
					<input type="password" class="ui-ctl-element" data-name="password" ref="passwordField">
				</div>
			</div>
		`),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_PASSWORD"));this.smtpPasswordRow=e;this.passwordField=s}function oe(){const{root:e,senderLimitCheckbox:s,senderLimitField:i}=t.Tag.render(I||(I=o`
			<div class="ui-slider-section">
				<div class="ui-slider-content-box">
					<div class="ui-slider-heading-4">${0}</div>
					<div class="ui-form-row">
						<div class="ui-form-label" data-form-row-hidden="">
							<label class="ui-ctl ui-ctl-checkbox smtp-editor-limit-checkbox">
								<input type="checkbox" class="ui-ctl-element" data-name="hasLimit" ref="senderLimitCheckbox">
								<div class="ui-ctl-label-text">${0}</div>
							</label>
						</div>
						<div class="ui-form-row-hidden">
							<div class="ui-form-row">
								<div class="ui-ctl-top">
									<div class="ui-form-label">${0}</div>
								</div>
								<div class="ui-ctl ui-ctl-textbox ui-ctl-w25">
									<input type="number" class="ui-ctl-element" data-name="limit" value="250" min="0" ref="senderLimitField">
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		`),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_SENDER_LIMIT_SECTION_TITLE"),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_SENDER_LIMIT_SETTINGS"),t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_SENDER_LIMIT_TITLE"));this.limitSection=e;this.senderLimitCheckbox=s;this.senderLimitField=i}function de(e=null){if(e){const t=this.alertNode.querySelector("span");t.textContent=e}t.Dom.style(this.alertNode,"display","block")}function ce(){t.Dom.style(this.alertNode,"display","none")}function ue(){this.requiredFields=[{row:this.smtpEmailRow,input:this.emailField,type:"email"},{row:this.smtpServerRow,input:this.serverField,type:"server"},{row:this.smtpPortAndSafeConnectionRow,input:this.portField,type:"port"},{row:this.smtpLoginRow,input:this.loginField,type:"login"}];if(!this.senderId){this.requiredFields.push({row:this.smtpPasswordRow,input:this.passwordField,type:"pass"})}}function ve(){let e=0;this.requiredFields.forEach((s=>{if(!babelHelpers.classPrivateFieldLooseBase(this,X)[X](s.type,s.input.value)){return}e++;t.Dom.addClass(s.row,"ui-ctl-warning");const i=babelHelpers.classPrivateFieldLooseBase(this,G)[G](s.type,s.input.value);const a=t.Tag.render(S||(S=o`
				<div class="ui-mail-field-error-message ui-ctl-bottom">${0}</div>
			`),i);t.Dom.append(a,s.row);if(this.topEmptyNode){return}this.topEmptyNode=s.row;this.topEmptyNode.scrollIntoView()}));return e>0}function he(){var e;if(!this.requiredFields){return}this.requiredFields.forEach((e=>{t.Dom.removeClass(e.row,"ui-ctl-warning");const s=e.row.querySelector(".ui-mail-field-error-message");if(t.Type.isDomNode(s)){t.Dom.remove(s)}}));this.topEmptyNode=null;(e=this.invalidFieldNode)==null?void 0:e.remove()}function pe(e,t){if(t.length===0){return true}if(e==="port"&&(!Number.isInteger(Number(t))||t<0||t>65535)){return true}return e==="email"&&!P.test(t)}function be(e,s){switch(e){case"email":if(t.Type.isString(s)&&s.length>0){return t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_INVALID_EMAIL")}return t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_EMPTY_EMAIL");case"server":return t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_EMPTY_SERVER");case"port":return t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_INVALID_PORT");case"login":return t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_EMPTY_LOGIN");default:return t.Loc.getMessage("UI_MAIL_SMTP_SLIDER_EMPTY_PASSWORD")}}function me(e){this.nameField.value=e}let Le=e=>e,Ie,Se,fe,Pe,ge,_e,Fe,ye,Ee,Te,Me,Be,De,Ae,we,He,Ce,xe,Ne,Re;const Oe="mailbox";const Ue="sender";const je="mailboxSender";const ke="alias";const Ke="mail-mailbox-config-success";const $e="mail-mailbox-config-delete";const Xe="mailAliasSlider";var Ge=babelHelpers.classPrivateFieldLooseKey("senderNameNodes");var qe=babelHelpers.classPrivateFieldLooseKey("createContentContainer");var Ve=babelHelpers.classPrivateFieldLooseKey("createAddSenderContainer");var Ye=babelHelpers.classPrivateFieldLooseKey("addAliasPromise");var We=babelHelpers.classPrivateFieldLooseKey("createToolbarButtons");var Ze=babelHelpers.classPrivateFieldLooseKey("renderSenderItem");var ze=babelHelpers.classPrivateFieldLooseKey("renderSenderNameContainer");var Je=babelHelpers.classPrivateFieldLooseKey("renderSenderEditNode");var Qe=babelHelpers.classPrivateFieldLooseKey("renderSenderExtraInfoContainer");var et=babelHelpers.classPrivateFieldLooseKey("getExtraInfoText");var tt=babelHelpers.classPrivateFieldLooseKey("renderSenderEditContainer");var st=babelHelpers.classPrivateFieldLooseKey("renderSenderAuthorContainer");var it=babelHelpers.classPrivateFieldLooseKey("renderUserInfoNode");var at=babelHelpers.classPrivateFieldLooseKey("renderDeleteButton");var nt=babelHelpers.classPrivateFieldLooseKey("renderSettingsButton");var rt=babelHelpers.classPrivateFieldLooseKey("renderSubmitButton");var lt=babelHelpers.classPrivateFieldLooseKey("renderCancelButton");var ot=babelHelpers.classPrivateFieldLooseKey("addSenders");var dt=babelHelpers.classPrivateFieldLooseKey("openSmtpSettings");var ct=babelHelpers.classPrivateFieldLooseKey("openMailboxSettings");var ut=babelHelpers.classPrivateFieldLooseKey("hasNameInvalidCharacters");var vt=babelHelpers.classPrivateFieldLooseKey("checkAliasCounter");var ht=babelHelpers.classPrivateFieldLooseKey("isMainSender");class pt{constructor(e){Object.defineProperty(this,ht,{value:Nt});Object.defineProperty(this,vt,{value:xt});Object.defineProperty(this,ut,{value:Ct});Object.defineProperty(this,ct,{value:Ht});Object.defineProperty(this,dt,{value:wt});Object.defineProperty(this,ot,{value:At});Object.defineProperty(this,lt,{value:Dt});Object.defineProperty(this,rt,{value:Bt});Object.defineProperty(this,nt,{value:Mt});Object.defineProperty(this,at,{value:Tt});Object.defineProperty(this,it,{value:Et});Object.defineProperty(this,st,{value:yt});Object.defineProperty(this,tt,{value:Ft});Object.defineProperty(this,et,{value:_t});Object.defineProperty(this,Qe,{value:gt});Object.defineProperty(this,Je,{value:Pt});Object.defineProperty(this,ze,{value:ft});Object.defineProperty(this,Ze,{value:St});Object.defineProperty(this,We,{value:It});Object.defineProperty(this,Ye,{value:Lt});Object.defineProperty(this,Ve,{value:mt});Object.defineProperty(this,qe,{value:bt});this.wasSenderUpdated=false;this.aliasCounter=0;Object.defineProperty(this,Ge,{writable:true,value:new Map});this.senderId=Number(e.senderId);this.email=e.email;this.setSender=e.setSenderCallback;this.updateSenderList=e.updateSenderList;babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]();babelHelpers.classPrivateFieldLooseBase(this,We)[We]()}static openSlider(e){const t=new pt(e);const i=function(e){const[s]=e.getData();if(!s){return}const i=s.getEventId();const a=s.getData();const n=Number(s.data.id);const r=BX.SidePanel.Instance.getSlider(Xe);if(i===Ke){t.wasSenderUpdated=true;t.updateMainSenderName(n);if(r){r.close()}return}if(i===$e){t.wasSenderUpdated=true;if(t.id===Number(n)){t.setSender()}if(r){r.close()}if(a&&a.type!==Ue){BX.SidePanel.Instance.postMessage(window,s.getEventId(),s.getData)}}};BX.SidePanel.Instance.open(Xe,{width:800,cacheable:false,contentCallback:()=>s.Layout.createContent({extensions:["ui.mail.sender-editor"],title:e.email,design:{section:false,margin:false},content(){return t.loadSliderContent()},toolbar(){return t.getToolbarButtons()},buttons:()=>{}}),events:{onClose:()=>{top.BX.Event.EventEmitter.unsubscribe("SidePanel.Slider:onMessage",i);if(t.updateSenderList&&t.wasSenderUpdated){t.updateSenderList()}}}});top.BX.Event.EventEmitter.subscribe("SidePanel.Slider:onMessage",i)}getContentContainer(){return this.contentContainer}getToolbarButtons(){const e=[];if(this.settingsButton){e.push(this.settingsButton)}return e}loadSliderContent(){return BX.ajax.runAction("main.api.mail.sender.getSenderTransitionalData",{data:{senderId:this.senderId}}).then((e=>{var t;const s=e.data;const i=(t=s.senders)!=null?t:null;this.id=Number(s.id);this.email=s.email;babelHelpers.classPrivateFieldLooseBase(this,ot)[ot](i);const a=s.type||null;switch(a){case Oe:this.settingsButton.bindEvent("click",(()=>{babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](s.href)}));break;case Ue:this.settingsButton.bindEvent("click",(()=>{babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](s.id)}));break;default:this.settingsButton.setDisabled();break}return this.getContentContainer()})).catch((()=>{this.settingsButton.setDisabled();return this.getContentContainer()}))}updateMainSenderName(e){return BX.ajax.runAction("main.api.mail.sender.getSenderByMailboxId",{data:{mailboxId:e}}).then((e=>{var t;const s=(t=e.data)==null?void 0:t.name;if(!s||!this.mainSenderNameNode){return}this.mainSenderNameNode.innerText=s})).catch((()=>{}))}}function bt(){this.senderList=t.Tag.render(Ie||(Ie=Le`
			<div class="mail-sender-list"></div>
		`));babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]();this.contentContainer=t.Tag.render(Se||(Se=Le`
			<div class="ui-form">
				<div class="ui-slider-section">
					<div class="ui-slider-content-box" style="margin-bottom: 0">
						<div class="ui-slider-heading-4 sender-list-header">${0}</div>
						${0}
						${0}
					</div>
				</div>
			</div>
		`),t.Text.encode(t.Loc.getMessage("UI_MAIL_ALIAS_SLIDER_EMAIL_TITLE")),this.senderList,this.addSenderContainer)}function mt(){this.senderInput=t.Tag.render(fe||(fe=Le`
			<input type="text" class="ui-ctl-element" data-name="aliasName" placeholder="${0}">
		`),t.Text.encode(t.Loc.getMessage("UI_MAIL_ALIAS_SLIDER_ADD_INPUT_PLACEHOLDER")));this.senderInputContainer=t.Tag.render(Pe||(Pe=Le`
			<div class="add-sender-input-container" hidden>
				<div class="ui-ctl ui-ctl-textbox ui-ctl-default-light ui-ctl-sm ui-ctl-w100">
					${0}
				</div>
			</div>
		`),this.senderInput);t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]((()=>babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]()),this.senderInput),this.senderInputContainer);t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]((()=>{t.Dom.hide(this.senderInputContainer);t.Dom.show(this.senderAddButton);this.senderInput.value=null})),this.senderInputContainer);this.senderAddButton=t.Tag.render(ge||(ge=Le`
			<div class="add-sender-button">${0}</div>
		`),t.Text.encode(t.Loc.getMessage("UI_MAIL_ALIAS_SLIDER_ADD_BUTTON")));t.Event.bind(this.senderAddButton,"click",(()=>{t.Dom.hide(this.senderAddButton);t.Dom.show(this.senderInputContainer);this.senderInput.focus()}));this.addSenderContainer=t.Tag.render(_e||(_e=Le`
			<div class="add-sender-container">
				${0}
				${0}
			</div>
		`),this.senderInputContainer,this.senderAddButton)}function Lt(){return new Promise((e=>{const s=()=>{t.Dom.hide(this.senderInputContainer);t.Dom.show(this.senderAddButton);this.senderInput.value=null;e()};if(this.senderInput.value.trim().length===0){s();return}if(babelHelpers.classPrivateFieldLooseBase(this,ut)[ut](this.senderInput.value.trim())){e();return}const i=this.senderInput.value;t.ajax.runAction("main.api.mail.sender.addAlias",{data:{name:i,email:this.email}}).then((e=>{var a,n;const r=e.data;const l=r.senderId;if(this.setSender&&r.senderId){this.setSender(r.senderId,i,this.email)}this.wasSenderUpdated=true;this.senderId=l;const o=babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]({id:l,name:i,isOwner:true,type:ke,canEdit:true,userUrl:(a=r.userUrl)!=null?a:null,avatar:(n=r.avatar)!=null?n:null});t.Dom.append(o,this.senderList);this.aliasCounter++;s()})).catch((()=>{s()}))}))}function It(){this.settingsButton=new n.Button({text:t.Loc.getMessage("UI_MAIL_ALIAS_SLIDER_MAIL_SETTINGS_BUTTON"),icon:n.Button.Icon.SETTING,color:n.Button.Color.LIGHT_BORDER})}function St(e){const s=t.Tag.render(Fe||(Fe=Le`<div class="sender-list-item"></div>`));const{root:i,textNode:a}=babelHelpers.classPrivateFieldLooseBase(this,ze)[ze](e.name);let n=null;if(e.canEdit){const{nameEditContainer:s,editInput:r}=babelHelpers.classPrivateFieldLooseBase(this,Je)[Je](e,a);t.Dom.append(s,i);n=()=>{r.value=i.innerText;t.Dom.hide(a);t.Dom.show(s);r.focus()};t.Event.bind(a,"click",n)}t.Dom.append(i,s);t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe](e),s);t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,st)[st](e,s),s);t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,tt)[tt](e,s,n),s);if(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht](e)){this.mainSenderNameNode=i.querySelector(".sender-item-name-text-container")}babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge].set(e.id,a);return s}function ft(e){const{root:s,textNode:i}=t.Tag.render(ye||(ye=Le`
			<div class="sender-item-name-container">
				<div class="sender-item-name-text-container" ref="textNode">
					${0}
				</div>
			</div>
		`),t.Text.encode(e));return{root:s,textNode:i}}function Pt(e,s){const i=s;const{root:a,editInput:n}=t.Tag.render(Ee||(Ee=Le`
			<div class="edit-sender-container-content" ref="editContent">
				<div class="ui-ctl ui-ctl-textbox ui-ctl-default-light ui-ctl-sm ui-ctl-w100">
					<input type="text" class="ui-ctl-element" ref="editInput" placeholder="${0}">
				</div>
			</div>
		`),t.Loc.getMessage("UI_MAIL_ALIAS_SLIDER_ADD_INPUT_PLACEHOLDER"));const r=a;const l=()=>new Promise((a=>{const l=()=>{n.value=s.innerText;t.Dom.hide(r);t.Dom.show(i);a()};if(n.value.length===0||n.value===s.innerText){l();return}if(babelHelpers.classPrivateFieldLooseBase(this,ut)[ut](n.value)){a();return}const o=n.value;t.ajax.runAction("main.api.mail.sender.updateSenderName",{data:{senderId:e.id,name:o}}).then((()=>{i.innerText=o;if(this.setSender){this.setSender(e.id,o,this.email)}this.wasSenderUpdated=true;l()})).catch((()=>{l()}))}));t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,rt)[rt](l,n),a);const o=()=>{t.Dom.hide(r);t.Dom.show(i);n.value=null};t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt](o),a);t.Dom.hide(a);return{nameEditContainer:r,editInput:n}}function gt(e){return t.Tag.render(Te||(Te=Le`
			<div class="sender-item-type-container">${0}</div>
		`),t.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,et)[et](e)))}function _t(e){if(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht](e)){return t.Loc.getMessage("UI_MAIL_ALIAS_EDITOR_CURRENT_SENDER_NAME")}if([Ue,je].includes(e.type)){return t.Loc.getMessage("UI_MAIL_ALIAS_EDITOR_ANOTHER_SENDER_NAME")}if(e.type===ke&&e.isOwner){return t.Loc.getMessage("UI_MAIL_ALIAS_EDITOR_ADDITIONAL_SENDER_NAME")}return""}function Ft(e,s,i){const a=t.Tag.render(Me||(Me=Le`
			<div class="sender-item-edit-container"></div>
		`));if(!e.canEdit&&!e.isOwner){return a}const n=t.Tag.render(Be||(Be=Le`
			<div class="sender-item-btn ui-btn ui-btn-xs ui-icon-set --pencil-50"></div>
		`));t.Dom.append(n,a);if(i){t.Event.bind(n,"click",i)}if(e.type===ke){t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,at)[at](e.id,s),a);return a}t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt](e.type,e.id,e.editHref),a);return a}function yt(e,s){const i=t.Tag.render(De||(De=Le`
			<div class="sender-item-author-container"></div>
		`));if(e.userUrl){var a;t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,it)[it](e.userUrl,(a=e.avatar)!=null?a:null),i)}return i}function Et(e,s){const{root:i,userAvatarContainer:a}=t.Tag.render(Ae||(Ae=Le`
			<div class="sender-item-owner-info">
				${0}
				<a href="${0}" class="ui-icon ui-icon-common-user sender-item-owner-avatar" ref="userAvatarContainer"></a> 
			</div>
		`),t.Loc.getMessage("UI_MAIL_ALIAS_EDITOR_ANOTHER_USER_SENDER_NAME"),t.Text.encode(e));let n="";if(s){n=t.Tag.render(we||(we=Le`<i style="background-image: url('${0}')"></i>`),t.Text.encode(s))}else{n=t.Tag.render(He||(He=Le`<div class="sender-item-owner-avatar-icon ui-icon-set --person"></div>`))}t.Dom.append(n,a);return i}function Tt(e,s){const i=t.Tag.render(Ce||(Ce=Le`
			<div class="sender-item-btn ui-btn ui-btn-xs ui-icon-set --trash-bin" style="margin: 0"></div>
		`));t.Event.bind(i,"click",(()=>{t.Dom.removeClass(i,["ui-icon-set","--trash-bin"]);t.Dom.addClass(i,["ui-btn-light","ui ui-btn-wait"]);t.ajax.runAction("main.api.mail.sender.deleteSender",{data:{senderId:e}}).then((()=>{s.remove();this.wasSenderUpdated=true;if(Number(e)===this.senderId){this.setSender()}babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge].delete(e);this.aliasCounter--;babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]()})).catch((()=>{t.Dom.removeClass(i,"ui-btn-wait")}))}));return i}function Mt(e,s,i){const a=t.Tag.render(xe||(xe=Le`
			<div class="sender-item-btn ui-btn ui-btn-xs ui-icon-set --settings-1" style="margin: 0"></div>
		`));if(e===je){t.Event.bind(a,"click",(()=>{babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](i)}));return a}t.Event.bind(a,"click",(()=>{babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](s)}));return a}function Bt(e,s){const i=t.Tag.render(Ne||(Ne=Le`
			<div class="ui-btn ui-btn-xs ui-btn-primary ui-btn-icon-done" style="margin: 0"></div>
		`));t.Event.bind(i,"click",(()=>{t.Dom.addClass(i,"ui ui-btn-wait");e().then((()=>{t.Dom.removeClass(i,"ui-btn-wait")})).catch((()=>{}))}));t.Event.bind(s,"keypress",(e=>{if(e.key==="Enter"){i.click()}}));return i}function Dt(e){const s=t.Tag.render(Re||(Re=Le`
			<div class="sender-item-btn ui-btn ui-btn-xs ui-icon-set --cross-45" style="margin: 0"></div>
		`));t.Event.bind(s,"click",e);return s}function At(e){if(!e){return}e.sort(((e,t)=>e.id-t.id));e.forEach((e=>{if(!this.id){if(e.type===Ue){this.id=e.id}if(e.type===je){this.id=e.mailboxId}}const s=babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze](e);if(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht](e)){t.Dom.prepend(s,this.senderList)}else{t.Dom.append(s,this.senderList)}this.aliasCounter++}))}function wt(e){V.openSlider({senderId:Number(e),setSenderCallback:(e,t,s)=>{if(babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge].has(e)){babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge].get(e).innerText=t}this.setSender(e,t,s);this.wasSenderUpdated=true}})}function Ht(e){BX.SidePanel.Instance.open(e)}function Ct(e){const s=/[^\p{L}\p{N}\p{Zs}\-.'(),]+/gu;if(s.test(e)){top.BX.UI.Notification.Center.notify({content:t.Text.encode(t.Loc.getMessage("UI_MAIL_ALIAS_EDITOR_INVALID_SYMBOLS_NOTIFICATION"))});return true}return false}function xt(){if(this.aliasCounter===0){const e=BX.SidePanel.Instance.getSlider(Xe);if(e){e.close()}}}function Nt(e){return e.type===Ue&&this.id===Number(e.id)||e.type===je&&this.id===Number(e.mailboxId)}e.AliasEditor=pt;e.SmtpEditor=V})(this.BX.UI.Mail=this.BX.UI.Mail||{},BX,BX.UI.SidePanel,BX,BX.UI,BX.UI,BX,BX.UI);
//# sourceMappingURL=sender-editor.bundle.map.js