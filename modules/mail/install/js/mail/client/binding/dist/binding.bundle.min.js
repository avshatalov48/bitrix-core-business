this.BX=this.BX||{};this.BX.Mail=this.BX.Mail||{};(function(e,t,i,a){"use strict";var s;function r(e,t,i){l(e,t);t.set(e,i)}function l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function n(e,t,i){o(e,t);c(i,"get");return b(e,i)}function c(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function o(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function b(e,t){if(t.get){return t.get.call(e)}return t.value}var u=new WeakMap;var v=new WeakMap;var d=new WeakMap;var h=new WeakMap;var p=new WeakMap;var g=new WeakMap;var I=new WeakMap;var f=new WeakMap;var m=new WeakMap;var M=new WeakMap;var _=new WeakMap;var k=new WeakMap;var P=new WeakMap;var T=new WeakMap;var H=new WeakMap;var N=function(){babelHelpers.createClass(e,[{key:"isError",value:function t(i){if(n(e,e,A)[i]!==undefined){return true}return false}},{key:"isActive",value:function e(){return babelHelpers.classPrivateFieldGet(this,v)}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,d)}},{key:"getMessageId",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!t){return babelHelpers.classPrivateFieldGet(this,f)}else{return babelHelpers.classPrivateFieldGet(this,m)}}}]);function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{type:"",id:""};babelHelpers.classCallCheck(this,e);r(this,u,{writable:true,value:void 0});r(this,v,{writable:true,value:false});r(this,d,{writable:true,value:void 0});r(this,h,{writable:true,value:void 0});r(this,p,{writable:true,value:void 0});r(this,g,{writable:true,value:false});r(this,I,{writable:true,value:void 0});r(this,f,{writable:true,value:void 0});r(this,m,{writable:true,value:void 0});r(this,M,{writable:true,value:void 0});r(this,_,{writable:true,value:"ui-btn-wait"});r(this,k,{writable:true,value:void 0});r(this,P,{writable:true,value:{crm:"MAIL_BINDING_CRM_",chat:"MAIL_BINDING_CHAT_",task:"MAIL_BINDING_TASK_",post:"MAIL_BINDING_POST_",meeting:"MAIL_BINDING_MEETING_"}});r(this,T,{writable:true,value:{crm:"MAIL_BINDING_CRM_TITLE",chat:"MAIL_BINDING_CHAT_TITLE",task:"MAIL_BINDING_TASK_TITLE",post:"MAIL_BINDING_POST_TITLE",meeting:"MAIL_BINDING_MEETING_TITLE"}});r(this,H,{writable:true,value:{crm:"mail-binding-crm",chat:"mail-binding-chat",task:"mail-binding-task",post:"mail-binding-post",meeting:"mail-binding-meeting"}});babelHelpers.classPrivateFieldSet(this,k,i["errorType"]);babelHelpers.classPrivateFieldSet(this,f,i["messageId"]);babelHelpers.classPrivateFieldSet(this,d,i["id"]);babelHelpers.classPrivateFieldSet(this,h,i["href"]);babelHelpers.classPrivateFieldSet(this,p,i["type"]);babelHelpers.classPrivateFieldSet(this,m,i["messageSimpleId"]);babelHelpers.classPrivateFieldSet(this,M,i["createHref"]);if(babelHelpers.classPrivateFieldGet(this,d)){babelHelpers.classPrivateFieldSet(this,v,true)}if(this.isActive()){babelHelpers.classPrivateFieldSet(this,u,t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,P)[babelHelpers.classPrivateFieldGet(this,p)]+"ACTIVE"))}else{babelHelpers.classPrivateFieldSet(this,u,t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,P)[babelHelpers.classPrivateFieldGet(this,p)]+"NOT_ACTIVE"+this.getVersionNotActivePhrase()))}}babelHelpers.createClass(e,[{key:"getType",value:function e(){return babelHelpers.classPrivateFieldGet(this,p)}},{key:"onClick",value:function t(i){if(this.isError(babelHelpers.classPrivateFieldGet(this,k))){e.showError(babelHelpers.classPrivateFieldGet(this,k));return}if(this.isActive()){switch(this.getType()){case"chat":BX.Mail.Secretary.getInstance(this.getMessageId(true)).openChat();break;case"task":BX.Mail.Secretary.getInstance(this.getMessageId(true)).onTaskAction("task_view","view_button");break}}else if(!babelHelpers.classPrivateFieldGet(this,g)){switch(this.getType()){case"crm":this.startWait();BX.Mail.Client.Message.List["mail-client-list-manager"].onCrmClick(this.getMessageId());break;case"chat":BX.Mail.Secretary.getInstance(this.getMessageId(true)).openChat();break;case"task":var a=BX.Uri.addParam(babelHelpers.classPrivateFieldGet(this,M),{ta_sec:"mail",ta_el:"create_button"});top.BX.SidePanel.Instance.open(a);break;case"post":top.BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldGet(this,M));break;case"meeting":BX.Mail.Secretary.getInstance(this.getMessageId(true)).openCalendarEvent();break}}}},{key:"getHref",value:function e(){return babelHelpers.classPrivateFieldGet(this,h)}},{key:"setText",value:function e(t){babelHelpers.classPrivateFieldGet(this,I).textContent=t}},{key:"getNode",value:function e(){return babelHelpers.classPrivateFieldGet(this,I)}},{key:"startWait",value:function e(){babelHelpers.classPrivateFieldSet(this,g,true);this.getNode().classList.add(babelHelpers.classPrivateFieldGet(this,_))}},{key:"stopWait",value:function e(){babelHelpers.classPrivateFieldSet(this,g,false);this.getNode().classList.remove(babelHelpers.classPrivateFieldGet(this,_))}},{key:"setActive",value:function e(i){this.stopWait();this.getNode().classList.remove("mail-ui-not-active");this.getNode().classList.add("mail-ui-active");this.setText(t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,P)[this.getType()]+"ACTIVE"));this.getNode().setAttribute("href",i);babelHelpers.classPrivateFieldSet(this,v,true);this.updateTitle()}},{key:"deactivation",value:function e(){this.stopWait();this.getNode().classList.add("mail-ui-not-active");this.getNode().classList.remove("mail-ui-active");this.setText(t.Loc.getMessage("".concat(babelHelpers.classPrivateFieldGet(this,P)[this.getType()],"NOT_ACTIVE").concat(this.getVersionNotActivePhrase())));this.getNode().removeAttribute("href");babelHelpers.classPrivateFieldSet(this,v,false);this.updateTitle()}},{key:"getTitle",value:function e(){return t.Loc.getMessage(babelHelpers.classPrivateFieldGet(this,T)[this.getType()]+(this.isActive()?"_ACTIVE":""))}},{key:"updateTitle",value:function e(){this.getNode().removeAttribute("title");this.getNode().setAttribute("title",this.getTitle())}},{key:"render",value:function e(){var i=this.isActive()?"mail-ui-active":"mail-ui-not-active";var a=t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="mail-ui-binding ui-btn-light-border ui-btn ui-btn-xs ui-btn-round ui-btn-no-caps '," "," js-bind-",'">\n\t\t\t\t',"\n\t\t\t</a>"])),babelHelpers.classPrivateFieldGet(this,H)[this.getType()],i,this.getMessageId(true),babelHelpers.classPrivateFieldGet(this,u));babelHelpers.classPrivateFieldSet(this,I,a);babelHelpers.classPrivateFieldGet(this,I).object=this;this.updateTitle();a.onclick=function(){this.object.onClick()};a.ondblclick=function(e){e.stopPropagation()};a.setActive=function(e){this.object.setActive(e)};a.deactivation=function(){this.object.deactivation()};a.startWait=function(){this.object.startWait()};a.stopWait=function(){this.object.stopWait()};if(babelHelpers.classPrivateFieldGet(this,k)==="crm-install-permission-error"&&this.getHref()){babelHelpers.classPrivateFieldSet(this,k,"crm-install-permission-open-error")}if(this.isActive()&&!this.isError(babelHelpers.classPrivateFieldGet(this,k))){a.setAttribute("href",this.getHref())}return a}},{key:"getVersionNotActivePhrase",value:function e(){return{meeting:"_MSG_1"}[this.getType()]||""}}],[{key:"showError",value:function a(s){i.UI.Notification.Center.notify({content:t.Loc.getMessage(n(e,e,A)[s])})}}]);return e}();var A={writable:true,value:{"crm-install-error":"MAIL_BINDING_CRM_ERROR","calendar-install-error":"MAIL_BINDING_MEETING_ERROR_MSGVER_1","tasks-install-error":"MAIL_BINDING_TASK_ERROR","chat-install-error":"MAIL_BINDING_CHAT_ERROR_MSGVER_1","socialnetwork-install-error":"MAIL_BINDING_POST_ERROR_MSGVER_1","crm-install-permission-error":"MAIL_BINDING_CRM_PERMISSION_SAVE_ERROR","crm-install-permission-open-error":"MAIL_BINDING_CRM_PERMISSION_OPEN_ERROR","crm-install-permission-working-error":"MAIL_BINDING_CRM_PERMISSION_WORKING_ERROR"}};function w(e,t){G(e,t);t.add(e)}function y(e,t,i){G(e,t);t.set(e,i)}function G(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function S(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var E=new WeakMap;var F=new WeakMap;var B=new WeakSet;var C=new WeakSet;var L=new WeakSet;var R=function(){babelHelpers.createClass(e,[{key:"getMailbox",value:function e(){return babelHelpers.classPrivateFieldGet(this,E)}}]);function e(t){var i=this;babelHelpers.classCallCheck(this,e);w(this,L);w(this,C);w(this,B);y(this,E,{writable:true,value:void 0});y(this,F,{writable:true,value:{CRM_ACTIVITY:".mail-binding-crm",TASKS_TASK:".mail-binding-task",IM_CHAT:".mail-binding-chat",BLOG_POST:".mail-binding-post",CALENDAR_EVENT:".mail-binding-meeting"}});babelHelpers.classPrivateFieldSet(this,E,t);S(this,B,W).call(this);a.EventEmitter.subscribe("onPullEvent-mail",(function(e){var t=e.getData();if(t[0]==="messageBindingCreated"&&(t[1]["mailboxId"]===i.getMailbox()||t[1]["mailboxId"]===String(i.getMailbox()))){var a=t[1];var s=a["messageId"];var r=document.querySelector(""+(".js-bind-"+s)+babelHelpers.classPrivateFieldGet(i,F)[a["entityType"]]+"");if(r){r.setActive(a["bindingEntityLink"])}}if(t[0]==="messageBindingDeleted"&&(t[1]["mailboxId"]===i.getMailbox()||t[1]["mailboxId"]===String(i.getMailbox()))){var l=t[1];var n=l["messageId"];var c=document.querySelector(""+(".js-bind-"+n)+babelHelpers.classPrivateFieldGet(i,F)[l["entityType"]]+"");if(c){c.deactivation()}}}))}babelHelpers.createClass(e,null,[{key:"build",value:function e(t){var i=new N(t);return i.render()}},{key:"replaceElement",value:function e(t){var i=t.parentNode;var a=this.build({type:t.getAttribute("bind-type"),id:t.getAttribute("bind-id"),messageId:t.getAttribute("message-id"),messageSimpleId:t.getAttribute("message-simple-id"),href:t.getAttribute("bind-href"),createHref:t.getAttribute("create-href"),errorType:t.getAttribute("error-type")});i.replaceChild(a,t)}},{key:"initButtons",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:document.body;var i=Array.from(t.getElementsByClassName("mail-ui-binding-data"));for(var a=0,s=i;a<s.length;a++){var r=s[a];this.replaceElement(r)}}}]);return e}();function W(){var e=this;BX.PULL.subscribe({type:BX.PullClient.SubscriptionType.Server,moduleId:"mail",command:"unbindItem",callback:function t(i){return S(e,C,D).call(e,i)}})}function D(e){var t=".js-bind-".concat(e.messageId,".mail-binding-").concat(e.type,".mail-ui-active");var i=document.querySelector(t);if(!i){return}i.deactivation();S(this,L,O).call(this)}function O(){BX.Mail.Home.Grid.reloadTable()}e.Binding=R;e.Item=N})(this.BX.Mail.Client=this.BX.Mail.Client||{},BX,BX,BX.Event);
//# sourceMappingURL=binding.bundle.map.js