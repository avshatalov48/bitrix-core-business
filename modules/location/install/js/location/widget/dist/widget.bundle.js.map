{"version":3,"file":"widget.bundle.js","sources":["../src/state.js","../src/mappopup/addressstring.js","../src/mappopup/addressapplier.js","../src/mappopup/popup.js","../src/mappopup/mappopup.js","../src/address/features/basefeature.js","../src/address/address.js","../src/autocomplete/menubottom.js","../src/autocomplete/menu.js","../src/autocomplete/prompt.js","../src/autocomplete/addressstring.js","../src/autocomplete/autocomplete.js","../src/mappopup/photo.js","../src/mappopup/gallery.js","../src/fields/field.js","../src/fields/fields.js","../src/address/features/mapfeature.js","../src/address/features/autocompletefeature.js","../src/address/features/fieldsfeature.js","../src/address/features/mapfeatureauto.js","../src/factory.js","../src/ui-address/switch.js","../src/ui-address/icon.js","../src/ui-address/ui-address.js","../src/widget.js"],"sourcesContent":["/**\n * Contains\n * */\nexport default class State\n{\n\tstatic INITIAL = 'INITIAL';\n\tstatic DATA_INPUTTING = 'DATA_INPUTTING';\n\tstatic DATA_SELECTED = 'DATA_SELECTED';\n\tstatic DATA_SUPPOSED = 'DATA_SUPPOSED';\n\tstatic DATA_LOADING = 'DATA_LOADING';\n\tstatic DATA_LOADED = 'DATA_LOADED';\n}","import {Tag} from 'main.core';\nimport {Address, Format, AddressStringConverter, FormatTemplateType} from 'location.core';\n\nexport default class AddressString\n{\n\t#address;\n\t#element;\n\t#stringElement;\n\t#addressFormat;\n\n\tconstructor(props)\n\t{\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new Error('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\t}\n\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\n\t\tif (!this.#stringElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#stringElement.innerHTML = this.#convertAddressToString(address);\n\n\t\tif (!address && !this.isHidden())\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t\telse if (address && this.isHidden())\n\t\t{\n\t\t\tthis.show();\n\t\t}\n\t}\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tlet result = '';\n\n\t\tif (address)\n\t\t{\n\t\t\tresult = AddressStringConverter.convertAddressToStringTemplate(\n\t\t\t\taddress,\n\t\t\t\tthis.#addressFormat.getTemplate(FormatTemplateType.DEFAULT),\n\t\t\t\tAddressStringConverter.CONTENT_TYPE_HTML,\n\t\t\t\t', ',\n\t\t\t\tthis.#addressFormat\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\t\n\trender(props): Element\n\t{\n\t\tthis.#address = props.address;\n\t\tconst addresStr = this.#convertAddressToString(this.#address);\n\t\tthis.#stringElement = Tag.render`<div class=\"location-map-address-text\">${addresStr}</div>`;\n\n\t\tthis.#element = Tag.render`\n\t\t\t<div class=\"location-map-address-container\">\n\t\t\t\t<div class=\"location-map-address-icon\"></div>\n\t\t\t\t${this.#stringElement}\n\t\t\t</div>`;\n\n\t\tif (addresStr === '')\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\n\t\treturn this.#element;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.#element)\n\t\t{\n\t\t\tthis.#element.style.display = 'block';\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif (this.#element)\n\t\t{\n\t\t\tthis.#element.style.display = 'none';\n\t\t}\n\t}\n\n\tisHidden()\n\t{\n\t\treturn !this.#element || this.#element.style.display === 'none';\n\t}\n}","import {Vue} from 'ui.vue';\nimport {Address, AddressStringConverter} from 'location.core';\n\nexport default Vue.extend({\n\tprops: {\n\t\taddress: {required: true},\n\t\taddressFormat: {required: true},\n\t\tisHidden: {required: true},\n\t},\n\tmethods: {\n\t\thandleApplyClick()\n\t\t{\n\t\t\tthis.$emit('apply', {address: this.address});\n\t\t},\n\t\tconvertAddressToString(address: ?Address): string\n\t\t{\n\t\t\tif (!address)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn address.toString(this.addressFormat, AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA);\n\t\t}\n\t},\n\tcomputed: {\n\t\taddressString()\n\t\t{\n\t\t\tif (!this.address)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.address.toString(this.addressFormat, AddressStringConverter.STRATEGY_TYPE_TEMPLATE_COMMA, AddressStringConverter.CONTENT_TYPE_TEXT);\n\t\t},\n\t\tcontainerStyles()\n\t\t{\n\t\t\treturn {\n\t\t\t\tdisplay: this.isHidden ? 'none' : 'flex'\n\t\t\t};\n\t\t},\n\t\tcontainerClasses()\n\t\t{\n\t\t\treturn this.isHidden ? {hidden: true} : {};\n\t\t},\n\t\tlocalize()\n\t\t{\n\t\t\treturn Vue.getFilteredPhrases('LOCATION_WIDGET_');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"containerClasses\"\n\t\t\t:style=\"containerStyles\"\n\t\t\tclass=\"location-map-address-changed\"\n\t\t>\n\t\t\t<div class=\"location-map-address-changed-inner\">\n\t\t\t<div class=\"location-map-address-changed-title\">\n\t\t\t\t{{localize.LOCATION_WIDGET_AUI_ADDRESS_CHANGED_NEW_ADDRESS}}\n\t\t\t</div>\n\t\t\t<div class=\"location-map-address-changed-text\">{{addressString}}</div>\n\t\t\t</div>\n\t\t\t<button @click=\"handleApplyClick\" type=\"button\" class=\"location-map-address-apply-btn\">\n\t\t\t\t{{localize.LOCATION_WIDGET_AUI_ADDRESS_APPLY}}\n\t\t\t</button>\n\t\t</div>\t\n\t`\n});\n","import {Popup as MainPopup} from 'main.popup';\nimport {Dom} from 'main.core';\n\n/**\n * Popup window, which contains map\n */\nexport default class Popup extends MainPopup\n{\n\tgetBindElement()\n\t{\n\t\treturn this.bindElement;\n\t}\n\n\tadjustPosition(bindOptions: {\n\t\tforceBindPosition?: boolean,\n\t\tforceLeft?: boolean,\n\t\tforceTop?: boolean,\n\t\tposition?: 'right' | 'top' | 'bootom'\n\t}): void\n\t{\n\t\tlet isCustomPosition, isCustomPositionSuccess;\n\n\t\tif (this.bindOptions.position && this.bindOptions.position === 'right')\n\t\t{\n\t\t\tisCustomPosition = true;\n\t\t\tisCustomPositionSuccess = this.#adjustRightPosition();\n\t\t}\n\n\t\tif (!(isCustomPosition && isCustomPositionSuccess))\n\t\t{\n\t\t\tsuper.adjustPosition(bindOptions);\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the popup in right position\n\t * @returns {boolean} an indicator whether or not we have managed to adjust the popup successfully\n\t */\n\t#adjustRightPosition(): boolean\n\t{\n\t\tconst bindElRect = this.bindElement.getBoundingClientRect();\n\t\tconst popupHeight = this.getPopupContainer().offsetHeight;\n\t\tconst popupWidth = this.getPopupContainer().offsetWidth;\n\n\t\t/**\n\t\t * Check if the popup fits in the viewport\n\t\t */\n\t\tif ((bindElRect.left + bindElRect.width + popupWidth) > document.documentElement.clientWidth)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet angleOffsetY = popupHeight / 2;\n\n\t\tconst left = bindElRect.left + bindElRect.width + 10;\n\t\tlet top = window.pageYOffset + bindElRect.top + bindElRect.height / 2 - popupHeight / 2;\n\n\t\tif(top < window.pageYOffset)\n\t\t{\n\t\t\tangleOffsetY -= window.pageYOffset - top;\n\t\t\ttop = window.pageYOffset;\n\t\t}\n\t\telse if(top > window.pageYOffset + document.body.clientHeight - popupHeight)\n\t\t{\n\t\t\tangleOffsetY += top - (window.pageYOffset + document.body.clientHeight - popupHeight);\n\t\t\ttop = window.pageYOffset + document.body.clientHeight - popupHeight;\n\t\t}\n\n\t\tthis.setAngle({position: 'left', offset: angleOffsetY});\n\n\t\tDom.adjust(this.popupContainer, {\n\t\t\tstyle: {\n\t\t\t\ttop: `${top}px`,\n\t\t\t\tleft: `${left}px`,\n\t\t\t\tzIndex: this.getZindex()\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n}\n","import {\n\tTag,\n\tType,\n\tDom,\n\tEvent,\n\tLoc\n} from 'main.core';\nimport {\n\tAddress,\n\tFormat,\n\tLocation,\n\tControlMode,\n\tMapBase,\n\tGeocodingServiceBase,\n\tAddressStringConverter,\n\tLocationType\n} from 'location.core';\nimport {EventEmitter} from 'main.core.events';\nimport AddressString from './addressstring';\nimport AddressApplier from './addressapplier';\nimport Popup from './popup';\n\nimport 'ui.design-tokens';\nimport './css/mappopup.css';\n\nexport default class MapPopup extends EventEmitter\n{\n\tstatic #onChangedEvent = 'onChanged';\n\tstatic #onMouseOverEvent = 'onMouseOver';\n\tstatic #onMouseOutEvent = 'onMouseOut';\n\tstatic #onShowedEvent = 'onShow';\n\tstatic #onClosedEvent = 'onClose';\n\n\t#map;\n\t#mode;\n\t#address;\n\t#popup;\n\t#addressString;\n\t#addressApplier;\n\t#addressFormat;\n\t#gallery;\n\t#locationRepository;\n\t#isMapRendered = false;\n\t#mapInnerContainer;\n\t#geocodingService;\n\t#contentWrapper;\n\t#userLocationPoint;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.MapPopup');\n\n\t\tif (!(props.map instanceof MapBase))\n\t\t{\n\t\t\tBX.debug('map must be instance of Map');\n\t\t}\n\n\t\tthis.#map = props.map;\n\n\t\tif (props.geocodingService instanceof GeocodingServiceBase)\n\t\t{\n\t\t\tthis.#geocodingService = props.geocodingService;\n\t\t}\n\n\t\tthis.#map.onLocationChangedEventSubscribe(this.#onLocationChanged.bind(this));\n\n\t\tif (!(props.popup instanceof Popup))\n\t\t{\n\t\t\tBX.debug('popup must be instance of Popup');\n\t\t}\n\n\t\tthis.#popup = props.popup;\n\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tthis.#addressString = new AddressString({\n\t\t\taddressFormat: this.#addressFormat\n\t\t});\n\t\tthis.#createAddressApplier();\n\n\t\tif (props.gallery)\n\t\t{\n\t\t\tthis.#gallery = props.gallery;\n\t\t}\n\n\t\tthis.#locationRepository = props.locationRepository;\n\t\tthis.#userLocationPoint = props.userLocationPoint;\n\t}\n\n\t#createAddressApplier()\n\t{\n\t\tthis.#addressApplier = new AddressApplier(\n\t\t\t{\n\t\t\t\tpropsData: {\n\t\t\t\t\taddress: this.#address,\n\t\t\t\t\taddressFormat: this.#addressFormat,\n\t\t\t\t\tisHidden: true,\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tthis.#addressApplier.$mount();\n\t\tthis.#addressApplier.$on('apply', (event) => {\n\t\t\tconst prevAddress = event.address;\n\n\t\t\tthis.#address = prevAddress;\n\t\t\tthis.#addressString.address = prevAddress;\n\t\t\tthis.#addressApplier.$props.isHidden = true;\n\n\t\t\tthis.emit(\n\t\t\t\tMapPopup.#onChangedEvent,\n\t\t\t\t{address: prevAddress}\n\t\t\t);\n\t\t});\n\t}\n\n\t#onLocationChanged(event: Event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst location = data.location;\n\t\tconst address = location.toAddress();\n\n\t\tif (!this.#address)\n\t\t{\n\t\t\tthis.#address = address;\n\t\t\tthis.#addressString.address = address;\n\t\t\tthis.emit(\n\t\t\t\tMapPopup.#onChangedEvent,\n\t\t\t\t{address: address}\n\t\t\t);\n\t\t}\n\t\telse if (address.fieldCollection.isEqual(this.#address.fieldCollection, LocationType.ADDRESS_LINE_1))\n\t\t{\n\t\t\tthis.#address.latitude = address.latitude;\n\t\t\tthis.#address.longitude = address.longitude;\n\n\t\t\tif (this.#address.location)\n\t\t\t{\n\t\t\t\tthis.#address.location.latitude = address.latitude;\n\t\t\t\tthis.#address.location.longitude = address.longitude;\n\t\t\t}\n\n\t\t\tthis.emit(\n\t\t\t\tMapPopup.#onChangedEvent,\n\t\t\t\t{address: this.#address}\n\t\t\t);\n\n\t\t\tthis.#addressApplier.$props.isHidden = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#addressString.address = address;\n\t\t\tthis.#addressApplier.$props.address = address;\n\t\t\tthis.#addressApplier.$props.isHidden = false;\n\t\t}\n\n\t\tif (this.#gallery)\n\t\t{\n\t\t\tthis.#gallery.location = location;\n\t\t}\n\t}\n\n\trender(props: object): void\n\t{\n\t\tthis.#address = props.address;\n\t\tthis.#mode = props.mode;\n\t\tthis.#isMapRendered = false;\n\t\tthis.#mapInnerContainer = Tag.render`<div class=\"location-map-inner\"></div>`;\n\t\tthis.#renderPopup(props.bindElement, this.#mapInnerContainer);\n\t}\n\n\t#renderPopup(bindElement: Element, mapInnerContainer: Element): Popup\n\t{\n\t\tlet gallery = '';\n\n\t\tif (this.#gallery)\n\t\t{\n\t\t\tgallery = this.#gallery.render();\n\t\t}\n\n\t\tconst thirdPartyWarningNode = Tag.render`\n\t\t\t<div class=\"location-map-address-third-party-warning\">\n\t\t\t\t${Loc.getMessage('LOCATION_WIDGET_THIRD_PARTY_WARNING')}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#contentWrapper = Tag.render`\n\t\t\t<div class=\"location-map-wrapper\">\n\t\t\t\t<div class=\"location-map-container\">\n\t\t\t\t\t${mapInnerContainer}\n\t\t\t\t\t${gallery}\n\t\t\t\t</div>\n\t\t\t\t${this.#mode === ControlMode.edit ? this.#addressString.render({address: this.#address}) : ''}\n\t\t\t\t${thirdPartyWarningNode}\n\t\t\t\t${this.#mode === ControlMode.edit ? this.#addressApplier.$el : ''}\n\t\t\t</div>`;\n\n\t\tEvent.bind(this.#contentWrapper, 'click', (e) => e.stopPropagation());\n\t\tEvent.bind(this.#contentWrapper, 'mouseover', (e) => this.emit(MapPopup.#onMouseOverEvent, e));\n\t\tEvent.bind(this.#contentWrapper, 'mouseout', (e) => this.emit(MapPopup.#onMouseOutEvent, e));\n\t\tthis.bindElement = bindElement;\n\t\tthis.#popup.setContent(this.#contentWrapper);\n\t}\n\n\tget bindElement()\n\t{\n\t\treturn this.#popup.getBindElement();\n\t}\n\n\tset bindElement(bindElement: Element)\n\t{\n\t\tif (Type.isDomNode(bindElement))\n\t\t{\n\t\t\tthis.#popup.setBindElement(bindElement);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.debug('bindElement must be type of dom node');\n\t\t}\n\t}\n\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\t\tthis.#addressString.address = address;\n\n\t\tthis.#convertAddressToLocation(address)\n\t\t\t.then((location) => {\n\t\t\t\tthis.#setLocationInternal(location);\n\t\t\t});\n\t}\n\n\t#extractLatLon(address: Address): ?Array\n\t{\n\t\tlet result = null;\n\t\tlet lat;\n\t\tlet lon;\n\n\t\tif (address.latitude && address.longitude)\n\t\t{\n\t\t\tlat = address.latitude;\n\t\t\tlon = address.longitude;\n\t\t}\n\t\telse if (address.location\n\t\t\t&& address.location.latitude\n\t\t\t&& address.location.longitude\n\t\t)\n\t\t{\n\t\t\tlat = address.location.latitude;\n\t\t\tlon = address.location.longitude;\n\t\t}\n\n\t\tif (lat && lat !== '0' && lon && lon !== '0')\n\t\t{\n\t\t\tresult = [lat, lon];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#convertAddressToLocation(address: ?Address, useUserLocation: boolean = false): Promise<?Location>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif (useUserLocation)\n\t\t\t{\n\t\t\t\tresolve(\n\t\t\t\t\tthis.#userLocationPoint && this.#mode !== ControlMode.view\n\t\t\t\t\t\t? new Location({\n\t\t\t\t\t\t\tlatitude: this.#userLocationPoint.latitude,\n\t\t\t\t\t\t\tlongitude: this.#userLocationPoint.longitude\n\t\t\t\t\t\t})\n\t\t\t\t\t\t: null\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (address)\n\t\t\t{\n\t\t\t\tconst latLon = this.#extractLatLon(address);\n\n\t\t\t\tif (latLon)\n\t\t\t\t{\n\t\t\t\t\tresolve(new Location({\n\t\t\t\t\t\tlatitude: latLon[0],\n\t\t\t\t\t\tlongitude: latLon[1],\n\t\t\t\t\t\ttype: address.getType()\n\t\t\t\t\t}));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresolve(null);\n\t\t});\n\t}\n\n\t#setLocationInternal(location: ?Location): void\n\t{\n\t\tif (this.#map)\n\t\t{\n\t\t\tthis.#map.location = location;\n\t\t}\n\n\t\tif (this.#gallery)\n\t\t{\n\t\t\tthis.#gallery.location = location;\n\t\t}\n\t}\n\n\tset mode(mode: string): void\n\t{\n\t\tthis.#mode = mode;\n\t\tthis.#map.mode = mode;\n\t}\n\n\t#renderMap({location})\n\t{\n\t\treturn this.#map.render({\n\t\t\tmapContainer: this.#mapInnerContainer,\n\t\t\tlocation: location,\n\t\t\tmode: this.#mode\n\t\t});\n\t}\n\n\tshow(useUserLocation: boolean = false): void\n\t{\n\t\tthis.#convertAddressToLocation(this.#address, useUserLocation)\n\t\t\t.then((location) => {\n\t\t\t\tif (!location)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#popup.show();\n\n\t\t\t\tif (!this.#isMapRendered)\n\t\t\t\t{\n\t\t\t\t\tthis.#renderMap({location})\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tif (this.#gallery)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#gallery.location = location;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.emit(MapPopup.#onShowedEvent);\n\t\t\t\t\t\t\tthis.#map.onMapShow();\n\t\t\t\t\t\t});\n\n\t\t\t\t\tthis.#isMapRendered = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#map.location = location;\n\n\t\t\t\t\tif (this.#gallery)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#gallery.location = location;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.emit(MapPopup.#onShowedEvent);\n\t\t\t\t\tthis.#map.onMapShow();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#popup.isShown();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#popup.close();\n\t\tthis.#addressApplier.$props.isHidden = true;\n\t\tthis.emit(MapPopup.#onClosedEvent);\n\t}\n\n\tonChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onChangedEvent, listener);\n\t}\n\n\tonMouseOverSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onMouseOverEvent, listener);\n\t}\n\n\tonMouseOutSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onMouseOutEvent, listener);\n\t}\n\n\tsubscribeOnShowedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onShowedEvent, listener);\n\t}\n\n\tsubscribeOnClosedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(MapPopup.#onClosedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#map = null;\n\t\tthis.#gallery = null;\n\t\tthis.#addressString = null;\n\t\tthis.#addressApplier = null;\n\n\t\tthis.#popup.destroy();\n\t\tthis.#popup = null;\n\t\tDom.remove(this.#contentWrapper);\n\t\tthis.#contentWrapper = null;\n\t\tEvent.unbindAll(this);\n\t}\n}\n","import {Address, MethodNotImplemented} from \"location.core\";\nimport MapPopup from \"../../mappopup/mappopup\";\n\n/**\n * Base class for the address widget feature\n */\nexport default class BaseFeature\n{\n\t_saveResourceStrategy = false;\n\n\tconstructor(props)\n\t{\n\t\tthis._saveResourceStrategy = props.saveResourceStrategy;\n\t}\n\n\trender(props)\n\t{\n\t\tthrow new MethodNotImplemented('Method render must be implemented');\n\t}\n\n\tsetAddressWidget(addressWidget): void\n\t{\n\t\tthrow new MethodNotImplemented('Method render must be implemented');\n\t}\n\n\tsetAddress(address: Address): void\n\t{\n\t\tthrow new MethodNotImplemented('Method set address must be implemented');\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\n\t}\n\n\tdestroy(): void\n\t{\n\n\t}\n\n\tresetView(): void\n\t{\n\n\t}\n}","import {Type, Event} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {\n\tAddress as AddressEntity,\n\tControlMode,\n\tFormat,\n\tAddressStringConverter,\n\tLocationRepository,\n\tErrorPublisher,\n\tFormatTemplateType,\n\tAddressType,\n\tStorage\n} from 'location.core';\nimport State from '../state';\nimport BaseFeature from './features/basefeature';\nimport {FeatureEvent} from './featurevent';\n\n/**\n * Props for the address widget constructor\n */\nexport type AddressConstructorProps = {\n\t/** @see ControlMode */\n\tmode: string,\n\taddressFormat: Format,\n\taddress?: AddressEntity,\n\tneedWarmBackendAfterAddressChanged?: boolean,\n\tlocationRepository?: LocationRepository,\n};\n\n/**\n * Props for the address widget render method\n */\nexport type AddressRenderProps = {\n\t/** Input control witch will be used by user to enter the address */\n\tinputNode: Element,\n\t/** Control wrapper witch could be used for mouseover event etc. */\n\tcontrolWrapper: Element,\n\t/** If map feature is used it could be used to bind map popup */\n\tmapBindElement: ?Element,\n\t/** If autocomplete feature is used it could be used to bind menu node */\n\tautocompleteMenuElement: ?Element\n};\n\n/**\n * Address widget\n */\nexport default class Address extends EventEmitter\n{\n\t/* If address was changed by user */\n\tstatic onAddressChangedEvent = 'onAddressChanged';\n\t/* If state of the widget was changed */\n\tstatic onStateChangedEvent = 'onStateChanged';\n\t/* Any feature-related events */\n\tstatic onFeatureEvent = 'onFeatureEvent';\n\n\t#mode;\n\t#state;\n\t#address;\n\t#addressFormat;\n\t#languageId;\n\n\t#features = [];\n\n\t#inputNode;\n\t#controlWrapper;\n\n\t#destroyed = false;\n\n\t#isAddressChangedByFeature = false;\n\t#isInputNodeValueUpdated = false;\n\n\t#needWarmBackendAfterAddressChanged = true;\n\t#locationRepository;\n\n\t/**\n\t * Constructor\n\t * @param {AddressConstructorProps} props\n\t */\n\tconstructor(props: AddressConstructorProps)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Address');\n\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tif (props.address && !(props.address instanceof AddressEntity))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = props.address || null;\n\n\t\tif (!(ControlMode.isValid(props.mode)))\n\t\t{\n\t\t\tBX.debug('mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tif (!Type.isString(props.languageId))\n\t\t{\n\t\t\tthrow new TypeError('props.languageId must be type of string');\n\t\t}\n\n\t\tthis.#languageId = props.languageId;\n\n\t\tif (props.features)\n\t\t{\n\t\t\tif (!Type.isArray(props.features))\n\t\t\t{\n\t\t\t\tthrow new TypeError('features must be an array');\n\t\t\t}\n\n\t\t\tprops.features.forEach((feature: BaseFeature) => {\n\t\t\t\tthis.#addFeature(feature);\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isBoolean(props.needWarmBackendAfterAddressChanged))\n\t\t{\n\t\t\tthis.#needWarmBackendAfterAddressChanged = props.needWarmBackendAfterAddressChanged;\n\t\t}\n\n\t\tif (props.locationRepository instanceof LocationRepository)\n\t\t{\n\t\t\tthis.#locationRepository = props.locationRepository;\n\t\t}\n\t\telse if (this.#needWarmBackendAfterAddressChanged)\n\t\t{\n\t\t\tthis.#locationRepository = new LocationRepository();\n\t\t}\n\n\t\tthis.#state = State.INITIAL;\n\t}\n\n\t/**\n\t * @param {AddressEntity} address\n\t * @param {BaseFeature} sourceFeature\n\t * @param {Array} excludeFeatures\n\t * @param {Object} options\n\t * @internal\n\t */\n\tsetAddressByFeature(\n\t\taddress: AddressEntity,\n\t\tsourceFeature: BaseFeature,\n\t\texcludeFeatures: Array = [],\n\t\toptions: Object = {}\n\t): void\n\t{\n\t\tconst addressId = this.#address ? this.#address.id : 0;\n\n\t\tif (\n\t\t\taddress\n\t\t\t&& !address.getFieldValue(AddressType.ADDRESS_LINE_1)\n\t\t\t&& this.#addressFormat.isTemplateExists(FormatTemplateType.ADDRESS_LINE_1)\n\t\t)\n\t\t{\n\t\t\taddress.setFieldValue(\n\t\t\t\tAddressType.ADDRESS_LINE_1,\n\t\t\t\tAddressStringConverter.convertAddressToStringTemplate(\n\t\t\t\t\taddress,\n\t\t\t\t\tthis.#addressFormat.getTemplate(FormatTemplateType.ADDRESS_LINE_1),\n\t\t\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT,\n\t\t\t\t\tnull,\n\t\t\t\t\tthis.#addressFormat\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\tthis.#address = address;\n\n\t\tconst storeAsLastAddress = options.hasOwnProperty('storeAsLastAddress')\n\t\t\t? options.storeAsLastAddress\n\t\t\t: true;\n\t\tif (storeAsLastAddress)\n\t\t{\n\t\t\tthis.#storeAsLastAddress();\n\t\t}\n\n\t\tif (this.#address && addressId > 0)\n\t\t{\n\t\t\tthis.#address.id = addressId;\n\t\t}\n\n\t\tthis.#isAddressChangedByFeature = true;\n\t\tthis.#setInputValue(address);\n\n\t\tthis.#executeFeatureMethod(\n\t\t\t'setAddress',\n\t\t\t[address],\n\t\t\tsourceFeature,\n\t\t\texcludeFeatures\n\t\t);\n\n\t\tif (this.#state !== State.DATA_INPUTTING)\n\t\t{\n\t\t\tthis.#emitOnAddressChanged();\n\t\t}\n\t}\n\n\temitFeatureEvent(featureEvent: FeatureEvent)\n\t{\n\t\tthis.emit(\n\t\t\tAddress.onFeatureEvent,\n\t\t\tfeatureEvent\n\t\t);\n\t}\n\n\t/**\n\t * Add feature to the widget\n\t * @param {BaseFeature} feature\n\t */\n\t#addFeature(feature: BaseFeature)\n\t{\n\t\tif (!(feature instanceof BaseFeature))\n\t\t{\n\t\t\tBX.debug('feature must be instance of BaseFeature');\n\t\t}\n\n\t\tfeature.setAddressWidget(this);\n\t\tthis.#features.push(feature);\n\t}\n\n\tget features()\n\t{\n\t\treturn this.#features;\n\t}\n\n\t#executeFeatureMethod(method, params = [], sourceFeature = null, excludeFeatures = [])\n\t{\n\t\tlet result;\n\n\t\tfor(const feature of this.#features)\n\t\t{\n\t\t\tlet isExcluded = false;\n\t\t\tfor(const excludeFeature of excludeFeatures)\n\t\t\t{\n\t\t\t\tif (feature instanceof excludeFeature)\n\t\t\t\t{\n\t\t\t\t\tisExcluded = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!isExcluded && feature !== sourceFeature)\n\t\t\t{\n\t\t\t\tresult = feature[method].apply(feature, params);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#emitOnAddressChanged()\n\t{\n\t\tthis.emit(\n\t\t\tAddress.onAddressChangedEvent,\n\t\t\t{address: this.#address}\n\t\t);\n\n\t\tif (this.#address && this.#needWarmBackendAfterAddressChanged)\n\t\t{\n\t\t\tthis.#warmBackendAfterAddressChanged(this.#address);\n\t\t}\n\t}\n\n\t#warmBackendAfterAddressChanged(address: AddressEntity): void\n\t{\n\t\tif (address.location !== null && address.location.id <= 0)\n\t\t{\n\t\t\tthis.#locationRepository.findParents(address.location);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onInputFocus(e: KeyboardEvent)\n\t{\n\t\tconst value = this.#inputNode.value;\n\n\t\tif (value.length > 0)\n\t\t{\n\t\t\tBX.setCaretPosition(this.#inputNode, value.length);\n\t\t}\n\t}\n\n\t#convertAddressToString(\n\t\taddress: ?Address,\n\t\ttemplateType: string\n\t): string\n\t{\n\t\tlet result = '';\n\n\t\tif (address)\n\t\t{\n\t\t\tif (!this.#addressFormat.isTemplateExists(templateType))\n\t\t\t{\n\t\t\t\tconsole.error(`Address format \"${this.#addressFormat.code}\" does not have a template \"${templateType}\"`);\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tresult = AddressStringConverter.convertAddressToStringTemplate(\n\t\t\t\taddress,\n\t\t\t\tthis.#addressFormat.getTemplate(templateType),\n\t\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT,\n\t\t\t\t', ',\n\t\t\t\tthis.#addressFormat\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#setInputValue(address: ?Address)\n\t{\n\t\tif (this.#inputNode)\n\t\t{\n\t\t\tconst shortAddressString = this.#convertAddressToString(address, FormatTemplateType.AUTOCOMPLETE);\n\t\t\tconst fullAddressString = this.#convertAddressToString(address, FormatTemplateType.DEFAULT);\n\t\t\tthis.#inputNode.value = shortAddressString.trim() !== '' ? shortAddressString : fullAddressString;\n\t\t\tthis.#inputNode.title = fullAddressString;\n\t\t\tconst selectionStart = this.#inputNode.selectionStart;\n\t\t\tconst selectionEnd = shortAddressString.length;\n\t\t\tthis.#inputNode.setSelectionRange(selectionStart, selectionEnd);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onInputFocusOut(e: Event)\n\t{\n\t\t// Seems that we don't have any autocompleter feature\n\t\tif (this.#isInputNodeValueUpdated && !this.#isAddressChangedByFeature)\n\t\t{\n\t\t\tconst value = this.#inputNode.value.trim();\n\t\t\tconst address = new AddressEntity({languageId: this.#languageId});\n\t\t\taddress.setFieldValue(this.#addressFormat.fieldForUnRecognized, value);\n\t\t\tthis.address = address;\n\t\t\tthis.#emitOnAddressChanged();\n\t\t}\n\n\t\tthis.#isInputNodeValueUpdated = false;\n\t\tthis.#isAddressChangedByFeature = false;\n\t}\n\n\tonInputKeyup(e: KeyboardEvent)\n\t{\n\t\tswitch (e.code)\n\t\t{\n\t\t\tcase 'Tab':\n\t\t\tcase 'Esc':\n\t\t\tcase 'Enter':\n\t\t\tcase 'NumpadEnter':\n\t\t\t\tthis.resetView();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonInputInput(e)\n\t{\n\t\tthis.#isInputNodeValueUpdated = true;\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.#executeFeatureMethod('resetView');\n\t}\n\n\t/**\n\t * Render Widget\n\t * @param {AddressRenderProps} props\n\t */\n\trender(props: AddressRenderProps): void\n\t{\n\t\tif (!Type.isDomNode(props.controlWrapper))\n\t\t{\n\t\t\tBX.debug('props.controlWrapper must be instance of Element');\n\t\t}\n\n\t\tthis.#controlWrapper = props.controlWrapper;\n\n\t\tif (this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tif (!Type.isDomNode(props.inputNode))\n\t\t\t{\n\t\t\t\tBX.debug('props.inputNode must be instance of Element');\n\t\t\t}\n\n\t\t\tthis.#inputNode = props.inputNode;\n\t\t\tthis.#setInputValue(this.#address);\n\t\t}\n\n\t\tthis.#executeFeatureMethod('render', [props]);\n\n\t\t// We can prevent these events in features if need\n\t\tif (this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tEvent.bind(this.#inputNode, 'focus', this.#onInputFocus.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'focusout', this.#onInputFocusOut.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'keyup', this.onInputKeyup.bind(this));\n\t\t\tEvent.bind(this.#inputNode, 'input', this.onInputInput.bind(this));\n\t\t}\n\t}\n\n\tget controlWrapper()\n\t{\n\t\treturn this.#controlWrapper;\n\t}\n\n\tget inputNode()\n\t{\n\t\treturn this.#inputNode;\n\t}\n\n\tget address(): ?AddressEntity\n\t{\n\t\treturn this.#address;\n\t}\n\n\tset address(address: ?AddressEntity): void\n\t{\n\t\tif (address && !(address instanceof AddressEntity))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = address;\n\t\tthis.#storeAsLastAddress();\n\t\tthis.#executeFeatureMethod('setAddress', [address]);\n\t\tthis.#isInputNodeValueUpdated = false;\n\t\tthis.#isAddressChangedByFeature = false;\n\t\tthis.#setInputValue(address);\n\t}\n\n\tget mode()\n\t{\n\t\treturn this.#mode;\n\t}\n\n\tset mode(mode: string): void\n\t{\n\t\tif (!(ControlMode.isValid(mode)))\n\t\t{\n\t\t\tBX.debug('mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = mode;\n\n\t\tthis.#executeFeatureMethod('setMode', [mode]);\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\tget addressFormat(): Format\n\t{\n\t\treturn this.#addressFormat;\n\t}\n\n\tsetStateByFeature(state: string)\n\t{\n\t\tthis.#state = state;\n\n\t\tthis.emit(\n\t\t\tAddress.onStateChangedEvent,\n\t\t\t{state: state}\n\t\t);\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onStateChangedEvent, listener);\n\t}\n\n\tsubscribeOnAddressChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onAddressChangedEvent, listener);\n\t}\n\n\tsubscribeOnFeatureEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Address.onFeatureEvent, listener);\n\t}\n\n\tsubscribeOnErrorEvent(listener: Function): void\n\t{\n\t\tErrorPublisher.getInstance().subscribe(listener);\n\t}\n\n\t#storeAsLastAddress()\n\t{\n\t\tif (\n\t\t\tthis.#address\n\t\t\t&& this.#address.fieldCollection\n\t\t\t&& this.#address.fieldCollection.isFieldExists(AddressType.LOCALITY)\n\t\t)\n\t\t{\n\t\t\tStorage.getInstance().lastAddress = this.#address;\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.#destroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.unbindAll(this);\n\t\tEvent.unbind(this.#inputNode, 'focus', this.#onInputFocus);\n\t\tEvent.unbind(this.#inputNode, 'focusout', this.#onInputFocusOut);\n\t\tEvent.unbind(this.#inputNode, 'keyup', this.onInputKeyup);\n\t\tEvent.unbind(this.#inputNode, 'input', this.onInputInput);\n\n\t\tthis.#executeFeatureMethod('destroy');\n\t\tthis.#destroyFeatures();\n\t\tthis.#destroyed = true;\n\t}\n\n\t#destroyFeatures()\n\t{\n\t\tthis.#features.splice(0, this.#features.length);\n\t}\n\n\tisDestroyed()\n\t{\n\t\treturn this.#destroyed;\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport {Tag} from 'main.core';\n\nexport default class MenuBottom extends EventEmitter\n{\n\t#node;\n\t#leftItemNodeContainer;\n\t#rightItemNodeContainer;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Autocomplete.MenuBottom');\n\t}\n\n\trender()\n\t{\n\t\tthis.#leftItemNodeContainer = Tag.render`<div class=\"location-map-popup-item--info-left\"></div>`;\n\t\tthis.#rightItemNodeContainer = Tag.render`<div></div>`;\n\n\t\tthis.#node = Tag.render`\n\t\t\t<div>\n\t\t\t\t<span class=\"location-map-popup-item--info\"> \t\t\n\t\t\t\t\t${this.#leftItemNodeContainer}\n\t\t\t\t\t${this.#rightItemNodeContainer}\n\t\t\t\t</span>\t\t\t\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#node;\n\t}\n\n\tsetRightItemNode(node: Element): void\n\t{\n\t\twhile (this.#rightItemNodeContainer.firstChild)\n\t\t{\n\t\t\tthis.#rightItemNodeContainer.removeChild(this.#rightItemNodeContainer.firstChild);\n\t\t}\n\n\t\tthis.#rightItemNodeContainer.appendChild(node);\n\t}\n\n\tsetLeftItemNode(node: Element): void\n\t{\n\t\twhile (this.#leftItemNodeContainer.firstChild)\n\t\t{\n\t\t\tthis.#leftItemNodeContainer.removeChild(this.#leftItemNodeContainer.firstChild);\n\t\t}\n\n\t\tthis.#leftItemNodeContainer.appendChild(node);\n\t}\n}","import {Menu as MainMenu} from 'main.popup';\nimport './css/menu.css';\nimport MenuBottom from './menubottom';\n\nexport default class Menu extends MainMenu\n{\n\tchoseItemIdx = -1;\n\t#bottom;\n\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tconst elRect = options.bindElement.getBoundingClientRect();\n\t\tthis.popupWindow.setMaxWidth(elRect.width);\n\t\tthis.#bottom = new MenuBottom();\n\t\tthis.layout.menuContainer.appendChild(\n\t\t\tthis.#bottom.render()\n\t\t);\n\t}\n\n\tisMenuEmpty(): boolean\n\t{\n\t\treturn this.menuItems.length <= 0;\n\t}\n\n\tisChoseLastItem(): boolean\n\t{\n\t\treturn this.choseItemIdx >= this.menuItems.length - 1;\n\t}\n\n\tisChoseFirstItem(): boolean\n\t{\n\t\treturn this.choseItemIdx === 0;\n\t}\n\n\tisItemChosen(): boolean\n\t{\n\t\treturn this.choseItemIdx >= 0;\n\t}\n\n\tisDestroyed(): boolean\n\t{\n\t\treturn this.getPopupWindow().isDestroyed();\n\t}\n\n\tisItemExist(index: number): boolean\n\t{\n\t\treturn typeof this.menuItems[index] !== 'undefined';\n\t}\n\n\tgetChosenItem()\n\t{\n\t\tlet result = null;\n\n\t\tif(this.isItemChosen() && this.isItemExist(this.choseItemIdx))\n\t\t{\n\t\t\tresult = this.menuItems[this.choseItemIdx];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchooseNextItem(): void\n\t{\n\t\tif(!this.isMenuEmpty() && !this.isChoseLastItem())\n\t\t{\n\t\t\tthis.chooseItem(this.choseItemIdx + 1);\n\t\t}\n\n\t\treturn this.getChosenItem();\n\t}\n\n\tchoosePrevItem(): void\n\t{\n\t\tif(!this.isMenuEmpty() && !this.isChoseFirstItem())\n\t\t{\n\t\t\tthis.chooseItem(this.choseItemIdx - 1);\n\t\t}\n\n\t\treturn this.getChosenItem();\n\t}\n\n\thighlightItem(index: number): void\n\t{\n\t\tif(this.isItemExist(index))\n\t\t{\n\t\t\tconst item = this.getChosenItem();\n\n\t\t\tif(item && item.layout.item)\n\t\t\t{\n\t\t\t\titem.layout.item.classList.add('highlighted');\n\t\t\t}\n\t\t}\n\t}\n\n\tunHighlightItem(index: number): void\n\t{\n\t\tif(this.isItemExist(index))\n\t\t{\n\t\t\tconst item = this.getChosenItem();\n\n\t\t\tif(item && item.layout.item)\n\t\t\t{\n\t\t\t\titem.layout.item.classList.remove('highlighted');\n\t\t\t}\n\t\t}\n\t}\n\n\tchooseItem(index: number)\n\t{\n\t\tlet idx = index;\n\n\t\tif(idx < 0)\n\t\t{\n\t\t\tidx = this.menuItems.length - 1;\n\t\t}\n\t\telse if(idx > this.menuItems.length - 1)\n\t\t{\n\t\t\tidx = 0;\n\t\t}\n\n\t\tthis.unHighlightItem(this.choseItemIdx);\n\t\tthis.choseItemIdx = idx;\n\t\tthis.highlightItem(this.choseItemIdx);\n\t}\n\n\tclearItems()\n\t{\n\t\twhile(this.menuItems.length > 0)\n\t\t{\n\t\t\tthis.removeMenuItem(this.menuItems[0].id);\n\t\t}\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.getPopupWindow().isShown();\n\t}\n\n\tsetBottomRightItemNode(node: Element): void\n\t{\n\t\tthis.#bottom.setRightItemNode(node);\n\t}\n\n\tsetBottomLeftItemNode(node: Element): void\n\t{\n\t\tthis.#bottom.setLeftItemNode(node);\n\t}\n}\n","import {EventEmitter} from 'main.core.events';\nimport {Loc} from 'main.core';\nimport {Location, Address, AddressType, LocationType} from 'location.core';\nimport Menu from './menu';\n\nexport default class Prompt extends EventEmitter\n{\n\tstatic onItemSelectedEvent = 'onItemSelected';\n\n\t/** Element */\n\t#inputNode;\n\n\t/** Element */\n\t#menuNode;\n\n\t/** {Menu} */\n\t#menu;\n\n\t/** {Array<Location>} */\n\t#locationList;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.Prompt');\n\n\t\tthis.#inputNode = props.inputNode;\n\n\t\tif (props.menuNode)\n\t\t{\n\t\t\tthis.#menuNode = props.menuNode;\n\t\t}\n\t}\n\n\t#createMenu()\n\t{\n\t\treturn new Menu({\n\t\t\tbindElement: this.#menuNode ? this.#menuNode : this.#inputNode,\n\t\t\tautoHide: false,\n\t\t\tcloseByEsc: true,\n\t\t\tclassName: 'location-widget-prompt-menu',\n\t\t});\n\t}\n\n\tgetMenu(): Menu\n\t{\n\t\tif(!this.#menu || this.#menu.isDestroyed())\n\t\t{\n\t\t\tthis.#menu = this.#createMenu();\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t/**\n\t * Show menu with list of locations\n\t * @param {array} locationsList\n\t * @param {string} searchPhrase\n\t * @returns void\n\t */\n\tshow(locationsList: Array<Location>, searchPhrase: string): void\n\t{\n\t\tif(locationsList.length > 0)\n\t\t{\n\t\t\tthis.setMenuItems(locationsList, searchPhrase);\n\t\t\tthis.getMenu().show();\n\t\t}\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.getMenu().close();\n\t}\n\n\t/**\n\t * @param {array<Location>} locationsList\n\t * @param {string} searchPhrase\n\t * @param {Address} address\n\t * @returns {*}\n\t */\n\tsetMenuItems(locationsList: Array<Location>, searchPhrase: string, address: ?Address): Menu\n\t{\n\t\tthis.getMenu().clearItems();\n\n\t\tif(Array.isArray(locationsList))\n\t\t{\n\t\t\tthis.#locationList = locationsList.slice();\n\n\t\t\tconst showFlatList = (\n\t\t\t\t!address\n\t\t\t\t|| !address.getFieldValue(AddressType.LOCALITY)\n\t\t\t\t|| !Prompt.#hasLocationWithLocality(this.#locationList)\n\t\t\t);\n\n\t\t\tif (showFlatList)\n\t\t\t{\n\t\t\t\tlocationsList.forEach((location, index) => {\n\t\t\t\t\tthis.getMenu().addMenuItem(\n\t\t\t\t\t\tthis.#createMenuItem(index, location, searchPhrase)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlocationsList.forEach((location, index) => {\n\t\t\t\t\tif (this.#isAddressOfSameLocation(address, location)) {\n\t\t\t\t\t\tthis.getMenu().addMenuItem(\n\t\t\t\t\t\t\tthis.#createMenuItem(index, location, searchPhrase)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlet isSeparatorSet = false;\n\t\t\t\tlocationsList.forEach((location, index) => {\n\t\t\t\t\tif (!this.#isAddressOfSameLocation(address, location)) {\n\t\t\t\t\t\tif (!isSeparatorSet)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getMenu().addMenuItem({\n\t\t\t\t\t\t\t\thtml: Loc.getMessage('LOCATION_WIDGET_PROMPT_IN_OTHER_CITY'),\n\t\t\t\t\t\t\t\tdelimiter: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.getMenu().addMenuItem(\n\t\t\t\t\t\t\tthis.#createMenuItem(index, location, searchPhrase)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tisSeparatorSet = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t#isAddressOfSameLocation(address, location)\n\t{\n\t\treturn (\n\t\t\taddress\n\t\t\t&& address.getFieldValue(AddressType.LOCALITY)\n\t\t\t&& location\n\t\t\t&& location.address\n\t\t\t&& location.address.getFieldValue(AddressType.LOCALITY)\n\t\t\t&& Prompt.#getAddressPossibleLocalities(location.address).includes(\n\t\t\t\taddress.getFieldValue(AddressType.LOCALITY)\n\t\t\t)\n\t\t);\n\t}\n\n\tstatic #getAddressPossibleLocalities(address: Address)\n\t{\n\t\tconst result = [];\n\n\t\tif (address.getFieldValue(AddressType.LOCALITY))\n\t\t{\n\t\t\tresult.push(address.getFieldValue(AddressType.LOCALITY));\n\t\t}\n\n\t\t/**\n\t\t * Address break-down formed on frontend is very inaccurate so we can't rely only on the locality type field\n\t\t * @see #142094\n\t\t */\n\t\tif (address.getFieldValue(AddressType.ADM_LEVEL_1))\n\t\t{\n\t\t\tresult.push(address.getFieldValue(AddressType.ADM_LEVEL_1));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * @param {array<Location>} locationsList\n\t * @returns boolean\n\t */\n\tstatic #hasLocationWithLocality(locationsList: Array<Location>): boolean\n\t{\n\t\tfor (let location of locationsList)\n\t\t{\n\t\t\tif (location.address && location.address.getFieldValue(AddressType.LOCALITY))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * @param {number} index\n\t * @param {Location} location\n\t * @param {string} searchPhrase\n\t * @returns {{onclick: onclick, text: string}}\n\t */\n\t#createMenuItem(index, location: Location, searchPhrase): Object\n\t{\n\t\treturn {\n\t\t\tid: index,\n\t\t\ttitle: location.name,\n\t\t\thtml: Prompt.createMenuItemText(location.name, searchPhrase, location),\n\t\t\tonclick: (event, item) => {\n\t\t\t\tthis.#onItemSelect(index);\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t};\n\t}\n\n\t#onItemSelect(index: number): void\n\t{\n\t\tconst location = this.#getLocationFromList(index);\n\n\t\tif(location)\n\t\t{\n\t\t\tthis.emit(Prompt.onItemSelectedEvent, {location: location});\n\t\t}\n\t}\n\n\tstatic createMenuItemText(locationName: string, searchPhrase: string, location: Location): string\n\t{\n\t\tlet result = `\n\t\t<div>\n\t\t\t<strong>${locationName}</strong>\n\t\t</div>`;\n\n\t\tlet clarification;\n\n\t\tif(location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION))\n\t\t{\n\t\t\tclarification = location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION);\n\n\t\t\tif(clarification)\n\t\t\t{\n\t\t\t\tif(location.getFieldValue(LocationType.TMP_TYPE_HINT))\n\t\t\t\t{\n\t\t\t\t\tclarification += ` <i>(${location.getFieldValue(LocationType.TMP_TYPE_HINT)})</i>`;\n\t\t\t\t}\n\n\t\t\t\tresult += `<div>${clarification}</div>`;\n\t\t\t}\n\t\t}\n\n\t\treturn '<div data-role=\"location-widget-menu-item\" tabindex=\"-1\">' + result + '</div>';\n\t}\n\n\tstatic #extractClarification(location: Location): string\n\t{\n\t\tlet clarification = '';\n\n\t\tif(location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION))\n\t\t{\n\t\t\tclarification = location.getFieldValue(LocationType.TMP_TYPE_CLARIFICATION);\n\t\t}\n\n\t\treturn clarification;\n\t}\n\n\t#getLocationFromList(index: number): ?Location\n\t{\n\t\tlet result = null;\n\n\t\tif (this.#locationList[index] !== undefined)\n\t\t{\n\t\t\tresult = this.#locationList[index];\n\t\t}\n\n\t\tif(!result)\n\t\t{\n\t\t\tBX.debug(`Location with index ${index} was not found`);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchoosePrevItem(isRecursive: boolean = false)\n\t{\n\t\tlet result = null;\n\t\tconst item = this.getMenu().choosePrevItem();\n\n\t\tif (item)\n\t\t{\n\t\t\tif (item.delimiter && item.delimiter === true)\n\t\t\t{\n\t\t\t\tresult = isRecursive ? this.getMenu().chooseNextItem() : this.choosePrevItem(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = this.#getLocationFromList(this.getMenu().choseItemIdx);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tchooseNextItem()\n\t{\n\t\tlet result = null;\n\t\tconst item = this.getMenu().chooseNextItem();\n\n\t\tif (item)\n\t\t{\n\t\t\tif (item.delimiter && item.delimiter === true)\n\t\t\t{\n\t\t\t\tresult = this.chooseNextItem();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = this.#getLocationFromList(this.getMenu().choseItemIdx);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisItemChosen()\n\t{\n\t\treturn this.getMenu().isItemChosen();\n\t}\n\n\tgetChosenItem()\n\t{\n\t\tlet result = null;\n\t\tconst menuItem = this.getMenu().getChosenItem();\n\n\t\tif(menuItem && menuItem.id)\n\t\t{\n\t\t\tresult = this.#getLocationFromList(this.getMenu().choseItemIdx);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.getMenu().isShown();\n\t}\n\n\tdestroy()\n\t{\n\t\tif(this.#menu)\n\t\t{\n\t\t\tthis.#menu.destroy();\n\t\t\tthis.#menu = null;\n\t\t}\n\n\t\tthis.#locationList = null;\n\t}\n}\n","import {Format, FormatTemplateType, AddressStringConverter, Address} from 'location.core';\n\nexport default class AddressString\n{\n\t// Input node element\n\t#input = null;\n\t// Address string value\n\t#value = '';\n\t// Address string as it was without custom inputs\n\t#pureAddressString = '';\n\t#addressFormat = null;\n\n\tconstructor(input: HTMLInputElement, addressFormat: Format, address: ?Address)\n\t{\n\t\tif (!(input instanceof HTMLInputElement))\n\t\t{\n\t\t\tthrow new TypeError('Wrong input type');\n\t\t}\n\n\t\tthis.#input = input;\n\n\t\tif (!(addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new TypeError('Wrong addressFormat type');\n\t\t}\n\n\t\tthis.#addressFormat = addressFormat;\n\n\t\tif (address && !(address instanceof Address))\n\t\t{\n\t\t\tthrow new TypeError('Wrong address type');\n\t\t}\n\t\tif (address)\n\t\t{\n\t\t\tthis.setValueFromAddress(address);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param {string} value Address string value\n\t * @param {boolean} isPureAddress Does it contain user input or not\n\t */\n\tsetValue(value: string, isPureAddress: boolean = false): void\n\t{\n\t\tthis.#value = value;\n\t\tthis.#input.value = value;\n\n\t\tif (isPureAddress)\n\t\t{\n\t\t\tthis.#pureAddressString = value;\n\t\t}\n\n\t\tthis.#actualizePureString();\n\t}\n\n\tactualize()\n\t{\n\t\tthis.#value = this.#input.value;\n\t\tthis.#actualizePureString();\n\t}\n\n\t#actualizePureString()\n\t{\n\t\tif (this.#isPureAddressStringModified())\n\t\t{\n\t\t\tthis.#pureAddressString = '';\n\t\t}\n\t}\n\n\tisChanged()\n\t{\n\t\treturn this.#value.trim() !== this.#input.value.trim();\n\t}\n\n\tget value(): string\n\t{\n\t\treturn this.#value;\n\t}\n\n\tget customTail()\n\t{\n\t\tif (this.#pureAddressString === '')\n\t\t{\n\t\t\treturn this.#value;\n\t\t}\n\n\t\tlet result;\n\n\t\tif (!this.#isPureAddressStringModified())\n\t\t{\n\t\t\tresult = this.#value.slice(this.#pureAddressString.length);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = this.#value;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\thasPureAddressString()\n\t{\n\t\treturn this.#pureAddressString !== '';\n\t}\n\n\t// We suggest that user will input data after the address data\n\t#isPureAddressStringModified(): boolean\n\t{\n\t\treturn this.#value === ''\n\t\t\t|| this.#pureAddressString === ''\n\t\t\t|| this.#value.indexOf(this.#pureAddressString) !== 0;\n\t}\n\n\tsetValueFromAddress(address: ?Address): void\n\t{\n\t\tlet value = '';\n\n\t\tif (address)\n\t\t{\n\t\t\tvalue = this.#convertAddressToString(address, FormatTemplateType.AUTOCOMPLETE);\n\n\t\t\tif (value.trim() === '')\n\t\t\t{\n\t\t\t\tvalue = this.#convertAddressToString(address, FormatTemplateType.DEFAULT);\n\t\t\t}\n\t\t}\n\n\t\tthis.setValue(value, true);\n\t}\n\n\t#convertAddressToString(address: Address, templateType: string): string\n\t{\n\t\tif (!this.#addressFormat.isTemplateExists(templateType))\n\t\t{\n\t\t\tconsole.error(`Address format \"${this.#addressFormat.code}\" does not have a template \"${templateType}\"`);\n\t\t\treturn '';\n\t\t}\n\n\t\treturn AddressStringConverter.convertAddressToStringTemplate(\n\t\t\taddress,\n\t\t\tthis.#addressFormat.getTemplate(templateType),\n\t\t\tAddressStringConverter.CONTENT_TYPE_TEXT,\n\t\t\t', ',\n\t\t\tthis.#addressFormat\n\t\t);\n\t}\n}","import {Event, Loc, Tag} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {\n\tLocationRepository,\n\tAutocompleteServiceBase,\n\tFormat,\n\tAddress,\n\tLocation,\n\tErrorPublisher,\n\tAddressType,\n\tStorage,\n\tPoint\n} from 'location.core';\nimport type {AutocompleteServiceParams} from 'location.core';\nimport Prompt from './prompt';\nimport State from '../state';\nimport AddressString from './addressstring';\n\n/**\n * @mixes EventEmitter\n */\nexport default class Autocomplete extends EventEmitter\n{\n\tstatic #onAddressChangedEvent = 'onAddressChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\tstatic #onSearchStartedEvent = 'onSearchStarted';\n\tstatic #onSearchCompletedEvent = 'onSearchCompleted';\n\tstatic #onShowOnMapClickedEvent = 'onShowOnMapClicked';\n\n\t/** {Address} */\n\t#address;\n\t/** {AddressString|null} */\n\t#addressString = null;\n\t/** {String} */\n\t#languageId;\n\t/** {Format} */\n\t#addressFormat;\n\t/** {String} */\n\t#sourceCode;\n\t/** {LocationRepository} */\n\t#locationRepository;\n\t/** {Point} */\n\t#userLocationPoint;\n\t/** {Function} */\n\t#presetLocationsProvider;\n\t/** {Prompt} */\n\t#prompt;\n\t/** {AutocompleteServiceBase} */\n\t#autocompleteService;\n\t/** {number} */\n\t#timerId = null;\n\t/** {Element} */\n\t#inputNode;\n\n\t#searchPhrase = {\n\t\trequested: '',\n\t\tcurrent: '',\n\t\tdropped: ''\n\t};\n\n\t#state;\n\t#wasCleared = false;\n\t#isDestroyed = false;\n\n\t#isAutocompleteRequestStarted = false;\n\t#isNextAutocompleteRequestWaiting = false;\n\n\t#onLocationSelectTimerId = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Autocomplete');\n\n\t\tif (!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tthrow new Error('props.addressFormat must be type of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\n\t\tif (!(props.autocompleteService instanceof AutocompleteServiceBase))\n\t\t{\n\t\t\tthrow new Error('props.autocompleteService must be type of AutocompleteServiceBase');\n\t\t}\n\n\t\tthis.#autocompleteService = props.autocompleteService;\n\n\t\tif (!props.languageId)\n\t\t{\n\t\t\tthrow new Error('props.languageId must be defined');\n\t\t}\n\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#sourceCode = props.sourceCode;\n\t\tthis.#address = props.address;\n\t\tthis.#presetLocationsProvider = props.presetLocationsProvider;\n\t\tthis.#locationRepository = props.locationRepository || new LocationRepository();\n\t\tthis.#userLocationPoint = props.userLocationPoint;\n\t\tthis.#setState(State.INITIAL);\n\t}\n\n\trender(props: {}): void\n\t{\n\t\tthis.#inputNode = props.inputNode;\n\t\tthis.#address = props.address;\n\t\tthis.#addressString = new AddressString(this.#inputNode, this.#addressFormat, this.#address);\n\t\tthis.#inputNode.addEventListener('keydown', this.#onInputKeyDown.bind(this));\n\t\tthis.#inputNode.addEventListener('keyup', this.#onInputKeyUp.bind(this));\n\t\tthis.#inputNode.addEventListener('focus', this.#onInputFocus.bind(this));\n\t\tthis.#inputNode.addEventListener('focusout', this.#onInputFocusOut.bind(this));\n\t\tthis.#inputNode.addEventListener('click', this.#onInputClick.bind(this));\n\t\tthis.#inputNode.addEventListener('paste', this.#onInputPaste.bind(this));\n\n\t\tthis.#prompt = new Prompt({\n\t\t\tinputNode: props.inputNode,\n\t\t\tmenuNode: props.menuNode,\n\t\t});\n\n\t\tthis.#prompt.subscribe(Prompt.onItemSelectedEvent, this.#onPromptItemSelected.bind(this));\n\t\tdocument.addEventListener('click', this.#onDocumentClick.bind(this));\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onInputClick(e: MouseEvent)\n\t{\n\t\tconst value = this.#addressString.value;\n\n\t\tif (value.length === 0)\n\t\t{\n\t\t\tthis.#showPresetLocations();\n\t\t}\n\t}\n\n\t#showPresetLocations()\n\t{\n\t\tconst presetLocationList = this.#presetLocationsProvider();\n\n\t\tthis.#prompt.setMenuItems(presetLocationList, '');\n\n\t\tlet leftBottomMenuMessage;\n\n\t\tif (presetLocationList.length > 0)\n\t\t{\n\t\t\tleftBottomMenuMessage = Loc.getMessage('LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tleftBottomMenuMessage = Loc.getMessage('LOCATION_WIDGET_START_PRINTING_OR_SHOW_ON_MAP');\n\t\t}\n\n\t\tthis.#showMenu(leftBottomMenuMessage, null);\n\t}\n\n\t#createRightBottomMenuNode(location: ?Location): Element\n\t{\n\t\tconst element = Tag.render`\n\t\t\t\t<span class=\"location-map-popup-item--show-on-map\">\n\t\t\t\t\t${Loc.getMessage('LOCATION_WIDGET_SHOW_ON_MAP')}\n\t\t\t\t</span>\n\t\t`;\n\n\t\telement.addEventListener('click', this.#getShowOnMapHandler(location));\n\n\t\treturn element;\n\t}\n\n\t#createLeftBottomMenuNode(text: string): Element\n\t{\n\t\treturn Tag.render`\n\t\t\t\t<span>\n\t\t\t\t\t<span class=\"menu-popup-item-icon\"></span>\n\t\t\t\t\t<span class=\"menu-popup-item-text\">${text}</span>\n\t\t\t\t</span>\n\t\t`;\n\t}\n\n\t#showMenu(leftBottomText: string, location: ?Location): void\n\t{\n\t\t/* Menu destroys popup after the closing, so we need to refresh it every time, we show it */\n\t\tthis.#prompt.getMenu().setBottomRightItemNode(\n\t\t\tthis.#createRightBottomMenuNode(location)\n\t\t);\n\t\tthis.#prompt.getMenu().setBottomLeftItemNode(\n\t\t\tthis.#createLeftBottomMenuNode(leftBottomText)\n\t\t);\n\t\tthis.#prompt.getMenu().show();\n\t}\n\n\t#onInputFocusOut(e: Event)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis.#state === State.DATA_INPUTTING\n\t\t\t&& !(\n\t\t\t\te.relatedTarget\n\t\t\t\t&& (e.relatedTarget.getAttribute('data-role') === 'location-widget-menu-item')\n\t\t\t)\n\t\t) {\n\t\t\tthis.#setState(State.DATA_SUPPOSED);\n\n\t\t\tlet isChanged = false;\n\t\t\tif (this.#addressString) {\n\t\t\t\tif (\n\t\t\t\t\t!this.#address\n\t\t\t\t\t|| !this.#addressString.hasPureAddressString()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.#address = this.#convertStringToAddress(\n\t\t\t\t\t\tthis.#addressString.value\n\t\t\t\t\t);\n\t\t\t\t\tisChanged = true;\n\t\t\t\t}\n\t\t\t\t// this.#addressString === null until autocompete'll be rendered\n\t\t\t\telse if (this.#addressString.customTail !== '')\n\t\t\t\t{\n\t\t\t\t\tconst currentValue = this.#address.getFieldValue(this.#addressFormat.fieldForUnRecognized);\n\t\t\t\t\tconst newValue = currentValue\n\t\t\t\t\t\t? currentValue + this.#addressString.customTail\n\t\t\t\t\t\t: this.#addressString.customTail\n\t\t\t\t\t;\n\t\t\t\t\tthis.#address.setFieldValue(\n\t\t\t\t\t\tthis.#addressFormat.fieldForUnRecognized,\n\t\t\t\t\t\tnewValue\n\t\t\t\t\t);\n\t\t\t\t\tisChanged = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isChanged)\n\t\t\t{\n\t\t\t\tthis.#addressString.setValueFromAddress(this.#address);\n\t\t\t\tthis.#onAddressChangedEventEmit([], {storeAsLastAddress: false});\n\t\t\t}\n\t\t}\n\n\t\t// Let's prevent other onInputFocusOut handlers.\n\t\te.stopImmediatePropagation();\n\t}\n\n\t#onInputFocus()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#address)\n\t\t{\n\t\t\tconst lastAddress = Storage.getInstance().lastAddress;\n\n\t\t\tif (\n\t\t\t\tlastAddress\n\t\t\t\t&& lastAddress.fieldCollection.isFieldExists(AddressType.LOCALITY)\n\t\t\t\t&& !this.#wasCleared\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst fieldCollection = {};\n\n\t\t\t\tfieldCollection[AddressType.LOCALITY] = lastAddress.fieldCollection.getFieldValue(\n\t\t\t\t\tAddressType.LOCALITY\n\t\t\t\t);\n\t\t\t\tif (lastAddress.fieldCollection.isFieldExists(AddressType.COUNTRY))\n\t\t\t\t{\n\t\t\t\t\tfieldCollection[AddressType.COUNTRY] = lastAddress.fieldCollection.getFieldValue(AddressType.COUNTRY);\n\t\t\t\t}\n\t\t\t\tif (lastAddress.fieldCollection.isFieldExists(AddressType.ADM_LEVEL_1))\n\t\t\t\t{\n\t\t\t\t\tfieldCollection[AddressType.ADM_LEVEL_1] = lastAddress.fieldCollection.getFieldValue(AddressType.ADM_LEVEL_1);\n\t\t\t\t}\n\n\t\t\t\tif (['RU', 'RU_2'].includes(this.#addressFormat.code))\n\t\t\t\t{\n\t\t\t\t\tfieldCollection[AddressType.ADDRESS_LINE_2] = ', ';\n\t\t\t\t}\n\n\t\t\t\tthis.#address = new Address({\n\t\t\t\t\tlanguageId: lastAddress.languageId,\n\t\t\t\t\tfieldCollection: fieldCollection,\n\t\t\t\t});\n\t\t\t\tthis.#addressString.setValueFromAddress(this.#address);\n\t\t\t\tthis.#setState(State.DATA_SUPPOSED);\n\t\t\t\tthis.#onAddressChangedEventEmit(\n\t\t\t\t\t[],\n\t\t\t\t\t{storeAsLastAddress: false}\n\t\t\t\t);\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tBX.setCaretPosition(this.#inputNode, this.#inputNode.value.length);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.#address\n\t\t\t\t&& (!this.#address.location || !this.#address.location.hasExternalRelation())\n\t\t\t\t&& this.#addressString.value.length > 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.showPrompt(this.#addressString.value);\n\t\t\t}\n\t\t}\n\t}\n\n\t#makeAutocompleteServiceParams(): AutocompleteServiceParams\n\t{\n\t\tconst result: AutocompleteServiceParams = {};\n\n\t\t//result.biasPoint = this.#userLocationPoint;\n\t\tif (this.#address && this.#address.latitude && this.#address.longitude)\n\t\t{\n\t\t\tresult.biasPoint = new Point(\n\t\t\t\tthis.#address.latitude,\n\t\t\t\tthis.#address.longitude\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * @param address\n\t */\n\tset address(address: ?Address): void\n\t{\n\t\tthis.#address = address;\n\n\t\tif (this.#addressString) // already rendered\n\t\t{\n\t\t\tthis.#addressString.setValueFromAddress(this.#address);\n\t\t}\n\n\t\tif (!address)\n\t\t{\n\t\t\tthis.#wasCleared = true;\n\t\t}\n\t}\n\n\t/**\n\t * @returns {Address}\n\t */\n\tget address(): ?Address\n\t{\n\t\treturn this.#address;\n\t}\n\n\t/**\n\t * Close menu on mouse click outside\n\t * @param {MouseEvent} event\n\t */\n\t#onDocumentClick(event: MouseEvent)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.target === this.#inputNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#prompt.isShown())\n\t\t{\n\t\t\tthis.#prompt.close();\n\t\t}\n\t}\n\n\t/**\n\t * Subscribe on changed event\n\t * @param {Function} listener\n\t */\n\tonAddressChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onAddressChangedEvent, listener);\n\t}\n\n\t/**\n\t * Subscribe on loading event\n\t * @param {Function} listener\n\t */\n\tonStateChangedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onStateChangedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonSearchStartedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onSearchStartedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonSearchCompletedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onSearchCompletedEvent, listener);\n\t}\n\n\t/**\n\t * @param {Function} listener\n\t */\n\tonShowOnMapClickedEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Autocomplete.#onShowOnMapClickedEvent, listener);\n\t}\n\n\t/**\n\t * Is called when autocompleteService returned location list\n\t * @param {array} locationsList\n\t * @param {object} params\n\t */\n\t#onPromptsReceived(locationsList: array<Location>, params: Object): void\n\t{\n\t\tif (Array.isArray(locationsList) && locationsList.length > 0)\n\t\t{\n\t\t\tif (\n\t\t\t\tlocationsList.length === 1\n\t\t\t\t&& this.#address\n\t\t\t\t&& this.#address.location\n\t\t\t\t&& this.#address.location.externalId\n\t\t\t\t&& this.#address.location.externalId === locationsList[0].externalId\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.closePrompt();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#prompt.setMenuItems(locationsList, this.#searchPhrase.requested, this.address);\n\t\t\tthis.#showMenu(Loc.getMessage('LOCATION_WIDGET_PICK_ADDRESS_OR_SHOW_ON_MAP'), locationsList[0]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#prompt.getMenu().clearItems();\n\n\t\t\tthis.#prompt.getMenu().addMenuItem(\n\t\t\t\t{\n\t\t\t\t\tid: 'notFound',\n\t\t\t\t\thtml: `<span>${Loc.getMessage('LOCATION_WIDGET_PROMPT_ADDRESS_NOT_FOUND')}</span>`,\n\t\t\t\t\t// eslint-disable-next-line no-unused-vars\n\t\t\t\t\tonclick: (event, item) => {\n\t\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.#showMenu(Loc.getMessage('LOCATION_WIDGET_CHECK_ADDRESS_OR_SHOW_ON_MAP'), null);\n\t\t}\n\t}\n\n\t#getShowOnMapHandler(location: ?Location)\n\t{\n\t\treturn () => {\n\t\t\tif (location)\n\t\t\t{\n\t\t\t\tthis.#fulfillSelection(location);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Otherwise this click will close just opened map popup.\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.emit(Autocomplete.#onShowOnMapClickedEvent);\n\t\t\t}, 1);\n\t\t};\n\t}\n\n\tstatic #splitPhrase(phrase: string): Object\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tphrase = phrase.trim();\n\n\t\tif (phrase.length <= 0)\n\t\t{\n\t\t\treturn ['', ''];\n\t\t}\n\n\t\tconst tailPosition = phrase.lastIndexOf(' ');\n\n\t\tif (tailPosition <= 0)\n\t\t{\n\t\t\treturn ['', ''];\n\t\t}\n\n\t\treturn [phrase.slice(0, tailPosition), phrase.slice(tailPosition + 1)];\n\t}\n\n\t/**\n\t * Is called when location from menu have chosen\n\t * @param event\n\t */\n\t#onPromptItemSelected(event: BaseEvent): void\n\t{\n\t\tif (event.data.location)\n\t\t{\n\t\t\tthis.#fulfillSelection(event.data.location);\n\t\t}\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Autocomplete.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\t/**\n\t * Fulfill selected location\n\t * @param {Location} location\n\t * @returns {Promise}\n\t */\n\t#fulfillSelection(location: ?Location): void\n\t{\n\t\tlet result;\n\t\tthis.#setState(State.DATA_SELECTED);\n\t\tif (location)\n\t\t{\n\t\t\tif (location.hasExternalRelation() && this.#sourceCode === location.sourceCode)\n\t\t\t{\n\t\t\t\tresult = this.#getLocationDetails(location)\n\t\t\t\t\t.then(\n\t\t\t\t\t\t(detailedLocation: ?Location) => {\n\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tlocation.address\n\t\t\t\t\t\t\t\t&& location.address.getFieldValue(AddressType.ADDRESS_LINE_2)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet addressLine2 = '';\n\t\t\t\t\t\t\t\tif (detailedLocation.address.getFieldValue(AddressType.ADDRESS_LINE_2))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\taddressLine2 = detailedLocation.address.getFieldValue(AddressType.ADDRESS_LINE_2);\n\t\t\t\t\t\t\t\t\taddressLine2 += ', ';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\taddressLine2 += location.address.getFieldValue(AddressType.ADDRESS_LINE_2);\n\n\t\t\t\t\t\t\t\tdetailedLocation.address.setFieldValue(AddressType.ADDRESS_LINE_2, addressLine2);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.#createOnLocationSelectTimer(detailedLocation, 0);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(response) => ErrorPublisher.getInstance().notify(response.errors)\n\t\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = new Promise((resolve) => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.#createOnLocationSelectTimer(location, 0);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}, 0);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = new Promise((resolve) => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.#createOnLocationSelectTimer(null, 0);\n\t\t\t\t\tresolve();\n\t\t\t\t}, 0);\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#onAddressChangedEventEmit(excludeSetAddressFeatures: Array = [], options: Object = {})\n\t{\n\t\tthis.emit(\n\t\t\tAutocomplete.#onAddressChangedEvent,\n\t\t\t{\n\t\t\t\taddress: this.#address,\n\t\t\t\texcludeSetAddressFeatures,\n\t\t\t\toptions: options,\n\t\t\t}\n\t\t);\n\t}\n\n\t/**\n\t * obtain location details\n\t * @param {Location} location\n\t * @returns {*}\n\t */\n\t#getLocationDetails(location: Location): Promise\n\t{\n\t\tthis.#setState(State.DATA_LOADING);\n\n\t\treturn this.#locationRepository.findByExternalId(\n\t\t\tlocation.externalId,\n\t\t\tlocation.sourceCode,\n\t\t\tlocation.languageId\n\t\t)\n\t\t\t.then((detailedLocation: ?Location) => {\n\t\t\t\t\tthis.#setState(State.DATA_LOADED);\n\n\t\t\t\t\tlet result;\n\t\t\t\t\t/*\n\t\t\t\t\t * Nominatim could return a bit different location without the coordinates.\n\t\t\t\t\t * For example N752206814\n\t\t\t\t\t */\n\t\t\t\t\tif (\n\t\t\t\t\t\tdetailedLocation.latitude !== '0'\n\t\t\t\t\t\t&& detailedLocation.longitude !== '0'\n\t\t\t\t\t\t&& detailedLocation !== ''\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = detailedLocation;\n\t\t\t\t\t\tresult.name = location.name;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = location;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\t(response) => {\n\t\t\t\t\tErrorPublisher.getInstance().notify(response.errors);\n\t\t\t\t}\n\t\t\t);\n\t}\n\n\t#convertStringToAddress(addressString: string)\n\t{\n\t\tconst result = new Address({\n\t\t\tlanguageId: this.#languageId\n\t\t});\n\n\t\tresult.setFieldValue(this.#addressFormat.fieldForUnRecognized, addressString);\n\t\treturn result;\n\t}\n\n\t/**\n\t * Is called when location was selected and the location details were obtained\n\t * @param {Location} location\n\t */\n\t#onLocationSelect(location: ?Location): void\n\t{\n\t\tthis.#address = location ? location.toAddress() : null;\n\t\tthis.#addressString.setValueFromAddress(this.#address);\n\t\tthis.#onAddressChangedEventEmit();\n\t}\n\n\t#onInputKeyDown(e: KeyboardEvent): void\n\t{\n\t\tif (\n\t\t\t!(\n\t\t\t\tthis.#inputNode\n\t\t\t\t&& this.#inputNode.selectionStart === 0\n\t\t\t\t&& this.#inputNode.selectionEnd === this.#inputNode.value.length\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t(\n\t\t\t\te.code === 'Backspace'\n\t\t\t\t|| e.code === 'Delete'\n\t\t\t\t|| (e.code === 'KeyV' && ((e.ctrlKey || e.metaKey)))\n\t\t\t\t|| (e.code === 'KeyX' && ((e.ctrlKey || e.metaKey)))\n\t\t\t\t|| (e.code === 'Insert' && e.shiftKey)\n\t\t\t)\n\t\t\t|| (\n\t\t\t\t!(e.ctrlKey || e.metaKey)\n\t\t\t\t&& [...e.key].length === 1\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis.address = null;\n\t\t\tthis.#onAddressChangedEventEmit();\n\t\t}\n\t}\n\n\t#onInputKeyUp(e: KeyboardEvent): void\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis.#state !== State.DATA_INPUTTING\n\t\t\t&& this.#addressString.isChanged()\n\t\t)\n\t\t{\n\t\t\tthis.#setState(State.DATA_INPUTTING);\n\t\t}\n\n\t\tif (this.#prompt.isShown())\n\t\t{\n\t\t\tlet location;\n\t\t\tconst onLocationSelectTimeout = 700;\n\n\t\t\tswitch (e.code)\n\t\t\t{\n\t\t\t\tcase 'NumpadEnter':\n\t\t\t\tcase 'Enter':\n\t\t\t\t\tif (this.#prompt.isItemChosen())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#fulfillSelection(this.#prompt.getChosenItem())\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t(error) => BX.debug(error)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'Tab':\n\t\t\t\tcase 'Escape':\n\t\t\t\t\tthis.#setState(State.DATA_SUPPOSED);\n\t\t\t\t\tthis.#onAddressChangedEventEmit();\n\t\t\t\t\tthis.#prompt.close();\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'ArrowUp':\n\t\t\t\t\tlocation = this.#prompt.choosePrevItem();\n\n\t\t\t\t\tif (location && location.address)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#createOnLocationSelectTimer(location, onLocationSelectTimeout);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\n\t\t\t\tcase 'ArrowDown':\n\t\t\t\t\tlocation = this.#prompt.chooseNextItem();\n\n\t\t\t\t\tif (location && location.address)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#createOnLocationSelectTimer(location, onLocationSelectTimeout);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#addressString.isChanged())\n\t\t{\n\t\t\tthis.#addressString.actualize();\n\t\t\tthis.showPrompt(this.#addressString.value);\n\t\t}\n\n\t\tif (this.#addressString.value.length === 0)\n\t\t{\n\t\t\tthis.#showPresetLocations();\n\t\t}\n\t}\n\n\t#onInputPaste(): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (\n\t\t\t\tthis.#state !== State.DATA_INPUTTING\n\t\t\t\t&& this.#addressString.isChanged()\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#setState(State.DATA_INPUTTING);\n\t\t\t}\n\n\t\t\tif (this.#addressString.isChanged())\n\t\t\t{\n\t\t\t\tthis.#addressString.actualize();\n\t\t\t\tthis.showPrompt(this.#addressString.value);\n\t\t\t}\n\t\t}, 0);\n\t}\n\n\t#createOnLocationSelectTimer(location: Location, timeout: Number): void\n\t{\n\t\tif (this.#onLocationSelectTimerId !== null)\n\t\t{\n\t\t\tclearTimeout(this.#onLocationSelectTimerId);\n\t\t}\n\n\t\tthis.#onLocationSelectTimerId = setTimeout(() => {\n\t\t\t\tthis.#onLocationSelect(location);\n\t\t\t},\n\t\t\ttimeout\n\t\t);\n\t}\n\n\t/**\n\t * @param {string} searchPhrase\n\t */\n\tshowPrompt(searchPhrase: string): void\n\t{\n\t\tthis.#searchPhrase.requested = searchPhrase;\n\t\tthis.#searchPhrase.current = searchPhrase;\n\t\tthis.#searchPhrase.dropped = '';\n\t\tthis.#showPromptInner(searchPhrase);\n\t}\n\n\tclosePrompt(): void\n\t{\n\t\tif (this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.close();\n\t\t}\n\t}\n\n\tisPromptShown(): boolean\n\t{\n\t\tif (this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.isShown();\n\t\t}\n\t}\n\n\t#showPromptInner(searchPhrase: string): void\n\t{\n\t\tif (searchPhrase.length <= 3)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#timerId !== null)\n\t\t{\n\t\t\tclearTimeout(this.#timerId);\n\t\t}\n\n\t\tthis.#timerId = this.#createTimer(searchPhrase);\n\t}\n\n\t/**\n\t * Wait for further user input for some time\n\t * @param {string} searchPhrase\n\t * @returns {number}\n\t */\n\t#createTimer(searchPhrase: string): number\n\t{\n\t\treturn setTimeout(() => {\n\t\t\t\t// to avoid multiple parallel requests, server responses are too slow.\n\t\t\t\tif (this.#isAutocompleteRequestStarted)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.#timerId);\n\t\t\t\t\tthis.#timerId = this.#createTimer(searchPhrase);\n\t\t\t\t\tthis.#isNextAutocompleteRequestWaiting = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.#isNextAutocompleteRequestWaiting = false;\n\n\t\t\t\tthis.emit(Autocomplete.#onSearchStartedEvent);\n\t\t\t\tthis.#isAutocompleteRequestStarted = true;\n\t\t\t\tconst params = this.#makeAutocompleteServiceParams();\n\n\t\t\t\tthis.#autocompleteService.autocomplete(searchPhrase, params)\n\t\t\t\t\t.then(\n\t\t\t\t\t\t(locationsList: Array<Location>) => {\n\t\t\t\t\t\t\tthis.#timerId = null;\n\t\t\t\t\t\t\tif (!this.#isNextAutocompleteRequestWaiting)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#onPromptsReceived(locationsList, params);\n\t\t\t\t\t\t\t\tthis.emit(Autocomplete.#onSearchCompletedEvent);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.#isAutocompleteRequestStarted = false;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(error) => {\n\t\t\t\t\t\t\tif (!this.#isNextAutocompleteRequestWaiting)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.emit(Autocomplete.#onSearchCompletedEvent);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.#isAutocompleteRequestStarted = false;\n\t\t\t\t\t\t\tBX.debug(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t},\n\t\t\t300\n\t\t);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEvent.unbindAll(this);\n\n\t\tif (this.#prompt)\n\t\t{\n\t\t\tthis.#prompt.destroy();\n\t\t\tthis.#prompt = null;\n\t\t}\n\n\t\tthis.#timerId = null;\n\n\t\tif (this.#inputNode)\n\t\t{\n\t\t\tthis.#inputNode.removeEventListener('keydown', this.#onInputKeyDown);\n\t\t\tthis.#inputNode.removeEventListener('keyup', this.#onInputKeyUp);\n\t\t\tthis.#inputNode.removeEventListener('focus', this.#onInputFocus);\n\t\t\tthis.#inputNode.removeEventListener('focusout', this.#onInputFocusOut);\n\t\t\tthis.#inputNode.removeEventListener('click', this.#onInputClick);\n\t\t\tthis.#inputNode.removeEventListener('paste', this.#onInputPaste);\n\t\t}\n\n\t\tdocument.removeEventListener('click', this.#onDocumentClick);\n\t\tthis.#isDestroyed = true;\n\t}\n}\n","import {Tag} from \"main.core\";\n\nexport default class Photo\n{\n\t#description;\n\t#url;\n\t#link;\n\t#location;\n\t#title;\n\n\tconstructor(props)\n\t{\n\t\tthis.#url = props.url;\n\t\tthis.#link = props.link || '';\n\t\tthis.#description = props.description || '';\n\t\tthis.#location = props.location;\n\t\tthis.#title = props.title || '';\n\t}\n\n\trender()\n\t{\n\t\tlet description = '';\n\n\t\tif(this.#description)\n\t\t{\n\t\t\t//todo: sanitize\n\t\t\tdescription = Tag.render`<span class=\"location-map-item-description\">${this.#description}</span>`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"location-map-photo-item-block\">\n\t\t\t\t<span class=\"location-map-photo-item-block-image-block-inner\">\n\t\t\t\t\t${description}\n\t\t\t\t\t<span \n\t\t\t\t\t\tdata-viewer data-viewer-type=\"image\" \n\t\t\t\t\t\tdata-src=\"${this.#link}\" \n\t\t\t\t\t\tdata-title=\"${this.#title}\"\n\t\t\t\t\t\tclass=\"location-map-item-photo-image\" \n\t\t\t\t\t\tdata-viewer-group-by=\"${this.#location.externalId}\"\n\t\t\t\t\t\tstyle=\"background-image: url(${this.#url});\">\t\t\t\t\t\t\t\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</div>`;\n\t}\n}","import {Tag, Dom} from \"main.core\";\nimport Photo from \"./photo\";\n\nexport default class Gallery\n{\n\t#photos = [];\n\t#container = null;\n\t#photosContainer = null;\n\t#thumbnailHeight;\n\t#thumbnailWidth;\n\t#photoService;\n\t#maxPhotoCount;\n\t#location;\n\n\tconstructor(props)\n\t{\n\t\tthis.#thumbnailHeight = props.thumbnailHeight;\n\t\tthis.#thumbnailWidth = props.thumbnailWidth;\n\t\tthis.#maxPhotoCount = props.maxPhotoCount;\n\t\tthis.#photoService = props.photoService;\n\t}\n\n\trefresh()\n\t{\n\t\tif(this.#location)\n\t\t{\n\t\t\tthis.#photoService.requestPhotos({\t\t\t\t\n\t\t\t\tlocation: this.#location,\n\t\t\t\tthumbnailHeight: this.#thumbnailHeight,\n\t\t\t\tthumbnailWidth: this.#thumbnailWidth,\n\t\t\t\tmaxPhotoCount: this.#maxPhotoCount\n\t\t\t\t\n\t\t\t})\n\t\t\t.then((photosData) => {\n\t\t\t\tif(Array.isArray(photosData) && photosData.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#setPhotos(photosData);\n\t\t\t\t\tthis.show();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tset location(location: Location)\n\t{\n\t\tthis.#location = location;\n\t\tthis.refresh();\n\t}\n\n\t#setPhotos(photosData)\n\t{\n\t\tif(!this.#location)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet photos = [];\n\n\t\tfor(let photo of photosData)\n\t\t{\n\t\t\tphotos.push(\n\t\t\t\tnew Photo({\n\t\t\t\t\turl: photo.thumbnail.url,\n\t\t\t\t\tlink: photo.url,\n\t\t\t\t\tlocation: this.#location,\n\t\t\t\t\ttitle: this.#location.name + \" ( \" + BX.util.strip_tags(photo.description) + ' )'\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tif(!Array.isArray(photos))\n\t\t{\n\t\t\tBX.debug('Wrong type of photos. Must be array');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#photos = [];\n\n\t\tfor(let photo of photos)\n\t\t{\n\t\t\tthis.#photos.push(photo);\n\t\t}\n\n\t\tif(this.#photos.length > 0 && this.#photosContainer)\n\t\t{\n\t\t\tlet renderedPhotos = this.#photos ? this.#renderPhotos(this.#photos) : '';\n\n\t\t\tthis.#photosContainer.innerHTML = '';\n\n\t\t\tif(renderedPhotos.length > 0)\n\t\t\t{\n\t\t\t\tfor (let photo of renderedPhotos)\n\t\t\t\t{\n\t\t\t\t\tthis.#photosContainer.appendChild(photo);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif(this.#container)\n\t\t{\n\t\t\tthis.#container.style.display = 'none';\n\t\t}\n\t}\n\n\tisHidden()\n\t{\n\t\treturn !this.#container || this.#container.clientWidth <= 0;\n\t}\n\n\tshow()\n\t{\n\t\tif(this.#container)\n\t\t{\n\t\t\tthis.#container.style.display = 'block';\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tthis.#photosContainer = Tag.render`\t\t\t\t\t\n\t\t\t\t<div class=\"location-map-photo-inner\">\t\t\t\t\t\n\t\t\t\t</div>`;\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"location-map-photo-container\">\n\t\t\t\t${this.#photosContainer}\n\t\t\t</div>`;\n\n\t\treturn this.#container;\n\t}\n\n\t#renderPhotos(photos)\n\t{\n\t\tlet result = [];\n\n\t\tfor (let photo of photos)\n\t\t{\n\t\t\tresult.push(photo.render());\n\t\t}\n\n\t\treturn result;\n\t}\n}","import {Tag, Event, Dom, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport 'ui.forms';\nimport {ControlMode} from 'location.core';\nimport State from '../state';\n\nexport default class Field extends EventEmitter\n{\n\tstatic #onValueChangedEvent = 'onValueChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\n\t#title;\n\t#value;\n\t#type;\n\t#sort;\n\t#mode;\n\t#input;\n\t#viewContainer;\n\t#container = null;\n\t#state = State.INITIAL;\n\n\tconstructor(props: FieldConstructorProps)\n\t{\n\t\tsuper(props);\n\t\tthis.setEventNamespace('BX.Location.Widget.Field');\n\n\t\tthis.#title = props.title;\n\t\tthis.#type = props.type;\n\t\tthis.#sort = props.sort;\n\t}\n\n\tget container()\n\t{\n\t\treturn this.#container;\n\t}\n\n\tget state()\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Field.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\trender(props: FieldRenderProps): void\n\t{\n\t\tthis.#value = typeof props.value === 'string' ? props.value : '';\n\n\t\tif(!ControlMode.isValid(props.mode))\n\t\t{\n\t\t\tBX.debug('props.mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tthis.#container = Tag.render`\n\t\t\t<div class=\"ui-entity-editor-content-block ui-entity-editor-field-text\">\n\t\t\t\t<div class=\"ui-entity-editor-block-title\">\n\t\t\t\t\t<label class=\"ui-entity-editor-block-title-text\">${this.#title}:</label>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>`;\n\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#renderEditMode(this.#container)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#renderViewMode(this.#container)\n\t\t}\n\n\t\treturn this.#container;\n\t}\n\n\t#renderEditMode(container: Element)\n\t{\n\t\tthis.#input = Tag.render`<input type=\"text\" class=\"ui-ctl-element\" value=\"${Text.encode(this.#value)}\">`;\n\t\tthis.#viewContainer = null;\n\n\t\tEvent.bind(this.#input, 'focus', (e) => {\n\t\t\tthis.#setState(State.DATA_INPUTTING);\n\t\t});\n\n\t\tEvent.bind(this.#input, 'focusout', (e) => {\n\t\t\tthis.#setState(State.DATA_SELECTED);\n\t\t});\n\n\t\tEvent.bind(this.#input, 'change', (e) => {\n\t\t\tthis.#setState(State.DATA_SELECTED);\n\t\t\tthis.#value = this.#input.value;\n\t\t\tthis.emit(Field.#onValueChangedEvent, {value: this});\n\t\t});\n\n\t\tcontainer.appendChild(\n\t\t\tTag.render`\n\t\t\t\t<div class=\"ui-entity-editor-content-block\">\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t${this.#input}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t);\n\t}\n\n\t#renderViewMode(container: Element)\n\t{\n\t\tthis.#input = null;\n\n\t\tthis.#viewContainer = Tag.render`\n\t\t\t<div class=\"ui-title-6\">\n\t\t\t\t${Text.encode(this.#value)}\n\t\t\t</div>`;\n\n\t\tcontainer.appendChild(this.#viewContainer);\n\t}\n\n\t#refreshLayout()\n\t{\n\t\tif(this.#mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#input.value = this.#value;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#viewContainer.innerHTML = Text.encode(this.#value);\n\t\t}\n\t}\n\n\tset type(type: number)\n\t{\n\t\tthis.#type = type;\n\t}\n\n\tget type(): number\n\t{\n\t\treturn this.#type;\n\t}\n\n\tset sort(sort: number)\n\t{\n\t\tthis.#sort = sort;\n\t}\n\n\tget sort(): number\n\t{\n\t\treturn this.#sort;\n\t}\n\n\tset value(value: string)\n\t{\n\t\tthis.#value = typeof value === 'string' ? value : '';\n\t\tthis.#refreshLayout();\n\t}\n\n\tget value(): string\n\t{\n\t\treturn this.#value;\n\t}\n\n\tsubscribeOnValueChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Field.#onValueChangedEvent, listener);\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Field.#onStateChangedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tDom.remove(this.#container);\n\t\tEvent.unbindAll(this);\n\t\tthis.#container = null;\n\t}\n}\n\ntype FieldConstructorProps = {\n\ttitle: string\n}\n\ntype FieldRenderProps = {\n\tvalue: string,\n\tmode: string //ControlMode\n}","import {Event, Dom, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Format, Address, ControlMode} from 'location.core';\nimport Field from './field';\n\nexport type FieldsConstructorType = {\n\taddressFormat: Format\n}\n\nexport type FieldsRenderType = {\n\taddress: Address,\n\tmode: string, // ControlMode\n\tcontainer: Element\n}\n\nexport default class Fields extends EventEmitter\n{\n\tstatic #onAddressChangedEvent = 'onAddressChanged';\n\tstatic #onStateChangedEvent = 'onStateChanged';\n\n\t#address;\n\t#addressFormat;\n\t#mode;\n\t#fields = [];\n\t#languageId;\n\t#container;\n\t#state;\n\n\tconstructor(props: FieldsConstructorType)\n\t{\n\t\tsuper(props);\n\n\t\tthis.setEventNamespace('BX.Location.Widget.Fields');\n\n\t\tif(!(props.addressFormat instanceof Format))\n\t\t{\n\t\t\tBX.debug('addressFormat must be instance of Format');\n\t\t}\n\n\t\tthis.#addressFormat = props.addressFormat;\n\t\tthis.#languageId = props.languageId;\n\t\tthis.#initFields();\n\t}\n\n\t#initFields()\n\t{\n\t\tfor (let type in this.#addressFormat.fieldCollection.fields)\n\t\t{\n\t\t\tif(!this.#addressFormat.fieldCollection.fields.hasOwnProperty(type))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet formatField = this.#addressFormat.fieldCollection.fields[type];\n\n\t\t\tlet field = new Field({\n\t\t\t\ttitle: formatField.name,\n\t\t\t\ttype: formatField.type,\n\t\t\t\tsort: formatField.sort\n\t\t\t});\n\n\t\t\tfield.subscribeOnValueChangedEvent((event) => {\n\t\t\t\tthis.#onFieldChanged(field);\n\t\t\t});\n\n\t\t\tfield.subscribeOnStateChangedEvent((event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#setState(data.state);\n\t\t\t});\n\n\t\t\tthis.#fields.push(field)\n\t\t}\n\n\t\tthis.#fields.sort((a, b) => {\n\t\t\treturn a.sort - b.sort;\n\t\t});\n\t}\n\n\trender(props: FieldsRenderType): void\n\t{\n\t\tif(props.address && !(props.address instanceof Address))\n\t\t{\n\t\t\tBX.debug('props.address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = props.address;\n\n\t\tif(!ControlMode.isValid(props.mode))\n\t\t{\n\t\t\tBX.debug('props.mode must be valid ControlMode');\n\t\t}\n\n\t\tthis.#mode = props.mode;\n\n\t\tif(!Type.isDomNode(props.container))\n\t\t{\n\t\t\tBX.debug('props.container must be dom node');\n\t\t}\n\n\t\tthis.#container = props.container;\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tlet value = this.#address ? this.#address.getFieldValue(field.type) : '';\n\n\t\t\tif(this.#mode === ControlMode.view && !value)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet item = field.render({\n\t\t\t\tvalue: value,\n\t\t\t\tmode: this.#mode\n\t\t\t});\n\n\t\t\tthis.#container.appendChild(item);\n\t\t}\n\t}\n\n\t#onFieldChanged(field: Field)\n\t{\n\t\tif(!this.#address)\n\t\t{\n\t\t\tthis.#address = new Address({\n\t\t\t\tlanguageId: this.#languageId\n\t\t\t});\n\t\t}\n\n\t\tthis.#address.setFieldValue(field.type, field.value);\n\n\t\tthis.emit(Fields.#onAddressChangedEvent, {\n\t\t\taddress: this.#address,\n\t\t\tchangedField: field\n\t\t});\n\t}\n\n\tset address(address: ?Address)\n\t{\n\t\tif(address && !(address instanceof Address))\n\t\t{\n\t\t\tBX.debug('address must be instance of Address');\n\t\t}\n\n\t\tthis.#address = address;\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tfield.value = this.#address ? this.#address.getFieldValue(field.type) : '';\n\t\t}\n\t}\n\n\tsubscribeOnAddressChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Fields.#onAddressChangedEvent, listener);\n\t}\n\n\tdestroy()\n\t{\n\t\tEvent.unbindAll(this);\n\n\t\tfor(let field of this.#fields)\n\t\t{\n\t\t\tfield.destroy();\n\t\t}\n\n\t\tDom.clean(this.#container);\n\t}\n\n\tget state()\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#setState(state: string)\n\t{\n\t\tthis.#state = state;\n\t\tthis.emit(Fields.#onStateChangedEvent, {state: this.#state});\n\t}\n\n\tsubscribeOnStateChangedEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Fields.#onStateChangedEvent, listener);\n\t}\n}","import {Type} from 'main.core';\nimport {Address} from 'location.core';\nimport MapPopup from '../../mappopup/mappopup';\nimport BaseFeature from './basefeature';\nimport State from '../../state';\n\n/**\n * Complex address widget\n */\nexport default class MapFeature extends BaseFeature\n{\n\t#map = null;\n\n\t#mapBindElement = null;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tif(!(props.map instanceof MapPopup))\n\t\t{\n\t\t\tBX.debug('props.map must be instance of MapPopup');\n\t\t}\n\n\t\tthis.#map = props.map;\n\n\t\tthis.#map.onChangedEventSubscribe(\n\t\t\t(event) => {\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.setAddressByFeature(data.address, this);\n\t\t\t});\n\t}\n\n\tshowMap(useUserLocation: boolean = false): void\n\t{\n\t\tif(!this.#map.isShown())\n\t\t{\n\t\t\tthis.#map.show(useUserLocation);\n\t\t}\n\t}\n\n\tcloseMap(): void\n\t{\n\t\tif(this.#map.isShown())\n\t\t{\n\t\t\tthis.#map.close();\n\t\t}\n\n\t\tthis.#map.bindelement = this.#mapBindElement;\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.closeMap();\n\t}\n\n\t/**\n\t * Render Widget\n\t * @param {Object} props\n\t */\n\trender(props: {}): void\n\t{\n\t\tif(!Type.isDomNode(props.mapBindElement))\n\t\t{\n\t\t\tBX.debug('props.mapBindElement  must be instance of Element');\n\t\t}\n\n\t\tthis.#mapBindElement = props.mapBindElement;\n\n\t\tthis.#map.render({\n\t\t\tbindElement: props.mapBindElement,\n\t\t\taddress: this.#addressWidget.address,\n\t\t\tmode: this.#addressWidget.mode,\n\t\t});\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tif(this.addressWidget.state === State.DATA_INPUTTING)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#map.address = address;\n\t}\n\n\tsetAddressWidget(addressWidget): void\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\t\tthis.#map.mode = mode;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#map.destroy();\n\t\tthis.#map = null;\n\t}\n\n\tget map(): MapPopup\n\t{\n\t\treturn this.#map;\n\t}\n\n\tget addressWidget(): Address\n\t{\n\t\treturn this.#addressWidget;\n\t}\n\n\tget mapBindElement(): Element\n\t{\n\t\treturn this.#mapBindElement;\n\t}\n}","import {Address, ControlMode} from 'location.core';\nimport BaseFeature from './basefeature';\nimport Autocomplete from '../../autocomplete/autocomplete';\n\n/**\n * Complex address widget\n */\nexport default class AutocompleteFeature extends BaseFeature\n{\n\tstatic searchStartedEvent = 'searchStarted';\n\tstatic searchCompletedEvent = 'searchCompleted';\n\tstatic showOnMapClickedEvent = 'showOnMapClicked';\n\n\t#autocomplete;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tif(!(props.autocomplete instanceof Autocomplete))\n\t\t{\n\t\t\tBX.debug('props.autocomplete  must be instance of Autocomplete');\n\t\t}\n\n\t\tthis.#autocomplete = props.autocomplete;\n\n\t\tthis.#autocomplete.onAddressChangedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\n\t\t\t\tthis.#addressWidget.setAddressByFeature(\n\t\t\t\t\tdata.address,\n\t\t\t\t\tthis,\n\t\t\t\t\tdata.excludeSetAddressFeatures,\n\t\t\t\t\tdata.options\n\t\t\t\t);\n\t\t\t});\n\n\t\tthis.#autocomplete.onStateChangedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.setStateByFeature(data.state);\n\t\t\t});\n\n\t\tthis.#autocomplete.onSearchStartedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.searchStartedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\n\t\tthis.#autocomplete.onSearchCompletedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.searchCompletedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\n\t\tthis.#autocomplete.onShowOnMapClickedEventSubscribe(\n\t\t\t(event) =>\n\t\t\t{\n\t\t\t\tconst data = event.getData();\n\t\t\t\tthis.#addressWidget.emitFeatureEvent(\n\t\t\t\t\t{\n\t\t\t\t\t\tfeature: this,\n\t\t\t\t\t\teventCode: AutocompleteFeature.showOnMapClickedEvent,\n\t\t\t\t\t\tpayload: data\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t}\n\n\tresetView(): void\n\t{\n\t\tthis.#autocomplete.closePrompt();\n\t}\n\n\trender(props): void\n\t{\n\t\tif(this.#addressWidget.mode === ControlMode.edit)\n\t\t{\n\t\t\tthis.#autocomplete.render({\n\t\t\t\tinputNode: this.#addressWidget.inputNode,\n\t\t\t\tmenuNode: props.autocompleteMenuElement,\n\t\t\t\taddress: this.#addressWidget.address,\n\t\t\t\tmode: this.#addressWidget.mode,\n\t\t\t});\n\t\t}\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tthis.#autocomplete.address = address;\n\t}\n\n\tsetAddressWidget(addressWidget)\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.#autocomplete.destroy();\n\t\tthis.#autocomplete = null;\n\t}\n}","import {Type} from 'main.core';\nimport {Address, ControlMode} from 'location.core';\nimport BaseFeature from './basefeature';\nimport Fields from '../../fields/fields';\n\n/**\n * Fields widget feature\n */\nexport default class FieldsFeature extends BaseFeature\n{\n\t#fields;\n\t#addressWidget = null;\n\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tif(!(props.fields instanceof Fields))\n\t\t{\n\t\t\tBX.debug('props.Fields must be instance of Fields');\n\t\t}\n\n\t\tthis.#fields = props.fields;\n\n\t\tthis.#fields.subscribeOnAddressChangedEvent(\n\t\t\t(event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#addressWidget.setAddressByFeature(data.address, this);\n\t\t\t});\n\n\t\tthis.#fields.subscribeOnStateChangedEvent(\n\t\t\t(event) => {\n\t\t\t\tlet data = event.getData();\n\t\t\t\tthis.#addressWidget.setStateByFeature(data.state);\n\t\t\t});\n\t}\n\n\trender(props): void\n\t{\n\t\tif(this.#addressWidget.mode === ControlMode.edit)\n\t\t{\n\t\t\tif (!Type.isDomNode(props.fieldsContainer))\n\t\t\t{\n\t\t\t\tBX.debug('props.fieldsContainer  must be instance of Element');\n\t\t\t}\n\n\t\t\tthis.#fields.render({\n\t\t\t\taddress: this.#addressWidget.address,\n\t\t\t\tmode: this.#addressWidget.mode,\n\t\t\t\tcontainer: props.fieldsContainer\n\t\t\t});\n\t\t}\n\t}\n\n\tsetAddressWidget(addressWidget)\n\t{\n\t\tthis.#addressWidget = addressWidget;\n\t}\n\n\tsetAddress(address: Address): void\n\t{\n\t\tthis.#fields.address = address;\n\t}\n\n\tsetMode(mode: string): void\n\t{\n\t\tthis.#fields.mode = mode;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#fields.destroy();\n\t\tthis.#fields = null;\n\t}\n}","import {Address, ControlMode} from 'location.core';\nimport State from '../../state';\nimport MapFeature from './mapfeature';\n\n/**\n * Map feature for the address widget with auto map opening / closing behavior\n */\nexport default class MapFeatureAuto extends MapFeature\n{\n\t#showMapTimerId = null;\n\t#showMapDelay = 700;\n\t#closeMapTimerId = null;\n\t#closeMapDelay = 800;\n\n\t#isDestroyed = false;\n\n\t/**\n\t * Render Widget\n\t * @param {AddressRenderProps} props\n\t */\n\trender(props: AddressRenderProps): void\n\t{\n\t\tsuper.render(props);\n\n\t\tthis.addressWidget.controlWrapper.addEventListener('click', this.#onControlWrapperClick.bind(this));\n\t\tthis.addressWidget.controlWrapper.addEventListener('mouseover', this.#processOnMouseOver.bind(this));\n\t\tthis.addressWidget.controlWrapper.addEventListener('mouseout', this.#processOnMouseOut.bind(this));\n\n\t\tdocument.addEventListener('click', this.#onDocumentClick.bind(this));\n\n\t\tthis.map.onMouseOverSubscribe(this.#processOnMouseOver.bind(this));\n\t\tthis.map.onMouseOutSubscribe(this.#processOnMouseOut.bind(this));\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\t#onControlWrapperClick(event)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.mode === ControlMode.view)\n\t\t{\n\t\t\tif (this.map.isShown())\n\t\t\t{\n\t\t\t\tthis.closeMap();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tclearTimeout(this.#showMapTimerId);\n\t\t\t}\n\t\t}\n\t\telse if (this.addressWidget.mode === ControlMode.edit && this._saveResourceStrategy === false)\n\t\t{\n\t\t\tif (this.addressWidget.address && !this.map.isShown() && event.target === this.addressWidget.inputNode)\n\t\t\t{\n\t\t\t\tthis.showMap();\n\t\t\t}\n\t\t}\n\t}\n\n\t#onDocumentClick(event)\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.inputNode !== event.target)\n\t\t{\n\t\t\tthis.closeMap();\n\t\t}\n\t}\n\n\t#processOnMouseOver()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.#showMapTimerId);\n\t\tclearTimeout(this.#closeMapTimerId);\n\n\t\tif (this.addressWidget.mode !== ControlMode.view)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.address && !this.map.isShown())\n\t\t{\n\t\t\tthis.#showMapTimerId = setTimeout(() => {\n\t\t\t\t\tthis.showMap();\n\t\t\t\t},\n\t\t\t\tthis.#showMapDelay\n\t\t\t);\n\t\t}\n\t}\n\n\t#processOnMouseOut()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.#showMapTimerId);\n\t\tclearTimeout(this.#closeMapTimerId);\n\n\t\tif (this.addressWidget.mode !== ControlMode.view)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.addressWidget.mode === ControlMode.view && this.map.isShown())\n\t\t{\n\t\t\tthis.#closeMapTimerId = setTimeout(() => {\n\t\t\t\t\tthis.closeMap();\n\t\t\t\t},\n\t\t\t\tthis.#closeMapDelay\n\t\t\t);\n\t\t}\n\t}\n\n\tsetAddress(address: ?Address): void\n\t{\n\t\tif (!address)\n\t\t{\n\t\t\tthis.closeMap();\n\t\t}\n\n\t\tthis.map.address = address;\n\n\t\tif (address && this.addressWidget.state !== State.DATA_SUPPOSED)\n\t\t{\n\t\t\tthis.showMap();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.#isDestroyed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdocument.removeEventListener('click', this.#onDocumentClick);\n\n\t\tif (this.addressWidget.controlWrapper)\n\t\t{\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('click', this.#onControlWrapperClick);\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('mouseover', this.#processOnMouseOver);\n\t\t\tthis.addressWidget.controlWrapper.removeEventListener('mouseout', this.#processOnMouseOut);\n\t\t}\n\n\t\tthis.#showMapTimerId = null;\n\t\tthis.#closeMapTimerId = null;\n\n\t\tsuper.destroy();\n\t\tthis.#isDestroyed = true;\n\t}\n}\n","import {\n\tLocationRepository,\n\tSourceCreationError,\n\tFormat,\n\tLocation,\n} from 'location.core';\nimport { Google } from 'location.google';\nimport Address from './address/address';\nimport Autocomplete from './autocomplete/autocomplete';\nimport { Factory as SourceFactory } from 'location.source';\nimport MapPopup from './mappopup/mappopup';\nimport Gallery from './mappopup/gallery';\nimport Popup from './mappopup/popup';\nimport Fields from './fields/fields';\nimport MapFeature from './address/features/mapfeature';\nimport AutocompleteFeature from './address/features/autocompletefeature';\nimport FieldsFeature from './address/features/fieldsfeature';\nimport MapFeatureAuto from './address/features/mapfeatureauto';\n\n/**\n * Props type for the main fabric method\n */\nexport type FactoryCreateAddressWidgetProps = {\n\t// Initial Address\n\taddress?: Address,\n\t// Initial widget mode\n\tmode: 'edit' | 'view',\n\n\t// optional\n\tlanguageId?: string,\n\taddressFormat?: Format,\n\tsourceCode?: string,\n\tsourceParams?: {},\n\n\t// Witch features will be used?\n\tuseFeatures?: {\n\t\tfields?: boolean, \t\t// default true\n\t\tmap?: boolean, \t\t\t// default true\n\t\tautocomplete?: boolean\t// default true\n\t},\n\n\t// Useful for the using with map feature only\n\t// Address photo height if photo exists\n\tthumbnailHeight: number,\n\t// Address photo width if photo exists\n\tthumbnailWidth: number,\n\t// Max photo thumbnails count\n\tmaxPhotoCount: number,\n\t/*\n\t * auto - open / close map feature depends on user's input\n\t * manual - allow to control open / close map\n\t */\n\tmapBehavior: 'auto' | 'manual',\n\tpopupOptions?: {},\n\tpopupBindOptions: {\n\t\tforceBindPosition?: boolean,\n\t\tforceLeft?: boolean,\n\t\tforceTop?: boolean,\n\t\tposition?: 'right' | 'top' | 'bootom'\n\t},\n\tpresetLocationsProvider?: Function,\n\tpresetLocationList?: []\n};\n\n/**\n * Factory class with a set of tools for the address widget creation\n */\nexport default class Factory\n{\n\t/**\n\t * Main factory method\n\t * @param {FactoryCreateAddressWidgetProps} props\n\t * @returns {Address}\n\t */\n\tcreateAddressWidget(props: FactoryCreateAddressWidgetProps): Address\n\t{\n\t\tconst sourceCode = props.sourceCode || BX.message('LOCATION_WIDGET_SOURCE_CODE');\n\t\tconst sourceParams = props.sourceParams || BX.message('LOCATION_WIDGET_SOURCE_PARAMS');\n\t\tconst languageId = props.languageId || BX.message('LOCATION_WIDGET_LANGUAGE_ID');\n\t\tconst sourceLanguageId = props.sourceLanguageId || BX.message('LOCATION_WIDGET_SOURCE_LANGUAGE_ID');\n\t\tconst userLocationPoint = new Location(JSON.parse(BX.message('LOCATION_WIDGET_USER_LOCATION_POINT')));\n\n\t\tconst addressFormat = props.addressFormat || new Format(\n\t\t\tJSON.parse(\n\t\t\t\tBX.message('LOCATION_WIDGET_DEFAULT_FORMAT')\n\t\t\t));\n\n\t\tconst presetLocationsProvider = props.presetLocationsProvider\n\t\t\t? props.presetLocationsProvider\n\t\t\t: () => {\n\t\t\t\treturn props.presetLocationList ? props.presetLocationList : [];\n\t\t\t};\n\n\t\tconst features = [];\n\n\t\tif(!props.useFeatures || props.useFeatures.fields !== false)\n\t\t{\n\t\t\tfeatures.push(\n\t\t\t\tthis.createFieldsFeature({addressFormat, languageId})\n\t\t\t);\n\t\t}\n\n\t\tlet source = null;\n\n\t\tif(sourceCode && sourceParams)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tsource = SourceFactory.create(sourceCode, languageId, sourceLanguageId, sourceParams)\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif(e instanceof SourceCreationError)\n\t\t\t\t{\n\t\t\t\t\tsource = null;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet mapFeature = null;\n\t\tif(source)\n\t\t{\n\t\t\tif(!props.useFeatures || props.useFeatures.autocomplete !== false)\n\t\t\t{\n\t\t\t\tfeatures.push(\n\t\t\t\t\tthis.createAutocompleteFeature({\n\t\t\t\t\t\tlanguageId,\n\t\t\t\t\t\taddressFormat,\n\t\t\t\t\t\tsource,\n\t\t\t\t\t\tuserLocationPoint: userLocationPoint,\n\t\t\t\t\t\tpresetLocationsProvider\n\t\t\t\t\t}));\n\t\t\t}\n\n\t\t\tif(!props.useFeatures || props.useFeatures.map !== false)\n\t\t\t{\n\t\t\t\tconst showPhotos = !!sourceParams.showPhotos;\n\t\t\t\tconst useGeocodingService = !!sourceParams.useGeocodingService;\n\t\t\t\tconst DEFAULT_THUMBNAIL_HEIGHT = 80;\n\t\t\t\tconst DEFAULT_THUMBNAIL_WIDTH = 150;\n\t\t\t\tconst DEFAULT_MAX_PHOTO_COUNT = showPhotos ? 5 : 0;\n\t\t\t\tconst DEFAULT_MAP_BEHAVIOR = 'auto';\n\n\t\t\t\tmapFeature = this.createMapFeature({\n\t\t\t\t\taddressFormat,\n\t\t\t\t\tsource,\n\t\t\t\t\tuseGeocodingService,\n\t\t\t\t\tpopupOptions: props.popupOptions,\n\t\t\t\t\tpopupBindOptions: props.popupBindOptions,\n\t\t\t\t\tthumbnailHeight: props.thumbnailHeight || DEFAULT_THUMBNAIL_HEIGHT,\n\t\t\t\t\tthumbnailWidth: props.thumbnailWidth || DEFAULT_THUMBNAIL_WIDTH,\n\t\t\t\t\tmaxPhotoCount: props.maxPhotoCount || DEFAULT_MAX_PHOTO_COUNT,\n\t\t\t\t\tmapBehavior: props.mapBehavior || DEFAULT_MAP_BEHAVIOR,\n\t\t\t\t\tuserLocationPoint: userLocationPoint\n\t\t\t\t});\n\n\t\t\t\tfeatures.push(mapFeature);\n\t\t\t}\n\t\t}\n\n\t\tconst widget = new Address({\n\t\t\tfeatures,\n\t\t\taddress: props.address,\n\t\t\tmode: props.mode,\n\t\t\taddressFormat,\n\t\t\tlanguageId,\n\t\t});\n\n\t\tif(mapFeature)\n\t\t{\n\t\t\twidget.subscribeOnFeatureEvent((event) => {\n\t\t\t\tconst data = event.getData();\n\n\t\t\t\tif(data.feature instanceof AutocompleteFeature\n\t\t\t\t\t&& data.eventCode === AutocompleteFeature.showOnMapClickedEvent\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tmapFeature.showMap(true);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn widget;\n\t}\n\n\tcreateFieldsFeature(props: {}): FieldsFeature\n\t{\n\t\tconst fields = new Fields({\n\t\t\taddressFormat: props.addressFormat,\n\t\t\tlanguageId: props.languageId,\n\t\t});\n\n\t\treturn new FieldsFeature({\n\t\t\tfields\n\t\t});\n\t}\n\n\tcreateAutocompleteFeature(props: {}): AutocompleteFeature\n\t{\n\t\tconst autocomplete = new Autocomplete({\n\t\t\tsourceCode: props.source.sourceCode,\n\t\t\tlanguageId: props.languageId,\n\t\t\taddressFormat: props.addressFormat,\n\t\t\tautocompleteService: props.source.autocompleteService,\n\t\t\tuserLocationPoint: props.userLocationPoint,\n\t\t\tpresetLocationsProvider: props.presetLocationsProvider,\n\t\t});\n\n\t\treturn new AutocompleteFeature({\n\t\t\tautocomplete\n\t\t});\n\t}\n\n\tcreateMapFeature(props: {}): MapFeature\n\t{\n\t\tlet popupOptions = {\n\t\t\tcacheable: true,\n\t\t\tcloseByEsc: true,\n\t\t\tclassName: `location-popup-window location-source-${props.source.sourceCode}`,\n\t\t\tanimation: 'fading',\n\t\t\tangle: true,\n\t\t\tbindOptions: props.popupBindOptions\n\t\t};\n\t\tif(props.popupOptions)\n\t\t{\n\t\t\tpopupOptions = Object.assign(popupOptions, props.popupOptions);\n\t\t}\n\t\tconst popup = new Popup(popupOptions);\n\n\t\tlet gallery = null;\n\n\t\tif(props.maxPhotoCount > 0)\n\t\t{\n\t\t\tgallery = new Gallery({\n\t\t\t\tphotoService: props.source.photoService,\n\t\t\t\tthumbnailHeight: props.thumbnailHeight,\n\t\t\t\tthumbnailWidth: props.thumbnailWidth,\n\t\t\t\tmaxPhotoCount: props.maxPhotoCount\n\t\t\t});\n\t\t}\n\n\t\tconst mapFeatureProps = {\n\t\t\tsaveResourceStrategy: props.source.sourceCode === Google.code,\n\t\t\tmap: new MapPopup({\n\t\t\t\taddressFormat: props.addressFormat,\n\t\t\t\tmap: props.source.map,\n\t\t\t\tpopup: popup,\n\t\t\t\tgallery: gallery,\n\t\t\t\tlocationRepository: new LocationRepository(),\n\t\t\t\tgeocodingService: props.useGeocodingService ? props.source.geocodingService : null,\n\t\t\t\tuserLocationPoint: props.userLocationPoint\n\t\t\t})\n\t\t};\n\n\t\tlet result;\n\n\t\tif(props.mapBehavior === 'manual')\n\t\t{\n\t\t\tresult = new MapFeature(mapFeatureProps);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = new MapFeatureAuto(mapFeatureProps);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","import {EventEmitter} from \"main.core.events\";\nimport {Tag} from \"main.core\";\n\nexport default class Switch extends EventEmitter\n{\n\tstatic STATE_OFF = 0;\n\tstatic STATE_ON = 1;\n\n\tstatic #onToggleEvent = \"onToggleEvent\";\n\n\t#state;\n\t#titleContainer;\n\t#titles = ['on', 'off'];\n\n\tconstructor(props = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Switch');\n\t\tthis.#state = props.state;\n\t\tthis.#titles = props.titles;\n\t}\n\n\tset state(state: string)\n\t{\n\t\tthis.#state = state;\n\n\t\tif(this.#titleContainer)\n\t\t{\n\t\t\tthis.#titleContainer.innerHTML = this.#getTitle();\n\t\t}\n\t}\n\n\tget state(): string\n\t{\n\t\treturn this.#state;\n\t}\n\n\t#getTitle()\n\t{\n\t\treturn this.#titles[this.#state];\n\t}\n\n\trender(mode: number)\n\t{\n\t\tthis.#titleContainer = Tag.render`\t\t\t\n\t\t\t<span class=\"ui-link ui-link-secondary ui-entity-editor-block-title-link\">\n\t\t\t\t${this.#getTitle()}\n\t\t\t</span>`;\n\n\t\tthis.#titleContainer.addEventListener(\n\t\t\t'click',\n\t\t\t(event) => {\n\t\t\t\tthis.state = this.#state === Switch.STATE_OFF ? Switch.STATE_ON : Switch.STATE_OFF;\n\t\t\t\tthis.emit(Switch.#onToggleEvent, {state: this.#state});\n\t\t\t\tevent.stopPropagation();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t);\n\n\t\tthis.#titleContainer.addEventListener(\n\t\t\t'mouseover',\n\t\t\t(event) => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t);\n\n\t\treturn this.#titleContainer;\n\t}\n\n\tsubscribeOnToggleEventSubscribe(listener: Function): void\n\t{\n\t\tthis.subscribe(Switch.#onToggleEvent, listener);\n\t}\n}\n","import {EventEmitter} from \"main.core.events\";\nimport {Tag} from \"main.core\";\n\nexport default class Icon extends EventEmitter\n{\n\tstatic #onClickEvent = 'onClick';\n\n\tstatic TYPE_CLEAR = 'clear';\n\tstatic TYPE_SEARCH = 'search';\n\tstatic TYPE_LOADER = 'loader';\n\n\t#type = Icon.TYPE_SEARCH;\n\t#domNode;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Location.Widget.Icon');\n\t}\n\n\tset type(type: string): void\n\t{\n\t\tthis.#type = type;\n\n\t\tif(this.#domNode)\n\t\t{\n\t\t\tthis.#domNode.className = this.#getClassByType(this.#type);\n\t\t}\n\t}\n\n\t#getClassByType(iconType: string): void\n\t{\n\t\tlet iconClass = '';\n\n\t\tif(iconType === Icon.TYPE_CLEAR)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-btn ui-ctl-icon-clear\";\n\t\t}\n\t\telse if(iconType === Icon.TYPE_SEARCH)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-search\";\n\t\t}\n\t\telse if(iconType === Icon.TYPE_LOADER)\n\t\t{\n\t\t\ticonClass = \"ui-ctl-after ui-ctl-icon-loader\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.debug('Wrong icon type');\n\t\t}\n\n\t\treturn iconClass;\n\t}\n\n\trender(props)\n\t{\n\t\tthis.#type = props.type;\n\t\tthis.#domNode = Tag.render`<div class=\"${this.#getClassByType(this.#type)}\"></div>`;\n\n\t\tthis.#domNode.addEventListener(\n\t\t\t'click',\n\t\t\t(e) => {\n\t\t\t\tthis.emit(Icon.#onClickEvent);\n\t\t\t}\n\t\t);\n\n\t\treturn this.#domNode;\n\t}\n\n\tsubscribeOnClickEvent(listener: Function): void\n\t{\n\t\tthis.subscribe(Icon.#onClickEvent, listener);\n\t}\n}","import {Type, Tag, Dom} from 'main.core';\nimport {Address, ControlMode, ErrorPublisher} from 'location.core';\nimport {BaseEvent} from 'main.core.events';\nimport './css/ui-address.css';\nimport {State as WidgetState} from 'location.widget';\nimport Factory from '../factory';\nimport Switch from './switch';\nimport Icon from './icon';\n\n/**\n * Address field widget for the ui.entity-editor\n */\nexport default class UIAddress extends BX.UI.EntityEditorField\n{\n\tconstructor(props)\n\t{\n\t\tsuper(props);\n\n\t\tthis._input = null;\n\t\tthis._inputIcon = null;\n\t\tthis._hiddenInput = null;\n\t\tthis._innerWrapper = null;\n\t\tthis._addressWidget = null;\n\t\tthis._addressFieldsContainer = null;\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new UIAddress();\n\t\tself.initialize(id, settings);\n\t\treturn self;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tsuper.initialize(id, settings);\n\n\t\tconst value = this.getValue();\n\t\tlet address = null;\n\n\t\tif(Type.isStringFilled(value))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\taddress = new Address(JSON.parse(value));\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tBX.debug('Cant parse address value');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\n\t\tconst widgetFactory = new Factory();\n\n\t\tthis._addressWidget = widgetFactory.createAddressWidget({\n\t\t\taddress: address,\n\t\t\tmode: this._mode === BX.UI.EntityEditorMode.edit ? ControlMode.edit : ControlMode.view,\n\t\t\tpopupBindOptions: {\n\t\t\t\tposition: 'right'\n\t\t\t}\n\t\t});\n\n\t\tthis._addressWidget.subscribeOnStateChangedEvent(this.#onAddressWidgetChangedState.bind(this));\n\t\tthis._addressWidget.subscribeOnAddressChangedEvent(this.#onAddressChanged.bind(this));\n\n\t\tthis._fieldsSwitch = new Switch({\n\t\t\tstate: Switch.STATE_OFF,\n\t\t\ttitles: [\n\t\t\t\tBX.message('LOCATION_WIDGET_AUI_MORE'),\n\t\t\t\tBX.message('LOCATION_WIDGET_AUI_BRIEFLY')\n\t\t\t]\n\t\t});\n\t\tthis._fieldsSwitch.subscribeOnToggleEventSubscribe(this.#onFieldsSwitchToggle.bind(this));\n\t}\n\n\t#onIconClick()\n\t{\n\t\tif(this._input.value !== '')\n\t\t{\n\t\t\tthis._input.value = '';\n\t\t\tthis._addressWidget.address = null;\n\t\t\tthis._inputIcon.type = Icon.TYPE_SEARCH;\n\t\t}\n\n\t\tif(this.hasError())\n\t\t{\n\t\t\tthis.clearError();\n\t\t}\n\t}\n\n\t#onFieldsSwitchToggle(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst state = data.state;\n\n\t\tif(state === Switch.STATE_OFF)\n\t\t{\n\t\t\tthis.#hideFields();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showFields();\n\t\t}\n\n\t\tthis._addressWidget.resetView();\n\t}\n\n\tfocus()\n\t{\n\t\tif(!this._input)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.focus(this._input);\n\t\tBX.UI.EditorTextHelper.getCurrent().setPositionAtEnd(this._input);\n\t}\n\n\t#hideFields()\n\t{\n\t\tif(this._addressFieldsContainer)\n\t\t{\n\t\t\tthis._addressFieldsContainer.classList.remove('visible');\n\t\t}\n\t}\n\n\t#showFields()\n\t{\n\t\tif(this._addressFieldsContainer)\n\t\t{\n\t\t\tthis._addressFieldsContainer.classList.add('visible');\n\t\t}\n\t}\n\n\t#onAddressWidgetChangedState(event)\n\t{\n\t\tconst data = event.getData();\n\t\tconst state = data.state;\n\t\tlet iconType;\n\n\t\tif(data.state === WidgetState.DATA_LOADING)\n\t\t{\n\t\t\ticonType = Icon.TYPE_LOADER;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(data.state === WidgetState.DATA_INPUTTING)\n\t\t\t{\n\t\t\t\tthis.markAsChanged();\n\t\t\t}\n\n\t\t\ticonType = UIAddress.#chooseInputIconTypeByAddress(this.#getAddress());\n\t\t}\n\n\n\t\tthis._inputIcon.type = iconType;\n\t}\n\n\tgetModeSwitchType(mode)\n\t{\n\t\tlet result = BX.UI.EntityEditorModeSwitchType.common;\n\n\t\tif(mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\t// eslint-disable-next-line no-bitwise\n\t\t\tresult |= BX.UI.EntityEditorModeSwitchType.button | BX.UI.EntityEditorModeSwitchType.content;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tdoSetMode(mode)\n\t{\n\t\tthis._addressWidget.mode = mode === BX.UI.EntityEditorMode.edit ? ControlMode.edit : ControlMode.view;\n\t\tthis._fieldsSwitch.state = Switch.STATE_OFF;\n\t}\n\n\tgetContentWrapper()\n\t{\n\t\treturn this._innerWrapper;\n\t}\n\n\t#onAddressChanged(event: BaseEvent): void\n\t{\n\t\tconst data = event.getData();\n\t\tconst address = data.address;\n\n\t\tif(this._hiddenInput)\n\t\t{\n\t\t\tthis._hiddenInput.value = address ? address.toJson() : '';\n\t\t\tthis.markAsChanged();\n\t\t}\n\n\t\tif(this._inputIcon)\n\t\t{\n\t\t\tthis._inputIcon.type = UIAddress.#chooseInputIconTypeByAddress(address);\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tif(!this.isEditable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst address = this.#getAddress();\n\n\t\tthis._model.setField(\n\t\t\tthis.getName(),\n\t\t\taddress ? address.toJson() : ''\n\t\t);\n\n\t\tthis._addressWidget.resetView();\n\t}\n\n\tshowError(error, anchor)\n\t{\n\t\tsuper.showError.apply(this, [error, anchor]);\n\n\t\tif(this._input)\n\t\t{\n\t\t\tBX.addClass(this._inputContainer, 'ui-ctl-danger');\n\t\t}\n\t}\n\n\tclearError()\n\t{\n\t\tsuper.clearError.apply(this);\n\n\t\tif(this._input)\n\t\t{\n\t\t\tBX.removeClass(this._inputContainer, 'ui-ctl-danger');\n\t\t}\n\t}\n\n\tdoClearLayout(options)\n\t{\n\t\tthis._input = null;\n\t\tthis._innerWrapper = null;\n\t\tthis._inputContainer = null;\n\t\tthis._addressFieldsContainer = null;\n\t\tthis._inputIcon = null;\n\t\tthis._hiddenInput = null;\n\t\tDom.clean(this._innerWrapper);\n\t}\n\n\tvalidate(result)\n\t{\n\t\tif(!(this._mode === BX.UI.EntityEditorMode.edit && this._input))\n\t\t{\n\t\t\tthrow Error('BX.Location.UIAddress. Invalid validation context');\n\t\t}\n\n\t\tthis.clearError();\n\n\t\tif(this.hasValidators())\n\t\t{\n\t\t\treturn this.executeValidators(result);\n\t\t}\n\n\t\tconst isValid = !this.isRequired() || BX.util.trim(this._input.value) !== '';\n\n\t\tif(!isValid)\n\t\t{\n\t\t\tresult.addError(BX.UI.EntityValidationError.create({field: this}));\n\t\t\tthis.showRequiredFieldError(this._input);\n\t\t}\n\t\treturn isValid;\n\t}\n\n\tgetRuntimeValue()\n\t{\n\t\treturn (this._mode === BX.UI.EntityEditorMode.edit\n\t\t\t? this.#getAddress() : null\n\t\t);\n\t}\n\n\tstatic #chooseInputIconTypeByAddress(address: ?Address): string\n\t{\n\t\treturn address ? Icon.TYPE_CLEAR : Icon.TYPE_SEARCH;\n\t};\n\n\t#convertAddressToString(address: ?Address): string\n\t{\n\t\tif(!address)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn address.toString(this._addressWidget.addressFormat);\n\t}\n\n\t#getAddress(): Address\n\t{\n\t\treturn this._addressWidget.address;\n\t}\n\n\tlayout(options): void\n\t{\n\t\tif(this._hasLayout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ensureWrapperCreated({classNames: ['ui-entity-card-content-block-field-phone']});\n\t\tthis.adjustWrapper();\n\n\t\tconst title = this.getTitle();\n\n\t\tif(this.isDragEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createDragButton());\n\t\t}\n\n\t\tconst addressWidgetParams = {};\n\n\t\tif(this._mode === BX.UI.EntityEditorMode.edit)\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\n\t\t\tthis._input = Tag.render`<input class=\"ui-ctl-element ui-ctl-textbox\" value=\"\" type=\"text\" autocomplete=\"off\" name=\"${`${this.getName()}_STRING`}\">`;\n\t\t\tthis._hiddenInput = Tag.render`<input value='${this.getValue()}' type=\"hidden\" name=\"${this.getName()}\">`;\n\t\t\tthis._inputIcon = new Icon();\n\t\t\tthis._inputIcon.subscribeOnClickEvent(this.#onIconClick.bind(this));\n\t\t\tconst inputIconNode = this._inputIcon.render({\n\t\t\t\ttype: UIAddress.#chooseInputIconTypeByAddress(this.#getAddress())\n\t\t\t});\n\n\t\t\tthis._inputContainer = Tag.render`<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\">${inputIconNode}${this._input}${this._hiddenInput}</div>`;\n\t\t\tthis._titleWrapper.appendChild(Tag.render`${this._fieldsSwitch.render(this._mode)}`);\n\n\t\t\tthis._innerWrapper = Tag.render`\t\t\t\t\t\t    \n\t\t\t\t<div class=\"location-search-control-block\">\t\t\t\t\t\n\t\t\t\t\t${this._inputContainer}\n\t\t\t\t</div>`;\n\n\t\t\taddressWidgetParams.inputNode = this._input;\n\t\t\taddressWidgetParams.mapBindElement = inputIconNode;\n\n\t\t\tthis._addressFieldsContainer = Tag.render`<div class=\"location-fields-control-block\"></div>`;\n\n\t\t\tif(this._fieldsSwitch.state === Switch.STATE_ON)\n\t\t\t{\n\t\t\t\tthis._addressFieldsContainer.classList.add('visible');\n\t\t\t}\n\n\t\t\taddressWidgetParams.fieldsContainer = this._addressFieldsContainer;\n\t\t\tthis._innerWrapper.appendChild(this._addressFieldsContainer);\n\t\t}\n\t\telse// if(this._mode === BX.UI.EntityEditorMode.view)\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\n\t\t\tlet addressStringNode;\n\n\t\t\tif(this.hasContentToDisplay())\n\t\t\t{\n\t\t\t\tconst addressString = this.#convertAddressToString(this.#getAddress());\n\t\t\t\taddressStringNode = Tag.render`<span class=\"ui-link ui-link-dark ui-link-dotted\">${addressString}</span>`;\n\n\t\t\t\tthis._innerWrapper = Tag.render`\n\t\t\t\t\t<div class=\"location-search-control-block\">\n\t\t\t\t\t\t<div class=\"ui-entity-editor-content-block-text\">\n\t\t\t\t\t\t\t${addressStringNode}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\n\t\t\t\taddressWidgetParams.mapBindElement = addressStringNode;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._innerWrapper = Tag.render`<div class=\"location-search-control-block\">\n\t\t\t\t\t${BX.message('UI_ENTITY_EDITOR_FIELD_EMPTY')}\n\t\t\t\t</div>`;\n\n\t\t\t\taddressWidgetParams.mapBindElement = this._innerWrapper;\n\t\t\t}\n\t\t}\n\n\t\taddressWidgetParams.controlWrapper = this._innerWrapper;\n\t\tthis._addressWidget.render(addressWidgetParams);\n\t\tthis._wrapper.appendChild(this._innerWrapper);\n\n\t\tthis._addressWidget.subscribeOnErrorEvent(this.errorListener.bind(this));\n\n\t\tif(this.isContextMenuEnabled())\n\t\t{\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\n\t\t}\n\n\t\tif(this.isDragEnabled())\n\t\t{\n\t\t\tthis.initializeDragDropAbilities();\n\t\t}\n\n\t\tthis.registerLayout(options);\n\t\tthis._hasLayout = true;\n\t}\n\n\terrorListener(event: BaseEvent)\n\t{\n\t\tconst data = event.getData();\n\t\tconst errors = data.errors;\n\n\t\tif(this._inputIcon)\n\t\t{\n\t\t\tthis._inputIcon.type = Icon.TYPE_CLEAR;\n\t\t}\n\n\t\tif(!Type.isArray(errors))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// todo: this.showError supports only one error\n\t\terrors.forEach((error) => {\n\t\t\tlet message;\n\n\t\t\tif(error.message)\n\t\t\t{\n\t\t\t\tmessage = error.message;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmessage = BX.message('LOCATION_WIDGET_AUI_UNKNOWN_ERROR');\n\t\t\t}\n\n\t\t\tif(error.code)\n\t\t\t{\n\t\t\t\tmessage += ` [${error.code}]`;\n\t\t\t}\n\n\t\t\tthis.showError(message);\n\t\t});\n\t}\n\n\tprocessModelChange(params)\n\t{\n\t\tif(BX.prop.get(params, 'originator', null) === this)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(!BX.prop.getBoolean(params, 'forAll', false)\n\t\t\t&& BX.prop.getString(params, 'name', '') !== this.getName()\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.refreshLayout();\n\t}\n\n\tstatic registerField(): void\n\t{\n\t\tif(typeof BX.UI.EntityEditorControlFactory !== 'undefined')\n\t\t{\n\t\t\tBX.UI.EntityEditorControlFactory.registerFactoryMethod('address', UIAddress.registerFieldMethod);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.addCustomEvent('BX.UI.EntityEditorControlFactory:onInitialize', (params, eventArgs) =>\n\t\t\t{\n\t\t\t\teventArgs.methods.address = UIAddress.registerFieldMethod;\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic registerFieldMethod(type, controlId, settings): ?UIAddress\n\t{\n\t\tlet result = null;\n\n\t\tif(type === 'address')\n\t\t{\n\t\t\tresult = UIAddress.create(controlId, settings);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","import Address from './address/address';\nimport Factory from './factory';\nimport UIAddress from './ui-address/ui-address';\nimport State from './state';\nimport BaseFeature from './address/features/basefeature';\nimport MapFeature from './address/features/mapfeature';\nimport AutocompleteFeature from './address/features/autocompletefeature';\nimport FieldsFeature from './address/features/fieldsfeature';\n\n/* A set of widgets for using to deal with addresses */\nexport {\n\n\t// Main Widget\n\tAddress,\n\n\t// Widget features\n\tBaseFeature,\n\n\tMapFeature,\n\tAutocompleteFeature,\n\tFieldsFeature,\n\n\t// Widget factory\n\tFactory,\n\n\t// Possible widget states\n\tState,\n\n\t/* Address field for the ui.forms.\n\t * This can be used as an example of the widget implementation\n\t */\n\tUIAddress,\n};\n\n// Register fields for ui.entity-editor\nUIAddress.registerField();\n"],"names":["State","AddressString","props","addressFormat","Format","Error","address","addresStr","Tag","render","hide","style","display","innerHTML","isHidden","show","result","AddressStringConverter","convertAddressToStringTemplate","getTemplate","FormatTemplateType","DEFAULT","CONTENT_TYPE_HTML","Vue","extend","required","methods","handleApplyClick","$emit","convertAddressToString","toString","STRATEGY_TYPE_TEMPLATE_COMMA","computed","addressString","CONTENT_TYPE_TEXT","containerStyles","containerClasses","hidden","localize","getFilteredPhrases","template","Popup","_classPrivateMethodInitSpec","bindElement","bindOptions","isCustomPosition","isCustomPositionSuccess","position","MainPopup","bindElRect","getBoundingClientRect","popupHeight","getPopupContainer","offsetHeight","popupWidth","offsetWidth","left","width","document","documentElement","clientWidth","angleOffsetY","top","window","pageYOffset","height","body","clientHeight","setAngle","offset","Dom","adjust","popupContainer","zIndex","getZindex","MapPopup","_classPrivateFieldInitSpec","setEventNamespace","map","MapBase","BX","debug","geocodingService","GeocodingServiceBase","onLocationChangedEventSubscribe","_classPrivateMethodGet","bind","popup","gallery","locationRepository","userLocationPoint","mode","useUserLocation","then","location","emit","onMapShow","isShown","close","$props","listener","subscribe","destroy","remove","Event","unbindAll","getBindElement","Type","isDomNode","setBindElement","EventEmitter","AddressApplier","propsData","$mount","$on","event","prevAddress","data","getData","toAddress","fieldCollection","isEqual","LocationType","ADDRESS_LINE_1","latitude","longitude","mapInnerContainer","thirdPartyWarningNode","Loc","getMessage","ControlMode","edit","$el","e","stopPropagation","setContent","lat","lon","Promise","resolve","view","Location","latLon","type","getType","mapContainer","BaseFeature","_saveResourceStrategy","saveResourceStrategy","MethodNotImplemented","addressWidget","Address","AddressEntity","isValid","isString","languageId","TypeError","features","isArray","forEach","feature","isBoolean","needWarmBackendAfterAddressChanged","LocationRepository","INITIAL","sourceFeature","excludeFeatures","options","addressId","id","getFieldValue","AddressType","isTemplateExists","setFieldValue","storeAsLastAddress","hasOwnProperty","DATA_INPUTTING","featureEvent","onFeatureEvent","code","resetView","controlWrapper","inputNode","onInputKeyup","onInputInput","state","onStateChangedEvent","onAddressChangedEvent","ErrorPublisher","getInstance","unbind","setAddressWidget","push","method","params","isExcluded","excludeFeature","apply","findParents","value","length","setCaretPosition","templateType","console","error","shortAddressString","AUTOCOMPLETE","fullAddressString","trim","title","selectionStart","selectionEnd","setSelectionRange","fieldForUnRecognized","isFieldExists","LOCALITY","Storage","lastAddress","splice","MenuBottom","node","firstChild","removeChild","appendChild","Menu","elRect","popupWindow","setMaxWidth","layout","menuContainer","menuItems","choseItemIdx","getPopupWindow","isDestroyed","index","isItemChosen","isItemExist","isMenuEmpty","isChoseLastItem","chooseItem","getChosenItem","isChoseFirstItem","item","classList","add","idx","unHighlightItem","highlightItem","removeMenuItem","setRightItemNode","setLeftItemNode","MainMenu","Prompt","menuNode","locationsList","searchPhrase","setMenuItems","getMenu","clearItems","Array","slice","showFlatList","addMenuItem","isSeparatorSet","html","delimiter","isRecursive","choosePrevItem","chooseNextItem","menuItem","locationName","clarification","TMP_TYPE_CLARIFICATION","TMP_TYPE_HINT","autoHide","closeByEsc","className","includes","ADM_LEVEL_1","name","createMenuItemText","onclick","onItemSelectedEvent","undefined","input","HTMLInputElement","setValueFromAddress","isPureAddress","setValue","indexOf","Autocomplete","requested","current","dropped","autocompleteService","AutocompleteServiceBase","sourceCode","presetLocationsProvider","addEventListener","removeEventListener","presetLocationList","leftBottomMenuMessage","element","text","leftBottomText","setBottomRightItemNode","setBottomLeftItemNode","relatedTarget","getAttribute","DATA_SUPPOSED","isChanged","hasPureAddressString","customTail","currentValue","newValue","stopImmediatePropagation","COUNTRY","ADDRESS_LINE_2","setTimeout","hasExternalRelation","showPrompt","biasPoint","Point","target","externalId","closePrompt","DATA_SELECTED","detailedLocation","addressLine2","response","notify","errors","excludeSetAddressFeatures","DATA_LOADING","findByExternalId","DATA_LOADED","ctrlKey","metaKey","shiftKey","key","onLocationSelectTimeout","actualize","timeout","clearTimeout","autocomplete","Photo","url","link","description","Gallery","thumbnailHeight","thumbnailWidth","maxPhotoCount","photoService","requestPhotos","photosData","refresh","photos","photo","thumbnail","util","strip_tags","renderedPhotos","Field","sort","container","Text","encode","Fields","field","clean","fields","formatField","subscribeOnValueChangedEvent","subscribeOnStateChangedEvent","a","b","changedField","MapFeature","onChangedEventSubscribe","setAddressByFeature","bindelement","closeMap","mapBindElement","AutocompleteFeature","onAddressChangedEventSubscribe","onStateChangedEventSubscribe","setStateByFeature","onSearchStartedEventSubscribe","emitFeatureEvent","eventCode","searchStartedEvent","payload","onSearchCompletedEventSubscribe","searchCompletedEvent","onShowOnMapClickedEventSubscribe","showOnMapClickedEvent","autocompleteMenuElement","FieldsFeature","subscribeOnAddressChangedEvent","fieldsContainer","MapFeatureAuto","onMouseOverSubscribe","onMouseOutSubscribe","showMap","Factory","message","sourceParams","sourceLanguageId","JSON","parse","useFeatures","createFieldsFeature","source","SourceFactory","create","SourceCreationError","mapFeature","createAutocompleteFeature","showPhotos","useGeocodingService","DEFAULT_THUMBNAIL_HEIGHT","DEFAULT_THUMBNAIL_WIDTH","DEFAULT_MAX_PHOTO_COUNT","DEFAULT_MAP_BEHAVIOR","createMapFeature","popupOptions","popupBindOptions","mapBehavior","widget","subscribeOnFeatureEvent","cacheable","animation","angle","Object","assign","mapFeatureProps","Google","Switch","titles","STATE_OFF","STATE_ON","Icon","TYPE_SEARCH","iconType","iconClass","TYPE_CLEAR","TYPE_LOADER","UIAddress","_input","_inputIcon","_hiddenInput","_innerWrapper","_addressWidget","_addressFieldsContainer","settings","getValue","isStringFilled","widgetFactory","createAddressWidget","_mode","UI","EntityEditorMode","_fieldsSwitch","subscribeOnToggleEventSubscribe","focus","EditorTextHelper","getCurrent","setPositionAtEnd","EntityEditorModeSwitchType","common","button","content","isEditable","_model","setField","getName","toJson","anchor","addClass","_inputContainer","removeClass","clearError","hasValidators","executeValidators","isRequired","addError","EntityValidationError","showRequiredFieldError","_hasLayout","ensureWrapperCreated","classNames","adjustWrapper","getTitle","isDragEnabled","_wrapper","createDragButton","addressWidgetParams","createTitleNode","subscribeOnClickEvent","inputIconNode","_titleWrapper","addressStringNode","hasContentToDisplay","subscribeOnErrorEvent","errorListener","isContextMenuEnabled","createContextMenuButton","initializeDragDropAbilities","registerLayout","showError","prop","get","getBoolean","getString","refreshLayout","self","initialize","EntityEditorControlFactory","registerFactoryMethod","registerFieldMethod","addCustomEvent","eventArgs","controlId","EntityEditorField","hasError","WidgetState","markAsChanged","registerField"],"mappings":"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"}