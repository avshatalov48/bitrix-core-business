this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};this.BX.Calendar.Sync=this.BX.Calendar.Sync||{};(function(e,t,n,s,i,a,o,c,r,d,l,h,p,u){"use strict";let g=e=>e,_,C,v,E,S;class T{constructor(e){this.status=e.status;this.connections=e.connections;this.withStatusLabel=e.withStatusLabel;this.popupWithUpdateButton=e.popupWithUpdateButton;this.popupId=e.popupId}static createInstance(e){return new this(e)}setStatus(e){this.status=e;return this}setConnections(e){this.connections=e;return this}getContent(){let e;if(this.status==="success"){e=h.Tag.render(_||(_=g`
				<div id="status-info-block" class="ui-alert ui-alert-success calendar-sync-status-info">
					<span class="ui-alert-message">${0}</span>
				</div>
			`),h.Loc.getMessage("SYNC_STATUS_SUCCESS"))}else if(this.status==="failed"){e=h.Tag.render(C||(C=g`
				<div id="status-info-block" class="ui-alert ui-alert-danger calendar-sync-status-info">
					<span class="ui-alert-message">${0}</span>
				</div>
			`),h.Loc.getMessage("SYNC_STATUS_ALERT"))}else{e=h.Tag.render(v||(v=g`
				<div id="status-info-block" class="ui-alert ui-alert-primary calendar-sync-status-info">
					<span class="ui-alert-message">${0}</span>
				</div>
			`),h.Loc.getMessage("SYNC_STATUS_NOT_CONNECTED"))}e.addEventListener("mouseenter",(()=>{this.handlerMouseEnter(e)}));e.addEventListener("mouseleave",(()=>{this.handlerMouseLeave()}));this.statusBlock=h.Tag.render(E||(E=g`
			<div class="calendar-sync-status-block" id="calendar-sync-status-block">
				${0}
				${0}
			</div>
		`),this.getStatusTextLabel(),e);return this.statusBlock}getStatusTextLabel(){return this.withStatusLabel?h.Tag.render(S||(S=g`
				<div class="calendar-sync-status-subtitle">
					<span data-hint=""></span>
					<span class="calendar-sync-status-text">${0}:</span>
				</div>`),h.Loc.getMessage("LABEL_STATUS_INFO")):""}handlerMouseEnter(e){clearTimeout(this.statusBlockEnterTimeout);this.buttonEnterTimeout=setTimeout((()=>{this.statusBlockEnterTimeout=null;this.showPopup(e)}),500)}handlerMouseLeave(){if(this.statusBlockEnterTimeout!==null){clearTimeout(this.statusBlockEnterTimeout);this.statusBlockEnterTimeout=null;return}this.statusBlockLeaveTimeout=setTimeout((()=>{this.hidePopup()}),500)}showPopup(e){if(this.status!=="not_connected"){this.popup=this.getPopup(e);this.popup.show();this.addPopupHandlers()}}hidePopup(){if(this.popup){this.popup.hide()}}addPopupHandlers(){this.popup.getPopup().getPopupContainer().addEventListener("mouseenter",(()=>{clearTimeout(this.statusBlockEnterTimeout);clearTimeout(this.statusBlockLeaveTimeout)}));this.popup.getPopup().getPopupContainer().addEventListener("mouseleave",(()=>{this.hidePopup()}))}getPopup(e){return i.SyncStatusPopup.createInstance({connections:this.connections,withUpdateButton:this.popupWithUpdateButton,node:e,id:this.popupId})}refresh(e,t){this.status=e;this.connections=t;return this}}let y=e=>e,I,L,A,N,f,m,D;class b{constructor(e){this.MAIN_SYNC_SLIDER_NAME="calendar:auxiliary-sync-slider";this.SLIDER_WIDTH=684;this.LOADER_NAME="calendar:loader";this.cache=new h.Cache.MemoryCache;this.status=e.status;this.connectionsProviders=e.connectionsProviders;this.userId=e.userId;this.statusBlockEnterTimeout=null;this.statusBlockLeaveTimeout=null}openSlider(){BX.SidePanel.Instance.open(this.MAIN_SYNC_SLIDER_NAME,{contentCallback:e=>new Promise(((e,t)=>{e(this.getContent())})),allowChangeHistory:false,events:{onLoad:()=>{this.setGridContent()}},cacheable:false,width:this.SLIDER_WIDTH,loader:this.LOADER_NAME})}getContent(){return h.Tag.render(I||(I=y`
			<div class="calendar-sync-wrap">
				${0}
				${0}
				${0}
				${0}
				${0}
			</div>
		`),this.getHeader(),this.getMobileHeader(),this.getMobileContentWrapper(),this.getWebHeader(),this.getWebContentWrapper())}getHeader(){return h.Tag.render(L||(L=y`
			<div class="calendar-sync-header">
				${0}
				${0}
			</div>
		`),this.getMainHeader(),this.getStatusBlockContent(this.getConnections()))}getMainHeader(){return this.cache.remember("calendar-syncPanel-mainHeader",(()=>h.Tag.render(A||(A=y`
				<span class="calendar-sync-header-text">${0}</span>
			`),h.Loc.getMessage("SYNC_CALENDAR_HEADER_NEW"))))}getMobileContentWrapper(){return this.cache.remember("calendar-syncPanel-mobileContentWrapper",(()=>h.Tag.render(N||(N=y`
			<div id="calendar-sync-mobile" class="calendar-sync-mobile"></div>
		`))))}getWebContentWrapper(){return this.cache.remember("calendar-syncPanel-webContentWrapper",(()=>h.Tag.render(f||(f=y`
				<div id="calendar-sync-web" class="calendar-sync-web"></div>
			`))))}getMobileHeader(){return this.cache.remember("calendar-syncPanel-mobileHeader",(()=>h.Tag.render(m||(m=y`
				<div class="calendar-sync-title">${0}</div>
			`),h.Loc.getMessage("SYNC_MOBILE_HEADER"))))}getWebHeader(){return this.cache.remember("calendar-syncPanel-webHeader",(()=>h.Tag.render(D||(D=y`
				<div class="calendar-sync-title">${0}</div>
		`),h.Loc.getMessage("SYNC_WEB_HEADER"))))}getStatusBlockContent(e){this.statusBlock=T.createInstance({status:this.status,connections:e,withStatusLabel:true,popupWithUpdateButton:true,popupId:"calendar-syncPanel-status"});this.statusBlockContent=this.statusBlock.getContent();return this.statusBlockContent}getConnections(){const e=[];const t=Object.values(this.connectionsProviders);t.forEach((t=>{const n=t.getConnections();if(n.length>0){n.forEach((t=>{if(i.ConnectionItem.isConnectionItem(t)&&t.getConnectStatus()===true){e.push(t)}}))}}));return e}setGridContent(){const e=Object.values(this.connectionsProviders);this.showWebGridContent(e.filter((e=>e.mainPanel===false&&e.getViewClassification()==="web")));this.showMobileGridContent(e.filter((e=>e.mainPanel===false&&e.getViewClassification()==="mobile")))}showWebGridContent(e){const t=this.getWebContentWrapper();h.Dom.clean(t);const n=new BX.TileGrid.Grid({id:"calendar_sync",items:e,container:t,sizeRatio:"55%",itemMinWidth:180,tileMargin:7,itemType:"BX.Calendar.Sync.Interface.GridUnit",userId:this.userId});n.draw()}showMobileGridContent(e){const t=this.getMobileContentWrapper();h.Dom.clean(t);const n=new BX.TileGrid.Grid({id:"calendar_sync",items:e,container:t,sizeRatio:"55%",itemMinWidth:180,tileMargin:7,itemType:"BX.Calendar.Sync.Interface.GridUnit"});n.draw()}refresh(e,t){this.status=e;this.connectionsProviders=t;this.blockStatusContent=this.statusBlock.refresh(e,this.getConnections()).getContent();h.Dom.replace(document.querySelector("#calendar-sync-status-block"),this.blockStatusContent);this.setGridContent()}}let O=e=>e,M,w,B,P,k,U,R,W,H,x,$;class G{constructor(e){this.COUNTER_FAILED=1;this.logoClassName="";this.options=e;this.connectionProvider=this.options.connectionProvider}getConnectionTemplate(){if(!this.connectionTemplate){this.connectionTemplate=this.connectionProvider.getClassTemplateItem().createInstance(this.connectionProvider,this.connectionProvider.getConnection())}return this.connectionTemplate}renderTo(e){if(h.Type.isElementNode(e)){h.Dom.append(this.getContent(),e)}}getContent(){this.unitNode=h.Tag.render(M||(M=O`
			<div class="calendar-sync__calendar-item">
				<div class="calendar-sync__calendar-item--logo">
					${0}
				</div>
				<div class="calendar-sync__calendar-item--container">
					<div class="calendar-sync__calendar-item--title">
						${0}
						${0}
					</div>
					${0}
				</div>
			</div>
		`),this.getLogoNode(),this.getTitle(),this.getSyncInfoWrap(),this.getButtonsWrap());return this.unitNode}getLogoNode(){return h.Tag.render(w||(w=O`<div class="calendar-sync__calendar-item--logo-image ${0}"></div>`),this.connectionProvider.getSyncPanelLogo())}getTitle(){return this.connectionProvider.getSyncPanelTitle()}getSyncInfoWrap(){this.syncInfoWrap=h.Tag.render(B||(B=O`
			<div class="calendar-sync__account-info">
				<div class="calendar-sync__account-info--icon --animate"></div>
				<span data-role="sync_info_text" />
			</div>
		`));return this.syncInfoWrap}setSyncStatus(e){this.unitNode.className="calendar-sync__calendar-item";this.syncInfoWrap.className="calendar-sync__account-info";switch(e){case this.connectionProvider.STATUS_REFUSED:h.Dom.addClass(this.unitNode,"--refused");this.setSyncInfoStatusText(h.Loc.getMessage("CAL_SYNC_INFO_STATUS_REFUSED"),false);break;case this.connectionProvider.STATUS_SUCCESS:h.Dom.addClass(this.unitNode,"--complete");this.setSyncInfoStatusText(this.formatSyncTime(this.connectionProvider.getSyncDate()));break;case this.connectionProvider.STATUS_FAILED:if(this.connectionProvider.doSupportReconnectionScenario()){h.Dom.addClass(this.unitNode,"--error-reconnect");h.Dom.addClass(this.syncInfoWrap,"--error-reconnect");const e=this.connectionProvider.getFailedConnectionName();this.setSyncInfoStatusText(h.Loc.getMessage("CAL_SYNC_INFO_STATUS_ERROR_RECONNECT",{"#TYPE#":e==="iCloud"?"iCloud":h.Text.capitalize(e)}),false)}else{h.Dom.addClass(this.unitNode,"--error");this.setSyncInfoStatusText(h.Loc.getMessage("CAL_SYNC_INFO_STATUS_ERROR"))}break;case this.connectionProvider.STATUS_PENDING:h.Dom.addClass(this.unitNode,"--pending");this.setSyncInfoStatusText("");break;case this.connectionProvider.STATUS_SYNCHRONIZING:h.Dom.addClass(this.unitNode,"--active");this.setSyncInfoStatusText(h.Loc.getMessage("CAL_SYNC_INFO_STATUS_SYNCHRONIZING"));break;case this.connectionProvider.STATUS_NOT_CONNECTED:if(this.connectionProvider.isGoogleApplicationRefused){h.Dom.addClass(this.unitNode,"--off");this.setSyncInfoStatusText(h.Loc.getMessage("CAL_SYNC_INFO_STATUS_REFUSED"),false)}else{this.setSyncInfoStatusText("")}break;default:break}this.refreshButton()}setSyncInfoStatusText(e,t=true){const n=this.syncInfoWrap.querySelector('[data-role="sync_info_text"]');if(h.Type.isElementNode(n)){n.innerHTML=t?h.Text.encode(e).toUpperCase():h.Text.encode(e)}}getButtonsWrap(){if(!h.Type.isElementNode(this.buttonsWrap)){this.buttonsWrap=h.Tag.render(P||(P=O`<div class="calendar-sync__calendar-item--buttons">
				${0}
				${0}
			</div>`),this.getButton(),this.getMoreButton())}return this.buttonsWrap}refreshButton(){h.Dom.clean(this.buttonsWrap);h.Dom.append(this.getButton(),this.buttonsWrap);h.Dom.append(this.getMoreButton(),this.buttonsWrap)}getButton(){if(this.connectionProvider.isGoogleApplicationRefused){return null}switch(this.connectionProvider.getStatus()){case this.connectionProvider.STATUS_SUCCESS:this.button=h.Tag.render(k||(k=O`
					<a data-role="status-success" class="ui-btn ui-btn-icon-success ui-btn-link">
						${0}
					</a>
				`),h.Loc.getMessage("CAL_BUTTON_STATUS_SUCCESS"));break;case this.connectionProvider.STATUS_FAILED:if(this.connectionProvider.doSupportReconnectionScenario()){const e=this.connectionProvider.getFailedConnectionsCount();this.button=h.Tag.render(U||(U=O`
						<button data-role="status-failed-reconnect" class="ui-btn ui-btn-light-border ui-btn-round">
							<div class="ui-icon-set --refresh-6 calendar-sync__calendar-item_buttons-error"></div>
								${0}
							<div class="calendar-sync__calendar-item_buttons-counter">${0}</div>
						</button>
					`),h.Loc.getMessage("CAL_BUTTON_STATUS_FAILED_RECONNECT"),e);h.Event.bind(this.button,"click",(()=>this.getConnectionTemplate().reconnect()))}else{this.button=h.Tag.render(R||(R=O`
						<a data-role="status-failed" class="ui-btn ui-btn-icon-fail ui-btn-link">
							${0}
						</a>
					`),h.Loc.getMessage("CAL_BUTTON_STATUS_FAILED"))}break;case this.connectionProvider.STATUS_PENDING:this.button=h.Tag.render(W||(W=O`
					<a data-role="status-pending" class="ui-btn ui-btn-disabled ui-btn-link">
						${0}
					</a>
				`),h.Loc.getMessage("CAL_BUTTON_STATUS_PENDING"));break;case this.connectionProvider.STATUS_NOT_CONNECTED:this.button=h.Tag.render(H||(H=O`
					<a data-role="status-not_connected" class="ui-btn ui-btn-success ui-btn-round">
						${0}
					</a>
				`),h.Loc.getMessage("CAL_BUTTON_STATUS_NOT_CONNECTED"));h.Event.bind(this.button,"click",this.handleItemClick.bind(this));break;case this.connectionProvider.STATUS_SYNCHRONIZING:this.button=h.Tag.render(x||(x=O`
					<a data-role="status-not_connected" class="ui-btn ui-btn-success ui-btn-round ui-btn-clock ui-btn-disabled">
						${0}
					</a>
				`),h.Loc.getMessage("CAL_BUTTON_STATUS_SUCCESS"));break;default:break}return this.button}getMoreButton(){this.moreButton=h.Tag.render($||($=O`
			<div
				data-role="more-button" 
				class="ui-btn ui-btn-round ui-btn-light-border calendar-sync__calendar-item--more"
			></div>
		`));h.Event.bind(this.moreButton,"click",this.handleItemClick.bind(this));return this.moreButton}handleItemClick(e){const t=this.connectionProvider.getStatus();if([this.connectionProvider.STATUS_SUCCESS,this.connectionProvider.STATUS_FAILED,this.connectionProvider.STATUS_REFUSED].includes(t)){if(this.connectionProvider.hasMenu()){this.connectionProvider.showMenu(getComputedStyle(this.moreButton).display!=="none"?this.moreButton:this.button)}else if(this.connectionProvider.getConnectStatus()){this.connectionProvider.openActiveConnectionSlider(this.connectionProvider.getConnection())}else{this.connectionProvider.openInfoConnectionSlider()}}else if(t===this.connectionProvider.STATUS_NOT_CONNECTED){this.getConnectionTemplate().handleConnectButton()}}formatSyncTime(e){const t=new Date;let n=e;if(h.Type.isDate(e)){n=Math.round(e.getTime()/1e3);const s=parseInt((t-e)/1e3,10);if(s<60){return h.Loc.getMessage("CAL_JUST")}}if(n===null){return h.Loc.getMessage("CAL_JUST")}return BX.date.format([["tommorow","tommorow, H:i:s"],["i","iago"],["H","Hago"],["d","dago"],["m100","mago"],["m","mago"],["-",""]],n)}}let X=e=>e,F,Y,z,j,K,q,V;class Z{constructor(e){this.MAIN_SYNC_SLIDER_NAME="calendar:sync-slider";this.HELPDESK_CODE=11828176;this.SLIDER_WIDTH=770;this.LOADER_NAME="calendar:loader";this.cache=new h.Cache.MemoryCache;this.status=e.status;this.connectionsProviders=e.connectionsProviders;this.userId=e.userId;this.BX=window.top.BX||window.BX}openSlider(){BX.SidePanel.Instance.open(this.MAIN_SYNC_SLIDER_NAME,{contentCallback:e=>new Promise(((e,t)=>{e(this.getContent())})),allowChangeHistory:false,events:{onLoad:()=>{this.displayConnectionUnits()}},cacheable:false,width:this.SLIDER_WIDTH,loader:this.LOADER_NAME})}getContent(){return h.Tag.render(F||(F=X`
			<div class="calendar-sync__wrapper calendar-sync__scope">
				${0}
				<div class="calendar-sync__content">
				${0}
				${0}
				</div>
			</div>
		`),this.getHeaderWrapper(),this.getUnitsContentWrapper(),this.getFooterWrapper())}getHeaderWrapper(){return h.Tag.render(Y||(Y=X`
			<div class="calendar-sync__header">
				<div class="calendar-sync__header-logo"></div>
				<div class="calendar-sync__header-container">
					<div class="calendar-sync__header-title">${0}</div>
					<div class="calendar-sync__header-sub-title">${0}</div>
				</div>
			</div>
		`),h.Loc.getMessage("CAL_SYNC_TITLE_NEW"),h.Loc.getMessage("CAL_SYNC_SUB_TITLE"))}getUnitsContentWrapper(){this.unitsContentWrapper=h.Tag.render(z||(z=X`
			<div class="calendar-sync__calendar-list">
			</div>
		`));return this.unitsContentWrapper}getFooterWrapper(){return h.Tag.render(j||(j=X`
			<div class="calendar-sync__content-block --space-bottom --space-left">
				${0}
			</div>
			<div class="calendar-sync__content-block --space-bottom --space-left--double">
				${0}
			</div>
			<div class="calendar-sync__content-block --space-left--double">
				${0}
			</div>
		`),this.getExtraInfoWithCheckIcon(),this.getOpenAuxiliaryPanelLink(),this.getOpenHelpLink())}getExtraInfoWithCheckIcon(){const e=Object.values(this.connectionsProviders).filter((e=>e.mainPanel&&e.status)).length>0;return h.Tag.render(K||(K=X`
			<div class="calendar-sync__content-text --icon-check${0}">
				${0}
			</div>
		`),e?" --disabled":"",h.Loc.getMessage("CAL_SYNC_INFO_PROMO"))}getOpenAuxiliaryPanelLink(){const e=h.Tag.render(q||(q=X`
			<div class="calendar-sync__content-link">
				${0}
			</div>
		`),h.Loc.getMessage("CAL_OPEN_AUXILIARY_PANEL"));h.Event.bind(e,"click",(()=>{this.auxiliarySyncPanel=new b({connectionsProviders:this.connectionsProviders,userId:this.userId,status:this.status});this.auxiliarySyncPanel.openSlider()}));return e}getOpenHelpLink(){const e=h.Tag.render(V||(V=X`
			<div class="calendar-sync__content-link">${0}</divclass>
		`),h.Loc.getMessage("CAL_SHOW_SYNC_HELP"));h.Event.bind(e,"click",(()=>{if(this.BX.Helper){this.BX.Helper.show("redirect=detail&code="+this.HELPDESK_CODE)}}));return e}getConnections(){const e=[];const t=Object.values(this.connectionsProviders);t.forEach((t=>{const n=t.getConnections();if(n.length>0){n.forEach((t=>{if(i.ConnectionItem.isConnectionItem(t)&&t.getConnectStatus()===true){e.push(t)}}))}}));return e}displayConnectionUnits(){const e=Object.values(this.connectionsProviders).filter((e=>e.mainPanel||e.connected));this.renderConnectionUnits(e)}renderConnectionUnits(e){h.Dom.clean(this.unitsContentWrapper);e.forEach((e=>{const t=new G({connectionProvider:e});e.setInterfaceUnit(t);t.renderTo(this.unitsContentWrapper);t.setSyncStatus(e.getStatus())}))}showWebGridContent(e){const t=this.getWebContentWrapper();h.Dom.clean(t);const n=new BX.TileGrid.Grid({id:"calendar_sync",items:e,container:t,sizeRatio:"55%",itemMinWidth:180,tileMargin:7,itemType:"BX.Calendar.Sync.Interface.GridUnit",userId:this.userId});n.draw()}refresh(e,t){var n;this.status=e;this.connectionsProviders=t;h.Dom.replace(document.querySelector("#calendar-sync-status-block"),this.blockStatusContent);this.displayConnectionUnits();(n=this.auxiliarySyncPanel)==null?void 0:n.refresh(e,t)}}let J=e=>e,Q,ee,te,ne;class se extends BX.TileGrid.Item{constructor(e){super({id:e.type});this.item=e}getContent(){this.gridUnit=h.Tag.render(Q||(Q=J`<div class="calendar-sync-item ${0}" style="${0}">
			<div class="calendar-item-content">
				${0}
				${0}
				${0}
			</div>
		</div>`),this.getAdditionalContentClass(),this.getContentStyles(),this.getImage(),this.getTitle(),this.isActive()?this.getStatus():"");this.gridUnit.addEventListener("click",this.onClick.bind(this));return this.gridUnit}getTitle(){if(!this.layout.title){this.layout.title=h.Tag.render(ee||(ee=J`
				<div class="calendar-sync-item-title">${0}</div>`),BX.util.htmlspecialchars(this.item.getGridTitle()))}return this.layout.title}getImage(){return h.Tag.render(te||(te=J`
			<div class="calendar-sync-item-image">
				<div class="calendar-sync-item-image-item" style="background-image: ${0}"></div>
			</div>`),"url("+this.item.getGridIcon()+")")}getStatus(){if(this.isActive()){return h.Tag.render(ne||(ne=J`
				<div class="calendar-sync-item-status"></div>
			`))}return""}isActive(){return this.item.getConnectStatus()}getAdditionalContentClass(){if(this.isActive()){if(this.item.getSyncStatus()){return"calendar-sync-item-selected"}else{return"calendar-sync-item-failed"}}else{return""}}getContentStyles(){if(this.isActive()){return"background-color:"+this.item.getGridColor()+";"}else{return""}}onClick(){if(this.item.hasMenu()){this.item.showMenu(this.gridUnit)}else if(this.item.getConnectStatus()){this.item.openActiveConnectionSlider(this.item.getConnection())}else{this.item.openInfoConnectionSlider()}}}let ie=e=>e,ae,oe,ce,re,de,le;class he{constructor(e=null){this.userName=null;this.server=null;this.connectionName=null;this.addButtonText=h.Loc.getMessage("CAL_UPPER_CONNECT");this.removeButtonText=h.Loc.getMessage("CAL_UPPER_DISCONNECT");this.saveButtonText=h.Loc.getMessage("CAL_UPPER_SAVE");if(e!==null){this.userName=BX.util.htmlspecialchars(e.userName);this.server=BX.util.htmlspecialchars(e.server);this.connectionName=BX.util.htmlspecialchars(e.connectionName)}}getWrapper(){return h.Tag.render(ae||(ae=ie`
			<div class="calendar-sync-slider-section calendar-sync-slider-section-form"></div>
		`))}getForm(){return h.Tag.render(oe||(oe=ie`
			<form class="calendar-sync-slider-form" action="">
				<div class="calendar-sync-slider-field">
					<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">
						<input type="text" class="ui-ctl-element" placeholder=\"${0}\" name="name" value="${0}">
					</div>
				</div>
				<div class="calendar-sync-slider-field">
					<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">
						<input type="text" class="ui-ctl-element" placeholder=\"${0}\" name="server" value="${0}">
					</div>
				</div>
				<div class="calendar-sync-slider-field">
					<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">
						<input type="text" class="ui-ctl-element" placeholder=\"${0}\" name="user_name" value="${0}">
					</div>
				</div>
				<div class="calendar-sync-slider-field">
					<div class="ui-ctl ui-ctl-w100 ui-ctl-textbox">
						<input type="password" class="ui-ctl-element" name="password" placeholder=\"${0}\">
					</div>
				</div>
			</form>
		`),h.Loc.getMessage("CAL_TEXT_NAME"),this.connectionName||"",h.Loc.getMessage("CAL_TEXT_SERVER_ADDRESS"),this.server||"",h.Loc.getMessage("CAL_TEXT_USER_NAME"),this.userName||"",h.Loc.getMessage("CAL_TEXT_PASSWORD"))}getAddButton(){return h.Tag.render(ce||(ce=ie`
			<button id="connect-button" class="ui-btn ui-btn-light-border">${0}</button>
		`),this.addButtonText)}getDisconnectButton(){return h.Tag.render(re||(re=ie`
			<button id="disconnect-button" class="calendar-sync-slider-btn ui-btn ui-btn-light-border">${0}</button>
		`),this.removeButtonText)}getSaveButton(){return h.Tag.render(de||(de=ie`
			<button id="edit-connect-button" class="calendar-sync-slider-btn ui-btn ui-btn-light-border">${0}</button>
		`),this.saveButtonText)}getButtonWrapper(){return h.Tag.render(le||(le=ie`
			<div class="calendar-sync-slider-form-btn"></div>
		`))}}class pe{constructor(e={}){this.zIndex=3100;this.DOM={};this.QRC=null;this.type=e.type;this.helpDeskCode=e.helpDeskCode||"11828176";this.alreadyConnectedToNew=this.type==="android"?p.Util.isGoogleConnected():p.Util.isIcloudConnected();this.qrAuth=null}show(){var e;(e=this.qrAuth)!=null?e:this.qrAuth=new a.QrAuthorization({title:h.Loc.getMessage("SYNC_BANNER_MOBILE_TITLE"),content:h.Loc.getMessage("SYNC_MOBILE_NOTICE"),intent:this.type?"calendar_sync_slider":"calendar_sync_banner",showFishingWarning:true,showBottom:false});this.qrAuth.show()}}let ue=e=>e,ge,_e,Ce,ve,Ee,Se,Te,ye,Ie,Le,Ae,Ne,fe,me,De,be,Oe,Me;class we extends d.EventEmitter{constructor(e){super();this.COUNTER_FAILED=1;this.sliderWidth=840;this.IS_UPDATING=false;this.setEventNamespace("BX.Calendar.Sync.Interface.InterfaceTemplate");this.title=e.title;this.helpdeskCode=e.helpDeskCode;this.titleInfoHeader=e.titleInfoHeader;this.descriptionInfoHeader=e.descriptionInfoHeader;this.titleActiveHeader=e.titleActiveHeader;this.descriptionActiveHeader=e.descriptionActiveHeader;this.sliderIconClass=e.sliderIconClass;this.iconPath=e.iconPath;this.iconLogoClass=e.iconLogoClass||"";this.color=e.color;this.provider=e.provider;this.connection=e.connection;this.popupWithUpdateButton=e.popupWithUpdateButton}static createInstance(e,t=null){return new this(e,t)}getInfoConnectionContent(){return h.Tag.render(ge||(ge=ue`
			<div class="calendar-sync-wrap calendar-sync-wrap-detail">
				<div class="calendar-sync-header">
					<span class="calendar-sync-header-text">${0}</span>
				</div>
				${0}
			</div>
		`),this.getHeaderTitle(),this.getContentInfoBody())}getContentActiveBodyHeader(){const e=this.connection.getSyncDate().getTime()/1e3;const t=e?`${p.Util.formatDateUsable(e)} ${BX.date.format(p.Util.getTimeFormatShort(),e)}`:"";return h.Tag.render(_e||(_e=ue`
			<div class="calendar-sync__account ${0}">
				<div class="calendar-sync__account-logo">
					<div class="calendar-sync__account-logo--image ${0}"></div>
				</div>
				<div class="calendar-sync__account-content">
					${0}
					${0}
				</div>
				${0}
			</div>
		`),this.getSyncStatusClassName(),this.getLogoIconClass(),BX.util.htmlspecialchars(this.connection.getConnectionName()),this.getAccountInfo(t),this.getActionButton())}getAccountInfo(e){if(this.connection.status===false&&this.provider.getStatus()==="failed"&&this.provider.doSupportReconnectionScenario()){const e=h.Text.encode(this.provider.getFailedConnectionName());return h.Tag.render(Ce||(Ce=ue`
				<div class="calendar-sync__account-info calendar-sync__account-info-template-reconnection">
					<div class="calendar-sync__account-info--icon --animate"></div>
					${0}
				</div>
			`),h.Loc.getMessage("CAL_SYNC_INFO_STATUS_ERROR_RECONNECT",{"#TYPE#":e==="iCloud"?"iCloud":h.Text.capitalize(e)}))}return h.Tag.render(ve||(ve=ue`
			<div class="calendar-sync__account-info">
				<div class="calendar-sync__account-info--icon --animate"></div>
				${0}
			</div>
		`),e)}getActiveConnectionContent(){this.disconnectButton=this.getDisconnectButton();return h.Tag.render(Ee||(Ee=ue`
			<div class="calendar-sync-wrap calendar-sync-wrap-detail">
				<div class="calendar-sync-header">
					<span class="calendar-sync-header-text">${0}</span>
				</div>
				<div class="calendar-sync__scope">
					<div class="calendar-sync__content --border-radius">
						<div class="calendar-sync__content-block --space-bottom">
							${0}
						</div>
					</div>
				</div>
				<div class="calendar-sync__disconnect-button-container">
					${0}
				</div>
			</div>
		`),this.getHeaderTitle(),this.getContentActiveBody(),this.disconnectButton)}getActionButton(){if(this.connection.status===false&&this.provider.getStatus()==="failed"&&this.provider.doSupportReconnectionScenario()){this.actionButton=h.Tag.render(Se||(Se=ue`
				<button class="ui-btn ui-btn-primary ui-btn-round calendar-sync__account-btn">
					<div class="ui-icon-set --refresh-4"></div>
					${0}
					<div class="calendar-sync__account-counter">${0}</div>
				</button>
			`),h.Loc.getMessage("CAL_BUTTON_STATUS_FAILED_RECONNECT"),this.COUNTER_FAILED);h.Event.bind(this.actionButton,"click",(()=>this.reconnect()))}else if(this.provider.getStatus()==="pending"){this.actionButton=h.Tag.render(Te||(Te=ue`
				<button class="ui-btn ui-btn-primary ui-btn-clock ui-btn-round calendar-sync__account-btn">
					<div class="calendar-sync__account-counter">${0}</div>
				</button>
			`),this.COUNTER_FAILED)}else{const{root:e,icon:t}=h.Tag.render(ye||(ye=ue`
				<button class="ui-btn ui-btn-primary ui-btn-round calendar-sync__account-btn">
					<div ref="icon" class="ui-icon-set --refresh-4"></div>
					${0}
				</button>
			`),h.Loc.getMessage("CAL_REFRESH"));this.actionButton=e;this.actionButtonIcon=t;h.Event.bind(this.actionButton,"click",(()=>this.updateConnection()))}return this.actionButton}updateConnection(){if(this.IS_UPDATING){return}this.onUpdateConnectionStart();return new Promise((e=>{BX.ajax.runAction("calendar.api.syncajax.updateConnection",{data:{type:"user",requestUid:p.Util.registerRequestId()}}).then((t=>{d.EventEmitter.emit("BX.Calendar.Sync.Interface.InterfaceTemplate:onRefresh",{data:t.data,event:{doRefreshMainSlider:true}});this.onUpdateConnectionEnd();e()}))}))}onUpdateConnectionStart(){this.IS_UPDATING=true;h.Dom.addClass(this.actionButtonIcon,"--hidden");h.Dom.addClass(this.actionButton,"ui-btn-clock");h.Dom.addClass(this.disconnectButton,"ui-btn-disabled");h.Dom.addClass(this.sectionListNode,"--disabled")}onUpdateConnectionEnd(){this.IS_UPDATING=false;h.Dom.removeClass(this.actionButtonIcon,"--hidden");h.Dom.removeClass(this.actionButton,"ui-btn-clock");h.Dom.removeClass(this.disconnectButton,"ui-btn-disabled");h.Dom.removeClass(this.sectionListNode,"--disabled");this.provider.closeSlider()}getContentInfoBody(){return h.Tag.render(Ie||(Ie=ue`
			${0}
		`),this.getContentInfoBodyHeader())}getContentActiveBody(){return h.Tag.render(Le||(Le=ue`
			${0}
			${0}
			${0}
		`),this.getContentActiveBodyHeader(),this.getContentActiveBodySectionsHeader(),this.getContentActiveBodySectionsManager())}showHelp(e){if(top.BX.Helper){top.BX.Helper.show(`redirect=detail&code=${this.helpdeskCode}`);e.preventDefault()}}getHelpdeskLink(){return`https://helpdesk.bitrix24.ru/open/${this.helpdeskCode}`}getHeaderTitle(){return this.title}getLogoIconClass(){return this.iconLogoClass}getContentInfoBodyHeader(){if(!this.infoBodyHeader){this.infoBodyHeader=h.Tag.render(Ae||(Ae=ue`
				<div class="calendar-sync-slider-section calendar-sync-slider-section-flex-wrap">
					<div class="calendar-sync-slider-header-icon ${0}"></div>
					<div class="calendar-sync-slider-header">
						<div class="calendar-sync-slider-title">
							${0}
						</div>
						<div class="calendar-sync-slider-info">
							<span class="calendar-sync-slider-info-text">
								${0}
							</span>
						</div>
						${0}
					</div>
				</div>
			`),this.sliderIconClass,this.titleInfoHeader,this.descriptionInfoHeader,this.getContentInfoBodyHeaderHelper())}return this.infoBodyHeader}getContentInfoBodyHeaderHelper(){return h.Tag.render(Ne||(Ne=ue`
			<div class="calendar-sync-slider-info">
				<span class="calendar-sync-slider-info-text">
					<a class="calendar-sync-slider-info-link" href="javascript:void(0);" onclick="${0}">
						${0}
					</a>
				</span>
			</div>
		`),this.showHelp.bind(this),h.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"))}getContentInfoWarning(){const e=this.getMobileSyncControlButton();if(this.alreadyConnectedToNew){h.Event.bind(e,"click",this.handleMobileButtonOtherSyncInfo.bind(this))}else{h.Event.bind(e,"click",this.handleMobileButtonConnectClick.bind(this))}return h.Tag.render(fe||(fe=ue`
			<div class="calendar-sync-slider-section-warning calendar-sync-slider-section-col">
				<div class="ui-alert ui-alert-warning ui-alert-icon-info">
					<span class="ui-alert-message">${0}
					</span>
				</div>
				<div class="calendar-sync-button-warning">${0}</div>
			</div>
		`),this.warningText,e)}getMobileSyncControlButton(){return h.Tag.render(me||(me=ue`
			<button class="ui-btn ui-btn-success ui-btn-sm ui-btn-round">
				${0}
			</button>
		`),this.mobileSyncButtonText)}setProvider(e){this.provider=e}sendRequestRemoveConnection(e){BX.ajax.runAction("calendar.api.syncajax.removeConnection",{data:{connectionId:e,removeCalendars:"Y"}}).then((()=>{BX.reload()}))}runUpdateInfo(){BX.ajax.runAction("calendar.api.calendarajax.setSectionStatus",{data:{sectionStatus:this.sectionStatusObject}}).then((e=>{this.emit("reDrawCalendarGrid",{})}))}refresh(e){var t;this.connection=e;if(this.connection){var n;(n=this.statusBlock)==null?void 0:n.setStatus(this.connection.getStatus()).setConnections([this.connection])}h.Dom.replace(document.getElementById("status-info-block"),(t=this.statusBlock)==null?void 0:t.getContent())}reconnect(){if(!this.provider.doSupportReconnectionScenario()){return}this.provider.startReconnecting();this.handleConnectButton();this.provider.closeSlider()}handleConnectButton(){}getDisconnectButton(){const e=h.Tag.render(De||(De=ue`
			<button class="ui-btn ui-btn-light-border ui-btn-round calendar-sync__account-btn">
				${0}
			</button>
		`),h.Loc.getMessage("CAL_SYNC_DISCONNECT_BUTTON"));h.Event.bind(e,"click",this.handleDisconnectButton.bind(this));return e}getSyncStatusClassName(){return this.provider.getStatus()==="success"||this.connection.status===true?"--complete":this.provider.doSupportReconnectionScenario()?"--error-reconnect":"--error"}getContentActiveBodySectionsHeader(){return h.Tag.render(be||(be=ue`
			<div class="calendar-sync__account-desc">${0}</div>
		`),h.Loc.getMessage("CAL_SYNC_SELECTED_LIST_TITLE"))}getContentActiveBodySectionsManager(){this.sectionListNode=h.Tag.render(Oe||(Oe=ue`
			<div class="calendar-sync__account-check-list">
				${0}
			</div>
		`),this.getContentActiveBodySections());return this.sectionListNode}getContentActiveBodySections(){const e=[];this.sectionList.forEach((t=>{e.push(h.Tag.render(Me||(Me=ue`
				<label class="calendar-sync__account-check-list-label">
					<input type="checkbox" class="calendar-sync__account-check-list-input"
						value="${0}" 
						onclick="${0}" ${0}/>
					<span class="calendar-sync__account-check-list-text">${0}</span>
				</label>
			`),BX.util.htmlspecialchars(t.ID),this.onClickCheckSection.bind(this),t.ACTIVE==="Y"?"checked":"",BX.util.htmlspecialchars(t.NAME)))}));return e}showUpdateSectionListNotification(){p.Util.showNotification(h.Loc.getMessage("CAL_SYNC_CALENDAR_LIST_UPDATED"))}handleDisconnectButton(e){if(h.Type.isElementNode(this.disconnectButton)){h.Dom.addClass(this.disconnectButton,["ui-btn-clock","ui-btn-disabled"])}e.preventDefault();this.sendRequestRemoveConnection(this.connection.getId())}deactivateConnection(e){BX.ajax.runAction("calendar.api.syncajax.deactivateConnection",{data:{connectionId:e,removeCalendars:"N"}}).then((()=>{this.provider.closeSlider();this.provider.setStatus(this.provider.STATUS_NOT_CONNECTED);this.provider.getInterfaceUnit().refreshButton();this.provider.getInterfaceUnit().setSyncStatus(this.provider.STATUS_NOT_CONNECTED);this.emit("reDrawCalendarGrid",{})}))}}we.SLIDER_WIDTH=606;we.SLIDER_PREFIX="calendar:connection-sync-";let Be=e=>e,Pe,ke;class Ue extends we{constructor(e){super(e)}getContentInfoBody(){let e=null;if(this.connection!==null){e={server:this.connection.addParams.server,userName:this.connection.addParams.userName,connectionName:this.connection.connectionName}}const t=new he(e);const n=t.getWrapper();const s=t.getForm();const i=t.getAddButton();const a=t.getButtonWrapper();const o=this.getContentInfoBodyHeader();i.addEventListener("click",(e=>{h.Dom.addClass(i,["ui-btn-clock","ui-btn-disabled"]);e.preventDefault();this.sendRequestAddConnection(s)}));h.Dom.append(i,a);h.Dom.append(a,s);h.Dom.append(s,n);return h.Tag.render(Pe||(Pe=Be`
			${0}
			${0}
		`),o,n)}getContentActiveBody(){const e=new he({server:this.connection.addParams.server,userName:this.connection.addParams.userName,connectionName:this.connection.connectionName});const t=e.getWrapper();const n=e.getForm();const s=this.getContentActiveBodyHeader();h.Dom.append(n,t);return h.Tag.render(ke||(ke=Be`
			${0}
			${0}
		`),s,t)}sendRequestAddConnection(e){const t=new FormData(e);BX.ajax.runAction("calendar.api.syncajax.addConnection",{data:{name:t.get("name"),server:t.get("server"),userName:t.get("user_name"),pass:t.get("password")}}).then((e=>{BX.reload()}),(t=>{const n=e.querySelector("#connect-button");this.showAlertPopup(t.errors[0],n)}))}showAlertPopup(e,t){let n="";if(e.code==="incorrect_parameters"){n=h.Loc.getMessage("CAL_TEXT_ALERT_INCORRECT_PARAMETERS")}else if(e.code==="tech_problem"){n=h.Loc.getMessage("CAL_TEXT_ALERT_TECH_PROBLEM")}else{n=h.Loc.getMessage("CAL_TEXT_ALERT_DEFAULT")}const s=new BX.UI.Dialogs.MessageBox({message:n,title:e.message,buttons:BX.UI.Dialogs.MessageBoxButtons.OK,okCaption:h.Loc.getMessage("CAL_TEXT_BUTTON_RETURN_TO_SETTINGS"),minWidth:358,mediumButtonSize:false,popupOptions:{zIndex:3021,height:166,width:358,className:"calendar-alert-popup-connection"},onOk:()=>{h.Dom.removeClass(t,["ui-btn-clock","ui-btn-disabled"]);return true}});s.show()}handleConnectButton(){this.provider.openInfoConnectionSlider(this.provider.getFirstFailedConnection())}}class Re extends Ue{constructor(e,t=null){super({title:h.Loc.getMessage("CALENDAR_TITLE_CALDAV"),helpDeskCode:"5697365",titleInfoHeader:h.Loc.getMessage("CAL_CONNECT_CALDAV_CALENDAR"),descriptionInfoHeader:h.Loc.getMessage("CAL_CALDAV_CONNECT_DESCRIPTION"),titleActiveHeader:h.Loc.getMessage("CAL_CALDAV_CALENDAR_IS_CONNECT"),descriptionActiveHeader:h.Loc.getMessage("CAL_CALDAV_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-caldav",iconPath:"/bitrix/images/calendar/sync/caldav.svg",color:"#1eae43",provider:e,connection:t,popupWithUpdateButton:true})}}let We=e=>e,He,xe,$e,Ge;class Xe extends we{constructor(e,t=null){super({title:h.Loc.getMessage("CALENDAR_TITLE_EXCHANGE"),helpDeskCode:"9860971",titleInfoHeader:h.Loc.getMessage("CAL_CONNECT_EXCHANGE_CALENDAR"),descriptionInfoHeader:h.Loc.getMessage("CAL_EXCHANGE_CONNECT_DESCRIPTION"),titleActiveHeader:h.Loc.getMessage("CAL_EXCHANGE_CALENDAR_IS_CONNECT"),descriptionActiveHeader:h.Loc.getMessage("CAL_EXCHANGE_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-office",iconLogoClass:"--exchange",iconPath:"/bitrix/images/calendar/sync/exchange.svg",color:"#54d0df",provider:e,connection:t,popupWithUpdateButton:true})}getContentActiveBody(){return h.Tag.render(He||(He=We`
			${0}
			${0}
			${0}
		`),this.getContentActiveBodyHeader(),this.getContentBody(),this.getHelpdeskBlock())}getContentActiveBodyHeader(){const e=this.connection.getSyncDate().getTime()/1e3;const t=e?p.Util.formatDateUsable(e)+" "+BX.date.format(p.Util.getTimeFormatShort(),e):"";return h.Tag.render(xe||(xe=We`
			<div class="calendar-sync__account ${0}">
				<div class="calendar-sync__account-logo">
					<div class="calendar-sync__account-logo--image ${0}"></div>
				</div>
				<div class="calendar-sync__account-content">
					${0}
					<div class="calendar-sync__account-info">
						<div class="calendar-sync__account-info--icon --animate"></div>
						${0}
					</div>
				</div>
			</div>
			`),this.getSyncStatusClassName(),this.getLogoIconClass(),BX.util.htmlspecialchars(this.connection.getConnectionName()),t)}getContentBody(){return h.Tag.render($e||($e=We`
			<div class="calendar-sync__account-desc">
				${0}
			</div>
		`),h.Loc.getMessage("CAL_EXCHANGE_SELECTED_DESCRIPTION"))}getHelpdeskBlock(){return h.Tag.render(Ge||(Ge=We`
			<div>
				<a class="calendar-sync-slider-info-link" href="javascript:void(0);" onclick="${0}">
					${0}
				</a>
			</div>
		`),this.showHelp.bind(this),h.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"))}}let Fe=e=>e,Ye,ze,je,Ke,qe,Ve,Ze,Je,Qe,et,tt,nt,st,it,at;class ot extends d.EventEmitter{constructor(e={}){super();this.TYPE="undefined";this.SLIDER_NAME="calendar:sync-wizard-slider";this.SLIDER_WIDTH=450;this.LOADER_NAME="calendar:loader";this.cache=new h.Cache.MemoryCache;this.syncStagesList=[];this.accountName="";this.HELPDESK_CODE=11828176;this.MIN_UPDATE_STATE_DELAY=1500;this.CONFETTI_DELAY=1e3;this.setEventNamespace("BX.Calendar.Sync.Interface.SyncWizard");this.BX=window.top.BX||window.BX;this.pullWizardEventHandler=this.handlePullNewEvent.bind(this);this.lastUpdateStateTimestamp=Date.now();this.logoIconClass="";this.mode=h.Type.isStringFilled(e.mode)?this.getValidatedMode(e.mode):"default"}getValidatedMode(e){if(["default","reconnect"].includes(e)){return e}return"default"}openSlider(){const e=this.getContent();if(this.mode!=="reconnect"){BX.SidePanel.Instance.open(this.SLIDER_NAME,{contentCallback:t=>new Promise(((t,n)=>{t(e)})),allowChangeHistory:false,events:{onLoad:()=>{this.displaySyncStages();this.bindButtonsHandlers()},onDestroy:this.handleCloseWizard.bind(this)},cacheable:false,width:this.SLIDER_WIDTH,loader:this.LOADER_NAME})}this.slider=BX.SidePanel.Instance.getTopSlider();this.syncIsFinished=false;this.errorStatus=false}getContent(){return h.Tag.render(Ye||(Ye=Fe`
			<div class="calendar-sync__wrapper calendar-sync__scope">
				<div class="calendar-sync__content --border-radius">
					<div class="calendar-sync__content-block --space-bottom">
						${0}
						${0}
						${0}
						${0}
						${0}
						${0}
						${0}
					</div>
				</div>
			</div>
		`),this.getTitleWrapper(),this.getSyncStagesWrapper(),this.getInfoStatusWrapper(),this.getErrorWrapper(),this.getFinalCheckWrapper(),this.getHelpLinkWrapper(),this.getButtonWrapper())}getTitleWrapper(){this.syncTitleWrapper=h.Tag.render(ze||(ze=Fe`
			<div class="calendar-sync__account">
				<div class="calendar-sync__account-logo">
					<div class="calendar-sync__account-logo--image ${0}"></div>
				</div>
				<div class="calendar-sync__account-content">
					${0}
					<div class="calendar-sync__account-info">
						<div class="calendar-sync__account-info--icon --animate"></div>
						${0}
					</div>
				</div>
			</div>
		`),this.getLogoIconClass(),this.getAccountNameNode(),this.getActiveStatusNode());return this.syncTitleWrapper}getSyncStagesWrapper(){this.syncStagesWrapper=h.Tag.render(je||(je=Fe`<div class="calendar-sync-stages-wrap"></div>`));return this.syncStagesWrapper}getInfoStatusWrapper(){this.infoStatusWrapper=h.Tag.render(Ke||(Ke=Fe`
			<div class="calendar-sync__content-block --space-bottom-xl" style="display: none;">
				<div class="calendar-sync__notification">
					<div class="calendar-sync__notification-title">${0}</div>
					<div class="calendar-sync__notification-message">${0}</div>
				</div>
			</div>
		`),h.Loc.getMessage("CAL_INFO_STATUS_CONG_1"),h.Loc.getMessage("CAL_INFO_STATUS_CONG_2"));return this.infoStatusWrapper}getErrorWrapper(){this.errorWrapper=h.Tag.render(qe||(qe=Fe`
			<div class="calendar-sync__content-block --space-bottom-xl" style="display: none;">
				<div class="calendar-sync__error">
					<div class="calendar-sync__notification-message">
						<div class="calendar-sync__notification-message-inner">
							${0}
						</div>
						${0}</div>
				</div>
			</div>
		`),h.Loc.getMessage("CAL_ERROR_WARN_1"),h.Loc.getMessage("CAL_ERROR_WARN_2"));return this.errorWrapper}getHelpLinkWrapper(){this.helpLinkWrapper=h.Tag.render(Ve||(Ve=Fe`
			<div class="calendar-sync__content-block" style="display: none;"></div>
		`));return this.helpLinkWrapper}getFinalCheckWrapper(){this.finalCheckWrapper=h.Tag.render(Ze||(Ze=Fe`
			<div class="calendar-sync__content-block" style="display: none;"></div>
		`));return this.finalCheckWrapper}getButtonWrapper(){this.buttonWrapper=h.Tag.render(Je||(Je=Fe`
			<div style="display: none" class="calendar-sync__content-block --align-center">
				<a class="ui-btn ui-btn-lg ui-btn-primary ui-btn-round" data-role="continue_btn">
					${0}
				</a>
				<a style="display: none" class="ui-btn ui-btn-lg ui-btn-light-border ui-btn-round" data-role="everything_is_fine_btn">
					${0}
				</a>
				<a style="display: none" class="ui-btn ui-btn-lg ui-btn-light-border ui-btn-round" data-role="close_button">
					${0}
				</a>
			</div>
		`),h.Loc.getMessage("CAL_BUTTON_CONTINUE"),h.Loc.getMessage("CAL_BUTTON_EVERYTHING_IS_FINE"),h.Loc.getMessage("CAL_ERROR_CLOSE"));return this.buttonWrapper}getNewEventCardWrapper(){this.newEventCardWrapper=h.Tag.render(Qe||(Qe=Fe`
			<div class="calendar-sync__content-block --space-bottom" style="display: none;"></div>
		`));return this.newEventCardWrapper}getSkeletonWrapper(){this.skeletonWrapper=h.Tag.render(et||(et=Fe`
			<div class="calendar-sync__content-block --space-bottom">
					<div class="calendar-sync__balloon --skeleton">
						<div class="calendar-sync__balloon__skeleton-box">
							<div class="calendar-sync__balloon__skeleton-inline-box">
								<div class="calendar-sync__balloon__skeleton-circle"></div>
								<div class="calendar-sync__balloon__skeleton-line"></div>
							</div>
							<div class="calendar-sync__balloon__skeleton-line"></div>
						</div>
						<div class="calendar-sync__content-text">${0}</div>
					</div>
				</div>
		`),this.getSkeletonTitle());return this.skeletonWrapper}getSkeletonTitle(){return""}getExtraInfoWithCheckIcon(){const e=Object.values(this.connectionsProviders).filter((e=>e.mainPanel&&e.status)).length>0;return h.Tag.render(tt||(tt=Fe`
			<div class="calendar-sync__content-text --icon-check${0}">
				${0}
			</div>
		`),e?" --disabled":"",h.Loc.getMessage("CAL_SYNC_INFO_PROMO"))}getAccountNameNode(){if(!h.Type.isElementNode(this.accountNameNode)){this.accountNameNode=h.Tag.render(nt||(nt=Fe`
			<div class="calendar-sync__account-title">${0}</div>
		`),this.getAccountName())}return this.accountNameNode}setAccountName(e){this.accountName=e}getAccountName(){return this.accountName}getActiveStatusNode(){if(!h.Type.isElementNode(this.activeStatusNode)){this.activeStatusNode=h.Tag.render(st||(st=Fe`
				<span class="calendar-active-status-node-carousel">
					<span class="calendar-active-status-node-phrase">
						${0}
					</span>
				</span>
			`),h.Loc.getMessage("CAL_STATUS_SYNC_IN_PROGRESS"));this.startStatusCarousel(this.activeStatusNode)}return this.activeStatusNode}startStatusCarousel(e){const t=[h.Loc.getMessage("CAL_STATUS_SYNC_IN_PROGRESS_STATUSES_FIRST"),h.Loc.getMessage("CAL_STATUS_SYNC_IN_PROGRESS_STATUSES_SECOND")];let n=1;this.statusCarouselInterval=setInterval((()=>{const s=e.firstElementChild;if(this.countDots(s.innerText)<3){s.innerText+=".";e.style.width=s.offsetWidth+1+"px";return}if(n<2){n++;s.innerText=s.innerText.slice(0,-3);return}n=1;if(t.length>0){const n=t.shift();this.animateNextStatus(e,n)}else{const t=h.Loc.getMessage("CAL_STATUS_SYNC_IN_PROGRESS_ALMOST_DONE");this.animateNextStatus(e,t);e.style.width="";clearInterval(this.statusCarouselInterval)}}),900)}animateNextStatus(e,t){const n=e.firstElementChild;const s=h.Tag.render(it||(it=Fe`
			<span class="calendar-active-status-node-phrase">${0}</span>
		`),t);e.append(s);const i=Math.max(s.offsetWidth,n.offsetWidth);e.style.width=i+1+"px";n.style.transition="";n.style.transform=`translateX(-${n.offsetWidth}px)`;s.style.transform=`translateX(-${n.offsetWidth}px)`;setTimeout((()=>{n.remove();s.style.transition="none";s.style.transform=""}),300)}countDots(e){return(e.match(/\./g)||[]).length}setSyncStages(){this.syncStagesList=[]}getSyncStages(){return this.syncStagesList}getHelpDeskCode(){return this.HELPDESK_CODE}displaySyncStages(){h.Dom.clean(this.syncStagesWrapper);this.getSyncStages().forEach((e=>{e.renderTo(this.syncStagesWrapper)}))}bindButtonsHandlers(){const e=this.buttonWrapper.querySelector('.ui-btn[data-role="continue_btn"]');if(h.Type.isElementNode(e)){h.Event.bind(e,"click",this.handleContinueButtonClick.bind(this))}const t=this.buttonWrapper.querySelector('.ui-btn[data-role="everything_is_fine_btn"]');if(h.Type.isElementNode(t)){h.Event.bind(t,"click",this.handleFinalCloseButtonClick.bind(this))}}handleContinueButtonClick(){this.showFinalStage()}showFinalStage(){this.syncIsFinished=true;const e=this.buttonWrapper.querySelector('.ui-btn[data-role="everything_is_fine_btn"]');if(h.Type.isElementNode(e)){e.style.display=""}const t=this.buttonWrapper.querySelector('.ui-btn[data-role="continue_btn"]');if(h.Type.isElementNode(t)){t.style.display="none"}this.showFinalCheckWrapper();this.showHelpLinkWrapper();this.hideSyncStagesWrapper();this.hideInfoStatusWrapper();p.Util.getBX().Event.EventEmitter.subscribe("onPullEvent-calendar",this.pullWizardEventHandler);this.emit("startWizardWaitingMode")}isSyncFinished(){return this.syncIsFinished}handleFinalCloseButtonClick(){BX.SidePanel.Instance.getOpenSliders().forEach((e=>{if(["calendar:sync-slider","calendar:section-slider",this.SLIDER_NAME].includes(e.getUrl())){e.close()}}))}handleUpdateState(e){const t=Date.now();if(t-this.lastUpdateStateTimestamp>this.MIN_UPDATE_STATE_DELAY){this.updateState(e)}else{setTimeout((()=>{this.handleUpdateState(e)}),this.MIN_UPDATE_STATE_DELAY)}}updateState(e){if(this.errorStatus){return}if(e.stage==="connection_created"&&e.accountName&&h.Type.isElementNode(this.accountNameNode)){this.setAccountName(e.accountName);this.accountNameNode.innerHTML=h.Text.encode(e.accountName)}this.lastUpdateStateTimestamp=Date.now()}setActiveStatusFinished(){this.activeStatusNode.style.width="";clearInterval(this.statusCarouselInterval);this.syncIsFinished=true;if(h.Type.isElementNode(this.activeStatusNode)){this.activeStatusNode.innerHTML=h.Text.encode(h.Loc.getMessage("CAL_STATUS_SYNC_SUCCESS").toUpperCase());h.Dom.remove(this.syncTitleWrapper.querySelector(".calendar-sync__account-info--icon"))}}showButtonWrapper(){if(h.Type.isElementNode(this.buttonWrapper)){this.buttonWrapper.style.display=""}}hideButtonWrapper(){if(h.Type.isElementNode(this.buttonWrapper)){this.buttonWrapper.style.display="none"}}showInfoStatusWrapper(){if(h.Type.isElementNode(this.infoStatusWrapper)){this.infoStatusWrapper.style.display=""}}hideInfoStatusWrapper(){if(h.Type.isElementNode(this.infoStatusWrapper)){this.infoStatusWrapper.style.display="none"}}showErrorWrapper(){if(h.Type.isElementNode(this.errorWrapper)){this.errorWrapper.style.display=""}}hideErrorWrapper(){if(h.Type.isElementNode(this.errorWrapper)){this.errorWrapper.style.display="none"}}showFinalCheckWrapper(){if(h.Type.isElementNode(this.finalCheckWrapper)){this.finalCheckWrapper.style.display=""}}hideFinalCheckWrapper(){if(h.Type.isElementNode(this.finalCheckWrapper)){this.finalCheckWrapper.style.display="none"}}showSyncStagesWrapper(){if(h.Type.isElementNode(this.syncStagesWrapper)){this.syncStagesWrapper.style.display=""}}hideSyncStagesWrapper(){if(h.Type.isElementNode(this.syncStagesWrapper)){this.syncStagesWrapper.style.display="none"}}showHelpLinkWrapper(){if(h.Type.isElementNode(this.helpLinkWrapper)){this.helpLinkWrapper.style.display=""}}hideHelpLinkWrapper(){if(h.Type.isElementNode(this.helpLinkWrapper)){this.helpLinkWrapper.style.display="none"}}handlePullNewEvent(e){if(e&&h.Type.isFunction(e.getData)){const t={command:e.getData()[0],...e.getData()[1]};if(t.command==="edit_event"&&t.newEvent){if(h.Type.isElementNode(this.finalCheckWrapper)){const e=this.finalCheckWrapper.querySelector(".calendar-sync__balloon");if(h.Type.isElementNode(e)&&h.Dom.hasClass(e,"--progress")){h.Dom.removeClass(e,"--progress");h.Dom.addClass(e,"--done")}}const e=new o.Entry({data:t.fields});this.displayNewEvent(e);p.Util.getBX().Event.EventEmitter.unsubscribe("onPullEvent-calendar",this.pullWizardEventHandler);const n=this.buttonWrapper.querySelector('.ui-btn[data-role="everything_is_fine_btn"]');if(h.Type.isElementNode(n)){n.innerHTML=h.Text.encode(h.Loc.getMessage("CAL_BUTTON_KEEP_GOING"));h.Dom.addClass(n,"ui-btn-primary");h.Dom.removeClass(n,"ui-btn-light-border")}this.emit("endWizardWaitingMode")}}}displayNewEvent(e){if(h.Type.isElementNode(this.skeletonWrapper)){h.Dom.remove(this.skeletonWrapper)}if(h.Type.isElementNode(this.newEventCardWrapper)){this.newEventCardWrapper.style.display="";h.Dom.clean(this.newEventCardWrapper);this.newEventCardWrapper.appendChild(this.getNewEventCard(e))}}getNewEventCard(e){const t=new Date(e.from.getTime()-(parseInt(e.data["~USER_OFFSET_FROM"])||0)*1e3);const n=new Date(e.to.getTime()-(parseInt(e.data["~USER_OFFSET_TO"])||0)*1e3);const s=t.getTime();const i=BX.date.format(p.Util.getDayMonthFormat(),s/1e3);const a=p.Util.formatTime(t.getHours(),t.getMinutes());const o=p.Util.formatTime(n.getHours(),n.getMinutes());const c=e.isFullDay()?h.Loc.getMessage("CAL_WIZARD_FULL_DAY"):a+" - "+o;this.newEventCard=h.Tag.render(at||(at=Fe`
			<div class="calendar-sync__balloon --calendar ${0}">
				<div class="calendar-sync__content-text">
					${0}
					<span class="calendar-date-year">
						${0}
					</span>
				</div>
				<div class="calendar-sync__content-text">${0}</div>
				<div class="calendar-sync__time-box">
					<div class="calendar-sync__time">
						<div class="calendar-sync__time-date">${0}</div>
						<div class="calendar-sync__time-line"></div>
					</div>
					<div class="calendar-sync__time-notification-box">
						<div class="calendar-sync__content-text">${0}</div>
						<div class="calendar-sync__content-text">${0}</div>
					</div>
					<div class="calendar-sync__time">
						<div class="calendar-sync__time-date">${0}</div>
						<div class="calendar-sync__time-line"></div>
					</div>
				</div>
			</div>
		`),e.isFullDay()?"--fullday-event":"",i,BX.date.format("Y",s/1e3),BX.date.format("l",s/1e3),a,h.Text.encode(e.getName()),c,o);return this.newEventCard}handleCloseWizard(){this.slider=null;clearInterval(this.statusCarouselInterval);p.Util.getBX().Event.EventEmitter.unsubscribe("onPullEvent-calendar",this.pullWizardEventHandler);this.emit("onClose")}showConfetti(){setTimeout((()=>{const e=p.Util.getBX();e.UI.Confetti.fire({particleCount:240,spread:170,origin:{y:.3,x:.9},zIndex:e.SidePanel.Instance.getTopSlider().getZindex()+1})}),this.CONFETTI_DELAY)}getLogoIconClass(){return this.logoIconClass}getSlider(){return this.slider}setErrorState(){this.errorStatus=true;this.showErrorWrapper();this.hideInfoStatusWrapper();this.hideSyncStagesWrapper();this.showButtonWrapper();h.Dom.addClass(this.syncTitleWrapper,"--error");if(h.Type.isElementNode(this.activeStatusNode)){this.activeStatusNode.innerHTML=h.Text.encode(h.Loc.getMessage("CAL_STATUS_SYNC_ERROR").toUpperCase())}const e=this.buttonWrapper.querySelector('.ui-btn[data-role="close_button"]');if(h.Type.isElementNode(e)){e.style.display="";h.Event.bind(e,"click",(()=>{BX.SidePanel.Instance.getOpenSliders().forEach((e=>{if(["calendar:sync-slider","calendar:section-slider",this.SLIDER_NAME].includes(e.getUrl())){e.close()}}));BX.reload()}))}const t=this.buttonWrapper.querySelector('.ui-btn[data-role="continue_btn"]');if(h.Type.isElementNode(t)){t.style.display="none"}}}let ct=e=>e,rt;class dt{constructor(e){this.name=e.name||"";this.title=e.title||"";this.doneStatus=false}renderTo(e){if(h.Type.isElementNode(e)){e.appendChild(this.getContent())}d.EventEmitter.emit("BX.Calendar.Sync.Interface.SyncStageUnit:onRenderDone")}getContent(){this.contentNode=h.Tag.render(rt||(rt=ct`
			<div class="calendar-sync__content-block --space-bottom-xl">
				<div class="calendar-sync__content-text --icon-check --disabled">${0}</div>
			</div>
		`),this.title);return this.contentNode}setDone(){var e;this.doneStatus=true;h.Dom.removeClass((e=this.contentNode)==null?void 0:e.querySelector(".--icon-check"),"--disabled")}setUndone(){var e;this.doneStatus=false;h.Dom.addClass((e=this.contentNode)==null?void 0:e.querySelector(".--icon-check"),"--disabled")}}let lt=e=>e,ht,pt,ut;class gt extends ot{constructor(e={}){super(e);this.TYPE="google";this.SLIDER_NAME="calendar:sync-wizard-google";this.STAGE_1_CODE="google-to-b24";this.STAGE_2_CODE="b24-to-google";this.STAGE_3_CODE="b24-events-to-google";this.GOOGLE_ON_MOBILE_HELPDESK=15456338;this.setEventNamespace("BX.Calendar.Sync.Interface.GoogleSyncWizard");this.setAccountName(h.Loc.getMessage("CALENDAR_TITLE_GOOGLE"));this.setSyncStages();this.logoIconClass="--google"}getHelpLinkWrapper(){let e="";this.helpLinkWrapper=h.Tag.render(ht||(ht=lt`
			<div class="calendar-sync__content-block --align-center --space-bottom" style="display: none;">
				${0}
			</div>
		`),e=h.Tag.render(pt||(pt=lt`<a href="#" class="calendar-sync__content-link">
					${0}
				</a>`),h.Loc.getMessage("CAL_SYNC_NO_GOOGLE_ON_PHONE")));h.Event.bind(e,"click",(()=>{const e=p.Util.getBX().Helper;if(e){e.show(`redirect=detail&code=${this.GOOGLE_ON_MOBILE_HELPDESK}`)}}));return this.helpLinkWrapper}getFinalCheckWrapper(){this.finalCheckWrapper=h.Tag.render(ut||(ut=lt`
			<div style="display: none;">
				<div class="calendar-sync__content-block --space-bottom">
					<div class="calendar-sync__balloon --progress">
						<div class="calendar-sync__content-text calendar-sync__content-title --show-for-progress">${0}</div>
						<div class="calendar-sync__content-text calendar-sync__content-subtitle --show-for-progress">${0}</div>
						<div class="calendar-sync__content-text calendar-sync__content-title --show-for-done">${0}</div>
						<div class="calendar-sync__content-text calendar-sync__content-subtitle --show-for-done">${0}</div>
						<div class="calendar-sync__balloon--icon"></div>
					</div>
				</div>
				${0}
				${0}
			</div>
		`),h.Loc.getMessage("CAL_SYNC_LETS_CHECK"),h.Loc.getMessage("CAL_SYNC_CREATE_EVENT_GOOGLE"),h.Loc.getMessage("CAL_SYNC_NEW_EVENT_ADDED_GOOGLE"),h.Loc.getMessage("CAL_SYNC_NEW_EVENT_YOULL_SEE"),this.getSkeletonWrapper(),this.getNewEventCardWrapper());return this.finalCheckWrapper}setSyncStages(){this.syncStagesList=[new dt({name:this.STAGE_1_CODE,title:h.Loc.getMessage("CAL_SYNC_STAGE_GOOGLE_1")}),new dt({name:this.STAGE_2_CODE,title:h.Loc.getMessage("CAL_SYNC_STAGE_GOOGLE_2")}),new dt({name:this.STAGE_3_CODE,title:h.Loc.getMessage("CAL_SYNC_STAGE_GOOGLE_3")})]}updateState(e){super.updateState(e);this.getSyncStages().forEach((t=>{if(e.stage==="connection_created"&&t.name===this.STAGE_1_CODE){t.setDone()}else if(e.stage==="import_finished"&&(t.name===this.STAGE_1_CODE||t.name===this.STAGE_2_CODE)){t.setDone()}else if(e.stage==="export_finished"){t.setDone();if(t.name===this.STAGE_3_CODE){if(this.mode==="reconnecting"){this.handleCloseWizard()}else{this.setActiveStatusFinished();this.showButtonWrapper();this.showInfoStatusWrapper()}this.showConfetti();this.emit("onConnectionCreated")}}}))}getSkeletonTitle(){return h.Loc.getMessage("CAL_SYNC_NEW_EVENT_GOOGLE_TITLE")}}class _t extends we{constructor(e,t=null){super({title:h.Loc.getMessage("CALENDAR_TITLE_GOOGLE"),helpDeskCode:"6030429",titleInfoHeader:h.Loc.getMessage("CAL_CONNECT_GOOGLE_CALENDAR"),descriptionInfoHeader:h.Loc.getMessage("CAL_GOOGLE_CONNECT_DESCRIPTION"),titleActiveHeader:h.Loc.getMessage("CAL_GOOGLE_CALENDAR_IS_CONNECT"),descriptionActiveHeader:h.Loc.getMessage("CAL_GOOGLE_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-google",iconPath:"/bitrix/images/calendar/sync/google.svg",iconLogoClass:"--google",color:"#387ced",provider:e,connection:t,popupWithUpdateButton:true});this.HANDLE_CONNECTION_DELAY=500;this.sectionStatusObject={};this.sectionList=[];this.handleSuccessConnectionDebounce=h.Runtime.debounce(this.handleSuccessConnection,this.HANDLE_CONNECTION_DELAY,this)}createConnection(){const e=this.provider.getSyncLink();BX.util.popup(e,500,600);h.Event.bind(window,"hashchange",this.handleSuccessConnectionDebounce);h.Event.bind(window,"message",this.handleSuccessConnectionDebounce)}handleSuccessConnection(e){if(window.location.hash==="#googleAuthSuccess"||e.data.title==="googleAuthSuccess"){p.Util.removeHash();this.provider.setWizardSyncMode(true);this.provider.saveConnection();this.openSyncWizard();this.provider.setStatus(this.provider.STATUS_SYNCHRONIZING);this.provider.getInterfaceUnit().setSyncStatus(this.provider.STATUS_SYNCHRONIZING);this.provider.getInterfaceUnit().refreshButton();if(this.provider.isReconnecting()){this.provider.emit("onReconnecting")}h.Event.unbind(window,"hashchange",this.handleSuccessConnectionDebounce);h.Event.unbind(window,"message",this.handleSuccessConnectionDebounce)}}getSectionsForGoogle(){return new Promise((e=>{BX.ajax.runAction("calendar.api.syncajax.getAllSectionsForGoogle",{data:{connectionId:this.connection.addParams.id}}).then((t=>{this.sectionList=t.data;e(t.data)}),(t=>{e(t.errors)}))}))}onClickCheckSection(e){this.sectionStatusObject[e.target.value]=e.target.checked;this.runUpdateInfo();this.showUpdateSectionListNotification()}showAlertPopup(){const e=new l.MessageBox({className:this.id,message:h.Loc.getMessage("GOOGLE_IS_NOT_CALDAV_SETTINGS_WARNING_MESSAGE"),width:500,offsetLeft:60,offsetTop:5,padding:7,onOk:()=>{e.close()},okCaption:"OK",buttons:BX.UI.Dialogs.MessageBoxButtons.OK,popupOptions:{zIndexAbsolute:4020,autoHide:true,animation:"fading-slide"}});e.show()}handleConnectButton(){if(this.provider.hasSetSyncGoogleSettings()){this.createConnection()}else{this.provider.endReconnecting();this.showAlertPopup()}}openSyncWizard(){if(!this.wizard){const e=this.provider.isStartedReconnecting?"reconnect":"default";this.wizard=new gt({mode:e});this.wizard.openSlider();this.provider.setActiveWizard(this.wizard)}}sendRequestRemoveConnection(e){this.deactivateConnection(e)}}let Ct=e=>e,vt,Et,St,Tt,yt,It,Lt,At,Nt,ft,mt;class Dt extends d.EventEmitter{constructor(e={}){super();this.zIndex=3100;this.DOM={};this.appPasswordTemplate="xxxx-xxxx-xxxx-xxxx";this.type=e.type;this.setEventNamespace("BX.Calendar.Sync.Icloud");this.keyHandler=this.handleKeyPress.bind(this);this.checkOutsideClickClose=this.checkOutsideClickClose.bind(this);this.outsideMouseDownClose=this.outsideMouseDownClose.bind(this);this.initAlertBlock()}show(){this.popup=new u.Popup({className:"calendar-sync__auth-popup calendar-sync__scope",titleBar:h.Loc.getMessage("CAL_ICLOUD_AUTH_TITLE"),draggable:true,content:this.getContainer(),width:475,animation:"fading-slide",zIndexAbsolute:this.zIndex,cacheable:false,closeByEsc:true,closeIcon:true,contentBackground:"#fff",overlay:{opacity:15},lightShadow:true,buttons:[new BX.UI.Button({text:h.Loc.getMessage("CAL_ICLOUD_CONNECT_BUTTON"),className:`ui-btn ui-btn-md ui-btn-success ui-btn-round`,events:{click:this.authorize.bind(this)}}),new BX.UI.Button({text:h.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-md ui-btn-light-border ui-btn-round",events:{click:this.close.bind(this)}})],events:{onPopupClose:this.close.bind(this)}});this.popup.show();h.Event.bind(document,"keydown",this.keyHandler);h.Event.bind(document,"mouseup",this.checkOutsideClickClose);h.Event.bind(document,"mousedown",this.outsideMouseDownClose)}authorize(){if(this.isFormDataValid()){const e=this.popup.getButtons()[0];e.setClocking(true);e.setDisabled(true);const t=this.popup.getButtons()[1];t.setDisabled(true);if(this.DOM.container.contains(this.DOM.alertBlock)){h.Dom.remove(this.DOM.alertBlock)}this.emit("onSubmit",new d.BaseEvent({data:{appleId:this.DOM.appleIdInput.value.toString().trim(),appPassword:this.DOM.appPasswordInput.value.toString().trim()}}))}else{this.highlightInvalidFormData()}}isFormDataValid(){return this.DOM.appleIdInput.value.toString().trim()!==""&&this.DOM.appPasswordInput.value.toString().trim()!==""}highlightInvalidFormData(){const e=this.popup.getButtons()[0];e.setClocking(false);e.setDisabled(false);const t=this.popup.getButtons()[1];t.setDisabled(false);if(this.DOM.appleIdInput.value.toString().trim()===""){this.highlightInvalidAppleIdInput()}if(this.DOM.appPasswordInput.value.toString().trim()===""){this.highlightInvalidPasswordInput()}}highlightInvalidAppleIdInput(){h.Dom.addClass(this.DOM.appleIdInput,"calendar-field-string-error");const e=()=>{h.Dom.removeClass(this.DOM.appleIdInput,"calendar-field-string-error");h.Event.unbind(this.DOM.appleIdInput,"change",e);h.Event.unbind(this.DOM.appleIdInput,"keyup",e)};h.Event.bind(this.DOM.appleIdInput,"change",e);h.Event.bind(this.DOM.appleIdInput,"keyup",e)}highlightInvalidPasswordInput(){h.Dom.addClass(this.DOM.appPasswordInput,"calendar-field-string-error");const e=()=>{h.Dom.removeClass(this.DOM.appPasswordInput,"calendar-field-string-error");h.Event.unbind(this.DOM.appPasswordInput,"change",e);h.Event.unbind(this.DOM.appPasswordInput,"keyup",e)};h.Event.bind(this.DOM.appPasswordInput,"change",e);h.Event.bind(this.DOM.appPasswordInput,"keyup",e);this.DOM.appPasswordInput.focus()}enableSaveButton(){const e=this.popup.getButtons()[0];e.setDisabled(false);const t=this.popup.getButtons()[1];t.setDisabled(false)}getContainer(){this.DOM.container=h.Tag.render(vt||(vt=Ct`
			<div>
				${0}
				<div class="calendar-sync__auth-popup--row" id="calendar-apple-id-block">
					${0}
					${0}
					${0}
				</div>
				<div class="calendar-sync__auth-popup--row" id="calendar-apple-pass-block">
					<div class="calendar-sync__auth-popup--label-block">
						${0}
						${0}
					</div>
					<div class="ui-ctl ui-ctl-w100 ui-ctl-after-icon">
						${0}
						${0}
					</div>
					${0}
				</div>
			</div>
		`),this.getAppleInfoBlock(),this.getAppleIdTitle(),this.getAppleIdInput(),this.getAppleIdError(),this.getAppPasswordTitle(),this.getLearnMoreButton(),this.getAppPasswordInput(),this.getShowHidePasswordIcon(),this.getAppPasswordError());return this.DOM.container}getAppleInfoBlock(){if(!this.DOM.appleInfo){this.DOM.appleInfo=h.Tag.render(Et||(Et=Ct`
				<div class="calendar-sync__auth-popup--info">
					<div class="calendar-sync__auth-popup--logo-image --icloud"></div>
					<div class="calendar-sync__auth-popup--logo-text">${0}</div>
				</div>
			`),h.Loc.getMessage("CAL_ICLOUD_INFO_BLOCK"))}return this.DOM.appleInfo}getAppleIdTitle(){if(!this.DOM.appleIdTitle){this.DOM.appleIdTitle=h.Tag.render(St||(St=Ct`
			<p class="calendar-sync__auth-popup--label-text">
				${0}
			</p>
			`),h.Loc.getMessage("CAL_ICLOUD_APPLE_ID_PLACEHOLDER"))}return this.DOM.appleIdTitle}getAppPasswordTitle(){if(!this.DOM.appPasswordTitle){this.DOM.appPasswordTitle=h.Tag.render(Tt||(Tt=Ct`
				<p class="calendar-sync__auth-popup--label-text">
					${0}
				</p>
			`),h.Loc.getMessage("CAL_ICLOUD_PASS_PLACEHOLDER"))}return this.DOM.appPasswordTitle}getAppleIdError(){if(!this.DOM.appleIdError){this.DOM.appleIdError=h.Tag.render(yt||(yt=Ct`
				<div class="calendar-sync__auth-popup--label-text --error">
					${0}
				</div>
			`),h.Loc.getMessage("CAL_ICLOUD_APPLE_ID_ERROR"))}return this.DOM.appleIdError}getAppPasswordError(){if(!this.DOM.appPasswordError){this.DOM.appPasswordError=h.Tag.render(It||(It=Ct`
				<div class="calendar-sync__auth-popup--label-text --error">
					${0}
				</div>
			`),h.Loc.getMessage("CAL_ICLOUD_APP_PASSWORD_ERROR",{"#LINK_START#":'<a href="#" data-role="open-helpdesk-password">',"#LINK_END#":"</a>"}));const e=this.DOM.appPasswordError.querySelector('a[data-role="open-helpdesk-password"]');if(e){h.Event.bind(e,"click",this.openHelpDesk.bind(this))}}return this.DOM.appPasswordError}getAppleIdInput(){if(!this.DOM.appleIdInput){this.DOM.appleIdInput=h.Tag.render(Lt||(Lt=Ct`
				<input
					type="text"
					placeholder="${0}"
					class="calendar-field-string ui-ctl-element"
				/>
			`),h.Loc.getMessage("CAL_ICLOUD_AUTH_EMAIL_PLACEHOLDER"));this.DOM.appleIdInput.onfocus=()=>{if(h.Dom.hasClass(this.DOM.appleIdInput,"calendar-field-string-error")){h.Dom.removeClass(this.DOM.appleIdInput,"calendar-field-string-error");h.Dom.removeClass(this.DOM.appleIdError,"show")}};this.DOM.appleIdInput.onblur=()=>{if(!this.validateAppleIdInput()&&!h.Dom.hasClass(this.DOM.appleIdInput,"calendar-field-string-error")){h.Dom.addClass(this.DOM.appleIdInput,"calendar-field-string-error");h.Dom.addClass(this.DOM.appleIdError,"show")}}}return this.DOM.appleIdInput}getAppPasswordInput(){if(!this.DOM.appPasswordInput){this.DOM.appPasswordInput=h.Tag.render(At||(At=Ct`
				<input
					type="password"
					placeholder="${0}"
					class="calendar-field-string ui-ctl-element"
					required maxlength="19"
				/>
			`),h.Loc.getMessage("CAL_ICLOUD_AUTH_APPPASS_PLACEHOLDER"));h.Event.bind(this.DOM.appPasswordInput,"input",this.validateAppPasswordInput.bind(this))}return this.DOM.appPasswordInput}getShowHidePasswordIcon(){if(!this.DOM.showHidePasswordIcon){this.DOM.showHidePasswordIcon=h.Tag.render(Nt||(Nt=Ct`
				<div class="ui-ctl-after calendar-sync__auth-popup--icon-adjust-password"></div>
			`));h.Event.bind(this.DOM.showHidePasswordIcon,"click",this.switchPasswordVisibility.bind(this))}return this.DOM.showHidePasswordIcon}getLearnMoreButton(){if(!this.DOM.learnMoreButton){this.DOM.learnMoreButton=h.Tag.render(ft||(ft=Ct`
				<span class="calendar-sync__auth-popup--learn-more">${0}</span>
			`),h.Loc.getMessage("CAL_ICLOUD_AUTH_APPPASS_ABOUT"));h.Event.bind(this.DOM.learnMoreButton,"click",this.openHelpDesk.bind(this))}return this.DOM.learnMoreButton}initAlertBlock(){if(!this.DOM.alertBlock){this.DOM.alertBlock=h.Tag.render(mt||(mt=Ct`
				<div class="ui-alert ui-alert-danger calendar-sync__auth-error">
	                <span class="ui-alert-message">${0}</span>
				</div>
			`),h.Loc.getMessage("CAL_ICLOUD_AUTH_ERROR"))}}showErrorAuthorizationAlert(){this.highlightInvalidAppleIdInput();this.highlightInvalidPasswordInput();this.enableSaveButton();if(!this.DOM.container.contains(this.DOM.alertBlock)){h.Dom.append(this.DOM.alertBlock,this.DOM.container)}}validateAppleIdInput(){const e=/^[a-zA-Z\d.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z\d-]+(?:\.[a-zA-Z\d-]+)*$/;const t=this.DOM.appleIdInput.value.toString().trim();if(t===""){return true}return e.test(t)}validateAppPasswordInput(){const e=/^[a-z]{4}-[a-z]{4}-[a-z]{4}-[a-z]{4}$/;const t=this.completeWithTemplate(this.DOM.appPasswordInput.value.toString().trim());if(e.test(t)){h.Dom.removeClass(this.DOM.appPasswordInput,"calendar-field-string-error");h.Dom.removeClass(this.DOM.appPasswordError,"show")}else{h.Dom.addClass(this.DOM.appPasswordInput,"calendar-field-string-error");h.Dom.addClass(this.DOM.appPasswordError,"show")}}switchPasswordVisibility(){if(h.Dom.hasClass(this.DOM.showHidePasswordIcon,"--hide")){this.DOM.appPasswordInput.type="password";h.Dom.removeClass(this.DOM.showHidePasswordIcon,"--hide")}else{this.DOM.appPasswordInput.type="text";h.Dom.addClass(this.DOM.showHidePasswordIcon,"--hide")}}clearForm(){this.DOM.appPasswordInput.value="";this.DOM.appleIdInput.value="";if(h.Dom.hasClass(this.DOM.appleIdInput,"calendar-field-string-error")){h.Dom.removeClass(this.DOM.appleIdInput,"calendar-field-string-error")}if(h.Dom.hasClass(this.DOM.appPasswordInput,"calendar-field-string-error")){h.Dom.removeClass(this.DOM.appPasswordInput,"calendar-field-string-error")}if(h.Dom.hasClass(this.DOM.appleIdError,"show")){h.Dom.removeClass(this.DOM.appleIdError,"show")}if(h.Dom.hasClass(this.DOM.appPasswordError,"show")){h.Dom.removeClass(this.DOM.appPasswordError,"show")}}completeWithTemplate(e){const t=this.appPasswordTemplate.slice(e.length,this.appPasswordTemplate.length);e+=t;return e}openHelpDesk(){const e="15426356";top.BX.Helper.show("redirect=detail&code="+e)}handleKeyPress(e){if(e.keyCode===p.Util.getKeyCode("enter")){this.authorize()}else if(e.keyCode===p.Util.getKeyCode("escape")){this.close()}}checkOutsideClickClose(e){let t=e.target||e.srcElement;this.outsideMouseUp=!t.closest("div.popup-window");if(this.outsideMouseUp&&this.outsideMouseDown&&this.checkTopSlider()){this.close()}}outsideMouseDownClose(e){let t=e.target||e.srcElement;this.outsideMouseDown=!t.closest("div.popup-window")}close(){if(this.popup){this.popup.destroy()}h.Event.unbind(document,"keydown",this.keyHandler);h.Event.unbind(document,"mouseup",this.checkOutsideClickClose);h.Event.unbind(document,"mousedown",this.outsideMouseDownClose);this.clearForm()}checkTopSlider(){return!p.Util.getBX().SidePanel.Instance.getTopSlider()}}let bt=e=>e,Ot;class Mt extends ot{constructor(e={}){super(e);this.TYPE="icloud";this.SLIDER_NAME="calendar:sync-wizard-icloud";this.STAGE_1_CODE="icloud-to-b24";this.STAGE_2_CODE="b24-events-to-icloud";this.STAGE_3_CODE="b24-to-icloud";this.setEventNamespace("BX.Calendar.Sync.Interface.IcloudSyncWizard");this.setAccountName(h.Loc.getMessage("CALENDAR_TITLE_ICLOUD"));this.setSyncStages();this.logoIconClass="--icloud"}getHelpLinkWrapper(){return""}getFinalCheckWrapper(){this.finalCheckWrapper=h.Tag.render(Ot||(Ot=bt`
			<div style="display: none;">
				<div class="calendar-sync__content-block --space-bottom">
					<div class="calendar-sync__balloon --progress">
						<div class="calendar-sync__content-text calendar-sync__content-title --show-for-progress">${0}</div>
						<div class="calendar-sync__content-text calendar-sync__content-subtitle --show-for-progress">${0}</div>
						<div class="calendar-sync__content-text calendar-sync__content-title --show-for-done">${0}</div>
						<div class="calendar-sync__content-text calendar-sync__content-subtitle --show-for-done">${0}</div>
						<div class="calendar-sync__balloon--icon"></div>
					</div>
				</div>
				${0}
				${0}
			</div>
		`),h.Loc.getMessage("CAL_SYNC_LETS_CHECK"),h.Loc.getMessage("CAL_SYNC_CREATE_EVENT_ICLOUD"),h.Loc.getMessage("CAL_SYNC_NEW_EVENT_ADDED_FROM_ICLOUD"),h.Loc.getMessage("CAL_SYNC_NEW_EVENT_YOULL_SEE"),this.getSkeletonWrapper(),this.getNewEventCardWrapper());return this.finalCheckWrapper}setSyncStages(){this.syncStagesList=[new dt({name:this.STAGE_1_CODE,title:h.Loc.getMessage("CAL_SYNC_STAGE_ICLOUD_1")}),new dt({name:this.STAGE_2_CODE,title:h.Loc.getMessage("CAL_SYNC_STAGE_ICLOUD_2")}),new dt({name:this.STAGE_3_CODE,title:h.Loc.getMessage("CAL_SYNC_STAGE_ICLOUD_3")})]}updateState(e){super.updateState(e);this.getSyncStages().forEach((t=>{if(e.stage==="connection_created"&&t.name===this.STAGE_1_CODE){t.setDone()}else if(e.stage==="import_finished"&&(t.name===this.STAGE_1_CODE||t.name===this.STAGE_2_CODE)){t.setDone()}else if(e.stage==="export_finished"){t.setDone();if(t.name===this.STAGE_3_CODE){if(this.mode==="reconnecting"){this.handleCloseWizard()}else{this.setActiveStatusFinished();this.showButtonWrapper();this.showInfoStatusWrapper()}this.showConfetti();this.emit("onConnectionCreated")}}}))}getSkeletonTitle(){return h.Loc.getMessage("CAL_SYNC_NEW_EVENT_ICLOUD_TITLE")}}let wt=e=>e,Bt;class Pt{constructor(e={}){this.zIndex=3100;this.DOM={};this.authDialog=e.authDialog}show(){this.popup=new u.Popup({className:"calendar-sync__auth-popup calendar-sync__scope",titleBar:h.Loc.getMessage("CAL_ICLOUD_ALERT_OTHER_APPLE_SYNC_TITLE"),width:500,draggable:true,content:this.getContainer(),cacheable:false,closeByEsc:true,closeIcon:true,contentBackground:"#fff",overlay:{opacity:15},buttons:[new BX.UI.Button({text:h.Loc.getMessage("CAL_ICLOUD_ALERT_OTHER_APPLE_SYNC_LEARN_MORE"),className:"ui-btn ui-btn-md ui-btn-primary",events:{click:this.openHelpDesk.bind(this)}}),new BX.UI.Button({text:h.Loc.getMessage("CAL_BUTTON_CONTINUE"),className:"ui-btn ui-btn-md ui-btn-light",events:{click:this.openAuthDialog.bind(this)}})],events:{onPopupClose:this.close.bind(this)}});this.popup.show()}getContainer(){this.DOM.container=h.Tag.render(Bt||(Bt=wt`
			<div>
				${0}
			</div>
		`),this.getAlertInformation());return this.DOM.container}getAlertInformation(){this.DOM.alertBlock=new BX.UI.Alert({text:h.Loc.getMessage("CAL_ICLOUD_ALERT_OTHER_APPLE_SYNC_INFO"),color:BX.UI.Alert.Color.WARNING,icon:BX.UI.Alert.Icon.INFO});const e=this.DOM.alertBlock.getContainer();const t=e.querySelector(".ui-alert-message");h.Dom.addClass(t,"calendar-sync__alert-popup--text");return e}openHelpDesk(){const e="16020988";top.BX.Helper.show("redirect=detail&code="+e)}disableConnection(){BX.ajax.runAction("calendar.api.syncajax.disableIphoneOrMacConnection").then((()=>{this.authDialog.show();this.close();p.Util.setIphoneConnectionStatus(false);p.Util.setMacConnectionStatus(false)}))}openAuthDialog(){this.authDialog.show();this.close()}close(){if(this.popup){this.popup.destroy()}}}class kt extends we{constructor(e,t=null){super({title:h.Loc.getMessage("CALENDAR_TITLE_ICLOUD"),helpDeskCode:"6030429",titleInfoHeader:h.Loc.getMessage("CAL_CONNECT_ICLOUD_CALENDAR"),descriptionInfoHeader:h.Loc.getMessage("CAL_ICLOUD_CONNECT_DESCRIPTION"),titleActiveHeader:h.Loc.getMessage("CAL_CALENDAR_IS_CONNECT"),descriptionActiveHeader:h.Loc.getMessage("CAL_ICLOUD_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-icloud",iconPath:"/bitrix/images/calendar/sync/icloud.svg",iconLogoClass:"--icloud",color:"#95a0af",provider:e,connection:t,popupWithUpdateButton:true});this.sectionStatusObject={};this.sectionList=[]}createConnection(e){this.provider.setWizardSyncMode(true);this.provider.getInterfaceUnit().setSyncStatus(this.provider.STATUS_SYNCHRONIZING);BX.ajax.runAction("calendar.api.syncajax.createIcloudConnection",{data:{appleId:e.appleId,appPassword:e.appPassword}}).then((t=>{const n=t.data;if(n.status==="success"&&n.connectionId){this.openSyncWizard(e.appleId);void this.syncCalendarsWithIcloud(n.connectionId)}}),(()=>{this.authDialog.showErrorAuthorizationAlert()}))}syncCalendarsWithIcloud(e){this.authDialog.close();return new Promise((t=>{BX.ajax.runAction("calendar.api.syncajax.syncIcloudConnection",{data:{connectionId:e}}).then((n=>{this.provider.setStatus(this.provider.STATUS_SUCCESS);this.provider.getInterfaceUnit().setSyncStatus(this.provider.STATUS_SUCCESS);if(e){this.provider.getConnection().setId(e);this.provider.getConnection().setStatus(true);this.provider.getConnection().setConnected(true);this.provider.getConnection().setSyncDate(new Date)}t(n.data)}),(e=>{this.provider.setStatus(this.provider.STATUS_FAILED);this.provider.setWizardState({status:this.provider.ERROR_CODE,vendorName:this.provider.type});t(e.errors)}))}))}getSectionsForIcloud(){return new Promise((e=>{BX.ajax.runAction("calendar.api.syncajax.getAllSectionsForIcloud",{data:{connectionId:this.connection.addParams.id}}).then((t=>{this.sectionList=t.data;e(t.data)}),(t=>{e(t.errors)}))}))}onClickCheckSection(e){this.sectionStatusObject[e.target.value]=e.target.checked;this.runUpdateInfo();this.showUpdateSectionListNotification()}handleConnectButton(){this.initPopup();if(p.Util.isIphoneConnected()||p.Util.isMacConnected()){this.alertSyncPopup.show()}else{this.authDialog.show()}}initPopup(){if(!this.authDialog){this.authDialog=new Dt;d.EventEmitter.unsubscribeAll("BX.Calendar.Sync.Icloud:onSubmit");d.EventEmitter.subscribe("BX.Calendar.Sync.Icloud:onSubmit",(e=>{this.createConnection(e.data)}))}if(!this.alertSyncPopup){this.alertSyncPopup=new Pt({authDialog:this.authDialog})}}openSyncWizard(e){this.provider.setWizardSyncMode(true);const t=this.provider.isStartedReconnecting?"reconnect":"default";this.wizard=new Mt({mode:t});this.wizard.openSlider();this.provider.setActiveWizard(this.wizard);d.EventEmitter.subscribeOnce("BX.Calendar.Sync.Interface.SyncStageUnit:onRenderDone",(()=>{this.wizard.updateState({stage:"connection_created",vendorName:"icloud",accountName:e})}))}sendRequestRemoveConnection(e){this.deactivateConnection(e)}}let Ut=e=>e,Rt;class Wt extends ot{constructor(e={}){super(e);this.TYPE="office365";this.SLIDER_NAME="calendar:sync-wizard-office365";this.STAGE_1_CODE="office365-to-b24";this.STAGE_2_CODE="sections_sync_finished";this.STAGE_3_CODE="events_sync_finished";this.setEventNamespace("BX.Calendar.Sync.Interface.Office365SyncWizard");this.setAccountName(h.Loc.getMessage("CALENDAR_TITLE_OFFICE365"));this.setSyncStages();this.logoIconClass="--office365"}getHelpLinkWrapper(){return""}getFinalCheckWrapper(){this.finalCheckWrapper=h.Tag.render(Rt||(Rt=Ut`
			<div style="display: none;">
				<div class="calendar-sync__content-block --space-bottom">
					<div class="calendar-sync__balloon --progress">
						<div class="calendar-sync__content-text calendar-sync__content-title --show-for-progress">${0}</div>
						<div class="calendar-sync__content-text calendar-sync__content-subtitle --show-for-progress">${0}</div>
						<div class="calendar-sync__content-text calendar-sync__content-title --show-for-done">${0}</div>
						<div class="calendar-sync__content-text calendar-sync__content-subtitle --show-for-done">${0}</div>
						<div class="calendar-sync__balloon--icon"></div>
					</div>
				</div>
				${0}
				${0}
			</div>
		`),h.Loc.getMessage("CAL_SYNC_LETS_CHECK"),h.Loc.getMessage("CAL_SYNC_CREATE_EVENT_OFFICE365"),h.Loc.getMessage("CAL_SYNC_NEW_EVENT_ADDED_FROM_OFFICE365"),h.Loc.getMessage("CAL_SYNC_NEW_EVENT_YOULL_SEE"),this.getSkeletonWrapper(),this.getNewEventCardWrapper());return this.finalCheckWrapper}setSyncStages(){this.syncStagesList=[new dt({name:this.STAGE_1_CODE,title:h.Loc.getMessage("CAL_SYNC_STAGE_OFFICE365_1")}),new dt({name:this.STAGE_2_CODE,title:h.Loc.getMessage("CAL_SYNC_STAGE_OFFICE365_2")}),new dt({name:this.STAGE_3_CODE,title:h.Loc.getMessage("CAL_SYNC_STAGE_OFFICE365_3")})]}updateState(e){super.updateState(e);this.getSyncStages().forEach((t=>{if(e.stage==="connection_created"&&t.name===this.STAGE_1_CODE){t.setDone()}else if(e.stage==="import_finished"&&(t.name===this.STAGE_1_CODE||t.name===this.STAGE_2_CODE)){t.setDone()}else if(e.stage==="export_finished"){t.setDone();if(this.mode==="reconnecting"){this.handleCloseWizard()}else{this.setActiveStatusFinished();this.showButtonWrapper();this.showInfoStatusWrapper()}this.showConfetti();this.emit("onConnectionCreated")}}))}getSkeletonTitle(){return h.Loc.getMessage("CAL_SYNC_NEW_EVENT_OFFICE365_TITLE")}}class Ht extends we{constructor(e,t=null){super({title:h.Loc.getMessage("CALENDAR_TITLE_OFFICE365"),helpDeskCode:"6030429",titleInfoHeader:h.Loc.getMessage("CAL_CONNECT_OFFICE365_CALENDAR"),descriptionInfoHeader:h.Loc.getMessage("CAL_OFFICE365_CONNECT_DESCRIPTION"),titleActiveHeader:h.Loc.getMessage("CAL_OFFICE365_CALENDAR_IS_CONNECT"),descriptionActiveHeader:h.Loc.getMessage("CAL_OFFICE365_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-office365",iconPath:"/bitrix/images/calendar/sync/office365.svg",iconLogoClass:"--office365",color:"#fc1d1d",provider:e,connection:t,popupWithUpdateButton:true});this.HANDLE_CONNECTION_DELAY=500;this.sectionStatusObject={};this.sectionList=[];this.handleSuccessConnectionDebounce=h.Runtime.debounce(this.handleSuccessConnection,this.HANDLE_CONNECTION_DELAY,this)}createConnection(){const e=this.provider.getSyncLink();BX.util.popup(e,500,600);h.Event.bind(window,"hashchange",this.handleSuccessConnectionDebounce)}handleSuccessConnection(e){if(window.location.hash==="#office365AuthSuccess"){p.Util.removeHash();this.provider.setWizardSyncMode(true);this.provider.saveConnection();this.openSyncWizard();this.provider.setStatus(this.provider.STATUS_SYNCHRONIZING);this.provider.getInterfaceUnit().setSyncStatus(this.provider.STATUS_SYNCHRONIZING);this.provider.getInterfaceUnit().refreshButton();if(this.provider.isReconnecting()){this.provider.emit("onReconnecting")}h.Event.unbind(window,"hashchange",this.handleSuccessConnectionDebounce)}}onClickCheckSection(e){this.sectionStatusObject[e.target.value]=e.target.checked;this.runUpdateInfo();this.showUpdateSectionListNotification()}handleConnectButton(){if(this.provider.hasSetSyncOffice365Settings()){this.createConnection()}else{this.showAlertPopup()}}openSyncWizard(){const e=this.provider.isStartedReconnecting?"reconnect":"default";this.wizard=new Wt({mode:e});this.wizard.openSlider();this.provider.setActiveWizard(this.wizard)}getSectionsForOffice365(){return new Promise((e=>{BX.ajax.runAction("calendar.api.syncajax.getAllSectionsForOffice365",{data:{connectionId:this.connection.addParams.id}}).then((t=>{this.sectionList=t.data;e(t.data)}),(t=>{e(t.errors)}))}))}sendRequestRemoveConnection(e){this.deactivateConnection(e)}showAlertPopup(){const e=new l.MessageBox({className:this.id,message:h.Loc.getMessage("OFFICE365_IS_NOT_CALDAV_SETTINGS_WARNING_MESSAGE"),width:500,offsetLeft:60,offsetTop:5,padding:7,onOk:()=>{e.close()},okCaption:"OK",buttons:BX.UI.Dialogs.MessageBoxButtons.OK,popupOptions:{zIndexAbsolute:4020,autoHide:true,animation:"fading-slide"}});e.show()}}let xt=e=>e,$t,Gt,Xt,Ft,Yt,zt;class jt extends we{constructor(e,t=null){super({title:h.Loc.getMessage("CALENDAR_TITLE_MAC"),helpDeskCode:"5684075",titleInfoHeader:h.Loc.getMessage("CAL_CONNECT_MAC_CALENDAR_TITLE"),descriptionInfoHeader:h.Loc.getMessage("CAL_MAC_CONNECT_DESCRIPTION"),titleActiveHeader:h.Loc.getMessage("CAL_MAC_CALENDAR_IS_CONNECT_TITLE"),descriptionActiveHeader:h.Loc.getMessage("CAL_MAC_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-mac",iconPath:"/bitrix/images/calendar/sync/mac.svg",color:"#ff5752",provider:e,connection:t,popupWithUpdateButton:false});this.alreadyConnectedToNew=p.Util.isIcloudConnected();if(this.alreadyConnectedToNew){this.warningText=h.Loc.getMessage("CAL_SYNC_WARNING_IPHONE_AND_MAC_CONNECTED");this.mobileSyncButtonText=h.Loc.getMessage("CALENDAR_CHECK_ICLOUD_SETTINGS")}else{this.warningText=h.Loc.getMessage("CAL_SYNC_WARNING_IPHONE_AND_MAC");this.mobileSyncButtonText=h.Loc.getMessage("CALENDAR_CONNECT_ICLOUD")}}getPortalAddress(){return this.portalAddress}getContentInfoBody(){return h.Tag.render($t||($t=xt`
			${0}
			${0}
		`),this.getContentInfoBodyHeader(),this.getContentInfoWarning())}getActiveConnectionContent(){return h.Tag.render(Gt||(Gt=xt`
			<div class="calendar-sync-wrap calendar-sync-wrap-detail">
				<div class="calendar-sync-header">
					<span class="calendar-sync-header-text">${0}</span>
				</div>
				${0}
			</div>
		`),this.getHeaderTitle(),this.getContentActiveBody())}getContentActiveBody(){return h.Tag.render(Xt||(Xt=xt`
			${0}
			<div class="calendar-sync-slider-section calendar-sync-slider-section-banner">
				${0}
			</div>
		`),this.getContentActiveBodyHeader(),this.getContentBodyConnect())}getContentActiveBodyHeader(){const e=this.connection.getSyncDate().getTime()/1e3;const t=e?p.Util.formatDateUsable(e)+" "+BX.date.format(p.Util.getTimeFormatShort(),e):"";return h.Tag.render(Ft||(Ft=xt`
			<div class="calendar-sync-slider-section">
				<div class="calendar-sync-slider-header-icon ${0}"></div>
				<div class="calendar-sync-slider-header">
				<div class="calendar-sync-slider-title">${0}</div>
				<div class="calendar-sync-slider-info">
					<span class="calendar-sync-slider-info-text">${0}</span>
					<span class="calendar-sync-slider-info-time">${0}</span>
				</div>
					<a class="calendar-sync-slider-link" href="javascript:void(0);" onclick="${0}">${0}</a>
				</div>
			</div>`),this.sliderIconClass,this.titleActiveHeader,h.Loc.getMessage("CAL_SYNC_LAST_SYNC_DATE"),t,this.showHelp.bind(this),h.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"))}getContentInfoBodyHeaderHelper(){if(!this.headerHelper){this.headerHelper=h.Tag.render(Yt||(Yt=xt`
				<div class="calendar-sync-slider-info">
					<span class="calendar-sync-slider-info-text">
						<a class="calendar-sync-slider-info-link">
							${0}
						</a>
					</span>
				</div>
			`),h.Loc.getMessage("CAL_CONNECT_PC"));h.Event.bind(this.headerHelper,"click",this.showExtendedInfoMacOs.bind(this))}return this.headerHelper}showExtendedInfoMacOs(){this.headerHelper.style.display="none";h.Dom.append(this.getContentBodyConnect(),this.infoBodyHeader)}getContentBodyConnect(){return h.Tag.render(zt||(zt=xt`
			<div class="calendar-sync-slider-section calendar-sync-slider-section-col">
				<div class="calendar-sync-slider-header calendar-sync-slider-header-divide">
					<div class="calendar-sync-slider-subtitle">${0}</div>
				</div>
				<div class="calendar-sync-slider-info">
					<span class="calendar-sync-slider-info-text">${0}:</span>
					<ol class="calendar-sync-slider-info-list">
						<li class="calendar-sync-slider-info-item">
							<span class="calendar-sync-slider-info-text">${0}</span>
						</li>
						<li class="calendar-sync-slider-info-item">
							<span class="calendar-sync-slider-info-text">${0}</span>
						</li>
						<li class="calendar-sync-slider-info-item">
							<span class="calendar-sync-slider-info-text">${0}</span>
						</li>
						<li class="calendar-sync-slider-info-item">
							<span class="calendar-sync-slider-info-text">${0}</span>
						</li>
						<li class="calendar-sync-slider-info-item">
							<span class="calendar-sync-slider-info-text">${0}</span>
						</li>
						<li class="calendar-sync-slider-info-item">
							<span class="calendar-sync-slider-info-text">${0}</span>
						</li>
						<li class="calendar-sync-slider-info-item">
							<span class="calendar-sync-slider-info-text">${0}</span>
						</li>
					</ol>
					<span class="calendar-sync-slider-info-text">${0}</span>
					<div class="calendar-sync-slider-info" style="margin-top: 20px">
						<span class="calendar-sync-slider-info-text">
							<a class="calendar-sync-slider-info-link" href="javascript:void(0);" onclick="${0}">
								${0}
							</a>
						</span>
					</div>
				</div>
			</div>
		`),h.Loc.getMessage("CAL_MAC_INSTRUCTION_HEADER"),h.Loc.getMessage("CAL_MAC_INSTRUCTION_DESCRIPTION"),h.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_FIRST"),h.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_SECOND"),h.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_THIRD"),h.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_FOURTH"),h.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_FIFTH",{"#PORTAL_ADDRESS#":this.provider.getPortalAddress()}),h.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_SIXTH"),h.Loc.getMessage("CAL_MAC_INSTRUCTION_POINT_SEVENTH"),h.Loc.getMessage("CAL_MAC_INSTRUCTION_CONCLUSION"),this.showHelp.bind(this),h.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"))}handleMobileButtonConnectClick(){BX.SidePanel.Instance.getOpenSliders().forEach((e=>{if(["calendar:auxiliary-sync-slider","calendar:item-sync-connect-mac"].includes(e.getUrl())){e.close()}}));const e=p.Util.getCalendarContext();if(e){e.syncInterface.getIcloudProvider().getInterfaceUnit().getConnectionTemplate().handleConnectButton()}}handleMobileButtonOtherSyncInfo(){BX.SidePanel.Instance.getOpenSliders().forEach((e=>{if(["calendar:auxiliary-sync-slider","calendar:item-sync-connect-mac"].includes(e.getUrl())){e.close()}}));const e=p.Util.getCalendarContext();if(e){const t=e.syncInterface.getIcloudProvider().getInterfaceUnit().connectionProvider;t.openActiveConnectionSlider(t.getConnection())}}}class Kt extends we{constructor(e,t=null){super({title:h.Loc.getMessage("CALENDAR_TITLE_MAC"),helpDeskCode:"5684075",titleInfoHeader:h.Loc.getMessage("CAL_CONNECT_MAC_CALENDAR_TITLE"),descriptionInfoHeader:h.Loc.getMessage("CAL_MAC_CONNECT_DESCRIPTION"),titleActiveHeader:h.Loc.getMessage("CAL_MAC_CALENDAR_IS_CONNECT_TITLE"),descriptionActiveHeader:h.Loc.getMessage("CAL_MAC_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-mac",iconPath:"/bitrix/images/calendar/sync/mac.svg",color:"#ff5752",provider:e,connection:t,popupWithUpdateButton:false})}}class qt extends Ue{constructor(e,t=null){super({title:h.Loc.getMessage("CALENDAR_TITLE_YANDEX"),helpDeskCode:"12925048",titleInfoHeader:h.Loc.getMessage("CAL_CONNECT_YANDEX_CALENDAR"),descriptionInfoHeader:h.Loc.getMessage("CAL_YANDEX_CONNECT_DESCRIPTION"),titleActiveHeader:h.Loc.getMessage("CAL_YANDEX_CALENDAR_IS_CONNECT"),descriptionActiveHeader:h.Loc.getMessage("CAL_YANDEX_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-yandex",iconPath:"/bitrix/images/calendar/sync/yandex.svg",iconLogoClass:"--yandex",color:"#f9c500",provider:e,connection:t,popupWithUpdateButton:true})}}let Vt=e=>e,Zt,Jt,Qt,en,tn,nn,sn;class an extends we{constructor(e){super(e);this.banner=new pe({type:this.provider.getType(),helpDeskCode:e.helpDeskCode});if(this.status){this.syncDate=h.Type.isDate(this.data.syncDate)?this.data.syncDate:p.Util.parseDate(this.data.syncDate)}}getContentInfoBody(){return h.Tag.render(Zt||(Zt=Vt`
			${0}
			${0}
		`),this.getContentInfoBodyHeader(),this.getContentInfoWarning())}getContentInfoBodyHeaderHelper(){if(!this.headerHelper){this.headerHelper=h.Tag.render(Jt||(Jt=Vt`
				<div class="calendar-sync-slider-info">
					${0}
				</div>
			`),this.getContentInfoBodyHeaderHelperConnect())}return this.headerHelper}getContentInfoBodyHeaderHelperConnect(){if(!this.headerHelperConnect){this.headerHelperConnect=h.Tag.render(Qt||(Qt=Vt`
				<div class="calendar-sync-slider-info-text">
					<a class="calendar-sync-slider-info-link">
						${0}
					</a>
				</div>
			`),h.Loc.getMessage("CAL_CONNECT_PHONE"));h.Event.bind(this.headerHelperConnect,"click",this.showMobileSyncBanner.bind(this))}return this.headerHelperConnect}showMobileSyncBanner(){this.banner.show()}getContentActiveBody(){return h.Tag.render(en||(en=Vt`
			${0}			
			${0}
		`),this.getContentActiveBodyHeader(),this.getContentInfoWarning())}getContentActiveBodyHeader(){const e=this.connection.getSyncDate().getTime()/1e3;const t=e?p.Util.formatDateUsable(e)+" "+BX.date.format(p.Util.getTimeFormatShort(),e):"";return h.Tag.render(tn||(tn=Vt`
			<div class="calendar-sync-slider-section">
				<div class="calendar-sync-slider-header-icon ${0}"></div>
				<div class="calendar-sync-slider-header">
					<div class="calendar-sync-slider-title">${0}</div>
					<div class="calendar-sync-slider-info">
						<span class="calendar-sync-slider-info-text">${0}</span>
						<span class="calendar-sync-slider-info-time">${0}</span>
					</div>
					<div class="calendar-sync-slider-desc">${0}</div>
					${0}
				</div>
			</div>`),this.sliderIconClass,this.titleActiveHeader,h.Loc.getMessage("CAL_SYNC_LAST_SYNC_DATE"),t,h.Loc.getMessage("CAL_SYNC_DISABLE"),this.getContentInfoBodyHeaderHelper())}getActiveConnectionContent(){return h.Tag.render(nn||(nn=Vt`
			<div class="calendar-sync-wrap calendar-sync-wrap-detail">
				<div class="calendar-sync-header" style="justify-content: start;">
					<span class="calendar-sync-header-text">${0}</span>
					${0}
				</div>
				${0}
			</div>
		`),this.getHeaderTitle(),this.getHeaderHint(),this.getContentActiveBody())}getInfoConnectionContent(){return h.Tag.render(sn||(sn=Vt`
			<div class="calendar-sync-wrap calendar-sync-wrap-detail">
				<div class="calendar-sync-header" style="justify-content: start;">
					<span class="calendar-sync-header-text">${0}</span>
					${0}
				</div>
				${0}
			</div>
		`),this.getHeaderTitle(),this.getHeaderHint(),this.getContentInfoBody())}getHeaderHint(){var e;(e=this.hintNode)!=null?e:this.hintNode=BX.UI.Hint.createNode(h.Loc.getMessage("CAL_TEXT_ABOUT_WORK_SYNC"));h.Event.bind(this.hintNode,"click",this.showHelp.bind(this));return this.hintNode}}class on extends an{constructor(e,t=null){super({title:h.Loc.getMessage("CALENDAR_TITLE_ANDROID"),helpDeskCode:"5686179",titleInfoHeader:h.Loc.getMessage("CAL_CONNECT_ANDROID_CALENDAR_TITLE"),descriptionInfoHeader:h.Loc.getMessage("CAL_ANDROID_CONNECT_DESCRIPTION"),titleActiveHeader:h.Loc.getMessage("CAL_SYNC_CONNECTED_ANDROID_TITLE"),descriptionActiveHeader:h.Loc.getMessage("CAL_ANDROID_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-android",iconPath:"/bitrix/images/calendar/sync/android.svg",color:"#9ece03",provider:e,connection:t,popupWithUpdateButton:false});this.alreadyConnectedToNew=p.Util.isGoogleConnected();if(this.alreadyConnectedToNew){this.warningText=h.Loc.getMessage("CAL_SYNC_WARNING_ANDROID_CONNECTED");this.mobileSyncButtonText=h.Loc.getMessage("CALENDAR_CHECK_GOOGLE_SETTINGS")}else{this.warningText=h.Loc.getMessage("CAL_SYNC_WARNING_ANDROID");this.mobileSyncButtonText=h.Loc.getMessage("CALENDAR_CONNECT_GOOGLE")}}handleMobileButtonConnectClick(){BX.SidePanel.Instance.getOpenSliders().forEach((e=>{if(["calendar:auxiliary-sync-slider","calendar:item-sync-connect-android"].includes(e.getUrl())){e.close()}}));const e=p.Util.getCalendarContext();if(e){e.syncInterface.getGoogleProvider().getInterfaceUnit().getConnectionTemplate().handleConnectButton()}}handleMobileButtonOtherSyncInfo(){BX.SidePanel.Instance.getOpenSliders().forEach((e=>{if(["calendar:auxiliary-sync-slider","calendar:item-sync-connect-android"].includes(e.getUrl())){e.close()}}));const e=p.Util.getCalendarContext();if(e){const t=e.syncInterface.getGoogleProvider().getInterfaceUnit().connectionProvider;t.openActiveConnectionSlider(t.getConnection())}}}class cn extends an{constructor(e,t=null){super({title:h.Loc.getMessage("CALENDAR_TITLE_IPHONE"),helpDeskCode:"5686207",titleInfoHeader:h.Loc.getMessage("CAL_CONNECT_IPHONE_CALENDAR_TITLE"),descriptionInfoHeader:h.Loc.getMessage("CAL_IPHONE_CONNECT_DESCRIPTION"),titleActiveHeader:h.Loc.getMessage("CAL_SYNC_CONNECTED_IPHONE_TITLE"),descriptionActiveHeader:h.Loc.getMessage("CAL_IPHONE_SELECTED_DESCRIPTION"),sliderIconClass:"calendar-sync-slider-header-icon-iphone",iconPath:"/bitrix/images/calendar/sync/iphone.svg",color:"#2fc6f6",provider:e,connection:t,popupWithUpdateButton:false});this.alreadyConnectedToNew=p.Util.isIcloudConnected();if(this.alreadyConnectedToNew){this.warningText=h.Loc.getMessage("CAL_SYNC_WARNING_IPHONE_AND_MAC_CONNECTED");this.mobileSyncButtonText=h.Loc.getMessage("CALENDAR_CHECK_ICLOUD_SETTINGS")}else{this.warningText=h.Loc.getMessage("CAL_SYNC_WARNING_IPHONE_AND_MAC");this.mobileSyncButtonText=h.Loc.getMessage("CALENDAR_CONNECT_ICLOUD")}}handleMobileButtonConnectClick(){BX.SidePanel.Instance.getOpenSliders().forEach((e=>{if(["calendar:auxiliary-sync-slider","calendar:item-sync-connect-iphone"].includes(e.getUrl())){e.close()}}));const e=p.Util.getCalendarContext();if(e){e.syncInterface.getIcloudProvider().getInterfaceUnit().getConnectionTemplate().handleConnectButton()}}handleMobileButtonOtherSyncInfo(){BX.SidePanel.Instance.getOpenSliders().forEach((e=>{if(["calendar:auxiliary-sync-slider","calendar:item-sync-connect-iphone"].includes(e.getUrl())){e.close()}}));const e=p.Util.getCalendarContext();if(e){const t=e.syncInterface.getIcloudProvider().getInterfaceUnit().connectionProvider;t.openActiveConnectionSlider(t.getConnection())}}}let rn=e=>e,dn,ln;var hn=babelHelpers.classPrivateFieldLooseKey("showSuccessCopyNotification");var pn=babelHelpers.classPrivateFieldLooseKey("showFailedCopyNotification");var un=babelHelpers.classPrivateFieldLooseKey("showResultNotification");class gn{constructor(e){Object.defineProperty(this,un,{value:vn});Object.defineProperty(this,pn,{value:Cn});Object.defineProperty(this,hn,{value:_n});this.LINK_LENGTH=112;this.link=this.getIcalLink(e)}static createInstance(e){return new this(e)}show(){this.createPopup().show();this.startSync()}startSync(){BX.ajax.get(this.link+"&check=Y","",(e=>{setTimeout((()=>{if(!e||e.length<=0||e.toUpperCase().indexOf("BEGIN:VCALENDAR")===-1){this.showPopupWithSyncDataError()}}),300)}))}getContent(){return h.Tag.render(dn||(dn=rn`
			<div class="calendar-ical-popup-wrapper">
				<h3>${0}</h3>
				<div class="calendar-ical-popup-label-text"><span>${0}</span></div>
				${0}
			</div>
		`),h.Loc.getMessage("EC_JS_EXPORT_TILE"),h.Loc.getMessage("EC_EXP_TEXT"),this.getLinkBlock())}createPopup(){return this.popup=new u.Popup({width:400,zIndexOptions:4e3,autoHide:false,closeByEsc:true,draggable:true,closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",content:this.getContent(),buttons:[new BX.UI.Button({text:h.Loc.getMessage("EC_JS_ICAL_COPY_ICAL_SYNC_LINK"),color:BX.UI.Button.Color.PRIMARY,onclick:()=>{this.copyLink(event)}}),new BX.UI.Button({text:h.Loc.getMessage("EC_SEC_SLIDER_CLOSE"),color:BX.UI.Button.Color.LINK,onclick:()=>{this.popup.close()}})]})}getIcalLink(e){return e.calendarPath+(e.calendarPath.indexOf("?")>=0?"&":"?")+"action=export"+e.sectionLink}getLinkBlock(){return h.Tag.render(ln||(ln=rn`
				<div class="calendar-ical-popup-link-block">
					<a class="ui-link ui-link-primary " target="_blank" href="${0}">
						${0}
					</a>
				</div>
			`),BX.util.htmlspecialchars(this.link),BX.util.htmlspecialchars(this.getShortenLink(this.link)))}static checkPathes(e){return!!e.sectionLink||!!e.calendarPath}static showPopupWithPathesError(){BX.UI.Dialogs.MessageBox.alert(h.Loc.getMessage("EC_JS_ICAL_ERROR_WITH_PATHES"))}showPopupWithSyncDataError(){BX.UI.Dialogs.MessageBox.alert(h.Loc.getMessage("EC_EDEV_EXP_WARN"))}copyLink(e){window.BX.clipboard.copy(this.link)?babelHelpers.classPrivateFieldLooseBase(this,hn)[hn]():babelHelpers.classPrivateFieldLooseBase(this,pn)[pn]();e.preventDefault();e.stopPropagation()}getShortenLink(e){return e.length<this.LINK_LENGTH?e:e.substr(0,105)+"..."+e.slice(-7)}}function _n(){babelHelpers.classPrivateFieldLooseBase(this,un)[un](h.Loc.getMessage("EC_JS_ICAL_COPY_ICAL_SYNC_LINK_SUCCESS"))}function Cn(){babelHelpers.classPrivateFieldLooseBase(this,un)[un](h.Loc.getMessage("EC_JS_ICAL_COPY_ICAL_SYNC_LINK_FAILED"))}function vn(e){p.Util.showNotification(e)}class En{constructor(e={}){this.options=e}static createInstance(e){return new this(e)}loadExtension(){return new Promise((e=>{h.Runtime.loadExtension("ui.tour").then((t=>{if(t&&t["Guide"]&&t["Manager"]){e()}else{console.error(`Extension "ui.tour" not found`)}}))}))}show(){this.loadExtension().then((()=>{this.guide=new BX.UI.Tour.Guide({steps:[{target:this.getTarget(),title:h.Loc.getMessage("CAL_AFTER_SYNC_AHA_TITLE"),text:h.Loc.getMessage("CAL_AFTER_SYNC_AHA_TEXT")}],onEvents:true});this.guide.start()}))}getTarget(){let e;const t=this.options.view;const n=t.getContainer();if(t.getName()==="month"){e=n.querySelectorAll(".calendar-grid-today")[0]}else if(t.getName()==="day"||t.getName()==="week"){const t=p.Util.getDayCode(new Date);e=n.querySelector('div[data-bx-calendar-timeline-day="'+t+'"] .calendar-grid-cell-inner')}else{e=document.querySelector('span[data-role="addButton"]')}return e}}e.SyncPanel=Z;e.SyncPanelUnit=G;e.AuxiliarySyncPanel=b;e.GridUnit=se;e.ConnectionControls=he;e.MobileSyncBanner=pe;e.YandexTemplate=qt;e.CaldavTemplate=Re;e.MacTemplate=jt;e.ExchangeTemplate=Xe;e.GoogleTemplate=_t;e.IcloudTemplate=kt;e.OutlookTemplate=Kt;e.IphoneTemplate=cn;e.AndroidTemplate=on;e.IcalSyncPopup=gn;e.AfterSyncTour=En;e.GoogleSyncWizard=gt;e.Office365template=Ht;e.IcloudAuthDialog=Dt})(this.BX.Calendar.Sync.Interface=this.BX.Calendar.Sync.Interface||{},BX,BX,BX,BX.Calendar.Sync.Manager,BX.UI,BX.Calendar,BX,BX,BX.Event,BX.UI.Dialogs,BX,BX.Calendar,BX.Main);
//# sourceMappingURL=syncinterface.bundle.map.js