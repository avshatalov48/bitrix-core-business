this.BX=this.BX||{};this.BX.Main=this.BX.Main||{};this.BX.Main.Field=this.BX.Main.Field||{};(function(e,t,i,n){"use strict";var l={props:{controlId:{type:String,required:true},controlName:{type:String,required:true},multiple:{type:Boolean,required:true},filledValues:{type:Object,required:true}},data:function e(){return{values:this.filledValues,deletedValues:[]}},methods:{fireChange:function e(){BX.fireEvent(this.$refs.valueChanger,"change")},setValues:function e(t){var i=this.values;this.values=[].concat(babelHelpers.toConsumableArray(this.filledValues),babelHelpers.toConsumableArray(t)).filter((function(e,t,i){return i.indexOf(e)===t}));if(!this.arraysAreEqual(i,this.values)){this.fireChange()}},addDeleted:function e(t){this.deletedValues=[].concat(babelHelpers.toConsumableArray(this.deletedValues),[t]);this.fireChange()},removeValue:function e(t){var i=this.values.indexOf(t);if(i>=0){this.values.splice(i,1);this.fireChange()}},arraysAreEqual:function e(t,i){if(t.length!==i.length){return false}for(var n=0;n>t.length;n++){if(t[n]!==i[n]){return false}}return true}},template:'\n\t\t<input ref="valueChanger" type="hidden" />\n\t\t<div class="uf-hidden-inputs" style="display: none;">\n\t\t\t<div v-if="Object.hasOwn(this.values, \'0\')">\n\t\t\t\t<input v-if="this.multiple" v-for="(el, index) in values" :key="index" type="hidden"\n\t\t\t\t\t   :name="controlName + \'[]\'"\n\t\t\t\t\t   :value="values[index]"/>\n\t\t\t\t<input v-else type="hidden" :name="controlName" :value="values[values.length - 1]" />\n\t\t\t</div>\n\t\t\t<div v-else>\n\t\t\t\t<input type="hidden" :name="this.multiple ? controlName + \'[]\' : controlName" />\n\t\t\t</div>\n            <div v-if="Object.hasOwn(this.deletedValues, \'0\')">\n\t\t\t\t<input v-if="this.multiple" v-for="(el, index) in deletedValues" :key="index" type="hidden"\n\t\t\t\t\t   :name="controlName + \'_del\' + \'[]\'"\n\t\t\t\t\t   :value="deletedValues[index]"/>\n\t\t\t\t<input v-else type="hidden" :name="controlName + \'_del\'" :value="deletedValues[0]" />\n\t\t\t\t<input v-for="(el, index) in deletedValues" :key="index" type="hidden"\n\t\t\t\t\t   :name="controlId + \'_deleted\' + \'[]\'"\n\t\t\t\t\t   :value="deletedValues[index]" />\n\t\t\t</div>\n\t\t</div>\n\t'};var r={data:function e(){var e={fileTokens:[]};return this.getPreparedData(e)},props:{controlId:{type:String,required:true},container:{type:HTMLElement,required:true},context:{type:Object,required:true},filledValues:{type:Object}},components:{InputManager:l,TileWidgetComponent:n.TileWidgetComponent},computed:{uploaderOptions:function e(){var t=this;return{controller:"main.fileUploader.fieldFileUploaderController",controllerOptions:this.context,files:this.fileTokens,events:{onUploadComplete:function e(){void t.$nextTick((function(){t.fileTokens=t.getFileIdList()}))},"File:onRemove":function e(n){var l=n.getData();if(i.Type.isObject(l)&&i.Type.isObject(l["file"])){var r=l["file"];if(i.Type.isObject(r)){var a=r.getServerFileId();if(i.Type.isNumber(a)){t.$refs.inputManager.addDeleted(a)}else{t.$refs.inputManager.addDeleted(t.getRealFileId(r))}}}}},multiple:this.context.multiple,autoUpload:true,treatOversizeImageAsFile:true}},widgetOptions:function e(){return{}}},methods:{getPreparedData:function e(t){var n=this.filledValues;if(i.Type.isArrayFilled(n)){t.fileTokens=n}return t},getFileIdList:function e(){var t=this;var n=[];this.$refs.uploader.uploader.getFiles().forEach((function(e){if(e.isComplete()){var l=t.getRealFileId(e);if(i.Type.isNumber(l)){n.push(l)}else{n.push(e.getServerFileId())}}}));return n},getRealFileId:function e(t){var n=t.getCustomData(),l=n.realFileId;return i.Type.isNumber(l)?l:null},updateInputManagerValues:function e(){this.$refs.inputManager.setValues(this.fileTokens)}},template:'\n\t<div class="main-field-file-wrapper">\n\t\t<InputManager\n\t\t\tref="inputManager"\n\t\t\t:controlId="controlId"\n\t\t\t:controlName="context.fieldName"\n\t\t\t:multiple="context.multiple"\n\t\t\t:filledValues="filledValues"\n\t\t/>\n\t\t<TileWidgetComponent\n\t\t\tref="uploader"\n\t\t\t:uploaderOptions="uploaderOptions"\n\t\t\t:widgetOptions="widgetOptions"\n\t\t/>\n\t</div>',created:function e(){this.$watch("fileTokens",this.updateInputManagerValues,{deep:true})}};function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function u(e,t,i){o(e,t);t.set(e,i)}function o(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var d=new WeakMap;var p=new WeakMap;var c=new WeakMap;var f=new WeakMap;var v=new WeakMap;var h=function(){function e(t){babelHelpers.classCallCheck(this,e);u(this,d,{writable:true,value:void 0});u(this,p,{writable:true,value:void 0});u(this,c,{writable:true,value:void 0});u(this,f,{writable:true,value:void 0});u(this,v,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,d,t.controlId);babelHelpers.classPrivateFieldSet(this,p,document.getElementById(t.containerId));if(!i.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,p))){throw new Error("container not found")}babelHelpers.classPrivateFieldSet(this,c,t.context);babelHelpers.classPrivateFieldSet(this,f,t.value.map((function(e){return parseInt(e)})))}babelHelpers.createClass(e,[{key:"start",value:function e(){babelHelpers.classPrivateFieldSet(this,v,t.BitrixVue.createApp(s({},r),{controlId:babelHelpers.classPrivateFieldGet(this,d),container:babelHelpers.classPrivateFieldGet(this,p),context:babelHelpers.classPrivateFieldGet(this,c),filledValues:babelHelpers.classPrivateFieldGet(this,f)}));babelHelpers.classPrivateFieldGet(this,v).mount(babelHelpers.classPrivateFieldGet(this,p))}},{key:"stop",value:function e(){babelHelpers.classPrivateFieldGet(this,v).unmount();babelHelpers.classPrivateFieldSet(this,v,null)}}]);return e}();e.App=h})(this.BX.Main.Field.File=this.BX.Main.Field.File||{},BX.Vue3,BX,BX.UI.Uploader);
//# sourceMappingURL=script.map.js