this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,t,i,s,o){"use strict";const n=50;class l{static getTypes(){return Object.freeze({string:"string",enumeration:"enumeration",date:"date",datetime:"datetime",address:"address",url:"url",file:"file",money:"money",boolean:"boolean",double:"double",employee:"employee",crm:"crm",crmStatus:"crm_status"})}static getDescriptions(){return Object.freeze({string:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_STRING_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_STRING_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_STRING_LABEL")},enumeration:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUM_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUM_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUMERATION_LABEL")},date:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATE_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATE_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATE_LABEL")},datetime:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATETIME_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATETIME_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DATETIME_LABEL")},address:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ADDRESS_TITLE_2"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ADDRESS_LEGEND_2")},url:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_URL_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_URL_LEGEND")},file:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_FILE_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_FILE_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_FILE_LABEL")},money:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_MONEY_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_MONEY_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_MONEY_LABEL")},boolean:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_BOOLEAN_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_BOOLEAN_LEGEND")},double:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DOUBLE_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DOUBLE_LEGEND"),defaultTitle:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_DOUBLE_LABEL")},employee:{title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_EMPLOYEE_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_EMPLOYEE_LEGEND")}})}static getCustomTypeDescription(){return Object.freeze({name:"custom",title:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_CUSTOM_TITLE"),description:s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_CUSTOM_LEGEND")})}}const r=Object.freeze({multiple:"N",mandatory:"N",userTypeId:l.string,showFilter:"E",showInList:"Y",settings:{},isSearchable:"N"});const a=Object.freeze({file:{showFilter:"N",showInList:"N"},employee:{showFilter:"I"},crm:{showFilter:"I"},crm_status:{showFilter:"I"},enumeration:{settings:{DISPLAY:"UI"}},double:{settings:{PRECISION:2}}});let c=e=>e,u,d,h,p,g;const E=3;var F=babelHelpers.classPrivateFieldLooseKey("enableScrollToBottom");var T=babelHelpers.classPrivateFieldLooseKey("enableScrollToTop");class m{constructor(e,t,i){Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});this.id=e;this.items=t;this.params={};if(s.Type.isPlainObject(i)){this.params=i}}getId(){if(!this.id){return"ui-user-field-factory-menu"}return this.id}getPopup(e=null){if(!this.popup){let e={...m.getDefaultPopupOptions(),...this.params};e.events={onPopupShow:this.onPopupShow.bind(this),onPopupDestroy:this.onPopupDestroy.bind(this)};e.id=this.getId();this.popup=new i.Popup(e)}this.popup.setContent(this.render(e));return this.popup}static getDefaultPopupOptions(){return{autoHide:true,draggable:false,offsetLeft:0,offsetTop:0,noAllPaddings:true,bindOptions:{forceBindPosition:true},closeByEsc:true,cacheable:false}}open(e){const t=this.getPopup(e);if(!t.isShown()){t.show()}}render(e){if(!this.container){this.container=s.Tag.render(u||(u=c`<div class="ui-userfieldfactory-creation-menu-container"></div>`));const t='<svg xmlns="http://www.w3.org/2000/svg" width="42" height="13" viewBox="0 0 42 13">\n'+'  <polyline fill="none" stroke="#CACDD1" stroke-width="2" points="274 98 284 78.614 274 59" transform="rotate(90 186 -86.5)" stroke-linecap="round" stroke-linejoin="round"/>\n'+"</svg>\n";this.topScrollButton=s.Tag.render(d||(d=c`<div class="ui-userfieldfactory-creation-menu-scroll-top">${0}</div>`),t);this.bottomScrollButton=s.Tag.render(h||(h=c`<div class="ui-userfieldfactory-creation-menu-scroll-bottom">${0}</div>`),t);this.container.appendChild(this.topScrollButton);this.container.appendChild(this.bottomScrollButton);this.container.appendChild(this.renderList(e))}return this.container}renderList(e){if(!this.containerList){this.containerList=s.Tag.render(p||(p=c`<div class="ui-userfieldfactory-creation-menu-list"></div>`));this.items.forEach((t=>{this.containerList.appendChild(this.renderItem(t,e))}))}return this.containerList}renderItem(e,t){return s.Tag.render(g||(g=c`<div class="ui-userfieldfactory-creation-menu-item" onclick="${0}">
			<div class="ui-userfieldfactory-creation-menu-item-title">${0}</div>
			<div class="ui-userfieldfactory-creation-menu-item-desc">${0}</div>
		</div>`),(()=>{this.handleItemClick(e,t)}),e.title,e.description)}handleItemClick(e,t){if(s.Type.isFunction(e.onClick)){e.onClick(e.name)}else if(s.Type.isFunction(t)){t(e.name)}this.getPopup().close()}onPopupShow(){s.Event.bind(this.bottomScrollButton,"mouseover",this.onBottomButtonMouseOver.bind(this));s.Event.bind(this.bottomScrollButton,"mouseout",this.onBottomButtonMouseOut.bind(this));s.Event.bind(this.topScrollButton,"mouseover",this.onTopButtonMouseOver.bind(this));s.Event.bind(this.topScrollButton,"mouseout",this.onTopButtonMouseOut.bind(this));s.Event.bind(this.containerList,"scroll",this.onScroll.bind(this));window.setTimeout(this.adjust.bind(this),100)}onPopupDestroy(){s.Event.unbind(this.bottomScrollButton,"mouseover",this.onBottomButtonMouseOver.bind(this));s.Event.unbind(this.bottomScrollButton,"mouseout",this.onBottomButtonMouseOut.bind(this));s.Event.unbind(this.topScrollButton,"mouseover",this.onTopButtonMouseOver.bind(this));s.Event.unbind(this.topScrollButton,"mouseout",this.onTopButtonMouseOut.bind(this));s.Event.unbind(this.containerList,"scroll",this.onScroll.bind(this));this.container=null;this.containerList=null;this.topScrollButton=null;this.bottomScrollButton=null;this.popup=null}onBottomButtonMouseOver(){if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=true;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=false;(function e(){if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F]){return}if(this.containerList.scrollTop+this.containerList.offsetHeight!==this.containerList.scrollHeight){this.containerList.scrollTop+=E}if(this.containerList.scrollTop+this.containerList.offsetHeight===this.containerList.scrollHeight){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=false}else{window.setTimeout(e.bind(this),20)}}).bind(this)()}onBottomButtonMouseOut(){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=false}onTopButtonMouseOver(){if(babelHelpers.classPrivateFieldLooseBase(this,T)[T]){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=false;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=true;(function e(){if(!babelHelpers.classPrivateFieldLooseBase(this,T)[T]){return}if(this.containerList.scrollTop>0){this.containerList.scrollTop-=E}if(this.containerList.scrollTop===0){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=false}else{window.setTimeout(e.bind(this),20)}}).bind(this)()}onTopButtonMouseOut(){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=false}onScroll(){this.adjust()}adjust(){const e=this.containerList.offsetHeight;const t=this.containerList.scrollTop;const i=this.containerList.scrollHeight;if(t===0){s.Dom.hide(this.topScrollButton)}else{s.Dom.show(this.topScrollButton)}if(t+e===i){s.Dom.hide(this.bottomScrollButton)}else{s.Dom.show(this.bottomScrollButton)}}}class _{constructor(e=null,t=null){this.value=e;this.id=t}setNode(e){this.node=e}getId(){return this.id}getNode(){return this.node}getInput(){const e=this.getNode();if(!e){return null}if(e instanceof HTMLInputElement){return e}return e.querySelector("input")}getValue(){const e=this.getInput();if(e&&e.value){return e.value}return this.value||""}}let f=e=>e,L,I,U,b,y,v,C,S,D,R,O,B,M,A,k,N,Y,w,P;class x{constructor(e){if(s.Type.isPlainObject(e)){if(e.userField){this.userField=e.userField}if(s.Type.isFunction(e.onSave)){this.onSave=e.onSave}if(s.Type.isFunction(e.onCancel)){this.onCancel=e.onCancel}this.canMultipleFields=true;if(s.Type.isBoolean(e.canMultipleFields)){this.canMultipleFields=e.canMultipleFields}this.canRequiredFields=true;if(s.Type.isBoolean(e.canRequiredFields)){this.canRequiredFields=e.canRequiredFields}}this.enumItems=new Set}render(){this.node=s.Tag.render(L||(L=f`<div class="ui-userfieldfactory-configurator"></div>`));this.labelInput=s.Tag.render(I||(I=f`<input class="ui-ctl-element" type="text" placeholder="${0}" />`),s.Text.encode(this.userField.getTitle()));this.node.appendChild(s.Tag.render(U||(U=f`<div class="ui-userfieldfactory-configurator-block">
			<div class="ui-userfieldfactory-configurator-title">
				<span class="ui-userfieldfactory-configurator-title-text">${0}</span>
			</div>
			<div class="ui-userfieldfactory-configurator-content">
				<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">
					${0}
				</div>
			</div>
		</div>`),s.Loc.getMessage("UI_USERFIELD_FACTORY_CONFIGURATOR_FIELD_TITLE"),this.labelInput));if(this.userField.getUserTypeId()===l.getTypes().enumeration){this.node.appendChild(this.renderEnumeration())}this.node.appendChild(this.renderOptions());const e=e=>{e.preventDefault();if(s.Type.isFunction(this.onSave)){this.onSave(this.saveField())}};const t=e=>{e.preventDefault();if(s.Type.isFunction(this.onCancel)){this.onCancel()}else{this.node.style.display="none"}};this.saveButton=s.Tag.render(b||(b=f`<span class="ui-btn ui-btn-primary" onclick="${0}">${0}</span>`),e.bind(this),s.Loc.getMessage("UI_USERFIELD_SAVE"));this.cancelButton=s.Tag.render(y||(y=f`<span class="ui-btn ui-btn-light-border" onclick="${0}">${0}</span>`),t.bind(this),s.Loc.getMessage("UI_USERFIELD_CANCEL"));this.node.appendChild(s.Tag.render(v||(v=f`<div class="ui-userfieldfactory-configurator-block">
			${0}${0}
		</div>`),this.saveButton,this.cancelButton));return this.node}saveField(){if(this.timeCheckbox){if(this.timeCheckbox.checked){this.userField.setUserTypeId(l.getTypes().datetime)}else{this.userField.setUserTypeId(l.getTypes().date)}}if(this.multipleCheckbox){this.userField.setIsMultiple(this.multipleCheckbox.checked)}if(this.mandatoryCheckbox){this.userField.setIsMandatory(this.mandatoryCheckbox.checked)}this.userField.setTitle(this.labelInput.value);this.saveEnumeration(this.userField,this.enumItems);return this.userField}renderEnumeration(){this.enumItemsContainer=s.Tag.render(C||(C=f`<div class="ui-userfieldfactory-configurator-block"></div>`));this.enumAddItemContainer=s.Tag.render(S||(S=f`<div class="ui-userfieldfactory-configurator-block-add-field">
			<span class="ui-userfieldfactory-configurator-add-button" onclick="${0}">${0}</span>
		</div>`),(()=>{this.addEnumInput().focus()}),s.Loc.getMessage("UI_USERFIELD_ADD"));this.enumContainer=s.Tag.render(D||(D=f`<div class="ui-userfieldfactory-configurator-block">
			<div class="ui-userfieldfactory-configurator-title">
				<span class="ui-userfieldfactory-configurator-title-text">${0}</span>
			</div>
			${0}
			${0}
		</div>`),s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENUM_ITEMS"),this.enumItemsContainer,this.enumAddItemContainer);this.userField.getEnumeration().forEach((e=>{this.addEnumInput(e)}));this.addEnumInput();return this.enumContainer}addEnumInput(e){let t;if(s.Type.isPlainObject(e)){t=new _(e.value,e.id)}else{t=new _}const i=s.Tag.render(R||(R=f`<div style="margin-bottom: 10px;" class="ui-ctl ui-ctl-textbox ui-ctl-w100 ui-ctl-row">
			<input class="ui-ctl-element" type="text" value="${0}">
			<div class="ui-userfieldfactory-configurator-remove-enum" onclick="${0}"></div>
		</div>`),s.Text.encode(t.getValue()),(e=>{e.preventDefault();this.deleteEnumItem(t)}));t.setNode(i);this.enumItems.add(t);this.enumItemsContainer.appendChild(i);return i}deleteEnumItem(e){this.enumItemsContainer.removeChild(e.getNode());this.enumItems.delete(e)}renderOptions(){this.optionsContainer=s.Tag.render(O||(O=f`<div class="ui-userfieldfactory-configurator-block"></div>`));if(this.canRequiredFields){this.mandatoryCheckbox=s.Tag.render(B||(B=f`<input class="ui-ctl-element" type="checkbox">`));this.mandatoryCheckbox.checked=this.userField.isMandatory();this.optionsContainer.appendChild(s.Tag.render(M||(M=f`<div>
				<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">
					${0}
					<div class="ui-ctl-label-text">${0}</div>
				</label>
			</div>`),this.mandatoryCheckbox,s.Loc.getMessage("UI_USERFIELD_FACTORY_FIELD_REQUIRED")))}if(!this.userField.isSaved()&&(this.userField.getUserTypeId()===l.getTypes().date||this.userField.getUserTypeId()===l.getTypes().datetime)){this.timeCheckbox=s.Tag.render(A||(A=f`<input class="ui-ctl-element" type="checkbox">`));this.timeCheckbox.checked=this.userField.getUserTypeId()===l.getTypes().datetime;const e=s.Tag.render(k||(k=f`
				<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">
					${0}
				</label>
			`),this.timeCheckbox);if(this.userField.getUserTypeId()===l.getTypes().datetime){s.Dom.append(s.Tag.render(N||(N=f`<div className="ui-ctl-label-text">${0}</div>`),s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_ENABLE_TIME")),e)}this.optionsContainer.appendChild(s.Tag.render(Y||(Y=f`<div>
				
			</div>`)))}if(!this.userField.isSaved()&&this.userField.getUserTypeId()!==l.getTypes().boolean&&this.canMultipleFields){this.multipleCheckbox=s.Tag.render(w||(w=f`<input class="ui-ctl-element" type="checkbox">`));this.multipleCheckbox.checked=this.userField.isMultiple();this.optionsContainer.appendChild(s.Tag.render(P||(P=f`<div>
				<label class="ui-ctl ui-ctl-checkbox ui-ctl-xs">
					${0}
					<div class="ui-ctl-label-text">${0}</div>
				</label>
			</div>`),this.multipleCheckbox,s.Loc.getMessage("UI_USERFIELD_FACTORY_FIELD_MULTIPLE")))}return this.optionsContainer}saveEnumeration(e,t){const i=[];let s=100;t.forEach((e=>{i.push({value:e.getValue(),sort:s,id:e.getId()});s+=100}));e.setEnumeration(i)}}class ${constructor(e,i={}){t.EventEmitter.makeObservable(this,"BX.UI.UserFieldFactory.Factory");this.configuratorClass=x;if(s.Type.isString(e)&&e.length>0){this.entityId=e}if(s.Type.isPlainObject(i)){if(s.Type.isString(i.menuId)){this.menuId=i.menuId}if(!s.Type.isArray(i.types)){i.types=[]}if(s.Type.isDomNode(i.bindElement)){this.bindElement=i.bindElement}this.moduleId=i.moduleId;this.setCustomTypesUrl(i.customTypesUrl).setConfiguratorClass(i.configuratorClass)}else{i.types=[]}this.types=this.getFieldTypes().concat(i.types)}getFieldTypes(){const e=[];Object.keys(l.getDescriptions()).forEach((t=>{e.push({...l.getDescriptions()[t],...{name:t}})}));this.emit("OnGetUserTypes",{types:e});return e}getMenu(e){if(!s.Type.isPlainObject(e)){e={}}if(!s.Type.isDomNode(e.bindElement)){e.bindElement=this.bindElement}const t=this.types;if(this.customTypesUrl&&!this.isCustomTypeAdded){const e={...l.getCustomTypeDescription()};e.onClick=this.onCustomTypeClick.bind(this);t.push(e);this.isCustomTypeAdded=true}if(!this.menu){this.menu=new m(this.menuId,t,e)}return this.menu}setConfiguratorClass(e){let t=null;if(s.Type.isString(e)){t=s.Reflection.getClass(e)}else if(s.Type.isFunction(e)){t=e}if(s.Type.isFunction(t)&&t.prototype instanceof x){this.configuratorClass=t}}setCustomTypesUrl(e){this.customTypesUrl=e;return this}getConfigurator(e){return new this.configuratorClass(e)}createUserField(e,t){let i={...r,...a[e],...{userTypeId:e}};if(!s.Type.isString(t)||t.length<=0||t.length>n){t=this.generateFieldName()}i.fieldName=t;i.entityId=this.entityId;const l=new o.UserField(i,{moduleId:this.moduleId});l.setTitle(this.getDefaultLabel(e));this.emit("onCreateField",{userField:l});return l}getDefaultLabel(e){let t=s.Loc.getMessage("UI_USERFIELD_FACTORY_UF_LABEL");this.types.forEach((i=>{if(i.name===e&&s.Type.isString(i.defaultTitle)){t=i.defaultTitle}}));return t}generateFieldName(){let e="UF_"+(this.entityId?this.entityId+"_":"");let t=(new Date).getTime().toString();if(e.length+t.length>n){t=t.substr(e.length+t.length-n)}e+=t;return e}onCustomTypeClick(){if(!this.customTypesUrl){return}BX.SidePanel.Instance.open(this.customTypesUrl.toString(),{cacheable:false,allowChangeHistory:false,width:900,events:{onClose:e=>{const t=e.getSlider();if(t){const e=t.getData().get("userFieldData");if(e){const t=o.UserField.unserialize(e);this.emit("onCreateCustomUserField",{userField:t})}}}}})}}e.Factory=$;e.FieldTypes=l;e.Configurator=x})(this.BX.UI.UserFieldFactory=this.BX.UI.UserFieldFactory||{},BX.Event,BX.Main,BX,BX.UI.UserField);
//# sourceMappingURL=userfieldfactory.bundle.map.js