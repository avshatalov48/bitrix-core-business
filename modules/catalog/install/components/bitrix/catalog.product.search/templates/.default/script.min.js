BX.namespace("BX.Catalog");BX.Catalog.ProductSearchDialog=function(){var e=function(e){this.callback=null;this.event=null;this.tableId=e.tableId;if(typeof e.event!=="undefined"){this.event=e.event}else if(typeof e.callback!=="undefined"){this.callback=e.callback}this.callerName=e.callerName;this.currentUri=e.currentUri;this.popup=e.popup;this.iblockName=e.iblockName;this.searchTimer=null;this.ignoreFilter=true;var t=this,n=function(e){var a=!!BX(t.tableId+"_reload_container");if(a){if(!e.altKey&&!e.ctrlKey&&!e.metaKey&&document.activeElement.tagName!="INPUT"&&document.activeElement.tagName!="SELECT"&&document.activeElement.tagName!="TEXTAREA"){if(e.keyCode>=48&&e.keyCode<=90||e.keyCode>=96&&e.keyCode<=105||e.keyCode==219||e.keyCode==221){BX(t.tableId+"_query").focus()}}}else if(document.removeEventListener)document.removeEventListener("keydown",n);else document.detachEvent("onkeydown",n)};if(document.addEventListener)document.addEventListener("keydown",n);else if(document.attachEvent)document.attachEvent("onkeydown",n)};e.prototype.getIblockId=function(){return BX(this.tableId+"_iblock").value};e.prototype.getForm=function(){return BX(this.tableId+"_form")};e.prototype.SelEl=function(e,t){BX.removeClass(t,"row-sku-selected");if(typeof e["quantity"]==="undefined")e["quantity"]=1;var n=BX(this.tableId+"_qty_"+e["id"]);if(!!n)e["quantity"]=n.value;if(!!this.event){if(typeof e.IBLOCK_ID==="undefined")e.IBLOCK_ID=this.getIblockId();BX.onCustomEvent(this.event,[e])}else if(!!this.callback){window[this.callback](e,this.getIblockId())}};e.prototype.fShowSku=function(e,t){var n,a,i=BX.hasClass(t,"is-expand");if(!BX.type.isArray(e)||e.length<1)return false;for(n=0;n<e.length;n++){a=BX(this.tableId+"_sku-"+e[n]);if(BX.type.isElementNode(a)){if(!i)BX.show(a.parentNode.parentNode);else BX.hide(a.parentNode.parentNode)}a=null}BX.toggleClass(t,"is-expand");return false};e.prototype.onSubmitForm=function(){var e=this.buildUrl();window[this.tableId].GetAdminList(e);return false};e.prototype.onSearch=function(e,t){var n=BX(this.tableId+"_query_value"),a=n.value;if(a==e)return false;n.value=e;var i=this;if(this.searchTimer!=null)clearTimeout(this.searchTimer);this.searchTimer=setTimeout(function(){if(e.length==0||e.length>2){i.onSubmitForm()}BX(i.tableId+"_query_clear").style.display=e.length==0?"none":"inline";BX(i.tableId+"_query_clear_separator").style.display=e.length==0?"none":"inline-block";i.searchTimer=null},t||300);return true};e.prototype.clearQuery=function(){var e=BX(this.tableId+"_query"),t=e.value;e.value="";if(t.length>2)this.onSearch("",10);return false};e.prototype.onIblockChange=function(e,t){var n=this,a=this.buildUrl({action:"change_iblock",IBLOCK_ID:e,SECTION_ID:0});if(t)n.iblockName=t;BX.ajax.get(a,null,BX.proxy(function(e){BX(n.tableId+"_reload_container").innerHTML=e},this));BX(this.tableId+"_section_label").style.display="none";return false};e.prototype.onSectionClick=function(e,t){BX(this.tableId+"_section_id").value=e;this.onSubmitForm();var n=BX.findChildren(BX(this.tableId+"_catalog_tree_wrap"),{className:"adm-submenu-item-active"},true);BX.removeClass(n[0],"adm-submenu-item-active");var a=BX(this.tableId+"_section_"+e);if(a){BX.addClass(a.parentNode,"adm-submenu-item-active");if(!BX.hasClass(a.parentNode,"adm-sub-submenu-open")){var i=BX.findChild(a,{className:"adm-submenu-item-arrow"});if(i)i.click()}}if(!t&&a){var o=BX.findChild(BX(this.tableId+"_section_"+e).parentNode,{className:"adm-submenu-item-name-link-text"},true);t=o.innerHTML}var l=BX(this.tableId+"_section_label");l.innerHTML=e!="0"?t+' <span class="adm-s-search-tag-del" onclick="return '+this.tableId+'_helper.onSectionClick(0)"></span>':"";l.style.display=e!="0"?"inline-block":"none";return false};e.prototype.toggleSection=function(e){var t=!BX.hasClass(e,"adm-sub-submenu-open");BX[t?"addClass":"removeClass"](e,"adm-sub-submenu-open");return t};e.prototype.toggleDynSection=function(e,t,n,a,i){var o=BX.findChild(t,{className:"adm-sub-submenu-block-children"});if(o.hasChildNodes()){this.toggleSection(t,n,a);return}var l=false;var r=BX.create("SPAN",{props:{className:"adm-submenu-loading adm-sub-submenu-block"},style:{marginLeft:parseInt(e)+"px"},text:BX.message("JS_CORE_LOADING")});setTimeout(BX.proxy(function(){if(!l){o.appendChild(r);this.toggleSection(t,n,a)}},this),200);var s=this,c=this.currentUri+"?action=open_section&lang="+BX.message("LANGUAGE_ID")+"&section_id="+n+"&IBLOCK_ID="+s.getIblockId()+"&caller="+this.callerName+"&level="+a+"&active_id="+(i?i:0);BX.ajax.get(c,BX.proxy(function(e){l=true;e=BX.util.trim(e);if(e!=""){var i=r.parentNode?true:false;o.innerHTML=e;if(!i)this.toggleSection(t,n,a)}else{r.innerHTML=BX.message("JS_CORE_NO_DATA");if(!r.parentNode){o.appendChild(r);this.toggleSection(t,n,a)}}},this))};e.prototype.openBranchByPath=function(e){var t=e.pop();for(var n=0;n<e.length;++n){var a=BX(this.tableId+"_section_"+e[n]);if(a){var i=parseInt(a.getAttribute("data-level"))+1,o=a.getAttribute("data-offset"),l=a.parentNode;if(BX.hasClass(l,"adm-sub-submenu-open"))continue;var r=BX.findChild(l,{className:"adm-sub-submenu-block-children"});if(r.hasChildNodes()){this.toggleSection(l,e[n],i)}else{this.toggleDynSection(o,l,e[n],i,t);break}}}};e.prototype.setBreadcrumbs=function(e){var t=this.iblockName,n=['<a class="adm-navchain-item adm-navchain-item-desktop" href="#" onclick="return '+this.tableId+'_helper.onSectionClick(0)">'+BX.util.htmlspecialchars(t)+"</a>"],a=[];for(var i in e){if(e.hasOwnProperty(i)){a.push(e[i].ID);n.push('<a class="adm-navchain-item adm-navchain-item-desktop" href="#" onclick="return '+this.tableId+"_helper.onSectionClick("+e[i].ID+')">'+BX.util.htmlspecialchars(e[i].NAME)+"</a>");t=e[i].NAME}}this.popup.SetTitle(BX.util.htmlspecialcharsback(t));BX(this.tableId+"_breadcrumbs").innerHTML=n.join('<span class="adm-navchain-delimiter"></span>');this.openBranchByPath(a)};e.prototype.setIgnoreFilter=function(e){this.ignoreFilter=!!e};e.prototype.buildUrl=function(e){var t=BX.ajax.prepareForm(this.getForm()),n=[],a;for(a in t.data){if(t.data.hasOwnProperty(a)&&t.data[a]){if(this.ignoreFilter&&a.indexOf("filter_")===0)continue;n.push(encodeURIComponent(a)+"="+encodeURIComponent(t.data[a]))}}if(BX.type.isPlainObject(e)){for(a in e){if(e.hasOwnProperty(a)&&e[a]){n.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]))}}}return this.currentUri+"?"+n.join("&",n)};return e}();
//# sourceMappingURL=script.map.js