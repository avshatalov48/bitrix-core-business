this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,s,t,l,a,i,r,o){"use strict";let d=e=>e,n,c,b,h,v;const p="sender";const u="mailbox";const L="S";const P="MB";var f=babelHelpers.classPrivateFieldLooseKey("container");var m=babelHelpers.classPrivateFieldLooseKey("senderButton");var I=babelHelpers.classPrivateFieldLooseKey("senderButtonTextNode");var g=babelHelpers.classPrivateFieldLooseKey("loader");var B=babelHelpers.classPrivateFieldLooseKey("isListUpdated");var H=babelHelpers.classPrivateFieldLooseKey("isSenderAvailable");var y=babelHelpers.classPrivateFieldLooseKey("createLoader");var F=babelHelpers.classPrivateFieldLooseKey("renderContainer");var S=babelHelpers.classPrivateFieldLooseKey("createSelector");var D=babelHelpers.classPrivateFieldLooseKey("updateDialog");var E=babelHelpers.classPrivateFieldLooseKey("loadItems");var _=babelHelpers.classPrivateFieldLooseKey("updateSenderList");var w=babelHelpers.classPrivateFieldLooseKey("addSender");var C=babelHelpers.classPrivateFieldLooseKey("showLoader");var O=babelHelpers.classPrivateFieldLooseKey("hideLoader");var $=babelHelpers.classPrivateFieldLooseKey("getSelectorSenderId");var N=babelHelpers.classPrivateFieldLooseKey("getSenderTypeByItemId");class T{constructor(e){var s,t;Object.defineProperty(this,N,{value:W});Object.defineProperty(this,$,{value:V});Object.defineProperty(this,O,{value:x});Object.defineProperty(this,C,{value:U});Object.defineProperty(this,w,{value:A});Object.defineProperty(this,_,{value:X});Object.defineProperty(this,E,{value:R});Object.defineProperty(this,D,{value:M});Object.defineProperty(this,S,{value:k});Object.defineProperty(this,F,{value:K});Object.defineProperty(this,y,{value:j});Object.defineProperty(this,f,{writable:true,value:null});Object.defineProperty(this,m,{writable:true,value:null});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:true});Object.defineProperty(this,H,{writable:true,value:false});this.sender=((s=e.fieldValue)==null?void 0:s.length)>0?e.fieldValue:null;this.fieldId=e.fieldId;this.fieldName=e.fieldName;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=(t=e.isSenderAvailable)!=null?t:false;babelHelpers.classPrivateFieldLooseBase(this,f)[f]=this.fieldId&&this.fieldName?babelHelpers.classPrivateFieldLooseBase(this,F)[F]():null;babelHelpers.classPrivateFieldLooseBase(this,y)[y]();babelHelpers.classPrivateFieldLooseBase(this,S)[S]();this.selectCallback=e.selectCallback;this.mailboxes=e.mailboxes;if(this.mailboxes){babelHelpers.classPrivateFieldLooseBase(this,D)[D](this.mailboxes)}}render(){return babelHelpers.classPrivateFieldLooseBase(this,f)[f]}renderTo(e){if(s.Type.isDomNode(e)){s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,f)[f],e)}}setSender(e=null,t=null,l=null,a=p){const i=a===u?P:L;this.selectedItemId=e?`${i}_${e}`:null;const r=t;const o=l;let d="";if(r&&o){d=`${r} <${o}>`}if(this.selectCallback&&!babelHelpers.classPrivateFieldLooseBase(this,f)[f]){this.selectCallback(d,"");return}if(!babelHelpers.classPrivateFieldLooseBase(this,f)[f]){return}const n=babelHelpers.classPrivateFieldLooseBase(this,f)[f].querySelector("input");this.sender=d;babelHelpers.classPrivateFieldLooseBase(this,I)[I].innerText=d.length>0?d:s.Loc.getMessage("UI_MAIL_SENDER_SLIDER_SELECTOR_SELECT_NEW_SENDER");babelHelpers.classPrivateFieldLooseBase(this,I)[I].title=this.sender;s.Dom.append(this.icon,babelHelpers.classPrivateFieldLooseBase(this,m)[m]);n.value=d}showDialog(e=null,s=null){if(!babelHelpers.classPrivateFieldLooseBase(this,B)[B]){return}if(!this.senderDialog||this.senderDialog.getItems().length===0){this.showProviderShowcase();return}if(e){this.senderDialog.setTargetNode(e)}this.senderDialog.show()}showProviderShowcase(e){this.addSenderCallback=e;i.ProviderShowcase.openSlider({isSender:babelHelpers.classPrivateFieldLooseBase(this,H)[H],addSenderCallback:e,setSenderCallback:(e,s,t)=>{this.setSender(e,s,t)},updateSenderList:()=>{void babelHelpers.classPrivateFieldLooseBase(this,_)[_]()}})}}function j(){babelHelpers.classPrivateFieldLooseBase(this,g)[g]=new l.Loader({target:babelHelpers.classPrivateFieldLooseBase(this,m)[m],size:17,mode:"inline"})}function K(){var e,t,l;const a=new o.Icon({icon:o.Actions.CHEVRON_DOWN,color:getComputedStyle(document.body).getPropertyValue("--ui-color-base-80"),size:16});this.icon=a.render();babelHelpers.classPrivateFieldLooseBase(this,I)[I]=s.Tag.render(n||(n=d`
			<div class="sender-selector-button-text" title="${0}">
				${0}
			</div>
		`),(e=this.sender)!=null?e:"",(t=this.sender)!=null?t:s.Loc.getMessage("UI_MAIL_SENDER_SLIDER_SELECTOR_SELECT_NEW_SENDER"));babelHelpers.classPrivateFieldLooseBase(this,m)[m]=s.Tag.render(c||(c=d`
			<div class="sender-selector-button">
				${0}
				${0}
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,I)[I],this.icon);const{root:i,senderInput:r}=s.Tag.render(b||(b=d`
			<div>
				${0}
				<input type="hidden"
					id="${0}"
					name="${0}"
					value="${0}"
					ref="senderInput">
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,m)[m],this.fieldId,this.fieldName,(l=this.sender)!=null?l:"");this.senderInput=r;return i}function k(){const e=()=>{this.senderDialog.hide();this.showProviderShowcase()};const t=s.Tag.render(h||(h=d`
			<span class="ui-selector-footer-link ui-selector-footer-link-add" onclick="${0}">${0}</span>
		`),e,s.Loc.getMessage("UI_MAIL_SENDER_SLIDER_SELECTOR_ADD_NEW_MAILBOX"));const l=e=>{const s=e.data;s.event.preventDefault();const t=s.node.getItem();const l=t.getDialog();l.hide();const a=t.getCustomData();if(t.entityId===u){BX.SidePanel.Instance.open(a.get("href"),{width:760,cacheable:false,events:{onClose:()=>{this.setSender();void babelHelpers.classPrivateFieldLooseBase(this,_)[_]()}}});return}r.AliasEditor.openSlider({senderId:a.get("id"),email:a.get("email"),setSenderCallback:(e,s,t)=>{this.setSender(e,s,t)},updateSenderList:()=>{void babelHelpers.classPrivateFieldLooseBase(this,_)[_]()}})};this.senderDialog=new a.Dialog({targetNode:babelHelpers.classPrivateFieldLooseBase(this,m)[m],width:400,height:300,multiple:false,enableSearch:true,footer:t,dropdownMode:true,showAvatars:false,compactView:true,events:{"Item:onSelect":e=>{const{item:s}=e.getData();const t=s.getCustomData().get("name");const l=s.getCustomData().get("email");this.setSender(s.id,t,l)},"ItemNode:onLinkClick":l}});s.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,m)[m],"click",(()=>{this.showDialog()}))}function M(e){this.senderDialog.removeItems();const t=s.Tag.unsafe(v||(v=d`${0}`),this.sender);e.forEach((e=>{if(e.id){babelHelpers.classPrivateFieldLooseBase(this,w)[w](e);if(!this.selectedItemId&&t===`${e.name} <${e.email}>`){this.selectedItemId=babelHelpers.classPrivateFieldLooseBase(this,$)[$](e.id,e.type)}}}));if(this.selectedItemId){const e=this.senderDialog.getItem({id:this.selectedItemId,entityId:babelHelpers.classPrivateFieldLooseBase(this,N)[N](this.selectedItemId)});e==null?void 0:e.select()}else{const e=this.senderDialog.getItems();if(e.length>0){this.setSender(e[0].id,e[0].getCustomData().get("name"),e[0].getCustomData().get("email"));e[0].select();this.selectedItemId=e[0].id}}}function R(){return s.ajax.runAction("main.api.mail.sender.getAvailableSenders",{}).then((e=>e.data)).catch((()=>[]))}async function X(){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=false;babelHelpers.classPrivateFieldLooseBase(this,C)[C]();this.senderDialog.removeItems();try{const e=await babelHelpers.classPrivateFieldLooseBase(this,E)[E]();if(e){babelHelpers.classPrivateFieldLooseBase(this,D)[D](e)}}catch{}babelHelpers.classPrivateFieldLooseBase(this,O)[O]();babelHelpers.classPrivateFieldLooseBase(this,B)[B]=true}function A(e){const t=`${e.name} <${e.email}>`;const l=babelHelpers.classPrivateFieldLooseBase(this,$)[$](e.id,e.type);const a=e.type===u?e.editHref:e.id;this.senderDialog.addItem({id:l,tabs:"recents",entityId:e.type===u?u:p,link:a?"#":null,deselectable:false,linkTitle:s.Loc.getMessage("UI_MAIL_SENDER_SLIDER_SELECTOR_ITEM_LINK_TITLE"),title:t,customData:{name:e.name,email:e.email,id:e.id,formated:e.formated,href:a}})}function U(){babelHelpers.classPrivateFieldLooseBase(this,g)[g].show();s.Dom.style(this.icon,"display","none")}function x(){babelHelpers.classPrivateFieldLooseBase(this,g)[g].hide();s.Dom.style(this.icon,"display","block")}function V(e,s){return s===u?`${P}_${e}`:`${L}_${e}`}function W(e){const s=e.split("_")[0];switch(s){case L:return p;case P:return u;default:return""}}e.SenderSelector=T})(this.BX.UI.Mail=this.BX.UI.Mail||{},BX,BX.Event,BX,BX.UI.EntitySelector,BX.UI.Mail,BX.UI.Mail,BX.UI.IconSet);
//# sourceMappingURL=sender-selector.bundle.map.js