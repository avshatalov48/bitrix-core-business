this.BX=this.BX||{};this.BX.Socialnetwork=this.BX.Socialnetwork||{};(function(e,t,i,s,o,a){"use strict";var n=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"htmlWasInserted",false);babelHelpers.defineProperty(this,"scriptsLoaded",false)}babelHelpers.createClass(e,[{key:"processCSS",value:function e(t,i){if(o.Type.isArray(t.CSS)&&t.CSS.length>0){BX.load(t.CSS,i)}else{i()}}},{key:"processExternalJS",value:function e(t,i){if(o.Type.isArray(t.JS)&&t.JS.length>0){BX.load(t.JS,i)}else{i()}}},{key:"processAjaxBlockInsertHTML",value:function e(t,i,s){i.appendChild(BX.create("DIV",{html:t.CONTENT}));this.htmlWasInserted=true;if(this.scriptsLoaded){this.processInlineJS(t,s)}}},{key:"processInlineJS",value:function e(t,i){this.scriptsLoaded=true;if(this.htmlWasInserted){BX.ajax.processRequestData(t.CONTENT,{scriptsRunFirst:false,dataType:"HTML"});i()}}}]);return e}();var r=function(){babelHelpers.createClass(e,null,[{key:"setInstance",value:function t(i){e.instance=i}},{key:"getInstance",value:function t(){return e.instance}}]);function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"lazyLoad",null);babelHelpers.defineProperty(this,"ajaxUrl","");babelHelpers.defineProperty(this,"inited",false);babelHelpers.defineProperty(this,"loaded",false);babelHelpers.defineProperty(this,"container",null);babelHelpers.defineProperty(this,"containerMicro",null);babelHelpers.defineProperty(this,"containerMicroInner",null);babelHelpers.defineProperty(this,"clickDisabled",false);babelHelpers.defineProperty(this,"lastWait",[]);babelHelpers.defineProperty(this,"animationStartHeight",0);babelHelpers.defineProperty(this,"initedEditorsList",[]);babelHelpers.defineProperty(this,"options",{});this.init(t);e.setInstance(this)}babelHelpers.createClass(e,[{key:"setOption",value:function e(t,i){if(!o.Type.isStringFilled(t)){return}this.options[t]=i}},{key:"onShow",value:function e(){if(!o.Type.isStringFilled(this.options.startVideoRecorder)||this.options.startVideoRecorder!=="Y"){return}setTimeout(function(){var e=document.getElementById("divoPostFormLHE_blogPostForm");if(!e){return}a.EventEmitter.emit(e,"OnShowLHE",new a.BaseEvent({compatData:["justShow"]}));BX.VideoRecorder.start("blogPostForm","post")},500)}},{key:"onSliderClose",value:function e(){var t=BX.SidePanel.Instance.getTopSlider();if(!t){return}BX.SidePanel.Instance.postMessageAll(window,"SidePanel.Wrapper:onClose",{sliderData:t.getData()})}},{key:"init",value:function e(t){if(this.inited!==true){this.inited=true;this.lazyLoad=!o.Type.isUndefined(t.lazyLoad)?!!t.lazyLoad:false;this.ajaxUrl=o.Type.isStringFilled(t.ajaxUrl)?t.ajaxUrl:"";this.container=o.Type.isDomNode(t.container)?t.container:null;this.containerMicro=o.Type.isDomNode(t.containerMicro)?t.containerMicro:null;this.containerMicroInner=o.Type.isDomNode(t.containerMicroInner)?t.containerMicroInner:null;this.successPostId=!o.Type.isUndefined(t.successPostId)&&parseInt(t.successPostId)>0?parseInt(t.successPostId):0}var i=BX.SidePanel.Instance.getTopSlider();if(i){if(this.successPostId>0){BX.SidePanel.Instance.postMessage(window,"Socialnetwork.PostForm:onAdd",{originatorSliderId:i.getData().get("sliderId"),successPostId:this.successPostId});BX.SidePanel.Instance.close()}else if(!i.getData().get("initialized")){a.EventEmitter.subscribe(i,"BX.Socialnetwork.SidePanel.Slider:onClose",this.onSliderClose);i.getData().set("initialized",true)}}}},{key:"get",value:function e(t){var i=this;if(this.clickDisabled){return}if(this.lazyLoad&&!this.loaded){this.clickDisabled=true;this.animationStartHeight=this.containerMicro.offsetHeight;if(o.Type.isStringFilled(t.loaderType)&&t.loaderType==="tab"){this.showWaitTab()}else{this.containerMicroInner.style.display="none";this.showWait(this.containerMicro)}o.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{action:"SBPE_get_full_form",sessid:o.Loc.getMessage("bitrix_sessid")},onsuccess:function e(s){i.loaded=true;i.clickDisabled=false;i.closeWait();if(s.success){i.processAjaxBlock(s.PROPS,t.callback)}},onfailure:function e(){i.clickDisabled=false;i.closeWait();i.containerMicroInner.style.display="block"}})}else if(o.Type.isFunction(t.callback)){t.callback()}}},{key:"processAjaxBlock",value:function e(t,i){var s=this;if(!t){return}var o=new n;o.processCSS(t,function(){o.processAjaxBlockInsertHTML(t,s.container,i)});o.processExternalJS(t,function(){o.processInlineJS(t,i)})}},{key:"showWait",value:function e(t){var i=this;var s=t.bxmsg=document.body.appendChild(o.Dom.create("DIV",{props:{id:"wait_".concat(t.id),className:"feed-add-post-loader-cont"},html:'<svg class="feed-add-post-loader" viewBox="25 25 50 50"><circle class="feed-add-post-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle><circle class="feed-add-post-loader-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"></circle></svg>'}));setTimeout(function(){i.adjustWait(t)},10);this.lastWait.push(s);return s}},{key:"showWaitTab",value:function e(){if(!BX("feed-add-post-more-icon")||!BX("feed-add-post-more-icon-waiter")){return}BX("feed-add-post-more-icon").style.display="none";BX("feed-add-post-more-icon-waiter").style.display="block"}},{key:"closeWait",value:function e(){var t=this.containerMicro.bxmsg;if(t&&t.parentNode){for(var i=0,s=this.lastWait.length;i<s;i++){if(t===this.lastWait[i]){this.lastWait=BX.util.deleteFromArray(this.lastWait,i);break}}t.parentNode.removeChild(t);if(this.containerMicro){this.containerMicro.bxmsg=null}o.Dom.clean(t);o.Dom.remove(t)}if(BX("feed-add-post-more-icon")&&BX("feed-add-post-more-icon-waiter")&&BX("feed-add-post-more-icon").style.display==="none"){BX("feed-add-post-more-icon").style.display="block";BX("feed-add-post-more-icon-waiter").style.display="none"}}},{key:"adjustWait",value:function e(t){if(!t.bxmsg){return}var i=BX.pos(t);var s=i.top+15;if(s<BX.GetDocElement().scrollTop){s=BX.GetDocElement().scrollTop+5}t.bxmsg.style.top="".concat(s+5,"px");if(t===BX.GetDocElement()){t.bxmsg.style.right="5px"}else{t.bxmsg.style.left="".concat(i.left+parseInt((i.width-t.bxmsg.offsetWidth)/2),"px")}}},{key:"tasksTaskEvent",value:function e(t){if(!o.Reflection.getClass("BX.UI.Notification.Center")){return}var i=o.Loc.getMessage("PATH_TO_USER_TASKS_TASK").replace("#user_id#",o.Loc.getMessage("USER_ID")).replace("#task_id#",t).replace("#action#","view");window.top.BX.UI.Notification.Center.notify({content:o.Loc.getMessage("BLOG_POST_EDIT_T_CREATE_TASK_SUCCESS_TITLE"),actions:[{title:o.Loc.getMessage("BLOG_POST_EDIT_T_CREATE_TASK_BUTTON_TITLE"),events:{click:function e(t,s,o){s.close();window.top.BX.SidePanel.Instance.open(i)}}}]})}}]);return e}();babelHelpers.defineProperty(r,"instance",null);var l=function(e){babelHelpers.inherits(i,e);babelHelpers.createClass(i,null,[{key:"setInstance",value:function e(t){i.instance=t}},{key:"getInstance",value:function e(){if(i.instance===null){new i}return i.instance}}]);function i(){var e;babelHelpers.classCallCheck(this,i);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"inited",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"tabs",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"bodies",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"active",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"animation",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"animationStartHeight",0);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"previousTab",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"menu",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"listsMenu",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"menuItems",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"lastWait",[]);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"clickDisabled",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"tabContainer",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"arrow",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"config",{id:{message:"message",task:"tasks",calendar:"calendar",file:"file",gratitude:"grat",important:"important",vote:"vote",more:"more",listItem:"lists"}});e.setEventNamespace("BX.Socialnetwork.Livefeed.Post.Form.Tabs");e.init();i.setInstance(babelHelpers.assertThisInitialized(e));window.SBPETabs=babelHelpers.assertThisInitialized(e);return e}babelHelpers.createClass(i,[{key:"init",value:function e(){var t=this;this.tabContainer=document.getElementById("feed-add-post-form-tab");this.arrow=document.getElementById("feed-add-post-form-tab-arrow");this.tabs={};this.bodies={};var i=this.tabContainer&&this.tabContainer.querySelectorAll("span.feed-add-post-form-link");if(i){for(var s=0;s<i.length;s++){var a=i[s].getAttribute("id").replace("feed-add-post-form-tab-","");this.tabs[a]=i[s];if(this.tabs[a].style.display==="none"){this.menuItems.push({tabId:a,text:i[s].getAttribute("data-name"),className:"menu-popup-no-icon feed-add-post-form-".concat(a," feed-add-post-form-").concat(a,"-more"),onclick:this.createOnClick(a,i[s].getAttribute("data-name"),i[s].getAttribute("data-onclick"))});this.tabs[a]=this.tabs[a].parentNode}this.bodies[a]=document.getElementById("feed-add-post-content-".concat(a))}}if(!!this.tabs[this.config.id.file]){this.bodies[this.config.id.file]=[this.bodies[this.config.id.message]]}if(!!this.tabs[this.config.id.calendar]){this.bodies[this.config.id.calendar]=[this.bodies[this.config.id.calendar]]}if(!!this.tabs[this.config.id.vote]){this.bodies[this.config.id.vote]=[this.bodies[this.config.id.message],this.bodies[this.config.id.vote]]}if(!!this.tabs[this.config.id.more]){this.bodies[this.config.id.more]=null}if(!!this.tabs[this.config.id.important]){this.bodies[this.config.id.important]=[this.bodies[this.config.id.message],this.bodies[this.config.id.important]]}if(!!this.tabs[this.config.id.gratitude]){this.bodies[this.config.id.gratitude]=[this.bodies[this.config.id.message],this.bodies[this.config.id.gratitude]]}if(!!this.tabs[this.config.id.listItem]){this.bodies[this.config.id.listItem]=[this.bodies[this.config.id.listItem]]}if(!!this.tabs[this.config.id.task]){this.bodies[this.config.id.task]=[this.bodies[this.config.id.task]]}for(var n in this.bodies){if(this.bodies.hasOwnProperty(n)&&o.Type.isDomNode(this.bodies[n])){this.bodies[n]=[this.bodies[n]]}}this.inited=true;this.previousTab=false;var r=document.getElementById("bx-b-uploadfile-blogPostForm");if(r){r.setAttribute("bx-press","pressOut");o.Event.bind(r,"mousedown",function(){r.setAttribute("bx-press",r.getAttribute("bx-press")=="pressOut"?"pressOn":"pressOut")})}var l=document.getElementById("blogPostForm");if(!l){return}if(!l.changePostFormTab){l.appendChild(o.Dom.create("INPUT",{props:{type:"hidden",name:"changePostFormTab",value:""}}))}this.subscribe("changePostFormTab",function(e){var i=e.getData(),s=i.type;if(s===t.config.id.more){return}l.changePostFormTab.value=s;if(l["UF_BLOG_POST_IMPRTNT"]){l["UF_BLOG_POST_IMPRTNT"].value=s===t.config.id.important?"1":"0"}})}},{key:"createOnClick",value:function e(t,i,s){var a=this;return function(){var e=document.getElementById("feed-add-post-form-link-more");var n=document.getElementById("feed-add-post-form-link-text");n.innerHTML=i;if(t!==a.config.id.listItem){e.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-link-active feed-add-post-form-".concat(t,"-link");a.changePostFormTab(t)}else{e.className="feed-add-post-form-link feed-add-post-form-link-more feed-add-post-form-".concat(t,"-link")}if(o.Type.isStringFilled(s)){BX.evalGlobal(s)}a.menu.popupWindow.close()}}},{key:"changePostFormTab",value:function e(t,i){if(this.clickDisabled){return false}return this.setActive(t,i)}},{key:"setActive",value:function e(t,i){var s=this;if(o.Type.isNull(t)||this.active===t&&t!==this.config.id.listItem){return this.active}else if(!this.tabs[t]){return false}var n=t!==this.config.id.task||this.isTaskTabLoaded();if(n){this.startAnimation()}for(var r in this.tabs){if(this.tabs.hasOwnProperty(r)&&r!==t){this.tabs[r].classList.remove("feed-add-post-form-link-active");if(this.bodies[r]==null||this.bodies[t]==null){continue}for(var l=0;l<this.bodies[r].length;l++){if(this.bodies[t][l]!=this.bodies[r][l]){o.Dom.adjust(this.bodies[r][l],{style:{display:"none"}})}}}}if(!!this.tabs[t]){this.active=t;var d=BX.pos(this.tabs[t],true);this.arrow.style.display="block";this.arrow.style.top="".concat(d.bottom,"px");var c=parseInt(this.arrow.style.left)||0;var u=parseInt(this.arrow.style.width)||0;new BX.easing({duration:200,start:{left:c,width:u},finish:{left:d.left,width:d.width},transition:BX.easing.makeEaseInOut(BX.easing.transitions.quart),step:function e(t){s.arrow.style.left="".concat(t.left,"px");s.arrow.style.width="".concat(t.width,"px")},complete:function e(){s.arrow.style.display="none";s.tabs[t].classList.add("feed-add-post-form-link-active")}}).animate();if(this.previousTab===this.config.id.file||t===this.config.id.file){var m=false;var f=false;var p=document.getElementById("divoPostFormLHE_blogPostForm");if(!!p&&!!p.childNodes&&p.childNodes.length>0){for(var h in p.childNodes){if(!p.childNodes.hasOwnProperty(h)){continue}if(p.childNodes[h].className==="file-selectdialog"){var b=p.childNodes[h];var g=b.querySelector(".file-placeholder-tbody");var y=b.querySelector(".feed-add-photo-block");if(g.rows>0||!!y&&y.length>1){m=true}}else if(o.Type.isStringFilled(p.childNodes[h].className)&&(p.childNodes[h].className.indexOf("wduf-selectdialog")>=0||p.childNodes[h].className.indexOf("diskuf-selectdialog")>=0)){var v=p.childNodes[h];var T=v.querySelectorAll("wd-inline-file");f=!!T&&T.length>0}else if(o.Type.isDomNode(p.childNodes[h])&&p.childNodes[h].classList&&!p.childNodes[h].classList.contains("urlpreview")&&!p.childNodes[h].classList.contains("feed-add-post-strings-blocks")){o.Dom.adjust(p.childNodes[h],{style:{display:t===this.config.id.file?"none":""}})}}if(t===this.config.id.file){if(!!window["PlEditorblogPostForm"]&&!window["PlEditorblogPostForm"].SBPEBinded){window["PlEditorblogPostForm"].SBPEBinded=true;a.EventEmitter.subscribe(window["PlEditorblogPostForm"].eventNode,"onUploadsHasBeenChanged",function(e){var t=e.getData()[1];if(t.dialogName==="AttachFileDialog"&&t.urlUpload.indexOf("&dropped=Y")<0){t.urlUpload=t.agent.uploadFileUrl=t.urlUpload.replace("&random_folder=Y","&dropped=Y")}document.getElementById("bx-b-uploadfile-blogPostForm").setAttribute("bx-press","pressOn");if(s.active!==s.config.id.file){s.changePostFormTab(s.config.id.message)}})}window["PlEditorblogPostForm"].controllerInit("show");p.classList.add("feed-add-post-form","feed-add-post-edit-form","feed-add-post-edit-form-file")}else{p.classList.remove("feed-add-post-form","feed-add-post-edit-form","feed-add-post-edit-form-file");if(!m&&!f&&document.getElementById("bx-b-uploadfile-blogPostForm").getAttribute("bx-press")==="pressOut"&&!!window["PlEditorblogPostForm"]){window["PlEditorblogPostForm"].controllerInit("hide")}}}}var E=document.getElementById("divoPostFormLHE_blogPostForm");if(E&&E.style.display==="none"){a.EventEmitter.emit(E,"OnShowLHE",new a.BaseEvent({compatData:["justShow"]}))}if(t===this.config.id.listItem){a.EventEmitter.emit("onDisplayClaimLiveFeed",new a.BaseEvent({compatData:[i]}))}this.previousTab=t;if(!!this.bodies[t]){for(var I=0;I<this.bodies[t].length;I++){if(!!this.bodies[t][I]){o.Dom.adjust(this.bodies[t][I],{style:{display:"block"}})}}}}if(n){this.endAnimation()}if(t!==this.config.id.listItem){this.restoreMoreMenu()}this.emit("changePostFormTab",{type:t});return this.active}},{key:"isTaskTabLoaded",value:function e(){var t=document.getElementById("feed-add-post-content-tasks-container");return t&&t.children.length}},{key:"collapse",value:function e(){this.active=null;var t=false;if(window!==top.window){var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i&&i.url.match(/\/user\/(\d+)\/blog\/edit\//)){t=true}}if(!t){this.changePostFormTab("message");var s=r.getInstance();if(s&&o.Type.isDomNode(s.containerMicroInner)){s.containerMicroInner.style.display="block"}this.startAnimation()}var n=document.getElementById("divoPostFormLHE_blogPostForm");if(n){a.EventEmitter.emit(n,"OnShowLHE",new a.BaseEvent({compatData:[false]}))}a.EventEmitter.emit("onExtAutoSaveReset_blogPostForm",new a.BaseEvent({compatData:[]}));if(!t){this.endAnimation()}else{a.EventEmitter.emit(window.top,"SidePanel.Slider:onClose",new a.BaseEvent({compatData:[currentSlider.getEvent("onClose")]}));BX.SidePanel.Instance.close()}}},{key:"startAnimation",value:function e(){if(this.animation){this.animation.stop()}var t=document.getElementById("microblog-form");if(!t){return}if(r.getInstance().animationStartHeight>0){this.animationStartHeight=r.getInstance().animationStartHeight;r.getInstance().animationStartHeight=0}else{this.animationStartHeight=t.parentNode.offsetHeight}t.parentNode.style.height="".concat(this.animationStartHeight,"px");t.parentNode.style.overflowY="hidden";t.parentNode.style.position="relative";t.style.opacity=0}},{key:"endAnimation",value:function e(){var t=this;var i=document.getElementById("microblog-form");if(!i){return}this.animation=new BX.easing({duration:500,start:{height:this.animationStartHeight,opacity:0},finish:{height:i.offsetHeight+i.offsetTop,opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){i.parentNode.style.height="".concat(t.height,"px");i.style.opacity=t.opacity/100},complete:function e(){i.style.cssText="";i.parentNode.style.cssText="";t.animation=null}});this.animation.animate()}},{key:"showMoreMenu",value:function e(){if(!this.menu){this.menu=t.MenuManager.create("feed-add-post-form-popup",document.getElementById("feed-add-post-form-link-text"),this.menuItems,{className:"feed-add-post-form-popup",closeByEsc:true,offsetTop:5,offsetLeft:3,angle:true})}this.menu.popupWindow.show()}},{key:"restoreMoreMenu",value:function e(){var t=this.menuItems.length;if(t<1){return}for(var i=0;i<t;i++){if(this.active===this.menuItems[i]["tabId"]){return}}var s=document.getElementById("feed-add-post-form-link-more");var a=document.getElementById("feed-add-post-form-link-text");s.className="feed-add-post-form-link feed-add-post-form-link-more";a.innerHTML=o.Loc.getMessage("SBPE_MORE")}},{key:"getTaskForm",value:function e(){var t=this;var i=document.getElementById("feed-add-post-form-tab-tasks")&&document.getElementById("feed-add-post-form-tab-tasks").style.display!=="none"?document.getElementById("feed-add-post-form-tab-tasks"):document.getElementById("feed-add-post-form-link-more");var s=document.getElementById("feed-add-post-content-tasks");var n=document.getElementById("feed-add-post-content-tasks-container");if(n&&n.innerHTML.length<=0&&!this.clickDisabled){this.clickDisabled=true;r.getInstance().showWait(n);this.startAnimation();var l={GROUP_ID:o.Loc.getMessage("TASK_SOCNET_GROUP_ID"),PATH_TO_USER_TASKS:o.Loc.getMessage("PATH_TO_USER_TASKS"),PATH_TO_USER_TASKS_TASK:o.Loc.getMessage("PATH_TO_USER_TASKS_TASK"),PATH_TO_GROUP_TASKS:o.Loc.getMessage("PATH_TO_GROUP_TASKS"),PATH_TO_GROUP_TASKS_TASK:o.Loc.getMessage("PATH_TO_GROUP_TASKS_TASK"),PATH_TO_USER_PROFILE:o.Loc.getMessage("PATH_TO_USER_PROFILE"),PATH_TO_GROUP:o.Loc.getMessage("PATH_TO_GROUP"),PATH_TO_USER_TASKS_PROJECTS_OVERVIEW:o.Loc.getMessage("PATH_TO_USER_TASKS_PROJECTS_OVERVIEW"),PATH_TO_USER_TASKS_TEMPLATES:o.Loc.getMessage("PATH_TO_USER_TASKS_TEMPLATES"),PATH_TO_USER_TEMPLATES_TEMPLATE:o.Loc.getMessage("PATH_TO_USER_TEMPLATES_TEMPLATE"),ENABLE_FOOTER:"N",TEMPLATE_CONTROLLER_ID:"livefeed_task_form",ENABLE_FORM:"N",BACKURL:o.Loc.getMessage("TASK_SUBMIT_BACKURL")};BX.Tasks.Util.Query.runOnce("ui.task.edit",{parameters:{COMPONENT_PARAMETERS:l}}).then(function(e){if(e.isSuccess()){o.Runtime.html(n,e.getData());o.Dom.adjust(s,{style:{display:"block"}});return true}else{t.closeWait(n);t.endAnimation();throw new Error}},function(e){t.closeWait(n);t.endAnimation();throw new Error}).then(function(){t.clickDisabled=false;t.closeWait(n);t.endAnimation();a.EventEmitter.emit(document.getElementById("divlivefeed_task_form"),"OnShowLHE",new a.BaseEvent({compatData:["justShow"]}))})}else{this.startAnimation();this.endAnimation()}}},{key:"closeWait",value:function e(t){var i=t.bxmsg;if(i&&i.parentNode){for(var s=0,a=this.lastWait.length;s<a;s++){if(i===this.lastWait[s]){this.lastWait=BX.util.deleteFromArray(this.lastWait,s);break}}i.parentNode.removeChild(i);if(t){t.bxmsg=null}o.Dom.clean(i);o.Dom.remove(i)}}},{key:"getLists",value:function e(){var t=this;var i=document.getElementById("feed-add-post-form-tab-lists")&&document.getElementById("feed-add-post-form-tab-lists").style.display!=="none"?document.getElementById("feed-add-post-form-tab-lists"):document.getElementById("feed-add-post-form-link-more");var s=i.querySelectorAll("span.feed-add-post-form-link-lists");var a=i.querySelectorAll("span.feed-add-post-form-link-lists-default");var n=[];var r=[];if(s.length){r=this.getMenuItems(s,this.createOnclickLists);n=this.getMenuItemsDefault(a);r=r.concat(n);this.showMoreMenuLists(r)}else{var l=null;if(document.getElementById("bx-lists-select-site-id")){l=document.getElementById("bx-lists-select-site-id").value}o.ajax({method:"POST",dataType:"json",url:"/bitrix/components/bitrix/socialnetwork.blog.post.edit/post.ajax.php",data:{bitrix_processes:1,siteId:l,sessid:o.Loc.getMessage("bitrix_sessid")},onsuccess:function e(l){if(l.success){for(var d in l.lists){if(!l.lists.hasOwnProperty(d)){continue}i.appendChild(o.Dom.create("span",{attrs:{"data-name":l.lists[d].NAME,"data-picture":l.lists[d].PICTURE,"data-description":l.lists[d].DESCRIPTION,"data-picture-small":l.lists[d].PICTURE_SMALL,"data-code":l.lists[d].CODE,iblockId:l.lists[d].ID},props:{className:"feed-add-post-form-link-lists",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}s=i.querySelectorAll("span.feed-add-post-form-link-lists");r=t.getMenuItems(s,t.createOnclickLists);if(!a.length){for(var c in l.permissions){if(!l.permissions.hasOwnProperty(c)){continue}var u=void 0;if(c==="new"){u='document.location.href = "'.concat(document.getElementById("bx-lists-lists-page").value,'0/edit/"')}else if(c==="market"){if(l.admin&&document.getElementById("bx-lists-lists-page")){u='document.location.href = "'.concat(document.getElementById("bx-lists-lists-page").value,'?bp_catalog=y"')}else{if(document.getElementById("bx-lists-random-string")){u='BX.Lists["LiveFeedClass_'.concat(BX("bx-lists-random-string").value,'"].errorPopup("').concat(o.Loc.getMessage("LISTS_CATALOG_PROCESSES_ACCESS_DENIED"),'");')}}}else if(c==="settings"){u='document.location.href = "'.concat(BX("bx-lists-lists-page").value,'"')}i.appendChild(o.Dom.create("span",{attrs:{"data-name":l.permissions[c],"data-picture-small":"","data-key":c,"data-onclick":u},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}))}a=i.querySelectorAll("span.feed-add-post-form-link-lists-default")}n=t.getMenuItemsDefault(a);r=r.concat(n);t.showMoreMenuLists(r)}else{i.appendChild(o.Dom.create("span",{attrs:{"data-name":l.error,"data-picture-small":""},props:{className:"feed-add-post-form-link-lists-default",id:"feed-add-post-form-tab-lists"},style:{display:"none"}}));s=i.querySelectorAll("span.feed-add-post-form-link-lists-default");r=t.getMenuItems(s,false);t.showMoreMenuLists(r)}}})}}},{key:"getMenuItems",value:function e(t,i){var s=[];for(var o=0;o<t.length;o++){var a=t[o].getAttribute("id").replace("feed-add-post-form-tab-","");if(i){s.push({tabId:a,text:BX.util.htmlspecialchars(t[o].getAttribute("data-name")),className:"feed-add-post-form-".concat(a," feed-add-post-form-").concat(a,"-item"),onclick:i(a,[t[o].getAttribute("iblockId"),t[o].getAttribute("data-name"),t[o].getAttribute("data-description"),t[o].getAttribute("data-picture"),t[o].getAttribute("data-code")])})}else{s.push({tabId:a,text:t[o].getAttribute("data-name"),className:"feed-add-post-form-".concat(a),onclick:""})}}return s}},{key:"getMenuItemsDefault",value:function e(t){var i=[];for(var s=0;s<t.length;s++){i.push({text:BX.util.htmlspecialchars(t[s].getAttribute("data-name")),className:"feed-add-post-form-lists-default-".concat(t[s].getAttribute("data-key")),onclick:t[s].getAttribute("data-onclick")})}return i}},{key:"showMoreMenuLists",value:function e(i){var s=document.getElementById("feed-add-post-form-tab-lists").style.display!=="none"?document.getElementById("feed-add-post-form-tab-lists"):document.getElementById("feed-add-post-form-link-more");this.listsMenu=t.MenuManager.create("lists",s,i,{closeByEsc:true,offsetTop:5,offsetLeft:12,angle:true});var o=document.getElementById("popup-window-content-menu-popup-lists").querySelectorAll("span.menu-popup-item-icon");var a=s.querySelectorAll("span.feed-add-post-form-link-lists");var n=s.querySelectorAll("span.feed-add-post-form-link-lists-default");a=Array.from(a).concat(Array.from(n));for(var r=0;r<o.length;r++){if(!a[r].getAttribute("data-picture-small")){continue}o[r].innerHTML=a[r].getAttribute("data-picture-small")}this.listsMenu.popupWindow.show()}},{key:"createOnclickLists",value:function e(t,s){return function(){i.getInstance().changePostFormTab(t,s);i.getInstance().listsMenu.popupWindow.close();i.getInstance().menu.popupWindow.close()}}}]);return i}(a.EventEmitter);babelHelpers.defineProperty(l,"instance",null);var d=function(){function e(){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"isInitialized",false);babelHelpers.defineProperty(this,"popupShowingPeriods",null);babelHelpers.defineProperty(this,"menuItems",[]);babelHelpers.defineProperty(this,"customDateStyleModifier","feed-add-post-expire-date-customize");babelHelpers.defineProperty(this,"customDatePopupOptionClass","js-custom-date-end");babelHelpers.defineProperty(this,"postExpireDateBlock",null);babelHelpers.defineProperty(this,"formUfInputDateCustom",null);babelHelpers.defineProperty(this,"formDateDuration",null);babelHelpers.defineProperty(this,"formDateTimeEditing",null);babelHelpers.defineProperty(this,"popupTrigger",null);babelHelpers.defineProperty(this,"customDateSelectedTitle",null);babelHelpers.defineProperty(this,"selectors",{postExpireDateBlock:".js-post-expire-date-block",postEndTime:".js-form-post-end-time",postEditingEndTime:".js-form-editing-post-end-time",postEndPeriod:".js-form-post-end-period",popupTrigger:".js-important-till-popup-trigger",customDateFinal:".js-date-post-showing-custom",durationOptionsContainer:".js-post-showing-duration-options-container",durationOption:".js-post-showing-duration-option"});this.init()}babelHelpers.createClass(e,[{key:"init",value:function e(){if(this.isInitialized){return}this.addEventHandlers();if(!this.formDateTimeEditing.value){this.customDateSelectedTitle.innerText=this.getCurrentDate()}this.isInitialized=true}},{key:"addEventHandlers",value:function e(){var t=this;this.postExpireDateBlock=document.querySelector(this.selectors.postExpireDateBlock);this.formUfInputDateCustom=document.querySelector(this.selectors.postEndTime);this.formDateDuration=document.querySelector(this.selectors.postEndPeriod);this.formDateTimeEditing=document.querySelector(this.selectors.postEditingEndTime);this.popupTrigger=document.querySelector(this.selectors.popupTrigger);if(this.popupTrigger){this.popupTrigger.addEventListener("click",function(){t.showPostEndPeriodsPopup()})}this.customDateSelectedTitle=document.querySelector(this.selectors.customDateFinal);if(this.customDateSelectedTitle){this.customDateSelectedTitle.addEventListener("click",function(){var e=new Date;var i=Math.round(e/1e3)-e.getTimezoneOffset()*60;if(t.formDateTimeEditing.value){e=BX.parseDate(t.formDateTimeEditing.value);i=BX.date.convertToUTC(e)}BX.calendar({node:t.customDateSelectedTitle,form:"blogPostForm",value:i,bTime:false,callback:function e(){return true},callback_after:t.onEndDateSet.bind(t)})})}}},{key:"showPostEndPeriodsPopup",value:function e(){if(!this.popupShowingPeriods){this.createPopupShowingPeriods()}this.popupShowingPeriods.popupWindow.show()}},{key:"createPopupShowingPeriods",value:function e(){if(this.menuItems.length<=0){this.menuItems=this.createPopupItems()}this.popupShowingPeriods=t.MenuManager.create("feed-add-post-form-popup42",document.getElementById("js-post-expire-date-wrapper"),this.menuItems,{className:"feed-add-post-expire-date-options",closeByEsc:true,angle:true})}},{key:"createPopupItems",value:function e(){var t=this;var i=[];var s=document.querySelector(this.selectors.durationOptionsContainer).querySelectorAll(this.selectors.durationOption);if(!s){return i}s.forEach(function(e){i.push({onclick:t.onPopupItemClick.bind(t),dataset:{value:e.getAttribute("data-value"),class:e.getAttribute("data-class")},text:e.getAttribute("data-text"),className:"menu-popup-item menu-popup-no-icon ".concat(e.getAttribute("data-class"))})});return i}},{key:"onPopupItemClick",value:function e(t){var i=t.currentTarget;if(i.getAttribute("data-class")===this.customDatePopupOptionClass){this.postExpireDateBlock.classList.add(this.customDateStyleModifier);if(this.formDateTimeEditing.value){this.formUfInputDateCustom.value=this.formDateTimeEditing.value;this.customDateSelectedTitle.innerText=this.formDateTimeEditing.value}else{this.formUfInputDateCustom.value=this.getCurrentDate()}}else{this.postExpireDateBlock.classList.remove(this.customDateStyleModifier);this.formUfInputDateCustom.value=null}this.popupTrigger.innerText=i.innerText.toLowerCase();this.formDateDuration.value=i.getAttribute("data-value").toUpperCase();this.popupShowingPeriods.popupWindow.close()}},{key:"onEndDateSet",value:function e(t){if(!t){return}this.formDateTimeEditing.value=this.getFormattedDate(t);this.formUfInputDateCustom.value=this.getFormattedDate(t);this.customDateSelectedTitle.innerText=this.getFormattedDate(t)}},{key:"getFormattedDate",value:function e(t){return BX.date.format(BX.date.convertBitrixFormat(o.Loc.getMessage("FORMAT_DATE")),t)}},{key:"getCurrentDate",value:function e(){return this.getFormattedDate(new Date)}}]);return e}();var c=function(e){babelHelpers.inherits(s,e);babelHelpers.createClass(s,null,[{key:"setInstance",value:function e(t){s.instance=t}},{key:"getInstance",value:function e(){return s.instance}}]);function s(e){var t;babelHelpers.classCallCheck(this,s);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"popupWindow",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"sendEvent",true);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"gratsContentElement",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"itemSelectedImageItem",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"itemSelectedInput",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"gratsList",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"selector",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(t),"config",{fields:{employeesValue:{name:"GRAT_DEST_DATA"}}});t.init(e);s.setInstance(babelHelpers.assertThisInitialized(t));return t}babelHelpers.createClass(s,[{key:"init",value:function e(t){var i=this;if(!t.name){t.name="lm"}this.itemSelectedImageItem[t.name]=t.itemSelectedImageItem;this.itemSelectedInput[t.name]=t.itemSelectedInput;this.gratsList[t.name]=t.gratsList;this.itemSelectedImageItem[t.name].addEventListener("click",function(e){i.openDialog(t.name);e.preventDefault()});this.createEntitySelector(t.entitySelectorParams)}},{key:"openDialog",value:function e(i){var s=this;if(!i){i="lm"}if(this.popupWindow!=null){this.popupWindow.close();return false}var a=[];for(var n=0;n<this.gratsList[i].length;n++){a[a.length]=o.Dom.create("span",{props:{className:"feed-add-grat-box ".concat(this.gratsList[i][n].style)},attrs:{"data-title":this.gratsList[i][n].title,"data-code":this.gratsList[i][n].code,"data-style":this.gratsList[i][n].style},events:{click:function e(t){var o=t.currentTarget;s.selectItem(i,o.getAttribute("data-code"),o.getAttribute("data-style"),o.getAttribute("data-title"));t.preventDefault()}}})}var r=[];var l=1;for(var d=0;d<a.length;d++){if(d>=a.length/2){l=2}if(o.Type.isNil(r[l])){r[l]=o.Dom.create("div",{props:{className:"feed-add-grat-list-row"}})}r[l].appendChild(a[d])}this.gratsContentElement=o.Dom.create("div",{children:[o.Dom.create("div",{props:{className:"feed-add-grat-list-title"},html:o.Loc.getMessage("BLOG_GRAT_POPUP_TITLE")}),o.Dom.create("div",{props:{className:"feed-add-grat-list"},children:r})]});this.popupWindow=new t.Popup("BXSocNetGratSelector",document.getElementById("feed-add-post-grat-type-selected"),{autoHide:true,offsetLeft:25,bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:{top:"5px",right:"10px"},events:{onPopupClose:function e(){s.popupWindow.destroy()},onPopupDestroy:function e(){s.popupWindow=null}},content:this.gratsContentElement,angle:{position:"bottom",offset:20},lightShadow:true});this.popupWindow.setAngle({});this.popupWindow.show();return true}},{key:"selectItem",value:function e(t,i,s,o){var a=this.itemSelectedImageItem[t].querySelector("span");if(a){a.className="feed-add-grat-box ".concat(s)}this.itemSelectedImageItem[t].title=o;this.itemSelectedInput[t].value=i;this.popupWindow.close()}},{key:"createEntitySelector",value:function e(t){var s=this;this.selector=new i.TagSelector({id:t.id,dialogOptions:{id:t.id,context:"GRATITUDE",preselectedItems:o.Type.isArray(t.preselectedItems)?t.preselectedItems:[],events:{"Item:onSelect":function e(i){s.recalcValue(i.getTarget().getSelectedItems(),t.inputNodeId)},"Item:onDeselect":function e(i){s.recalcValue(i.getTarget().getSelectedItems(),t.inputNodeId)}},entities:[{id:"user",options:{emailUsers:false,inviteEmployeeLink:false,intranetUsersOnly:true}},{id:"department",options:{selectMode:"usersOnly"}}]},addButtonCaption:o.Loc.getMessage("BLOG_GRATMEDAL_1"),addButtonCaptionMore:o.Loc.getMessage("BLOG_GRATMEDAL_1")});this.selector.renderTo(document.getElementById(t.tagNodeId));this.selector.subscribe("onContainerClick",function(){s.emit("Selector::onContainerClick")})}},{key:"recalcValue",value:function e(t,i){if(!o.Type.isArray(t)||!document.getElementById(i)){return}var s=[];t.forEach(function(e){s.push([e.entityId,e.id])});document.getElementById(i).value=JSON.stringify(s)}}]);return s}(a.EventEmitter);babelHelpers.defineProperty(c,"instance",null);var u=function(e){babelHelpers.inherits(t,e);babelHelpers.createClass(t,null,[{key:"setInstance",value:function e(i,s){t.instance[i]=s}},{key:"getInstance",value:function e(i){return t.instance[i]}}]);function t(e,i){var s;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"disabled",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"formId","");s.init(e,i);t.setInstance(e,babelHelpers.assertThisInitialized(s));window["setBlogPostFormSubmitted"]=s.setBlogPostFormSubmitted.bind(babelHelpers.assertThisInitialized(s));window["submitBlogPostForm"]=s.submitBlogPostForm.bind(babelHelpers.assertThisInitialized(s));return s}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){var s=this;this.disabled=false;this.formId=t;this.formParams={editorID:i.editorID,showTitle:!!i.showTitle,submitted:false,text:i.text,autoSave:i.autoSave,handler:LHEPostForm&&LHEPostForm.getHandler(i.editorID),editor:LHEPostForm&&LHEPostForm.getEditor(i.editorID),restoreAutosave:!!i.restoreAutosave};a.EventEmitter.subscribe("onInitialized",function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),o=i[0],a=i[1];s.onHandlerInited(o,a)});if(this.formParams.handler){this.onHandlerInited(this.formParams.handler,t)}a.EventEmitter.subscribe("OnEditorInitedAfter",function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,1),o=i[0];s.onEditorInited.bind(o)});if(this.formParams.editor){this.onEditorInited(this.formParams.editor)}a.EventEmitter.subscribe("onSocNetLogMoveBody",function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,1),o=i[0];if(o==="sonet_log_microblog_container"){s.reinit()}});o.Event.ready(function(){if(o.Browser.isIE()&&document.getElementById("POST_TITLE")){var e=function e(){var t=document.getElementById("POST_TITLE");if(!t||t.value===t.getAttribute("placeholder")){t.value=t.getAttribute("placeholder");t.classList.remove("feed-add-post-inp-active")}};o.Event.bind(document.getElementById("POST_TITLE"),"blur",e);e();document.getElementById("POST_TITLE").__onchange=function(e){var t=document.getElementById("POST_TITLE");if(t.value===t.getAttribute("placeholder")){t.value=""}if(t.className.indexOf("feed-add-post-inp-active")<0){t.classList.add("feed-add-post-inp-active")}};o.Event.bind(document.getElementById("POST_TITLE"),"click",document.getElementById("POST_TITLE").__onchange);o.Event.bind(document.getElementById("POST_TITLE"),"keydown",document.getElementById("POST_TITLE").__onchange);o.Event.bind(document.getElementById("POST_TITLE").form,"submit",function(){var e=document.getElementById("POST_TITLE");if(e.value===e.getAttribute("placeholder")){e.value=""}})}if(i.activeTab!==""){l.getInstance().changePostFormTab(i.activeTab)}l.getInstance().subscribe("changePostFormTab",s.checkHideAlert.bind(s));if(c.getInstance()){c.getInstance().subscribe("Selector::onContainerClick",s.hideAlert.bind(s))}})}},{key:"showPanelTitle",value:function e(t,i){t=t===true||t===false?t:document.getElementById("blog-title").style.display&&document.getElementById("blog-title").style.display==="none";i=i!==false;var s=this.formParams.showTitle;var o=document.getElementById("lhe_button_title_".concat(this.formId));var a=document.getElementById("feed-add-post-block".concat(this.formId));var n=document.getElementById("show_title")||{};if(t){BX.show(document.getElementById("blog-title"));if(document.getElementById("POST_TITLE")){document.getElementById("POST_TITLE").focus()}this.formParams.showTitle=true;n.value="Y";if(o){o.classList.add("feed-add-post-form-btn-active")}if(a){a.classList.add("blog-post-edit-open")}}else{BX.hide(document.getElementById("blog-title"));this.formParams.showTitle=false;n.value="N";if(o){o.classList.remove("feed-add-post-form-btn-active")}}if(i){BX.userOptions.save("socialnetwork","postEdit","showTitle",this.formParams.showTitle?"Y":"N")}else{this.formParams.showTitle=s}}},{key:"setBlogPostFormSubmitted",value:function e(t){if(document.getElementById("blog-submit-button-save")){if(t){document.getElementById("blog-submit-button-save").classList.add("ui-btn-clock")}else{document.getElementById("blog-submit-button-save").classList.remove("ui-btn-clock")}}this.formParams.submitted=t;this.disabled=t}},{key:"submitBlogPostForm",value:function e(t,i){var s=this;if(this.disabled){return}if(!o.Type.isObject(t)){i=t;t=LHEPostForm.getEditor(this.formParams.editorID)}if(t&&t.id===this.formParams.editorID){if(this.formParams.submitted){return false}t.SaveContent();if(!i){i="save"}if(document.getElementById("blog-title").style.display==="none"){document.getElementById("POST_TITLE").value=""}var a=this.getSubmitButton({buttonType:i});if(a){a.classList.add("ui-btn-clock");this.disabled=true;window.addEventListener("beforeunload",function(e){setTimeout(function(){BX.removeClass(a,"ui-btn-clock");s.disabled=false;s.formParams.submitted=false},3e3)})}var n="";var r=l.getInstance().active;if(o.Type.isStringFilled(r)){n=document.getElementById(this.formId).action;o.Uri.removeParam(n,["b24statTab"]);o.Uri.addParam(n,{b24statTab:r});document.getElementById(this.formId).action=n}if(r===l.getInstance().config.id.gratitude&&c.getInstance()){if(!this.checkEmployeesValue({buttonType:i})){return}}BX.submit(document.getElementById(this.formId),i);this.formParams.submitted=true}}},{key:"checkEmployeesValue",value:function e(t){var i=t.buttonType;var s=document.getElementById(this.formId).elements[c.getInstance().config.fields.employeesValue.name];if(!s||!o.Type.isStringFilled(s.value)||s.value==="[]"){var a=this.getSubmitButton({buttonType:i});if(a){a.classList.remove("ui-btn-clock");this.disabled=false}var n=document.getElementById("feed-add-post-bottom-alertblogPostForm");if(n){o.Dom.clean(n);n.appendChild(o.Dom.create("div",{props:{className:"ui-alert ui-alert-danger"},children:[o.Dom.create("span",{props:{className:"ui-alert-message"},text:o.Loc.getMessage("BLOG_POST_EDIT_T_GRAT_ERROR_NO_EMPLOYEES")})]}))}return false}return true}},{key:"checkHideAlert",value:function e(t){var i=t.getData(),s=i.type;if(s===l.getInstance().config.id.gratitude){return}this.hideAlert()}},{key:"hideAlert",value:function e(){var t=document.getElementById("feed-add-post-bottom-alertblogPostForm");if(!t){return}o.Dom.clean(t)}},{key:"getSubmitButton",value:function e(t){var i=t.buttonType;var s=null;if(i==="save"&&document.getElementById("blog-submit-button-save")){s=document.getElementById("blog-submit-button-save")}else if(i==="draft"&&document.getElementById("blog-submit-button-draft")){s=document.getElementById("blog-submit-button-draft")}return s}},{key:"onHandlerInited",value:function e(t,i){if(i!==this.formId){return}this.formParams.handler=t;a.EventEmitter.subscribe(t.eventNode,"OnControlClick",function(){l.getInstance().changePostFormTab(l.getInstance().config.id.message)});a.EventEmitter.subscribe(t.eventNode,"OnAfterShowLHE",this.OnAfterShowLHE.bind(this));a.EventEmitter.subscribe(t.eventNode,"OnAfterHideLHE",this.OnAfterHideLHE.bind(this));if(t.eventNode.style.display=="none"){this.OnAfterHideLHE()}else{this.OnAfterShowLHE()}}},{key:"OnAfterShowLHE",value:function e(){var t=[document.getElementById("feed-add-post-form-notice-blockblogPostForm"),document.getElementById("feed-add-buttons-blockblogPostForm"),document.getElementById("feed-add-post-bottom-alertblogPostForm"),document.getElementById("feed-add-post-content-message-add-ins")];for(var i=0;i<t.length;i++){if(!t[i]){continue}o.Dom.adjust(t[i],{style:{display:"block",height:"auto",opacity:1}});t[i].style.padding=null}if(this.formParams.showTitle){this.showPanelTitle(true,false)}}},{key:"OnAfterHideLHE",value:function e(){var t=[document.getElementById("feed-add-post-form-notice-blockblogPostForm"),document.getElementById("feed-add-buttons-blockblogPostForm"),document.getElementById("feed-add-post-bottom-alertblogPostForm"),document.getElementById("feed-add-post-content-message-add-ins")];for(var i=0;i<t.length;i++){if(!t[i]){continue}o.Dom.adjust(t[i],{style:{display:"block",height:"0",opacity:0}})}if(this.formParams.showTitle){this.showPanelTitle(false,false)}}},{key:"onEditorInited",value:function e(t){if(r.getInstance().initedEditorsList.includes(t.id)){return}if(t.id!==this.formParams.editorID){return}this.formParams.editor=t;if(this.formParams.autoSave!=="N"){new m(this.formParams.autoSave,this.formParams.restoreAutosave)}var i=window[t.id+"Files"];var s=LHEPostForm.getHandler(t.id);var a=[];var n=null;var l=null;for(var d in s.controllers){if(!s.controllers.hasOwnProperty(d)){continue}if(s.controllers[d].parser&&s.controllers[d].parser.bxTag==="postimage"){l=s.controllers[d];break}}var c=function e(t,i){return function(){t.insertFile(i)}};var u=function e(t,i,s){return function(){if(l){l.deleteFile(i,{});o.Dom.remove(document.getElementById("wd-doc'".concat(i)));o.ajax({method:"GET",url:s})}else{t.deleteFile(i,s,t,{controlID:"common"})}}};for(var f in i){if(!i.hasOwnProperty(f)){continue}if(l){l.addFile(i[f])}else{var p=s.checkFile(f,"common",i[f]);a.push(f);if(!!p&&document.getElementById("wd-doc".concat(f))&&!document.getElementById("wd-doc".concat(f)).hasOwnProperty("bx-bound")){BX("wd-doc".concat(f)).setAttribute("bx-bound","Y");if((n=document.getElementById("wd-doc".concat(f)).querySelector(".feed-add-img-wrap"))&&n){o.Event.bind(n,"click",c(s,p));n.style.cursor="pointer"}if((n=document.getElementById("wd-doc".concat(f)).querySelector(".feed-add-img-title"))&&n){o.Event.bind(n,"click",c(s,p));n.style.cursor="pointer"}}}if((n=document.getElementById("wd-doc".concat(f)).querySelector(".feed-add-post-del-but"))&&n){o.Event.bind(n,"click",u(s,f,i[f].del_url));n.style.cursor="pointer"}}if(a.length>0){t.SaveContent();var h=t.GetContent();h=h.replace(new RegExp("\\&\\#91\\;IMG ID=("+a.join("|")+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"[IMG ID=$1$2]");t.SetContent(h);t.Focus()}r.getInstance().initedEditorsList.push(t.id)}},{key:"reinit",value:function e(){if(!this.formParams.editorID){return}if(o.Type.isFunction(this.formParams.editor)){this.formParams.editor(this.formParams.text)}else{setTimeout(this.reinit,50)}}}]);return t}(a.EventEmitter);babelHelpers.defineProperty(u,"instance",{});var m=function(){function e(t,i){babelHelpers.classCallCheck(this,e);this.init(t,i)}babelHelpers.createClass(e,[{key:"init",value:function e(t,i){var s=this;var n="blogPostForm";var r=document.getElementById(n);var l="POST_TITLE";var d=document.getElementById(l);var c=r.TAGS;if(!r){return}i=!o.Type.isUndefined(i)?!!i:true;a.EventEmitter.subscribe(r,"onAutoSavePrepare",function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),o=i[0],a=i[1];o.DISABLE_STANDARD_NOTIFY=true;var n=o;setTimeout(function(){s.bindLHEEvents(n)},100)});a.EventEmitter.subscribe(r,"onAutoSave",function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),s=i[0],o=i[1];o.TAGS=c.value;delete o.POST_MESSAGE});if(t=="Y"){a.EventEmitter.subscribe(r,"onAutoSaveRestoreFound",function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),s=i[0],a=i[1];var r=a["text".concat(n)];r=o.Type.isStringFilled(r)?r.trim():"";var d=a[l];d=o.Type.isStringFilled(d)?d.trim():"";if(!o.Type.isStringFilled(r)&&!o.Type.isStringFilled(d)){return}s.Restore()})}else{a.EventEmitter.subscribe(r,"onAutoSaveRestoreFound",function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),s=i[0],a=i[1];var r=a["text".concat(n)];r=o.Type.isStringFilled(r)?r.trim():"";var d=a[l];d=o.Type.isStringFilled(d)?d.trim():"";if(!o.Type.isStringFilled(r)&&!o.Type.isStringFilled(d)){return}var c=document.getElementById("microoPostFormLHE_blogPostForm");var u=o.Dom.create("DIV",{attrs:{className:"feed-add-successfully"},children:[o.Dom.create("SPAN",{attrs:{className:"feed-add-info-icon"}}),o.Dom.create("A",{attrs:{className:"feed-add-info-text",href:"#"},events:{click:function e(){s.Restore();u.parentNode.removeChild(u);return false}},text:o.Loc.getMessage("BLOG_POST_AUTOSAVE2")})]});if(c){c.parentNode.insertBefore(u,c)}})}if(i){a.EventEmitter.subscribe(r,"onAutoSaveRestore",function(e){var t=e.getData(),i=babelHelpers.slicedToArray(t,2),r=i[0],c=i[1];d.value=c[l];if(o.Type.isStringFilled(c[l])&&c[l]!==d.getAttribute("placeholder")){if(document.getElementById("divoPostFormLHE_blogPostForm").style.display!=="none"){u.getInstance(n).showPanelTitle(true)}else{window.bShowTitle=true}if(o.Type.isFunction(d.__onchange)){d.__onchange()}}var m=window["BXPostFormTags_".concat(n)];if(c.TAGS.length>0&&m){var f=m.addTag(c.TAGS);if(f.length>0){BX.show(m.tagsArea)}}a.EventEmitter.emit("onAutoSaveRestoreDestination",new a.BaseEvent({compatData:[{formId:n,data:c}]}));s.bindLHEEvents(r)})}}},{key:"bindLHEEvents",value:function e(t){var i=document.getElementById("blogPostForm");var s=document.getElementById("POST_TITLE");var a=i.TAGS;o.Event.bind(s,"keydown",t.Init.bind(t));o.Event.bind(a,"keydown",t.Init.bind(t))}}]);return e}();e.PostForm=r;e.PostFormTabs=l;e.PostFormDateEnd=d;e.PostFormGratSelector=c;e.PostFormAutoSave=m;e.PostFormEditor=u})(this.BX.Socialnetwork.Livefeed=this.BX.Socialnetwork.Livefeed||{},BX.Main,BX.UI.EntitySelector,BX,BX,BX.Event);
//# sourceMappingURL=script.map.js