{"version":3,"file":"copilot-list.bundle.js","sources":["../src/components/message-text.js","../src/components/copilot-item.js","../src/classes/copilot-service.js","../src/classes/context-menu-manager.js","../src/copilot-list.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\nimport { Settings } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelUser, ImModelChat, ImModelRecentItem, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const MessageText = {\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['recent/getMessage'](this.recentItem.dialogId);\n\t\t},\n\t\tshowLastMessage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showLastMessage);\n\t\t},\n\t\thiddenMessageText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_LIST_RECENT_CHAT_TYPE_GROUP_V2');\n\t\t},\n\t\tisLastMessageAuthor(): boolean\n\t\t{\n\t\t\tif (!this.message)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.message.authorId === Core.getUserId();\n\t\t},\n\t\tlastMessageAuthorAvatar(): string\n\t\t{\n\t\t\tconst authorDialog = this.$store.getters['chats/get'](this.message.authorId);\n\n\t\t\tif (!authorDialog)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn authorDialog.avatar;\n\t\t},\n\t\tlastMessageAuthorAvatarStyle(): Object\n\t\t{\n\t\t\treturn { backgroundImage: `url('${this.lastMessageAuthorAvatar}')` };\n\t\t},\n\t\tmessageText(): string\n\t\t{\n\t\t\tconst formattedText = Parser.purifyRecent(this.recentItem);\n\t\t\tif (!formattedText)\n\t\t\t{\n\t\t\t\treturn this.hiddenMessageText;\n\t\t\t}\n\n\t\t\treturn formattedText;\n\t\t},\n\t\tformattedMessageText(): string\n\t\t{\n\t\t\tconst SPLIT_INDEX = 27;\n\n\t\t\treturn Utils.text.insertUnseenWhitespace(this.messageText, SPLIT_INDEX);\n\t\t},\n\t\tpreparedDraftContent(): string\n\t\t{\n\t\t\tconst phrase = this.loc('IM_LIST_RECENT_MESSAGE_DRAFT_2');\n\t\t\tconst PLACEHOLDER_LENGTH = '#TEXT#'.length;\n\t\t\tconst prefix = phrase.slice(0, -PLACEHOLDER_LENGTH);\n\n\t\t\treturn `\n\t\t\t\t<span class=\"bx-im-list-copilot-item__message_draft-prefix\">${prefix}</span>\n\t\t\t\t<span class=\"bx-im-list-copilot-item__message_text_content\">${this.formattedDraftText}</span>\n\t\t\t`;\n\t\t},\n\t\tformattedDraftText(): string\n\t\t{\n\t\t\treturn Parser.purify({ text: this.recentItem.draft.text, showIconIfEmptyText: false });\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-copilot-item__message_container\">\n\t\t\t<span class=\"bx-im-list-copilot-item__message_text\">\n\t\t\t\t<span v-if=\"recentItem.draft.text && dialog.counter === 0\" v-html=\"preparedDraftContent\"></span>\n\t\t\t\t<span v-else-if=\"!showLastMessage\">{{ hiddenMessageText }}</span>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<span v-if=\"isLastMessageAuthor\" class=\"bx-im-list-copilot-item__message_author-icon --self\"></span>\n\t\t\t\t\t<template v-else-if=\"message.authorId\">\n\t\t\t\t\t\t<span v-if=\"lastMessageAuthorAvatar\" :style=\"lastMessageAuthorAvatarStyle\" class=\"bx-im-list-copilot-item__message_author-icon --user\"></span>\n\t\t\t\t\t\t<span v-else class=\"bx-im-list-copilot-item__message_author-icon --user --default\"></span>\n\t\t\t\t\t</template>\n\t\t\t\t\t<span class=\"bx-im-list-copilot-item__message_text_content\">{{ formattedMessageText }}</span>\n\t\t\t\t</template>\n\t\t\t</span>\n\t\t</div>\n\t`,\n};\n","import 'main.date';\n\nimport { Core } from 'im.v2.application.core';\nimport { Settings, Layout } from 'im.v2.const';\nimport { Avatar, AvatarSize, ChatTitle } from 'im.v2.component.elements';\n\nimport { MessageText } from './message-text';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\n\nimport '../css/copilot-item.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem, ImModelChat, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const CopilotItem = {\n\tname: 'CopilotItem',\n\tcomponents: { Avatar, ChatTitle, MessageText },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\trecentItem(): ImModelRecentItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\treturn this.formatDate(this.message.date);\n\t\t},\n\t\tformattedCounter(): string\n\t\t{\n\t\t\treturn this.dialog.counter > 99 ? '99+' : this.dialog.counter.toString();\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.recentItem.dialogId, true);\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['recent/getMessage'](this.recentItem.dialogId);\n\t\t},\n\t\tlayout(): { name: string, entityId: string }\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tisChatSelected(): boolean\n\t\t{\n\t\t\tif (this.layout.name !== Layout.copilot.name)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.layout.entityId === this.recentItem.dialogId;\n\t\t},\n\t\tisChatMuted(): boolean\n\t\t{\n\t\t\tconst isMuted = this.dialog.muteList.find((element) => {\n\t\t\t\treturn element === Core.getUserId();\n\t\t\t});\n\n\t\t\treturn Boolean(isMuted);\n\t\t},\n\t\tisSomeoneTyping(): boolean\n\t\t{\n\t\t\treturn this.dialog.writingList.length > 0;\n\t\t},\n\t\tshowLastMessage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['application/settings/get'](Settings.recent.showLastMessage);\n\t\t},\n\t\tshowPinnedIcon(): boolean\n\t\t{\n\t\t\treturn this.recentItem.pinned && this.dialog.counter === 0 && !this.recentItem.unread;\n\t\t},\n\t\tshowCounter(): boolean\n\t\t{\n\t\t\treturn this.dialog.counter > 0;\n\t\t},\n\t\twrapClasses(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--pinned': this.recentItem.pinned,\n\t\t\t\t'--selected': this.isChatSelected,\n\t\t\t};\n\t\t},\n\t\titemClasses(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--no-text': !this.showLastMessage,\n\t\t\t};\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tformatDate(date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :data-id=\"recentItem.dialogId\" :class=\"wrapClasses\" class=\"bx-im-list-copilot-item__wrap\">\n\t\t\t<div :class=\"itemClasses\" class=\"bx-im-list-copilot-item__container\">\n\t\t\t\t<div class=\"bx-im-list-copilot-item__avatar_container\">\n\t\t\t\t\t<div class=\"bx-im-list-copilot-item__avatar_content\">\n\t\t\t\t\t\t<div class=\"bx-im-list-copilot-item__avatar_icon\"></div>\n\t\t\t\t\t\t<div v-if=\"isSomeoneTyping\" class=\"bx-im-list-copilot-item__avatar_typing\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-copilot-item__content_container\">\n\t\t\t\t\t<div class=\"bx-im-list-copilot-item__content_header\">\n\t\t\t\t\t\t<ChatTitle :dialogId=\"recentItem.dialogId\" :withMute=\"true\" />\n\t\t\t\t\t\t<div class=\"bx-im-list-copilot-item__date\">\n\t\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-list-copilot-item__content_bottom\">\n\t\t\t\t\t\t<MessageText :item=\"recentItem\" />\n\t\t\t\t\t\t<div :class=\"{'--extended': dialog.counter > 99}\" class=\"bx-im-list-copilot-item__counter_wrap\">\n\t\t\t\t\t\t\t<div class=\"bx-im-list-copilot-item__counter_container\">\n\t\t\t\t\t\t\t\t<div v-if=\"showPinnedIcon\" class=\"bx-im-list-copilot-item__pinned-icon\"></div>\n\t\t\t\t\t\t\t\t<div v-else-if=\"showCounter\" :class=\"{'--muted': isChatMuted}\" class=\"bx-im-list-copilot-item__counter_number\">\n\t\t\t\t\t\t\t\t\t{{ formattedCounter }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Messenger } from 'im.public';\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { RecentService } from 'im.v2.provider.service';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem } from 'im.v2.model';\n\nexport class CopilotRecentService extends RecentService\n{\n\tgetQueryParams(firstPage: boolean): JsonObject\n\t{\n\t\treturn {\n\t\t\tONLY_COPILOT: 'Y',\n\t\t\tLIMIT: this.itemsPerPage,\n\t\t\tLAST_MESSAGE_DATE: firstPage ? null : this.lastMessageDate,\n\t\t\tGET_ORIGINAL_TEXT: 'Y',\n\t\t\tPARSE_TEXT: 'Y',\n\t\t};\n\t}\n\n\tgetModelSaveMethod(): string\n\t{\n\t\treturn 'recent/setCopilot';\n\t}\n\n\tgetCollection(): ImModelRecentItem[]\n\t{\n\t\treturn Core.getStore().getters['recent/getCopilotCollection'];\n\t}\n\n\tgetExtractorOptions(): { withBirthdays?: boolean }\n\t{\n\t\treturn { withBirthdays: false };\n\t}\n\n\thideChat(dialogId)\n\t{\n\t\tLogger.warn('Im.CopilotRecentList: hide chat', dialogId);\n\t\tconst recentItem = Core.getStore().getters['recent/get'](dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/delete', {\n\t\t\tid: dialogId,\n\t\t});\n\n\t\tconst chatIsOpened = Core.getStore().getters['application/isChatOpen'](dialogId);\n\t\tif (chatIsOpened)\n\t\t{\n\t\t\tMessenger.openCopilot();\n\t\t}\n\n\t\tCore.getRestClient().callMethod(RestMethod.imRecentHide, { DIALOG_ID: dialogId }).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('Im.CopilotRecentList: hide chat error', error);\n\t\t});\n\t}\n}\n","import { Loc } from 'main.core';\n\nimport { Messenger } from 'im.public';\nimport { RecentMenu, type MenuItem } from 'im.v2.lib.menu';\n\nimport { CopilotRecentService } from './copilot-service';\n\nexport class CopilotRecentMenu extends RecentMenu\n{\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenItem(),\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getHideItem(),\n\t\t];\n\t}\n\n\tgetOpenItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.openCopilot(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetHideItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIST_COPILOT_MENU_HIDE'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.getRecentService().hideChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetRecentService(): CopilotRecentService\n\t{\n\t\tif (!this.service)\n\t\t{\n\t\t\tthis.service = new CopilotRecentService();\n\t\t}\n\n\t\treturn this.service;\n\t}\n}\n","import { CopilotDraftManager } from 'im.v2.lib.draft';\n\nimport { CopilotItem } from './components/copilot-item';\nimport { CopilotRecentService } from './classes/copilot-service';\nimport { CopilotRecentMenu } from './classes/context-menu-manager';\n\nimport './css/copilot-list.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem } from 'im.v2.model';\n\n// @vue/component\nexport const CopilotList = {\n\tname: 'CopilotList',\n\tcomponents: { CopilotItem },\n\temits: ['chatClick'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcollection(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.getRecentService().getCollection();\n\t\t},\n\t\tsortedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn [...this.collection].sort((a, b) => {\n\t\t\t\tconst firstDate = this.$store.getters['recent/getMessageDate'](a.dialogId);\n\t\t\t\tconst secondDate = this.$store.getters['recent/getMessageDate'](b.dialogId);\n\n\t\t\t\treturn secondDate - firstDate;\n\t\t\t});\n\t\t},\n\t\tpinnedItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.sortedItems.filter((item) => {\n\t\t\t\treturn item.pinned === true;\n\t\t\t});\n\t\t},\n\t\tgeneralItems(): ImModelRecentItem[]\n\t\t{\n\t\t\treturn this.sortedItems.filter((item) => {\n\t\t\t\treturn item.pinned === false;\n\t\t\t});\n\t\t},\n\t},\n\tasync created()\n\t{\n\t\tthis.contextMenuManager = new CopilotRecentMenu();\n\n\t\tthis.isLoading = true;\n\t\tawait this.getRecentService().loadFirstPage();\n\t\tthis.isLoading = false;\n\t\tCopilotDraftManager.getInstance().initDraftHistory();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods:\n\t{\n\t\tasync onScroll(event)\n\t\t{\n\t\t\tthis.contextMenuManager.close();\n\t\t\tif (!this.oneScreenRemaining(event) || !this.getRecentService().hasMoreItemsToLoad)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.getRecentService().loadNextPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonClick(item, event)\n\t\t{\n\t\t\tthis.$emit('chatClick', item.dialogId);\n\t\t},\n\t\tonRightClick(item, event)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tthis.contextMenuManager.openMenu(item, event.currentTarget);\n\t\t},\n\t\toneScreenRemaining(event): boolean\n\t\t{\n\t\t\tconst bottomPointOfVisibleContent = event.target.scrollTop + event.target.clientHeight;\n\t\t\tconst containerHeight = event.target.scrollHeight;\n\t\t\tconst oneScreenHeight = event.target.clientHeight;\n\n\t\t\treturn bottomPointOfVisibleContent >= containerHeight - oneScreenHeight;\n\t\t},\n\t\tgetRecentService(): CopilotRecentService\n\t\t{\n\t\t\tif (!this.service)\n\t\t\t{\n\t\t\t\tthis.service = new CopilotRecentService();\n\t\t\t}\n\n\t\t\treturn this.service;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-copilot__scope bx-im-list-copilot__container\">\n\t\t\t<div @scroll=\"onScroll\" class=\"bx-im-list-copilot__scroll-container\">\n\t\t\t\t<div v-if=\"pinnedItems.length > 0\" class=\"bx-im-list-copilot__pinned_container\">\n\t\t\t\t\t<CopilotItem\n\t\t\t\t\t\tv-for=\"item in pinnedItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item, $event)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-copilot__general_container\">\n\t\t\t\t\t<CopilotItem\n\t\t\t\t\t\tv-for=\"item in generalItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t@click=\"onClick(item, $event)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\t\n\t\t\t\t<div v-if=\"isLoading\" class=\"bx-im-list-copilot__loading\"></div>\n\t\t\t\t<div v-else-if=\"collection.length === 0\" class=\"bx-im-list-copilot__empty\">\n\t\t\t\t\t<div class=\"bx-im-list-copilot__empty_icon\"></div>\n\t\t\t\t\t<div class=\"bx-im-list-copilot__empty_text\">{{ loc('IM_LIST_COPILOT_EMPTY') }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["MessageText","props","item","type","Object","required","data","computed","recentItem","dialog","$store","getters","dialogId","user","message","showLastMessage","Settings","recent","hiddenMessageText","$Bitrix","Loc","getMessage","isLastMessageAuthor","authorId","Core","getUserId","lastMessageAuthorAvatar","authorDialog","avatar","lastMessageAuthorAvatarStyle","backgroundImage","messageText","formattedText","Parser","purifyRecent","formattedMessageText","SPLIT_INDEX","Utils","text","insertUnseenWhitespace","preparedDraftContent","phrase","loc","PLACEHOLDER_LENGTH","length","prefix","slice","formattedDraftText","purify","draft","showIconIfEmptyText","methods","phraseCode","replacements","template","CopilotItem","name","components","Avatar","ChatTitle","AvatarSize","formattedDate","formatDate","date","formattedCounter","counter","toString","layout","isChatSelected","Layout","copilot","entityId","isChatMuted","isMuted","muteList","find","element","Boolean","isSomeoneTyping","writingList","showPinnedIcon","pinned","unread","showCounter","wrapClasses","itemClasses","DateFormatter","formatByTemplate","DateTemplate","CopilotRecentService","RecentService","getQueryParams","firstPage","ONLY_COPILOT","LIMIT","itemsPerPage","LAST_MESSAGE_DATE","lastMessageDate","GET_ORIGINAL_TEXT","PARSE_TEXT","getModelSaveMethod","getCollection","getStore","getExtractorOptions","withBirthdays","hideChat","Logger","warn","dispatch","id","chatIsOpened","Messenger","openCopilot","getRestClient","callMethod","RestMethod","imRecentHide","DIALOG_ID","catch","error","console","CopilotRecentMenu","RecentMenu","getMenuItems","getOpenItem","getPinMessageItem","getHideItem","onclick","context","menuInstance","close","getRecentService","service","CopilotList","emits","isLoading","collection","sortedItems","sort","a","b","firstDate","secondDate","pinnedItems","filter","generalItems","created","contextMenuManager","loadFirstPage","CopilotDraftManager","getInstance","initDraftHistory","beforeUnmount","destroy","onScroll","event","oneScreenRemaining","hasMoreItemsToLoad","loadNextPage","onClick","$emit","onRightClick","preventDefault","openMenu","currentTarget","bottomPointOfVisibleContent","target","scrollTop","clientHeight","containerHeight","scrollHeight","oneScreenHeight"],"mappings":"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"}