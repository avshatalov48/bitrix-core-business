this.BX=this.BX||{};(function(e,s,a){"use strict";var t=babelHelpers.classPrivateFieldLooseKey("enable");class l{constructor(e=false){Object.defineProperty(this,t,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,t)[t]=e}log(...e){if(babelHelpers.classPrivateFieldLooseBase(this,t)[t]){console.log(...e)}}}var i=babelHelpers.classPrivateFieldLooseKey("rootNode");var r=babelHelpers.classPrivateFieldLooseKey("template");var o=babelHelpers.classPrivateFieldLooseKey("style");var b=babelHelpers.classPrivateFieldLooseKey("lang");var n=babelHelpers.classPrivateFieldLooseKey("appId");var d=babelHelpers.classPrivateFieldLooseKey("appAllowedByTariff");var c=babelHelpers.classPrivateFieldLooseKey("fetchable");var p=babelHelpers.classPrivateFieldLooseKey("clickable");var v=babelHelpers.classPrivateFieldLooseKey("uniqueId");var h=babelHelpers.classPrivateFieldLooseKey("frame");var P=babelHelpers.classPrivateFieldLooseKey("logger");var u=babelHelpers.classPrivateFieldLooseKey("demoData");var L=babelHelpers.classPrivateFieldLooseKey("useDemoData");var F=babelHelpers.classPrivateFieldLooseKey("blockId");var f=babelHelpers.classPrivateFieldLooseKey("getFrameContent");var B=babelHelpers.classPrivateFieldLooseKey("getCoreConfigs");var H=babelHelpers.classPrivateFieldLooseKey("getAssetsConfigs");var g=babelHelpers.classPrivateFieldLooseKey("parseExtensionConfig");var y=babelHelpers.classPrivateFieldLooseKey("fetchData");var m=babelHelpers.classPrivateFieldLooseKey("message");var w=babelHelpers.classPrivateFieldLooseKey("bindEvents");var O=babelHelpers.classPrivateFieldLooseKey("onMessage");class j{constructor(e){Object.defineProperty(this,O,{value:k});Object.defineProperty(this,w,{value:I});Object.defineProperty(this,m,{value:A});Object.defineProperty(this,y,{value:N});Object.defineProperty(this,g,{value:D});Object.defineProperty(this,H,{value:K});Object.defineProperty(this,B,{value:T});Object.defineProperty(this,f,{value:E});Object.defineProperty(this,i,{writable:true,value:null});Object.defineProperty(this,r,{writable:true,value:void 0});Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:{}});Object.defineProperty(this,n,{writable:true,value:0});Object.defineProperty(this,d,{writable:true,value:true});Object.defineProperty(this,c,{writable:true,value:false});Object.defineProperty(this,p,{writable:true,value:false});Object.defineProperty(this,v,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:null});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:null});Object.defineProperty(this,L,{writable:true,value:false});Object.defineProperty(this,F,{writable:true,value:0});babelHelpers.classPrivateFieldLooseBase(this,v)[v]=`widget_${a.Text.getRandom(8)}`;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new l(e.debug||false);babelHelpers.classPrivateFieldLooseBase(this,i)[i]=a.Type.isString(e.rootNode)?document.querySelector(e.rootNode):null;babelHelpers.classPrivateFieldLooseBase(this,r)[r]=a.Type.isString(e.template)?e.template:"";babelHelpers.classPrivateFieldLooseBase(this,o)[o]=a.Type.isString(e.style)?e.style:null;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=a.Type.isObject(e.demoData)?e.demoData:null;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=a.Type.isBoolean(e.useDemoData)?e.useDemoData:false;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.lang||{};babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.blockId?a.Text.toNumber(e.blockId):0;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.appId?a.Text.toNumber(e.appId):0;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=babelHelpers.classPrivateFieldLooseBase(this,n)[n]&&a.Type.isBoolean(e.appAllowedByTariff)?e.appAllowedByTariff:true;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=a.Type.isBoolean(e.fetchable)?e.fetchable:false;const s=a.Type.isFunction(BX.Landing.getMode)&&BX.Landing.getMode()==="edit";babelHelpers.classPrivateFieldLooseBase(this,p)[p]=!s}mount(){return babelHelpers.classPrivateFieldLooseBase(this,f)[f]().then((e=>{babelHelpers.classPrivateFieldLooseBase(this,h)[h]=document.createElement("iframe");babelHelpers.classPrivateFieldLooseBase(this,h)[h].className="landing-widgetvue-iframe";babelHelpers.classPrivateFieldLooseBase(this,h)[h].sandbox="allow-scripts";babelHelpers.classPrivateFieldLooseBase(this,h)[h].srcdoc=e;babelHelpers.classPrivateFieldLooseBase(this,h)[h].onload=()=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]("getSize",{},babelHelpers.classPrivateFieldLooseBase(this,h)[h].contentWindow)};if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]>0&&babelHelpers.classPrivateFieldLooseBase(this,i)[i]&&!j.runningAppNodes.has(babelHelpers.classPrivateFieldLooseBase(this,i)[i])){const e=babelHelpers.classPrivateFieldLooseBase(this,i)[i].parentElement;a.Dom.clean(e);a.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,h)[h],e);j.runningAppNodes.add(babelHelpers.classPrivateFieldLooseBase(this,i)[i]);babelHelpers.classPrivateFieldLooseBase(this,w)[w]()}}))}}function E(){let e="";const s={id:babelHelpers.classPrivateFieldLooseBase(this,v)[v],origin:window.location.origin,fetchable:babelHelpers.classPrivateFieldLooseBase(this,c)[c],clickable:babelHelpers.classPrivateFieldLooseBase(this,p)[p]};return babelHelpers.classPrivateFieldLooseBase(this,B)[B]().then((s=>{e+=babelHelpers.classPrivateFieldLooseBase(this,g)[g](s);e+=babelHelpers.classPrivateFieldLooseBase(this,g)[g]({lang_additional:babelHelpers.classPrivateFieldLooseBase(this,b)[b]});if(babelHelpers.classPrivateFieldLooseBase(this,o)[o]){e+=`<link rel="stylesheet" href="${babelHelpers.classPrivateFieldLooseBase(this,o)[o]}">`}return babelHelpers.classPrivateFieldLooseBase(this,H)[H]()})).then((s=>{e+=babelHelpers.classPrivateFieldLooseBase(this,g)[g](s);if(!babelHelpers.classPrivateFieldLooseBase(this,d)[d]){throw new Error(a.Loc.getMessage("LANDING_WIDGETVUE_ERROR_PAYMENT"))}if(babelHelpers.classPrivateFieldLooseBase(this,L)[L]){if(!babelHelpers.classPrivateFieldLooseBase(this,u)[u]){babelHelpers.classPrivateFieldLooseBase(this,P)[P].log("Widget haven't demo data and can be render correctly")}return babelHelpers.classPrivateFieldLooseBase(this,u)[u]||{}}return babelHelpers.classPrivateFieldLooseBase(this,y)[y]()})).then((e=>{s.data=e})).catch((e=>{s.error=e.message||"error"})).then((()=>{const a=`\n\t\t\t\t\t<script>\n\t\t\t\t\t\tBX.ready(function() {\n\t\t\t\t\t\t\t(new BX.Landing.WidgetVue.Engine(\n\t\t\t\t\t\t\t\t${JSON.stringify(s)}\n\t\t\t\t\t\t\t)).render();\n\t\t\t\t\t\t});\n\t\t\t\t\t<\/script>\n\n\t\t\t\t\t<div id="${babelHelpers.classPrivateFieldLooseBase(this,v)[v]}">${babelHelpers.classPrivateFieldLooseBase(this,r)[r]}</div>\n\t\t\t\t`;e+=a;return e}))}function T(){const e=["main.core","ui.design-tokens"];const a=["bitrix24"];return s.Backend.getInstance().action("Block::getAssetsConfig",{extCodes:e,tplCodes:a})}function K(){const e=["landing.widgetvue.engine"];return s.Backend.getInstance().action("Block::getAssetsConfig",{extCodes:e})}function D(e){const s=`${document.location.protocol}//${document.location.host}`;let a="";if(e.lang_additional!==undefined){a+=`<script>BX.message(${JSON.stringify(e.lang_additional)})<\/script>`}(e.js||[]).forEach((e=>{a+=`<script src="${s}${e}"><\/script>`}));(e.css||[]).forEach((e=>{a+=`<link href="${s}${e}" type="text/css" rel="stylesheet" />`}));return a}function N(e={}){if(!babelHelpers.classPrivateFieldLooseBase(this,c)[c]){babelHelpers.classPrivateFieldLooseBase(this,P)[P].log("Fetch data is impossible now (haven`t handler)");return Promise.resolve({})}if(babelHelpers.classPrivateFieldLooseBase(this,L)[L]){return Promise.resolve(babelHelpers.classPrivateFieldLooseBase(this,u)[u]||{})}return s.Backend.getInstance().action("RepoWidget::fetchData",{blockId:babelHelpers.classPrivateFieldLooseBase(this,F)[F],params:e}).then((e=>{let s={};s=JSON.parse(e);if(s.error){throw new Error(s.error)}return s})).catch((s=>{const t=[`Fetch data error!\nWidget ID: ${babelHelpers.classPrivateFieldLooseBase(this,F)[F]}`];if(Object.keys(e)>0){t.push("\nFetch request params:",e)}if(a.Type.isString(s)){t.push(`\nError in JSON data: ${s}`)}else if(a.Type.isObject(s)){if(s instanceof Error&&s.message){t.push(`\nJavaScript error: ${s.message}`)}else if(s.result&&a.Type.isArray(s.result)&&s.result.length>0){t.push("\nError from backend:");s.result.forEach((e=>{t.push(e)}))}}babelHelpers.classPrivateFieldLooseBase(this,P)[P].log(...t);throw new Error(a.Loc.getMessage("LANDING_WIDGETVUE_ERROR_FETCH"))}))}function A(e,s={},a=window){a.postMessage({name:e,params:s,origin:babelHelpers.classPrivateFieldLooseBase(this,v)[v]},"*")}function I(){a.Event.bind(window,"message",babelHelpers.classPrivateFieldLooseBase(this,O)[O].bind(this))}function k(e){if(e.data&&e.data.origin&&e.data.name&&e.data.params&&a.Type.isObject(e.data.params)){if(e.data.origin!==babelHelpers.classPrivateFieldLooseBase(this,v)[v]){return}if(e.data.name==="fetchData"){babelHelpers.classPrivateFieldLooseBase(this,y)[y](e.data.params).then((s=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]("setData",{data:s},e.source)})).catch((s=>{babelHelpers.classPrivateFieldLooseBase(this,m)[m]("setError",{error:s},e.source)}))}if(e.data.name==="setSize"&&e.data.params.size!==undefined){babelHelpers.classPrivateFieldLooseBase(this,h)[h].height=parseInt(e.data.params.size,10)}if(e.data.name==="openApplication"&&babelHelpers.classPrivateFieldLooseBase(this,n)[n]>0){const s=a.Type.isObject(e.data.params)?e.data.params:{};BX.rest.AppLayout.openApplication(babelHelpers.classPrivateFieldLooseBase(this,n)[n],s)}if(e.data.name==="openPath"&&a.Type.isString(e.data.params.path)){BX.rest.AppLayout.openPath(babelHelpers.classPrivateFieldLooseBase(this,n)[n],{path:e.data.params.path})}}}j.runningAppNodes=new Set;e.WidgetVue=j})(this.BX.Landing=this.BX.Landing||{},BX.Landing,BX);
//# sourceMappingURL=widgetvue.bundle.map.js