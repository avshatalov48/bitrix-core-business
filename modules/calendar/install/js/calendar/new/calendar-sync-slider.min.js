(function(window){function SyncSlider(e){this.calendar=e.calendar;this.id=this.calendar.id+"_sync";this.zIndex=e.zIndex||1e3;this.sliderId="calendar:sync-slider";this.SLIDER_WIDTH=500;this.SLIDER_DURATION=80;this.DOM={button:e.button};this.config=this.calendar.util.config;this.syncInfo=this.config.syncInfo;if(this.DOM.button){BX.bind(this.DOM.button,"click",BX.proxy(this.show,this))}}SyncSlider.prototype={show:function(){this.init();BX.SidePanel.Instance.open(this.sliderId,{contentCallback:BX.delegate(this.create,this),width:this.SLIDER_WIDTH,animationDuration:this.SLIDER_DURATION});BX.addCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this));BX.addCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));this.calendar.disableKeyHandler()},close:function(){BX.SidePanel.Instance.close()},hide:function(e){if(e&&e.getSliderPage&&e.getSliderPage().getUrl()===this.sliderId){if(this.denyClose){e.denyAction()}else{BX.removeCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this))}}},destroy:function(e){if(e&&e.getSliderPage&&e.getSliderPage().getUrl()===this.sliderId){BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.SidePanel.Instance.destroy(this.sliderId);this.calendar.enableKeyHandler()}},init:function(){this.syncList=[{id:"google",label:BX.message("EC_CAL_SYNC_GOOGLE"),active:!!this.syncInfo.google.active,connected:!!this.syncInfo.google.connected,syncDate:this.syncInfo.google.syncDate,connectHandler:BX.delegate(function(e){BX.util.popup(this.config.googleCalDavStatus.authLink,500,600);return BX.PreventDefault(e||window.event)},this),disconnectHandler:BX.delegate(function(e){this.disconnectGoogle(e);return BX.PreventDefault(e||window.event)},this)},{id:"macosx",label:BX.message("EC_CAL_SYNC_MAC"),active:!!this.syncInfo.macosx.active,connected:!!this.syncInfo.macosx.connected,syncDate:this.syncInfo.macosx.syncDate,connectHandler:BX.delegate(function(e){this.connectMacOSX();return BX.PreventDefault(e||window.event)},this),disconnectHandler:BX.delegate(function(e){this.disconnectMacOSX();return BX.PreventDefault(e||window.event)},this)},{id:"iphone",label:BX.message("EC_CAL_SYNC_IPHONE"),active:!!this.syncInfo.iphone.active,connected:!!this.syncInfo.iphone.connected,syncDate:this.syncInfo.iphone.syncDate,connectHandler:BX.delegate(function(e){this.connectIphone();return BX.PreventDefault(e||window.event)},this),disconnectHandler:BX.delegate(function(e){this.disconnectIphone();return BX.PreventDefault(e||window.event)},this)},{id:"android",label:BX.message("EC_CAL_SYNC_ANDROID"),active:!!this.syncInfo.android.active,connected:!!this.syncInfo.android.connected,syncDate:this.syncInfo.android.syncDate,connectHandler:BX.delegate(function(e){this.connectAndroid();return BX.PreventDefault(e||window.event)},this),disconnectHandler:BX.delegate(function(e){this.disconnectAndroid();return BX.PreventDefault(e||window.event)},this)},{id:"outlook",label:BX.message("EC_CAL_SYNC_OUTLOOK"),active:!!this.syncInfo.outlook.active&&!BX.browser.IsMac(),connected:!!this.syncInfo.outlook.connected,syncDate:this.syncInfo.outlook.syncDate,connectHandler:BX.delegate(function(e){this.connectOutlook();return BX.PreventDefault(e||window.event)},this),disconnectHandler:BX.delegate(function(e){this.disconnectOutlook();return BX.PreventDefault(e||window.event)},this)},{id:"office365",label:BX.message("EC_CAL_SYNC_OFFICE_365"),active:!!this.syncInfo.office365.active,connected:!!this.syncInfo.office365.connected,syncDate:this.syncInfo.office365.syncDate},{id:"exchange",label:BX.message("EC_CAL_SYNC_EXCHANGE"),active:!!this.syncInfo.exchange.active,connected:!!this.syncInfo.exchange.connected,syncDate:this.syncInfo.exchange.syncDate,connectHandler:function(e){},disconnectHandler:function(e){},refreshHandler:BX.delegate(function(e){this.calendar.request({type:"post",data:{action:"exchange_sync"},handler:BX.delegate(function(e){if(e.result===false)alert(BX.message("EC_BAN_EXCH_NO_SYNC"));else BX.reload()},this)});return BX.PreventDefault(e||window.event)},this)}];this.syncList.forEach(function(e){if(e.active&&e.connected&&e.syncDate){e.syncDate=BX.parseDate(e.syncDate)}e.DOM={}});this.syncList.sort(function(e,n){if(e.active&&e.connected&&n.active&&n.connected&&e.syncDate&&n.syncDate){return n.syncDate.getTime()-e.syncDate.getTime()}if(e.active&&e.connected)return-1;if(n.active&&n.connected)return 1;return 0})},create:function(){this.DOM.wrap=BX.create("DIV",{props:{className:"calendar-slider-calendar-wrap calendar-custom-scroll"}});this.DOM.header=this.DOM.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-slider-header"},html:'<div class="calendar-head-area"><div class="calendar-head-area-inner"><div class="calendar-head-area-title">'+'<span class="calendar-head-area-name">'+BX.message("EC_CAL_SYNC_TITLE")+"</span>"+"</div></div></div>"}));this.DOM.sliderWorkarea=this.DOM.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-slider-workarea"},style:{minWidth:"auto"}}));this.DOM.tableWrap=this.DOM.sliderWorkarea.appendChild(BX.create("DIV",{props:{className:"calendar-slider-content calendar-slider-sync-content"}}));this.DOM.table=this.DOM.tableWrap.appendChild(BX.create("TABLE",{props:{className:"calendar-sync"}}));var e,n,t,a,s,c,i,o,l,d;for(o=0;o<this.syncList.length;o++){d=this.syncList[o];d.DOM={};if(d.active){l=BX.adjust(this.DOM.table.insertRow(-1),{props:{className:"calendar-sync-column"}});e=BX.adjust(l.insertCell(-1),{props:{className:"calendar-sync-cell calendar-sync-cell-icon"}}).appendChild(BX.create("DIV",{props:{className:"calendar-sync-platform-icon calendar-sync-platform-icon-"+this.syncList[o].id}}));n=BX.adjust(l.insertCell(-1),{props:{className:"calendar-sync-cell"}}).appendChild(BX.create("DIV",{props:{className:"calendar-sync-platform-name calendar-sync-cell"},text:this.syncList[o].label}));t=BX.adjust(l.insertCell(-1),{props:{className:"calendar-sync-cell"}});if(d.connected){a=t.appendChild(BX.create("DIV",{props:{className:"calendar-sync-info"}})).appendChild(BX.create("DIV",{props:{className:"calendar-sync-info-inner"}}));s=a.appendChild(BX.create("DIV",{props:{className:"calendar-sync-info-status"},text:BX.message("EC_CAL_SYNC_OK")}));if(d.syncDate){var r=this.calendar.util.formatDateUsable(d.syncDate);if(((new Date).getTime()-d.syncDate.getTime())/this.calendar.util.dayLength<3){r+=" "+this.calendar.util.formatTime(d.syncDate.getHours(),d.syncDate.getMinutes())}c=a.appendChild(BX.create("DIV",{props:{className:"calendar-sync-info-date"},html:r}))}if(d.id=="exchange"&&this.calendar.util.config.bExchange){n.style.cursor="pointer";BX.bind(n,"click",BX.proxy(this.syncExchange,this))}}i=BX.adjust(l.insertCell(-1),{props:{className:"calendar-sync-cell calendar-sync-cell-link"}});if(!d.connected&&d.connectHandler){d.DOM.connectLink=i.appendChild(BX.create("SPAN",{props:{className:"calendar-sync-link"},events:{click:d.connectHandler},text:BX.message("EC_CAL_SYNC_CONNECT")}))}else if(d.connected){if(d.disconnectHandler){d.DOM.disconnectLink=i.appendChild(BX.create("SPAN",{props:{className:"calendar-sync-link"},events:{click:d.disconnectHandler},text:BX.message("EC_CAL_SYNC_DISCONNECT")}))}if(d.refreshHandler){d.DOM.refreshLink=i.appendChild(BX.create("SPAN",{props:{className:"calendar-sync-link"},events:{click:d.refreshHandler},text:BX.message("EC_CAL_SYNC_REFRESH")}))}if(d.disconnectHandler&&d.refreshHandler){BX.addClass(i,"calendar-sync-two-links")}}d.DOM.row=l}}return this.DOM.wrap},syncSectionWithOutlook:function(section){if(section&&section.data.OUTLOOK_JS)try{eval(section.data.OUTLOOK_JS)}catch(e){}},disconnectGoogle:function(e){if(confirm(BX.message("EC_CAL_REMOVE_GOOGLE_SYNC_CONFIRM"))){var n,t=null;for(n=0;n<this.calendar.calDavConnections.length;n++){t=this.calendar.calDavConnections[n];if(t.account_type=="caldav_google_oauth"){break}}if(t&&t.id){this.calendar.request({type:"post",data:{action:"disconnect_google",connectionId:t.id},handler:BX.delegate(function(e){BX.reload()},this)})}}return BX.PreventDefault(e||window.event)},connectOutlook:function(){var e=this.calendar.sectionController.getSectionList(),n=this,t=[],a,s,c;for(s=0;s<e.length;s++){if(e[s].belongsToView()&&e[s].data.OUTLOOK_JS){t.push(e[s])}}if(t.length==1){this.syncSectionWithOutlook(t[0])}else{var i=this.getSyncItem("outlook");if(i){a=[];for(s=0;s<t.length;s++){a.push({id:"bx-calendar-outlook-"+t[s].id,text:BX.util.htmlspecialchars(t[s].name),color:t[s].color,className:"calendar-add-popup-section-menu-item",onclick:function(e){return function(){n.syncSectionWithOutlook(n.calendar.sectionController.getSection(e));n.sectionMenu.close()}}(t[s].id)})}this.sectionMenu=BX.PopupMenu.create("outlookSectionMenu"+this.calendar.id,i.DOM.connectLink,a,{closeByEsc:true,autoHide:true,zIndex:3200,offsetTop:0,offsetLeft:0,angle:true});this.sectionMenu.show();for(s=0;s<this.sectionMenu.menuItems.length;s++){if(this.sectionMenu.menuItems[s].layout.item){c=this.sectionMenu.menuItems[s].layout.item.querySelector(".menu-popup-item-icon");if(c){c.style.backgroundColor=this.sectionMenu.menuItems[s].color}}}}}},connectIphone:function(){this.showSyncHelp("iphone")},connectMacOSX:function(){this.showSyncHelp("macosx")},connectAndroid:function(){this.showSyncHelp("android")},disconnectIphone:function(){this.clearSyncInformation("iphone");var e=this.getSyncItem("iphone");if(e&&e.pDisconnectLink){var n=this;this.showInfoPopup(e.pDisconnectLink,BX.message("EC_CAL_DISCONNECT_IPHONE"),function(){n.syncInfo.iphone.connected=false;n.syncInfo.iphone.syncDate=false})}},disconnectMacOSX:function(){this.clearSyncInformation("mac");var e=this.getSyncItem("macosx");if(e&&e.pDisconnectLink){var n=this;this.showInfoPopup(e.pDisconnectLink,BX.message("EC_CAL_DISCONNECT_MAC"),function(){n.syncInfo.macosx.connected=false;n.syncInfo.macosx.syncDate=false})}},disconnectAndroid:function(){this.clearSyncInformation("android");var e=this.getSyncItem("android");if(e&&e.pDisconnectLink){var n=this;this.showInfoPopup(e.pDisconnectLink,BX.message("EC_CAL_DISCONNECT_ANDROID"),function(){n.syncInfo.android.connected=false;n.syncInfo.android.syncDate=false})}},disconnectOutlook:function(){this.clearSyncInformation("outlook");var e=this.getSyncItem("outlook");if(e&&e.pDisconnectLink){var n=this;this.showInfoPopup(e.pDisconnectLink,BX.message("EC_CAL_DISCONNECT_OUTLOOK"),function(){n.syncInfo.outlook.connected=false;n.syncInfo.outlook.syncDate=false})}},showInfoPopup:function(e,n,t){var a=BX.PopupWindowManager.create(this.id+"-disconnect-popup",e,{autoHide:true,closeByEsc:true,offsetTop:-1,offsetLeft:1,lightShadow:true,content:BX.create("DIV",{props:{className:"bxec-disconnect-popup-wrap"},html:n})});a.show(true);function s(){if(t&&typeof t=="function")t();if(a&&a.destroy){BX.removeCustomEvent(a,"onPopupClose",s);a.destroy();a=null}}BX.addCustomEvent(a,"onPopupClose",s)},buildSyncItem:function(e,n){if(!n)n=this.pWrap;if(e.active){e.pOuter=n.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-el "+(e.className||"")}}));e.pInner=e.pOuter.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-el-block"}}));if(!e.connected&&e.connectHandler){e.pConnectLink=e.pInner.appendChild(BX.create("A",{props:{className:"bxec-sect-access-connect-link"},text:BX.message("EC_CAL_SYNC_CONNECT")}));BX.bind(e.pConnectLink,"click",e.connectHandler)}e.pIcon=e.pInner.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-icon"}}));e.pTextWrap=e.pInner.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-text-wrap"},text:e.label}));if(!this.brightMode||e.connected)BX.addClass(e.pOuter,"bxec-sect-access-connected");if(e.connected){e.pInner.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-allowed-icon"}}));e.pInfoCont=e.pOuter.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-block-info bxec-sect-access-el-block-active"}}));var t=e.pInfoCont.appendChild(BX.create("TABLE",{props:{className:"bxec-sect-access-el-table"}}));var a=t.insertRow(-1);BX.adjust(a.insertCell(-1),{props:{className:"bxec-sect-access-status"},html:BX.message("EC_CAL_SYNC_OK")});var s=BX.adjust(a.insertCell(-1),{style:{textAlign:"right"}});if(e.syncDate){e.pSyncDate=s.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-status-time"}}));e.pSyncDate.innerHTML=e.syncDate}if(e.disconnectHandler){e.pDisconnectLink=s.appendChild(BX.create("SPAN",{props:{className:"bxec-sect-access-disconnect-link"},html:BX.message("EC_CAL_SYNC_DISCONNECT")}));BX.bind(e.pDisconnectLink,"click",e.disconnectHandler)}if(e.id=="exchange"&&this.calendar.util.config.bExchange){e.pTextWrap.style.cursor="pointer";BX.bind(e.pTextWrap,"click",BX.proxy(this.syncExchange,this))}}}},getSyncItem:function(e){var n;for(n=0;n<this.syncList.length;n++){if(this.syncList[n].active&&this.syncList[n].id==e){return this.syncList[n]}}},showSyncHelp:function(e){var n=[],t;var a=this.syncList.filter(function(n){return n.id==e});if(!a||!a[0])return;a=a[0];if(!a.DOM.helpCell){a.DOM.helpRow=BX.adjust(this.DOM.table.insertRow(a.DOM.row.rowIndex+1),{props:{className:"calendar-sync-column calendar-sync-desc"}});a.DOM.helpCell=BX.adjust(a.DOM.helpRow.insertCell(-1),{attrs:{colspan:"4"},props:{className:"calendar-sync-cell"}}).appendChild(BX.create("DIV",{props:{className:"calendar-sync-help-wrap"}}));if(e=="iphone"){a.DOM.helpCell.innerHTML=BX.message("EC_MOBILE_HELP_IPHONE")}else if(e=="macosx"){a.DOM.helpCell.innerHTML=BX.message("EC_MOBILE_HELP_MAC")}else if(e=="android"){a.DOM.helpCell.innerHTML=BX.message("EC_MOBILE_HELP_ANDROID")}if(e=="iphone"||e=="macosx"){n=n.concat(BX.findChildren(a.DOM.helpCell,{tagName:"SPAN",className:"bxec-link"},true));for(t=0;t<n.length;t++){if(n[t]&&n[t].nodeName){n[t].innerHTML=this.calendar.util.config.caldav_link_all}}}}if(BX.hasClass(a.DOM.helpCell,"open")){BX.removeClass(a.DOM.helpCell,"open");setTimeout(function(){a.DOM.helpRow.style.display="none"},300)}else{a.DOM.helpRow.style.display="";setTimeout(function(){BX.addClass(a.DOM.helpCell,"open")},0)}},clearSyncInformation:function(e){this.calendar.request({type:"post",data:{action:"clear_sync_info",sync_type:e},handler:BX.delegate(function(e){BX.reload()},this)})},showCalDavSyncDialog:function(){if(!this.calDavSyncDialog){var e=this.calendar.id;this.calDavSyncDialog={DOM:{content:BX.create("DIV",{props:{className:"calendar-caldav-popup-wrap"},html:'<div class="bxec-dav-list" id="'+e+'_caldav_list"></div>'})},popup:false};var n=this;this.calDavSyncDialog.popup=new BX.PopupWindow("BXCExternalDialog"+this.id,null,{overlay:{opacity:10},autoHide:false,closeByEsc:true,zIndex:4e3,width:600,offsetLeft:0,offsetTop:0,draggable:true,titleBar:BX.message("EC_CALDAV_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window bxc-popup-window-white",contentColor:"white",contentNoPaddings:true,buttons:[new BX.PopupWindowButton({text:BX.message("EC_ADD_CALDAV"),events:{click:function(){n.connections.push({name:BX.message("EC_NEW_CONNECTION_NAME"),link:"",user_name:""});n.displayConnection(n.connections[n.connections.length-1],n.connections.length-1)}}}),new BX.PopupWindowButton({text:BX.message("EC_SEC_SLIDER_SAVE"),className:"popup-window-button-accept",events:{click:function(){if(n.calDavSyncDialog.bLockClosing)return alert(BX.message("EC_CAL_DAV_CON_WAIT"));n.calDavSyncDialog.bLockClosing=true;n.saveCalDavConnections(function(e){n.calDavSyncDialog.bLockClosing=false;if(e){n.calDavSyncDialog.popup.close();BX.reload()}})}}}),new BX.PopupWindowButtonLink({text:BX.message("EC_SEC_SLIDER_CLOSE"),className:"popup-window-button-link-cancel",events:{click:function(){n.calDavSyncDialog.popup.close()}}})],content:this.calDavSyncDialog.DOM.content});BX.addCustomEvent(this.calDavSyncDialog.popup,"onPopupClose",BX.proxy(this.closeCalDavSyncDialog,this))}this.calDavSyncDialog.popup.show();this.calDavSyncDialog.DOM.list=BX(e+"_caldav_list");this.calendar.disableKeyHandler();this.calDavSyncDialog.curEditedConInd=false;BX.cleanNode(this.calDavSyncDialog.DOM.list);this.connections=BX.clone(this.calendar.util.getCalDavConnections());this.connections.forEach(this.displayConnection,this);if(this.connections.length==0){this.connections.push({name:BX.message("EC_NEW_CONNECTION_NAME"),link:"",user_name:""});this.displayConnection(this.connections[this.connections.length-1],this.connections.length-1)}},displayConnection:function(e,n){var t=this,a=this.calendar.id,s,c=this.calDavSyncDialog.DOM.list.appendChild(BX.create("DIV",{props:{id:a+"_dav_con_"+n,className:"calendar-caldav-item"}})),i=c.appendChild(BX.create("DIV",{props:{className:"calendar-caldav-item-title"}})),o=i.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-dav-item-status"}})),l=i.appendChild(BX.create("SPAN",{text:e.name})),d=i.appendChild(BX.create("SPAN",{text:""})),r=i.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-dav-del"},text:BX.message("EC_CALDAV_DEL")}));if(e.id>0&&(e.account_type=="google_api_oauth"||e.account_type=="caldav_google_oauth")){s=c.appendChild(BX.create("DIV",{props:{className:"bxec-dav-new-form"},html:'<div class="calendar-caldav-field-container-wrap">'+'<div  class="calendar-caldav-sections-outer-wrap" id="'+a+"_dav_sections_cont_outer"+n+'">'+'<div class="calendar-caldav-sections-title">'+BX.message("EC_ADD_CALDAV_SECTIONS")+" : </div>"+'<div class="calendar-caldav-sections-wrap" id="'+a+"_dav_sections_cont"+n+'"></div>'+"</div>"+"</div>"}))}else{s=c.appendChild(BX.create("DIV",{props:{className:"bxec-dav-new-form"},html:'<div  class="calendar-caldav-field-container-wrap">'+'<div class="calendar-field-container calendar-field-container-string"><div class="calendar-field-block"><input id="'+a+"_caldav_name"+n+'" type="text" placeholder="'+BX.message("EC_ADD_CALDAV_NAME")+'" class="calendar-field calendar-field-string"></div></div>'+'<div class="calendar-field-container calendar-field-container-string"><div class="calendar-field-block"><input id="'+a+"_caldav_link"+n+'" type="text" placeholder="'+BX.message("EC_ADD_CALDAV_LINK")+'" class="calendar-field calendar-field-string"></div></div>'+'<div class="calendar-field-container calendar-field-container-string"><div class="calendar-field-block"><input id="'+a+"_caldav_username"+n+'" type="text" placeholder="'+BX.message("EC_ADD_CALDAV_USER_NAME")+'" class="calendar-field calendar-field-string"></div></div>'+'<div class="calendar-field-container calendar-field-container-string"><div class="calendar-field-block"><input id="'+a+"_caldav_password"+n+'" type="password" placeholder="'+BX.message("EC_ADD_CALDAV_PASS")+'" class="calendar-field calendar-field-string"></div></div>'+'<div  class="calendar-caldav-sections-outer-wrap" id="'+a+"_dav_sections_cont_outer"+n+'">'+'<div class="calendar-caldav-sections-title">'+BX.message("EC_ADD_CALDAV_SECTIONS")+" : </div>"+'<div class="calendar-caldav-sections-wrap" id="'+a+"_dav_sections_cont"+n+'"></div>'+"</div>"+"</div>"}))}if(e.id>0){if(e.last_result&&e.last_result.indexOf("[200]")>=0){o.className="bxec-dav-item-status bxec-dav-ok";o.title=BX.message("EC_CALDAV_SYNC_OK")+". "+BX.message("EC_CALDAV_SYNC_DATE")+": "+e.sync_date}else{o.className+="bxec-dav-item-status bxec-dav-error";o.title=BX.message("EC_CALDAV_SYNC_ERROR")+": "+e.last_result+". "+BX.message("EC_CALDAV_SYNC_DATE")+": "+e.sync_date}var p=0;e.sections={};this.calendar.sectionController.sections.forEach(function(t){if(t.belongsToView()&&(t.isCalDav()||t.isGoogle())&&t.data.CAL_DAV_CON==e.id){p++;var s=BX(a+"_dav_sections_cont"+n).appendChild(BX.create("DIV",{props:{className:"bxec-dav-sect"}}));e.sections[t.id]={section:t,checkbox:s.appendChild(BX.create("SPAN",{props:{className:"bxec-dav-sect-check"}})).appendChild(BX.create("INPUT",{props:{type:"checkbox",id:a+"_dav_sections_cont"+n+t.id,checked:t.isActive()}}))};s.appendChild(BX.create("SPAN",{props:{className:"bxc-spd-sect-label"},html:'<label for="'+a+"_dav_sections_cont"+n+t.id+'"><span>'+BX.util.htmlspecialchars(t.name)+"</span></label>"}))}},this);d.innerHTML=" ("+p+")";if(p>0){BX(a+"_dav_sections_cont_outer"+n).style.display=""}else{BX(a+"_dav_sections_cont_outer"+n).style.display="none"}r.style.display="inline-block"}else{BX(a+"_dav_sections_cont_outer"+n).style.display="none";r.style.display="none"}e.nameInput=BX(a+"_caldav_name"+n)||false;e.linkInput=BX(a+"_caldav_link"+n)||false;e.userInput=BX(a+"_caldav_username"+n)||false;e.passInput=BX(a+"_caldav_password"+n)||false;r.onclick=function(n){if(e.id>0&&(e.account_type=="google_api_oauth"||e.account_type=="caldav_google_oauth")){t.disconnectGoogle(n)}else{}return BX.PreventDefault(n)}},saveCalDavConnections:function(e){var n=[];this.connections.forEach(function(e){var t,a={};for(t in e.sections){if(e.sections.hasOwnProperty(t)){a[t]=e.sections[t].checkbox.checked?"Y":"N"}}var s={id:e.id||0,name:e.nameInput?e.nameInput.value:e.name,link:e.linkInput?e.linkInput.value:e.link,user_name:e.userInput?e.userInput.value:e.user_name,pass:e.passInput&&e.passInput.value?e.passInput.value:"bxec_not_modify_pass",del:e.del?"Y":"N",del_calendars:"Y",sections:a};if(!e.id&&(!s.name||!s.user_name||!s.pass))return;n.push(s)},this);this.calendar.request({type:"post",data:{action:"connections_edit",connections:n},handler:BX.delegate(function(n){setTimeout(function(){if(BX.type.isFunction(e))e(true)},100);if(n.result===false)alert(BX.message("EC_BAN_EXCH_NO_SYNC"));else BX.reload()},this),onerror:BX.delegate(function(n){setTimeout(function(){if(BX.type.isFunction(e))e(false)},100)},this)});return true},closeCalDavSyncDialog:function(){this.calendar.enableKeyHandler();this.calDavSyncDialog.popup.destroy();this.calDavSyncDialog=null},showICalExportDialog:function(e){var n=this;if(!this.exportDialog){var t=BX.create("DIV",{html:"<span>"+BX.message("EC_EXP_TEXT")+"</span>"});this.exportDialog=new BX.PopupWindow("export_dialog"+this.calendar.id,null,{autoHide:false,closeByEsc:true,zIndex:4e3,offsetLeft:0,offsetTop:0,width:800,draggable:true,titleBar:BX.message("EC_JS_EXPORT_TILE"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:BX.message("EC_SEC_SLIDER_CLOSE"),className:"popup-window-button-link-cancel",events:{click:function(){n.exportDialog.close()}}})],content:t});this.exportDialog.DOM={}}this.exportDialog.show();var a=this.calendar.util.config.path;a+=a.indexOf("?")>=0?"&":"?";if(e&&e.data.EXPORT.LINK){a+="action=export"+e.data.EXPORT.LINK}this.exportDialog.DOM.link=t.appendChild(BX.create("DIV",{props:{className:""}})).appendChild(BX.create("A",{props:{href:a,target:"_blank"},html:a,events:{click:function(e){window.location.href="webcal"+a.substr(a.indexOf("://"));e.preventDefault();e.stopPropagation()}}}));BX.ajax.get(a+"&check=Y","",function(e){setTimeout(function(){if(!e||e.length<=0||e.toUpperCase().indexOf("BEGIN:VCALENDAR")==-1){alert(BX.message("EC_EDEV_EXP_WARN"))}},300)})}};if(window.BXEventCalendar){window.BXEventCalendar.SyncSlider=SyncSlider}else{BX.addCustomEvent(window,"onBXEventCalendarInit",function(){window.BXEventCalendar.SyncSlider=SyncSlider})}})(window);