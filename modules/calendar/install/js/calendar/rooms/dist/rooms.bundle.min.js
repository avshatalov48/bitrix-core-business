this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(e,t,s,i,a,o,r){"use strict";class n extends i.AddButton{constructor(e={}){super(e);this.setEventNamespace("BX.Calendar.Rooms.ReserveButton");this.zIndex=e.zIndex||3200;this.popupId=e.id||"add-button-"+Math.round(Math.random()*1e4);this.showTasks=e.showTasks;this.addEntryHandler=a.Type.isFunction(e.addEntry)?e.addEntry:null;this.addTaskHandler=a.Type.isFunction(e.addTask)?e.addTask:null;this.create()}create(){this.DOM.wrap=a.Dom.create("button",{props:{className:"ui-btn ui-btn-success",type:"button"},html:a.Loc.getMessage("EC_RESERVE"),events:{click:this.addEntry.bind(this)}})}}let c=e=>e,l,d,h,g;class p extends s.EventEmitter{constructor(e={}){super();this.DOM={};this.isCreated=false;this.setEventNamespace("BX.Calendar.SectionInterface.EditForm");this.DOM.outerWrap=e.wrap;this.sectionAccessTasks=e.sectionAccessTasks;this.sectionManager=e.sectionManager;this.closeCallback=e.closeCallback;this.BX=o.Util.getBX();this.keyHandlerBinded=this.keyHandler.bind(this)}show(e={}){this.section=e.section;this.create();this.showAccess=e.showAccess!==false;this.allowChangeName=e.allowChangeName!==false;if(this.showAccess){this.DOM.accessLink.style.display="";this.DOM.accessWrap.style.display=""}else{this.DOM.accessLink.style.display="none";this.DOM.accessWrap.style.display="none"}a.Event.bind(document,"keydown",this.keyHandlerBinded);a.Dom.addClass(this.DOM.outerWrap,"show");if(e.section){if(e.section.color){this.setColor(e.section.color)}this.setAccess(e.section.access||e.section.data.ACCESS||{});if(e.section.name){this.DOM.sectionTitleInput.value=e.section.name}}if(this.allowChangeName){BX.focus(this.DOM.sectionTitleInput);if(this.DOM.sectionTitleInput.value!==""){this.DOM.sectionTitleInput.select()}}else{a.Dom.addClass(this.DOM.sectionTitleInput,"--disabled");this.DOM.sectionTitleInput.disabled=true}this.isOpenedState=true}close(){this.isOpenedState=false;a.Event.unbind(document,"keydown",this.keyHandlerBinded);a.Dom.removeClass(this.DOM.outerWrap,"show");if(a.Type.isFunction(this.closeCallback)){this.closeCallback()}}isOpened(){return this.isOpenedState}create(){this.wrap=this.DOM.outerWrap.querySelector(".calendar-form-content");if(this.wrap){a.Dom.clean(this.wrap)}else{this.wrap=this.DOM.outerWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-form-content"}}))}this.DOM.formFieldsWrap=this.wrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content"}})).appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content-block"}}));this.DOM.sectionTitleInput=this.DOM.formFieldsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-field-container calendar-field-container-string"}})).appendChild(a.Dom.create("DIV",{props:{className:"calendar-field-block"}})).appendChild(a.Dom.create("INPUT",{attrs:{type:"text",placeholder:a.Loc.getMessage("EC_SEC_SLIDER_SECTION_TITLE")},props:{className:"calendar-field calendar-field-string"}}));this.DOM.optionsWrap=this.DOM.formFieldsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-new-calendar-options-container"}}));this.initSectionColorSelector();this.initAccessController();this.buttonsWrap=this.DOM.formFieldsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-btn-container"}}));this.saveBtn=new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_SAVE"),className:"ui-btn ui-btn-success",events:{click:this.save.bind(this)}});this.saveBtn.renderTo(this.buttonsWrap);new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-link",events:{click:this.checkClose.bind(this)}}).renderTo(this.buttonsWrap);this.isCreated=true}keyHandler(e){if(e.keyCode===o.Util.getKeyCode("escape")){this.checkClose()}else if(e.keyCode===o.Util.getKeyCode("enter")){this.save()}}checkClose(){this.close()}save(){this.saveBtn.setWaiting(true);this.sectionManager.saveSection(this.DOM.sectionTitleInput.value,this.color,this.access,{section:this.section}).then((()=>{this.saveBtn.setWaiting(false);this.close()}))}initSectionColorSelector(){this.DOM.colorContWrap=this.DOM.optionsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-new-calendar-option-color"},html:a.Loc.getMessage("EC_SEC_SLIDER_COLOR")}));this.colorIcon=this.DOM.colorContWrap.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-color-selected"}}));this.colorChangeLink=this.DOM.colorContWrap.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-color-change"},html:a.Loc.getMessage("EC_SEC_SLIDER_CHANGE")}));a.Event.bind(this.colorIcon,"click",this.showSimplePicker.bind(this));a.Event.bind(this.colorChangeLink,"click",this.showSimplePicker.bind(this))}showSimplePicker(e){const t=a.Runtime.clone(o.Util.getDefaultColorList(),true);const s=a.Dom.create("DIV",{props:{className:"calendar-simple-color-wrap calendar-field-container-colorpicker-square"}});const i=s.appendChild(a.Dom.create("DIV",{events:{click:BX.delegate(this.simplePickerClick,this)}}));const r=s.appendChild(a.Dom.create("DIV",{props:{className:"calendar-simple-color-more-link-wrap"}}));const n=r.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-simple-color-more-link"},html:a.Loc.getMessage("EC_COLOR"),events:{click:BX.delegate(this.showFullPicker,this)}}));this.simplePickerColorWrap=i;this.colors=[];if(!t.includes(this.color)){t.push(this.color)}for(let e=0;e<t.length;e++){this.colors.push({color:t[e],node:i.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-field-colorpicker-color-item"},style:{backgroundColor:t[e]},attrs:{"data-bx-calendar-color":t[e]},html:'<span class="calendar-field-colorpicker-color"></span>'}))})}this.lastActiveNode=this.colors[BX.util.array_search(this.color,t)||0].node;a.Dom.addClass(this.lastActiveNode,"active");this.simpleColorPopup=BX.PopupWindowManager.create("simple-color-popup-"+o.Util.getRandomInt(),this.colorIcon,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:9,lightShadow:true,content:s,cacheable:false});this.simpleColorPopup.setAngle({offset:10});this.simpleColorPopup.show(true)}simplePickerClick(e){const t=o.Util.findTargetNode(e.target||e.srcElement,this.DOM.outerWrap);if(a.Type.isElementNode(t)){const e=t.getAttribute("data-bx-calendar-color");if(e!==null){if(this.lastActiveNode){a.Dom.removeClass(this.lastActiveNode,"active")}a.Dom.addClass(t,"active");this.lastActiveNode=t;this.setColor(e)}}}showFullPicker(){if(this.simpleColorPopup){this.simpleColorPopup.close()}if(!this.fullColorPicker){this.fullColorPicker=new BX.ColorPicker({bindElement:this.colorIcon,onColorSelected:BX.delegate((function(e){this.setColor(e)}),this),popupOptions:{cacheable:false,zIndex:this.zIndex,events:{onPopupClose:BX.delegate((function(){}),this)}}})}this.fullColorPicker.open()}setColor(e){this.colorIcon.style.backgroundColor=e;this.color=e}setAccess(e){let t=0;for(let s in e){if(e.hasOwnProperty(s)){t++}}this.accessRowsCount=t;this.access=e;for(let t in e){if(e.hasOwnProperty(t)){this.insertAccessRow(o.Util.getAccessName(t),t,e[t])}}this.checkAccessTableHeight()}initAccessController(){this.buildAccessController();if(this.sectionManager&&this.sectionManager.calendarType==="group"){this.initDialogGroup()}else{this.initDialogStandard()}this.initAccessSelectorPopup()}initAccessSelectorPopup(){a.Event.bind(this.DOM.accessWrap,"click",(e=>{const t=o.Util.findTargetNode(e.target||e.srcElement,this.DOM.outerWrap);if(a.Type.isElementNode(t)){if(t.getAttribute("data-bx-calendar-access-selector")!==null){const e=t.getAttribute("data-bx-calendar-access-selector");if(this.accessControls[e]){this.showAccessSelectorPopup({node:this.accessControls[e].removeIcon,setValueCallback:t=>{if(this.accessTasks[t]&&this.accessControls[e]){this.accessControls[e].valueNode.innerHTML=a.Text.encode(this.accessTasks[t].title);this.access[e]=t}}})}}else if(t.getAttribute("data-bx-calendar-access-remove")!==null){const e=t.getAttribute("data-bx-calendar-access-remove");if(this.accessControls[e]){a.Dom.remove(this.accessControls[e].rowNode);this.accessControls[e]=null;delete this.access[e]}}}}))}buildAccessController(){this.DOM.accessLink=this.DOM.optionsWrap.appendChild(a.Tag.render(l||(l=c`<div class="calendar-list-slider-new-calendar-option-more">${0}</div>`),a.Loc.getMessage("EC_SEC_SLIDER_ACCESS")));this.DOM.accessWrap=this.DOM.formFieldsWrap.appendChild(a.Tag.render(d||(d=c`
				<div class="calendar-list-slider-access-container">
					<div class="calendar-list-slider-access-inner-wrap">
						${0}
					</div>
					<div class="calendar-list-slider-new-calendar-options-container">
						${0}
					</div>
				</div>`),this.DOM.accessTable=a.Tag.render(h||(h=c`
							<table class="calendar-section-slider-access-table"></table>
						`)),this.DOM.accessButton=a.Tag.render(g||(g=c`
							<span class="calendar-list-slider-new-calendar-option-add">
								${0}
							</span>`),a.Loc.getMessage("EC_SEC_SLIDER_ACCESS_ADD"))));this.accessControls={};this.accessTasks=this.sectionAccessTasks;a.Event.bind(this.DOM.accessLink,"click",(()=>{if(a.Dom.hasClass(this.DOM.accessWrap,"shown")){a.Dom.removeClass(this.DOM.accessWrap,"shown")}else{a.Dom.addClass(this.DOM.accessWrap,"shown")}this.checkAccessTableHeight()}))}initDialogStandard(){a.Event.bind(this.DOM.accessButton,"click",(()=>{this.entitySelectorDialog=new r.Dialog({targetNode:this.DOM.accessButton,context:"CALENDAR",preselectedItems:[],enableSearch:true,events:{"Item:onSelect":this.handleEntitySelectorChanges.bind(this),"Item:onDeselect":this.handleEntitySelectorChanges.bind(this)},popupOptions:{targetContainer:document.body},entities:[{id:"user"},{id:"project"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}]});this.entitySelectorDialog.show()}))}initDialogGroup(){a.Event.bind(this.DOM.accessButton,"click",(()=>{this.entitySelectorDialog=new r.Dialog({targetNode:this.DOM.accessButton,context:"CALENDAR",preselectedItems:[],enableSearch:true,events:{"Item:onSelect":this.handleEntitySelectorChanges.bind(this),"Item:onDeselect":this.handleEntitySelectorChanges.bind(this)},popupOptions:{targetContainer:document.body},entities:[{id:"user"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}],tabs:[{id:"groupAccess",title:this.sectionManager.ownerName}],items:[{id:"SG"+this.sectionManager.ownerId+"_"+"A",entityId:"group",tabs:"groupAccess",title:a.Loc.getMessage("EC_ACCESS_GROUP_ADMIN")},{id:"SG"+this.sectionManager.ownerId+"_"+"E",entityId:"group",tabs:"groupAccess",title:a.Loc.getMessage("EC_ACCESS_GROUP_MODERATORS")},{id:"SG"+this.sectionManager.ownerId+"_"+"K",entityId:"group",tabs:"groupAccess",title:a.Loc.getMessage("EC_ACCESS_GROUP_MEMBERS")}]});this.entitySelectorDialog.show()}))}handleEntitySelectorChanges(){const e=this.entitySelectorDialog.getSelectedItems();this.entitySelectorDialog.hide();if(a.Type.isArray(e)){e.forEach((e=>{let t;if(e.entityId==="group"){t=this.sectionManager.ownerName+": "+e.title.text}else{t=e.title.text}const s=o.Util.convertEntityToAccessCode(e);o.Util.setAccessName(s,t);this.insertAccessRow(t,s)}))}a.Runtime.debounce((()=>{this.entitySelectorDialog.destroy()}),400)()}insertAccessRow(e,t,s){if(!this.accessControls[t]){if(s===undefined){for(let e in this.sectionAccessTasks){if(this.sectionAccessTasks.hasOwnProperty(e)&&this.sectionAccessTasks[e].name==="calendar_view"){s=e;break}}}const i=a.Dom.adjust(this.DOM.accessTable.insertRow(-1),{props:{className:"calendar-section-slider-access-table-row"}}),o=a.Dom.adjust(i.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},html:'<span class="calendar-section-slider-access-title">'+a.Text.encode(e)+":</span>"}),r=a.Dom.adjust(i.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},attrs:{"data-bx-calendar-access-selector":t}}),n=r.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-section-slider-access-container"}})),c=n.appendChild(a.Dom.create("SPAN",{text:this.accessTasks[s]?this.accessTasks[s].title:"",props:{className:"calendar-section-slider-access-value"}})),l=n.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-section-slider-access-remove"},attrs:{"data-bx-calendar-access-remove":t}}));this.access[t]=s;this.accessControls[t]={rowNode:i,titleNode:o,valueNode:c,removeIcon:l}}}checkAccessTableHeight(){if(this.checkTableTimeout){this.checkTableTimeout=clearTimeout(this.checkTableTimeout)}this.checkTableTimeout=setTimeout((()=>{if(a.Dom.hasClass(this.DOM.accessWrap,"shown")){if(this.DOM.accessWrap.offsetHeight-this.DOM.accessTable.offsetHeight<36){this.DOM.accessWrap.style.maxHeight=parseInt(this.DOM.accessTable.offsetHeight)+100+"px"}}else{this.DOM.accessWrap.style.maxHeight=""}}),300)}showAccessSelectorPopup(e){if(this.accessPopupMenu&&this.accessPopupMenu.popupWindow&&this.accessPopupMenu.popupWindow.isShown()){return this.accessPopupMenu.close()}const t=this;const s=[];for(let i in this.accessTasks){if(this.accessTasks.hasOwnProperty(i)){s.push({text:this.accessTasks[i].title,onclick:function(s){return function(){e.setValueCallback(s);t.accessPopupMenu.close()}}(i)})}}this.accessPopupMenu=this.BX.PopupMenu.create("section-access-popup"+o.Util.randomInt(),e.node,s,{closeByEsc:true,autoHide:true,offsetTop:-5,offsetLeft:0,angle:true,cacheable:false});this.accessPopupMenu.show()}}let u=e=>e,m,C,f,y,M,E,b,O;class D extends p{constructor(e={}){super(e);this.setEventNamespace("BX.Calendar.Rooms.EditFormRoom");this.DOM.outerWrap=e.wrap;this.roomsManager=e.roomsManager;this.categoryManager=e.categoryManager;this.capacityNumbers=[3,5,7,10,25];this.zIndex=e.zIndex||3100;this.closeCallback=e.closeCallback;this.BX=o.Util.getBX();this.keyHandlerBinded=this.keyHandler.bind(this);this.freezeButtonsCallback=e.freezeButtonsCallback}show(e={}){this.setParams(e);this.create();if(this.showAccess){a.Dom.style(this.DOM.accessLink,"display",null);a.Dom.style(this.DOM.accessWrap,"display",null)}else{a.Dom.style(this.DOM.accessLink,"display","none");a.Dom.style(this.DOM.accessWrap,"display","none")}a.Event.bind(document,"keydown",this.keyHandlerBinded);a.Dom.addClass(this.DOM.outerWrap,"show");if(this.room){this.setInputValues(this.room)}this.setFocusOnInput();this.isOpenedState=true}setParams(e){this.actionType=e.actionType;this.room=e.room;this.showAccess=e.showAccess!==false}setInputValues(e){if(e.color){this.setColor(e.color)}this.setAccess(e.access||e.data.ACCESS||{});if(e.name){this.DOM.roomsTitleInput.value=e.name}if(this.room.capacity){this.DOM.roomsCapacityInput.value=e.capacity}}setFocusOnInput(){BX.focus(this.DOM.roomsTitleInput);if(this.DOM.roomsTitleInput.value!==""){this.DOM.roomsTitleInput.select()}}create(){this.wrap=this.getSliderContentWrap();this.DOM.formFieldsWrap=this.getFormFieldsWrap(this.wrap);this.DOM.roomsTitleInput=this.createTitleInput(this.DOM.formFieldsWrap);this.DOM.roomsCapacityInput=this.createCapacityInput(this.DOM.formFieldsWrap);this.DOM.categorySelect=this.DOM.formFieldsWrap.appendChild(this.renderCategorySelector());this.createBottomOptions(this.DOM.formFieldsWrap);this.createButtons(this.DOM.formFieldsWrap);this.isCreated=true}getSliderContentWrap(){let e=this.DOM.outerWrap.querySelector(".calendar-form-content");if(e){a.Dom.clean(e)}else{e=this.DOM.outerWrap.appendChild(a.Tag.render(m||(m=u`
					<div class="calendar-form-content"></div>
				`)))}return e}getFormFieldsWrap(e){return e.appendChild(a.Tag.render(C||(C=u`
				<div class="calendar-list-slider-widget-content"></div>
			`))).appendChild(a.Tag.render(f||(f=u`
				<div class="calendar-list-slider-widget-content-block"></div>
			`)))}createTitleInput(e){return e.appendChild(a.Tag.render(y||(y=u`
				<div class="calendar-field-container calendar-field-container-string">
					<div class="calendar-field-block">
						<input type="text" placeholder="${0}" 
							class="calendar-field calendar-field-string"
						/>
					</div>
				</div>
		`),a.Loc.getMessage("EC_SEC_SLIDER_SECTION_TITLE"))).querySelector(".calendar-field")}createCapacityInput(e){return e.appendChild(a.Tag.render(M||(M=u`
				<div class="calendar-field-container calendar-field-container-string">
					<div class="calendar-field-block">
						<div class ="calendar-list-slider-card-widget-title" style="margin-bottom: 0">
							<span class="calendar-list-slider-card-widget-title-text">
								${0}
							</span>
							<input type="number" class="calendar-field calendar-field-number" placeholder="0"/>
						</div>
					</div>
				</div>
		`),a.Loc.getMessage("EC_SEC_SLIDER_SECTION_CAPACITY"))).querySelector(".calendar-field")}renderCategorySelector(){const e=this.renderCategorySelectorWrap();this.categoryTagSelector=this.createCategoryTagSelector();this.categoryTagSelector.renderTo(e.querySelector(".calendar-list-slider-card-widget-title"));if(this.categoryTagSelector.isRendered()){this.onAfterCategorySelectorRender()}return e}renderCategorySelectorWrap(){return a.Tag.render(E||(E=u`
					<div class="calendar-field-container calendar-field-container-string">
						<div class="calendar-field-block">
							<div class ="calendar-list-slider-card-widget-title">
								<span class="calendar-list-slider-card-widget-title-text">
									${0}
								</span>
							</div>
						</div>
					</div>
		`),a.Loc.getMessage("EC_SEC_SLIDER_ROOM_CATEGORY"))}createCategoryTagSelector(){let e=[];e=this.prepareCategoriesForDialog(this.categoryManager.getCategories());this.selectedCategory=null;if(this.room&&this.room.categoryId){this.selectedCategory=this.prepareCategoriesForDialog([this.categoryManager.getCategory(this.room.categoryId)])}return new r.TagSelector({placeholder:a.Loc.getMessage("EC_SEC_SLIDER_CATEGORY_SELECTOR_PLACEHOLDER"),textBoxWidth:320,multiple:false,events:{onTagAdd:()=>{const e=this.categoryTagSelector.getItemsContainer();a.Dom.addClass(e,"calendar-room-form-category-selector-container-with-change-button")},onTagRemove:()=>{const e=this.categoryTagSelector.getItemsContainer();a.Dom.removeClass(e,"calendar-room-form-category-selector-container-with-change-button")}},dialogOptions:{context:"CALENDAR_CONTEXT",width:315,height:280,compactView:true,showAvatars:false,dropdownMode:true,tabs:[{id:"category",title:"categories",itemOrder:{title:"asc"},icon:"none"}],items:e,selectedItems:this.selectedCategory}})}onAfterCategorySelectorRender(){a.Dom.addClass(this.categoryTagSelector.getDialog().getContainer(),"calendar-room-form-category-selector-dialog");a.Dom.addClass(this.categoryTagSelector.getOuterContainer(),"calendar-field-tag-selector-outer-container");a.Dom.addClass(this.categoryTagSelector.getTextBox(),"calendar-field-tag-selector-text-box");if(this.selectedCategory!==null){const e=this.categoryTagSelector.getItemsContainer();a.Dom.addClass(e,"calendar-room-form-category-selector-container-with-change-button")}}createBottomOptions(e){this.DOM.optionsWrap=e.appendChild(a.Tag.render(b||(b=u`
			<div class="calendar-list-slider-new-calendar-options-container"></div>`)));this.initSectionColorSelector();this.initAccessController()}createButtons(e){this.buttonsWrap=e.appendChild(a.Tag.render(O||(O=u`
				<div class="calendar-list-slider-btn-container"></div>
			`)));if(this.actionType==="createRoom"){this.renderCreateButton(this.buttonsWrap)}else if(this.actionType==="updateRoom"){this.renderUpdateButton(this.buttonsWrap)}this.renderCancelButton(this.buttonsWrap)}renderCreateButton(e){this.saveBtn=new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_SAVE"),className:"ui-btn ui-btn-success",events:{click:this.createRoom.bind(this)}});this.saveBtn.renderTo(e)}renderUpdateButton(e){this.saveBtn=new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_SAVE"),className:"ui-btn ui-btn-success",events:{click:this.updateRoom.bind(this)}});this.saveBtn.renderTo(e)}renderCancelButton(e){new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-link",events:{click:this.checkClose.bind(this)}}).renderTo(e)}createRoom(){if(this.freezeButtonsCallback){this.freezeButtonsCallback()}this.saveBtn.setWaiting(true);this.roomsManager.createRoom({name:this.DOM.roomsTitleInput.value,capacity:this.DOM.roomsCapacityInput.value,color:this.color,access:this.access,categoryId:this.getSelectedCategory()}).then((()=>{this.saveBtn.setWaiting(false);this.close()}))}initAccessController(){this.buildAccessController();this.initDialogStandard();this.initAccessSelectorPopup()}updateRoom(){if(this.freezeButtonsCallback){this.freezeButtonsCallback()}this.saveBtn.setWaiting(true);this.roomsManager.updateRoom({id:this.room.id,location_id:this.room.location_id,name:this.DOM.roomsTitleInput.value,capacity:this.DOM.roomsCapacityInput.value,color:this.color,access:this.access,categoryId:this.getSelectedCategory()}).then((()=>{this.saveBtn.setWaiting(false);this.close()}))}keyHandler(e){if(this.categoryTagSelector.getDialog().isOpen()){return}if(e.keyCode===o.Util.getKeyCode("escape")){this.checkClose()}else if(e.keyCode===o.Util.getKeyCode("enter")&&this.actionType==="createRoom"){this.createRoom()}else if(e.keyCode===o.Util.getKeyCode("enter")&&this.actionType==="updateRoom"){this.updateRoom()}}prepareCategoriesForDialog(e){return e.map((e=>({id:e.id,entityId:"category",title:e.name,tabs:"category"})))}getSelectedCategory(){const e=this.categoryTagSelector.getDialog().getSelectedItems()[0];return e?e.id:null}}let S=e=>e,B,k,T,R,v,w;class _ extends p{constructor(e={}){super(e);this.setEventNamespace("BX.Calendar.Rooms.EditFormCategory");this.DOM.outerWrap=e.wrap;this.categoryManager=e.categoryManager;this.zIndex=e.zIndex||3100;this.closeCallback=e.closeCallback;this.BX=o.Util.getBX();this.keyHandlerBinded=this.keyHandler.bind(this);this.preparedSelectedRooms=[];this.freezeButtonsCallback=e.freezeButtonsCallback}show(e={}){this.setParams(e);if(this.category&&this.category.rooms){this.preparedSelectedRooms=this.prepareRoomsForDialog(this.category.rooms)}this.create();a.Event.bind(document,"keydown",this.keyHandlerBinded);a.Dom.addClass(this.DOM.outerWrap,"show");if(this.category){this.setInputValues(this.category)}this.setFocusOnInput();this.isOpenedState=true}setParams(e){this.actionType=e.actionType;this.category=e.category}setInputValues(){if(this.category.name){this.DOM.categoryTitleInput.value=this.category.name}}setFocusOnInput(){BX.focus(this.DOM.categoryTitleInput);if(this.DOM.categoryTitleInput.value!==""){this.DOM.categoryTitleInput.select()}}create(e){this.wrap=this.getSliderContentWrap();this.DOM.formFieldsWrap=this.getFormFieldsWrap(this.wrap);this.DOM.categoryTitleInput=this.createTitleInput(this.DOM.formFieldsWrap);this.DOM.locationSelector=this.DOM.formFieldsWrap.appendChild(this.renderRoomSelector());this.createButtons(this.DOM.formFieldsWrap);this.isCreated=true}getSliderContentWrap(){let e=this.DOM.outerWrap.querySelector(".calendar-form-content");if(e){a.Dom.clean(e)}else{e=this.DOM.outerWrap.appendChild(a.Tag.render(B||(B=S`
					<div class="calendar-form-content"></div>
				`)))}return e}getFormFieldsWrap(e){return e.appendChild(a.Tag.render(k||(k=S`
				<div class="calendar-list-slider-widget-content"></div>
			`))).appendChild(a.Tag.render(T||(T=S`
				<div class="calendar-list-slider-widget-content-block"></div>
			`)))}createTitleInput(e){return e.appendChild(a.Tag.render(R||(R=S`
				<div class="calendar-field-container calendar-field-container-string">
					<div class="calendar-field-block">
						<input type="text" placeholder="${0}" 
							class="calendar-field calendar-field-string"
						/>
					</div>
				</div>
		`),a.Loc.getMessage("EC_SEC_SLIDER_SECTION_TITLE"))).querySelector(".calendar-field")}renderRoomSelector(){const e=this.renderRoomSelectorWrap();this.roomTagSelector=this.createRoomTagSelector();this.roomTagSelector.renderTo(e.querySelector(".calendar-list-slider-card-widget-title"));if(this.roomTagSelector.isRendered()){this.onAfterRoomSelectorRender()}return e}renderRoomSelectorWrap(){return a.Tag.render(v||(v=S`
				<div class="calendar-field-container calendar-field-container-string">
					<div class="calendar-field-block" >
						<div class ="calendar-list-slider-card-widget-title" style="border: none">
							<span class="calendar-list-slider-card-widget-title-text">
								${0}
							</span>
						</div>
					</div>
				</div>
		`),a.Loc.getMessage("EC_SEC_SLIDER_ROOM_SELECTOR"))}createRoomTagSelector(){return new r.TagSelector({placeholder:a.Loc.getMessage("EC_SEC_SLIDER_ROOM_SELECTOR_PLACEHOLDER"),textBoxWidth:320,dialogOptions:{context:"CALENDAR_CONTEXT",width:315,height:280,compactView:true,showAvatars:true,dropdownMode:true,preload:true,entities:[{id:"room",dynamicLoad:true,filters:[{id:"calendar.roomFilter"}]}],selectedItems:this.preparedSelectedRooms,tabs:[{id:"room",title:"rooms",itemOrder:{title:"asc"},icon:"none"}]}})}onAfterRoomSelectorRender(){a.Dom.addClass(this.roomTagSelector.getDialog().getContainer(),"calendar-category-form-room-selector-dialog");a.Dom.addClass(this.roomTagSelector.getContainer(),"calendar-category-form-room-tag-selector");a.Dom.addClass(this.roomTagSelector.getOuterContainer(),"calendar-field-tag-selector-outer-container");a.Dom.addClass(this.roomTagSelector.getTextBox(),"calendar-field-tag-selector-text-box")}createButtons(e){this.buttonsWrap=e.appendChild(a.Tag.render(w||(w=S`
				<div class="calendar-list-slider-btn-container"></div>
			`)));if(this.actionType==="createCategory"){this.renderCreateButton(this.buttonsWrap)}else if(this.actionType==="updateCategory"){this.renderUpdateButton(this.buttonsWrap)}this.renderCancelButton(this.buttonsWrap)}renderCreateButton(e){this.saveBtn=new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_SAVE"),className:"ui-btn ui-btn-success",events:{click:this.createCategory.bind(this)}});this.saveBtn.renderTo(e)}renderUpdateButton(e){this.saveBtn=new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_SAVE"),className:"ui-btn ui-btn-success",events:{click:this.updateCategory.bind(this)}});this.saveBtn.renderTo(e)}renderCancelButton(e){new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-link",events:{click:this.checkClose.bind(this)}}).renderTo(e)}createCategory(){if(this.freezeButtonsCallback){this.freezeButtonsCallback()}this.saveBtn.setWaiting(true);const e=this.getSelectedRooms();this.categoryManager.createCategory({name:this.DOM.categoryTitleInput.value,rooms:e}).then((()=>{this.saveBtn.setWaiting(false);this.close()}))}updateCategory(){if(this.freezeButtonsCallback){this.freezeButtonsCallback()}const e=this.prepareRoomsBeforeUpdate(this.getSelectedRooms());const t=this.prepareRoomsBeforeUpdate(this.preparedSelectedRooms);const s=e.filter((e=>!t.includes(e)));const i=t.filter((t=>!e.includes(t)));this.saveBtn.setWaiting(true);this.categoryManager.updateCategory({toAddCategory:s,toRemoveCategory:i,id:this.category.id,name:this.DOM.categoryTitleInput.value}).then((()=>{this.saveBtn.setWaiting(false);this.close()}))}getSelectedRooms(){const e=this.roomTagSelector.getDialog().getSelectedItems();const t=[];e.map((e=>t.push(e.id)));return t}keyHandler(e){if(this.roomTagSelector.getDialog().isOpen()){return}if(e.keyCode===o.Util.getKeyCode("escape")){this.checkClose()}else if(e.keyCode===o.Util.getKeyCode("enter")&&this.actionType==="createCategory"){this.createCategory()}else if(e.keyCode===o.Util.getKeyCode("enter")&&this.actionType==="updateCategory"){this.updateCategory()}}prepareRoomsForDialog(e){return e.map((e=>({id:e.id,entityId:"room",title:e.name,avatarOptions:{bgColor:e.color,bgSize:"22px",bgImage:"none"},tabs:"room"})))}prepareRoomsBeforeUpdate(e){if(!e){return[]}return e.map((e=>{if(e.id){return parseInt(e.id,10)}return parseInt(e,10)}))}}let A=e=>e,I,W,x,L,N,X,F,U,H,P,z,G,V,$,Y,q,K,j;class J extends t.SectionInterface{constructor({calendarContext:e,readonly:t,roomsManager:s,categoryManager:i,isConfigureList:a=false}){super({calendarContext:e,readonly:t,roomsManager:s});this.SLIDER_WIDTH=400;this.SLIDER_DURATION=80;this.sliderId="calendar:rooms-slider";this.CATEGORY_ROOMS_SHOWN_ALL=0;this.CATEGORY_ROOMS_SHOWN_SOME=1;this.CATEGORY_ROOMS_SHOWN_NONE=2;this.setEventNamespace("BX.Calendar.RoomsInterface");this.roomsManager=s;this.categoryManager=i;this.isConfigureList=a;this.calendarContext=e;this.readonly=t;this.BX=o.Util.getBX();this.sliderOnClose=this.hide.bind(this);this.deleteRoomHandlerBinded=this.deleteRoomHandler.bind(this);this.refreshRoomsBinded=this.refreshRooms.bind(this);this.refreshCategoriesBinded=this.refreshCategories.bind(this);if(this.calendarContext!==null){if(this.calendarContext.util.config.accessNames){var r,n,c;o.Util.setAccessNames((r=this.calendarContext)==null?void 0:(n=r.util)==null?void 0:(c=n.config)==null?void 0:c.accessNames)}}this.setRoomsFromManager();this.setCategoriesFromManager()}addEventEmitterSubscriptions(){o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:create",this.refreshRoomsBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:update",this.refreshRoomsBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:delete",this.deleteRoomHandlerBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:pull-create",this.refreshRoomsBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:pull-update",this.refreshRoomsBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:pull-delete",this.deleteRoomHandlerBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms.Categories:create",this.refreshCategoriesBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms.Categories:update",this.refreshCategoriesBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms.Categories:delete",this.refreshCategoriesBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms.Categories:pull-create",this.refreshCategoriesBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms.Categories:pull-update",this.refreshCategoriesBinded);o.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms.Categories:pull-delete",this.refreshCategoriesBinded)}destroyEventEmitterSubscriptions(){o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:create",this.refreshRoomsBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:update",this.refreshRoomsBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:delete",this.deleteRoomHandlerBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:pull-create",this.refreshRoomsBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:pull-update",this.refreshRoomsBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:pull-delete",this.deleteRoomHandlerBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms.Categories:create",this.refreshCategoriesBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms.Categories:update",this.refreshCategoriesBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms.Categories:delete",this.refreshCategoriesBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms.Categories:pull-create",this.refreshCategoriesBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms.Categories:pull-update",this.refreshCategoriesBinded);o.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms.Categories:pull-delete",this.refreshCategoriesBinded)}createContent(){this.DOM.outerWrap=this.renderOuterWrap();this.DOM.titleWrap=this.DOM.outerWrap.appendChild(this.renderTitleWrap());if(!this.readonly){this.DOM.addButton=this.DOM.titleWrap.appendChild(this.renderAddButton());this.DOM.roomFormWrap=this.DOM.outerWrap.appendChild(this.renderRoomFormWrap())}this.createRoomBlocks();return this.DOM.outerWrap}renderOuterWrap(){return a.Tag.render(I||(I=A`
				<div class="calendar-list-slider-wrap"></div>
			`))}renderTitleWrap(){return a.Tag.render(W||(W=A`
				<div class="calendar-list-slider-title-container">
					<div class="calendar-list-slider-title">${0}</div>
				</div>
			`),a.Loc.getMessage("EC_SECTION_ROOMS"))}renderAddButton(){return a.Tag.render(x||(x=A`
				<span class="ui-btn-split ui-btn-light-border" style="margin-right: 0">
					<span class="ui-btn-main" onclick="${0}">
						${0}
					</span>
					<span id = "add-menu-button" class="ui-btn-menu" onclick="${0}"></span>
				</span>
		`),this.showEditRoomForm.bind(this),a.Loc.getMessage("EC_ADD"),this.showAddMenu.bind(this))}renderRoomFormWrap(){return a.Tag.render(L||(L=A`
				<div class="calendar-list-slider-card-widget calendar-list-slider-form-wrap">
					<div class="calendar-list-slider-card-widget-title">
						<span class="calendar-list-slider-card-widget-title-text">${0}</span>
					</div>
				</div>
		`),a.Loc.getMessage("EC_SEC_SLIDER_NEW_ROOM"))}showAddMenu(){const e=this.createAddMenuButtons();if(e&&e.length>0){this.addRoomMenu=this.createAddMenu(e);this.addRoomMenu.popupWindow.show();this.addRoomMenu.popupWindow.subscribe("onClose",(()=>{this.allowSliderClose()}));this.denySliderClose()}}createAddMenuButtons(){const e=[];e.push({text:a.Loc.getMessage("EC_ADD_LOCATION"),onclick:()=>{this.addRoomMenu.close();this.showEditRoomForm()}});e.push({text:a.Loc.getMessage("EC_ADD_CATEGORY"),onclick:()=>{this.addRoomMenu.close();this.showEditCategoryForm()}});return e}createAddMenu(e){const t={offsetLeft:20,closeByEsc:true,angle:{position:"top"},autoHide:true,offsetTop:0,cacheable:false};return new BX.PopupMenuWindow("add-menu-form-"+o.Util.getRandomInt(),BX("add-menu-button"),e,t)}createRoomBlocks(){this.setBlocksWrap();if(a.Type.isArray(this.rooms)||a.Type.isObject(this.categories)){this.categories["categories"].forEach((e=>{if(e.rooms.length!==0){this.createCategoryBlock(e,this.createBlockWrap(this.DOM.blocksWrap))}}));if(this.categories["default"].length>0){let e=this.createBlockWrap(this.DOM.blocksWrap);this.categories["default"].forEach((t=>this.createRoomBlock(t,e)))}this.categories["categories"].forEach((e=>{if(e.rooms.length===0&&this.categoryManager.canDo("edit")){this.createCategoryBlock(e,this.createBlockWrap(this.DOM.blocksWrap))}}))}if(this.isFrozen()){this.unfreezeButtons()}}setRoomsFromManager(){this.rooms=this.roomsManager.getRooms().filter((function(e){return e.belongsToView()||e.isPseudo()}))}setCategoriesFromManager(){this.categories=this.categoryManager.getCategoriesWithRooms(this.rooms)}setBlocksWrap(){if(this.DOM.blocksWrap){a.Dom.clean(this.DOM.blocksWrap);a.Dom.adjust(this.DOM.blocksWrap,{props:{className:""}})}else{this.DOM.blocksWrap=this.DOM.outerWrap.appendChild(a.Tag.render(N||(N=A`
					<div></div>
				`)))}}showEditRoomForm(e={}){if(typeof e.actionType==="undefined"){e.actionType="createRoom"}this.closeForms();const t=this.DOM.roomFormWrap.querySelector(".calendar-list-slider-card-widget-title-text");this.editSectionForm=new D({wrap:this.DOM.roomFormWrap,sectionAccessTasks:this.roomsManager.getSectionAccessTasks(),roomsManager:this.roomsManager,categoryManager:this.categoryManager,freezeButtonsCallback:this.freezeButtons.bind(this),closeCallback:()=>{this.allowSliderClose()}});let s=true;if(e.room&&e.room.id){t.innerHTML=a.Loc.getMessage("EC_SEC_SLIDER_EDIT_SECTION_ROOM");s=e.room.canDo("access")}else{t.innerHTML=a.Loc.getMessage("EC_SEC_SLIDER_NEW_ROOM")}this.editSectionForm.show({showAccess:s,room:e.room||{color:o.Util.getRandomColor(),access:this.roomsManager.getDefaultSectionAccess()},actionType:e.actionType});this.denySliderClose()}showEditCategoryForm(e={}){if(typeof e.actionType==="undefined"){e.actionType="createCategory"}this.closeForms();const t=this.DOM.roomFormWrap.querySelector(".calendar-list-slider-card-widget-title-text");this.editSectionForm=new _({wrap:this.DOM.roomFormWrap,sectionAccessTasks:this.roomsManager.getSectionAccessTasks(),categoryManager:this.categoryManager,freezeButtonsCallback:this.freezeButtons.bind(this),closeCallback:()=>{this.allowSliderClose()}});if(e.category&&e.category.id){t.innerHTML=a.Loc.getMessage("EC_SEC_SLIDER_EDIT_ROOM_CATEGORY")}else{t.innerHTML=a.Loc.getMessage("EC_SEC_SLIDER_NEW_CATEGORY")}this.editSectionForm.show({category:e.category||{},actionType:e.actionType});this.denySliderClose()}showRoomMenu(e,t){const s=t.closest("[data-bx-calendar-section]")||t.closest("[ data-bx-calendar-section-without-action]");if(a.Type.isElementNode(s)){a.Dom.addClass(s,"active")}const i=this.createRoomMenuButtons(e);if(i&&i.length>0){this.roomActionMenu=this.createRoomMenu(i,t);this.roomActionMenu.show();this.roomActionMenu.popupWindow.subscribe("onClose",(()=>{if(a.Type.isElementNode(s)){a.Dom.removeClass(s,"active")}this.allowSliderClose()}));this.denySliderClose()}else{a.Dom.removeClass(s,"active")}}createRoomMenuButtons(e){const t=[];if(e.canDo("view_time")&&!this.isConfigureList){t.push({text:a.Loc.getMessage("EC_SEC_LEAVE_ONE_ROOM"),onclick:()=>{this.roomActionMenu.close();this.showOnlyOneSection(e,this.roomsManager.rooms);this.updateAllCategoriesCheckboxState()}})}if(!this.readonly&&e.canDo("edit_section")){t.push({text:a.Loc.getMessage("EC_SEC_EDIT"),onclick:()=>{this.roomActionMenu.close();this.showEditRoomForm({room:e,actionType:"updateRoom"})}})}if(e.canDo("edit_section")&&e.belongsToView()){t.push({text:a.Loc.getMessage("EC_SEC_DELETE"),onclick:()=>{this.roomActionMenu.close();this.deleteRoom(e)}})}return t}createRoomMenu(e,t){const s={closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:9,angle:true,cacheable:false};return top.BX.PopupMenu.create("section-menu-"+o.Util.getRandomInt(),t,e,s)}refreshRooms(){this.setRoomsFromManager();this.setCategoriesFromManager();this.createRoomBlocks()}refreshCategories(){this.roomsManager.reloadRoomsFromDatabase().then(this.refreshRoomsBinded)}createBlockWrap(e){const t=e.appendChild(a.Tag.render(X||(X=A`
					<div class="calendar-list-slider-card-widget calendar-list-slider-category-widget">
						<div class="calendar-list-slider-widget-content">
							<div class="calendar-list-slider-widget-content-block">
								<ul class="calendar-list-slider-container"></ul>
							</div>
						</div>
					</div>
				`))).querySelector(".calendar-list-slider-container");a.Event.bind(t,"click",this.roomClickHandler.bind(this));return t}createCategoryBlock(e,t){if(!e.DOM){e.DOM={}}e.DOM.item=t.appendChild(this.renderCategoryBlockWrap(e));const s=this.categoryManager.getCategoryRooms(e,this.rooms);if(!this.isConfigureList&&s.length){e.setCheckboxStatus(this.determineCategoryCheckboxStatus(e,s));e.DOM.checkbox=e.DOM.item.appendChild(this.renderCategoryBlockCheckbox(e,s))}e.DOM.title=e.DOM.item.appendChild(this.renderCategoryBlockTitle(e));if(this.categoryManager.canDo("edit")||e.rooms.length>0){e.DOM.actionCont=e.DOM.item.appendChild(this.renderCategoryBlockActionsContainer(e))}this.createCategoryBlockContent(e,t);return e}renderCategoryBlockWrap(e){if(this.isConfigureList){return a.Tag.render(F||(F=A`
					<li class="calendar-list-slider-item-category"
						data-bx-calendar-category-without-action="${0}"
					>
					</li>
				`),e.id)}return a.Tag.render(U||(U=A`
					<li class="calendar-list-slider-item-category" data-bx-calendar-category="${0}"></li>
		`),e.id)}renderCategoryBlockCheckbox(e){let t="";if(e.checkboxStatus===this.CATEGORY_ROOMS_SHOWN_ALL){t="calendar-list-slider-item-checkbox-checked"}else if(e.checkboxStatus===this.CATEGORY_ROOMS_SHOWN_SOME){t="calendar-list-slider-item-checkbox-indeterminate"}return a.Tag.render(H||(H=A`
					<div class="calendar-title-checkbox calendar-list-slider-item-checkbox
						${0}" style="background-color: #a5abb2"
					>
					</div>
		`),t)}renderCategoryBlockActionsContainer(e){return a.Tag.render(P||(P=A`
					<div class="calendar-list-slider-item-actions-container
					calendar-list-slider-item-context-menu-category-wrap" 
						data-bx-calendar-category-menu="${0}"
					>
						<span class="calendar-list-slider-item-context-menu
							calendar-list-slider-item-context-menu-category"
						>
						</span>
					</div>
		`),e.id)}renderCategoryBlockTitle(e){return a.Tag.render(z||(z=A`
				<div class="calendar-list-slider-card-widget-title-text calendar-list-slider-item-category-text" 
					title="${0}"
				>
					${0}
				</div>
		`),a.Text.encode(e.name),a.Text.encode(e.name))}createCategoryBlockContent(e,t){if(e.rooms.length){e.rooms.forEach((e=>this.createRoomBlock(e,t)))}else{t.appendChild(a.Tag.render(G||(G=A`
					<li class="calendar-list-slider-card-widget-title-text">${0}</li>
				`),a.Loc.getMessage("EC_CATEGORY_EMPTY")))}}createRoomBlock(e,t){if(!e.DOM){e.DOM={}}e.DOM.item=t.appendChild(this.renderRoomBlockWrap(e));e.DOM.checkbox=e.DOM.item.appendChild(this.renderRoomBlockCheckbox(e));e.DOM.title=e.DOM.item.appendChild(this.renderRoomBlockTitle(e));e.DOM.actionCont=e.DOM.item.appendChild(this.renderRoomBlockActionsContainer(e));return e}renderRoomBlockWrap(e){if(this.isConfigureList){return a.Tag.render(V||(V=A`
					<li class="calendar-list-slider-item"  data-bx-calendar-section-without-action="${0}"></li>
			`),e.id)}return a.Tag.render($||($=A`
					<li class="calendar-list-slider-item" data-bx-calendar-section="${0}"></li>
		`),e.id)}renderRoomBlockCheckbox(e){if(this.isConfigureList){return a.Tag.render(Y||(Y=A`
					<div class="calendar-field-select-icon" style="background-color: ${0}"></div>
			`),e.color)}return a.Tag.render(q||(q=A`
				<div class="calendar-list-slider-item-checkbox 
					${0}" 
					style="background-color: ${0}"
				>
				</div>
		`),e.isShown()?"calendar-list-slider-item-checkbox-checked":"",e.color)}renderRoomBlockTitle(e){return a.Tag.render(K||(K=A`
				<div class="calendar-list-slider-item-name" title="${0}">
					${0}
				</div>
		`),a.Text.encode(e.name),a.Text.encode(e.name))}renderRoomBlockActionsContainer(e){return a.Tag.render(j||(j=A`
				<div class="calendar-list-slider-item-actions-container" data-bx-calendar-section-menu="${0}">
					<span class="calendar-list-slider-item-context-menu"></span>
				</div>
		`),e.id)}roomClickHandler(e){const t=o.Util.findTargetNode(e.target||e.srcElement,this.DOM.outerWrap);if(t&&t.getAttribute){if(t.getAttribute("data-bx-calendar-category")!==null){const e=this.categoryManager.getCategory(parseInt(t.getAttribute("data-bx-calendar-category"),10));if(e&&e.rooms.length>0){this.switchCategory(e,this.rooms)}}else if(t.getAttribute("data-bx-calendar-category-menu")!==null){let e=t.getAttribute("data-bx-calendar-category-menu");this.showCategoryMenu(this.categoryManager.getCategory(e),t)}else if(t.getAttribute("data-bx-calendar-section-menu")!==null){let e=t.getAttribute("data-bx-calendar-section-menu");this.showRoomMenu(this.roomsManager.getRoom(e),t)}else if(t.getAttribute("data-bx-calendar-section")!==null){let e=t.getAttribute("data-bx-calendar-section");const s=this.roomsManager.getRoom(e);this.switchSection(s);this.updateCategoryCheckboxState(this.categoryManager.getCategory(s.categoryId))}}}setRoomsForCategory(e){this.categoryManager.unsetCategoryRooms(e);const t=this.roomsManager.getRooms();const s=this.categoryManager;t.forEach((function(t){if(t.categoryId===e){s.getCategory(e).addRoom(t)}}),this)}showOnlyOneCategory(e,t){for(let s of t){if(s.categoryId===e.id){this.switchOnSection(s)}else{this.switchOffSection(s)}}this.updateAllCategoriesCheckboxState();this.calendarContext.reload()}showCategoryMenu(e,t){this.setRoomsForCategory(e.id);const s=this.createCategoryMenuButtons(e);if(s&&s.length>0){this.categoryActionMenu=this.createCategoryMenu(s,t);this.categoryActionMenu.show();this.categoryActionMenu.popupWindow.subscribe("onClose",(()=>{this.allowSliderClose()}));this.denySliderClose()}}createCategoryMenuButtons(e){const t=[];if(this.categoryManager.canDo("view")&&!this.isConfigureList&&e.rooms.length>0){t.push({text:a.Loc.getMessage("EC_SEC_LEAVE_ONE_ROOM"),onclick:()=>{this.categoryActionMenu.close();this.showOnlyOneCategory(e,this.roomsManager.rooms)}})}if(!this.readonly&&this.categoryManager.canDo("edit")){t.push({text:a.Loc.getMessage("EC_SEC_EDIT"),onclick:()=>{this.categoryActionMenu.close();this.showEditCategoryForm({category:e,actionType:"updateCategory"})}})}if(this.categoryManager.canDo("edit")){t.push({text:a.Loc.getMessage("EC_SEC_DELETE"),onclick:()=>{this.categoryActionMenu.close();this.freezeButtons();this.categoryManager.deleteCategory(e.id,this.unfreezeButtons.bind(this))}})}return t}createCategoryMenu(e,t){const s={closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:9,angle:true,cacheable:false};return top.BX.PopupMenu.create("category-menu-"+o.Util.getRandomInt(),t,e,s)}findCheckBoxNodes(e){return this.DOM.blocksWrap.querySelectorAll(".calendar-list-slider-item[data-bx-calendar-section='"+e+"'] .calendar-list-slider-item-checkbox")}destroy(e){if(e&&e.getSlider&&e.getSlider().getUrl()===this.sliderId){this.destroyEventEmitterSubscriptions();BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.SidePanel.Instance.destroy(this.sliderId);delete this.DOM.blocksWrap;if(this.roomActionMenu){this.roomActionMenu.close()}}}deleteRoomHandler(e){if(e&&e instanceof o.Util.getBX().Event.BaseEvent){const t=e.getData();const s=parseInt(t.id);this.rooms.forEach(((e,t)=>{if(parseInt(e.id)===s&&e.DOM&&e.DOM.item){a.Dom.addClass(e.DOM.item,"calendar-list-slider-item-disappearing");setTimeout((()=>{a.Dom.clean(e.DOM.item,true);this.rooms.splice(t,1)}),300)}}),this);this.closeForms()}this.refreshRooms()}deleteRoom(e){this.roomsManager.deleteRoom(e.id,e.location_id)}freezeButtons(){a.Dom.addClass(this.DOM.outerWrap,"calendar-content-locked")}unfreezeButtons(){a.Dom.removeClass(this.DOM.outerWrap,"calendar-content-locked")}isFrozen(){return a.Dom.hasClass(this.DOM.outerWrap,"calendar-content-locked")}updateCategoryCheckboxState(e){if(!e){return}const t=this.determineCategoryCheckboxStatus(e,this.roomsManager.rooms);if(e.checkboxStatus!==t){e.setCheckboxStatus(t);this.setCategoryCheckboxState(this.findCategoryCheckBoxNode(e.id),t)}}determineCategoryCheckboxStatus(e,t){let s=false;let i=false;t.forEach((t=>{if(t.categoryId===e.id){if(t.isShown()&&!s){s=true}if(!t.isShown()&&!i){i=true}}}));if(s&&i){return this.CATEGORY_ROOMS_SHOWN_SOME}if(s){return this.CATEGORY_ROOMS_SHOWN_ALL}return this.CATEGORY_ROOMS_SHOWN_NONE}switchCategory(e,t){const s=this.findCategoryCheckBoxNode(e.id);switch(e.checkboxStatus){case this.CATEGORY_ROOMS_SHOWN_SOME:case this.CATEGORY_ROOMS_SHOWN_NONE:this.switchOnCategoryRooms(e.id,t);this.setCategoryCheckboxState(s,this.CATEGORY_ROOMS_SHOWN_ALL);e.setCheckboxStatus(this.CATEGORY_ROOMS_SHOWN_ALL);break;case this.CATEGORY_ROOMS_SHOWN_ALL:this.switchOffCategoryRooms(e.id,t);this.setCategoryCheckboxState(s,this.CATEGORY_ROOMS_SHOWN_NONE);e.setCheckboxStatus(this.CATEGORY_ROOMS_SHOWN_NONE);break;default:break}this.calendarContext.reload()}setCategoryCheckboxState(e,t){a.Dom.removeClass(e,"calendar-list-slider-item-checkbox-checked");a.Dom.removeClass(e,"calendar-list-slider-item-checkbox-indeterminate");switch(t){case this.CATEGORY_ROOMS_SHOWN_SOME:a.Dom.addClass(e,"calendar-list-slider-item-checkbox-indeterminate");break;case this.CATEGORY_ROOMS_SHOWN_ALL:a.Dom.addClass(e,"calendar-list-slider-item-checkbox-checked");break;default:break}}findCategoryCheckBoxNode(e){return this.DOM.outerWrap.querySelector(".calendar-list-slider-item-category[data-bx-calendar-category='"+e+"'] .calendar-list-slider-item-checkbox")}switchOnCategoryRooms(e,t){t.forEach((t=>{if(t.categoryId===e&&!t.isShown()){this.switchOnSection(t)}}))}switchOffCategoryRooms(e,t){t.forEach((t=>{if(t.categoryId===e&&t.isShown()){this.switchOffSection(t)}}))}updateAllCategoriesCheckboxState(){this.categoryManager.getCategories().forEach((e=>this.updateCategoryCheckboxState(e)))}}e.ReserveButton=n;e.RoomsInterface=J;e.EditFormRoom=D})(this.BX.Calendar.Rooms=this.BX.Calendar.Rooms||{},BX.Calendar,BX.Event,BX.Calendar.Controls,BX,BX.Calendar,BX.UI.EntitySelector);
//# sourceMappingURL=rooms.bundle.map.js