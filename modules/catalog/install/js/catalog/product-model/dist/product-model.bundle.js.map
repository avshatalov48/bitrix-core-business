{"version":3,"file":"product-model.bundle.js","sources":["../src/error-collection.js","../src/image-collection.js","../src/field-collection.js","../src/right-action-dictionary.js","../src/store-collection.js","../src/product-model.js"],"sourcesContent":["import {ProductModel} from \"catalog.product-model\";\n\nexport class ErrorCollection\n{\n\terrors: Map = new Map();\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tgetErrors()\n\t{\n\t\treturn Object.fromEntries(this.errors);\n\t}\n\n\tsetError(code: string, text: string): ErrorCollection\n\t{\n\t\tthis.errors.set(code, {\n\t\t\tcode,\n\t\t\ttext\n\t\t});\n\t\tthis.model.onErrorCollectionChange();\n\n\t\treturn this;\n\t}\n\n\tremoveError(code: string): ErrorCollection\n\t{\n\t\tif (this.errors.has(code))\n\t\t{\n\t\t\tthis.errors.delete(code);\n\t\t}\n\t\tthis.model.onErrorCollectionChange();\n\n\t\treturn this;\n\t}\n\n\tclearErrors(): ErrorCollection\n\t{\n\t\tthis.errors.clear();\n\t\tthis.model.onErrorCollectionChange();\n\n\t\treturn this;\n\t}\n\n\thasErrors()\n\t{\n\t\treturn this.errors.size > 0;\n\t}\n}\n","import {Text, Type} from 'main.core';\nimport {ProductModel} from \"catalog.product-model\";\n\nexport class ImageCollection\n{\n\t#isEnabledSaving = false;\n\t#preview = '';\n\t#editInput = '';\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tisEnableFileSaving(): boolean\n\t{\n\t\treturn this.#isEnabledSaving;\n\t}\n\n\tenableFileSaving(): void\n\t{\n\t\tthis.#isEnabledSaving = true;\n\t}\n\n\tgetMorePhotoValues(): {}\n\t{\n\t\treturn this.morePhoto;\n\t}\n\n\tsetMorePhotoValues(values): void\n\t{\n\t\tthis.morePhoto = Type.isPlainObject(values) ? values : {};\n\t}\n\n\tremoveMorePhotoItem(fileId): boolean\n\t{\n\t\tfor (const index in this.morePhoto)\n\t\t{\n\t\t\tlet value = this.morePhoto[index];\n\n\t\t\tif (!Type.isObject(value))\n\t\t\t{\n\t\t\t\tvalue = Text.toInteger(value);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t(Type.isNumber(value) && value === Text.toInteger(fileId))\n\t\t\t\t|| (Type.isObject(value) && value.fileId === fileId)\n\t\t\t)\n\t\t\t{\n\t\t\t\tdelete this.morePhoto[index];\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetPreview(html: string): ImageCollection\n\t{\n\t\tthis.#preview = Type.isStringFilled(html) ? html : '';\n\n\t\treturn this;\n\t}\n\n\tsetEditInput(html: string): ImageCollection\n\t{\n\t\tthis.#editInput = Type.isStringFilled(html) ? html : '';\n\n\t\treturn this;\n\t}\n\n\tgetPreview(): string\n\t{\n\t\treturn this.#preview || '';\n\t}\n\n\tgetEditInput(): string\n\t{\n\t\treturn this.#editInput || '';\n\t}\n\n\taddMorePhotoItem(fileId, value): void\n\t{\n\t\tthis.morePhoto[fileId] = value;\n\t}\n}\n","import {Type} from 'main.core';\nimport {ProductModel} from \"catalog.product-model\";\n\nexport class FieldCollection\n{\n\tchangedFields: Map = new Map();\n\tfields: Map = new Map();\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tgetFields(): {}\n\t{\n\t\treturn Object.fromEntries(this.fields);\n\t}\n\n\tgetField(fieldName: string): any\n\t{\n\t\treturn this.fields.get(fieldName);\n\t}\n\n\tsetField(fieldName: string, value: any): FieldCollection\n\t{\n\t\tconst oldValue = this.fields.get(fieldName);\n\t\tthis.fields.set(fieldName, value);\n\t\tif (!this.changedFields.has(fieldName) && oldValue !== value)\n\t\t{\n\t\t\tthis.changedFields.set(fieldName, oldValue);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn (this.changedFields.size > 0);\n\t}\n\n\tclearChanged(savingFieldNames: [] = null): FieldCollection\n\t{\n\t\tif (Type.isNil(savingFieldNames))\n\t\t{\n\t\t\tthis.changedFields.clear();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsavingFieldNames.forEach((name) => {\n\t\t\t\tthis.removeFromChanged(name)\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tremoveFromChanged(fieldName): FieldCollection\n\t{\n\t\tthis.changedFields.delete(fieldName);\n\n\t\treturn this;\n\t}\n\n\tgetChangedFields(): {}\n\t{\n\t\tconst changedFieldValues = {};\n\n\t\tthis.fields.forEach((value, key) => {\n\t\t\tif (this.changedFields.has(key))\n\t\t\t{\n\t\t\t\tchangedFieldValues[key] = value;\n\t\t\t}\n\t\t})\n\n\t\treturn {...changedFieldValues};\n\t}\n\n\tgetChangedValues(): {}\n\t{\n\t\tconst changedFieldValues = {};\n\n\t\tthis.changedFields.forEach((value, key) => {\n\t\t\tchangedFieldValues[key] = value;\n\t\t})\n\n\t\treturn {...changedFieldValues};\n\t}\n\n\tinitFields(fields): FieldCollection\n\t{\n\t\tthis.fields.clear();\n\t\tthis.clearChanged();\n\t\tif (Type.isObject(fields))\n\t\t{\n\t\t\tObject.keys(fields).forEach((key) => {\n\t\t\t\tthis.fields.set(key, fields[key])\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n}\n","export class RightActionDictionary\n{\n\tstatic ACTION_PRODUCT_VIEW: string = 'catalog_product_view';\n\tstatic ACTION_PRODUCT_EDIT: string = 'catalog_product_edit';\n\tstatic ACTION_PRODUCT_ADD: string = 'catalog_product_add';\n}","import {ajax, Text, Type} from \"main.core\";\nimport {ProductModel} from \"catalog.product-model\";\nimport {RightActionDictionary} from \"./right-action-dictionary\";\n\nexport class StoreCollection\n{\n\t#map: Map = new Map();\n\t#inited: boolean = false;\n\n\tconstructor(model: ProductModel = {})\n\t{\n\t\tthis.model = model;\n\t}\n\n\tinit(map: {})\n\t{\n\t\tthis.#setInited(true);\n\t\tObject.keys(map).forEach((key) => {\n\t\t\tconst item = map[key];\n\t\t\tif (item['STORE_ID'] > 0)\n\t\t\t{\n\t\t\t\tthis.#map.set(\n\t\t\t\t\tText.toNumber(item['STORE_ID']),\n\t\t\t\t\t{\n\t\t\t\t\t\tAMOUNT: Text.toNumber(item['AMOUNT']),\n\t\t\t\t\t\tQUANTITY_RESERVED: Text.toNumber(item['QUANTITY_RESERVED']),\n\t\t\t\t\t\tSTORE_ID: Text.toNumber(item['STORE_ID']),\n\t\t\t\t\t\tSTORE_TITLE: Text.encode(item['STORE_TITLE']),\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n\n\trefresh(): {}\n\t{\n\t\tthis.clear();\n\t\tif (this.model.getSkuId() > 0 && this.model.checkAccess(RightActionDictionary.ACTION_PRODUCT_VIEW))\n\t\t{\n\t\t\tajax.runAction(\n\t\t\t\t'catalog.storeSelector.getProductStores',\n\t\t\t\t{\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tproductId: this.model.getSkuId(),\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.#setInited(true);\n\t\t\t\t\tresponse.data.forEach((item) => {\n\t\t\t\t\t\tif (!Type.isNil(item['STORE_ID']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#map.set(\n\t\t\t\t\t\t\t\tText.toNumber(item['STORE_ID']),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tAMOUNT: Text.toNumber(item['AMOUNT']),\n\t\t\t\t\t\t\t\t\tQUANTITY_RESERVED: Text.toNumber(item['QUANTITY_RESERVED']),\n\t\t\t\t\t\t\t\t\tSTORE_ID: Text.toNumber(item['STORE_ID']),\n\t\t\t\t\t\t\t\t\tSTORE_TITLE: item['STORE_TITLE'],\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.model.onChangeStoreData();\n\t\t\t\t});\n\t\t}\n\t}\n\n\tgetStoreAmount(storeId): any\n\t{\n\t\treturn this.#map.get(Text.toNumber(storeId))?.AMOUNT || 0;\n\t}\n\n\tgetStoreReserved(storeId): any\n\t{\n\t\treturn this.#map.get(Text.toNumber(storeId))?.QUANTITY_RESERVED || 0;\n\t}\n\n\tgetStoreAvailableAmount(storeId): any\n\t{\n\t\treturn this.getStoreAmount(storeId) - this.getStoreReserved(storeId);\n\t}\n\n\tgetMaxFilledStore(): {}\n\t{\n\t\tlet result = {\n\t\t\t'STORE_ID': 0,\n\t\t\t'AMOUNT': 0,\n\t\t\t'STORE_TITLE': '',\n\t\t\t'QUANTITY_RESERVED': 0,\n\t\t};\n\t\tthis.#map.forEach((item) => {\n\t\t\tresult =\n\t\t\t\titem.AMOUNT > result.AMOUNT\n\t\t\t\t\t? item\n\t\t\t\t\t: result\n\t\t\t;\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t#setInited(inited: boolean): void\n\t{\n\t\tthis.#inited = inited;\n\t}\n\n\tisInited(): boolean\n\t{\n\t\treturn this.#inited;\n\t}\n\n\tclear(): StoreCollection\n\t{\n\t\tthis.#map.clear();\n\t\tthis.#setInited(false);\n\n\t\treturn this;\n\t}\n}\n","import {ajax, Extension, Loc, Tag, Text, Type} from 'main.core';\nimport {EventEmitter} from \"main.core.events\";\nimport {ErrorCollection} from \"./error-collection\";\nimport {ImageCollection} from \"./image-collection\";\nimport {ProductOption} from \"./product-option\";\nimport {DiscountType, ProductCalculator, TaxForPriceStrategy} from \"catalog.product-calculator\";\nimport {FieldCollection} from \"./field-collection\";\nimport {StoreCollection} from \"./store-collection\";\nimport {RightActionDictionary} from \"./right-action-dictionary\";\n\nconst instances = new Map();\n\nclass ProductModel\n{\n\t#fieldCollection = null;\n\t#errorCollection = null;\n\t#imageCollection = null;\n\t#storeCollection = null;\n\t#productRights = null;\n\t#calculator = null;\n\t#offerId = null;\n\t#skuTree = null;\n\n\tstatic SAVE_NOTIFICATION_CATEGORY = 'MODEL_SAVE'\n\n\tstatic getById(id: string): ?ProductModel\n\t{\n\t\treturn instances.get(id) || null;\n\t}\n\n\tconstructor(options: ProductOption = {})\n\t{\n\t\tthis.options = options || {};\n\t\tthis.id = this.options.id || Text.getRandom();\n\n\t\tthis.#errorCollection = new ErrorCollection(this);\n\t\tthis.#imageCollection = new ImageCollection(this);\n\t\tthis.#fieldCollection = new FieldCollection(this);\n\t\tthis.#storeCollection = new StoreCollection(this);\n\n\t\tconst settings = Extension.getSettings('catalog.product-model');\n\t\tthis.#productRights = settings.get('catalogProductRights');\n\n\t\tif (settings.get('isExternalCatalog'))\n\t\t{\n\t\t\tthis.setOption('isSaveable', false);\n\t\t}\n\n\t\tif (Type.isObject(options.fields))\n\t\t{\n\t\t\tthis.initFields(options.fields, false);\n\t\t}\n\n\t\tif (this.#isStoreCollectionEnabled())\n\t\t{\n\t\t\tif (Type.isNil(options.storeMap))\n\t\t\t{\n\t\t\t\tthis.#storeCollection.refresh();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#storeCollection.init(options.storeMap);\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isObject(options.skuTree))\n\t\t{\n\t\t\tthis.setSkuTree(options.skuTree);\n\t\t}\n\n\t\tif (Type.isObject(options.imageInfo))\n\t\t{\n\t\t\t// this.getImageCollection().setMorePhotoValues(options.imageInfo.morePhoto);\n\t\t}\n\n\t\tthis.#calculator = new ProductCalculator(this.#getDefaultCalculationFields(), {\n\t\t\tcurrencyId: this.options.currency,\n\t\t\tpricePrecision: this.options.pricePrecision || 2,\n\t\t\tcommonPrecision: this.options.pricePrecision || 2,\n\t\t});\n\t\tthis.#calculator.setCalculationStrategy(new TaxForPriceStrategy(this.#calculator));\n\n\t\tinstances.set(this.id, this);\n\t}\n\n\t#getDefaultCalculationFields(): {}\n\t{\n\t\tconst defaultPrice = Text.toNumber(this.#fieldCollection.getField('PRICE'));\n\t\tconst basePrice = Type.isNumber(this.#fieldCollection.getField('BASE_PRICE'))\n\t\t\t? Text.toNumber(this.#fieldCollection.getField('BASE_PRICE'))\n\t\t\t: defaultPrice;\n\n\t\treturn {\n\t\t\t'QUANTITY': Text.toNumber(this.#fieldCollection.getField('QUANTITY')),\n\t\t\t'BASE_PRICE': basePrice,\n\t\t\t'PRICE': defaultPrice,\n\t\t\t'PRICE_NETTO': basePrice,\n\t\t\t'PRICE_BRUTTO': defaultPrice,\n\t\t\t'PRICE_EXCLUSIVE': this.#fieldCollection.getField('PRICE_EXCLUSIVE') || defaultPrice,\n\t\t\t'DISCOUNT_TYPE_ID': this.#fieldCollection.getField('DISCOUNT_TYPE_ID') || DiscountType.PERCENTAGE,\n\t\t\t'DISCOUNT_RATE': Text.toNumber(this.#fieldCollection.getField('DISCOUNT_RATE')),\n\t\t\t'DISCOUNT_SUM': Text.toNumber(this.#fieldCollection.getField('DISCOUNT_SUM')),\n\t\t\t'TAX_INCLUDED': this.#fieldCollection.getField('TAX_INCLUDED') || 'N',\n\t\t\t'TAX_RATE': Text.toNumber(this.#fieldCollection.getField('TAX_RATE')) || 0,\n\t\t\t'CUSTOMIZED': this.#fieldCollection.getField('CUSTOMIZED') || 'N',\n\t\t};\n\t}\n\n\tcheckAccess(action: RightActionDictionary): boolean\n\t{\n\t\treturn Text.toBoolean(this.#productRights[action] ?? false);\n\t}\n\n\tgetOption(name: string, defaultValue: any = null): any\n\t{\n\t\treturn this.options[name] ?? defaultValue\n\t}\n\n\tsetOption(name: string, value: any = null): this\n\t{\n\t\tthis.options[name] = value;\n\n\t\treturn this;\n\t}\n\n\tsetSkuTree(skuTree: {} = null): this\n\t{\n\t\tthis.#skuTree = skuTree;\n\n\t\treturn this;\n\t}\n\n\tclearSkuTree(): this\n\t{\n\t\tthis.#skuTree = null;\n\n\t\treturn this;\n\t}\n\n\tgetSkuTree(): ?{}\n\t{\n\t\treturn this.#skuTree;\n\t}\n\n\tgetCalculator(): ProductCalculator\n\t{\n\t\treturn this.#calculator;\n\t}\n\n\tgetErrorCollection(): ErrorCollection\n\t{\n\t\treturn this.#errorCollection;\n\t}\n\n\tgetImageCollection(): ImageCollection\n\t{\n\t\treturn this.#imageCollection;\n\t}\n\n\tgetFields(): {}\n\t{\n\t\treturn this.#fieldCollection.getFields();\n\t}\n\n\tgetStoreCollection(): StoreCollection\n\t{\n\t\treturn this.#storeCollection;\n\t}\n\n\tgetField(fieldName: string): any\n\t{\n\t\treturn this.#fieldCollection.getField(fieldName);\n\t}\n\n\tsetField(fieldName: string, value: any): ProductModel\n\t{\n\t\tthis.#fieldCollection.setField(fieldName, value);\n\n\t\tif (\n\t\t\t(\n\t\t\t\tfieldName === 'SKU_ID' || fieldName === 'PRODUCT_ID'\n\t\t\t)\n\t\t\t&& this.getSkuId() !== this.#offerId\n\t\t)\n\t\t{\n\t\t\tthis.#offerId = this.getSkuId();\n\t\t\tif (this.#offerId > 0 && this.#isStoreCollectionEnabled())\n\t\t\t{\n\t\t\t\tthis.#storeCollection.refresh();\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tsetFields(fields): ProductModel\n\t{\n\t\tObject.keys(fields).forEach((key) => {\n\t\t\tthis.setField(key, fields[key]);\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tinitFields(fields: {}, refreshStoreInfo: boolean = true): ProductModel\n\t{\n\t\tthis.#fieldCollection.initFields(fields);\n\t\tthis.#offerId = this.getSkuId();\n\t\tif (refreshStoreInfo && this.#isStoreCollectionEnabled())\n\t\t{\n\t\t\tthis.#storeCollection.refresh();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tremoveField(fieldName): ProductModel\n\t{\n\t\tthis.#fieldCollection.removeField(fieldName);\n\n\t\treturn this;\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn this.#fieldCollection.isChanged();\n\t}\n\n\tisNew(): boolean\n\t{\n\t\treturn this.getOption('isNew', false);\n\t}\n\t\n\t#isStoreCollectionEnabled(): boolean\n\t{\n\t\treturn this.getOption('isStoreCollectable', true);\n\t}\n\n\tgetSkuId(): ?number\n\t{\n\t\treturn this.getField('SKU_ID') || this.getProductId();\n\t}\n\n\tgetProductId(): ?number\n\t{\n\t\treturn this.getField('PRODUCT_ID') || null;\n\t}\n\n\tisCatalogExisted(): boolean\n\t{\n\t\treturn this.getSkuId() > 0;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.getProductId() === null && !this.isSimple();\n\t}\n\n\tisSimple(): boolean\n\t{\n\t\treturn this.getOption('isSimpleModel', false);\n\t}\n\n\tgetIblockId(): boolean\n\t{\n\t\treturn this.getOption('iblockId', 0);\n\t}\n\n\tgetBasePriceId(): number\n\t{\n\t\treturn this.getOption('basePriceId', 0);\n\t}\n\n\tgetCurrency(): number\n\t{\n\t\treturn this.getOption('currency', null);\n\t}\n\n\tgetDetailPath(): string\n\t{\n\t\treturn this.getOption('detailPath', '');\n\t}\n\n\tsetDetailPath(value: string): void\n\t{\n\t\tthis.options['detailPath'] = value || '';\n\t}\n\n\tisService(): boolean\n\t{\n\t\tconst type = parseInt(this.getField('TYPE'));\n\t\treturn type === 7; // \\Bitrix\\Catalog\\ProductTable::TYPE_SERVICE\n\t}\n\n\tshowSaveNotifier(id: string, options: {})\n\t{\n\t\tif (!this.isCatalogExisted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst title = options.title || '';\n\t\tconst closeEventName = BX.UI.Notification.Event.getFullName('onClose');\n\t\tconst cancelEventName = BX.UI.Notification.Event.getFullName('onCancel');\n\n\t\tnew Promise((resolve) => {\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t\t\tif (currentBalloon && currentBalloon.getId() !== id)\n\t\t\t{\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tcurrentBalloon.close();\n\t\t\t\t\tsetTimeout(resolve, 400);\n\t\t\t\t}, 200);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(id);\n\t\t\t\tif (!notify)\n\t\t\t\t{\n\t\t\t\t\tconst notificationOptions = {\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\tcategory: ProductModel.SAVE_NOTIFICATION_CATEGORY,\n\t\t\t\t\t\tautoHideDelay: 4000,\n\t\t\t\t\t\tcontent: Tag.render`<div>${title}</div>`,\n\n\t\t\t\t\t};\n\n\t\t\t\t\tif (options.disableCancel !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tnotificationOptions.actions = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: options.declineCancelTitle || Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_DECLINE_SAVE'),\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tclick: (event, balloon) => {\n\t\t\t\t\t\t\t\t\t\tBX.removeAllCustomEvents(notify, closeEventName);\n\t\t\t\t\t\t\t\t\t\tballoon.fireEvent('onCancel');\n\t\t\t\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\n\t\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t\t}\n\n\t\t\t\tBX.removeAllCustomEvents(notify, closeEventName);\n\t\t\t\tnotify.addEvent('onClose', () => {\n\t\t\t\t\tif (Type.isFunction(options?.events?.onSave))\n\t\t\t\t\t{\n\t\t\t\t\t\t(options.events.onSave)();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tBX.removeAllCustomEvents(notify, cancelEventName);\n\t\t\t\tnotify.addEvent('onCancel', () => {\n\t\t\t\t\tif (Type.isFunction(options?.events?.onCancel))\n\t\t\t\t\t{\n\t\t\t\t\t\t(options.events.onCancel)();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tnotify.show();\n\t\t\t});\n\t}\n\n\tstatic getLastActiveSaveNotification(): ?BX.UI.Notification.Balloon\n\t{\n\t\treturn BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\n\t}\n\n\tsave(savingFieldNames: []): ?Promise\n\t{\n\t\tif (!this.isSaveable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet ajaxResult;\n\t\t\tif (this.isSimple())\n\t\t\t{\n\t\t\t\tajaxResult = this.#createProduct();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tajaxResult = this.#updateProduct(savingFieldNames);\n\t\t\t}\n\n\t\t\tajaxResult\n\t\t\t\t.then((event) => {\n\t\t\t\t\tthis.#fieldCollection.clearChanged(savingFieldNames);\n\t\t\t\t\tresolve(event);\n\t\t\t\t})\n\t\t\t\t.catch(reject)\n\t\t});\n\t}\n\n\tisSaveable(): boolean\n\t{\n\t\tif (!this.getOption('isSaveable', true) || this.isEmpty())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.isSimple()\n\t\t\t? this.checkAccess(RightActionDictionary.ACTION_PRODUCT_ADD)\n\t\t\t: this.checkAccess(RightActionDictionary.ACTION_PRODUCT_EDIT)\n\t\t;\n\t}\n\n\tonErrorCollectionChange()\n\t{\n\t\tEventEmitter.emit(this,'onErrorsChange');\n\t}\n\n\tonChangeStoreData()\n\t{\n\t\tEventEmitter.emit(this,'onChangeStoreData');\n\t}\n\n\t#updateProduct(savingFieldNames: [])\n\t{\n\t\tif (this.getIblockId() <= 0)\n\t\t{\n\t\t\treturn Promise.reject({\n\t\t\t\tstatus: 'error',\n\t\t\t\terrors: [\n\t\t\t\t\t'The iblock id is not set for the model.'\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\n\t\tif (!this.#fieldCollection.isChanged())\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tstatus: 'success',\n\t\t\t\tdata: {\n\t\t\t\t\tid: this.getSkuId(),\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tlet savedFields = {};\n\t\tif (!Type.isArray(savingFieldNames) || savingFieldNames.length === 0)\n\t\t{\n\t\t\tsavedFields = this.#fieldCollection.getChangedFields();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst changedFields = this.#fieldCollection.getChangedFields();\n\t\t\tObject.keys(changedFields).forEach((key) => {\n\t\t\t\tif (savingFieldNames.includes(key))\n\t\t\t\t{\n\t\t\t\t\tif (key === 'PRICE' || key === 'BASE_PRICE')\n\t\t\t\t\t{\n\t\t\t\t\t\tsavedFields['PRICES'] = savedFields['PRICES'] || {};\n\t\t\t\t\t\tsavedFields['PRICES'][this.getBasePriceId()] = {\n\t\t\t\t\t\t\tPRICE: changedFields[key],\n\t\t\t\t\t\t\tCURRENCY: this.getCurrency(),\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tsavedFields[key] = changedFields[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn ajax.runAction(\n\t\t\t'catalog.productSelector.updateSku',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tid: this.getSkuId(),\n\t\t\t\t\tupdateFields: savedFields,\n\t\t\t\t\toldFields: this.#fieldCollection.getChangedValues(),\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t#createProduct(): Promise\n\t{\n\t\tconst fields = {\n\t\t\tNAME: this.#fieldCollection.getField('NAME', ''),\n\t\t\tIBLOCK_ID: this.getIblockId()\n\t\t};\n\n\t\tconst price = this.#fieldCollection.getField('BASE_PRICE', null);\n\t\tif (!Type.isNil(price))\n\t\t{\n\t\t\tfields['PRICE'] = price;\n\t\t}\n\n\t\tconst barcode = this.#fieldCollection.getField('BARCODE', null);\n\t\tif (!Type.isNil(barcode))\n\t\t{\n\t\t\tfields['BARCODE'] = barcode;\n\t\t}\n\n\t\tfields['CURRENCY'] = this.getCurrency();\n\t\tconst currency = this.#fieldCollection.getField('CURRENCY', null);\n\t\tif (Type.isStringFilled(currency))\n\t\t{\n\t\t\tfields['CURRENCY'] = currency;\n\t\t}\n\n\t\treturn ajax.runAction(\n\t\t\t'catalog.productSelector.createProduct',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tfields\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t}\n}\n\nexport {ProductModel, RightActionDictionary}\n"],"names":["ErrorCollection","model","Map","Object","fromEntries","errors","code","text","set","onErrorCollectionChange","has","clear","size","ImageCollection","morePhoto","values","Type","isPlainObject","fileId","index","value","isObject","Text","toInteger","isNumber","html","isStringFilled","FieldCollection","fields","fieldName","get","oldValue","changedFields","savingFieldNames","isNil","forEach","name","removeFromChanged","changedFieldValues","key","clearChanged","keys","RightActionDictionary","StoreCollection","_classPrivateFieldInitSpec","map","item","toNumber","AMOUNT","QUANTITY_RESERVED","STORE_ID","STORE_TITLE","encode","getSkuId","checkAccess","ACTION_PRODUCT_VIEW","ajax","runAction","json","productId","then","response","data","onChangeStoreData","storeId","getStoreAmount","getStoreReserved","result","inited","instances","ProductModel","id","options","_classPrivateMethodInitSpec","getRandom","settings","Extension","getSettings","setOption","initFields","storeMap","refresh","init","skuTree","setSkuTree","imageInfo","ProductCalculator","currencyId","currency","pricePrecision","commonPrecision","setCalculationStrategy","TaxForPriceStrategy","action","toBoolean","defaultValue","getFields","getField","setField","refreshStoreInfo","removeField","isChanged","getOption","getProductId","isSimple","type","parseInt","isCatalogExisted","title","closeEventName","BX","UI","Notification","Event","getFullName","cancelEventName","Promise","resolve","currentBalloon","Center","getBalloonByCategory","SAVE_NOTIFICATION_CATEGORY","getId","setTimeout","close","notify","getBalloonById","notificationOptions","closeButton","category","autoHideDelay","content","Tag","render","disableCancel","actions","declineCancelTitle","Loc","getMessage","events","click","event","balloon","removeAllCustomEvents","fireEvent","addEvent","isFunction","onSave","onCancel","show","isSaveable","reject","ajaxResult","isEmpty","ACTION_PRODUCT_ADD","ACTION_PRODUCT_EDIT","EventEmitter","emit","defaultPrice","basePrice","DiscountType","PERCENTAGE","getIblockId","status","savedFields","isArray","length","getChangedFields","includes","getBasePriceId","PRICE","CURRENCY","getCurrency","updateFields","oldFields","getChangedValues","NAME","IBLOCK_ID","price","barcode"],"mappings":"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"}