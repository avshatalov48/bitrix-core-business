{"version":3,"file":"styleform.bundle.js","sources":["../src/styleform.js"],"sourcesContent":["import { Dom, Event, Type, Tag, Loc } from 'main.core';\nimport { BaseForm } from 'landing.ui.form.baseform';\nimport { Highlight } from 'landing.ui.highlight';\nimport { BaseField } from 'landing.ui.field.basefield';\nimport {Env} from 'landing.env';\nimport { fetchEventsFromOptions } from 'landing.ui.component.internal';\n\nimport './css/style_form.css';\nimport 'ui.design-tokens';\n\n/**\n * @memberOf BX.Landing.UI.Form\n */\nexport class StyleForm extends BaseForm\n{\n\t#styleFields: Map;\n\n\tconstructor(options = {})\n\t{\n\t\tsuper(options);\n\t\tthis.setEventNamespace('BX.Landing.UI.Form.StyleForm');\n\t\tthis.subscribeFromOptions(fetchEventsFromOptions(options));\n\n\t\tDom.addClass(this.layout, 'landing-ui-form-style');\n\t\tthis.iframe = 'iframe' in options ? options.iframe : null;\n\t\tthis.node = 'node' in options ? options.node : null;\n\t\tthis.selector = 'selector' in options ? options.selector : null;\n\t\tthis.collapsed = 'collapsed' in options ? options.collapsed : null;\n\t\tthis.currentTarget = 'currentTarget' in options ? options.currentTarget : null;\n\t\tthis.specialType = 'specialType' in options ? options.specialType : null;\n\t\tthis.#styleFields = new Map();\n\n\t\tthis.onHeaderEnter = this.onHeaderEnter.bind(this);\n\t\tthis.onHeaderLeave = this.onHeaderLeave.bind(this);\n\t\tthis.onHeaderClick = this.onHeaderClick.bind(this);\n\n\t\tthis.prepareHeader();\n\n\t\tEvent.bind(this.header, 'click', this.onHeaderClick);\n\t\tEvent.bind(this.header, 'mouseenter', this.onHeaderEnter);\n\t\tEvent.bind(this.header, 'mouseleave', this.onHeaderLeave);\n\n\t\tif (this.iframe)\n\t\t{\n\t\t\tthis.onFrameLoad();\n\t\t}\n\n\t\tif (this.collapsed)\n\t\t{\n\t\t\tDom.addClass(this.layout, 'landing-ui-form-style--collapsed');\n\t\t}\n\n\t\tif (\n\t\t\tthis.specialType && this.specialType === 'crm_forms'\n\t\t\t&& Env.getInstance().getSpecialType() === 'crm_forms'\n\t\t)\n\t\t{\n\t\t\tthis.#addReplaceByTemplateCard();\n\t\t}\n\t}\n\n\tonFrameLoad()\n\t{\n\t\tif (!this.node)\n\t\t{\n\t\t\tthis.node = [...this.iframe.document.querySelectorAll(this.selector)];\n\t\t}\n\t}\n\n\tonHeaderEnter()\n\t{\n\t\tHighlight.getInstance().show(this.node);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tonHeaderLeave()\n\t{\n\t\tHighlight.getInstance().hide();\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tonHeaderClick(event: MouseEvent)\n\t{\n\t\tevent.preventDefault();\n\t\tDom.toggleClass(this.layout, 'landing-ui-form-style--collapsed');\n\t}\n\n\taddField(field: BaseField)\n\t{\n\t\tif (field)\n\t\t{\n\t\t\tconst attrKey = field?.data?.attrKey;\n\n\t\t\tfield.subscribe('onChange', this.onChange.bind(this));\n\t\t\tfield.subscribe('onInit', this.onInit.bind(this));\n\n\t\t\tthis.fields.add(field);\n\t\t\tBX.Dom.append(field.layout, this.body);\n\n\t\t\tif (attrKey)\n\t\t\t{\n\t\t\t\tthis.#styleFields.set(attrKey, field.getLayout());\n\t\t\t}\n\t\t}\n\t}\n\n\tonChange(event)\n\t{\n\t\tthis.#toggleLinkedFields(event.getData());\n\t\tthis.emit('onChange');\n\t}\n\n\tonInit(event)\n\t{\n\t\tthis.#toggleLinkedFields(event.getData());\n\t\tthis.emit('onInit');\n\t}\n\n\t#toggleLinkedFields(fieldData: Object)\n\t{\n\t\t// hide linked fields\n\t\tif (fieldData.hide && Type.isArray(fieldData.hide))\n\t\t{\n\t\t\tfieldData.hide.map((attr) => {\n\t\t\t\tconst layout = this.#styleFields.get(attr);\n\t\t\t\tif (layout)\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.style(layout, 'display', 'none');\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t});\n\t\t}\n\n\t\t// show linked fields\n\t\tif (fieldData.show && Type.isArray(fieldData.show))\n\t\t{\n\t\t\tfieldData.show.map((attr) => {\n\t\t\t\tconst layout = this.#styleFields.get(attr);\n\t\t\t\tif (layout)\n\t\t\t\t{\n\t\t\t\t\tBX.Dom.style(layout, 'display', 'block');\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t});\n\t\t}\n\t}\n\n\tprepareHeader()\n\t{\n\t\tconst headerText = BX.Dom.create({\n\t\t\ttag: 'div',\n\t\t\tprops: {\n\t\t\t\tclassList: 'landing-ui-form-header-text',\n\t\t\t},\n\t\t});\n\t\tif (this.header.childNodes)\n\t\t{\n\t\t\tthis.header.childNodes.forEach((childNode) => {\n\t\t\t\tBX.Dom.append(childNode, headerText);\n\t\t\t});\n\t\t}\n\t\tBX.Dom.append(headerText, this.header);\n\t}\n\n\t#addReplaceByTemplateCard()\n\t{\n\t\tconst isMinisitesAllowed = Env.getInstance().getOptions().allow_minisites;\n\n\t\tconst lockIcon = (\n\t\t\tisMinisitesAllowed\n\t\t\t\t? ''\n\t\t\t\t: Tag.render`<span class=\"landing-ui-form-lock-icon\"></span>`\n\t\t);\n\t\tconst button = Tag.render`\n\t\t\t<span class=\"landing-ui-form-replace-by-templates-card-button ui-btn ui-btn-sm ui-btn-primary ui-btn-hover ui-btn-round\">\n\t\t\t\t${Loc.getMessage('LANDING_REPLACE_BY_TEMPLATES_BUTTON')}\n\t\t\t\t${lockIcon}\n\t\t\t</span>\n\t\t`;\n\t\tconst card = Tag.render`<div class=\"landing-ui-form-replace-by-templates-card\">\n\t\t\t<div class=\"landing-ui-form-replace-by-templates-card-title\">\n\t\t\t\t${Loc.getMessage('LANDING_REPLACE_BY_TEMPLATES_TITLE')}\n\t\t\t</div>\n\t\t\t${button}\n\t\t</div>`;\n\t\tDom.insertBefore(card, this.header);\n\n\t\tEvent.bind(button, 'click', () => {\n\t\t\tif (!isMinisitesAllowed)\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show('limit_crm_forms_templates');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// todo: migrate to new analytics?\n\t\t\tconst metrika = new BX.Landing.Metrika(true);\n\t\t\tmetrika.sendLabel(\n\t\t\t\tnull,\n\t\t\t\t'templateMarket',\n\t\t\t\t'open&replaceLid=' + landingParams['LANDING_ID']\n\t\t\t);\n\n\t\t\tconst templatesMarketUrl = landingParams['PAGE_URL_LANDING_REPLACE_FROM_STYLE'];\n\t\t\tif (templatesMarketUrl)\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.open(\n\t\t\t\t\ttemplatesMarketUrl,\n\t\t\t\t\t{\n\t\t\t\t\t\tallowChangeHistory: false,\n\t\t\t\t\t\tcacheable: false,\n\t\t\t\t\t\tcustomLeftBoundary: 0,\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n}\n"],"names":["StyleForm","options","setEventNamespace","subscribeFromOptions","fetchEventsFromOptions","Dom","addClass","layout","iframe","node","selector","collapsed","currentTarget","specialType","Map","onHeaderEnter","bind","onHeaderLeave","onHeaderClick","prepareHeader","Event","header","onFrameLoad","Env","getInstance","getSpecialType","document","querySelectorAll","Highlight","show","hide","event","preventDefault","toggleClass","field","attrKey","data","subscribe","onChange","onInit","fields","add","BX","append","body","set","getLayout","getData","emit","headerText","create","tag","props","classList","childNodes","forEach","childNode","BaseForm","fieldData","Type","isArray","map","attr","get","style","isMinisitesAllowed","getOptions","allow_minisites","lockIcon","Tag","render","button","Loc","getMessage","card","insertBefore","UI","InfoHelper","metrika","Landing","Metrika","sendLabel","landingParams","templatesMarketUrl","SidePanel","Instance","open","allowChangeHistory","cacheable","customLeftBoundary"],"mappings":"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"}