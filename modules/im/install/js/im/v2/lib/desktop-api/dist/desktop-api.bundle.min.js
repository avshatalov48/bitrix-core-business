this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(t,e,o,s,n,i){"use strict";const r={isDesktop(){return s.Type.isObject(window.BXDesktopSystem)},restart(){var t;if(this.getApiVersion()<74){return}(t=BXDesktopSystem)==null?void 0:t.Restart()},shutdown(){var t;(t=BXDesktopSystem)==null?void 0:t.Shutdown()}};const a={mask:{id:"mask",version:72},restart:{id:"restart",version:74},accountManagement:{id:"accountManagement",version:75},openNewTab:{id:"openNewTab",version:76},openPage:{id:"openPage",version:79}};const l={getApiVersion(){if(!this.isDesktop()){return 0}const[t,e,o,s]=window.BXDesktopSystem.GetProperty("versionParts");return s},isFeatureEnabled(t){var e;return Boolean((e=window.BXDesktopSystem)==null?void 0:e.FeatureEnabled(t))},isFeatureSupported(t){return this.isFeatureSupportedInVersion(this.getApiVersion(),t)},isFeatureSupportedInVersion(t,e){if(!a[e]){return false}return t>=a[e].version}};const u={};const d={subscribe(t,e){if(!this.isDesktop()){return}const o=t=>{var o;const s=(o=t.detail)!=null?o:[];e.apply(window,s)};if(!u[t]){u[t]=[]}u[t].push(o);s.Event.bind(window,t,o)},unsubscribe(t,e){if(!s.Type.isFunction(e)){if(!s.Type.isArrayFilled(u[t])){return}u[t].forEach((e=>{s.Event.unbind(window,t,e)}));return}s.Event.unbind(window,t,e)},emit(t,e=[]){const o=opener||top;const s=o.BXWindows;s.forEach((o=>{var s;if(!o||o.name===""){return}o==null?void 0:(s=o.BXDesktopWindow)==null?void 0:s.DispatchCustomEvent(t,e)}));this.emitToMainWindow(t,e)},emitToMainWindow(t,e=[]){var o,s;const n=opener||top;(o=n.BXDesktopSystem)==null?void 0:(s=o.GetMainWindow())==null?void 0:s.DispatchCustomEvent(t,e)}};const c={smoothing:"bxd_camera_smoothing",smoothing_v2:"bxd_camera_smoothing_v2",telemetry:"bxd_telemetry",sliderBindingsStatus:"sliderBindingsStatus"};const p={getCameraSmoothingStatus(){return this.getCustomSetting(c.smoothing,"0")==="1"},setCameraSmoothingStatus(t){const e=t===true?"1":"0";if(this.getApiVersion()>76){this.setCustomSetting(c.smoothing_v2,e);return}this.setCustomSetting(c.smoothing,e)},isTwoWindowMode(){var t;return Boolean((t=BXDesktopSystem)==null?void 0:t.IsTwoWindowsMode())},setTwoWindowMode(t){var e;if(t===true){var o;(o=BXDesktopSystem)==null?void 0:o.V10();return}(e=BXDesktopSystem)==null?void 0:e.V8()},getAutostartStatus(){var t;return(t=BXDesktopSystem)==null?void 0:t.GetProperty("autostart")},setAutostartStatus(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetProperty("autostart",t)},getTelemetryStatus(){return this.getCustomSetting(c.telemetry,"1")==="1"},setTelemetryStatus(t){this.setCustomSetting(c.telemetry,t?"1":"0")},setCustomSetting(t,e){var o;(o=BXDesktopSystem)==null?void 0:o.StoreSettings(t,e)},getCustomSetting(t,e){var o;return(o=BXDesktopSystem)==null?void 0:o.QuerySettings(t,e)}};const m={isTwoWindowMode(){var t;return Boolean((t=BXDesktopSystem)==null?void 0:t.IsTwoWindowsMode())},isChatWindow(){const t=s.Extension.getSettings("im.v2.lib.desktop-api");return this.isDesktop()&&t.get("isChatWindow")},isChatTab(){return this.isChatWindow()||this.isDesktop()&&location.href.includes("&IM_TAB=Y")},setActiveTab(t=window){var e;if(!s.Type.isObject(t)){return}(e=t.BXDesktopSystem)==null?void 0:e.SetActiveTab()},showWindow(t=window){var e;if(!s.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("show")},activateWindow(t=window){this.setActiveTab(t);this.showWindow(t)},hideWindow(t=window){var e;if(!s.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("hide")},closeWindow(t=window){var e;if(!s.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("close")},hideLoader(){s.Dom.remove(document.getElementById("bx-desktop-loader"))},reloadWindow(){const t=new i.BaseEvent;i.EventEmitter.emit(window,n.EventType.desktop.onReload,t);location.reload()},findWindow(t=""){const e=opener||top;return e.BXWindows.find((e=>(e==null?void 0:e.name)===t))},openPage(t,o={}){const n=s.Dom.create({tag:"a",attrs:{href:t}});if(n.host!==location.host){setTimeout((()=>this.hideWindow()),100);return Promise.resolve(false)}if(!p.isTwoWindowMode()){if(o.skipNativeBrowser===true){setTimeout((()=>this.hideWindow()),100);return Promise.resolve(false)}e.Utils.browser.openLink(n.href);setTimeout((()=>this.hideWindow()),100);return Promise.resolve(true)}this.createTab(n.href);return Promise.resolve(true)},createTab(t){const e=s.Dom.create({tag:"a",attrs:{href:t}}).href;BXDesktopSystem.CreateTab(e)},createImTab(t){const e=s.Dom.create({tag:"a",attrs:{href:t}}).href;BXDesktopSystem.CreateImTab(e)},createWindow(t,e){BXDesktopSystem.GetWindow(t,e)},createTopmostWindow(t){return BXDesktopSystem.ExecuteCommand("topmost.show.html",t)},setWindowPosition(t){var e;const o={};Object.entries(t).forEach((([t,e])=>{const s=t[0].toUpperCase()+t.slice(1);o[s]=e}));(e=BXDesktopWindow)==null?void 0:e.SetProperty("position",o)},prepareHtml(t,e){let o="";if(s.Type.isDomNode(t)){o=t.outerHTML}else{o=t}let n="";if(s.Type.isDomNode(e)){n=e.outerHTML}else{n=e}s.Event.ready();if(s.Type.isStringFilled(n)){n=`\n\t\t\t\t<script>\n\t\t\t\t\tBX.ready(() => {\n\t\t\t\t\t\t${n}\n\t\t\t\t\t});\n\t\t\t\t<\/script>\n\t\t\t`}const i=document.head.outerHTML.replaceAll(/BX\.PULL\.start\([^)]*\);/g,"");return`\n\t\t\t<!DOCTYPE html>\n\t\t\t<html lang="">\n\t\t\t\t${i}\n\t\t\t\t<body class="im-desktop im-desktop-popup">\n\t\t\t\t\t${o}${n}\n\t\t\t\t</body>\n\t\t\t</html>\n\t\t`},setWindowSize(t,e){BXDesktopWindow.SetProperty("clientSize",{Width:t,Height:e})},setMinimumWindowSize(t,e){BXDesktopWindow.SetProperty("minClientSize",{Width:t,Height:e})}};const v={setCounter(t,e=false){var o,s;const n=t.toString();(o=BXDesktopSystem)==null?void 0:o.SetIconBadge(n,e);(s=BXDesktopSystem)==null?void 0:s.SetTabBadge(0,n)},setBrowserIconBadge(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetBrowserIconBadge(t.toString())},setIconStatus(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetIconStatus(t)},setOfflineIcon(){var t;(t=BXDesktopSystem)==null?void 0:t.SetIconStatus("offline")},flashIcon(){var t;if(!s.Browser.isWin()){return}(t=BXDesktopSystem)==null?void 0:t.FlashIcon()}};const g={prepareResourcePath(t){let e="";try{const o=new URL(t,location.origin);e=o.href}catch{}return e}};const S={changeTab(t){const e=s.Extension.getSettings("im.v2.lib.desktop-api");const o=e.get("v2");if(o){return}BX.desktop.changeTab(t)}};const B={removeNativeNotifications(){var t;if(this.getApiVersion()<74){return}(t=BXDesktopSystem)==null?void 0:t.NotificationRemoveAll()}};const h={writeToLogFile(t,e){var o;if(!s.Type.isStringFilled(t)){console.error("Desktop logger: filename is not defined");return}let n="";if(s.Type.isString(e)){n=e}else if(s.Type.isNumber(e)){n=e.toString()}else{n=JSON.stringify(e)}(o=BXDesktopSystem)==null?void 0:o.Log(t,n)},printWelcomePrompt(){const t=BXDesktopSystem.GetProperty("versionParts").join(".");let e="unknown";if(s.Browser.isMac()){e="MacOS"}else if(s.Browser.isWin()){e="Windows"}else if(s.Browser.isLinux()){e="Linux"}const n=s.Loc.getMessage("IM_LIB_DESKTOP_API_WELCOME_PROMPT",{"#VERSION#":t,"#OS#":e});o.Logger.desktop(n)},setLogInfo(t){BXDesktopSystem.LogInfo=t}};const w={getCallMask(){if(!this.isDesktop()){return{id:""}}return{id:BXDesktopSystem.QuerySettings("bxd_camera_3dbackground_id")||""}},setCallMaskLoadHandlers(t){this.subscribe("BX3dAvatarReady",t);this.subscribe("BX3dAvatarError",t)},setCallMask(t,e,o){if(this.getApiVersion()<72){return false}if(!t){BXDesktopSystem.Set3dAvatar("","");BXDesktopSystem.StoreSettings("bxd_camera_3dbackground_id","");return true}e=this.prepareResourcePath(e);o=this.prepareResourcePath(o);BXDesktopSystem.Set3dAvatar(e,o);BXDesktopSystem.StoreSettings("bxd_camera_3dbackground_id",t);return true}};const k={isBlur(t){return t.toString().toLowerCase().includes("blur")},getLimitationBackground(t){const e=BX.message("call_features");const o={enable:true};let s="";if(t&&t!=="none"){s=`${this.isBlur(t)?"blur_":""}background`}const n=s?e==null?void 0:e[`call_${s}`]:null;if(!n){return o}return{enable:n.enable,articleCode:n.articleCode}},openArticle(t){const e=BX.UI.InfoHelper;if(e.isOpen()){e.close()}e.show(t)},handleLimitationBackground(t,e){const{enable:o,articleCode:s}=t;if(o&&typeof e==="function"){e()}if(!o&&s){this.openArticle(s)}},getBackgroundImage(){var t;const e=BXDesktopSystem.QuerySettings("bxd_camera_background_id")||"none";if(!this.isDesktop()||!((t=this.getLimitationBackground(e))!=null&&t.enable)){return{id:"none",source:""}}return{id:e}},setCallBackground(t,e){if(e==="none"||e===""){e=""}else if(e==="blur");else if(e==="gaussianBlur"){e="GaussianBlur"}else{e=this.prepareResourcePath(e)}var o=new BX.Promise;const s=this.getLimitationBackground(e);let n="";let i="";this.handleLimitationBackground(s,(()=>{n=e;i=t}));setTimeout((()=>{this.setCallMask(false);BXDesktopSystem.StoreSettings("bxd_camera_background_id",i);BXDesktopSystem.StoreSettings("bxd_camera_background",n);o.resolve(i||"none")}),100);return o}};const y={openAddAccountTab(){var t;(t=BXDesktopSystem)==null?void 0:t.AccountAddForm()},deleteAccount(t,e){var o;(o=BXDesktopSystem)==null?void 0:o.AccountDelete(t,e)},connectAccount(t,e,o,s){var n;(n=BXDesktopSystem)==null?void 0:n.AccountConnect(t,e,o,s)},disconnectAccount(t){var e;(e=BXDesktopSystem)==null?void 0:e.AccountDisconnect(t)},getAccountList(){var t;return(t=BXDesktopSystem)==null?void 0:t.AccountList()},login(){return new Promise((t=>{var e;(e=BXDesktopSystem)==null?void 0:e.Login({success:()=>t()})}))},async logout(){try{var t;await s.ajax.runAction(n.RestMethod.imV2DesktopLogout);(t=BXDesktopSystem)==null?void 0:t.Logout(2)}catch(t){var e;console.error("DesktopApi logout error",t);(e=BXDesktopSystem)==null?void 0:e.Logout(3)}},async terminate(){try{await s.ajax.runAction(n.RestMethod.imV2DesktopLogout)}finally{r.shutdown()}}};const D={startDiskSync(){var t;(t=BXFileStorage)==null?void 0:t.SyncPause(false);const e=new i.BaseEvent({compatData:[true]});i.EventEmitter.emit(window,n.EventType.desktop.onSyncPause,e)},stopDiskSync(){var t;(t=BXFileStorage)==null?void 0:t.SyncPause(true);const e=new i.BaseEvent({compatData:[false]});i.EventEmitter.emit(window,n.EventType.desktop.onSyncPause,e)}};const f={openDeveloperTools(){var t;(t=BXDesktopWindow)==null?void 0:t.OpenDeveloperTools()},openLogsFolder(){var t;(t=BXDesktopSystem)==null?void 0:t.OpenLogsFolder()}};const X={...r,...g,...l,...d,...m,...v,...B,...p,...S,...k,...w,...h,...y,...D,...f};t.DesktopApi=X;t.DesktopFeature=a;t.DesktopSettingsKey=c})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Const,BX.Event);
//# sourceMappingURL=desktop-api.bundle.map.js