{"version":3,"file":"recent-list.bundle.js","sources":["../src/components/new-user-popup.js","../src/components/recent-item.js","../src/components/active-call.js","../src/settings-manager.js","../src/broadcast-manager.js","../src/call-manager.js","../src/draft-manager.js","../src/event-handler.js","../src/recent-list.js"],"sourcesContent":["import {EventEmitter} from 'main.core.events';\n\nimport {EventType} from 'im.old-chat-embedding.const';\n\n// @vue/component\nexport const NewUserPopup = {\n\tname: 'NewUserPopup',\n\tprops: {\n\t\ttitle: {type: String, required: true},\n\t\ttext: {type: String, required: true}\n\t},\n\temits: ['click', 'close'],\n\tmounted()\n\t{\n\t\tBX.MessengerProxy.playNewUserSound();\n\t\tthis.setCloseTimer(5000);\n\n\t\tthis.onClosePopupHandler = this.onClosePopup.bind(this);\n\t\tEventEmitter.subscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t},\n\tmethods:\n\t{\n\t\tonClick()\n\t\t{\n\t\t\tthis.$emit('click');\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tonMouseOver()\n\t\t{\n\t\t\tclearTimeout(this.closeTimeout);\n\t\t},\n\t\tonMouseLeave()\n\t\t{\n\t\t\tthis.setCloseTimer(2000);\n\t\t},\n\t\tsetCloseTimer(time: number)\n\t\t{\n\t\t\tthis.closeTimeout = setTimeout(() => {\n\t\t\t\tthis.$emit('close');\n\t\t\t}, time);\n\t\t},\n\t\tonClosePopup()\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<Transition name=\"bx-im-recent-new-user-popup\">\n\t\t\t<div @click=\"onClick\" @mouseover=\"onMouseOver\" @mouseleave=\"onMouseLeave\" class=\"bx-im-recent-new-user-popup\">\n\t\t\t\t<div class=\"bx-im-recent-new-user-popup-title\">{{ title }}</div>\n\t\t\t\t<div class=\"bx-im-recent-new-user-popup-text\">{{ text }}</div>\n\t\t\t</div>\n\t\t</Transition>\n\t`\n};","import 'main.date';\nimport {PopupManager} from 'main.popup';\nimport {EventEmitter} from 'main.core.events';\n\nimport {MessageStatus, DialogType, RecentSettings, EventType, OpenTarget} from 'im.old-chat-embedding.const';\nimport {Utils} from 'im.old-chat-embedding.lib.utils';\nimport {Avatar, AvatarSize, ChatTitle} from 'im.old-chat-embedding.component.elements';\n\nimport {Parser} from 'im.v2.lib.parser';\n\nimport {NewUserPopup} from './new-user-popup';\n\ntype RecentListItem = {\n\tdialogId: number,\n\tmessage: {\n\t\tid: number,\n\t\ttext: string,\n\t\tdate: string,\n\t\tsenderId: number,\n\t\tstatus: MessageStatus.received | MessageStatus.delivered | MessageStatus.error\n\t},\n\tdraft: {\n\t\ttext: string,\n\t\tdate: Date | null,\n\t},\n\tunread: boolean,\n\tpinned: boolean,\n\tliked: boolean,\n\tinvitation: {\n\t\tisActive: boolean,\n\t\toriginator: number,\n\t\tcanResend: boolean\n\t}\n}\n\n// @vue/component\nexport const RecentItem = {\n\tname: 'RecentItem',\n\tcomponents: {Avatar, ChatTitle, NewUserPopup},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tcompactMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\tisVisibleOnScreen: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tshowNewUserPopup: false\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tformattedDate(): string\n\t\t{\n\t\t\tif (this.needsBirthdayPlaceholder)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('IM_RECENT_BIRTHDAY_DATE');\n\t\t\t}\n\n\t\t\treturn this.formatDate(this.item.message.date);\n\t\t},\n\n\t\tmessageText(): string\n\t\t{\n\t\t\tconst formattedText = Parser.purifyRecent(this.item);\n\t\t\tif (!formattedText)\n\t\t\t{\n\t\t\t\treturn this.isUser ? this.$store.getters['users/getPosition'](this.item.dialogId) : this.hiddenMessageText;\n\t\t\t}\n\n\t\t\treturn formattedText;\n\t\t},\n\n\t\tformattedMessageText(): string\n\t\t{\n\t\t\tconst SPLIT_INDEX = 24;\n\t\t\treturn Utils.text.insertUnseenWhitespace(this.messageText, SPLIT_INDEX);\n\t\t},\n\n\t\thiddenMessageText(): string\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['users/getPosition'](this.item.dialogId);\n\t\t\t}\n\n\t\t\tif (this.dialog.type === DialogType.open)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('IM_RECENT_CHAT_TYPE_OPEN');\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_RECENT_CHAT_TYPE_GROUP');\n\t\t},\n\n\t\tstatusIcon(): string\n\t\t{\n\t\t\tif (!this.isLastMessageAuthor || this.isBot || this.needsBirthdayPlaceholder || !this.item.message)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (this.isSelfChat)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (this.item.message.status === MessageStatus.error)\n\t\t\t{\n\t\t\t\treturn 'error';\n\t\t\t}\n\n\t\t\tif (this.item.liked)\n\t\t\t{\n\t\t\t\treturn 'like';\n\t\t\t}\n\n\t\t\tif (this.item.message.status === MessageStatus.delivered)\n\t\t\t{\n\t\t\t\treturn 'read';\n\t\t\t}\n\n\t\t\treturn 'unread';\n\t\t},\n\n\t\tformattedCounter()\n\t\t{\n\t\t\treturn this.dialog.counter > 99 ? '99+' : this.dialog.counter;\n\t\t},\n\n\t\tuser()\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.item.dialogId, true);\n\t\t},\n\n\t\tdialog()\n\t\t{\n\t\t\treturn this.$store.getters['dialogues/get'](this.item.dialogId, true);\n\t\t},\n\n\t\tcurrentUserId()\n\t\t{\n\t\t\treturn this.$store.state.application.common.userId;\n\t\t},\n\n\t\tisUser()\n\t\t{\n\t\t\treturn this.dialog.type === DialogType.user;\n\t\t},\n\n\t\tisChat()\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\n\t\tisSelfChat()\n\t\t{\n\t\t\treturn this.isUser && this.user.id === this.currentUserId;\n\t\t},\n\n\t\tisBot()\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn this.user.bot;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\tisLastMessageAuthor()\n\t\t{\n\t\t\tif (!this.item.message)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.currentUserId === this.item.message.senderId;\n\t\t},\n\n\t\tlastMessageAuthorAvatar()\n\t\t{\n\t\t\tconst authorDialog = this.$store.getters['dialogues/get'](this.item.message.senderId);\n\n\t\t\tif (!authorDialog)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn authorDialog.avatar;\n\t\t},\n\n\t\tlastMessageAuthorAvatarStyle()\n\t\t{\n\t\t\treturn {backgroundImage: `url('${this.lastMessageAuthorAvatar}')`};\n\t\t},\n\n\t\tisChatMuted()\n\t\t{\n\t\t\tif (this.isUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst isMuted = this.dialog.muteList.find(element => {\n\t\t\t\treturn element === this.currentUserId;\n\t\t\t});\n\n\t\t\treturn !!isMuted;\n\t\t},\n\n\t\tneedsBirthdayPlaceholder()\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['recent/needsBirthdayPlaceholder'](this.item.dialogId);\n\t\t},\n\n\t\tshowBirthdays()\n\t\t{\n\t\t\treturn this.$store.getters['recent/getOption'](RecentSettings.showBirthday);\n\t\t},\n\n\t\tshowLastMessage()\n\t\t{\n\t\t\treturn this.$store.getters['recent/getOption'](RecentSettings.showLastMessage);\n\t\t},\n\n\t\tinvitation()\n\t\t{\n\t\t\treturn this.item.invitation;\n\t\t},\n\n\t\tnewUserPopupContainer()\n\t\t{\n\t\t\treturn `#popup-window-content-bx-im-recent-welcome-${this.item.dialogId}`;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tinvitation(newValue, oldValue)\n\t\t{\n\t\t\tif (!this.compactMode)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// invitation accepted, user logged in\n\t\t\tif (oldValue.isActive === true && newValue.isActive === false)\n\t\t\t{\n\t\t\t\tthis.openNewUserPopup();\n\t\t\t}\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\topenNewUserPopup()\n\t\t{\n\t\t\tif (!this.isVisibleOnScreen || BX.MessengerProxy.isSliderOpened())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.newUserPopup = this.getNewUserPopup();\n\t\t\tthis.newUserPopup.show();\n\t\t\tthis.showNewUserPopup = true;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.newUserPopup.setOffset({\n\t\t\t\t\toffsetTop: -this.newUserPopup.popupContainer.offsetHeight + 1,\n\t\t\t\t\toffsetLeft: -this.newUserPopup.popupContainer.offsetWidth + 13\n\t\t\t\t});\n\t\t\t\tthis.newUserPopup.adjustPosition();\n\t\t\t});\n\t\t},\n\t\tgetNewUserPopup()\n\t\t{\n\t\t\treturn PopupManager.create({\n\t\t\t\tid: `bx-im-recent-welcome-${this.item.dialogId}`,\n\t\t\t\tbindElement: this.$refs.container,\n\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\tclassName: 'bx-im-recent-welcome',\n\t\t\t\tcacheable: false,\n\t\t\t\tanimation: {\n\t\t\t\t\tshowClassName: 'bx-im-recent-new-user-popup-show',\n\t\t\t\t\tcloseClassName: 'bx-im-recent-new-user-popup-hide',\n\t\t\t\t\tcloseAnimationType: 'animation'\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonNewUserPopupClick(event)\n\t\t{\n\t\t\tconst target = !this.compactMode || event.altKey? OpenTarget.current: OpenTarget.auto;\n\n\t\t\tEventEmitter.emit(EventType.dialog.open, {\n\t\t\t\t...this.item,\n\t\t\t\ttarget\n\t\t\t});\n\t\t},\n\t\tonNewUserPopupClose()\n\t\t{\n\t\t\tthis.newUserPopup.close();\n\t\t\tthis.newUserPopup = null;\n\t\t\tthis.showNewUserPopup = false;\n\t\t},\n\t\tformatDate(date)\n\t\t{\n\t\t\tconst format = [\n\t\t\t\t['today', 'H:i'],\n\t\t\t\t['d7', 'D'],\n\t\t\t\t['', 'd.m.Y']\n\t\t\t];\n\n\t\t\treturn BX.date.format(format, date);\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :data-id=\"item.dialogId\" class=\"bx-im-recent-item-wrap\">\n\t\t<div v-if=\"!compactMode\" :class=\"{'bx-im-recent-item-no-text': !showLastMessage, 'bx-im-recent-item-pinned': item.pinned}\" class=\"bx-im-recent-item\">\n\t\t\t<div class=\"bx-im-recent-avatar-wrap\">\n\t\t\t\t<Avatar :dialogId=\"item.dialogId\" :size=\"AvatarSize.L\" :withTyping=\"true\"/>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-recent-item-content\">\n\t\t\t\t<div class=\"bx-im-recent-item-content-header\">\n\t\t\t\t\t<ChatTitle :dialogId=\"item.dialogId\" :withMute=\"true\" />\n\t\t\t\t\t<div class=\"bx-im-recent-date\">\n\t\t\t\t\t\t<div v-if=\"statusIcon\" :class=\"'bx-im-recent-status-icon bx-im-recent-status-icon-' + statusIcon\"></div>\n\t\t\t\t\t\t{{ formattedDate }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-recent-item-content-bottom\">\n\t\t\t\t\t<div class=\"bx-im-recent-message-text-wrap\">\n\t\t\t\t\t\t<!-- Message text -->\n\t\t\t\t\t\t<span class=\"bx-im-recent-message-text\">\n\t\t\t\t\t\t\t<template v-if=\"item.draft.text && dialog.counter === 0\">\n\t\t\t\t\t\t\t\t<span class=\"bx-im-recent-draft-prefix\">{{ $Bitrix.Loc.getMessage('IM_RECENT_MESSAGE_DRAFT_2', {'#TEXT#': ''}) }}</span>\n\t\t\t\t\t\t\t\t<span>{{ item.draft.text }}</span>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if=\"item.invitation.isActive\">\n\t\t\t\t\t\t\t\t<span class=\"bx-im-recent-message-text-invitation\">{{ $Bitrix.Loc.getMessage('IM_RECENT_INVITATION_NOT_ACCEPTED') }}</span>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if=\"needsBirthdayPlaceholder\">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_RECENT_BIRTHDAY') }}\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if=\"!showLastMessage\">\n\t\t\t\t\t\t\t\t{{ hiddenMessageText }}\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<span v-if=\"isLastMessageAuthor\" class=\"bx-im-recent-last-message-author-icon-self\"></span>\n\t\t\t\t\t\t\t\t<template v-else-if=\"isChat && item.message.senderId\">\n\t\t\t\t\t\t\t\t\t<span v-if=\"lastMessageAuthorAvatar\" :style=\"lastMessageAuthorAvatarStyle\" class=\"bx-im-recent-last-message-author-icon-user\"></span>\n\t\t\t\t\t\t\t\t\t<span v-else class=\"bx-im-recent-last-message-author-icon-user bx-im-recent-last-message-author-icon-user-default\"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span>{{ formattedMessageText }}</span>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<!-- End message text -->\n\t\t\t\t\t</div>\n\t\t\t\t\t<div :class=\"{'bx-im-recent-counter-static-wrap-extended': dialog.counter > 99}\" class=\"bx-im-recent-counter-static-wrap\">\n\t\t\t\t\t\t<div v-if=\"item.unread || item.pinned || dialog.counter > 0\" class=\"bx-im-recent-counter-wrap\">\n\t\t\t\t\t\t\t<div v-if=\"item.pinned && dialog.counter === 0 && !item.unread\" class=\"bx-im-recent-pinned-icon\"></div>\n\t\t\t\t\t\t\t<div v-if=\"dialog.counter > 0 && !isSelfChat\" :class=\"{'bx-im-recent-counter-muted': isChatMuted}\" class=\"bx-im-recent-counter\">\n\t\t\t\t\t\t\t\t{{ formattedCounter }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-else-if=\"item.unread\" :class=\"{'bx-im-recent-counter-muted': isChatMuted}\"  class=\"bx-im-recent-counter bx-im-recent-counter-unread\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"compactMode\" class=\"bx-im-recent-item\" :class=\"{'bx-im-recent-item-pinned': item.pinned, 'bx-im-recent-item-no-counter': dialog.counter === 0}\" ref=\"container\">\n\t\t\t<div class=\"bx-im-recent-avatar-wrap\">\n\t\t\t\t<Avatar\n\t\t\t\t\t:dialogId=\"item.dialogId\"\n\t\t\t\t\t:size=\"AvatarSize.M\"\n\t\t\t\t\t:withStatus=\"false\"\n\t\t\t\t\t:withCounter=\"true\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<template v-if=\"showNewUserPopup\">\n\t\t\t\t<Teleport :to=\"newUserPopupContainer\">\n\t\t\t\t\t<NewUserPopup :title=\"dialog.name\" :text=\"$Bitrix.Loc.getMessage('IM_RECENT_NEW_USER_POPUP_TEXT')\" @click=\"onNewUserPopupClick\" @close=\"onNewUserPopupClose\"/>\n\t\t\t\t</Teleport>\n\t\t\t</template>\n\t\t</div>\n\t\t</div>\n\t`\n};","import {mapState} from 'ui.vue3.vuex';\nimport {MenuManager} from 'main.popup';\nimport {Loc} from 'main.core';\n\nimport {RecentCallStatus, DialogType} from 'im.old-chat-embedding.const';\nimport {Utils} from 'im.old-chat-embedding.lib.utils';\nimport {Avatar, AvatarSize} from 'im.old-chat-embedding.component.elements';\n\n// @vue/component\nexport const ActiveCall = {\n\tname: 'ActiveCall',\n\tcomponents: {Avatar},\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t},\n\t\tcompactMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t}\n\t},\n\temits: ['click', 'contextmenu'],\n\tcomputed: {\n\t\tRecentCallStatus: () => RecentCallStatus,\n\t\tAvatarSize: () => AvatarSize,\n\t\tchatData()\n\t\t{\n\t\t\treturn this.item.call.associatedEntity;\n\t\t},\n\t\tisUser()\n\t\t{\n\t\t\treturn this.chatData.advanced.chatType === DialogType.private;\n\t\t},\n\t\tisTabWithActiveCall()\n\t\t{\n\t\t\treturn false;\n\t\t},\n\t\tavatarStyle()\n\t\t{\n\t\t\treturn {backgroundImage: `url(${this.chatData.avatar})`};\n\t\t},\n\t\tavatarText()\n\t\t{\n\t\t\treturn Utils.text.getFirstLetters(this.item.name);\n\t\t},\n\t\tisDarkTheme()\n\t\t{\n\t\t\treturn this.application.options.darkTheme;\n\t\t},\n\t\tformattedName()\n\t\t{\n\t\t\treturn Utils.text.htmlspecialcharsback(this.item.name);\n\t\t},\n\t\t...mapState({\n\t\t\tapplication: state => state.application\n\t\t})\n\t},\n\tmethods:\n\t{\n\t\tonJoinClick(event)\n\t\t{\n\t\t},\n\t\tonHangupClick()\n\t\t{\n\t\t},\n\t\tonClick(event)\n\t\t{\n\t\t\tconst item = this.$store.getters['recent/get'](this.item.dialogId);\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.$emit('click', {item, $event: event});\n\t\t},\n\t\tonRightClick()\n\t\t{\n\t\t\tconst item = this.$store.getters['recent/get'](this.item.dialogId);\n\t\t\tif (!item)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.$emit('contextmenu', {item, $event: event});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :data-id=\"item.dialogId\" class=\"bx-im-recent-item-wrap\">\n\t\t<div v-if=\"!compactMode\" @click=\"onClick\" @click.right.prevent=\"onRightClick\" class=\"bx-im-recent-item bx-im-recent-active-call-item\">\n\t\t\t<div class=\"bx-im-recent-avatar-wrap\">\n\t\t\t\t<Avatar :dialogId=\"item.dialogId\" :size=\"AvatarSize.L\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-recent-item-content\">\n\t\t\t\t<!-- Waiting status -->\n\t\t\t\t<template v-if=\"item.state === RecentCallStatus.waiting\">\n\t\t\t\t\t<!-- 1-on-1 -->\n\t\t\t\t\t<div v-if=\"isUser\"  class=\"bx-im-recent-active-call-waiting-content\">\n\t\t\t\t\t\t<div class=\"bx-im-recent-active-call-icon bx-im-recent-active-call-waiting-icon\"></div>\n\t\t\t\t\t\t<div class=\"bx-im-recent-active-call-waiting-title\">\n\t\t\t\t\t\t\t{{ formattedName }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<!-- Chat -->\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<div class=\"bx-im-recent-item-content-header\">\n\t\t\t\t\t\t\t<div class=\"bx-im-recent-active-call-icon bx-im-recent-active-call-waiting-icon\"></div>\n\t\t\t\t\t\t\t<span class=\"bx-im-recent-active-call-waiting-title\" :title=\"formattedName\">\n\t\t\t\t\t\t\t\t{{ formattedName }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-recent-item-content-bottom\">\n\t\t\t\t\t\t\t<div @click.stop=\"onJoinClick\" class=\"bx-im-recent-active-call-button bx-im-recent-active-call-join-button\">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_RECENT_ACTIVE_CALL_JOIN') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<!-- Joined status -->\n\t\t\t\t<template v-else-if=\"item.state === RecentCallStatus.joined\">\n\t\t\t\t\t<!-- 1-on-1 -->\n\t\t\t\t\t<div v-if=\"isUser || !isTabWithActiveCall\" class=\"bx-im-recent-active-call-joined-content\">\n\t\t\t\t\t\t<div class=\"bx-im-recent-active-call-icon bx-im-recent-active-call-joined-icon\"></div>\n\t\t\t\t\t\t<div class=\"bx-im-recent-active-call-joined-title\">\n\t\t\t\t\t\t\t{{ formattedName }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<!-- Chat -->\n\t\t\t\t\t<div v-else-if=\"!isUser && isTabWithActiveCall\">\n\t\t\t\t\t\t<div class=\"bx-im-recent-item-content-header\">\n\t\t\t\t\t\t\t<div class=\"bx-im-recent-active-call-icon bx-im-recent-active-call-joined-icon\"></div>\n\t\t\t\t\t\t\t<span class=\"bx-im-recent-active-call-joined-title\" :title=\"formattedName\">\n\t\t\t\t\t\t\t\t{{ formattedName }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-recent-item-content-bottom\">\n\t\t\t\t\t\t\t<div @click.stop=\"onHangupClick\" class=\"bx-im-recent-active-call-button bx-im-recent-active-call-hangup-button\">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_RECENT_ACTIVE_CALL_HANGUP') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"compactMode\" @click=\"onClick\" @click.right.prevent=\"onRightClick\" class=\"bx-im-recent-item bx-im-recent-active-call-item\">\n\t\t\t<div class=\"bx-im-recent-avatar-wrap\">\n\t\t\t\t<Avatar :dialogId=\"item.dialogId\" :size=\"AvatarSize.M\" />\n\t\t\t\t<div class=\"bx-im-recent-active-call-compact-icon-container\">\n\t\t\t\t\t<div v-if=\"item.state === RecentCallStatus.waiting\" class=\"bx-im-recent-active-call-icon bx-im-recent-active-call-waiting-icon\"></div>\n\t\t\t\t\t<div v-else-if=\"item.state === RecentCallStatus.joined\" class=\"bx-im-recent-active-call-icon bx-im-recent-active-call-joined-icon\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t</div>\n\t`\n};","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {EventType, SettingsMap, RecentSettingsMap} from 'im.old-chat-embedding.const';\nimport {Logger} from 'im.old-chat-embedding.lib.logger';\nimport {Utils} from 'im.old-chat-embedding.lib.utils';\n\nexport class SettingsManager\n{\n\tstatic instance = null;\n\tstore: Object = null;\n\n\tstatic init($Bitrix): void\n\t{\n\t\tif (this.instance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.instance = new this($Bitrix);\n\t}\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\t\tthis.initSettings();\n\n\t\tthis.onSettingsChangeHandler = this.onSettingsChange.bind(this);\n\t\tEventEmitter.subscribe(EventType.dialog.settingsChange, this.onSettingsChangeHandler);\n\n\t\tif (Utils.platform.isBitrixDesktop() && !Type.isUndefined(BX.desktop))\n\t\t{\n\t\t\tBX.desktop.addCustomEvent('bxSaveSettings', (settings) => {\n\t\t\t\tthis.onSettingsChangeHandler({data: settings});\n\t\t\t});\n\t\t}\n\t}\n\n\tinitSettings()\n\t{\n\t\tif (!BX.MessengerProxy)\n\t\t{\n\t\t\tconsole.error('Im.RecentList: SettingsManager: BX.MessengerProxy is not available');\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.initGeneralSettings();\n\t\tthis.initRecentSettings();\n\t}\n\n\tinitGeneralSettings()\n\t{\n\t\tconst initialSettings = {};\n\t\tObject.entries(SettingsMap).forEach(([oldName, name]) => {\n\t\t\tinitialSettings[name] = BX.MessengerProxy.getOption(oldName);\n\t\t});\n\n\t\tthis.store.dispatch('application/setOptions', initialSettings);\n\t}\n\n\tinitRecentSettings()\n\t{\n\t\tconst initialSettings = {};\n\t\tObject.entries(RecentSettingsMap).forEach(([oldName, name]) => {\n\t\t\tinitialSettings[name] = BX.MessengerProxy.getOption(oldName);\n\t\t});\n\n\t\tthis.store.dispatch('recent/setOptions', initialSettings);\n\t}\n\n\tonSettingsChange({data: event})\n\t{\n\t\tLogger.warn('Im.RecentList: SettingsChange', event);\n\t\tconst generalSettings = {};\n\t\tconst recentSettings = {};\n\t\tObject.entries(event).forEach(([name, value]) => {\n\t\t\tif (Object.keys(RecentSettingsMap).includes(name))\n\t\t\t{\n\t\t\t\trecentSettings[RecentSettingsMap[name]] = value;\n\t\t\t}\n\n\t\t\tif (Object.keys(SettingsMap).includes(name))\n\t\t\t{\n\t\t\t\tgeneralSettings[SettingsMap[name]] = value;\n\t\t\t}\n\t\t});\n\n\t\tthis.store.dispatch('application/setOptions', generalSettings);\n\t\tthis.store.dispatch('recent/setOptions', recentSettings);\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.dialog.settingsChange, this.onSettingsChangeHandler);\n\t}\n}","import {EventEmitter} from 'main.core.events';\nimport {Type} from 'main.core';\n\nimport {Utils} from 'im.old-chat-embedding.lib.utils';\n\nexport class BroadcastManager extends EventEmitter\n{\n\tstatic instance = null;\n\tstatic channelName = 'im-recent';\n\tstatic eventNamespace = 'BX.Messenger.Embedding.Recent.BroadcastManager';\n\tstatic events = {\n\t\trecentListUpdate: 'recentListUpdate'\n\t};\n\n\tstatic getInstance()\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(BroadcastManager.eventNamespace);\n\t\tthis.init();\n\t}\n\n\tisSupported()\n\t{\n\t\treturn !Type.isUndefined(window.BroadcastChannel) && !Utils.platform.isBitrixDesktop();\n\t}\n\n\tinit()\n\t{\n\t\tif (!this.isSupported())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.channel = new BroadcastChannel(BroadcastManager.channelName);\n\t\tthis.channel.addEventListener('message', ({data: {type, data}}) => {\n\t\t\tthis.emit(type, data);\n\t\t});\n\t}\n\n\tsendRecentList(recentData: Object)\n\t{\n\t\tif (!this.isSupported())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.channel.postMessage({\n\t\t\ttype: BroadcastManager.events.recentListUpdate,\n\t\t\tdata: recentData\n\t\t});\n\t}\n}","import {EventEmitter} from 'main.core.events';\n\nimport {RecentCallStatus} from 'im.old-chat-embedding.const';\n\nexport class CallManager\n{\n\tstatic instance = null;\n\tstore: Object = null;\n\n\tstatic init($Bitrix): void\n\t{\n\t\tif (this.instance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.instance = new this($Bitrix);\n\t}\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\n\t\tthis.onCallCreatedHandler = this.onCallCreated.bind(this);\n\t\tEventEmitter.subscribe('CallEvents::callCreated', this.onCallCreatedHandler);\n\t}\n\n\tonCallCreated(event)\n\t{\n\t\tconst {call} = event.getData()[0];\n\t\tcall.addEventListener(BX.Call.Event.onJoin, this.onCallJoin.bind(this));\n\t\tcall.addEventListener(BX.Call.Event.onLeave, this.onCallLeave.bind(this));\n\t\tcall.addEventListener(BX.Call.Event.onDestroy, this.onCallDestroy.bind(this));\n\n\t\tthis.store.dispatch('recent/addActiveCall', {\n\t\t\tdialogId: call.associatedEntity.id,\n\t\t\tname: call.associatedEntity.name,\n\t\t\tcall: call,\n\t\t\tstate: RecentCallStatus.waiting\n\t\t});\n\t}\n\n\tonCallJoin(event)\n\t{\n\t\tthis.store.dispatch('recent/updateActiveCall', {\n\t\t\tdialogId: event.call.associatedEntity.id,\n\t\t\tfields: {\n\t\t\t\tstate: RecentCallStatus.joined\n\t\t\t}\n\t\t});\n\t}\n\n\tonCallLeave(event)\n\t{\n\t\tthis.store.dispatch('recent/updateActiveCall', {\n\t\t\tdialogId: event.call.associatedEntity.id,\n\t\t\tfields: {\n\t\t\t\tstate: RecentCallStatus.waiting\n\t\t\t}\n\t\t});\n\t}\n\n\tonCallDestroy(event)\n\t{\n\t\tthis.store.dispatch('recent/deleteActiveCall', {\n\t\t\tdialogId: event.call.associatedEntity.id\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(window, 'CallEvents::callCreated', this.onCallCreatedHandler);\n\t}\n}","import {EventEmitter} from 'main.core.events';\n\nimport {EventType} from 'im.old-chat-embedding.const';\n\nexport class DraftManager\n{\n\tstatic instance = null;\n\tstore: Object = null;\n\n\tstatic init($Bitrix): void\n\t{\n\t\tif (this.instance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.instance = new this($Bitrix);\n\t}\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\n\t\tthis.initDraftHistory();\n\n\t\tthis.onSetDraftHandler = this.onSetDraft.bind(this);\n\t\tEventEmitter.subscribe(EventType.recent.setDraftMessage, this.onSetDraftHandler);\n\t}\n\n\tinitDraftHistory()\n\t{\n\t\tif (!BX.MessengerProxy)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst history = BX.MessengerProxy.getTextareaHistory();\n\t\tObject.entries(history).forEach(([dialogId, text]) => {\n\t\t\tthis.setDraftMessage(dialogId, text);\n\t\t});\n\t}\n\n\tonSetDraft({data: {dialogId, text}})\n\t{\n\t\tthis.setDraftMessage(dialogId, text);\n\t}\n\n\tsetDraftMessage(dialogId, text)\n\t{\n\t\tthis.store.dispatch('recent/draft', {\n\t\t\tid: dialogId,\n\t\t\ttext\n\t\t});\n\t}\n\n\tdestroy()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.recent.setDraftMessage, this.onSetDraftHandler);\n\t}\n}","import {Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {EventType} from 'im.old-chat-embedding.const';\n\nexport class EventHandler\n{\n\tstatic instance = null;\n\tstore: Object = null;\n\n\tstatic init($Bitrix): void\n\t{\n\t\tif (this.instance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.instance = new this($Bitrix);\n\t}\n\n\tconstructor($Bitrix)\n\t{\n\t\tthis.store = $Bitrix.Data.get('controller').store;\n\n\t\tthis.subscribeToEvents();\n\t}\n\n\tsubscribeToEvents()\n\t{\n\t\tthis.onSetCounterHandler = this.onSetCounter.bind(this);\n\t\tthis.onSetMessageHandler = this.onSetMessage.bind(this);\n\t\tthis.onHideChatHandler = this.onHideChat.bind(this);\n\t\tthis.onLeaveChatHandler = this.onLeaveChat.bind(this);\n\t\tthis.onClearLikeHandler = this.onClearLike.bind(this);\n\t\tthis.onClearHistoryHandler = this.onClearHistory.bind(this);\n\n\t\tEventEmitter.subscribe(EventType.recent.setCounter, this.onSetCounterHandler);\n\t\tEventEmitter.subscribe(EventType.recent.setMessage, this.onSetMessageHandler);\n\t\tEventEmitter.subscribe(EventType.recent.hideChat, this.onHideChatHandler);\n\t\tEventEmitter.subscribe(EventType.recent.leaveChat, this.onLeaveChatHandler);\n\t\tEventEmitter.subscribe(EventType.recent.clearLike, this.onClearLikeHandler);\n\t\tEventEmitter.subscribe(EventType.dialog.clearHistory, this.onClearHistoryHandler);\n\t}\n\n\tonSetCounter({data: {dialogId, counter}})\n\t{\n\t\tconst recentItem = this.store.getters['recent/get'](dialogId);\n\t\tconst dialog = this.store.getters['dialogues/get'](dialogId);\n\t\tif (!recentItem || !dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId: dialogId,\n\t\t\tfields: {\n\t\t\t\tcounter: counter\n\t\t\t}\n\t\t});\n\t}\n\n\tonSetMessage({data: {id, dialogId, text, date}})\n\t{\n\t\tconst recentItem = this.store.getters['recent/get'](dialogId);\n\t\tconst dialog = this.store.getters['dialogues/get'](dialogId);\n\t\tif (!recentItem || !dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (id && !id.toString().startsWith('temp') && id !== recentItem.message.id)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {\n\t\t\t\t\tid: id || 0,\n\t\t\t\t\ttext: text,\n\t\t\t\t\tsenderId: this.getCurrentUserId(),\n\t\t\t\t\tstatus: recentItem.message.status,\n\t\t\t\t\tdate: date || recentItem.message.date,\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tonHideChat({data: {dialogId}})\n\t{\n\t\tconst recentItem = this.store.getters['recent/get'](dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/delete', {\n\t\t\tid: dialogId\n\t\t});\n\t}\n\n\tonLeaveChat({data: {dialogId}})\n\t{\n\t\tthis.onHideChat({data: {dialogId}});\n\t}\n\n\tonClearLike({data: {dialogId}})\n\t{\n\t\tconst recentItem = this.store.getters['recent/get'](dialogId);\n\t\tif (!recentItem || !recentItem.liked)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/like', {\n\t\t\tid: dialogId,\n\t\t\tliked: false\n\t\t});\n\t}\n\n\tonClearHistory({data: {dialogId}})\n\t{\n\t\tconst recentItem = this.store.getters['recent/get'](dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('recent/update', {\n\t\t\tid: dialogId,\n\t\t\tfields: {\n\t\t\t\tmessage: {\n\t\t\t\t\t...recentItem.message,\n\t\t\t\t\ttext: Loc.getMessage('IM_RECENT_DELETED_MESSAGE'),\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetCurrentUserId(): number\n\t{\n\t\treturn this.store.state.application.common.userId;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.unsubscribeEvents();\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tEventEmitter.unsubscribe(EventType.recent.setCounter, this.onSetCounterHandler);\n\t\tEventEmitter.unsubscribe(EventType.recent.setMessage, this.onSetMessageHandler);\n\t\tEventEmitter.unsubscribe(EventType.recent.hideChat, this.onHideChatHandler);\n\t\tEventEmitter.unsubscribe(EventType.recent.leaveChat, this.onLeaveChatHandler);\n\t\tEventEmitter.unsubscribe(EventType.recent.clearLike, this.onClearLikeHandler);\n\t}\n}","import 'ui.design-tokens';\n\nimport {EventEmitter} from 'main.core.events';\nimport {mapState} from 'ui.vue3.vuex';\n\nimport {DialogType, EventType, RecentSettings, OpenTarget} from 'im.old-chat-embedding.const';\nimport {Utils} from 'im.old-chat-embedding.lib.utils';\nimport {RecentService} from 'im.old-chat-embedding.provider.service';\nimport {RecentLoadingState} from 'im.old-chat-embedding.component.elements';\nimport {RecentMenu} from 'im.old-chat-embedding.lib.menu';\n\nimport {RecentItem} from './components/recent-item';\nimport {ActiveCall} from './components/active-call';\n\nimport {SettingsManager} from './settings-manager';\nimport {BroadcastManager} from './broadcast-manager';\nimport {CallManager} from './call-manager';\nimport {DraftManager} from './draft-manager';\nimport {EventHandler} from './event-handler';\n\nimport './css/recent-list.css';\n\n// @vue/component\nexport const RecentList = {\n\tname: 'RecentList',\n\tcomponents: {LoadingState: RecentLoadingState, RecentItem, ActiveCall},\n\tdirectives:\n\t{\n\t\t'recent-list-observer':\n\t\t{\n\t\t\tmounted(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.observer.observe(element);\n\t\t\t}\n\t\t}\n\t},\n\tprops: {\n\t\tcompactMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tvisibleElements: new Set()\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcollection()\n\t\t{\n\t\t\treturn this.$store.getters['recent/getRecentCollection'];\n\t\t},\n\t\tsections()\n\t\t{\n\t\t\treturn [this.pinnedItems, this.generalItems];\n\t\t},\n\t\tpreparedItems()\n\t\t{\n\t\t\tconst filteredCollection = this.collection.filter(item => {\n\t\t\t\tif (!this.showBirthdays && item.options.birthdayPlaceholder)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst dialog = this.$store.getters['dialogues/get'](item.dialogId, true);\n\t\t\t\tconst isUser = dialog.type === DialogType.user;\n\t\t\t\tconst hasBirthday = isUser && this.showBirthdays && this.$store.getters['users/hasBirthday'](item.dialogId);\n\t\t\t\tif (!this.showInvited && item.options.defaultUserRecord && !hasBirthday)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\treturn [...filteredCollection].sort((a, b) => {\n\t\t\t\tconst firstDate = this.$store.getters['recent/getMessageDate'](a.dialogId);\n\t\t\t\tconst secondDate = this.$store.getters['recent/getMessageDate'](b.dialogId);\n\n\t\t\t\treturn secondDate - firstDate;\n\t\t\t});\n\t\t},\n\t\tpinnedItems()\n\t\t{\n\t\t\treturn this.preparedItems.filter(item => {\n\t\t\t\treturn item.pinned === true;\n\t\t\t});\n\t\t},\n\t\tgeneralItems()\n\t\t{\n\t\t\treturn this.preparedItems.filter(item => {\n\t\t\t\treturn item.pinned === false;\n\t\t\t});\n\t\t},\n\t\tisDarkTheme()\n\t\t{\n\t\t\treturn this.application.options.darkTheme;\n\t\t},\n\t\tshowBirthdays()\n\t\t{\n\t\t\treturn this.$store.getters['recent/getOption'](RecentSettings.showBirthday);\n\t\t},\n\t\tshowInvited()\n\t\t{\n\t\t\treturn this.$store.getters['recent/getOption'](RecentSettings.showInvited);\n\t\t},\n\t\ttransitionType()\n\t\t{\n\t\t\tif (this.compactMode)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (this.isLoading)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn 'bx-messenger-recent-transition';\n\t\t},\n\t\t...mapState({\n\t\t\tactiveCalls: state => state.recent.activeCalls,\n\t\t\tapplication: state => state.application\n\t\t})\n\t},\n\tcreated()\n\t{\n\t\tthis.recentService = RecentService.getInstance();\n\t\tthis.contextMenuManager = new RecentMenu(this.$Bitrix);\n\n\t\tCallManager.init(this.$Bitrix);\n\t\tEventHandler.init(this.$Bitrix);\n\t\tSettingsManager.init(this.$Bitrix);\n\n\t\tthis.initBroadcastManager();\n\t\tthis.initObserver();\n\t\tthis.initBirthdayCheck();\n\t\tthis.manageChatOptions();\n\t\tthis.managePreloadedList();\n\n\t\tthis.isLoading = true;\n\t\tconst ignorePreloadedItems = !this.compactMode;\n\t\tthis.recentService.loadFirstPage({ignorePreloadedItems}).then(() => {\n\t\t\tthis.isLoading = false;\n\t\t\tDraftManager.init(this.$Bitrix);\n\t\t});\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t\tthis.clearBirthdayCheck();\n\t\tthis.destroyBroadcastManager();\n\t},\n\tmethods:\n\t{\n\t\tonScroll(event)\n\t\t{\n\t\t\tthis.contextMenuManager.close();\n\t\t\tif (!this.oneScreenRemaining(event) || !this.recentService.hasMoreItemsToLoad)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tthis.recentService.loadNextPage().then(() => {\n\t\t\t\tthis.isLoading = false;\n\t\t\t});\n\t\t},\n\n\t\tonClick(item, event)\n\t\t{\n\t\t\tconst target = !this.compactMode || event.altKey? OpenTarget.current: OpenTarget.auto;\n\n\t\t\tEventEmitter.emit(EventType.dialog.open, {\n\t\t\t\t...item,\n\t\t\t\tchat: this.$store.getters['dialogues/get'](item.dialogId, true),\n\t\t\t\tuser: this.$store.getters['users/get'](item.dialogId, true),\n\t\t\t\ttarget\n\t\t\t});\n\t\t},\n\n\t\tonRightClick(item, event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst target = !this.compactMode || event.altKey? OpenTarget.current: OpenTarget.auto;\n\t\t\tconst context = {\n\t\t\t\t...item,\n\t\t\t\tcompactMode: this.compactMode,\n\t\t\t\ttarget\n\t\t\t};\n\n\t\t\tthis.contextMenuManager.openMenu(context, event.currentTarget);\n\n\t\t\tevent.preventDefault();\n\t\t},\n\n\t\tonCallClick({item, $event})\n\t\t{\n\t\t\tthis.onClick(item, $event);\n\t\t},\n\n\t\tonCallRightClick({item, $event})\n\t\t{\n\t\t\tthis.onRightClick(item, $event);\n\t\t},\n\n\t\toneScreenRemaining(event)\n\t\t{\n\t\t\treturn event.target.scrollTop + event.target.clientHeight >= event.target.scrollHeight - event.target.clientHeight;\n\t\t},\n\n\t\tinitObserver()\n\t\t{\n\t\t\tthis.observer = new IntersectionObserver(((entries) => {\n\t\t\t\tentries.forEach(entry => {\n\t\t\t\t\tif (entry.isIntersecting && entry.intersectionRatio === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.visibleElements.add(entry.target.dataset.id);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.visibleElements.delete(entry.target.dataset.id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}), {threshold: [0, 1]});\n\t\t},\n\n\t\tinitBroadcastManager()\n\t\t{\n\t\t\tthis.onRecentListUpdate = (event) => {\n\t\t\t\tthis.recentService.setPreloadedData(event.data);\n\t\t\t};\n\t\t\tthis.broadcastManager = BroadcastManager.getInstance();\n\t\t\tthis.broadcastManager.subscribe(BroadcastManager.events.recentListUpdate, this.onRecentListUpdate);\n\t\t},\n\n\t\tdestroyBroadcastManager()\n\t\t{\n\t\t\tthis.broadcastManager = BroadcastManager.getInstance();\n\t\t\tthis.broadcastManager.unsubscribe(BroadcastManager.events.recentListUpdate, this.onRecentListUpdate);\n\t\t},\n\n\t\tinitBirthdayCheck()\n\t\t{\n\t\t\tconst fourHours = 60000*60*4;\n\t\t\tconst day = 60000*60*24;\n\t\t\tthis.birthdayCheckTimeout = setTimeout(() => {\n\t\t\t\tthis.recentService.loadFirstPage({ignorePreloadedItems: true});\n\t\t\t\tthis.birthdayCheckInterval = setInterval(() => {\n\t\t\t\t\tthis.recentService.loadFirstPage({ignorePreloadedItems: true});\n\t\t\t\t}, day);\n\t\t\t}, Utils.date.getTimeToNextMidnight() + fourHours);\n\t\t},\n\n\t\tclearBirthdayCheck()\n\t\t{\n\t\t\tclearTimeout(this.birthdayCheckTimeout);\n\t\t\tclearInterval(this.birthdayCheckInterval);\n\t\t},\n\n\t\tmanagePreloadedList()\n\t\t{\n\t\t\tconst {preloadedList} = this.$Bitrix.Application.get().params;\n\t\t\tif (!preloadedList)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.recentService.setPreloadedData(preloadedList);\n\t\t\tthis.broadcastManager.sendRecentList(preloadedList);\n\t\t},\n\n\t\tmanageChatOptions()\n\t\t{\n\t\t\tconst {chatOptions} = this.$Bitrix.Application.get().params;\n\t\t\tif (!chatOptions)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.$store.dispatch('dialogues/setChatOptions', chatOptions);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div @scroll=\"onScroll\" class=\"bx-messenger-recent-list\" :class=\"{'bx-messenger-recent-compact': compactMode}\" >\n\t\t\t<transition-group :name=\"transitionType\">\n\t\t\t\t<ActiveCall\n\t\t\t\t\tv-for=\"activeCall in activeCalls\"\n\t\t\t\t\t:key=\"'call-' + activeCall.dialogId\"\n\t\t\t\t\t:item=\"activeCall\"\n\t\t\t\t\t:compactMode=\"compactMode\"\n\t\t\t\t\t@click=\"onCallClick\"\n\t\t\t\t\t@click.right=\"onCallRightClick\"\n\t\t\t\t/>\n\t\t\t\t<template v-for=\"section in sections\">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for=\"item in section\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:item=\"item\"\n\t\t\t\t\t\t:compactMode=\"compactMode\"\n\t\t\t\t\t\t:isVisibleOnScreen=\"visibleElements.has(item.dialogId)\"\n\t\t\t\t\t\tv-recent-list-observer\n\t\t\t\t\t\t@click=\"onClick(item, $event)\"\n\t\t\t\t\t\t@click.right=\"onRightClick(item, $event)\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</transition-group>\n\t\t\t<LoadingState v-if=\"isLoading\" :compactMode=\"compactMode\" />\n\t\t\t<template v-if=\"collection.length === 0\">\n\t\t\t\t<div class=\"bx-im-recent-empty\">{{ $Bitrix.Loc.getMessage('IM_RECENT_EMPTY') }}</div>\n\t\t\t</template>\n\t\t</div>\n\t`\n};"],"names":["NewUserPopup","name","props","title","type","String","required","text","emits","mounted","BX","MessengerProxy","playNewUserSound","setCloseTimer","onClosePopupHandler","onClosePopup","bind","EventEmitter","subscribe","EventType","dialog","closePopup","beforeUnmount","unsubscribe","methods","onClick","$emit","onMouseOver","clearTimeout","closeTimeout","onMouseLeave","time","setTimeout","template","RecentItem","components","Avatar","ChatTitle","item","Object","compactMode","Boolean","default","isVisibleOnScreen","data","showNewUserPopup","computed","AvatarSize","formattedDate","needsBirthdayPlaceholder","$Bitrix","Loc","getMessage","formatDate","message","date","messageText","formattedText","Parser","purifyRecent","isUser","$store","getters","dialogId","hiddenMessageText","formattedMessageText","SPLIT_INDEX","Utils","insertUnseenWhitespace","DialogType","open","statusIcon","isLastMessageAuthor","isBot","isSelfChat","status","MessageStatus","error","liked","delivered","formattedCounter","counter","user","currentUserId","state","application","common","userId","isChat","id","bot","senderId","lastMessageAuthorAvatar","authorDialog","avatar","lastMessageAuthorAvatarStyle","backgroundImage","isChatMuted","isMuted","muteList","find","element","showBirthdays","RecentSettings","showBirthday","showLastMessage","invitation","newUserPopupContainer","watch","newValue","oldValue","isActive","openNewUserPopup","isSliderOpened","newUserPopup","getNewUserPopup","show","$nextTick","setOffset","offsetTop","popupContainer","offsetHeight","offsetLeft","offsetWidth","adjustPosition","PopupManager","create","bindElement","$refs","container","bindOptions","forceBindPosition","className","cacheable","animation","showClassName","closeClassName","closeAnimationType","onNewUserPopupClick","event","target","altKey","OpenTarget","current","auto","emit","onNewUserPopupClose","close","format","ActiveCall","RecentCallStatus","chatData","call","associatedEntity","advanced","chatType","private","isTabWithActiveCall","avatarStyle","avatarText","getFirstLetters","isDarkTheme","options","darkTheme","formattedName","htmlspecialcharsback","mapState","onJoinClick","onHangupClick","$event","onRightClick","SettingsManager","init","instance","constructor","store","Data","get","initSettings","onSettingsChangeHandler","onSettingsChange","settingsChange","platform","isBitrixDesktop","Type","isUndefined","desktop","addCustomEvent","settings","console","initGeneralSettings","initRecentSettings","initialSettings","entries","SettingsMap","forEach","oldName","getOption","dispatch","RecentSettingsMap","Logger","warn","generalSettings","recentSettings","value","keys","includes","destroy","BroadcastManager","getInstance","setEventNamespace","eventNamespace","isSupported","window","BroadcastChannel","channel","channelName","addEventListener","sendRecentList","recentData","postMessage","events","recentListUpdate","CallManager","onCallCreatedHandler","onCallCreated","getData","Call","Event","onJoin","onCallJoin","onLeave","onCallLeave","onDestroy","onCallDestroy","waiting","fields","joined","DraftManager","initDraftHistory","onSetDraftHandler","onSetDraft","recent","setDraftMessage","history","getTextareaHistory","EventHandler","subscribeToEvents","onSetCounterHandler","onSetCounter","onSetMessageHandler","onSetMessage","onHideChatHandler","onHideChat","onLeaveChatHandler","onLeaveChat","onClearLikeHandler","onClearLike","onClearHistoryHandler","onClearHistory","setCounter","setMessage","hideChat","leaveChat","clearLike","clearHistory","recentItem","toString","startsWith","getCurrentUserId","unsubscribeEvents","RecentList","LoadingState","RecentLoadingState","directives","binding","observer","observe","isLoading","visibleElements","Set","collection","sections","pinnedItems","generalItems","preparedItems","filteredCollection","filter","birthdayPlaceholder","hasBirthday","showInvited","defaultUserRecord","sort","a","b","firstDate","secondDate","pinned","transitionType","activeCalls","created","recentService","RecentService","contextMenuManager","RecentMenu","initBroadcastManager","initObserver","initBirthdayCheck","manageChatOptions","managePreloadedList","ignorePreloadedItems","loadFirstPage","then","clearBirthdayCheck","destroyBroadcastManager","onScroll","oneScreenRemaining","hasMoreItemsToLoad","loadNextPage","chat","shiftKey","context","openMenu","currentTarget","preventDefault","onCallClick","onCallRightClick","scrollTop","clientHeight","scrollHeight","IntersectionObserver","entry","isIntersecting","intersectionRatio","add","dataset","delete","threshold","onRecentListUpdate","setPreloadedData","broadcastManager","fourHours","day","birthdayCheckTimeout","birthdayCheckInterval","setInterval","getTimeToNextMidnight","clearInterval","preloadedList","Application","params","chatOptions"],"mappings":"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"}