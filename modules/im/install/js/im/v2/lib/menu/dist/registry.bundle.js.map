{"version":3,"file":"registry.bundle.js","sources":["../src/base/base.js","../src/recent/invite-manager.js","../src/recent/recent.js","../src/user/user.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { MenuManager, Menu } from 'main.popup';\nimport { EventEmitter } from 'main.core.events';\nimport { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { Core } from 'im.v2.application.core';\n\nimport type { MenuItem } from '../type/menu';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Lib.Menu';\n\nexport class BaseMenu extends EventEmitter\n{\n\tmenuInstance: Menu;\n\tcontext: Object;\n\ttarget: HTMLElement;\n\tstore: Store;\n\trestClient: RestClient;\n\tid: String = 'im-base-context-menu';\n\n\tstatic events = {\n\t\tonCloseMenu: 'onCloseMenu',\n\t};\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\n\t\tthis.onClosePopupHandler = this.onClosePopup.bind(this);\n\t}\n\n\t// public\n\topenMenu(context: Object, target: HTMLElement)\n\t{\n\t\tif (this.menuInstance)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\tthis.context = context;\n\t\tthis.target = target;\n\t\tthis.menuInstance = this.getMenuInstance();\n\t\tthis.menuInstance.show();\n\n\t\t// EventEmitter.subscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t}\n\n\tgetMenuInstance(): Menu\n\t{\n\t\treturn MenuManager.create(this.getMenuOptions());\n\t}\n\n\tgetMenuOptions(): Object\n\t{\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tbindOptions: { forceBindPosition: true, position: 'bottom' },\n\t\t\ttargetContainer: document.body,\n\t\t\tbindElement: this.target,\n\t\t\tcacheable: false,\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\titems: this.#prepareMenuItems(),\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.emit(BaseMenu.events.onCloseMenu);\n\t\t\t\t\tthis.close();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [];\n\t}\n\n\tgetMenuClassName(): string\n\t{\n\t\treturn '';\n\t}\n\n\tonClosePopup()\n\t{\n\t\tthis.close();\n\t}\n\n\tclose()\n\t{\n\t\t// EventEmitter.unsubscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t\tif (!this.menuInstance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.menuInstance.destroy();\n\t\tthis.menuInstance = null;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.close();\n\t}\n\n\tgetCurrentUserId(): number\n\t{\n\t\treturn Core.getUserId();\n\t}\n\n\t#prepareMenuItems(): MenuItem[]\n\t{\n\t\treturn this.#filterExcessDelimiters(this.getMenuItems());\n\t}\n\n\t#filterExcessDelimiters(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tconst menuItemsWithoutDuplicates = this.#filterDuplicateDelimiters(menuItems);\n\n\t\treturn this.#filterFinishingDelimiter(menuItemsWithoutDuplicates);\n\t}\n\n\t#filterDuplicateDelimiters(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tlet previousElement = null;\n\n\t\treturn menuItems.filter((element) => {\n\t\t\tif (this.#isDelimiter(previousElement) && this.#isDelimiter(element))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element !== null)\n\t\t\t{\n\t\t\t\tpreviousElement = element;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\t#filterFinishingDelimiter(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tlet previousElement = null;\n\n\t\treturn menuItems.reverse().filter((element) => {\n\t\t\tif (previousElement === null && this.#isDelimiter(element))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element !== null)\n\t\t\t{\n\t\t\t\tpreviousElement = element;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}).reverse();\n\t}\n\n\t#isDelimiter(element: ?MenuItem): boolean\n\t{\n\t\treturn Type.isObjectLike(element) && element.delimiter === true;\n\t}\n}\n","import {ajax as Ajax, Loc} from 'main.core';\n\nconst resendAction = 'intranet.controller.invite.reinvite';\nconst cancelAction = 'intranet.controller.invite.deleteinvitation';\n\nexport const InviteManager = {\n\tresendInvite(userId: number)\n\t{\n\t\tconst data = {\n\t\t\tparams: {userId}\n\t\t};\n\t\tAjax.runAction(resendAction, {data}).then(() => {\n\t\t\tthis.showNotification(Loc.getMessage('IM_LIB_INVITE_RESEND_DONE'), 2000);\n\t\t}, (error) => {\n\t\t\tthis.handleActionError(error);\n\t\t});\n\t},\n\n\tcancelInvite(userId: number)\n\t{\n\t\tconst data = {\n\t\t\tparams: {userId}\n\t\t};\n\t\tAjax.runAction(cancelAction, {data}).then(() => {\n\t\t\tthis.showNotification(Loc.getMessage('IM_LIB_INVITE_CANCEL_DONE'), 2000);\n\t\t}, (error) => {\n\t\t\tthis.handleActionError(error);\n\t\t});\n\t},\n\n\tshowNotification(text: string, autoHideDelay: number = 4000)\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: text,\n\t\t\tautoHideDelay\n\t\t});\n\t},\n\n\thandleActionError(error: Object)\n\t{\n\t\tif (error.status === 'error' && error.errors.length > 0)\n\t\t{\n\t\t\tconst errorContent = error.errors.map((element) => {\n\t\t\t\treturn element.message;\n\t\t\t}).join('. ');\n\t\t\tthis.showNotification(errorContent);\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.showNotification(Loc.getMessage('IM_LIST_RECENT_CONNECT_ERROR'));\n\t}\n};","import { Loc, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\n\nimport { Core } from 'im.v2.application.core';\nimport { ActionByRole, EventType, SidebarDetailBlock, ChatType, UserType, ActionByUserType } from 'im.v2.const';\nimport { CallManager } from 'im.v2.lib.call';\nimport { ChatService, RecentService } from 'im.v2.provider.service';\nimport { Utils } from 'im.v2.lib.utils';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { showLeaveChatConfirm } from 'im.v2.lib.confirm';\nimport { ChannelManager } from 'im.v2.lib.channel';\nimport { Messenger } from 'im.public';\nimport { Analytics as CallAnalytics } from 'call.lib.analytics';\n\nimport { BaseMenu } from '../base/base';\nimport { InviteManager } from './invite-manager';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\nimport type { ImModelRecentItem, ImModelUser, ImModelChat } from 'im.v2.model';\n\nexport class RecentMenu extends BaseMenu\n{\n\tcontext: ImModelRecentItem;\n\tcallManager: CallManager;\n\tpermissionManager: PermissionManager;\n\tchatService: ChatService;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-recent-context-menu';\n\t\tthis.chatService = new ChatService();\n\t\tthis.callManager = CallManager.getInstance();\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetMenuOptions(): Object\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: true,\n\t\t\toffsetLeft: 32,\n\t\t};\n\t}\n\n\tgetMenuClassName(): string\n\t{\n\t\treturn this.context.compactMode ? '' : super.getMenuClassName();\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\tif (this.context.invitation.isActive)\n\t\t{\n\t\t\treturn this.getInviteItems();\n\t\t}\n\n\t\treturn [\n\t\t\tthis.getUnreadMessageItem(),\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getMuteItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getChatsWithUserItem(),\n\t\t\tthis.getHideItem(),\n\t\t\tthis.getLeaveItem(),\n\t\t];\n\t}\n\n\tgetSendMessageItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_WRITE_V2'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetUnreadMessageItem(): ?MenuItem\n\t{\n\t\tconst dialog = this.store.getters['chats/get'](this.context.dialogId, true);\n\t\tconst showReadOption = this.context.unread || dialog.counter > 0;\n\n\t\treturn {\n\t\t\ttext: showReadOption ? Loc.getMessage('IM_LIB_MENU_READ') : Loc.getMessage('IM_LIB_MENU_UNREAD'),\n\t\t\tonclick: () => {\n\t\t\t\tif (showReadOption)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.readDialog(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unreadDialog(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetPinMessageItem(): ?MenuItem\n\t{\n\t\tconst isPinned = this.context.pinned;\n\n\t\treturn {\n\t\t\ttext: isPinned ? Loc.getMessage('IM_LIB_MENU_UNPIN_MSGVER_1') : Loc.getMessage('IM_LIB_MENU_PIN_MSGVER_1'),\n\t\t\tonclick: () => {\n\t\t\t\tif (isPinned)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unpinChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.pinChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMuteItem(): ?MenuItem\n\t{\n\t\tconst canMute = this.permissionManager.canPerformActionByRole(ActionByRole.mute, this.context.dialogId);\n\t\tif (!canMute)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst dialog = this.store.getters['chats/get'](this.context.dialogId, true);\n\t\tconst isMuted = dialog.muteList.includes(Core.getUserId());\n\n\t\treturn {\n\t\t\ttext: isMuted ? Loc.getMessage('IM_LIB_MENU_UNMUTE_2') : Loc.getMessage('IM_LIB_MENU_MUTE_2'),\n\t\t\tonclick: () => {\n\t\t\t\tif (isMuted)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unmuteChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.muteChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCallItem(): ?MenuItem\n\t{\n\t\tconst chatCanBeCalled = this.callManager.chatCanBeCalled(this.context.dialogId);\n\t\tconst chatIsAllowedToCall = this.permissionManager.canPerformActionByRole(ActionByRole.call, this.context.dialogId);\n\t\tif (!chatCanBeCalled || !chatIsAllowedToCall)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_CALL_2'),\n\t\t\tonclick: () => {\n\t\t\t\tCallAnalytics.getInstance().onRecentStartCallClick({\n\t\t\t\t\tisGroupChat: this.context.dialogId.includes('chat'),\n\t\t\t\t\tchatId: this.context.chatId,\n\t\t\t\t});\n\n\t\t\t\tthis.callManager.startCall(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenProfileItem(): ?MenuItem\n\t{\n\t\tif (!this.isUser() || this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_PROFILE_V2'),\n\t\t\thref: profileUri,\n\t\t\tonclick: () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetHideItem(): ?MenuItem\n\t{\n\t\tif (this.context.invitation?.isActive || this.context.options?.default_user_record)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_HIDE_MSGVER_1'),\n\t\t\tonclick: () => {\n\t\t\t\tRecentService.getInstance().hideChat(this.context.dialogId);\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetLeaveItem(): ?MenuItem\n\t{\n\t\tif (this.isCollabChat())\n\t\t{\n\t\t\treturn this.#leaveCollab();\n\t\t}\n\n\t\treturn this.#leaveChat();\n\t}\n\n\tgetChatsWithUserItem(): ?MenuItem\n\t{\n\t\tif (!this.isUser() || this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isAnyChatOpened = this.store.getters['application/getLayout'].entityId.length > 0;\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_FIND_CHATS_WITH_USER'),\n\t\t\tonclick: async () => {\n\t\t\t\tif (!isAnyChatOpened)\n\t\t\t\t{\n\t\t\t\t\tawait Messenger.openChat(this.context.dialogId);\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\t\tpanel: SidebarDetailBlock.chatsWithUser,\n\t\t\t\t\tstandalone: true,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t// region invitation\n\tgetInviteItems(): Array\n\t{\n\t\tconst items = [\n\t\t\tthis.getSendMessageItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t];\n\n\t\tlet canInvite; // TODO change to APPLICATION variable\n\t\tif (Type.isUndefined(BX.MessengerProxy))\n\t\t{\n\t\t\tcanInvite = true;\n\t\t\tconsole.error('BX.MessengerProxy.canInvite() method not found in v2 version!');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcanInvite = BX.MessengerProxy.canInvite();\n\t\t}\n\n\t\tconst canManageInvite = canInvite && Core.getUserId() === this.context.invitation.originator;\n\t\tif (canManageInvite)\n\t\t{\n\t\t\titems.push(\n\t\t\t\tthis.getDelimiter(),\n\t\t\t\tthis.context.invitation.canResend ? this.getResendInviteItem() : null,\n\t\t\t\tthis.getCancelInviteItem(),\n\t\t\t);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetResendInviteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_INVITE_RESEND'),\n\t\t\tonclick: () => {\n\t\t\t\tInviteManager.resendInvite(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCancelInviteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_INVITE_CANCEL'),\n\t\t\tonclick: () => {\n\t\t\t\tMessageBox.show({\n\t\t\t\t\tmessage: Loc.getMessage('IM_LIB_INVITE_CANCEL_CONFIRM'),\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\t\tInviteManager.cancelInvite(this.context.dialogId);\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: (messageBox) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\t// endregion\n\n\tgetDelimiter(): Object\n\t{\n\t\treturn { delimiter: true };\n\t}\n\n\tgetChat(): ImModelChat\n\t{\n\t\treturn this.store.getters['chats/get'](this.context.dialogId, true);\n\t}\n\n\tisUser(): boolean\n\t{\n\t\treturn this.store.getters['chats/isUser'](this.context.dialogId);\n\t}\n\n\tisBot(): boolean\n\t{\n\t\tif (!this.isUser())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst user: ImModelUser = this.store.getters['users/get'](this.context.dialogId);\n\n\t\treturn user.type === UserType.bot;\n\t}\n\n\tisChannel(): boolean\n\t{\n\t\treturn ChannelManager.isChannel(this.context.dialogId);\n\t}\n\n\tisCommentsChat(): boolean\n\t{\n\t\tconst { type }: ImModelChat = this.store.getters['chats/get'](this.context.dialogId, true);\n\n\t\treturn type === ChatType.comment;\n\t}\n\n\tisCollabChat(): boolean\n\t{\n\t\tconst { type }: ImModelChat = this.store.getters['chats/get'](this.context.dialogId, true);\n\n\t\treturn type === ChatType.collab;\n\t}\n\n\t#leaveChat(): ?MenuItem\n\t{\n\t\tconst canLeaveChat = this.permissionManager.canPerformActionByRole(ActionByRole.leave, this.context.dialogId);\n\t\tif (!canLeaveChat)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst text = this.isChannel()\n\t\t\t? Loc.getMessage('IM_LIB_MENU_LEAVE_CHANNEL')\n\t\t\t: Loc.getMessage('IM_LIB_MENU_LEAVE_MSGVER_1')\n\t\t;\n\n\t\treturn {\n\t\t\ttext,\n\t\t\tonclick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showLeaveChatConfirm(this.context.dialogId);\n\t\t\t\tif (userChoice === true)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.leaveChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\t#leaveCollab(): ?MenuItem\n\t{\n\t\tconst canLeaveChat = this.permissionManager.canPerformActionByRole(ActionByRole.leave, this.context.dialogId);\n\t\tconst canLeaveCollab = this.permissionManager.canPerformActionByUserType(ActionByUserType.leaveCollab);\n\t\tif (!canLeaveChat || !canLeaveCollab)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_LEAVE_MSGVER_1'),\n\t\t\tonclick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showLeaveChatConfirm(this.context.dialogId);\n\t\t\t\tif (!userChoice)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.chatService.leaveCollab(this.context.dialogId);\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Core } from 'im.v2.application.core';\nimport { ChatService } from 'im.v2.provider.service';\nimport { showKickUserConfirm } from 'im.v2.lib.confirm';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { ActionByRole, ChatType, EventType, UserType } from 'im.v2.const';\n\nimport { BaseMenu } from '../base/base';\n\nimport type { MenuItem } from '../type/menu';\n\nimport type { ImModelUser, ImModelChat } from 'im.v2.model';\n\ntype UserMenuContext = {\n\tuser: ImModelUser,\n\tdialog: ImModelChat\n};\n\nexport class UserMenu extends BaseMenu\n{\n\tcontext: UserMenuContext;\n\tpermissionManager: PermissionManager;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'bx-im-user-context-menu';\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetKickItem(): ?MenuItem\n\t{\n\t\tconst canKick = this.permissionManager.canPerformActionByRole(ActionByRole.kick, this.context.dialog.dialogId);\n\t\tif (!canKick)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: this.#getKickItemText(),\n\t\t\tonclick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showKickUserConfirm(this.context.dialog.dialogId);\n\t\t\t\tif (userChoice !== true)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvoid this.#kickUser();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMentionItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_USER_MENTION'),\n\t\t\tonclick: () => {\n\t\t\t\tEventEmitter.emit(EventType.textarea.insertMention, {\n\t\t\t\t\tmentionText: this.context.user.name,\n\t\t\t\t\tmentionReplacement: Utils.text.getMentionBbCode(this.context.user.id, this.context.user.name),\n\t\t\t\t\tdialogId: this.context.dialog.dialogId,\n\t\t\t\t\tisMentionSymbol: false,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetSendItem(): ?MenuItem\n\t{\n\t\tif (this.context.dialog.type === ChatType.user)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_USER_WRITE'),\n\t\t\tonclick: () => {\n\t\t\t\tvoid Messenger.openChat(this.context.user.id);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetProfileItem(): ?MenuItem\n\t{\n\t\tif (this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.user.id);\n\t\tconst isCurrentUser = this.context.user.id === Core.getUserId();\n\t\tconst phraseCode = isCurrentUser ? 'IM_LIB_MENU_OPEN_OWN_PROFILE' : 'IM_LIB_MENU_OPEN_PROFILE_V2';\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage(phraseCode),\n\t\t\thref: profileUri,\n\t\t\tonclick: () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tisCollabChat(): boolean\n\t{\n\t\tconst { type }: ImModelChat = this.store.getters['chats/get'](this.context.dialog.dialogId, true);\n\n\t\treturn type === ChatType.collab;\n\t}\n\n\tisBot(): boolean\n\t{\n\t\treturn this.context.user.type === UserType.bot;\n\t}\n\n\t#getKickItemText(): string\n\t{\n\t\tif (this.isCollabChat())\n\t\t{\n\t\t\treturn Loc.getMessage('IM_LIB_MENU_USER_KICK_FROM_COLLAB');\n\t\t}\n\n\t\treturn Loc.getMessage('IM_LIB_MENU_USER_KICK_FROM_CHAT');\n\t}\n\n\t#kickUser(): Promise\n\t{\n\t\tif (this.isCollabChat())\n\t\t{\n\t\t\treturn (new ChatService()).kickUserFromCollab(this.context.dialog.dialogId, this.context.user.id);\n\t\t}\n\n\t\treturn (new ChatService()).kickUserFromChat(this.context.dialog.dialogId, this.context.user.id);\n\t}\n}\n"],"names":["EVENT_NAMESPACE","BaseMenu","EventEmitter","constructor","id","setEventNamespace","store","Core","getStore","restClient","getRestClient","onClosePopupHandler","onClosePopup","bind","openMenu","context","target","menuInstance","close","getMenuInstance","show","MenuManager","create","getMenuOptions","bindOptions","forceBindPosition","position","targetContainer","document","body","bindElement","cacheable","className","getMenuClassName","items","events","onClose","emit","onCloseMenu","getMenuItems","destroy","getCurrentUserId","getUserId","menuItems","menuItemsWithoutDuplicates","previousElement","filter","element","reverse","Type","isObjectLike","delimiter","resendAction","cancelAction","InviteManager","resendInvite","userId","data","params","Ajax","runAction","then","showNotification","Loc","getMessage","error","handleActionError","cancelInvite","text","autoHideDelay","BX","UI","Notification","Center","notify","content","status","errors","length","errorContent","map","message","join","RecentMenu","chatService","ChatService","callManager","CallManager","getInstance","permissionManager","PermissionManager","angle","offsetLeft","compactMode","invitation","isActive","getInviteItems","getUnreadMessageItem","getPinMessageItem","getMuteItem","getOpenProfileItem","getChatsWithUserItem","getHideItem","getLeaveItem","getSendMessageItem","onclick","Messenger","openChat","dialogId","getOpenItem","dialog","getters","showReadOption","unread","counter","readDialog","unreadDialog","isPinned","pinned","unpinChat","pinChat","canMute","canPerformActionByRole","ActionByRole","mute","isMuted","muteList","includes","unmuteChat","muteChat","getCallItem","chatCanBeCalled","chatIsAllowedToCall","call","CallAnalytics","onRecentStartCallClick","isGroupChat","chatId","startCall","isUser","isBot","profileUri","Utils","user","getProfileLink","href","options","default_user_record","RecentService","hideChat","isCollabChat","isAnyChatOpened","entityId","EventType","sidebar","open","panel","SidebarDetailBlock","chatsWithUser","standalone","canInvite","isUndefined","MessengerProxy","console","canManageInvite","originator","push","getDelimiter","canResend","getResendInviteItem","getCancelInviteItem","MessageBox","modal","buttons","MessageBoxButtons","OK_CANCEL","onOk","messageBox","onCancel","getChat","type","UserType","bot","isChannel","ChannelManager","isCommentsChat","ChatType","comment","collab","canLeaveChat","leave","userChoice","showLeaveChatConfirm","leaveChat","canLeaveCollab","canPerformActionByUserType","ActionByUserType","leaveCollab","UserMenu","getKickItem","canKick","kick","showKickUserConfirm","getMentionItem","textarea","insertMention","mentionText","name","mentionReplacement","getMentionBbCode","isMentionSymbol","getSendItem","getProfileItem","isCurrentUser","phraseCode","kickUserFromCollab","kickUserFromChat"],"mappings":"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"}