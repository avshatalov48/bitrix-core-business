this.BX=this.BX||{};(function(e,s,a){"use strict";var t=babelHelpers.classPrivateFieldLooseKey("rootNode");var i=babelHelpers.classPrivateFieldLooseKey("template");var l=babelHelpers.classPrivateFieldLooseKey("lang");var r=babelHelpers.classPrivateFieldLooseKey("appId");var o=babelHelpers.classPrivateFieldLooseKey("appAllowedByTariff");var n=babelHelpers.classPrivateFieldLooseKey("fetchable");var c=babelHelpers.classPrivateFieldLooseKey("clickable");var d=babelHelpers.classPrivateFieldLooseKey("uniqueId");var b=babelHelpers.classPrivateFieldLooseKey("frame");var p=babelHelpers.classPrivateFieldLooseKey("defaultData");var v=babelHelpers.classPrivateFieldLooseKey("blockId");var h=babelHelpers.classPrivateFieldLooseKey("getFrameContent");var u=babelHelpers.classPrivateFieldLooseKey("getCoreConfigs");var P=babelHelpers.classPrivateFieldLooseKey("getAssetsConfigs");var L=babelHelpers.classPrivateFieldLooseKey("parseExtensionConfig");var f=babelHelpers.classPrivateFieldLooseKey("fetchData");var F=babelHelpers.classPrivateFieldLooseKey("bindEvents");var B=babelHelpers.classPrivateFieldLooseKey("onMessage");class H{constructor(e){Object.defineProperty(this,B,{value:j});Object.defineProperty(this,F,{value:E});Object.defineProperty(this,f,{value:O});Object.defineProperty(this,L,{value:w});Object.defineProperty(this,P,{value:m});Object.defineProperty(this,u,{value:y});Object.defineProperty(this,h,{value:g});Object.defineProperty(this,t,{writable:true,value:null});Object.defineProperty(this,i,{writable:true,value:void 0});Object.defineProperty(this,l,{writable:true,value:{}});Object.defineProperty(this,r,{writable:true,value:0});Object.defineProperty(this,o,{writable:true,value:true});Object.defineProperty(this,n,{writable:true,value:false});Object.defineProperty(this,c,{writable:true,value:false});Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:null});Object.defineProperty(this,p,{writable:true,value:null});Object.defineProperty(this,v,{writable:true,value:0});babelHelpers.classPrivateFieldLooseBase(this,d)[d]="widget"+a.Text.getRandom(8);babelHelpers.classPrivateFieldLooseBase(this,t)[t]=a.Type.isString(e.rootNode)?document.querySelector(e.rootNode):null;babelHelpers.classPrivateFieldLooseBase(this,i)[i]=a.Type.isString(e.template)?e.template:"";babelHelpers.classPrivateFieldLooseBase(this,p)[p]=a.Type.isObject(e.data)?e.data:null;babelHelpers.classPrivateFieldLooseBase(this,l)[l]=e.lang||{};babelHelpers.classPrivateFieldLooseBase(this,v)[v]=e.blockId?a.Text.toNumber(e.blockId):0;babelHelpers.classPrivateFieldLooseBase(this,r)[r]=e.appId?a.Text.toNumber(e.appId):0;babelHelpers.classPrivateFieldLooseBase(this,o)[o]=babelHelpers.classPrivateFieldLooseBase(this,r)[r]&&a.Type.isBoolean(e.appAllowedByTariff)?e.appAllowedByTariff:true;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=a.Type.isBoolean(e.fetchable)?e.fetchable:false;const s=a.Type.isFunction(BX.Landing.getMode)&&BX.Landing.getMode()==="edit";babelHelpers.classPrivateFieldLooseBase(this,c)[c]=!s}mount(){return babelHelpers.classPrivateFieldLooseBase(this,h)[h]().then((e=>{babelHelpers.classPrivateFieldLooseBase(this,b)[b]=document.createElement("iframe");babelHelpers.classPrivateFieldLooseBase(this,b)[b].className="landing-widgetvue-iframe";babelHelpers.classPrivateFieldLooseBase(this,b)[b].sandbox="allow-scripts";babelHelpers.classPrivateFieldLooseBase(this,b)[b].srcdoc=e;if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]>0&&babelHelpers.classPrivateFieldLooseBase(this,t)[t]&&!H.runningAppNodes.has(babelHelpers.classPrivateFieldLooseBase(this,t)[t])){const e=babelHelpers.classPrivateFieldLooseBase(this,t)[t].parentElement;a.Dom.clean(e);a.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,b)[b],e);babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}}))}}function g(){let e="";const s={id:babelHelpers.classPrivateFieldLooseBase(this,d)[d],origin:window.location.origin,fetchable:babelHelpers.classPrivateFieldLooseBase(this,n)[n],clickable:babelHelpers.classPrivateFieldLooseBase(this,c)[c]};return babelHelpers.classPrivateFieldLooseBase(this,u)[u]().then((s=>{e+=babelHelpers.classPrivateFieldLooseBase(this,L)[L](s);e+=babelHelpers.classPrivateFieldLooseBase(this,L)[L]({lang_additional:babelHelpers.classPrivateFieldLooseBase(this,l)[l]});return babelHelpers.classPrivateFieldLooseBase(this,P)[P]()})).then((s=>{e+=babelHelpers.classPrivateFieldLooseBase(this,L)[L](s);if(!babelHelpers.classPrivateFieldLooseBase(this,o)[o]){throw new Error(a.Loc.getMessage("LANDING_WIDGETVUE_ERROR_PAYMENT"))}if(babelHelpers.classPrivateFieldLooseBase(this,p)[p]){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}return babelHelpers.classPrivateFieldLooseBase(this,f)[f]()})).then((e=>{s.data=e})).catch((e=>{s.error=e.message||"error"})).then((()=>{const a=`\n\t\t\t\t\t<script>\n\t\t\t\t\t\tBX.ready(function() {\n\t\t\t\t\t\t\t(new BX.Landing.WidgetVue.Engine(\n\t\t\t\t\t\t\t\t${JSON.stringify(s)}\n\t\t\t\t\t\t\t)).render();\n\t\t\t\t\t\t});\n\t\t\t\t\t<\/script>\n\t\t\t\t\t\n\t\t\t\t\t<div id="${babelHelpers.classPrivateFieldLooseBase(this,d)[d]}">${babelHelpers.classPrivateFieldLooseBase(this,i)[i]}</div>\n\t\t\t\t`;e+=a;return e}))}function y(){const e=["main.core","ui.design-tokens"];const a=["bitrix24"];return s.Backend.getInstance().action("Block::getAssetsConfig",{extCodes:e,tplCodes:a})}function m(){const e=["landing.widgetvue.engine"];return s.Backend.getInstance().action("Block::getAssetsConfig",{extCodes:e})}function w(e){const s=`${document.location.protocol}//${document.location.host}`;let a="";if(e.lang_additional!==undefined){a+=`<script>BX.message(${JSON.stringify(e.lang_additional)})<\/script>`}(e.js||[]).forEach((e=>{a+=`<script src="${s}${e}"><\/script>`}));(e.css||[]).forEach((e=>{a+=`<link href="${s}${e}" type="text/css" rel="stylesheet" />`}));return a}function O(e={}){if(!babelHelpers.classPrivateFieldLooseBase(this,n)[n]){console.info("Fetch data is impossible now (haven`t handler)");return Promise.resolve({})}return s.Backend.getInstance().action("RepoWidget::fetchData",{blockId:babelHelpers.classPrivateFieldLooseBase(this,v)[v],params:e}).then((e=>{let s={};try{s=JSON.parse(e);if(s.error){throw new Error(a.Loc.getMessage("LANDING_WIDGETVUE_ERROR_FETCH"),s.error)}}catch(e){throw new Error(a.Loc.getMessage("LANDING_WIDGETVUE_ERROR_FETCH"),e)}return s}))}function E(){a.Event.bind(window,"message",babelHelpers.classPrivateFieldLooseBase(this,B)[B].bind(this))}function j(e){if(e.data&&e.data.name&&e.data.params){if(e.data.name==="fetchData"){babelHelpers.classPrivateFieldLooseBase(this,f)[f](e.data.params).then((s=>{e.source.postMessage({name:"setData",params:{data:s}},"*")})).catch((s=>{e.source.postMessage({name:"setError",params:{error:s}},"*")}))}if(e.data.name==="setSize"&&e.data.params.size!==undefined){babelHelpers.classPrivateFieldLooseBase(this,b)[b].height=parseInt(e.data.params.size)}if(e.data.name==="openApplication"&&babelHelpers.classPrivateFieldLooseBase(this,r)[r]>0){const s=a.Type.isObject(e.data.params)?e.data.params:{};BX.rest.AppLayout.openApplication(babelHelpers.classPrivateFieldLooseBase(this,r)[r],s)}if(e.data.name==="openPath"&&a.Type.isString(e.data.path)){const s=new URL(e.data.path,window.location.origin);if(s.origin===window.location.origin){window.open(s.href,"_blank")}}}}H.runningAppNodes=new Set;e.WidgetVue=H})(this.BX.Landing=this.BX.Landing||{},BX.Landing,BX);
//# sourceMappingURL=widgetvue.bundle.map.js