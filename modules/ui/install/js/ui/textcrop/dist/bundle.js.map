{"version":3,"file":"bundle.js","sources":["../src/index.js"],"sourcesContent":["import { Tag, Type } from 'main.core';\n\nexport class TextCrop\n{\n\tconstructor(options)\n\t{\n\t\tthis.target = options.target || null;\n\t\tthis.rows = options.rows || 2;\n\t\tthis.resize = options.resize || false;\n\t\tthis.text = null;\n\t\tthis.rowHeight = null;\n\n\t\tthis.layout = {\n\t\t\twrapper: null,\n\t\t\tbasicBlock: null\n\t\t}\n\t}\n\n\tgetText()\n\t{\n\t\tif(!this.text)\n\t\t{\n\t\t\tthis.text = BX.util.htmlspecialchars(this.target\n\t\t\t\t? this.target.innerText\n\t\t\t\t: null);\n\t\t}\n\n\t\treturn this.text;\n\t}\n\n\tgetWrapper()\n\t{\n\t\tif(!this.layout.wrapper)\n\t\t{\n\t\t\tthis.layout.wrapper = Tag.render`\n\t\t\t\t<div>${this.getText()}</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.wrapper;\n\t}\n\n\tgetBasicBlock()\n\t{\n\t\tif(!this.layout.basicBlock)\n\t\t{\n\t\t\tthis.layout.basicBlock = Tag.render`\n\t\t\t\t<div>a</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.layout.basicBlock;\n\t}\n\n\tgetRowHeight()\n\t{\n\t\tif(!this.rowHeight)\n\t\t{\n\t\t\tlet styleAtt = getComputedStyle(this.getWrapper());\n\n\t\t\tif (styleAtt.lineHeight  === 'normal')\n\t\t\t{\n\t\t\t\tlet firstHeight = this.getWrapper().offsetHeight;\n\t\t\t\tthis.layout.wrapper.appendChild(this.getBasicBlock());\n\t\t\t\tlet secondHeight = this.getWrapper().offsetHeight;\n\t\t\t\tthis.getBasicBlock().remove();\n\n\t\t\t\tthis.rowHeight = secondHeight - firstHeight;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.rowHeight = styleAtt.lineHeight;\n\t\t\t}\n\t\t}\n\n\t\treturn this.rowHeight;\n\t}\n\n\tcropResize()\n\t{\n\t\tif(this.resize)\n\t\t{\n\t\t\tlet timer;\n\t\t\twindow.addEventListener('resize', () => {\n\t\t\t\tif (!timer)\n\t\t\t\t{\n\t\t\t\t\ttimer = setTimeout(() => {\n\t\t\t\t\t\tthis.init();\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t}, 100);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcrop()\n\t{\n\t\tthis.init();\n\t}\n\n\tinit()\n\t{\n\t\tif(!Type.isDomNode(this.target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getText();\n\t\tthis.target.innerText = '';\n\t\tthis.layout.wrapper = '';\n\t\tthis.target.appendChild(this.getWrapper());\n\n\t\tlet rowHeight = this.getRowHeight();\n\t\tlet cropText = '';\n\t\tlet numberRows = this.getWrapper().offsetHeight / parseInt(rowHeight);\n\n\t\tif (numberRows > this.rows)\n\t\t{\n\t\t\tthis.target.setAttribute('title', this.getText());\n\n\t\t\twhile (this.getWrapper().offsetHeight / parseInt(rowHeight) > this.rows)\n\t\t\t{\n\t\t\t\tcropText = this.layout.wrapper.textContent.substring(0, this.layout.wrapper.textContent.length - 4);\n\t\t\t\tthis.layout.wrapper.textContent = cropText + '...';\n\t\t\t}\n\t\t}\n\n\t\tthis.cropResize();\n\t}\n}\n\n"],"names":["TextCrop","options","target","rows","resize","text","rowHeight","layout","wrapper","basicBlock","BX","util","htmlspecialchars","innerText","Tag","render","getText","styleAtt","getComputedStyle","getWrapper","lineHeight","firstHeight","offsetHeight","appendChild","getBasicBlock","secondHeight","remove","timer","window","addEventListener","setTimeout","init","clearTimeout","Type","isDomNode","getRowHeight","cropText","numberRows","parseInt","setAttribute","textContent","substring","length","cropResize"],"mappings":"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"}