this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,i){"use strict";const r={browser:{isSafari(){if(this.isChrome()){return false}if(!navigator.userAgent.toLowerCase().includes("safari")){return false}return!this.isSafariBased()},isSafariBased(){if(!navigator.userAgent.toLowerCase().includes("applewebkit")){return false}return navigator.userAgent.toLowerCase().includes("yabrowser")||navigator.userAgent.toLowerCase().includes("yaapp_ios_browser")||navigator.userAgent.toLowerCase().includes("crios")},isChrome(){return navigator.userAgent.toLowerCase().includes("chrome")},isFirefox(){return navigator.userAgent.toLowerCase().includes("firefox")},isIe(){return navigator.userAgent.match(/(Trident\/|MSIE\/)/)!==null},findParent(e,t){const i=t instanceof HTMLElement;if(!t||typeof t!=="string"&&!i){return null}for(;e&&e!==document;e=e.parentNode){if(typeof t==="string"){if(e.classList.contains(t)){return e}}else if(i&&e===t){return e}}return null}},platform:{isMac(){return navigator.userAgent.toLowerCase().includes("macintosh")},isLinux(){return navigator.userAgent.toLowerCase().includes("linux")},isWindows(){return navigator.userAgent.toLowerCase().includes("windows")||!this.isMac()&&!this.isLinux()},isBitrixMobile(){return navigator.userAgent.toLowerCase().includes("bitrixmobile")},isBitrixDesktop(){return navigator.userAgent.toLowerCase().includes("bitrixdesktop")},getDesktopVersion(){if(typeof this.getDesktopVersionStatic!=="undefined"){return this.getDesktopVersionStatic}if(typeof BXDesktopSystem==="undefined"){return 0}const e=BXDesktopSystem.GetProperty("versionParts");this.getDesktopVersionStatic=e[3];return this.getDesktopVersionStatic},isMobile(){return this.isAndroid()||this.isIos()||this.isBitrixMobile()},isIos(){return navigator.userAgent.toLowerCase().includes("iphone")||navigator.userAgent.toLowerCase().includes("ipad")},getIosVersion(){if(!this.isIos()){return null}let e=navigator.userAgent.toLowerCase().match(/(iphone|ipad)(.+)(OS\s([0-9]+)([_.]([0-9]+))?)/i);if(!e||!e[4]){return null}return parseFloat(e[4]+"."+(e[6]?e[6]:0))},isAndroid(){return navigator.userAgent.toLowerCase().includes("android")},openNewPage(e){if(!e){return false}if(this.isBitrixMobile()){if(typeof BX.MobileTools!=="undefined"){let t=BX.MobileTools.resolveOpenFunction(e);if(t){t();return true}}app.openNewPage(e)}else{window.open(e,"_blank")}return true}},device:{isDesktop(){return!this.isMobile()},isMobile(){if(typeof this.isMobileStatic!=="undefined"){return this.isMobileStatic}this.isMobileStatic=navigator.userAgent.toLowerCase().includes("android")||navigator.userAgent.toLowerCase().includes("webos")||navigator.userAgent.toLowerCase().includes("iphone")||navigator.userAgent.toLowerCase().includes("ipad")||navigator.userAgent.toLowerCase().includes("ipod")||navigator.userAgent.toLowerCase().includes("blackberry")||navigator.userAgent.toLowerCase().includes("windows phone");return this.isMobileStatic},orientationHorizontal:"horizontal",orientationPortrait:"portrait",getOrientation(){if(!this.isMobile()){return this.orientationHorizontal}return Math.abs(window.orientation)===0?this.orientationPortrait:this.orientationHorizontal}},text:{quote(e,t,i={},r=null){if(typeof e!=="string"){return e.toString()}if(!r){r=BX.message}e=e.replace(/\[USER=([0-9]{1,})](.*?)\[\/USER]/gi,((e,t,i)=>i));e=e.replace(/\[CHAT=(imol\|)?([0-9]{1,})](.*?)[\/CHAT]/gi,((e,t,i,r)=>r));e=e.replace(/\[CALL(?:=(.+?))?](.+?)?\[\/CALL]/gi,((e,t,i)=>i?i:t));e=e.replace(/\[ATTACH=([0-9]{1,})]/gi,((e,t,i)=>t===1e4?"":"["+r["IM_UTILS_TEXT_ATTACH"]+"] "));e=e.replace(/\[RATING=([1-5]{1})]/gi,((e,t)=>"["+r.IM_F_RATING+"] "));e=e.replace(/&nbsp;/gi," ");e=e.replace(/------------------------------------------------------(.*?)------------------------------------------------------/gims,"["+r["IM_UTILS_TEXT_QUOTE"]+"]");e=e.replace(/^(>>(.*)\n)/gi,"["+r["IM_UTILS_TEXT_QUOTE"]+"]\n");if(t&&t.FILE_ID&&t.FILE_ID.length>0){let s=[];t.FILE_ID.forEach((e=>{if(i[e].type==="image"){s.push(r["IM_UTILS_TEXT_IMAGE"])}else if(i[e].type==="audio"){s.push(r["IM_UTILS_TEXT_AUDIO"])}else if(i[e].type==="video"){s.push(r["IM_UTILS_TEXT_VIDEO"])}else{s.push(i[e].name)}}));if(s.length<=0){s.push(r["IM_UTILS_TEXT_FILE"])}e=s.join("\n")+e}else if(t&&t.ATTACH&&t.ATTACH.length>0){e="["+r["IM_UTILS_TEXT_ATTACH"]+"]\n"+e}if(e.length<=0){e=r["IM_UTILS_TEXT_DELETED"]}return e.trim()},purify(e,t,i={},r=null){if(typeof e!=="string"){return e.toString()}if(!r){r=BX.message}e=e.trim();if(e.startsWith("/me")){e=e.substr(4)}else if(e.startsWith("/loud")){e=e.substr(6)}e=e.replace(/<br><br \/>/gi,"<br />");e=e.replace(/<br \/><br>/gi,"<br />");const s=[];e=e.replace(/\[CODE\]\n?([\0-\uFFFF]*?)\[\/CODE\]/gi,(function(e,t){const i=s.length;s.push(t);return"####REPLACEMENT_CODE_"+i+"####"}));e=e.replace(/\[PUT(?:=(?:.+?))?\](?:.+?)?\[\/PUT]/gi,(function(e){return e.replace(/\[PUT(?:=(.+))?\](.+?)?\[\/PUT]/gi,(function(e,t,i){return i?i:t}))}));e=e.replace(/\[SEND(?:=(?:.+?))?\](?:.+?)?\[\/SEND]/gi,(function(e){return e.replace(/\[SEND(?:=(.+))?\](.+?)?\[\/SEND]/gi,(function(e,t,i){return i?i:t}))}));e=e.replace(/\[[buis]](.*?)\[\/[buis]]/gi,"$1");e=e.replace(/\[url](.*?)\[\/url]/gi,"$1");e=e.replace(/\[RATING=([1-5]{1})]/gi,(()=>"["+r["IM_UTILS_TEXT_RATING"]+"] "));e=e.replace(/\[ATTACH=([0-9]{1,})]/gi,(()=>"["+r["IM_UTILS_TEXT_ATTACH"]+"] "));e=e.replace(/\[USER=([0-9]{1,})](.*?)\[\/USER]/gi,"$2");e=e.replace(/\[CHAT=([0-9]{1,})](.*?)\[\/CHAT]/gi,"$2");e=e.replace(/\[SEND(?:=(?:.+?))?\](.+?)?\[\/SEND]/gi,"$1");e=e.replace(/\[PUT(?:=(?:.+?))?\](.+?)?\[\/PUT]/gi,"$1");e=e.replace(/\[CALL=([0-9]{1,})](.*?)\[\/CALL]/gi,"$2");e=e.replace(/\[PCH=([0-9]{1,})](.*?)\[\/PCH]/gi,"$2");e=e.replace(/<img.*?data-code="([^"]*)".*?>/gi,"$1");e=e.replace(/<span.*?title="([^"]*)".*?>.*?<\/span>/gi,"($1)");e=e.replace(/<img.*?title="([^"]*)".*?>/gi,"($1)");e=e.replace(/\[ATTACH=([0-9]{1,})]/gi,((e,t,i)=>t===1e4?"":"["+r["IM_UTILS_TEXT_ATTACH"]+"] "));e=e.replace(/<s>([^"]*)<\/s>/gi," ");e=e.replace(/\[s]([^"]*)\[\/s]/gi," ");e=e.replace(/\[icon=([^\]]*)]/gi,(e=>{let t=e.match(/title=(.*[^\s\]])/i);if(t&&t[1]){t=t[1];if(t.indexOf("width=")>-1){t=t.substr(0,t.indexOf("width="))}if(t.indexOf("height=")>-1){t=t.substr(0,t.indexOf("height="))}if(t.indexOf("size=")>-1){t=t.substr(0,t.indexOf("size="))}if(t){t="("+t.trim()+")"}}else{t="("+r["IM_UTILS_TEXT_ICON"]+")"}return t}));s.forEach(((t,i)=>{e=e.replace("####REPLACEMENT_CODE_"+i+"####",t)}));e=e.replace(/------------------------------------------------------(.*?)------------------------------------------------------/gims,"["+r["IM_UTILS_TEXT_QUOTE"]+"] ");e=e.replace(/^(>>(.*)(\n)?)/gim,"["+r["IM_UTILS_TEXT_QUOTE"]+"] ");e=e.replace(/<\/?[^>]+>/gi,"");if(t&&t.FILE_ID&&t.FILE_ID.length>0){let s=[];if(typeof i==="object"){t.FILE_ID.forEach((e=>{if(typeof i[e]==="undefined");else if(i[e].type==="image"){s.push(r["IM_UTILS_TEXT_IMAGE"])}else if(i[e].type==="audio"){s.push(r["IM_UTILS_TEXT_AUDIO"])}else if(i[e].type==="video"){s.push(r["IM_UTILS_TEXT_VIDEO"])}else{s.push(i[e].name)}}))}if(s.length<=0){s.push(r["IM_UTILS_TEXT_FILE"])}e=s.join(" ")+e}else if(t&&(t.WITH_ATTACH||t.ATTACH&&t.ATTACH.length>0)){e="["+r["IM_UTILS_TEXT_ATTACH"]+"] "+e}else if(t&&t.WITH_FILE){e="["+r["IM_UTILS_TEXT_FILE"]+"] "+e}if(e.length<=0){e=r["IM_UTILS_TEXT_DELETED"]}return e.replace("\n"," ").trim()},htmlspecialchars(e){if(typeof e!=="string"){return e}return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlspecialcharsback(e){if(typeof e!=="string"){return e}return e.replace(/\&quot;/g,'"').replace(/&#039;/g,"'").replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&amp;/g,"&").replace(/\&nbsp;/g," ")},getLocalizeForNumber(e,t,i="en",r=null){if(!r){r=BX.message}let s=1;t=parseInt(t);if(t<0){t=t*-1}if(i){switch(i){case"de":case"en":s=t!==1?1:0;break;case"ru":case"ua":s=t%10===1&&t%100!==11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;break}}return r[e+"_PLURAL_"+s]},getFirstLetters(e){const t=/[\p{L}\p{N} ]/u;const i=e.split(/[\s,]/).filter((e=>{const i=e.charAt(0);return t.test(i)}));if(i.length===0){return""}if(i.length>1){return i[0].charAt(0)+i[1].charAt(0)}return i[0].charAt(0)},convertSnakeToCamelCase(e){return e.replace(/(_[a-z])/gi,(e=>e.toUpperCase().replace("_","")))}},date:{getFormatType(e=t.DateFormat.default,i=null){if(!i){i=BX.message}let r=[];if(e===t.DateFormat.groupTitle){r=[["tommorow","tommorow"],["today","today"],["yesterday","yesterday"],["",i["IM_UTILS_FORMAT_DATE"]]]}else if(e===t.DateFormat.message){r=[["",i["IM_UTILS_FORMAT_TIME"]]]}else if(e===t.DateFormat.recentTitle){r=[["tommorow","today"],["today","today"],["yesterday","yesterday"],["",i["IM_UTILS_FORMAT_DATE_RECENT"]]]}else if(e===t.DateFormat.recentLinesTitle){r=[["tommorow","tommorow"],["today","today"],["yesterday","yesterday"],["",i["IM_UTILS_FORMAT_DATE_RECENT"]]]}else if(e===t.DateFormat.readedTitle){r=[["tommorow","tommorow, "+i["IM_UTILS_FORMAT_TIME"]],["today","today, "+i["IM_UTILS_FORMAT_TIME"]],["yesterday","yesterday, "+i["IM_UTILS_FORMAT_TIME"]],["",i["IM_UTILS_FORMAT_READED"]]]}else if(e===t.DateFormat.vacationTitle){r=[["",i["IM_UTILS_FORMAT_DATE_SHORT"]]]}else{r=[["tommorow","tommorow, "+i["IM_UTILS_FORMAT_TIME"]],["today","today, "+i["IM_UTILS_FORMAT_TIME"]],["yesterday","yesterday, "+i["IM_UTILS_FORMAT_TIME"]],["",i["IM_UTILS_FORMAT_DATE_TIME"]]]}return r},getDateFunction(e=null){if(this.dateFormatFunction){return this.dateFormatFunction}this.dateFormatFunction=Object.create(BX.Main.Date);if(e){this.dateFormatFunction._getMessage=t=>e[t]}return this.dateFormatFunction},format(e,i=null,r=null){if(!i){i=this.getFormatType(t.DateFormat.default,r)}return this.getDateFunction(r).format(i,e)},cast(e,t=new Date){let i=t;if(e instanceof Date){i=e}else if(typeof e==="string"){i=new Date(e)}else if(typeof e==="number"){i=new Date(e*1e3)}if(i instanceof Date&&Number.isNaN(i.getTime())){i=t}return i},getTimeToNextMidnight(){const e=new Date((new Date).setHours(24,0,0)).getTime();return e-Date.now()},getStartOfTheDay(){return new Date((new Date).setHours(0,0))},isToday(e){return this.cast(e).toDateString()===(new Date).toDateString()}},user:{getLastDateText(e={}){if(e.bot||e.network||!e.lastActivityDate){return""}const s=this.isOnline(e.lastActivityDate);const n=this.isMobileOnline(e.lastActivityDate,e.mobileLastDate);let a="";if(s&&e.idle&&!n){a=i.Loc.getMessage("IM_STATUS_AWAY_TITLE").replace("#TIME#",this.getIdleText(e.idle))}const o=this.getLastSeenText(e.lastActivityDate);if(s&&!o){a=this.getStatusText(e.status)}if(o){const t=`IM_LAST_SEEN_${e.gender}`;a=i.Loc.getMessage(t).replace("#POSITION#. ","").replace("#LAST_SEEN#",o)}if(e.absent){const s=r.date.getDateFunction();const n=r.date.getFormatType(t.DateFormat.vacationTitle);const o=i.Loc.getMessage("IM_STATUS_VACATION_TITLE").replace("#DATE#",s.format(n,e.absent.getTime()/1e3));a=a?`${a}. ${o}`:o}return a},getIdleText(e=""){if(!e){return""}return r.date.getDateFunction().format([["s60","sdiff"],["i60","idiff"],["H24","Hdiff"],["","ddiff"]],e)},isOnline(e){if(!e){return false}return Date.now()-e.getTime()<=this.getOnlineLimit()*1e3},isMobileOnline(e,t){if(!e||!t){return false}const i=5*60*1e3;return Date.now()-t.getTime()<this.getOnlineLimit()*1e3&&e-t<i},getStatusText(e){var t;const i=BX.message||{};e=e.toUpperCase();const r=`IM_STATUS_${e}`;return(t=i[r])!=null?t:e},getLastSeenText(e){if(!e){return""}const t=5*60*1e3;if(Date.now()-e.getTime()>t){return r.date.getDateFunction().formatLastActivityDate(e)}return""},isBirthdayToday(e){return e===r.date.format(new Date,"d-m")},getOnlineLimit(){const e=BX.message||{};const t=15*60;return e.LIMIT_ONLINE?Number.parseInt(e.LIMIT_ONLINE,10):t}},getLogTrackingParams(e={}){let t=[];let{name:i="tracking",data:r=[],dialog:s=null,message:n=null,files:a=null}=e;i=encodeURIComponent(i);if(r&&!(r instanceof Array)&&typeof r==="object"){let e=[];for(let t in r){if(r.hasOwnProperty(t)){e.push(encodeURIComponent(t)+"="+encodeURIComponent(r[t]))}}r=e}else if(!r instanceof Array){r=[]}if(s){t.push("timType="+s.type);if(s.type==="lines"){t.push("timLinesType="+s.entityId.split("|")[0])}}if(a){let e="file";if(a instanceof Array&&a[0]){e=a[0].type}else{e=a.type}t.push("timMessageType="+e)}else if(n){t.push("timMessageType=text")}if(this.platform.isBitrixMobile()){t.push("timDevice=bitrixMobile")}else if(this.platform.isBitrixDesktop()){t.push("timDevice=bitrixDesktop")}else if(this.platform.isIos()||this.platform.isAndroid()){t.push("timDevice=mobile")}else{t.push("timDevice=web")}return i+(r.length?"&"+r.join("&"):"")+(t.length?"&"+t.join("&"):"")},types:{isUuidV4(e){if(typeof e!=="string"){return false}const t=new RegExp(/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i);return e.search(t)===0}}};e.Utils=r})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Const,BX);
//# sourceMappingURL=utils.bundle.map.js