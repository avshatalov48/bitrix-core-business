(function(e,t,s,n){"use strict";var i,a,r,o;var c=t.Reflection.namespace("BX.Bizproc.Component");var l=function(){function e(n){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"selectedType",null);babelHelpers.defineProperty(this,"selectedCategory",null);babelHelpers.defineProperty(this,"selectedStatus",null);if(t.Type.isPlainObject(n)){this.scheme=new s.TemplatesScheme(n.scheme);this.signedParameters=n.signedParameters;this.steps=n.steps;this.action=n.action;this.executeButton=n.executeButton;this.errorsContainer=n.errorsContainer;this.stepContentTypeContainer=n.stepsContentContainers[0];this.stepContentCategoryContainer=n.stepsContentContainers[1];this.stepContentStatusContainer=n.stepsContentContainers[2]}}babelHelpers.createClass(e,[{key:"init",value:function e(){this.renderStepContents();t.Event.bind(this.executeButton,"click",this.onExecuteButtonClick.bind(this))}},{key:"renderStepContents",value:function e(){var s=this;var n=[[this.selectedType,this.stepContentTypeContainer,this.onTypeSelectorClick.bind(this)],[this.selectedCategory,this.stepContentCategoryContainer,this.onCategorySelectorClick.bind(this)],[this.selectedStatus,this.stepContentStatusContainer,this.onStatusSelectorClick.bind(this)]];var i=0;n.forEach((function(e){var n=babelHelpers.slicedToArray(e,3),a=n[0],r=n[1],o=n[2];var c=t.Type.isNil(a)?BX.message("BIZPROC_AUTOMATION_SCHEME_DROPDOWN_PLACEHOLDER"):a.Name;s.renderDropdownStepContent(r,c,o);if(a){i+=1}}));if(!t.Type.isNil(this.selectedType)&&this.scheme.getTypeCategories(this.selectedType).length<=0){this.renderTextStepContent(this.stepContentCategoryContainer,BX.message("BIZPROC_AUTOMATION_SCHEME_CATEGORIES_NOT_EXISTS"));i+=1}this.stepTo(i)}},{key:"renderDropdownStepContent",value:function e(s,n,r){t.Dom.clean(s);var o=t.Dom.create("div",{attrs:{class:"ui-ctl ui-ctl-after-icon ui-ctl-dropdown"},events:{click:r},children:[t.Tag.render(i||(i=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl-after ui-ctl-icon-angle"></div>']))),t.Tag.render(a||(a=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl-element">',"</div>"])),t.Text.encode(n))]});s.appendChild(t.Dom.create("div",{attrs:{class:"bizproc-automation-scheme__content --padding-15"},children:[o]}))}},{key:"renderTextStepContent",value:function e(s,n){t.Dom.clean(s);s.appendChild(t.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="bizproc-automation-scheme__content">\n\t\t\t\t\t<div class="ui-alert ui-alert-success">\n\t\t\t\t\t\t<span class="ui-alert-message">',"</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),t.Text.encode(n)))}},{key:"onExecuteButtonClick",value:function e(s){var n=this;s.preventDefault();if(!this.selectedType||!this.selectedStatus){this.showError({message:BX.message("BIZPROC_AUTOMATION_SCHEME_DESTINATION_SCOPE_ERROR_ACTION_".concat(this.action))});t.Dom.removeClass(this.executeButton,"ui-btn-wait");return}BX.ajax.runComponentAction("bitrix:bizproc.automation.scheme","copyMove",{mode:"class",signedParameters:this.signedParameters,data:{dstScope:{DocumentType:this.selectedType,Category:this.selectedCategory,Status:this.selectedStatus}}}).then((function(e){if(n.isSlider()){var s=BX.SidePanel.Instance.getTopSlider().getData();Object.entries(e.data).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],i=t[1];return s.set(n,i)}));s.set("targetScope",{documentType:n.selectedType,category:n.selectedCategory,status:n.selectedStatus});BX.SidePanel.Instance.close()}t.Dom.removeClass(n.executeButton,"ui-btn-wait")}))["catch"]((function(e){e.errors.forEach((function(e){return n.showError(e)}));t.Dom.removeClass(n.executeButton,"ui-btn-wait")}))}},{key:"isSlider",value:function e(){return location.href.toString().indexOf("SIDE_SLIDER")>0}},{key:"stepTo",value:function e(s){this.steps.forEach(function(e,n){if(n<s){t.Dom.addClass(e,"--success")}else{t.Dom.removeClass(e,"--success")}}.bind(this))}},{key:"onTypeSelectorClick",value:function e(t){t.preventDefault();var s=this;this.adjustDropdown(t.target,this.scheme.getDocumentTypes().map((function(e){return{id:e.Type,text:e.Name,onclick:function t(n){n.preventDefault();this.close();s.selectedType=e;s.selectedCategory=null;s.selectedStatus=null;s.renderStepContents()}}})))}},{key:"onCategorySelectorClick",value:function e(s){s.preventDefault();var n=this;var i=!t.Type.isNil(this.selectedType)?this.scheme.getTypeCategories(this.selectedType):[];if(i.length>0){this.adjustDropdown(s.target,i.map((function(e){return{id:e.Id,text:e.Name,onclick:function t(s){s.preventDefault();this.close();n.selectedCategory=e;n.selectedStatus=null;n.renderStepContents()}}})))}}},{key:"onStatusSelectorClick",value:function e(s){s.preventDefault();var n=this;var i=[];if(!t.Type.isNil(this.selectedType)){i=this.scheme.getTypeStatuses(this.selectedType,this.selectedCategory)}if(i.length>0){this.adjustDropdown(s.target,i.map((function(e){return{id:e.Id,text:e.Name,onclick:function t(s){s.preventDefault();this.close();n.selectedStatus=e;n.renderStepContents()}}})))}}},{key:"adjustDropdown",value:function e(t,s){var i=new n.Menu({autoHide:true,bindElement:t,width:t.offsetWidth,closeByEsc:true,items:s});i.show()}},{key:"showError",value:function e(s){var n=t.Dom.create("div",{props:{className:"ui-alert ui-alert-danger"},children:[t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['<span class="ui-alert-message">',"</span>"])),s.message)]});this.errorsContainer.append(n)}}]);return e}();c.Scheme=l})(this.window=this.window||{},BX,BX.Bizproc.Automation,BX.Main);
//# sourceMappingURL=script.map.js