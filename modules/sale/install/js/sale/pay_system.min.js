(function(e){if(!BX.Sale)BX.Sale={};if(BX.Sale.PaySystem)return;BX.Sale.PaySystem={ajaxUrl:"/bitrix/admin/sale_pay_system_ajax.php",setLHEClass:function(e){BX.ready(function(){var t=BX(e);if(t)BX.addClass(t,"adm-sale-lhe-frame-dlvrs-dscr")})},getRestrictionParamsHtml:function(t){if(!t.class)return;t.params=t.params||{};t.restrictionId=t.restrictionId||0;t.sort=t.sort||100;ShowWaitWindow();var i={action:"get_restriction_params_html",className:t.class,params:t.params,paySystemId:t.paySystemId,sort:t.sort,lang:t.lang,sessid:BX.bitrix_sessid()};BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:i,onsuccess:function(i){CloseWaitWindow();if(i&&i.RESTRICTION_HTML&&!i.ERROR){var a=BX.processHTML(i.RESTRICTION_HTML);BX.Sale.PaySystem.showRestrictionParamsDialog(a["HTML"],t);e["paySystemGetRestrictionHtmlScriptsLoadingStarted"]=false;var r=function(t){if(!t)BX.removeCustomEvent("paySystemGetRestrictionHtmlScriptsReady",r);for(var i in a["SCRIPT"]){BX.evalGlobal(a["SCRIPT"][i]["JS"]);delete a["SCRIPT"][i];if(t&&e["paySystemGetRestrictionHtmlScriptsLoadingStarted"])return}};BX.addCustomEvent("paySystemGetRestrictionHtmlScriptsReady",r);r(true);BX.loadCSS(a["STYLE"])}else if(i&&i.ERROR){BX.debug("Error receiving restriction params html: "+i.ERROR)}else{BX.debug("Error receiving restriction params html!")}},onfailure:function(){CloseWaitWindow();BX.debug("Error adding restriction!")}})},showRestrictionParamsDialog:function(e,t){var i=t.class=="\\Bitrix\\Sale\\PaySystem\\Restrictions\\ByLocation"?1030:420,a=new BX.CDialog({content:'<form id="sale-paysystem-restriction-edit-form">'+e+"</form>",title:BX.message("SALE_RDL_RESTRICTION")+" "+t.title,width:i,height:500,resizable:true});a.ClearButtons();a.SetButtons([{title:BX.message("SALE_RDL_SAVE"),action:function(){var e=BX("sale-paysystem-restriction-edit-form"),i=BX.ajax.prepareForm(e),a=!!i&&i.data?i.data:{};BX.Sale.PaySystem.saveRestriction(t,a);this.parentWindow.Close()}},BX.CDialog.prototype.btnCancel]);BX.addCustomEvent(a,"onWindowClose",function(e){e.DIV.parentNode.removeChild(e.DIV)});a.Show();a.adjustSizeEx()},saveRestriction:function(e,t){ShowWaitWindow();var i=t.RESTRICTION||{},a={action:"save_restriction",params:i,sort:t.SORT,className:e.class,paySystemId:e.paySystemId,restrictionId:e.restrictionId,sessid:BX.bitrix_sessid(),lang:BX.message("LANGUAGE_ID")};BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:a,onsuccess:function(e){CloseWaitWindow();if(e&&!e.ERROR){if(e.HTML)BX.Sale.PaySystem.insertAjaxRestrictionHtml(e.HTML)}else{alert(e.ERROR)}},onfailure:function(){CloseWaitWindow()}})},deleteRestriction:function(e,t){if(!e)return;ShowWaitWindow();var i={action:"delete_restriction",restrictionId:e,paySystemId:t,sessid:BX.bitrix_sessid(),lang:BX.message("LANGUAGE_ID")};BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:i,onsuccess:function(e){CloseWaitWindow();if(e&&!e.ERROR){if(e.HTML)BX.Sale.PaySystem.insertAjaxRestrictionHtml(e.HTML);if(e.ERROR)BX.debug("Error deleting restriction: "+e.ERROR)}else{BX.debug("Error deleting restriction!")}},onfailure:function(){CloseWaitWindow();BX.debug("Error refreshing restriction!")}})},insertAjaxRestrictionHtml:function(e){var t=BX.processHTML(e),i=BX("sale-paysystem-restriction-container");if(!i)return;BX.loadCSS(t["STYLE"]);i.innerHTML=t["HTML"];for(var a in t["SCRIPT"])BX.evalGlobal(t["SCRIPT"][a]["JS"])},getHandlerOptions:function(e){var t=e.value;if(t=="")return;ShowWaitWindow();var i={action:"getHandlerDescription",handler:t,paySystemId:BX("ID").value,sessid:BX.bitrix_sessid(),lang:BX.message("LANGUAGE_ID")};BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:i,onsuccess:function(e){CloseWaitWindow();if(e&&!e.ERROR){if(e.BUS_VAL){var t=BX.processHTML(e.BUS_VAL);var i=BX("paysystem-business-value-settings");if(!i)return;BX.loadCSS(t["STYLE"]);i.innerHTML=t["HTML"];for(var a in t["SCRIPT"])BX.evalGlobal(t["SCRIPT"][a]["JS"])}var r=BX("pay_system_tariff");if(e.TARIF){t=BX.processHTML(e.TARIF);if(!r)return;BX.loadCSS(t["STYLE"]);r.innerHTML=t["HTML"];for(a in t["SCRIPT"])BX.evalGlobal(t["SCRIPT"][a]["JS"]);BX.Sale.PaySystem.initTariffLoad()}else{r.innerHTML=""}var s=BX("pay_system_ps_mode");if(e.PAYMENT_MODE){var n=BX.create("tr",{props:{width:"40%"}});n.setAttribute("valign","top");var o=BX.create("td",{props:{width:"40%"}});BX.addClass(o,"adm-detail-content-cell-l");o.innerHTML=BX.message("SALE_PS_MODE")+":";var l=BX.create("td",{props:{width:"60%"}});BX.addClass(l,"adm-detail-content-cell-r");l.innerHTML=e.PAYMENT_MODE;n.appendChild(o);n.appendChild(l);s.innerHTML="";s.appendChild(n)}else{s.innerHTML=""}var d=BX("pay_system_ps_description");if(d)d.innerHTML="";if(e.DESCRIPTION){var c=BX.create("tr",{children:[BX.create("td",{props:{width:"40%",className:"adm-detail-content-cell-l"}}),BX.create("td",{props:{width:"60%",className:"adm-detail-content-cell-r"},html:e.DESCRIPTION})]});d.appendChild(c)}if(e.NAME!==undefined)BX("NAME").value=e.NAME;if(e.PSA_NAME!==undefined)BX("PSA_NAME").value=e.PSA_NAME;if(e.SORT)BX("SORT").value=e.SORT;var m=BX("ID").value;var S=BX("LOGOTIP");var f=BX.findParent(S,{tag:"div"});var B=BX.findChild(f.parentNode,{tag:"img"});if(e.LOGOTIP){if(e.LOGOTIP.NAME)S.previousElementSibling.innerHTML=e.LOGOTIP.NAME;if(B){if(e.LOGOTIP.PATH)B.src=e.LOGOTIP.PATH}else{B=BX.create("img",{attrs:{src:e.LOGOTIP.PATH,width:95,height:55}});BX.insertAfter(B,f);BX.insertAfter(BX.create("br"),f)}}else if(m<=0){if(B)BX.remove(B);S.previousElementSibling.innerHTML=BX.message("JSADM_FILE")}}else{BX.debug(e.ERROR)}},onfailure:function(){CloseWaitWindow();var e=BX("pay_system_ps_description");if(e)e.innerHTML="";var t=BX("pay_system_ps_mode");if(t)t.innerHTML="";BX.debug("Error")}})},toggleNextSiblings:function(e,t,i){if(!e.nextElementSibling)return false;var a=e.nextElementSibling;for(var r=0;r<t;r++){if(a.style.display=="none"&&!i)a.style.display="";else a.style.display="none";if(a.nextElementSibling)a=a.nextElementSibling;else break}return true},deleteObjectAndNextSiblings:function(e,t,i){if(!e)return false;var a;var r=e;if(i&&i>0){for(a=0;a<i;a++){if(r.parentNode)r=r.parentNode;else return false}}var s=false;var n=r;for(a=0;a<=t;a++){if(n.nextElementSibling)s=n.nextElementSibling;n.parentNode.removeChild(n);if(s)n=s;else break}return true},initTariffLoad:function(){var t;var i=BX("tabControl_layout");if(i){var a=e.parent.BX.findChildren(i,{tag:"tr","class":"ps-admin-hide"},true);for(t in a)BX.Sale.PaySystem.toggleNextSiblings(a[t],4,true)}e.parent.BX.onCustomEvent("onAdminTabsChange")}}})(window);
//# sourceMappingURL=pay_system.map.js