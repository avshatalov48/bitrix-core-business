this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};this.BX.UI.AccessRights=this.BX.UI.AccessRights||{};(function(t,e,s,i,r,o,n,a,l,c,u,d,h,p,v,g,b){"use strict";const m={name:"Selector",emits:["close"],props:{userGroup:{type:Object,required:true},bindNode:{type:HTMLElement,required:true}},computed:{selectedItems(){const t=[];for(const e of this.userGroup.members.keys()){t.push(this.getItemIdByAccessCode(e))}return t}},mounted(){new u.Dialog({enableSearch:true,context:"ui.accessrights.v2~member-selector",alwaysShowLabels:true,entities:[{id:"user",options:{intranetUsersOnly:true,emailUsers:false,inviteEmployeeLink:false,inviteGuestLink:false}},{id:"department",options:{selectMode:"usersAndDepartments",allowSelectRootDepartment:true,allowFlatDepartments:true}},{id:"project",dynamicLoad:true,options:{addProjectMetaUsers:true},itemOptions:{default:{link:"",linkTitle:""}}},{id:"site-groups",dynamicLoad:true,dynamicSearch:true}],targetNode:this.bindNode,preselectedItems:this.selectedItems,cacheable:false,events:{"Item:onSelect":this.onMemberAdd,"Item:onDeselect":this.onMemberRemove,onHide:()=>{this.$emit("close")}}}).show()},methods:{getItemIdByAccessCode(t){if(/^I?U(\d+)$/.test(t)){const e=t.match(/^I?U(\d+)$/)||null;const s=e?e[1]:null;return["user",s]}if(/^DR(\d+)$/.test(t)){const e=t.match(/^DR(\d+)$/)||null;const s=e?e[1]:null;return["department",s]}if(/^D(\d+)$/.test(t)){const e=t.match(/^D(\d+)$/)||null;const s=e?e[1]:null;return["department",`${s}:F`]}if(/^G(\d+)$/.test(t)){const e=t.match(/^G(\d+)$/)||null;const s=e?e[1]:null;return["site-groups",s]}if(/^SG(\d+)_([AEK])$/.test(t)){const e=t.match(/^SG(\d+)_([AEK])$/)||null;const s=e?e[1]:null;const i=e?e[2]:null;return["project",`${s}:${i}`]}return["unknown",t]},onMemberAdd(t){const e=this.getMemberFromEvent(t);this.$store.dispatch("userGroups/addMember",{userGroupId:this.userGroup.id,accessCode:e.id,member:e})},onMemberRemove(t){const e=this.getMemberFromEvent(t);this.$store.dispatch("userGroups/removeMember",{userGroupId:this.userGroup.id,accessCode:e.id})},getMemberFromEvent(t){const{item:e}=t.getData();return{id:this.getAccessCodeByItem(e),type:this.getMemberTypeByItem(e),name:e.title.text,avatar:b.Type.isStringFilled(e.avatar)?e.avatar:null}},getAccessCodeByItem(t){const e=t.entityId;if(e==="user"){return`U${t.id}`}if(e==="department"){if(b.Type.isString(t.id)&&t.id.endsWith(":F")){const e=t.id.match(/^(\d+):F$/);const s=e?e[1]:null;return`D${s}`}return`DR${t.id}`}if(e==="site-groups"){return`G${t.id}`}if(e==="project"){const e=t.customData.get("metauser");const s=t.customData.get("projectId");if(e==="owner"){return`SG${s}_A`}if(e==="moderator"){return`SG${s}_E`}if(e==="all"){return`SG${s}_K`}}return""},getMemberTypeByItem(t){switch(t.entityId){case"user":return"users";case"intranet":case"department":return"departments";case"socnetgroup":case"project":return"sonetgroups";case"group":return"groups";case"site-groups":return"usergroups";default:return""}}},template:"<div hidden></div>"};const S={name:"SingleMember",props:{member:{type:Object,required:true}},computed:{avatarBackgroundImage(){return`url(${encodeURI(this.member.avatar)})`},noAvatarClass(){if(this.member.type==="groups"){return"ui-icon-common-user-group"}if(this.member.type==="sonetgroups"||this.member.type==="departments"){return"ui-icon-common-company"}if(this.member.type==="usergroups"){return"ui-icon-common-user-group"}return"ui-icon-common-user"}},template:`\n\t\t<div class='ui-access-rights-v2-members-item'>\n\t\t\t<a v-if="member.avatar" class='ui-access-rights-v2-members-item-avatar' :title="member.name" :style="{\n\t\t\t\tbackgroundImage: avatarBackgroundImage,\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t}"></a>\n\t\t\t<a v-else class='ui-icon ui-access-rights-v2-members-item-icon' :class="noAvatarClass" :title="member.name">\n\t\t\t\t<i></i>\n\t\t\t</a>\n\t\t</div>\n\t`};const f=5;const y={name:"Members",components:{SingleMember:S,Selector:m},props:{userGroup:{type:Object,required:true}},data(){return{isSelectorShown:false,isSelectedMembersPopupShown:false}},popup:null,computed:{shownMembers(){if(this.userGroup.members.size<=f){return this.userGroup.members}const t=[...this.userGroup.members].slice(0,f);return new Map(t)},notShownMembersCount(){if(this.userGroup.members.size>f){return this.userGroup.members.size-f}return 0},bindNode(){return this.$refs.container}},template:`\n\t\t<div ref="container" class="ui-access-rights-v2-members-container"  @click="isSelectorShown = true">\n\t\t\t<div v-if="userGroup.members.size > 0" class='ui-access-rights-v2-members'>\n\t\t\t\t<SingleMember v-for="[accessCode, member] in shownMembers" :key="accessCode" :member="member"/>\n\t\t\t\t<span v-if="notShownMembersCount > 0" class="ui-access-rights-v2-members-more">\n\t\t\t\t\t+ {{ notShownMembersCount }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass='ui-access-rights-v2-members-item ui-access-rights-v2-members-item-add'\n\t\t\t\t:class="{\n\t\t\t\t\t'--show-always': userGroup.members.size <= 0,\n\t\t\t\t\t'--has-siblings': userGroup.members.size > 0,\n\t\t\t\t}"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --plus-30"></div>\n\t\t\t</div>\n\t\t\t<Selector\n\t\t\t\tv-if="isSelectorShown"\n\t\t\t\t:user-group="userGroup"\n\t\t\t\t:bind-node="bindNode"\n\t\t\t\t@close="isSelectorShown = false"\n\t\t\t/>\n\t\t</div>\n\t`};const I={name:"RoleHeading",components:{RichMenuPopup:r.RichMenuPopup,RichMenuItem:r.RichMenuItem},props:{userGroup:{type:Object,required:true}},data(){return{isEdit:false,isPopupShown:false}},computed:{RichMenuItemIcon:()=>r.RichMenuItemIcon,...g.mapState({isSaving:t=>t.application.isSaving,guid:t=>t.application.guid,maxVisibleUserGroups:t=>t.application.options.maxVisibleUserGroups}),...g.mapGetters({isMaxVisibleUserGroupsReached:"userGroups/isMaxVisibleUserGroupsReached",isMaxValueSet:"accessRights/isMaxValueSet",isMinValueSet:"accessRights/isMinValueSet"}),title:{get(){return this.userGroup.title},set(t){this.$store.dispatch("userGroups/setRoleTitle",{userGroupId:this.userGroup.id,title:t})}}},watch:{isEdit(t){if(t===true){this.bindClickedOutsideHandler();void this.$nextTick((()=>{this.$refs.input.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"});this.$refs.input.focus();this.$refs.input.select()}))}else{this.unbindClickedOutsideHandler()}}},mounted(){if(this.userGroup.isNew){this.isEdit=true}},beforeUnmount(){this.unbindClickedOutsideHandler()},methods:{bindClickedOutsideHandler(){b.Event.bind(window,"click",this.turnOffEditWhenClickedOutside,{capture:true})},unbindClickedOutsideHandler(){b.Event.unbind(window,"click",this.turnOffEditWhenClickedOutside,{capture:true})},turnOffEditWhenClickedOutside(t){if(t.target!==this.$refs.input){this.isEdit=false}},showDeleteConfirmation(){const t=new h.Popup({bindElement:this.$refs.container,width:250,overlay:true,contentPadding:10,content:this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_POPUP_REMOVE_ROLE"),className:"ui-access-rights-v2-text-center",animation:"fading-slide",cacheable:false,buttons:[new c.Button({text:this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_POPUP_REMOVE_ROLE_YES"),size:c.ButtonSize.SMALL,color:c.ButtonColor.PRIMARY,events:{click:()=>{t.destroy();this.$store.dispatch("userGroups/removeUserGroup",{userGroupId:this.userGroup.id})}}}),new c.CancelButton({size:c.ButtonSize.SMALL,events:{click:()=>{t.destroy()}}})]});t.show()},showActionsMenu(){if(!this.isSaving){this.isPopupShown=true}},onSetMaxValuesClick(){this.isPopupShown=false;this.$store.dispatch("userGroups/setMaxAccessRightValuesForUserGroup",{userGroupId:this.userGroup.id})},onSetMinValuesClick(){this.isPopupShown=false;this.$store.dispatch("userGroups/setMinAccessRightValuesForUserGroup",{userGroupId:this.userGroup.id})},onEnableEditClick(){this.isPopupShown=false;this.isEdit=true},onCopyRoleClick(){if(this.isMaxVisibleUserGroupsReached){return}this.isPopupShown=false;this.$store.dispatch("userGroups/copyUserGroup",{userGroupId:this.userGroup.id})},onDeleteRoleClick(){this.isPopupShown=false;this.showDeleteConfirmation()}},template:`\n\t\t<div ref="container" class='ui-access-rights-v2-role'>\n\t\t\t<div class="ui-access-rights-v2-role-value-container">\n\t\t\t\t<input\n\t\t\t\t\tv-if="isEdit && !isSaving"\n\t\t\t\t\tref="input"\n\t\t\t\t\ttype='text'\n\t\t\t\t\tclass='ui-access-rights-v2-role-input'\n\t\t\t\t\tv-model="title"\n\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_NAME')"\n\t\t\t\t\t@keydown.enter="isEdit = false"\n\t\t\t\t/>\n\t\t\t\t<div v-else class='ui-access-rights-v2-role-value' :title="title">{{ title }}</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tref="menu"\n\t\t\t\tclass="ui-icon-set --more ui-access-rights-v2-role-menu" \n\t\t\t\t@click="showActionsMenu"\n\t\t\t>\n\t\t\t\t<RichMenuPopup v-if="isPopupShown" @close="isPopupShown = false" :popup-options="{bindElement: $refs.menu}">\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\tv-if="isMaxValueSet"\n\t\t\t\t\t\t:icon="RichMenuItemIcon.check"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MAX_ACCESS_RIGHTS')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MAX_ACCESS_RIGHTS_SUBTITLE')"\n\t\t\t\t\t\t@click="onSetMaxValuesClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\tv-if="isMinValueSet"\n\t\t\t\t\t\t:icon="RichMenuItemIcon['red-lock']"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MIN_ACCESS_RIGHTS')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SET_MIN_ACCESS_RIGHTS_SUBTITLE')"\n\t\t\t\t\t\t@click="onSetMinValuesClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t:icon="RichMenuItemIcon.pencil"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_RENAME')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_RENAME_SUBTITLE')"\n\t\t\t\t\t\t@click="onEnableEditClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t:icon="RichMenuItemIcon.copy"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY_ROLE_SUBTITLE')"\n\t\t\t\t\t\t:disabled="isMaxVisibleUserGroupsReached"\n\t\t\t\t\t\t:hint="\n\t\t\t\t\t\t\tisMaxVisibleUserGroupsReached\n\t\t\t\t\t\t\t\t? $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_COPYING_DISABLED', {\n\t\t\t\t\t\t\t\t\t'#COUNT#': maxVisibleUserGroups,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t"\n\t\t\t\t\t\t@click="onCopyRoleClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t:icon="RichMenuItemIcon['trash-bin']"\n\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_REMOVE')"\n\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_REMOVE_SUBTITLE')"\n\t\t\t\t\t\t@click="onDeleteRoleClick"\n\t\t\t\t\t/>\n\t\t\t\t</RichMenuPopup>\n\t\t\t</div>\n\t\t</div>\n\t`};const L={template:`\n\t\t<div class='ui-access-rights-v2-column-item'>\n\t\t\t<slot/>\n\t\t</div>\n\t`};const C={template:`\n\t\t<div class='ui-access-rights-v2-column'>\n\t\t\t<slot/>\n\t\t</div>\n\t`};const w={name:"RolesControl",components:{CellLayout:L,ColumnLayout:C,RichMenuPopup:r.RichMenuPopup,RichMenuItem:r.RichMenuItem},props:{userGroups:{type:Map,required:true}},viewDialog:null,computed:{RichMenuItemIcon:()=>r.RichMenuItemIcon,...g.mapState({allUserGroups:t=>t.userGroups.collection,maxVisibleUserGroups:t=>t.application.options.maxVisibleUserGroups,guid:t=>t.application.guid}),...g.mapGetters({isMaxVisibleUserGroupsSet:"application/isMaxVisibleUserGroupsSet",isMaxVisibleUserGroupsReached:"userGroups/isMaxVisibleUserGroupsReached"}),shownGroupsCounter(){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ROLE_COUNTER",{"#VISIBLE_ROLES#":this.userGroups.size,"#ALL_ROLES#":this.allUserGroups.size,"#GREY_START#":'<span style="opacity: var(--ui-opacity-30)">',"#GREY_FINISH#":"</span>"})},copyDialogItems(){const t=[];for(const e of this.allUserGroups.values()){t.push({id:e.id,entityId:"accessrights-user-group",title:e.title||this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ROLE_NAME"),tabs:["recents"]})}return t},viewDialogItems(){const t=[];for(const e of this.copyDialogItems){t.push({...e,selected:this.userGroups.has(e.id)})}return t}},data(){return{isPopupShown:false}},methods:{onCreateNewRoleClick(){if(this.isMaxVisibleUserGroupsReached){return}this.isPopupShown=false;this.$store.dispatch("userGroups/addUserGroup")},onRoleViewClick(){this.isPopupShown=false;this.showViewDialog(this.$refs.configure)},onCopyRoleClick(){if(this.isMaxVisibleUserGroupsReached){return}this.isPopupShown=false;this.showCopyDialog()},showCopyDialog(){const t=new u.Dialog({context:"ui.accessrights.v2~role-selector",targetNode:this.$refs.configure,multiple:false,dropdownMode:true,enableSearch:true,cacheable:false,showAvatars:false,items:this.copyDialogItems,events:{"Item:onSelect":t=>{const{item:e}=t.getData();this.$store.dispatch("userGroups/copyUserGroup",{userGroupId:e.getId()})}}});t.show()},showViewDialog(t){this.viewDialog=new u.Dialog({context:"ui.accessrights.v2~role-selector",footer:this.isMaxVisibleUserGroupsSet?this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ROLE_SELECTOR_MAX_VISIBLE_WARNING",{"#COUNT#":this.maxVisibleUserGroups}):null,targetNode:t,multiple:true,dropdownMode:true,enableSearch:true,cacheable:false,showAvatars:false,items:this.viewDialogItems,events:{"Item:onBeforeSelect":t=>{if(this.isMaxVisibleUserGroupsSet&&this.viewDialog.getSelectedItems().length>=this.maxVisibleUserGroups){t.preventDefault()}},"Item:onSelect":t=>{const{item:e}=t.getData();this.$store.dispatch("userGroups/showUserGroup",{userGroupId:e.getId()})},"Item:onDeselect":t=>{const{item:e}=t.getData();this.$store.dispatch("userGroups/hideUserGroup",{userGroupId:e.getId()})},onHide:()=>{this.viewDialog=null}}});this.viewDialog.show()},toggleViewDialog(t){if(this.viewDialog){this.viewDialog.hide()}else{this.showViewDialog(t)}}},template:`\n\t\t<ColumnLayout v-memo="[shownGroupsCounter]">\n\t\t\t<CellLayout class="ui-access-rights-v2-header-roles-control">\n\t\t\t\t<div class='ui-access-rights-v2-column-item-text ui-access-rights-v2-header-roles-control-header'>\n\t\t\t\t\t<div>{{ $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLES') }}</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="configure"\n\t\t\t\t\t\tclass="ui-icon-set --more ui-access-rights-v2-role-menu"\n\t\t\t\t\t\t@click="isPopupShown = true"\n\t\t\t\t\t>\n\t\t\t\t\t\t<RichMenuPopup v-if="isPopupShown" @close="isPopupShown = false" :popup-options="{bindElement: $refs.configure}">\n\t\t\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t\t\t:icon="RichMenuItemIcon.role"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_NEW_ROLE')"\n\t\t\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_NEW_ROLE_SUBTITLE')"\n\t\t\t\t\t\t\t\t:disabled="isMaxVisibleUserGroupsReached"\n\t\t\t\t\t\t\t\t:hint="\n\t\t\t\t\t\t\t\t\tisMaxVisibleUserGroupsReached\n\t\t\t\t\t\t\t\t\t\t? $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_ADDING_DISABLED', {\n\t\t\t\t\t\t\t\t\t\t\t'#COUNT#': maxVisibleUserGroups,\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t"\n\t\t\t\t\t\t\t\t@click="onCreateNewRoleClick"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t\t\t:icon="RichMenuItemIcon.copy"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY_ROLE')"\n\t\t\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COPY_ROLE_SUBTITLE')"\n\t\t\t\t\t\t\t\t:disabled="isMaxVisibleUserGroupsReached"\n\t\t\t\t\t\t\t\t:hint="\n\t\t\t\t\t\t\t\t\tisMaxVisibleUserGroupsReached\n\t\t\t\t\t\t\t\t\t\t? $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_COPYING_DISABLED', {\n\t\t\t\t\t\t\t\t\t\t\t'#COUNT#': maxVisibleUserGroups,\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t"\n\t\t\t\t\t\t\t\t@click="onCopyRoleClick"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<RichMenuItem\n\t\t\t\t\t\t\t\t:icon="RichMenuItemIcon['opened-eye']"\n\t\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_VIEW')"\n\t\t\t\t\t\t\t\t:subtitle="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE_VIEW_SUBTITLE')"\n\t\t\t\t\t\t\t\t@click="onRoleViewClick"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</RichMenuPopup>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-access-rights-v2-header-roles-control-actions">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="counter"\n\t\t\t\t\t\tclass="ui-access-rights-v2-header-roles-control-counter"\n\t\t\t\t\t\t@click="toggleViewDialog($refs.counter)"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="ui-icon-set --opened-eye" style="--ui-icon-set__icon-size: 15px;"></div>\n\t\t\t\t\t\t<span v-html="shownGroupsCounter"></span>\n\t\t\t\t\t\t<div class="ui-icon-set --chevron-down ui-access-rights-v2-header-roles-control-chevron"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-access-rights-v2-header-roles-control-expander">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="ui-icon-set --collapse"\n\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_COLLAPSE_ALL_SECTIONS')"\n\t\t\t\t\t\t\t@click="$store.dispatch('accessRights/collapseAllSections')"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="ui-icon-set --expand-1"\n\t\t\t\t\t\t\t:title="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_EXPAND_ALL_SECTIONS')"\n\t\t\t\t\t\t\t@click="$store.dispatch('accessRights/expandAllSections')"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</CellLayout>\n\t\t</ColumnLayout>\n\t`};const G=new Map;const H=new Map;const P={name:"SyncHorizontalScroll",data(){return{componentGuid:b.Text.getRandom(16)}},computed:{...g.mapState({guid:t=>t.application.guid})},throttledEmitScrollEvent:null,created(){this.throttledEmitScrollEvent=E(this.emitScrollEvent)},mounted(){if(!G.has(this.guid)){const t=this.$store.state.accessRights.collection.size+1;this.$Bitrix.eventEmitter.incrementMaxListeners("ui:accessrights:v2:syncScroll",t);G.set(this.guid,true)}this.$Bitrix.eventEmitter.subscribe("ui:accessrights:v2:syncScroll",this.handleScrollEvent);void this.$nextTick((()=>{if(H.has(this.guid)){this.syncScroll(H.get(this.guid))}}))},beforeUnmount(){this.$Bitrix.eventEmitter.unsubscribe("ui:accessrights:v2:syncScroll",this.handleScrollEvent)},methods:{emitScrollEvent(t){const{scrollLeft:e,scrollWidth:s,clientWidth:i,offsetWidth:r}=t.target;const o=s-i;const n=r-i;if(o>n){H.set(this.guid,e);this.$Bitrix.eventEmitter.emit("ui:accessrights:v2:syncScroll",{scrollLeft:e,componentGuid:this.componentGuid})}},handleScrollEvent(t){const{scrollLeft:e,componentGuid:s}=t.getData();if(this.componentGuid===s){return}this.syncScroll(e)},syncScroll(t){if(this.$el.scrollLeft!==t){this.$el.scrollLeft=t}}},template:`\n\t\t<div @scroll="throttledEmitScrollEvent">\n\t\t\t<slot/>\n\t\t</div>\n\t`};function E(t){let e=false;let s=false;return function i(...r){s=true;if(!e){const i=function i(){if(s){t(...r);s=false;requestAnimationFrame(i);e=true}else{e=false}};i()}}}const R={name:"Header",components:{RoleHeading:I,SyncHorizontalScroll:P,Members:y,RolesControl:w,ColumnLayout:C,CellLayout:L},props:{userGroups:{type:Map,required:true}},template:`\n\t\t<div class="ui-access-rights-v2-section ui-access-rights-v2--head-section">\n\t\t\t<div class='ui-access-rights-v2-section-container'>\n\t\t\t\t<div class='ui-access-rights-v2-section-head'>\n\t\t\t\t\t<RolesControl :user-groups="userGroups"/>\n\t\t\t\t</div>\n\t\t\t\t<div class='ui-access-rights-v2-section-content'>\n\t\t\t\t\t<SyncHorizontalScroll class='ui-access-rights-v2-section-wrapper'>\n\t\t\t\t\t\t<ColumnLayout\n\t\t\t\t\t\t\tv-for="[groupId, group] in userGroups" \n\t\t\t\t\t\t\t:key="groupId"\n\t\t\t\t\t\t\t:data-accessrights-user-group-id="groupId"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CellLayout class="ui-access-rights-v2-header-role-cell">\n\t\t\t\t\t\t\t\t<RoleHeading :user-group="group"/>\n\t\t\t\t\t\t\t\t<Members :user-group="group"/>\n\t\t\t\t\t\t\t</CellLayout>\n\t\t\t\t\t\t</ColumnLayout>\n\t\t\t\t\t</SyncHorizontalScroll>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const M={name:"SearchBox",debouncedSetSearchQuery:null,created(){const t=t=>{this.$store.dispatch("accessRights/search",{query:t})};this.debouncedSetSearchQuery=b.Runtime.debounce(t,200)},computed:{searchQuery:{get(){return this.$store.state.accessRights.searchQuery},set(t){this.debouncedSetSearchQuery(t)}}},template:`\n\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-w100 ui-ctl-round">\n\t\t\t<input\n\t\t\t\ttype="text"\n\t\t\t\tclass="ui-ctl-element ui-ctl-textbox"\n\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_SEARCH_PLACEHOLDER')"\n\t\t\t\tv-model="searchQuery"\n\t\t\t>\n\t\t\t<a class="ui-ctl-after ui-ctl-icon-search"></a>\n\t\t</div>\n\t`};function B(t){if(!t.isShown){return false}return!t.group||t.isGroupExpanded}function _(t){const e=[...t.values()].pop();if(t.size===1){return V(e.title)}return b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_HAS_SELECTED_ITEMS",{"#FIRST_ITEM_NAME#":V(e.title),"#COUNT_REST_ITEMS#":t.size-1})}function V(t){const e=15;if(t.length>e){return`${t.slice(0,e)}...`}return t}function T(t,e,s){if(t.size<2){return""}let i="";for(const e of A(t,s)){i+=`<li>${b.Text.encode(e.title)}</li>`}return`\n\t\t<p>${b.Text.encode(e)}</p>\n\t\t<ul>${i}</ul>\n\t`}function A(t,e){const s=new Map;let i=0;for(const[t]of e){s.set(t,i);i++}return[...t.values()].sort(((t,e)=>{const i=s.get(t.id);const r=s.get(e.id);if(b.Type.isNil(i)){return 1}if(b.Type.isNil(r)){return-1}return i-r}))}const F="|";function x(t,e=F){const s=t.split(e);return new Set(s)}function U(t,e=F){const s=[...t].sort();return s.join(e)}function O(t,e=F){const s=x(t,e);return U(s,e)}var $=babelHelpers.classPrivateFieldLooseKey("initialRights");var D=babelHelpers.classPrivateFieldLooseKey("searchAction");class k extends g.BuilderModel{constructor(...t){super(...t);Object.defineProperty(this,D,{value:j});Object.defineProperty(this,$,{writable:true,value:new Map})}getName(){return"accessRights"}setInitialAccessRights(t){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=t;return this}getState(){return{collection:b.Runtime.clone(babelHelpers.classPrivateFieldLooseBase(this,$)[$]),searchQuery:""}}getElementState(t={}){throw new Error("Cant create AccessRightSection. You are doing something wrong")}getGetters(){return{shown:t=>{const e=new Map;for(const[s,i]of t.collection){if(i.isShown){e.set(s,i)}}return e},isMinValueSet:t=>{for(const e of t.collection.values()){for(const t of e.rights.values()){if(!b.Type.isNil(t.minValue)){return true}}}return false},isMaxValueSet:t=>{for(const e of t.collection.values()){for(const t of e.rights.values()){if(!b.Type.isNil(t.maxValue)){return true}}}return false},getEmptyValue:t=>(e,s)=>{var i,r;const o=(i=t.collection.get(e))==null?void 0:i.rights.get(s);if((o==null?void 0:o.type)==="toggler"){const t=!o.emptyValue||!o.emptyValue[0];if(t){return new Set(["0"])}}return(r=o.emptyValue)!=null?r:new Set},getSelectedVariablesAlias:t=>(e,s,i)=>{var r;const o=(r=t.collection.get(e))==null?void 0:r.rights.get(s);if(!o){return null}const n=U(i,o.selectedVariablesAliasesSeparator);return o.selectedVariablesAliases.get(n)}}}getActions(){return{toggleSection:(t,{sectionCode:e})=>{if(!t.state.collection.has(e)){console.warn("ui.accessrights.v2: Attempt to toggle section that dont exists",{sectionCode:e});return}t.commit("toggleSection",{sectionCode:e})},expandAllSections:t=>{for(const e of t.state.collection.keys()){t.commit("expandSection",{sectionCode:e})}},collapseAllSections:t=>{for(const e of t.state.collection.keys()){t.commit("collapseSection",{sectionCode:e})}},toggleGroup:(t,{sectionCode:e,groupId:s})=>{var i;const r=(i=t.state.collection.get(e))==null?void 0:i.rights.get(s);if(!r){console.warn("ui.accessrights.v2: Attempt to toggle group that dont exists",{groupId:s});return}if(!r.groupHead){console.warn("ui.accessrights.v2: Attempt to toggle group that is not group head",{groupId:s});return}t.commit("toggleGroup",{sectionCode:e,groupId:s})},search:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,D)[D](t,e)}}}getMutations(){return{toggleSection:(t,{sectionCode:e})=>{const s=t.collection.get(e);s.isExpanded=!s.isExpanded},expandSection:(t,{sectionCode:e})=>{const s=t.collection.get(e);s.isExpanded=true},collapseSection:(t,{sectionCode:e})=>{const s=t.collection.get(e);s.isExpanded=false},toggleGroup:(t,{sectionCode:e,groupId:s})=>{const i=t.collection.get(e);for(const t of i.rights.values()){if(t.id===s&&t.groupHead||t.group===s){t.isGroupExpanded=!t.isGroupExpanded}}},expandGroup:(t,{sectionCode:e,groupId:s})=>{const i=t.collection.get(e);i.isExpanded=true;for(const t of i.rights.values()){if(t.id===s&&t.groupHead||t.group===s){t.isGroupExpanded=true}}},showItem:(t,{sectionCode:e,itemId:s})=>{const i=t.collection.get(e);i.isShown=true;const r=i.rights.get(s);r.isShown=true;if(r.group){i.rights.get(r.group).isShown=true}},showGroup:(t,{sectionCode:e,groupId:s})=>{const i=t.collection.get(e);i.isShown=true;for(const t of i.rights.values()){if(t.id===s&&t.groupHead||t.group===s){t.isShown=true}}},showSection:(t,{sectionCode:e})=>{const s=t.collection.get(e);s.isShown=true;for(const t of s.rights.values()){t.isShown=true}},showAll:t=>{for(const e of t.collection.values()){e.isShown=true;for(const t of e.rights.values()){t.isShown=true}}},hideAll:t=>{for(const e of t.collection.values()){e.isShown=false;for(const t of e.rights.values()){t.isShown=false}}},setSearchQuery:(t,{query:e})=>{t.searchQuery=String(e)}}}}function j(t,{query:e}){if(!b.Type.isString(e)){console.warn("ui.accessrights.v2: attempt to search with non-string search query");return}t.commit("setSearchQuery",{query:e});if(e===""){t.commit("showAll");return}t.commit("hideAll");const s=e.toLowerCase();for(const e of t.state.collection.values()){var i;if(e.sectionTitle.toLowerCase().includes(s)||(i=e.sectionSubTitle)!=null&&i.toLowerCase().includes(s)){t.commit("showSection",{sectionCode:e.sectionCode});continue}for(const i of e.rights.values()){if(!i.title.toLowerCase().includes(s)){continue}if(i.groupHead){t.commit("showGroup",{sectionCode:e.sectionCode,groupId:i.id})}else{t.commit("showItem",{sectionCode:e.sectionCode,itemId:i.id});if(i.group){t.commit("expandGroup",{sectionCode:e.sectionCode,groupId:i.group})}}}}}const N={name:"SelectedHint",props:{html:{type:String,required:true}},data(){return{isRendered:true}},watch:{html(){this.isRendered=false;void this.$nextTick((()=>{this.isRendered=true}))}},directives:{hint:l.hint},template:`\n\t\t<div v-if="isRendered" v-hint="{\n\t\t\thtml,\n\t\t\tpopupOptions: {\n\t\t\t\toffsetTop: 3,\n\t\t\t},\n\t\t}" data-hint-init="vue">\n\t\t\t<slot/>\n\t\t</div>\n\t`};const z={name:"Icon",inject:["section"],computed:{iconBgColor(){if(this.section.sectionIcon.bgColor.startsWith("--")){return`var(${this.section.sectionIcon.bgColor})`}return this.section.sectionIcon.bgColor}},template:`\n\t\t<div v-if="section.sectionIcon" class="ui-access-rights-v2-section-header-icon" :style="{\n\t\t\tbackgroundColor: iconBgColor,\n\t\t}">\n\t\t\t<div class="ui-icon-set" :class="'--' + section.sectionIcon.type"></div>\n\t\t</div>\n\t`};const K={name:"PopupHeader",components:{Switcher:d.Switcher,SectionIcon:z},emits:["setMax","setMin"],props:{userGroupTitle:{type:String,required:true},values:{type:Set,required:true}},inject:["section","right"],computed:{rightOrGroupTitle(){if(!this.right.group){return this.right.title}const t=this.section.rights.get(this.right.group);return t==null?void 0:t.title},isMinMaxValuesSet(){return!b.Type.isNil(this.right.minValue)&&!b.Type.isNil(this.right.maxValue)},isSelectedAnythingBesidesMin(){if(this.values.size<=0){return false}for(const t of this.values){if(!this.right.minValue.has(t)){return true}}return false},switcherOptions(){return{size:"small",color:"green"}}},template:`\n\t\t<div class="ui-access-rights-v2-cell-popup-header">\n\t\t\t<div class="ui-access-rights-v2-cell-popup-header-locator">\n\t\t\t\t<SectionIcon/>\n\t\t\t\t<span\n\t\t\t\t\tclass="ui-access-rights-v2-text-ellipsis"\n\t\t\t\t\t:title="section.sectionTitle"\n\t\t\t\t>{{ section.sectionTitle }}</span>\n\t\t\t\t<span\n\t\t\t\t\tv-if="section.sectionSubTitle" \n\t\t\t\t\tclass="ui-access-rights-v2-text-ellipsis"\n\t\t\t\t\t:title="section.sectionSubTitle"\n\t\t\t\t\tstyle="margin-left: 5px; color: var(--ui-color-palette-gray-70);"\n\t\t\t\t>{{ section.sectionSubTitle }}</span>\n\t\t\t\t<div class="ui-icon-set --chevron-right ui-access-rights-v2-cell-popup-header-chevron"></div>\n\t\t\t\t<template v-if="rightOrGroupTitle !== right.title">\n\t\t\t\t\t<span class="ui-access-rights-v2-text-ellipsis" :title="right.title">{{ right.title }}</span>\n\t\t\t\t\t<div class="ui-icon-set --chevron-right ui-access-rights-v2-cell-popup-header-chevron"></div>\n\t\t\t\t</template>\n\t\t\t\t<span class="ui-access-rights-v2-text-ellipsis" :title="rightOrGroupTitle">{{ rightOrGroupTitle }}</span>\n\t\t\t</div>\n\t\t\t<div class="ui-access-rights-v2-cell-popup-header-role-line">\n\t\t\t\t<div class="ui-access-rights-v2-cell-popup-header-role-container">\n\t\t\t\t\t<span class="ui-icon ui-icon-square ui-icon-xs ui-access-rights-v2-cell-popup-header-role-icon">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class="ui-access-rights-v2-cell-popup-header-role-caption">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ROLE') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="ui-access-rights-v2-cell-popup-header-role-title ui-access-rights-v2-text-ellipsis"\n\t\t\t\t\t\t\t:title="userGroupTitle"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ userGroupTitle }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isMinMaxValuesSet" class="ui-access-rights-v2-cell-popup-header-toggle-container">\n\t\t\t\t\t<span class="ui-access-rights-v2-cell-popup-header-toggle-caption">{{\n\t\t\t\t\t\t$Bitrix.Loc.getMessage('JS_UI_ACCESSRIGHTS_V2_ACCESS')\n\t\t\t\t\t}}</span>\n\t\t\t\t\t<Switcher\n\t\t\t\t\t\t:is-checked="isSelectedAnythingBesidesMin"\n\t\t\t\t\t\t@check="$emit('setMax')"\n\t\t\t\t\t\t@uncheck="$emit('setMin')"\n\t\t\t\t\t\t:options="switcherOptions"\n\t\t\t\t\t\tdata-accessrights-min-max\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const J={name:"PopupContent",emits:["close"],components:{Switcher:d.Switcher,PopupHeader:K},props:{value:{type:Object,required:true}},data(){return{notSavedValues:b.Runtime.clone(this.value.values)}},inject:["section","userGroup","right"],computed:{isMinMaxValuesSet(){return!b.Type.isNil(this.right.minValue)&&!b.Type.isNil(this.right.maxValue)},variablesShownInList(){if(!this.isMinMaxValuesSet){return this.right.variables}const t=b.Runtime.clone(this.right.variables);for(const e of this.right.minValue){t.delete(e)}for(const[e,s]of t){if(s.secondary){t.delete(e)}}return t},secondaryVariables(){const t=new Map;for(const[e,s]of this.right.variables){if(s.secondary){t.set(e,s)}}return t},emptyValues(){return this.$store.getters["accessRights/getEmptyValue"](this.section.sectionCode,this.value.id)},switcherOptions(){return{size:"small",color:"primary"}},secondarySwitcherOptions(){return{size:"extra-small",color:"green"}}},mounted(){const t=new c.ApplyButton({color:c.ButtonColor.PRIMARY,onclick:()=>{this.apply();this.$emit("close")}});t.renderTo(this.$refs["button-container"]);const e=new c.CancelButton({onclick:()=>{this.$emit("close")}});e.renderTo(this.$refs["button-container"])},methods:{addValue(t){const e=this.right.variables.get(t);if(!e){return}this.notSavedValues.add(t);if(!b.Type.isNil(e.requires)){for(const t of e.requires){this.notSavedValues.add(t)}}if(!b.Type.isNil(e.conflictsWith)){for(const t of e.conflictsWith){this.notSavedValues.delete(t)}}for(const e of this.right.variables.values()){if(e.id===t){continue}if(this.notSavedValues.has(e.id)&&!b.Type.isNil(e.conflictsWith)){for(const t of e.conflictsWith){if(this.notSavedValues.has(t)){this.notSavedValues.delete(e.id)}}}}},removeValue(t){this.notSavedValues.delete(t);for(const e of this.notSavedValues){if(e===t){continue}const s=this.right.variables.get(e);if(!s){continue}if(!b.Type.isNil(s.requires)&&s.requires.has(t)){this.notSavedValues.delete(e)}}},setMaxValue(){for(const t of this.right.maxValue){this.addValue(t)}},setMinValue(){for(const t of this.right.minValue){this.addValue(t)}},apply(){let t=this.notSavedValues;if(t.size<=0){t=this.emptyValues}this.$store.dispatch("userGroups/setAccessRightValues",{sectionCode:this.section.sectionCode,userGroupId:this.userGroup.id,valueId:this.value.id,values:t})}},template:`\n\t\t<div>\n\t\t\t<PopupHeader\n\t\t\t\t:values="notSavedValues"\n\t\t\t\t:user-group-title="userGroup.title" \n\t\t\t\t@set-max="setMaxValue"\n\t\t\t\t@set-min="setMinValue"\n\t\t\t/>\n\t\t\t<div class="ui-access-rights-v2-dv-popup--line-container">\n\t\t\t\t<div \n\t\t\t\t\tv-for="[variableId, variable] in variablesShownInList"\n\t\t\t\t\t:key="variableId"\n\t\t\t\t\tclass="ui-access-rights-v2-dv-popup--line"\n\t\t\t\t>\n\t\t\t\t\t<span class="ui-access-rights-v2-text-ellipsis">{{ variable.title }}</span>\n\t\t\t\t\t<Switcher\n\t\t\t\t\t\t:is-checked="notSavedValues.has(variable.id)"\n\t\t\t\t\t\t@check="addValue(variable.id)"\n\t\t\t\t\t\t@uncheck="removeValue(variable.id)"\n\t\t\t\t\t\t:options="switcherOptions"\n\t\t\t\t\t\t:data-accessrights-variable-id="variable.id"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-for="[variableId, variable] in secondaryVariables"\n\t\t\t\t\t:key="variableId"\n\t\t\t\t\tclass="ui-access-rights-v2-dv-popup--line --secondary"\n\t\t\t\t>\n\t\t\t\t\t<Switcher\n\t\t\t\t\t\t:is-checked="notSavedValues.has(variable.id)"\n\t\t\t\t\t\t@check="addValue(variable.id)"\n\t\t\t\t\t\t@uncheck="removeValue(variable.id)"\n\t\t\t\t\t\t:options="secondarySwitcherOptions"\n\t\t\t\t\t\tstyle="padding-right: 5px;"\n\t\t\t\t\t\t:data-accessrights-variable-id="variable.id"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class="ui-access-rights-v2-text-ellipsis">{{ variable.title }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div ref="button-container" class="ui-access-rights-v2-dv-popup--buttons"></div>\n\t\t</div>\n\t`};const q={name:"DependentVariables",components:{Popup:a.Popup,PopupContent:J,SelectedHint:N},props:{value:{type:Object,required:true}},data(){return{isPopupShown:false}},inject:["section","right"],computed:{selectedVariables(){const t=new Map;for(const[e,s]of this.right.variables){if(this.value.values.has(e)){t.set(e,s)}}return t},currentAlias(){return this.$store.getters["accessRights/getSelectedVariablesAlias"](this.section.sectionCode,this.value.id,this.value.values)},title(){if(b.Type.isString(this.currentAlias)){return this.currentAlias}if(this.selectedVariables.size<=0){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ADD")}return _(this.selectedVariables)},hintHtml(){return T(this.selectedVariables,this.hintTitle,this.right.variables)},hintTitle(){if(b.Type.isString(this.right.hintTitle)){return this.right.hintTitle}return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_SELECTED_ITEMS_TITLE")},popupOptions(){return{autoHide:true,closeEsc:true,cacheable:false,minWidth:466,padding:18}}},template:`\n\t\t<div class='ui-access-rights-v2-column-item-text-link' :class="{\n\t\t\t'ui-access-rights-v2-text-ellipsis': !hintHtml\n\t\t}" @click="isPopupShown = true">\n\t\t\t<SelectedHint v-if="hintHtml" :html="hintHtml">{{title}}</SelectedHint>\n\t\t\t<div v-else :title="title">{{title}}</div>\n\t\t\t<Popup v-if="isPopupShown" @close="isPopupShown = false" :options="popupOptions">\n\t\t\t\t<PopupContent \n\t\t\t\t\t@close="isPopupShown = false"\n\t\t\t\t\t:value="value"\n\t\t\t\t/>\n\t\t\t</Popup>\n\t\t</div>\n\t`};let X=t=>t,W,Y,Q;class Z extends u.DefaultFooter{constructor(t,e){super(t,e);this.selectAllButton=b.Tag.render(W||(W=X`<div class="ui-selector-footer-link ui-selector-search-footer-label--hide">${0}</div>`),b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ALL_SELECT_LABEL"));b.Event.bind(this.selectAllButton,"click",this.selectAll.bind(this));this.deselectAllButton=b.Tag.render(Y||(Y=X`<div class="ui-selector-footer-link ui-selector-search-footer-label--hide">${0}</div>`),b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ALL_DESELECT_LABEL"));b.Event.bind(this.deselectAllButton,"click",this.deselectAll.bind(this));this.getDialog().subscribe("Item:onSelect",this.onItemStatusChange.bind(this));this.getDialog().subscribe("Item:onDeselect",this.onItemStatusChange.bind(this))}getContent(){this.toggleSelectButtons();return b.Tag.render(Q||(Q=X`
			<div class="ui-selector-search-footer-box">
				${0}
				${0}
			</div>
		`),this.selectAllButton,this.deselectAllButton)}toggleSelectButtons(){if(this.getDialog().getSelectedItems().length===this.getDialog().getItems().length){if(b.Dom.hasClass(this.deselectAllButton,"ui-selector-search-footer-label--hide")){b.Dom.addClass(this.selectAllButton,"ui-selector-search-footer-label--hide");b.Dom.removeClass(this.deselectAllButton,"ui-selector-search-footer-label--hide")}}else if(b.Dom.hasClass(this.selectAllButton,"ui-selector-search-footer-label--hide")){b.Dom.addClass(this.deselectAllButton,"ui-selector-search-footer-label--hide");b.Dom.removeClass(this.selectAllButton,"ui-selector-search-footer-label--hide")}}selectAll(){if(this.getDialog().getSelectedItems().length===this.getDialog().getItems().length){return}this.getDialog().getItems().forEach((t=>{t.select()}))}deselectAll(){this.getDialog().getSelectedItems().forEach((t=>{t.deselect()}))}onItemStatusChange(){this.toggleSelectButtons()}}const tt={name:"Multivariables",components:{SelectedHint:N},props:{value:{type:Object,required:true}},inject:["section","userGroup","right"],computed:{isAllSelected(){return this.value.values.has(this.right.allSelectedCode)},selectedVariables(){if(this.isAllSelected){return this.right.variables}const t=new Map;for(const[e,s]of this.right.variables){if(this.value.values.has(e)){t.set(e,s)}}return t},emptyValues(){return this.$store.getters["accessRights/getEmptyValue"](this.section.sectionCode,this.value.id)},currentAlias(){return this.$store.getters["accessRights/getSelectedVariablesAlias"](this.section.sectionCode,this.value.id,this.value.values)},title(){if(b.Type.isString(this.currentAlias)){return this.currentAlias}if(this.isAllSelected){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ALL_ACCEPTED")}if(this.selectedVariables.size<=0){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ADD")}return _(this.selectedVariables)},hintHtml(){return T(this.selectedVariables,this.hintTitle,this.right.variables)},hintTitle(){if(b.Type.isString(this.right.hintTitle)){return this.right.hintTitle}return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_SELECTED_ITEMS_TITLE")},dialogItems(){const t=[];for(const e of this.right.variables.values()){const s=b.Runtime.clone(e);s.entityId=s.entityId||"editor-right-item";s.tabs="recents";if(s.selectionStrategy){s.customData={...s.customData,selectionStrategy:s.selectionStrategy}}t.push(s)}return t},selectedDialogItems(){return this.dialogItems.filter((t=>this.selectedVariables.has(t.id)))}},methods:{showSelector(){const t=new u.Dialog({targetNode:this.$el,height:300,context:"editor-right-items",enableSearch:this.right.enableSearch,multiple:true,dropdownMode:true,compactView:this.right.compactView,showAvatars:this.right.showAvatars,selectedItems:this.selectedDialogItems,searchOptions:{allowCreateItem:false},cacheable:false,events:{"Item:onSelect":this.onItemSelect,"Item:onDeselect":this.onItemDeselect,onHide:this.setEmptyValueIfNoneSelected},entities:[{id:"editor-right-item"}],items:this.dialogItems,footer:this.right.disableSelectAll?null:Z});t.show()},onItemSelect(t){const e=t.getData().item;this.processSelectionLogic(e);const s=String(e.getId());setTimeout((()=>{this.addValue(s)}))},processSelectionLogic(t){const e=t.getDialog().getSelectedItems();if(t.customData.get("selectionStrategy")==="mutually-exclusive"){for(const s of e){if(t.getId()!==s.getId()){s.deselect()}}}for(const s of e){if(s.customData.get("selectionStrategy")==="mutually-exclusive"&&t.getId()!==s.getId()){s.deselect()}}},onItemDeselect(t){const e=t.getData().item;const s=String(e.getId());setTimeout((()=>{this.removeValue(s)}))},addValue(t){const e=b.Runtime.clone(this.value.values);e.add(t);if(e.length>=this.right.variables.size){this.setValues(new Set([this.right.allSelectedCode]))}else{this.setValues(e)}},removeValue(t){if(this.value.values.has(this.right.allSelectedCode)){const e=[...this.right.variables.values()].map((t=>t.id));const s=new Set(e);s.delete(t);this.setValues(s)}else{const e=[...this.value.values].filter((e=>e!==t));this.setValues(new Set(e))}},setEmptyValueIfNoneSelected(){if(this.value.values.size<=0){for(const t of this.emptyValues){this.addValue(t)}}},setValues(t){this.$store.dispatch("userGroups/setAccessRightValues",{sectionCode:this.section.sectionCode,userGroupId:this.userGroup.id,valueId:this.value.id,values:t})}},template:`\n\t\t<SelectedHint \n\t\t\tv-if="hintHtml"\n\t\t\t:html="hintHtml" \n\t\t\tclass='ui-access-rights-v2-column-item-text-link'\n\t\t\t@click="showSelector"\n\t\t>\n\t\t\t{{ title }}\n\t\t</SelectedHint>\n\t\t<div \n\t\t\tv-else\n\t\t\tclass='ui-access-rights-v2-column-item-text-link ui-access-rights-v2-text-ellipsis'\n\t\t\t@click="showSelector"\n\t\t\t:title="title"\n\t\t>\n\t\t\t{{ title }}\n\t\t</div>\n\t`};const et={name:"Toggler",components:{Switcher:d.Switcher},props:{value:{type:Object,required:true}},inject:["section","userGroup"],computed:{isChecked(){return this.value.values.has("1")}},methods:{setValue(t){this.$store.dispatch("userGroups/setAccessRightValues",{userGroupId:this.userGroup.id,sectionCode:this.section.sectionCode,valueId:this.value.id,values:new Set([t])})}},template:`\n\t\t<Switcher\n\t\t\t:is-checked="isChecked"\n\t\t\t@check="setValue('1')"\n\t\t\t@uncheck="setValue('0')"\n\t\t\t:options="{\n\t\t\t\tsize: 'extra-small',\n\t\t\t\tcolor: 'green',\n\t\t\t}"\n\t\t/>\n\t`};const st="ui-access-rights-v2-column-item-popup-variables";const it={name:"Variables",props:{value:{type:Object,required:true}},inject:["section","userGroup","right"],computed:{emptyVariableId(){const t=this.$store.getters["accessRights/getEmptyValue"](this.section.sectionCode,this.value.id);return t[0]},currentVariableId(){if(this.value.values.size<=0){return this.emptyVariableId}const[t]=this.value.values;return t},currentAlias(){return this.$store.getters["accessRights/getSelectedVariablesAlias"](this.section.sectionCode,this.value.id,this.value.values)},currentVariableTitle(){if(b.Type.isString(this.currentAlias)){return this.currentAlias}const t=this.right.variables.get(this.currentVariableId);if(!t){return this.$Bitrix.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ADD")}return t.title}},methods:{showSelector(t){const e=[];for(const t of this.right.variables.values()){e.push({id:t.id,text:t.title,onclick:(e,s)=>{var i;(i=s.getMenuWindow())==null?void 0:i.close();this.setValue(t.id)}})}h.MenuManager.show({id:st,bindElement:t.target,items:e,autoHide:true,cacheable:false})},setValue(t){this.$store.dispatch("userGroups/setAccessRightValues",{sectionCode:this.section.sectionCode,userGroupId:this.userGroup.id,valueId:this.value.id,values:new Set([t])})}},template:`\n\t\t<div\n\t\t\tclass='ui-access-rights-v2-column-item-text-link ui-access-rights-v2-text-ellipsis'\n\t\t\t:title="currentVariableTitle"\n\t\t\t@click="showSelector"\n\t\t>\n\t\t\t{{ currentVariableTitle }}\n\t\t</div>\n\t`};const rt=Object.freeze({Toggler:et,Variables:it,Multivariables:tt,DependentVariables:q});function ot(t){if(t.type==="toggler"){return"Toggler"}if(t.type==="variables"){return"Variables"}if(t.type==="multivariables"){return"Multivariables"}if(t.type==="dependent_variables"){return"DependentVariables"}console.warn("ui.accessrights.v2: Unknown access right type",t);return""}const nt={name:"ValueCell",components:{CellLayout:L,...rt},props:{right:{type:Object,required:true}},inject:["section","userGroup"],provide(){return{right:this.right}},computed:{value(){const t=this.userGroup.accessRights.get(this.right.id);return t||this.$store.getters["userGroups/getEmptyAccessRightValue"](this.userGroup.id,this.section.sectionCode,this.right.id)},cellComponent(){return ot(this.right)}},template:`\n\t\t<CellLayout\n\t\t\t:class="{\n\t\t\t\t'ui-access-rights-v2-group-children': right.group,\n\t\t\t\t'--modified': value.isModified\n\t\t\t}"\n\t\t\tv-memo="[userGroup.id, value.values, value.isModified]"\n\t\t>\n\t\t\t<Component\n\t\t\t\t:is="cellComponent"\n\t\t\t\t:value="value"\n\t\t\t\t:data-accessrights-right-id="right.id"\n\t\t\t/>\n\t\t</CellLayout>\n\t`};const at={name:"Column",components:{ColumnLayout:C,ValueCell:nt},props:{userGroup:{type:Object,required:true},rights:{type:Map,required:true}},provide(){return{userGroup:n.computed((()=>this.userGroup))}},computed:{renderedRights(){const t=new Map;for(const[e,s]of this.rights){if(B(s)){t.set(e,s)}}return t}},template:`\n\t\t<ColumnLayout>\n\t\t\t<ValueCell\n\t\t\t\tv-for="[rightId, accessRightItem] in renderedRights"\n\t\t\t\t:key="rightId"\n\t\t\t\t:right="accessRightItem"\n\t\t\t/>\n\t\t</ColumnLayout>\n\t`};var lt=babelHelpers.classPrivateFieldLooseKey("cache");class ct{static get(t){return babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].remember(t,(()=>BX.UI.Hint.createInstance({id:`ui-access-rights-v2-hint-${t}`,popupParameters:{className:"ui-access-rights-v2-popup-pointer-events ui-hint-popup",autoHide:true,darkMode:true,maxWidth:280,offsetTop:0,offsetLeft:8,angle:true,animation:"fading-slide"}})))}}Object.defineProperty(ct,lt,{writable:true,value:new b.Cache.MemoryCache});let ut=t=>t,dt;const ht={name:"Hint",props:{html:{type:String,required:true}},computed:{...g.mapState({guid:t=>t.application.guid})},mounted(){this.renderHint()},watch:{html(){b.Dom.clean(this.$refs.container);this.renderHint()}},methods:{renderHint(){const t=b.Tag.render(dt||(dt=ut`<span data-hint-html="true" data-hint-interactivity="true"></span>`));t.setAttribute("data-hint",this.html);b.Dom.append(t,this.$refs.container);this.getHintManager().init(this.$refs.container)},getHintManager(){return ct.get(this.guid)}},template:'<span ref="container"></span>'};const pt={name:"Header",components:{Hint:ht,Icon:z},inject:["section"],methods:{toggleSection(){this.$store.dispatch("accessRights/toggleSection",{sectionCode:this.section.sectionCode})}},template:`\n\t\t<div\n\t\t\t@click="toggleSection"\n\t\t\tclass='ui-access-rights-v2-section-header'\n\t\t\t:class="{\n\t\t\t\t'--expanded': section.isExpanded,\n\t\t\t}" \n\t\t\tv-memo="[section.isExpanded]"\n\t\t>\n\t\t\t<div class="ui-access-rights-v2-section-header-expander">\n\t\t\t\t<div class='ui-icon-set' :class="{\n\t\t\t\t\t'--chevron-up': section.isExpanded,\n\t\t\t\t\t'--chevron-down': !section.isExpanded,\n\t\t\t\t}"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<Icon/>\n\t\t\t<span \n\t\t\t\tclass="ui-access-rights-v2-text-ellipsis ui-access-rights-v2-section-title"\n\t\t\t\t:title="section.sectionTitle"\n\t\t\t>{{ section.sectionTitle }}</span>\n\t\t\t<span\n\t\t\t\tv-if="section.sectionSubTitle"\n\t\t\t\tclass="ui-access-rights-v2-text-ellipsis ui-access-rights-v2-section-subtitle"\n\t\t\t\t:title="section.sectionSubTitle"\n\t\t\t>\n\t\t\t\t{{ section.sectionSubTitle }}\n\t\t\t</span>\n\t\t\t<Hint v-if="section.sectionHint" :html="section.sectionHint"/>\n\t\t</div>\n\t`};const vt={name:"TitleCell",components:{Hint:ht},props:{right:{type:Object,required:true}},inject:["section"],methods:{toggleGroup(){if(!this.right.groupHead){return}this.$store.dispatch("accessRights/toggleGroup",{sectionCode:this.section.sectionCode,groupId:this.right.id})}},template:`\n\t\t<div\n\t\t\tclass='ui-access-rights-v2-column-item-text ui-access-rights-v2-column-item-title'\n\t\t\t@click="toggleGroup"\n\t\t\t:title="right.title"\n\t\t\t:style="{\n\t\t\t\tcursor: right.groupHead ? 'pointer' : null,\n\t\t\t}"\n\t\t\tv-memo="[right.isGroupExpanded]"\n\t\t\t:data-accessrights-right-id="right.id"\n\t\t>\n\t\t\t<span\n\t\t\t\tv-if="right.groupHead"\n\t\t\t\tclass="ui-icon-set"\n\t\t\t\t:class="{\n\t\t\t\t\t'--minus-in-circle': right.isGroupExpanded,\n\t\t\t\t\t'--plus-in-circle': !right.isGroupExpanded,\n\t\t\t\t}"\n\t\t\t></span>\n\t\t\t<span class="ui-access-rights-v2-text-ellipsis" :style="{\n\t\t\t\t'margin-left': !right.groupHead && !right.group ? '23px' : null,\n\t\t\t}">{{ right.title }}</span>\n\t\t\t<Hint v-once v-if="right.hint" :html="right.hint" />\n\t\t</div>\n\t`};const gt={name:"TitleColumn",components:{TitleCell:vt,ColumnLayout:C,CellLayout:L},props:{rights:{type:Map,required:true}},computed:{renderedRights(){const t=new Map;for(const[e,s]of this.rights){if(B(s)){t.set(e,s)}}return t}},template:`\n\t\t<ColumnLayout>\n\t\t\t<CellLayout\n\t\t\t\tv-for="[rightId, accessRightItem] in renderedRights"\n\t\t\t\t:key="rightId"\n\t\t\t\t:class="{\n\t\t\t\t\t'ui-access-rights-v2-group-children': accessRightItem.group,\n\t\t\t\t}"\n\t\t\t>\n\t\t\t\t<TitleCell :right="accessRightItem" />\n\t\t\t</CellLayout>\n\t\t</ColumnLayout>\n\t`};const bt={name:"Section",components:{Column:at,SyncHorizontalScroll:P,TitleColumn:gt,Header:pt},props:{userGroups:{type:Map,required:true},rights:{type:Map,required:true},code:{type:String,required:true},isExpanded:{type:Boolean,required:true},title:{type:String,required:true},subTitle:{type:String},hint:{type:String},icon:{type:Object}},throttledScrollHandler:null,throttledResizeHandler:null,ears:null,isEarsInited:false,data(){return{isLeftShadowShown:false,isRightShadowShown:false}},provide(){return{section:n.computed((()=>({sectionCode:this.code,sectionTitle:this.title,sectionSubTitle:this.subTitle,sectionIcon:this.icon,sectionHint:this.hint,isExpanded:this.isExpanded,rights:this.rights})))}},created(){this.throttledScrollHandler=b.Runtime.throttle(this.adjustShadowsVisibility,200);this.throttledResizeHandler=b.Runtime.throttle((()=>{this.adjustShadowsVisibility();this.adjustEars()}),200)},mounted(){b.Event.bind(window,"resize",this.throttledResizeHandler);this.adjustShadowsVisibility();this.initEars()},beforeUnmount(){this.destroyEars();b.Event.unbind(window,"resize",this.throttledResizeHandler)},watch:{userGroups(t,e){if(t.size!==e.size){this.adjustShadowsVisibility();this.adjustEars()}},isExpanded(t){if(t===true){void this.$nextTick((()=>{this.initEars()}))}else{this.destroyEars()}}},methods:{calculateShadowsVisibility(){if(!this.$refs["column-container"]){return{isLeftShadowShown:false,isRightShadowShown:false}}const t=this.$refs["column-container"].$el.scrollLeft;const e=t>0;const s=this.$refs["column-container"].$el.offsetWidth;return{isLeftShadowShown:e,isRightShadowShown:this.$refs["column-container"].$el.scrollWidth>Math.round(t+s)}},adjustShadowsVisibility(){requestAnimationFrame((()=>{const{isLeftShadowShown:t,isRightShadowShown:e}=this.calculateShadowsVisibility();this.isLeftShadowShown=t;this.isRightShadowShown=e}))},adjustEars(){if(!this.isEarsInited){return}requestAnimationFrame((()=>{this.ears.toggleEars()}))},initEars(){if(!this.$refs["column-container"]){return}if(this.ears){return}this.ears=new o.Ears({container:this.$refs["column-container"].$el,immediateInit:true,smallSize:true});requestAnimationFrame((()=>{if(!this.ears||!this.$refs["column-container"]){this.ears=null;return}const t=this.$refs["column-container"].$el.scrollLeft;this.ears.init();b.Dom.style(this.ears.getWrapper(),"flex",1);if(t>0){this.$refs["column-container"].$el.scrollLeft=t}this.isEarsInited=true}))},destroyEars(){var t;(t=this.ears)==null?void 0:t.destroy();this.isEarsInited=false;this.ears=null}},template:`\n\t\t<div class="ui-access-rights-v2-section" :data-accessrights-section-code="code">\n\t\t\t<Header/>\n\t\t\t<div v-if="isExpanded" class='ui-access-rights-v2-section-container'>\n\t\t\t\t<div class='ui-access-rights-v2-section-head'>\n\t\t\t\t\t<TitleColumn :rights="rights" />\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass='ui-access-rights-v2-section-content'\n\t\t\t\t\t:class="{\n\t\t\t\t\t\t'ui-access-rights-v2-section-shadow-left-shown': isLeftShadowShown,\n\t\t\t\t\t\t'ui-access-rights-v2-section-shadow-right-shown': isRightShadowShown,\n\t\t\t\t\t}"\n\t\t\t\t>\n\t\t\t\t\t<SyncHorizontalScroll\n\t\t\t\t\t\tref="column-container"\n\t\t\t\t\t\tclass='ui-access-rights-v2-section-wrapper'\n\t\t\t\t\t\t@scroll="throttledScrollHandler"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Column \n\t\t\t\t\t\t\tv-for="[groupId, group] in userGroups"\n\t\t\t\t\t\t\t:key="groupId"\n\t\t\t\t\t\t\t:user-group="group"\n\t\t\t\t\t\t\t:rights="rights"\n\t\t\t\t\t\t\t:data-accessrights-user-group-id="groupId"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</SyncHorizontalScroll>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const mt={name:"Grid",components:{Section:bt,Header:R,SearchBox:M},loader:null,computed:{...g.mapState({isSaving:t=>t.application.isSaving,searchContainerSelector:t=>t.application.options.searchContainerSelector}),...g.mapGetters({shownSections:"accessRights/shown",shownUserGroups:"userGroups/shown"})},mounted(){this.loader=new i.Loader({target:this.$refs.container})},beforeUnmount(){this.loader.destroy()},watch:{isSaving(t){if(t){this.loader.show()}else{this.loader.hide()}}},template:`\n\t\t<Teleport v-if="searchContainerSelector" :to="searchContainerSelector">\n\t\t\t<SearchBox/>\n\t\t</Teleport>\n\t\t<div ref="container" class='ui-access-rights-v2' :class="{\n\t\t\t'ui-access-rights-v2-block': isSaving,\n\t\t}">\n\t\t\t<Header :user-groups="shownUserGroups"/>\n\t\t\t<Section\n\t\t\t\tv-for="[sectionCode, accessRightSection] in shownSections"\n\t\t\t\t:key="sectionCode"\n\t\t\t\t:code="accessRightSection.sectionCode"\n\t\t\t\t:is-expanded="accessRightSection.isExpanded"\n\t\t\t\t:title="accessRightSection.sectionTitle"\n\t\t\t\t:sub-title="accessRightSection.sectionSubTitle"\n\t\t\t\t:hint="accessRightSection.sectionHint"\n\t\t\t\t:icon="accessRightSection.sectionIcon"\n\t\t\t\t:rights="accessRightSection.rights"\n\t\t\t\t:user-groups="shownUserGroups"\n\t\t\t/>\n\t\t</div>\n\t`};const St="save";const ft="ajax";const yt="data";var It=babelHelpers.classPrivateFieldLooseKey("guid");var Lt=babelHelpers.classPrivateFieldLooseKey("options");class Ct extends g.BuilderModel{constructor(...t){super(...t);Object.defineProperty(this,It,{writable:true,value:void 0});Object.defineProperty(this,Lt,{writable:true,value:void 0})}getName(){return"application"}setOptions(t){babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=t;return this}setGuid(t){babelHelpers.classPrivateFieldLooseBase(this,It)[It]=t;return this}getState(){return{options:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt],guid:babelHelpers.classPrivateFieldLooseBase(this,It)[It],isSaving:false}}getGetters(){return{isMaxVisibleUserGroupsSet:t=>t.options.maxVisibleUserGroups>0}}getMutations(){return{setSaving:(t,e)=>{t.isSaving=Boolean(e)}}}}const wt="new~~~";var Gt=babelHelpers.classPrivateFieldLooseKey("initialUserGroups");var Ht=babelHelpers.classPrivateFieldLooseKey("setAccessRightValuesAction");var Pt=babelHelpers.classPrivateFieldLooseKey("setMinAccessRightValuesForUserGroupAction");var Et=babelHelpers.classPrivateFieldLooseKey("getMinValueForGroupAction");var Rt=babelHelpers.classPrivateFieldLooseKey("setMaxAccessRightValuesForUserGroupAction");var Mt=babelHelpers.classPrivateFieldLooseKey("getMaxValueForGroupAction");var Bt=babelHelpers.classPrivateFieldLooseKey("setRoleTitleAction");var _t=babelHelpers.classPrivateFieldLooseKey("addMemberAction");var Vt=babelHelpers.classPrivateFieldLooseKey("removeMemberAction");var Tt=babelHelpers.classPrivateFieldLooseKey("copyUserGroupAction");var At=babelHelpers.classPrivateFieldLooseKey("addUserGroupAction");var Ft=babelHelpers.classPrivateFieldLooseKey("removeUserGroupAction");var xt=babelHelpers.classPrivateFieldLooseKey("showUserGroupAction");var Ut=babelHelpers.classPrivateFieldLooseKey("hideUserGroupAction");var Ot=babelHelpers.classPrivateFieldLooseKey("isUserGroupExists");var $t=babelHelpers.classPrivateFieldLooseKey("getUserGroup");var Dt=babelHelpers.classPrivateFieldLooseKey("isValueExistsInStructure");var kt=babelHelpers.classPrivateFieldLooseKey("isValueModified");var jt=babelHelpers.classPrivateFieldLooseKey("isSetsEqual");var Nt=babelHelpers.classPrivateFieldLooseKey("isUserGroupModified");class zt extends g.BuilderModel{constructor(...t){super(...t);Object.defineProperty(this,Nt,{value:ue});Object.defineProperty(this,jt,{value:ce});Object.defineProperty(this,kt,{value:le});Object.defineProperty(this,Dt,{value:ae});Object.defineProperty(this,$t,{value:ne});Object.defineProperty(this,Ot,{value:oe});Object.defineProperty(this,Ut,{value:re});Object.defineProperty(this,xt,{value:ie});Object.defineProperty(this,Ft,{value:se});Object.defineProperty(this,At,{value:ee});Object.defineProperty(this,Tt,{value:te});Object.defineProperty(this,Vt,{value:Zt});Object.defineProperty(this,_t,{value:Qt});Object.defineProperty(this,Bt,{value:Yt});Object.defineProperty(this,Mt,{value:Wt});Object.defineProperty(this,Rt,{value:Xt});Object.defineProperty(this,Et,{value:qt});Object.defineProperty(this,Pt,{value:Jt});Object.defineProperty(this,Ht,{value:Kt});Object.defineProperty(this,Gt,{writable:true,value:new Map})}getName(){return"userGroups"}setInitialUserGroups(t){babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]=t;return this}getState(){return{collection:b.Runtime.clone(babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]),deleted:new Set}}getElementState(t={}){return{id:`${wt}${b.Text.getRandom()}`,isNew:true,isModified:true,isShown:true,title:b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_ROLE_NAME"),accessRights:new Map,members:new Map}}getGetters(){return{shown:t=>{const e=new Map;for(const[s,i]of t.collection){if(i.isShown){e.set(s,i)}}return e},getEmptyAccessRightValue:(t,e,s,i)=>(e,s,r)=>{const o=i["accessRights/getEmptyValue"](s,r);return{id:r,values:o,isModified:t.collection.get(e).isNew}},defaultAccessRightValues:(t,e,s)=>{const i=new Map;for(const t of s.accessRights.collection.values()){for(const[e,s]of t.rights){if(b.Type.isNil(s.defaultValue)){continue}i.set(e,{id:e,values:s.defaultValue,isModified:true})}}return i},isModified:t=>{if(t.deleted.size>0){return true}for(const e of t.collection.values()){if(e.isNew||e.isModified){return true}for(const t of e.accessRights.values()){if(t.isModified){return true}}}return false},isMaxVisibleUserGroupsReached:(t,e,s,i)=>{if(!i["application/isMaxVisibleUserGroupsSet"]){return false}return e.shown.size>=s.application.options.maxVisibleUserGroups}}}getActions(){return{setAccessRightValues:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht](t,e)},setMinAccessRightValuesForUserGroup:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt](t,e)},setMaxAccessRightValuesForUserGroup:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt](t,e)},setRoleTitle:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt](t,e)},addMember:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,_t)[_t](t,e)},removeMember:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt](t,e)},copyUserGroup:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt](t,e)},addUserGroup:t=>{babelHelpers.classPrivateFieldLooseBase(this,At)[At](t)},removeUserGroup:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft](t,e)},showUserGroup:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,xt)[xt](t,e)},hideUserGroup:(t,e)=>{babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut](t,e)}}}getMutations(){return{setAccessRightValues:(t,{userGroupId:e,valueId:s,values:i,isModified:r})=>{const o=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t](t,e);const n=o.accessRights.get(s);if(!n){o.accessRights.set(s,{id:s,values:i,isModified:r});return}n.values=i;n.isModified=r},setRoleTitle:(t,{userGroupId:e,title:s})=>{const i=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t](t,e);i.title=s;i.isModified=babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt](i)},addMember:(t,{userGroupId:e,accessCode:s,member:i})=>{const r=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t](t,e);r.members.set(s,i);r.isModified=babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt](r)},removeMember:(t,{userGroupId:e,accessCode:s})=>{const i=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t](t,e);i.members.delete(s);i.isModified=babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt](i)},addUserGroup:(t,{userGroup:e})=>{t.collection.set(e.id,e)},removeUserGroup:(t,{userGroupId:e})=>{t.collection.delete(e)},markUserGroupForDeletion:(t,{userGroupId:e})=>{t.deleted.add(e)},showUserGroup:(t,{userGroupId:e})=>{t.collection.get(e).isShown=true},hideUserGroup:(t,{userGroupId:e})=>{t.collection.get(e).isShown=false}}}}function Kt(t,e){if(!b.Type.isSet(e.values)){console.warn("ui.accessrights.v2: Attempt to set not-Set values",e);return}if(!babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot](t,e.userGroupId)){console.warn("ui.accessrights.v2: Attempt to set value to a user group that dont exists",e);return}if(!babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt](t,e.sectionCode,e.valueId)){console.warn("ui.accessrights.v2: Attempt to set value to a right that dont exists in structure",e);return}t.commit("setAccessRightValues",{userGroupId:e.userGroupId,valueId:e.valueId,values:e.values,isModified:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt](e.userGroupId,e.valueId,e.values,t.rootGetters["accessRights/getEmptyValue"](e.sectionCode,e.valueId))})}function Jt(t,{userGroupId:e}){for(const s of t.rootState.accessRights.collection.values()){for(const i of s.rights.values()){const r=babelHelpers.classPrivateFieldLooseBase(this,Et)[Et](i,t.rootGetters["accessRights/getEmptyValue"](s.sectionCode,i.id));if(b.Type.isNil(r)){continue}void t.dispatch("setAccessRightValues",{userGroupId:e,sectionCode:s.sectionCode,valueId:i.id,values:r})}}void t.dispatch("accessRights/expandAllSections",null,{root:true})}function qt(t,e){const s=b.Type.isBoolean(t.setEmptyOnGroupActions)&&t.setEmptyOnGroupActions;if(s){return e}if(!b.Type.isNil(t.minValue)){return t.minValue}return null}function Xt(t,{userGroupId:e}){for(const s of t.rootState.accessRights.collection.values()){for(const i of s.rights.values()){const r=babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt](i,t.rootGetters["accessRights/getEmptyValue"](s.sectionCode,i.id));if(b.Type.isNil(r)){continue}void t.dispatch("setAccessRightValues",{userGroupId:e,sectionCode:s.sectionCode,valueId:i.id,values:r})}}void t.dispatch("accessRights/expandAllSections",null,{root:true})}function Wt(t,e){const s=b.Type.isBoolean(t.setEmptyOnGroupActions)&&t.setEmptyOnGroupActions;if(s){return e}if(!b.Type.isNil(t.maxValue)){return t.maxValue}return null}function Yt(t,e){if(!b.Type.isString(e.title)){console.warn("ui.accessrights.v2: Attempt to set role title with something other than string",e);return}if(!babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot](t,e.userGroupId)){console.warn("ui.accessrights.v2: Attempt to update user group that dont exists",e);return}t.commit("setRoleTitle",e)}function Qt(t,e){if(!babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot](t,e.userGroupId)){console.warn("ui.accessrights.v2: Attempt to add member to a user group that dont exists",e);return}if(!b.Type.isStringFilled(e.accessCode)||!b.Type.isStringFilled(e.member.id)||!b.Type.isStringFilled(e.member.type)||!b.Type.isStringFilled(e.member.name)||!(b.Type.isNil(e.member.avatar)||b.Type.isStringFilled(e.member.avatar))){console.warn("ui.accessrights.v2: Attempt to add member with invalid payload",e);return}t.commit("addMember",e)}function Zt(t,e){if(!babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot](t,e.userGroupId)){console.warn("ui.accessrights.v2: Attempt to remove member from a user group that dont exists",e);return}if(!b.Type.isStringFilled(e.accessCode)){console.warn("ui.accessrights.v2: Attempt to remove member with invalid payload",e);return}t.commit("removeMember",e)}function te(t,{userGroupId:e}){const s=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t](t.state,e);if(!s){console.warn("ui.accessrights.v2: Attempt to copy user group that dont exists",{userGroupId:e});return}const i=this.getElementState();const r={...b.Runtime.clone(s),id:i.id,title:b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_COPIED_ROLE_NAME",{"#ORIGINAL#":s.title}),isNew:true,isModified:true,isShown:true};for(const t of r.accessRights.values()){t.isModified=true}t.commit("addUserGroup",{userGroup:r})}function ee(t){const e=this.getElementState();e.accessRights=b.Runtime.clone(t.getters.defaultAccessRightValues);t.commit("addUserGroup",{userGroup:e})}function se(t,{userGroupId:e}){const s=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t](t.state,e);if(!s){console.warn("ui.accessrights.v2: Attempt to remove user group that dont exists",{userGroupId:e});return}t.commit("removeUserGroup",{userGroupId:e});if(!s.isNew){t.commit("markUserGroupForDeletion",{userGroupId:e})}}function ie(t,{userGroupId:e}){if(!babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot](t,e)){console.warn("ui.accessrights.v2: Attempt to show user group that dont exists",{userGroupId:e});return}t.commit("showUserGroup",{userGroupId:e})}function re(t,{userGroupId:e}){if(!babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot](t,e)){console.warn("ui.accessrights.v2: Attempt to shrink user group that dont exists",{userGroupId:e});return}t.commit("hideUserGroup",{userGroupId:e})}function oe(t,e){const s=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t](t.state,e);return Boolean(s)}function ne(t,e){return t.collection.get(e)}function ae(t,e,s){const i=t.rootState.accessRights.collection.get(e);return i==null?void 0:i.rights.has(s)}function le(t,e,s,i){var r,o;const n=babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].get(t);if(!n){return true}const a=(r=(o=n.accessRights.get(e))==null?void 0:o.values)!=null?r:i;return!babelHelpers.classPrivateFieldLooseBase(this,jt)[jt](new Set(a),new Set(s))}function ce(t,e){if(b.Type.isFunction(t.symmetricDifference)){return t.symmetricDifference(e).size===0}if(t.size!==e.size){return false}for(const s of t){if(!e.has(s)){return false}}for(const s of e){if(!t.has(s)){return false}}return true}function ue(t){if(t.isNew){return true}const e=babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].get(t.id);if(!e){throw new Error("ui.accessrights.v2: initial user group not found")}if(t.title!==e.title){return true}const s=new Set(e.members.keys());const i=new Set(t.members.keys());return!babelHelpers.classPrivateFieldLooseBase(this,jt)[jt](s,i)}function de(t,e,s,i){const r=zt.create().setInitialUserGroups(e);const o=k.create().setInitialAccessRights(s);const{store:n,builder:a}=g.Builder.init().addModel(Ct.create().setOptions(t).setGuid(i)).addModel(r).addModel(o).syncBuild();return{store:n,resetState:()=>a.clearModelState(),userGroupsModel:r,accessRightsModel:o}}var he=babelHelpers.classPrivateFieldLooseKey("transformAccessCodes");var pe=babelHelpers.classPrivateFieldLooseKey("transformAccessRightValues");class ve{constructor(){Object.defineProperty(this,pe,{value:be});Object.defineProperty(this,he,{value:ge})}transform(t){const e=[];for(const s of t.values()){e.push({id:s.id.startsWith(wt)?"0":s.id,title:s.title,accessCodes:babelHelpers.classPrivateFieldLooseBase(this,he)[he](s.members),accessRights:babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](s)})}return e}shouldBeIncludedInExport(t,e){throw new Error("Not implemented")}}function ge(t){const e={};for(const[s,i]of t){e[s]=i.type}return e}function be(t){const e=[];for(const s of t.accessRights.values()){if(!this.shouldBeIncludedInExport(t,s)){continue}for(const t of s.values){e.push({id:s.id,value:t})}}return e}class me extends ve{shouldBeIncludedInExport(t,e){return true}}class Se extends ve{shouldBeIncludedInExport(t,e){return t.isNew||e.isModified}}var fe=babelHelpers.classPrivateFieldLooseKey("internalizeExternalSection");var ye=babelHelpers.classPrivateFieldLooseKey("internalizeExternalIcon");var Ie=babelHelpers.classPrivateFieldLooseKey("internalizeExternalItem");var Le=babelHelpers.classPrivateFieldLooseKey("internalizeSelectedVariablesAliases");var Ce=babelHelpers.classPrivateFieldLooseKey("internalizeValueSet");var we=babelHelpers.classPrivateFieldLooseKey("internalizeExternalVariable");class Ge{constructor(){Object.defineProperty(this,we,{value:Be});Object.defineProperty(this,Ce,{value:Me});Object.defineProperty(this,Le,{value:Re});Object.defineProperty(this,Ie,{value:Ee});Object.defineProperty(this,ye,{value:Pe});Object.defineProperty(this,fe,{value:He})}transform(t){const e=new Map;for(const s of t){const t=babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](s);e.set(t.sectionCode,t)}return e}}function He(t){const e={sectionCode:b.Type.isStringFilled(t.sectionCode)?t.sectionCode:b.Text.getRandom(),sectionTitle:String(t.sectionTitle),sectionSubTitle:b.Type.isStringFilled(t.sectionSubTitle)?t.sectionSubTitle:null,sectionHint:b.Type.isStringFilled(t.sectionHint)?t.sectionHint:null,sectionIcon:babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](t.sectionIcon),rights:new Map,isExpanded:true,isShown:true};for(const s of t.rights){const t=babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie](s);e.rights.set(t.id,t)}return e}function Pe(t){if(b.Type.isStringFilled(t==null?void 0:t.type)&&b.Type.isStringFilled(t==null?void 0:t.bgColor)){return{type:t.type,bgColor:t.bgColor}}return null}function Ee(t){const[e,s]=babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](t.selectedVariablesAliases);const i={id:String(t.id),type:String(t.type),title:String(t.title),hint:b.Type.isStringFilled(t.hint)?t.hint:null,group:b.Type.isNil(t.group)?null:String(t.group),groupHead:b.Type.isBoolean(t.groupHead)?t.groupHead:false,isShown:true,minValue:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](t.minValue),maxValue:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](t.maxValue),defaultValue:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](t.defaultValue),emptyValue:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](t.emptyValue),setEmptyOnGroupActions:b.Type.isBoolean(t.setEmptyOnGroupActions)?t.setEmptyOnGroupActions:null,variables:b.Type.isArray(t.variables)?new Map:null,allSelectedCode:b.Type.isStringFilled(t.allSelectedCode)?t.allSelectedCode:null,selectedVariablesAliases:e,selectedVariablesAliasesSeparator:s,enableSearch:b.Type.isBoolean(t.enableSearch)?t.enableSearch:null,showAvatars:b.Type.isBoolean(t.showAvatars)?t.showAvatars:null,compactView:b.Type.isBoolean(t.compactView)?t.compactView:null,disableSelectAll:b.Type.isBoolean(t.disableSelectAll)?t.disableSelectAll:null,hintTitle:b.Type.isStringFilled(t.hintTitle)?t.hintTitle:null};if(i.groupHead||i.group){i.isGroupExpanded=false}if(b.Type.isArray(t.variables)){for(const e of t.variables){const t=babelHelpers.classPrivateFieldLooseBase(this,we)[we](e);i.variables.set(t.id,t)}}return i}function Re(t){if(!b.Type.isPlainObject(t)){return[new Map,F]}const e=b.Type.isString(t.separator)?t.separator:F;const s=new Map;for(const[i,r]of Object.entries(t)){if(i==="separator"){continue}s.set(O(i,e),String(r))}return[s,e]}function Me(t){if(b.Type.isNil(t)){return null}if(b.Type.isArray(t)){return new Set(t.map((t=>String(t))))}return new Set([String(t)])}function Be(t){return{id:String(t.id),title:String(t.title),entityId:b.Type.isStringFilled(t.entityId)?t.entityId:null,supertitle:b.Type.isStringFilled(t.supertitle)?t.supertitle:null,avatar:b.Type.isStringFilled(t.avatar)?t.avatar:null,avatarOptions:b.Type.isPlainObject(t.avatarOptions)?t.avatarOptions:null,selectionStrategy:b.Type.isStringFilled(t.selectionStrategy)?t.selectionStrategy:null,conflictsWith:b.Type.isArray(t.conflictsWith)?new Set(t.conflictsWith.map((t=>String(t)))):null,requires:b.Type.isArray(t.requires)?new Set(t.requires.map((t=>String(t)))):null,secondary:b.Type.isBoolean(t.secondary)?t.secondary:null}}var _e=babelHelpers.classPrivateFieldLooseKey("deepFreeze");class Ve{constructor(){Object.defineProperty(this,_e,{value:Te})}transform(t){return babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]({component:String(t.component),actionSave:b.Type.isStringFilled(t.actionSave)?t.actionSave:St,mode:b.Type.isStringFilled(t.mode)?t.mode:ft,bodyType:b.Type.isStringFilled(t.bodyType)?t.bodyType:yt,additionalSaveParams:b.Type.isPlainObject(t.additionalSaveParams)?t.additionalSaveParams:null,isSaveOnlyChangedRights:b.Type.isBoolean(t.isSaveOnlyChangedRights)?t.isSaveOnlyChangedRights:false,maxVisibleUserGroups:b.Type.isInteger(t.maxVisibleUserGroups)?t.maxVisibleUserGroups:null,searchContainerSelector:b.Type.isStringFilled(t.searchContainerSelector)?t.searchContainerSelector:null})}}function Te(t){if(b.Type.isObject(t)){Object.values(t).forEach((t=>{babelHelpers.classPrivateFieldLooseBase(this,_e)[_e](t)}));return Object.freeze(t)}return t}var Ae=babelHelpers.classPrivateFieldLooseKey("maxVisibleUserGroups");var Fe=babelHelpers.classPrivateFieldLooseKey("internalizeExternalGroup");var xe=babelHelpers.classPrivateFieldLooseKey("internalizeExternalAccessRightsValue");var Ue=babelHelpers.classPrivateFieldLooseKey("internalizeExternalAccessCode");var Oe=babelHelpers.classPrivateFieldLooseKey("internalizeExternalMember");class $e{constructor(t){Object.defineProperty(this,Oe,{value:Ne});Object.defineProperty(this,Ue,{value:je});Object.defineProperty(this,xe,{value:ke});Object.defineProperty(this,Fe,{value:De});Object.defineProperty(this,Ae,{writable:true,value:null});if(b.Type.isInteger(t)){babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]=t}}transform(t){const e=new Map;for(const s of t){const t=babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](s);if(babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]>0&&e.size>=babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]){t.isShown=false}e.set(t.id,t)}return e}}function De(t){const e={id:String(t.id),isNew:false,isModified:false,isShown:true,title:String(t.title),accessRights:new Map,members:new Map};for(const s of t.accessRights){const t=babelHelpers.classPrivateFieldLooseBase(this,xe)[xe](s);if(e.accessRights.has(t.id)){for(const s of e.accessRights.get(t.id).values){t.values.add(s)}}e.accessRights.set(t.id,t)}for(const[s,i]of Object.entries(t.members)){const t=babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue](s);e.members.set(t,babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe](i))}return e}function ke(t){const e=String(t.id);const s={id:e,isModified:false};const i=b.Type.isArray(t.value)?t.value:[t.value];s.values=new Set(i.map((t=>String(t))));return s}function je(t){let e=String(t);if(/^IU(\d+)$/.test(e)){e=e.replace("IU","U")}return e}function Ne(t){return{type:String(t.type),id:String(t.id),name:String(t.name),avatar:b.Type.isStringFilled(t.avatar)?t.avatar:null}}var ze=babelHelpers.classPrivateFieldLooseKey("srcUserGroups");var Ke=babelHelpers.classPrivateFieldLooseKey("maxVisibleUserGroups");var Je=babelHelpers.classPrivateFieldLooseKey("ensureThatNoMoreUserGroupsThanMaxIsShown");class qe{constructor(t,e){Object.defineProperty(this,Je,{value:Xe});Object.defineProperty(this,ze,{writable:true,value:void 0});Object.defineProperty(this,Ke,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=t;if(b.Type.isInteger(e)){babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]=e}}transform(t){for(const[e,s]of t){const t=babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].get(e);if(t){s.isShown=t.isShown}else{s.isShown=true}}if(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]>0){babelHelpers.classPrivateFieldLooseBase(this,Je)[Je](t)}return t}}function Xe(t){let e=0;for(const s of t.values()){if(!s.isShown){continue}e++;if(e>babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]){s.isShown=false}}}var We=babelHelpers.classPrivateFieldLooseKey("options");var Ye=babelHelpers.classPrivateFieldLooseKey("renderTo");var Qe=babelHelpers.classPrivateFieldLooseKey("buttonPanel");var Ze=babelHelpers.classPrivateFieldLooseKey("guid");var ts=babelHelpers.classPrivateFieldLooseKey("isUserConfirmedClose");var es=babelHelpers.classPrivateFieldLooseKey("handleSliderClose");var ss=babelHelpers.classPrivateFieldLooseKey("app");var is=babelHelpers.classPrivateFieldLooseKey("store");var rs=babelHelpers.classPrivateFieldLooseKey("resetState");var os=babelHelpers.classPrivateFieldLooseKey("unwatch");var ns=babelHelpers.classPrivateFieldLooseKey("userGroupsModel");var as=babelHelpers.classPrivateFieldLooseKey("accessRightsModel");var ls=babelHelpers.classPrivateFieldLooseKey("bindEvents");var cs=babelHelpers.classPrivateFieldLooseKey("unbindEvents");var us=babelHelpers.classPrivateFieldLooseKey("tryShowFeaturePromoter");var ds=babelHelpers.classPrivateFieldLooseKey("showNotification");var hs=babelHelpers.classPrivateFieldLooseKey("runSaveAjaxRequest");var ps=babelHelpers.classPrivateFieldLooseKey("confirmBeforeClosingModifiedSlider");class vs{constructor(t){Object.defineProperty(this,ps,{value:ys});Object.defineProperty(this,hs,{value:fs});Object.defineProperty(this,ds,{value:Ss});Object.defineProperty(this,us,{value:ms});Object.defineProperty(this,cs,{value:bs});Object.defineProperty(this,ls,{value:gs});Object.defineProperty(this,We,{writable:true,value:{}});Object.defineProperty(this,Ye,{writable:true,value:void 0});Object.defineProperty(this,Qe,{writable:true,value:void 0});Object.defineProperty(this,Ze,{writable:true,value:void 0});Object.defineProperty(this,ts,{writable:true,value:false});Object.defineProperty(this,es,{writable:true,value:void 0});Object.defineProperty(this,ss,{writable:true,value:void 0});Object.defineProperty(this,is,{writable:true,value:void 0});Object.defineProperty(this,rs,{writable:true,value:void 0});Object.defineProperty(this,os,{writable:true,value:void 0});Object.defineProperty(this,ns,{writable:true,value:void 0});Object.defineProperty(this,as,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,We)[We]=t||{};babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=babelHelpers.classPrivateFieldLooseBase(this,We)[We].renderTo;babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]=BX.UI.ButtonPanel||null;babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]=b.Text.getRandom(16);babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]()}fireEventReset(){const t=s.MessageBox.create({message:b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CANCEL_WARNING"),modal:true,buttons:[new c.Button({color:c.ButtonColor.PRIMARY,size:c.ButtonSize.SMALL,text:b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CANCEL_YES_CANCEL"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]();t.close()}}),new c.Button({color:c.ButtonColor.LINK,size:c.ButtonSize.SMALL,text:b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CANCEL_NO_CANCEL"),onclick:()=>{t.close()}})]});t.show()}sendActionRequest(){if(babelHelpers.classPrivateFieldLooseBase(this,is)[is].state.application.isSaving||!babelHelpers.classPrivateFieldLooseBase(this,is)[is].getters["userGroups/isModified"]){return}babelHelpers.classPrivateFieldLooseBase(this,is)[is].commit("application/setSaving",true);babelHelpers.classPrivateFieldLooseBase(this,hs)[hs]().then((({userGroups:t,accessRights:e})=>{babelHelpers.classPrivateFieldLooseBase(this,ns)[ns].setInitialUserGroups(t);babelHelpers.classPrivateFieldLooseBase(this,as)[as].setInitialAccessRights(e);babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]();babelHelpers.classPrivateFieldLooseBase(this,ds)[ds](b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_SETTINGS_HAVE_BEEN_SAVED"))})).catch((t=>{var e,s;console.warn("ui.accessrights.v2: error during save",t);if(babelHelpers.classPrivateFieldLooseBase(this,us)[us](t)){return}babelHelpers.classPrivateFieldLooseBase(this,ds)[ds]((t==null?void 0:(e=t.errors)==null?void 0:(s=e[0])==null?void 0:s.message)||"Something went wrong")})).finally((()=>{var t;const e=(t=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe])==null?void 0:t.getContainer().querySelector(".ui-btn-wait");b.Dom.removeClass(e,"ui-btn-wait");babelHelpers.classPrivateFieldLooseBase(this,is)[is].commit("application/setSaving",false)}))}draw(){const t=(new Ve).transform(babelHelpers.classPrivateFieldLooseBase(this,We)[We]);const{store:e,resetState:s,accessRightsModel:i,userGroupsModel:r}=de(t,new $e(t.maxVisibleUserGroups).transform(babelHelpers.classPrivateFieldLooseBase(this,We)[We].userGroups),(new Ge).transform(babelHelpers.classPrivateFieldLooseBase(this,We)[We].accessRights),babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]);babelHelpers.classPrivateFieldLooseBase(this,is)[is]=e;babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=s;babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]=r;babelHelpers.classPrivateFieldLooseBase(this,as)[as]=i;babelHelpers.classPrivateFieldLooseBase(this,os)[os]=babelHelpers.classPrivateFieldLooseBase(this,is)[is].watch(((t,e)=>e["userGroups/isModified"]),(t=>{if(t){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe])==null?void 0:e.show()}else{var s;(s=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe])==null?void 0:s.hide()}}));babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=n.BitrixVue.createApp(mt);babelHelpers.classPrivateFieldLooseBase(this,ss)[ss].use(babelHelpers.classPrivateFieldLooseBase(this,is)[is]);b.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]);babelHelpers.classPrivateFieldLooseBase(this,ss)[ss].mount(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye])}destroy(){babelHelpers.classPrivateFieldLooseBase(this,ss)[ss].unmount();babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=null;babelHelpers.classPrivateFieldLooseBase(this,cs)[cs]();babelHelpers.classPrivateFieldLooseBase(this,os)[os]();babelHelpers.classPrivateFieldLooseBase(this,os)[os]=null;babelHelpers.classPrivateFieldLooseBase(this,is)[is]=null;babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=null;babelHelpers.classPrivateFieldLooseBase(this,ns)[ns]=null;babelHelpers.classPrivateFieldLooseBase(this,as)[as]=null;babelHelpers.classPrivateFieldLooseBase(this,We)[We]=null;babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]=null;b.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]);babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=null}}function gs(){babelHelpers.classPrivateFieldLooseBase(this,es)[es]=t=>{var e,s;const[i]=t.getData();const r=((e=BX.SidePanel)==null?void 0:(s=e.Instance)==null?void 0:s.getSliderByWindow(window))===(i==null?void 0:i.getSlider());if(!r){return}babelHelpers.classPrivateFieldLooseBase(this,ps)[ps](i)};e.EventEmitter.subscribe("SidePanel.Slider:onClose",babelHelpers.classPrivateFieldLooseBase(this,es)[es])}function bs(){e.EventEmitter.unsubscribe("SidePanel.Slider:onClose",babelHelpers.classPrivateFieldLooseBase(this,es)[es]);babelHelpers.classPrivateFieldLooseBase(this,es)[es]=null}function ms(t){if(!b.Type.isArrayFilled(t==null?void 0:t.errors)){return false}for(const s of t.errors){var e;if(b.Type.isStringFilled(s==null?void 0:(e=s.customData)==null?void 0:e.sliderCode)){b.Runtime.loadExtension("ui.info-helper").then((({FeaturePromotersRegistry:t})=>{t.getPromoter({code:s.customData.sliderCode}).show()})).catch((t=>{console.error("ui.accessrights.v2: could not load ui.info-helper",t)}));return true}}return false}function Ss(t){BX.UI.Notification.Center.notify({content:t,position:"top-right",autoHideDelay:3e3})}function fs(){const t=babelHelpers.classPrivateFieldLooseBase(this,is)[is].state.userGroups.collection;let e=null;if(babelHelpers.classPrivateFieldLooseBase(this,is)[is].state.application.options.isSaveOnlyChangedRights){e=(new Se).transform(t)}else{e=(new me).transform(t)}const s=babelHelpers.classPrivateFieldLooseBase(this,is)[is].state.application.options.bodyType;return new Promise(((i,r)=>{b.ajax.runComponentAction(babelHelpers.classPrivateFieldLooseBase(this,is)[is].state.application.options.component,babelHelpers.classPrivateFieldLooseBase(this,is)[is].state.application.options.actionSave,{mode:babelHelpers.classPrivateFieldLooseBase(this,is)[is].state.application.options.mode,[s]:{userGroups:e,deletedUserGroups:[...babelHelpers.classPrivateFieldLooseBase(this,is)[is].state.userGroups.deleted.values()],parameters:babelHelpers.classPrivateFieldLooseBase(this,is)[is].state.application.options.additionalSaveParams}}).then((e=>{const s=babelHelpers.classPrivateFieldLooseBase(this,is)[is].state.application.options.maxVisibleUserGroups;const r=new $e(s).transform(e.data.USER_GROUPS);new qe(t,s).transform(r);i({userGroups:r,accessRights:(new Ge).transform(e.data.ACCESS_RIGHTS)})})).catch(r)}))}function ys(t){if(!babelHelpers.classPrivateFieldLooseBase(this,is)[is].getters["userGroups/isModified"]||babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]){return}t.denyAction();const e=s.MessageBox.create({title:b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CLOSE_WARNING_TITLE"),message:b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CLOSE_WARNING"),modal:true,buttons:[new c.Button({color:c.ButtonColor.PRIMARY,size:c.ButtonSize.SMALL,text:b.Loc.getMessage("JS_UI_ACCESSRIGHTS_V2_MODIFIED_CLOSE_YES_CLOSE"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=true;e.close();t.getSlider().close()}}),new c.CancelButton({size:c.ButtonSize.SMALL,onclick:()=>{e.close()}})]});e.show()}t.App=vs})(this.BX.UI.AccessRights.V2=this.BX.UI.AccessRights.V2||{},BX.Event,BX.UI.Dialogs,BX,BX.UI.Vue3.Components,BX.UI,BX.Vue3,BX.UI.Vue3.Components,BX.Vue3.Directives,BX.UI,BX.UI.EntitySelector,BX.UI.Vue3.Components,BX.Main,BX,BX,BX.Vue3.Vuex,BX);
//# sourceMappingURL=v2.bundle.map.js