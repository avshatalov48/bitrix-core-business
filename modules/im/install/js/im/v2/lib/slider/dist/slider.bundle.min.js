this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,n,s,i,r,a,o,l){"use strict";const d="im:slider";const c=1200;const g="bx-im-messenger__slider";const h="/bitrix/js/im/v2/lib/slider/src/images/loader-chats.svg?v3";class u{static init(){if(this.instance){return}this.instance=new this}static getInstance(){this.init();return this.instance}constructor(){this.instances={};this.sidePanelManager=BX.SidePanel.Instance;this.v2enabled=false;r.Logger.warn("Slider: class created");this.initSettings();this.bindEvents();this.store=s.Core.getStore()}bindEvents(){if(!this.v2enabled){r.Logger.warn("Slider: v2 is not enabled");return false}n.EventEmitter.subscribe("SidePanel.Slider:onCloseByEsc",this.onCloseByEsc.bind(this));n.EventEmitter.subscribe("SidePanel.Slider:onClose",this.onClose.bind(this));n.EventEmitter.subscribe("SidePanel.Slider:onDestroy",this.onDestroy.bind(this));t.Event.ready(this.initZIndex.bind(this));return true}initSettings(){const e=t.Extension.getSettings("im.v2.lib.slider");this.v2enabled=e.get("v2enabled",false)}openSlider(){if(o.DesktopManager.isChatWindow()){this.sidePanelManager.closeAll(true);return Promise.resolve()}if(this.isOpened()){t.ZIndexManager.bringToFront(this.getCurrent().getOverlay());return Promise.resolve()}void this.launchMessengerApplication();return new Promise((e=>{if(this.isFocused()){e();return}const t=this.getNextId();this.sidePanelManager.open(`${d}:${t}`,{data:{rightBoundary:0},cacheable:false,animationDuration:100,hideControls:true,customLeftBoundary:0,customRightBoundary:0,loader:h,contentCallback:()=>`<div class="${g}"></div>`,events:{onLoad:e=>{e.slider.showLoader()},onOpenComplete:async t=>{await this.initMessengerComponent();t.slider.closeLoader();return e()}}});this.instances[t]=this.sidePanelManager.getSlider(`${d}:${t}`)}))}launchMessengerApplication(){if(this.applicationPromise){return this.applicationPromise}this.applicationPromise=t.Runtime.loadExtension("im.v2.application.messenger").then((()=>a.Launch("messenger"))).then((e=>{r.Logger.warn("Slider: Messenger application launched",e);return e}));return this.applicationPromise}async initMessengerComponent(){const e=await this.applicationPromise;return e.initComponent(`.${g}`)}onDialogOpen(e){r.Logger.warn("Slider: onDialogOpen",e.data.dialogId)}onClose({data:e}){[e]=e;const t=e.getSlider().getUrl().toString();if(!t.startsWith(d)){return}if(!this.canClose()){e.denyAction();return}const s=this.getIdFromSliderId(t);delete this.instances[s];n.EventEmitter.emit(i.EventType.slider.onClose);l.LayoutManager.getInstance().setLayout({name:i.Layout.chat.name})}onCloseByEsc({data:e}){[e]=e;const t=e.getSlider().getUrl().toString();if(!t.startsWith(d)){return}if(!this.canCloseByEsc()){e.denyAction()}}onDestroy({data:e}){[e]=e;const t=e.getSlider().getUrl().toString();if(!t.startsWith(d)){return}const n=this.getIdFromSliderId(t);delete this.instances[n]}initZIndex(){if(!t.ZIndexManager){return}const e=t.ZIndexManager.getOrAddStack(document.body);e.baseIndex=c;e.sort()}getZIndex(){return c}isOpened(){return Object.keys(this.instances).length>0}isFocused(){if(!this.isOpened()){return false}const e=this.sidePanelManager.getTopSlider();if(!e){return false}return e.getUrl().toString().startsWith(d)}canClose(){return true}canCloseByEsc(){return false}getCurrent(){return this.instances[this.getCurrentId()]}getCurrentId(){return Object.keys(this.instances).length}getNextId(){return this.getCurrentId()+1}getIdFromSliderId(e){return Number.parseInt(e.slice(d.length+1),10)}}u.instance=null;e.MessengerSlider=u})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=slider.bundle.map.js