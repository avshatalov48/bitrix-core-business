{"version":3,"file":"dialogeditcontact.bundle.js","sources":["../src/dialogeditcontact.js"],"sourcesContent":["import { Validation } from 'main.core';\nimport { Tag } from 'main.core';\nimport { Text } from 'main.core';\nimport { Loc } from 'main.core';\nimport { SidePanelWrapper } from 'mail.sidepanelwrapper';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport './css/style.css';\nimport '/bitrix/js/ui/forms/ui.forms.css';\nimport 'ui.forms';\n\nexport class DialogEditContact\n{\n\tstatic getCheckedFields(contentElement)\n\t{\n\t\tconst emailItem = contentElement.querySelector('[data-role=\"email-container\"]');\n\t\tconst emailInput = emailItem.querySelector('[data-role=\"input\"]');\n\t\tconst email = emailInput.value;\n\n\t\tconst nameItem = contentElement.querySelector('[data-role=\"name-container\"]');\n\t\tconst nameInput = nameItem.querySelector('[data-role=\"input\"]');\n\t\tlet name = nameInput.value;\n\n\t\tlet fieldsAreFilledCorrectly = true;\n\t\tlet checkedFields = [];\n\n\t\tif (!Validation.isEmail(email))\n\t\t{\n\t\t\tfieldsAreFilledCorrectly = false;\n\t\t\temailItem.showError();\n\t\t}\n\t\telse if (name.length < 1)\n\t\t{\n\t\t\tname = email.split('@')[0];\n\t\t}\n\n\t\tcheckedFields = {\n\t\t\tname: name,\n\t\t\temail: email,\n\t\t};\n\n\t\tif (fieldsAreFilledCorrectly)\n\t\t{\n\t\t\treturn checkedFields;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tstatic openRemoveDialog(config = {\n\t\tid: '',\n\t})\n\t{\n\t\tlet promiseRemoveContact = new BX.Promise();\n\t\tlet removeContact = this.removeContact;\n\t\tconst topSlider = BX.SidePanel.Instance.getTopSlider();\n\t\tlet messageBoxZIndex = 1;\n\n\t\tif (topSlider != null)\n\t\t{\n\t\t\tmessageBoxZIndex += topSlider.getZindex();\n\t\t}\n\n\t\tconst messageBox = new MessageBox({\n\t\t\ttitle: Loc.getMessage(\"MAIL_DIALOG_EDIT_CONTACT_REMOVE_DIALOG_TITLE\"),\n\t\t\tmessage: Loc.getMessage(\"MAIL_DIALOG_EDIT_CONTACT_REMOVE_DIALOG_MESSAGE\"),\n\t\t\tbuttons: BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,\n\t\t\tpopupOptions: {\n\t\t\t\tzIndex: messageBoxZIndex,\n\t\t\t},\n\t\t\tonOk: function() {\n\t\t\t\tremoveContact(config['id']).then(() => promiseRemoveContact.fulfill());\n\t\t\t\tmessageBox.close();\n\t\t\t},\n\t\t\tonCancel: function() {\n\t\t\t\tpromiseRemoveContact.reject();\n\t\t\t\tmessageBox.close();\n\t\t\t},\n\t\t});\n\n\t\tmessageBox.show();\n\n\t\treturn promiseRemoveContact;\n\t}\n\n\tstatic removeContact(id)\n\t{\n\t\treturn BX.ajax.runAction('mail.addressbook.removecontacts', {\n\t\t\tdata: {\n\t\t\t\tidSet: [id],\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic saveContact(name, email, id)\n\t{\n\t\tlet contactData = {\n\t\t\tNAME: name,\n\t\t\tEMAIL: email,\n\t\t};\n\n\t\tif (id !== undefined)\n\t\t{\n\t\t\tcontactData['ID'] = id;\n\t\t}\n\n\t\treturn BX.ajax.runAction('mail.addressbook.savecontact', {\n\t\t\tdata: {\n\t\t\t\tcontactData: contactData,\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic showError(item = this)\n\t{\n\t\tlet errorTitle = item.querySelector('[data-role=\"error-title\"]');\n\t\terrorTitle.style.display = 'block';\n\t}\n\n\tstatic hideError(item = this)\n\t{\n\t\tlet errorTitle = item.querySelector('[data-role=\"error-title\"]');\n\t\terrorTitle.style.display = 'none';\n\t}\n\n\tstatic openDialog(titleText, contactConfig = {})\n\t{\n\t\tlet currentEmail = \"\";\n\t\tlet currentName = \"\";\n\n\t\tif (contactConfig['contactData'] !== undefined)\n\t\t{\n\t\t\tcurrentName = Text.encode(contactConfig['contactData']['name']);\n\t\t\tcurrentEmail = Text.encode(contactConfig['contactData']['email']);\n\t\t}\n\n\t\tlet content = Tag.render`\n\t\t\t<div>\n\t\t\t\t<div data-role=\"name-container\" class=\"mail-addressbook-dialogeditcontact-item\">\n\t\t\t\t\t<label class=\"mail-addressbook-dialogeditcontact-lable\">${Loc.getMessage(\"MAIL_DIALOG_EDIT_CONTACT_NAME_TITLE\")}\n\t\t\t\t\t\t<div id=\"mail-addressbook-dialogeditcontact-contact-email-container\" class=\"ui-ctl ui-ctl-textbox mail-addressbook-dialogeditcontact-field\">\n\t\t\t\t\t\t\t<input data-role = \"input\" value=\"${currentName}\" class=\"ui-ctl-element\" placeholder=\"\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t\t<div data-role = \"error-title\" class=\"mail-addressbook-dialogeditcontact-contact-error\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div data-role=\"email-container\" class=\"mail-addressbook-dialogeditcontact-item\">\n\t\t\t\t\t<label class=\"mail-addressbook-dialogeditcontact-lable\">${Loc.getMessage(\"MAIL_DIALOG_EDIT_CONTACT_EMAIL_TITLE\")}\n\t\t\t\t\t\t<div id=\"mail-addressbook-dialogeditcontact-contact-email-container\" class=\"ui-ctl ui-ctl-textbox mail-addressbook-dialogeditcontact-field\">\n\t\t\t\t\t\t\t<input data-role = \"input\" value=\"${currentEmail}\" class=\"ui-ctl-element\" placeholder=\"info@example.com\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t\t<div data-role = \"error-title\" class=\"mail-addressbook-dialogeditcontact-contact-error\">${Loc.getMessage(\"MAIL_DIALOG_EDIT_CONTACT_EMAIL_ERROR\")}</div>\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>`;\n\n\t\tlet emailItem = content.querySelector('[data-role=\"email-container\"]');\n\t\temailItem.showError = this.showError;\n\t\temailItem.hideError = this.hideError;\n\n\t\tlet nameItem = content.querySelector('[data-role=\"name-container\"]');\n\t\tnameItem.showError = this.showError;\n\t\tnameItem.hideError = this.hideError;\n\n\t\tlet emailInput = emailItem.querySelector('[data-role=\"input\"]');\n\t\temailInput.oninput = () => emailItem.hideError();\n\n\t\tlet nameInput = nameItem.querySelector('[data-role=\"input\"]');\n\t\tnameInput.oninput = () => nameItem.hideError();\n\n\t\tSidePanelWrapper.open({\n\t\t\tid: 'dialogEditContact',\n\t\t\ttitleText: titleText,\n\t\t\tfooterIsActive: true,\n\t\t\tcontent: content,\n\t\t\tcancelButton: {\n\t\t\t\ttext: Loc.getMessage(\"MAIL_DIALOG_EDIT_CONTACT_BUTTON_CANCEL\"),\n\t\t\t},\n\t\t\tconsentButton: {\n\t\t\t\ttext: Loc.getMessage(\"MAIL_DIALOG_EDIT_CONTACT_BUTTON_SAVE\"),\n\t\t\t\tfunction: (eventObject) => {\n\t\t\t\t\tconst checkedFields = this.getCheckedFields(content);\n\n\t\t\t\t\tif (checkedFields)\n\t\t\t\t\t{\n\t\t\t\t\t\teventObject.setClocking(true);\n\n\t\t\t\t\t\tthis.saveContact(checkedFields['name'], checkedFields['email'], contactConfig['contactID']).then(() => {\n\t\t\t\t\t\t\tBX.SidePanel.Instance.close();\n\t\t\t\t\t\t\tBX.SidePanel.Instance.postMessageAll('mail:side-panel', 'dialogEditContact::reloadList', {});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tstatic openCreateDialog(config)\n\t{\n\t\tthis.openDialog(Loc.getMessage(\"MAIL_DIALOG_EDIT_CONTACT_TITLE_BAR_ADD\"), config);\n\t}\n\n\tstatic openEditDialog(config = {\n\t\tcontactID: '',\n\t\tcontactData: {\n\t\t\tname: '',\n\t\t\temail: '',\n\t\t},\n\t})\n\t{\n\t\tthis.openDialog(Loc.getMessage(\"MAIL_DIALOG_EDIT_CONTACT_TITLE_BAR_EDIT\"), config);\n\t}\n}"],"names":["DialogEditContact","contentElement","emailItem","querySelector","emailInput","email","value","nameItem","nameInput","name","fieldsAreFilledCorrectly","checkedFields","Validation","isEmail","showError","length","split","config","id","promiseRemoveContact","BX","Promise","removeContact","topSlider","SidePanel","Instance","getTopSlider","messageBoxZIndex","getZindex","messageBox","MessageBox","title","Loc","getMessage","message","buttons","UI","Dialogs","MessageBoxButtons","OK_CANCEL","popupOptions","zIndex","onOk","then","fulfill","close","onCancel","reject","show","ajax","runAction","data","idSet","contactData","NAME","EMAIL","undefined","item","errorTitle","style","display","titleText","contactConfig","currentEmail","currentName","Text","encode","content","Tag","render","hideError","oninput","SidePanelWrapper","open","footerIsActive","cancelButton","text","consentButton","function","eventObject","getCheckedFields","setClocking","saveContact","postMessageAll","openDialog","contactID"],"mappings":"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"}