{"version":3,"file":"deletedviewform.bundle.js","sources":["../src/deletedviewform.js"],"sourcesContent":["import { Type, Tag, Dom, Loc, Text } from 'main.core';\nimport { WidgetDate } from 'calendar.sharing.public-v2';\nimport './css/deletedviewform.css';\nimport { Util } from 'calendar.util';\nimport { DateTimeFormat } from 'main.date';\n\ntype InitialEventData = {\n\ttimestampFromUTC: number,\n\ttimestampToUTC: number,\n\ttimezone: string,\n\tisFullDay: boolean,\n\teventName: string,\n\teventId: boolean,\n\tcanceledUserName: string,\n\tcanceledUserId: number,\n\tcanceledTimestamp: number,\n}\n\nexport class DeletedViewForm\n{\n\t#layout;\n\t#eventData;\n\t#widgetDate: WidgetDate;\n\n\tconstructor(entryId)\n\t{\n\t\tthis.#eventData = {\n\t\t\teventId: entryId,\n\t\t\tfrom: null,\n\t\t\tto: null,\n\t\t\ttimezone: null,\n\t\t\tisFullDay: false,\n\t\t\tcanceledTimestamp: null,\n\t\t\tcanceledUserName: null,\n\t\t\tcanceledUserId: null,\n\t\t\teventName: null,\n\t\t};\n\n\t\tthis.#layout = {\n\t\t\tback: null,\n\t\t\twidgetDate: null,\n\t\t\teventName: null,\n\t\t\ticon: null,\n\t\t\tstateTitle: null,\n\t\t\tadditionalBlock: null,\n\t\t\tbottomButton: null,\n\t\t};\n\n\t\tthis.#widgetDate = new WidgetDate();\n\t}\n\n\tinitInSlider(slider, promiseResolve)\n\t{\n\t\tthis.createContent(slider).then((html) => {\n\t\t\tif (Type.isFunction(promiseResolve))\n\t\t\t{\n\t\t\t\tpromiseResolve(html);\n\t\t\t}\n\t\t});\n\t}\n\n\tcreateContent(slider)\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.ajax.runAction('calendar.api.sharingajax.getDeletedSharedEvent', {\n\t\t\t\tdata: {\n\t\t\t\t\tentryId: parseInt(this.#eventData.eventId, 10),\n\t\t\t\t},\n\t\t\t}).then((response) => {\n\t\t\t\tconst entry = response.data.entry;\n\t\t\t\tconst link = response.data.link;\n\t\t\t\tconst userTimezone = response.data.userTimezone;\n\n\t\t\t\tthis.#initEventData({\n\t\t\t\t\teventId: entry.ID,\n\t\t\t\t\ttimestampFromUTC: entry.timestampFromUTC,\n\t\t\t\t\ttimestampToUTC: entry.timestampToUTC,\n\t\t\t\t\ttimezone: userTimezone,\n\t\t\t\t\tisFullDay: entry.DT_SKIP_TIME === 'Y',\n\t\t\t\t\teventName: entry.NAME,\n\t\t\t\t\tcanceledTimestamp: link.canceledTimestamp,\n\t\t\t\t\tcanceledUserId: entry.canceledUserId,\n\t\t\t\t\tcanceledUserName: entry.HOST_NAME,\n\t\t\t\t});\n\n\t\t\t\tconst deletedViewSliderRoot = Tag.render`\n\t\t\t\t\t<div class=\"calendar-deleted-event-view-slider-root\">\n\t\t\t\t\t\t<div class=\"calendar-pub__block calendar-pub__state\">\n\t\t\t\t\t\t\t${this.#getContent()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\n\t\t\t\tslider.sliderContent = deletedViewSliderRoot;\n\t\t\t\tresolve(deletedViewSliderRoot);\n\t\t\t});\n\t\t});\n\t}\n\n\t#initEventData(initialEventData: InitialEventData)\n\t{\n\t\tthis.#eventData.eventId = initialEventData.eventId;\n\t\tthis.#eventData.from = Util.getTimezoneDateFromTimestampUTC(\n\t\t\tparseInt(initialEventData.timestampFromUTC, 10) * 1000,\n\t\t\tinitialEventData.timezone,\n\t\t);\n\t\tthis.#eventData.to = Util.getTimezoneDateFromTimestampUTC(\n\t\t\tparseInt(initialEventData.timestampToUTC, 10) * 1000,\n\t\t\tinitialEventData.timezone,\n\t\t);\n\t\tthis.#eventData.timezone = initialEventData.timezone;\n\t\tthis.#eventData.isFullDay = initialEventData.isFullDay;\n\t\tthis.#eventData.eventName = initialEventData.eventName;\n\t\tthis.#eventData.canceledTimestamp = initialEventData.canceledTimestamp;\n\t\tthis.#eventData.canceledUserName = initialEventData.canceledUserName;\n\t\tthis.#eventData.canceledUserId = initialEventData.canceledUserId;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"calendar-sharing__form-result\">\n\t\t\t\t${this.#getNodeBackWrapper()}\n\t\t\t\t<div class=\"calendar-sharing__calendar-block --form --center\">\n\t\t\t\t\t${this.#getNodeIcon()}\n\t\t\t\t\t${this.#getEventNameNode()}\n\t\t\t\t\t${this.#getStateTitleNode()}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"calendar-sharing__calendar-block --form --center\">\n\t\t\t\t\t${this.#getNodeWidgetDate()}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"calendar-sharing__calendar-block --form --center\">\n\t\t\t\t\t${this.#getAdditionalBlockNode()}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"calendar-sharing__calendar-block --top-auto\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getNodeIcon()\n\t{\n\t\tif (!this.#layout.icon)\n\t\t{\n\t\t\tthis.#layout.icon = this.#createIcon();\n\t\t}\n\n\t\treturn this.#layout.icon;\n\t}\n\n\t#getNodeBackWrapper(): HTMLElement\n\t{\n\t\tif (!this.#layout.back)\n\t\t{\n\t\t\tthis.#layout.back = Tag.render`<div class=\"calendar-sharing__calendar-bar --no-margin\"></div>`;\n\t\t}\n\n\t\treturn this.#layout.back;\n\t}\n\n\t#createIcon()\n\t{\n\t\tconst result = Tag.render`\n\t\t\t<div class=\"calendar-sharing__form-result_icon\"></div>\n\t\t`;\n\t\tDom.addClass(result, '--decline');\n\n\t\treturn result;\n\t}\n\n\t#getEventNameNode(): HTMLElement\n\t{\n\t\tif (!this.#layout.eventName)\n\t\t{\n\t\t\tthis.#layout.eventName = Tag.render`\n\t\t\t\t<div class=\"calendar-pub-ui__typography-title --center --line-height-normal\">\n\t\t\t\t\t${Text.encode(this.#eventData.eventName)}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.eventName;\n\t}\n\n\t#getStateTitleNode()\n\t{\n\t\tif (!this.#layout.stateTitle)\n\t\t{\n\t\t\tthis.#layout.stateTitle = Tag.render`\n\t\t\t\t<div class=\"calendar-pub-ui__typography-s --center\">\n\t\t\t\t\t${Loc.getMessage('CALENDAR_SHARING_MEETING_CANCELED')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn this.#layout.stateTitle;\n\t}\n\n\t#getAdditionalBlockNode()\n\t{\n\t\tif (!this.#layout.additionalBlock)\n\t\t{\n\t\t\tthis.#layout.additionalBlock = this.#createAdditionalBlockContentByState();\n\t\t}\n\n\t\treturn this.#layout.additionalBlock;\n\t}\n\n\t#createAdditionalBlockContentByState()\n\t{\n\t\tlet result = '';\n\n\t\tconst date = Util.getTimezoneDateFromTimestampUTC(\n\t\t\tparseInt(this.#eventData.canceledTimestamp, 10) * 1000,\n\t\t\tthis.#eventData.timezone,\n\t\t);\n\n\t\tif (this.#eventData.canceledTimestamp && this.#eventData.canceledUserName && date)\n\t\t{\n\t\t\tconst dayMonthFormat = DateTimeFormat.getFormat('DAY_MONTH_FORMAT');\n\t\t\tconst shortTimeFormat = DateTimeFormat.getFormat('SHORT_TIME_FORMAT');\n\t\t\tconst format = `${dayMonthFormat} ${shortTimeFormat}`;\n\n\t\t\tresult = Tag.render`\n\t\t\t\t<div class=\"calendar-pub__form-status\">\n\t\t\t\t\t<div class=\"calendar-pub__form-status_text\">\n\t\t\t\t\t\t${Loc.getMessage('CALENDAR_SHARING_WHO_CANCELED')}: <a href=\"/company/personal/user/${this.#eventData.canceledUserId}/\" target=\"_blank\" class=\"calendar-sharing-deletedviewform_open-profile\">${Text.encode(this.#eventData.canceledUserName)}</a>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t${DateTimeFormat.format(format, date.getTime() / 1000)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = Tag.render`\n\t\t\t\t<div></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t#getNodeWidgetDate(): HTMLElement\n\t{\n\t\tif (!this.#layout.widgetDate)\n\t\t{\n\t\t\tthis.#widgetDate.updateValue({\n\t\t\t\tfrom: this.#eventData.from,\n\t\t\t\tto: this.#eventData.to,\n\t\t\t\ttimezone: this.#eventData.timezone,\n\t\t\t\tisFullDay: this.#eventData.isFullDay,\n\t\t\t});\n\t\t\tthis.#layout.widgetDate = this.#widgetDate.render();\n\t\t}\n\n\t\treturn this.#layout.widgetDate;\n\t}\n}\n"],"names":["DeletedViewForm","constructor","entryId","eventId","from","to","timezone","isFullDay","canceledTimestamp","canceledUserName","canceledUserId","eventName","back","widgetDate","icon","stateTitle","additionalBlock","bottomButton","WidgetDate","initInSlider","slider","promiseResolve","createContent","then","html","Type","isFunction","Promise","resolve","BX","ajax","runAction","data","parseInt","response","entry","link","userTimezone","ID","timestampFromUTC","timestampToUTC","DT_SKIP_TIME","NAME","HOST_NAME","deletedViewSliderRoot","Tag","render","sliderContent","initialEventData","Util","getTimezoneDateFromTimestampUTC","result","Dom","addClass","Text","encode","Loc","getMessage","date","dayMonthFormat","DateTimeFormat","getFormat","shortTimeFormat","format","getTime","updateValue"],"mappings":"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"}