{"version":3,"file":"chat-search.bundle.js","sources":["../src/classes/search-service/base-server-search.js","../src/classes/search-service.js","../src/classes/search-context-menu.js","../src/components/search-item.js","../src/components/my-notes.js","../src/components/carousel-user.js","../src/components/recent-users-carousel.js","../src/components/latest-search-result.js","../src/components/empty-state.js","../src/components/search-result.js","../src/chat-search.js"],"sourcesContent":["import { ajax as Ajax } from 'main.core';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { Utils } from 'im.v2.lib.utils';\nimport { StoreUpdater, type ImRecentProviderItem, type SearchConfig } from 'im.v2.lib.search';\nimport { EntityId, getSearchConfig, SearchResultItem } from 'im.v2.lib.search';\n\ntype RecentItem = [string, string | number];\n\nconst SEARCH_REQUEST_ENDPOINT = 'ui.entityselector.doSearch';\nconst LOAD_LATEST_RESULTS_ENDPOINT = 'ui.entityselector.load';\nconst SAVE_ITEM_ENDPOINT = 'ui.entityselector.saveRecentItems';\n\nexport class BaseServerSearch\n{\n\t#searchConfig: SearchConfig;\n\t#storeUpdater: StoreUpdater;\n\n\tconstructor(searchConfig: SearchConfig)\n\t{\n\t\tthis.#searchConfig = searchConfig;\n\t\tthis.#storeUpdater = new StoreUpdater();\n\t}\n\n\tasync search(query: string): Promise<SearchResultItem[]>\n\t{\n\t\tconst items = await this.#searchRequest(query);\n\t\tawait this.#storeUpdater.update(items);\n\n\t\treturn this.#getDialogIdAndDate(items);\n\t}\n\n\tasync loadLatestResults(): Promise<SearchResultItem[]>\n\t{\n\t\tconst response = await this.#loadLatestResultsRequest();\n\t\tconst { items, recentItems } = response;\n\t\tif (items.length === 0 || recentItems.length === 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst itemsFromRecentItems = this.#getItemsFromRecentItems(recentItems, items);\n\t\tawait this.#storeUpdater.update(itemsFromRecentItems);\n\n\t\treturn this.#getDialogIdAndDate(itemsFromRecentItems);\n\t}\n\n\taddItemsToRecentSearchResults(dialogId: string): Promise\n\t{\n\t\tconst recentItems = [{ id: dialogId, entityId: EntityId }];\n\n\t\tconst config = {\n\t\t\tjson: {\n\t\t\t\t...getSearchConfig(this.#searchConfig),\n\t\t\t\trecentItems,\n\t\t\t},\n\t\t};\n\n\t\treturn Ajax.runAction(SAVE_ITEM_ENDPOINT, config);\n\t}\n\n\tasync #loadLatestResultsRequest(): Promise<{items: ImRecentProviderItem[], recentItems: Object[]}>\n\t{\n\t\tconst config = {\n\t\t\tjson: getSearchConfig(this.#searchConfig),\n\t\t};\n\n\t\tlet items = { items: [], recentItems: [] };\n\t\ttry\n\t\t{\n\t\t\tconst response = await Ajax.runAction(LOAD_LATEST_RESULTS_ENDPOINT, config);\n\t\t\tLogger.warn('Search service: latest search request result', response);\n\t\t\titems = response.data.dialog;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tLogger.warn('Search service: latest search request error', error);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tasync #searchRequest(query: string): Promise<ImRecentProviderItem[]>\n\t{\n\t\tconst config = {\n\t\t\tjson: getSearchConfig(this.#searchConfig),\n\t\t};\n\n\t\tconfig.json.searchQuery = {\n\t\t\tqueryWords: Utils.text.getWordsFromString(query),\n\t\t\tquery,\n\t\t};\n\n\t\tlet items = [];\n\t\ttry\n\t\t{\n\t\t\tconst response = await Ajax.runAction(SEARCH_REQUEST_ENDPOINT, config);\n\t\t\tLogger.warn('Search service: request result', response);\n\t\t\titems = response.data.dialog.items;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tLogger.warn('Search service: error', error);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\t#getDialogIdAndDate(items: ImRecentProviderItem[]): SearchResultItem[]\n\t{\n\t\treturn items.map((item) => {\n\t\t\treturn {\n\t\t\t\tdialogId: item.id.toString(),\n\t\t\t\tdateMessage: item.customData?.dateMessage ?? '',\n\t\t\t};\n\t\t});\n\t}\n\n\t#getItemsFromRecentItems(recentItems: RecentItem[], items: ImRecentProviderItem[]): ImRecentProviderItem[]\n\t{\n\t\tconst filledRecentItems = [];\n\t\trecentItems.forEach(([, dialogId]) => {\n\t\t\tconst found = items.find((recentItem) => {\n\t\t\t\treturn recentItem.id === dialogId.toString();\n\t\t\t});\n\t\t\tif (found)\n\t\t\t{\n\t\t\t\tfilledRecentItems.push(found);\n\t\t\t}\n\t\t});\n\n\t\treturn filledRecentItems;\n\t}\n}\n","import { Core } from 'im.v2.application.core';\n\nimport { ChatType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { LocalSearch, type SearchResultItem } from 'im.v2.lib.search';\n\nimport { BaseServerSearch } from './search-service/base-server-search';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { ImModelUser, ImModelChat } from 'im.v2.model';\n\nexport class SearchService\n{\n\t#store: Store;\n\t#localSearch: LocalSearch;\n\t#baseServerSearch: BaseServerSearch;\n\t#localCollection: Map<string, Date> = new Map();\n\n\tconstructor(searchConfig)\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#localSearch = new LocalSearch(searchConfig);\n\t\tthis.#baseServerSearch = new BaseServerSearch(searchConfig);\n\t}\n\n\tloadLatestResults(): Promise<SearchResultItem[]>\n\t{\n\t\treturn this.#baseServerSearch.loadLatestResults();\n\t}\n\n\tsearchLocal(query: string): SearchResultItem[]\n\t{\n\t\tconst localCollection = [...this.#localCollection.values()];\n\n\t\treturn this.#localSearch.search(query, localCollection);\n\t}\n\n\tasync search(query: string): Promise<SearchResultItem[]>\n\t{\n\t\tconst searchResult = await this.#baseServerSearch.search(query);\n\n\t\tsearchResult.forEach((searchItem) => {\n\t\t\tthis.#localCollection.set(searchItem.dialogId, searchItem);\n\t\t});\n\n\t\treturn searchResult;\n\t}\n\n\tsaveItemToRecentSearch(dialogId: string): Promise\n\t{\n\t\treturn this.#baseServerSearch.addItemsToRecentSearchResults(dialogId);\n\t}\n\n\tclearSessionResult()\n\t{\n\t\tthis.#localCollection.clear();\n\t}\n\n\tsortByDate(items: SearchResultItem[]): SearchResultItem[]\n\t{\n\t\titems.sort((firstItem, secondItem) => {\n\t\t\tif (!firstItem.dateMessage || !secondItem.dateMessage)\n\t\t\t{\n\t\t\t\tif (!firstItem.dateMessage && !secondItem.dateMessage)\n\t\t\t\t{\n\t\t\t\t\tif (this.#isExtranet(firstItem.dialogId))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.#isExtranet(secondItem.dialogId))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\treturn firstItem.dateMessage ? -1 : 1;\n\t\t\t}\n\n\t\t\treturn Utils.date.cast(secondItem.dateMessage) - Utils.date.cast(firstItem.dateMessage);\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#isExtranet(dialogId: string): boolean\n\t{\n\t\tconst dialog: ImModelChat = this.#store.getters['chats/get'](dialogId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (dialog.type === ChatType.user)\n\t\t{\n\t\t\tconst user: ImModelUser = this.#store.getters['users/get'](dialogId);\n\n\t\t\treturn user && user.extranet;\n\t\t}\n\n\t\treturn dialog.extranet;\n\t}\n}\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { Utils } from 'im.v2.lib.utils';\nimport { BaseMenu } from 'im.v2.lib.menu';\nimport { CallManager } from 'im.v2.lib.call';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { ChatActionType, EventType, SidebarDetailBlock } from 'im.v2.const';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\nimport type { ImModelUser } from 'im.v2.model';\n\nexport class SearchContextMenu extends BaseMenu\n{\n\tcallManager: CallManager;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-chat-search-context-menu';\n\t\tthis.callManager = CallManager.getInstance();\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenItem(),\n\t\t\tthis.getCallItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getChatsWithUserItem(),\n\t\t];\n\t}\n\n\tgetOpenItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCallItem(): ?MenuItem\n\t{\n\t\tconst chatCanBeCalled = this.callManager.chatCanBeCalled(this.context.dialogId);\n\t\tconst chatIsAllowedToCall = this.permissionManager.canPerformAction(ChatActionType.call, this.context.dialogId);\n\t\tif (!chatCanBeCalled || !chatIsAllowedToCall)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_CALL_2'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.callManager.startCall(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenProfileItem(): ?MenuItem\n\t{\n\t\tif (!this.isUser() || this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_PROFILE'),\n\t\t\thref: profileUri,\n\t\t\tonclick: () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetChatsWithUserItem(): ?MenuItem\n\t{\n\t\tif (!this.isUser() || this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isAnyChatOpened = this.store.getters['application/getLayout'].entityId.length > 0;\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_FIND_CHATS_WITH_USER'),\n\t\t\tonclick: async () => {\n\t\t\t\tif (!isAnyChatOpened)\n\t\t\t\t{\n\t\t\t\t\tawait Messenger.openChat(this.context.dialogId);\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\t\tpanel: SidebarDetailBlock.chatsWithUser,\n\t\t\t\t\tstandalone: true,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tisUser(): boolean\n\t{\n\t\treturn this.store.getters['chats/isUser'](this.context.dialogId);\n\t}\n\n\tisBot(): boolean\n\t{\n\t\tif (!this.isUser())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst user: ImModelUser = this.store.getters['users/get'](this.context.dialogId);\n\n\t\treturn user.bot === true;\n\t}\n}\n","import { Text } from 'main.core';\n\nimport { ChatType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { Avatar, AvatarSize, ChatTitleWithHighlighting } from 'im.v2.component.elements';\n\nimport '../css/search-item.css';\n\nimport type { ImModelChat, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const SearchItem = {\n\tname: 'SearchItem',\n\tcomponents: { Avatar, ChatTitleWithHighlighting },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdateMessage: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\twithDate: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tselected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['clickItem', 'openContextMenu'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tposition(): string\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.user.workPosition;\n\t\t},\n\t\tuserItemText(): string\n\t\t{\n\t\t\tif (!this.position)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_SEARCH_ITEM_USER_TYPE_GROUP_V2');\n\t\t\t}\n\n\t\t\treturn highlightText(Text.encode(this.position), this.query);\n\t\t},\n\t\tchatItemText(): string\n\t\t{\n\t\t\treturn this.loc('IM_SEARCH_ITEM_CHAT_TYPE_GROUP_V2');\n\t\t},\n\t\titemText(): string\n\t\t{\n\t\t\treturn this.isUser ? this.userItemText : this.chatItemText;\n\t\t},\n\t\titemTextForTitle(): string\n\t\t{\n\t\t\treturn this.isUser ? this.position : this.chatItemText;\n\t\t},\n\t\tformattedDate(): ?string\n\t\t{\n\t\t\tif (!this.dateMessage)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst date = Utils.date.cast(this.dateMessage);\n\n\t\t\treturn this.formatDate(date);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('openContextMenu', { dialogId: this.dialogId, nativeEvent: event });\n\t\t},\n\t\tformatDate(date: Date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\" \n\t\t\tclass=\"bx-im-search-item__container bx-im-search-item__scope\"\n\t\t\t:class=\"{'--selected': selected}\"\n\t\t>\n\t\t\t<div class=\"bx-im-search-item__avatar-container\">\n\t\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-item__content-container\">\n\t\t\t\t<div class=\"bx-im-search-item__content_header\">\n\t\t\t\t\t<ChatTitleWithHighlighting :dialogId=\"dialogId\" :textToHighlight=\"query\" />\n\t\t\t\t\t<div v-if=\"withDate && formattedDate\" class=\"bx-im-search-item__date\">\n\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-search-item__item-text\" :title=\"itemTextForTitle\" v-html=\"itemText\"></div>\n\t\t\t</div>\n\t\t\t<div v-if=\"selected\" class=\"bx-im-chat-search-item__selected\"></div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\n\nimport { SearchContextMenu } from '../classes/search-context-menu';\n\nimport '../css/my-notes.css';\n\n// @vue/component\nexport const MyNotes = {\n\tname: 'MyNotes',\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tdialogId(): number\n\t\t{\n\t\t\treturn Core.getUserId().toString();\n\t\t},\n\t\tname(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_MY_NOTES');\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-search-my-notes__container bx-im-search-my-notes__scope\"\n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent\n\t\t>\n\t\t\t<div class=\"bx-im-search-my-notes__avatar\"></div>\n\t\t\t<div class=\"bx-im-search-my-notes__title\" :title=\"name\">\n\t\t\t\t{{ name }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Avatar, AvatarSize } from 'im.v2.component.elements';\n\nimport { SearchContextMenu } from '../classes/search-context-menu';\n\nimport '../css/carousel-user.css';\n\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const CarouselUser = {\n\tname: 'CarouselUser',\n\tcomponents: { Avatar },\n\tprops: {\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tselected: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['clickItem', 'openContextMenu'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tdialogId(): number\n\t\t{\n\t\t\treturn this.userId.toString();\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tname(): string\n\t\t{\n\t\t\treturn this.user.firstName ?? this.user.name;\n\t\t},\n\t\tisExtranet(): boolean\n\t\t{\n\t\t\treturn this.user.extranet;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('openContextMenu', { dialogId: this.dialogId, nativeEvent: event });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-carousel-user__container bx-im-carousel-user__scope\"\n\t\t\t:class=\"{'--extranet': isExtranet, '--selected': selected}\"\n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\"\n\t\t>\n\t\t\t<div v-if=\"selected\" class=\"bx-im-carousel-user__selected-mark\"></div>\n\t\t\t<Avatar :dialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t<div class=\"bx-im-carousel-user__title\" :title=\"name\">\n\t\t\t\t{{ name }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\n\nimport { MyNotes } from './my-notes';\nimport { CarouselUser } from './carousel-user';\n\nimport '../css/recent-users-carousel.css';\n\nimport type { ImModelUser, ImModelRecentItem } from 'im.v2.model';\n\nconst SHOW_USERS_LIMIT = 6;\n\n// @vue/component\nexport const RecentUsersCarousel = {\n\tname: 'RecentUsersCarousel',\n\tcomponents: { CarouselUser, MyNotes },\n\tprops: {\n\t\tselectMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tshowMyNotes: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tselectedItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t},\n\temits: ['clickItem', 'openContextMenu'],\n\tcomputed:\n\t{\n\t\tusers(): number[]\n\t\t{\n\t\t\tconst recentUsers = [];\n\n\t\t\tthis.$store.getters['recent/getSortedCollection'].forEach((recentItem: ImModelRecentItem) => {\n\t\t\t\tif (this.isChat(recentItem.dialogId))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst user: ImModelUser = this.$store.getters['users/get'](recentItem.dialogId, true);\n\t\t\t\tif (user.bot || user.id === Core.getUserId())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trecentUsers.push(user);\n\t\t\t});\n\n\t\t\treturn recentUsers.map((user: ImModelUser) => user.id);\n\t\t},\n\t\titems(): number[]\n\t\t{\n\t\t\tconst limit = this.showMyNotes ? SHOW_USERS_LIMIT - 1 : SHOW_USERS_LIMIT;\n\n\t\t\treturn this.users.slice(0, limit);\n\t\t},\n\n\t\tcurrentUserId(): number\n\t\t{\n\t\t\treturn Core.getUserId();\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tisChat(dialogId: string): boolean\n\t\t{\n\t\t\treturn dialogId.startsWith('chat');\n\t\t},\n\t\tisSelected(userId: number): boolean\n\t\t{\n\t\t\tconst dialogId = userId.toString();\n\n\t\t\treturn this.selectedItems.includes(dialogId);\n\t\t},\n\t\tloc(key: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(key);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-recent-users-carousel__container bx-im-recent-users-carousel__scope\">\n\t\t\t<div class=\"bx-im-recent-users-carousel__title-container\">\n\t\t\t\t<span class=\"bx-im-recent-users-carousel__section-title\">\n\t\t\t\t\t{{ loc('IM_SEARCH_SECTION_RECENT_CHATS') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-recent-users-carousel__users-container\">\n\t\t\t\t<MyNotes\n\t\t\t\t\tv-if=\"showMyNotes\"\n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\" \n\t\t\t\t/>\n\t\t\t\t<CarouselUser\n\t\t\t\t\tv-for=\"userId in items\"\n\t\t\t\t\t:key=\"userId\"\n\t\t\t\t\t:userId=\"userId\"\n\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t:selected=\"isSelected(userId)\"\n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t\t@openContextMenu=\"$emit('openContextMenu', $event)\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loader } from 'im.v2.component.elements';\n\nimport { SearchItem } from './search-item';\nimport { RecentUsersCarousel } from './recent-users-carousel';\n\nimport '../css/latest-search-result.css';\n\n// @vue/component\nexport const LatestSearchResult = {\n\tname: 'LatestSearchResult',\n\tcomponents: { RecentUsersCarousel, SearchItem, Loader },\n\tprops: {\n\t\titems: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tselectMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tselectedItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tshowMyNotes: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['clickItem', 'openContextMenu'],\n\tcomputed:\n\t{\n\t\tsearchItems(): {dialogId: string, dateMessage: string}[]\n\t\t{\n\t\t\treturn this.items;\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_SECTION_RECENT');\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tisSelected(dialogId: string): boolean\n\t\t{\n\t\t\treturn this.selectedItems.includes(dialogId.toString());\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-latest-search-result__scope\">\n\t\t\t<RecentUsersCarousel\n\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t:selectedItems=\"selectedItems\"\n\t\t\t\t:showMyNotes=\"showMyNotes\"\n\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t@openContextMenu=\"$emit('openContextMenu', $event)\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-latest-search-result__title\">{{ title }}</div>\n\t\t\t<SearchItem\n\t\t\t\tv-for=\"item in searchItems\"\n\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t:dialogId=\"item.dialogId\"\n\t\t\t\t:selected=\"isSelected(item.dialogId)\"\n\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t@openContextMenu=\"$emit('openContextMenu', $event)\"\n\t\t\t/>\n\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-latest-search-result__loader\" />\n\t\t</div>\n\t`,\n};\n","import '../css/empty-state.css';\n\n// @vue/component\nexport const EmptyState = {\n\tname: 'EmptyState',\n\tcomputed:\n\t{\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_RESULT_NOT_FOUND');\n\t\t},\n\t\tsubTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_RESULT_NOT_FOUND_DESCRIPTION');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-empty-state__container bx-im-search-empty-state__scope\">\n\t\t\t<div class=\"bx-im-search-empty-state__icon\"></div>\n\t\t\t<div class=\"bx-im-search-empty-state__title\">\n\t\t\t\t{{ title }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-empty-state__subtitle\">\n\t\t\t\t{{ subTitle }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loader } from 'im.v2.component.elements';\n\nimport { EmptyState } from './empty-state';\nimport { SearchItem } from './search-item';\n\n// @vue/component\nexport const SearchResult = {\n\tname: 'SearchResult',\n\tcomponents: { SearchItem, EmptyState, Loader },\n\tprops:\n\t{\n\t\titems: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tselectMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tselectedItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tshowMyNotes: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['clickItem', 'openContextMenu'],\n\tcomputed:\n\t{\n\t\tsearchResult(): {dialogId: string, dateMessage: ''}[]\n\t\t{\n\t\t\treturn this.items;\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.items.length === 0;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tisSelected(item: {dialogId: string, dateMessage: ''}): boolean\n\t\t{\n\t\t\treturn this.selectedItems.includes(item.dialogId);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-result__scope\">\n\t\t\t<SearchItem\n\t\t\t\tv-for=\"item in items\"\n\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t:dialogId=\"item.dialogId\"\n\t\t\t\t:dateMessage=\"item.dateMessage\"\n\t\t\t\t:withDate=\"true\"\n\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t:isSelected=\"isSelected(item)\"\n\t\t\t\t:query=\"query\"\n\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t@openContextMenu=\"$emit('openContextMenu', $event)\"\n\t\t\t/>\n\t\t\t<EmptyState v-if=\"isEmptyState\" />\n\t\t</div>\n\t`,\n};\n","import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport { Runtime, Extension } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { EventType } from 'im.v2.const';\nimport { ScrollWithGradient } from 'im.v2.component.elements';\n\nimport { SearchService } from './classes/search-service';\nimport { SearchContextMenu } from './classes/search-context-menu';\nimport { LatestSearchResult } from './components/latest-search-result';\nimport { SearchResult } from './components/search-result';\n\nimport './css/chat-search.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { SearchResultItem } from 'im.v2.lib.search';\n\n// @vue/component\nexport const ChatSearch = {\n\tname: 'ChatSearch',\n\tcomponents: {\n\t\tScrollWithGradient,\n\t\tLatestSearchResult,\n\t\tSearchResult,\n\t},\n\tprops: {\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsearchMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tselectMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tsaveSearchHistory: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tshowMyNotes: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tselectedItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tsearchConfig: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['clickItem', 'loading', 'scroll'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisRecentLoading: false,\n\t\t\tisServerLoading: false,\n\n\t\t\tqueryWasDeleted: false,\n\t\t\tcurrentServerQueries: 0,\n\t\t\tresult: {\n\t\t\t\trecent: [],\n\t\t\t\tusersAndChats: [],\n\t\t\t},\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcleanQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tshowLatestSearchResult(): boolean\n\t\t{\n\t\t\treturn this.cleanQuery.length === 0;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tcleanQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery.length > 0)\n\t\t\t{\n\t\t\t\tthis.queryWasDeleted = false;\n\t\t\t}\n\n\t\t\tif (newQuery.length === 0)\n\t\t\t{\n\t\t\t\tthis.searchService.clearSessionResult();\n\t\t\t}\n\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.startSearch(newQuery);\n\t\t},\n\t\tisServerLoading(newValue: boolean)\n\t\t{\n\t\t\tthis.$emit('loading', newValue);\n\t\t},\n\t\tsearchMode(newValue: boolean, oldValue: boolean)\n\t\t{\n\t\t\tif (!newValue && oldValue)\n\t\t\t{\n\t\t\t\tthis.searchService.clearSessionResult();\n\t\t\t\tvoid this.loadRecentSearchFromServer();\n\t\t\t}\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.contextMenuManager = new SearchContextMenu();\n\n\t\tthis.searchService = new SearchService(this.searchConfig);\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 400, this);\n\n\t\tEventEmitter.subscribe(EventType.dialog.errors.accessDenied, this.onDelete);\n\t\tEventEmitter.subscribe(EventType.search.keyPressed, this.onKeyPressed);\n\n\t\tvoid this.loadRecentSearchFromServer();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t\tEventEmitter.unsubscribe(EventType.dialog.errors.accessDenied, this.onDelete);\n\t\tEventEmitter.unsubscribe(EventType.search.keyPressed, this.onKeyPressed);\n\t},\n\tmethods:\n\t{\n\t\tasync loadRecentSearchFromServer()\n\t\t{\n\t\t\tthis.isRecentLoading = true;\n\t\t\tthis.result.recent = await this.searchService.loadLatestResults();\n\t\t\tthis.isRecentLoading = false;\n\t\t},\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.search.chat-search');\n\t\t\tconst defaultMinTokenSize = 3;\n\t\t\tthis.minTokenSize = settings.get('minTokenSize', defaultMinTokenSize);\n\t\t},\n\t\tstartSearch(query: string)\n\t\t{\n\t\t\tif (query.length > 0)\n\t\t\t{\n\t\t\t\tconst result = this.searchService.searchLocal(query);\n\t\t\t\tif (query !== this.cleanQuery)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.result.usersAndChats = this.searchService.sortByDate(result);\n\t\t\t}\n\n\t\t\tif (query.length >= this.minTokenSize)\n\t\t\t{\n\t\t\t\tthis.isServerLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(query);\n\t\t\t}\n\n\t\t\tif (query.length === 0)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.result.usersAndChats = [];\n\t\t},\n\t\tasync searchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tconst searchResult = await this.searchService.search(query);\n\t\t\tif (query !== this.cleanQuery)\n\t\t\t{\n\t\t\t\tthis.stopLoader();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst mergedItems = this.mergeResults(this.result.usersAndChats, searchResult);\n\t\t\tthis.result.usersAndChats = this.searchService.sortByDate(mergedItems);\n\t\t\tthis.stopLoader();\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tthis.currentServerQueries--;\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isServerLoading = false;\n\t\t},\n\t\tonOpenContextMenu(event)\n\t\t{\n\t\t\tif (this.selectMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { dialogId, nativeEvent } = event;\n\t\t\tif (Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.contextMenuManager.openMenu({ dialogId }, nativeEvent.currentTarget);\n\t\t},\n\t\tonDelete({ data: eventData })\n\t\t{\n\t\t\tconst { dialogId } = eventData;\n\t\t\tthis.result.recent = this.result.recent.filter((recentItem) => {\n\t\t\t\treturn recentItem !== dialogId;\n\t\t\t});\n\t\t\tthis.result.usersAndChats = this.result.usersAndChats.filter((dialogIdFromSearch) => {\n\t\t\t\treturn dialogIdFromSearch !== dialogId;\n\t\t\t});\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tthis.$emit('scroll', event);\n\t\t\tthis.contextMenuManager.destroy();\n\t\t},\n\t\tasync onClickItem(event: {dialogId: string, nativeEvent: KeyboardEvent})\n\t\t{\n\t\t\tif (this.saveSearchHistory)\n\t\t\t{\n\t\t\t\tvoid this.searchService.saveItemToRecentSearch(event.dialogId);\n\t\t\t}\n\n\t\t\tthis.$emit('clickItem', event);\n\t\t},\n\t\tonKeyPressed(event: BaseEvent)\n\t\t{\n\t\t\tif (this.selectMode || !this.searchMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { keyboardEvent } = event.getData();\n\n\t\t\tif (Utils.key.isCombination(keyboardEvent, 'Enter'))\n\t\t\t{\n\t\t\t\tthis.onPressEnterKey(event);\n\t\t\t}\n\n\t\t\tif (Utils.key.isCombination(keyboardEvent, 'Backspace'))\n\t\t\t{\n\t\t\t\tthis.onPressBackspaceKey();\n\t\t\t}\n\t\t},\n\t\tonPressEnterKey(keyboardEvent: KeyboardEvent)\n\t\t{\n\t\t\tconst firstItem: ?SearchResultItem = this.getFirstItemFromSearchResults();\n\t\t\tif (!firstItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.onClickItem({\n\t\t\t\tdialogId: firstItem.dialogId,\n\t\t\t\tnativeEvent: keyboardEvent,\n\t\t\t});\n\t\t},\n\t\tonPressBackspaceKey()\n\t\t{\n\t\t\tif (this.searchQuery.length > 0)\n\t\t\t{\n\t\t\t\tthis.queryWasDeleted = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.queryWasDeleted)\n\t\t\t{\n\t\t\t\tthis.queryWasDeleted = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.queryWasDeleted)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.search.close);\n\t\t\t}\n\t\t},\n\t\tgetFirstItemFromSearchResults(): ?SearchResultItem\n\t\t{\n\t\t\tif (this.showLatestSearchResult && this.result.recent.length > 0)\n\t\t\t{\n\t\t\t\treturn this.result.recent[0];\n\t\t\t}\n\n\t\t\tif (this.result.usersAndChats.length > 0)\n\t\t\t{\n\t\t\t\treturn this.result.usersAndChats[0];\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tmergeResults(originalItems: SearchResultItem[], newItems: SearchResultItem[]): SearchResultItem[]\n\t\t{\n\t\t\tconst mergedItems = [...originalItems, ...newItems].map((item) => {\n\t\t\t\treturn [item.dialogId, item];\n\t\t\t});\n\t\t\tconst result = new Map(mergedItems);\n\n\t\t\treturn [...result.values()];\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ScrollWithGradient :gradientHeight=\"28\" :withShadow=\"false\" @scroll=\"onScroll\"> \n\t\t\t<div class=\"bx-im-chat-search__container bx-im-chat-search__scope\">\n\t\t\t\t<LatestSearchResult\n\t\t\t\t\tv-if=\"showLatestSearchResult\"\n\t\t\t\t\t:items=\"result.recent\"\n\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t:selectedItems=\"selectedItems\"\n\t\t\t\t\t:showMyNotes=\"showMyNotes\"\n\t\t\t\t\t:isLoading=\"isRecentLoading\"\n\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t\t@openContextMenu=\"onOpenContextMenu\"\n\t\t\t\t/>\n\t\t\t\t<SearchResult\n\t\t\t\t\tv-else\n\t\t\t\t\t:items=\"result.usersAndChats\"\n\t\t\t\t\t:selectMode=\"selectMode\"\n\t\t\t\t\t:selectedItems=\"selectedItems\"\n\t\t\t\t\t:isLoading=\"isServerLoading\"\n\t\t\t\t\t:query=\"cleanQuery\"\n\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t\t@openContextMenu=\"onOpenContextMenu\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</ScrollWithGradient> \n\t`,\n};\n"],"names":["SEARCH_REQUEST_ENDPOINT","LOAD_LATEST_RESULTS_ENDPOINT","SAVE_ITEM_ENDPOINT","BaseServerSearch","constructor","searchConfig","StoreUpdater","search","query","items","update","loadLatestResults","response","recentItems","length","itemsFromRecentItems","addItemsToRecentSearchResults","dialogId","id","entityId","EntityId","config","json","getSearchConfig","Ajax","runAction","Logger","warn","data","dialog","error","searchQuery","queryWords","Utils","text","getWordsFromString","map","item","toString","dateMessage","customData","filledRecentItems","forEach","found","find","recentItem","push","SearchService","Map","Core","getStore","LocalSearch","searchLocal","localCollection","values","searchResult","searchItem","set","saveItemToRecentSearch","clearSessionResult","clear","sortByDate","sort","firstItem","secondItem","date","cast","getters","type","ChatType","user","extranet","SearchContextMenu","BaseMenu","callManager","CallManager","getInstance","permissionManager","PermissionManager","getMenuItems","getOpenItem","getCallItem","getOpenProfileItem","getChatsWithUserItem","Loc","getMessage","onclick","Messenger","openChat","context","menuInstance","close","chatCanBeCalled","chatIsAllowedToCall","canPerformAction","ChatActionType","call","startCall","isUser","isBot","profileUri","getProfileLink","href","isAnyChatOpened","store","EventEmitter","emit","EventType","sidebar","open","panel","SidebarDetailBlock","chatsWithUser","standalone","bot","SearchItem","name","components","Avatar","ChatTitleWithHighlighting","props","String","required","default","withDate","Boolean","selected","emits","computed","AvatarSize","$store","isChat","position","workPosition","userItemText","loc","highlightText","Text","encode","chatItemText","itemText","itemTextForTitle","formattedDate","formatDate","methods","onClick","event","$emit","nativeEvent","onRightClick","altKey","shiftKey","DateFormatter","formatByTemplate","DateTemplate","recent","phraseCode","$Bitrix","template","MyNotes","getUserId","created","contextMenuManager","beforeUnmount","destroy","CarouselUser","userId","Number","firstName","isExtranet","SHOW_USERS_LIMIT","RecentUsersCarousel","selectMode","showMyNotes","selectedItems","Array","users","recentUsers","limit","slice","currentUserId","startsWith","isSelected","includes","key","LatestSearchResult","Loader","isLoading","searchItems","title","EmptyState","subTitle","SearchResult","isEmptyState","ChatSearch","ScrollWithGradient","searchMode","saveSearchHistory","Object","isRecentLoading","isServerLoading","queryWasDeleted","currentServerQueries","result","usersAndChats","cleanQuery","trim","toLowerCase","showLatestSearchResult","watch","newQuery","previousQuery","searchService","startSearch","newValue","oldValue","loadRecentSearchFromServer","initSettings","searchOnServerDelayed","Runtime","debounce","searchOnServer","subscribe","errors","accessDenied","onDelete","keyPressed","onKeyPressed","unsubscribe","settings","Extension","getSettings","defaultMinTokenSize","minTokenSize","get","cleanSearchResult","stopLoader","mergedItems","mergeResults","onOpenContextMenu","isAltOrOption","openMenu","currentTarget","eventData","filter","dialogIdFromSearch","onScroll","onClickItem","keyboardEvent","getData","isCombination","onPressEnterKey","onPressBackspaceKey","getFirstItemFromSearchResults","originalItems","newItems"],"mappings":"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"}