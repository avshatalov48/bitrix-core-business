this.BX=this.BX||{};(function(t,e,i,s,n,a,r,l,d,o,c,h){"use strict";const u={name:"UserAvatar",props:{avatarSize:Number,user:{COLLAB_USER:Boolean,SHARING_USER:Boolean,EMAIL_USER:Boolean,AVATAR:String|null,DISPLAY_NAME:String}},methods:{renderAvatar(){new h.AvatarRoundGuest({size:this.avatarSize,userName:this.user.DISPLAY_NAME,userpicPath:this.getAvatar(),baseColor:"#19cc45"}).renderTo(this.$refs.collabAvatar)},getAvatar(){if(this.user.AVATAR&&this.user.AVATAR!=="/bitrix/images/1.gif"){return this.user.AVATAR}return null}},mounted(){if(this.user.COLLAB_USER){this.renderAvatar()}},template:`\n\t\t<div class="calendar-slider-sidebar-user-block-item">\n\t\t\t<div ref="collabAvatar" v-if="user.COLLAB_USER" :style="'width:' + avatarSize + 'px'"></div>\n\t\t\t<div class="ui-icon ui-icon-common-user ui-icon-common-user-sharing" :style="'width:' + avatarSize + 'px'"\n\t\t\t\t v-else-if="user.SHARING_USER">\n\t\t\t\t<i></i>\n\t\t\t</div>\n\t\t\t<div class="ui-icon ui-icon-common-user-mail" :style="'width:' + avatarSize + 'px'"\n\t\t\t\t v-else-if="user.EMAIL_USER">\n\t\t\t\t<i></i>\n\t\t\t</div>\n\t\t\t<span v-else>\n\t\t\t\t<img :src="encodeURI(user.AVATAR)" :width="avatarSize" :height="avatarSize" v-if="user.AVATAR && user.AVATAR !== '/bitrix/images/1.gif'"/>\n\t\t\t\t<div class="ui-icon ui-icon-common-user" :style="'width:' + avatarSize + 'px'" v-else>\n\t\t\t\t\t<i></i>\n\t\t\t\t</div>\n\t\t\t</span>\n\t\t</div>\n\t`};const m={name:"ViewEventSlider",props:["params","reloadPlannerCallback","showUserListPopupCallback"],components:{UserAvatar:u},data(){return{id:this.params.id,eventId:parseInt(this.params.eventId,10),name:this.params.name,description:this.params.description,timezoneHint:this.params.timezoneHint,timezone:this.params.userTimezone,fromToHtml:this.params.fromToHtml,isMeeting:this.params.isMeeting,meetingHost:this.params.meetingHost,meetingHostDisplayName:this.params.meetingHostDisplayName,meetingHostWorkPosition:this.params.meetingHostWorkPosition,avatarSize:this.params.avatarSize,attendees:this.params.attendees,avatarUsers:[],avatarMoreUsers:[],avatarMoreCount:0,userList:{y:[],i:[],q:[],n:[]},curUserStatus:this.params.curUserStatus,meetingCreatorUrl:this.params.meetingCreatorUrl,meetingCreatorDisplayName:this.params.meetingCreatorDisplayName,meetingCreatorCollabUser:this.params.meetingCreatorCollabUser,isRemind:this.params.isRemind,isWebdavEvent:this.params.isWebdavEvent,isCrmEvent:this.params.isCrmEvent,isHighImportance:this.params.isHighImportance,isRrule:this.params.isRrule,rruleDescription:this.params.rruleDescription,detailFilesTemplate:this.params.detailFilesTemplate,accessibility:this.params.accessibility,isIntranetEnabled:this.params.isIntranetEnabled,isPrivate:this.params.isPrivate,location:this.params.location,canEditCalendar:this.params.canEditCalendar,downloadIcsEnabled:this.params.downloadIcsEnabled,canAttendeeEditCalendar:this.params.canAttendeeEditCalendar,canDeleteEvent:this.params.canDeleteEvent,showComments:this.params.showComments,filesView:this.getComponentHTML(this.params.filesView),crmView:this.getComponentHTML(this.params.crmView),entry:new a.Entry({data:this.params.entry,userIndex:this.params.userIndex}),isInvited:false,updateParamsDebounce:r.Runtime.debounce(this.updateParams,500,this),hasPulls:false,backgroundPullEvent:null}},created(){this.isInvited=this.entry.isInvited()},mounted(){if(this.params.eventExists){this.updateUserList();if(this.showComments){this.loadCommentsView()}if(this.isWebdavEvent){this.executeScripts(this.$refs.filesView)}r.Event.bind(document,"visibilitychange",this.handleBackgroundPulls)}r.Event.bind(this.$refs.sliderDetailContent,"mouseup",this.quote);l.EventEmitter.subscribe("AI.Copilot.Menu:open",this.handleCopilotMenuShow)},beforeMount(){if(this.params.eventExists){l.EventEmitter.subscribe("onPullEvent-calendar",this.handlePullEvent);l.EventEmitter.subscribe(`MeetingStatusControl_${this.id}:onSetStatus`,this.handleStatusUpdate)}},beforeUnmount(){if(this.params.eventExists){l.EventEmitter.unsubscribe("onPullEvent-calendar",this.handlePullEvent);l.EventEmitter.unsubscribe(`MeetingStatusControl_${this.id}:onSetStatus`,this.handleStatusUpdate);r.Event.unbind(this.$refs.sliderDetailContent,"mouseup",this.quote);l.EventEmitter.unsubscribe("AI.Copilot.Menu:open",this.handleCopilotMenuShow)}},computed:{authorNodeId(){return this.id+"_detail-author-info"},meetingCreatorClassName(){return`calendar-slider-sidebar-user-info-name${this.meetingCreatorCollabUser?" calendar-collab-user":""}`}},methods:{getComponentHTML(t){if(!t){return""}return JSON.parse(t).data.html},loadCommentsView(){BX.ajax.runAction("calendar.api.calendareventviewform.getCommentsView",{data:{signedEvent:this.params.signedEvent}}).then((t=>{const e=document.createElement("div");e.innerHTML=t.data.html;this.$refs.commentsView.appendChild(e);this.executeScripts(this.$refs.commentsView)}))},executeScripts(t){if(!t){return}const e=t.querySelectorAll("script");for(const t of e){const e=document.createElement("script");e.innerHTML=t.innerHTML;t.parentNode.appendChild(e);t.remove()}},quote(t){window.mplCheckForQuote(t,t.currentTarget,`EVENT_${this.eventId}`,this.authorNodeId)},updateUserList(){var t,e;this.userList={y:[],i:[],q:[],n:[]};if(this.entry.isMeeting()){this.entry.getAttendees().forEach((function(t){if(t.STATUS==="H"){this.userList.y.push(t)}else if(this.userList[t.STATUS.toLowerCase()]){this.userList[t.STATUS.toLowerCase()].push(t)}}),this)}const i=(t=(e=this.attendees.y)==null?void 0:e.filter((t=>{var e;if(!t){return false}if((e=this.entry)!=null&&e.isOpenEvent()){return true}return parseInt(this.meetingHost.ID,10)!==parseInt(t.ID,10)})))!=null?t:[];if(i.length<=11){this.avatarUsers=i.slice(0,11);this.avatarMoreUsers=[]}else{this.avatarUsers=i.slice(0,10);this.avatarMoreUsers=i.slice(10)}this.avatarMoreCount=this.avatarMoreUsers.length;if(this.avatarMoreCount>=1e3){this.avatarMoreCount=`${parseInt(this.avatarMoreUsers.length/1e3,10)}K`}},reloadPlanner(){const t={entryId:this.entry.id||0,entryLocation:this.entry.data.LOCATION||"",ownerId:0,hostId:this.entry.getMeetingHost(),type:"user",entityList:this.entry.getAttendeesEntityList(),dateFrom:n.Util.formatDate(this.entry.from.getTime()-n.Util.getDayLength()*3),dateTo:n.Util.formatDate(this.entry.to.getTime()+n.Util.getDayLength()*10),timezone:this.timezone,location:this.entry.getLocation(),entry:this.entry};this.reloadPlannerCallback(t)},handleBackgroundPulls(){if(this.hasPulls){this.updateParamsDebounce(this.backgroundPullEvent);this.hasPulls=false}},handleStatusUpdate(t){this.entry.data.MEETING_STATUS=t.getData().status;this.curUserStatus=this.entry.data.MEETING_STATUS;this.isInvited=this.entry.isInvited()},handlePullEvent(t){if(t.data[0]==="refresh_sync_status"){return}if(t.data[1].fields.CAL_TYPE==="location"){return}if(BX.Calendar.Util.documentIsDisplayingNow()){this.updateParamsDebounce(t)}else{this.hasPulls=true;this.backgroundPullEvent=t}},updateParams(t){if(parseInt(t.data[1].fields.PARENT_ID,10)!==parseInt(this.params.parentId,10)){this.reloadPlanner();return}const e=t.data[1].fields;this.name=e.NAME;this.accessibility=e.ACCESSIBILITY;BX.ajax.runAction("calendar.api.calendareventviewform.getCalendarViewSliderParams",{data:{entryId:this.eventId,dateFrom:n.Util.formatDate(e.DATE_FROM),timezoneOffset:e.TZ_OFFSET_FROM}}).then((t=>{const e=t.data;this.description=e.description;this.isMeeting=e.isMeeting;this.timezone=e.userTimezone;this.timezoneHint=e.timezoneHint;this.fromToHtml=e.fromToHtml;this.meetingHost=e.meetingHost;this.meetingHostDisplayName=e.meetingHostDisplayName;this.meetingHostWorkPosition=e.meetingHostWorkPosition;this.avatarSize=e.avatarSize;this.attendees=e.attendees;this.meetingCreatorUrl=e.meetingCreatorUrl;this.meetingCreatorDisplayName=e.meetingCreatorDisplayName;this.meetingCreatorCollabUser=e.meetingCreatorCollabUser;this.isRemind=e.isRemind;this.isWebdavEvent=e.isWebdavEvent;this.isCrmEvent=e.isCrmEvent;this.isHighImportance=e.isHighImportance;this.isRrule=e.isRrule;this.rruleDescription=e.rruleDescription;this.detailFilesTemplate=e.detailFilesTemplate;this.isIntranetEnabled=e.isIntranetEnabled;this.isPrivate=e.isPrivate;this.location=e.location;this.canEditCalendar=e.canEditCalendar;this.canAttendeeEditCalendar=e.canAttendeeEditCalendar;this.canDeleteEvent=e.canDeleteEvent;this.showComments=e.showComments;this.filesView=this.getComponentHTML(e.filesView);if(this.filesView){setTimeout((()=>{this.executeScripts(this.$refs.filesView)}),1e3)}this.crmView=this.getComponentHTML(e.crmView);this.entry=new a.Entry({data:e.entry,userIndex:e.userIndex});this.updateUserList();this.reloadPlanner()}))},handleCopilotMenuShow(){const t=[...document.querySelectorAll(".ai__copilot-menu-popup")];const e=t.find((t=>t.offsetHeight>0));const i=e.getBoundingClientRect().bottom-this.$refs.comments.getBoundingClientRect().bottom;const s=parseInt(this.$refs.comments.style.marginBottom,10);if(isNaN(s)&&i>0||!isNaN(s)&&s<i){this.$refs.comments.style.marginBottom=`${i}px`}},highlightChange(t){if(!t){return}const e=t.style.opacity;const i=t.style.transition;t.style.opacity="0.2";setTimeout((()=>{t.style.transition="1s";t.style.opacity=e;setTimeout((()=>{t.style.transition=i}),1e3)}),100)}},watch:{name:{handler(t,e){this.highlightChange(this.$refs.highlightName)}},fromToHtml:{handler(t,e){this.highlightChange(this.$refs.highlightFromTo)}},description:{handler(t,e){this.highlightChange(this.$refs.highlightDescription)}},crmView:{handler(t,e){this.highlightChange(this.$refs.highlightCrmView)}},location:{handler(t,e){this.highlightChange(this.$refs.highlightLocation)}},accessibility:{handler(t,e){this.highlightChange(this.$refs.highlightAccessibility)}}},template:`\n\t\t<div class="ui-alert ui-alert-danger ui-alert-icon-danger ui-alert-text-center" v-if="!params.eventExists">\n\t\t\t<span class="ui-alert-message">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_EVENT_NOT_FOUND')}}</span>\n\t\t</div>\n\t\t<div class="calendar-slider-calendar-wrap" v-else>\n\t\t\t<div class="calendar-slider-header">\n\t\t\t\t<div class="calendar-head-area">\n\t\t\t\t\t<div class="calendar-head-area-inner">\n\t\t\t\t\t\t<div class="calendar-head-area-title">\n\t\t\t\t\t\t\t<span class="calendar-event-invite-counter calendar-event-invite-counter-big" v-if="isInvited">1</span>\n\t\t\t\t\t\t\t<span :id="id + '_title'" class="calendar-head-area-title-name" ref="highlightName">{{name}}</span>\n\t\t\t\t\t\t\t<span :id="id + '_copy_url_btn'" class="calendar-page-link-btn" :title="$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_COPY_LINK')"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="calendar-slider-workarea">\n\t\t\t\t<div class="calendar-slider-sidebar">\n\t\t\t\t\t<div :id="id + '_time_wrap'" class="calendar-slider-sidebar-head" :title="timezoneHint" ref="highlightFromTo">\n\t\t\t\t\t\t<div :id="id + '_time_inner_wrap'" class="calendar-slider-sidebar-head-title">{{fromToHtml}}\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-head-timezone" :title="timezoneHint" v-if="timezoneHint">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-head-timezone-icon"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div :id="id + '_sidebar_inner'" class="calendar-slider-sidebar-inner">\n\t\t\t\t\t\t<div class="calendar-slider-sidebar-videocall" style="display: none;"></div>\n\t\t\t\t\t\t<div class="calendar-slider-sidebar-layout calendar-slider-sidebar-user">\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-layout-top calendar-slider-sidebar-user-top calendar-slider-sidebar-border-bottom">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-left-side">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-name">\n\t\t\t\t\t\t\t\t\t\t<span v-if="isMeeting">{{$Bitrix.Loc.getMessage('EC_VIEW_ATTENDEES_TITLE')}}</span>\n\t\t\t\t\t\t\t\t\t\t<span v-else>{{$Bitrix.Loc.getMessage('EC_VIEW_HOST')}}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-right-side" :id="id + '_add_link'" style="display: none;">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-property calendar-slider-sidebar-link-user">\n\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_ATTENDEES_ADD')}}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-layout-main">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block">\n\t\t\t\t\t\t\t\t<div v-if="isMeeting">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-container-holder">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-container" v-if="!entry.isOpenEvent()">\n\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block-avatar">\n\t\t\t\t\t\t\t\t\t\t\t\t<a :href="meetingHost.URL">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<UserAvatar :user="meetingHost" :avatarSize="avatarSize"/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-icon-top"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-icon-bottom"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass="calendar-slider-sidebar-user-container"\n\t\t\t\t\t\t\t\t\t\t\tv-for="att in avatarUsers"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block-avatar">\n\t\t\t\t\t\t\t\t\t\t\t\t<a :href="att.URL">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<UserAvatar :user="att" :avatarSize="avatarSize"/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-icon-bottom"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tv-if="avatarMoreUsers.length > 0"\n\t\t\t\t\t\t\t\t\t\t\tclass="calendar-slider-sidebar-user-more-container" ref="attendeesMore"\n\t\t\t\t\t\t\t\t\t\t\t@click="showUserListPopupCallback($refs.attendeesMore, avatarMoreUsers)"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-more">\n\t\t\t\t\t\t\t\t\t\t\t\t+{{avatarMoreCount}}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-row calendar-slider-sidebar-border-bottom" v-if="meetingCreatorUrl">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-string-name">{{$Bitrix.Loc.getMessage('EC_VIEW_CREATED_BY')}}:</div>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-string-value">\n\t\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\t\t:href="meetingCreatorUrl"\n\t\t\t\t\t\t\t\t\t\t\t\t:class="meetingCreatorClassName"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{{meetingCreatorDisplayName}}\n\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-container calendar-slider-sidebar-user-card" v-else>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-block-avatar">\n\t\t\t\t\t\t\t\t\t\t<a :href="meetingHost.URL">\n\t\t\t\t\t\t\t\t\t\t\t<UserAvatar :user="meetingHost" :avatarSize="avatarSize"/>\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-icon-bottom"></div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-info">\n\t\t\t\t\t\t\t\t\t\t<a :href="meetingHost.URL" class="calendar-slider-sidebar-user-info-name">{{meetingHostDisplayName}}</a>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-info-status" v-if="meetingHostWorkPosition">{{meetingHostWorkPosition}}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social calendar-slider-sidebar-border-bottom" v-if="isMeeting">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-left">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-item" ref="attendeesY"\n\t\t\t\t\t\t\t\t\t\t @click="showUserListPopupCallback($refs.attendeesY, userList.y)">\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-number">\n\t\t\t\t\t\t\t\t\t\t\t{{attendees.y.length}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-name calendar-slider-sidebar-color-grey-opacity">\n\t\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_STATUS_TITLE_Y')}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-item" ref="attendeesQ"\n\t\t\t\t\t\t\t\t\t\t @click="showUserListPopupCallback($refs.attendeesQ, userList.q)">\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-number">\n\t\t\t\t\t\t\t\t\t\t\t{{attendees.q.length}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-name calendar-slider-sidebar-color-grey-opacity">\n\t\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_STATUS_TITLE_Q')}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-right">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-item" style="visibility: hidden;" ref="attendeesI"\n\t\t\t\t\t\t\t\t\t\t @click="showUserListPopupCallback($refs.attendeesI, userList.i)">\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-number">\n\t\t\t\t\t\t\t\t\t\t\t{{attendees.i.length}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-name calendar-slider-sidebar-color-grey-opacity">\n\t\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_STATUS_TITLE_I')}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-user-social-item" ref="attendeesN"\n\t\t\t\t\t\t\t\t\t\t @click="showUserListPopupCallback($refs.attendeesN, userList.n)">\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-number">\n\t\t\t\t\t\t\t\t\t\t\t{{attendees.n.length}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-user-social-name calendar-slider-sidebar-color-grey-opacity">\n\t\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_STATUS_TITLE_N')}}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="calendar-slider-sidebar-layout-main calendar-slider-sidebar-border-bottom calendar-slider-sidebar-remind" v-if="isRemind">\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-row">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-string-name">{{$Bitrix.Loc.getMessage('EC_VIEW_REMINDERS')}}:</div>\n\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-remind-link calendar-slider-sidebar-string-value" :id="id + '_add_reminder_link'" style="display: none;">\n\t\t\t\t\t\t\t\t\t<span class="calendar-slider-sidebar-remind-link-name">{{$Bitrix.Loc.getMessage('EC_VIEW_REMINDER_ADD')}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-remind-wrap"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="calendar-slider-sidebar-row calendar-slider-sidebar-border-bottom" v-if="isRrule">\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-string-name">{{$Bitrix.Loc.getMessage('EC_T_REPEAT')}}:</div>\n\t\t\t\t\t\t\t<div class="calendar-slider-sidebar-string-value">{{rruleDescription}}</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="calendar-slider-sidebar-copy" style="display: none;">\n\t\t\t\t\t\t<span class="calendar-slider-sidebar-copy-link">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_COPY_LINK')}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="calendar-slider-content">\n\t\t\t\t\t<div class="calendar-slider-detail calendar-slider-detail-panel">\n\t\t\t\t\t\t<div class="calendar-slider-detail-info">\n\t\t\t\t\t\t\t<div class="calendar-slider-detail-header">\n\t\t\t\t\t\t\t\t<div id="calendar-slider-detail-important-button" class="calendar-slider-info-panel-important mutable" v-if="isHighImportance">\n\t\t\t\t\t\t\t\t\t<span class="if-not-no">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_IMPORTANT_EVENT')}}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-subtitle-status" style="visibility: hidden">\n\t\t\t\t\t\t\t\t\t#calendar-slider-detail-subtitle-status#\n\t\t\t\t\t\t\t\t\t<span class="calendar-slider-detail-status-below-name"></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="calendar-slider-detail-content" ref="sliderDetailContent">\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass="calendar-detail-author-info"\n\t\t\t\t\t\t\t\t\t:id="authorNodeId"\n\t\t\t\t\t\t\t\t\t:bx-post-author-id="meetingHost.ID"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{meetingCreatorDisplayName ?? meetingHostDisplayName}}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div id="calendar-slider-detail-description" class="calendar-slider-detail-description" v-if="description"\n\t\t\t\t\t\t\t\t\t ref="highlightDescription" v-html="description">\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-files" :id="id + '_' + eventId + '_files_wrap'" v-if="isWebdavEvent">\n\t\t\t\t\t\t\t\t\t<div v-html="filesView" ref="filesView"></div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-timeline hidden" :id="id + '_view_planner_wrap'">\n\t\t\t\t\t\t\t\t\t<div class="calendar-view-planner-wrap"></div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-relation" :id="id + '_view_relation_wrap'"/>\n\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-block" v-if="isCrmEvent" ref="highlightCrmView">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-name">{{$Bitrix.Loc.getMessage('EC_CRM_TITLE')}}:</div>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-value calendar-slider-detail-option-crm">\n\t\t\t\t\t\t\t\t\t\t\t<div v-html="crmView"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-block" v-if="accessibility && isIntranetEnabled" ref="highlightAccessibility">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-name">{{$Bitrix.Loc.getMessage('EC_ACCESSIBILITY_TITLE')}}:</div>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-value">{{$Bitrix.Loc.getMessage('EC_ACCESSIBILITY_' + accessibility.toUpperCase())}}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-block" v-if="isPrivate && isIntranetEnabled">\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-name">{{$Bitrix.Loc.getMessage('EC_EDDIV_SPECIAL_NOTES')}}:</div>\n\t\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-option-value">{{$Bitrix.Loc.getMessage('EC_PRIVATE_EVENT')}}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-place" v-if="location" ref="highlightLocation">\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-place-title">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_LOCATION')}}</div>\n\t\t\t\t\t\t\t\t\t<div class="calendar-slider-detail-place-name">{{location}}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="calendar-slider-detail-buttons">\n\t\t\t\t\t\t\t\t<div class="calendar-slider-view-buttonset calendar-slider-view-button-more-right">\n\t\t\t\t\t\t\t\t\t<div :id="id + '_buttonset'" class="calendar-slider-view-buttonset-inner">\n\t\t\t\t\t\t\t\t\t\t<input type="hidden" :id="id + '_current_status'" :value="curUserStatus"/>\n\t\t\t\t\t\t\t\t\t\t<span :id="id + '_status_buttonset'"></span>\n\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<button v-show="canEditCalendar || (canAttendeeEditCalendar && ['H', 'Y'].includes(curUserStatus))" :id="id + '_but_edit'" class="ui-btn ui-btn-light-border">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_EDIT')}}</button>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tv-show="downloadIcsEnabled"\n\t\t\t\t\t\t\t\t\t\t\t\t:id="id + '_but_download'"\n\t\t\t\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-light-border"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_DOWNLOAD')}}\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t<button v-if="canDeleteEvent" :id="id + '_but_del'" class="ui-btn ui-btn-light-border">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_DEL')}}</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="calendar-slider-comments" v-if="showComments" ref="comments">\n\t\t\t\t\t\t\t<div class="calendar-slider-comments-title">{{$Bitrix.Loc.getMessage('EC_VIEW_SLIDER_COMMENTS')}}</div>\n\t\t\t\t\t\t\t<div class="calendar-slider-comments-main" :id="id + 'comments-cont'" style="opacity: 1;">\n\t\t\t\t\t\t\t\t<div ref="commentsView"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};let p=t=>t,v,g;class b{constructor(t={}){this.permissions={};this.name="eventviewform";this.uid=null;this.DOM={};this.RELOAD_REQUESTED="RELOAD_REQUESTED";this.RELOAD_FINISHED="RELOAD_FINISHED";this.reloadStatus=null;this.entityChanged=false;this.LOAD_DELAY=500;this.app=null;this.type=t.type||"user";this.attendees=[];this.ownerId=t.ownerId||0;this.userId=t.userId||0;this.zIndex=3100;this.entryId=t.entryId||null;this.calendarContext=t.calendarContext||null;this.entryDateFrom=t.entryDateFrom||null;this.timezoneOffset=t.timezoneOffset||null;this.BX=n.Util.getBX();this.sliderOnLoad=this.onLoadSlider.bind(this);this.showUserListPopupBind=this.showUserListPopup.bind(this);this.keyHandlerBind=this.keyHandler.bind(this);this.destroyBind=this.destroy.bind(this);this.loadPlannerDataDebounce=r.Runtime.debounce(this.loadPlannerData,this.LOAD_DELAY,this);this.pullEventList=new Set}initInSlider(t,e){this.slider=t;l.EventEmitter.subscribe(t,"SidePanel.Slider:onLoad",this.sliderOnLoad);l.EventEmitter.subscribe(t,"SidePanel.Slider:onCloseComplete",this.destroyBind);r.Event.bind(document,"keydown",this.keyHandlerBind);this.createContent(t).then((t=>{if(r.Type.isFunction(e)){e(t)}}));this.opened=true}isOpened(){return this.opened}destroy(){l.EventEmitter.unsubscribe(this.slider,"SidePanel.Slider:onLoad",this.sliderOnLoad);l.EventEmitter.unsubscribe(this.slider,"SidePanel.Slider:onCloseComplete",this.destroyBind);r.Event.unbind(document,"keydown",this.keyHandlerBind);if(this.app){this.app.unmount()}if(this.intranetControllButton&&this.intranetControllButton.destroy){this.intranetControllButton.destroy()}n.Util.closeAllPopups();this.opened=false}onLoadSlider(t){var e;if(!t instanceof l.BaseEvent){return}const i=t.getData();const s=(e=i[0])==null?void 0:e.slider;this.DOM.content=s.layout.content;this.BX.html(s.layout.content,s.getData().get("sliderContent"));if(!r.Type.isNull(this.uid)){this.initControls(this.uid)}this.reloadStatus=this.RELOAD_FINISHED}loadComponentAssets(t){if(!t){return}let e=JSON.parse(t).data.assets;let i=new Promise((function(t,i){let s=e.css;BX.load(s,(function(){BX.loadScript(e.js,t)}))}));i.then((function(){let t=e.string;let i=t.join("\n");BX.html(document.head,i,{useAdjacentHTML:true})}))}createContent(t){return new Promise((e=>{this.BX.ajax.runAction("calendar.api.calendareventviewform.getCalendarViewSliderParams",{data:{entryId:this.entryId,dateFrom:n.Util.formatDate(this.entryDateFrom),timezoneOffset:this.timezoneOffset},analytics:{tool:"im",category:"events",event:"view_card",c_section:"card_full",p5:`eventId_${this.entryId}`}}).then((i=>{const n=document.createElement("div");if(r.Type.isFunction(t.isOpen)&&t.isOpen()||t.isOpen===true){let e=i.data;e.eventExists=Boolean(e.entry.ID);this.attendees=[];for(const t in e.attendees){this.attendees.push(...e.attendees[t])}if(e.filesView){this.loadComponentAssets(e.filesView)}if(e.crmView){this.loadComponentAssets(e.crmView);this.BX.ajax.runAction("calendar.api.calendareventviewform.getCrmView",{data:{signedEvent:e.signedEvent}})}this.app=s.BitrixVue.createApp(m,{params:e,reloadPlannerCallback:this.loadPlannerDataDebounce,showUserListPopupCallback:this.showUserListPopupBind});this.app.mount(n);t.sliderContent=n;this.userId=e.userId;this.uid=e.id;this.entryUrl=e.entryUrl;this.userTimezone=e.userTimezone;this.plannerFeatureEnabled=Boolean(e.plannerFeatureEnabled);if(this.planner&&!this.plannerFeatureEnabled){this.planner.lock()}this.handleEntryData(e.entry,e.userIndex,e.section);this.isCollabUser=e.isCollabUser;this.downloadIcsEnabled=e.downloadIcsEnabled}e(n)}),(i=>{if(i.errors&&i.errors.length>0){t.getData().set("sliderContent",'<div class="calendar-slider-alert">'+'<div class="calendar-slider-alert-inner">'+'<div class="calendar-slider-alert-img"></div>'+'<h1 class="calendar-slider-alert-text">'+r.Text.encode(i.errors[0].message)+"</h1>"+"</div>"+"</div>")}if(i.data&&!r.Type.isNil(i.data.isAvailable)&&!i.data.isAvailable){const t=()=>{top.BX.UI.InfoHelper.show("limit_office_calendar_off",{isLimit:true,limitAnalyticsLabels:{module:"calendar",source:"eventViewForm"}})};if(this.slider){this.slider.close(true,t)}else{t()}}this.displayError(i.errors);e(i)}))}))}initControls(t){var i,s,d,o;this.DOM.title=this.DOM.content.querySelector(`#${t}_title`);this.DOM.buttonSet=this.DOM.content.querySelector(`#${t}_buttonset`);this.DOM.editButton=this.DOM.content.querySelector(`#${t}_but_edit`);if(this.downloadIcsEnabled){this.DOM.downloadButton=this.DOM.content.querySelector(`#${t}_but_download`)}this.DOM.delButton=this.DOM.content.querySelector(`#${t}_but_del`);this.DOM.sidebarInner=this.DOM.content.querySelector(`#${t}_sidebar_inner`);if(this.DOM.buttonSet){this.initPlannerControl(t)}const h=this.DOM.content.querySelector(`#${t}_time_inner_wrap`);if(r.Type.isElementNode(h)&&h.offsetHeight>50){r.Dom.addClass(this.DOM.content.querySelector(`#${t}_time_wrap`),"calendar-slider-sidebar-head-long-time")}if(this.canDo(this.entry,"edit")&&this.DOM.editButton){r.Event.bind(this.DOM.editButton,"click",(()=>{this.BX.SidePanel.Instance.close(false,function(){a.EntryManager.openEditSlider({entry:this.entry,type:this.type,ownerId:this.ownerId,userId:this.userId})}.bind(this))}))}else{this.BX.remove(this.DOM.editButton)}if(this.DOM.sidebarInner){this.DOM.reminderWrap=this.DOM.sidebarInner.querySelector(".calendar-slider-sidebar-remind-wrap");if(r.Type.isDomNode(this.DOM.reminderWrap)){r.Dom.clean(this.DOM.reminderWrap);let t=!this.canDo(this.entry,"edit")&&this.entry.getCurrentStatus()===false;this.reminderControl=new this.BX.Calendar.Controls.Reminder({wrap:this.DOM.reminderWrap,zIndex:this.zIndex,viewMode:t});this.reminderControl.setValue(this.entry.getReminders());if(!t){this.reminderControl.subscribe("onChange",(t=>{if(t instanceof l.BaseEvent){this.handleEntityChanges();this.reminderValues=t.getData().values;this.BX.ajax.runAction("calendar.api.calendarajax.updateReminders",{data:{entryId:this.entry.id,userId:this.userId,reminders:this.reminderValues}})}}))}}let t=this.DOM.sidebarInner.querySelectorAll(".calendar-slider-sidebar-border-bottom");if(t.length>=2){this.BX.removeClass(t[t.length-1],"calendar-slider-sidebar-border-bottom")}}if(this.downloadIcsEnabled){r.Event.bind(this.DOM.downloadButton,"click",(()=>a.EntryManager.downloadIcs(this.entryId)))}if(this.canDo(this.entry,"delete")){r.Event.bind(this.DOM.delButton,"click",(()=>{l.EventEmitter.subscribeOnce("BX.Calendar.Entry:beforeDelete",(()=>{this.BX.SidePanel.Instance.close()}));a.EntryManager.deleteEntry(this.entry,this.calendarContext)}))}else{this.BX.remove(this.DOM.delButton)}const u=t+"_"+this.entry.id+"_files_wrap";if(u){const t=typeof window.top.BX.viewElementBind==="function"?window.top.BX:window.BX;t.viewElementBind(u,{showTitle:true},(function(t){return r.Type.isElementNode(t)&&(t.getAttribute("data-bx-viewer")||t.getAttribute("data-bx-image"))}))}this.DOM.relationWrap=this.DOM.content.querySelector(`#${t}_view_relation_wrap`);if(this.DOM.relationWrap&&((i=this.entry)==null?void 0:(s=i.data)==null?void 0:s.EVENT_TYPE)==="#shared_crm#"){this.relationControl=new c.RelationInterface({parentNode:this.DOM.relationWrap,eventId:this.entry.parentId});r.Dom.append(this.relationControl.render(),this.DOM.relationWrap)}if(this.entry&&this.entry.isMeeting()){this.initAcceptMeetingControl(t)}if(this.DOM.sidebarInner){let t=this.DOM.sidebarInner.querySelectorAll(".calendar-slider-sidebar-border-bottom");if(t.length>=2){this.BX.removeClass(t[t.length-1],"calendar-slider-sidebar-border-bottom")}}this.DOM.copyButton=this.DOM.content.querySelector(`#${t}_copy_url_btn`);if(this.DOM.copyButton){r.Event.bind(this.DOM.copyButton,"click",this.copyEventUrl.bind(this))}this.DOM.videoCall=this.DOM.sidebarInner.querySelector(".calendar-slider-sidebar-videocall");r.Dom.clean(this.DOM.videoCall);if(r.Type.isElementNode(this.DOM.videoCall)&&this.entry&&this.entry.data.PARENT_ID&&(this.entry.data.EVENT_TYPE==="#shared#"||this.entry.data.EVENT_TYPE==="#shared_crm#")){this.DOM.videoCall.style.display="";this.conferenceButton=r.Tag.render(v||(v=p`
				<div class="ui-btn-split ui-btn-icon-camera-blue intranet-control-btn ui-btn-light-border ui-btn-icon-inline" style="width: 100%">
					<button class="ui-btn-main calendar-slider-conference-button">
						${0}
					</button>
				</div>
			`),r.Loc.getMessage("EC_CALENDAR_CONFERENCE"));r.Event.bind(this.conferenceButton,"click",this.handleConferenceButtonClick.bind(this));r.Dom.append(this.conferenceButton,this.DOM.videoCall)}else if((d=BX)!=null&&(o=d.Intranet)!=null&&o.ControlButton&&r.Type.isElementNode(this.DOM.videoCall)&&this.entry.getCurrentStatus()!==false){this.DOM.videoCall.style.display="";const t=this.isCollabUser?["chat","videocall","task"]:["chat","videocall","blog_post","task"];this.intranetControllButton=new e.IntranetButton({intranetControlButtonParams:{items:t,container:this.DOM.videoCall,entityType:"calendar_event",entityId:this.entry.parentId,entityData:{dateFrom:n.Util.formatDate(this.entry.from),parentId:this.entry.parentId},analytics:{startVideoCall:{tool:"im",category:"events",event:"click_call",type:"group",c_section:"card_full",c_sub_section:"context_menu",p5:`eventId_${this.entry.parentId}`}}},callbacks:{getUsersCount:()=>this.attendees.length,hasChat:()=>{var t,e;return((t=this.entry.data)==null?void 0:(e=t.MEETING)==null?void 0:e.CHAT_ID)>0}}})}else{this.DOM.videoCall.style.display="none"}}handleEntryData(t,e,i){this.entry=new a.Entry({data:t,userIndex:e});this.section=new d.CalendarSection(i);if(r.Type.isPlainObject(i)){this.permissions=i.PERM}a.EntryManager.registerEntrySlider(this.entry,this)}initPlannerControl(t){this.plannerId=t+"_view_slider_planner";this.DOM.plannerWrapOuter=this.DOM.content.querySelector(`.calendar-slider-detail-timeline`);this.DOM.plannerWrap=this.DOM.plannerWrapOuter.querySelector(`.calendar-view-planner-wrap`);r.Dom.clean(this.DOM.plannerWrap);this.planner=new i.Planner({wrap:this.DOM.plannerWrap,minWidth:parseInt(this.DOM.plannerWrap.offsetWidth),solidStatus:true,readonly:true,locked:!this.plannerFeatureEnabled,alwaysBlue:true});this.planner.show();this.planner.showLoader();this.planner.setEntriesCount(this.attendees.length);setTimeout((()=>{if(this.DOM.plannerWrapOuter){r.Dom.removeClass(this.DOM.plannerWrapOuter,"hidden")}}),500);const e={entryId:this.entry.id||0,entryLocation:this.entry.data.LOCATION||"",ownerId:this.ownerId,hostId:this.entry.getMeetingHost(),type:this.type,entityList:this.entry.getAttendeesEntityList(),dateFrom:n.Util.formatDate(this.entry.from.getTime()-n.Util.getDayLength()*3),dateTo:n.Util.formatDate(this.entry.to.getTime()+n.Util.getDayLength()*10),timezone:this.userTimezone,location:this.entry.getLocation(),entry:this.entry};this.loadPlannerDataDebounce(e)}showUserListPopup(t,e){if(this.userListPopup){this.userListPopup.close()}if(e&&e.length){this.DOM.userListPopupWrap=this.BX.create("DIV",{props:{className:"calendar-user-list-popup-block"}});e.forEach((function(t){let e=`\n\t\t\t\t\t<div class="ui-icon ui-icon-common-user" style="width: 34px; height: 34px;">\n\t\t\t\t\t\t<i></i>\n\t\t\t\t\t</div>\n\t\t\t\t`;if(t.AVATAR&&t.AVATAR!=="/bitrix/images/1.gif"){e=`<img src="${encodeURI(t.AVATAR)}" width="34" height="34">`}if(t.EMAIL_USER){e=`\n\t\t\t\t\t\t<div class="ui-icon ui-icon ui-icon-common-user-mail" style="width: 34px; height: 34px;">\n\t\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`}if(t.SHARING_USER){e=`\n\t\t\t\t\t\t<div class="ui-icon ui-icon-common-user ui-icon-common-user-sharing" style="width: 34px; height: 34px;">\n\t\t\t\t\t\t\t<i></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`}if(t.COLLAB_USER){const i=t.AVATAR&&t.AVATAR!=="/bitrix/images/1.gif"?t.AVATAR:null;e=new h.AvatarRoundGuest({size:34,userName:t.DISPLAY_NAME,userpicPath:i,baseColor:"#19cc45"}).getContainer()}const i=r.Tag.render(g||(g=p`
					<div class="calendar-slider-sidebar-user-container calendar-slider-sidebar-user-card">
						<div class="calendar-slider-sidebar-user-block-avatar">
							<div class="calendar-slider-sidebar-user-block-item">
								${0}
							</div>
						</div>
						<div class="calendar-slider-sidebar-user-info">
							<a href="${0}" 
								class="calendar-slider-sidebar-user-info-name ${0}"
							>
								${0}
							</a>
						</div>
					</div>
				`),e,t.URL?t.URL:"#",t.COLLAB_USER?"calendar-collab-user":"",r.Text.encode(t.DISPLAY_NAME));this.DOM.userListPopupWrap.append(i)}),this);this.userListPopup=this.BX.PopupWindowManager.create("user-list-popup-"+Math.random(),t,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:t.offsetWidth/2,resizable:false,lightShadow:true,content:this.DOM.userListPopupWrap,className:"calendar-user-list-popup",maxWidth:300,maxHeight:500,zIndex:4e3,angle:{position:"top"}});this.userListPopup.show();this.BX.addCustomEvent(this.userListPopup,"onPopupClose",(()=>{this.userListPopup.destroy()}))}}initAcceptMeetingControl(t){this.DOM.statusButtonset=this.DOM.content.querySelector(`#${t}_status_buttonset`);this.DOM.statusButtonset.style.marginRight="12px";if(this.entry.getCurrentStatus()==="H"||this.entry.getCurrentStatus()===false){r.Dom.remove(this.DOM.statusButtonset)}else{this.statusControl=new e.MeetingStatusControl({wrap:this.DOM.statusButtonset,currentStatus:this.DOM.content.querySelector(`#${t}_current_status`).value||this.entry.getCurrentStatus()});this.statusControl.subscribe("onSetStatus",(e=>{if(e instanceof l.BaseEvent){this.handleEntityChanges();a.EntryManager.setMeetingStatus(this.entry,e.getData().status).then((()=>{this.statusControl.setStatus(this.entry.getCurrentStatus(),false);this.statusControl.updateStatus();l.EventEmitter.emit(`MeetingStatusControl_${t}:onSetStatus`,e)}))}}))}}copyEventUrl(){if(!this.entryUrl||!this.BX.clipboard.copy(window.location.origin+this.entryUrl)){return}this.timeoutIds=this.timeoutIds||[];const t=new this.BX.PopupWindow("calendar_clipboard_copy",this.DOM.copyButton,{content:r.Loc.getMessage("CALENDAR_TIP_TEMPLATE_LINK_COPIED"),darkMode:true,autoHide:true,zIndex:1e3,angle:true,offsetLeft:20,cachable:false});t.show();let e;while(e=this.timeoutIds.pop()){clearTimeout(e)}this.timeoutIds.push(setTimeout((()=>{t.close()}),1500))}displayError(t=[]){}canDo(t,e){if(e==="edit"||e==="delete"){if(t.isResourcebooking()){return false}if(this.entry.permissions){var i;return(i=this.entry.permissions)==null?void 0:i["edit"]}return this.section.canDo("edit")}if(e==="view"){if(this.entry.permissions){var s;return(s=this.entry.permissions)==null?void 0:s["view_full"]}return this.permissions.view_full}return false}plannerIsShown(){return this.DOM.plannerWrap&&r.Dom.hasClass(this.DOM.plannerWrap,"calendar-edit-planner-wrap-shown")}loadPlannerData(t){return new Promise((e=>{this.BX.ajax.runAction("calendar.api.calendarajax.updatePlanner",{data:t}).then((i=>{this.planner.hideLoader();this.planner.update(i.data.entries,i.data.accessibility);this.planner.updateSelector(n.Util.adjustDateForTimezoneOffset(t.entry.from,t.entry.userTimezoneOffsetFrom,t.entry.fullDay),n.Util.adjustDateForTimezoneOffset(t.entry.to,t.entry.userTimezoneOffsetTo,t.entry.fullDay),t.entry.fullDay);e(i)}),(t=>{e(t)}))}))}keyHandler(t){if(t.keyCode===n.Util.getKeyCode("delete")&&this.canDo(this.entry,"delete")){const t=event.target||event.srcElement;const e=r.Type.isElementNode(t)?t.tagName.toLowerCase():null;if(e&&!["input","textarea"].includes(e)){l.EventEmitter.subscribeOnce("BX.Calendar.Entry:beforeDelete",(()=>{this.BX.SidePanel.Instance.close()}));a.EntryManager.deleteEntry(this.entry,this.calendarContext)}}}handleEntityChanges(){this.entityChanged=true}handleConferenceButtonClick(){if(this.conferenceButton){r.Dom.addClass(this.conferenceButton,"ui-btn-wait")}this.getConferenceChatId();if(this.conferenceButton){r.Dom.removeClass(this.conferenceButton,"ui-btn-wait")}}getConferenceChatId(){return this.BX.ajax.runAction("calendar.api.calendarajax.getConferenceChatId",{data:{eventId:this.entry.data.PARENT_ID},analytics:{tool:"im",category:"events",event:"click_call",type:"videoconf",c_section:"card_full",c_sub_section:"card",p5:`eventId_${this.entry.parentId}`}}).then((t=>{if(top.window.BXIM&&t.data&&t.data.chatId){top.BXIM.openMessenger(`chat${parseInt(t.data.chatId,10)}`);return null}alert(r.Loc.getMessage("EC_CONFERENCE_ERROR"));return null}),(t=>{alert(r.Loc.getMessage("EC_CONFERENCE_ERROR"));return null}))}}t.EventViewForm=b})(this.BX.Calendar=this.BX.Calendar||{},BX.Calendar.Controls,BX.Calendar,BX.Vue3,BX.Calendar,BX.Calendar,BX,BX.Event,BX.Calendar,BX,BX.Calendar,BX.UI);
//# sourceMappingURL=eventviewform.bundle.map.js