(function(t){BX.namespace("BX.Sender");if(BX.Sender.TileGrid){return}var i=BX.Sender.Helper;function e(t){this.rows=Object.create(null);this.items=Object.create(null);this.buttons=[];this.container=t.container;this.tpls=t.templates;this.type=t.type;this.mess=t.mess;if(!this.tpls){throw new Error("Templates parameter `templates` is not set.")}this.loadData(t)}e.prototype={events:{itemClick:"item-click",itemButtonClick:"item-button-click"},getRow:function(t){return this.rows[t]?this.rows[t]:null},getItem:function(t){return this.items[t]?this.items[t]:null},draw:function(){var t=document.createDocumentFragment();for(var i in this.rows){t.appendChild(this.rows[i].render())}this.container.classList.add("sender-tpl-"+this.type);this.container.appendChild(t)},getItemInRow:function(){return Math.round(this.container.offsetWidth/320)},addRow:function(t){t=t||{};if(this.getRow(t.id)!==null){return}t.tpl=this.tpls.row;t.manager=this;this.rows[t.id]=new n(t)},addItem:function(t){t=t||{};if(this.getItem(t.id)!==null){return}var i=this.getRow(t.rowId);if(i){if(!t.buttons){t.buttons=this.buttons}t.tpl=this.tpls.item;t.tplButton=this.tpls.button;t.manager=this;var e=new s(t);this.items[t.id]=e;i.addItem(e)}},loadData:function(t){if(t.buttons){this.buttons=t.buttons}t.rows.forEach((function(t){this.addRow(t)}),this);t.items.forEach((function(t){this.addItem(t)}),this)}};function n(t){this.manager=t.manager;this.id=t.id;this.name=t.name;this.items=[];this.tpl=t.tpl;this.showMoreButton=null;this.layout={container:null,items:null,name:null}}n.prototype={addItem:function(t){t.rowId=this.id;this.items.push(t);if(this.layout.container){this.render()}},createLayout:function(){this.layout.container=i.getTemplatedNode(this.tpl,{name:this.name});this.layout.name=i.getNode("row-name",this.layout.container);this.layout.items=i.getNode("row-items",this.layout.container);return this.layout.container},getShowMoreButton:function(){this.showMoreButton=BX.create("div",{attrs:{className:"sender-tpl-item-show-more"},children:[BX.create("div",{attrs:{className:"webform-small-button webform-small-button-transparent"},events:{click:function(){if(this.items[0]?.count>0){return this.loadMore()}return this.showAllItems()}.bind(this)},html:this.manager.mess.showMore})]});return this.showMoreButton},showAllItems:function(t=false){this.layout.container.classList.add("sender-tpl-items-show-all");if(!t){this.showMoreButton.classList.add("sender-tpl-item-show-hide")}},loadMore:function(){if(this.id==="USER"&&this.items[this.items.length-1].data){BX.ajax.runComponentAction("bitrix:sender.template.selector","load",{data:{lastId:this.items[this.items.length-1].data.templateId,templateType:"USER"}}).then((t=>{if(t.data&&t.data.items){var i=0;t.data.items.forEach((t=>{t.manager=this.manager;t.buttons=[];t.tpl=this.manager.tpls.item;t.tplButton=this.manager.tpls.button;i=t.count;this.items.push(new s(t))}));this.layout.container.parentElement.removeChild(this.layout.container);this.layout.container=null;this.manager.container.appendChild(this.render());this.showAllItems(i>=9)}})).catch((t=>{}))}},render:function(){if(this.layout.container===null){this.createLayout()}for(var t=0;t<this.items.length;t++){var i=this.items[t];this.layout.items.appendChild(i.render(t))}if(!this.items[0].count&&this.items.length>this.manager.getItemInRow()*3+1||this.items[0].count>9){this.layout.items.appendChild(this.getShowMoreButton())}return this.layout.container}};function s(t){this.manager=t.manager;this.id=t.id;this.name=t.name||"";this.data=t.data||{};this.rowId=t.rowId;this.description=t.description||"";this.type=t.type||"";this.image=t.image;this.buttons=t.buttons;this.tpl=t.tpl;this.tplButton=t.tplButton;this.hot=t.hot;this.hint=t.hint;this.count=t.count||0;this.layout={container:null,title:null,image:null,description:null,buttons:null}}s.prototype={getItemWidth:function(){return 100/this.getItemLengthInRow()},getItemLengthInRow:function(){return Math.round(this.manager.container.offsetWidth/320)},clipDescription:function(){if(this.hot){return this.description.substr(0,40)+"..."}return this.description.substr(0,55)+"..."},initButton:function(t){var e=i.getTemplatedNode(this.tplButton,t);this.layout.buttons.appendChild(e);BX.bind(e,"click",this.onButtonClick.bind(this,t))},onButtonClick:function(t){BX.onCustomEvent(this.manager,this.manager.events.itemButtonClick,[this,t]);if(t.handler){t.handler.apply(this.manager,[this,t])}},onClick:function(){BX.onCustomEvent(this.manager,this.manager.events.itemClick,[this])},render:function(t){this.layout.container=i.getTemplatedNode(this.tpl,{name:this.name,style:"width: "+this.getItemWidth()+"%","image-style":this.image?"background-image: url("+this.image+"); "+"background-size: cover;":"",desc:this.clipDescription()});this.layout.content=i.getNode("item-content",this.layout.container);this.layout.title=i.getNode("item-title",this.layout.container);this.layout.image=i.getNode("item-image",this.layout.container);this.layout.description=i.getNode("item-desc",this.layout.container);this.hot?this.layout.description.classList.add("sender-tpl-item-description-hot"):null;this.description===""?this.layout.container.classList.add("sender-tpl-content-without-description"):null;if(this.hint){var e=document.createElement("span");e.setAttribute("data-hint",this.hint);e.setAttribute("data-hint-html","");BX.UI.Hint.initNode(e);this.layout.title.appendChild(e)}if(t>this.getItemLengthInRow()*3-1){this.layout.container.classList.add("sender-tpl-item-hidden")}if(this.buttons){this.layout.buttons=i.getNode("item-buttons",this.layout.container);this.buttons.forEach(this.initButton,this)}BX.bind(this.layout.content,"click",this.onClick.bind(this));return this.layout.container}};BX.Sender.TileGrid=e})(window);
//# sourceMappingURL=grid.map.js