{"version":3,"file":"status.bundle.js","sources":["../src/status.js"],"sourcesContent":["/**\n * Bitrix UI\n * Pull connection status Vue component\n *\n * @package bitrix\n * @subpackage pull\n * @copyright 2001-2019 Bitrix\n */\n\nimport \"./status.css\";\nimport {Vue} from \"ui.vue\";\nimport {PullClient} from \"pull.client\";\n\nVue.component('bx-pull-status',\n{\n\t/**\n\t * @emits 'reconnect' {} - work only with props.canReconnect = true\n\t */\n\tprops:\n\t{\n\t\tcanReconnect: { default: false }\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tstatus: PullClient.PullStatus.Online,\n\t\t\tshowed: null\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.isMac = navigator.userAgent.toLowerCase().includes('macintosh');\n\n\t\tthis.setStatusTimeout = null;\n\t\tthis.hideTimeout = null;\n\n\t\tthis.pullUnSubscribe = () => {};\n\n\t\tif (typeof this.$root.$bitrixPullClient !== 'undefined')\n\t\t{\n\t\t\tif (this.$root.$bitrixPullClient)\n\t\t\t{\n\t\t\t\tthis.subscribe(this.$root.$bitrixPullClient);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$root.$on('onBitrixPullClientInited', () => {\n\t\t\t\t\tthis.subscribe(this.$root.$bitrixPullClient);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (typeof BX.PULL !== 'undefined')\n\t\t{\n\t\t\tthis.subscribe(BX.PULL);\n\t\t}\n\n\t\twindow.component = this;\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.pullUnSubscribe();\n\t},\n\tmethods:\n\t{\n\t\tsubscribe(client)\n\t\t{\n\t\t\tthis.pullUnSubscribe = client.subscribe({\n\t\t\t\ttype: PullClient.SubscriptionType.Status,\n\t\t\t\tcallback: event => this.statusChange(event.status)\n\t\t\t});\n\t\t},\n\t\treconnect()\n\t\t{\n\t\t\tif (this.canReconnect)\n\t\t\t{\n\t\t\t\tthis.$emit('reconnect');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlocation.reload();\n\t\t\t}\n\t\t},\n\t\tstatusChange(status)\n\t\t{\n\t\t\tclearTimeout(this.setStatusTimeout);\n\n\t\t\tif (this.status === status)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet validStatus = [\n\t\t\t\tPullClient.PullStatus.Online,\n\t\t\t\tPullClient.PullStatus.Offline,\n\t\t\t\tPullClient.PullStatus.Connecting\n\t\t\t];\n\t\t\tif (validStatus.indexOf(status) < 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet timeout = 500;\n\n\t\t\tif (status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\ttimeout = 5000;\n\t\t\t}\n\t\t\telse if (status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\ttimeout = 2000;\n\t\t\t}\n\n\t\t\tthis.setStatusTimeout = setTimeout(() => {\n\t\t\t\tthis.status = status;\n\t\t\t\tthis.showed = true;\n\t\t\t}, timeout);\n\n\t\t\treturn true;\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tstatus()\n\t\t{\n\t\t\tclearTimeout(this.hideTimeout);\n\t\t\tif (this.status == PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tclearTimeout(this.hideTimeout);\n\t\t\t\tthis.hideTimeout = setTimeout(() => this.showed = false, 4000);\n\t\t\t}\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tconnectionClass()\n\t\t{\n\t\t\tlet result = '';\n\t\t\tif (this.showed === true)\n\t\t\t{\n\t\t\t\tresult = \"bx-pull-status-show\";\n\t\t\t}\n\t\t\telse if (this.showed === false)\n\t\t\t{\n\t\t\t\tresult = \"bx-pull-status-hide\";\n\t\t\t}\n\n\t\t\tif (this.status === PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-online\";\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-offline\";\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-connecting\";\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tconnectionText()\n\t\t{\n\t\t\tlet result = '';\n\n\t\t\tif (this.status === PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_ONLINE;\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_OFFLINE;\n\t\t\t}\n\t\t\telse if (this.status === PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_CONNECTING;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tbutton()\n\t\t{\n\t\t\tlet hotkey = '';\n\t\t\tlet name = '';\n\n\t\t\tif (this.canReconnect)\n\t\t\t{\n\t\t\t\tname = this.localize.BX_PULL_STATUS_BUTTON_RECONNECT;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thotkey = this.isMac? '&#8984;+R': \"Ctrl+R\";\n\t\t\t\tname = this.localize.BX_PULL_STATUS_BUTTON_RELOAD;\n\t\t\t}\n\n\t\t\treturn {title: name, key: hotkey};\n\t\t},\n\t\tlocalize()\n\t\t{\n\t\t\treturn Vue.getFilteredPhrases('BX_PULL_STATUS_', this.$root.$bitrixMessages);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"['bx-pull-status', connectionClass]\">\n\t\t\t<div class=\"bx-pull-status-wrap\">\n\t\t\t\t<span class=\"bx-pull-status-text\">{{connectionText}}</span>\n\t\t\t\t<span class=\"bx-pull-status-button\" @click=\"reconnect\">\n\t\t\t\t\t<span class=\"bx-pull-status-button-title\">{{button.title}}</span>\n\t\t\t\t\t<span class=\"bx-pull-status-button-key\" v-html=\"button.key\"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["Vue","component","props","canReconnect","default","data","status","PullClient","PullStatus","Online","showed","created","isMac","navigator","userAgent","toLowerCase","includes","setStatusTimeout","hideTimeout","pullUnSubscribe","$root","$bitrixPullClient","subscribe","$on","BX","PULL","window","beforeDestroy","methods","client","type","SubscriptionType","Status","callback","event","statusChange","reconnect","$emit","location","reload","clearTimeout","validStatus","Offline","Connecting","indexOf","timeout","setTimeout","watch","computed","connectionClass","result","connectionText","localize","BX_PULL_STATUS_ONLINE","BX_PULL_STATUS_OFFLINE","BX_PULL_STATUS_CONNECTING","button","hotkey","name","BX_PULL_STATUS_BUTTON_RECONNECT","BX_PULL_STATUS_BUTTON_RELOAD","title","key","getFilteredPhrases","$bitrixMessages","template"],"mappings":"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"}