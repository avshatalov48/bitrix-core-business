{"version":3,"file":"script.js","sources":["src/index.js"],"sourcesContent":["import { Event, Dom, ajax, Loc, Runtime, Tag, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Button, ButtonSize, ButtonColor } from 'ui.buttons';\nimport { UserStatus } from 'bizproc.task';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\nimport './style.css';\nimport 'sidepanel';\n\ntype TaskButton = {\n\tTARGET_USER_STATUS: number,\n\tNAME: string,\n\tVALUE: string,\n\tTEXT: string,\n};\n\nexport class WorkflowInfo\n{\n\tcurrentUserId: number;\n\tworkflowId: string;\n\ttaskId: number;\n\ttaskUserId: number;\n\ttaskButtons: ?Array<TaskButton>;\n\ttaskForm: ?HTMLFormElement;\n\tbuttonsPanel: ?HTMLElement;\n\tworkflowContent: HTMLElement;\n\tcanDelegateTask: boolean;\n\t#isChanged: boolean = false;\n\t#messageBox: MessageBox;\n\t#canClose: boolean = false;\n\n\tconstructor(options: {\n\t\tcurrentUserId: number,\n\t\tworkflowId: string,\n\t\ttaskId: number,\n\t\ttaskUserId: number,\n\t\ttaskButtons?: Array<TaskButton>,\n\t\ttaskForm?: HTMLFormElement,\n\t\tbuttonsPanel: HTMLElement,\n\t\tworkflowContent: HTMLElement,\n\t\tcanDelegateTask: boolean,\n\t})\n\t{\n\t\tthis.currentUserId = options.currentUserId;\n\t\tthis.workflowId = options.workflowId;\n\t\tthis.taskId = options.taskId;\n\t\tthis.taskUserId = options.taskUserId;\n\t\tthis.taskButtons = options.taskButtons;\n\t\tthis.taskForm = options.taskForm;\n\t\tthis.buttonsPanel = options.buttonsPanel;\n\t\tthis.workflowContent = options.workflowContent;\n\t\tthis.canDelegateTask = options.canDelegateTask;\n\n\t\tthis.handleMarkAsRead = Runtime.debounce(this.#sendMarkAsRead, 100, this);\n\t}\n\n\tinit(): void\n\t{\n\t\tif (this.buttonsPanel)\n\t\t{\n\t\t\tthis.#renderButtons();\n\t\t}\n\n\t\tthis.handleMarkAsRead();\n\n\t\tEventEmitter.subscribe('OnUCCommentWasRead', (event) => {\n\t\t\tconst [xmlId] = event.getData();\n\t\t\tif (xmlId === `WF_${this.workflowId}`)\n\t\t\t{\n\t\t\t\tthis.handleMarkAsRead();\n\t\t\t}\n\t\t});\n\t\tif (this.taskForm)\n\t\t{\n\t\t\tEvent.bind(this.taskForm, 'change', () => {\n\t\t\t\tthis.#isChanged = true;\n\t\t\t});\n\t\t\tEvent.bind(this.taskForm, 'input', (event) => {\n\t\t\t\tconst target = event.target;\n\t\t\t\tif (target.matches('input, textarea, select'))\n\t\t\t\t{\n\t\t\t\t\tconst formRow = target.closest('.ui-form-content');\n\t\t\t\t\tif (formRow)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#clearError(formRow);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.#isChanged = true;\n\t\t\t});\n\n\t\t\tthis.taskForm.querySelectorAll('.ui-form-content').forEach((row) => {\n\t\t\t\tEvent.bind(row, 'click', (event) => {\n\t\t\t\t\tconst target = event.currentTarget;\n\t\t\t\t\tthis.#clearError(target);\n\t\t\t\t});\n\t\t\t});\n\t\t\tEventEmitter.subscribe('BX.UI.Selector:onChange', (event) => {\n\t\t\t\tconst box = BX(`crm-${event.data[0].selectorId}-box`);\n\t\t\t\tconst formRow = box.closest('.ui-form-content');\n\t\t\t\tif (formRow)\n\t\t\t\t{\n\t\t\t\t\tthis.#clearError(formRow);\n\t\t\t\t\tthis.#isChanged = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe('BX.UI.EntitySelector.Dialog:Item:onSelect', (event) => {\n\t\t\t\tif (event.target.context === 'BIZPROC')\n\t\t\t\t{\n\t\t\t\t\tthis.#isChanged = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tEventEmitter.subscribe('BX.UI.EntitySelector.Dialog:Item:onDeselect', (event) => {\n\t\t\t\tif (event.target.context === 'BIZPROC')\n\t\t\t\t{\n\t\t\t\t\tthis.#isChanged = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe('OnIframeKeyup', (event) => {\n\t\t\t\tconst box = event.target.dom.cont;\n\t\t\t\tconst formRow = box.closest('.ui-form-content');\n\t\t\t\tif (formRow)\n\t\t\t\t{\n\t\t\t\t\tthis.#clearError(formRow);\n\t\t\t\t}\n\t\t\t});\n\t\t\tEventEmitter.subscribe('OnContentChanged', (event) => {\n\t\t\t\tif (event.target.dom.cont.closest('.ui-form-content'))\n\t\t\t\t{\n\t\t\t\t\tthis.#isChanged = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe('BX.Disk.Uploader.Integration:Item:onAdd', (event) => {\n\t\t\t\tif ((event.target.getUploader().getHiddenFieldsContainer().closest('.ui-form-content')))\n\t\t\t\t{\n\t\t\t\t\tthis.#isChanged = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tEventEmitter.subscribe('BX.Disk.Uploader.Integration:Item:onRemove', (event) => {\n\t\t\t\tif ((event.target.getUploader().getHiddenFieldsContainer().closest('.ui-form-content')))\n\t\t\t\t{\n\t\t\t\t\tthis.#isChanged = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', (event) => {\n\t\t\t\tif (event.getTarget().getWindow() === window && this.#isChanged && !this.#canClose)\n\t\t\t\t{\n\t\t\t\t\tevent.getCompatData()[0].denyAction();\n\t\t\t\t\tif (!this.#messageBox?.getPopupWindow().isShown())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showConfirmDialog();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t#renderButtons(): void\n\t{\n\t\tif (this.taskButtons)\n\t\t{\n\t\t\tDom.clean(this.buttonsPanel);\n\t\t\tthis.taskButtons.forEach((taskButton: TaskButton) => {\n\t\t\t\tconst targetStatus = new UserStatus(taskButton.TARGET_USER_STATUS);\n\t\t\t\tconst isDecline = targetStatus.isNo() || targetStatus.isCancel();\n\n\t\t\t\tconst button = new Button({\n\t\t\t\t\tcolor: isDecline ? ButtonColor.LIGHT_BORDER : ButtonColor.SUCCESS,\n\t\t\t\t\t// icon: isDecline ? ButtonIcon.CANCEL : ButtonIcon.DONE,\n\t\t\t\t\tround: true,\n\t\t\t\t\tsize: ButtonSize.MEDIUM,\n\t\t\t\t\t// noCaps: true,\n\t\t\t\t\ttext: taskButton.TEXT,\n\t\t\t\t\tonclick: (btn) => this.#handleTaskButtonClick(taskButton, btn),\n\t\t\t\t});\n\n\t\t\t\tDom.style(button.getContainer(), 'minWidth', '160px');\n\t\t\t\tDom.style(button.getContainer(), 'maxWidth', '200px');\n\t\t\t\tDom.attr(button.getContainer(), 'title', taskButton.TEXT);\n\t\t\t\tDom.append(button.getContainer(), this.buttonsPanel);\n\t\t\t});\n\t\t}\n\n\t\tif (this.canDelegateTask)\n\t\t{\n\t\t\tconst button = new Button({\n\t\t\t\tcolor: ButtonColor.LINK,\n\t\t\t\tsize: ButtonSize.MEDIUM,\n\t\t\t\t// noCaps: true,\n\t\t\t\ttext: Loc.getMessage('BPWFI_SLIDER_BUTTON_DELEGATE'),\n\t\t\t\tonclick: (btn) => this.#handleDelegateButtonClick(btn),\n\t\t\t});\n\n\t\t\tDom.style(button.getContainer(), 'minWidth', '160px');\n\t\t\tDom.style(button.getContainer(), 'maxWidth', '200px');\n\t\t\tDom.append(button.getContainer(), this.buttonsPanel);\n\t\t}\n\t}\n\n\t#handleTaskButtonClick(taskButton: TaskButton, uiButton: Button): void\n\t{\n\t\tconst formData = new FormData(this.taskForm);\n\t\tformData.append('taskId', this.taskId);\n\t\tformData.append('workflowId', this.workflowId);\n\t\tformData.append(taskButton.NAME, taskButton.VALUE);\n\n\t\tuiButton.setDisabled(true);\n\n\t\tajax.runAction('bizproc.task.do', {\n\t\t\tdata: formData,\n\t\t}).then(() => {\n\t\t\tuiButton.setDisabled(false);\n\t\t\tDom.addClass(this.workflowContent, 'fade-out');\n\t\t\tajax.runAction('bizproc.task.getUserTaskByWorkflowId', {\n\t\t\t\tdata: formData,\n\t\t\t}).then((res) => {\n\t\t\t\tif (BX.type.isArray(res.data.additionalParams) && res.data.additionalParams.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#canClose = true;\n\t\t\t\t\tBX.SidePanel.Instance.getSliderByWindow(window)?.close();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#renderNextTask(res.data);\n\t\t\t\t}\n\t\t\t}).catch((response) => {\n\t\t\t\tDom.toggleClass(this.workflowContent, 'fade-out fade-in');\n\t\t\t\tMessageBox.alert(response.errors.pop().message);\n\t\t\t});\n\t\t}).catch((response) => {\n\t\t\tif (BX.type.isArray(response.errors))\n\t\t\t{\n\t\t\t\tconst popupErrors = [];\n\t\t\t\tresponse.errors.forEach((error) => {\n\t\t\t\t\tconst fieldName = error.customData;\n\t\t\t\t\tif (this.taskForm && fieldName)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst field = this.taskForm.querySelector(`[data-cid=\"${fieldName}\"]`);\n\t\t\t\t\t\tif (field)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#showError(error, field);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tpopupErrors.push(error.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (popupErrors.length > 0)\n\t\t\t\t{\n\t\t\t\t\tMessageBox.alert(popupErrors.join(', '));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tuiButton.setDisabled(false);\n\t\t});\n\t}\n\n\t#handleDelegateButtonClick(uiButton: Button): void\n\t{\n\t\tuiButton.setDisabled(true);\n\n\t\tRuntime.loadExtension('ui.entity-selector').then((exports) => {\n\t\t\tconst { Dialog } = exports;\n\t\t\tuiButton.setDisabled(false);\n\n\t\t\tconst dialog = new Dialog({\n\t\t\t\ttargetNode: uiButton.getContainer(),\n\t\t\t\tcontext: 'bp-task-delegation',\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\temailUsers: false,\n\t\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\t\tinviteGuestLink: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'department',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tselectMode: 'usersOnly',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\t\t},\n\t\t\t\tenableSearch: true,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\t\tconst item = event.getData().item;\n\t\t\t\t\t\tthis.#delegateTask(item.getId());\n\t\t\t\t\t},\n\t\t\t\t\tonHide: (event) => {\n\t\t\t\t\t\tevent.getTarget().destroy();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\thideOnSelect: true,\n\t\t\t\toffsetTop: 3,\n\t\t\t\tclearUnavailableItems: true,\n\t\t\t\tmultiple: false,\n\t\t\t});\n\n\t\t\tdialog.show();\n\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tconsole.error(e);\n\t\t\t\tuiButton.setDisabled(false);\n\t\t\t});\n\t}\n\n\t#delegateTask(toUserId: number): void\n\t{\n\t\tconst actionData = {\n\t\t\ttaskIds: [this.taskId],\n\t\t\tfromUserId: this.taskUserId || this.currentUserId,\n\t\t\ttoUserId,\n\t\t};\n\n\t\tajax.runAction('bizproc.task.delegate', { data: actionData })\n\t\t\t.then((response) => {\n\t\t\t\tthis.#canClose = true;\n\t\t\t\tBX.SidePanel.Instance.getSliderByWindow(window)?.close();\n\t\t\t}).catch((response) => {\n\t\t\t\tMessageBox.alert(response.errors.pop().message);\n\t\t\t});\n\t}\n\n\t#sendMarkAsRead(): void\n\t{\n\t\tajax.runAction('bizproc.workflow.comment.markAsRead', {\n\t\t\tdata: {\n\t\t\t\tworkflowId: this.workflowId,\n\t\t\t\tuserId: this.currentUserId,\n\t\t\t},\n\t\t});\n\t}\n\n\t#clearError(target: HTMLElement): void\n\t{\n\t\tconst errorContainer = target.querySelector('.ui-form-notice');\n\t\tif (errorContainer)\n\t\t{\n\t\t\tBX.Dom.remove(errorContainer);\n\t\t}\n\t}\n\n\t#showError(error: string, field: HTMLElement): void\n\t{\n\t\tconst parentContainer = field.querySelector('.ui-form-content');\n\t\tlet errorContainer = field.querySelector('.ui-form-notice');\n\t\tif (!errorContainer)\n\t\t{\n\t\t\terrorContainer = BX.Dom.create(\n\t\t\t\t'div',\n\t\t\t\t{ attrs: { className: 'ui-form-notice' } },\n\t\t\t);\n\n\t\t\terrorContainer.innerText = error.message;\n\t\t\tif (parentContainer)\n\t\t\t{\n\t\t\t\tBX.Dom.append(errorContainer, parentContainer);\n\t\t\t}\n\t\t}\n\t}\n\n\t#renderNextTask(data)\n\t{\n\t\tthis.#isChanged = false;\n\t\tthis.#renderTaskFields(data);\n\n\t\tif (data.additionalParams)\n\t\t{\n\t\t\tthis.taskId = data.additionalParams.ID;\n\t\t\tconst subject = this.workflowContent.querySelector('.bp-workflow-info__subject');\n\t\t\tif (subject)\n\t\t\t{\n\t\t\t\tsubject.innerText = data.additionalParams.NAME;\n\t\t\t}\n\t\t\tconst desc = this.workflowContent.querySelector('.bp-workflow-info__desc-inner');\n\t\t\tif (desc)\n\t\t\t{\n\t\t\t\tconst descWrap = desc.closest('.bp-workflow-info__tabs-block');\n\t\t\t\tif (data.additionalParams.DESCRIPTION.length > 0)\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(descWrap, 'block-hidden');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(descWrap, 'block-hidden');\n\t\t\t\t}\n\n\t\t\t\tdesc.innerHTML = data.additionalParams.DESCRIPTION;\n\t\t\t}\n\t\t}\n\n\t\tif (data.additionalParams && data.additionalParams.BUTTONS)\n\t\t{\n\t\t\tthis.taskButtons = data.additionalParams.BUTTONS;\n\t\t}\n\n\t\tthis.init();\n\t\tDom.removeClass(this.workflowContent, 'fade-out');\n\t\tDom.addClass(this.workflowContent, 'fade-in');\n\n\t\tEvent.bindOnce(this.workflowContent, 'animationend', () => {\n\t\t\tDom.removeClass(this.workflowContent, 'fade-in');\n\t\t});\n\t}\n\n\t#renderTaskFields(data)\n\t{\n\t\tconst taskFields = this.workflowContent.querySelector('.bp-workflow-info__editor');\n\t\tif (BX.type.isArray(data.html) && data.html.length > 0)\n\t\t{\n\t\t\tDom.removeClass(taskFields, 'block-hidden');\n\t\t\tDom.clean(this.taskForm);\n\t\t\tdata.html.forEach((renderedControl, controlId) => {\n\t\t\t\tconst fieldData = data.additionalParams?.FIELDS?.[controlId];\n\t\t\t\tif (fieldData)\n\t\t\t\t{\n\t\t\t\t\tconst labelClass = fieldData.Required ? 'ui-form-label --required' : 'ui-form-label';\n\t\t\t\t\tconst node = Tag.render`\n\t\t\t\t\t\t<div class=\"ui-form-row\" data-cid=\"${Text.encode(fieldData.Id)}\">\n\t\t\t\t\t\t\t<div class=\"${labelClass}\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Text.encode(fieldData.Name)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"ui-form-content\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;\n\n\t\t\t\t\tBX.Runtime.html(node.querySelector('.ui-form-content'), renderedControl);\n\t\t\t\t\tthis.taskForm.append(node);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(taskFields, 'block-hidden');\n\t\t}\n\t}\n\n\t#showConfirmDialog()\n\t{\n\t\tthis.#messageBox = MessageBox.confirm(\n\t\t\tLoc.getMessage('BPWFI_SLIDER_CONFIRM_DESCRIPTION'),\n\t\t\tLoc.getMessage('BPWFI_SLIDER_CONFIRM_TITLE'),\n\t\t\t() => {\n\t\t\t\tthis.#canClose = true;\n\t\t\t\tBX.SidePanel.Instance.getSliderByWindow(window)?.close();\n\t\t\t},\n\t\t\tLoc.getMessage('BPWFI_SLIDER_CONFIRM_ACCEPT'),\n\t\t\t() => {\n\t\t\t\tthis.#messageBox.close();\n\t\t\t\tthis.#messageBox = null;\n\t\t\t},\n\t\t\tLoc.getMessage('BPWFI_SLIDER_CONFIRM_CANCEL'),\n\t\t);\n\t}\n}\n"],"names":["WorkflowInfo","constructor","options","currentUserId","workflowId","taskId","taskUserId","taskButtons","taskForm","buttonsPanel","workflowContent","canDelegateTask","handleMarkAsRead","Runtime","debounce","init","EventEmitter","subscribe","event","xmlId","getData","Event","bind","target","matches","formRow","closest","querySelectorAll","forEach","row","currentTarget","box","BX","data","selectorId","context","dom","cont","getUploader","getHiddenFieldsContainer","getTarget","getWindow","window","getCompatData","denyAction","getPopupWindow","isShown","Dom","clean","taskButton","targetStatus","UserStatus","TARGET_USER_STATUS","isDecline","isNo","isCancel","button","Button","color","ButtonColor","LIGHT_BORDER","SUCCESS","round","size","ButtonSize","MEDIUM","text","TEXT","onclick","btn","style","getContainer","attr","append","LINK","Loc","getMessage","uiButton","formData","FormData","NAME","VALUE","setDisabled","ajax","runAction","then","addClass","res","type","isArray","additionalParams","length","SidePanel","Instance","getSliderByWindow","close","catch","response","toggleClass","MessageBox","alert","errors","pop","message","popupErrors","error","fieldName","customData","field","querySelector","push","join","loadExtension","exports","Dialog","dialog","targetNode","entities","id","intranetUsersOnly","emailUsers","inviteEmployeeLink","inviteGuestLink","selectMode","popupOptions","bindOptions","forceBindPosition","enableSearch","events","item","getId","onHide","destroy","hideOnSelect","offsetTop","clearUnavailableItems","multiple","show","e","console","toUserId","actionData","taskIds","fromUserId","userId","errorContainer","remove","parentContainer","create","attrs","className","innerText","ID","subject","desc","descWrap","DESCRIPTION","removeClass","innerHTML","BUTTONS","bindOnce","taskFields","html","renderedControl","controlId","fieldData","FIELDS","labelClass","Required","node","Tag","render","Text","encode","Id","Name","confirm"],"mappings":"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"}