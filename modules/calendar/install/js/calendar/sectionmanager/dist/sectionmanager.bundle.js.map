{"version":3,"file":"sectionmanager.bundle.js","sources":["../src/calendarsection.js","../src/calendartasksection.js","../src/sectionmanager.js"],"sourcesContent":["import {Util} from 'calendar.util';\nimport { Event, Type } from 'main.core';\nimport {SectionManager} from \"calendar.sectionmanager\";\n\nexport class CalendarSection\n{\n\tconstructor(data)\n\t{\n\t\tthis.updateData(data);\n\t\tthis.calendarContext = Util.getCalendarContext();\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.id;\n\t}\n\n\tupdateData(data)\n\t{\n\t\tthis.data = data || {};\n\t\tthis.type = data.CAL_TYPE || '';\n\t\tthis.ownerId = parseInt(data.OWNER_ID) || 0;\n\t\tthis.id = parseInt(data.ID);\n\t\tthis.color = this.data.COLOR;\n\t\tthis.name = this.data.NAME;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.calendarContext.sectionManager.sectionIsShown(this.id);\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.isShown())\n\t\t{\n\t\t\tlet hiddenSections = this.calendarContext.sectionManager.getHiddenSections();\n\t\t\thiddenSections = hiddenSections.filter((sectionId) => {return sectionId !== this.id;}, this);\n\t\t\tthis.calendarContext.sectionManager.setHiddenSections(hiddenSections);\n\t\t\tthis.calendarContext.sectionManager.saveHiddenSections();\n\t\t}\n\t}\n\n\thide(): void\n\t{\n\t\tif (this.isShown())\n\t\t{\n\t\t\tconst hiddenSections = this.calendarContext.sectionManager.getHiddenSections();\n\t\t\thiddenSections.push(this.id);\n\t\t\tthis.calendarContext.sectionManager.setHiddenSections(hiddenSections);\n\t\t\tthis.calendarContext.sectionManager.saveHiddenSections();\n\t\t}\n\t}\n\n\tremove()\n\t{\n\t\tconst EventAlias = Util.getBX().Event;\n\t\tEventAlias.EventEmitter.emit(\n\t\t\t'BX.Calendar.Section:delete',\n\t\t\tnew EventAlias.BaseEvent({data: {sectionId: this.id}})\n\t\t);\n\n\t\tBX.ajax.runAction('calendar.api.calendarajax.deleteCalendarSection', {\n\t\t\tdata: {\n\t\t\t\tid: this.id\n\t\t\t}\n\t\t})\n\t\t.then(\n\t\t\t(response) => {\n\t\t\t\treturn this.updateListAfterDelete();\n\t\t\t},\n\t\t\t(response) => {\n\t\t\t\t// this.calendar.displayError(response.errors);\n\t\t\t}\n\t\t);\n\t}\n\n\thideSyncSection()\n\t{\n\t\tthis.hide();\n\t\tBX.onCustomEvent(this.calendar, 'BXCalendar:onSectionDelete', [this.id]);\n\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t'BX.Calendar.Section:delete',\n\t\t\tnew Event.BaseEvent({data: {sectionId: this.id}})\n\t\t);\n\n\t\t//hideExternalCalendarSection\n\t\tBX.ajax.runAction('calendar.api.calendarajax.setSectionStatus', {\n\t\t\tdata: {\n\t\t\t\tsectionStatus: {\n\t\t\t\t\t[this.id] : false\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t.then(\n\t\t\t(response) => {\n\t\t\t\treturn this.updateListAfterDelete();\n\t\t\t},\n\t\t\t(response) => {\n\t\t\t\t// this.calendar.displayError(response.errors);\n\t\t\t}\n\t\t);\n\t}\n\n\thideExternalCalendarSection()\n\t{\n\t\tthis.hide();\n\t\tBX.onCustomEvent(this.calendar, 'BXCalendar:onSectionDelete', [this.id]);\n\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t'BX.Calendar.Section:delete',\n\t\t\tnew Event.BaseEvent({data: {sectionId: this.id}})\n\t\t);\n\n\t\tBX.ajax.runAction('calendar.api.calendarajax.hideExternalCalendarSection', {\n\t\t\tdata: {\n\t\t\t\tid: this.id\n\t\t\t}\n\t\t})\n\t\t.then(\n\t\t\t(response) => {\n\t\t\t\treturn this.updateListAfterDelete();\n\t\t\t},\n\t\t\t(response) => {\n\t\t\t\t// this.calendar.displayError(response.errors);\n\t\t\t}\n\t\t);\n\t}\n\n\tgetLink()\n\t{\n\t\treturn this.data && this.data.LINK ? this.data.LINK : '';\n\t}\n\n\tcanBeConnectedToOutlook()\n\t{\n\t\treturn !this.isPseudo() && this.data.OUTLOOK_JS && !(this.data.CAL_DAV_CAL && this.data.CAL_DAV_CON) && !BX.browser.IsMac();\n\t}\n\n\tconnectToOutlook()\n\t{\n\t\tBX.ajax.runAction('calendar.api.syncajax.getOutlookLink', {\n\t\t\tdata: {\n\t\t\t\tid: this.id\n\t\t\t}\n\t\t})\n\t\t.then(\n\t\t\t(response) => {\n\t\t\t\tconst url = response.data.result;\n\n\t\t\t\teval(url);\n\t\t\t},\n\t\t\t(response) => {\n\t\t\t\t// this.calendar.displayError(response.errors);\n\t\t\t}\n\t\t)\n\t}\n\n\tcanDo(action)\n\t{\n\t\t//action: access|add|edit|edit_section|view_full|view_time|view_title\n\t\tif (this.isVirtual() && ['access','add','edit'].includes(action))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.hasPermission(action);\n\t}\n\n\thasPermission(action)\n\t{\n\t\tif (action === 'view_event')\n\t\t{\n\t\t\taction = 'view_time';\n\t\t}\n\n\t\tif (!this.data.PERM[action])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.data.PERM && this.data.PERM[action];\n\t}\n\n\tisSuperposed()\n\t{\n\t\treturn !this.isPseudo() && !!this.data.SUPERPOSED;\n\t}\n\n\tisPseudo()\n\t{\n\t\treturn false;\n\t}\n\n\tisVirtual()\n\t{\n\t\treturn (this.data.CAL_DAV_CAL && this.data.CAL_DAV_CAL.indexOf('@virtual/events/') !== -1)\n\t\t\t|| (this.data.GAPI_CALENDAR_ID && this.data.GAPI_CALENDAR_ID.indexOf('@group.v.calendar.google.com') !== -1)\n\t\t\t|| (this.data.EXTERNAL_TYPE === 'google_readonly')\n\t\t\t|| (this.data.EXTERNAL_TYPE === 'google_freebusy')\n\t}\n\n\tisGoogle()\n\t{\n\t\tconst googleTypes = [\n\t\t\t'google_readonly',\n\t\t\t'google',\n\t\t\t'google_write_read',\n\t\t\t'google_freebusy'\n\t\t]\n\n\t\treturn !this.isPseudo() && googleTypes.includes(this.data.EXTERNAL_TYPE);\n\t}\n\n\tisCalDav()\n\t{\n\t\treturn !this.isPseudo() && this.data.CAL_DAV_CAL && this.data.CAL_DAV_CON;\n\t}\n\n\tisIcloud()\n\t{\n\t\treturn !this.isPseudo() && this.data.EXTERNAL_TYPE === 'icloud';\n\t}\n\n\tisOffice365()\n\t{\n\t\treturn !this.isPseudo() && this.data.EXTERNAL_TYPE === 'office365';\n\t}\n\n\tisArchive()\n\t{\n\t\treturn !this.isPseudo() && this.data.EXTERNAL_TYPE === 'archive';\n\t}\n\n\tisExchange()\n\t{\n\t\treturn !this.isPseudo() && this.data['IS_EXCHANGE'];\n\t}\n\n\tisCompanyCalendar()\n\t{\n\t\treturn !this.isPseudo() && this.type !== 'user' && this.type !== 'group' && !this.ownerId;\n\t}\n\n\tisGroupCalendar()\n\t{\n\t\treturn !this.isPseudo() && this.type === 'group'\n\t}\n\n\thasConnection()\n\t{\n\t\treturn !this.isPseudo() && this.data.connectionLinks && this.data.connectionLinks.length;\n\t}\n\n\tisLocationRoom()\n\t{\n\t\treturn this.type === 'location';\n\t}\n\n\tbelongsToView()\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\treturn this.type === calendarContext.getCalendarType()\n\t\t\t&& this.ownerId === calendarContext.getOwnerId();\n\t}\n\n\tbelongsToOwner()\n\t{\n\t\treturn this.belongsToUser(Util.getCalendarContext().getUserId());\n\t}\n\n\tbelongsToUser(userId): boolean\n\t{\n\t\treturn this.type === 'user'\n\t\t\t&& this.ownerId === parseInt(userId)\n\t\t\t&& this.data.ACTIVE !== 'N';\n\t}\n\n\tgetExternalType(): string\n\t{\n\t\treturn this.data.EXTERNAL_TYPE\n\t\t\t? this.data.EXTERNAL_TYPE\n\t\t\t: (this.isCalDav() ? 'caldav' : '')\n\t\t;\n\t}\n\n\tgetConnectionLinks(): object\n\t{\n\t\treturn Type.isArray(this.data.connectionLinks)\n\t\t\t? this.data.connectionLinks\n\t\t\t: [];\n\t}\n\n\texternalTypeIsLocal(): boolean\n\t{\n\t\treturn this.getExternalType() === SectionManager.EXTERNAL_TYPE_LOCAL\n\t\t\t|| this.isCompanyCalendar()\n\t\t\t|| this.isGroupCalendar()\n\t\t;\n\t}\n\n\tisPrimaryForConnection(): boolean\n\t{\n\t\treturn !this.externalTypeIsLocal() && this.getConnectionLinks().find(connection => {\n\t\t\treturn connection.isPrimary === 'Y';\n\t\t});\n\t}\n\n\tisActive()\n\t{\n\t\treturn this.data.ACTIVE !== 'N';\n\t}\n\n\tgetType()\n\t{\n\t\treturn this.type;\n\t}\n\n\tgetOwnerId()\n\t{\n\t\treturn this.ownerId;\n\t}\n\n\tgetConnectionIdList()\n\t{\n\t\tconst connectionIdList = [];\n\t\tlet connectionId =  parseInt(this.data.CAL_DAV_CON, 10);\n\t\tif (connectionId)\n\t\t{\n\t\t\tconnectionIdList.push(connectionId);\n\t\t}\n\n\t\treturn connectionIdList;\n\t}\n\n\n\tupdateListAfterDelete()\n\t{\n\t\tconst sectionManager = Util.getCalendarContext().sectionManager;\n\t\tlet reload = true;\n\t\tlet section;\n\n\t\tfor (let i = 0; i < sectionManager.sections.length; i++)\n\t\t{\n\t\t\tsection = sectionManager.sections[i];\n\t\t\tif (\n\t\t\t\tsection.id !== this.id\n\t\t\t\t&& section.belongsToView()\n\t\t\t\t&& !section.isGoogle()\n\t\t\t\t&& !section.isIcloud()\n\t\t\t\t&& !section.isOffice365()\n\t\t\t\t&& !section.isCalDav()\n\t\t\t\t&& !section.isArchive()\n\t\t\t)\n\t\t\t{\n\t\t\t\treload = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst calendar = Util.getCalendarContext();\n\t\tif (!calendar || reload)\n\t\t{\n\t\t\treturn Util.getBX().reload();\n\t\t}\n\t\tcalendar.reload();\n\t}\n\n}","import { Loc } from 'main.core';\nimport { CalendarSection } from './calendarsection';\n\nexport class CalendarTaskSection extends CalendarSection\n{\n\tconstructor(data = {}, {type, userId, ownerId})\n\t{\n\t\tconst defaultColor = '#ff5b55';\n\t\tlet belongToUser = false;\n\t\tlet defaultName = Loc.getMessage('EC_SEC_USER_TASK_DEFAULT');\n\n\t\tif (type === 'user' && userId === ownerId)\n\t\t{\n\t\t\tdefaultName = Loc.getMessage('EC_SEC_MY_TASK_DEFAULT');\n\t\t\tbelongToUser = true;\n\t\t}\n\t\telse if(type === 'group')\n\t\t{\n\t\t\tdefaultName = Loc.getMessage('EC_SEC_GROUP_TASK_DEFAULT');\n\t\t}\n\n\t\tsuper({\n\t\t\tID: 'tasks',\n\t\t\tNAME: data.name || defaultName,\n\t\t\tCOLOR: data.color || defaultColor,\n\t\t\tPERM: {\n\t\t\t\tedit_section: true,\n\t\t\t\tview_full: true,\n\t\t\t\tview_time: true,\n\t\t\t\tview_title: true\n\t\t\t}\n\t\t});\n\n\t\tthis.isUserTaskSection = belongToUser;\n\t}\n\n\tisPseudo(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\ttaskSectionBelongToUser()\n\t{\n\t\treturn this.isUserTaskSection;\n\t}\n\n\tupdateData(data)\n\t{\n\t\tsuper.updateData(data);\n\t\tthis.id = data.ID;\n\t}\n}","import {Util} from 'calendar.util';\nimport {Event, Loc, Runtime, Type} from 'main.core';\nimport {CalendarSection} from './calendarsection';\nimport {CalendarTaskSection} from './calendartasksection';\nimport {EventEmitter} from 'main.core.events';\n\nexport { CalendarSection };\n\nexport class SectionManager\n{\n\tstatic newEntrySectionId = null;\n\tstatic EXTERNAL_TYPE_LOCAL = 'local';\n\tstatic RELOAD_DELAY = 1000;\n\n\tconstructor(data, config)\n\t{\n\t\tthis.setSections(data.sections);\n\t\tthis.setConfig(config);\n\t\tthis.addTaskSection();\n\t\tthis.sortSections();\n\t\tEventEmitter.subscribeOnce('BX.Calendar.Section:delete', (event) => {\n\t\t\tthis.deleteSectionHandler(event.data.sectionId);\n\t\t});\n\n\t\tthis.reloadDataDebounce = Runtime.debounce(this.reloadData, SectionManager.RELOAD_DELAY, this);\n\t}\n\n\tsetSections(rawSections = [])\n\t{\n\t\tthis.sections = [];\n\t\tthis.sectionIndex = {};\n\n\t\trawSections.forEach((sectionData) => {\n\t\t\tconst section = new CalendarSection(sectionData);\n\t\t\tif (section.canDo('view_time'))\n\t\t\t{\n\t\t\t\tthis.sections.push(section);\n\t\t\t\tthis.sectionIndex[section.getId()] = this.sections.length - 1;\n\t\t\t}\n\t\t});\n\t}\n\n\tsortSections()\n\t{\n\t\tthis.sectionIndex = {};\n\t\tthis.sections = this.sections.sort((a, b) => {\n\t\t\tif (Type.isFunction(a.isPseudo) && a.isPseudo())\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\telse if (Type.isFunction(b.isPseudo) && b.isPseudo())\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn a.name.localeCompare(b.name);\n\t\t});\n\n\t\tthis.sections.forEach((section, index) => {\n\t\t\tthis.sectionIndex[section.getId()] = index;\n\t\t});\n\t}\n\n\tsetConfig(config)\n\t{\n\t\tthis.setHiddenSections(config.hiddenSections);\n\t\tthis.calendarType = config.type;\n\t\tthis.ownerId = config.ownerId;\n\t\tthis.ownerName = config.ownerName || '';\n\t\tthis.userId = config.userId;\n\t\tthis.defaultSectionAccess = config.new_section_access || {};\n\n\t\tthis.sectionAccessTasks = config.sectionAccessTasks;\n\t\tthis.showTasks = config.showTasks;\n\t\tthis.customizationData = config.sectionCustomization || {};\n\t\tthis.meetSectionId = parseInt(config.meetSectionId, 10);\n\t}\n\n\taddTaskSection()\n\t{\n\t\tif (this.showTasks)\n\t\t{\n\t\t\tconst taskSection = new CalendarTaskSection(\n\t\t\t\tthis.customizationData['tasks' + this.ownerId],\n\t\t\t\t{\n\t\t\t\t\ttype: this.calendarType,\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\townerId: this.ownerId\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.sections.push(taskSection);\n\t\t\tthis.sectionIndex[taskSection.id] = this.sections.length - 1;\n\t\t}\n\t}\n\n\tgetCalendarType()\n\t{\n\t\treturn this.calendarType;\n\t}\n\n\thandlePullChanges(params)\n\t{\n\t\tif (params.command === 'delete_section')\n\t\t{\n\t\t\tconst sectionId = parseInt(params.fields.ID, 10);\n\t\t\tif (this.sectionIndex[sectionId])\n\t\t\t{\n\t\t\t\tthis.deleteSectionHandler(sectionId);\n\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t'BX.Calendar.Section:pull-delete',\n\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata: { sectionId: sectionId }\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.reloadDataDebounce();\n\t\t\t}\n\t\t}\n\t\telse if (params.command === 'edit_section')\n\t\t{\n\t\t\tthis.reloadDataDebounce();\n\t\t\tUtil.getBX().Event.EventEmitter.emit('BX.Calendar:doRefresh');\n\t\t}\n\t\telse if (params.command === 'hidden_sections_updated')\n\t\t{\n\t\t\tthis.setHiddenSections(params.hiddenSections);\n\t\t\tthis.reloadDataDebounce();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.reloadDataDebounce();\n\t\t}\n\t}\n\n\treloadData()\n\t{\n\t\tBX.ajax.runAction('calendar.api.calendarajax.getSectionList', {\n\t\t\t\tdata: {\n\t\t\t\t\t'type': this.calendarType,\n\t\t\t\t\t'ownerId': this.ownerId\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\t\tthis.setSections(response.data.sections || []);\n\t\t\t\t\tthis.sortSections();\n\t\t\t\t\tif (response.data.config)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setConfig(config);\n\t\t\t\t\t}\n\t\t\t\t\tthis.addTaskSection();\n\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t'BX.Calendar.Section:pull-reload-data'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t}\n\n\tgetSections()\n\t{\n\t\treturn this.sections;\n\t}\n\n\tgetSuperposedSectionList()\n\t{\n\t\tvar i, result = [];\n\t\tfor (i = 0; i < this.sections.length; i++)\n\t\t{\n\t\t\tif (this.sections[i].isSuperposed()\n\t\t\t\t&& this.sections[i].isActive())\n\t\t\t{\n\t\t\t\tresult.push(this.sections[i]);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetSectionListForEdit()\n\t{\n\t\tconst result = [];\n\t\tfor (let i = 0; i < this.sections.length; i++)\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.sections[i].canDo('edit')\n\t\t\t\t&& !this.sections[i].isPseudo()\n\t\t\t\t&& this.sections[i].isActive()\n\t\t\t\t&& !this.sections[i].isLocationRoom()\n\t\t\t)\n\t\t\t{\n\t\t\t\tresult.push(this.sections[i]);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetSection(id)\n\t{\n\t\treturn this.sections[this.sectionIndex[id]] || {};\n\t}\n\n\tgetDefaultSectionName()\n\t{\n\t\treturn Loc.getMessage('EC_DEFAULT_SECTION_NAME');\n\t}\n\n\tgetDefaultSectionAccess()\n\t{\n\t\treturn this.defaultSectionAccess;\n\t\t// return this.calendar.util.config.new_section_access || {};\n\t}\n\n\tsaveSection(name, color, access, params)\n\t{\n\t\treturn new Promise(resolve => {\n\t\t\tname = (Type.isString(name) && name.trim())\n\t\t\t\t? name.trim()\n\t\t\t\t: Loc.getMessage('EC_SEC_SLIDER_NEW_SECTION');\n\n\t\t\tif (params.section.id)\n\t\t\t{\n\t\t\t\t// BX.onCustomEvent(this.calendar, 'BXCalendar:onSectionChange', [\n\t\t\t\t// \tparams.section.id,\n\t\t\t\t// \t{\n\t\t\t\t// \t\tname: name,\n\t\t\t\t// \t\tcolor: color\n\t\t\t\t// \t}]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// BX.onCustomEvent(this.calendar, 'BXCalendar:onSectionAddBefore', [{\n\t\t\t\t// \tname: name,\n\t\t\t\t// \tcolor: color\n\t\t\t\t// }]);\n\t\t\t}\n\n\t\t\tconst isCustomization = params.section.id && params.section.isPseudo();\n\t\t\tBX.ajax.runAction('calendar.api.calendarajax.editCalendarSection', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t\t\taction: params.section.id ? 'editSection' : 'newSection',\n\t\t\t\t\t\t\ttype: params.section.type || this.calendarType\n\t\t\t\t\t\t},\n\t\t\t\t\t\tid: params.section.id || 0,\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\ttype: params.section.type || this.calendarType,\n\t\t\t\t\t\townerId: params.section.ownerId || this.ownerId,\n\t\t\t\t\t\tcolor: color,\n\t\t\t\t\t\taccess: access || null,\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tcustomization: isCustomization ? 'Y' : 'N',\n\t\t\t\t\t\texternal_type: params?.section?.id ? params.section.getExternalType() : 'local'\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tif (isCustomization)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tBX.reload();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst sectionList = response.data.sectionList || [];\n\t\t\t\t\t\tthis.setSections(sectionList);\n\t\t\t\t\t\tthis.sortSections();\n\t\t\t\t\t\tthis.addTaskSection();\n\n\t\t\t\t\t\tUtil.getBX().Event.EventEmitter.emit(\n\t\t\t\t\t\t\t'BX.Calendar.Section:edit',\n\t\t\t\t\t\t\tnew Event.BaseEvent(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdata: { sectionList: sectionList }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t},\n\t\t\t\t\t(response) => {\n\t\t\t\t\t\tBX.Calendar.Util.displayError(response.errors);\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t});\n\t}\n\n\tsectionIsShown(id)\n\t{\n\t\treturn !BX.util.in_array(id, this.hiddenSections);\n\t}\n\n\tgetHiddenSections()\n\t{\n\t\treturn this.hiddenSections;\n\t}\n\n\tsetHiddenSections(hiddenSections)\n\t{\n\t\tthis.hiddenSections = [];\n\t\tif (Type.isArray(hiddenSections))\n\t\t{\n\t\t\thiddenSections.forEach((id) => {\n\t\t\t\tthis.hiddenSections.push(id === 'tasks' ? id : parseInt(id));\n\t\t\t});\n\t\t}\n\t}\n\n\tsaveHiddenSections()\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\tconst optionName = calendarContext.util.userIsOwner()\n\t\t\t? 'hidden_sections'\n\t\t\t: 'hidden_sections_' + calendarContext.util.type;\n\n\t\tBX.userOptions.save('calendar', optionName, optionName, this.hiddenSections);\n\t}\n\n\tgetSectionsInfo()\n\t{\n\t\tconst allActive = [];\n\t\tconst superposed = [];\n\t\tconst active = [];\n\t\tconst hidden = [];\n\n\t\tthis.sections.forEach((section) => {\n\t\t\tif(section.isShown() && this.calendarType === 'location' && section.type === 'location')\n\t\t\t{\n\t\t\t\tif (section.isSuperposed())\n\t\t\t\t{\n\t\t\t\t\tsuperposed.push(section.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tactive.push(section.id);\n\t\t\t\t}\n\t\t\t\tallActive.push(section.id);\n\t\t\t}\n\t\t\telse if (section.isShown() && this.calendarType !== 'location')\n\t\t\t{\n\t\t\t\tif (section.isSuperposed())\n\t\t\t\t{\n\t\t\t\t\tsuperposed.push(section.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tactive.push(section.id);\n\t\t\t\t}\n\t\t\t\tallActive.push(section.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thidden.push(section.id);\n\t\t\t}\n\t\t});\n\n\t\treturn { superposed, active, hidden, allActive };\n\t}\n\n\tdeleteSectionHandler(sectionId)\n\t{\n\t\tif (this.sectionIndex[sectionId] !== undefined)\n\t\t{\n\t\t\tthis.sections = BX.util.deleteFromArray(this.sections, this.sectionIndex[sectionId]);\n\n\t\t\tthis.sectionIndex = {};\n\t\t\tfor (let i = 0; i < this.sections.length; i++)\n\t\t\t{\n\t\t\t\tthis.sectionIndex[this.sections[i].id] = i;\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getNewEntrySectionId(calendarType = null, ownerId = null)\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\tif (calendarContext && !calendarContext.isExternalMode())\n\t\t{\n\t\t\tcalendarType = calendarType || calendarContext.util.type;\n\t\t\tif (calendarType === 'location')\n\t\t\t{\n\t\t\t\tconst section = calendarContext.sectionManager.getDefaultSection(\n\t\t\t\t\t'user',\n\t\t\t\t\tcalendarContext.util.userId\n\t\t\t\t);\n\t\t\t\treturn parseInt(section?.id, 10);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst section = calendarContext.sectionManager.getDefaultSection(calendarType, ownerId);\n\t\t\t\treturn parseInt(section?.id, 10);\n\t\t\t}\n\t\t}\n\n\t\tif (SectionManager.newEntrySectionId)\n\t\t{\n\t\t\treturn SectionManager.newEntrySectionId;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstatic setNewEntrySectionId(sectionId)\n\t{\n\t\tSectionManager.newEntrySectionId = parseInt(sectionId);\n\t}\n\n\tstatic getSectionGroupList(options = {})\n\t{\n\t\tlet\n\t\t\ttype = options.type,\n\t\t\townerId = options.ownerId,\n\t\t\tuserId = options.userId,\n\t\t\tfollowedUserList = options.trackingUsersList || Util.getFollowedUserList(userId),\n\t\t\tsectionGroups = [],\n\t\t\ttitle;\n\n\t\t// 1. Main group - depends from current view\n\t\tif (type === 'user')\n\t\t{\n\t\t\tif (userId === ownerId)\n\t\t\t{\n\t\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_MY_CALENDARS_LIST');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_USER_CALENDARS_LIST');\n\t\t\t}\n\t\t}\n\t\telse if (type === 'group')\n\t\t{\n\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_GROUP_CALENDARS_LIST');\n\t\t}\n\t\telse if (type === 'location')\n\t\t{\n\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_TYPE_LOCATION_LIST');\n\t\t}\n\t\telse if (type === 'resource')\n\t\t{\n\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_TYPE_RESOURCE_LIST');\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttitle = Loc.getMessage('EC_SEC_SLIDER_TITLE_COMP_CAL');\n\t\t}\n\n\t\tsectionGroups.push({\n\t\t\ttitle: title,\n\t\t\ttype: type,\n\t\t\tbelongsToView: true\n\t\t});\n\n\t\tif (type !== 'user' || userId !== ownerId)\n\t\t{\n\t\t\tsectionGroups.push({\n\t\t\t\ttitle: Loc.getMessage('EC_SEC_SLIDER_MY_CALENDARS_LIST'),\n\t\t\t\ttype: 'user',\n\t\t\t\townerId: userId\n\t\t\t});\n\t\t}\n\n\t\t// 2. Company calendar\n\t\tif (type !== 'company' && type !== 'company_calendar' && type !== 'calendar_company')\n\t\t{\n\t\t\tsectionGroups.push({\n\t\t\t\ttitle: Loc.getMessage('EC_SEC_SLIDER_TITLE_COMP_CAL'),\n\t\t\t\ttype: 'company'\n\t\t\t});\n\t\t}\n\n\t\t// 3. Users calendars\n\t\tif (Type.isArray(followedUserList))\n\t\t{\n\t\t\tfollowedUserList.forEach((user) => {\n\t\t\t\tif (parseInt(user.ID) !== ownerId || type !== 'user')\n\t\t\t\t{\n\t\t\t\t\tsectionGroups.push({\n\t\t\t\t\t\ttitle: BX.util.htmlspecialchars(user.FORMATTED_NAME),\n\t\t\t\t\t\ttype: 'user',\n\t\t\t\t\t\townerId: parseInt(user.ID)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// 4. Groups calendars\n\t\tsectionGroups.push({\n\t\t\ttitle: Loc.getMessage('EC_SEC_SLIDER_POPUP_MENU_ADD_GROUP'),\n\t\t\ttype: 'group'\n\t\t});\n\n\t\t// 5. Resources calendars\n\t\tsectionGroups.push({\n\t\t\ttitle: Loc.getMessage('EC_SEC_SLIDER_TITLE_RESOURCE_CAL'),\n\t\t\ttype: 'resource'\n\t\t});\n\n\t\t// 6. Location calendars\n\t\tsectionGroups.push({\n\t\t\ttitle: Loc.getMessage('EC_SEC_SLIDER_TITLE_LOCATION_CAL'),\n\t\t\ttype: 'location'\n\t\t});\n\n\t\treturn sectionGroups;\n\t}\n\n\tgetSectionAccessTasks()\n\t{\n\t\treturn this.sectionAccessTasks;\n\t}\n\n\tgetDefaultSection(calendarType = null, ownerId = null)\n\t{\n\t\tlet sections = this.getSectionListForEdit();\n\n\t\tcalendarType = Type.isString(calendarType) ? calendarType : this.calendarType;\n\t\townerId = Type.isNumber(ownerId) ? ownerId : this.ownerId;\n\n\t\tlet section;\n\n\t\tif (calendarType === 'user')\n\t\t{\n\t\t\tconst defaultSectionId = this.meetSectionId;\n\t\t\tsection = sections.find((item) => {\n\t\t\t\treturn item.type === calendarType\n\t\t\t\t\t&& item.ownerId === ownerId\n\t\t\t\t\t&& item.id === defaultSectionId;\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsections = sections.sort((section1, section2) => section1.id - section2.id);\n\t\t}\n\n\t\tif (!section)\n\t\t{\n\t\t\tsection = sections.find((item) => {\n\t\t\t\treturn item.type === calendarType\n\t\t\t\t\t&& item.ownerId === ownerId\n\t\t\t\t\t&& item.canDo('edit')\n\t\t\t});\n\t\t}\n\n\t\treturn section;\n\t}\n\n\tsetDefaultSection(sectionId)\n\t{\n\t\tconst section = this.getSection(parseInt(sectionId, 10));\n\n\t\tif (section\n\t\t\t&& section.type === this.calendarType\n\t\t\t&& section.ownerId === this.ownerId)\n\t\t{\n\t\t\tconst userSettings = Util.getUserSettings();\n\t\t\tconst key = this.calendarType + this.ownerId;\n\t\t\tif (userSettings.defaultSections[key] !== section.id)\n\t\t\t{\n\t\t\t\tuserSettings.defaultSections[key] = section.id;\n\t\t\t\tUtil.setUserSettings(userSettings);\n\n\t\t\t\tBX.ajax.runAction('calendar.api.calendarajax.updateDefaultSectionId', {\n\t\t\t\t\tdata: {\n\t\t\t\t\t\t'key': key,\n\t\t\t\t\t\t'sectionId': sectionId\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic saveDefaultSectionId(sectionId, options = {})\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\tif (calendarContext)\n\t\t{\n\t\t\tcalendarContext.sectionManager.setDefaultSection(sectionId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (Type.isArray(options.sections) && options.calendarType && options.ownerId)\n\t\t\t{\n\t\t\t\tconst section = options.sections.find((item) => {\n\t\t\t\t\tconst id = parseInt(item.ID || item.id, 10);\n\t\t\t\t\tconst ownerId = parseInt(item.OWNER_ID || item.ownerId, 10);\n\t\t\t\t\tconst type = item.CAL_TYPE || item.type;\n\n\t\t\t\t\treturn id === parseInt(sectionId,10)\n\t\t\t\t\t\t&& ownerId === parseInt(options.ownerId, 10)\n\t\t\t\t\t\t&& type === options.calendarType;\n\t\t\t\t});\n\n\t\t\t\tif (section)\n\t\t\t\t{\n\t\t\t\t\tconst userSettings = Util.getUserSettings();\n\t\t\t\t\tconst key = options.calendarType + options.ownerId;\n\t\t\t\t\tif (userSettings && userSettings.defaultSections[key] !== sectionId)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserSettings.defaultSections[key] = sectionId;\n\t\t\t\t\t\tUtil.setUserSettings(userSettings);\n\t\t\t\t\t\tSectionManager.newEntrySectionId = sectionId;\n\n\t\t\t\t\t\tBX.ajax.runAction('calendar.api.calendarajax.updateDefaultSectionId', {\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t'key': key,\n\t\t\t\t\t\t\t\t'sectionId': sectionId\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic getSectionExternalConnection(section, sectionExternalType): any\n\t{\n\t\tconst calendarContext = Util.getCalendarContext();\n\t\tconst linkList = section.getConnectionLinks();\n\n\t\tlet provider = undefined;\n\t\tlet connection = undefined;\n\t\tlet connectionId = linkList.length\n\t\t\t? parseInt(linkList[0].id)\n\t\t\t: parseInt(section.data.CAL_DAV_CON, 10)\n\t\t;\n\n\t\tif (connectionId && calendarContext && calendarContext.syncInterface)\n\t\t{\n\t\t\t[provider, connection] = calendarContext.syncInterface.getProviderById(connectionId);\n\n\t\t\tif (\n\t\t\t\tconnection\n\t\t\t\t&& (!linkList.length || connection.getType() === sectionExternalType)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn connection;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}"],"names":["CalendarSection","constructor","data","updateData","calendarContext","Util","getCalendarContext","getId","id","type","CAL_TYPE","ownerId","parseInt","OWNER_ID","ID","color","COLOR","name","NAME","isShown","sectionManager","sectionIsShown","show","hiddenSections","getHiddenSections","filter","sectionId","setHiddenSections","saveHiddenSections","hide","push","remove","EventAlias","getBX","Event","EventEmitter","emit","BaseEvent","BX","ajax","runAction","then","response","updateListAfterDelete","hideSyncSection","onCustomEvent","calendar","sectionStatus","hideExternalCalendarSection","getLink","LINK","canBeConnectedToOutlook","isPseudo","OUTLOOK_JS","CAL_DAV_CAL","CAL_DAV_CON","browser","IsMac","connectToOutlook","url","result","eval","canDo","action","isVirtual","includes","hasPermission","PERM","isSuperposed","SUPERPOSED","indexOf","GAPI_CALENDAR_ID","EXTERNAL_TYPE","isGoogle","googleTypes","isCalDav","isIcloud","isOffice365","isArchive","isExchange","isCompanyCalendar","isGroupCalendar","hasConnection","connectionLinks","length","isLocationRoom","belongsToView","getCalendarType","getOwnerId","belongsToOwner","belongsToUser","getUserId","userId","ACTIVE","getExternalType","getConnectionLinks","Type","isArray","externalTypeIsLocal","SectionManager","EXTERNAL_TYPE_LOCAL","isPrimaryForConnection","find","connection","isPrimary","isActive","getType","getConnectionIdList","connectionIdList","connectionId","reload","section","i","sections","CalendarTaskSection","defaultColor","belongToUser","defaultName","Loc","getMessage","edit_section","view_full","view_time","view_title","isUserTaskSection","taskSectionBelongToUser","config","setSections","setConfig","addTaskSection","sortSections","subscribeOnce","event","deleteSectionHandler","reloadDataDebounce","Runtime","debounce","reloadData","RELOAD_DELAY","rawSections","sectionIndex","forEach","sectionData","sort","a","b","isFunction","localeCompare","index","calendarType","ownerName","defaultSectionAccess","new_section_access","sectionAccessTasks","showTasks","customizationData","sectionCustomization","meetSectionId","taskSection","handlePullChanges","params","command","fields","getSections","getSuperposedSectionList","getSectionListForEdit","getSection","getDefaultSectionName","getDefaultSectionAccess","saveSection","access","Promise","resolve","isString","trim","isCustomization","analyticsLabel","customization","external_type","sectionList","Calendar","displayError","errors","util","in_array","optionName","userIsOwner","userOptions","save","getSectionsInfo","allActive","superposed","active","hidden","undefined","deleteFromArray","getNewEntrySectionId","isExternalMode","getDefaultSection","newEntrySectionId","setNewEntrySectionId","getSectionGroupList","options","followedUserList","trackingUsersList","getFollowedUserList","sectionGroups","title","user","htmlspecialchars","FORMATTED_NAME","getSectionAccessTasks","isNumber","defaultSectionId","item","section1","section2","setDefaultSection","userSettings","getUserSettings","key","defaultSections","setUserSettings","saveDefaultSectionId","getSectionExternalConnection","sectionExternalType","linkList","provider","syncInterface","getProviderById"],"mappings":"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"}