(function(){"use strict";BX.namespace("BX.Currency");var e=null,t={CURRENCY:"",NAME:"",FORMAT_STRING:"#",DEC_POINT:".",THOUSANDS_VARIANT:null,THOUSANDS_SEP:" ",DECIMALS:2,HIDE_ZERO:"N",BASE:"N",SEPARATOR:" "};function r(){if(e===null){e=BX.message("CURRENCY")}return e}function n(e){var n=r();if(typeof n[e]!=="undefined")return n[e];return t}BX.Currency.Editor=function(e){this.input=e.input;this.callback=e.callback;this.currency=e.currency;this.value=e.value||"";BX.ready(BX.delegate(this.init,this))};BX.Currency.Editor.prototype.init=function(){BX.bind(this.input,"bxchange",BX.proxy(this.valueEdit,this));BX.unbind(this.input,"change",BX.proxy(this.valueEdit,this))};BX.Currency.Editor.prototype.clean=function(){BX.unbind(this.input,"bxchange",BX.proxy(this.valueEdit,this));this.input=null};BX.Currency.Editor.prototype.valueEdit=function(){this.formatValue()};BX.Currency.Editor.prototype.setCurrency=function(e){this.value=BX.Currency.Editor.getUnFormattedValue(this.input.value,this.currency);this.currency=e;this.input.value=BX.Currency.Editor.getFormattedValue(this.value,this.currency);this.callValueChangeCallback()};BX.Currency.Editor.prototype.formatValue=function(){var e=BX.getCaretPosition(this.input),t=this.input.value;this.changeValue();if(this.input.value.length>0){BX.setCaretPosition(this.input,e-t.length+this.input.value.length)}};BX.Currency.Editor.prototype.changeValue=function(){this.value=BX.Currency.Editor.getUnFormattedValue(this.input.value,this.currency);this.input.value=BX.Currency.Editor.getFormattedValue(this.value,this.currency);this.callValueChangeCallback()};BX.Currency.Editor.prototype.callValueChangeCallback=function(){if(!!this.callback){this.callback.apply(this,[this.value])}BX.onCustomEvent(this,"Currency::Editor::change",[this.value])};BX.Currency.Editor.getBaseCurrencyId=function(){var e=r();for(var t in e){if(!e.hasOwnProperty(t)){continue}if(BX.prop.getString(e[t],"BASE","N")==="Y"){return t}}return""};BX.Currency.Editor.trimTrailingZeros=function(e,t){var r=n(t),i;i=BX.prop.getString(r,"DEC_POINT","");return i!==""?e.replace(new RegExp("\\"+i+"0+$"),""):e};BX.Currency.Editor.escapeRegExp=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};BX.Currency.Editor.getUnFormattedValue=function(e,t){var r=n(t);if(r["SEPARATOR"].length===1){return e.replace(new RegExp("["+r["SEPARATOR"]+"]","g"),"").replace(r["DEC_POINT"],".")}else if(r["SEPARATOR"].length>1){return e.replace(new RegExp(this.escapeRegExp(r["SEPARATOR"]),"g"),"").replace(r["DEC_POINT"],".")}else{return e.replace(r["DEC_POINT"],".")}};BX.Currency.Editor.getFormattedValue=function(e,t){var r=e.length,i="",u=n(t),a,l,c,h;if(r>0){e=e.replace(/^0+/,"");if(e.length<=0){e="0"}else if(e.charAt(0)==="."){e="0"+e}r=e.length}if(u["SEPARATOR"]===","||u["SEPARATOR"]==="."){a=new RegExp("[.,]")}else{a=new RegExp("["+u["DEC_POINT"]+",.]")}l=e.match(a);l=l===null?e.length:l.index;c=0;for(h=0;h<e.length;h++){var o=e.length-1-h;var s=e.charAt(o);var E="0123456789".indexOf(s)>=0;if(E){c++}if(o===l){c=0}if(o>=l){if(u["DEC_POINT"]==="."&&s===","){s=u["DEC_POINT"]}if(u["DEC_POINT"]===","&&s==="."){s=u["DEC_POINT"]}if(E||o===l&&s===u["DEC_POINT"]){i=s+i}else if(r>o){r--}}else{if(E){i=s+i}else if(r>o){r--}if(E&&c%3===0&&c!==0&&o!==0){i=u["SEPARATOR"]+i;if(r>=o){r++}}}}if(u["DECIMALS"]>0){l=i.match(new RegExp("["+u["DEC_POINT"]+"]"));l=l===null?i.length:l.index;while(i.length-1-l>u["DECIMALS"]){if(r>=i.length-1){r--}i=i.substr(0,i.length-1)}}return i}})();