{"version":3,"file":"reaction.bundle.js","sources":["../src/classes/reaction-service.js","../src/components/selector.js","../src/components/user.js","../src/classes/user-service.js","../src/components/additional-users.js","../src/components/item.js","../src/components/list.js"],"sourcesContent":["import {Core} from 'im.v2.application.core';\nimport {RestMethod} from 'im.v2.const';\nimport {Logger} from 'im.v2.lib.logger';\n\nimport type {Store} from 'ui.vue3.vuex';\nimport type {reactionType as ReactionType} from 'ui.reactions-select';\nimport type {RestClient} from 'rest.client';\n\nexport class ReactionService\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t}\n\n\tsetReaction(messageId: number, reaction: $Values<typeof ReactionType>)\n\t{\n\t\tLogger.warn('ReactionService: setReaction', messageId, reaction);\n\t\tthis.#store.dispatch('messages/reactions/setReaction', {\n\t\t\tmessageId,\n\t\t\treaction,\n\t\t\tuserId: Core.getUserId()\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatMessageReactionAdd, {\n\t\t\tmessageId,\n\t\t\treaction\n\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error('ReactionService: error setting reaction', error);\n\t\t\t});\n\t}\n\n\tremoveReaction(messageId: number, reaction: $Values<typeof ReactionType>)\n\t{\n\t\tLogger.warn('ReactionService: removeReaction', messageId, reaction);\n\t\tthis.#store.dispatch('messages/reactions/removeReaction', {\n\t\t\tmessageId,\n\t\t\treaction,\n\t\t\tuserId: Core.getUserId()\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatMessageReactionDelete, {\n\t\t\t\tmessageId,\n\t\t\t\treaction\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error('ReactionService: error removing reaction', error);\n\t\t\t});\n\t}\n}","import {ReactionsSelect, reactionType as ReactionType} from 'ui.reactions-select';\n\nimport {ReactionService} from '../classes/reaction-service';\n\nimport '../css/selector.css';\n\nimport type {ImModelReactions} from 'im.v2.model';\n\nconst SHOW_DELAY = 500;\nconst HIDE_DELAY = 500;\n\n// @vue/component\nexport const ReactionSelector = {\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: Number,\n\t\t\trequired: true\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\treactionsData(): ImModelReactions\n\t\t{\n\t\t\treturn this.$store.getters['messages/reactions/getByMessageId'](this.messageId);\n\t\t},\n\t\townReactionSet(): boolean\n\t\t{\n\t\t\treturn this.reactionsData?.ownReactions?.size > 0;\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tstartShowTimer()\n\t\t{\n\t\t\tthis.showTimeout = setTimeout(() => {\n\t\t\t\tthis.showSelector();\n\t\t\t}, SHOW_DELAY);\n\t\t},\n\t\tclearShowTimer()\n\t\t{\n\t\t\tclearTimeout(this.showTimeout);\n\t\t\tthis.setHideTimeout();\n\t\t},\n\t\tshowSelector()\n\t\t{\n\t\t\tthis.selector = new ReactionsSelect({\n\t\t\t\tname: 'im-base-message-reaction-selector',\n\t\t\t\tposition: this.$refs['container']\n\t\t\t});\n\t\t\tthis.subscribeToSelectorEvents();\n\t\t\tthis.selector.show();\n\t\t},\n\t\tsubscribeToSelectorEvents()\n\t\t{\n\t\t\tthis.selector.subscribe('select', (selectEvent) => {\n\t\t\t\tconst {reaction} = selectEvent.getData();\n\t\t\t\tthis.getReactionService().setReaction(this.messageId, reaction);\n\t\t\t\tthis.selector?.hide();\n\t\t\t});\n\n\t\t\tthis.selector.subscribe('mouseleave', this.setHideTimeout);\n\n\t\t\tthis.selector.subscribe('mouseenter', () => {\n\t\t\t\tclearTimeout(this.hideTimeout);\n\t\t\t});\n\n\t\t\tthis.selector.subscribe('hide', () => {\n\t\t\t\tclearTimeout(this.hideTimeout);\n\t\t\t\tthis.selector = null;\n\t\t\t});\n\t\t},\n\t\tsetHideTimeout()\n\t\t{\n\t\t\tthis.hideTimeout = setTimeout(() => {\n\t\t\t\tthis.selector?.hide();\n\t\t\t}, HIDE_DELAY);\n\t\t},\n\t\tonIconClick()\n\t\t{\n\t\t\tthis.clearShowTimer();\n\t\t\tif (this.ownReactionSet)\n\t\t\t{\n\t\t\t\tconst [currentReaction] = [...this.reactionsData.ownReactions];\n\t\t\t\tthis.getReactionService().removeReaction(this.messageId, currentReaction);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getReactionService().setReaction(this.messageId, ReactionType.like);\n\t\t},\n\t\tgetReactionService(): ReactionService\n\t\t{\n\t\t\tif (!this.reactionService)\n\t\t\t{\n\t\t\t\tthis.reactionService = new ReactionService();\n\t\t\t}\n\n\t\t\treturn this.reactionService;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t@click=\"onIconClick\"\n\t\t\t@mouseenter=\"startShowTimer\"\n\t\t\t@mouseleave=\"clearShowTimer\"\n\t\t\tclass=\"bx-im-reaction-selector__container\"\n\t\t\tref=\"container\"\n\t\t>\n\t\t\t<div  class=\"bx-im-reaction-selector__icon\" :class=\"{'--active': ownReactionSet}\"></div>\n\t\t</div>\n\t`,\n};\n","import { Avatar, AvatarSize } from 'im.v2.component.elements';\n\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const ReactionUser = {\n\tcomponents: { Avatar },\n\tprops:\n\t{\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.userId);\n\t\t},\n\t\tavatarStyle(): Object\n\t\t{\n\t\t\tif (!this.user.avatar)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${this.user.avatar}')`,\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-reaction-list__user_avatar\">\n\t\t\t<Avatar \n\t\t\t\t:dialogId=\"userId\" \n\t\t\t\t:size=\"AvatarSize.XS\" \n\t\t\t\t:withAvatarLetters=\"false\" \n\t\t\t\t:withStatus=\"false\" \n\t\t\t\t:withTooltip=\"false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import {Core} from 'im.v2.application.core';\nimport {RestMethod} from 'im.v2.const';\nimport {UserManager} from 'im.v2.lib.user';\nimport {Logger} from 'im.v2.lib.logger';\n\nimport type {Store} from 'ui.vue3.vuex';\nimport type {RestClient} from 'rest.client';\n\nexport class UserService\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\t#userManager: UserManager;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t\tthis.#userManager = new UserManager();\n\t}\n\n\tloadReactionUsers(messageId: number, reaction: string): Promise<number[]>\n\t{\n\t\tlet users = [];\n\t\tLogger.warn('Reactions: UserService: loadReactionUsers', messageId, reaction);\n\t\tconst queryParams = {\n\t\t\tmessageId,\n\t\t\tfilter: {\n\t\t\t\treaction\n\t\t\t}\n\t\t};\n\t\treturn this.#restClient.callMethod(RestMethod.imV2ChatMessageReactionTail, queryParams)\n\t\t\t.then(response => {\n\t\t\t\tusers = response.data().users;\n\t\t\t\treturn this.#userManager.setUsersToModel(Object.values(users));\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\treturn users.map(user => user.id);\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error('Reactions: UserService: loadReactionUsers error', error);\n\t\t\t\tthrow new Error(error);\n\t\t\t});\n\t}\n}","import {Core} from 'im.v2.application.core';\nimport {UserListPopup} from 'im.v2.component.elements';\n\nimport {UserService} from '../classes/user-service';\n\n// @vue/component\nexport const AdditionalUsers = {\n\tcomponents: {UserListPopup},\n\tprops: {\n\t\tmessageId: {\n\t\t\ttype: Number,\n\t\t\trequired: true\n\t\t},\n\t\treaction: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t},\n\t\tshow: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t}\n\t},\n\temits: ['close'],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tshowPopup: false,\n\t\t\tloadingAdditionalUsers: false,\n\t\t\tadditionalUsers: []\n\t\t};\n\t},\n\twatch:\n\t{\n\t\tshow(newValue, oldValue)\n\t\t{\n\t\t\tif (!oldValue && newValue)\n\t\t\t{\n\t\t\t\tthis.showPopup = true;\n\t\t\t\tthis.loadUsers();\n\t\t\t}\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tloadUsers()\n\t\t{\n\t\t\tthis.loadingAdditionalUsers = true;\n\t\t\tthis.getUserService().loadReactionUsers(this.messageId, this.reaction)\n\t\t\t\t.then(userIds => {\n\t\t\t\t\tthis.additionalUsers = userIds;\n\t\t\t\t\tthis.loadingAdditionalUsers = false;\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.loadingAdditionalUsers = false;\n\t\t\t\t});\n\t\t},\n\t\tonPopupClose()\n\t\t{\n\t\t\tthis.showPopup = false;\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tprepareAdditionalUsers(userIds: number[]): number[]\n\t\t{\n\t\t\tconst firstViewerId = this.dialog.lastMessageViews.firstViewer.userId;\n\n\t\t\treturn userIds.filter(userId => {\n\t\t\t\treturn userId !== Core.getUserId() && userId !== firstViewerId;\n\t\t\t});\n\t\t},\n\t\tgetUserService(): UserService\n\t\t{\n\t\t\tif (!this.userService)\n\t\t\t{\n\t\t\t\tthis.userService = new UserService();\n\t\t\t}\n\n\t\t\treturn this.userService;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<UserListPopup\n\t\t\tid=\"bx-im-message-reaction-users\"\n\t\t\t:showPopup=\"showPopup\"\n\t\t\t:loading=\"loadingAdditionalUsers\"\n\t\t\t:userIds=\"additionalUsers\"\n\t\t\t:bindElement=\"bindElement || {}\"\n\t\t\t:withAngle=\"false\"\n\t\t\t:offsetLeft=\"-112\"\n\t\t\t:forceTop=\"true\"\n\t\t\t@close=\"onPopupClose\"\n\t\t/>\n\t`\n};","import { Event } from 'main.core';\n\nimport { ReactionsSelect, reactionCssClass as ReactionIconClass } from 'ui.reactions-select';\nimport { Lottie } from 'ui.lottie';\n\nimport { ReactionUser } from './user';\nimport { AdditionalUsers } from './additional-users';\n\nconst USERS_TO_SHOW = 5;\nconst SHOW_USERS_DELAY = 1500;\n\n// @vue/component\nexport const ReactionItem = {\n\tcomponents: { ReactionUser, AdditionalUsers },\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tcounter: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tusers: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tselected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tanimate: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['click'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tshowAdditionalUsers: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tshowUsers(): boolean\n\t\t{\n\t\t\tconst userLimitIsNotReached = this.counter <= USERS_TO_SHOW;\n\t\t\tconst weHaveUsersData = this.counter === this.users.length;\n\n\t\t\treturn userLimitIsNotReached && weHaveUsersData;\n\t\t},\n\t\tpreparedUsers(): number[]\n\t\t{\n\t\t\treturn [...this.users].sort((a, b) => a - b).reverse();\n\t\t},\n\t\treactionClass(): string\n\t\t{\n\t\t\treturn ReactionIconClass[this.type];\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tif (this.animate)\n\t\t{\n\t\t\tthis.playAnimation();\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tplayAnimation()\n\t\t{\n\t\t\tthis.animation = Lottie.loadAnimation({\n\t\t\t\tanimationData: ReactionsSelect.getLottieAnimation(this.type),\n\t\t\t\tcontainer: this.$refs.reactionIcon,\n\t\t\t\tloop: false,\n\t\t\t\tautoplay: false,\n\t\t\t\trenderer: 'svg',\n\t\t\t\trendererSettings: {\n\t\t\t\t\tviewBoxOnly: true,\n\t\t\t\t},\n\t\t\t});\n\t\t\tEvent.bind(this.animation, 'complete', () => {\n\t\t\t\tthis.animation.destroy();\n\t\t\t});\n\t\t\tEvent.bind(this.animation, 'destroy', () => {\n\t\t\t\tthis.animation = null;\n\t\t\t});\n\t\t\tthis.animation.play();\n\t\t},\n\t\tstartShowUsersTimer()\n\t\t{\n\t\t\tthis.showUsersTimeout = setTimeout(() => {\n\t\t\t\tthis.showAdditionalUsers = true;\n\t\t\t}, SHOW_USERS_DELAY);\n\t\t},\n\t\tclearShowUsersTimer()\n\t\t{\n\t\t\tclearTimeout(this.showUsersTimeout);\n\t\t},\n\t\tonClick()\n\t\t{\n\t\t\tclearTimeout(this.showUsersTimeout);\n\t\t\tthis.$emit('click', { animateItemFunction: this.playAnimation });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t@click=\"onClick\" \n\t\t\t@mouseenter=\"startShowUsersTimer\"\n\t\t\t@mouseleave=\"clearShowUsersTimer\"\n\t\t\tclass=\"bx-im-reaction-list__item\"\n\t\t\t:class=\"{'--selected': selected}\"\n\t\t>\n\t\t\t<div class=\"bx-im-reaction-list__item_icon\" :class=\"reactionClass\" ref=\"reactionIcon\"></div>\n\t\t\t<div v-if=\"showUsers\" class=\"bx-im-reaction-list__user_container\" ref=\"users\">\n\t\t\t\t<TransitionGroup name=\"bx-im-reaction-list__user_animation\">\n\t\t\t\t\t<ReactionUser v-for=\"user in preparedUsers\" :key=\"user\" :userId=\"user\" />\n\t\t\t\t</TransitionGroup>\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-im-reaction-list__item_counter\" ref=\"counter\">{{ counter }}</div>\n\t\t\t<AdditionalUsers\n\t\t\t\t:show=\"showAdditionalUsers\"\n\t\t\t\t:bindElement=\"$refs['users'] || $refs['counter'] || {}\"\n\t\t\t\t:messageId=\"messageId\"\n\t\t\t\t:reaction=\"type\"\n\t\t\t\t@close=\"showAdditionalUsers = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import {EventEmitter} from 'main.core.events';\nimport {reactionType as Reaction} from 'ui.reactions-select';\n\nimport {DialogScrollThreshold, EventType} from 'im.v2.const';\n\nimport {ReactionItem} from './item';\nimport {ReactionService} from '../classes/reaction-service';\n\nimport '../css/list.css';\n\nimport type {ImModelReactions, ImModelMessage} from 'im.v2.model';\n\ntype ReactionType = $Values<typeof Reaction>;\n\n// @vue/component\nexport const ReactionList = {\n\tcomponents: {ReactionItem},\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: Number,\n\t\t\trequired: true\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmounted: false\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tReaction: () => Reaction,\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.messageId);\n\t\t},\n\t\treactionsData(): ImModelReactions\n\t\t{\n\t\t\treturn this.$store.getters['messages/reactions/getByMessageId'](this.messageId);\n\t\t},\n\t\treactionCounters(): {[ReactionType]: number}\n\t\t{\n\t\t\treturn this.reactionsData?.reactionCounters ?? {};\n\t\t},\n\t\townReactions(): Set<ReactionType>\n\t\t{\n\t\t\treturn this.reactionsData?.ownReactions ?? new Set();\n\t\t},\n\t\tshowReactionsContainer(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.reactionCounters).length > 0;\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tshowReactionsContainer(newValue, oldValue)\n\t\t{\n\t\t\tif (!oldValue && newValue)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.message.chatId,\n\t\t\t\t\tthreshold: DialogScrollThreshold.nearTheBottom\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\tmounted()\n\t{\n\t\tthis.mounted = true;\n\t},\n\tmethods:\n\t{\n\t\tonReactionSelect(reaction: ReactionType, event: {animateItemFunction: () => void})\n\t\t{\n\t\t\tconst {animateItemFunction} = event;\n\t\t\tif (this.ownReactions?.has(reaction))\n\t\t\t{\n\t\t\t\tthis.getReactionService().removeReaction(this.messageId, reaction);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getReactionService().setReaction(this.messageId, reaction);\n\t\t\tanimateItemFunction();\n\t\t},\n\t\tgetReactionUsers(reaction: ReactionType): number[]\n\t\t{\n\t\t\tconst users = this.reactionsData.reactionUsers[reaction];\n\t\t\tif (!users)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn [...users];\n\t\t},\n\t\tgetReactionService(): ReactionService\n\t\t{\n\t\t\tif (!this.reactionService)\n\t\t\t{\n\t\t\t\tthis.reactionService = new ReactionService();\n\t\t\t}\n\n\t\t\treturn this.reactionService;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div v-if=\"showReactionsContainer\" class=\"bx-im-reaction-list__container\">\n\t\t\t<template v-for=\"reactionType in Reaction\">\n\t\t\t\t<ReactionItem\n\t\t\t\t\tv-if=\"reactionCounters[reactionType] > 0\"\n\t\t\t\t\t:key=\"reactionType\"\n\t\t\t\t\t:messageId=\"messageId\"\n\t\t\t\t\t:type=\"reactionType\"\n\t\t\t\t\t:counter=\"reactionCounters[reactionType]\"\n\t\t\t\t\t:users=\"getReactionUsers(reactionType)\"\n\t\t\t\t\t:selected=\"ownReactions.has(reactionType)\"\n\t\t\t\t\t:animate=\"mounted\"\n\t\t\t\t\t@click=\"onReactionSelect(reactionType, $event)\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</div>\n\t`\n};"],"names":["ReactionService","constructor","Core","getStore","getRestClient","setReaction","messageId","reaction","Logger","warn","dispatch","userId","getUserId","callMethod","RestMethod","imV2ChatMessageReactionAdd","catch","error","console","removeReaction","imV2ChatMessageReactionDelete","SHOW_DELAY","HIDE_DELAY","ReactionSelector","props","type","Number","required","data","computed","reactionsData","$store","getters","ownReactionSet","ownReactions","size","methods","startShowTimer","showTimeout","setTimeout","showSelector","clearShowTimer","clearTimeout","setHideTimeout","selector","ReactionsSelect","name","position","$refs","subscribeToSelectorEvents","show","subscribe","selectEvent","getData","getReactionService","hide","hideTimeout","onIconClick","currentReaction","ReactionType","like","reactionService","template","ReactionUser","components","Avatar","AvatarSize","user","avatarStyle","avatar","backgroundImage","UserService","UserManager","loadReactionUsers","users","queryParams","filter","imV2ChatMessageReactionTail","then","response","setUsersToModel","Object","values","map","id","Error","AdditionalUsers","UserListPopup","String","Boolean","bindElement","emits","showPopup","loadingAdditionalUsers","additionalUsers","watch","newValue","oldValue","loadUsers","getUserService","userIds","onPopupClose","$emit","prepareAdditionalUsers","firstViewerId","dialog","lastMessageViews","firstViewer","userService","USERS_TO_SHOW","SHOW_USERS_DELAY","ReactionItem","counter","Array","selected","animate","showAdditionalUsers","showUsers","userLimitIsNotReached","weHaveUsersData","length","preparedUsers","sort","a","b","reverse","reactionClass","ReactionIconClass","mounted","playAnimation","animation","Lottie","loadAnimation","animationData","getLottieAnimation","container","reactionIcon","loop","autoplay","renderer","rendererSettings","viewBoxOnly","Event","bind","destroy","play","startShowUsersTimer","showUsersTimeout","clearShowUsersTimer","onClick","animateItemFunction","ReactionList","Reaction","message","reactionCounters","Set","showReactionsContainer","keys","EventEmitter","emit","EventType","scrollToBottom","chatId","threshold","DialogScrollThreshold","nearTheBottom","onReactionSelect","event","has","getReactionUsers","reactionUsers"],"mappings":"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"}