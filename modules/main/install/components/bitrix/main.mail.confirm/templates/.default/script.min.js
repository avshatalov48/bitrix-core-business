(function(){if(window.BXMainMailConfirm)return;var e={showForm:function(e){var t="email";var o=new BX.PopupWindow("add_from_email",null,{width:480,titleBar:BX.message("MAIN_MAIL_CONFIRM_TITLE"),closeIcon:true,lightShadow:true,contentColor:"white",contentNoPaddings:true,content:BX("new_from_email_dialog_content").innerHTML,buttons:[new BX.PopupWindowButton({text:BX.message("MAIN_MAIL_CONFIRM_GET_CODE"),className:"popup-window-button-create",events:{click:function(){var a=this;if(BX.hasClass(a.buttonNode,"popup-window-button-wait"))return;var n=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-email-block",true);var i=BX.findChildByClassName(o.contentContainer,"new-from-email-dialog-code-block",true);var l=BX.findChild(n,{attr:{"data-name":"name"}},true);var r=BX.findChild(n,{attr:{"data-name":"email"}},true);var s=BX.findChild(i,{attr:{"data-name":"code"}},true);var u=BX.findChild(o.contentContainer,{attr:{"data-name":"public"}},true);if(t=="email"){s.value="";var d="[=a-z0-9_+~'!$&*^`|#%/?{}-]";var m=new RegExp("^"+d+"+(\\."+d+"+)*@([a-z0-9-]+\\.)+[a-z0-9-]{2,20}$","i");if(!r.value.match(m)){o.showNotify(BX.message(r.value.length>0?"MAIN_MAIL_CONFIRM_INVALID_EMAIL":"MAIN_MAIL_CONFIRM_EMPTY_EMAIL"));return}}else{if(s.value.length==0){o.showNotify(BX.message("MAIN_MAIL_CONFIRM_EMPTY_CODE"));return}}o.hideNotify();BX.addClass(a.buttonNode,"popup-window-button-wait");BX.ajax({url:"/bitrix/components/bitrix/main.mail.confirm/ajax.php?act=add",method:"POST",dataType:"json",data:{name:l.value,email:r.value,code:t!="email"?s.value:"",public:u.checked?u.value:""},onsuccess:function(s){BX.removeClass(a.buttonNode,"popup-window-button-wait");if(s.result=="error"){o.showNotify(s.error)}else if(t=="email"){t="code";n.style.height=n.offsetHeight+"px";n.offsetHeight;n.style.height="0px";var u=i.offsetHeight;i.style.height="0px";i.style.position="";i.offsetHeight;i.style.height=u+"px";a.setName(BX.message("MAIN_MAIL_CONFIRM_SAVE"))}else{a.popupWindow.close();if(BX.type.isFunction(e)){var d=l.value.length>0?l.value:BX.message("MAIN_MAIL_CONFIRM_USER_FULL_NAME");e({name:d,email:r.value},d.length>0?d+" <"+r.value+">":r.value)}}},onfailure:function(e){BX.removeClass(a.buttonNode,"popup-window-button-wait");o.showNotify(BX.message("MAIN_MAIL_CONFIRM_AJAX_ERROR"))}})}}}),new BX.PopupWindowButton({text:BX.message("MAIN_MAIL_CONFIRM_CANCEL"),className:"popup-window-button-link",events:{click:function(){this.popupWindow.close()}}})]});o.hideNotify=function(){var e=BX.findChild(o.contentContainer,{class:"new-from-email-dialog-error"},true);BX.hide(e,"block")};o.showNotify=function(e){var t=BX.findChild(o.contentContainer,{class:"new-from-email-dialog-error"},true);t.innerHTML=e;BX.show(t,"block")};o.show()}};window.BXMainMailConfirm=e})();