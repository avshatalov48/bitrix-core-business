{"version":3,"file":"sender-editor.bundle.js","sources":["../src/smtp-editor.js","../src/alias-editor.js"],"sourcesContent":["import { Loc, Tag, Dom, ready, ajax, Type } from 'main.core';\nimport { Layout } from 'ui.sidepanel.layout';\nimport { LayoutForm } from 'ui.layout-form';\nimport './css/style.css';\nimport 'ui.hint';\nimport 'ui.alerts';\nimport { SaveButton } from \"ui.buttons\";\nimport { AliasEditor } from './alias-editor';\n\ntype SenderData = {\n\tname: string,\n\tisPublic: boolean;\n\temail: string,\n\tserver: string,\n\tport: number,\n\tprotocol: string,\n\tlimit: null | number,\n};\n\ntype Options = {\n\tsenderId?: number,\n\tsetSenderCallback?: Function,\n\taddSenderCallback?: Function,\n\tonClose?: Function,\n};\n\nconst SidePanel = BX.SidePanel;\nconst emailRegularEx = /\\S+@\\S+\\.\\S+/;\nconst deleteMessage = 'mail-mailbox-config-delete';\nconst senderType = 'sender';\n\nexport class SmtpEditor\n{\n\tconstructor(options: Options)\n\t{\n\t\tif (options)\n\t\t{\n\t\t\tif (options.senderId && Type.isInteger(options.senderId) && options.senderId > 0)\n\t\t\t{\n\t\t\t\tthis.title = Loc.getMessage('UI_MAIL_SMTP_SLIDER_EDIT_TITLE');\n\t\t\t\tthis.senderId = options.senderId;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.title = Loc.getMessage('UI_MAIL_SMTP_SLIDER_ADD_TITLE');\n\t\t\t}\n\n\t\t\tthis.setSender = options.setSenderCallback ?? null;\n\t\t\tthis.addSender = options.addSenderCallback ?? null;\n\t\t}\n\t\tthis.onCloseAction = options.onClose ?? null;\n\n\t\tthis.#createContentContainer();\n\t\tthis.#prepareNecessaryFields();\n\t}\n\n\tstatic openSlider(options: Options): void {\n\t\tconst instance = new SmtpEditor(options);\n\t\tSidePanel.Instance.open('smtpSender', {\n\t\t\twidth: 760,\n\t\t\tcacheable: false,\n\t\t\tcontentCallback: () => {\n\t\t\t\treturn instance.getContentCallback();\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonLoad: () => {\n\t\t\t\t\tready(() => {\n\t\t\t\t\t\tnew LayoutForm({ container: instance.limitSection });\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tgetContentCallback(): Layout\n\t{\n\t\treturn Layout.createContent({\n\t\t\textensions: [\n\t\t\t\t'ui.mail.sender-editor',\n\t\t\t],\n\t\t\ttitle: this.title,\n\t\t\tdesign: {\n\t\t\t\tsection: false,\n\t\t\t\tmargin: false,\n\t\t\t},\n\t\t\tcontent: () => {\n\t\t\t\tif (this.senderId > 0)\n\t\t\t\t{\n\t\t\t\t\treturn this.loadSender(this.senderId);\n\t\t\t\t}\n\n\t\t\t\treturn ajax.runAction('main.api.mail.sender.getDefaultSenderName')\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tthis.#setUserName(response.data);\n\n\t\t\t\t\t\treturn this.getContentContainer();\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\treturn this.getContentContainer();\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t},\n\t\t\tbuttons: ({ cancelButton, Button }) => {\n\t\t\t\tconst buttonArray = [];\n\t\t\t\tconst saveButton = new SaveButton({\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.#save(saveButton);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tbuttonArray.push(saveButton);\n\n\t\t\t\tif (this.senderId > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.disconnectButton = new Button({\n\t\t\t\t\t\ttext: Loc.getMessage('UI_MAIL_SMTP_SLIDER_DISCONNECT_BUTTON'),\n\t\t\t\t\t\tcolor: BX.UI.Button.Color.DANGER,\n\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\tthis.#showDisconnectDialog();\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tbuttonArray.push(this.disconnectButton);\n\t\t\t\t}\n\t\t\t\tbuttonArray.push(cancelButton);\n\n\t\t\t\treturn buttonArray;\n\t\t\t},\n\t\t});\n\t}\n\n\tloadSender(senderId: number): Promise\n\t{\n\t\treturn ajax.runAction(\n\t\t\t'main.api.mail.sender.getSenderData',\n\t\t\t{\n\t\t\t\tdata: { senderId },\n\t\t\t},\n\t\t).then((response) => {\n\t\t\tthis.#setFieldData(response.data);\n\n\t\t\treturn this.getContentContainer();\n\t\t}).catch(() => {\n\t\t\treturn this.getContentContainer();\n\t\t});\n\t}\n\n\t#setFieldData(senderData: SenderData): void\n\t{\n\t\tthis.nameField.value = senderData.name;\n\t\tthis.accessField.checked = senderData.isPublic;\n\t\tthis.emailField.value = senderData.email;\n\t\tthis.serverField.value = senderData.server;\n\t\tthis.portField.value = senderData.port;\n\t\tif (senderData.protocol === 'smtps')\n\t\t{\n\t\t\tthis.sslField.checked = true;\n\t\t}\n\n\t\tif (Type.isNumber(senderData.limit) && senderData.limit > 0)\n\t\t{\n\t\t\tthis.senderLimitCheckbox.checked = true;\n\t\t\tthis.senderLimitField.value = senderData.limit;\n\t\t}\n\t}\n\n\t#showDisconnectDialog(): void\n\t{\n\t\ttop.BX.UI.Dialogs.MessageBox.show({\n\t\t\tmessage: Loc.getMessage('UI_MAIL_SMTP_SLIDER_DISCONNECT_MESSAGE'),\n\t\t\tmodal: true,\n\t\t\tbuttons: BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,\n\t\t\tonOk: (messageBox) => {\n\t\t\t\tthis.#disconnect();\n\t\t\t\tmessageBox.close();\n\t\t\t},\n\t\t\tonCancel: (messageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t},\n\t\t});\n\t}\n\n\t#save(button: SaveButton): void\n\t{\n\t\tthis.#clearInvalidFields();\n\t\tif (this.#hasInvalidFields())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.#hideAlertNode();\n\t\tbutton.setClocking();\n\t\tthis.#saveSender()\n\t\t\t.then((response) => {\n\t\t\t\tconst data = response.data;\n\t\t\t\tif (this.setSender)\n\t\t\t\t{\n\t\t\t\t\tthis.setSender(data.senderId, data.name, this.email);\n\t\t\t\t}\n\n\t\t\t\tif (this.addSender)\n\t\t\t\t{\n\t\t\t\t\tconst mailbox = [];\n\t\t\t\t\tmailbox.name = data.name;\n\t\t\t\t\tmailbox.email = this.email;\n\t\t\t\t\tthis.addSender(mailbox);\n\t\t\t\t}\n\n\t\t\t\tBX.SidePanel.Instance.getTopSlider().close();\n\t\t\t\tif (!this.senderId && !this.addSender)\n\t\t\t\t{\n\t\t\t\t\tAliasEditor.openSlider({\n\t\t\t\t\t\tsenderId: data.senderId,\n\t\t\t\t\t\temail: this.email,\n\t\t\t\t\t\tsetSenderCallback: this.setSender,\n\t\t\t\t\t\tonClose: this.onCloseAction,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.#showAlertNode(response.errors[0].message);\n\t\t\t\tbutton.setClocking(false);\n\t\t\t})\n\t\t;\n\t}\n\n\t#disconnect(): void\n\t{\n\t\tDom.addClass(this.disconnectButton, 'ui-btn-wait');\n\t\tajax.runAction(\n\t\t\t'main.api.mail.sender.deleteSender',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tsenderId: this.senderId,\n\t\t\t\t},\n\t\t\t},\n\t\t).then(() => {\n\t\t\tDom.removeClass(this.disconnectButton, 'ui-btn-wait');\n\t\t\tSidePanel.Instance.getTopSlider().close();\n\t\t\ttop.BX.SidePanel.Instance.postMessage(\n\t\t\t\twindow,\n\t\t\t\tdeleteMessage,\n\t\t\t\t{\n\t\t\t\t\tid: this.senderId,\n\t\t\t\t\ttype: senderType,\n\t\t\t\t},\n\t\t\t);\n\t\t}).catch(() => {\n\t\t\tDom.removeClass(this.disconnectButton, 'ui-btn-wait');\n\t\t});\n\t}\n\n\t#saveSender(): Promise\n\t{\n\t\tthis.email = this.emailField.value;\n\n\t\tconst data = {\n\t\t\tid: this.senderId ?? null,\n\t\t\tname: this.nameField.value,\n\t\t\temail: this.email,\n\t\t\tsmtp: {},\n\t\t\tpublic: this.accessField.checked ? 'Y' : 'N',\n\t\t};\n\n\t\tdata.smtp = {\n\t\t\tserver: this.serverField.value,\n\t\t\tport: this.portField.value,\n\t\t\tssl: this.sslField.checked ? this.sslField.value : '',\n\t\t\tlogin: this.emailField.value,\n\t\t\tpassword: this.passwordField.value,\n\t\t\tlimit: this.senderLimitCheckbox.checked ? this.senderLimitField.value : null,\n\t\t};\n\n\t\treturn ajax.runAction('main.api.mail.sender.submitSender', {\n\t\t\tdata: { data },\n\t\t}).then((response) => {\n\t\t\treturn response;\n\t\t});\n\t}\n\n\t#createContentContainer(): void\n\t{\n\t\tthis.#createAlertNode();\n\t\tthis.#createSenderSection();\n\t\tthis.#createSmtpServerSection();\n\t\tthis.#createLimitSection();\n\n\t\tthis.contentContainer = Tag.render`\n\t\t\t<div class=\"ui-form\">\n\t\t\t\t${this.alertNode}\n\t\t\t\t${this.senderSection}\n\t\t\t\t${this.smtpServerSection}\n\t\t\t\t${this.limitSection}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetContentContainer(): HTMLElement\n\t{\n\t\treturn this.contentContainer;\n\t}\n\n\t#createAlertNode(): void\n\t{\n\t\tthis.alertNode = Tag.render`\n\t\t\t<div class=\"ui-alert ui-alert-danger ui-alert-icon-warning\" style=\"display: none\">\n\t\t\t\t<span class=\"ui-alert-message\"></span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createSenderSection(): void\n\t{\n\t\tconst { root, nameField, accessField } = Tag.render`\n\t\t\t<div class=\"ui-slider-section\">\n\t\t\t\t<div class=\"ui-slider-content-box\">\n\t\t\t\t\t<div class=\"ui-slider-heading-4\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_SENDER_MAIN_SECTION_TITLE')}</div>\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-ctl-top smtp-sender-name\">\n\t\t\t\t\t\t\t<div class=\"ui-form-label\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_SENDER_NAME')}</div>\n\t\t\t\t\t\t\t<span data-hint=\"${Loc.getMessage('UI_MAIL_SMTP_SLIDER_NAME_HINT')}\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-row-inline ui-ctl-w100\">\n\t\t\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t\t\t\t<input type=\"text\" data-name=\"name\" value=\"\" class=\"ui-ctl-element\" ref=\"nameField\">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"ui-ctl-element\" data-name=\"access\" ref=\"accessField\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_SENDER_AVAILABLE_TOGGLE')}</div>\n\t\t\t\t\t\t\t\t\t<span data-hint=\"${Loc.getMessage('UI_MAIL_SMTP_SLIDER_SENDER_AVAILABLE_TOGGLE_HINT')}\"></span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tthis.senderSection = root;\n\t\tthis.nameField = nameField;\n\t\tthis.accessField = accessField;\n\n\t\tthis.hintInstence = top.BX.UI.Hint?.createInstance();\n\t\tthis.hintInstence.init(this.senderSection);\n\t}\n\n\t#createSmtpServerSection(): void\n\t{\n\t\tthis.#createSmtpEmailRow();\n\t\tthis.#createSmtpServerRow();\n\t\tthis.#createSmtpPortAndSafeConnectionRow();\n\t\tthis.#createSmtpPasswordRow();\n\n\t\tthis.smtpServerSection = Tag.render`\n\t\t\t<div class=\"ui-slider-section\">\n\t\t\t\t<div class=\"ui-slider-content-box\">\n\t\t\t\t\t<div class=\"ui-slider-heading-4\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_SMTP_SECTION_TITLE')}</div>\n\t\t\t\t\t${this.smtpServerRow}\n\t\t\t\t\t${this.smtpPortAndSafeConnectionRow}\n\t\t\t\t\t${this.smtpEmailRow}\n\t\t\t\t\t${this.smtpPasswordRow}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createSmtpEmailRow(): void\n\t{\n\t\tconst { root, emailField } = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-ctl-top\">\n\t\t\t\t\t<div class=\"ui-form-label\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_EMAIL')}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t<input type=\"email\" name=\"email\" class=\"ui-ctl-element\" data-name=\"email\" placeholder=\"info@example.com\" ref=\"emailField\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.smtpEmailRow = root;\n\t\tthis.emailField = emailField;\n\t}\n\n\t#createSmtpServerRow(): void\n\t{\n\t\tconst { root, serverField } = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-ctl-top\">\n\t\t\t\t\t<div class=\"ui-form-label\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_SERVER')}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t<input type=\"text\" name=\"server\" class=\"ui-ctl-element\" data-name=\"server\" placeholder=\"smtp.example.com\" ref=\"serverField\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.smtpServerRow = root;\n\t\tthis.serverField = serverField;\n\t}\n\n\t#createSmtpPortAndSafeConnectionRow(): void\n\t{\n\t\tconst { root, portField, sslField } = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-ctl-top\">\n\t\t\t\t\t<div class=\"ui-form-label\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_PORT')}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row-inline\" style=\"margin-bottom: 0\">\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t\t<input type=\"text\" \n\t\t\t\t\t\t\tclass=\"ui-ctl-element\" \n\t\t\t\t\t\t\tdata-name=\"port\" \n\t\t\t\t\t\t\tplaceholder=\"555\"\n\t\t\t\t\t\t\tref=\"portField\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox\">\n\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"ui-ctl-element\" value=\"Y\" data-name=\"ssl\" ref=\"sslField\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_SSL')}</div>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.smtpPortAndSafeConnectionRow = root;\n\t\tthis.portField = portField;\n\t\tthis.sslField = sslField;\n\t}\n\n\t#createSmtpPasswordRow(): void\n\t{\n\t\tconst { root, passwordField } = Tag.render`\n\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t<div class=\"ui-ctl-top\">\n\t\t\t\t\t<div class=\"ui-form-label\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_PASSWORD')}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t<input type=\"password\" class=\"ui-ctl-element\" data-name=\"password\" ref=\"passwordField\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.smtpPasswordRow = root;\n\t\tthis.passwordField = passwordField;\n\t}\n\n\t#createLimitSection(): void\n\t{\n\t\tconst { root, senderLimitCheckbox, senderLimitField } = Tag.render`\n\t\t\t<div class=\"ui-slider-section\">\n\t\t\t\t<div class=\"ui-slider-content-box\">\n\t\t\t\t\t<div class=\"ui-slider-heading-4\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_SENDER_LIMIT_SECTION_TITLE')}</div>\n\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t<div class=\"ui-form-label\" data-form-row-hidden=\"\">\n\t\t\t\t\t\t\t<label class=\"ui-ctl ui-ctl-checkbox smtp-editor-limit-checkbox\">\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" class=\"ui-ctl-element\" data-name=\"hasLimit\" ref=\"senderLimitCheckbox\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_SENDER_LIMIT_SETTINGS')}</div>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"ui-form-row-hidden\">\n\t\t\t\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-top\">\n\t\t\t\t\t\t\t\t\t<div class=\"ui-form-label\">${Loc.getMessage('UI_MAIL_SMTP_SLIDER_SENDER_LIMIT_TITLE')}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w25\">\n\t\t\t\t\t\t\t\t\t<input type=\"number\" class=\"ui-ctl-element\" data-name=\"limit\" value=\"250\" min=\"0\" ref=\"senderLimitField\">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.limitSection = root;\n\t\tthis.senderLimitCheckbox = senderLimitCheckbox;\n\t\tthis.senderLimitField = senderLimitField;\n\t}\n\n\t#showAlertNode(message: string = null): void\n\t{\n\t\tif (message)\n\t\t{\n\t\t\tconst spanNode = this.alertNode.querySelector('span');\n\t\t\tspanNode.textContent = message;\n\t\t}\n\n\t\tDom.style(this.alertNode, 'display', 'block');\n\t}\n\n\t#hideAlertNode(): void\n\t{\n\t\tDom.style(this.alertNode, 'display', 'none');\n\t}\n\n\t#prepareNecessaryFields(): void\n\t{\n\t\tthis.requiredFields = [\n\t\t\t{ row: this.smtpEmailRow, input: this.emailField, type: 'email' },\n\t\t\t{ row: this.smtpServerRow, input: this.serverField, type: 'server' },\n\t\t\t{ row: this.smtpPortAndSafeConnectionRow, input: this.portField, type: 'port' },\n\t\t];\n\n\t\tif (!this.senderId)\n\t\t{\n\t\t\tthis.requiredFields.push({\n\t\t\t\trow: this.smtpPasswordRow,\n\t\t\t\tinput: this.passwordField,\n\t\t\t\ttype: 'pass',\n\t\t\t});\n\t\t}\n\t}\n\n\t#hasInvalidFields(): boolean\n\t{\n\t\tlet count = 0;\n\t\tthis.requiredFields.forEach((field) => {\n\t\t\tif (!this.#isInvalidField(field.type, field.input.value))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcount++;\n\t\t\tDom.addClass(field.row, 'ui-ctl-warning');\n\t\t\tconst errorMessage = this.#getErrorMessage(field.type, field.input.value);\n\t\t\tconst invalidField = Tag.render`\n\t\t\t\t<div class=\"ui-mail-field-error-message ui-ctl-bottom\">${errorMessage}</div>\n\t\t\t`;\n\t\t\tDom.append(invalidField, field.row);\n\n\t\t\tif (this.topEmptyNode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.topEmptyNode = field.row;\n\t\t\tthis.topEmptyNode.scrollIntoView();\n\t\t});\n\n\t\treturn count > 0;\n\t}\n\n\t#clearInvalidFields(): void\n\t{\n\t\tif (!this.requiredFields)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requiredFields.forEach((field) => {\n\t\t\tDom.removeClass(field.row, 'ui-ctl-warning');\n\t\t\tconst errorMessageFiled = field.row.querySelector('.ui-mail-field-error-message');\n\t\t\tif (Type.isDomNode(errorMessageFiled))\n\t\t\t{\n\t\t\t\tDom.remove(errorMessageFiled);\n\t\t\t}\n\t\t});\n\t\tthis.topEmptyNode = null;\n\t\tthis.invalidFieldNode?.remove();\n\t}\n\n\t#isInvalidField(type: string, input: string | number): boolean\n\t{\n\t\tif (input.length === 0)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (type === 'port'\n\t\t\t&& (\n\t\t\t\t!Number.isInteger(Number(input))\n\t\t\t\t|| input < 0\n\t\t\t\t|| input > 65535\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn type === 'email' && !emailRegularEx.test(input);\n\t}\n\n\t#getErrorMessage(type: string, input: string | number): string\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase 'email':\n\t\t\t\tif (Type.isString(input) && input.length > 0)\n\t\t\t\t{\n\t\t\t\t\treturn Loc.getMessage('UI_MAIL_SMTP_SLIDER_INVALID_EMAIL');\n\t\t\t\t}\n\n\t\t\t\treturn Loc.getMessage('UI_MAIL_SMTP_SLIDER_EMPTY_EMAIL');\n\t\t\tcase 'server':\n\t\t\t\treturn Loc.getMessage('UI_MAIL_SMTP_SLIDER_EMPTY_SERVER');\n\t\t\tcase 'port':\n\t\t\t\treturn Loc.getMessage('UI_MAIL_SMTP_SLIDER_INVALID_PORT');\n\t\t\tdefault:\n\t\t\t\treturn Loc.getMessage('UI_MAIL_SMTP_SLIDER_EMPTY_PASSWORD');\n\t\t}\n\t}\n\n\t#setUserName(name: string)\n\t{\n\t\tthis.nameField.value = name;\n\t}\n}\n","import { Layout } from 'ui.sidepanel.layout';\nimport { ajax, Dom, Event, Loc, Tag, Text } from 'main.core';\nimport { SmtpEditor } from './smtp-editor';\nimport { Button } from 'ui.buttons';\nimport './css/style.css';\nimport 'ui.forms';\nimport 'ui.layout-form';\nimport 'ui.sidepanel-content';\nimport 'ui.entity-selector';\nimport 'ui.icon-set.actions';\nimport 'ui.icon-set.main';\n\ntype Sender = {\n\tid: number,\n\tname: string,\n\tuserId: number | null,\n\tisOwner: boolean,\n\ttype: string,\n\tmailboxId: number | null,\n\tcanEdit: boolean,\n\teditHref: string | null,\n\tavatar: string | null,\n\tuserUrl: string | null,\n}\n\ntype Options = {\n\tsenderId: number,\n\temail: string,\n\tsetSenderCallback?: Function,\n\tupdateSenderList?: () => void,\n}\n\nconst mailboxType = 'mailbox';\nconst senderType = 'sender';\nconst mailboxSenderType = 'mailboxSender';\nconst aliasType = 'alias';\nconst successSubmitMessage = 'mail-mailbox-config-success';\nconst deleteMessage = 'mail-mailbox-config-delete';\nconst aliasSliderUrl = 'mailAliasSlider';\n\nexport class AliasEditor\n{\n\twasSenderUpdated: boolean = false;\n\tconstructor(options: Options)\n\t{\n\t\tthis.senderId = Number(options.senderId);\n\t\tthis.email = options.email;\n\t\tthis.setSender = options.setSenderCallback;\n\t\tthis.updateSenderList = options.updateSenderList;\n\t\tthis.#createContentContainer();\n\t\tthis.#createToolbarButtons();\n\t}\n\n\tstatic openSlider(options: Options): void\n\t{\n\t\tconst instance = new AliasEditor(options);\n\t\tconst onSliderMessage = function(event) {\n\t\t\tconst [sliderEvent] = event.getData();\n\t\t\tif (!sliderEvent)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst eventMessage = sliderEvent.getEventId();\n\t\t\tconst data = sliderEvent.getData();\n\t\t\tconst mailboxId = Number(sliderEvent.data.id);\n\t\t\tconst slider = BX.SidePanel.Instance.getSlider(aliasSliderUrl);\n\t\t\tif (eventMessage === successSubmitMessage)\n\t\t\t{\n\t\t\t\tinstance.wasSenderUpdated = true;\n\t\t\t\tinstance.updateMainSenderName(mailboxId);\n\n\t\t\t\tif (slider)\n\t\t\t\t{\n\t\t\t\t\tslider.close();\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (eventMessage === deleteMessage)\n\t\t\t{\n\t\t\t\tinstance.wasSenderUpdated = true;\n\t\t\t\tif (instance.id === Number(mailboxId))\n\t\t\t\t{\n\t\t\t\t\tinstance.setSender();\n\t\t\t\t}\n\n\t\t\t\tif (slider)\n\t\t\t\t{\n\t\t\t\t\tslider.close();\n\t\t\t\t}\n\n\t\t\t\tif (data && data.type !== senderType)\n\t\t\t\t{\n\t\t\t\t\tBX.SidePanel.Instance.postMessage(window, sliderEvent.getEventId(), sliderEvent.getData);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tBX.SidePanel.Instance.open(aliasSliderUrl, {\n\t\t\twidth: 680,\n\t\t\tcacheable: false,\n\t\t\tcontentCallback: () => {\n\t\t\t\treturn Layout.createContent({\n\t\t\t\t\textensions: [\n\t\t\t\t\t\t'ui.mail.sender-editor',\n\t\t\t\t\t],\n\t\t\t\t\ttitle: options.email,\n\t\t\t\t\tdesign: {\n\t\t\t\t\t\tsection: false,\n\t\t\t\t\t\tmargin: false,\n\t\t\t\t\t},\n\t\t\t\t\tcontent(): Promise\n\t\t\t\t\t{\n\t\t\t\t\t\treturn instance.loadSliderContent();\n\t\t\t\t\t},\n\t\t\t\t\ttoolbar(): Array\n\t\t\t\t\t{\n\t\t\t\t\t\treturn instance.getToolbarButtons();\n\t\t\t\t\t},\n\t\t\t\t\tbuttons: () => {},\n\t\t\t\t});\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\ttop.BX.Event.EventEmitter.unsubscribe('SidePanel.Slider:onMessage', onSliderMessage);\n\t\t\t\t\tif (instance.updateSenderList && instance.wasSenderUpdated)\n\t\t\t\t\t{\n\t\t\t\t\t\tinstance.updateSenderList();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\ttop.BX.Event.EventEmitter.subscribe('SidePanel.Slider:onMessage', onSliderMessage);\n\t}\n\n\tgetContentContainer(): HTMLElement\n\t{\n\t\treturn this.contentContainer;\n\t}\n\n\tgetToolbarButtons(): Array\n\t{\n\t\tconst buttons = [];\n\n\t\tif (this.settingsButton)\n\t\t{\n\t\t\tbuttons.push(this.settingsButton);\n\t\t}\n\n\t\treturn buttons;\n\t}\n\n\tloadSliderContent(): Promise\n\t{\n\t\treturn BX.ajax.runAction(\n\t\t\t'main.api.mail.sender.getSenderTransitionalData',\n\t\t\t{\n\t\t\t\tdata: { senderId: this.senderId },\n\t\t\t},\n\t\t).then((response) => {\n\t\t\tconst data = response.data;\n\t\t\tconst senders = data.senders;\n\t\t\tthis.id = Number(data.id);\n\t\t\tthis.email = data.email;\n\t\t\tthis.#addSenders(senders);\n\n\t\t\tconst type = data.type || null;\n\t\t\tswitch (type)\n\t\t\t{\n\t\t\t\tcase mailboxType:\n\t\t\t\t\tthis.settingsButton.bindEvent('click', () => {\n\t\t\t\t\t\tthis.#openMailboxSettings(data.href);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase senderType:\n\t\t\t\t\tthis.settingsButton.bindEvent('click', () => {\n\t\t\t\t\t\tthis.#openSmtpSettings(data.id);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.settingsButton.setDisabled();\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn this.getContentContainer();\n\t\t}).catch(() => {\n\t\t\tthis.settingsButton.setDisabled();\n\n\t\t\treturn this.getContentContainer();\n\t\t});\n\t}\n\n\t#createContentContainer(): void\n\t{\n\t\tthis.senderList = Tag.render`\n\t\t\t<div class=\"mail-sender-list\"></div>\n\t\t`;\n\n\t\tthis.#createAddSenderContainer();\n\n\t\tthis.contentContainer = Tag.render`\n\t\t\t<div class=\"ui-form\">\n\t\t\t\t<div class=\"ui-slider-section\">\n\t\t\t\t\t<div class=\"ui-slider-content-box\" style=\"margin-bottom: 0\">\n\t\t\t\t\t\t<div class=\"ui-slider-heading-4 sender-list-header\">${Text.encode(Loc.getMessage('UI_MAIL_ALIAS_SLIDER_EMAIL_TITLE'))}</div>\n\t\t\t\t\t\t${this.senderList}\n\t\t\t\t\t\t${this.addSenderContainer}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createAddSenderContainer(): void\n\t{\n\t\tthis.senderInput = Tag.render`\n\t\t\t<input type=\"text\" class=\"ui-ctl-element\" data-name=\"aliasName\" placeholder=\"${Text.encode(Loc.getMessage('UI_MAIL_ALIAS_SLIDER_ADD_INPUT_PLACEHOLDER'))}\">\n\t\t`;\n\t\tthis.senderInputContainer = Tag.render`\n\t\t\t<div class=\"add-sender-input-container\" hidden>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-default-light ui-ctl-sm ui-ctl-w100\">\n\t\t\t\t\t${this.senderInput}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.append(\n\t\t\tthis.#renderSubmitButton(\n\t\t\t\t() => {\n\t\t\t\t\treturn this.#addAliasPromise();\n\t\t\t\t},\n\t\t\t\tthis.senderInput,\n\t\t\t),\n\t\t\tthis.senderInputContainer,\n\t\t);\n\t\tDom.append(\n\t\t\tthis.#renderCancelButton(() => {\n\t\t\t\tDom.hide(this.senderInputContainer);\n\t\t\t\tDom.show(this.senderAddButton);\n\t\t\t\tthis.senderInput.value = null;\n\t\t\t}),\n\t\t\tthis.senderInputContainer,\n\t\t);\n\n\t\tthis.senderAddButton = Tag.render`\n\t\t\t<div class=\"add-sender-button\">${Text.encode(Loc.getMessage('UI_MAIL_ALIAS_SLIDER_ADD_BUTTON'))}</div>\n\t\t`;\n\t\tEvent.bind(this.senderAddButton, 'click', () => {\n\t\t\tDom.hide(this.senderAddButton);\n\t\t\tDom.show(this.senderInputContainer);\n\t\t\tthis.senderInput.focus();\n\t\t});\n\n\t\tthis.addSenderContainer = Tag.render`\n\t\t\t<div class=\"add-sender-container\">\n\t\t\t\t${this.senderInputContainer}\n\t\t\t\t${this.senderAddButton}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#addAliasPromise(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst hideInputContainer = () => {\n\t\t\t\tDom.hide(this.senderInputContainer);\n\t\t\t\tDom.show(this.senderAddButton);\n\t\t\t\tthis.senderInput.value = null;\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tif (this.senderInput.value.trim().length === 0)\n\t\t\t{\n\t\t\t\thideInputContainer();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.#hasNameInvalidCharacters(this.senderInput.value.trim()))\n\t\t\t{\n\t\t\t\tresolve();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst name = this.senderInput.value;\n\t\t\tajax.runAction(\n\t\t\t\t'main.api.mail.sender.addAlias',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tname,\n\t\t\t\t\t\temail: this.email,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then((response) => {\n\t\t\t\tconst data = response.data;\n\t\t\t\tconst newSenderId = data.senderId;\n\t\t\t\tif (this.setSender && data.senderId)\n\t\t\t\t{\n\t\t\t\t\tthis.setSender(data.senderId, name, this.email);\n\t\t\t\t}\n\t\t\t\tthis.wasSenderUpdated = true;\n\t\t\t\tthis.senderId = newSenderId;\n\t\t\t\tconst senderNode = this.#renderSenderItem({\n\t\t\t\t\tid: newSenderId,\n\t\t\t\t\tname,\n\t\t\t\t\tisOwner: true,\n\t\t\t\t\ttype: aliasType,\n\t\t\t\t\tcanEdit: true,\n\t\t\t\t});\n\t\t\t\tDom.append(senderNode, this.senderList);\n\t\t\t\thideInputContainer();\n\t\t\t}).catch(() => {\n\t\t\t\thideInputContainer();\n\t\t\t});\n\t\t});\n\t}\n\n\t#createToolbarButtons(): void\n\t{\n\t\tthis.settingsButton = new Button({\n\t\t\ttext: Loc.getMessage('UI_MAIL_ALIAS_SLIDER_MAIL_SETTINGS_BUTTON'),\n\t\t\ticon: Button.Icon.SETTING,\n\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t});\n\t}\n\n\t#renderSenderItem(sender: Sender): HTMLElement\n\t{\n\t\tconst itemContainer = Tag.render`<div class=\"sender-list-item\"></div>`;\n\t\tconst {\n\t\t\troot: nameContainer,\n\t\t\ttextNode: nameTextContainer,\n\t\t} = this.#renderSenderNameContainer(sender.name);\n\t\tlet handleShowEditInput = null;\n\n\t\tif (sender.canEdit)\n\t\t{\n\t\t\tconst {\n\t\t\t\tnameEditContainer,\n\t\t\t\teditInput: nameEditInput,\n\t\t\t} = this.#renderSenderEditNode(sender, nameTextContainer);\n\t\t\tDom.append(nameEditContainer, nameContainer);\n\t\t\thandleShowEditInput = () => {\n\t\t\t\tnameEditInput.value = nameContainer.innerText;\n\t\t\t\tDom.hide(nameTextContainer);\n\t\t\t\tDom.show(nameEditContainer);\n\t\t\t\tnameEditInput.focus();\n\t\t\t};\n\n\t\t\tEvent.bind(nameTextContainer, 'click', handleShowEditInput);\n\t\t}\n\t\tDom.append(nameContainer, itemContainer);\n\t\tDom.append(this.#renderSenderExtraInfoContainer(sender), itemContainer);\n\t\tDom.append(this.#renderSenderEditContainer(sender, itemContainer, handleShowEditInput), itemContainer);\n\n\t\tif (\n\t\t\t(sender.type === senderType && this.id === Number(sender.id))\n\t\t\t|| (sender.type === mailboxSenderType && this.id === Number(sender.mailboxId))\n\t\t)\n\t\t{\n\t\t\tthis.mainSenderNameNode = nameContainer.querySelector('.sender-item-name-text-container');\n\t\t}\n\n\t\treturn itemContainer;\n\t}\n\n\t#renderSenderNameContainer(senderName: string): { root: HTMLElement, textNode: HTMLElement}\n\t{\n\t\tconst { root, textNode } = Tag.render`\n\t\t\t<div class=\"sender-item-name-container\">\n\t\t\t\t<div class=\"sender-item-name-text-container\" ref=\"textNode\">\n\t\t\t\t\t${Text.encode(senderName)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn { root, textNode };\n\t}\n\n\t#renderSenderEditNode(\n\t\tsender: Sender,\n\t\tnameTextContainer: HTMLElement,\n\t): {nameEditContainer: HTMLElement, editInput: HTMLElement}\n\t{\n\t\tconst textContainer = nameTextContainer;\n\t\tconst { root, editInput } = Tag.render`\n\t\t\t<div class=\"edit-sender-container-content\" ref=\"editContent\">\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-default-light ui-ctl-sm ui-ctl-w100\">\n\t\t\t\t\t<input type=\"text\" class=\"ui-ctl-element\" ref=\"editInput\" placeholder=\"${Loc.getMessage('UI_MAIL_ALIAS_SLIDER_ADD_INPUT_PLACEHOLDER')}\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst nameEditContainer = root;\n\n\t\tconst submitPromise = () => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst hideEditContainer = () => {\n\t\t\t\t\teditInput.value = nameTextContainer.innerText;\n\t\t\t\t\tDom.hide(nameEditContainer);\n\t\t\t\t\tDom.show(textContainer);\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\n\t\t\t\tif (editInput.value.length === 0 || editInput.value === nameTextContainer.innerText)\n\t\t\t\t{\n\t\t\t\t\thideEditContainer();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.#hasNameInvalidCharacters(editInput.value))\n\t\t\t\t{\n\t\t\t\t\tresolve();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst senderNewName = editInput.value;\n\n\t\t\t\tajax.runAction(\n\t\t\t\t\t'main.api.mail.sender.updateSenderName',\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tsenderId: sender.id,\n\t\t\t\t\t\t\tname: senderNewName,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t).then(() => {\n\t\t\t\t\ttextContainer.innerText = senderNewName;\n\t\t\t\t\tif (this.setSender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setSender(sender.id, senderNewName, this.email);\n\t\t\t\t\t}\n\t\t\t\t\tthis.wasSenderUpdated = true;\n\t\t\t\t\thideEditContainer();\n\t\t\t\t}).catch(() => {\n\t\t\t\t\thideEditContainer();\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\tDom.append(this.#renderSubmitButton(submitPromise, editInput), root);\n\n\t\tconst cancelHandler = () => {\n\t\t\tDom.hide(nameEditContainer);\n\t\t\tDom.show(textContainer);\n\t\t\teditInput.value = null;\n\t\t};\n\t\tDom.append(this.#renderCancelButton(cancelHandler), root);\n\t\tDom.hide(root);\n\n\t\treturn { nameEditContainer, editInput };\n\t}\n\n\t#renderSenderExtraInfoContainer(sender: Sender): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sender-item-type-container\">${Text.encode(this.#getExtraInfoText(sender))}</div>\n\t\t`;\n\t}\n\n\t#getExtraInfoText(sender: Sender): string\n\t{\n\t\tif (\n\t\t\t(sender.type === senderType && this.id === Number(sender.id))\n\t\t\t|| (sender.type === mailboxSenderType && this.id === Number(sender.mailboxId))\n\t\t)\n\t\t{\n\t\t\treturn Loc.getMessage('UI_MAIL_ALIAS_EDITOR_CURRENT_SENDER_NAME');\n\t\t}\n\n\t\tif ([senderType, mailboxSenderType].includes(sender.type) && sender.isOwner)\n\t\t{\n\t\t\treturn Loc.getMessage('UI_MAIL_ALIAS_EDITOR_ANOTHER_SENDER_NAME');\n\t\t}\n\n\t\tif (sender.type === aliasType && sender.isOwner)\n\t\t{\n\t\t\treturn Loc.getMessage('UI_MAIL_ALIAS_EDITOR_ADDITIONAL_SENDER_NAME');\n\t\t}\n\n\t\treturn '';\n\t}\n\n\t#renderSenderEditContainer(sender: Sender, senderNode: HTMLElement, handleShowInput: null | () => void): HTMLElement\n\t{\n\t\tconst senderEditContainer = Tag.render`\n\t\t\t<div class=\"sender-item-edit-container\"></div>\n\t\t`;\n\n\t\tif (!sender.isOwner)\n\t\t{\n\t\t\tDom.append(this.#renderUserInfoNode(sender.userUrl, sender.avatar), senderEditContainer);\n\n\t\t\treturn senderEditContainer;\n\t\t}\n\n\t\tconst senderNameEditButton = Tag.render`\n\t\t\t<div class=\"sender-item-btn ui-btn ui-btn-xs ui-icon-set --pencil-50\"></div>\n\t\t`;\n\t\tDom.append(senderNameEditButton, senderEditContainer);\n\n\t\tif (handleShowInput)\n\t\t{\n\t\t\tEvent.bind(senderNameEditButton, 'click', handleShowInput);\n\t\t}\n\n\t\tif (sender.type === aliasType)\n\t\t{\n\t\t\tDom.append(this.#renderDeleteButton(sender.id, senderNode), senderEditContainer);\n\n\t\t\treturn senderEditContainer;\n\t\t}\n\n\t\tDom.append(this.#renderSettingsButton(sender.type, sender.id, sender.editHref), senderEditContainer);\n\n\t\treturn senderEditContainer;\n\t}\n\n\t#renderUserInfoNode(userUrl: string, avatar: string | null): HTMLElement\n\t{\n\t\tconst { root, userAvatarContainer } = Tag.render`\n\t\t\t<div class=\"sender-item-owner-info\">\n\t\t\t\t${Loc.getMessage('UI_MAIL_ALIAS_EDITOR_ANOTHER_USER_SENDER_NAME')}\n\t\t\t\t<a href=\"${Text.encode(userUrl)}\" class=\"ui-icon ui-icon-common-user sender-item-owner-avatar\" ref=\"userAvatarContainer\"></a> \n\t\t\t</div>\n\t\t`;\n\t\tlet avatarIcon = '';\n\t\tif (avatar)\n\t\t{\n\t\t\tavatarIcon = Tag.render`<i style=\"background-image: url('${Text.encode(avatar)}')\"></i>`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tavatarIcon = Tag.render`<div class=\"sender-item-owner-avatar-icon ui-icon-set --person\"></div>`;\n\t\t}\n\t\tDom.append(avatarIcon, userAvatarContainer);\n\n\t\treturn root;\n\t}\n\n\t#renderDeleteButton(senderId: number, senderNode: HTMLElement): HTMLElement\n\t{\n\t\tconst deleteButton = Tag.render`\n\t\t\t<div class=\"sender-item-btn ui-btn ui-btn-xs ui-icon-set --trash-bin\" style=\"margin: 0\"></div>\n\t\t`;\n\n\t\tEvent.bind(deleteButton, 'click', () => {\n\t\t\tDom.removeClass(deleteButton, ['ui-icon-set', '--trash-bin']);\n\t\t\tDom.addClass(deleteButton, ['ui-btn-light', 'ui ui-btn-wait']);\n\t\t\tajax.runAction(\n\t\t\t\t'main.api.mail.sender.deleteSender',\n\t\t\t\t{\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tsenderId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then(() => {\n\t\t\t\tsenderNode.remove();\n\t\t\t\tthis.wasSenderUpdated = true;\n\t\t\t\tif (Number(senderId) === this.senderId)\n\t\t\t\t{\n\t\t\t\t\tthis.setSender();\n\t\t\t\t}\n\t\t\t}).catch(() => {\n\t\t\t\tDom.removeClass(deleteButton, 'ui-btn-wait');\n\t\t\t});\n\t\t});\n\n\t\treturn deleteButton;\n\t}\n\n\t#renderSettingsButton(type: string, senderId: number | string, editHref: string | null): HTMLElement\n\t{\n\t\tconst editButton = Tag.render`\n\t\t\t<div class=\"sender-item-btn ui-btn ui-btn-xs ui-icon-set --settings-1\" style=\"margin: 0\"></div>\n\t\t`;\n\n\t\tif (type === mailboxSenderType)\n\t\t{\n\t\t\tEvent.bind(editButton, 'click', () => {\n\t\t\t\tthis.#openMailboxSettings(editHref);\n\t\t\t});\n\n\t\t\treturn editButton;\n\t\t}\n\n\t\tEvent.bind(editButton, 'click', () => {\n\t\t\tthis.#openSmtpSettings(senderId);\n\t\t});\n\n\t\treturn editButton;\n\t}\n\n\t#renderSubmitButton(submitPromise: Promise, targetElement: HTMLInputElement): HTMLElement\n\t{\n\t\tconst submitButton = Tag.render`\n\t\t\t<div class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-icon-done\" style=\"margin: 0\"></div>\n\t\t`;\n\t\tEvent.bind(submitButton, 'click', () => {\n\t\t\tDom.addClass(submitButton, 'ui ui-btn-wait');\n\t\t\tsubmitPromise()\n\t\t\t\t.then(() => {\n\t\t\t\t\tDom.removeClass(submitButton, 'ui-btn-wait');\n\t\t\t\t})\n\t\t\t\t.catch(() => {})\n\t\t\t;\n\t\t});\n\t\tEvent.bind(targetElement, 'keypress', (event: KeyboardEvent) => {\n\t\t\tif (event.key === 'Enter')\n\t\t\t{\n\t\t\t\tsubmitButton.click();\n\t\t\t}\n\t\t});\n\n\t\treturn submitButton;\n\t}\n\n\t#renderCancelButton(cancelHandler: () => void): HTMLElement\n\t{\n\t\tconst cancelButton = Tag.render`\n\t\t\t<div class=\"sender-item-btn ui-btn ui-btn-xs ui-icon-set --cross-45\" style=\"margin: 0\"></div>\n\t\t`;\n\n\t\tEvent.bind(cancelButton, 'click', cancelHandler);\n\n\t\treturn cancelButton;\n\t}\n\n\t#addSenders(senders: Sender[] | null): void\n\t{\n\t\tif (!senders)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tsenders.sort((a, b) => a.id - b.id);\n\t\tsenders.forEach((sender: Sender) => {\n\t\t\tconst senderNode = this.#renderSenderItem(sender);\n\t\t\tDom.append(senderNode, this.senderList);\n\t\t});\n\t}\n\n\t#openSmtpSettings(senderId: number | string): void\n\t{\n\t\tSmtpEditor.openSlider({\n\t\t\tsenderId: Number(senderId),\n\t\t\tsetSenderCallback: (id: number | string, name: string, email: string) => {\n\t\t\t\tif (this.mainSenderNameNode)\n\t\t\t\t{\n\t\t\t\t\tthis.mainSenderNameNode.innerText = name;\n\t\t\t\t}\n\t\t\t\tthis.setSender(id, name, email);\n\t\t\t\tthis.wasSenderUpdated = true;\n\t\t\t},\n\t\t});\n\t}\n\n\t#openMailboxSettings(href: string): void\n\t{\n\t\tBX.SidePanel.Instance.open(href);\n\t}\n\n\t#hasNameInvalidCharacters(name: string): boolean\n\t{\n\t\t// regex checks for characters other than letters of the alphabet, numbers, spaces\n\t\t// and special characters (\"-\", \".\", \"'\", \"(\", \")\", \",\")\n\t\tconst regexForInvalidCharacters = /[^\\p{L}\\p{N}\\p{Zs}\\-.'(),]+/ug;\n\n\t\tif (regexForInvalidCharacters.test(name))\n\t\t{\n\t\t\ttop.BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(Loc.getMessage('UI_MAIL_ALIAS_EDITOR_INVALID_SYMBOLS_NOTIFICATION')),\n\t\t\t});\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tupdateMainSenderName(mailboxId: number): void\n\t{\n\t\treturn BX.ajax.runAction(\n\t\t\t'main.api.mail.sender.getSenderByMailboxId',\n\t\t\t{\n\t\t\t\tdata: { mailboxId },\n\t\t\t},\n\t\t)\n\t\t\t.then((response) => {\n\t\t\t\tconst name = response.data?.name;\n\t\t\t\tif (!name || !this.mainSenderNameNode)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.mainSenderNameNode.innerText = name;\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n}\n"],"names":["SidePanel","BX","emailRegularEx","deleteMessage","senderType","SmtpEditor","constructor","options","senderId","Type","isInteger","title","Loc","getMessage","setSender","setSenderCallback","addSender","addSenderCallback","onCloseAction","onClose","openSlider","instance","Instance","open","width","cacheable","contentCallback","getContentCallback","events","onLoad","ready","LayoutForm","container","limitSection","Layout","createContent","extensions","design","section","margin","content","loadSender","ajax","runAction","then","response","data","getContentContainer","catch","buttons","cancelButton","Button","buttonArray","saveButton","SaveButton","onclick","push","disconnectButton","text","color","UI","Color","DANGER","contentContainer","senderData","nameField","value","name","accessField","checked","isPublic","emailField","email","serverField","server","portField","port","protocol","sslField","isNumber","limit","senderLimitCheckbox","senderLimitField","top","Dialogs","MessageBox","show","message","modal","MessageBoxButtons","OK_CANCEL","onOk","messageBox","close","onCancel","button","setClocking","mailbox","getTopSlider","AliasEditor","errors","Dom","addClass","removeClass","postMessage","window","id","type","smtp","public","ssl","login","password","passwordField","Tag","render","alertNode","senderSection","smtpServerSection","root","hintInstence","Hint","createInstance","init","smtpServerRow","smtpPortAndSafeConnectionRow","smtpEmailRow","smtpPasswordRow","spanNode","querySelector","textContent","style","requiredFields","row","input","count","forEach","field","errorMessage","invalidField","append","topEmptyNode","scrollIntoView","errorMessageFiled","isDomNode","remove","invalidFieldNode","length","Number","test","isString","mailboxType","mailboxSenderType","aliasType","successSubmitMessage","aliasSliderUrl","wasSenderUpdated","updateSenderList","onSliderMessage","event","sliderEvent","getData","eventMessage","getEventId","mailboxId","slider","getSlider","updateMainSenderName","loadSliderContent","toolbar","getToolbarButtons","Event","EventEmitter","unsubscribe","subscribe","settingsButton","senders","bindEvent","href","setDisabled","mainSenderNameNode","innerText","senderList","Text","encode","addSenderContainer","senderInput","senderInputContainer","hide","senderAddButton","bind","focus","Promise","resolve","hideInputContainer","trim","newSenderId","senderNode","isOwner","canEdit","icon","Icon","SETTING","LIGHT_BORDER","sender","itemContainer","nameContainer","textNode","nameTextContainer","handleShowEditInput","nameEditContainer","editInput","nameEditInput","senderName","textContainer","submitPromise","hideEditContainer","senderNewName","cancelHandler","includes","handleShowInput","senderEditContainer","userUrl","avatar","senderNameEditButton","editHref","userAvatarContainer","avatarIcon","deleteButton","editButton","targetElement","submitButton","key","click","sort","a","b","regexForInvalidCharacters","Notification","Center","notify"],"mappings":"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"}