{"version":3,"file":"counters.bundle.js","sources":["../src/counters.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { CounterPanel } from 'ui.counterpanel';\nimport { EventEmitter } from 'main.core.events';\n\nexport class Counters extends CounterPanel\n{\n\tconstructor(options)\n\t{\n\t\tsuper({\n\t\t\ttarget: options.countersWrap,\n\t\t\titems: Counters.getCountersValue(options.counters),\n\t\t\tmultiselect: false,\n\t\t});\n\t\t\n\t\tthis.search = options.search;\n\t\tthis.userId = options.userId;\n\t\tthis.counters = options.counters;\n\t\tthis.countersWrap = options.countersWrap;\n\t\t\n\t\tthis.bindEvents();\n\t\t\n\t}\n\t\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:activate', this.onActivateItem.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:deactivate', this.onDeactivateItem.bind(this));\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t}\n\t\n\tonActivateItem(event)\n\t{\n\t\tconst item = event.getData();\n\t\t\n\t\tif (item.id === 'invitation')\n\t\t{\n\t\t\tthis.search.setPresetInvitation();\n\t\t}\n\t}\n\t\n\tonDeactivateItem(event)\n\t{\n\t\tthis.search.resetPreset();\n\t}\n\t\n\trecalculateCounters()\n\t{\n\t\tObject.entries(this.counters).forEach(([code, data]) => {\n\t\t\tconst item = this.getItemById(code);\n\t\t\titem.updateValue(data.value);\n\t\t\titem.updateColor(data.color);\n\t\t})\n\t}\n\t\n\tmarkCounters()\n\t{\n\t\tObject.entries(this.counters).forEach(([code, data]) => {\n\t\t\tconst item = this.getItemById(code);\n\t\t\t\n\t\t\tif (item.id === 'invitation')\n\t\t\t{\n\t\t\t\tthis.fields['MEETING_STATUS'] === 'Q'\n\t\t\t\t\t? item.activate(false)\n\t\t\t\t\t: item.deactivate(false)\n\t\t\t\t;\n\t\t\t}\n\t\t})\n\t}\n\t\n\tsetCountersValue(counters)\n\t{\n\t\tthis.counters = counters;\n\t\tthis.recalculateCounters();\n\t}\n\t\n\tonFilterApply()\n\t{\n\t\tthis.fields = this.search.filter.getFilterFieldsValues();\n\t\tthis.markCounters();\n\t}\n\t\n\tstatic getCountersValue(counters)\n\t{\n\t\treturn Object.entries(counters).map(([code, item]) => {\n\t\t\treturn {\n\t\t\t\tid: code,\n\t\t\t\ttitle: Counters.getCountersName(code),\n\t\t\t\tvalue: item.value,\n\t\t\t\tcolor: item.color,\n\t\t\t};\n\t\t});\n\t}\n\n\tstatic getCountersName(type)\n\t{\n\t\tif (type === 'invitation')\n\t\t{\n\t\t\treturn Loc.getMessage('EC_COUNTER_INVITATION');\n\t\t}\n\t}\n}"],"names":["Counters","CounterPanel","constructor","options","target","countersWrap","items","getCountersValue","counters","multiselect","search","userId","bindEvents","EventEmitter","subscribe","onActivateItem","bind","onDeactivateItem","onFilterApply","event","item","getData","id","setPresetInvitation","resetPreset","recalculateCounters","Object","entries","forEach","code","data","getItemById","updateValue","value","updateColor","color","markCounters","fields","activate","deactivate","setCountersValue","filter","getFilterFieldsValues","map","title","getCountersName","type","Loc","getMessage"],"mappings":"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"}