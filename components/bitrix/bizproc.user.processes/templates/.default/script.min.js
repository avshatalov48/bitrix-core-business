this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,s,t,l,r,a,i,o,n,d,c){"use strict";var b=babelHelpers.classPrivateFieldLooseKey("runComponentAction");class p{constructor(){Object.defineProperty(this,b,{value:u})}loadWorkflows(e){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]("loadWorkflows",{ids:e})}}function u(e,s={}){return new Promise(((t,l)=>{d.ajax.runComponentAction("bitrix:bizproc.user.processes",e,{mode:"class",data:s}).catch((e=>{l(e)})).then((e=>{t(e)}))}))}let h=e=>e,v,P,f,m,B;var w=babelHelpers.classPrivateFieldLooseKey("currentUserId");var g=babelHelpers.classPrivateFieldLooseKey("targetUserId");var L=babelHelpers.classPrivateFieldLooseKey("data");var T=babelHelpers.classPrivateFieldLooseKey("task");var F=babelHelpers.classPrivateFieldLooseKey("inlineTaskView");var k=babelHelpers.classPrivateFieldLooseKey("faces");var y=babelHelpers.classPrivateFieldLooseKey("getWorkflowInfoUrl");class I{constructor(e){Object.defineProperty(this,y,{value:H});Object.defineProperty(this,w,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,T,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e.workflow;babelHelpers.classPrivateFieldLooseBase(this,w)[w]=d.Type.isNumber(e.currentUserId)?e.currentUserId:0;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=babelHelpers.classPrivateFieldLooseBase(this,L)[L].userId;if(babelHelpers.classPrivateFieldLooseBase(this,L)[L].task){babelHelpers.classPrivateFieldLooseBase(this,T)[T]=new a.Task(babelHelpers.classPrivateFieldLooseBase(this,L)[L].task);if(d.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,T)[T].controls.buttons)){babelHelpers.classPrivateFieldLooseBase(this,T)[T].setButtons(babelHelpers.classPrivateFieldLooseBase(this,T)[T].buttons.map((s=>({onclick:()=>e.userProcesses.doTask({taskId:babelHelpers.classPrivateFieldLooseBase(this,T)[T].id,workflowId:babelHelpers.classPrivateFieldLooseBase(this,L)[L].workflowId,taskName:babelHelpers.classPrivateFieldLooseBase(this,T)[T].name,taskRequest:{[s.NAME]:s.VALUE}}),...s}))))}babelHelpers.classPrivateFieldLooseBase(this,F)[F]=new a.InlineTaskView({task:babelHelpers.classPrivateFieldLooseBase(this,T)[T],responsibleUser:babelHelpers.classPrivateFieldLooseBase(this,g)[g]})}}renderProcess(){var e,s,t,l;const r=d.Type.isString((e=babelHelpers.classPrivateFieldLooseBase(this,L)[L])==null?void 0:e.name)?babelHelpers.classPrivateFieldLooseBase(this,L)[L].name:"";const a=d.Type.isString((s=babelHelpers.classPrivateFieldLooseBase(this,L)[L])==null?void 0:s.typeName)?babelHelpers.classPrivateFieldLooseBase(this,L)[L].typeName:"";const i=((t=babelHelpers.classPrivateFieldLooseBase(this,L)[L].task)==null?void 0:t.url)||babelHelpers.classPrivateFieldLooseBase(this,L)[L].workflowUrl||babelHelpers.classPrivateFieldLooseBase(this,y)[y]();const o=d.Type.isString((l=babelHelpers.classPrivateFieldLooseBase(this,L)[L])==null?void 0:l.description)?babelHelpers.classPrivateFieldLooseBase(this,L)[L].description:"";const n=80;const c=d.Dom.create("span",{html:o==null?void 0:o.replace(/(<br \/>)+/gm," ")}).textContent.replace(/\n+/," ").slice(0,n);const b=(o==null?void 0:o.length)>n;return d.Tag.render(v||(v=h`
				<div class="bp-user-processes">
					<a class="bp-user-processes__title-link ui-typography-text-lg"
						href="${0}">${0}
					</a>
					<div class="bp-user-processes__appointment">${0}</div>
					<div class="bp-user-processes__description-box ${0}">
						<span class="bp-user-processes__short_description">
							${0}
							...<a href="#" onclick="this.closest('div').classList.add('--expanded'); return false;" class="bp-user-processes__description-link">${0}</a>
						</span>
						<span class="bp-user-processes__description">
							${0}
						</span>
					</div>
			</div>
		`),d.Text.encode(i),d.Text.encode(r),d.Text.encode(a.toUpperCase()),b?"":"--expanded",d.Text.encode(c),d.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_DESCRIPTION_MORE"),o)}renderTaskName(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,F)[F])==null?void 0:e.render()}renderTask(){if(!babelHelpers.classPrivateFieldLooseBase(this,L)[L].task||babelHelpers.classPrivateFieldLooseBase(this,L)[L].userId!==babelHelpers.classPrivateFieldLooseBase(this,w)[w]){const e=babelHelpers.classPrivateFieldLooseBase(this,L)[L].isCompleted?"--success":"";return d.Tag.render(P||(P=h`
				<div class="bp-status-panel ${0}">
						<div class="bp-status-item">
							<div class="bp-status-name">${0}</div>
							${0}
						</div>
				</div>
			`),e,d.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,L)[L].statusText.toUpperCase()),"")}return this.renderTaskName()}renderDocumentName(){var e,s,t,l;const r=d.Type.isString((e=babelHelpers.classPrivateFieldLooseBase(this,L)[L])==null?void 0:(s=e.document)==null?void 0:s.name)?babelHelpers.classPrivateFieldLooseBase(this,L)[L].document.name:"";if(d.Type.isString((t=babelHelpers.classPrivateFieldLooseBase(this,L)[L])==null?void 0:(l=t.document)==null?void 0:l.url)){const e=new d.Uri(babelHelpers.classPrivateFieldLooseBase(this,L)[L].document.url);return d.Tag.render(f||(f=h`
				<a href="${0}">
					${0}
				</a>
			`),d.Text.encode(e.toString()),d.Text.encode(r))}return d.Text.encode(r)}renderWorkflowFaces(){const e=d.Tag.render(m||(m=h`<div></div>`));try{babelHelpers.classPrivateFieldLooseBase(this,k)[k]=new i.WorkflowFaces({workflowId:babelHelpers.classPrivateFieldLooseBase(this,L)[L].workflowId,targetUserId:babelHelpers.classPrivateFieldLooseBase(this,g)[g],target:e,data:babelHelpers.classPrivateFieldLooseBase(this,L)[L].taskProgress,showArrow:true});babelHelpers.classPrivateFieldLooseBase(this,k)[k].render()}catch(e){console.error(e)}return e}renderSummary(){return new o.Summary({workflowId:babelHelpers.classPrivateFieldLooseBase(this,L)[L].workflowId,time:babelHelpers.classPrivateFieldLooseBase(this,L)[L].taskProgress.time.total,workflowIsCompleted:babelHelpers.classPrivateFieldLooseBase(this,L)[L].taskProgress.workflowIsCompleted,showArrow:false}).render()}renderModified(){var e;let s=null;if(babelHelpers.classPrivateFieldLooseBase(this,L)[L].userId===babelHelpers.classPrivateFieldLooseBase(this,w)[w]&&(babelHelpers.classPrivateFieldLooseBase(this,L)[L].taskCnt>0||babelHelpers.classPrivateFieldLooseBase(this,L)[L].commentCnt>0)){const e=babelHelpers.classPrivateFieldLooseBase(this,L)[L].taskCnt===0&&babelHelpers.classPrivateFieldLooseBase(this,L)[L].commentCnt>0?n.CounterColor.SUCCESS:n.CounterColor.DANGER;s=new n.Counter({value:(babelHelpers.classPrivateFieldLooseBase(this,L)[L].taskCnt||0)+(babelHelpers.classPrivateFieldLooseBase(this,L)[L].commentCnt||0),color:e,secondaryColor:n.CounterColor.SUCCESS,isDouble:babelHelpers.classPrivateFieldLooseBase(this,L)[L].taskCnt>0&&babelHelpers.classPrivateFieldLooseBase(this,L)[L].commentCnt>0})}return d.Tag.render(B||(B=h`
			<div class="bp-modified-cell">
				<span class="bp-row-counters">${0}</span>
				<span>${0}</span>
			</div>
		`),(e=s)==null?void 0:e.getContainer(),d.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,L)[L].modified))}destroy(){babelHelpers.classPrivateFieldLooseBase(this,L)[L]=null;babelHelpers.classPrivateFieldLooseBase(this,T)[T]=null;babelHelpers.classPrivateFieldLooseBase(this,F)[F]=null;if(!d.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,k)[k])){babelHelpers.classPrivateFieldLooseBase(this,k)[k].destroy();babelHelpers.classPrivateFieldLooseBase(this,k)[k]=null}}}function H(){var e;const s=d.Type.isNil((e=babelHelpers.classPrivateFieldLooseBase(this,L)[L].task)==null?void 0:e.id)?babelHelpers.classPrivateFieldLooseBase(this,L)[L].workflowId:babelHelpers.classPrivateFieldLooseBase(this,L)[L].task.id;const t=new d.Uri(`/company/personal/bizproc/${s}/`);return t.toString()}var E=babelHelpers.classPrivateFieldLooseKey("subscribeToPulls");var S=babelHelpers.classPrivateFieldLooseKey("getTaskColor");var C=babelHelpers.classPrivateFieldLooseKey("getCommentColor");var _=babelHelpers.classPrivateFieldLooseKey("setFilterPreset");var O=babelHelpers.classPrivateFieldLooseKey("getFilterManager");class A{constructor(e){Object.defineProperty(this,O,{value:M});Object.defineProperty(this,_,{value:N});Object.defineProperty(this,C,{value:D});Object.defineProperty(this,S,{value:U});Object.defineProperty(this,E,{value:R});this.filterId=e.filterId;this.counters=e.counters}renderTo(e){var s,t,l,r;this.uiPanel=new BX.UI.CounterPanel({target:e,multiselect:false,title:d.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_LABEL"),items:[{id:"task",value:{value:((s=this.counters)==null?void 0:s.task)||0,order:1},title:{value:d.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_TASK"),order:2},color:babelHelpers.classPrivateFieldLooseBase(this,S)[S]((t=this.counters)==null?void 0:t.task),separator:false,eventsForActive:{click:babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this)},eventsForUnActive:{click:babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this,"active_task")}},{id:"comment",value:((l=this.counters)==null?void 0:l.comment)||0,title:d.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_COUNTERS_COMMENT"),color:babelHelpers.classPrivateFieldLooseBase(this,C)[C]((r=this.counters)==null?void 0:r.comment),eventsForActive:{click:babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this)},eventsForUnActive:{click:babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this,"comment")}}]});this.uiPanel.init();babelHelpers.classPrivateFieldLooseBase(this,E)[E]()}}function R(){BX.PULL.subscribe({moduleId:"main",command:"user_counter",callback:e=>{var s,t;const l=(s=(t=e[BX.message("SITE_ID")])==null?void 0:t.bp_tasks)!=null?s:null;if(l!==null){this.uiPanel.getItemById("task").updateValue(l);this.uiPanel.getItemById("task").updateColor(babelHelpers.classPrivateFieldLooseBase(this,S)[S](l))}}});BX.PULL.subscribe({moduleId:"bizproc",command:"comment",callback:e=>{var s,t;const l=(s=(t=e.counter)==null?void 0:t.allUnread)!=null?s:null;if(l!==null){this.uiPanel.getItemById("comment").updateValue(l);this.uiPanel.getItemById("comment").updateColor(babelHelpers.classPrivateFieldLooseBase(this,C)[C](l))}}})}function U(e){return e>0?"DANGER":"THEME"}function D(e){return e>0?"SUCCESS":"THEME"}function N(e){const s=babelHelpers.classPrivateFieldLooseBase(this,O)[O]();if(!s){return}const t=s.getApi();const l={SYSTEM_PRESET:e!=null?e:"in_work"};t.setFields(l);t.apply()}function M(){if(this.filterId){var e;return(e=BX.Main.filterManager)==null?void 0:e.getById(this.filterId)}console.warn("Filter not found");return null}let x=e=>e,K;var W=babelHelpers.classPrivateFieldLooseKey("workflowTasks");var j=babelHelpers.classPrivateFieldLooseKey("workflowRenderer");var X=babelHelpers.classPrivateFieldLooseKey("subscribeToPushes");var G=babelHelpers.classPrivateFieldLooseKey("updateWorkflows");var z=babelHelpers.classPrivateFieldLooseKey("appendWorkflow");var $=babelHelpers.classPrivateFieldLooseKey("createWorkflowRenderer");var V=babelHelpers.classPrivateFieldLooseKey("getWorkflowRendererById");var Z=babelHelpers.classPrivateFieldLooseKey("deleteWorkflowRendererById");var Y=babelHelpers.classPrivateFieldLooseKey("hideRow");var q=babelHelpers.classPrivateFieldLooseKey("showRow");class J{constructor(e){Object.defineProperty(this,q,{value:ie});Object.defineProperty(this,Y,{value:ae});Object.defineProperty(this,Z,{value:re});Object.defineProperty(this,V,{value:le});Object.defineProperty(this,$,{value:te});Object.defineProperty(this,z,{value:se});Object.defineProperty(this,G,{value:ee});Object.defineProperty(this,X,{value:Q});this.delegateToUserId=0;Object.defineProperty(this,W,{writable:true,value:new Map});Object.defineProperty(this,j,{writable:true,value:{}});let s=false;if(d.Type.isPlainObject(e)){this.gridId=e.gridId;if(d.Type.isArray(e.errors)){this.showErrors(e.errors)}this.actionPanel={wrapperElementId:e.actionPanelUserWrapperId,actionButtonName:`${this.gridId}_action_button`};this.currentUserId=e.currentUserId;s=e.mustSubscribeToPushes===true}this.loader=new p;if(s){babelHelpers.classPrivateFieldLooseBase(this,X)[X]()}this.init();this.initCounterPanel(e.counters,e.filterId)}getDefaultAddRowOptions(e,s){const t=[{text:d.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_ROW_ACTION_DOCUMENT"),href:e.document.url||"#"}];if(e.task){t.push({text:d.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_ROW_ACTION_TASK"),href:e.task.url})}return{id:e.workflowId,animation:false,columns:{ID:e.workflowId,PROCESS:s.renderProcess(),TASK_PROGRESS:s.renderWorkflowFaces(),TASK:s.renderTask(),WORKFLOW_STATE:d.Text.encode(e.statusText),DOCUMENT_NAME:s.renderDocumentName(),WORKFLOW_TEMPLATE_NAME:d.Text.encode(e.templateName),TASK_DESCRIPTION:d.Dom.create("span",{html:e.description||""}),MODIFIED:s.renderModified(),WORKFLOW_STARTED:d.Text.encode(e.workflowStarted),WORKFLOW_STARTED_BY:d.Text.encode(e.startedBy),OVERDUE_DATE:d.Text.encode(e.overdueDate),SUMMARY:s.renderSummary()},actions:t,columnClasses:{TASK_PROGRESS:"bp-task-progress-cell",SUMMARY:"bp-summary-cell",TASK:e.isCompleted?"bp-status-completed-cell":""},editable:Boolean(e.task)}}init(){this.actionPanel.userWrapperElement=document.getElementById(this.actionPanel.wrapperElementId);this.initUserSelector();this.renderCells();this.onActionPanelChanged()}initCounterPanel(e,s){const t=document.querySelector('[data-role="bizproc-counterpanel"]');if(!t){return}new A({counters:e,filterId:s}).renderTo(t)}renderCells(){const e=new Map;document.querySelectorAll('[data-role="bp-render-cell"]').forEach((s=>{const t=d.Dom.attr(s,"data-workflow");const l=d.Dom.attr(s,"data-column");if(t){if(!e.has(t.workflowId)){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](t.workflowId);e.set(t.workflowId)}if(t.task){babelHelpers.classPrivateFieldLooseBase(this,W)[W].set(t.workflowId,t.task.id)}this.renderColumnCell(s,l,t)}}))}renderColumnCell(e,s,t){var l;const r=(l=babelHelpers.classPrivateFieldLooseBase(this,V)[V](String(t.workflowId)))!=null?l:babelHelpers.classPrivateFieldLooseBase(this,$)[$](String(t.workflowId),t);let a=null;switch(s){case"DOCUMENT_NAME":a=r.renderDocumentName();break;case"PROCESS":a=r.renderProcess();break;case"TASK_PROGRESS":a=r.renderWorkflowFaces();break;case"TASK":a=r.renderTask();break;case"SUMMARY":a=r.renderSummary();break;case"MODIFIED":a=r.renderModified();break;default:}if(a){d.Dom.replace(e,a)}}async initStartWorkflowButton(e){const s=d.Type.isStringFilled(e)&&document.getElementById(e);const t=d.Type.isStringFilled(s==null?void 0:s.dataset.lists)&&JSON.parse(s.dataset.lists);let r=null;if(t){const e=new l.Menu({angle:true,offsetLeft:d.Dom.getPosition(s).width/2,autoHide:true,bindElement:s,closeByEsc:true,items:Object.values(t).map((s=>{const t={text:s.name,className:"feed-add-post-form-link-lists",dataset:{iconUrl:s.icon}};if(d.Type.isNil(s.url)){const l={iBlockTypeId:s.iBlockTypeId,iBlockId:s.iBlockId,analyticsP1:s.name};if(s.selected===true){r=l}t.onclick=()=>{e.close();d.Runtime.loadExtension("lists.element.creation-guide").then((({CreationGuide:e})=>{e==null?void 0:e.open(l)})).catch((()=>{}))}}else{t.href=s.url}return t}))});const a=e.getMenuContainer();for(const e of a.querySelectorAll(".menu-popup-item-icon")){d.Dom.append(d.Tag.render(K||(K=x`
						<img src = "${0}" alt="" width = "19" height = "16"/>
					`),e.parentElement.dataset.iconUrl),e)}s.onclick=s=>{s.preventDefault();if(!e.getPopupWindow().isShown()){d.Runtime.loadExtension("ui.analytics").then((({sendData:e})=>{e({tool:"automation",category:"bizproc_operations",event:"drawer_open",c_section:"bizproc",c_element:"button"})})).catch((()=>{}))}e.toggle()}}if(r){d.Runtime.loadExtension("lists.element.creation-guide").then((({CreationGuide:e})=>{e==null?void 0:e.open(r)})).catch((()=>{}))}}initUserSelector(){if(!this.delegateToSelector){this.delegateToSelector=new t.TagSelector({multiple:false,tagMaxWidth:180,events:{onTagAdd:e=>{this.delegateToUserId=parseInt(e.getData().tag.getId(),10);if(!d.Type.isInteger(this.delegateToUserId)){this.delegateToUserId=0}},onTagRemove:()=>{this.delegateToUserId=0}},dialogOptions:{entities:[{id:"user",options:{intranetUsersOnly:true,inviteEmployeeLink:false}}]}})}if(d.Type.isDomNode(this.actionPanel.userWrapperElement)){d.Dom.clean(this.actionPanel.userWrapperElement);this.delegateToSelector.renderTo(this.actionPanel.userWrapperElement)}}showErrors(e){if(!d.Type.isArrayFilled(e)){if(!d.Type.isArray(e)){console.error(e)}return}const t=document.getElementById("bp-user-processes-errors-container");if(t){let l=0;const r=()=>{if(l>0){d.Dom.style(t,{margin:"10px"})}else{d.Dom.style(t,{margin:"0px"})}};for(const a of e){l+=1;const e=new s.Alert({text:d.Text.encode(a.message),color:s.AlertColor.DANGER,closeBtn:true,animated:true});e.renderTo(t);if(e.getCloseBtn()){e.getCloseBtn().onclick=()=>{l-=1;r()}}}r()}}onActionPanelChanged(){const e=this.getGrid();const s=e==null?void 0:e.getActionsPanel();if(s){const e=s.getValues()[this.actionPanel.actionButtonName];if(!d.Type.isString(e)||e.includes("set_status")){d.Dom.hide(this.actionPanel.userWrapperElement)}else{d.Dom.show(this.actionPanel.userWrapperElement)}}}applyActionPanelValues(){const e=this.getGrid();const s=e==null?void 0:e.getActionsPanel();if(e&&s){var t;const l=((t=s.getForAllCheckbox())==null?void 0:t.checked)===true;if(l){this.showErrors([{message:"Not implemented currently"}])}const r=s.getValues()[this.actionPanel.actionButtonName];if(d.Type.isString(r)){const s=this.getSelectedTaskIds(e.getRows().getSelectedIds());if(s.length===0){return}if(r.includes("set_status_")){const e=parseInt(r.split("_").pop(),10);if(d.Type.isNumber(e)){this.setTasksStatuses(s,e)}}else if(r.startsWith("delegate_to")){this.delegateTasks(s,this.delegateToUserId)}}}}getSelectedTaskIds(e){return e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,W)[W].get(e))).filter((e=>d.Type.isNumber(e)))}setTasksStatuses(e,s){d.ajax.runAction("bizproc.task.doInlineTasks",{data:{taskIds:e,newStatus:s}}).catch((e=>{this.showErrors(e.errors);this.reloadGrid()}))}delegateTasks(e,s){d.ajax.runComponentAction("bitrix:bizproc.user.processes","delegateTasks",{mode:"class",data:{taskIds:e,toUserId:s}}).catch((e=>{this.showErrors(e.errors);this.reloadGrid()}))}reloadGrid(){var e;(e=this.getGrid())==null?void 0:e.reload()}doTask(e){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](e.workflowId);d.ajax.runAction("bizproc.task.do",{data:e}).then((()=>{if(e.taskName){c.UI.Notification.Center.notify({content:d.Loc.getMessage("BIZPROC_USER_PROCESSES_TEMPLATE_TASK_TOUCHED",{"#TASK_NAME#":d.Text.encode(e.taskName)})})}})).catch((s=>{this.showErrors(s.errors);babelHelpers.classPrivateFieldLooseBase(this,q)[q](e.workflowId)}))}removeWorkflow(e){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](e,true);babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](e);babelHelpers.classPrivateFieldLooseBase(this,W)[W].delete(e)}getGrid(){if(this.gridId){var e;return(e=BX.Main.gridManager)==null?void 0:e.getInstanceById(this.gridId)}console.warn("Grid not found");return null}}function Q(){BX.PULL.subscribe({moduleId:"bizproc",command:"workflow",callback:e=>{if(e.eventName==="DELETED"||e.eventName==="UPDATED"){e.items.forEach((e=>this.removeWorkflow(e.id)))}if(e.eventName==="ADDED"||e.eventName==="UPDATED"){const s=this.getGrid().getRows();let t=e.items.map((e=>e.id));if(e.eventName==="ADDED"){t=t.filter((e=>!s.getById(e)))}if(t.length>0){this.loader.loadWorkflows(t).then(babelHelpers.classPrivateFieldLooseBase(this,G)[G].bind(this)).catch((e=>this.showErrors(e)))}}}})}function ee(e){var s;const{workflows:t}=e.data;if(!d.Type.isArray(t)){console.warn("Unexpected response from server. Expected workflow.data to be an array");return}const l=(s=this.getGrid())==null?void 0:s.getRealtime();if(l){let e=null;t.forEach((s=>{const t=Boolean(s.taskCnt>0||s.commentCnt>0||s.startedById===this.currentUserId&&s.isCompleted===false);if(t){babelHelpers.classPrivateFieldLooseBase(this,z)[z]({workflow:s,renderer:babelHelpers.classPrivateFieldLooseBase(this,$)[$](s.workflowId,s),insertAfter:e});e=s.workflowId}}))}}function se({workflow:e,renderer:s,insertAfter:t}){var l,r;if(e.task){babelHelpers.classPrivateFieldLooseBase(this,W)[W].set(e.workflowId,e.task.id)}const a=(l=this.getGrid())==null?void 0:l.getRealtime();if(!a){return}const i=this.getDefaultAddRowOptions(e,s);if(d.Type.isStringFilled(t)){i.insertAfter=t}else{i.prepend=true}a.addRow(i);const o=(r=this.getGrid())==null?void 0:r.getRows().getById(e.workflowId);if(o){if(i.columnClasses){for(const[e,s]of Object.entries(i.columnClasses)){if(s){d.Dom.addClass(o.getCellById(e),s)}}}d.Dom.addClass(o.getNode(),"main-ui-grid-show-new-row");d.Event.bind(o.getNode(),"animationend",(e=>{if(e.animationName==="showNewRow"){d.Dom.removeClass(o.getNode(),"main-ui-grid-show-new-row")}}))}}function te(e,s){babelHelpers.classPrivateFieldLooseBase(this,j)[j][e]=new I({userProcesses:this,currentUserId:this.currentUserId,workflow:s});return babelHelpers.classPrivateFieldLooseBase(this,j)[j][e]}function le(e){return d.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,j)[j][e])?null:babelHelpers.classPrivateFieldLooseBase(this,j)[j][e]}function re(e){const s=babelHelpers.classPrivateFieldLooseBase(this,V)[V](e);if(s){s.destroy();delete babelHelpers.classPrivateFieldLooseBase(this,j)[j][e]}}function ae(e,s=false){const t=this.getGrid();const l=t==null?void 0:t.getRows().getById(e);if(l){l.hide();if(s){d.Dom.remove(l.getNode())}if(t.getRows().getCountDisplayed()===0){t.getRealtime().showStub()}}}function ie(e){var s,t;(s=this.getGrid())==null?void 0:(t=s.getRows().getById(e))==null?void 0:t.show()}e.UserProcesses=J})(this.BX.Bizproc.Component=this.BX.Bizproc.Component||{},BX.UI,BX.UI.EntitySelector,BX.Main,BX.Bizproc,BX.Bizproc,BX.Bizproc.Workflow,BX.Bizproc.Workflow.Faces,BX.UI,BX,BX);
//# sourceMappingURL=script.map.js