{"version":3,"file":"resourcebooking.bundle.js","sources":["../src/viewcontrolabstract.js","../src/viewdropdownselect.js","../src/controls/userselector.js","../src/controls/resourceselector.js","../src/controls/serviceselector.js","../src/controls/durationselector.js","../src/controls/dateselector.js","../src/controls/timeselector.js","../src/controls/statusinformer.js","../src/livefieldcontroller.js","../src/translit.js","../src/bookingutil.js","../src/fieldviewcontrollerabstract.js","../src/fieldviewcontrolleredit.js","../src/fieldviewcontrollerpreview.js","../src/controls/selectinput.js","../src/resourcebooking.js"],"sourcesContent":["import {Loc, Dom, Tag} from \"./resourcebooking\";\n\nexport class ViewControlAbstract\n{\n\tconstructor(params)\n\t{\n\t\tif (new.target === ViewControlAbstract)\n\t\t{\n\t\t\tthrow new TypeError(\"Cannot construct Abstract instances directly\");\n\t\t}\n\n\t\tthis.name = null;\n\t\tthis.classNames = {\n\t\t\twrap: params.wrapClassName || 'calendar-resbook-webform-block',\n\t\t\tinnerWrap: 'calendar-resbook-webform-block-inner',\n\t\t\ttitle: 'calendar-resbook-webform-block-title',\n\t\t\tfield: 'calendar-resbook-webform-block-field'\n\t\t};\n\n\t\tthis.DOM = {\n\t\t\touterWrap: params.outerWrap,\n\t\t\twrap: null,\n\t\t\tdataWrap: null,\n\t\t\tinnerWrap: null,\n\t\t\tlabelWrap: null\n\t\t};\n\t\tthis.data = params.data;\n\t\tthis.shown = false;\n\t}\n\n\tisDisplayed()\n\t{\n\t\treturn this.data.show !== 'N';\n\t}\n\n\tisShown()\n\t{\n\t\treturn this.shown;\n\t}\n\n\tdisplay()\n\t{\n\t\tthis.DOM.wrap = this.DOM.outerWrap.appendChild(Dom.create(\"div\", {props : { className : this.classNames.wrap}}));\n\n\t\tthis.DOM.dataWrap = this.DOM.wrap.appendChild(Tag.render`<div data-bx-resource-data-wrap=\"Y\"></div>`);\n\n\t\tif (this.isDisplayed())\n\t\t{\n\t\t\tthis.show({animation: false});\n\t\t}\n\t}\n\n\trefresh(data)\n\t{\n\t\tthis.refreshLabel(data);\n\t\tthis.data = data;\n\n\t\tif (this.setDataConfig())\n\t\t{\n\t\t\tif (this.isDisplayed())\n\t\t\t{\n\t\t\t\tthis.show({animation: true});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hide({animation: true});\n\t\t\t}\n\t\t}\n\t\tthis.data = data;\n\t}\n\n\tsetDataConfig()\n\t{\n\t\treturn true;\n\t}\n\n\trefreshLabel(data)\n\t{\n\t\tif (this.data.label !== data.label)\n\t\t{\n\t\t\tDom.adjust(this.DOM.labelWrap, {text: data.label});\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tif (this.DOM.innerWrap)\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\n\t\tthis.DOM.innerWrap = this.DOM.wrap.appendChild(Dom.create(\"div\", {props : { className : this.classNames.innerWrap}}));\n\n\t\tif (this.data.label || this.label)\n\t\t{\n\t\t\tthis.DOM.labelWrap = this.DOM.innerWrap.appendChild(Dom.create(\"div\", {props : { className : this.classNames.title}, text: this.data.label || this.label}));\n\t\t}\n\t\tthis.DOM.controlWrap = this.DOM.innerWrap.appendChild(Dom.create(\"div\", {props : { className : this.classNames.field}}));\n\t\tthis.displayControl();\n\t\tthis.shown = true;\n\t}\n\n\thide()\n\t{\n\t\tDom.remove(this.DOM.innerWrap);\n\t\tthis.DOM.innerWrap = null;\n\t\tthis.shown = false;\n\t}\n\n\tdisplayControl()\n\t{\n\t}\n\n\tshowWarning(errorMessage)\n\t{\n\t\tif (this.shown && this.DOM.wrap && this.DOM.innerWrap)\n\t\t{\n\t\t\tDom.addClass(this.DOM.wrap, \"calendar-resbook-webform-block-error\");\n\t\t\tthis.displayErrorText(errorMessage || Loc.getMessage('WEBF_RES_BOOKING_REQUIRED_WARNING'));\n\t\t}\n\t}\n\n\thideWarning()\n\t{\n\t\tif (this.DOM.wrap)\n\t\t{\n\t\t\tDom.removeClass(this.DOM.wrap, \"calendar-resbook-webform-block-error\");\n\t\t\tif (this.DOM.errorTextWrap)\n\t\t\t{\n\t\t\t\tDom.remove(this.DOM.errorTextWrap);\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplayErrorText(errorMessage)\n\t{\n\t\tif (this.DOM.errorTextWrap)\n\t\t{\n\t\t\tDom.remove(this.DOM.errorTextWrap);\n\t\t}\n\t\tthis.DOM.errorTextWrap = this.DOM.innerWrap.appendChild(Dom.create(\"span\", {props : { className : 'calendar-resbook-webform-block-error-text'}, text: errorMessage}));\n\t}\n}\n\n\n","import {Type, Loc, Dom, Event, Text, BookingUtil, MenuManager} from \"./resourcebooking\";\n\nexport class ViewDropDownSelect\n{\n\tconstructor(params)\n\t{\n\t\tthis.id = 'viewform-dropdown-select-' + Math.round(Math.random() * 100000);\n\t\tthis.DOM = {\n\t\t\twrap: params.wrap\n\t\t};\n\t\tthis.maxHeight = params.maxHeight;\n\t\tthis.selectAllMessage = Loc.getMessage('WEBF_RES_SELECT_ALL');\n\t\tthis.setSettings(params);\n\t}\n\n\tbuild()\n\t{\n\t\tthis.DOM.select = this.DOM.wrap.appendChild(Dom.create(\"div\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: \"calendar-resbook-webform-block-input calendar-resbook-webform-block-input-dropdown\"\n\t\t\t},\n\t\t\tevents: {click: this.openPopup.bind(this)}\n\t\t}));\n\n\t\tthis.setSelectedValues(this.selected);\n\t}\n\n\tsetSettings(params)\n\t{\n\t\tthis.handleChangesCallback = Type.isFunction(params.handleChangesCallback) ? params.handleChangesCallback : null;\n\t\tthis.values = params.values;\n\t\tthis.selected = !Type.isArray(params.selected) ? [params.selected] : params.selected;\n\t\tthis.multiple = params.multiple;\n\t}\n\n\topenPopup()\n\t{\n\t\tif (this.isPopupShown())\n\t\t{\n\t\t\treturn this.closePopup();\n\t\t}\n\n\t\tlet menuItems = [];\n\t\tthis.values.forEach(function(item)\n\t\t{\n\t\t\tlet className = 'menu-popup-no-icon';\n\t\t\tif (Type.isArray(this.selected) && this.selected.includes(parseInt(item.id)))\n\t\t\t{\n\t\t\t\tclassName += ' menu-item-selected';\n\t\t\t}\n\n\t\t\tmenuItems.push({\n\t\t\t\tid: item.id,\n\t\t\t\tclassName: className,\n\t\t\t\ttext: Text.encode(item.title),\n\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t});\n\t\t}, this);\n\n\t\tif (this.multiple && menuItems.length <= 1)\n\t\t{\n\t\t\tthis.multiple = false;\n\t\t}\n\n\t\tif (this.multiple)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: 'select-all',\n\t\t\t\ttext: this.selectAllMessage,\n\t\t\t\tonclick: this.selectAllItemClick.bind(this)\n\t\t\t});\n\t\t}\n\n\t\tthis.popup = MenuManager.create(\n\t\t\tthis.id,\n\t\t\tthis.DOM.select,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tclassName: 'calendar-resbook-form-popup' + (this.multiple ? ' popup-window-resource-select' : ''),\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : !this.multiple,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tcacheable: false\n\t\t\t}\n\t\t);\n\n\t\tthis.popup.show(true);\n\t\tthis.popupContainer = this.popup.popupWindow.popupContainer;\n\t\tthis.popupContainer.style.width = parseInt(this.DOM.select.offsetWidth) + 'px';\n\n\t\tif (this.multiple)\n\t\t{\n\t\t\tthis.popup.menuItems.forEach(function(menuItem)\n\t\t\t{\n\t\t\t\tlet checked;\n\t\t\t\tif (menuItem.id === 'select-all')\n\t\t\t\t{\n\t\t\t\t\tthis.selectAllChecked = !this.values.find(function(value){\n\t\t\t\t\t\treturn !this.selected.find(function(itemId){return itemId === value.id});\n\t\t\t\t\t},this);\n\n\t\t\t\t\tmenuItem.layout.item.className = 'menu-popup-item menu-popup-item-resource-all';\n\t\t\t\t\tmenuItem.layout.item.innerHTML = '<div class=\"menu-popup-item-inner\">' +\n\t\t\t\t\t\t'<div class=\"menu-popup-item-resource\">' +\n\t\t\t\t\t\t'<input class=\"menu-popup-item-resource-checkbox menu-popup-item-all-resources-checkbox\" type=\"checkbox\"' + (this.selectAllChecked ? 'checked=\"checked\"' : '') + ' id=\"' + menuItem.id + '\">' +\n\t\t\t\t\t\t'<label class=\"menu-popup-item-text\" for=\"' + menuItem.id + '\">' + menuItem.text + '</label>' +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'</div>';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tchecked = this.selected.find(function(itemId){return itemId === menuItem.id});\n\n\t\t\t\t\tmenuItem.layout.item.className = 'menu-popup-item';\n\t\t\t\t\tmenuItem.layout.item.innerHTML = '<div class=\"menu-popup-item-inner\">' +\n\t\t\t\t\t\t'<div class=\"menu-popup-item-resource\">' +\n\t\t\t\t\t\t'<input class=\"menu-popup-item-resource-checkbox\" type=\"checkbox\"' + (checked ? 'checked=\"checked\"' : '') + ' id=\"' + menuItem.id + '\">' +\n\t\t\t\t\t\t'<label class=\"menu-popup-item-text\" for=\"' + menuItem.id + '\">' + menuItem.text + '</label>' +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'</div>';\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tEvent.unbind(document, 'click', this.handleClick.bind(this));\n\t\t\tsetTimeout(function(){\n\t\t\t\tEvent.bind(document, 'click', this.handleClick.bind(this));\n\t\t\t}.bind(this), 50);\n\t\t}\n\t}\n\n\tclosePopup()\n\t{\n\t\tif (this.isPopupShown())\n\t\t{\n\t\t\tthis.popup.close();\n\t\t\tif (this.multiple)\n\t\t\t{\n\t\t\t\tEvent.unbind(document, 'click', this.handleClick.bind(this));\n\t\t\t}\n\t\t}\n\t}\n\n\tisPopupShown()\n\t{\n\t\treturn this.popup && this.popup.popupWindow &&\n\t\t\tthis.popup.popupWindow.isShown && this.popup.popupWindow.isShown() &&\n\t\t\tthis.popup.popupWindow.popupContainer &&\n\t\t\tDom.isShown(this.popup.popupWindow.popupContainer);\n\t}\n\n\tmenuItemClick(e, menuItem)\n\t{\n\t\tlet\n\t\t\tselectAllcheckbox,\n\t\t\ttarget = e.target || e.srcElement,\n\t\t\tfoundValue, checkbox;\n\n\n\t\tif (this.multiple)\n\t\t{\n\t\t\tfoundValue = this.values.find(function(value){return value.id == menuItem.id;});\n\t\t\tcheckbox = menuItem.layout.item.querySelector('.menu-popup-item-resource-checkbox');\n\n\t\t\tif (foundValue && target && (Dom.hasClass(target, \"menu-popup-item\") || Dom.hasClass(target, \"menu-popup-item-resource-checkbox\") || Dom.hasClass(target, \"menu-popup-item-inner\")))\n\t\t\t{\n\t\t\t\tif (!Dom.hasClass(target, \"menu-popup-item-resource-checkbox\"))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = !checkbox.checked;\n\t\t\t\t}\n\n\t\t\t\tif (checkbox.checked)\n\t\t\t\t{\n\t\t\t\t\tthis.selectItem(foundValue);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.deselectItem(foundValue);\n\t\t\t\t\tselectAllcheckbox = this.popupContainer.querySelector('.menu-popup-item-all-resources-checkbox');\n\t\t\t\t\tthis.selectAllChecked = false;\n\t\t\t\t\tif (selectAllcheckbox)\n\t\t\t\t\t{\n\t\t\t\t\t\tselectAllcheckbox.checked = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.setSelectedValues(this.selected);\n\t\t\t\tthis.handleControlChanges();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setSelectedValues([menuItem.id]);\n\t\t\tthis.handleControlChanges();\n\t\t\tthis.closePopup();\n\t\t}\n\t}\n\n\tselectItem(value)\n\t{\n\t\tif (!this.selected.includes(value.id))\n\t\t{\n\t\t\tthis.selected.push(value.id);\n\t\t}\n\t}\n\n\tdeselectItem(value)\n\t{\n\t\tlet index = this.selected.indexOf(parseInt(value.id));\n\t\tif (index >= 0)\n\t\t{\n\t\t\tthis.selected = this.selected.slice(0, index).concat(this.selected.slice(index + 1));\n\t\t}\n\t}\n\n\tselectAllItemClick(e, menuItem)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (target && (Dom.hasClass(target, \"menu-popup-item\") || Dom.hasClass(target, \"menu-popup-item-resource-checkbox\")))\n\t\t{\n\t\t\tlet checkbox = menuItem.layout.item.querySelector('.menu-popup-item-resource-checkbox');\n\n\t\t\tif (Dom.hasClass(target, \"menu-popup-item\"))\n\t\t\t{\n\t\t\t\tcheckbox.checked = !checkbox.checked;\n\t\t\t}\n\n\t\t\tlet i, checkboxes = this.popupContainer.querySelectorAll('input.menu-popup-item-resource-checkbox');\n\t\t\tthis.selectAllChecked = checkbox.checked;\n\n\t\t\tfor (i = 0; i < checkboxes.length; i++)\n\t\t\t{\n\t\t\t\tcheckboxes[i].checked = this.selectAllChecked;\n\t\t\t}\n\t\t\tthis.selected = [];\n\t\t\tif (this.selectAllChecked)\n\t\t\t{\n\t\t\t\tthis.values.forEach(function(value){this.selected.push(value.id);}, this);\n\t\t\t}\n\t\t\tthis.setSelectedValues(this.selected);\n\t\t\tthis.handleControlChanges();\n\t\t}\n\t}\n\n\thandleClick(e)\n\t{\n\t\tif (this.isPopupShown() && !this.popupContainer.contains(e.target || e.srcElement))\n\t\t{\n\t\t\tthis.closePopup({animation: true});\n\t\t}\n\t\tthis.handleControlChanges();\n\t}\n\n\tgetSelectedValues()\n\t{\n\t\treturn this.selected;\n\t}\n\n\tsetSelectedValues(values)\n\t{\n\t\tlet i,\n\t\t\tfoundValue,\n\t\t\ttextValues = [],\n\t\t\tselectedValues = [];\n\n\t\tfor (i = 0; i < values.length; i++)\n\t\t{\n\t\t\tfoundValue = this.values.find(function(value){return value.id === values[i];});\n\t\t\tif (foundValue)\n\t\t\t{\n\t\t\t\ttextValues.push(foundValue.title);\n\t\t\t\tselectedValues.push(foundValue.id);\n\t\t\t}\n\t\t}\n\n\t\tthis.selected = selectedValues;\n\t\tDom.adjust(this.DOM.select, {text: textValues.length ? textValues.join(', ') : Loc.getMessage('USER_TYPE_RESOURCE_LIST_PLACEHOLDER')});\n\t}\n\n\thandleControlChanges()\n\t{\n\t\tif (this.handleChangesCallback)\n\t\t{\n\t\t\tthis.handleChangesCallback(this.getSelectedValues());\n\t\t}\n\t}\n}\n","import {Type} from \"../resourcebooking\";\nimport {ViewControlAbstract} from \"../viewcontrolabstract\";\nimport {ViewDropDownSelect} from \"../viewdropdownselect\";\n\nexport class UserSelector extends ViewControlAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.name = 'UserSelector';\n\t\tthis.data = params.data || {};\n\t\tthis.userList = [];\n\t\tthis.userIndex = {};\n\n\t\tthis.values = [];\n\t\tthis.defaultMode = 'auto';\n\t\tthis.previewMode = params.previewMode === undefined;\n\t\tthis.autoSelectDefaultValue = params.autoSelectDefaultValue;\n\t\tthis.changeValueCallback = params.changeValueCallback;\n\n\t\tthis.handleSettingsData(this.data, params.userIndex);\n\t}\n\n\tdisplayControl()\n\t{\n\t\tthis.selectedValue = this.getSelectedUser();\n\t\tthis.dropdownSelect = new ViewDropDownSelect({\n\t\t\twrap: this.DOM.controlWrap,\n\t\t\tvalues: this.userList,\n\t\t\tselected: this.selectedValue,\n\t\t\thandleChangesCallback: this.handleChanges.bind(this)\n\t\t});\n\t\tthis.dropdownSelect.build();\n\t}\n\n\trefresh(data, userIndex)\n\t{\n\t\tthis.refreshLabel(data);\n\t\tthis.data = data;\n\t\tthis.handleSettingsData(this.data, userIndex);\n\t\tthis.selectedValue = this.getSelectedUser();\n\n\t\tif (this.dropdownSelect)\n\t\t{\n\t\t\tthis.dropdownSelect.setSettings({\n\t\t\t\tvalues: this.userList,\n\t\t\t\tselected: this.selectedValue\n\t\t\t});\n\t\t}\n\n\t\tif (this.setDataConfig())\n\t\t{\n\t\t\tif (this.isDisplayed())\n\t\t\t{\n\t\t\t\tthis.show({animation: true});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hide({animation: true});\n\t\t\t}\n\t\t}\n\t}\n\n\thandleSettingsData(data, userIndex)\n\t{\n\t\tif (Type.isPlainObject(userIndex))\n\t\t{\n\t\t\tfor (let id in userIndex)\n\t\t\t{\n\t\t\t\tif (userIndex.hasOwnProperty(id))\n\t\t\t\t{\n\t\t\t\t\tthis.userIndex[id] = userIndex[id];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.defaultMode = this.data.defaultMode === 'none' ? 'none' : 'auto';\n\t\tlet dataValue = [];\n\t\tthis.userList = [];\n\t\tif (this.data.value)\n\t\t{\n\t\t\tlet dataValueRaw = Type.isArray(this.data.value) ? this.data.value : this.data.value.split('|');\n\t\t\tdataValueRaw.forEach(function(id)\n\t\t\t{\n\t\t\t\tid = parseInt(id);\n\t\t\t\tif (id > 0)\n\t\t\t\t{\n\t\t\t\t\tdataValue.push(id);\n\t\t\t\t\tif (this.userIndex[id])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.userList.push({\n\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\ttitle: this.userIndex[id].displayName\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\t\tthis.values = dataValue;\n\t}\n\n\tgetSelectedUser()\n\t{\n\t\tlet selected = null;\n\t\tif (this.dropdownSelect)\n\t\t{\n\t\t\tselected = this.dropdownSelect.getSelectedValues();\n\t\t\tselected = (Type.isArray(selected) && selected.length) ? selected[0] : null;\n\t\t}\n\n\t\tif (!selected && this.previewMode\n\t\t\t&& this.data.defaultMode === 'auto'\n\t\t\t&& this.userList && this.userList[0])\n\t\t{\n\t\t\tselected = this.userList[0].id;\n\t\t}\n\n\t\tif (!selected && this.autoSelectDefaultValue)\n\t\t{\n\t\t\tselected = this.autoSelectDefaultValue;\n\t\t}\n\n\t\treturn selected;\n\t}\n\n\tsetSelectedUser(userId)\n\t{\n\t\tif (this.dropdownSelect)\n\t\t{\n\t\t\tthis.dropdownSelect.setSelectedValues([userId]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.autoSelectDefaultValue = parseInt(userId);\n\t\t}\n\t}\n\n\thandleChanges(selectedValues)\n\t{\n\t\tif (!this.previewMode && Type.isFunction(this.changeValueCallback))\n\t\t{\n\t\t\tthis.changeValueCallback(selectedValues[0] || null);\n\t\t}\n\t}\n}","import {Type} from \"../resourcebooking\";\nimport {ViewControlAbstract} from \"../viewcontrolabstract\";\nimport {ViewDropDownSelect} from \"../viewdropdownselect\";\n\nexport class ResourceSelector extends ViewControlAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.name = 'ResourceSelector';\n\t\tthis.data = params.data;\n\t\tthis.allResourceList = params.resourceList;\n\t\tthis.autoSelectDefaultValue = params.autoSelectDefaultValue;\n\t\tthis.changeValueCallback = params.changeValueCallback;\n\t\tthis.handleSettingsData(params.data);\n\t}\n\n\thandleSettingsData(data)\n\t{\n\t\tif (!Type.isArray(data.value))\n\t\t{\n\t\t\tlet dataValue = [];\n\t\t\tif (data.value)\n\t\t\t{\n\t\t\t\tdata.value.split('|').forEach(function(id)\n\t\t\t\t{\n\t\t\t\t\tif (parseInt(id) > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdataValue.push(parseInt(id))\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.data.value = dataValue;\n\t\t}\n\n\t\tthis.resourceList = [];\n\t\tif (Type.isArray(this.allResourceList) && Type.isArray(this.data.value))\n\t\t{\n\t\t\tthis.allResourceList.forEach(function(item)\n\t\t\t{\n\t\t\t\tif (this.data.value.includes(parseInt(item.id)))\n\t\t\t\t{\n\t\t\t\t\tthis.resourceList.push(item);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\n\t\tthis.setSelectedValues(this.getSelectedValues());\n\t}\n\n\tdisplayControl()\n\t{\n\t\tthis.dropdownSelect = new ViewDropDownSelect({\n\t\t\twrap: this.DOM.controlWrap,\n\t\t\tvalues: this.resourceList,\n\t\t\tselected: this.selectedValues,\n\t\t\tmultiple: this.data.multiple === 'Y',\n\t\t\thandleChangesCallback: this.changeValueCallback\n\t\t});\n\t\tthis.dropdownSelect.build();\n\t}\n\n\trefresh(data)\n\t{\n\t\tthis.refreshLabel(data);\n\t\tthis.data = data;\n\t\tthis.handleSettingsData(this.data);\n\t\tthis.setSelectedValues(this.getSelectedValues());\n\n\t\tif (this.dropdownSelect)\n\t\t{\n\t\t\tthis.dropdownSelect.setSettings({\n\t\t\t\tvalues: this.resourceList,\n\t\t\t\tselected: this.selectedValues,\n\t\t\t\tmultiple: this.data.multiple === 'Y'\n\t\t\t});\n\t\t}\n\n\t\tif (this.setDataConfig())\n\t\t{\n\t\t\tif (this.isDisplayed())\n\t\t\t{\n\t\t\t\tthis.show({animation: true});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hide({animation: true});\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSelectedValues()\n\t{\n\t\tlet selected = null;\n\n\t\tif (this.dropdownSelect)\n\t\t{\n\t\t\tselected = this.dropdownSelect.getSelectedValues();\n\t\t}\n\n\t\tif (!selected && this.autoSelectDefaultValue)\n\t\t{\n\t\t\tselected = [this.autoSelectDefaultValue];\n\t\t}\n\n\t\tif (!selected && this.data.defaultMode === 'auto')\n\t\t{\n\t\t\tif (this.resourceList && this.resourceList[0])\n\t\t\t{\n\t\t\t\tselected = [this.resourceList[0].id];\n\t\t\t}\n\t\t}\n\n\t\treturn selected;\n\t}\n\n\tsetSelectedValues(selectedValues)\n\t{\n\t\tthis.selectedValues = selectedValues;\n\t}\n\n\tsetSelectedResource(id)\n\t{\n\t\tif (this.dropdownSelect)\n\t\t{\n\t\t\tthis.dropdownSelect.setSelectedValues([id]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.autoSelectDefaultValue = parseInt(id);\n\t\t\tthis.selectedValues = [id];\n\t\t}\n\t}\n}","import {Type, BookingUtil} from \"../resourcebooking\";\nimport {ViewControlAbstract} from \"../viewcontrolabstract\";\nimport {ViewDropDownSelect} from \"../viewdropdownselect\";\n\nexport class ServiceSelector extends ViewControlAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.name = 'ServiceSelector';\n\t\tthis.data = params.data;\n\t\tthis.serviceList = [];\n\n\t\tthis.allServiceList = [];\n\t\tif (Type.isArray(params.serviceList))\n\t\t{\n\t\t\tparams.serviceList.forEach((service) => {\n\t\t\t\tif (Type.isString(name))\n\t\t\t\t{\n\t\t\t\t\tservice.name = service.name.trim();\n\t\t\t\t}\n\t\t\t\tthis.allServiceList.push(service);\n\t\t\t})\n\t\t}\n\t\tthis.values = [];\n\t\tthis.changeValueCallback = Type.isFunction(params.changeValueCallback) ? params.changeValueCallback : null;\n\t\tif (params.selectedValue)\n\t\t{\n\t\t\tthis.setSelectedService(params.selectedValue);\n\t\t}\n\t\tthis.handleSettingsData(this.data);\n\t}\n\n\tdisplayControl()\n\t{\n\t\tthis.dropdownSelect = new ViewDropDownSelect({\n\t\t\twrap: this.DOM.controlWrap,\n\t\t\tvalues: this.serviceList,\n\t\t\tselected: this.getSelectedService(),\n\t\t\thandleChangesCallback: function (selectedValues)\n\t\t\t{\n\t\t\t\tif (selectedValues && selectedValues[0])\n\t\t\t\t{\n\t\t\t\t\tthis.setSelectedService(selectedValues[0]);\n\t\t\t\t\tif (this.changeValueCallback)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.changeValueCallback();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t});\n\t\tthis.dropdownSelect.build();\n\t}\n\n\trefresh(data)\n\t{\n\t\tthis.refreshLabel(data);\n\t\tthis.data = data;\n\n\t\tthis.handleSettingsData(this.data);\n\n\t\tif (this.dropdownSelect)\n\t\t{\n\t\t\tthis.dropdownSelect.setSettings({\n\t\t\t\tvalues: this.serviceList,\n\t\t\t\tselected: this.getSelectedService()\n\t\t\t});\n\t\t}\n\n\t\tif (this.setDataConfig())\n\t\t{\n\t\t\tif (this.isDisplayed())\n\t\t\t{\n\t\t\t\tthis.show({animation: true});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hide({animation: true});\n\t\t\t}\n\t\t}\n\t}\n\n\thandleSettingsData()\n\t{\n\t\tthis.serviceIndex = {};\n\t\tif (Type.isArray(this.allServiceList))\n\t\t{\n\t\t\tthis.allServiceList.forEach(function(service)\n\t\t\t{\n\t\t\t\tif (Type.isPlainObject(service)\n\t\t\t\t\t&& Type.isString(service.name)\n\t\t\t\t\t&& service.name.trim() !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.serviceIndex[this.prepareServiceId(service.name)] = service;\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\n\t\tthis.serviceList = [];\n\t\tif (this.data.value)\n\t\t{\n\t\t\tlet dataValueRaw = Type.isArray(this.data.value) ? this.data.value : this.data.value.split('|');\n\t\t\tdataValueRaw.forEach(function(id)\n\t\t\t{\n\t\t\t\tlet service = this.serviceIndex[this.prepareServiceId(id)];\n\t\t\t\tif (Type.isPlainObject(service)\n\t\t\t\t\t&& Type.isString(service.name)\n\t\t\t\t\t&& service.name.trim() !== '')\n\t\t\t\t{\n\t\t\t\t\tthis.serviceList.push({\n\t\t\t\t\t\tid: this.prepareServiceId(service.name),\n\t\t\t\t\t\ttitle: service.name + ' - ' + BookingUtil.getDurationLabel(service.duration)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\t}\n\n\tsetSelectedService(serviceName)\n\t{\n\t\tthis.selectedService = serviceName;\n\t}\n\n\tgetSelectedService(getMeta)\n\t{\n\t\treturn getMeta !== true ? (this.selectedService || null) : (this.serviceIndex[this.prepareServiceId(this.selectedService)] || null);\n\t}\n\n\tprepareServiceId(str)\n\t{\n\t\treturn BookingUtil.translit(str);\n\t}\n}\n","import {Type, Dom, BookingUtil, SelectInput} from \"../resourcebooking\";\nimport {ViewControlAbstract} from \"../viewcontrolabstract\";\n\nexport class DurationSelector extends ViewControlAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.name = 'DurationSelector';\n\t\tthis.data = params.data;\n\t\tthis.durationList = BookingUtil.getDurationList(params.fullDay);\n\t\tthis.changeValueCallback = params.changeValueCallback;\n\t\tthis.defaultValue = params.defaultValue || this.data.defaultValue;\n\t\tthis.handleSettingsData(params.data);\n\t}\n\n\thandleSettingsData()\n\t{\n\t\tthis.durationItems = [];\n\t\tif (Type.isArray(this.durationList))\n\t\t{\n\t\t\tthis.durationList.forEach(function(item)\n\t\t\t{\n\t\t\t\tthis.durationItems.push({\n\t\t\t\t\tid: item.value,\n\t\t\t\t\ttitle: item.label\n\t\t\t\t});\n\t\t\t}, this);\n\t\t}\n\t}\n\n\tdisplayControl()\n\t{\n\t\tthis.DOM.durationInput = this.DOM.controlWrap.appendChild(Dom.create('INPUT', {\n\t\t\tattrs: {\n\t\t\t\tvalue: this.data.defaultValue || null,\n\t\t\t\ttype: 'text'\n\t\t\t},\n\t\t\tprops: {className: 'calendar-resbook-webform-block-input calendar-resbook-webform-block-input-dropdown'}\n\t\t}));\n\n\t\tthis.durationControl = new SelectInput({\n\t\t\tinput: this.DOM.durationInput,\n\t\t\tvalues: this.durationList,\n\t\t\tvalue: this.data.defaultValue || null,\n\t\t\teditable: this.data.manualInput === 'Y',\n\t\t\tdefaultValue: this.defaultValue,\n\t\t\tsetFirstIfNotFound: true,\n\t\t\tonChangeCallback: this.changeValueCallback\n\t\t});\n\t}\n\n\trefresh(data)\n\t{\n\t\tthis.refreshLabel(data);\n\t\tthis.data = data;\n\t\tthis.handleSettingsData(this.data);\n\n\t\tif (this.setDataConfig())\n\t\t{\n\t\t\tif (this.isDisplayed())\n\t\t\t{\n\t\t\t\tthis.show({animation: true});\n\t\t\t\tif (this.durationControl)\n\t\t\t\t{\n\t\t\t\t\tthis.durationControl.setValue(this.data.defaultValue || null);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.hide({animation: true});\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSelectedValue()\n\t{\n\t\tlet duration = null;\n\t\tif (this.durationControl)\n\t\t{\n\t\t\tduration = BookingUtil.parseDuration(this.durationControl.getValue());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tduration = parseInt(this.defaultValue);\n\t\t}\n\t\treturn duration;\n\t}\n}","import {Type, Loc, Dom, Event, Tag, Browser, BookingUtil} from \"../resourcebooking\";\nimport {ViewControlAbstract} from \"../viewcontrolabstract\";\n\nexport class DateSelector extends ViewControlAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.DOM = {\n\t\t\touterWrap: params.outerWrap,\n\t\t\twrap: null\n\t\t};\n\t\tthis.data = params.data || {};\n\t\tthis.changeValueCallback = params.changeValueCallback;\n\t\tthis.requestDataCallback = params.requestDataCallback;\n\t\tthis.previewMode = params.previewMode === undefined;\n\t\tthis.allowOverbooking = params.allowOverbooking;\n\t\tthis.setDataConfig();\n\t\tthis.displayed = true;\n\t}\n\n\tdisplay(params)\n\t{\n\t\tparams = params || {};\n\t\tthis.setDateIndex(params.availableDateIndex);\n\t\tthis.setCurrentDate(params.selectedValue);\n\n\t\tthis.DOM.wrap = this.DOM.outerWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block\"></div>`);\n\n\t\tthis.DOM.innerWrap = this.DOM.wrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-inner\"></div>`);\n\t\tif (this.data.label)\n\t\t{\n\t\t\tthis.DOM.labelWrap = this.DOM.innerWrap.appendChild(Dom.create(\"div\", {props : { className : 'calendar-resbook-webform-block-title'}, text: this.data.label + '*'}));\n\t\t}\n\t\tthis.displayControl();\n\t\tthis.shown = true;\n\t}\n\n\trefresh(data, params)\n\t{\n\t\tparams = params || {};\n\t\tthis.setDateIndex(params.availableDateIndex);\n\t\tthis.setCurrentDate(params.selectedValue);\n\n\t\tthis.data = data;\n\t\tDom.adjust(this.DOM.labelWrap, {text: this.data.label + '*'});\n\n\t\tif (this.setDataConfig())\n\t\t{\n\t\t\tDom.remove(this.DOM.controlWrap);\n\t\t\tthis.displayControl();\n\t\t}\n\n\t\tif (this.style === 'line')\n\t\t{\n\t\t\tthis.lineDateControl.refreshDateAvailability();\n\t\t}\n\t}\n\n\tsetDataConfig()\n\t{\n\t\tlet\n\t\t\tstyle = this.data.style === 'line' ? 'line' : 'popup', // line|popup\n\t\t\tstart = this.data.start === 'today' ? 'today' : 'free',\n\t\t\tconfigWasChanged = this.style !== style || this.start !== start;\n\n\t\tthis.style = style;\n\t\tthis.start = start;\n\n\t\treturn configWasChanged;\n\t}\n\n\thide()\n\t{\n\t\tDom.remove(this.DOM.innerWrap);\n\t\tthis.DOM.innerWrap = null;\n\t}\n\n\tdisplayControl()\n\t{\n\t\tthis.DOM.controlWrap = this.DOM.innerWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-date\"></div>`);\n\n\t\tif (this.style === 'popup')\n\t\t{\n\t\t\tthis.DOM.controlWrap.className = 'calendar-resbook-webform-block-calendar';\n\t\t\tthis.popupSateControl = new PopupDateSelector(\n\t\t\t\t{\n\t\t\t\t\twrap: this.DOM.controlWrap,\n\t\t\t\t\tisDateAvailable: this.isDateAvailable.bind(this),\n\t\t\t\t\tonChange: function(value)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onChange(value);\n\t\t\t\t\t}.bind(this)\n\t\t\t\t});\n\t\t\tthis.popupSateControl.build();\n\t\t\tthis.popupSateControl.setValue(this.getValue());\n\t\t}\n\t\telse if (this.style === 'line')\n\t\t{\n\t\t\tthis.DOM.controlWrap.className = 'calendar-resbook-webform-block-date';\n\t\t\tthis.lineDateControl = new LineDateSelector(\n\t\t\t\t{\n\t\t\t\t\twrap: this.DOM.controlWrap,\n\t\t\t\t\tisDateAvailable: this.isDateAvailable.bind(this),\n\t\t\t\t\tonChange: this.onChange.bind(this)\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.lineDateControl.build();\n\t\t\tthis.lineDateControl.setValue(this.getValue());\n\t\t}\n\t}\n\n\tsetCurrentDate(date)\n\t{\n\t\tif (Type.isDate(date))\n\t\t{\n\t\t\tthis.currentDate = date;\n\t\t}\n\t}\n\n\tsetDateIndex(availableDateIndex)\n\t{\n\t\tif (Type.isPlainObject(availableDateIndex))\n\t\t{\n\t\t\tthis.availableDateIndex = availableDateIndex;\n\t\t}\n\t}\n\n\tisDateLoaded(date)\n\t{\n\t\tif (Type.isDate(date) && !this.isItPastDate(date) && this.availableDateIndex)\n\t\t{\n\t\t\tif (this.availableDateIndex[BookingUtil.formatDate(null, date)] !== undefined)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (Type.isFunction(this.requestDataCallback))\n\t\t\t{\n\t\t\t\tthis.requestDataCallback({date: date});\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tisDateAvailable(date)\n\t{\n\t\tif (this.previewMode || this.allowOverbooking)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (Type.isDate(date) && !this.isItPastDate(date) && this.availableDateIndex)\n\t\t{\n\t\t\tlet dateKey = BookingUtil.formatDate(null, date);\n\t\t\tif (this.availableDateIndex[dateKey] === undefined)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(this.requestDataCallback))\n\t\t\t\t{\n\t\t\t\t\tthis.requestDataCallback({date: date});\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn this.availableDateIndex[dateKey];\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tisItPastDate(date)\n\t{\n\t\tif (Type.isDate(date))\n\t\t{\n\t\t\tlet\n\t\t\t\tnowDate = new Date(),\n\t\t\t\tcheckDate = new Date(date.getTime());\n\n\t\t\tnowDate.setHours(0, 0, 0, 0);\n\t\t\tcheckDate.setHours(0, 0, 0, 0);\n\n\t\t\treturn checkDate.getTime() < nowDate.getTime();\n\t\t}\n\t\treturn false;\n\t}\n\n\trefreshCurrentValue()\n\t{\n\t\tthis.onChange(this.getDisplayedValue());\n\t}\n\n\tgetDisplayedValue()\n\t{\n\t\treturn this.style === 'popup' ? this.popupSateControl.getValue() : this.lineDateControl.getValue();;\n\t}\n\n\tonChange(date)\n\t{\n\t\tif (Type.isFunction(this.changeValueCallback))\n\t\t{\n\t\t\tlet realDate = date;\n\t\t\tif (!Type.isDate(realDate))\n\t\t\t{\n\t\t\t\trealDate = this.getDisplayedValue();\n\t\t\t}\n\t\t\tthis.setCurrentDate(date);\n\t\t\tthis.changeValueCallback(date, realDate, this.isDateAvailable(realDate));\n\t\t}\n\t}\n\n\tgetValue()\n\t{\n\t\tif (!this.currentDate)\n\t\t{\n\t\t\tthis.currentDate = new Date();\n\t\t}\n\t\treturn this.currentDate;\n\t}\n}\n\n\nclass PopupDateSelector\n{\n\tstatic externalDatePickerIsEnabled = null;\n\n\tconstructor(params)\n\t{\n\t\tthis.DOM = {\n\t\t\touterWrap: params.wrap,\n\t\t\twrap: null\n\t\t};\n\t\tthis.value = null;\n\t\tthis.datePicker = null;\n\t\tthis.isDateAvailable = Type.isFunction(params.isDateAvailable) ? params.isDateAvailable : function(){return true};\n\t\tthis.onChange = Type.isFunction(params.onChange) ? params.onChange : function(){};\n\t}\n\n\tbuild()\n\t{\n\t\tthis.DOM.wrap = this.DOM.outerWrap.appendChild(Dom.create(\"div\", {\n\t\t\tprops : { className : 'calendar-resbook-webform-block-strip'},\n\t\t\tevents: {click: this.handleClick.bind(this)}\n\t\t}));\n\n\t\tthis.DOM.valueInput = this.DOM.wrap.appendChild(Tag.render`<input type=\"hidden\" \nvalue=\"\"/>`);\n\n\t\tthis.DOM.previousArrow = this.DOM.wrap.appendChild(Tag.render`<span class=\"calendar-resbook-webform-block-strip-arrow calendar-resbook-webform-block-strip-arrow-prev\" data-bx-resbook-date-meta=\"previous\"/>`);\n\n\t\tthis.DOM.stateWrap = this.DOM.wrap.appendChild(Tag.render`<span class=\"calendar-resbook-webform-block-strip-text\" data-bx-resbook-date-meta=\"calendar\"/>`);\n\n\t\tthis.DOM.stateWrapDate = this.DOM.stateWrap.appendChild(Tag.render`<span class=\"calendar-resbook-webform-block-strip-date\"/>`);\n\t\tthis.DOM.stateWrapDay = this.DOM.stateWrap.appendChild(Tag.render`<span class=\"calendar-resbook-webform-block-strip-day\"/>`);\n\n\t\tthis.DOM.nextArrow = this.DOM.wrap.appendChild(Tag.render`<span class=\"calendar-resbook-webform-block-strip-arrow calendar-resbook-webform-block-strip-arrow-next\" data-bx-resbook-date-meta=\"next\"/>`);\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.value;\n\t}\n\n\tsetValue(dateValue)\n\t{\n\t\tthis.value = dateValue;\n\t\tDom.adjust(this.DOM.stateWrapDate, {text: BookingUtil.formatDate(Loc.getMessage('WEBF_RES_DATE_FORMAT_DATE_LINE'), dateValue)});\n\t\tDom.adjust(this.DOM.stateWrapDay, {text: BookingUtil.formatDate(Loc.getMessage('WEBF_RES_DATE_FORMAT_DAY_LINE'), dateValue)});\n\n\t\tif (!this.isDateAvailable(dateValue) || !Type.isDate(dateValue))\n\t\t{\n\t\t\tthis.onChange(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.onChange(this.value);\n\t\t}\n\t}\n\n\thandleClick(e)\n\t{\n\t\tlet\n\t\t\tdateValue,\n\t\t\ttarget = e.target || e.srcElement;\n\n\t\tif (target.hasAttribute('data-bx-resbook-date-meta') ||\n\t\t\t(target = target.closest('[data-bx-resbook-date-meta]')))\n\t\t{\n\t\t\tlet dateMeta = target.getAttribute('data-bx-resbook-date-meta');\n\t\t\tif (dateMeta === 'previous')\n\t\t\t{\n\t\t\t\tdateValue = this.getValue();\n\t\t\t\tdateValue.setDate(dateValue.getDate() - 1);\n\t\t\t\tthis.setValue(dateValue);\n\t\t\t}\n\t\t\telse if (dateMeta === 'next')\n\t\t\t{\n\t\t\t\tdateValue = this.getValue();\n\t\t\t\tdateValue.setDate(dateValue.getDate() + 1);\n\t\t\t\tthis.setValue(dateValue);\n\t\t\t}\n\t\t\telse if (dateMeta === 'calendar')\n\t\t\t{\n\t\t\t\tthis.openCalendarPopup();\n\t\t\t}\n\t\t}\n\t}\n\n\topenCalendarPopup()\n\t{\n\t\tthis.DOM.valueInput.value = BookingUtil.formatDate(null, this.getValue().getTime() / 1000);\n\n\t\tif (PopupDateSelector.isExternalDatePickerEnabled())\n\t\t{\n\t\t\tthis.openExternalDatePicker();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.openBxCalendar();\n\t\t}\n\t}\n\n\topenBxCalendar()\n\t{\n\t\tBX.calendar({node: this.DOM.stateWrap, field: this.DOM.valueInput, bTime: false});\n\t\tif (BX.calendar.get().popup)\n\t\t{\n\t\t\tBookingUtil.unbindCustomEvent(BX.calendar.get().popup, 'onPopupClose', this.handleCalendarClose.bind(this));\n\t\t\tBookingUtil.bindCustomEvent(BX.calendar.get().popup, 'onPopupClose', this.handleCalendarClose.bind(this));\n\t\t}\n\t}\n\n\thandleCalendarClose()\n\t{\n\t\tthis.setValue(BookingUtil.parseDate(this.DOM.valueInput.value));\n\t}\n\n\tstatic isExternalDatePickerEnabled()\n\t{\n\t\tif (Type.isNull(PopupDateSelector.externalDatePickerIsEnabled))\n\t\t{\n\t\t\tPopupDateSelector.externalDatePickerIsEnabled = !!(window.BX && BX.UI && BX.UI.Vue && BX.UI.Vue.Components && BX.UI.Vue.Components.DatePick);\n\t\t}\n\n\t\treturn PopupDateSelector.externalDatePickerIsEnabled;\n\t}\n\n\topenExternalDatePicker()\n\t{\n\t\tif (Type.isNull(this.datePicker))\n\t\t{\n\t\t\tthis.datePicker = new BX.UI.Vue.Components.DatePick(\n\t\t\t\t{\n\t\t\t\t\tnode: this.DOM.stateWrap,\n\t\t\t\t\thasTime: false,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tchange: function(value){\n\t\t\t\t\t\t\tthis.DOM.valueInput.value = value;\n\t\t\t\t\t\t\tthis.handleCalendarClose();\n\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.datePicker.value = this.DOM.valueInput.value;\n\t\tthis.datePicker.toggle();\n\t}\n}\n\n\n\nclass LineDateSelector\n{\n\tconstructor(params)\n\t{\n\t\tparams = params || {};\n\t\tthis.DOM = {\n\t\t\touterWrap: params.wrap,\n\t\t\twrap: null\n\t\t};\n\t\tthis.value = null;\n\t\tthis.isDateAvailable = Type.isFunction(params.isDateAvailable) ? params.isDateAvailable : function(){return true};\n\t\tthis.onChange = Type.isFunction(params.onChange) ? params.onChange : function(){};\n\t\tthis.DAYS_DISPLAY_SIZE = 30;\n\t\tthis.DOM.dayNodes = {};\n\t\tthis.dayNodeIndex = {};\n\t}\n\n\tbuild()\n\t{\n\t\tthis.DOM.monthTitle = this.DOM.outerWrap.appendChild(Dom.create(\"span\", {\n\t\t\tprops : { className : 'calendar-resbook-webform-block-date-month'}\n\t\t}));\n\n\t\tthis.DOM.wrap = this.DOM.outerWrap.appendChild(Dom.create(\"div\", {\n\t\t\tprops : { className : 'calendar-resbook-webform-block-date-range'},\n\t\t\tevents: {click: this.handleClick.bind(this)}\n\t\t}));\n\n\t\tthis.DOM.controlStaticWrap = this.DOM.wrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-date-range-static-wrap\" \n></div>`);\n\t\tthis.DOM.controlInnerWrap = this.DOM.controlStaticWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-date-range-inner-wrap\" \n></div>`);\n\t\tthis.DOM.valueInput = this.DOM.wrap.appendChild(Tag.render`<input type=\"hidden\" \nvalue=\"\"/>`);\n\n\t\tthis.fillDays();\n\t\tthis.initCustomScroll();\n\t}\n\n\tfillDays()\n\t{\n\t\tlet\n\t\t\ti,\n\t\t\tstartDate = this.getStartLoadDate(),\n\t\t\tdate = new Date(startDate.getTime());\n\n\t\tfor (i = 0; i < this.DAYS_DISPLAY_SIZE; i++)\n\t\t{\n\t\t\tthis.addDateSlot(date);\n\t\t\tdate.setDate(date.getDate() + 1);\n\t\t}\n\n\t\tthis.innerWidth = parseInt(this.DOM.controlInnerWrap.offsetWidth);\n\t}\n\n\taddDateSlot(date)\n\t{\n\t\tlet dateCode = BookingUtil.formatDate('Y-m-d', date.getTime() / 1000);\n\t\tthis.dayNodeIndex[dateCode] = new Date(date.getTime());\n\t\tthis.DOM.dayNodes[dateCode] = this.DOM.controlInnerWrap.appendChild(Dom.create(\"div\", {\n\t\t\tattrs : {\n\t\t\t\tclassName : 'calendar-resbook-webform-block-date-item' + (this.isDateAvailable(date) ? '' : ' calendar-resbook-webform-block-date-item-off'),\n\t\t\t\t'data-bx-resbook-date-meta' : dateCode\n\t\t\t},\n\t\t\thtml: '<div class=\"calendar-resbook-webform-block-date-item-inner\">' +\n\t\t\t\t'<span class=\"calendar-resbook-webform-block-date-number\">' +\n\t\t\t\tBookingUtil.formatDate(Loc.getMessage('WEBF_RES_DATE_FORMAT_DATE'), date) +\n\t\t\t\t'</span>' +\n\t\t\t\t'<span class=\"calendar-resbook-webform-block-date-day\">' +\n\t\t\t\tBookingUtil.formatDate(Loc.getMessage('WEBF_RES_DATE_FORMAT_DAY_OF_THE_WEEK'), date) +\n\t\t\t\t'</span>' +\n\t\t\t\t'</div>'\n\t\t}));\n\t}\n\n\trefreshDateAvailability()\n\t{\n\t\tfor (let dateCode in this.DOM.dayNodes)\n\t\t{\n\t\t\tif (this.DOM.dayNodes.hasOwnProperty(dateCode))\n\t\t\t{\n\t\t\t\tif (this.isDateAvailable(this.dayNodeIndex[dateCode]))\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(this.DOM.dayNodes[dateCode], 'calendar-resbook-webform-block-date-item-off');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.DOM.dayNodes[dateCode], 'calendar-resbook-webform-block-date-item-off');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\thandleClick(e)\n\t{\n\t\tlet\n\t\t\tdateValue,\n\t\t\ttarget = e.target || e.srcElement;\n\n\t\tif (target.hasAttribute('data-bx-resbook-date-meta') ||\n\t\t\t(target = target.closest('[data-bx-resbook-date-meta]')))\n\t\t{\n\t\t\tlet dateMeta = target.getAttribute('data-bx-resbook-date-meta');\n\t\t\tif (dateMeta && (dateValue = BookingUtil.parseDate(dateMeta, false, 'YYYY-MM-DD')))\n\t\t\t{\n\t\t\t\tthis.setValue(dateValue);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetValue(dateValue)\n\t{\n\t\tif (Type.isDate(dateValue))\n\t\t{\n\t\t\tthis.value = dateValue;\n\t\t\tlet dayNode = this.getDayNode(dateValue);\n\t\t\tif (dayNode)\n\t\t\t{\n\t\t\t\tthis.setSelected(dayNode);\n\t\t\t}\n\t\t\tthis.onChange(this.value);\n\t\t}\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.value;\n\t}\n\n\tgetDayNode(dateValue)\n\t{\n\t\tlet dateCode = BookingUtil.formatDate('Y-m-d', dateValue.getTime() / 1000);\n\t\tif (this.DOM.dayNodes[dateCode])\n\t\t{\n\t\t\treturn this.DOM.dayNodes[dateCode];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.fillDays(dateValue);\n\t\t\tif (this.DOM.dayNodes[dateCode])\n\t\t\t{\n\t\t\t\treturn this.DOM.dayNodes[dateCode];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tsetSelected(dayNode)\n\t{\n\t\tif (this.currentSelected)\n\t\t{\n\t\t\tDom.removeClass(this.currentSelected, 'calendar-resbook-webform-block-date-item-select');\n\t\t}\n\t\tthis.currentSelected = dayNode;\n\t\tDom.addClass(dayNode, 'calendar-resbook-webform-block-date-item-select');\n\t}\n\n\tgetStartLoadDate()\n\t{\n\t\tif (!this.startLoadDate)\n\t\t{\n\t\t\tthis.startLoadDate = new Date();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.startLoadDate.setDate(this.startLoadDate.getDate() + this.DAYS_DISPLAY_SIZE);\n\t\t}\n\t\treturn this.startLoadDate;\n\t}\n\n\tinitCustomScroll()\n\t{\n\t\tlet arrowWrap = this.DOM.wrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-arrow-container\" \n></div>`);\n\n\t\tthis.DOM.leftArrow = arrowWrap.appendChild(Dom.create(\"span\",\n\t\t\t{\n\t\t\t\tprops : {className : 'calendar-resbook-webform-block-arrow calendar-resbook-webform-block-arrow-prev'},\n\t\t\t\tevents: {click: this.handlePreletrowClick.bind(this)}\n\t\t\t}));\n\t\tthis.DOM.rightArrow = arrowWrap.appendChild(Dom.create(\"span\",\n\t\t\t{\n\t\t\t\tprops : { className : 'calendar-resbook-webform-block-arrow calendar-resbook-webform-block-arrow-next'},\n\t\t\t\tevents: {click: this.handleNextArrowClick.bind(this)}\n\t\t\t}));\n\n\t\tthis.outerWidth = parseInt(this.DOM.controlStaticWrap.offsetWidth);\n\t\tthis.innerWidth = parseInt(this.DOM.controlInnerWrap.offsetWidth);\n\n\t\tif ('onwheel' in document)\n\t\t{\n\t\t\tEvent.bind(this.DOM.controlStaticWrap, \"wheel\", this.mousewheelScrollHandler.bind(this));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(this.DOM.controlStaticWrap, \"mousewheel\", this.mousewheelScrollHandler.bind(this));\n\t\t}\n\n\t\tthis.checkScrollPosition();\n\t}\n\n\thandleNextArrowClick()\n\t{\n\t\tthis.DOM.controlStaticWrap.scrollLeft = this.DOM.controlStaticWrap.scrollLeft + 100;\n\t\tthis.checkScrollPosition();\n\t}\n\n\thandlePreletrowClick()\n\t{\n\t\tthis.DOM.controlStaticWrap.scrollLeft = Math.max(this.DOM.controlStaticWrap.scrollLeft - 100, 0);\n\t\tthis.checkScrollPosition();\n\t}\n\n\tmousewheelScrollHandler(e)\n\t{\n\t\te = e || window.event;\n\t\tlet delta = e.deltaY || e.detail || e.wheelDelta;\n\t\tif (Math.abs(delta) > 0)\n\t\t{\n\t\t\tif (!Browser.isMac())\n\t\t\t{\n\t\t\t\tdelta = delta * 3;\n\t\t\t}\n\t\t\tthis.DOM.controlStaticWrap.scrollLeft = Math.max(this.DOM.controlStaticWrap.scrollLeft + delta, 0);\n\t\t\tthis.checkScrollPosition();\n\n\t\t\tif(e.stopPropagation)\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tcheckScrollPosition()\n\t{\n\t\tif (this.outerWidth <= this.innerWidth)\n\t\t{\n\t\t\tthis.DOM.leftArrow.style.display = this.DOM.controlStaticWrap.scrollLeft === 0 ? 'none' : '';\n\t\t\t//this.DOM.rightArrow.style.display = (this.innerWidth - this.outerWidth - 4 <= this.DOM.controlStaticWrap.scrollLeft) ? 'none' : '';\n\t\t\tif (this.innerWidth - this.outerWidth - 4 <= this.DOM.controlStaticWrap.scrollLeft)\n\t\t\t{\n\t\t\t\tthis.fillDays();\n\t\t\t}\n\t\t}\n\n\t\tthis.updateMonthTitle();\n\t}\n\n\tupdateMonthTitle()\n\t{\n\t\tif (!this.dayNodeOuterWidth)\n\t\t{\n\t\t\tthis.dayNodeOuterWidth = this.DOM.controlInnerWrap.childNodes[1].offsetLeft - this.DOM.controlInnerWrap.childNodes[0].offsetLeft;\n\t\t\tif (!this.dayNodeOuterWidth)\n\t\t\t{\n\t\t\t\treturn setTimeout(this.updateMonthTitle.bind(this), 100);\n\t\t\t}\n\t\t}\n\n\t\tlet\n\t\t\tmonthFrom, monthTo, dateMeta, dateValue,\n\t\t\tfirstDayNodeIndex = Math.floor(this.DOM.controlStaticWrap.scrollLeft / this.dayNodeOuterWidth),\n\t\t\tlastDayNodeIndex = Math.floor((this.DOM.controlStaticWrap.scrollLeft + this.outerWidth) / this.dayNodeOuterWidth);\n\n\t\tif (this.DOM.controlInnerWrap.childNodes[firstDayNodeIndex])\n\t\t{\n\t\t\tdateMeta = this.DOM.controlInnerWrap.childNodes[firstDayNodeIndex].getAttribute('data-bx-resbook-date-meta');\n\t\t\tif (dateMeta && (dateValue = BookingUtil.parseDate(dateMeta, false, 'YYYY-MM-DD')))\n\t\t\t{\n\t\t\t\tmonthFrom = monthTo = BookingUtil.formatDate('f', dateValue);\n\t\t\t}\n\t\t}\n\n\t\tif (this.DOM.controlInnerWrap.childNodes[lastDayNodeIndex])\n\t\t{\n\t\t\tdateMeta = this.DOM.controlInnerWrap.childNodes[lastDayNodeIndex].getAttribute('data-bx-resbook-date-meta');\n\t\t\tif (dateMeta && (dateValue = BookingUtil.parseDate(dateMeta, false, 'YYYY-MM-DD')))\n\t\t\t{\n\t\t\t\tmonthTo = BookingUtil.formatDate('f', dateValue);\n\t\t\t}\n\t\t}\n\n\t\tif (monthFrom && monthTo)\n\t\t{\n\t\t\tDom.adjust(this.DOM.monthTitle, {text: monthTo === monthFrom ? monthFrom : monthFrom + ' - ' + monthTo});\n\t\t}\n\t}\n}","import {Type, Loc, Dom, Event, Tag, Browser, BookingUtil, MenuManager} from \"../resourcebooking\";\nimport {ViewControlAbstract} from \"../viewcontrolabstract\";\n\nexport class TimeSelector extends ViewControlAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.DOM = {\n\t\t\touterWrap: params.outerWrap,\n\t\t\twrap: null\n\t\t};\n\n\t\tthis.data = params.data || {};\n\t\tthis.setDataConfig();\n\n\t\tthis.timeFrom = this.data.timeFrom || params.timeFrom || 7;\n\t\tif (params.timeFrom !== undefined)\n\t\t{\n\t\t\tthis.timeFrom = params.timeFrom;\n\t\t}\n\t\tthis.timeTo = this.data.timeTo || 20;\n\t\tif (params.timeTo !== undefined)\n\t\t{\n\t\t\tthis.timeTo = params.timeTo;\n\t\t}\n\t\tthis.SLOTS_ROW_AMOUNT = 6;\n\t\tthis.id = 'time-selector-' + Math.round(Math.random() * 1000);\n\t\tthis.popupSelectId = this.id + '-select-popup';\n\n\t\tthis.previewMode = params.previewMode === undefined;\n\t\tthis.changeValueCallback = params.changeValueCallback;\n\t\tthis.timezone = params.timezone;\n\t\tthis.timezoneOffset = params.timezoneOffset;\n\t\tthis.timezoneOffsetLabel = params.timezoneOffsetLabel;\n\t\tthis.timeMidday = 12;\n\t\tthis.timeEvening = 17;\n\t\tthis.displayed = true;\n\t}\n\n\tsetDataConfig()\n\t{\n\t\tlet\n\t\t\tstyle = this.data.style === 'select' ? 'select' : 'slots', // select|slots\n\t\t\tshowOnlyFree = this.data.showOnlyFree !== 'N',\n\t\t\tshowFinishTime = this.data.showFinishTime === 'Y',\n\t\t\tscale = parseInt(this.data.scale || 30),\n\t\t\tconfigWasChanged = this.style !== style || this.showOnlyFree !== showOnlyFree || this.showFinishTime !== showFinishTime || this.scale !== scale;\n\n\t\tthis.style = style;\n\t\tthis.showOnlyFree = showOnlyFree;\n\t\tthis.showFinishTime = showFinishTime;\n\t\tthis.scale = scale;\n\n\t\treturn configWasChanged;\n\t}\n\n\tdisplay()\n\t{\n\t\tthis.DOM.wrap = this.DOM.outerWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block\"></div>`);\n\t\tthis.DOM.innerWrap = this.DOM.wrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-inner\"></div>`);\n\t\tif (this.data.label)\n\t\t{\n\t\t\tthis.DOM.labelWrap = this.DOM.innerWrap.appendChild(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'calendar-resbook-webform-block-title'},\n\t\t\t\ttext: this.data.label + '*'\n\t\t\t}));\n\n\t\t\tif (this.timezone)\n\t\t\t{\n\t\t\t\tthis.DOM.timezoneLabelWrap = this.DOM.labelWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-title-timezone\"></div>`);\n\t\t\t\tDom.adjust(this.DOM.timezoneLabelWrap, {html: Loc.getMessage('USER_TYPE_RESOURCE_TIMEZONE').replace('#TIMEZONE#', this.timezone + ' ' + this.timezoneOffsetLabel)});\n\t\t\t}\n\t\t}\n\n\t\tthis.displayControl();\n\t\tthis.setValue(this.getValue());\n\t\tthis.shown = true;\n\t}\n\n\trefresh(data, params)\n\t{\n\t\tparams = params || {};\n\t\tthis.setSlotIndex(params.slotIndex);\n\t\tthis.currentDate = params.currentDate || new Date();\n\t\tthis.data = data;\n\n\t\tif (!this.isShown())\n\t\t{\n\t\t\tthis.setDataConfig();\n\t\t\tthis.display();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.DOM.labelWrap && this.data.label)\n\t\t\t{\n\t\t\t\tDom.adjust(this.DOM.labelWrap, {text: this.data.label + '*'});\n\t\t\t}\n\n\t\t\tif (this.timezone)\n\t\t\t{\n\t\t\t\tif (!this.DOM.timezoneLabelWrap\n\t\t\t\t\t|| !this.DOM.labelWrap.contains(this.DOM.timezoneLabelWrap))\n\t\t\t\t{\n\t\t\t\t\tthis.DOM.timezoneLabelWrap = this.DOM.labelWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-title-timezone\"></div>`);\n\n\t\t\t\t}\n\t\t\t\tDom.adjust(this.DOM.timezoneLabelWrap, {html: Loc.getMessage('USER_TYPE_RESOURCE_TIMEZONE').replace('#TIMEZONE#', this.timezone + ' ' + this.timezoneOffsetLabel)});\n\t\t\t}\n\n\t\t\tif (this.setDataConfig() || params.slotIndex || params.selectedValue)\n\t\t\t{\n\t\t\t\tDom.remove(this.DOM.controlWrap);\n\t\t\t\tthis.displayControl();\n\t\t\t}\n\t\t}\n\n\t\tthis.setCurrentValue(params.selectedValue || this.getValue());\n\t}\n\n\tsetSlotIndex(slotIndex)\n\t{\n\t\tif (Type.isPlainObject(slotIndex))\n\t\t{\n\t\t\tthis.availableSlotIndex = slotIndex;\n\t\t}\n\t}\n\n\tsetCurrentValue(timeValue)\n\t{\n\t\tif (timeValue && (this.previewMode || this.availableSlotIndex[timeValue]))\n\t\t{\n\t\t\tthis.setValue(timeValue);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setValue(null);\n\t\t}\n\t}\n\n\tshowEmptyWarning()\n\t{\n\t\tif (this.DOM.labelWrap)\n\t\t{\n\t\t\tthis.DOM.labelWrap.style.display = 'none';\n\t\t}\n\n\t\tif (!this.DOM.warningWrap)\n\t\t{\n\t\t\tthis.DOM.warningTextNode = Tag.render`<span class=\"calendar-resbook-webform-block-notice-date\"/>`;\n\n\t\t\tthis.DOM.warningWrap = this.DOM.innerWrap.appendChild(Dom.create(\"div\", {\n\t\t\t\tprops: {className: 'calendar-resbook-webform-block-notice'},\n\t\t\t\tchildren: [\n\t\t\t\t\tTag.render`<span class=\"calendar-resbook-webform-block-notice-icon\"/>`,\n\t\t\t\t\tthis.DOM.warningTextNode,\n\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\tprops: {className: 'calendar-resbook-webform-block-notice-detail'},\n\t\t\t\t\t\ttext: Loc.getMessage('WEBF_RES_BOOKING_BUSY_DAY_WARNING')\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}));\n\t\t}\n\n\t\tif (this.DOM.warningWrap)\n\t\t{\n\t\t\tDom.adjust(this.DOM.warningTextNode, {text: BookingUtil.formatDate(Loc.getMessage('WEBF_RES_BUSY_DAY_DATE_FORMAT'), this.currentDate)});\n\t\t\tthis.DOM.warningWrap.style.display = '';\n\n\t\t\tthis.noSlotsAvailable = true;\n\t\t}\n\t}\n\n\thideEmptyWarning()\n\t{\n\t\tthis.noSlotsAvailable = false;\n\t\tif (this.DOM.labelWrap)\n\t\t{\n\t\t\tthis.DOM.labelWrap.style.display = '';\n\t\t}\n\t\tif (this.DOM.warningWrap)\n\t\t{\n\t\t\tthis.DOM.warningWrap.style.display = 'none';\n\t\t}\n\t}\n\n\tdisplayControl()\n\t{\n\t\tlet slotsInfo = this.getSlotsInfo();\n\t\tthis.slots = slotsInfo.slots;\n\n\t\tif (!slotsInfo.freeSlotsCount)\n\t\t{\n\t\t\tthis.showEmptyWarning();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideEmptyWarning();\n\t\t\tif (this.style === 'select')\n\t\t\t{\n\t\t\t\tthis.createSelectControl();\n\t\t\t}\n\t\t\telse if (this.style === 'slots')\n\t\t\t{\n\t\t\t\tthis.createSlotsControl();\n\t\t\t}\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif (this.DOM.innerWrap)\n\t\t{\n\t\t\tthis.DOM.innerWrap.style.display = 'none';\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tif (this.DOM.innerWrap)\n\t\t{\n\t\t\tthis.DOM.innerWrap.style.display = '';\n\t\t}\n\t}\n\n\tcreateSlotsControl()\n\t{\n\t\tif (this.DOM.controlWrap)\n\t\t{\n\t\t\tDom.remove(this.DOM.controlWrap);\n\t\t}\n\n\t\tthis.DOM.controlWrap = this.DOM.innerWrap.appendChild(\n\t\t\tDom.create(\"div\", {\n\t\t\t\tprops: {className: 'calendar-resbook-webform-block-time'},\n\t\t\t\tevents: {click: this.handleClick.bind(this)}\n\t\t\t}));\n\n\t\tif (!this.showFinishTime && !BookingUtil.isAmPmMode())\n\t\t{\n\t\t\tDom.addClass(this.DOM.controlWrap, 'calendar-resbook-webform-block-time-sm');\n\t\t}\n\t\telse if (!this.showFinishTime && BookingUtil.isAmPmMode())\n\t\t{\n\t\t\tDom.addClass(this.DOM.controlWrap, 'calendar-resbook-webform-block-time-md');\n\t\t}\n\t\telse if (BookingUtil.isAmPmMode())\n\t\t{\n\t\t\tDom.addClass(this.DOM.controlWrap, 'calendar-resbook-webform-block-time-lg');\n\t\t}\n\n\t\tthis.DOM.controlStaticWrap = this.DOM.controlWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-time-static-wrap\"></div>`);\n\t\tthis.DOM.controlInnerWrap = this.DOM.controlStaticWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-time-inner-wrap\"></div>`);\n\n\t\tlet\n\t\t\titemsInColumn,\n\t\t\tmaxColumnNumber = 3,\n\t\t\tparts = {},\n\t\t\titemNumber = 0,\n\t\t\tinnerWrap;\n\n\t\t// FilterSlots\n\t\tthis.slots.forEach(function(slot)\n\t\t{\n\t\t\tif (!parts[slot.partOfTheDay])\n\t\t\t{\n\t\t\t\tparts[slot.partOfTheDay] = {\n\t\t\t\t\titems: []\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tparts[slot.partOfTheDay].items.push(slot);\n\t\t});\n\n\t\tthis.slots.forEach(function(slot)\n\t\t{\n\t\t\tif (!parts[slot.partOfTheDay].wrap)\n\t\t\t{\n\t\t\t\titemNumber = 0;\n\t\t\t\titemsInColumn = 6;\n\t\t\t\tparts[slot.partOfTheDay].wrap = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'calendar-resbook-webform-block-col'},\n\t\t\t\t\thtml: '<span class=\"calendar-resbook-webform-block-col-title\">'\n\t\t\t\t\t\t+ Loc.getMessage('WEBF_RES_PART_OF_THE_DAY_' + slot.partOfTheDay.toUpperCase())\n\t\t\t\t\t\t+ '</span>'\n\t\t\t\t});\n\n\t\t\t\tparts[slot.partOfTheDay].itemsWrap = parts[slot.partOfTheDay].wrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-col-list\"></div>`);\n\n\t\t\t\tif (parts[slot.partOfTheDay].items.length > maxColumnNumber * itemsInColumn)\n\t\t\t\t{\n\t\t\t\t\titemsInColumn = Math.ceil(parts[slot.partOfTheDay].items.length / maxColumnNumber);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (itemNumber % itemsInColumn === 0)\n\t\t\t{\n\t\t\t\tinnerWrap = parts[slot.partOfTheDay].itemsWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-col-list-inner\"></div>`);\n\t\t\t}\n\n\t\t\tif (innerWrap && (!slot.booked || !this.showOnlyFree))\n\t\t\t{\n\t\t\t\tinnerWrap.appendChild(Dom.create(\"div\", {\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t'data-bx-resbook-time-meta': 'slot' + (slot.booked ? '-off' : ''),\n\t\t\t\t\t\t'data-bx-resbook-slot': slot.time.toString(),\n\t\t\t\t\t\tclassName: 'calendar-resbook-webform-block-col-item'\n\t\t\t\t\t\t\t+ (slot.selected ? ' calendar-resbook-webform-block-col-item-select' : '')\n\t\t\t\t\t\t\t+ (slot.booked ? ' calendar-resbook-webform-block-col-item-off' : '')\n\t\t\t\t\t},\n\t\t\t\t\thtml: '<div class=\"calendar-resbook-webform-block-col-item-inner\">' + '<span class=\"calendar-resbook-webform-block-col-time\">' + slot.fromTime + '</span>' + (this.showFinishTime ? '- <span class=\"calendar-resbook-webform-block-col-time calendar-resbook-webform-block-col-time-end\">' + slot.toTime + '</span>' : ''\n\t\t\t\t\t) + '</div>'\n\t\t\t\t}));\n\t\t\t\titemNumber++;\n\t\t\t}\n\n\t\t\tparts[slot.partOfTheDay].itemsAmount = itemNumber;\n\t\t}, this);\n\n\t\tlet k;\n\t\tfor (k in parts)\n\t\t{\n\t\t\tif (parts.hasOwnProperty(k) && parts[k].itemsAmount > 0)\n\t\t\t{\n\t\t\t\tthis.DOM.controlInnerWrap.appendChild(parts[k].wrap);\n\t\t\t}\n\t\t}\n\n\t\tthis.initCustomScrollForSlots();\n\t}\n\n\tcreateSelectControl()\n\t{\n\t\tif (this.DOM.controlWrap)\n\t\t{\n\t\t\tDom.remove(this.DOM.controlWrap);\n\t\t}\n\n\t\tthis.DOM.controlWrap = this.DOM.innerWrap.appendChild(Dom.create(\"div\", {\n\t\t\tprops: {className: 'calendar-resbook-webform-block-field'},\n\t\t\tevents: {click: this.handleClick.bind(this)}\n\t\t}));\n\n\t\tthis.DOM.timeSelectWrap = this.DOM.controlWrap.appendChild(Dom.create(\"div\", {\n\t\t\tprops: {className: 'calendar-resbook-webform-block-strip'}\n\t\t}));\n\t\tthis.DOM.valueInput = this.DOM.timeSelectWrap.appendChild(Dom.create(\"input\", {\n\t\t\tattrs: {\n\t\t\t\ttype: 'hidden',\n\t\t\t\tvalue: ''\n\t\t\t}\n\t\t}));\n\n\t\tthis.DOM.previousArrow = this.DOM.timeSelectWrap.appendChild(Dom.create(\"span\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: 'calendar-resbook-webform-block-strip-arrow calendar-resbook-webform-block-strip-arrow-prev',\n\t\t\t\t'data-bx-resbook-time-meta': 'previous'\n\t\t\t}\n\t\t}));\n\n\t\tthis.DOM.stateWrap = this.DOM.timeSelectWrap.appendChild(Dom.create(\"span\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: 'calendar-resbook-webform-block-strip-text',\n\t\t\t\t'data-bx-resbook-time-meta': 'select'\n\t\t\t}\n\t\t}));\n\t\tthis.DOM.stateWrap = this.DOM.stateWrap.appendChild(Dom.create(\"span\", {props: {className: 'calendar-resbook-webform-block-strip-date'}}));\n\n\t\tthis.DOM.nextArrow = this.DOM.timeSelectWrap.appendChild(Dom.create(\"span\", {\n\t\t\tattrs: {\n\t\t\t\tclassName: 'calendar-resbook-webform-block-strip-arrow calendar-resbook-webform-block-strip-arrow-next',\n\t\t\t\t'data-bx-resbook-time-meta': 'next'\n\t\t\t}\n\t\t}));\n\n\t\tthis.setValue(this.getValue());\n\t}\n\n\tsetValue(value)\n\t{\n\t\tlet slot = this.getSlotByTime(value);\n\t\tif (slot)\n\t\t{\n\t\t\tif (this.style === 'select' && Type.isDomNode(this.DOM.stateWrap))\n\t\t\t{\n\t\t\t\tDom.adjust(this.DOM.stateWrap, {text: this.getTimeTextBySlot(slot)});\n\t\t\t}\n\t\t\telse if (this.style === 'slots')\n\t\t\t{\n\t\t\t\tthis.setSelected(this.getSlotNode(slot.time));\n\t\t\t}\n\t\t\tthis.value = slot.time;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.value = null;\n\t\t}\n\n\t\tif (!this.previewMode && Type.isFunction(this.changeValueCallback))\n\t\t{\n\t\t\tthis.changeValueCallback(this.value);\n\t\t}\n\t}\n\n\tgetValue()\n\t{\n\t\tif (!this.value && (this.previewMode || this.style === 'select'))\n\t\t{\n\t\t\tthis.value = this.slots[0].time;\n\t\t}\n\t\treturn this.value;\n\t}\n\n\thasAvailableSlots()\n\t{\n\t\treturn !this.noSlotsAvailable;\n\t}\n\n\tgetTimeTextBySlot(slot)\n\t{\n\t\treturn slot.fromTime + (this.showFinishTime ? ' - ' + slot.toTime : '');\n\t}\n\n\tgetSlotByTime(time)\n\t{\n\t\treturn Type.isArray(this.slots) ? this.slots.find(function(slot){return parseInt(slot.time) === parseInt(time);}) : null;\n\t}\n\n\thandleClick(e)\n\t{\n\t\tlet target = e.target || e.srcElement;\n\t\tif (target.hasAttribute('data-bx-resbook-time-meta') ||\n\t\t\t(target = target.closest('[data-bx-resbook-time-meta]')))\n\t\t{\n\t\t\tlet meta = target.getAttribute('data-bx-resbook-time-meta');\n\t\t\tif (this.style === 'select')\n\t\t\t{\n\t\t\t\tif (meta === 'previous')\n\t\t\t\t{\n\t\t\t\t\tthis.setValue(this.getValue() - this.scale);\n\t\t\t\t}\n\t\t\t\telse if (meta === 'next')\n\t\t\t\t{\n\t\t\t\t\tthis.setValue(this.getValue() + this.scale);\n\t\t\t\t}\n\t\t\t\telse if (meta === 'select')\n\t\t\t\t{\n\t\t\t\t\tthis.openSelectPopup();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (meta === 'slot')\n\t\t\t{\n\t\t\t\tthis.setValue(parseInt(target.getAttribute('data-bx-resbook-slot')));\n\t\t\t}\n\t\t}\n\t}\n\n\tgetSlotsInfo()\n\t{\n\t\tlet\n\t\t\tslots = [], slot,\n\t\t\tfreeSlotsCount = 0,\n\t\t\tfinishTime, hourFrom, minFrom,\n\t\t\thourTo, minTo,\n\t\t\tpart = 'morning',\n\t\t\tnum = 0,\n\t\t\ttime = this.timeFrom * 60;\n\n\t\twhile (time < this.timeTo * 60)\n\t\t{\n\t\t\tif (time >= this.timeEvening * 60)\n\t\t\t{\n\t\t\t\tpart = 'evening';\n\t\t\t}\n\t\t\telse if (time >= this.timeMidday * 60)\n\t\t\t{\n\t\t\t\tpart = 'afternoon';\n\t\t\t}\n\n\t\t\thourFrom = Math.floor(time / 60);\n\t\t\tminFrom = (time) - hourFrom * 60;\n\t\t\tfinishTime = time + this.scale;\n\t\t\thourTo = Math.floor(finishTime / 60);\n\t\t\tminTo = (finishTime) - hourTo * 60;\n\n\t\t\tslot = {\n\t\t\t\ttime: time,\n\t\t\t\tfromTime: BookingUtil.formatTime(hourFrom, minFrom),\n\t\t\t\ttoTime: BookingUtil.formatTime(hourTo, minTo),\n\t\t\t\tpartOfTheDay: part\n\t\t\t};\n\n\t\t\tif (this.previewMode)\n\t\t\t{\n\t\t\t\tif (!num)\n\t\t\t\t{\n\t\t\t\t\tslot.selected = true;\n\t\t\t\t}\n\t\t\t\telse if (Math.round(Math.random() * 10) <= 3)\n\t\t\t\t{\n\t\t\t\t\tslot.booked = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(this.availableSlotIndex)\n\t\t\t{\n\t\t\t\tslot.booked = !this.availableSlotIndex[time];\n\t\t\t}\n\n\t\t\tif (!slot.booked)\n\t\t\t{\n\t\t\t\tfreeSlotsCount++;\n\t\t\t}\n\n\t\t\tslots.push(slot);\n\t\t\ttime += this.scale;\n\t\t\tnum++;\n\t\t}\n\n\t\treturn {\n\t\t\tslots: slots,\n\t\t\tfreeSlotsCount: freeSlotsCount\n\t\t};\n\t}\n\n\tinitCustomScrollForSlots()\n\t{\n\t\tlet arrowWrap = this.DOM.controlWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-arrow-container\" />`);\n\n\t\t\tthis.DOM.leftArrow = arrowWrap.appendChild(Dom.create(\"span\",\n\t\t\t{\n\t\t\t\tprops : {className : 'calendar-resbook-webform-block-arrow calendar-resbook-webform-block-arrow-prev'},\n\t\t\t\tevents: {click: this.handlePreletrowClick.bind(this)}\n\t\t\t}));\n\t\tthis.DOM.rightArrow = arrowWrap.appendChild(Dom.create(\"span\",\n\t\t\t{\n\t\t\t\tprops : { className : 'calendar-resbook-webform-block-arrow calendar-resbook-webform-block-arrow-next'},\n\t\t\t\tevents: {click: this.handleNextArrowClick.bind(this)}\n\t\t\t}));\n\n\t\tthis.outerWidth = parseInt(this.DOM.controlStaticWrap.offsetWidth);\n\t\tthis.innerWidth = parseInt(this.DOM.controlInnerWrap.offsetWidth);\n\n\t\tif ('onwheel' in document)\n\t\t\tEvent.bind(this.DOM.controlStaticWrap, \"wheel\", this.mousewheelScrollHandler.bind(this));\n\t\telse\n\t\t\tEvent.bind(this.DOM.controlStaticWrap, \"mousewheel\", this.mousewheelScrollHandler.bind(this));\n\n\t\tthis.checkSlotsScroll();\n\t}\n\n\thandleNextArrowClick()\n\t{\n\t\tthis.DOM.controlStaticWrap.scrollLeft = this.DOM.controlStaticWrap.scrollLeft + 100;\n\t\tthis.checkSlotsScroll();\n\t}\n\n\thandlePreletrowClick()\n\t{\n\t\tthis.DOM.controlStaticWrap.scrollLeft = Math.max(this.DOM.controlStaticWrap.scrollLeft - 100, 0);\n\t\tthis.checkSlotsScroll();\n\t}\n\n\tmousewheelScrollHandler(e)\n\t{\n\t\te = e || window.event;\n\t\tlet delta = e.deltaY || e.detail || e.wheelDelta;\n\t\tif (Math.abs(delta) > 0)\n\t\t{\n\t\t\tif (!Browser.isMac())\n\t\t\t{\n\t\t\t\tdelta = delta * 5;\n\t\t\t}\n\t\t\tthis.DOM.controlStaticWrap.scrollLeft = Math.max(this.DOM.controlStaticWrap.scrollLeft + delta, 0);\n\t\t\tthis.checkSlotsScroll();\n\t\t\tif(e.stopPropagation)\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tcheckSlotsScroll()\n\t{\n\t\tif (this.outerWidth <= this.innerWidth)\n\t\t{\n\t\t\tthis.DOM.leftArrow.style.display = this.DOM.controlStaticWrap.scrollLeft ? '' : 'none';\n\t\t\tif (this.innerWidth - this.outerWidth - 4 <= this.DOM.controlStaticWrap.scrollLeft)\n\t\t\t{\n\t\t\t\tthis.DOM.rightArrow.style.display = 'none';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.DOM.rightArrow.style.display = '';\n\t\t\t}\n\t\t}\n\t}\n\n\topenSelectPopup()\n\t{\n\t\tif (this.isSelectPopupShown())\n\t\t{\n\t\t\treturn this.closeSelectPopup();\n\t\t}\n\n\t\tthis.popup = MenuManager.create(\n\t\t\tthis.popupSelectId,\n\t\t\tthis.DOM.stateWrap,\n\t\t\tthis.getTimeSelectItems(),\n\t\t\t{\n\t\t\t\tclassName: \"calendar-resbook-time-select-popup\"\t,\n\t\t\t\tangle: true,\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : true,\n\t\t\t\toffsetTop: 5,\n\t\t\t\toffsetLeft: 10,\n\t\t\t\tcacheable: false\n\t\t\t}\n\t\t);\n\n\t\tthis.popup.show(true);\n\t}\n\n\tcloseSelectPopup()\n\t{\n\t\tif (this.isSelectPopupShown())\n\t\t{\n\t\t\tthis.popup.close();\n\t\t\tEvent.unbind(document, 'click', this.handleClick.bind(this));\n\t\t}\n\t}\n\n\tisSelectPopupShown()\n\t{\n\t\treturn this.popup && this.popup.popupWindow &&\n\t\t\tthis.popup.popupWindow.isShown && this.popup.popupWindow.isShown();\n\t}\n\n\tgetTimeSelectItems()\n\t{\n\t\tlet menuItems = [];\n\t\tthis.slots.forEach(function(slot)\n\t\t{\n\t\t\tif (this.showOnlyFree && slot.booked)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet className = 'menu-popup-no-icon';\n\t\t\tif (slot.booked)\n\t\t\t{\n\t\t\t\tclassName += ' menu-item-booked';\n\t\t\t}\n\t\t\tif (slot.selected)\n\t\t\t{\n\t\t\t\tclassName += ' menu-item-selected';\n\t\t\t}\n\n\t\t\tmenuItems.push(\n\t\t\t\t{\n\t\t\t\t\tclassName: className,\n\t\t\t\t\ttext: this.getTimeTextBySlot(slot),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tvalue: slot.time,\n\t\t\t\t\t\tbooked: !!slot.booked\n\t\t\t\t\t},\n\t\t\t\t\tonclick: this.menuItemClick.bind(this)\n\t\t\t\t}\n\t\t\t);\n\t\t}, this);\n\t\treturn menuItems;\n\t}\n\n\tmenuItemClick(e, menuItem)\n\t{\n\t\tif (menuItem && menuItem.dataset && menuItem.dataset.value)\n\t\t{\n\t\t\tif (!menuItem.dataset.booked)\n\t\t\t{\n\t\t\t\tthis.setValue(menuItem.dataset.value);\n\t\t\t}\n\t\t}\n\t\tthis.closeSelectPopup();\n\t}\n\n\tgetSlotNode(time)\n\t{\n\t\tlet i, slotNodes = this.DOM.controlInnerWrap.querySelectorAll('.calendar-resbook-webform-block-col-item');\n\t\tfor (i = 0; i < slotNodes.length; i++)\n\t\t{\n\t\t\tif (parseInt(slotNodes[i].getAttribute('data-bx-resbook-slot')) === parseInt(time))\n\t\t\t{\n\t\t\t\treturn slotNodes[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tsetSelected(slotNode)\n\t{\n\t\tif (Type.isDomNode(slotNode))\n\t\t{\n\t\t\tif (this.currentSelected)\n\t\t\t{\n\t\t\t\tDom.removeClass(this.currentSelected, 'calendar-resbook-webform-block-col-item-select');\n\t\t\t}\n\t\t\tthis.currentSelected = slotNode;\n\t\t\tDom.addClass(slotNode, 'calendar-resbook-webform-block-col-item-select');\n\t\t}\n\t}\n}\n\n","import {Loc, Dom, Tag, BookingUtil} from \"../resourcebooking\";\n\nexport class StatusInformer\n{\n\tconstructor(params)\n\t{\n\t\tthis.DOM = {\n\t\t\touterWrap: params.outerWrap\n\t\t};\n\t\tthis.timezone = params.timezone;\n\t\tthis.timezoneOffsetLabel = params.timezoneOffsetLabel;\n\t\tthis.shown = false;\n\t\tthis.built = false;\n\t}\n\n\tisShown()\n\t{\n\t\treturn this.shown;\n\t}\n\n\tbuild()\n\t{\n\t\tthis.DOM.wrap = this.DOM.outerWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-result\" style=\"display: none\" \n></div>`);\n\t\tthis.DOM.innerWrap = this.DOM.wrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-result-inner\"></div>`);\n\t\tthis.DOM.labelWrap = this.DOM.innerWrap.appendChild(Dom.create(\"span\", {props : { className : 'calendar-resbook-webform-block-result-text'}, text: Loc.getMessage('WEBF_RES_BOOKING_STATUS_LABEL')}));\n\t\tthis.DOM.statusWrap = this.DOM.innerWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-block-result-value\"></div>`);\n\t\tthis.DOM.statusTimezone = this.DOM.innerWrap.appendChild(Dom.create(\"span\", {props: {className: 'calendar-resbook-webform-block-result-timezone'}, text: this.timezoneOffsetLabel || '', style: {display: 'none'}}));\n\t\tthis.built = true;\n\t}\n\n\trefresh(params)\n\t{\n\t\tif (!this.built)\n\t\t{\n\t\t\tthis.build();\n\t\t}\n\n\t\tif (!this.isShown())\n\t\t{\n\t\t\tthis.show();\n\t\t}\n\n\t\tif (params.dateFrom)\n\t\t{\n\t\t\tthis.DOM.labelWrap.style.display = '';\n\t\t\tDom.removeClass(this.DOM.wrap, 'calendar-resbook-webform-block-result-error');\n\t\t\tif (this.timezone)\n\t\t\t{\n\t\t\t\tthis.DOM.statusTimezone.style.display = '';\n\t\t\t}\n\t\t\tDom.adjust(this.DOM.statusWrap, {text: this.getStatusText(params)});\n\t\t}\n\t\telse if (!params.dateFrom && params.fullDay)\n\t\t{\n\t\t\tthis.DOM.labelWrap.style.display = 'none';\n\t\t\tthis.DOM.statusTimezone.style.display = 'none';\n\t\t\tDom.addClass(this.DOM.wrap, 'calendar-resbook-webform-block-result-error');\n\t\t\tDom.adjust(this.DOM.statusWrap, {text: Loc.getMessage('WEBF_RES_BOOKING_STATUS_DATE_IS_NOT_AVAILABLE')});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.DOM.labelWrap.style.display = 'none';\n\t\t\tthis.DOM.statusTimezone.style.display = 'none';\n\t\t\tDom.removeClass(this.DOM.wrap, 'calendar-resbook-webform-block-result-error');\n\t\t\tDom.adjust(this.DOM.statusWrap, {text: Loc.getMessage('WEBF_RES_BOOKING_STATUS_NO_TIME_SELECTED')});\n\t\t}\n\t}\n\n\tgetStatusText(params)\n\t{\n\t\tlet\n\t\t\tdateFrom = params.dateFrom,\n\t\t\tdateTo = new Date(dateFrom.getTime() + params.duration * 60 * 1000 + (params.fullDay ? -1 : 0)),\n\t\t\ttext = '';\n\n\t\tif (params.fullDay)\n\t\t{\n\t\t\tif (BookingUtil.formatDate('Y-m-d', dateFrom.getTime() / 1000) === BookingUtil.formatDate('Y-m-d', dateTo.getTime() / 1000))\n\t\t\t{\n\t\t\t\ttext = BookingUtil.formatDate(Loc.getMessage('WEBF_RES_DATE_FORMAT_STATUS'), dateFrom);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttext = Loc.getMessage('WEBF_RES_DATE_FORMAT_FROM_TO')\n\t\t\t\t\t.replace('#DATE_FROM#', BookingUtil.formatDate(Loc.getMessage('WEBF_RES_DATE_FORMAT_STATUS_SHORT'), dateFrom))\n\t\t\t\t\t.replace('#DATE_TO#', BookingUtil.formatDate(Loc.getMessage('WEBF_RES_DATE_FORMAT_STATUS_SHORT'), dateTo));\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (BookingUtil.formatDate('Y-m-d', dateFrom.getTime() / 1000) === BookingUtil.formatDate('Y-m-d', dateTo.getTime() / 1000))\n\t\t\t{\n\t\t\t\ttext = BookingUtil.formatDate(Loc.getMessage('WEBF_RES_DATE_FORMAT_STATUS'), dateFrom)\n\t\t\t\t\t+ ' '\n\t\t\t\t\t+ Loc.getMessage('WEBF_RES_TIME_FORMAT_FROM_TO')\n\t\t\t\t\t\t.replace('#TIME_FROM#', BookingUtil.formatTime(dateFrom.getHours(), dateFrom.getMinutes()))\n\t\t\t\t\t\t.replace('#TIME_TO#', BookingUtil.formatTime(dateTo.getHours(), dateTo.getMinutes()));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttext = Loc.getMessage('WEBF_RES_DATE_FORMAT_FROM_TO')\n\t\t\t\t\t.replace('#DATE_FROM#', BookingUtil.formatDate(Loc.getMessage('WEBF_RES_DATE_FORMAT_STATUS_SHORT'), dateFrom) + ' '+ BookingUtil.formatTime(dateFrom.getHours(), dateFrom.getMinutes()))\n\t\t\t\t\t.replace('#DATE_TO#', BookingUtil.formatDate(Loc.getMessage('WEBF_RES_DATE_FORMAT_STATUS_SHORT'), dateTo) + ' '+ BookingUtil.formatTime(dateTo.getHours(), dateTo.getMinutes()));\n\t\t\t}\n\t\t}\n\n\t\treturn text;\n\t}\n\n\thide()\n\t{\n\t\tif (this.built && this.shown)\n\t\t{\n\t\t\tthis.DOM.wrap.style.display = 'none';\n\t\t\tthis.shown = false;\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tif (this.built && !this.shown)\n\t\t{\n\t\t\tthis.DOM.wrap.style.display = '';\n\t\t\tthis.shown = true;\n\t\t}\n\t}\n\n\tsetError(message)\n\t{\n\t\tif (this.DOM.labelWrap)\n\t\t{\n\t\t\tthis.DOM.labelWrap.style.display = 'none';\n\t\t}\n\t\tDom.addClass(this.DOM.wrap, 'calendar-resbook-webform-block-result-error');\n\t\tDom.adjust(this.DOM.statusWrap, {text: message});\n\t}\n\n\tisErrorSet()\n\t{\n\t\treturn this.shown && Dom.hasClass(this.DOM.wrap, 'calendar-resbook-webform-block-result-error');\n\t}\n}","import {Type, Loc, Dom, Tag, Text, BookingUtil} from \"./resourcebooking\";\nimport {EventEmitter, BaseEvent} from 'main.core.events';\nimport {UserSelector} from \"./controls/userselector\";\nimport {ResourceSelector} from \"./controls/resourceselector\";\nimport {ServiceSelector} from \"./controls/serviceselector\";\nimport {DurationSelector} from \"./controls/durationselector\";\nimport {DateSelector} from \"./controls/dateselector\";\nimport {TimeSelector} from \"./controls/timeselector\";\nimport {StatusInformer} from \"./controls/statusinformer\";\n\nexport class LiveFieldController extends EventEmitter\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.setEventNamespace('BX.Calendar.LiveFieldController');\n\t\tthis.params = params;\n\t\tthis.actionAgent = params.actionAgent || BX.ajax.runAction;\n\t\tthis.timeFrom = params.timeFrom || 7;\n\t\tthis.timeTo = params.timeTo || 20;\n\t\tthis.inputName = params.field.name + '[]';\n\t\tthis.DATE_FORMAT = BookingUtil.getDateFormat();\n\t\tthis.DATETIME_FORMAT = BookingUtil.getDateTimeFormat();\n\t\tthis.userIndex = null;\n\t\tthis.timezoneOffset = null;\n\t\tthis.timezoneOffsetLabel = null;\n\t\tthis.userFieldParams = null;\n\t\tthis.loadedDates = [];\n\n\t\tthis.externalSiteContext = Type.isFunction(params.actionAgent);\n\n\t\tthis.accessibility = {\n\t\t\tuser : {},\n\t\t\tresource: {}\n\t\t};\n\t\tthis.busySlotMatrix = {\n\t\t\tuser : {},\n\t\t\tresource: {}\n\t\t};\n\n\t\tthis.DOM = {\n\t\t\twrap: this.params.wrap,\n\t\t\tvalueInputs: []\n\t\t};\n\t}\n\n\tinit()\n\t{\n\t\tconst settingsData = this.getSettingsData();\n\t\tif (!settingsData.users || !settingsData.resources)\n\t\t{\n\t\t\tthrow new Error('Can\\'t init resourcebooking field, because \\'settings_data\\' parameter is not provided or has incorrect structure');\n\t\t\treturn;\n\t\t}\n\t\tthis.scale = parseInt(settingsData.time && settingsData.time.scale ? settingsData.time.scale : 60, 10);\n\n\t\tthis.DOM.outerWrap = this.DOM.wrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-wrapper\"></div>`);\n\n\t\tthis.showMainLoader();\n\t\tthis.requireFormData().then(()=>{\n\t\t\tthis.hideMainLoader();\n\t\t\tthis.buildFormControls();\n\t\t\tthis.onChangeValues();\n\t\t});\n\t}\n\n\tcheck()\n\t{\n\t\tlet result = true;\n\n\t\tif (this.usersDisplayed() && !this.getSelectedUser())\n\t\t{\n\t\t\tthis.userControl.showWarning();\n\t\t\tresult = false;\n\t\t}\n\n\t\tif (result && this.resourcesDisplayed() && !this.getSelectedResources())\n\t\t{\n\t\t\tthis.resourceControl.showWarning();\n\t\t\tresult = false;\n\t\t}\n\n\t\tif (result && !this.getCurrentDuration())\n\t\t{\n\t\t\tif (this.durationControl)\n\t\t\t{\n\t\t\t\tthis.durationControl.showWarning();\n\t\t\t}\n\t\t\telse if (this.serviceControl)\n\t\t\t{\n\t\t\t\tthis.serviceControl.showWarning();\n\t\t\t}\n\t\t\tresult = false;\n\t\t}\n\n\t\tif (result\n\t\t\t&& (\n\t\t\t\t!this.dateControl.getValue()\n\t\t\t\t|| this.statusControl.isErrorSet()\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis.dateControl.showWarning();\n\t\t\tresult = false;\n\t\t}\n\n\t\tif (result && this.timeSelectorDisplayed() && !this.timeControl.getValue())\n\t\t{\n\t\t\tthis.timeControl.showWarning();\n\t\t\tresult = false;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tbuildFormControls()\n\t{\n\t\tthis.DOM.innerWrap = this.DOM.outerWrap.appendChild(Tag.render`<div class=\"calendar-resbook-webform-inner\"></div>`);\n\t\tthis.DOM.inputsWrap = this.DOM.innerWrap.appendChild(Tag.render`<div></div>`);\n\n\t\tif (!this.getFieldParams())\n\t\t{\n\t\t\tthis.statusControl = new StatusInformer({\n\t\t\t\touterWrap: this.DOM.innerWrap\n\t\t\t});\n\t\t\tthis.statusControl.refresh({});\n\t\t\tthis.statusControl.setError('[UF_NOT_FOUND] ' + Loc.getMessage('WEBF_RES_BOOKING_UF_WARNING'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.externalSiteContext && BX.ZIndexManager)\n\t\t\t{\n\t\t\t\tconst stack = BX.ZIndexManager.getOrAddStack(document.body);\n\t\t\t\tstack.baseIndex = 100000;\n\t\t\t\tstack.sort();\n\t\t\t}\n\n\t\t\tthis.preparaAutoSelectValues();\n\t\t\tthis.displayUsersControl();\n\t\t\tthis.displayResourcesControl();\n\t\t\tthis.displayServicesControl();\n\t\t\tthis.displayDurationControl();\n\t\t\tthis.displayDateTimeControl();\n\n\t\t\tif (this.selectedUserId || this.selectedResourceId)\n\t\t\t{\n\t\t\t\tthis.refreshControlsState();\n\t\t\t}\n\t\t}\n\t}\n\n\trefreshControlsState()\n\t{\n\t\tif (this.selectorCanBeShown('resources')\n\t\t\t&& this.resourceControl\n\t\t\t&& !this.resourceControl.isShown())\n\t\t{\n\t\t\tthis.resourceControl.display();\n\t\t}\n\n\t\t// Show services\n\t\tif (this.selectorCanBeShown('services')\n\t\t\t&& this.serviceControl\n\t\t\t&& !this.serviceControl.isShown())\n\t\t{\n\t\t\tthis.serviceControl.display();\n\t\t}\n\n\t\t// Show duration\n\t\tif (this.selectorCanBeShown('duration')\n\t\t\t&& this.durationControl\n\t\t\t&& !this.durationControl.isShown())\n\t\t{\n\t\t\tthis.durationControl.display();\n\t\t}\n\n\t\tlet settingsData = this.getSettingsData();\n\t\t// Show date & time control\n\t\tif (this.selectorCanBeShown('date') && this.dateControl)\n\t\t{\n\t\t\tif (this.dateControl.isShown())\n\t\t\t{\n\t\t\t\tthis.dateControl.refresh(\n\t\t\t\t\tsettingsData.date,\n\t\t\t\t\t{\n\t\t\t\t\t\tavailableDateIndex: this.getAvailableDateIndex({\n\t\t\t\t\t\t\tresources: this.getSelectedResources(),\n\t\t\t\t\t\t\tuser: this.getSelectedUser(),\n\t\t\t\t\t\t\tduration: this.getCurrentDuration()\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tif (this.timeControl)\n\t\t\t\t{\n\t\t\t\t\tthis.timeControl.refresh(\n\t\t\t\t\t\tsettingsData.time,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tslotIndex: this.getSlotIndex({date: this.dateControl.getValue()}),\n\t\t\t\t\t\t\tcurrentDate: this.dateControl.getValue()\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet startValue;\n\t\t\t\tif (settingsData.date.start === 'free')\n\t\t\t\t{\n\t\t\t\t\tstartValue = this.getFreeDate({\n\t\t\t\t\t\tresources: this.getSelectedResources(),\n\t\t\t\t\t\tuser: this.getSelectedUser(),\n\t\t\t\t\t\tduration: this.getCurrentDuration()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstartValue = new Date();\n\t\t\t\t}\n\n\t\t\t\tthis.dateControl.display({\n\t\t\t\t\tselectedValue: startValue,\n\t\t\t\t\tavailableDateIndex: this.getAvailableDateIndex({\n\t\t\t\t\t\tresources: this.getSelectedResources(),\n\t\t\t\t\t\tuser: this.getSelectedUser(),\n\t\t\t\t\t\tduration: this.getCurrentDuration()\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.updateStatusControl();\n\t\tthis.onChangeValues();\n\t\tBookingUtil.fireCustomEvent(window, 'crmWebFormFireResize');\n\t}\n\n\tonChangeValues()\n\t{\n\t\tlet\n\t\t\tallValuesValue = [],\n\t\t\tdateFromValue = '',\n\t\t\tdateFrom = this.getCurrentDate(),\n\t\t\tduration = this.getCurrentDuration() * 60,// Duration in minutes\n\t\t\tserviceName = this.getCurrentServiceName(),\n\t\t\tentries = [];\n\n\t\t// Clear inputs\n\t\tDom.clean(this.DOM.inputsWrap);\n\n\t\tthis.DOM.valueInputs = [];\n\n\t\tif (Type.isDate(dateFrom) && !this.statusControl.isErrorSet())\n\t\t{\n\t\t\tlet resources = this.getSelectedResources();\n\t\t\tif (Type.isArray(resources))\n\t\t\t{\n\t\t\t\tresources.forEach(function(resourceId)\n\t\t\t\t{\n\t\t\t\t\tentries = entries.concat({type: 'resource', id: resourceId});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet selectedUser = this.getSelectedUser();\n\t\t\tif (selectedUser)\n\t\t\t{\n\t\t\t\tentries = entries.concat({type: 'user', id: selectedUser});\n\t\t\t}\n\n\t\t\tdateFromValue = BookingUtil.formatDate(this.DATETIME_FORMAT, dateFrom.getTime() / 1000);\n\n\t\t\tentries.forEach(function(entry)\n\t\t\t{\n\t\t\t\tlet value = entry.type + '|' + entry.id + '|' + dateFromValue + '|' + duration + '|' + serviceName;\n\t\t\t\tallValuesValue.push(value);\n\n\t\t\t\tthis.DOM.valueInputs.push(this.DOM.inputsWrap.appendChild(\n\t\t\t\t\tTag.render`\n\t\t\t\t\t<input \n\t\t\t\t\t\tname=\"${Text.encode(this.inputName)}\"\n\t\t\t\t\t\tvalue=\"${Text.encode(value)}\" \n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\t>\n\t\t\t\t\t`\n\t\t\t\t));\n\t\t\t}, this);\n\t\t}\n\n\t\tif (!entries.length)\n\t\t{\n\t\t\tallValuesValue.push('empty');\n\t\t\tthis.DOM.valueInputs.push(this.DOM.inputsWrap.appendChild(\n\t\t\t\tTag.render`\n\t\t\t\t\t<input \n\t\t\t\t\t\tname=\"${Text.encode(this.inputName)}\"\n\t\t\t\t\t\tvalue=\"empty\" \n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\t>\n\t\t\t\t\t`\n\t\t\t));\n\t\t}\n\n\t\tthis.emit('change', allValuesValue);\n\t}\n\n\tshowMainLoader()\n\t{\n\t\tif (this.DOM.wrap)\n\t\t{\n\t\t\tthis.hideMainLoader();\n\t\t\tlet loaderWrap = Tag.render`<div class=\"calendar-resbook-webform-wrapper-loader-wrap\"></div>`;\n\t\t\tloaderWrap.appendChild(BookingUtil.getLoader(160));\n\t\t\tthis.DOM.mainLoader = this.DOM.outerWrap.appendChild(loaderWrap);\n\t\t}\n\t}\n\n\thideMainLoader()\n\t{\n\t\tDom.remove(this.DOM.mainLoader);\n\t}\n\n\tshowStatusLoader()\n\t{\n\t\tthis.showMainLoader();\n\t}\n\n\thideStatusLoader()\n\t{\n\t\tthis.hideMainLoader();\n\t}\n\n\trequestAccessibilityData(params)\n\t{\n\t\tif (!this.requestedFormData)\n\t\t{\n\t\t\tthis.showStatusLoader();\n\n\t\t\tthis.requestedFormData = true;\n\t\t\tlet formDataParams = {\n\t\t\t\tfrom: params.date\n\t\t\t};\n\n\t\t\tthis.requireFormData(formDataParams).then(() => {\n\t\t\t\tthis.hideStatusLoader();\n\t\t\t\tthis.refreshControlsState();\n\t\t\t\tthis.dateControl.refreshCurrentValue();\n\t\t\t\tthis.onChangeValues();\n\t\t\t\tthis.requestedFormData = false;\n\t\t\t});\n\t\t}\n\t}\n\n\trequireFormData(params)\n\t{\n\t\tparams = Type.isPlainObject(params) ? params : {};\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet\n\t\t\t\tdata = {\n\t\t\t\t\tsettingsData: this.getSettingsData() || null\n\t\t\t\t};\n\n\t\t\tif (!this.userFieldParams)\n\t\t\t{\n\t\t\t\tdata.fieldName = this.params.field.entity_field_name;\n\t\t\t}\n\n\t\t\tlet\n\t\t\t\tdateFrom = Type.isDate(params.from) ? params.from : new Date(),\n\t\t\t\tdateTo;\n\n\t\t\tif (Type.isDate(params.to))\n\t\t\t{\n\t\t\t\tdateTo = params.to;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdateTo = new Date(dateFrom.getTime());\n\t\t\t\tdateTo.setDate(dateFrom.getDate() + 60);\n\t\t\t}\n\n\t\t\tdata.from = BookingUtil.formatDate(this.DATE_FORMAT, dateFrom);\n\t\t\tdata.to = BookingUtil.formatDate(this.DATE_FORMAT, dateTo);\n\n\t\t\tthis.setLoadedDataLimits(dateFrom, dateTo);\n\n\t\t\tthis.actionAgent('calendar.api.resourcebookingajax.getfillformdata', {\n\t\t\t\tdata: data\n\t\t\t}).then((response) => {\n\t\t\t\t\tif (!Type.isPlainObject(response) || !response.data)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Type.isNumber(response.data.timezoneOffset))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.timezoneOffset = response.data.timezoneOffset;\n\t\t\t\t\t\t\tthis.timezoneOffsetLabel = response.data.timezoneOffsetLabel;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (response.data.workTimeStart !== undefined && response.data.workTimeEnd !== undefined)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.timeFrom = parseInt(response.data.workTimeStart);\n\t\t\t\t\t\t\tthis.timeTo = parseInt(response.data.workTimeEnd);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (response.data.fieldSettings)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.userFieldParams = response.data.fieldSettings;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (response.data.userIndex)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.userIndex = response.data.userIndex;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.handleAccessibilityData(response.data.usersAccessibility, 'user');\n\t\t\t\t\t\tthis.handleAccessibilityData(response.data.resourcesAccessibility, 'resource');\n\n\t\t\t\t\t\tresolve(response.data);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(response) => {\n\t\t\t\t\tresolve(response);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tsetLoadedDataLimits(from, to)\n\t{\n\t\tthis.loadedDataFrom = Type.isDate(from) ? from : BookingUtil.parseDate(from);\n\t\tthis.loadedDataTo = Type.isDate(to) ? to : BookingUtil.parseDate(to);\n\n\t\tthis.loadedDates = this.loadedDates || [];\n\t\tthis.loadedDatesIndex = this.loadedDatesIndex || {};\n\n\t\tlet\n\t\t\tdateKey,\n\t\t\tdate = new Date(this.loadedDataFrom.getTime());\n\n\t\twhile (true)\n\t\t{\n\t\t\tdateKey = BookingUtil.formatDate(this.DATE_FORMAT, date);\n\t\t\tthis.loadedDatesIndex[dateKey] = this.loadedDates.length;\n\t\t\tthis.loadedDates.push({\n\t\t\t\tkey: BookingUtil.formatDate(this.DATE_FORMAT, date),\n\t\t\t\tslots: {},\n\t\t\t\tslotsCount: {}\n\t\t\t});\n\t\t\tdate.setDate(date.getDate() + 1);\n\n\t\t\tif (date.getTime() > this.loadedDataTo.getTime())\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tfillDataIndex(date, time, entityType, entityId)\n\t{\n\t\tlet dateIndex = this.loadedDatesIndex[date];\n\t\tif (this.loadedDates[dateIndex])\n\t\t{\n\t\t\tif (!this.loadedDates[dateIndex].slots[time])\n\t\t\t{\n\t\t\t\tthis.loadedDates[dateIndex].slots[time] = {};\n\t\t\t}\n\t\t\tif (this.loadedDates[dateIndex].slotsCount[entityType + entityId] === undefined)\n\t\t\t{\n\t\t\t\tthis.loadedDates[dateIndex].slotsCount[entityType + entityId] = 0;\n\t\t\t}\n\t\t\tthis.loadedDates[dateIndex].slots[time][entityType + entityId] = true;\n\t\t\tthis.loadedDates[dateIndex].slotsCount[entityType + entityId]++;\n\t\t}\n\t}\n\n\thandleAccessibilityData(data, entityType)\n\t{\n\t\tif (Type.isPlainObject(data) && (entityType === 'user' || entityType === 'resource'))\n\t\t{\n\t\t\t// For each entry which has accessibility entries\n\t\t\tfor (let entityId in data)\n\t\t\t{\n\t\t\t\tif (data.hasOwnProperty(entityId))\n\t\t\t\t{\n\t\t\t\t\tdata[entityId].forEach(function(entry)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!entry.from)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tentry.from = BookingUtil.parseDate(entry.dateFrom);\n\t\t\t\t\t\t\tif (entry.from)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentry.from.setSeconds(0,0);\n\t\t\t\t\t\t\t\tentry.fromTimestamp = entry.from.getTime();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!entry.to)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tentry.to = BookingUtil.parseDate(entry.dateTo);\n\t\t\t\t\t\t\tif (entry.to)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (entry.fullDay)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tentry.to.setHours(23, 59, 0, 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tentry.to.setSeconds(0, 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tentry.toTimestamp = entry.to.getTime();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (entry.from && entry.to)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.fillBusySlotMatrix(entry, entityType, entityId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.accessibility[entityType] = BookingUtil.mergeEx(this.accessibility[entityType], data);\n\t\t}\n\t}\n\n\tfillBusySlotMatrix(entry, entityType, entityId)\n\t{\n\t\tif (!this.busySlotMatrix[entityType][entityId])\n\t\t{\n\t\t\tthis.busySlotMatrix[entityType][entityId] = {};\n\t\t}\n\n\t\tlet\n\t\t\tfromDate = new Date(entry.from.getTime()),\n\t\t\tdateKey = BookingUtil.formatDate(this.DATE_FORMAT, fromDate),\n\t\t\tdateToKey = BookingUtil.formatDate(this.DATE_FORMAT, entry.to),\n\t\t\ttimeValueFrom = fromDate.getHours() * 60 + fromDate.getMinutes(),\n\t\t\tduration = Math.round((entry.toTimestamp - entry.fromTimestamp) / 60000), // in minutes\n\t\t\ttimeValueTo = timeValueFrom + duration,\n\t\t\tslots = this.getTimeSlots(),\n\t\t\tcount = 0,\n\t\t\ti;\n\n\t\tif (duration > 0)\n\t\t{\n\t\t\twhile (true)\n\t\t\t{\n\t\t\t\tif (!this.busySlotMatrix[entityType][entityId][dateKey])\n\t\t\t\t{\n\t\t\t\t\tthis.busySlotMatrix[entityType][entityId][dateKey] = {};\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < slots.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (timeValueFrom < (slots[i].time + this.scale) && timeValueTo > slots[i].time)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.busySlotMatrix[entityType][entityId][dateKey][slots[i].time] = true;\n\t\t\t\t\t\tthis.fillDataIndex(dateKey, slots[i].time, entityType, entityId);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (dateKey === dateToKey)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfromDate.setDate(fromDate.getDate() + 1);\n\t\t\t\t\tdateKey = BookingUtil.formatDate(this.DATE_FORMAT, fromDate);\n\t\t\t\t\ttimeValueFrom = 0;\n\t\t\t\t\tif (dateKey === dateToKey)\n\t\t\t\t\t{\n\t\t\t\t\t\ttimeValueTo = entry.to.getHours() * 60 + entry.to.getMinutes();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttimeValueTo = 1440; // end of the day - 24 hours\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcount++;\n\t\t\t\tif (count > 10000) // emergency exit\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCaption()\n\t{\n\t\treturn this.params.field.caption;\n\t}\n\n\tgetSettingsData()\n\t{\n\t\treturn this.params.field.settings_data || {};\n\t}\n\n\tgetUserIndex()\n\t{\n\t\treturn this.userIndex;\n\t}\n\n\tgetFieldParams()\n\t{\n\t\treturn this.userFieldParams;\n\t}\n\n\tgetSettings()\n\t{\n\t\treturn {\n\t\t\tcaption: this.getCaption(),\n\t\t\tdata: this.getSettingsData()\n\t\t};\n\t}\n\n\tisUserSelectorInAutoMode()\n\t{\n\t\treturn this.usersDisplayed() && this.getSettingsData().users.show === \"N\";\n\t}\n\n\tisResourceSelectorInAutoMode()\n\t{\n\t\treturn this.resourcesDisplayed() && this.getSettingsData().resources.show === \"N\";\n\t}\n\n\tautoAdjustUserSelector()\n\t{\n\t\tlet\n\t\t\tcurrentDate = this.dateControl.getValue(),\n\t\t\ttimeValue = this.timeControl.getValue();\n\n\t\tif (Type.isDate(currentDate) && timeValue)\n\t\t{\n\t\t\tlet i, loadedDate = this.loadedDates[this.loadedDatesIndex[BookingUtil.formatDate(this.DATE_FORMAT, currentDate)]];\n\t\t\tif (loadedDate.slots[timeValue])\n\t\t\t{\n\t\t\t\tfor (i = 0; i < this.userControl.values.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (!loadedDate.slots[timeValue]['user' + this.userControl.values[i]])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.userControl.setSelectedUser(this.userControl.values[i]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tautoAdjustResourceSelector()\n\t{\n\t\tlet\n\t\t\tcurrentDate = this.dateControl.getValue(),\n\t\t\ttimeValue = this.timeControl.getValue();\n\n\t\tif (Type.isDate(currentDate) && timeValue)\n\t\t{\n\t\t\tlet\n\t\t\t\ti, id,\n\t\t\t\tloadedDate = this.loadedDates[this.loadedDatesIndex[BookingUtil.formatDate(this.DATE_FORMAT, currentDate)]];\n\n\t\t\tif (loadedDate.slots[timeValue])\n\t\t\t{\n\t\t\t\tfor (i = 0; i < this.resourceControl.resourceList.length; i++)\n\t\t\t\t{\n\t\t\t\t\tid = parseInt(this.resourceControl.resourceList[i].id);\n\t\t\t\t\tif (!loadedDate.slots[timeValue]['resource' + id])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.resourceControl.setSelectedResource(id);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpreparaAutoSelectValues ()\n\t{\n\t\tlet\n\t\t\tsettingsData = this.getSettingsData(),\n\t\t\tautoSelectUser = this.usersDisplayed() && (settingsData.users.defaultMode === 'auto' || settingsData.users.show === \"N\"),\n\t\t\tautoSelectResource = this.resourcesDisplayed() && (settingsData.resources.defaultMode === 'auto' || settingsData.resources.show === \"N\"),\n\t\t\tautoSelectDate = settingsData.date.start === 'free',\n\t\t\tmaxStepsAuto = 60,\n\t\t\tdate, i;\n\n\t\tthis.selectedUserId = false;\n\t\tthis.selectedResourceId = false;\n\n\t\tdate = new Date();\n\t\t// Walk through each date searching for free space\n\t\tfor (i = 0; i <= maxStepsAuto; i++)\n\t\t{\n\t\t\tthis.getFreeEntitiesForDate(date, {\n\t\t\t\tautoSelectUser: autoSelectUser,\n\t\t\t\tautoSelectResource: autoSelectResource,\n\t\t\t\tslotsAmount: this.getDefaultDurationSlotsAmount()\n\t\t\t});\n\n\t\t\tif ((this.selectedUserId || !autoSelectUser)\n\t\t\t\t&&\n\t\t\t\t(this.selectedResourceId || !autoSelectResource))\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (!autoSelectDate)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdate.setDate(date.getDate() + 1);\n\t\t}\n\t}\n\n\tgetFreeEntitiesForDate(date, params)\n\t{\n\t\tlet\n\t\t\tsettingsData = this.getSettingsData(),\n\t\t\tslotsAmount = params.slotsAmount || 1,\n\t\t\ti, userList, resList;\n\n\t\tif (params.autoSelectUser)\n\t\t{\n\t\t\tuserList = this.getUsersValue();\n\t\t\tfor (i = 0; i < userList.length; i++)\n\t\t\t{\n\t\t\t\tif (this.checkSlotsForDate(date, slotsAmount, {\n\t\t\t\t\tuser: parseInt(userList[i])\n\t\t\t\t}))\n\t\t\t\t{\n\t\t\t\t\tthis.selectedUserId = parseInt(userList[i]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (params.autoSelectResource)\n\t\t{\n\t\t\tresList = this.getResourceValue();\n\t\t\tfor (i = 0; i < resList.length; i++)\n\t\t\t{\n\t\t\t\tif (this.checkSlotsForDate(date, slotsAmount, {\n\t\t\t\t\tresources: [parseInt(resList[i])],\n\t\t\t\t\tuser: this.selectedUserId || null\n\t\t\t\t}))\n\t\t\t\t{\n\t\t\t\t\tthis.selectedResourceId = parseInt(resList[i]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplayUsersControl()\n\t{\n\t\tif (this.usersDisplayed())\n\t\t{\n\t\t\tthis.userControl = new UserSelector({\n\t\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\t\tdata: this.getSettingsData().users,\n\t\t\t\tuserIndex: this.getUserIndex(),\n\t\t\t\tpreviewMode: false,\n\t\t\t\tautoSelectDefaultValue: this.selectedUserId,\n\t\t\t\tchangeValueCallback: function(userId)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('BX.Calendar.Resourcebooking.LiveFieldController:userChanged', new BaseEvent({data: {userId: userId}}));\n\t\t\t\t\tthis.refreshControlsState();\n\t\t\t\t}.bind(this)\n\t\t\t});\n\t\t\tthis.userControl.display();\n\t\t}\n\t}\n\n\tdisplayResourcesControl()\n\t{\n\t\tlet\n\t\t\tvalueIndex = {},\n\t\t\tdataValue = [],\n\t\t\tfieldParams = this.getFieldParams(),\n\t\t\tsettingsData = this.getSettingsData();\n\n\t\tif (this.resourcesDisplayed())\n\t\t{\n\t\t\tthis.getResourceValue().forEach(function(id)\n\t\t\t{\n\t\t\t\tid = parseInt(id);\n\t\t\t\tif (id > 0)\n\t\t\t\t{\n\t\t\t\t\tvalueIndex[id] = true;\n\t\t\t\t\tdataValue.push(id);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlet resourceList = [];\n\t\t\tfieldParams.SELECTED_RESOURCES.forEach(function(res)\n\t\t\t{\n\t\t\t\tres.id = parseInt(res.id);\n\t\t\t\tif (valueIndex[res.id])\n\t\t\t\t{\n\t\t\t\t\tresourceList.push(res);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tthis.resourceControl = new ResourceSelector({\n\t\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\t\tdata: {\n\t\t\t\t\tshow: settingsData.resources.show,\n\t\t\t\t\tdefaultMode: settingsData.resources.defaultMode,\n\t\t\t\t\tlabel: settingsData.resources.label,\n\t\t\t\t\tmultiple: settingsData.resources.multiple,\n\t\t\t\t\tvalue: settingsData.resources.value\n\t\t\t\t},\n\t\t\t\tresourceList: resourceList,\n\t\t\t\tautoSelectDefaultValue: this.selectedResourceId,\n\t\t\t\tchangeValueCallback: function()\n\t\t\t\t{\n\t\t\t\t\tthis.emit('BX.Calendar.Resourcebooking.LiveFieldController:resourceChanged');\n\t\t\t\t\tthis.refreshControlsState();\n\t\t\t\t}.bind(this)\n\t\t\t});\n\n\t\t\tif (this.selectorCanBeShown('resources'))\n\t\t\t{\n\t\t\t\tthis.resourceControl.display();\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplayServicesControl()\n\t{\n\t\tlet\n\t\t\tfieldParams = this.getFieldParams(),\n\t\t\tsettingsData = this.getSettingsData();\n\n\t\tif (fieldParams.USE_SERVICES === 'Y' && settingsData.services.value)\n\t\t{\n\t\t\tlet dataValueRaw = this.getServicesValue();\n\n\t\t\tthis.serviceControl = new ServiceSelector({\n\t\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\t\tdata: settingsData.services,\n\t\t\t\tserviceList: fieldParams.SERVICE_LIST,\n\t\t\t\tselectedValue: dataValueRaw.length > 0 ? dataValueRaw[0] : null,\n\t\t\t\tchangeValueCallback: function()\n\t\t\t\t{\n\t\t\t\t\tthis.emit('BX.Calendar.Resourcebooking.LiveFieldController:serviceChanged');\n\t\t\t\t\tthis.refreshControlsState();\n\t\t\t\t}.bind(this)\n\t\t\t});\n\n\t\t\tif (this.selectorCanBeShown('services'))\n\t\t\t{\n\t\t\t\tthis.serviceControl.display();\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplayDurationControl()\n\t{\n\t\tlet\n\t\t\tfieldParams = this.getFieldParams(),\n\t\t\tsettingsData = this.getSettingsData();\n\n\t\tif (!this.serviceControl)\n\t\t{\n\t\t\tthis.durationControl = new DurationSelector({\n\t\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\t\tdata: settingsData.duration,\n\t\t\t\tfullDay: fieldParams.FULL_DAY === 'Y',\n\t\t\t\tchangeValueCallback: function()\n\t\t\t\t{\n\t\t\t\t\tthis.emit('BX.Calendar.Resourcebooking.LiveFieldController:durationChanged');\n\t\t\t\t\tthis.refreshControlsState();\n\t\t\t\t}.bind(this)\n\t\t\t});\n\n\t\t\tif (this.selectorCanBeShown('duration'))\n\t\t\t{\n\t\t\t\tthis.durationControl.display();\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplayDateTimeControl()\n\t{\n\t\tlet\n\t\t\ttimezone = false,\n\t\t\tstartValue = null,\n\t\t\tsettingsData = this.getSettingsData(),\n\t\t\tfieldParams = this.getFieldParams();\n\n\t\tthis.dateControl = new DateSelector({\n\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\tdata: settingsData.date,\n\t\t\tpreviewMode: false,\n\t\t\tallowOverbooking: fieldParams.ALLOW_OVERBOOKING === \"Y\",\n\t\t\tchangeValueCallback: this.handleDateChanging.bind(this),\n\t\t\trequestDataCallback: this.requestAccessibilityData.bind(this)\n\t\t});\n\n\t\tif (this.timeSelectorDisplayed())\n\t\t{\n\t\t\tif (fieldParams.USE_USER_TIMEZONE === 'N')\n\t\t\t{\n\t\t\t\tlet userTimezoneOffset = -(new Date).getTimezoneOffset()*60;\n\t\t\t\tif (userTimezoneOffset !== this.timezoneOffset)\n\t\t\t\t{\n\t\t\t\t\ttimezone = fieldParams.TIMEZONE;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.timeControl = new TimeSelector({\n\t\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\t\tdata: settingsData.time,\n\t\t\t\tpreviewMode: false,\n\t\t\t\tchangeValueCallback: this.handleSelectedDateTimeChanging.bind(this),\n\t\t\t\ttimeFrom: this.timeFrom,\n\t\t\t\ttimeTo: this.timeTo,\n\t\t\t\ttimezone: timezone,\n\t\t\t\ttimezoneOffset: this.timezoneOffset,\n\t\t\t\ttimezoneOffsetLabel: this.timezoneOffsetLabel\n\t\t\t});\n\t\t}\n\n\t\tthis.statusControl = new StatusInformer({\n\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\ttimezone: timezone,\n\t\t\ttimezoneOffsetLabel: this.timezoneOffsetLabel\n\t\t});\n\n\t\tif (this.selectorCanBeShown('date'))\n\t\t{\n\t\t\tthis.statusControl.show();\n\t\t\tif (settingsData.date.start === 'free')\n\t\t\t{\n\t\t\t\tstartValue = this.getFreeDate({\n\t\t\t\t\tresources: this.getSelectedResources(),\n\t\t\t\t\tuser: this.getSelectedUser(),\n\t\t\t\t\tduration: this.getCurrentDuration()\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.dateControl.display({\n\t\t\t\tselectedValue: startValue\n\t\t\t});\n\n\t\t\tif (this.timeControl && !this.timeControl.isShown())\n\t\t\t{\n\t\t\t\tthis.timeControl.display();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.statusControl.hide();\n\t\t}\n\t}\n\n\thandleDateChanging(date, realDate)\n\t{\n\t\tthis.emit('BX.Calendar.Resourcebooking.LiveFieldController:dateChanged');\n\n\t\tif (this.timeSelectorDisplayed())\n\t\t{\n\t\t\tif (realDate)\n\t\t\t{\n\t\t\t\tthis.timeControl.show();\n\t\t\t\tlet\n\t\t\t\t\ttimeValueFrom,\n\t\t\t\t\tcurrentDate = this.getCurrentDate();\n\n\t\t\t\tif (currentDate)\n\t\t\t\t{\n\t\t\t\t\ttimeValueFrom = currentDate.getHours() * 60 + currentDate.getMinutes();\n\t\t\t\t}\n\n\t\t\t\tthis.timeControl.refresh(\n\t\t\t\t\tthis.getSettingsData().time,\n\t\t\t\t\t{\n\t\t\t\t\t\tslotIndex: this.getSlotIndex({date: realDate}),\n\t\t\t\t\t\tcurrentDate: realDate,\n\t\t\t\t\t\tselectedValue: timeValueFrom\n\t\t\t\t\t});\n\n\t\t\t\t// this.timeControl.refresh(\n\t\t\t\t// \tthis.getSettingsData().time,\n\t\t\t\t// \t{\n\t\t\t\t// \t\tslotIndex: this.getAvailableSlotIndex({\n\t\t\t\t// \t\t\tdate: realDate,\n\t\t\t\t// \t\t\tresources: this.getSelectedResources(),\n\t\t\t\t// \t\t\tuser: this.getSelectedUser(),\n\t\t\t\t// \t\t\tduration: this.getCurrentDuration()\n\t\t\t\t// \t\t}),\n\t\t\t\t// \t\tcurrentDate: realDate,\n\t\t\t\t// \t\tselectedValue: timeValueFrom\n\t\t\t\t// \t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.handleSelectedDateTimeChanging(null, true);\n\t\t}\n\t\tthis.onChangeValues();\n\t}\n\n\thandleSelectedDateTimeChanging(value, useTimeout)\n\t{\n\t\tif (useTimeout !== false)\n\t\t{\n\t\t\tif (this.updateTimeStatusTimeout)\n\t\t\t{\n\t\t\t\tthis.updateTimeStatusTimeout = clearTimeout(this.updateTimeStatusTimeout);\n\t\t\t}\n\t\t\tthis.updateTimeStatusTimeout = setTimeout(function(){\n\t\t\t\tthis.handleSelectedDateTimeChanging(value, false);\n\t\t\t}.bind(this), 100);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.isUserSelectorInAutoMode())\n\t\t\t{\n\t\t\t\tthis.autoAdjustUserSelector();\n\t\t\t}\n\t\t\tif (this.isResourceSelectorInAutoMode())\n\t\t\t{\n\t\t\t\tthis.autoAdjustResourceSelector();\n\t\t\t}\n\n\t\t\tthis.updateStatusControl();\n\t\t\tBookingUtil.fireCustomEvent(window, 'crmWebFormFireResize');\n\t\t}\n\t\tthis.onChangeValues();\n\t}\n\n\tupdateStatusControl()\n\t{\n\t\tif (this.statusControl && this.selectorCanBeShown('date'))\n\t\t{\n\t\t\tlet currentDate = this.getCurrentDate();\n\t\t\tif (this.dateControl.isItPastDate(currentDate))\n\t\t\t{\n\t\t\t\tthis.statusControl.setError(Loc.getMessage('WEBF_RES_BOOKING_PAST_DATE_WARNING'));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.timeSelectorDisplayed())\n\t\t\t\t{\n\t\t\t\t\tif (this.timeControl.hasAvailableSlots())\n\t\t\t\t\t{\n\t\t\t\t\t\tlet timeValue = this.timeControl.getValue();\n\t\t\t\t\t\tthis.statusControl.refresh({\n\t\t\t\t\t\t\tdateFrom: timeValue ? currentDate : null,\n\t\t\t\t\t\t\tduration: timeValue ? this.getCurrentDuration() : null,\n\t\t\t\t\t\t\tfullDay: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.statusControl.hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.statusControl.refresh({\n\t\t\t\t\t\tdateFrom: this.dateControl.isDateAvailable(currentDate) ? currentDate : null,\n\t\t\t\t\t\tduration: this.getCurrentDuration(),\n\t\t\t\t\t\tfullDay: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetFreeDate(params)\n\t{\n\t\tlet\n\t\t\tslotsAmount = Math.ceil(params.duration / this.scale),\n\t\t\tfreeDate = null,\n\t\t\tdate = this.loadedDataFrom;\n\n\t\t// Walk through each date searching for free space\n\t\twhile (true)\n\t\t{\n\t\t\tif (this.checkSlotsForDate(date, slotsAmount, {\n\t\t\t\tresources: params.resources,\n\t\t\t\tuser: params.user\n\t\t\t}))\n\t\t\t{\n\t\t\t\tfreeDate = date;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdate.setDate(date.getDate() + 1);\n\t\t\tif (date.getTime() >= this.loadedDataTo.getTime())\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn freeDate;\n\t}\n\n\tgetAvailableDateIndex(params)\n\t{\n\t\tlet\n\t\t\tuserIsFree, resourcesAreFree,\n\t\t\tdateIndex = {};\n\n\t\tif (this.timeSelectorDisplayed())\n\t\t{\n\t\t\tlet slotsAmount = Math.ceil(params.duration / this.scale);\n\n\t\t\tthis.loadedDates.forEach(function(date)\n\t\t\t{\n\t\t\t\tdateIndex[date.key] = this.checkSlotsForDate(date.key, slotsAmount, {\n\t\t\t\t\tresources: params.resources,\n\t\t\t\t\tuser: params.user\n\t\t\t\t});\n\t\t\t}, this);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet\n\t\t\t\ti, daysGap, date, j,\n\t\t\t\tuserKey = params.user ? 'user' + params.user : null,\n\t\t\t\tdaysAmount = Math.ceil(params.duration / 1440);\n\n\t\t\tdaysGap = 1;\n\t\t\tfor (i = this.loadedDates.length; i--; i >= 0)\n\t\t\t{\n\t\t\t\tuserIsFree = true;\n\t\t\t\tresourcesAreFree = true;\n\t\t\t\tdate = this.loadedDates[i];\n\n\t\t\t\tif (userKey)\n\t\t\t\t{\n\t\t\t\t\t// All day is free for user\n\t\t\t\t\tuserIsFree = !date.slotsCount[userKey];\n\t\t\t\t}\n\n\t\t\t\tif (userIsFree && params.resources && params.resources.length > 0)\n\t\t\t\t{\n\t\t\t\t\tfor (j = 0; j < params.resources.length; j++)\n\t\t\t\t\t{\n\t\t\t\t\t\tresourcesAreFree = resourcesAreFree && !date.slotsCount['resource' + params.resources[j]];\n\t\t\t\t\t\tif (!resourcesAreFree)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (userIsFree && resourcesAreFree)\n\t\t\t\t{\n\t\t\t\t\tdaysGap++;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdaysGap = 0;\n\t\t\t\t}\n\n\t\t\t\tdateIndex[date.key] = userIsFree && resourcesAreFree && daysAmount <= daysGap;\n\t\t\t}\n\t\t}\n\n\t\treturn dateIndex;\n\t}\n\n\tgetSlotIndex(params)\n\t{\n\t\tif (params.date)\n\t\t{\n\t\t\tparams.date = this.dateControl.getValue();\n\t\t}\n\n\t\tlet slotIndex = {};\n\t\tif (Type.isDate(params.date))\n\t\t{\n\t\t\tif (this.getFieldParams().ALLOW_OVERBOOKING !== \"Y\"\n\t\t\t\t&& (this.isUserSelectorInAutoMode() || this.isResourceSelectorInAutoMode()))\n\t\t\t{\n\t\t\t\tconst fieldParams = this.getFieldParams();\n\t\t\t\tlet\n\t\t\t\t\tfreeSlot,\n\t\t\t\t\ti, j, time,\n\t\t\t\t\tslotGap = 1,\n\t\t\t\t\ttodayNowTime = 0,\n\t\t\t\t\ttimeSlots = this.getTimeSlots(),\n\t\t\t\t\tdateKey = BookingUtil.formatDate(this.DATE_FORMAT, params.date),\n\t\t\t\t\tloadedDate = this.loadedDates[this.loadedDatesIndex[dateKey]],\n\t\t\t\t\tslotsAmount = Math.ceil(this.getCurrentDuration() / this.scale);\n\n\t\t\t\tif (this.checkIsTodayDate(dateKey))\n\t\t\t\t{\n\t\t\t\t\tconst today = new Date();\n\t\t\t\t\tconst deltaOffset = fieldParams.USE_USER_TIMEZONE === 'N'\n\t\t\t\t\t\t? today.getTimezoneOffset() * 60 + this.timezoneOffset:\n\t\t\t\t\t\t0;\n\t\t\t\t\ttodayNowTime = today.getHours() * 60 + today.getMinutes() + (deltaOffset / 60);\n\t\t\t\t}\n\n\t\t\t\t// Prefill slotIndex\n\t\t\t\ttimeSlots.forEach(function(slot){slotIndex[slot.time] = true;}, this);\n\n\t\t\t\tif (this.isUserSelectorInAutoMode())\n\t\t\t\t{\n\t\t\t\t\tconst userList = this.getUsersValue();\n\n\t\t\t\t\tfor (i = timeSlots.length; i--; i >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\ttime = timeSlots[i].time;\n\t\t\t\t\t\tfreeSlot = false;\n\n\t\t\t\t\t\tif (todayNowTime && time < todayNowTime)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tslotIndex[time] = false;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (j = 0; j < userList.length; j++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!loadedDate.slots[time]\n\t\t\t\t\t\t\t\t|| !loadedDate.slots[time]['user' + userList[j]])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfreeSlot = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tslotIndex[time] = slotIndex[time] && freeSlot && slotsAmount <= slotGap;\n\t\t\t\t\t\tslotGap = freeSlot ? slotGap + 1 : 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.isResourceSelectorInAutoMode())\n\t\t\t\t{\n\t\t\t\t\tconst resList = this.getResourceValue();\n\t\t\t\t\tfor (i = timeSlots.length; i--; i >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\ttime = timeSlots[i].time;\n\t\t\t\t\t\tfreeSlot = false;\n\n\t\t\t\t\t\tif (todayNowTime && time < todayNowTime)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tslotIndex[time] = false;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (j = 0; j < resList.length; j++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!loadedDate.slots[time]\n\t\t\t\t\t\t\t\t|| !loadedDate.slots[time]['resource' + resList[j]])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfreeSlot = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tslotIndex[time] = slotIndex[time] && freeSlot && slotsAmount <= slotGap;\n\t\t\t\t\t\tslotGap = freeSlot ? slotGap + 1 : 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tslotIndex =  this.getAvailableSlotIndex({\n\t\t\t\t\tdate: params.date || this.dateControl.getValue(),\n\t\t\t\t\tresources: this.getSelectedResources(),\n\t\t\t\t\tuser: this.getSelectedUser(),\n\t\t\t\t\tduration: this.getCurrentDuration()\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\treturn slotIndex;\n\t}\n\n\tgetAvailableSlotIndex(params)\n\t{\n\t\tlet todayNowTime = 0;\n\t\tconst fieldParams = this.getFieldParams();\n\t\tlet\n\t\t\tdateKey, loadedDate, i, j, time,\n\t\t\tslotGap,\n\t\t\tuserKey = params.user ? 'user' + params.user : null,\n\t\t\tslotsAmount = Math.ceil(params.duration / this.scale),\n\t\t\tuserIsFree, resourcesAreFree,\n\t\t\ttimeSlots = this.getTimeSlots(),\n\t\t\tallowOverbooking = fieldParams.ALLOW_OVERBOOKING === \"Y\",\n\t\t\tslotIndex = {};\n\n\t\t// Prefill slotIndex\n\t\ttimeSlots.forEach(function(slot){slotIndex[slot.time] = true;}, this);\n\n\t\tif (Type.isDate(params.date))\n\t\t{\n\t\t\tdateKey = BookingUtil.formatDate(this.DATE_FORMAT, params.date);\n\t\t\tloadedDate = this.loadedDates[this.loadedDatesIndex[dateKey]];\n\t\t\tslotGap = 1;\n\n\t\t\tif (this.checkIsTodayDate(dateKey))\n\t\t\t{\n\t\t\t\tconst today = new Date();\n\t\t\t\tconst deltaOffset = fieldParams.USE_USER_TIMEZONE === 'N'\n\t\t\t\t\t? today.getTimezoneOffset() * 60 + this.timezoneOffset:\n\t\t\t\t\t0;\n\t\t\t\ttodayNowTime = today.getHours() * 60 + today.getMinutes() + (deltaOffset / 60);\n\t\t\t}\n\n\t\t\tfor (i = timeSlots.length; i--; i >= 0)\n\t\t\t{\n\t\t\t\ttime = timeSlots[i].time;\n\t\t\t\tif (todayNowTime && time < todayNowTime)\n\t\t\t\t{\n\t\t\t\t\tslotIndex[time] = false;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (allowOverbooking)\n\t\t\t\t{\n\t\t\t\t\tslotIndex[time] = slotsAmount <= slotGap;\n\t\t\t\t\tslotGap++;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tuserIsFree = true;\n\t\t\t\t\tresourcesAreFree = true;\n\n\t\t\t\t\tif (userKey)\n\t\t\t\t\t{\n\t\t\t\t\t\t// Time is free for user\n\t\t\t\t\t\tuserIsFree = !loadedDate.slots[time] || !loadedDate.slots[time][userKey];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (params.resources && params.resources.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (j = 0; j < params.resources.length; j++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresourcesAreFree = resourcesAreFree && (!loadedDate.slots[time] || !loadedDate.slots[time]['resource' + params.resources[j]]);\n\n\t\t\t\t\t\t\tif (!resourcesAreFree)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tslotIndex[time] = userIsFree && resourcesAreFree && slotsAmount <= slotGap;\n\n\t\t\t\t\tif (userIsFree && resourcesAreFree)\n\t\t\t\t\t{\n\t\t\t\t\t\tslotGap++;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tslotGap = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn slotIndex;\n\t}\n\n\tcheckSlotsForDate(date, slotsAmount, params)\n\t{\n\t\tlet\n\t\t\tuserIsFree = true,\n\t\t\tresourcesAreFree = true,\n\t\t\tdateKey = Type.isDate(date) ? BookingUtil.formatDate(this.DATE_FORMAT, date) : date;\n\n\t\tparams = params || {};\n\t\tif (this.usersDisplayed() && params.user)\n\t\t{\n\t\t\tif (this.busySlotMatrix.user[params.user]\n\t\t\t\t&& !this.entityHasSlotsForDate({\n\t\t\t\t\tentityType: 'user',\n\t\t\t\t\tentityId: params.user,\n\t\t\t\t\tdateKey: dateKey,\n\t\t\t\t\tslotsAmount: slotsAmount\n\t\t\t\t})\n\t\t\t)\n\t\t\t{\n\t\t\t\tuserIsFree = false;\n\t\t\t}\n\t\t}\n\n\t\tif (this.resourcesDisplayed() && userIsFree\n\t\t\t&& Type.isArray(params.resources) && params.resources.length  > 0)\n\t\t{\n\t\t\tparams.resources.forEach(function(resourceId)\n\t\t\t{\n\t\t\t\tif (resourcesAreFree\n\t\t\t\t\t&& this.busySlotMatrix.resource[resourceId]\n\t\t\t\t\t&& !this.entityHasSlotsForDate({\n\t\t\t\t\t\tentityType: 'resource',\n\t\t\t\t\t\tentityId: resourceId,\n\t\t\t\t\t\tdateKey: dateKey,\n\t\t\t\t\t\tslotsAmount: slotsAmount\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tresourcesAreFree = false;\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\n\t\treturn userIsFree && resourcesAreFree;\n\t}\n\n\tentityHasSlotsForDate(params)\n\t{\n\t\tlet\n\t\t\tbusySlotList,\n\t\t\tslots, i,\n\t\t\tfreeSlotCount = 0,\n\t\t\thasFreeSlots = false;\n\n\t\tif (this.busySlotMatrix[params.entityType][params.entityId] &&\n\t\t\tthis.busySlotMatrix[params.entityType][params.entityId][params.dateKey])\n\t\t{\n\t\t\tbusySlotList = this.busySlotMatrix[params.entityType][params.entityId][params.dateKey];\n\t\t\tslots = this.getTimeSlots();\n\t\t\tfor (i = 0; i < slots.length; i++)\n\t\t\t{\n\t\t\t\tif (!busySlotList[slots[i].time])\n\t\t\t\t{\n\t\t\t\t\tfreeSlotCount++;\n\t\t\t\t\tif (freeSlotCount >= params.slotsAmount)\n\t\t\t\t\t{\n\t\t\t\t\t\thasFreeSlots = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfreeSlotCount = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\thasFreeSlots = true;\n\t\t}\n\n\t\treturn hasFreeSlots;\n\t}\n\n\tgetSelectedResources()\n\t{\n\t\tlet result = null;\n\t\tif (this.resourceControl)\n\t\t{\n\t\t\tresult = this.resourceControl.getSelectedValues();\n\t\t\tif (Type.isArray(result) && !result.length)\n\t\t\t{\n\t\t\t\tresult = null;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\n\tgetSelectedUser()\n\t{\n\t\tlet result = null;\n\t\tif (this.userControl)\n\t\t{\n\t\t\tresult = this.userControl.getSelectedUser();\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetCurrentDuration()\n\t{\n\t\tlet result = null;\n\t\tif (this.durationControl)\n\t\t{\n\t\t\tresult = this.durationControl.getSelectedValue();\n\t\t}\n\t\telse if (this.serviceControl)\n\t\t{\n\t\t\tlet service = this.serviceControl.getSelectedService(true);\n\t\t\tif (service && service.duration)\n\t\t\t{\n\t\t\t\tresult = parseInt(service.duration);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetDefaultDurationSlotsAmount()\n\t{\n\t\tlet\n\t\t\tsettingsData = this.getSettingsData(),\n\t\t\tfieldParams = this.getFieldParams(),\n\t\t\tduration, i, slotsAmount;\n\n\t\tif (fieldParams.USE_SERVICES === 'Y' && settingsData.services.value)\n\t\t{\n\t\t\tconst services = this.getServicesValue();\n\t\t\tif (Type.isArray(fieldParams.SERVICE_LIST) && services.length > 0)\n\t\t\t{\n\t\t\t\tfor (i = 0; i < fieldParams.SERVICE_LIST.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (BookingUtil.translit(fieldParams.SERVICE_LIST[i].name) === services[0])\n\t\t\t\t\t{\n\t\t\t\t\t\tduration = parseInt(fieldParams.SERVICE_LIST[i].duration);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tduration = parseInt(settingsData.duration.defaultValue);\n\t\t}\n\n\t\tslotsAmount = Math.ceil(duration / this.scale);\n\t\treturn slotsAmount;\n\t}\n\n\tgetCurrentServiceName()\n\t{\n\t\tlet result = '';\n\t\tif (this.serviceControl)\n\t\t{\n\t\t\tlet service = this.serviceControl.getSelectedService(true);\n\t\t\tif (service && service.name)\n\t\t\t{\n\t\t\t\tresult = service.name;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetCurrentDate()\n\t{\n\t\tlet result = null;\n\t\tif (this.dateControl && this.dateControl.isShown())\n\t\t{\n\t\t\tresult = this.dateControl.getValue();\n\t\t\tif (this.timeSelectorDisplayed())\n\t\t\t{\n\t\t\t\tlet\n\t\t\t\t\thour, min,\n\t\t\t\t\ttimeValue = this.timeControl.getValue();\n\n\t\t\t\tif (timeValue)\n\t\t\t\t{\n\t\t\t\t\thour = Math.floor(timeValue / 60);\n\t\t\t\t\tmin = timeValue - hour * 60;\n\t\t\t\t\tresult.setHours(hour, min, 0, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.setHours(0, 0, 0, 0);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetTimeSlots()\n\t{\n\t\tif (!this.slots)\n\t\t{\n\t\t\tthis.slots = [];\n\t\t\tlet slot;\n\t\t\tlet finishTime, hourFrom,  hourTo;\n\t\t\tlet minTo, minFrom;\n\t\t\tlet num = 0;\n\t\t\tlet time = this.timeFrom * 60;\n\n\t\t\twhile (time < this.timeTo * 60)\n\t\t\t{\n\t\t\t\thourFrom = Math.floor(time / 60);\n\t\t\t\tminFrom = (time) - hourFrom * 60;\n\t\t\t\tfinishTime = time + this.scale;\n\t\t\t\thourTo = Math.floor(finishTime / 60);\n\t\t\t\tminTo = (finishTime) - hourTo * 60;\n\n\t\t\t\tslot = {\n\t\t\t\t\ttime: time\n\t\t\t\t};\n\n\t\t\t\tthis.slots.push(slot);\n\t\t\t\ttime += this.scale;\n\t\t\t\tnum++;\n\t\t\t}\n\t\t}\n\t\treturn this.slots;\n\t}\n\n\tusersDisplayed()\n\t{\n\t\tif (this.useUsers === undefined)\n\t\t{\n\t\t\tthis.useUsers = this.getFieldParams()['USE_USERS'] === 'Y';\n\t\t}\n\t\treturn this.useUsers;\n\t}\n\n\tresourcesDisplayed()\n\t{\n\t\tif (this.useResources === undefined)\n\t\t{\n\t\t\tlet fieldParams = this.getFieldParams();\n\t\t\tthis.useResources = !!(fieldParams.USE_RESOURCES === 'Y'\n\t\t\t\t&& fieldParams.SELECTED_RESOURCES);\n\t\t}\n\t\treturn this.useResources;\n\t}\n\n\ttimeSelectorDisplayed()\n\t{\n\t\tif (this.useTime === undefined)\n\t\t{\n\t\t\tthis.useTime = this.getFieldParams().FULL_DAY !== 'Y';\n\t\t}\n\t\treturn this.useTime;\n\t}\n\n\tselectorCanBeShown(type)\n\t{\n\t\tlet result = false;\n\t\tif (type === 'resources')\n\t\t{\n\t\t\tif (this.resourcesDisplayed() && !this.usersDisplayed())\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t}\n\t\t\telse if (this.usersDisplayed())\n\t\t\t{\n\t\t\t\tresult = this.getSelectedUser();\n\t\t\t}\n\t\t}\n\t\telse if (type === 'date' || type === 'services' || type === 'duration')\n\t\t{\n\t\t\tif (this.usersDisplayed() && this.resourcesDisplayed())\n\t\t\t{\n\t\t\t\tresult = this.getSelectedUser() && this.getSelectedResources();\n\t\t\t}\n\t\t\telse if (this.usersDisplayed())\n\t\t\t{\n\t\t\t\tresult = this.getSelectedUser();\n\t\t\t}\n\t\t\telse if (this.resourcesDisplayed())\n\t\t\t{\n\t\t\t\tresult = this.getSelectedResources();\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tcheckIsTodayDate(dateKey)\n\t{\n\t\tif (!this.todayDateKey)\n\t\t{\n\t\t\tlet today = new Date();\n\t\t\tthis.todayDateKey = BookingUtil.formatDate(this.DATE_FORMAT, today);\n\t\t}\n\t\treturn this.todayDateKey === dateKey;\n\t}\n\n\tgetResourceValue()\n\t{\n\t\tconst settingsData = this.getSettingsData();\n\t\tlet value = [];\n\t\tif (Type.isArray(settingsData.resources.value))\n\t\t{\n\t\t\tvalue = settingsData.resources.value;\n\t\t}\n\t\telse if (Type.isString(settingsData.resources.value))\n\t\t{\n\t\t\tvalue = settingsData.resources.value.split('|');\n\t\t}\n\t\treturn value;\n\t}\n\n\tgetUsersValue()\n\t{\n\t\tconst settingsData = this.getSettingsData();\n\t\tlet value = [];\n\t\tif (Type.isArray(settingsData.users.value))\n\t\t{\n\t\t\tvalue = settingsData.users.value;\n\t\t}\n\t\telse if (Type.isString(settingsData.users.value))\n\t\t{\n\t\t\tvalue = settingsData.users.value.split('|');\n\t\t}\n\t\treturn value;\n\t}\n\n\tgetServicesValue()\n\t{\n\t\tconst settingsData = this.getSettingsData();\n\t\tlet value = [];\n\t\tif (Type.isArray(settingsData.services.value))\n\t\t{\n\t\t\tvalue = settingsData.services.value;\n\t\t}\n\t\telse if (Type.isString(settingsData.services.value))\n\t\t{\n\t\t\tvalue = settingsData.services.value.split('|');\n\t\t}\n\t\treturn value;\n\t}\n}","import {Loc} from \"./resourcebooking\";\n\nexport class Translit\n{\n\tstatic replacementCharTable = null;\n\n\tstatic run (str)\n\t{\n\t\tlet\n\t\t\treplaceChar = '_',\n\t\t\tregexpEnChars = /[A-Z0-9]/i,\n\t\t\tregexpSpace = /\\s/,\n\t\t\tmaxLength = 100,\n\t\t\tlen = str.length,\n\t\t\tresult = '',\n\t\t\tlastNewChar = '',\n\t\t\ti;\n\n\t\tfor (i = 0; i < len; i++)\n\t\t{\n\t\t\tlet\n\t\t\t\tnewChar,\n\t\t\t\tchr = str.charAt(i);\n\n\t\t\tif (regexpEnChars.test(chr))\n\t\t\t{\n\t\t\t\tnewChar = chr;\n\t\t\t}\n\t\t\telse if (regexpSpace.test(chr))\n\t\t\t{\n\t\t\t\tif (i > 0 && lastNewChar !== replaceChar)\n\t\t\t\t{\n\t\t\t\t\tnewChar = replaceChar;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnewChar = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewChar = Translit.getChar(chr);\n\n\t\t\t\tif (newChar === null)\n\t\t\t\t{\n\t\t\t\t\tif (i > 0 && i !== len - 1 && lastNewChar !== replaceChar)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewChar = replaceChar;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tnewChar = '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (null != newChar && newChar.length > 0)\n\t\t\t{\n\t\t\t\tnewChar = newChar.toLowerCase();\n\t\t\t\tresult += newChar;\n\t\t\t\tlastNewChar = newChar;\n\t\t\t}\n\n\t\t\tif (result.length >= maxLength)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tstatic generateReplacementCharTable()\n\t{\n\t\tlet\n\t\t\tseparator = ',',\n\t\t\tcharTableFrom = (Loc.getMessage('TRANSLIT_FROM') || '').split(separator),\n\t\t\tcharTableTo = (Loc.getMessage('TRANSLIT_TO') || '').split(separator),\n\t\t\ti, len;\n\n\t\tTranslit.replacementCharTable = [];\n\t\tfor (i = 0, len = charTableFrom.length; i < len; i++)\n\t\t{\n\t\t\tTranslit.replacementCharTable[i] = [charTableFrom[i], charTableTo[i]];\n\t\t}\n\t}\n\n\tstatic getChar(chr)\n\t{\n\t\tif (Translit.replacementCharTable === null)\n\t\t{\n\t\t\tTranslit.generateReplacementCharTable();\n\t\t}\n\n\t\tfor (let i = 0, len = Translit.replacementCharTable.length; i < len; i++)\n\t\t{\n\t\t\tif (chr === Translit.replacementCharTable[i][0])\n\t\t\t{\n\t\t\t\treturn Translit.replacementCharTable[i][1];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n}","import {Type, Loc, Tag, Runtime, CoreDate} from \"./resourcebooking\";\nimport {Translit} from \"./translit\";\n\nexport class BookingUtil {\n\tstatic simpleTimeList = null;\n\tstatic DAY_LENGTH = 86400000;\n\tstatic TIME_FORMAT = null;\n\tstatic TIME_FORMAT_SHORT = null;\n\tstatic DATE_FORMAT = null;\n\tstatic DATETIME_FORMAT = null;\n\n\tstatic getDateFormat()\n\t{\n\t\tif (Type.isNull(BookingUtil.DATE_FORMAT))\n\t\t{\n\t\t\tBookingUtil.DATE_FORMAT = CoreDate.convertBitrixFormat(Loc.getMessage(\"FORMAT_DATE\"));\n\t\t}\n\t\treturn BookingUtil.DATE_FORMAT;\n\t}\n\n\tstatic getDateTimeFormat()\n\t{\n\t\tif (Type.isNull(BookingUtil.DATETIME_FORMAT))\n\t\t{\n\t\t\tBookingUtil.DATETIME_FORMAT = CoreDate.convertBitrixFormat(Loc.getMessage(\"FORMAT_DATETIME\"));\n\t\t}\n\t\treturn BookingUtil.DATETIME_FORMAT;\n\t}\n\n\tstatic getTimeFormat()\n\t{\n\t\tif (Type.isNull(BookingUtil.TIME_FORMAT))\n\t\t{\n\t\t\tlet DATETIME_FORMAT = BookingUtil.getDateTimeFormat();\n\t\t\tlet DATE_FORMAT = BookingUtil.getDateFormat();\n\n\t\t\tif ((DATETIME_FORMAT.substr(0, DATE_FORMAT.length) === DATE_FORMAT))\n\t\t\t{\n\t\t\t\tBookingUtil.TIME_FORMAT = DATETIME_FORMAT.substr(DATE_FORMAT.length).trim();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tBookingUtil.TIME_FORMAT = CoreDate.convertBitrixFormat(CoreDate.isAmPmMode() ? 'H:MI:SS T' : 'HH:MI:SS');\n\t\t\t}\n\n\t\t\tBookingUtil.TIME_FORMAT_SHORT = BookingUtil.TIME_FORMAT.replace(':s', '');\n\t\t}\n\n\t\treturn BookingUtil.TIME_FORMAT;\n\t}\n\n\tstatic getTimeFormatShort()\n\t{\n\t\tif (Type.isNull(BookingUtil.TIME_FORMAT_SHORT))\n\t\t{\n\t\t\tBookingUtil.TIME_FORMAT_SHORT = BookingUtil.getTimeFormat().replace(':s', '');\n\t\t}\n\t\treturn BookingUtil.TIME_FORMAT_SHORT;\n\t}\n\n\tstatic formatDate(format, timestamp, now, utc)\n\t{\n\t\tif (format === null)\n\t\t{\n\t\t\tformat = BookingUtil.getDateFormat();\n\t\t}\n\n\t\tif (Type.isDate(timestamp))\n\t\t{\n\t\t\ttimestamp = timestamp.getTime() / 1000;\n\t\t}\n\n\t\treturn CoreDate.format(format, timestamp, now, utc);\n\t}\n\n\tstatic parseDate(str, bUTC, formatDate, formatDatetime)\n\t{\n\t\treturn CoreDate.parse(str, bUTC, formatDate, formatDatetime);\n\t}\n\n\tstatic formatTime(h, m)\n\t{\n\t\tlet d = new Date();\n\t\td.setHours(h, m, 0);\n\t\treturn CoreDate.format(BookingUtil.getTimeFormatShort(), d.getTime() / 1000);\n\t};\n\n\tstatic translit(str)\n\t{\n\t\treturn Type.isString(str) ? Translit.run(str).replace(/[^a-z0-9_]/ig, \"_\") : str;\n\t}\n\n\tstatic getLoader(size, className)\n\t{\n\t\treturn Tag.render`\n\t\t<div class=\"${className || 'calendar-loader'}\">\n\t\t\t<svg class=\"calendar-loader-circular\"\n\t\t\t\tstyle=\"width:${parseInt(size)}px; height:${parseInt(size)}px;\"\n\t\t\t\tviewBox=\"25 25 50 50\">\n\t\t\t\t\t<circle class=\"calendar-loader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t\t<circle class=\"calendar-loader-inner-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t</svg>\n\t\t</div>\n`;\n\t};\n\n\tstatic fireCustomEvent(eventObject, eventName, eventParams, secureParams)\n\t{\n\t\tif (window.BX && Type.isFunction(BX.onCustomEvent))\n\t\t{\n\t\t\treturn BX.onCustomEvent(eventObject, eventName, eventParams, secureParams);\n\t\t}\n\t}\n\n\tstatic bindCustomEvent(eventObject, eventName, eventHandler)\n\t{\n\t\tif (window.BX && Type.isFunction(BX.addCustomEvent))\n\t\t{\n\t\t\treturn BX.addCustomEvent(eventObject, eventName, eventHandler);\n\t\t}\n\t}\n\n\tstatic unbindCustomEvent(eventObject, eventName, eventHandler)\n\t{\n\t\tif (window.BX && Type.isFunction(BX.removeCustomEvent))\n\t\t{\n\t\t\treturn BX.removeCustomEvent(eventObject, eventName, eventHandler);\n\t\t}\n\t}\n\n\tstatic isAmPmMode()\n\t{\n\t\treturn CoreDate.isAmPmMode();\n\t}\n\n\tstatic mergeEx()\n\t{\n\t\tlet arg = Array.prototype.slice.call(arguments);\n\t\tif(arg.length < 2)\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\tlet result = arg.shift();\n\t\tfor (let i = 0; i < arg.length; i++)\n\t\t{\n\t\t\tfor (let k in arg[i])\n\t\t\t{\n\t\t\t\tif (typeof arg[i] === \"undefined\" || arg[i] == null || !arg[i].hasOwnProperty(k))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (Type.isPlainObject(arg[i][k]) && Type.isPlainObject(result[k]))\n\t\t\t\t{\n\t\t\t\t\tBookingUtil.mergeEx(result[k], arg[i][k]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresult[k] = Type.isPlainObject(arg[i][k]) ? Runtime.clone(arg[i][k]) : arg[i][k];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tstatic getDurationList(fullDay)\n\t{\n\t\tlet\n\t\t\tvalues = [5, 10, 15, 20, 25, 30, 40, 45, 50, 60, 90,\n\t\t\t\t120, 180, 240, 300, 360,\n\t\t\t\t1440, 1440 * 2, 1440 * 3, 1440 * 4, 1440 * 5, 1440 * 6, 1440 * 7, 1440 * 10],\n\t\t\tval, i, res = [];\n\n\t\tfor (i = 0; i < values.length; i++)\n\t\t{\n\t\t\tval = values[i];\n\t\t\tif (fullDay && val % 1440 !== 0)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tres.push({\n\t\t\t\tvalue: val,\n\t\t\t\tlabel: BookingUtil.getDurationLabel(val)\n\t\t\t});\n\t\t}\n\t\treturn res;\n\t}\n\n\tstatic getDurationLabel(val)\n\t{\n\t\tlet label;\n\t\tif (val % 1440 === 0) // Days\n\t\t{\n\t\t\tlabel = Loc.getMessage('USER_TYPE_DURATION_X_DAY').replace('#NUM#', val / 1440);\n\t\t}\n\t\telse if (val % 60 === 0 && val !== 60) // Hours\n\t\t{\n\t\t\tlabel = Loc.getMessage('USER_TYPE_DURATION_X_HOUR').replace('#NUM#', val / 60);\n\t\t}\n\t\t// Minutes\n\t\telse\n\t\t{\n\t\t\tlabel = Loc.getMessage('USER_TYPE_DURATION_X_MIN').replace('#NUM#', val);\n\t\t}\n\t\treturn label\n\t}\n\n\tstatic parseDuration(value)\n\t{\n\t\tlet\n\t\t\tstringValue = value,\n\t\t\tnumValue = parseInt(value),\n\t\t\tparsed = false,\n\t\t\tdayRegexp = new RegExp('(\\\\d)\\\\s*(' + Loc.getMessage('USER_TYPE_DURATION_REGEXP_DAY') + ').*', 'ig'),\n\t\t\thourRegexp = new RegExp('(\\\\d)\\\\s*(' + Loc.getMessage('USER_TYPE_DURATION_REGEXP_HOUR') + ').*', 'ig');\n\n\t\tvalue = value.replace(dayRegexp, function(str, num){parsed = true;return num;});\n\t\t// It's days\n\t\tif (parsed)\n\t\t{\n\t\t\tvalue = numValue * 1440;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvalue = stringValue.replace(hourRegexp, function(str, num){parsed = true;return num;});\n\t\t\t// It's hours\n\t\t\tif (parsed)\n\t\t\t{\n\t\t\t\tvalue = numValue * 60;\n\t\t\t}\n\t\t\telse // Minutes\n\t\t\t{\n\t\t\t\tvalue = numValue;\n\t\t\t}\n\t\t}\n\n\t\treturn parseInt(value) || 0;\n\t}\n\n\tstatic getSimpleTimeList()\n\t{\n\t\tif (Type.isNull(BookingUtil.simpleTimeList))\n\t\t{\n\t\t\tlet i, res = [];\n\t\t\tfor (i = 0; i < 24; i++)\n\t\t\t{\n\t\t\t\tres.push({value: i * 60, label: this.formatTime(i, 0)});\n\t\t\t\tres.push({value: i * 60 + 30, label: this.formatTime(i, 30)});\n\t\t\t}\n\t\t\tBookingUtil.simpleTimeList = res;\n\t\t}\n\t\treturn BookingUtil.simpleTimeList;\n\t}\n\n\tstatic adaptTimeValue(timeValue)\n\t{\n\t\ttimeValue = parseInt(timeValue.h * 60) + parseInt(timeValue.m);\n\t\tlet\n\t\t\ttimeList = BookingUtil.getSimpleTimeList(),\n\t\t\tdiff = 24 * 60,\n\t\t\tind = false,\n\t\t\ti;\n\n\t\tfor (i = 0; i < timeList.length; i++)\n\t\t{\n\t\t\tif (Math.abs(timeList[i].value - timeValue) < diff)\n\t\t\t{\n\t\t\t\tdiff = Math.abs(timeList[i].value - timeValue);\n\t\t\t\tind = i;\n\t\t\t\tif (diff <= 15)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn timeList[ind || 0];\n\t}\n\n\tstatic getDayLength()\n\t{\n\t\treturn BookingUtil.DAY_LENGTH;\n\t}\n\n\tstatic showLimitationPopup()\n\t{\n\t\tif (top.BX.getClass(\"BX.UI.InfoHelper\"))\n\t\t{\n\t\t\ttop.BX.UI.InfoHelper.show('limit_crm_booking');\n\t\t}\n\t};\n}","import {Type, Loc, Dom, Event} from \"./resourcebooking\";\nimport {UserSelector} from \"./controls/userselector\";\nimport {ResourceSelector} from \"./controls/resourceselector\";\nimport {ServiceSelector} from \"./controls/serviceselector\";\nimport {DurationSelector} from \"./controls/durationselector\";\nimport {DateSelector} from \"./controls/dateselector\";\nimport {TimeSelector} from \"./controls/timeselector\";\n\nexport class FieldViewControllerAbstract extends Event.EventEmitter\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t\tthis.settings = params.settings || {};\n\t\tthis.showTitle = params.displayTitle !== false;\n\t\tthis.title = params.title || '';\n\t\tthis.DOM = {\n\t\t\twrap: params.wrap // outer wrap of the form\n\t\t};\n\t}\n\n\tbuild()\n\t{\n\t\tthis.controls = {};\n\t\t// inner wrap\n\t\tthis.DOM.outerWrap = this.DOM.wrap.appendChild(Dom.create(\"div\", {props : { className : 'calendar-resbook-webform-wrapper calendar-resbook-webform-wrapper-form'}}));\n\t\tthis.DOM.innerWrap = this.DOM.outerWrap.appendChild(Dom.create(\"div\", {props : { className : 'calendar-resbook-webform-inner'}}));\n\n\t\tif (this.settings.userfieldSettings.useUsers || this.settings.userfieldSettings.useResources)\n\t\t{\n\t\t\tthis.displayTitle();\n\t\t\tthis.displayUsersControl();\n\t\t\tthis.displayResourcesControl();\n\t\t\tthis.displayServicesControl();\n\t\t\tthis.displayDurationControl();\n\t\t\tthis.displayDateControl();\n\t\t\tthis.displayTimeControl();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.displayWarning(Loc.getMessage('WEBF_RES_BOOKING_WARNING'));\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tDom.remove(this.DOM.outerWrap);\n\t}\n\n\tdisplayTitle()\n\t{\n\t\tif (this.showTitle)\n\t\t{\n\t\t\tthis.DOM.titleWrap = this.DOM.innerWrap\n\t\t\t\t.appendChild(Dom.create(\"div\", {props:{className:'calendar-resbook-webform-title'}}))\n\t\t\t\t.appendChild(Dom.create(\"div\", {props:{className:'calendar-resbook-webform-title-text'}}));\n\t\t\tthis.updateTitle(this.title);\n\t\t}\n\t}\n\n\tupdateTitle(title)\n\t{\n\t\tif (this.showTitle)\n\t\t{\n\t\t\tthis.title = title;\n\t\t\tDom.adjust(this.DOM.titleWrap, {text: this.title});\n\t\t}\n\t}\n\n\tdisplayWarning(message)\n\t{\n\t\tthis.DOM.warningWrap = this.DOM.innerWrap\n\t\t\t.appendChild(Dom.create(\"div\", {\n\t\t\t\tprops:{className:'ui-alert ui-alert-warning ui-alert-text-center ui-alert-icon-warning'},\n\t\t\t\tstyle: {marginBottom: 0},\n\t\t\t\thtml: '<span class=\"ui-alert-message\">' + message + '</span>'\n\t\t\t}));\n\t}\n\n\tdisplayUsersControl()\n\t{\n\t\tif (this.settings.userfieldSettings.useUsers)\n\t\t{\n\t\t\tif (this.settings.data.users.value === null\n\t\t\t\t&& Type.isArray(this.settings.userfieldSettings.users))\n\t\t\t{\n\t\t\t\tthis.settings.data.users.value = this.settings.userfieldSettings.users;\n\t\t\t}\n\n\t\t\tthis.controls.users = new UserSelector({\n\t\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\t\tdata: this.settings.data.users,\n\t\t\t\tuserIndex: this.settings.userfieldSettings.userIndex\n\t\t\t});\n\t\t\tthis.controls.users.display();\n\t\t}\n\t}\n\n\tdisplayResourcesControl()\n\t{\n\t\tif (this.settings.userfieldSettings.useResources)\n\t\t{\n\t\t\tif (this.settings.data.resources.value === null\n\t\t\t\t&& Type.isArray(this.settings.userfieldSettings.resources))\n\t\t\t{\n\t\t\t\tthis.settings.data.resources.value = [];\n\t\t\t\tthis.settings.userfieldSettings.resources.forEach(function(res)\n\t\t\t\t{\n\t\t\t\t\tthis.settings.data.resources.value.push(parseInt(res.id));\n\t\t\t\t}, this);\n\t\t\t}\n\n\t\t\tthis.controls.resources = new ResourceSelector({\n\t\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\t\tdata: this.settings.data.resources,\n\t\t\t\tresourceList: this.settings.userfieldSettings.resources\n\t\t\t});\n\t\t\tthis.controls.resources.display();\n\t\t}\n\t}\n\n\tdisplayServicesControl()\n\t{\n\t\tif (this.settings.userfieldSettings.useServices)\n\t\t{\n\t\t\tif (this.settings.data.services.value === null\n\t\t\t\t&& Type.isArray(this.settings.userfieldSettings.services))\n\t\t\t{\n\t\t\t\tthis.settings.data.services.value = [];\n\t\t\t\tthis.settings.userfieldSettings.services.forEach(function(serv)\n\t\t\t\t{\n\t\t\t\t\tthis.settings.data.services.value.push(serv.name);\n\t\t\t\t}, this);\n\t\t\t}\n\n\t\t\tthis.controls.services = new ServiceSelector({\n\t\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\t\tdata: this.settings.data.services,\n\t\t\t\tserviceList: this.settings.userfieldSettings.services\n\t\t\t});\n\t\t\tthis.controls.services.display();\n\t\t}\n\t}\n\n\tdisplayDurationControl()\n\t{\n\t\tif (!this.settings.userfieldSettings.useServices)\n\t\t{\n\t\t\tthis.controls.duration = new DurationSelector({\n\t\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\t\tdata: this.settings.data.duration,\n\t\t\t\tfullDay: this.settings.userfieldSettings.fullDay\n\t\t\t});\n\t\t\tthis.controls.duration.display();\n\t\t}\n\t}\n\n\tdisplayDateControl()\n\t{\n\t\tthis.controls.date = new DateSelector({\n\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\tdata: this.settings.data.date\n\t\t});\n\t\tthis.controls.date.display();\n\t}\n\n\tdisplayTimeControl()\n\t{\n\t\tif (!this.settings.userfieldSettings.fullDay)\n\t\t{\n\t\t\tthis.controls.time = new TimeSelector({\n\t\t\t\touterWrap: this.DOM.innerWrap,\n\t\t\t\tdata: this.settings.data.time\n\t\t\t});\n\t\t\tthis.controls.time.display();\n\t\t}\n\t}\n\n\trefreshLayout(settingsData)\n\t{\n\t\tfor (let k in this.controls)\n\t\t{\n\t\t\tif (this.controls.hasOwnProperty(k) && Type.isFunction(this.controls[k].refresh))\n\t\t\t{\n\t\t\t\tthis.controls[k].refresh(settingsData[k] || this.settings.data[k]);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetInnerWrap()\n\t{\n\t\treturn this.DOM.innerWrap;\n\t}\n\n\tgetOuterWrap()\n\t{\n\t\treturn this.DOM.outerWrap;\n\t}\n}\n\n\n\n\n\n\n","import {FieldViewControllerAbstract} from \"./fieldviewcontrollerabstract\";\nexport class FieldViewControllerEdit extends FieldViewControllerAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t}\n}","import {FieldViewControllerAbstract} from \"./fieldviewcontrollerabstract\";\nexport class FieldViewControllerPreview extends FieldViewControllerAbstract\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\t}\n\n\tbuild()\n\t{\n\t\tsuper.build();\n\t\tthis.DOM.outerWrap.className = 'calendar-resbook-webform-wrapper calendar-resbook-webform-wrapper-preview calendar-resbook-webform-wrapper-dark';\n\t}\n}","import {Type, Dom, Event, BookingUtil, MenuManager} from \"../resourcebooking\";\n\nexport class SelectInput extends Event.EventEmitter\n{\n\tconstructor(params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.id = params.id || 'bx-select-input-' + Math.round(Math.random() * 1000000);\n\n\t\tif (Type.isFunction(params.getValues))\n\t\t{\n\t\t\tthis.getValues = params.getValues;\n\t\t\tthis.values = this.getValues();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.values = params.values || false;\n\t\t}\n\n\t\tthis.input = params.input;\n\t\tthis.defaultValue = params.defaultValue || '';\n\t\tthis.openTitle = params.openTitle || '';\n\t\tthis.className = params.className || '';\n\t\tthis.currentValue = params.value;\n\t\tthis.currentValueIndex = params.valueIndex;\n\t\tthis.onChangeCallback = Type.isFunction(params.onChangeCallback) ? params.onChangeCallback : null;\n\t\tthis.onAfterMenuOpen = params.onAfterMenuOpen || null;\n\t\tthis.zIndex = params.zIndex || 1200;\n\t\tthis.disabled = params.disabled;\n\t\tthis.editable = params.editable !== false;\n\t\tthis.setFirstIfNotFound = !!params.setFirstIfNotFound;\n\n\t\tif (this.onChangeCallback)\n\t\t{\n\t\t\tEvent.bind(this.input, 'change', this.onChangeCallback);\n\t\t\tEvent.bind(this.input, 'keyup', this.onChangeCallback);\n\t\t}\n\n\t\tthis.curInd = false;\n\n\t\tif (Type.isArray(this.values))\n\t\t{\n\t\t\tEvent.bind(this.input, 'click', this.onClick.bind(this));\n\n\t\t\tif (this.editable)\n\t\t\t{\n\t\t\t\tEvent.bind(this.input, 'focus', this.onFocus.bind(this));\n\t\t\t\tEvent.bind(this.input, 'blur', this.onBlur.bind(this));\n\t\t\t\tEvent.bind(this.input, 'keyup', this.onKeyup.bind(this));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEvent.bind(this.input, 'focus', function(){this.input.blur();}.bind(this));\n\t\t\t}\n\n\t\t\tif (this.currentValueIndex === undefined && this.currentValue !== undefined)\n\t\t\t{\n\t\t\t\tthis.currentValueIndex = -1;\n\t\t\t\tfor (let i = 0; i < this.values.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (parseInt(this.values[i].value) === parseInt(this.currentValue))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentValueIndex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.currentValueIndex === -1)\n\t\t\t\t{\n\t\t\t\t\tthis.currentValueIndex = this.setFirstIfNotFound ? 0 : undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.currentValueIndex !== undefined && this.values[this.currentValueIndex])\n\t\t{\n\t\t\tthis.input.value = this.values[this.currentValueIndex].label;\n\t\t}\n\t}\n\n\tshowPopup()\n\t{\n\t\tif (this.getValues)\n\t\t{\n\t\t\tthis.values = this.getValues();\n\t\t}\n\n\t\tif (this.shown || this.disabled || !this.values.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet\n\t\t\tind = 0,\n\t\t\tj = 0,\n\t\t\tmenuItems = [],\n\t\t\ti,\n\t\t\t_this = this;\n\n\t\tfor (i = 0; i < this.values.length; i++)\n\t\t{\n\t\t\tif (this.values[i].delimiter)\n\t\t\t{\n\t\t\t\tmenuItems.push(this.values[i]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif ((this.currentValue && this.values[i] && this.values[i].value === this.currentValue.value)\n\t\t\t\t\t|| this.input.value === this.values[i].label)\n\t\t\t\t{\n\t\t\t\t\tind = j;\n\t\t\t\t}\n\n\t\t\t\tmenuItems.push({\n\t\t\t\t\tid: this.values[i].value + '_' + i,\n\t\t\t\t\ttext: this.values[i].label,\n\t\t\t\t\tonclick: this.values[i].callback || (function (value, label)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn function ()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t_this.input.value = label;\n\t\t\t\t\t\t\t_this.popupMenu.close();\n\t\t\t\t\t\t\t_this.onChange(value, label);\n\t\t\t\t\t\t}\n\t\t\t\t\t})(this.values[i].value, this.values[i].labelRaw || this.values[i].label)\n\t\t\t\t});\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\n\t\tthis.popupMenu = MenuManager.create(\n\t\t\tthis.id,\n\t\t\tthis.input,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tcloseByEsc : true,\n\t\t\t\tautoHide : true,\n\t\t\t\tzIndex: this.zIndex,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tcacheable: false\n\t\t\t}\n\t\t);\n\n\t\tif (!BX.browser.IsFirefox())\n\t\t{\n\t\t\tthis.popupMenu.popupWindow.setMinWidth(this.input.offsetWidth);\n\t\t}\n\n\t\tthis.popupMenu.popupWindow.setMaxWidth(300);\n\n\t\tlet menuContainer = this.popupMenu.layout.menuContainer;\n\t\tDom.addClass(this.popupMenu.layout.menuContainer, 'calendar-resourcebook-select-popup');\n\t\tthis.popupMenu.show();\n\n\t\tlet menuItem = this.popupMenu.menuItems[ind];\n\t\tif (menuItem && menuItem.layout)\n\t\t{\n\t\t\tmenuContainer.scrollTop = menuItem.layout.item.offsetTop - 2;\n\t\t}\n\n\t\tBookingUtil.bindCustomEvent(this.popupMenu.popupWindow, 'onPopupClose', function(){this.shown = false;}.bind(this));\n\n\t\tthis.input.select();\n\n\t\tif (Type.isFunction(this.onAfterMenuOpen))\n\t\t{\n\t\t\tthis.onAfterMenuOpen(ind, this.popupMenu);\n\t\t}\n\n\t\tthis.shown = true;\n\t}\n\n\tclosePopup()\n\t{\n\t\tMenuManager.destroy(this.id);\n\t\tthis.shown = false;\n\t}\n\n\tonFocus()\n\t{\n\t\tsetTimeout(function(){\n\t\t\tif (!this.shown)\n\t\t\t{\n\t\t\t\tthis.showPopup();\n\t\t\t}\n\t\t}.bind(this), 200);\n\t}\n\n\tonClick()\n\t{\n\t\tif (this.shown)\n\t\t{\n\t\t\tthis.closePopup();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showPopup();\n\t\t}\n\t}\n\n\tonBlur()\n\t{\n\t\tsetTimeout(this.closePopup.bind(this), 200);\n\t}\n\n\tonKeyup()\n\t{\n\t\tsetTimeout(this.closePopup.bind(this), 50);\n\t}\n\n\tonChange(value)\n\t{\n\t\tlet val = this.input.value;\n\t\tthis.emit('BX.Calendar.Resourcebooking.SelectInput:changed', new Event.BaseEvent({data: {selectinput: this, value: val, realValue: value}}));\n\t\tif (this.onChangeCallback)\n\t\t{\n\t\t\tthis.onChangeCallback({value: val, realValue: value});\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.onChangeCallback)\n\t\t{\n\t\t\tEvent.unbind(this.input, 'change', this.onChangeCallback);\n\t\t\tEvent.unbind(this.input, 'keyup', this.onChangeCallback);\n\t\t}\n\n\t\tEvent.unbind(this.input, 'click', this.onClick.bind(this));\n\t\tEvent.unbind(this.input, 'focus', this.onFocus.bind(this));\n\t\tEvent.unbind(this.input, 'blur', this.onBlur.bind(this));\n\t\tEvent.unbind(this.input, 'keyup', this.onKeyup.bind(this));\n\n\t\tif (this.popupMenu)\n\t\t{\n\t\t\tthis.popupMenu.close();\n\t\t}\n\n\t\tMenuManager.destroy(this.id);\n\t\tthis.shown = false;\n\t}\n\n\tsetValue(value)\n\t{\n\t\tthis.input.value = value;\n\t\tif (Type.isArray(this.values))\n\t\t{\n\t\t\tlet currentValueIndex = -1;\n\t\t\tfor (let i = 0; i < this.values.length; i++)\n\t\t\t{\n\t\t\t\tif (this.values[i].value === value)\n\t\t\t\t{\n\t\t\t\t\tcurrentValueIndex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (currentValueIndex !== -1)\n\t\t\t{\n\t\t\t\tthis.input.value = this.values[currentValueIndex].label;\n\t\t\t\tthis.currentValueIndex = currentValueIndex;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetValue()\n\t{\n\t\treturn this.input.value;\n\t}\n}","// @flow\n'use strict';\nimport { Type, Loc, Dom, Event, Tag, Browser, Text, Runtime } from 'main.core';\nimport {LiveFieldController} from './livefieldcontroller.js';\nimport {BookingUtil} from \"./bookingutil\";\nimport {FieldViewControllerEdit} from \"./fieldviewcontrolleredit\";\nimport {FieldViewControllerPreview} from \"./fieldviewcontrollerpreview\";\nimport {SelectInput} from \"./controls/selectinput\";\nimport \"main.date\";\nimport './css/resourcebooking.css';\nimport {PopupManager, MenuManager} from 'main.popup';\n\nimport {BaseEvent, EventEmitter } from 'main.core.events';\nlet CoreDate = window.BX && BX.Main && BX.Main.Date ? BX.Main.Date : null;\nexport {CoreDate};\nexport {Type, Loc, Dom, Event, Tag, Browser, Text, Runtime, PopupManager, MenuManager};\nexport {BaseEvent, EventEmitter};\nexport {BookingUtil, FieldViewControllerEdit, FieldViewControllerPreview, SelectInput};\n\nexport class Resourcebooking\n{\n\tstatic getLiveField(params)\n\t{\n\t\tif (!params.wrap || !Type.isDomNode(params.wrap))\n\t\t{\n\t\t\tthrow new Error('The argument \"params.wrap\" must be a DOM node');\n\t\t}\n\t\tif (Type.isNull(CoreDate))\n\t\t{\n\t\t\tthrow new Error('The error occured during Date extention loading');\n\t\t}\n\n\t\tlet liveFieldController = new LiveFieldController(params);\n\t\tliveFieldController.init();\n\t\treturn liveFieldController;\n\t}\n\n\tstatic getPreviewField(params)\n\t{\n\t}\n}\n"],"names":["ViewControlAbstract","constructor","params","new","target","TypeError","name","classNames","wrap","wrapClassName","innerWrap","title","field","DOM","outerWrap","dataWrap","labelWrap","data","shown","isDisplayed","show","isShown","display","appendChild","Dom","create","props","className","Tag","render","animation","refresh","refreshLabel","setDataConfig","hide","label","adjust","text","controlWrap","displayControl","remove","showWarning","errorMessage","addClass","displayErrorText","Loc","getMessage","hideWarning","removeClass","errorTextWrap","ViewDropDownSelect","id","Math","round","random","maxHeight","selectAllMessage","setSettings","build","select","attrs","events","click","openPopup","bind","setSelectedValues","selected","handleChangesCallback","Type","isFunction","values","isArray","multiple","isPopupShown","closePopup","menuItems","forEach","item","includes","parseInt","push","Text","encode","onclick","menuItemClick","length","selectAllItemClick","popup","MenuManager","closeByEsc","autoHide","offsetTop","offsetLeft","cacheable","popupContainer","popupWindow","style","width","offsetWidth","menuItem","checked","selectAllChecked","find","value","itemId","layout","innerHTML","Event","unbind","document","handleClick","setTimeout","close","e","selectAllcheckbox","srcElement","foundValue","checkbox","querySelector","hasClass","selectItem","deselectItem","handleControlChanges","index","indexOf","slice","concat","i","checkboxes","querySelectorAll","contains","getSelectedValues","textValues","selectedValues","join","UserSelector","userList","userIndex","defaultMode","previewMode","undefined","autoSelectDefaultValue","changeValueCallback","handleSettingsData","selectedValue","getSelectedUser","dropdownSelect","handleChanges","isPlainObject","hasOwnProperty","dataValue","dataValueRaw","split","displayName","setSelectedUser","userId","ResourceSelector","allResourceList","resourceList","setSelectedResource","ServiceSelector","serviceList","allServiceList","service","isString","trim","setSelectedService","getSelectedService","serviceIndex","prepareServiceId","BookingUtil","getDurationLabel","duration","serviceName","selectedService","getMeta","str","translit","DurationSelector","durationList","getDurationList","fullDay","defaultValue","durationItems","durationInput","type","durationControl","SelectInput","input","editable","manualInput","setFirstIfNotFound","onChangeCallback","setValue","getSelectedValue","parseDuration","getValue","DateSelector","requestDataCallback","allowOverbooking","displayed","setDateIndex","availableDateIndex","setCurrentDate","lineDateControl","refreshDateAvailability","start","configWasChanged","popupSateControl","PopupDateSelector","isDateAvailable","onChange","LineDateSelector","date","isDate","currentDate","isDateLoaded","isItPastDate","formatDate","dateKey","nowDate","Date","checkDate","getTime","setHours","refreshCurrentValue","getDisplayedValue","realDate","datePicker","valueInput","previousArrow","stateWrap","stateWrapDate","stateWrapDay","nextArrow","dateValue","hasAttribute","closest","dateMeta","getAttribute","setDate","getDate","openCalendarPopup","isExternalDatePickerEnabled","openExternalDatePicker","openBxCalendar","BX","calendar","node","bTime","get","unbindCustomEvent","handleCalendarClose","bindCustomEvent","parseDate","isNull","externalDatePickerIsEnabled","window","UI","Vue","Components","DatePick","hasTime","change","toggle","DAYS_DISPLAY_SIZE","dayNodes","dayNodeIndex","monthTitle","controlStaticWrap","controlInnerWrap","fillDays","initCustomScroll","startDate","getStartLoadDate","addDateSlot","innerWidth","dateCode","html","dayNode","getDayNode","setSelected","currentSelected","startLoadDate","arrowWrap","leftArrow","handlePreletrowClick","rightArrow","handleNextArrowClick","outerWidth","mousewheelScrollHandler","checkScrollPosition","scrollLeft","max","event","delta","deltaY","detail","wheelDelta","abs","Browser","isMac","stopPropagation","preventDefault","updateMonthTitle","dayNodeOuterWidth","childNodes","monthFrom","monthTo","firstDayNodeIndex","floor","lastDayNodeIndex","TimeSelector","timeFrom","timeTo","SLOTS_ROW_AMOUNT","popupSelectId","timezone","timezoneOffset","timezoneOffsetLabel","timeMidday","timeEvening","showOnlyFree","showFinishTime","scale","timezoneLabelWrap","replace","setSlotIndex","slotIndex","setCurrentValue","availableSlotIndex","timeValue","showEmptyWarning","warningWrap","warningTextNode","children","noSlotsAvailable","hideEmptyWarning","slotsInfo","getSlotsInfo","slots","freeSlotsCount","createSelectControl","createSlotsControl","isAmPmMode","itemsInColumn","maxColumnNumber","parts","itemNumber","slot","partOfTheDay","items","toUpperCase","itemsWrap","ceil","booked","time","toString","fromTime","toTime","itemsAmount","k","initCustomScrollForSlots","timeSelectWrap","getSlotByTime","isDomNode","getTimeTextBySlot","getSlotNode","hasAvailableSlots","meta","openSelectPopup","finishTime","hourFrom","minFrom","hourTo","minTo","part","num","formatTime","checkSlotsScroll","isSelectPopupShown","closeSelectPopup","getTimeSelectItems","angle","dataset","slotNodes","slotNode","StatusInformer","built","statusWrap","statusTimezone","dateFrom","getStatusText","dateTo","getHours","getMinutes","setError","message","isErrorSet","LiveFieldController","EventEmitter","setEventNamespace","actionAgent","ajax","runAction","inputName","DATE_FORMAT","getDateFormat","DATETIME_FORMAT","getDateTimeFormat","userFieldParams","loadedDates","externalSiteContext","accessibility","user","resource","busySlotMatrix","valueInputs","init","settingsData","getSettingsData","users","resources","Error","showMainLoader","requireFormData","then","hideMainLoader","buildFormControls","onChangeValues","check","result","usersDisplayed","userControl","resourcesDisplayed","getSelectedResources","resourceControl","getCurrentDuration","serviceControl","dateControl","statusControl","timeSelectorDisplayed","timeControl","inputsWrap","getFieldParams","ZIndexManager","stack","getOrAddStack","body","baseIndex","sort","preparaAutoSelectValues","displayUsersControl","displayResourcesControl","displayServicesControl","displayDurationControl","displayDateTimeControl","selectedUserId","selectedResourceId","refreshControlsState","selectorCanBeShown","getAvailableDateIndex","getSlotIndex","startValue","getFreeDate","updateStatusControl","fireCustomEvent","allValuesValue","dateFromValue","getCurrentDate","getCurrentServiceName","entries","clean","resourceId","selectedUser","entry","emit","loaderWrap","getLoader","mainLoader","showStatusLoader","hideStatusLoader","requestAccessibilityData","requestedFormData","formDataParams","from","Promise","resolve","reject","fieldName","entity_field_name","to","setLoadedDataLimits","response","isNumber","workTimeStart","workTimeEnd","fieldSettings","handleAccessibilityData","usersAccessibility","resourcesAccessibility","loadedDataFrom","loadedDataTo","loadedDatesIndex","key","slotsCount","fillDataIndex","entityType","entityId","dateIndex","setSeconds","fromTimestamp","toTimestamp","fillBusySlotMatrix","mergeEx","fromDate","dateToKey","timeValueFrom","timeValueTo","getTimeSlots","count","getCaption","caption","settings_data","getUserIndex","getSettings","isUserSelectorInAutoMode","isResourceSelectorInAutoMode","autoAdjustUserSelector","loadedDate","autoAdjustResourceSelector","autoSelectUser","autoSelectResource","autoSelectDate","maxStepsAuto","getFreeEntitiesForDate","slotsAmount","getDefaultDurationSlotsAmount","resList","getUsersValue","checkSlotsForDate","getResourceValue","BaseEvent","valueIndex","fieldParams","SELECTED_RESOURCES","res","USE_SERVICES","services","getServicesValue","SERVICE_LIST","FULL_DAY","ALLOW_OVERBOOKING","handleDateChanging","USE_USER_TIMEZONE","userTimezoneOffset","getTimezoneOffset","TIMEZONE","handleSelectedDateTimeChanging","useTimeout","updateTimeStatusTimeout","clearTimeout","freeDate","userIsFree","resourcesAreFree","daysGap","j","userKey","daysAmount","freeSlot","slotGap","todayNowTime","timeSlots","checkIsTodayDate","today","deltaOffset","getAvailableSlotIndex","entityHasSlotsForDate","busySlotList","freeSlotCount","hasFreeSlots","hour","min","useUsers","useResources","USE_RESOURCES","useTime","todayDateKey","Translit","run","replaceChar","regexpEnChars","regexpSpace","maxLength","len","lastNewChar","newChar","chr","charAt","test","getChar","toLowerCase","generateReplacementCharTable","separator","charTableFrom","charTableTo","replacementCharTable","CoreDate","convertBitrixFormat","getTimeFormat","TIME_FORMAT","substr","TIME_FORMAT_SHORT","getTimeFormatShort","format","timestamp","now","utc","bUTC","formatDatetime","parse","h","m","d","size","eventObject","eventName","eventParams","secureParams","onCustomEvent","eventHandler","addCustomEvent","removeCustomEvent","arg","Array","prototype","call","arguments","shift","Runtime","clone","val","stringValue","numValue","parsed","dayRegexp","RegExp","hourRegexp","getSimpleTimeList","simpleTimeList","adaptTimeValue","timeList","diff","ind","getDayLength","DAY_LENGTH","showLimitationPopup","top","getClass","InfoHelper","FieldViewControllerAbstract","settings","showTitle","displayTitle","controls","userfieldSettings","displayDateControl","displayTimeControl","displayWarning","destroy","titleWrap","updateTitle","marginBottom","useServices","serv","refreshLayout","getInnerWrap","getOuterWrap","FieldViewControllerEdit","FieldViewControllerPreview","getValues","openTitle","currentValue","currentValueIndex","onAfterMenuOpen","zIndex","disabled","curInd","onClick","onFocus","onBlur","onKeyup","blur","showPopup","_this","delimiter","callback","popupMenu","labelRaw","browser","IsFirefox","setMinWidth","setMaxWidth","menuContainer","scrollTop","selectinput","realValue","Main","Resourcebooking","getLiveField","liveFieldController","getPreviewField"],"mappings":"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"}