if(!DragNDrop){in_array=function(e,t){for(let i=0;i<e.length;i++){if(e[i]===t){return true}}return false};function CreateActivity(activityInfo){if(!activityInfo.Type){activityInfo={Type:activityInfo}}const type=activityInfo.Type;let a;if(arAllActivities[type.toLowerCase()]&&arAllActivities[type.toLowerCase()]["JSCLASS"]){a=eval("new "+arAllActivities[type.toLowerCase()]["JSCLASS"]+"()");if(!activityInfo.Properties){activityInfo.Properties={}}else if(activityInfo.Properties instanceof Array){let e;const t=BX.clone(activityInfo.Properties);activityInfo.Properties={};for(e in t){if(t.hasOwnProperty(e)){activityInfo.Properties[e]=t[e]}}}if(!activityInfo.Properties["Title"]){activityInfo.Properties["Title"]=arAllActivities[type.toLowerCase()]["NAME"]}if(!activityInfo.Icon&&arAllActivities[type.toLowerCase()]["ICON"]){activityInfo.Icon=arAllActivities[type.toLowerCase()]["ICON"]}}else if(!BX.Type.isUndefined(window[type])){a=eval("new "+type+"()")}else{a=new UnknownBizProcActivity}a.Init(activityInfo);return a}function JSToPHPHidd(e,t,i){if(typeof BPDesignerUseJson!=="undefined"&&BPDesignerUseJson){e[i]=JSON.stringify(t,(function(e,t){if(typeof t=="boolean"){return t?"1":"0"}return t}));return true}var n,r,o;if(typeof t=="object"){n=[];var a=false;if(t instanceof Array){a=true;for(r in t){if(parseInt(r)!=r){a=false;break}}}if(a){for(r=0;r<t.length;r++)JSToPHPHidd(e,t[r],i+"["+r+"]")}else{for(o in t)JSToPHPHidd(e,t[o],i+"["+o+"]")}return true}if(typeof t=="boolean"){if(t)e[i]="1";else e[i]="0";return true}e[i]=t;return true}function JSToPHP(e,t){if(typeof BPDesignerUseJson!=="undefined"&&BPDesignerUseJson){return t+"="+encodeURIComponent(JSON.stringify(e,(function(e,t){if(typeof t=="boolean"){return t?"1":"0"}return t})))}var i,n,r;if(typeof e=="object"){i=[];var o=false;if(e instanceof Array){o=true;for(n in e){if(parseInt(n)!=n){o=false;break}}}if(o){for(n=0;n<e.length;n++)i.push(JSToPHP(e[n],t+"["+n+"]"))}else{for(r in e)i.push(JSToPHP(e[r],t+"["+r+"]"))}return i.join("&",i)}if(typeof e=="boolean"){if(e)return t+"=1";return t+"=0"}return t+"="+encodeURIComponent(e)}function ActGetRealPos(e){if(!e||!e.offsetParent){return false}return BX.pos(e,true)}function XMLEncode(e){if(!(typeof e=="string"||e instanceof String)){return e}e=e.replace(/&/g,"&amp;");e=e.replace(/"/g,"&quot;");e=e.replace(/'/g,"&apos;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");return e}function HTMLEncode(e){if(!(typeof e=="string"||e instanceof String)){return e}e=e.replace(/&/g,"&amp;");e=e.replace(/"/g,"&quot;");e=e.replace(/</g,"&lt;");e=e.replace(/>/g,"&gt;");return e}function GenUniqId(){return parseInt(Math.random()*1e5)+"_"+parseInt(Math.random()*1e5)+"_"+parseInt(Math.random()*1e5)+"_"+parseInt(Math.random()*1e5)}function FindActivityById(e,t){if(e.Name==t)return e;var i=false;if(e.Children){for(var n=0;n<e.Children.length;n++){i=FindActivityById(e.Children[n],t);if(i)return i}}return i}function _crt(e,t){const i=e||1;const n=t||1;const r=BX.Dom.create("table",{attrs:{width:"100%",cellSpacing:"0",cellPadding:"0",border:"0"}});for(let e=0;e<i;e++){const e=r.insertRow(-1);for(let t=0;t<n;t++){const t=e.insertCell(-1);BX.Dom.attr(t,{align:"center",vAlign:"center"})}}return r}BizProcActivity=function(){const e=this;e.childActivities=[];e.parentActivity=null;e.Name="A"+GenUniqId();e.Type="Activity";e.Properties={Title:""};e.Activated="Y";e.canBeActivated=true;arAllId[e.Name]=true;this.Init=function(e){if(e.Name){if(!arAllId[e.Name]){delete arAllId[this.Name];this.Name=e.Name;arAllId[this.Name]=true}}if(e["Properties"]){this.Properties=BX.Runtime.clone(e["Properties"])}if(e["Icon"]){this.Icon=e["Icon"]}if(e.Type){this.Type=e.Type}this.Activated=e.Activated==="N"?"N":"Y";this.height=0;this.width=0;let t;this.childActivities=[];if(!e.Children&&e.childActivities){e.Children=e.childActivities}const i=this.getCanBeActivatedChild();for(const n in e.Children){if(!e.Children.hasOwnProperty(n)){continue}t=CreateActivity(e.Children[n]);t.parentActivity=this;this.childActivities[this.childActivities.length]=t;if(!i){t.setCanBeActivated(false)}}};e.SerializeToXML=function(){if(e.childActivities){let t='<activity class="'+XMLEncode(e.Type)+'" name="'+XMLEncode(e["Properties"].Title)+'" id="'+XMLEncode(e.Name)+'" params="" >';for(let i=0;i<e.childActivities.length;i++){t=t+e.childActivities[i].SerializeToXML()}return t+"</activity>"}return'<activity class="'+XMLEncode(e.Type)+'" name="'+XMLEncode(e["Properties"].Title)+'" id="'+XMLEncode(e.Name)+'" params="" />'};e.Serialize=function(){const t={Type:e.Type,Name:e.Name,Activated:e.Activated,Properties:e.Properties,Children:[]};if(e.childActivities){for(let i=0;i<e.childActivities.length;i++){t["Children"].push(e.childActivities[i].Serialize())}}return t};e.OnRemoveClick=function(){e.parentActivity.RemoveChild(e)};e.OnSettingsClick=function(){e.Settings()};e.Settings=function(){let t="/bitrix/admin/"+MODULE_ID+"_bizproc_activity_settings.php?mode=public&bxpublic=Y&lang="+BX.message("LANGUAGE_ID")+"&entity="+ENTITY;if(window.document_type_signed){t="/bitrix/tools/bizproc_activity_settings.php?mode=public&bxpublic=Y&lang="+BX.message("LANGUAGE_ID")+"&dts="+window.document_type_signed}const i="id="+encodeURIComponent(e.Name);const n="document_type="+encodeURIComponent(document_type);const r="activity="+encodeURIComponent(e.Type);const o=JSToPHP(arWorkflowParameters,"arWorkflowParameters");const a=JSToPHP(arWorkflowVariables,"arWorkflowVariables");const s=JSToPHP(Array(rootActivity.Serialize()),"arWorkflowTemplate");const c=JSToPHP(arWorkflowConstants,"arWorkflowConstants");const l="current_site_id="+encodeURIComponent(CURRENT_SITE_ID);const d="sessid="+BX.bitrix_sessid();const f="can_be_activated="+(e.canBeActivated?"Y":"N");const p=[i,"decode=Y",n,r,o,a,s,c,l,f,d];new BX.CDialog({content_url:t,content_post:p.join("&"),height:500,width:900}).Show()};e.RemoveResources=function(){if(e.div&&e.div.parentNode){BX.Dom.remove(e.div);e.div=null}};e.RemoveChild=function(t){let i,n;for(i=0;i<e.childActivities.length;i++){if(e.childActivities[i].Name==t.Name){while(t.childActivities.length>0){t.childActivities[0].parentActivity.RemoveChild(t.childActivities[0])}t.childActivities=[];t.RemoveResources();e.childActivities[i].parentActivity=null;delete e.childActivities[i];for(n=i;n<e.childActivities.length-1;n++){e.childActivities[n]=e.childActivities[n+1]}e.childActivities.pop();delete arAllId[t.Name];break}}BPTemplateIsModified=true};e.SetError=function(t,i){if(!e.div){return false}if(t===false){e.div.className="activity activity-modern"}else{e.div.className="activityerr activity-modern"}if(i===true&&t!==false){BX.scrollToNode(e.div)}};e.Draw=function(t){e.div=BX.Dom.create("div",{attrs:{className:(e.isUnknown?"activityerr":"activity")+" activity-modern"},style:{margin:"0 auto",width:e.activityWidth?e.activityWidth:"170px"}});BX.Dom.append(e.div,t);const i=BX.Dom.create("div",{attrs:{className:"activityhead"+(e.Activated==="N"||!e.canBeActivated?" --deactivated":"")},children:[BX.Dom.create("a",{attrs:{className:"ui-icon-set --cross-45 activitydel"},events:{click:this.OnRemoveClick}})]});BX.Dom.append(i,e.div);if(!e.isUnknown){const e=BX.Dom.create("a",{attrs:{className:"ui-icon-set --settings-2 activityset"},events:{click:this.OnSettingsClick}});BX.Dom.append(e,i);if(this.OnHideClick){const e=BX.Dom.create("a",{attrs:{className:"ui-icon-set --line activitymin"},events:{click:this.OnHideClick}});BX.Dom.append(e,i)}}const n=BX.Dom.create("div",{style:{padding:"9px",cursor:e.isUnknown?"not-allowed":"move"}});BX.Dom.append(n,i);if(!e.isUnknown){n.onmousedown=function(t){if(!t){t=window.event}const i=DragNDrop.StartDrag(t,e);i.innerHTML=this.parentNode.parentNode.parentNode.innerHTML;BX.Dom.style(i,"width",this.parentNode.parentNode.offsetWidth+"px")}}const r=BX.Dom.create("div",{style:{backgroundColor:e.isUnknown?"#E6E6E6":"#ffffff",overflowX:"hidden",overflowY:"hidden",height:e.activityHeight?e.activityHeight:"30px","border-bottom-left-radius":"var(--ui-border-radius-xs)","border-bottom-right-radius":"var(--ui-border-radius-xs)"}});r.ondblclick=e.OnSettingsClick;BX.Dom.append(r,e.div);if(e.activityContent){BX.Dom.append(e.activityContent,r)}else{const t=BX.Dom.create("div",{html:HTMLEncode(e["Properties"]["Title"]),attrs:{title:BX.Text.encode(e["Properties"]["Title"])},style:{background:e.Icon?"url("+e.Icon+") left center no-repeat":"url(/bitrix/images/bizproc/act_icon.gif) left center no-repeat",height:"30px",margin:"2px",paddingLeft:"24px",textAlign:"left"}});BX.Dom.append(t,r)}if(e.CheckFields&&e.CheckFields()===false){e.SetError(true)}this.drawEditorComment()};this.SetHeight=function(e){this.height=e};this.drawEditorComment=function(t){if(!t){t=this.div}if(!t||!BX.getClass("BX.UI.Hint")||!e["Properties"]["EditorComment"]||e["Properties"]["EditorComment"].length<=0){return false}const i=BX.Dom.create("span",{props:{className:"activity-comment"},dataset:{hint:BX.Text.encode(e["Properties"]["EditorComment"]).replace(/([^>])\n/g,"$1<br/>")}});i.setAttribute("data-hint-html","y");BX.Dom.append(i,t);BX.UI.Hint.init(this.div)};e.setActivated=function(t){if(["Y","N"].includes(t)){e.Activated=t;e.childActivities.forEach((t=>t.setCanBeActivated(e.getCanBeActivatedChild())))}};e.setCanBeActivated=function(t){if(BX.Type.isBoolean(t)){e.canBeActivated=t;if(e.childActivities.length>0){e.childActivities.forEach((t=>t.setCanBeActivated(e.getCanBeActivatedChild())))}}};e.getCanBeActivatedChild=function(){return e.canBeActivated&&e.Activated==="Y"};e.findChildById=function(t){if(e.childActivities){for(let i=0;i<e.childActivities.length;i++){if(t===e.childActivities[i]["Name"]){return e.childActivities[i]}else{const n=e.childActivities[i].findChildById(t);if(n){return n}}}}return null}};function _DragNDrop(){var e=this;var t,i;var n=true;e.GetDrDr=function(){if(e.drdrop)return;e.drdrop=document.body.appendChild(document.createElement("DIV"));e.drdrop.style.display="none";e.drdrop.style.position="absolute";e.drdrop.style.zIndex="50000";e.drdrop.style.MozOpacity=.6;e.drdrop.style.opacity=.6;e.drdrop.style.filter="gray() alpha(opacity=60)";e.drdrop.style.border="1px solid #CCCCCC";e.drdrop.style.fontSize="12px";e.antiselect=document.body.appendChild(document.createElement("DIV"));e.antiselect.id="antiselect";e.antiselect.style.left="0";e.antiselect.style.top="0";e.antiselect.style.position="absolute";e.antiselect.style.MozUserSelect="none !important";e.antiselect.style.display="none";e.antiselect.style.backgroundColor="#FFFFFF";e.antiselect.style.MozOpacity=.01;e.antiselect.style.zIndex="100000";jsUtils.addEvent(document.body,"mousemove",e.Dragging);jsUtils.addEvent(document.body,"mouseup",e.Drop)};e.obj=null;e.StartDrag=function(t,i){e.obj=i;e.GetDrDr();if(!t)t=window.event;e.antiselect.style.display="block";var n=jsUtils.GetWindowScrollSize();e.antiselect.style.width=n.scrollWidth+"px";e.antiselect.style.height=n.scrollHeight+"px";e.antiselect.style.opacity=.01;e.antiselect.style.filter="gray() alpha(opacity=01)";e.dragging=true;e.drdrop.style.display="block";e.scrollPos=jsUtils.GetWindowScrollPos();e.drdrop.style.top=t.clientY+e.scrollPos.scrollTop+1+"px";e.drdrop.style.left=t.clientX+e.scrollPos.scrollLeft+1+"px";return e.drdrop};e.Handlers={};e.AddHandler=function(t,i){e.Handlers[t]=e.Handlers[t]||[];var n="i"+Math.random();e.Handlers[t][n]=i;return n};e.RemoveHandler=function(t,i){if(e.Handlers[t][i])delete e.Handlers[t][i]};e.Dragging=function(t){if(!e.dragging)return;if(!t)t=window.event;BX.fixEventPageXY(t);var i=t.pageX;var n=t.pageY;e.drdrop.style.left=i+1+"px";e.drdrop.style.top=n+1+"px";var r=BX.GetWindowInnerSize();var o=BX.GetWindowScrollPos();if(r.innerHeight-30<t.clientY)window.scrollBy(0,20);if(r.innerWidth-30<t.clientX)window.scrollBy(20,0);if(o.scrollTop>0&&t.clientY<30)window.scrollBy(0,-20);if(o.scrollLeft>0&&t.clientX<30)window.scrollBy(-20,0);if(document.selection&&document.selection.empty)document.selection.empty();else window.getSelection().removeAllRanges();for(var a in e.Handlers["ondragging"]){if(!e.Handlers["ondragging"].hasOwnProperty(a))continue;if(e.Handlers["ondragging"][a])e.Handlers["ondragging"][a](t,i,n)}};e._UnS=function(){if(e.antiselect)e.antiselect.style.display="none"};e.Drop=function(t){if(!e.dragging)return;if(!t)t=window.event;var i=jsUtils.GetWindowScrollPos();var n=t.clientX+i.scrollLeft+1+"px";var r=t.clientY+i.scrollTop+1+"px";for(var o in e.Handlers["ondrop"]){if(!e.Handlers["ondrop"].hasOwnProperty(o))continue;if(e.Handlers["ondrop"][o])e.Handlers["ondrop"][o](n,r,t)}e.dragging=false;e.drdrop.style.display="none";setTimeout(e._UnS,0)}}UnknownBizProcActivity=function(){var e=new BizProcActivity;e.isUnknown=true;return e};BX.namespace("BX.Bizproc");BX.Bizproc.cloneTypeControl=function(e){var t=document.getElementById(e);var i=t.rows.length;var n=t.insertRow(i);var r=n.insertCell(0);var o=t.rows[i-1].cells[0].innerHTML;var a=0,s,c,l;while(true){s=o.indexOf("[n",a);if(s<0)break;c=o.indexOf("]",s);if(c<0)break;l=parseInt(o.substr(s+2,c-s));o=o.substr(0,s)+"[n"+ ++l+"]"+o.substr(c+1);a=s+1}a=0;while(true){s=o.indexOf("__n",a);if(s<0)break;c=o.indexOf("_",s+2);if(c<0)break;l=parseInt(o.substr(s+3,c-s));o=o.substr(0,s)+"__n"+ ++l+"_"+o.substr(c+1);a=c+1}r.innerHTML=o;var d=new RegExp("<"+"script"+">[^\0]*?<"+"/"+"script"+">","ig");var f=o.match(d);if(f){for(var p=0;p<f.length;p++){if(f[p]!=""){s=f[p].substring(8,f[p].length-9);jsUtils.EvalGlobal(s)}}}};BX.Bizproc.cloneTypeControlHtml=function(e,t){var i=document.getElementById(e);var n=i.rows.length;var r=i.insertRow(n);var o=r.insertCell(0);var a=i.rows[n-1].cells[0].innerHTML;var s=0,c,l,d=0;c=a.indexOf("[n",s);if(c>-1){l=a.indexOf("]",c);if(l>-1){d=parseInt(a.substr(c+2,l-c));++d}}BX.ajax({method:"GET",dataType:"html",url:"/bitrix/tools/bizproc_get_html_editor.php?site_id="+BX.message("SITE_ID")+"&editor_id="+t+"__n"+d+"_&field_name="+t+"[n"+d+"]",onsuccess:function(e){o.innerHTML=e}})};var DragNDrop=new _DragNDrop}
//# sourceMappingURL=bizproc.map.js