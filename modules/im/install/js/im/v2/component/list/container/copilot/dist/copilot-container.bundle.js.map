{"version":3,"file":"copilot-container.bundle.js","sources":["../src/components/role-selector-mini/components/role-item.js","../src/components/role-selector-mini/components/role-selector-mini-content.js","../src/components/role-selector-mini/role-selector-mini.js","../src/copilot-container.js"],"sourcesContent":["import '../css/role-item.css';\n\nimport type { ImModelCopilotRole } from 'im.v2.model';\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const RoleItem = {\n\tname: 'RoleItem',\n\tprops:\n\t{\n\t\trole: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\timageLoadError: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\troleItem(): ImModelCopilotRole\n\t\t{\n\t\t\treturn this.role;\n\t\t},\n\t\troleAvatar(): string\n\t\t{\n\t\t\treturn this.roleItem.avatar.medium;\n\t\t},\n\t\troleName(): string\n\t\t{\n\t\t\treturn this.roleItem.name;\n\t\t},\n\t\troleSDescription(): string\n\t\t{\n\t\t\treturn this.roleItem.desc;\n\t\t},\n\t\tdefaultRole(): ImModelCopilotRole\n\t\t{\n\t\t\treturn this.$store.getters['copilot/roles/getDefault'];\n\t\t},\n\t\tdefaultRoleAvatarUrl(): string\n\t\t{\n\t\t\treturn this.defaultRole.avatar.medium;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonImageLoadError()\n\t\t{\n\t\t\tthis.imageLoadError = true;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-role-item__container\">\n\t\t\t<div class=\"bx-im-role-item__avatar\">\n\t\t\t\t<img v-if=\"!imageLoadError\" :src=\"roleAvatar\" :alt=\"roleName\" @error=\"onImageLoadError\">\n\t\t\t\t<img v-else :src=\"defaultRoleAvatarUrl\" :alt=\"roleName\">\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-role-item__info\">\n\t\t\t\t<div class=\"bx-im-role-item__name\" :title=\"roleName\">{{ roleName }}</div>\n\t\t\t\t<div class=\"bx-im-role-item__description\" :title=\"roleSDescription\">{{ roleSDescription }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { RoleItem } from './role-item';\n\nimport '../css/role-selector-mini-content.css';\n\nimport type { ImModelCopilotRole } from 'im.v2.model';\n\n// @vue/component\nexport const RoleSelectorMiniContent = {\n\tname: 'RoleSelectorMiniContent',\n\tcomponents: { RoleItem },\n\temits: ['selectedRole', 'openMainSelector'],\n\tcomputed:\n\t{\n\t\trolesToShow(): ImModelCopilotRole[]\n\t\t{\n\t\t\treturn this.$store.getters['copilot/getRecommendedRoles']();\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\topenMainSelector()\n\t\t{\n\t\t\tthis.$emit('openMainSelector');\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t\tonRoleClick(role)\n\t\t{\n\t\t\tthis.$emit('selectedRole', role.code);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-role-selector-mini-content__container\">\n\t\t\t<span class=\"bx-im-role-selector-mini-content__title\">\n\t\t\t\t{{ loc('IM_LIST_CONTAINER_COPILOT_ROLES_LIST') }}\n\t\t\t</span>\n\t\t\t<div class=\"bx-im-role-selector-mini-content__items\">\n\t\t\t\t<RoleItem \n\t\t\t\t\tv-for=\"role in rolesToShow\" \n\t\t\t\t\t:role=\"role\"\n\t\t\t\t\t@click=\"onRoleClick(role)\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"bx-im-role-selector-mini-content__main-selector\" @click=\"openMainSelector\">\n\t\t\t\t\t<div class=\"bx-im-role-selector-mini-content__main-selector-info\">\n\t\t\t\t\t\t<div class=\"bx-im-role-selector-mini-content__main-selector-avatar\"></div>\n\t\t\t\t\t\t<div class=\"bx-im-role-selector-mini-content__main-selector-name\">\n\t\t\t\t\t\t\t{{ loc('IM_LIST_CONTAINER_COPILOT_SELECT_ROLE_FROM_LIST') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-role-selector-mini-content__main-selector-arrow\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { MessengerPopup } from 'im.v2.component.elements';\n\nimport { RoleSelectorMiniContent } from './components/role-selector-mini-content';\n\nimport type { PopupOptions } from 'main.popup';\n\nconst POPUP_ID = 'im-role-selector-mini-popup';\n\n// @vue/component\nexport const RoleSelectorMini = {\n\tname: 'RoleSelectorMini',\n\tcomponents: { MessengerPopup, RoleSelectorMiniContent },\n\tprops:\n\t{\n\t\tbindElement: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['close', 'selectedRole', 'openMainSelector'],\n\tcomputed:\n\t{\n\t\tPOPUP_ID: () => POPUP_ID,\n\t\tconfig(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\twidth: 294,\n\t\t\t\tcloseIcon: false,\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tpadding: 0,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tcontentBackground: '#fff',\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<MessengerPopup\n\t\t\tv-slot=\"{enableAutoHide, disableAutoHide}\"\n\t\t\t:config=\"config\"\n\t\t\t@close=\"$emit('close')\"\n\t\t\t:id=\"POPUP_ID\"\n\t\t>\n\t\t\t<RoleSelectorMiniContent\n\t\t\t\t@selectedRole=\"$emit('selectedRole', $event)\"\n\t\t\t\t@openMainSelector=\"$emit('openMainSelector')\"\n\t\t\t\t@close=\"$emit('close')\"\n\t\t\t/>\n\t\t</MessengerPopup>\n\t`,\n};\n","import { Messenger } from 'im.public';\nimport { CopilotRolesDialog } from 'im.v2.component.elements';\nimport { CopilotList } from 'im.v2.component.list.items.copilot';\nimport { ChatType, Layout } from 'im.v2.const';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { Logger } from 'im.v2.lib.logger';\nimport { CopilotService } from 'im.v2.provider.service';\n\nimport { RoleSelectorMini } from './components/role-selector-mini/role-selector-mini';\n\nimport './css/copilot-container.css';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const CopilotListContainer = {\n\tname: 'CopilotListContainer',\n\tcomponents: { CopilotList, RoleSelectorMini, CopilotRolesDialog },\n\temits: ['selectEntity'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowRoleSelector: false,\n\t\t\tshowRolesDialog: false,\n\t\t\tisCreatingChat: false,\n\t\t};\n\t},\n\tcreated()\n\t{\n\t\tLogger.warn('List: Copilot container created');\n\t},\n\tdeactivated()\n\t{\n\t\tthis.showRolesDialog = false;\n\t\tthis.showRoleSelector = false;\n\t},\n\tmethods:\n\t{\n\t\tasync onCreateChatClick()\n\t\t{\n\t\t\tAnalytics.getInstance().onStartCreateNewChat(ChatType.copilot);\n\t\t\tthis.showRoleSelector = true;\n\t\t},\n\t\tonChatClick(dialogId)\n\t\t{\n\t\t\tthis.$emit('selectEntity', { layoutName: Layout.copilot.name, entityId: dialogId });\n\t\t},\n\t\tshowCreateChatError()\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: this.loc('IM_LIST_CONTAINER_COPILOT_CREATE_CHAT_ERROR'),\n\t\t\t});\n\t\t},\n\t\tgetCopilotService(): CopilotService\n\t\t{\n\t\t\tif (!this.copilotService)\n\t\t\t{\n\t\t\t\tthis.copilotService = new CopilotService();\n\t\t\t}\n\n\t\t\treturn this.copilotService;\n\t\t},\n\t\tasync createChat(roleCode: string)\n\t\t{\n\t\t\tthis.showRoleSelector = false;\n\t\t\tthis.showRolesDialog = false;\n\t\t\tthis.isCreatingChat = true;\n\n\t\t\tconst newDialogId = await this.getCopilotService().createChat({ roleCode })\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.isCreatingChat = false;\n\t\t\t\t\tthis.showCreateChatError();\n\t\t\t\t});\n\n\t\t\tthis.isCreatingChat = false;\n\t\t\tvoid Messenger.openCopilot(newDialogId);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t\tonCopilotDialogSelectRole(role)\n\t\t{\n\t\t\tvoid this.createChat(role.code);\n\t\t},\n\t\tonOpenMainSelector()\n\t\t{\n\t\t\tthis.showRoleSelector = false;\n\t\t\tthis.showRolesDialog = true;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-list-container-copilot__scope bx-im-list-container-copilot__container\">\n\t\t\t<div class=\"bx-im-list-container-copilot__header_container\">\n\t\t\t\t<div class=\"bx-im-list-container-copilot__header_title\">CoPilot</div>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"bx-im-list-container-copilot__create-chat\"\n\t\t\t\t\t:class=\"{'--loading': isCreatingChat}\"\n\t\t\t\t\tref=\"createChatButton\"\n\t\t\t\t\t@click=\"onCreateChatClick\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bx-im-list-container-copilot__create-chat_icon\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-list-container-copilot__elements_container\">\n\t\t\t\t<div class=\"bx-im-list-container-copilot__elements\">\n\t\t\t\t\t<CopilotList @chatClick=\"onChatClick\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<RoleSelectorMini\n\t\t\t\tv-if=\"showRoleSelector\"\n\t\t\t\t:bindElement=\"$refs.createChatButton\"\n\t\t\t\t@close=\"showRoleSelector = false\"\n\t\t\t\t@selectedRole=\"createChat\"\n\t\t\t\t@openMainSelector=\"onOpenMainSelector\"\n\t\t\t/>\n\t\t\t<CopilotRolesDialog\n\t\t\t\tv-if=\"showRolesDialog\"\n\t\t\t\t@selectRole=\"onCopilotDialogSelectRole\"\n\t\t\t\t@close=\"showRolesDialog = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n"],"names":["RoleItem","name","props","role","type","Object","required","data","imageLoadError","computed","roleItem","roleAvatar","avatar","medium","roleName","roleSDescription","desc","defaultRole","$store","getters","defaultRoleAvatarUrl","methods","onImageLoadError","template","RoleSelectorMiniContent","components","emits","rolesToShow","openMainSelector","$emit","loc","phraseCode","$Bitrix","Loc","getMessage","onRoleClick","code","POPUP_ID","RoleSelectorMini","MessengerPopup","bindElement","config","width","closeIcon","offsetTop","offsetLeft","padding","contentPadding","contentBackground","CopilotListContainer","CopilotList","CopilotRolesDialog","showRoleSelector","showRolesDialog","isCreatingChat","created","Logger","warn","deactivated","onCreateChatClick","Analytics","getInstance","onStartCreateNewChat","ChatType","copilot","onChatClick","dialogId","layoutName","Layout","entityId","showCreateChatError","BX","UI","Notification","Center","notify","content","getCopilotService","copilotService","CopilotService","createChat","roleCode","newDialogId","catch","Messenger","openCopilot","onCopilotDialogSelectRole","onOpenMainSelector"],"mappings":"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"}