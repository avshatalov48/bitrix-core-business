this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,i,o,r,a,n,l,c,p){"use strict";const d="icon.png";const b="internal.png";const v="http://127.0.0.1:20141";const u=500;const h="bx-im-messenger__out-of-view";const k="//www.bitrixsoft.com/200.ok";const g={};const f={testImageLoad(e,s,t=d){const i=Date.now();let o=false;const r=a.Dom.create({tag:"img",attrs:{src:`${v}/${t}?${i}`,"data-id":i},props:{className:h},events:{error(){if(o){return}const e=this.dataset.id;s(false,e);clearTimeout(g[e]);a.Dom.remove(this)},load(){const s=this.dataset.id;e(true,s);clearTimeout(g[s]);a.Dom.remove(this)}}});document.body.append(r);g[i]=setTimeout((()=>{o=true;s(false,i);a.Dom.remove(r)}),u)},testInternetConnection(){const e=Date.now();return new Promise((s=>{fetch(`${k}.${e}`).then((e=>{if(e.status===200){s(true);return}s(false)})).catch((()=>{s(false)}))}))},IMAGE_DESKTOP_RUN:d,IMAGE_DESKTOP_TWO_WINDOW_MODE:b};let L=[];let P=0;const B={openConference(e){if(!n.Utils.conference.isValidCode(e)){return false}if(!c.DesktopApi.isDesktop()){return false}let s=null;const t=[{width:2560,height:1440},{width:2048,height:1152},{width:1920,height:1080},{width:1600,height:900},{width:1366,height:768},{width:1024,height:576}];for(const e of t){s=e;if(screen.width>e.width&&screen.height>e.height){break}}L=L.filter((e=>Boolean(c.DesktopApi.findWindow(e))));L.push(n.Utils.conference.getWindowNameByCode(e));c.DesktopApi.createWindow(n.Utils.conference.getWindowNameByCode(e),(t=>{t.SetProperty("title",a.Loc.getMessage("IM_LIB_DESKTOP_CONFERENCE_TITLE"));t.SetProperty("clientSize",{Width:s.width,Height:s.height});t.ExecuteCommand("center");t.SetProperty("minClientSize",{Width:940,Height:400});t.SetProperty("backgroundColor","#2B3038");t.ExecuteCommand("html.load",`<script>location.href="/desktop_app/router.php?alias=${e}&videoconf";<\/script>`);t.ExecuteCommand("show");t.ExecuteCommand("center")}));return true},toggleConference(){if(P>L.length-1){P=0;c.DesktopApi.showWindow();return true}L=L.filter((e=>Boolean(c.DesktopApi.findWindow(e))));for(let e=P;e<L.length;e++){P++;const s=c.DesktopApi.findWindow(L[e]);if(s){c.DesktopApi.activateWindow(s);break}}return true}};const y=60*60*1e3;var D=babelHelpers.classPrivateFieldLooseKey("initDate");var F=babelHelpers.classPrivateFieldLooseKey("sidePanelManager");var m=babelHelpers.classPrivateFieldLooseKey("startReloadCheck");var C=babelHelpers.classPrivateFieldLooseKey("isReloadNeeded");var H=babelHelpers.classPrivateFieldLooseKey("reloadWindow");class w{static init(){return new w}constructor(){Object.defineProperty(this,H,{value:E});Object.defineProperty(this,C,{value:x});Object.defineProperty(this,m,{value:T});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:BX.SidePanel.Instance});babelHelpers.classPrivateFieldLooseBase(this,D)[D]=new Date;babelHelpers.classPrivateFieldLooseBase(this,m)[m]()}}function T(){setInterval((async()=>{const e=await babelHelpers.classPrivateFieldLooseBase(this,C)[C]();if(e){babelHelpers.classPrivateFieldLooseBase(this,H)[H]()}}),y)}async function x(){if(n.Utils.date.isSameDay(new Date,babelHelpers.classPrivateFieldLooseBase(this,D)[D])){return false}if(babelHelpers.classPrivateFieldLooseBase(this,F)[F].opened){p.Logger.desktop("Checker: checkDayForReload, slider is open - delay reload");return false}if(i.CallManager.getInstance().hasCurrentCall()){p.Logger.desktop("Checker: checkDayForReload, call is active - delay reload");return false}return f.testInternetConnection()}function E(){p.Logger.desktop("Checker: checkDayForReload, new day - reload window");c.DesktopApi.reloadWindow()}const O="!!";const A={encodeParams(e){if(!a.Type.isPlainObject(e)){return""}let s="";Object.entries(e).forEach((([e,t])=>{const i="";s+=`${i}${e}${O}${t}`}));return s},decodeParams(e){const s={};if(!a.Type.isStringFilled(e)){return s}const t=e.split(O);for(let e=0;e<t.length;e+=2){const i=t[e];const o=t[e+1];s[i]=o}return s},encodeParamsJson(e){if(!a.Type.isPlainObject(e)){return"{}"}let s="";try{s=encodeURIComponent(JSON.stringify(e))}catch(e){console.error("DesktopUtils: could not encode params.",e);s="{}"}return s},decodeParamsJson(e){let s={};if(!a.Type.isStringFilled(e)){return s}try{s=JSON.parse(decodeURIComponent(e))}catch(e){console.error("DesktopUtils: could not decode encoded params.",e)}return s}};var I=babelHelpers.classPrivateFieldLooseKey("subscribeToBxProtocolEvent");var S=babelHelpers.classPrivateFieldLooseKey("subscribeToLegacyBxProtocolEvent");class M{static init(){return new M}constructor(){Object.defineProperty(this,S,{value:j});Object.defineProperty(this,I,{value:K});babelHelpers.classPrivateFieldLooseBase(this,I)[I]();babelHelpers.classPrivateFieldLooseBase(this,S)[S]()}}function K(){c.DesktopApi.subscribe(l.EventType.desktop.onBxLink,((e,t)=>{const i=t!=null?t:{};Object.entries(i).forEach((([e,s])=>{i[e]=decodeURIComponent(s)}));c.DesktopApi.activateWindow();if(e===l.DesktopBxLink.chat){var o;const e=(o=i.messageId)!=null?o:0;void s.Messenger.openChat(i.dialogId,e)}else if(e===l.DesktopBxLink.lines){void s.Messenger.openLines(i.dialogId)}else if(e===l.DesktopBxLink.conference){void Ze.getInstance().openConference(i.code)}else if(e===l.DesktopBxLink.call){const e=i.withVideo!=="N";void s.Messenger.startVideoCall(i.dialogId,e)}else if(e===l.DesktopBxLink.phone){const e=A.decodeParamsJson(i.phoneParams);void s.Messenger.startPhoneCall(i.number,e)}else if(e===l.DesktopBxLink.callList){const e=A.decodeParamsJson(i.callListParams);void s.Messenger.startCallList(i.callListId,e)}else if(e===l.DesktopBxLink.notifications){void s.Messenger.openNotifications()}else if(e===l.DesktopBxLink.recentSearch){void s.Messenger.openRecentSearch()}else if(e===l.DesktopBxLink.copilot){void s.Messenger.openCopilot(i.dialogId)}else if(e===l.DesktopBxLink.settings){void s.Messenger.openSettings({onlyPanel:i.section})}else if(e===l.DesktopBxLink.timeManager){var r,a;(r=BX.Timeman)==null?void 0:(a=r.Monitor)==null?void 0:a.openReport()}else if(e===l.DesktopBxLink.openTab){c.DesktopApi.setActiveTab()}else if(e===l.DesktopBxLink.openPage){const e=A.decodeParamsJson(i.options);c.DesktopApi.openPage(e.url,e.options)}}))}function j(){c.DesktopApi.subscribe(l.EventType.desktop.onBxLink,((e,t)=>{const i=t!=null?t:{};Object.entries(i).forEach((([e,s])=>{i[e]=decodeURIComponent(s)}));c.DesktopApi.activateWindow();if(e===l.LegacyDesktopBxLink.messenger){if(i.dialog){void s.Messenger.openChat(i.dialog)}else if(i.chat){void s.Messenger.openChat(`chat${i.chat}`)}else{void s.Messenger.openChat()}}else if(e===l.LegacyDesktopBxLink.chat&&i.id){void s.Messenger.openChat(`chat${i.id}`)}else if(e===l.LegacyDesktopBxLink.notify){void s.Messenger.openNotifications()}else if(e===l.LegacyDesktopBxLink.callTo){if(i.video){void s.Messenger.startVideoCall(i.video)}else if(i.audio){void s.Messenger.startVideoCall(i.audio,false)}else if(i.phone){void s.Messenger.startPhoneCall(i.phone)}}else if(e===l.LegacyDesktopBxLink.callList){void s.Messenger.openRecentSearch()}}))}var $=babelHelpers.classPrivateFieldLooseKey("subscribeToLogoutEvent");var W=babelHelpers.classPrivateFieldLooseKey("onExit");class U{static init(){return new U}constructor(){Object.defineProperty(this,W,{value:N});Object.defineProperty(this,$,{value:R});babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}}function R(){c.DesktopApi.subscribe(l.EventType.desktop.onExit,babelHelpers.classPrivateFieldLooseBase(this,W)[W].bind(this))}function N(){t.runAction(l.RestMethod.imV2DesktopLogout).finally((()=>{c.DesktopApi.shutdown()}))}var X=babelHelpers.classPrivateFieldLooseKey("initDate");var _=babelHelpers.classPrivateFieldLooseKey("wakeUpTimer");var V=babelHelpers.classPrivateFieldLooseKey("subscribeToWakeUpEvent");var J=babelHelpers.classPrivateFieldLooseKey("onWakeUp");var G=babelHelpers.classPrivateFieldLooseKey("subscribeToIconClickEvent");var z=babelHelpers.classPrivateFieldLooseKey("onIconClick");var q=babelHelpers.classPrivateFieldLooseKey("subscribeToAwayEvent");var Y=babelHelpers.classPrivateFieldLooseKey("onUserAway");var Q=babelHelpers.classPrivateFieldLooseKey("subscribeToFocusEvent");var Z=babelHelpers.classPrivateFieldLooseKey("subscribeToBlurEvent");var ee=babelHelpers.classPrivateFieldLooseKey("removeNativeNotifications");var se=babelHelpers.classPrivateFieldLooseKey("setInitialStatus");var te=babelHelpers.classPrivateFieldLooseKey("subscribeToStatusChange");class ie{static init(){return new ie}constructor(){Object.defineProperty(this,te,{value:ue});Object.defineProperty(this,se,{value:ve});Object.defineProperty(this,ee,{value:be});Object.defineProperty(this,Z,{value:de});Object.defineProperty(this,Q,{value:pe});Object.defineProperty(this,Y,{value:ce});Object.defineProperty(this,q,{value:le});Object.defineProperty(this,z,{value:ne});Object.defineProperty(this,G,{value:ae});Object.defineProperty(this,J,{value:re});Object.defineProperty(this,V,{value:oe});Object.defineProperty(this,X,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:null});this.sidePanelManager=BX.SidePanel.Instance;babelHelpers.classPrivateFieldLooseBase(this,X)[X]=new Date;babelHelpers.classPrivateFieldLooseBase(this,V)[V]();babelHelpers.classPrivateFieldLooseBase(this,q)[q]();babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]();babelHelpers.classPrivateFieldLooseBase(this,G)[G]();babelHelpers.classPrivateFieldLooseBase(this,se)[se]();babelHelpers.classPrivateFieldLooseBase(this,te)[te]()}}function oe(){c.DesktopApi.subscribe(l.EventType.desktop.onWakeUp,babelHelpers.classPrivateFieldLooseBase(this,J)[J].bind(this))}async function re(){const e=await f.testInternetConnection();if(!e){p.Logger.desktop("StatusHandler: onWakeUp event, no internet connection, delay 60 sec");clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,_)[_]);babelHelpers.classPrivateFieldLooseBase(this,_)[_]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,J)[J].bind(this),60*1e3);return}if(n.Utils.date.isSameHour(new Date,babelHelpers.classPrivateFieldLooseBase(this,X)[X])){p.Logger.desktop("StatusHandler: onWakeUp event, same hour - restart pull client");o.Core.getPullClient().restart()}else{if(this.sidePanelManager.opened){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,_)[_]);babelHelpers.classPrivateFieldLooseBase(this,_)[_]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,J)[J].bind(this),60*1e3);p.Logger.desktop("StatusHandler: onWakeUp event, slider is open, delay 60 sec");return}if(i.CallManager.getInstance().hasCurrentCall()){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,_)[_]);babelHelpers.classPrivateFieldLooseBase(this,_)[_]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,J)[J].bind(this),60*1e3);p.Logger.desktop("StatusHandler: onWakeUp event, call is active, delay 60 sec");return}p.Logger.desktop("StatusHandler: onWakeUp event, reload window");c.DesktopApi.reloadWindow()}}function ae(){c.DesktopApi.subscribe(l.EventType.desktop.onIconClick,babelHelpers.classPrivateFieldLooseBase(this,z)[z].bind(this))}function ne(){Ze.getInstance().toggleConference()}function le(){c.DesktopApi.subscribe(l.EventType.desktop.onUserAway,babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].bind(this))}function ce(e){const s=e?l.RestMethod.imUserStatusIdleStart:l.RestMethod.imUserStatusIdleEnd;o.Core.getRestClient().callMethod(s).catch((e=>{console.error(`Desktop: error in ${s}  - ${e}`)}))}function pe(){a.Event.bind(window,"focus",babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].bind(this))}function de(){a.Event.bind(window,"blur",babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].bind(this))}function be(){if(!a.Browser.isWin()||!c.DesktopApi.isChatWindow()){return}c.DesktopApi.removeNativeNotifications()}function ve(){const e=o.Core.getStore().getters["application/settings/get"](l.Settings.user.status);c.DesktopApi.setIconStatus(e)}function ue(){const e=(e,s)=>s["application/settings/get"](l.Settings.user.status);o.Core.getStore().watch(e,(e=>{c.DesktopApi.setIconStatus(e)}))}var he=babelHelpers.classPrivateFieldLooseKey("store");var ke=babelHelpers.classPrivateFieldLooseKey("subscribeToCountersChange");var ge=babelHelpers.classPrivateFieldLooseKey("onCounterChange");class fe{static init(){return new fe}constructor(){Object.defineProperty(this,ge,{value:Pe});Object.defineProperty(this,ke,{value:Le});Object.defineProperty(this,he,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,he)[he]=o.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]();babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]()}}function Le(){r.EventEmitter.subscribe(l.EventType.counter.onNotificationCounterChange,babelHelpers.classPrivateFieldLooseBase(this,ge)[ge].bind(this));r.EventEmitter.subscribe(l.EventType.counter.onChatCounterChange,babelHelpers.classPrivateFieldLooseBase(this,ge)[ge].bind(this))}function Pe(){const e=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getters["counters/getTotalChatCounter"];const s=babelHelpers.classPrivateFieldLooseBase(this,he)[he].getters["notifications/getCounter"];const t=e>0;c.DesktopApi.setCounter(e+s,t)}var Be=babelHelpers.classPrivateFieldLooseKey("bindHotkeys");class ye{static init(){return new ye}constructor(){Object.defineProperty(this,Be,{value:De});babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]()}}function De(){a.Event.bind(window,"keydown",(e=>{const s=n.Utils.key.isCombination(e,"Ctrl+R");if(s){c.DesktopApi.reloadWindow();p.Logger.desktop("NOTICE: User reload window (hotkey)");return}const t=n.Utils.key.isCombination(e,"Ctrl+Shift+L");if(t){c.DesktopApi.openLogsFolder();p.Logger.desktop("NOTICE: User open log folder (hotkey)");return}const i=n.Utils.key.isCombination(e,"Ctrl+Shift+D");if(i){c.DesktopApi.openDeveloperTools();p.Logger.desktop("NOTICE: User open developer tools (hotkey)")}}))}var Fe=babelHelpers.classPrivateFieldLooseKey("subscribeToNewTabEvent");var me=babelHelpers.classPrivateFieldLooseKey("onNewTabClick");class Ce{static init(){return new Ce}constructor(){Object.defineProperty(this,me,{value:we});Object.defineProperty(this,Fe,{value:He});babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]()}}function He(){c.DesktopApi.subscribe(l.EventType.desktop.onNewTabClick,babelHelpers.classPrivateFieldLooseBase(this,me)[me].bind(this))}function we(){c.DesktopApi.createTab("/desktop/menu/")}var Te=babelHelpers.classPrivateFieldLooseKey("sendInitEvent");var xe=babelHelpers.classPrivateFieldLooseKey("initSliderBindings");var Ee=babelHelpers.classPrivateFieldLooseKey("getSliderBindingsStatus");var Oe=babelHelpers.classPrivateFieldLooseKey("initComplete");var Ae=babelHelpers.classPrivateFieldLooseKey("subscribeOnErrorEvent");var Ie=babelHelpers.classPrivateFieldLooseKey("handleInvalidAuthError");class Se{static init(){return new Se}constructor(){Object.defineProperty(this,Ie,{value:Ue});Object.defineProperty(this,Ae,{value:We});Object.defineProperty(this,Oe,{value:$e});Object.defineProperty(this,Ee,{value:je});Object.defineProperty(this,xe,{value:Ke});Object.defineProperty(this,Te,{value:Me});w.init();ie.init();U.init();M.init();fe.init();ye.init();Ce.init();babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]();babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]();babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]();babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]()}}function Me(){const{currentUser:e}=o.Core.getApplicationData();c.DesktopApi.emit(l.EventType.desktop.onInit,[{userInfo:e!=null?e:{}}])}function Ke(){const e=babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]();if(e){BX.SidePanel.Instance.enableAnchorBinding();return}BX.SidePanel.Instance.disableAnchorBinding()}function je(){const e=c.DesktopApi.getCustomSetting(c.DesktopSettingsKey.sliderBindingsStatus,"1");return e==="1"}function $e(){c.DesktopApi.setLogInfo=function(...e){p.Logger.desktop(...e)};window.BX.debugEnable(true);c.DesktopApi.printWelcomePrompt()}function We(){r.EventEmitter.subscribe(l.EventType.request.onAuthError,(()=>babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]()))}function Ue(){return c.DesktopApi.login()}var Re=babelHelpers.classPrivateFieldLooseKey("initComplete");class Ne{static init(){return new Ne}constructor(){Object.defineProperty(this,Re,{value:Xe});Ce.init();babelHelpers.classPrivateFieldLooseBase(this,Re)[Re]()}}function Xe(){c.DesktopApi.setLogInfo=function(...e){p.Logger.desktop(...e)}}const _e=2;const Ve=1e3;var Je=babelHelpers.classPrivateFieldLooseKey("desktopIsActive");var Ge=babelHelpers.classPrivateFieldLooseKey("desktopActiveVersion");var ze=babelHelpers.classPrivateFieldLooseKey("locationChangedToBx");var qe=babelHelpers.classPrivateFieldLooseKey("enableRedirectCounter");var Ye=babelHelpers.classPrivateFieldLooseKey("prepareBxUrl");var Qe=babelHelpers.classPrivateFieldLooseKey("initDesktopStatus");class Ze{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){Ze.getInstance()}static isDesktop(){return c.DesktopApi.isDesktop()}static isChatWindow(){return c.DesktopApi.isChatWindow()}constructor(){Object.defineProperty(this,Qe,{value:ss});Object.defineProperty(this,Ye,{value:es});Object.defineProperty(this,Je,{writable:true,value:void 0});Object.defineProperty(this,Ge,{writable:true,value:void 0});Object.defineProperty(this,ze,{writable:true,value:false});Object.defineProperty(this,qe,{writable:true,value:1});babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]();if(Ze.isDesktop()){if(c.DesktopApi.isChatWindow()){Se.init()}else{Ne.init()}}}isDesktopActive(){if(Ze.isDesktop()){return true}return babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]}setDesktopActive(e){babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=e}setDesktopVersion(e){babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=e}getDesktopVersion(){return babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]}isLocationChangedToBx(){return babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]}redirectToChat(e="",s=0){p.Logger.warn("Desktop: redirectToChat",e);let t=`bx://${l.DesktopBxLink.chat}/dialogId/${e}`;if(s>0){t+=`/messageId/${s}`}this.openBxLink(t);return Promise.resolve()}redirectToLines(e=""){p.Logger.warn("Desktop: redirectToLines",e);this.openBxLink(`bx://${l.DesktopBxLink.lines}/dialogId/${e}`);return Promise.resolve()}redirectToCopilot(e=""){p.Logger.warn("Desktop: redirectToCopilot",e);this.openBxLink(`bx://${l.DesktopBxLink.copilot}/dialogId/${e}`);return Promise.resolve()}redirectToNotifications(){p.Logger.warn("Desktop: redirectToNotifications");this.openBxLink(`bx://${l.DesktopBxLink.notifications}`);return Promise.resolve()}redirectToRecentSearch(){p.Logger.warn("Desktop: redirectToRecentSearch");this.openBxLink(`bx://${l.DesktopBxLink.recentSearch}`);return Promise.resolve()}redirectToConference(e){p.Logger.warn("Desktop: redirectToConference",e);this.openBxLink(`bx://${l.DesktopBxLink.conference}/code/${e}`);return Promise.resolve()}redirectToSettings(e){p.Logger.warn("Desktop: redirectToSettings",e);this.openBxLink(`bx://${l.DesktopBxLink.settings}/section/${e}`);return Promise.resolve()}openConference(e){p.Logger.warn("Desktop: openConference",e);const s=B.openConference(e);if(!s){return Promise.resolve(false)}return Promise.resolve(true)}toggleConference(){p.Logger.warn("Desktop: toggleConference");B.toggleConference()}redirectToVideoCall(e="",s=true){p.Logger.warn("Desktop: redirectToVideoCall",e,s);const t=s?"Y":"N";this.openBxLink(`bx://${l.DesktopBxLink.call}/dialogId/${e}/withVideo/${t}`);return Promise.resolve()}redirectToPhoneCall(e,s){p.Logger.warn("Desktop: redirectToPhoneCall",e,s);const t=A.encodeParamsJson(s);this.openBxLink(`bx://${l.DesktopBxLink.phone}/number/${e}/phoneParams/${t}`);return Promise.resolve()}redirectToCallList(e,s){p.Logger.warn("Desktop: redirectToCallList",e,s);const t=A.encodeParamsJson(s);this.openBxLink(`bx://${l.DesktopBxLink.callList}/callListId/${e}/callListParams/${t}`);return Promise.resolve()}openAccountTab(e){this.openBxLink(`bx://v2/${e}/${l.DesktopBxLink.openTab}`)}openPage(e,s={}){const t=A.encodeParamsJson({url:e,options:s});this.openBxLink(`bx://${l.DesktopBxLink.openPage}/options/${t}`)}checkStatusInDifferentContext(){if(!this.isDesktopActive()){return Promise.resolve(false)}if(c.DesktopApi.isChatWindow()){return Promise.resolve(false)}return new Promise((e=>{f.testImageLoad((()=>{e(true)}),(()=>{e(false)}))}))}checkForRedirect(){if(!this.isRedirectEnabled()||!this.isRedirectOptionEnabled()){return Promise.resolve(false)}return this.checkStatusInDifferentContext()}checkForOpenBrowserPage(){if(!this.isDesktopActive()||!this.isRedirectOptionEnabled()){return Promise.resolve(false)}const e=this.getDesktopVersion();if(!c.DesktopApi.isFeatureSupportedInVersion(e,c.DesktopFeature.openPage.id)){return Promise.resolve(false)}return new Promise((e=>{f.testImageLoad((()=>{f.testImageLoad((()=>{e(true)}),(()=>{e(false)}),f.IMAGE_DESKTOP_TWO_WINDOW_MODE)}),(()=>{e(false)}),f.IMAGE_DESKTOP_RUN)}))}isRedirectEnabled(){return babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]>0}enableRedirect(){babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]++}disableRedirect(){babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]--}isRedirectOptionEnabled(){if(c.DesktopApi.isDesktop()&&!c.DesktopApi.isChatWindow()){return true}return o.Core.getStore().getters["application/settings/get"](l.Settings.desktop.enableRedirect)}openBxLink(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye](e);babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=true;setTimeout((()=>{const e=new r.BaseEvent({compatData:[]});r.EventEmitter.emit(window,"BXLinkOpened",e);babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=false}),Ve);location.href=s}}function es(e){if(/^bx:\/\/v(\d)\//.test(e)){return e}return e.replace("bx://",`bx://v${_e}/${location.hostname}/`)}function ss(){const e=a.Extension.getSettings("im.v2.lib.desktop");this.setDesktopActive(e.get("desktopIsActive"));this.setDesktopVersion(e.get("desktopActiveVersion"))}e.DesktopManager=Ze})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Event,BX,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=desktop-manager.bundle.map.js