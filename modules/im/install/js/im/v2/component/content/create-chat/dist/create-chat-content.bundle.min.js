this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,n,a,s,i,r,o,c,h,g,l,d,C){"use strict";const m={name:"TitleInput",props:{modelValue:{type:String,default:""},placeholder:{type:String,required:true}},emits:["update:modelValue"],data(){return{}},mounted(){this.$refs.titleInput.focus()},methods:{onInput(t){this.$emit("update:modelValue",t.target.value)},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-create-chat__title_container">\n\t\t\t<input\n\t\t\t\t:value="modelValue"\n\t\t\t\t:placeholder="placeholder"\n\t\t\t\t@input="onInput"\n\t\t\t\tclass="bx-im-content-create-chat__title_input"\n\t\t\t\tref="titleInput"\n\t\t\t/>\n\t\t</div>\n\t`};const p={name:"ChatAvatar",props:{avatarFile:{required:true,validator(t){return t instanceof File||a.Type.isNull(t)}},chatTitle:{type:String,required:true}},emits:["avatarChange"],data(){return{}},computed:{preparedAvatar(){if(!this.avatarFile){return null}return URL.createObjectURL(this.avatarFile)}},methods:{onAvatarChangeClick(){this.$refs.avatarInput.click()},async onAvatarSelect(t){const e=t.target;const n=e.files[0];if(!n){return}const a=await this.getChatService().prepareAvatar(n);if(!a){return}this.$emit("avatarChange",a)},getChatService(){if(!this.chatService){this.chatService=new g.ChatService}return this.chatService}},template:`\n\t\t<div class="bx-im-content-create-chat__avatar_container" @click="onAvatarChangeClick">\n\t\t\t<img v-if="preparedAvatar" class="bx-im-content-create-chat__avatar_image" :src="preparedAvatar" :alt="chatTitle" />\n\t\t</div>\n\t\t<input type="file" @change="onAvatarSelect" accept="image/*" class="bx-im-content-create-chat__avatar_input" ref="avatarInput">\n\t`};const _={props:{chatMembers:{type:Array,required:true}},emits:["membersChange"],data(){return{}},computed:{currentUserId(){return o.Core.getUserId()}},created(){const t=this.chatMembers.map((t=>["user",t]));const e=[["user",this.currentUserId],...t];this.membersSelector=new n.TagSelector({maxHeight:99,placeholder:"",addButtonCaption:this.loc("IM_CREATE_CHAT_USER_SELECTOR_ADD_MEMBERS"),addButtonCaptionMore:this.loc("IM_CREATE_CHAT_USER_SELECTOR_ADD_MEMBERS"),showCreateButton:false,dialogOptions:{enableSearch:false,context:"IM_CHAT_CREATE",entities:[{id:"user"},{id:"department"}],preselectedItems:e,undeselectedItems:[["user",this.currentUserId]]},events:{onAfterTagAdd:t=>{const e=t.getTarget();this.$emit("membersChange",e.getTags().map((t=>t.id)))},onAfterTagRemove:t=>{const e=t.getTarget();this.$emit("membersChange",e.getTags().map((t=>t.id)))}}})},mounted(){this.membersSelector.renderTo(this.$refs.members)},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-create-chat__members" ref="members"></div>\n\t`};const u={components:{MessengerButton:C.Button},props:{isCreating:{type:Boolean,required:true},createButtonTitle:{type:String,required:true}},emits:["create","cancel"],data(){return{}},computed:{ButtonSize:()=>C.ButtonSize,ButtonColor:()=>C.ButtonColor},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-create-chat__buttons">\n\t\t\t<div class="bx-im-content-create-chat__buttons_create">\n\t\t\t\t<MessengerButton\n\t\t\t\t\t:size="ButtonSize.XL"\n\t\t\t\t\t:color="ButtonColor.Success"\n\t\t\t\t\t:text="createButtonTitle"\n\t\t\t\t\t:isLoading="isCreating"\n\t\t\t\t\t:isDisabled="isCreating"\n\t\t\t\t\t@click="$emit('create')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="bx-im-content-create-chat__buttons_cancel">\n\t\t\t\t<MessengerButton\n\t\t\t\t\t:size="ButtonSize.XL"\n\t\t\t\t\t:color="ButtonColor.Link"\n\t\t\t\t\t:text="loc('IM_CREATE_CHAT_CANCEL')"\n\t\t\t\t\t:isDisabled="isCreating"\n\t\t\t\t\t@click="$emit('cancel')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const v={components:{ExpandAnimation:e.ExpandAnimation},props:{name:{type:String,required:true},title:{type:String,required:true}},data(){return{isFolded:true}},computed:{containerClasses(){return[`--${this.name}`,{"--active":!this.isFolded}]}},methods:{onContainerClick(){if(this.isFolded){this.isFolded=false}},onHeaderClick(){if(!this.isFolded){this.isFolded=true}}},template:`\n\t\t<div :class="containerClasses" class="bx-im-content-create-chat__section bx-im-content-create-chat__section_scope">\n\t\t\t<div @click="isFolded = !isFolded" class="bx-im-content-create-chat__section_header">\n\t\t\t\t<div class="bx-im-content-create-chat__section_left">\n\t\t\t\t\t<div class="bx-im-content-create-chat__section_icon"></div>\n\t\t\t\t\t<div class="bx-im-content-create-chat__section_text">{{ title }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-content-create-chat__section_right"></div>\t\n\t\t\t</div>\n\t\t\t<ExpandAnimation>\n\t\t\t\t<div v-if="!isFolded" class="bx-im-content-create-chat__section_content_container">\n\t\t\t\t\t<div class="bx-im-content-create-chat__section_content">\n\t\t\t\t\t\t<slot></slot>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</ExpandAnimation>\n\t\t</div>\n\t`};const T={components:{CreateChatSection:v,Dropdown:C.Dropdown,Toggle:C.Toggle},props:{description:{type:String,required:true},withSearchOption:{type:Boolean,default:true},isAvailableInSearch:{type:Boolean,default:false}},emits:["chatTypeChange","descriptionChange"],data(){return{}},computed:{ToggleSize:()=>C.ToggleSize,descriptionPlaceholderText(){return this.loc("IM_CREATE_CHAT_SETTINGS_SECTION_DESCRIPTION_PLACEHOLDER",{"#BR#":"\n","#QUOTE_START#":'"',"#QUOTE_END#":'"'})}},methods:{onTypeChange(t){this.$emit("chatTypeChange",t)},onDescriptionChange(t){this.$emit("descriptionChange",t.target.value)},onToggleLabelClick(){this.$refs.toggle.toggle()},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<CreateChatSection name="settings" :title="loc('IM_CREATE_CHAT_SETTINGS_SECTION')">\n\t\t\t<div v-if="withSearchOption" class="bx-im-content-create-chat__section_block">\n\t\t\t\t<div class="bx-im-content-create-chat__heading">\n\t\t\t\t\t{{ loc('IM_CREATE_CHAT_SETTINGS_SECTION_PRIVACY') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-content-create-chat-settings__type-select">\n\t\t\t\t\t<Toggle :size="ToggleSize.M" :isEnabled="isAvailableInSearch" @change="onTypeChange" ref="toggle" />\n\t\t\t\t\t<div @click="onToggleLabelClick" class="bx-im-content-create-chat-settings__type-select_label">\n\t\t\t\t\t\t{{ loc('IM_CREATE_CHAT_SETTINGS_SECTION_AVAILABLE_FOR_SEARCH') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\n\t\t\t</div>\n\t\t\t<div class="bx-im-content-create-chat__section_block">\n\t\t\t\t<div class="bx-im-content-create-chat__heading">{{ loc('IM_CREATE_CHAT_SETTINGS_SECTION_DESCRIPTION') }}</div>\n\t\t\t\t<div class="bx-im-content-create-chat-settings__description_container">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-w100 ui-ctl-no-resize">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t@input="onDescriptionChange"\n\t\t\t\t\t\t\t:value="description"\n\t\t\t\t\t\t\t:placeholder="descriptionPlaceholderText"\n\t\t\t\t\t\t\tclass="bx-im-content-create-chat-settings__description ui-ctl-element"\n\t\t\t\t\t\t></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</CreateChatSection>\n\t`};const S={name:"OwnerSelector",props:{ownerId:{type:Number,required:true}},emits:["ownerChange"],data(){return{}},created(){this.membersSelector=new n.TagSelector({multiple:false,maxHeight:33,placeholder:"",addButtonCaption:this.loc("IM_CREATE_CHAT_USER_SELECTOR_CHANGE_OWNER"),addButtonCaptionMore:this.loc("IM_CREATE_CHAT_USER_SELECTOR_CHANGE_OWNER"),showCreateButton:false,dialogOptions:{enableSearch:false,context:"IM_CHAT_CREATE",entities:[{id:"user"},{id:"department"}],preselectedItems:[["user",this.ownerId]]},events:{onBeforeTagAdd:t=>{const{tag:e}=t.getData();e.setDeselectable(false)},onAfterTagAdd:t=>{const{tag:e}=t.getData();this.$emit("ownerChange",e.id)}}})},mounted(){this.membersSelector.renderTo(this.$refs.owner)},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-create-chat__owner" ref="owner"></div>\n\t`};const M={props:{managerIds:{type:Array,required:true}},emits:["managersChange"],data(){return{}},computed:{currentUserId(){return o.Core.getUserId()}},created(){const t=this.managerIds.map((t=>["user",t]));this.membersSelector=new n.TagSelector({maxHeight:99,placeholder:"",addButtonCaption:this.loc("IM_CREATE_CHAT_RIGHTS_SECTION_ADD_MANAGERS"),addButtonCaptionMore:this.loc("IM_CREATE_CHAT_RIGHTS_SECTION_ADD_MANAGERS"),showCreateButton:false,dialogOptions:{enableSearch:false,context:"IM_CHAT_CREATE",entities:[{id:"user"},{id:"department"}],preselectedItems:t},events:{onAfterTagAdd:t=>{const e=t.getTarget();this.$emit("managersChange",e.getTags().map((t=>t.id)))},onAfterTagRemove:t=>{const e=t.getTarget();this.$emit("managersChange",e.getTags().map((t=>t.id)))}}})},mounted(){this.membersSelector.renderTo(this.$refs.managers)},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-create-chat__managers" ref="managers"></div>\n\t`};const E=[{value:l.UserRole.member,text:a.Loc.getMessage("IM_CREATE_CHAT_RIGHTS_SECTION_ROLE_MEMBER")},{value:l.UserRole.manager,text:a.Loc.getMessage("IM_CREATE_CHAT_RIGHTS_SECTION_ROLE_MANAGER")},{value:l.UserRole.owner,text:a.Loc.getMessage("IM_CREATE_CHAT_RIGHTS_SECTION_ROLE_OWNER"),default:true}];const I={components:{CreateChatSection:v,Dropdown:C.Dropdown,OwnerSelector:S,ManagersSelector:M},props:{ownerId:{type:Number,required:true},managerIds:{type:Array,required:true},manageUsers:{type:String,required:true},manageSettings:{type:String,required:true},manageUi:{type:String,required:true},canPost:{type:String,required:true}},emits:["ownerChange","managersChange","manageUsersChange","manageUiChange","canPostChange"],data(){return{}},computed:{PopupType:()=>l.PopupType,manageUsersItems(){return E.map((t=>{if(t.value===this.manageUsers){return{...t,default:true}}return{...t}}))},manageUiItems(){return E.map((t=>{if(t.value===this.manageUi){return{...t,default:true}}return{...t}}))},canPostItems(){return E.map((t=>{if(t.value===this.canPost){return{...t,default:true}}return{...t}}))}},methods:{onOwnerChange(t){this.$emit("ownerChange",t)},onManagersChange(t){this.$emit("managersChange",t)},onManageUsersChange(t){this.$emit("manageUsersChange",t)},onManageUiChange(t){this.$emit("manageUiChange",t)},onCanPostChange(t){this.$emit("canPostChange",t)},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<CreateChatSection name="rights" :title="loc('IM_CREATE_CHAT_RIGHTS_SECTION')">\n\t\t\t<div class="bx-im-content-create-chat__section_block">\n\t\t\t\t<div class="bx-im-content-create-chat__heading">\n\t\t\t\t\t{{ loc('IM_CREATE_CHAT_SETTINGS_SECTION_OWNER') }}\n\t\t\t\t</div>\n\t\t\t\t<OwnerSelector :ownerId="ownerId" @ownerChange="onOwnerChange" />\n\t\t\t</div>\n\t\t\t<div class="bx-im-content-create-chat__section_block">\n\t\t\t\t<div class="bx-im-content-create-chat__heading">\n\t\t\t\t\t{{ loc('IM_CREATE_CHAT_RIGHTS_SECTION_MANAGERS') }}\n\t\t\t\t</div>\n\t\t\t\t<ManagersSelector :managerIds="managerIds" @managersChange="onManagersChange" />\n\t\t\t</div>\n\t\t\t<div class="bx-im-content-create-chat__section_block">\n\t\t\t\t<div class="bx-im-content-create-chat__heading">\n\t\t\t\t\t{{ loc('IM_CREATE_CHAT_RIGHTS_SECTION_MANAGE_USERS') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-content-create-chat-settings__manage-select">\n\t\t\t\t\t<Dropdown :items="manageUsersItems" :id="PopupType.createChatManageUsersMenu" @itemChange="onManageUsersChange" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-content-create-chat__section_block">\n\t\t\t\t<div class="bx-im-content-create-chat__heading">\n\t\t\t\t\t{{ loc('IM_CREATE_CHAT_RIGHTS_SECTION_MANAGE_UI') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-content-create-chat-settings__manage-select">\n\t\t\t\t\t<Dropdown :items="manageUiItems" :id="PopupType.createChatManageUiMenu" @itemChange="onManageUiChange" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-content-create-chat__section_block">\n\t\t\t\t<div class="bx-im-content-create-chat__heading">\n\t\t\t\t\t{{ loc('IM_CREATE_CHAT_RIGHTS_SECTION_MANAGE_SENDING') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-content-create-chat-settings__manage-select">\n\t\t\t\t\t<Dropdown :items="canPostItems" :id="PopupType.createChatCanPostMenu" @itemChange="onCanPostChange" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</CreateChatSection>\n\t`};const A={components:{CreateChatSection:v},data(){return{}},template:`\n\t\t<Section name="appearance" title="Appearance" />\n\t`};const b={name:"GroupChatCreation",components:{TitleInput:m,ChatAvatar:p,ChatMembersSelector:_,SettingsSection:T,RightsSection:I,AppearanceSection:A,ButtonPanel:u},data(){return{isCreating:false,avatarFile:null,chatTitle:"",chatMembers:[],settings:{isAvailableInSearch:false,description:""},rights:{ownerId:0,managerIds:[],manageUsers:"",manageSettings:"",manageUi:"",canPost:""}}},watch:{chatTitle(t){c.CreateChatManager.getInstance().setChatTitle(t)}},created(){s.EventEmitter.subscribe(l.EventType.layout.onLayoutChange,this.onLayoutChange);this.rights.ownerId=o.Core.getUserId();this.initDefaultRolesForRights();this.restoreFields();c.CreateChatManager.getInstance().setChatType(l.DialogType.chat);c.CreateChatManager.getInstance().setCreationStatus(true);c.CreateChatManager.getInstance().setChatAvatar(this.avatarFile)},beforeUnmount(){if(this.exitByCancel||this.exitByChatTypeSwitch){return}this.saveFields()},methods:{onMembersChange(t){this.chatMembers=t},onOwnerChange(t){this.rights.ownerId=t},onManagersChange(t){this.rights.managerIds=t},onChatTypeChange(t){this.settings.isAvailableInSearch=t},onDescriptionChange(t){this.settings.description=t},onManageUsersChange(t){this.rights.manageUsers=t},onManageUiChange(t){this.rights.manageUi=t},onCanPostChange(t){this.rights.canPost=t},async onCreateClick(){this.isCreating=true;const t=await this.getChatService().createChat({title:this.chatTitle,avatar:this.avatarFile,members:this.chatMembers,ownerId:this.rights.ownerId,managers:this.rights.managerIds,isAvailableInSearch:this.settings.isAvailableInSearch,description:this.settings.description,manageUsers:this.rights.manageUsers,manageUi:this.rights.manageUi,manageSettings:this.rights.manageSettings,canPost:this.rights.canPost}).catch((()=>{this.isCreating=false;BX.UI.Notification.Center.notify({content:this.loc("IM_CREATE_CHAT_ERROR")})}));this.isCreating=false;c.CreateChatManager.getInstance().setCreationStatus(false);void r.Messenger.openChat(t)},onCancelClick(){this.exitByCancel=true;c.CreateChatManager.getInstance().setCreationStatus(false);r.Messenger.openChat()},onAvatarChange(t){this.avatarFile=t;c.CreateChatManager.getInstance().setChatAvatar(this.avatarFile)},onScroll(){var t,e,n;(t=i.MenuManager.getMenuById(l.PopupType.createChatManageUsersMenu))==null?void 0:t.close();(e=i.MenuManager.getMenuById(l.PopupType.createChatManageUiMenu))==null?void 0:e.close();(n=i.MenuManager.getMenuById(l.PopupType.createChatCanPostMenu))==null?void 0:n.close()},onLayoutChange(t){const{to:e}=t.getData();if(e.name===l.Layout.createChat.name&&e.entityId!==l.DialogType.chat){this.exitByChatTypeSwitch=true}},saveFields(){c.CreateChatManager.getInstance().saveFields({chatTitle:this.chatTitle,avatarFile:this.avatarFile,chatMembers:this.chatMembers,settings:this.settings,rights:this.rights})},restoreFields(){const t=c.CreateChatManager.getInstance().getFields();if(!t){return}const{chatTitle:e,avatarFile:n,chatMembers:a,settings:s,rights:i}=t;this.chatTitle=e;this.avatarFile=n;this.chatMembers=a;this.settings=s;this.rights=i},initDefaultRolesForRights(){const{manageUsers:t,manageUi:e,manageSettings:n}=h.PermissionManager.getInstance().getDefaultRolesForActionGroups();this.rights.manageUsers=t;this.rights.manageUi=e;this.rights.manageSettings=n;this.rights.canPost=l.UserRole.member},getChatService(){if(!this.chatService){this.chatService=new g.ChatService}return this.chatService},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-create-chat__content" @scroll="onScroll">\n\t\t\t<div class="bx-im-content-create-chat__header">\n\t\t\t\t<ChatAvatar :avatarFile="avatarFile" :chatTitle="chatTitle" @avatarChange="onAvatarChange" />\n\t\t\t\t<TitleInput v-model="chatTitle" :placeholder="loc('IM_CREATE_CHAT_TITLE_PLACEHOLDER')" />\n\t\t\t</div>\n\t\t\t<ChatMembersSelector :chatMembers="chatMembers" @membersChange="onMembersChange" />\n\t\t\t<SettingsSection\n\t\t\t\t:isAvailableInSearch="settings.isAvailableInSearch"\n\t\t\t\t:description="settings.description"\n\t\t\t\t@chatTypeChange="onChatTypeChange"\n\t\t\t\t@descriptionChange="onDescriptionChange"\n\t\t\t/>\n\t\t\t<RightsSection\n\t\t\t\t:ownerId="rights.ownerId"\n\t\t\t\t:managerIds="rights.managerIds"\n\t\t\t\t:manageUsers="rights.manageUsers"\n\t\t\t\t:manageUi="rights.manageUi"\n\t\t\t\t:manageSettings="rights.manageSettings"\n\t\t\t\t:canPost="rights.canPost"\n\t\t\t\t@ownerChange="onOwnerChange"\n\t\t\t\t@managersChange="onManagersChange"\n\t\t\t\t@manageUsersChange="onManageUsersChange"\n\t\t\t\t@manageUiChange="onManageUiChange"\n\t\t\t\t@canPostChange="onCanPostChange"\n\t\t\t/> \n\t\t</div>\n\t\t<ButtonPanel\n\t\t\t:isCreating="isCreating"\n\t\t\t:createButtonTitle="loc('IM_CREATE_CHAT_CONFIRM')"\n\t\t\t@create="onCreateClick"\n\t\t\t@cancel="onCancelClick"\n\t\t/>\n\t`};const R={components:{CreateChatSection:v,Dropdown:C.Dropdown,Toggle:C.Toggle},props:{passwordNeeded:{type:Boolean,required:true},password:{type:String,required:true}},emits:["passwordNeededChange","passwordChange"],data(){return{}},computed:{ToggleSize:()=>C.ToggleSize},methods:{onPasswordNeededChange(t){this.$emit("passwordNeededChange",t)},onPasswordChange(t){this.$emit("passwordChange",t.target.value)},onToggleLabelClick(){this.$refs.toggle.toggle()},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<CreateChatSection name="conference" :title="loc('IM_CREATE_CHAT_CONFERENCE_SECTION')">\n\t\t\t<div class="bx-im-content-create-chat__section_block">\n\t\t\t\t<div class="bx-im-content-create-chat__heading">\n\t\t\t\t\t{{ loc('IM_CREATE_CHAT_CONFERENCE_SECTION_PRIVACY') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-content-create-chat-settings__type-select">\n\t\t\t\t\t<Toggle :size="ToggleSize.M" :isEnabled="passwordNeeded" @change="onPasswordNeededChange" ref="toggle" />\n\t\t\t\t\t<div @click="onToggleLabelClick" class="bx-im-content-create-chat-settings__type-select_label">\n\t\t\t\t\t\t{{ loc('IM_CREATE_CHAT_CONFERENCE_SECTION_USE_PASSWORD') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="passwordNeeded" class="bx-im-content-create-chat-conference__password-container ui-ctl ui-ctl-textbox">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tclass="bx-im-content-create-chat-conference__password-input ui-ctl-element"\n\t\t\t\t\t\t:value="password"\n\t\t\t\t\t\t:placeholder="loc('IM_CREATE_CHAT_CONFERENCE_SECTION_PASSWORD_PLACEHOLDER')"\n\t\t\t\t\t\t@input="onPasswordChange"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</CreateChatSection>\n\t`};const f={name:"ConferenceCreation",components:{TitleInput:m,ChatAvatar:p,ChatMembersSelector:_,SettingsSection:T,RightsSection:I,AppearanceSection:A,ConferenceSection:R,ButtonPanel:u},data(){return{isCreating:false,avatarFile:null,chatTitle:"",chatMembers:[],conference:{passwordNeeded:false,password:""},settings:{description:""},rights:{ownerId:0,managerIds:[],manageUsers:"",manageSettings:"",manageUi:"",canPost:""}}},watch:{chatTitle(t){c.CreateChatManager.getInstance().setChatTitle(t)}},created(){s.EventEmitter.subscribe(l.EventType.layout.onLayoutChange,this.onLayoutChange);this.rights.ownerId=o.Core.getUserId();this.initDefaultRolesForRights();this.restoreFields();c.CreateChatManager.getInstance().setChatType(l.DialogType.videoconf);c.CreateChatManager.getInstance().setCreationStatus(true);c.CreateChatManager.getInstance().setChatAvatar(this.avatarFile)},beforeUnmount(){if(this.exitByCancel||this.exitByChatTypeSwitch){return}this.saveFields()},methods:{onMembersChange(t){this.chatMembers=t},onOwnerChange(t){this.rights.ownerId=t},onManagersChange(t){this.rights.managerIds=t},onDescriptionChange(t){this.settings.description=t},onManageUsersChange(t){this.rights.manageUsers=t},onManageUiChange(t){this.rights.manageUi=t},onCanPostChange(t){this.rights.canPost=t},onAvatarChange(t){this.avatarFile=t;c.CreateChatManager.getInstance().setChatAvatar(this.avatarFile)},onPasswordNeededChange(t){this.conference.passwordNeeded=t},onPasswordChange(t){this.conference.password=t},async onCreateClick(){if(!this.checkPassword()){this.showPasswordError();return}this.isCreating=true;const t=await this.getChatService().createChat({type:l.DialogType.videoconf,title:this.chatTitle,avatar:this.avatarFile,members:this.chatMembers,ownerId:this.rights.ownerId,managers:this.rights.managerIds,description:this.settings.description,manageUsers:this.rights.manageUsers,manageUi:this.rights.manageUi,manageSettings:this.rights.manageSettings,canPost:this.rights.canPost,conferencePassword:this.conference.passwordNeeded?this.conference.password:""}).catch((()=>{this.isCreating=false;BX.UI.Notification.Center.notify({content:this.loc("IM_CREATE_CHAT_ERROR")})}));this.isCreating=false;c.CreateChatManager.getInstance().setCreationStatus(false);void r.Messenger.openChat(t)},onCancelClick(){this.exitByCancel=true;c.CreateChatManager.getInstance().setCreationStatus(false);r.Messenger.openChat()},onScroll(){var t,e,n;(t=i.MenuManager.getMenuById(l.PopupType.createChatManageUsersMenu))==null?void 0:t.close();(e=i.MenuManager.getMenuById(l.PopupType.createChatManageUiMenu))==null?void 0:e.close();(n=i.MenuManager.getMenuById(l.PopupType.createChatCanPostMenu))==null?void 0:n.close()},onLayoutChange(t){const{to:e}=t.getData();if(e.name===l.Layout.createChat.name&&e.entityId!==l.DialogType.videoconf){this.exitByChatTypeSwitch=true}},saveFields(){c.CreateChatManager.getInstance().saveFields({chatTitle:this.chatTitle,avatarFile:this.avatarFile,chatMembers:this.chatMembers,settings:this.settings,rights:this.rights,conference:this.conference})},restoreFields(){const t=c.CreateChatManager.getInstance().getFields();if(!t){return}const{chatTitle:e,avatarFile:n,chatMembers:a,conference:s,settings:i,rights:r}=t;this.chatTitle=e;this.avatarFile=n;this.chatMembers=a;this.conference=s;this.settings=i;this.rights=r},initDefaultRolesForRights(){const{manageUsers:t,manageUi:e,manageSettings:n}=h.PermissionManager.getInstance().getDefaultRolesForActionGroups();this.rights.manageUsers=t;this.rights.manageUi=e;this.rights.manageSettings=n;this.rights.canPost=l.UserRole.member},checkPassword(){const t=3;if(!this.conference.passwordNeeded){return true}const e=this.conference.password.trim();return e!==""&&e.length>=t},showPasswordError(){BX.UI.Notification.Center.notify({content:this.loc("IM_CREATE_CHAT_CONFERENCE_PASSWORD_ERROR")})},getChatService(){if(!this.chatService){this.chatService=new g.ChatService}return this.chatService},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-create-chat__content" @scroll="onScroll">\n\t\t\t<div class="bx-im-content-create-chat__header">\n\t\t\t\t<ChatAvatar :avatarFile="avatarFile" :chatTitle="chatTitle" @avatarChange="onAvatarChange" />\n\t\t\t\t<TitleInput v-model="chatTitle" :placeholder="loc('IM_CREATE_CONFERENCE_TITLE_PLACEHOLDER')" />\n\t\t\t</div>\n\t\t\t<ChatMembersSelector :chatMembers="chatMembers" @membersChange="onMembersChange" />\n\t\t\t<ConferenceSection\n\t\t\t\t:passwordNeeded="conference.passwordNeeded"\n\t\t\t\t:password="conference.password"\n\t\t\t\t@passwordNeededChange="onPasswordNeededChange"\n\t\t\t\t@passwordChange="onPasswordChange"\n\t\t\t/>\n\t\t\t<SettingsSection\n\t\t\t\t:withSearchOption="false"\n\t\t\t\t:description="settings.description"\n\t\t\t\t@descriptionChange="onDescriptionChange"\n\t\t\t/>\n\t\t\t<RightsSection\n\t\t\t\t:ownerId="rights.ownerId"\n\t\t\t\t:managerIds="rights.managerIds"\n\t\t\t\t:manageUsers="rights.manageUsers"\n\t\t\t\t:manageUi="rights.manageUi"\n\t\t\t\t:manageSettings="rights.manageSettings"\n\t\t\t\t:canPost="rights.canPost"\n\t\t\t\t@ownerChange="onOwnerChange"\n\t\t\t\t@managersChange="onManagersChange"\n\t\t\t\t@manageUsersChange="onManageUsersChange"\n\t\t\t\t@manageUiChange="onManageUiChange"\n\t\t\t\t@canPostChange="onCanPostChange"\n\t\t\t/>\n\t\t</div>\n\t\t<ButtonPanel\n\t\t\t:isCreating="isCreating"\n\t\t\t:createButtonTitle="loc('IM_CREATE_CONFERENCE_CONFIRM')"\n\t\t\t@create="onCreateClick"\n\t\t\t@cancel="onCancelClick"\n\t\t/>\n\t`};const w={name:"CreateChatContent",components:{GroupChatCreation:b,ConferenceCreation:f},props:{entityId:{type:String,required:true}},data(){return{}},computed:{DialogType:()=>l.DialogType,chatType(){return this.entityId}},template:`\n\t\t<div class="bx-im-content-create-chat__container bx-im-content-create-chat__scope">\n\t\t\t<GroupChatCreation v-if="chatType === DialogType.chat" />\n\t\t\t<ConferenceCreation v-else-if="chatType === DialogType.videoconf" />\n\t\t</div>\n\t`};t.CreateChatContent=w})(this.BX.Messenger.v2.Component.Content=this.BX.Messenger.v2.Component.Content||{},BX.Messenger.v2.Component.Animation,BX.UI.EntitySelector,BX,BX.Event,BX.Main,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Const,BX,BX.Messenger.v2.Component.Elements);
//# sourceMappingURL=create-chat-content.bundle.map.js