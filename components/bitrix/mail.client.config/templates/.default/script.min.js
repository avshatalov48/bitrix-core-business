BX.namespace("BX.MailClientConfig");BX.MailClientConfig.Edit={isSuccessSyncStatus:null,oauthUserIsEmpty:true,isOauthMode:false,isForbiddenToShare:false,smtp:{switcherChecked:false,switcherDisabled:false},crm:{integrationAvailable:false,switcherChecked:false},isCrmIntegrationAvailable:false,isCrmSwitcherChecked:false,init:function(e){if(BX.type.isNotEmptyObject(e)){this.isForbiddenToShare=e.isForbiddenToShare||false;this.smtp.switcherChecked=e.isSmtpSwitcherChecked||false;this.smtp.switcherDisabled=e.isSmtpSwitcherDisabled||false;this.crm.switcherChecked=e.isCrmSwitcherChecked||false;this.crm.integrationAvailable=e.isCrmIntegrationAvailable||false;this.oauthUserIsEmpty=e.oauthUserIsEmpty||false;this.isSuccessSyncStatus=null;this.isOauthMode=e.isOauthMode||false;if(e.isSuccessSyncStatus!==undefined){this.isSuccessSyncStatus=e.isSuccessSyncStatus}const{crmSyncIntervals:t={},leadSourceList:i={},crmEntityList:s={},messageSyncIntervals:n={},defaultMaxCrmSyncKey:a="",defaultMaxAgeMessageSyncKey:o="",defaultLeadSourceKey:c="",defaultNewEntityInKey:l="",defaultNewEntityOutKey:r=""}=e;const m=BX("mail-connect-crm-allow-entity-in");if(m!==null){const e=new BX.Mail.SettingSelector({settingsMap:s,selectedOptionKey:l,inputName:"fields[crm_entity_in]"});e.renderTo(m)}const d=BX("mail-connect-crm-allow-entity-out");if(d!==null){const e=new BX.Mail.SettingSelector({settingsMap:s,selectedOptionKey:r,inputName:"fields[crm_entity_out]"});e.renderTo(d)}const h=BX("mail-connect-crm-lead-source");if(h!==null){const e=new BX.Mail.SettingSelector({settingsMap:i,selectedOptionKey:c,inputName:"fields[crm_lead_source]",dialogOptions:{width:300,height:300,enableSearch:true}});e.renderTo(h)}const u=BX("mail-message-max-age");if(u!==null){const e=new BX.Mail.SettingSelector({settingsMap:n,selectedOptionKey:o,inputName:"fields[msg_max_age]"});e.renderTo(u)}const f=BX("mail-crm-max-age");if(f!==null){const e=new BX.Mail.SettingSelector({settingsMap:t,selectedOptionKey:a,inputName:"fields[crm_max_age]"});e.renderTo(f)}}if(this.isOauthMode&&this.oauthUserIsEmpty){this.showOauthAuthorizationBlock()}var t=BX.findChildrenByClassName(document,"mail-set-singleselect",true);for(var i in t){if(!t.hasOwnProperty(i)){continue}this.singleselect(t[i])}BX.bind(BX("mail_connect_mb_crm_new_lead_for_link"),"click",(function(e){var t=BX("mail_connect_mb_crm_new_lead_for");var i=t.offsetHeight>0;t.style.display=i?"none":"";BX[i?"removeClass":"addClass"](this,"mail-set-textarea-show-open")}));this.setSmtpSwitcher();this.setCrmSwitcher()},singleselect:function(e){var t=BX.findChildren(e,{tag:"input",attr:{type:"radio"}},true);for(var i in t){if(!t.hasOwnProperty(i)){continue}BX.bind(t[i],"change",(function(){if(this.checked){if(this.value==0){var t=BX(e.getAttribute("data-checked"));if(t){var i=BX.findNextSibling(this,{tag:"label",attr:{for:this.id}});var s=BX.findNextSibling(t,{tag:"label",attr:{for:t.id}});if(i&&s)BX.adjust(i,{text:s.innerHTML})}}else{e.setAttribute("data-checked",this.id)}}}))}BX.bind(e,"click",(function(t){t=t||window.event;t.skip_singleselect=e}));BX.bind(document,"click",(function(t){t=t||window.event;if(t.skip_singleselect!==e){BX(e.getAttribute("data-checked")).checked=true}}))},beforeOpenDialog:function(){return new Promise((function(e,t){if(BX.MailClientConfig.Edit.isForbiddenToShare){BX.MailClientConfig.Edit.alertForbiddenToShare();return t()}return e()}))},alertForbiddenToShare:function(){B24.licenseInfoPopup.show("mail-shared-mailbox-limit",BX.message("MAIL_MAILBOX_LICENSE_SHARED_LIMIT_TITLE"),BX.message("MAIL_MAILBOX_LICENSE_SHARED_LIMIT_BODY"))},setBlockSwitcher(e,t,i,s,n=false){const a=BX(e);const o=BX(i);if(!a||!o){return}const c=o.querySelector(".mail-connect-form-items");const l=o.querySelector(".mail-connect-title-block");if(!c||!l){return}const r=()=>{BX.Dom.hide(c);BX.Dom.addClass(l,"mail-connect-title-hidden-block");BX.Dom.removeClass(o,"mail-connect-section-block")};const m=()=>{BX.Dom.show(c);BX.Dom.removeClass(l,"mail-connect-title-hidden-block");BX.Dom.addClass(o,"mail-connect-section-block")};const d=BX(t);const h=new BX.UI.Switcher({node:a,checked:s,size:"small",disabled:n??false,handlers:{toggled:()=>{if(h.checked===true){m()}else{r()}if(d){d.click()}}}});if(!s){r()}},showOauthErrorTour(){this.oauthErrorTour=new BX.UI.Tour.Guide({id:"mail-config-oauth-error-tour",simpleMode:true,steps:[{target:"#mail_connect_mb_oauth_btn",title:BX.message("MAIL_CONFIG_OAUTH_ERROR_TOUR_TITLE"),text:BX.message("MAIL_CONFIG_OAUTH_ERROR_TOUR_TEXT"),position:"bottom",article:"19083990"}]});this.oauthErrorTour.start()},showPasswordErrorTour(){this.oauthErrorTour=new BX.UI.Tour.Guide({id:"mail-config-password-error-tour",simpleMode:true,steps:[{target:"#mail_password_form_wrapper",title:BX.message("MAIL_CONFIG_PASSWORD_ERROR_TOUR_TITLE"),text:BX.message("MAIL_CONFIG_PASSWORD_ERROR_TOUR_TEXT"),position:"bottom",article:"19083990"}]});this.oauthErrorTour.start()},showOauthAuthorizationBlock(){var e=BX("mail_connect_form");var t=BX("mail-client-config-email-oauth-field-error");var i=BX("mail-client-config-email-oauth-field-success");var s=BX("mail-email-oauth");var n=BX("mail_connect_mb_oauth_field");if(s){BX.hide(s);BX.hide(t);BX.hide(i)}if(n){n.value="N"}if(!e.elements["fields[mailbox_id]"]){var a=BX("mail_connect_mb_name_field");if(!a["__filled"]){a.value=""}}BX.Dom.style(BX("mail_connect_mb_oauth_status"),"display","none");BX.Dom.style(BX("mail_connect_mb_oauth_btn"),"display",null)},setSmtpSwitcher(){this.setBlockSwitcher("mail-connect-smtp-settings-title","mail_connect_mb_server_smtp_switch","mail-connect-section-smtp-block",this.smtp.switcherChecked,this.smtp.switcherDisabled)},setCrmSwitcher(){if(!this.crm.integrationAvailable){return}this.setBlockSwitcher("mail-connect-crm-settings-title","mail_connect_mb_crm_switch","mail-connect-section-crm-block",this.crm.switcherChecked)}};
//# sourceMappingURL=script.map.js