{"version":3,"file":"copilot-content.bundle.js","sources":["../src/components/chat-header.js","../src/components/empty-state.js","../src/components/textarea/classes/audio-manager.js","../src/components/textarea/audio-input.js","../src/components/textarea/textarea.js","../src/components/dialog-status.js","../src/components/message-list.js","../src/components/dialog.js","../src/copilot-content.js"],"sourcesContent":["import 'ui.notification';\nimport { Loc, Extension } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { ChatService } from 'im.v2.provider.service';\nimport { AddToChat } from 'im.v2.component.entity-selector';\nimport { EditableChatTitle } from 'im.v2.component.elements';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\n\nimport '../css/chat-header.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const ChatHeader = {\n\tname: 'ChatHeader',\n\tcomponents: { EditableChatTitle, AddToChat },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tcurrentSidebarPanel: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tuserCounter(): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural('IM_CONTENT_COPILOT_HEADER_USER_COUNT', this.dialog.userCounter, {\n\t\t\t\t'#COUNT#': this.dialog.userCounter,\n\t\t\t});\n\t\t},\n\t\tisInited(): boolean\n\t\t{\n\t\t\treturn this.dialog.inited;\n\t\t},\n\t\tisGroupCopilotChat(): boolean\n\t\t{\n\t\t\treturn this.dialog.userCounter > 2;\n\t\t},\n\t\tisAddToChatAvailable(): boolean\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.content.copilot');\n\n\t\t\treturn settings.isAddToChatAvailable === 'Y';\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonNewTitleSubmit(newTitle: string)\n\t\t{\n\t\t\tthis.getChatService().renameChat(this.dialogId, newTitle).catch(() => {\n\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\tcontent: this.loc('IM_CONTENT_COPILOT_HEADER_RENAME_ERROR'),\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\topenAddToChatPopup()\n\t\t{\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t\tonMembersClick()\n\t\t{\n\t\t\tif (!this.isInited)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.currentSidebarPanel === SidebarDetailBlock.members)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.members });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.members,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-copilot-header__container\">\n\t\t\t<div class=\"bx-im-copilot-header__left\">\n\t\t\t\t<div class=\"bx-im-copilot-header__avatar\">\n\t\t\t\t\t<div class=\"bx-im-copilot-header__avatar_default\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-copilot-header__info\">\n\t\t\t\t\t<EditableChatTitle :dialogId=\"dialogId\" @newTitleSubmit=\"onNewTitleSubmit\" />\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-if=\"isGroupCopilotChat\"\n\t\t\t\t\t\t:title=\"loc('IM_CONTENT_COPILOT_HEADER_OPEN_MEMBERS_TITLE')\"\n\t\t\t\t\t\t@click=\"onMembersClick\"\n\t\t\t\t\t\tclass=\"bx-im-copilot-header__subtitle --click\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ userCounter }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else class=\"bx-im-copilot-header__subtitle\">\n\t\t\t\t\t\t{{ loc('IM_CONTENT_COPILOT_HEADER_SUBTITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-copilot-header__right\">\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isAddToChatAvailable\"\n\t\t\t\t\t:title=\"loc('IM_CONTENT_COPILOT_HEADER_OPEN_INVITE_POPUP_TITLE')\"\n\t\t\t\t\t:class=\"{'--active': showAddToChatPopup}\"\n\t\t\t\t\tclass=\"bx-im-copilot-header__icon --add-users\"\n\t\t\t\t\t@click=\"openAddToChatPopup\"\n\t\t\t\t\tref=\"add-users\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<AddToChat\n\t\t\t\t:bindElement=\"$refs['add-users'] || {}\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:showPopup=\"showAddToChatPopup\"\n\t\t\t\t:popupConfig=\"{offsetTop: 15, offsetLeft: -300}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Messenger } from 'im.public';\nimport { Button as ChatButton, ButtonSize } from 'im.v2.component.elements';\nimport { Color } from 'im.v2.const';\nimport { CopilotService } from 'im.v2.provider.service';\n\nimport '../css/empty-state.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { CustomColorScheme } from 'im.v2.component.elements';\n\nconst BUTTON_BACKGROUND_COLOR = '#fff';\nconst BUTTON_HOVER_COLOR = '#eee';\nconst BUTTON_TEXT_COLOR = 'rgba(82, 92, 105, 0.9)';\n\n// @vue/component\nexport const EmptyState = {\n\tname: 'EmptyState',\n\tcomponents: { ChatButton },\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tpreparedText(): string\n\t\t{\n\t\t\treturn this.loc('IM_CONTENT_COPILOT_EMPTY_STATE_MESSAGE', {\n\t\t\t\t'#BR#': '\\n',\n\t\t\t});\n\t\t},\n\t\tbuttonColorScheme(): CustomColorScheme\n\t\t{\n\t\t\treturn {\n\t\t\t\tborderColor: Color.transparent,\n\t\t\t\tbackgroundColor: BUTTON_BACKGROUND_COLOR,\n\t\t\t\ticonColor: BUTTON_TEXT_COLOR,\n\t\t\t\ttextColor: BUTTON_TEXT_COLOR,\n\t\t\t\thoverColor: BUTTON_HOVER_COLOR,\n\t\t\t};\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tasync onButtonClick()\n\t\t{\n\t\t\tthis.isLoading = true;\n\n\t\t\tconst newDialogId = await this.getCopilotService().createChat()\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.isLoading = false;\n\t\t\t\t\tthis.showCreateChatError();\n\t\t\t\t});\n\n\t\t\tthis.isLoading = false;\n\t\t\tvoid Messenger.openCopilot(newDialogId);\n\t\t},\n\t\tshowCreateChatError()\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: this.loc('IM_CONTENT_COPILOT_EMPTY_STATE_ERROR_CREATING_CHAT'),\n\t\t\t});\n\t\t},\n\t\tgetCopilotService(): CopilotService\n\t\t{\n\t\t\tif (!this.copilotService)\n\t\t\t{\n\t\t\t\tthis.copilotService = new CopilotService();\n\t\t\t}\n\n\t\t\treturn this.copilotService;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-copilot-empty-state__container\">\n\t\t\t<div class=\"bx-im-content-copilot-empty-state__content\">\n\t\t\t\t<div class=\"bx-im-content-copilot-empty-state__icon\"></div>\n\t\t\t\t<div class=\"bx-im-content-copilot-empty-state__text\">{{ preparedText }}</div>\n\t\t\t\t<div class=\"bx-im-content-copilot-empty-state__button\">\n\t\t\t\t\t<ChatButton\n\t\t\t\t\t\tclass=\"--black-loader\"\n\t\t\t\t\t\t:size=\"ButtonSize.XL\"\n\t\t\t\t\t\t:customColorScheme=\"buttonColorScheme\"\n\t\t\t\t\t\t:text=\"loc('IM_CONTENT_COPILOT_EMPTY_STATE_ASK_QUESTION')\"\n\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t:isLoading=\"isLoading\"\n\t\t\t\t\t\t@click=\"onButtonClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Event } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nconst RecognizerEvent = {\n\taudioend: 'audioend',\n\taudiostart: 'audiostart',\n\tend: 'end',\n\terror: 'error',\n\tnomatch: 'nomatch',\n\tresult: 'result',\n\tsoundend: 'soundend',\n\tsoundstart: 'soundstart',\n\tspeechend: 'speechend',\n\tspeechstart: 'speechstart',\n\tstart: 'start',\n};\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.CopilotAudioManager';\n\nexport class AudioManager extends EventEmitter\n{\n\tstatic events = {\n\t\trecognitionStart: 'recognitionStart',\n\t\trecognitionError: 'recognitionError',\n\t\trecognitionEnd: 'recognitionEnd',\n\t\trecognitionResult: 'recognitionResult',\n\t};\n\n\trecognizer: SpeechRecognition | null = null;\n\n\tstatic isAvailable(): boolean\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\treturn DesktopApi.getApiVersion() > 74;\n\t\t}\n\n\t\treturn Boolean(window.SpeechRecognition || window.webkitSpeechRecognition);\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tthis.recognizer = new (window.SpeechRecognition || window.webkitSpeechRecognition)();\n\t\tthis.#initSettings();\n\t\tthis.#bindEvents();\n\t}\n\n\tstartRecognition()\n\t{\n\t\tthis.recognizer.start();\n\t}\n\n\tstopRecognition()\n\t{\n\t\tthis.recognizer.stop();\n\t}\n\n\t#bindEvents()\n\t{\n\t\tEvent.bind(this.recognizer, RecognizerEvent.start, () => {\n\t\t\tthis.lastRecognizedText = '';\n\t\t\tthis.emit(AudioManager.events.recognitionStart);\n\t\t});\n\t\tEvent.bind(this.recognizer, RecognizerEvent.error, (event: SpeechRecognitionErrorEvent) => {\n\t\t\tthis.emit(AudioManager.events.recognitionError, event.error);\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('Copilot: AudioManager: error', event.error);\n\t\t});\n\t\tEvent.bind(this.recognizer, RecognizerEvent.end, () => {\n\t\t\tthis.lastRecognizedText = '';\n\t\t\tthis.emit(AudioManager.events.recognitionEnd);\n\t\t});\n\t\tEvent.bind(this.recognizer, RecognizerEvent.result, (event: SpeechRecognitionEvent) => {\n\t\t\tconst recognizedText = this.#getRecognizedText(event);\n\t\t\tconst newText = this.#getNewText(recognizedText);\n\n\t\t\tif (newText !== '')\n\t\t\t{\n\t\t\t\tthis.emit(AudioManager.events.recognitionResult, newText);\n\t\t\t}\n\n\t\t\tthis.lastRecognizedText = recognizedText;\n\t\t});\n\t}\n\n\t#getRecognizedText(event: SpeechRecognitionEvent): string\n\t{\n\t\tlet recognizedChunk = '';\n\t\tObject.values(event.results).forEach((result: SpeechRecognitionResult) => {\n\t\t\tif (result.isFinal)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst [alternative] = result;\n\t\t\tconst { transcript } = alternative;\n\t\t\trecognizedChunk += transcript;\n\t\t});\n\n\t\treturn recognizedChunk;\n\t}\n\n\t#getNewText(fullText: string): string\n\t{\n\t\tlet additionalText = '';\n\t\tconst lastChunkLength = this.lastRecognizedText.length;\n\t\tif (fullText.length > lastChunkLength)\n\t\t{\n\t\t\tadditionalText = fullText.slice(lastChunkLength);\n\t\t}\n\n\t\treturn additionalText;\n\t}\n\n\t#initSettings()\n\t{\n\t\tthis.recognizer.continuous = true;\n\t\tthis.recognizer.interimResults = true;\n\t}\n}\n","import { BaseEvent } from 'main.core.events';\n\nimport { AudioManager } from './classes/audio-manager';\n\nimport './css/audio-input.css';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const AudioInput = {\n\tname: 'AudioInput',\n\tprops:\n\t{\n\t\taudioMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['start', 'stop', 'inputStart', 'inputResult', 'error'],\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\twatch:\n\t{\n\t\taudioMode(newValue, oldValue)\n\t\t{\n\t\t\tif (oldValue === false && newValue === true)\n\t\t\t{\n\t\t\t\tthis.startAudio();\n\t\t\t}\n\n\t\t\tif (oldValue === true && newValue === false)\n\t\t\t{\n\t\t\t\tthis.stopAudio();\n\t\t\t}\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonClick()\n\t\t{\n\t\t\tif (this.audioMode)\n\t\t\t{\n\t\t\t\tthis.$emit('stop');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('start');\n\t\t},\n\t\tstartAudio()\n\t\t{\n\t\t\tthis.getAudioManager().startRecognition();\n\t\t\tthis.bindAudioEvents();\n\t\t},\n\t\tstopAudio()\n\t\t{\n\t\t\tthis.getAudioManager().stopRecognition();\n\t\t\tthis.unbindAudioEvents();\n\t\t},\n\t\tbindAudioEvents()\n\t\t{\n\t\t\tthis.getAudioManager().subscribe(AudioManager.events.recognitionResult, (event: BaseEvent) => {\n\t\t\t\tconst text: string = event.getData();\n\t\t\t\tthis.$emit('inputResult', text);\n\t\t\t});\n\t\t\tthis.getAudioManager().subscribe(AudioManager.events.recognitionStart, () => {\n\t\t\t\tthis.$emit('inputStart');\n\t\t\t});\n\t\t\tthis.getAudioManager().subscribe(AudioManager.events.recognitionError, () => {\n\t\t\t\tthis.$emit('error');\n\t\t\t\tBX.UI.Notification.Center.notify({ content: this.loc('IM_CONTENT_COPILOT_TEXTAREA_AUDIO_INPUT_ERROR') });\n\t\t\t});\n\t\t},\n\t\tunbindAudioEvents()\n\t\t{\n\t\t\tthis.getAudioManager().unsubscribeAll(AudioManager.events.recognitionResult);\n\t\t\tthis.getAudioManager().unsubscribeAll(AudioManager.events.recognitionStart);\n\t\t\tthis.getAudioManager().unsubscribeAll(AudioManager.events.recognitionEnd);\n\t\t\tthis.getAudioManager().unsubscribeAll(AudioManager.events.recognitionError);\n\t\t},\n\t\tisAudioModeAvailable(): boolean\n\t\t{\n\t\t\treturn AudioManager.isAvailable();\n\t\t},\n\t\tgetAudioManager(): AudioManager\n\t\t{\n\t\t\tif (!this.audioManager)\n\t\t\t{\n\t\t\t\tthis.audioManager = new AudioManager();\n\t\t\t}\n\n\t\t\treturn this.audioManager;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"isAudioModeAvailable()\"\n\t\t\t@click=\"onClick\"\n\t\t\tclass=\"bx-im-copilot-audio-input__container\"\n\t\t\t:class=\"{'--active': audioMode}\"\n\t\t></div>\n\t`,\n};\n","// noinspection JSUnresolvedReference\nimport { BitrixVue } from 'ui.vue3';\n\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { CopilotDraftManager } from 'im.v2.lib.draft';\nimport { ChatTextarea } from 'im.v2.component.textarea';\n\nimport { AudioInput } from './audio-input';\n\nimport './css/textarea.css';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const CopilotTextarea = BitrixVue.cloneComponent(ChatTextarea, {\n\tname: 'CopilotTextarea',\n\tcomponents: { AudioInput },\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\t...this.parentData(),\n\t\t\taudioMode: false,\n\t\t\taudioUsed: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tisEmptyText(): boolean\n\t\t{\n\t\t\treturn this.text === '';\n\t\t},\n\t\tshowMentionForCopilotChat(): boolean\n\t\t{\n\t\t\treturn this.showMention && this.dialog.userCounter > 2;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonAudioInputStart()\n\t\t{\n\t\t\tif (this.isEmptyText)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.text += ' ';\n\t\t},\n\t\tonAudioInputResult(inputText: string)\n\t\t{\n\t\t\tif (!this.audioMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.text += inputText;\n\t\t\tthis.audioUsed = true;\n\t\t},\n\t\tonAudioError()\n\t\t{\n\t\t\tthis.audioMode = false;\n\t\t},\n\t\topenEditPanel()\n\t\t{},\n\t\tgetDraftManager(): CopilotDraftManager\n\t\t{\n\t\t\tif (!this.draftManager)\n\t\t\t{\n\t\t\t\tthis.draftManager = CopilotDraftManager.getInstance();\n\t\t\t}\n\n\t\t\treturn this.draftManager;\n\t\t},\n\t\tsendMessage(): void\n\t\t{\n\t\t\tthis.parentSendMessage();\n\n\t\t\tif (this.audioUsed)\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().useAudioInput();\n\t\t\t\tthis.audioUsed = false;\n\t\t\t}\n\n\t\t\tthis.audioMode = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-send-panel__scope bx-im-send-panel__container bx-im-copilot-send-panel__container\">\n\t\t\t<div class=\"bx-im-textarea__container\">\n\t\t\t\t<div @mousedown=\"onResizeStart\" class=\"bx-im-textarea__drag-handle\"></div>\n\t\t\t\t<div class=\"bx-im-textarea__content\" ref=\"textarea-content\">\n\t\t\t\t\t<div class=\"bx-im-textarea__left\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-model=\"text\"\n\t\t\t\t\t\t\t:style=\"textareaStyle\"\n\t\t\t\t\t\t\t:placeholder=\"loc('IM_CONTENT_COPILOT_TEXTAREA_PLACEHOLDER')\"\n\t\t\t\t\t\t\t:maxlength=\"textareaMaxLength\"\n\t\t\t\t\t\t\t@keydown=\"onKeyDown\"\n\t\t\t\t\t\t\t@paste=\"onPaste\"\n\t\t\t\t\t\t\tclass=\"bx-im-textarea__element\"\n\t\t\t\t\t\t\tref=\"textarea\"\n\t\t\t\t\t\t\trows=\"1\"\n\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t<AudioInput\n\t\t\t\t\t\t\t:audioMode=\"audioMode\"\n\t\t\t\t\t\t\t@start=\"audioMode = true\"\n\t\t\t\t\t\t\t@stop=\"audioMode = false\"\n\t\t\t\t\t\t\t@inputStart=\"onAudioInputStart\"\n\t\t\t\t\t\t\t@inputResult=\"onAudioInputResult\"\n\t\t\t\t\t\t\t@error=\"onAudioError\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<SendButton :editMode=\"editMode\" :isDisabled=\"isDisabled\" @click=\"sendMessage\" />\n\t\t\t<MentionPopup\n\t\t\t\tv-if=\"showMentionForCopilotChat\"\n\t\t\t\t:bindElement=\"$refs['textarea-content']\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:query=\"mentionQuery\"\n\t\t\t\t:searchChats=\"false\"\n\t\t\t\t@close=\"closeMentionPopup\"\n\t\t\t/>\n\t\t</div>\n\t`,\n});\n","import { DialogStatus } from 'im.v2.component.elements';\n\nimport { BitrixVue } from 'ui.vue3';\n\n// @vue/component\nexport const CopilotDialogStatus = BitrixVue.cloneComponent(DialogStatus, {\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog-chat-status__container\">\n\t\t\t<div v-if=\"typingStatus\" class=\"bx-im-dialog-chat-status__content\">\n\t\t\t\t<div class=\"bx-im-dialog-chat-status__icon --typing\"></div>\n\t\t\t\t<div class=\"bx-im-dialog-chat-status__text\">{{ typingStatus }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n});\n","import { BitrixVue } from 'ui.vue3';\n\nimport { MessageList } from 'im.v2.component.message-list';\n\nimport { CopilotDialogStatus } from './dialog-status';\n\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n\n// @vue/component\nexport const CopilotMessageList = BitrixVue.cloneComponent(MessageList, {\n\tname: 'CopilotMessageList',\n\tcomponents: { CopilotDialogStatus },\n\tcomputed:\n\t{\n\t\tstatusComponent(): BitrixVueComponentProps\n\t\t{\n\t\t\treturn CopilotDialogStatus;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonMessageContextMenuClick()\n\t\t{},\n\t\tonAvatarClick(params: { dialogId: string, $event: PointerEvent })\n\t\t{\n\t\t\tconst copilotUserId = this.$store.getters['users/bots/getCopilotUserId'];\n\t\t\tif (copilotUserId.toString() === params.dialogId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// noinspection JSUnresolvedReference\n\t\t\tthis.parentOnAvatarClick(params);\n\t\t},\n\t},\n});\n","import { BitrixVue } from 'ui.vue3';\n\nimport { ChatDialog } from 'im.v2.component.dialog.chat';\n\nimport { CopilotMessageList } from './message-list';\n\nimport '../css/dialog.css';\n\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n\n// @vue/component\nexport const CopilotDialog = BitrixVue.cloneComponent(ChatDialog, {\n\tname: 'CopilotDialog',\n\tcomputed:\n\t{\n\t\tmessageListComponent(): BitrixVueComponentProps\n\t\t{\n\t\t\treturn CopilotMessageList;\n\t\t},\n\t},\n});\n","import 'ui.notification';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { ChatService } from 'im.v2.provider.service';\nimport { Logger } from 'im.v2.lib.logger';\nimport { ThemeManager } from 'im.v2.lib.theme';\nimport { ResizeManager } from 'im.v2.lib.textarea';\nimport { EventType, Settings, SidebarDetailBlock } from 'im.v2.const';\nimport { ChatSidebar } from 'im.v2.component.sidebar';\nimport { Analytics } from 'im.v2.lib.analytics';\n\nimport { ChatHeader } from './components/chat-header';\nimport { EmptyState } from './components/empty-state';\nimport { CopilotTextarea } from './components/textarea/textarea';\nimport { CopilotDialog } from './components/dialog';\n\nimport './css/copilot-content.css';\n\nimport type { ImModelChat, ImModelLayout } from 'im.v2.model';\nimport type { BackgroundStyle } from 'im.v2.lib.theme';\n\n// @vue/component\nexport const CopilotContent = {\n\tname: 'CopilotContent',\n\tcomponents: { EmptyState, ChatHeader, CopilotDialog, CopilotTextarea, ChatSidebar },\n\tdirectives:\n\t{\n\t\t'textarea-observer': {\n\t\t\tmounted(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.textareaResizeManager.observeTextarea(element);\n\t\t\t},\n\t\t\tbeforeUnmount(element, binding)\n\t\t\t{\n\t\t\t\tbinding.instance.textareaResizeManager.unobserveTextarea(element);\n\t\t\t},\n\t\t},\n\t},\n\tprops:\n\t{\n\t\tentityId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tcontextMessageId: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\ttextareaHeight: 0,\n\t\t\tcurrentSidebarPanel: '',\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tlayout(): ImModelLayout\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.entityId, true);\n\t\t},\n\t\tcontainerClasses(): string[]\n\t\t{\n\t\t\tconst alignment = this.$store.getters['application/settings/get'](Settings.appearance.alignment);\n\n\t\t\treturn [`--${alignment}-align`];\n\t\t},\n\t\tbackgroundStyle(): BackgroundStyle\n\t\t{\n\t\t\tconst COPILOT_BACKGROUND_ID = 4;\n\n\t\t\treturn ThemeManager.getBackgroundStyleById(COPILOT_BACKGROUND_ID);\n\t\t},\n\t\tdialogContainerStyle(): Object\n\t\t{\n\t\t\tconst CHAT_HEADER_HEIGHT = 64;\n\n\t\t\treturn {\n\t\t\t\theight: `calc(100% - ${CHAT_HEADER_HEIGHT}px - ${this.textareaHeight}px)`,\n\t\t\t};\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tentityId(newValue, oldValue)\n\t\t{\n\t\t\tLogger.warn(`CopilotContent: switching from ${oldValue || 'empty'} to ${newValue}`);\n\t\t\tthis.onChatChange();\n\t\t\tEventEmitter.emit(EventType.sidebar.close, { panel: SidebarDetailBlock.members });\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tif (this.entityId)\n\t\t{\n\t\t\tthis.onChatChange();\n\t\t}\n\n\t\tthis.initTextareaResizeManager();\n\t},\n\tmethods:\n\t{\n\t\tasync onChatChange()\n\t\t{\n\t\t\tif (this.entityId === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dialog.inited)\n\t\t\t{\n\t\t\t\tLogger.warn(`CopilotContent: chat ${this.entityId} is already loaded`);\n\n\t\t\t\tAnalytics.getInstance().openCopilotChat(this.entityId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dialog.loading)\n\t\t\t{\n\t\t\t\tLogger.warn(`CopilotContent: chat ${this.entityId} is loading`);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.layout.contextId)\n\t\t\t{\n\t\t\t\tawait this.loadChatWithContext();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.loadChat();\n\t\t},\n\t\tloadChatWithContext(): Promise\n\t\t{\n\t\t\tLogger.warn(`CopilotContent: loading chat ${this.entityId} with context - ${this.layout.contextId}`);\n\n\t\t\treturn this.getChatService().loadChatWithContext(this.entityId, this.layout.contextId).then(() => {\n\t\t\t\tLogger.warn(`CopilotContent: chat ${this.entityId} is loaded with context of ${this.layout.contextId}`);\n\t\t\t}).catch((error) => {\n\t\t\t\tif (error.code === 'ACCESS_ERROR')\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(this.loc('IM_CONTENT_CHAT_ACCESS_ERROR'));\n\t\t\t\t}\n\t\t\t\tLogger.error(error);\n\t\t\t\tMessenger.openCopilot();\n\t\t\t});\n\t\t},\n\t\tloadChat(): Promise\n\t\t{\n\t\t\tLogger.warn(`CopilotContent: loading chat ${this.entityId}`);\n\n\t\t\treturn this.getChatService().loadChatWithMessages(this.entityId).then(() => {\n\t\t\t\tLogger.warn(`CopilotContent: chat ${this.entityId} is loaded`);\n\t\t\t\tAnalytics.getInstance().openCopilotChat(this.entityId);\n\t\t\t}).catch((error) => {\n\t\t\t\tconst [firstError] = error;\n\t\t\t\tif (firstError.code === 'ACCESS_DENIED')\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(this.loc('IM_CONTENT_CHAT_ACCESS_ERROR'));\n\t\t\t\t}\n\t\t\t\tMessenger.openCopilot();\n\t\t\t});\n\t\t},\n\t\tinitTextareaResizeManager()\n\t\t{\n\t\t\tthis.textareaResizeManager = new ResizeManager();\n\t\t\tthis.textareaResizeManager.subscribe(\n\t\t\t\tResizeManager.events.onHeightChange,\n\t\t\t\t(event: BaseEvent<{newHeight: number}>) => {\n\t\t\t\t\tconst { newHeight } = event.getData();\n\t\t\t\t\tthis.textareaHeight = newHeight;\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tshowNotification(text: string)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({ content: text });\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tonChangeSidebarPanel({ panel }: {panel: $Keys<typeof SidebarDetailBlock>})\n\t\t{\n\t\t\tthis.currentSidebarPanel = panel;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-content-chat__container bx-im-content-copilot__container\" :class=\"containerClasses\" :style=\"backgroundStyle\">\n\t\t\t<div v-if=\"entityId\" class=\"bx-im-content-copilot__content\">\n\t\t\t\t<ChatHeader :dialogId=\"entityId\" :key=\"entityId\" :currentSidebarPanel=\"currentSidebarPanel\" />\n\t\t\t\t<div :style=\"dialogContainerStyle\" class=\"bx-im-content-copilot__dialog_container\">\n\t\t\t\t\t<div class=\"bx-im-content-copilot__dialog_content\">\n\t\t\t\t\t\t<CopilotDialog :dialogId=\"entityId\" :key=\"entityId\" :textareaHeight=\"textareaHeight\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-textarea-observer class=\"bx-im-content-copilot__textarea_container\">\n\t\t\t\t\t<CopilotTextarea :dialogId=\"entityId\" :key=\"entityId\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<EmptyState v-else />\n\t\t\t<ChatSidebar\n\t\t\t\tv-if=\"entityId.length > 0\"\n\t\t\t\t:originDialogId=\"entityId\"\n\t\t\t\t@changePanel=\"onChangeSidebarPanel\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n"],"names":["ChatHeader","name","components","EditableChatTitle","AddToChat","props","dialogId","type","String","default","currentSidebarPanel","data","showAddToChatPopup","computed","dialog","$store","getters","chatId","userCounter","Loc","getMessagePlural","isInited","inited","isGroupCopilotChat","isAddToChatAvailable","settings","Extension","getSettings","methods","onNewTitleSubmit","newTitle","getChatService","renameChat","catch","BX","UI","Notification","Center","notify","content","loc","chatService","ChatService","phraseCode","replacements","$Bitrix","getMessage","openAddToChatPopup","onMembersClick","SidebarDetailBlock","members","EventEmitter","emit","EventType","sidebar","close","panel","open","template","BUTTON_BACKGROUND_COLOR","BUTTON_HOVER_COLOR","BUTTON_TEXT_COLOR","EmptyState","ChatButton","isLoading","ButtonSize","preparedText","buttonColorScheme","borderColor","Color","transparent","backgroundColor","iconColor","textColor","hoverColor","onButtonClick","newDialogId","getCopilotService","createChat","showCreateChatError","Messenger","openCopilot","copilotService","CopilotService","RecognizerEvent","audioend","audiostart","end","error","nomatch","result","soundend","soundstart","speechend","speechstart","start","EVENT_NAMESPACE","AudioManager","isAvailable","DesktopApi","isDesktop","getApiVersion","Boolean","window","SpeechRecognition","webkitSpeechRecognition","constructor","recognizer","setEventNamespace","startRecognition","stopRecognition","stop","Event","bind","lastRecognizedText","events","recognitionStart","event","recognitionError","console","recognitionEnd","recognizedText","newText","recognitionResult","recognizedChunk","Object","values","results","forEach","isFinal","alternative","transcript","fullText","additionalText","lastChunkLength","length","slice","continuous","interimResults","AudioInput","audioMode","required","emits","watch","newValue","oldValue","startAudio","stopAudio","onClick","$emit","getAudioManager","bindAudioEvents","unbindAudioEvents","subscribe","text","getData","unsubscribeAll","isAudioModeAvailable","audioManager","CopilotTextarea","BitrixVue","cloneComponent","ChatTextarea","parentData","audioUsed","isEmptyText","showMentionForCopilotChat","showMention","onAudioInputStart","onAudioInputResult","inputText","onAudioError","openEditPanel","getDraftManager","draftManager","CopilotDraftManager","getInstance","sendMessage","parentSendMessage","Analytics","useAudioInput","CopilotDialogStatus","DialogStatus","CopilotMessageList","MessageList","statusComponent","onMessageContextMenuClick","onAvatarClick","params","copilotUserId","toString","parentOnAvatarClick","CopilotDialog","ChatDialog","messageListComponent","CopilotContent","ChatSidebar","directives","mounted","element","binding","instance","textareaResizeManager","observeTextarea","beforeUnmount","unobserveTextarea","entityId","contextMessageId","Number","textareaHeight","layout","containerClasses","alignment","Settings","appearance","backgroundStyle","COPILOT_BACKGROUND_ID","ThemeManager","getBackgroundStyleById","dialogContainerStyle","CHAT_HEADER_HEIGHT","height","Logger","warn","onChatChange","created","initTextareaResizeManager","openCopilotChat","loading","contextId","loadChatWithContext","loadChat","then","code","showNotification","loadChatWithMessages","firstError","ResizeManager","onHeightChange","newHeight","onChangeSidebarPanel"],"mappings":"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"}