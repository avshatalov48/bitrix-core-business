this.BX=this.BX||{};(function(e){"use strict";var t=function(){function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);this.ownerId=!!t.ownerId?t.ownerId:0;this.ownerTypeId=!!t.ownerTypeId?t.ownerTypeId:0}babelHelpers.createClass(e,[{key:"progress",value:function t(r){var s=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(!r||r.length<=0){throw new Error("list must be defined")}e.isSuccess=true;this.batchFetch(r,a,n).then(function(t){s.activityAdds(t).then(function(){return s.clientAdds(t).then(function(){return s.dealUpdateContacts(s.ownerId,t).then(function(){return e.getFulfillPromise()},function(){throw new Error("batchFetch dealUpdateContacts Error")})},function(){throw new Error("batchFetch clientAdds Error")})},function(e){return s.continueProcess(e)}).then(function(){return s.nextBatch(t).then(function(){},function(){return e.labelFinish(t)})},function(){throw new Error("progress Error")})},function(){throw new Error("batchFetch Error")})}},{key:"continueProcess",value:function t(r){var s=!!r.errors?r.errors:{};if(Object.values(s).length>0){throw new Error("continueProcess Error")}else{return e.getFulfillPromise()}}},{key:"batchFetch",value:function e(t,r,s){return BX.ajax.runAction("sale.integration.stepper.activityBatch",{data:{list:t,total:r,start:s}})}},{key:"activityAdds",value:function t(r){var s=!!r.data?r.data:{};e.progressBar(s);e.messageBar(s);if(!!s.process){if(Object.values(s.process.items).length>0){return BX.ajax.runAction("sale.integration.scenarios.activityAddsFromOrderList",{data:{params:s.process.items}})}else if(Object.values(s.process.list).length>0){return e.getRejectPromise()}else if(!!s.error&&s.error.length>0){return e.getRejectPromise()}}throw new Error("activityAdds Error")}},{key:"prepareContactFields",value:function e(t){if(!!t.status&&t.status==="success"){var r=!!t.data?t.data:{};if(!!r.process&&Object.values(r.process.items).length>0){return BX.ajax.runAction("sale.integration.scenarios.resolveContactFieldsValuesFromOrderList",{data:{params:r.process.items}})}}throw new Error("clientAdds Error")}},{key:"clientAdds",value:function t(r){var s=this;return this.prepareContactFields(r).then(function(t){return s.contactRelationVoid(t).then(function(t){return s.contactAdds(t).then(function(){return e.getFulfillPromise()},function(){throw new Error("clientAdds contactAdds Error")})},function(){throw new Error("clientAdds contactRelationVoid Error")})},function(){throw new Error("clientAdds prepareContactFields Error")})}},{key:"contactRelationVoid",value:function t(r){if(!!r.status&&r.status==="success"){var s=!!r.data?r.data:{};if(!!s.result&&Object.values(s.result).length>0){return BX.ajax.runAction("sale.integration.scenarios.resolveUserTypeIAfterComparingRemotelyRelationFromOrderList",{data:{params:s.result}})}else{return e.getFulfillPromise(r)}}throw new Error("contactRelationVoid Error")}},{key:"contactAdds",value:function t(r){if(!!r.status&&r.status==="success"){var s=!!r.data?r.data:{};if(!!s.result&&Object.values(s.result).length>0){return BX.ajax.runAction("sale.integration.scenarios.contactAddsFromOrderList",{data:{params:s.result}})}else{return e.getFulfillPromise()}}throw new Error("contactAdds Error")}},{key:"dealUpdateContacts",value:function e(t,r){var s=this;return this.prepareContactFields(r).then(function(e){return s.dealContactItemsUpdate(t,e)},function(){throw new Error("dealUpdateContacts prepareContactFields Error")})}},{key:"dealContactItemsUpdate",value:function t(r,s){var a=this;if(!!s.status&&s.status==="success"){var n=!!s.data?s.data:{};if(!!n.result&&Object.values(n.result).length>0){return this.dealContactItemsGet(r).then(function(e){return a.dealContactAdds(r,{list:s,items:e})},function(){throw new Error("dealUpdateContacts dealContactAdds Error")})}else{return e.getFulfillPromise()}}throw new Error("dealUpdateContacts dealContactItemsUpdate Error")}},{key:"dealContactAdds",value:function e(t,r){var s=!!r.list?r.list:{};var a=!!r.items?r.items:{};if(!!s.status&&s.status==="success"&&!!a.status&&a.status==="success"){var n=!!s.data?s.data:{};var o=!!a.data?a.data:{};if(!!n.result&&!!o.result){if(Object.values(o.result).length>0){return BX.ajax.runAction("sale.integration.scenarios.dealContactUpdates",{data:{id:t,items:n.result,contacts:o.result}})}else{return BX.ajax.runAction("sale.integration.scenarios.dealContactAdds",{data:{id:t,items:n.result}})}}}throw new Error("dealContactAdds Error")}},{key:"dealContactItemsGet",value:function e(t){return BX.ajax.runAction("sale.integration.scenarios.dealContactItemsGet",{data:{id:t}})}},{key:"dealUpdate",value:function e(t){if(!!t.status&&t.status==="success"){var r=!!t.data?t.data:{};if(!!r.process&&r.process.items.length>0){return BX.ajax.runAction("sale.integration.scenarios.dealupdatecontacts",{data:{id:this.ownerId,params:r.process.items}})}}throw new Error("dealUpdate Error")}},{key:"nextBatch",value:function t(r){if(!!r.status&&r.status==="success"){var s=!!r.data?r.data:{};if(!!s.process&&!!s.process.list&&!!s.process.items&&!!s.process.total&&!!s.process.start){if(Object.values(s.process.items).length>0&&Object.values(s.process.list).length>0){this.progress(s.process.list,s.process.total,s.process.start);return e.getFulfillPromise()}if(Object.values(s.process.items).length===0&&Object.values(s.process.list).length>0){this.progress(s.process.list,s.process.total,s.process.start);return e.getFulfillPromise()}else if(Object.values(s.process.list).length<=0){return e.getRejectPromise()}}}throw new Error("nextBatch Error")}}],[{key:"progressBar",value:function t(r){if(!!r.progress){BX.ajax.runAction("sale.integration.stepper.progressbar",{data:{value:r.progress}}).then(function(t){return e.render("progress",t.data)},function(){throw new Error("ProgressBar failure!")})}}},{key:"labelFinish",value:function t(r){var s=!!r.data?r.data:{};if(!!s.finish){BX.ajax.runAction("sale.integration.stepper.messageOK",{}).then(function(t){e.render("finish",t.data);if(e.isSuccess){e.closeApplication()}},function(){throw new Error("MessagebyType OK failure!")})}}},{key:"messageBar",value:function t(r){if(!!r.error){e.isSuccess=false;BX.ajax.runAction("sale.integration.stepper.messagebytype",{data:{message:r.error,type:"ERROR"}}).then(function(e){var t=BX.create("DIV");t.innerHTML=e.data;BX("progress_error").appendChild(t)},function(){throw new Error("MessagebyType ERROR failure!")})}}},{key:"render",value:function e(t,r){BX.adjust(BX(t),{html:r})}},{key:"getFulfillPromise",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var r=new BX.Promise;r.fulfill(t);return r}},{key:"getFulfillPromise_setTimeout",value:function e(){var t=this;var r=new BX.Promise;setTimeout(function(){r.fulfill(t)},2e3);return r}},{key:"getRejectPromise",value:function e(){var t=new BX.Promise;t.reject(this);return t}},{key:"closeApplication",value:function e(){setTimeout(function(){BX24.closeApplication()},500)}}]);return e}();e.Stepper=t})(this.BX.Sale=this.BX.Sale||{});
//# sourceMappingURL=b24integration.bundle.map.js