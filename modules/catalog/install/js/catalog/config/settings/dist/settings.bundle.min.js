this.BX=this.BX||{};this.BX.Catalog=this.BX.Catalog||{};(function(e,t,s,a,i,l,o,r,n,c,d,b,u,p,v,h,g){"use strict";class P{constructor(e){this.url="/bitrix/tools/catalog/product_settings.php";this.stepOptions={ajaxSessionID:"",maxExecutionTime:30,maxOperationCounter:10};this.finish=false;this.currentState={counter:0,operationCounter:0,errorCounter:0,lastID:0};this.ajaxParams={operation:"Y"};this.iblocks=[];this.iblockIndex=-1;this.stepOptions.ajaxSessionID="productSettings";this.currentState.counter=0;this.events=e.events;this.settings=e.settings}nextStep(){for(let e in this.stepOptions){if(this.stepOptions.hasOwnProperty(e)){this.ajaxParams[e]=this.stepOptions[e]}}for(let e in this.currentState){if(this.currentState.hasOwnProperty(e)){this.ajaxParams[e]=this.currentState[e]}}this.ajaxParams.sessid=BX.bitrix_sessid();this.ajaxParams.lang=BX.message("LANGUAGE_ID");BX.ajax.loadJSON(this.url,this.ajaxParams,BX.proxy(this.nextStepResult,this))}nextStepResult(e){if(BX.type.isPlainObject(e)){this.currentState.lastID=e.lastID;this.stepOptions.maxOperationCounter=e.maxOperationCounter;this.currentState.operationCounter=parseInt(e.operationCounter,10);if(isNaN(this.currentState.operationCounter)){this.currentState.operationCounter=0}this.currentState.errorCounter=parseInt(e.errorCounter,10);if(isNaN(this.currentState.errorCounter)){this.currentState.errorCounter=0}if(this.events.onProgress){this.events.onProgress({allCnt:e.allCounter,doneCnt:e.allOperationCounter,currentIblockName:this.iblocks[this.iblockIndex].NAME})}if(this.finish){this.finishOperation()}else{this.checkOperation(e.finishOperation)}}}finishOperation(){this.currentState.operationCounter=0;this.currentState.errorCounter=0;this.currentState.lastID=0;this.finish=false;if(this.events.onComplete){this.events.onComplete()}}startOperation(){BX.ajax.loadJSON(this.url,{sessid:BX.bitrix_sessid(),changeSettings:"Y",...this.settings},BX.proxy(this.changeSettingsResult,this))}changeSettingsResult(e){if(!BX.type.isPlainObject(e)){return}if(e.success==="Y"){this.loadIblockList()}else{this.stopOperation()}}stopOperation(){this.finish=true}checkIblockIndex(){return!(this.iblocks.length===0||this.iblockIndex<0||this.iblockIndex>=this.iblocks.length)}loadIblockList(){BX.ajax.loadJSON(this.url,{sessid:BX.bitrix_sessid(),getIblock:"Y"},(e=>{if(BX.type.isArray(e)){this.iblocks=e;if(this.iblocks.length>0){this.iblockIndex=0;this.iblockReindex()}else{this.stopOperation()}}}))}iblockReindex(){if(this.finish||!this.checkIblockIndex()){return}this.initStep();this.nextStep()}initStep(){this.currentState.iblockId=this.iblocks[this.iblockIndex].ID;this.currentState.counter=this.iblocks[this.iblockIndex].COUNT;this.currentState.operationCounter=0;this.currentState.errorCounter=0;this.currentState.lastID=0}checkOperation(e){if(!!e){this.iblockIndex++;if(this.iblockIndex>=this.iblocks.length||this.currentState.errorCounter>0){this.finishOperation();if(this.currentState.errorCounter==0){this.finalRequest()}}else{this.initStep();this.nextStep()}}else{this.nextStep()}}finalRequest(){let e=[];if(this.iblocks.length>0){for(let t=0;t<this.iblocks.length;t++){e[e.length]=this.iblocks[t].ID}BX.ajax.get(this.url,{sessid:BX.bitrix_sessid(),finalRequest:"Y",iblockList:e})}}}let L=e=>e,_,C,S,T;var F=babelHelpers.classPrivateFieldLooseKey("settings");var f=babelHelpers.classPrivateFieldLooseKey("currentIblockName");var B=babelHelpers.classPrivateFieldLooseKey("allCount");var E=babelHelpers.classPrivateFieldLooseKey("doneCount");var I=babelHelpers.classPrivateFieldLooseKey("onComplete");var O=babelHelpers.classPrivateFieldLooseKey("elements");var H=babelHelpers.classPrivateFieldLooseKey("getProgressWidth");var N=babelHelpers.classPrivateFieldLooseKey("redraw");class m{constructor(e){Object.defineProperty(this,N,{value:A});Object.defineProperty(this,H,{value:y});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:null});Object.defineProperty(this,B,{writable:true,value:0});Object.defineProperty(this,E,{writable:true,value:0});Object.defineProperty(this,I,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:{}});babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.settings;babelHelpers.classPrivateFieldLooseBase(this,I)[I]=e.onComplete;new P({settings:babelHelpers.classPrivateFieldLooseBase(this,F)[F],events:{onProgress:e=>{babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e.currentIblockName;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e.allCnt;babelHelpers.classPrivateFieldLooseBase(this,E)[E]=e.doneCnt;babelHelpers.classPrivateFieldLooseBase(this,N)[N]()},onComplete:()=>{babelHelpers.classPrivateFieldLooseBase(this,I)[I]()}}}).startOperation()}render(){const e=h.Loc.getMessage("CAT_CONFIG_SETTINGS_OUT_OF").replace("#PROCESSED#",babelHelpers.classPrivateFieldLooseBase(this,E)[E]).replace("#TOTAL#",babelHelpers.classPrivateFieldLooseBase(this,B)[B]);babelHelpers.classPrivateFieldLooseBase(this,O)[O].text=h.Tag.render(_||(_=L`
			<div class="ui-progressbar-text-after">
				${0}
			</div>
		`),e);babelHelpers.classPrivateFieldLooseBase(this,O)[O].currentIblock=h.Tag.render(C||(C=L`
			<div style="padding-top: 10px;">
			</div>
		`));babelHelpers.classPrivateFieldLooseBase(this,O)[O].progressBar=h.Tag.render(S||(S=L`
			<div class="ui-progressbar-bar"></div>
		`));h.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,O)[O].progressBar,"width",babelHelpers.classPrivateFieldLooseBase(this,H)[H]());return h.Tag.render(T||(T=L`
			<div>
				<div class="ui-progressbar ui-progressbar-column">
					<div style="font-weight: bold;" class="ui-progressbar-text-before">
						${0}
					</div>
					<div class="ui-progressbar-track">
						${0}
					</div>
					${0}
				</div>
				<div style="color: rgb(83, 92, 105); font-size: 12px;">
					${0}
					${0}
				</div>
			</div>
		`),h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_SETTINGS_UPDATE_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,O)[O].progressBar,babelHelpers.classPrivateFieldLooseBase(this,O)[O].text,h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_SETTINGS_UPDATE_WAIT"),babelHelpers.classPrivateFieldLooseBase(this,O)[O].currentIblock)}}function y(){let e=0;if(babelHelpers.classPrivateFieldLooseBase(this,B)[B]>0){e=Math.round(babelHelpers.classPrivateFieldLooseBase(this,E)[E]/babelHelpers.classPrivateFieldLooseBase(this,B)[B]*100)}return`${e}%`}function A(){babelHelpers.classPrivateFieldLooseBase(this,O)[O].text.innerHTML=h.Loc.getMessage("CAT_CONFIG_SETTINGS_OUT_OF").replace("#PROCESSED#",babelHelpers.classPrivateFieldLooseBase(this,E)[E]).replace("#TOTAL#",babelHelpers.classPrivateFieldLooseBase(this,B)[B]);babelHelpers.classPrivateFieldLooseBase(this,O)[O].currentIblock.innerHTML=h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_SETTINGS_CURRENT_CATALOG").replace("#CATALOG_NAME#",babelHelpers.classPrivateFieldLooseBase(this,f)[f]);h.Dom.style(babelHelpers.classPrivateFieldLooseBase(this,O)[O].progressBar,"width",babelHelpers.classPrivateFieldLooseBase(this,H)[H]())}var M=babelHelpers.classPrivateFieldLooseKey("parentPage");var w=babelHelpers.classPrivateFieldLooseKey("costPriceCalculationParams");class D{constructor(e){Object.defineProperty(this,M,{writable:true,value:void 0});Object.defineProperty(this,w,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,w)[w]=e.costPriceCalculationParams;babelHelpers.classPrivateFieldLooseBase(this,M)[M]=e.parentPage}buildSection(){const e=new b.Section({title:h.Loc.getMessage("CAT_CONFIG_SETTINGS_COST_PRICE_CALCULATION_SECTION_TITLE"),titleIconClasses:"ui-icon-set --numbered-list",isOpen:true});const t=new c.SettingsSection({parent:babelHelpers.classPrivateFieldLooseBase(this,M)[M],section:e});e.append(new b.Row({content:new n.Alert({text:`\n\t\t\t\t\t\t\t${h.Loc.getMessage("CAT_CONFIG_SETTINGS_COST_PRICE_CALCULATION_SECTION_HINT")}\n\t\t\t\t\t\t\t<a class="ui-section__link" onclick="top.BX.Helper.show('redirect=detail&code=17858278')">\n\t\t\t\t\t\t\t\t${h.Loc.getMessage("INTRANET_SETTINGS_CANCEL_MORE")}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t`,inline:true,size:n.AlertSize.SMALL,color:n.AlertColor.PRIMARY}).getContainer()}).render());const s=new d.Selector({label:h.Loc.getMessage("CAT_CONFIG_SETTINGS_COST_PRICE_CALCULATION_METHOD"),name:"costPriceCalculationMethod",items:babelHelpers.classPrivateFieldLooseBase(this,w)[w].items,hints:babelHelpers.classPrivateFieldLooseBase(this,w)[w].hints,isFieldDisabled:true});s.getInputNode().setAttribute("required","required");h.Event.bind(s.getInputNode(),"change",(()=>{const t=new n.Alert({text:`\n\t\t\t\t\t${h.Loc.getMessage("CAT_CONFIG_SETTINGS_COST_PRICE_CALCULATION_SECTION_WARNING")}\n\t\t\t\t\t<a class="ui-section__link" onclick="top.BX.Helper.show('redirect=detail&code=17858278')">\n\t\t\t\t\t\t${h.Loc.getMessage("INTRANET_SETTINGS_CANCEL_MORE")}\n\t\t\t\t\t</a>\n\t\t\t\t`,inline:true,size:n.AlertSize.SMALL,color:n.AlertColor.WARNING}).getContainer();const s=new b.Row({content:t}).render();e.prepend(s)}));new c.SettingsRow({parent:t,child:new c.SettingsField({fieldView:s})});return t}}let R=e=>e,G,k;var x=babelHelpers.classPrivateFieldLooseKey("isInventoryManagementEnabled");var U=babelHelpers.classPrivateFieldLooseKey("is1cRestricted");var j=babelHelpers.classPrivateFieldLooseKey("currentMode");var K=babelHelpers.classPrivateFieldLooseKey("onecStatusUrl");var X=babelHelpers.classPrivateFieldLooseKey("rootElement");var V=babelHelpers.classPrivateFieldLooseKey("refreshAppLink");var $=babelHelpers.classPrivateFieldLooseKey("refreshStatus");var W=babelHelpers.classPrivateFieldLooseKey("render");var Y=babelHelpers.classPrivateFieldLooseKey("getSettingsLinkElement");class z{constructor(e){Object.defineProperty(this,Y,{value:J});Object.defineProperty(this,W,{value:q});Object.defineProperty(this,$,{value:Z});Object.defineProperty(this,V,{value:Q});Object.defineProperty(this,x,{writable:true,value:void 0});Object.defineProperty(this,U,{writable:true,value:void 0});Object.defineProperty(this,j,{writable:true,value:void 0});Object.defineProperty(this,K,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,x)[x]=e.isInventoryManagementEnabled;babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e.is1cRestricted;babelHelpers.classPrivateFieldLooseBase(this,j)[j]=e.currentMode;babelHelpers.classPrivateFieldLooseBase(this,K)[K]=e.onecStatusUrl;babelHelpers.classPrivateFieldLooseBase(this,X)[X]=h.Tag.render(G||(G=R`
			<div id="inventoryManagementStatus">
			</div>
		`))}initialize(){let e="";let t="";let s="";if(babelHelpers.classPrivateFieldLooseBase(this,j)[j]===v.ModeList.MODE_1C){if(babelHelpers.classPrivateFieldLooseBase(this,x)[x]){e=h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_STATUS_CHECKING");t=l.LabelColor.LIGHT;s="loading";a.ExternalCatalogPlacement.create().initialize().then((()=>{this.update({text:h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_STATUS_CONNECTED"),color:l.LabelColor.LIGHT_GREEN})})).catch((()=>{this.update({text:h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_STATUS_1C_NOT_CONNECTED"),color:l.LabelColor.LIGHT_RED})}))}else{e=h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_STATUS_1C_NOT_CONNECTED");t=l.LabelColor.LIGHT}}const i=new l.Label({text:e,color:t,size:l.LabelSize.LG,fill:true,status:s});babelHelpers.classPrivateFieldLooseBase(this,W)[W](i);return babelHelpers.classPrivateFieldLooseBase(this,X)[X]}update({text:e,color:t}){if(!babelHelpers.classPrivateFieldLooseBase(this,X)[X]){return}const s=new l.Label({text:e,color:t,size:l.LabelSize.LG,fill:true});babelHelpers.classPrivateFieldLooseBase(this,W)[W](s)}}function Q(){h.ajax.runComponentAction("bitrix:catalog.config.settings","refreshAppLink",{mode:"class"}).then((e=>{if(!e.data){return}babelHelpers.classPrivateFieldLooseBase(this,K)[K]=e.data}))}function Z(){a.ExternalCatalogPlacement.create().reset()}function q(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]();const s=e.render();let a=()=>{};if(babelHelpers.classPrivateFieldLooseBase(this,U)[U]){a=e=>{e.preventDefault();i.OneCPlanRestrictionSlider.show()}}else if(babelHelpers.classPrivateFieldLooseBase(this,K)[K].type==="app"){a=e=>{e.preventDefault();top.BX.rest.AppLayout.openApplication(babelHelpers.classPrivateFieldLooseBase(this,K)[K].value,{source:"inventory-management"},false,(()=>{babelHelpers.classPrivateFieldLooseBase(this,$)[$]();this.initialize()}))}}else{a=e=>{e.preventDefault();BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldLooseBase(this,K)[K].value,{customLeftBoundary:0,cacheable:false,loader:"market:detail",width:1162,events:{onClose:()=>{babelHelpers.classPrivateFieldLooseBase(this,V)[V]();babelHelpers.classPrivateFieldLooseBase(this,$)[$]();this.initialize()}}})}}h.Event.bind(t,"click",a);h.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,X)[X]);h.Dom.append(s,babelHelpers.classPrivateFieldLooseBase(this,X)[X]);h.Dom.append(t,babelHelpers.classPrivateFieldLooseBase(this,X)[X])}function J(){const e=babelHelpers.classPrivateFieldLooseBase(this,U)[U]?'<span class="tariff-lock"></span>':"";return h.Tag.render(k||(k=R`
			<span class="catalog-settings-inventory-management-mode-settings-container">
				${0}
				<a href="${0}" class="catalog-settings-inventory-management-mode-settings" data-slider-ignore-autobinding="true">
					${0}
				</a>
			</span>
		`),e,babelHelpers.classPrivateFieldLooseBase(this,K)[K].value,h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_STATUS_SETTINGS"))}let ee=e=>e,te,se,ae,ie;var le=babelHelpers.classPrivateFieldLooseKey("parentPage");var oe=babelHelpers.classPrivateFieldLooseKey("inventoryManagementParams");var re=babelHelpers.classPrivateFieldLooseKey("configCatalogSource");var ne=babelHelpers.classPrivateFieldLooseKey("inventoryManagementDisabler");var ce=babelHelpers.classPrivateFieldLooseKey("getCurrentModeBlock");var de=babelHelpers.classPrivateFieldLooseKey("sendEvent");var be=babelHelpers.classPrivateFieldLooseKey("getHelpLink");class ue{constructor(e){Object.defineProperty(this,be,{value:he});Object.defineProperty(this,de,{value:ve});Object.defineProperty(this,ce,{value:pe});Object.defineProperty(this,le,{writable:true,value:void 0});Object.defineProperty(this,oe,{writable:true,value:void 0});Object.defineProperty(this,re,{writable:true,value:null});Object.defineProperty(this,ne,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,le)[le]=e.parentPage;babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=e.inventoryManagementParams;babelHelpers.classPrivateFieldLooseBase(this,re)[re]=e.configCatalogSource;babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=new v.Disabler({hasConductedDocumentsOrQuantities:babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].hasConductedDocumentsOrQuantities,events:{onDisabled:()=>{babelHelpers.classPrivateFieldLooseBase(this,le)[le].onInventoryManagementModeChanged({isEnabled:false,mode:v.ModeList.MODE_B24})}}})}buildSection(){const e=new b.Section({title:h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_SECTION_TITLE"),titleIconClasses:"ui-icon-set --settings",isOpen:true});const t=new c.SettingsSection({parent:babelHelpers.classPrivateFieldLooseBase(this,le)[le],section:e});e.append(new b.Row({content:babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]()}).render());return t}openInventoryManagementSlider(){let e="/bitrix/components/bitrix/catalog.store.enablewizard/slider.php";if(babelHelpers.classPrivateFieldLooseBase(this,re)[re]){e+=`?inventoryManagementSource=${babelHelpers.classPrivateFieldLooseBase(this,re)[re]}`}(new v.EnableWizardOpener).open(e,{urlParams:{analyticsContextSection:v.AnalyticsContextList.SETTINGS}}).then((e=>{if(!e){return}const t=e.getData().get("isInventoryManagementEnabled");const a=e.getData().get("inventoryManagementMode");if(t!==undefined&&t!==babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].isEnabled||a!==undefined&&a!==babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].currentMode){var i;babelHelpers.classPrivateFieldLooseBase(this,le)[le].onInventoryManagementModeChanged({isEnabled:t,mode:a});(i=document.querySelector(".catalog-settings-inventory-management-mode-wrapper"))==null?void 0:i.scrollIntoView();if(babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].isEnabled&&t&&a!==babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].currentMode){s.UI.Notification.Center.notify({content:h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_CHANGED")});babelHelpers.classPrivateFieldLooseBase(this,le)[le].updateDataAfterSave()}}}))}}function pe(){const e=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].isEnabled;const t=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].currentMode;const s=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].is1cRestricted;let a="";if(t===v.ModeList.MODE_1C){a=h.Tag.render(te||(te=ee`
				<div class="catalog-settings-inventory-management-mode-external-logo"></div>
			`))}else{a=h.Loc.getMessage("CAT_CONFIG_SETTINGS_B24_LOGO").replace("[color]",'<span class="catalog-settings-inventory-management-mode-b24-numbers">').replace("[/color]","</span>");a=h.Tag.render(se||(se=ee`
				<span class="catalog-settings-inventory-management-mode-b24-name">${0}</span>
			`),a)}const i=new r.Button({text:h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_CHANGE"),color:r.ButtonColor.LIGHT,onclick:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,de)[de]("disable_clicked");this.openInventoryManagementSlider()}});const l=new r.Button({text:e?h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_DISABLE"):h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_ENABLE"),color:e?r.ButtonColor.LIGHT:r.ButtonColor.PRIMARY,onclick:(t,s)=>{if(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de]("change_mode_clicked");babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].open()}else{this.openInventoryManagementSlider()}},round:!e});const o=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].availableModes.includes(v.ModeList.MODE_1C)&&e;let n=h.Loc.getMessage("CAT_CONFIG_SETTINGS_B24_MODE_DESCRIPTION");let c="catalog-settings-inventory-management-mode-description";if(t===v.ModeList.MODE_1C){const a=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].onecStatusUrl;n=new z({currentMode:t,isInventoryManagementEnabled:e,onecStatusUrl:a,is1cRestricted:s}).initialize();c="catalog-settings-inventory-management-mode-status"}return h.Tag.render(ae||(ae=ee`
			<div>
				<div class="catalog-settings-inventory-management-mode-wrapper">
					<div class="catalog-settings-inventory-management-mode-inner">
						<div class="catalog-settings-inventory-management-mode-selected ${0}">
							<div class="catalog-settings-inventory-management-mode-name">${0}</div>
							<div class="${0}">
								${0}
							</div>
						</div>
						<div class="catalog-settings-inventory-management-mode-buttons">
							${0}
							${0}
						</div>
					</div>
				</div>
				<div>
					<p class="catalog-settings-inventory-management-mode-warning">
						${0}
					</p>
					${0}
				</div>
			</div>
		`),e?"":"--disabled",a,c,n,o?i.render():"",l.render(),h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_CHANGE_WARNING").replace("[break]","<br/>"),babelHelpers.classPrivateFieldLooseBase(this,be)[be]())}function ve(e){h.Runtime.loadExtension("ui.analytics").then((t=>{const{sendData:s}=t;s({tool:"inventory",category:"settings",c_section:"settings",p1:`mode_${babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].currentMode}`,event:e})}))}function he(){const e=h.Tag.render(ie||(ie=ee`
			<a class="catalog-settings-inventory-management-mode-help ui-section__link">
				${0}
			</a>
		`),h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_HELP"));h.Event.bind(e,"click",(()=>{if(top.BX&&top.BX.Helper){const e=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].availableModes.length>1?"20233748":"15992592";top.BX.Helper.show(`redirect=detail&code=${e}`)}}));return e}let ge=e=>e,Pe,Le;var _e=babelHelpers.classPrivateFieldLooseKey("parentPage");var Ce=babelHelpers.classPrivateFieldLooseKey("values");var Se=babelHelpers.classPrivateFieldLooseKey("showQuantityTracePopup");var Te=babelHelpers.classPrivateFieldLooseKey("showNewCardPopup");var Fe=babelHelpers.classPrivateFieldLooseKey("createWarningProductCardPopupForBitrix24");var fe=babelHelpers.classPrivateFieldLooseKey("createWarningProductCardPopupForBUS");var Be=babelHelpers.classPrivateFieldLooseKey("createWarningProductCardPopup");class Ee{constructor(e){Object.defineProperty(this,Be,{value:me});Object.defineProperty(this,fe,{value:Ne});Object.defineProperty(this,Fe,{value:He});Object.defineProperty(this,Te,{value:Oe});Object.defineProperty(this,Se,{value:Ie});Object.defineProperty(this,_e,{writable:true,value:void 0});Object.defineProperty(this,Ce,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]=e.parentPage;babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=e.values}buildSection(){const e=new c.SettingsSection({parent:babelHelpers.classPrivateFieldLooseBase(this,_e)[_e],section:{title:h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCTS_SECTION_TITLE"),titleIconClasses:"ui-icon-set --cubes-3",isOpen:true}});new c.SettingsRow({parent:e,child:new c.SettingsField({fieldView:new d.Checker({inputName:"defaultSubscribe",title:h.Loc.getMessage("CAT_CONFIG_SETTINGS_DEFAULT_SUBSCRIBE"),checked:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].defaultSubscribe==="Y"})})});const t=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].isEnabledInventoryManagement;const s=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].costPriceCalculationMethod.current==="";const a=t&&s;if(a){new c.SettingsRow({parent:e,child:new c.SettingsField({fieldView:new d.Checker({inputName:"checkRightsOnDecreaseStoreAmount",title:h.Loc.getMessage("CAT_CONFIG_SETTINGS_DEFAULT_CAN_BUY_ZERO_IN_DOCS"),checked:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].checkRightsOnDecreaseStoreAmount==="Y",hintOn:h.Loc.getMessage("CAT_CONFIG_SETTINGS_DEFAULT_CAN_BUY_ZERO_IN_DOCS_HINT").replace("[link]",'<a class="ui-section__link" onclick="top.BX.Helper.show(\'redirect=detail&code=15706692&anchor=products\')">').replace("[/link]","</a>")})})})}new c.SettingsRow({parent:e,child:new c.SettingsField({fieldView:new d.Checker({inputName:"defaultProductVatIncluded",title:h.Loc.getMessage("CAT_CONFIG_SETTINGS_SET_VAT_IN_PRICE_FOR_NEW_PRODUCTS"),checked:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].defaultProductVatIncluded==="Y"})})});const i=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].isReservationUsed&&babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].hasAccessToChangeCanBuyZero;if(i){new c.SettingsRow({parent:e,child:new c.SettingsField({fieldView:new d.Checker({inputName:"defaultCanBuyZero",title:h.Loc.getMessage("CAT_CONFIG_SETTINGS_DEFAULT_CAN_BUY_ZERO"),checked:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].defaultCanBuyZero==="Y",hintOn:h.Loc.getMessage("CAT_CONFIG_SETTINGS_DEFAULT_CAN_BUY_ZERO_HINT")})})})}const l=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].defaultQuantityTrace;const o=l==="Y"&&!t;if(o){const t=new d.Checker({inputName:"defaultQuantityTrace",title:h.Loc.getMessage("CAT_CONFIG_SETTINGS_DEFAULT_QUANTITY_TRACE"),checked:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].defaultQuantityTrace==="Y"});new c.SettingsRow({parent:e,child:new c.SettingsField({fieldView:t})});g.EventEmitter.subscribe(t.switcher,"toggled",(()=>{if(t.isChecked()){return}babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]()}))}if(babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].canEnableProductCardSlider){const t=new d.Checker({inputName:"productCardSliderEnabled",title:h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_CARD_ENABLE_NEW_CARD"),checked:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].productCardSliderEnabled==="Y"});new c.SettingsRow({parent:e,child:new c.SettingsField({fieldView:t})});g.EventEmitter.subscribe(t.switcher,"toggled",(()=>{if(!t.isChecked()){return}babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](t)}))}Object.keys(babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].vats.hints).forEach((e=>{babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].vats.hints[e]=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].vats.hints[e].replace("#MORE_DETAILS#",`\n\t\t\t\t<a class="ui-section__link"\n\t\t\t\t\tonclick="top.BX.Helper.show('redirect=detail&code=15706692&anchor=products')">${h.Loc.getMessage("CAT_CONFIG_SETTINGS_MODE_HELP")}</a>\n\t\t\t`)}));const r=new d.Selector({label:h.Loc.getMessage("CAT_CONFIG_SETTINGS_DEFAULT_VAT"),name:"defaultProductVatId",items:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].vats.items,hints:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].vats.hints});new c.SettingsRow({parent:e,child:new c.SettingsField({fieldView:r})});return e}updateValues(e){Object.assign(babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce],e)}}function Ie(){const e=new o.Popup(null,null,{events:{onPopupClose:()=>e.destroy()},content:h.Tag.render(Pe||(Pe=ge`
				<div class="catalog-settings-popup-content">
					<h3>
						${0}
					</h3>
					<div class="catalog-settings-popup-text">
						${0}
					</div>
				</div>
			`),h.Loc.getMessage("CAT_CONFIG_SETTINGS_TURN_OFF_QUANTITY_TRACE_TITLE"),h.Loc.getMessage("CAT_CONFIG_SETTINGS_TURN_OFF_QUANTITY_TRACE_TEXT")),maxWidth:500,overlay:true,buttons:[new r.Button({text:h.Loc.getMessage("CAT_CONFIG_SETTINGS_CLOSE"),color:r.Button.Color.PRIMARY,onclick:()=>e.close()})]});e.show()}function Oe(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].isBitrix24==="Y"?babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](e):babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e);t.show()}function He(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_CARD_ENABLE_NEW_CARD_ASK_TEXT"),[new r.Button({text:h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_CARD_ENABLE_NEW_CARD_ASK_DISAGREE"),color:r.Button.Color.PRIMARY,onclick:()=>{e.switcher.toggle();t.close()}}),new r.Button({text:h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_CARD_ENABLE_NEW_CARD_ASK_AGREE"),onclick:()=>t.close()})],{onPopupShow:()=>{const e=document.getElementById("catalog-settings-new-productcard-popup-helpdesk");if(e){h.Event.bind(e,"click",(()=>top.BX.Helper.show("redirect=detail&code=11657084")))}}});return t}function Ne(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_CARD_ENABLE_NEW_CARD_ASK_BUS_TEXT").replace("#HELP_LINK#",babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].busProductCardHelpLink),[new r.Button({text:h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_CARD_ENABLE_NEW_CARD_ASK_AGREE"),color:r.Button.Color.SUCCESS,onclick:()=>t.close()}),new r.Button({text:h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_CARD_ENABLE_NEW_CARD_ASK_BUS_DISAGREE"),color:r.Button.Color.LINK,onclick:()=>{e.switcher.toggle();t.close()}})]);return t}function me(e,t,s={}){const a={events:{onPopupClose:()=>i.destroy(),...s},content:h.Tag.render(Le||(Le=ge`
				<div class="catalog-settings-new-productcard-popup-content">
					${0}
				</div>
			`),e),className:"catalog-settings-new-productcard-popup",titleBar:h.Loc.getMessage("CAT_CONFIG_SETTINGS_PRODUCT_CARD_ENABLE_NEW_CARD_ASK_TITLE"),maxWidth:800,overlay:true,buttons:t};const i=new o.Popup(null,null,a);return i}let ye=e=>e,Ae,Me,we;var De=babelHelpers.classPrivateFieldLooseKey("mode");var Re=babelHelpers.classPrivateFieldLooseKey("period");var Ge=babelHelpers.classPrivateFieldLooseKey("getModeSelectorClasses");var ke=babelHelpers.classPrivateFieldLooseKey("buildModeSelector");var xe=babelHelpers.classPrivateFieldLooseKey("getPeriodClasses");var Ue=babelHelpers.classPrivateFieldLooseKey("buildPeriodInput");class je extends d.BaseField{constructor(e){super(e);Object.defineProperty(this,Ue,{value:$e});Object.defineProperty(this,xe,{value:Ve});Object.defineProperty(this,ke,{value:Xe});Object.defineProperty(this,Ge,{value:Ke});Object.defineProperty(this,De,{writable:true,value:void 0});Object.defineProperty(this,Re,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,De)[De]=e.mode;babelHelpers.classPrivateFieldLooseBase(this,Re)[Re]=e.period}prefixId(){return"reservation_"}renderContentField(){return h.Tag.render(Ae||(Ae=ye`
			<div id="${0}" class="ui-section__field-selector --field-separator">
				<div class="ui-section__field-container">
					<div class="ui-section__field-inline-box">
						<label class="ui-section__field-label" for="${0}">${0}</label> 
						<div class="ui-section__field-inline-label-separator"></div>
						<label class="ui-section__field-label" for="${0}">${0}</label>
					</div>
					<div class="ui-section__field-inline-box">
						<div class="ui-section__field">
							<div class="${0}">
								<div class="ui-ctl-after ui-ctl-icon-angle"></div>
								${0}
							</div>
						</div>
						<div class="ui-section__field-inline-separator"></div>
						<div class="${0}">
							${0}
						</div>
					</div>
				</div>
			</div>
		`),this.getId(),babelHelpers.classPrivateFieldLooseBase(this,De)[De].fieldName,babelHelpers.classPrivateFieldLooseBase(this,De)[De].setting.name,babelHelpers.classPrivateFieldLooseBase(this,Re)[Re].fieldName,babelHelpers.classPrivateFieldLooseBase(this,Re)[Re].setting.name,babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge](),babelHelpers.classPrivateFieldLooseBase(this,ke)[ke](),babelHelpers.classPrivateFieldLooseBase(this,xe)[xe](),babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]())}}function Ke(){let e="ui-ctl ui-ctl-w100 ui-ctl-after-icon ui-ctl-dropdown";if(babelHelpers.classPrivateFieldLooseBase(this,De)[De].setting.disabled){e+=" ui-ctl-disabled"}return e}function Xe(){const e=[];for(const{code:t,name:s}of babelHelpers.classPrivateFieldLooseBase(this,De)[De].setting.values){let a="";if(t===babelHelpers.classPrivateFieldLooseBase(this,De)[De].value){a="selected"}e.push(h.Tag.render(Me||(Me=ye`<option ${0} value="${0}">${0}</option>`),a,t,s))}const t=h.Dom.create("select",{attrs:{class:"ui-ctl-element",disabled:babelHelpers.classPrivateFieldLooseBase(this,De)[De].setting.disabled},children:e});t.name=babelHelpers.classPrivateFieldLooseBase(this,De)[De].fieldName;return t}function Ve(){let e="ui-section__hint";if(babelHelpers.classPrivateFieldLooseBase(this,Re)[Re].setting.disabled){e+=" ui-ctl-disabled"}return e}function $e(){const e=h.Tag.render(we||(we=ye`
			<input
				value="${0}"
				name="${0}"
				type="text"
				class="ui-ctl-element"
			>
		`),h.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,Re)[Re].value),babelHelpers.classPrivateFieldLooseBase(this,Re)[Re].fieldName);if(babelHelpers.classPrivateFieldLooseBase(this,Re)[Re].setting.disabled){e.disabled=true}return e}var We=babelHelpers.classPrivateFieldLooseKey("reservationEntities");var Ye=babelHelpers.classPrivateFieldLooseKey("parentPage");class ze{constructor(e){Object.defineProperty(this,We,{writable:true,value:void 0});Object.defineProperty(this,Ye,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,We)[We]=e.reservationEntities;babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=e.parentPage}buildSection(){var e;const t=new b.Section({title:h.Loc.getMessage("CAT_CONFIG_SETTINGS_RESERVATION_SECTION_TITLE"),titleIconClasses:"ui-icon-set --proposal-settings",isOpen:true});const s=new c.SettingsSection({parent:babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye],section:t});const a=(e=babelHelpers.classPrivateFieldLooseBase(this,We)[We][0])==null?void 0:e.settings;if(!a){return s}t.append(new b.Row({content:new n.Alert({text:`\n\t\t\t\t\t\t${h.Loc.getMessage("CAT_CONFIG_SETTINGS_RESERVATION_SECTION_DESCRIPTION")}\n\t\t\t\t\t\t<a class="ui-section__link" onclick="top.BX.Helper.show('redirect=detail&code=15706692&anchor=reservation')">\n\t\t\t\t\t\t\t${h.Loc.getMessage("INTRANET_SETTINGS_CANCEL_MORE")}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t`,inline:true,size:n.AlertSize.SMALL,color:n.AlertColor.PRIMARY}).getContainer()}).render());const i=ze.MODE_FIELD_NAME;const l=a.scheme.find((e=>e.code==="mode"));const o=a.values.mode;const r=ze.PERIOD_FIELD_NAME;const u=a.scheme.find((e=>e.code==="period"));const p=a.values.period;new c.SettingsRow({row:{separator:"bottom",className:"--block"},parent:s,child:new c.SettingsField({fieldView:new je({mode:{fieldName:i,setting:l,value:o},period:{fieldName:r,setting:u,value:p}})})});const v=a.scheme.find((e=>e.code==="autoWriteOffOnFinalize"));const g=a.values.autoWriteOffOnFinalize;const P=new d.Checker({inputName:ze.AUTO_WRITE_OFF_FIELD_NAME,title:v.name,checked:g,hintOn:v.description,isFieldDisabled:v.disabled,hideSeparator:true});new c.SettingsRow({parent:s,child:new c.SettingsField({fieldView:P})});return s}}ze.MODE_FIELD_NAME="reservationSettings[deal][mode]";ze.PERIOD_FIELD_NAME="reservationSettings[deal][period]";ze.AUTO_WRITE_OFF_FIELD_NAME="reservationSettings[deal][autoWriteOffOnFinalize]";let Qe=e=>e,Ze,qe;var Je=babelHelpers.classPrivateFieldLooseKey("productUpdaterPopup");var et=babelHelpers.classPrivateFieldLooseKey("initialData");var tt=babelHelpers.classPrivateFieldLooseKey("slider");var st=babelHelpers.classPrivateFieldLooseKey("getDataForSaving");var at=babelHelpers.classPrivateFieldLooseKey("save");var it=babelHelpers.classPrivateFieldLooseKey("resetSaveButton");var lt=babelHelpers.classPrivateFieldLooseKey("onSaveSuccess");var ot=babelHelpers.classPrivateFieldLooseKey("saveProductSettings");var rt=babelHelpers.classPrivateFieldLooseKey("didProductSettingsChange");var nt=babelHelpers.classPrivateFieldLooseKey("needProgressBarOnProductsUpdating");var ct=babelHelpers.classPrivateFieldLooseKey("buildReservationSection");var dt=babelHelpers.classPrivateFieldLooseKey("buildCostPriceCalculationSection");var bt=babelHelpers.classPrivateFieldLooseKey("buildProductsSection");var ut=babelHelpers.classPrivateFieldLooseKey("buildModeSection");var pt=babelHelpers.classPrivateFieldLooseKey("showNegativeBalancePopupIfNeeded");var vt=babelHelpers.classPrivateFieldLooseKey("isReservationUsed");var ht=babelHelpers.classPrivateFieldLooseKey("isStoreBatchUsed");var gt=babelHelpers.classPrivateFieldLooseKey("convertFormDataToObjectData");class Pt extends c.BaseSettingsPage{constructor(){super();Object.defineProperty(this,gt,{value:yt});Object.defineProperty(this,ht,{value:mt});Object.defineProperty(this,vt,{value:Nt});Object.defineProperty(this,pt,{value:Ht});Object.defineProperty(this,ut,{value:Ot});Object.defineProperty(this,bt,{value:It});Object.defineProperty(this,dt,{value:Et});Object.defineProperty(this,ct,{value:Bt});Object.defineProperty(this,nt,{value:ft});Object.defineProperty(this,rt,{value:Ft});Object.defineProperty(this,ot,{value:Tt});Object.defineProperty(this,lt,{value:St});Object.defineProperty(this,it,{value:Ct});Object.defineProperty(this,at,{value:_t});Object.defineProperty(this,st,{value:Lt});Object.defineProperty(this,Je,{writable:true,value:null});Object.defineProperty(this,et,{writable:true,value:{}});Object.defineProperty(this,tt,{writable:true,value:null});this.titlePage=h.Loc.getMessage("CAT_CONFIG_SETTINGS_TITLE");this.descriptionPage=h.Loc.getMessage("CAT_CONFIG_SETTINGS_DESCRIPTION");g.EventEmitter.subscribe(g.EventEmitter.GLOBAL_TARGET,"button-click",(e=>{babelHelpers.classPrivateFieldLooseBase(this,at)[at]()}));babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=BX.SidePanel.Instance.getTopSlider()}static init(e){const t=new Pt;t.setData(e);babelHelpers.classPrivateFieldLooseBase(t,et)[et]=e;const s=Boolean(e.hasAccessToCatalogSettings)||Boolean(e.hasAccessToReservationSettings);t.setPermission({canRead:()=>s,canEdit:()=>s});return t}onChange(){BX.UI.ButtonPanel.show()}getType(){return"catalog"}appendSections(e){if(babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]()&&this.getValue("hasAccessToReservationSettings")){const t=babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]();t.renderTo(e)}if(babelHelpers.classPrivateFieldLooseBase(this,ht)[ht]()&&this.getValue("hasAccessToCatalogSettings")){const t=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]();t.renderTo(e)}if(this.getValue("hasAccessToCatalogSettings")){const t=babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]();t.renderTo(e);const s=babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]();s.renderTo(e)}}onInventoryManagementModeChanged({isEnabled:e,mode:t}){var s;if(babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]){babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].getData().set("isInventoryManagementChanged",true);if(t){babelHelpers.classPrivateFieldLooseBase(this,tt)[tt].getData().set("inventoryManagementMode",t);if(t===v.ModeList.MODE_1C){babelHelpers.classPrivateFieldLooseBase(this,et)[et].is1cRestricted=false}}}babelHelpers.classPrivateFieldLooseBase(this,et)[et].isEnabledInventoryManagement=e;if(t&&(s=this.getValue("storeControlAvailableModes"))!=null&&s.includes(t)){babelHelpers.classPrivateFieldLooseBase(this,et)[et].storeControlMode=t}babelHelpers.classPrivateFieldLooseBase(this,et)[et].defaultQuantityTrace=e?"Y":"N";this.setData(babelHelpers.classPrivateFieldLooseBase(this,et)[et])}updateDataAfterSave(){this.setData(babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]())}}function Lt(){return BX.ajax.prepareForm(this.getFormNode()).data}function _t(){const e=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]();if(e){return}babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]().then((()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,st)[st]();return h.ajax.runComponentAction("bitrix:catalog.config.settings","save",{mode:"class",data:{data:e}})})).then(babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].bind(this))}function Ct(){const e=document.getElementById("ui-button-panel-save");h.Dom.removeClass(e,"ui-btn-wait")}function St(){BX.UI.ButtonPanel.hide();babelHelpers.classPrivateFieldLooseBase(this,it)[it]();this.updateDataAfterSave();BX.SidePanel.Instance.postMessage(window,"BX.Crm.Config.Catalog:onAfterSaveSettings")}function Tt(){if(!babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]()){return Promise.resolve()}const e=babelHelpers.classPrivateFieldLooseBase(this,st)[st]();const t={settings:{default_quantity_trace:e.defaultQuantityTrace,default_can_buy_zero:e.defaultCanBuyZero,default_subscribe:e.defaultSubscribe}};return new Promise((e=>{t.onComplete=()=>{e();if(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]()){babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].destroy()}};const s=new m(t).render();if(babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]()){babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=new o.Popup({content:s,width:310,overlay:true,padding:17,animation:"fading-slide",angle:false});babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].show()}}))}function Ft(){const e=babelHelpers.classPrivateFieldLooseBase(this,st)[st]();const t=["defaultQuantityTrace","defaultCanBuyZero","defaultSubscribe","checkRightsOnDecreaseStoreAmount"];const s=t.find((t=>e[t]!==undefined&&e[t]!==this.getValue(t)));const a=e.costPriceCalculationMethod!==undefined&&e.costPriceCalculationMethod!==this.getValue("costPriceCalculationMethod").current;return Boolean(s)||a}function ft(){return this.getValue("productsCount")>500}function Bt(){const e=this.getValue("storeControlMode");const t=this.getValue("reservationEntities");for(const s of t){for(const t of s.settings.scheme){if(["mode","period"].includes(t.code)){t.disabled=e===v.ModeList.MODE_1C}}if(e===v.ModeList.MODE_1C){s.settings.values.mode="onAddToDocument"}}const s=new ze({parentPage:this,reservationEntities:t});return s.buildSection()}function Et(){const e=new D({parentPage:this,costPriceCalculationParams:this.getValue("costPriceCalculationMethod")});return e.buildSection()}function It(){const e={};["defaultSubscribe","isEnabledInventoryManagement","costPriceCalculationMethod","checkRightsOnDecreaseStoreAmount","defaultProductVatIncluded","defaultCanBuyZero","defaultQuantityTrace","canEnableProductCardSlider","isBitrix24","productCardSliderEnabled","showNegativeStoreAmountPopup","storeBalancePopupLink","hasAccessToChangeCanBuyZero","busProductCardHelpLink","vats"].forEach((t=>{e[t]=this.getValue(t)}));e.isReservationUsed=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]();const t=new Ee({parentPage:this,values:e});return t.buildSection()}function Ot(){const e=new ue({parentPage:this,inventoryManagementParams:{isEnabled:this.getValue("isEnabledInventoryManagement"),currentMode:this.getValue("storeControlMode"),availableModes:this.getValue("storeControlAvailableModes"),onecStatusUrl:this.getValue("onecStatusUrl"),is1cRestricted:this.getValue("is1cRestricted"),hasConductedDocumentsOrQuantities:this.getValue("hasConductedDocumentsOrQuantities")},configCatalogSource:this.getValue("configCatalogSource")});return e.buildSection()}function Ht(){if(!babelHelpers.classPrivateFieldLooseBase(this,st)[st]().costPriceCalculationMethod||!this.getValue("showNegativeStoreAmountPopup")){return false}const e=h.Loc.getMessage("CAT_CONFIG_SETTINGS_NEGATIVE_STORE_BALANCE_POPUP_TEXT",{"#STORE_BALANCE_LIST_LINK#":"<help-link></help-link>"});const t=h.Tag.render(Ze||(Ze=Qe`
			<div class="catalog-settings-popup-content">
				<div class="catalog-settings-popup-text">
					${0}
				</div>
			</div>
		`),e);if(!h.Type.isUndefined(top.BX.SidePanel.Instance)&&h.Type.isStringFilled(this.getValue("storeBalancePopupLink"))){const e=h.Tag.render(qe||(qe=Qe`
				<a href="#" class="ui-form-link">
					${0}
				</a>
			`),h.Loc.getMessage("CAT_CONFIG_SETTINGS_NEGATIVE_STORE_BALANCE_POPUP_LINK"));h.Event.bind(e,"click",(()=>{top.BX.SidePanel.Instance.open(String(this.getValue("storeBalancePopupLink")),{requestMethod:"post",cacheable:false})}));h.Dom.replace(t.querySelector("help-link"),e)}const s=new o.Popup({id:"catalog_settings_document_negative_balance_popup",content:t,overlay:true,buttons:[new r.Button({text:h.Loc.getMessage("CAT_CONFIG_SETTINGS_RETURN"),color:r.ButtonColor.DANGER,onclick:(e,t)=>{babelHelpers.classPrivateFieldLooseBase(this,it)[it]();s.destroy()}})]});s.show();return true}function Nt(){return this.getValue("isEnabledInventoryManagement")||this.getValue("defaultQuantityTrace")==="Y"}function mt(){return this.getValue("isStoreBatchUsed")||this.getValue("hasAccessToCatalogSettings")}function yt(){const e=babelHelpers.classPrivateFieldLooseBase(this,st)[st]();const t=babelHelpers.classPrivateFieldLooseBase(this,et)[et];if(e.reservationSettings){e.reservationSettings.deal.autoWriteOffOnFinalize=e.reservationSettings.deal.autoWriteOffOnFinalize==="Y";Object.assign(t.reservationEntities[0].settings.values,e.reservationSettings.deal)}if(e.costPriceCalculationMethod){t.costPriceCalculationMethod.items.forEach((t=>{t.selected=t.value===e.costPriceCalculationMethod}))}if(e.defaultProductVatId){t.vats.items.forEach((t=>{t.selected=Number(t.value)===Number(e.defaultProductVatId)}))}const s=["defaultSubscribe","checkRightsOnDecreaseStoreAmount","defaultProductVatIncluded","defaultCanBuyZero","defaultQuantityTrace","productCardSliderEnabled"];s.forEach((s=>{if(e[s]){t[s]=e[s]}}));return t}class At{static open(e=null,t={}){At.closePopup();let s=At.URL;if(h.Type.isStringFilled(e)){s+=`?configCatalogSource=${e}`}g.EventEmitter.subscribe("SidePanel.Slider:onMessage",(e=>{const[t]=e.getData();if(t.eventId==="BX.Crm.Config.Catalog:onAfterSaveSettings"){g.EventEmitter.emit(window,"onCatalogSettingsSave")}}));if(!t.events){t.events={}}if(!t.events.onClose){t.events.onClose=e=>{var t;if((t=e.getSlider())!=null&&t.getData().get("isInventoryManagementChanged")){if(e.getSlider().getData().get("inventoryManagementMode")===v.ModeList.MODE_1C){top.document.location="/crm/"}else{document.location.reload()}}}}return new Promise((e=>{BX.SidePanel.Instance.open(s,{width:1e3,allowChangeHistory:false,cacheable:false,...t})}))}static openRigthsSlider(){At.closePopup();return new Promise((e=>{BX.SidePanel.Instance.open(At.URL_RIGHTS,{})}))}static openSeoSlider(e){At.closePopup();return new Promise((t=>{BX.SidePanel.Instance.open(e,{width:1e3,allowChangeHistory:false,cacheable:false})}))}static closePopup(){var e;(e=BX.PopupWindowManager)==null?void 0:e.getPopups().forEach((e=>{e.close()}))}}At.URL="/crm/configs/catalog/";At.URL_RIGHTS="/shop/settings/permissions/";var Mt=babelHelpers.classPrivateFieldLooseKey("page");var wt=babelHelpers.classPrivateFieldLooseKey("onEventChangeData");class Dt{constructor(e){Object.defineProperty(this,wt,{value:Rt});Object.defineProperty(this,Mt,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]=Pt.init(e);babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].subscribe("change",babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].bind(this))}render(){return babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].getPage()}}function Rt(){babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].onChange()}e.CatalogSettings=Dt;e.Slider=At})(this.BX.Catalog.Config=this.BX.Catalog.Config||{},BX.UI,BX,BX.Catalog,BX.Catalog,BX.UI,BX.Main,BX.UI,BX.UI,BX.UI.FormElements,BX.UI.FormElements,BX.UI,BX,BX,BX.Catalog.Store,BX,BX.Event);
//# sourceMappingURL=settings.bundle.map.js