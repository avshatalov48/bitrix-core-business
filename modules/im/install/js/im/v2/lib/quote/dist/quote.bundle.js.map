{"version":3,"file":"quote.bundle.js","sources":["../src/quote.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Core } from 'im.v2.application.core';\nimport { EventType, DialogType } from 'im.v2.const';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport type { ImModelMessage, ImModelUser, ImModelDialog } from 'im.v2.model';\n\nconst QUOTE_DELIMITER = '-'.repeat(54);\n\nexport const Quote = {\n\tsendQuoteEvent(message: ImModelMessage, text: string)\n\t{\n\t\tEventEmitter.emit(EventType.textarea.insertText, {\n\t\t\ttext: this.prepareQuoteText(message, text),\n\t\t\twithNewLine: true,\n\t\t\treplace: false,\n\t\t});\n\t},\n\tprepareQuoteText(message: ImModelMessage, text: string): string\n\t{\n\t\tlet quoteTitle = Loc.getMessage('IM_DIALOG_CHAT_QUOTE_DEFAULT_TITLE');\n\t\tif (message.authorId)\n\t\t{\n\t\t\tconst user: ImModelUser = Core.getStore().getters['users/get'](message.authorId);\n\t\t\tquoteTitle = user.name;\n\t\t}\n\n\t\tconst quoteDate = DateFormatter.formatByTemplate(message.date, DateTemplate.notification);\n\n\t\tconst quoteText = Parser.prepareQuote(message, text);\n\n\t\tlet quoteContext = '';\n\t\tconst dialog: ImModelDialog = Core.getStore().getters['dialogues/getByChatId'](message.chatId);\n\t\tif (dialog && dialog.type === DialogType.user)\n\t\t{\n\t\t\tquoteContext = `#${dialog.dialogId}:${Core.getUserId()}/${message.id}`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tquoteContext = `#${dialog.dialogId}/${message.id}`;\n\t\t}\n\n\t\treturn `${QUOTE_DELIMITER}\\n`\n\t\t\t+ `${quoteTitle} [${quoteDate}] ${quoteContext}\\n`\n\t\t\t+ `${quoteText}\\n`\n\t\t\t+ `${QUOTE_DELIMITER}\\n`\n\t\t;\n\t},\n};\n"],"names":["QUOTE_DELIMITER","repeat","Quote","sendQuoteEvent","message","text","EventEmitter","emit","EventType","textarea","insertText","prepareQuoteText","withNewLine","replace","quoteTitle","Loc","getMessage","authorId","user","Core","getStore","getters","name","quoteDate","DateFormatter","formatByTemplate","date","DateTemplate","notification","quoteText","Parser","prepareQuote","quoteContext","dialog","chatId","type","DialogType","dialogId","getUserId","id"],"mappings":";;;;;;;CAUA,MAAMA,eAAe,GAAG,GAAG,CAACC,MAAM,CAAC,EAAE,CAAC;AAEtC,OAAaC,KAAK,GAAG;GACpBC,cAAc,CAACC,OAAuB,EAAEC,IAAY,EACpD;KACCC,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACC,QAAQ,CAACC,UAAU,EAAE;OAChDL,IAAI,EAAE,IAAI,CAACM,gBAAgB,CAACP,OAAO,EAAEC,IAAI,CAAC;OAC1CO,WAAW,EAAE,IAAI;OACjBC,OAAO,EAAE;MACT,CAAC;IACF;GACDF,gBAAgB,CAACP,OAAuB,EAAEC,IAAY,EACtD;KACC,IAAIS,UAAU,GAAGC,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;KACrE,IAAIZ,OAAO,CAACa,QAAQ,EACpB;OACC,MAAMC,IAAiB,GAAGC,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,WAAW,CAAC,CAACjB,OAAO,CAACa,QAAQ,CAAC;OAChFH,UAAU,GAAGI,IAAI,CAACI,IAAI;;KAGvB,MAAMC,SAAS,GAAGC,qCAAa,CAACC,gBAAgB,CAACrB,OAAO,CAACsB,IAAI,EAAEC,oCAAY,CAACC,YAAY,CAAC;KAEzF,MAAMC,SAAS,GAAGC,uBAAM,CAACC,YAAY,CAAC3B,OAAO,EAAEC,IAAI,CAAC;KAEpD,IAAI2B,YAAY,GAAG,EAAE;KACrB,MAAMC,MAAqB,GAAGd,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,uBAAuB,CAAC,CAACjB,OAAO,CAAC8B,MAAM,CAAC;KAC9F,IAAID,MAAM,IAAIA,MAAM,CAACE,IAAI,KAAKC,sBAAU,CAAClB,IAAI,EAC7C;OACCc,YAAY,GAAI,IAAGC,MAAM,CAACI,QAAS,IAAGlB,2BAAI,CAACmB,SAAS,EAAG,IAAGlC,OAAO,CAACmC,EAAG,EAAC;MACtE,MAED;OACCP,YAAY,GAAI,IAAGC,MAAM,CAACI,QAAS,IAAGjC,OAAO,CAACmC,EAAG,EAAC;;KAGnD,OAAQ,GAAEvC,eAAgB,IAAG,GACzB,GAAEc,UAAW,KAAIS,SAAU,KAAIS,YAAa,IAAG,GAC/C,GAAEH,SAAU,IAAG,GACf,GAAE7B,eAAgB,IAAG;;CAG3B,CAAC;;;;;;;;"}