{"version":3,"file":"widgetvue.bundle.js","sources":["../src/logger.js","../src/widgetvue.js"],"sourcesContent":["export class Logger\n{\n\t#enable: boolean = false;\n\n\tconstructor(enable: boolean = false): void\n\t{\n\t\tthis.#enable = enable;\n\t}\n\n\tlog(...message: string)\n\t{\n\t\tif (this.#enable)\n\t\t{\n\t\t\tconsole.log(...message);\n\t\t}\n\t}\n}\n","import { WidgetOptions } from './internal/types';\nimport { Logger } from './logger';\nimport { Backend } from 'landing.backend';\nimport { Loc, Text, Type, Dom, Event } from 'main.core';\n\nimport './css/style.css';\n\nexport class WidgetVue\n{\n\tstatic runningAppNodes: Set<HTMLElement> = new Set();\n\n\t#rootNode: ?HTMLElement = null;\n\t#template: string;\n\t#style: ?string;\n\t#lang: {[key: string]: string} = {};\n\t#appId: number = 0;\n\t#appAllowedByTariff: boolean = true;\n\t#fetchable: boolean = false;\n\t#clickable: boolean = false;\n\n\t/**\n\t * Unique string for every widget\n\t * @type {string}\n\t */\n\t#uniqueId: string;\n\t#frame: ?HTMLIFrameElement = null;\n\t#logger: Logger;\n\n\t#demoData: ?{} = null;\n\t#useDemoData: boolean = false;\n\t#blockId: number = 0;\n\n\tconstructor(options: WidgetOptions): void\n\t{\n\t\tthis.#uniqueId = `widget_${Text.getRandom(8)}`;\n\t\tthis.#logger = new Logger(options.debug || false);\n\n\t\tthis.#rootNode = Type.isString(options.rootNode)\n\t\t\t? document.querySelector(options.rootNode)\n\t\t\t: null\n\t\t;\n\n\t\tthis.#template = Type.isString(options.template) ? options.template : '';\n\n\t\tthis.#style = Type.isString(options.style) ? options.style : null;\n\n\t\tthis.#demoData = Type.isObject(options.demoData) ? options.demoData : null;\n\t\tthis.#useDemoData = Type.isBoolean(options.useDemoData) ? options.useDemoData : false;\n\n\t\tthis.#lang = options.lang || {};\n\t\tthis.#blockId = options.blockId ? Text.toNumber(options.blockId) : 0;\n\n\t\tthis.#appId = options.appId ? Text.toNumber(options.appId) : 0;\n\t\tthis.#appAllowedByTariff = (this.#appId && Type.isBoolean(options.appAllowedByTariff))\n\t\t\t? options.appAllowedByTariff\n\t\t\t: true\n\t\t;\n\n\t\tthis.#fetchable = Type.isBoolean(options.fetchable) ? options.fetchable : false;\n\t\tconst isEditMode = Type.isFunction(BX.Landing.getMode) && BX.Landing.getMode() === 'edit';\n\t\tthis.#clickable = !isEditMode;\n\t}\n\n\t/**\n\t * Create frame with widget content\n\t * @returns {Promise|*}\n\t */\n\tmount(): Promise\n\t{\n\t\treturn this.#getFrameContent()\n\t\t\t.then((srcDoc) => {\n\t\t\t\tthis.#frame = document.createElement('iframe');\n\t\t\t\tthis.#frame.className = 'landing-widgetvue-iframe';\n\t\t\t\tthis.#frame.sandbox = 'allow-scripts';\n\t\t\t\tthis.#frame.srcdoc = srcDoc;\n\n\t\t\t\tthis.#frame.onload = () => {\n\t\t\t\t\tthis.#message('getSize', {}, this.#frame.contentWindow);\n\t\t\t\t};\n\n\t\t\t\tif (\n\t\t\t\t\tthis.#blockId > 0\n\t\t\t\t\t&& this.#rootNode\n\t\t\t\t\t&& !WidgetVue.runningAppNodes.has(this.#rootNode)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tconst blockWrapper = this.#rootNode.parentElement;\n\t\t\t\t\tDom.clean(blockWrapper);\n\t\t\t\t\tDom.append(this.#frame, blockWrapper);\n\n\t\t\t\t\tWidgetVue.runningAppNodes.add(this.#rootNode);\n\n\t\t\t\t\tthis.#bindEvents();\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\t#getFrameContent(): Promise<string>\n\t{\n\t\tlet content = '';\n\n\t\tconst engineParams = {\n\t\t\tid: this.#uniqueId,\n\t\t\torigin: window.location.origin,\n\t\t\tfetchable: this.#fetchable,\n\t\t\tclickable: this.#clickable,\n\t\t};\n\n\t\treturn this.#getCoreConfigs()\n\t\t\t.then((core) => {\n\t\t\t\tcontent += this.#parseExtensionConfig(core);\n\t\t\t\tcontent += this.#parseExtensionConfig({\n\t\t\t\t\tlang_additional: this.#lang,\n\t\t\t\t});\n\n\t\t\t\tif (this.#style)\n\t\t\t\t{\n\t\t\t\t\tcontent += `<link rel=\"stylesheet\" href=\"${this.#style}\">`;\n\t\t\t\t}\n\n\t\t\t\treturn this.#getAssetsConfigs();\n\t\t\t})\n\n\t\t\t.then((assets) => {\n\t\t\t\tcontent += this.#parseExtensionConfig(assets);\n\n\t\t\t\tif (!this.#appAllowedByTariff)\n\t\t\t\t{\n\t\t\t\t\tthrow new Error(Loc.getMessage('LANDING_WIDGETVUE_ERROR_PAYMENT'));\n\t\t\t\t}\n\n\t\t\t\tif (this.#useDemoData)\n\t\t\t\t{\n\t\t\t\t\tif (!this.#demoData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#logger.log('Widget haven\\'t demo data and can be render correctly');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.#demoData || {};\n\t\t\t\t}\n\n\t\t\t\treturn this.#fetchData();\n\t\t\t})\n\n\t\t\t.then((data) => {\n\t\t\t\tengineParams.data = data;\n\t\t\t})\n\n\t\t\t.catch((error) => {\n\t\t\t\tengineParams.error = error.message || 'error';\n\t\t\t})\n\n\t\t\t.then(() => {\n\t\t\t\tconst appInit = `\n\t\t\t\t\t<script>\n\t\t\t\t\t\tBX.ready(function() {\n\t\t\t\t\t\t\t(new BX.Landing.WidgetVue.Engine(\n\t\t\t\t\t\t\t\t${JSON.stringify(engineParams)}\n\t\t\t\t\t\t\t)).render();\n\t\t\t\t\t\t});\n\t\t\t\t\t</script>\n\n\t\t\t\t\t<div id=\"${this.#uniqueId}\">${this.#template}</div>\n\t\t\t\t`;\n\n\t\t\t\tcontent += appInit;\n\n\t\t\t\treturn content;\n\t\t\t})\n\t\t;\n\t}\n\n\t#getCoreConfigs(): Promise<Object>\n\t{\n\t\tconst extCodes = [\n\t\t\t'main.core',\n\t\t\t'ui.design-tokens',\n\t\t];\n\t\tconst tplCodes = [\n\t\t\t'bitrix24',\n\t\t];\n\n\t\treturn Backend.getInstance()\n\t\t\t.action(\n\t\t\t\t'Block::getAssetsConfig',\n\t\t\t\t{\n\t\t\t\t\textCodes,\n\t\t\t\t\ttplCodes,\n\t\t\t\t},\n\t\t\t)\n\t\t;\n\t}\n\n\t#getAssetsConfigs(): Promise<Object>\n\t{\n\t\tconst extCodes = [\n\t\t\t'landing.widgetvue.engine',\n\t\t];\n\n\t\treturn Backend.getInstance()\n\t\t\t.action(\n\t\t\t\t'Block::getAssetsConfig',\n\t\t\t\t{ extCodes },\n\t\t\t)\n\t\t;\n\t}\n\n\t#parseExtensionConfig(ext: Object): string\n\t{\n\t\tconst domain = `${document.location.protocol}//${document.location.host}`;\n\t\tlet html = '';\n\n\t\tif (ext.lang_additional !== undefined)\n\t\t{\n\t\t\thtml += `<script>BX.message(${JSON.stringify(ext.lang_additional)})</script>`;\n\t\t}\n\n\t\t(ext.js || []).forEach((js) => {\n\t\t\thtml += `<script src=\"${domain}${js}\"></script>`;\n\t\t});\n\n\t\t(ext.css || []).forEach((css) => {\n\t\t\thtml += `<link href=\"${domain}${css}\" type=\"text/css\" rel=\"stylesheet\" />`;\n\t\t});\n\n\t\treturn html;\n\t}\n\n\t#fetchData(params = {}): Promise<Object>\n\t{\n\t\tif (!this.#fetchable)\n\t\t{\n\t\t\tthis.#logger.log('Fetch data is impossible now (haven`t handler)');\n\n\t\t\treturn Promise.resolve({});\n\t\t}\n\n\t\tif (this.#useDemoData)\n\t\t{\n\t\t\treturn Promise.resolve(this.#demoData || {});\n\t\t}\n\n\t\treturn Backend.getInstance()\n\t\t\t.action('RepoWidget::fetchData', {\n\t\t\t\tblockId: this.#blockId,\n\t\t\t\tparams,\n\t\t\t})\n\n\t\t\t.then((jsonData) => {\n\t\t\t\tlet data = {};\n\t\t\t\tdata = JSON.parse(jsonData);\n\t\t\t\tif (data.error)\n\t\t\t\t{\n\t\t\t\t\tthrow new Error(data.error);\n\t\t\t\t}\n\n\t\t\t\treturn data;\n\t\t\t})\n\n\t\t\t.catch((error) => {\n\t\t\t\tconst logMessages = [`Fetch data error!\\nWidget ID: ${this.#blockId}`];\n\t\t\t\tif (Object.keys(params) > 0)\n\t\t\t\t{\n\t\t\t\t\tlogMessages.push('\\nFetch request params:', params);\n\t\t\t\t}\n\n\t\t\t\tif (Type.isString(error))\n\t\t\t\t{\n\t\t\t\t\tlogMessages.push(`\\nError in JSON data: ${error}`);\n\t\t\t\t}\n\n\t\t\t\telse if (Type.isObject(error))\n\t\t\t\t{\n\t\t\t\t\tif (error instanceof Error && error.message)\n\t\t\t\t\t{\n\t\t\t\t\t\tlogMessages.push(`\\nJavaScript error: ${error.message}`);\n\t\t\t\t\t}\n\t\t\t\t\telse if (error.result && Type.isArray(error.result) && error.result.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tlogMessages.push('\\nError from backend:');\n\t\t\t\t\t\terror.result.forEach((e) => {\n\t\t\t\t\t\t\tlogMessages.push(e);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.#logger.log(...logMessages);\n\t\t\t\tthrow new Error(Loc.getMessage('LANDING_WIDGETVUE_ERROR_FETCH'));\n\t\t\t});\n\t}\n\n\t#message(name: string, params: {} = {}, target: Window = window)\n\t{\n\t\ttarget.postMessage(\n\t\t\t{\n\t\t\t\tname,\n\t\t\t\tparams,\n\t\t\t\torigin: this.#uniqueId,\n\t\t\t},\n\t\t\t'*',\n\t\t);\n\t}\n\n\t#bindEvents()\n\t{\n\t\tEvent.bind(window, 'message', this.#onMessage.bind(this));\n\t}\n\n\t#onMessage(event)\n\t{\n\t\t// todo: need check origin manually?\n\n\t\tif (\n\t\t\tevent.data\n\t\t\t&& event.data.origin\n\t\t\t&& event.data.name\n\t\t\t&& event.data.params\n\t\t\t&& Type.isObject(event.data.params)\n\t\t)\n\t\t{\n\t\t\tif (event.data.origin !== this.#uniqueId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.data.name === 'fetchData')\n\t\t\t{\n\t\t\t\tthis.#fetchData(event.data.params)\n\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\tthis.#message('setData', { data }, event.source);\n\t\t\t\t\t})\n\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tthis.#message('setError', { error }, event.source);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tevent.data.name === 'setSize'\n\t\t\t\t&& event.data.params.size !== undefined\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.#frame.height = parseInt(event.data.params.size, 10);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tevent.data.name === 'openApplication'\n\t\t\t\t&& this.#appId > 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst params = Type.isObject(event.data.params) ? event.data.params : {};\n\t\t\t\tBX.rest.AppLayout.openApplication(\n\t\t\t\t\tthis.#appId,\n\t\t\t\t\tparams,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tevent.data.name === 'openPath'\n\t\t\t\t&& Type.isString(event.data.params.path)\n\t\t\t)\n\t\t\t{\n\t\t\t\tBX.rest.AppLayout.openPath(\n\t\t\t\t\tthis.#appId,\n\t\t\t\t\t{\n\t\t\t\t\t\tpath: event.data.params.path,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["Logger","constructor","enable","log","message","console","WidgetVue","options","Text","getRandom","debug","Type","isString","rootNode","document","querySelector","template","style","isObject","demoData","isBoolean","useDemoData","lang","blockId","toNumber","appId","appAllowedByTariff","fetchable","isEditMode","isFunction","BX","Landing","getMode","mount","then","srcDoc","createElement","className","sandbox","srcdoc","onload","contentWindow","runningAppNodes","has","blockWrapper","parentElement","Dom","clean","append","add","content","engineParams","id","origin","window","location","clickable","core","lang_additional","assets","Error","Loc","getMessage","data","catch","error","appInit","JSON","stringify","extCodes","tplCodes","Backend","getInstance","action","ext","domain","protocol","host","html","undefined","js","forEach","css","params","Promise","resolve","jsonData","parse","logMessages","Object","keys","push","result","isArray","length","e","name","target","postMessage","Event","bind","event","source","size","height","parseInt","rest","AppLayout","openApplication","path","openPath","Set"],"mappings":"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"}