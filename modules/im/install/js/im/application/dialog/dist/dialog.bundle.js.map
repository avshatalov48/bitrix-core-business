{"version":3,"file":"dialog.bundle.js","sources":["../src/view.js","../src/controller.js"],"sourcesContent":["/**\n * Bitrix Im\n * Application Dialog view\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\nimport {BitrixVue} from \"ui.vue\";\nimport {Logger} from \"im.lib.logger\";\nimport {Utils} from \"im.lib.utils\";\nimport \"im.component.recent\";\nimport \"im.component.dialog\";\nimport \"im.component.textarea\";\nimport \"pull.component.status\";\nimport \"./view.css\";\n\nimport {DeviceType} from 'im.const';\nimport {\n\tDialogCore, DialogReadMessages, DialogQuoteMessage, DialogClickOnCommand, DialogClickOnMention, DialogClickOnUserName,\n\tDialogClickOnMessageMenu, DialogClickOnMessageRetry, DialogClickOnUploadCancel, DialogClickOnReadList,\n\tDialogSetMessageReaction, DialogOpenMessageReactionList, DialogClickOnKeyboardButton, DialogClickOnChatTeaser,\n\tDialogClickOnDialog, TextareaCore, TextareaUploadFile\n} from 'im.mixin';\nimport { EventEmitter } from \"main.core.events\";\n\nBitrixVue.component('bx-im-application-dialog',\n{\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tinitialDialogId: { default: '0' }\n\t},\n\n\tmixins: [\n\t\tDialogCore, DialogReadMessages, DialogQuoteMessage, DialogClickOnCommand, DialogClickOnMention, DialogClickOnUserName,\n\t\tDialogClickOnMessageMenu, DialogClickOnMessageRetry, DialogClickOnUploadCancel, DialogClickOnReadList,\n\t\tDialogSetMessageReaction, DialogOpenMessageReactionList, DialogClickOnKeyboardButton, DialogClickOnChatTeaser,\n\t\tDialogClickOnDialog, TextareaCore, TextareaUploadFile\n\t],\n\n\tdata()\n\t{\n\t\treturn {\n\t\t\tdialogId: 0\n\t\t}\n\t},\n\n\tcreated()\n\t{\n\t\tthis.dialogId = this.initialDialogId;\n\n\t\tEventEmitter.subscribe('openMessenger', this.onOpenMessenger)\n\t},\n\n\tbeforeDestroy()\n\t{\n\t\tEventEmitter.unsubscribe('openMessenger', this.onOpenMessenger)\n\t},\n\n\tcomputed:\n\t{\n\t\tDeviceType: () => DeviceType,\n\t\tisDialog()\n\t\t{\n\t\t\treturn Utils.dialog.isChatId(this.dialogId);\n\t\t},\n\n\t\tisEnableGesture()\n\t\t{\n\t\t\treturn false;\n\t\t},\n\n\t\tisEnableGestureQuoteFromRight()\n\t\t{\n\t\t\treturn this.isEnableGesture && true;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonOpenMessenger({data: event})\n\t\t{\n\t\t\tthis.dialogId = event.id;\n\t\t},\n\t\tlogEvent(name, ...params)\n\t\t{\n\t\t\tLogger.info(name, ...params);\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t  \t<div style=\"display: flex;\">\n\t\t\t<div class=\"bx-mobilechat\">\n\t\t\t\t<div class=\"bx-mobilechat-dialog-title\">Dialog: {{dialogId}}</div>\n\t\t\t\t<bx-pull-component-status/>\n\t\t\t\t<bx-im-component-dialog\n\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:enableGestureMenu=\"isEnableGesture\"\n\t\t\t\t\t:enableGestureQuote=\"isEnableGesture\"\n\t\t\t\t\t:enableGestureQuoteFromRight=\"isEnableGestureQuoteFromRight\"\n\t\t\t\t\t:showMessageUserName=\"isDialog\"\n\t\t\t\t\t:showMessageAvatar=\"isDialog\"\n\t\t\t\t />\n\t\t\t\t<bx-im-component-textarea\n\t\t\t\t\t:siteId=\"application.common.siteId\"\n\t\t\t\t\t:userId=\"userId\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:writesEventLetter=\"3\"\n\t\t\t\t\t:enableEdit=\"true\"\n\t\t\t\t\t:enableCommand=\"false\"\n\t\t\t\t\t:enableMention=\"false\"\n\t\t\t\t\t:enableFile=\"true\"\n\t\t\t\t\t:autoFocus=\"application.device.type !== DeviceType.mobile\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`\n});","/**\n * Bitrix Im\n * Dialog application\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2020 Bitrix\n */\n\n// vue\nimport {VueVendorV2} from \"ui.vue\";\n\n// im\nimport {Core} from \"im.application.core\";\nimport {Utils} from \"im.lib.utils\";\nimport {Logger} from \"im.lib.logger\";\nimport {DialogRestHandler} from \"im.provider.rest\";\n\n// core\nimport \"promise\";\n\n// pull\nimport {PULL as Pull} from \"pull.client\";\n\n// component\nimport \"./view\";\n\nexport class DialogApplication\n{\n\t/* region 01. Initialize */\n\n\tconstructor(params = {})\n\t{\n\t\tthis.inited = false;\n\t\tthis.initPromise = new BX.Promise;\n\n\t\tthis.params = params;\n\n\t\tthis.template = null;\n\t\tthis.rootNode = this.params.node || document.createElement('div');\n\n\t\tthis.event = new VueVendorV2;\n\n\t\tthis.initCore()\n\t\t\t.then(() => this.initComponent())\n\t\t\t.then(() => this.initComplete())\n\t\t;\n\t}\n\n\tinitCore()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCore.ready().then(controller => {\n\t\t\t\tthis.controller = controller;\n\t\t\t\tresolve();\n\t\t\t})\n\t\t});\n\t}\n\n\tinitComponent()\n\t{\n\t\tconsole.log('2. initComponent');\n\n\t\tthis.controller.getStore().commit('application/set', {\n\t\t\tdialog: {\n\t\t\t\tdialogId: this.getDialogId()\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tquoteEnable: true,\n\t\t\t\tautoplayVideo: true,\n\t\t\t\tdarkBackground: false\n\t\t\t}\n\t\t});\n\n\t\tthis.controller.addRestAnswerHandler(\n\t\t\tDialogRestHandler.create({\n\t\t\t\tstore: this.controller.getStore(),\n\t\t\t\tcontroller: this.controller,\n\t\t\t\tcontext: this,\n\t\t\t})\n\t\t);\n\n\t\tlet dialog = this.controller.getStore().getters['dialogues/get'](this.controller.application.getDialogId());\n\t\tif (dialog)\n\t\t{\n\t\t\tthis.controller.getStore().commit('application/set', {dialog: {\n\t\t\t\tchatId: dialog.chatId,\n\t\t\t\tdiskFolderId: dialog.diskFolderId || 0\n\t\t\t}});\n\t\t}\n\n\t\treturn this.controller.createVue(this, {\n\t\t\tel: this.rootNode,\n\t\t\tdata: () =>\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tuserId: this.getUserId(),\n\t\t\t\t\tdialogId: this.getDialogId()\n\t\t\t\t};\n\t\t\t},\n\t\t\t// language=Vue\n\t\t\ttemplate: `<bx-im-application-dialog :userId=\"userId\" :initialDialogId=\"dialogId\"/>`,\n\t\t})\n\t\t.then(vue => {\n\t\t\tthis.template = vue;\n\t\t\treturn new Promise((resolve, reject) => resolve());\n\t\t});\n\t}\n\n\tinitComplete()\n\t{\n\t\tthis.inited = true;\n\t\tthis.initPromise.resolve(this);\n\t}\n\n\tready()\n\t{\n\t\tif (this.inited)\n\t\t{\n\t\t\tlet promise = new BX.Promise;\n\t\t\tpromise.resolve(this);\n\n\t\t\treturn promise;\n\t\t}\n\n\t\treturn this.initPromise;\n\t}\n\n/* endregion 01. Initialize */\n\n/* region 02. Methods */\n\n\tgetUserId()\n\t{\n\t\tlet userId = this.params.userId || this.getLocalize('USER_ID');\n\t\treturn userId? parseInt(userId): 0;\n\t}\n\n\tgetDialogId()\n\t{\n\t\treturn this.params.dialogId? this.params.dialogId.toString(): \"0\";\n\t}\n\n\tgetHost()\n\t{\n\t\treturn location.origin || '';\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn 's1';\n\t}\n\n/* endregion 02. Methods */\n\n/* region 03. Utils */\n\n\taddLocalize(phrases)\n\t{\n\t\treturn this.controller.addLocalize(phrases);\n\t}\n\n\tgetLocalize(name)\n\t{\n\t\treturn this.controller.getLocalize(name);\n\t}\n\n/* endregion 03. Utils */\n}"],"names":["BitrixVue","component","props","userId","default","initialDialogId","mixins","DialogCore","DialogReadMessages","DialogQuoteMessage","DialogClickOnCommand","DialogClickOnMention","DialogClickOnUserName","DialogClickOnMessageMenu","DialogClickOnMessageRetry","DialogClickOnUploadCancel","DialogClickOnReadList","DialogSetMessageReaction","DialogOpenMessageReactionList","DialogClickOnKeyboardButton","DialogClickOnChatTeaser","DialogClickOnDialog","TextareaCore","TextareaUploadFile","data","dialogId","created","EventEmitter","subscribe","onOpenMessenger","beforeDestroy","unsubscribe","computed","DeviceType","isDialog","Utils","dialog","isChatId","isEnableGesture","isEnableGestureQuoteFromRight","methods","event","id","logEvent","name","params","Logger","info","template","DialogApplication","inited","initPromise","BX","Promise","rootNode","node","document","createElement","VueVendorV2","initCore","then","initComponent","initComplete","resolve","reject","Core","ready","controller","console","log","getStore","commit","getDialogId","options","quoteEnable","autoplayVideo","darkBackground","addRestAnswerHandler","DialogRestHandler","create","store","context","getters","application","chatId","diskFolderId","createVue","el","getUserId","vue","promise","getLocalize","parseInt","toString","location","origin","phrases","addLocalize"],"mappings":";;;;;IAAA;;;;;;;;AASA,AAkBAA,oBAAS,CAACC,SAAV,CAAoB,0BAApB,EACA;IACCC,EAAAA,KAAK,EACL;IACCC,IAAAA,MAAM,EAAE;IAAEC,MAAAA,OAAO,EAAE;IAAX,KADT;IAECC,IAAAA,eAAe,EAAE;IAAED,MAAAA,OAAO,EAAE;IAAX;IAFlB,GAFD;IAOCE,EAAAA,MAAM,EAAE,CACPC,mBADO,EACKC,2BADL,EACyBC,2BADzB,EAC6CC,6BAD7C,EACmEC,6BADnE,EACyFC,8BADzF,EAEPC,iCAFO,EAEmBC,kCAFnB,EAE8CC,kCAF9C,EAEyEC,8BAFzE,EAGPC,iCAHO,EAGmBC,sCAHnB,EAGkDC,oCAHlD,EAG+EC,gCAH/E,EAIPC,4BAJO,EAIcC,qBAJd,EAI4BC,2BAJ5B,CAPT;IAcCC,EAAAA,IAdD,kBAeC;IACC,WAAO;IACNC,MAAAA,QAAQ,EAAE;IADJ,KAAP;IAGA,GAnBF;IAqBCC,EAAAA,OArBD,qBAsBC;IACC,SAAKD,QAAL,GAAgB,KAAKpB,eAArB;IAEAsB,IAAAA,6BAAY,CAACC,SAAb,CAAuB,eAAvB,EAAwC,KAAKC,eAA7C;IACA,GA1BF;IA4BCC,EAAAA,aA5BD,2BA6BC;IACCH,IAAAA,6BAAY,CAACI,WAAb,CAAyB,eAAzB,EAA0C,KAAKF,eAA/C;IACA,GA/BF;IAiCCG,EAAAA,QAAQ,EACR;IACCC,IAAAA,UAAU,EAAE;IAAA,aAAMA,mBAAN;IAAA,KADb;IAECC,IAAAA,QAFD,sBAGC;IACC,aAAOC,kBAAK,CAACC,MAAN,CAAaC,QAAb,CAAsB,KAAKZ,QAA3B,CAAP;IACA,KALF;IAOCa,IAAAA,eAPD,6BAQC;IACC,aAAO,KAAP;IACA,KAVF;IAYCC,IAAAA,6BAZD,2CAaC;IACC,aAAO,KAAKD,eAAL,IAAwB,IAA/B;IACA;IAfF,GAlCD;IAmDCE,EAAAA,OAAO,EACP;IACCX,IAAAA,eADD,iCAEC;IAAA,UADuBY,KACvB,QADiBjB,IACjB;IACC,WAAKC,QAAL,GAAgBgB,KAAK,CAACC,EAAtB;IACA,KAJF;IAKCC,IAAAA,QALD,oBAKUC,IALV,EAMC;IAAA,wCADkBC,MAClB;IADkBA,QAAAA,MAClB;IAAA;;IACCC,MAAAA,oBAAM,CAACC,IAAP,OAAAD,oBAAM,GAAMF,IAAN,SAAeC,MAAf,EAAN;IACA;IARF,GApDD;IA8DC;IACAG,EAAAA,QAAQ;IA/DT,CADA;;IC3BA;;;;;;;;AASA,QAkBaC,iBAAb;IAEC;IAEA,+BACA;IAAA;;IAAA,QADYJ,MACZ,uEADqB,EACrB;IAAA;IACC,SAAKK,MAAL,GAAc,KAAd;IACA,SAAKC,WAAL,GAAmB,IAAIC,EAAE,CAACC,OAAP,EAAnB;IAEA,SAAKR,MAAL,GAAcA,MAAd;IAEA,SAAKG,QAAL,GAAgB,IAAhB;IACA,SAAKM,QAAL,GAAgB,KAAKT,MAAL,CAAYU,IAAZ,IAAoBC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAApC;IAEA,SAAKhB,KAAL,GAAa,IAAIiB,kBAAJ,EAAb;IAEA,SAAKC,QAAL,GACEC,IADF,CACO;IAAA,aAAM,KAAI,CAACC,aAAL,EAAN;IAAA,KADP,EAEED,IAFF,CAEO;IAAA,aAAM,KAAI,CAACE,YAAL,EAAN;IAAA,KAFP;IAIA;;IApBF;IAAA;IAAA,+BAuBC;IAAA;;IACC,aAAO,IAAIT,OAAJ,CAAY,UAACU,OAAD,EAAUC,MAAV,EAAqB;IACvCC,QAAAA,wBAAI,CAACC,KAAL,GAAaN,IAAb,CAAkB,UAAAO,UAAU,EAAI;IAC/B,UAAA,MAAI,CAACA,UAAL,GAAkBA,UAAlB;IACAJ,UAAAA,OAAO;IACP,SAHD;IAIA,OALM,CAAP;IAMA;IA9BF;IAAA;IAAA,oCAiCC;IAAA;;IACCK,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;IAEA,WAAKF,UAAL,CAAgBG,QAAhB,GAA2BC,MAA3B,CAAkC,iBAAlC,EAAqD;IACpDnC,QAAAA,MAAM,EAAE;IACPX,UAAAA,QAAQ,EAAE,KAAK+C,WAAL;IADH,SAD4C;IAIpDC,QAAAA,OAAO,EAAE;IACRC,UAAAA,WAAW,EAAE,IADL;IAERC,UAAAA,aAAa,EAAE,IAFP;IAGRC,UAAAA,cAAc,EAAE;IAHR;IAJ2C,OAArD;IAWA,WAAKT,UAAL,CAAgBU,oBAAhB,CACCC,kCAAiB,CAACC,MAAlB,CAAyB;IACxBC,QAAAA,KAAK,EAAE,KAAKb,UAAL,CAAgBG,QAAhB,EADiB;IAExBH,QAAAA,UAAU,EAAE,KAAKA,UAFO;IAGxBc,QAAAA,OAAO,EAAE;IAHe,OAAzB,CADD;IAQA,UAAI7C,MAAM,GAAG,KAAK+B,UAAL,CAAgBG,QAAhB,GAA2BY,OAA3B,CAAmC,eAAnC,EAAoD,KAAKf,UAAL,CAAgBgB,WAAhB,CAA4BX,WAA5B,EAApD,CAAb;;IACA,UAAIpC,MAAJ,EACA;IACC,aAAK+B,UAAL,CAAgBG,QAAhB,GAA2BC,MAA3B,CAAkC,iBAAlC,EAAqD;IAACnC,UAAAA,MAAM,EAAE;IAC7DgD,YAAAA,MAAM,EAAEhD,MAAM,CAACgD,MAD8C;IAE7DC,YAAAA,YAAY,EAAEjD,MAAM,CAACiD,YAAP,IAAuB;IAFwB;IAAT,SAArD;IAIA;;IAED,aAAO,KAAKlB,UAAL,CAAgBmB,SAAhB,CAA0B,IAA1B,EAAgC;IACtCC,QAAAA,EAAE,EAAE,KAAKjC,QAD6B;IAEtC9B,QAAAA,IAAI,EAAE,gBACN;IACC,iBAAO;IACNrB,YAAAA,MAAM,EAAE,MAAI,CAACqF,SAAL,EADF;IAEN/D,YAAAA,QAAQ,EAAE,MAAI,CAAC+C,WAAL;IAFJ,WAAP;IAIA,SARqC;IAStC;IACAxB,QAAAA,QAAQ;IAV8B,OAAhC,EAYNY,IAZM,CAYD,UAAA6B,GAAG,EAAI;IACZ,QAAA,MAAI,CAACzC,QAAL,GAAgByC,GAAhB;IACA,eAAO,IAAIpC,OAAJ,CAAY,UAACU,OAAD,EAAUC,MAAV;IAAA,iBAAqBD,OAAO,EAA5B;IAAA,SAAZ,CAAP;IACA,OAfM,CAAP;IAgBA;IAhFF;IAAA;IAAA,mCAmFC;IACC,WAAKb,MAAL,GAAc,IAAd;IACA,WAAKC,WAAL,CAAiBY,OAAjB,CAAyB,IAAzB;IACA;IAtFF;IAAA;IAAA,4BAyFC;IACC,UAAI,KAAKb,MAAT,EACA;IACC,YAAIwC,UAAO,GAAG,IAAItC,EAAE,CAACC,OAAP,EAAd;IACAqC,QAAAA,UAAO,CAAC3B,OAAR,CAAgB,IAAhB;IAEA,eAAO2B,UAAP;IACA;;IAED,aAAO,KAAKvC,WAAZ;IACA;IAEF;;IAEA;;IAvGA;IAAA;IAAA,gCA0GC;IACC,UAAIhD,MAAM,GAAG,KAAK0C,MAAL,CAAY1C,MAAZ,IAAsB,KAAKwF,WAAL,CAAiB,SAAjB,CAAnC;IACA,aAAOxF,MAAM,GAAEyF,QAAQ,CAACzF,MAAD,CAAV,GAAoB,CAAjC;IACA;IA7GF;IAAA;IAAA,kCAgHC;IACC,aAAO,KAAK0C,MAAL,CAAYpB,QAAZ,GAAsB,KAAKoB,MAAL,CAAYpB,QAAZ,CAAqBoE,QAArB,EAAtB,GAAuD,GAA9D;IACA;IAlHF;IAAA;IAAA,8BAqHC;IACC,aAAOC,QAAQ,CAACC,MAAT,IAAmB,EAA1B;IACA;IAvHF;IAAA;IAAA,gCA0HC;IACC,aAAO,IAAP;IACA;IAEF;;IAEA;;IAhIA;IAAA;IAAA,gCAkIaC,OAlIb,EAmIC;IACC,aAAO,KAAK7B,UAAL,CAAgB8B,WAAhB,CAA4BD,OAA5B,CAAP;IACA;IArIF;IAAA;IAAA,gCAuIapD,IAvIb,EAwIC;IACC,aAAO,KAAKuB,UAAL,CAAgBwB,WAAhB,CAA4B/C,IAA5B,CAAP;IACA;IAEF;;IA5IA;IAAA;IAAA;;;;;;;;"}