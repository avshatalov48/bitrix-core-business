this.BX=this.BX||{};(function(e,a,t){"use strict";function n(e,a){r(e,a);a.add(e)}function i(e,a,t){r(e,a);a.set(e,t)}function r(e,a){if(a.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function s(e,a,t){if(!a.has(e)){throw new TypeError("attempted to get private field on non-instance")}return t}var o="mail";var l={};var c=new WeakMap;var d=new WeakSet;var u=function(){function e(a){babelHelpers.classCallCheck(this,e);n(this,d);i(this,c,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,c,a);this.sliderId="MailSecretary:".concat(o+babelHelpers.classPrivateFieldGet(this,c)).concat(Math.floor(Math.random()*1e3));this.contextBx=window.top.BX||window.BX;this.subscribe()}babelHelpers.createClass(e,[{key:"openChat",value:function e(){var a=this;return BX.ajax.runAction("mail.secretary.createChatFromMessage",{data:{messageId:babelHelpers.classPrivateFieldGet(this,c)}}).then((function(e){if(top.window.BXIM&&e.data){top.BXIM.openMessenger("chat"+parseInt(e.data))}}),(function(e){s(a,d,v).call(a,e.errors)}))}},{key:"openCalendarEvent",value:function e(){var a=this;return BX.ajax.runAction("mail.secretary.getCalendarEventDataFromMessage",{data:{messageId:babelHelpers.classPrivateFieldGet(this,c)}}).then((function(e){if(e.data&&e.data.isNewEvent){new(window.top.BX||window.BX).Calendar.SliderLoader(0,{sliderId:a.sliderId,entryName:e.data.name,entryDescription:e.data.desc}).show()}else if(e.data&&e.data.isIcal){return BX.ajax.runComponentAction("bitrix:mail.client","ical",{mode:"ajax",data:{messageId:babelHelpers.classPrivateFieldGet(a,c),action:"question"}})}}),(function(e){s(a,d,v).call(a,e.errors)})).then((function(e){if(e.data&&e.data.eventId){var a=new(window.top.BX||window.BX).Calendar.SliderLoader(e.data.eventId);a.show();var t=new BX.Mail.MessageGrid;t.reloadTable()}}))}},{key:"onCalendarSave",value:function e(a){if(a instanceof this.contextBx.Event.BaseEvent){var t=a.getData();if(t.sliderId===this.sliderId){BX.ajax.runAction("mail.secretary.onCalendarSave",{data:{messageId:babelHelpers.classPrivateFieldGet(this,c),calendarEventId:t.responseData.entryId}})}}}},{key:"onTaskAction",value:function e(a,n){var i={tool:"tasks",category:"task_operations",event:a,type:"task",c_section:"mail",c_element:n};t.sendData(i)}},{key:"subscribe",value:function e(){this.contextBx.Event.EventEmitter.subscribe("BX.Calendar:onEntrySave",this.onCalendarSave.bind(this))}},{key:"destroy",value:function e(){this.contextBx.Event.EventEmitter.unsubscribe("BX.Calendar:onEntrySave",this.onCalendarSave)}}],[{key:"getInstance",value:function t(n){if(a.Type.isUndefined(l[n])){l[n]=new e(n)}return l[n]}}]);return e}();function v(e){if(a.Type.isArray(e)){var t=[];e.forEach((function(e){t.push(e.message)}));alert(t.join("\n"))}else{alert("action can't be performed")}}e.Secretary=u})(this.BX.Mail=this.BX.Mail||{},BX,BX.UI.Analytics);
//# sourceMappingURL=secretary.bundle.map.js