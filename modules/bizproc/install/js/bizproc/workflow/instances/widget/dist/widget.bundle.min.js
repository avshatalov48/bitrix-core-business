this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};this.BX.Bizproc.Workflow=this.BX.Bizproc.Workflow||{};(function(e,s,a,i,t,l,r){"use strict";let o=e=>e,c,n,p,d,b,v,P,u;const h=[["s","sdiff"],["i","idiff"],["H","Hdiff"],["d","ddiff"],["m","mdiff"],["Y","Ydiff"]];const L={type:t.imageTypeEnum.ICON,data:{icon:"business-process-1",color:"var(--ui-color-base-10)"}};var f=babelHelpers.classPrivateFieldLooseKey("params");var F=babelHelpers.classPrivateFieldLooseKey("stack");var B=babelHelpers.classPrivateFieldLooseKey("popupInstance");var H=babelHelpers.classPrivateFieldLooseKey("popupListNode");var g=babelHelpers.classPrivateFieldLooseKey("listSkeleton");var y=babelHelpers.classPrivateFieldLooseKey("offset");var m=babelHelpers.classPrivateFieldLooseKey("initStack");var T=babelHelpers.classPrivateFieldLooseKey("getStackText");var w=babelHelpers.classPrivateFieldLooseKey("getStackUserImages");var O=babelHelpers.classPrivateFieldLooseKey("getEmptyStackImages");var _=babelHelpers.classPrivateFieldLooseKey("handleClick");var I=babelHelpers.classPrivateFieldLooseKey("getPopupContent");var S=babelHelpers.classPrivateFieldLooseKey("renderListSkeleton");var k=babelHelpers.classPrivateFieldLooseKey("renderListPage");var E=babelHelpers.classPrivateFieldLooseKey("loadList");var W=babelHelpers.classPrivateFieldLooseKey("handleNextPage");var z=babelHelpers.classPrivateFieldLooseKey("renderListItemFaces");var K=babelHelpers.classPrivateFieldLooseKey("formatDuration");class R{constructor(e){Object.defineProperty(this,K,{value:Z});Object.defineProperty(this,z,{value:J});Object.defineProperty(this,W,{value:G});Object.defineProperty(this,E,{value:$});Object.defineProperty(this,k,{value:M});Object.defineProperty(this,S,{value:x});Object.defineProperty(this,I,{value:N});Object.defineProperty(this,_,{value:X});Object.defineProperty(this,O,{value:D});Object.defineProperty(this,w,{value:U});Object.defineProperty(this,T,{value:C});Object.defineProperty(this,m,{value:j});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:0});babelHelpers.classPrivateFieldLooseBase(this,f)[f]=e;babelHelpers.classPrivateFieldLooseBase(this,m)[m]()}static renderTo(e){const a=new R(JSON.parse(e.dataset.widget));s.Dom.replace(e,a.render())}render(){const e=babelHelpers.classPrivateFieldLooseBase(this,f)[f].allCount<1;const a=s.Tag.render(c||(c=o`<div class="bp-workflow-instances-widget ${0}"></div>`),e?"--empty":"");babelHelpers.classPrivateFieldLooseBase(this,F)[F].renderTo(a);if(!e){s.Event.bind(a,"click",babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this))}return a}}function j(){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=new t.ImageStackSteps({steps:[{id:"basis",stack:{images:s.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,f)[f].users)?babelHelpers.classPrivateFieldLooseBase(this,w)[w](babelHelpers.classPrivateFieldLooseBase(this,f)[f].users,babelHelpers.classPrivateFieldLooseBase(this,f)[f].allCount):babelHelpers.classPrivateFieldLooseBase(this,O)[O]()},footer:{type:t.footerTypeEnum.TEXT,data:{text:babelHelpers.classPrivateFieldLooseBase(this,T)[T](babelHelpers.classPrivateFieldLooseBase(this,f)[f].allCount)},styles:{maxWidth:90}},styles:{minWidth:90}}]})}function C(e){if(e<1){return s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_LIST_EMPTY")}return s.Loc.getMessagePlural("BIZPROC_JS_WORKFLOW_INST_WIDGET_LIST",e,{"#COUNT#":e<100?e:"99+"})}function U(e,a){const i=[];e.forEach((e=>{const a=s.Text.toInteger(e.id);if(a>0){i.push({type:t.imageTypeEnum.USER,data:{userId:a,src:String(e.avatarUrl||"")}})}else{i.push(L)}}));if(a>3){const e=i.slice(0,2);e.push({type:t.imageTypeEnum.COUNTER,data:{text:`+${a-2}`}});return e}return i}function D(e,s=3){return Array.from({length:s}).fill(e!=null?e:{type:t.imageTypeEnum.USER_STUB})}function X(e){if(!babelHelpers.classPrivateFieldLooseBase(this,B)[B]){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=new i.Popup({autoHide:true,width:305,minHeight:342,animation:"fading-slide",content:babelHelpers.classPrivateFieldLooseBase(this,I)[I](),bindElement:e.target,padding:0,borderRadius:"12px"})}babelHelpers.classPrivateFieldLooseBase(this,B)[B].toggle()}function N(){babelHelpers.classPrivateFieldLooseBase(this,g)[g]=babelHelpers.classPrivateFieldLooseBase(this,S)[S]();babelHelpers.classPrivateFieldLooseBase(this,H)[H]=s.Tag.render(n||(n=o`<div class="bizproc-workflow-instances-popup-list">${0}</div>`),babelHelpers.classPrivateFieldLooseBase(this,g)[g]);babelHelpers.classPrivateFieldLooseBase(this,E)[E]();return s.Tag.render(p||(p=o`
			<div class="bizproc-workflow-instances-popup-content">
				<div class="bizproc-workflow-instances-popup-title">${0}</div>
				<div class="bizproc-workflow-instances-popup-text">
					${0}
					<br>
					${0}
				</div>
				<div class="bizproc-workflow-instances-popup-heads">
					<div class="bizproc-workflow-instances-popup-heads-item">
						${0}
					</div>
					<div class="bizproc-workflow-instances-popup-heads-item">
						${0}
					</div>
					<div class="bizproc-workflow-instances-popup-heads-item">
						${0}
					</div>
				</div>
				${0}
			</div>
		`),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TITLE"),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TEXT_P1"),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TEXT_P2"),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_AUTHOR"),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_IN_PROGRESS"),s.Loc.getMessage("BIZPROC_JS_WORKFLOW_INST_WIDGET_POPUP_TIME"),babelHelpers.classPrivateFieldLooseBase(this,H)[H])}function x(){let e=0;let a=1.15;const i=s.Tag.render(d||(d=o`<div class="bizproc-workflow-instances-popup-list-page"></div>`));while(e<5){++e;a-=.15;const t=babelHelpers.classPrivateFieldLooseBase(this,z)[z]();const r=new l.Label({color:l.LabelColor.DEFAULT,size:l.LabelSize.SM,fill:true,customClass:"bizproc-workflow-instances-popup-list-item-time-skeleton"});const c=s.Tag.render(b||(b=o`
				<div class="bizproc-workflow-instances-popup-list-item" style="opacity: ${0}">
					${0}
					<div class="bizproc-workflow-instances-popup-list-item-time">${0}</div>
				</div>
			`),a,t,r.render());s.Dom.append(c,i)}return i}function M(e){const a=s.Tag.render(v||(v=o`<div class="bizproc-workflow-instances-popup-list-page"></div>`));e.forEach((e=>{const i=babelHelpers.classPrivateFieldLooseBase(this,z)[z](e.avatars.author,e.avatars.running);const t=new l.Label({text:babelHelpers.classPrivateFieldLooseBase(this,K)[K](e.time.current),color:l.LabelColor.LIGHT_BLUE,size:l.LabelSize.SM,fill:true});const r=s.Tag.render(P||(P=o`
				<div class="bizproc-workflow-instances-popup-list-item">
					${0}
					<div class="bizproc-workflow-instances-popup-list-item-time">${0}</div>
				</div>
			`),i,t.render());s.Dom.append(r,a)}));return a}function $(){s.ajax.runAction("bizproc.workflow.getTemplateInstances",{data:{templateId:babelHelpers.classPrivateFieldLooseBase(this,f)[f].tplId,offset:babelHelpers.classPrivateFieldLooseBase(this,y)[y]}}).then((e=>{babelHelpers.classPrivateFieldLooseBase(this,y)[y]+=e.data.list.length;s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,k)[k](e.data.list),babelHelpers.classPrivateFieldLooseBase(this,H)[H]);s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,g)[g],babelHelpers.classPrivateFieldLooseBase(this,H)[H]);babelHelpers.classPrivateFieldLooseBase(this,W)[W](e.data.hasNextPage)})).catch((e=>{var a;if(((a=e.errors)==null?void 0:a.length)>0){s.Runtime.loadExtension("ui.dialogs.messagebox").then((({MessageBox:a})=>{a.alert(s.Text.encode(e.errors[0].message))})).catch((()=>{}))}else{var i;(i=console)==null?void 0:i.error(e)}}))}function G(e){if(e&&babelHelpers.classPrivateFieldLooseBase(this,g)[g]){new IntersectionObserver(((e,s)=>{e.forEach((e=>{if(e.isIntersecting){s.disconnect();babelHelpers.classPrivateFieldLooseBase(this,E)[E]()}}))})).observe(babelHelpers.classPrivateFieldLooseBase(this,g)[g]);return}s.Dom.remove(babelHelpers.classPrivateFieldLooseBase(this,g)[g]);babelHelpers.classPrivateFieldLooseBase(this,g)[g]=null}function J(e,a){const i=s.Tag.render(u||(u=o`
			<div class="bizproc-workflow-instances-popup-list-item-faces"></div>
		`));const l=new t.ImageStackSteps({steps:[{id:"col-1",stack:{images:s.Type.isArrayFilled(e)?babelHelpers.classPrivateFieldLooseBase(this,w)[w](e):babelHelpers.classPrivateFieldLooseBase(this,O)[O](L,1)},styles:{minWidth:36}},{id:"col-2",stack:{images:s.Type.isArrayFilled(a)?babelHelpers.classPrivateFieldLooseBase(this,w)[w](a):babelHelpers.classPrivateFieldLooseBase(this,O)[O](L,1)}}]});l.renderTo(i);return i}function Z(e){if(!e){return"?"}return r.DateTimeFormat.format(h,0,e)}e.Widget=R})(this.BX.Bizproc.Workflow.Instances=this.BX.Bizproc.Workflow.Instances||{},BX,BX.Event,BX.Main,BX.UI,BX.UI,BX.Main);
//# sourceMappingURL=widget.bundle.map.js