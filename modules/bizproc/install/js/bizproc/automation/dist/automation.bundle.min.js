this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,t,i,a,r,s,l,n,o,c,u,p,d,b,v,h,f,g,T,y){"use strict";function m(e,t,i){P(e,t);t.set(e,i)}function P(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var H=new WeakMap;var I=new WeakMap;var E=new WeakMap;var w=function(){function e(t){babelHelpers.classCallCheck(this,e);m(this,H,{writable:true,value:void 0});m(this,I,{writable:true,value:void 0});m(this,E,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,H,t.DocumentType);babelHelpers.classPrivateFieldSet(this,I,!T.Type.isNil(t.Category.Id)?t.Category:null);babelHelpers.classPrivateFieldSet(this,E,t.Status)}babelHelpers.createClass(e,[{key:"getId",value:function e(){if(this.hasCategory()){return"".concat(babelHelpers.classPrivateFieldGet(this,H).Type,"_").concat(babelHelpers.classPrivateFieldGet(this,I).Id,"_").concat(babelHelpers.classPrivateFieldGet(this,E).Id)}return"".concat(babelHelpers.classPrivateFieldGet(this,H).Type,"_").concat(babelHelpers.classPrivateFieldGet(this,E).Id)}},{key:"getDocumentType",value:function e(){return babelHelpers.classPrivateFieldGet(this,H)}},{key:"getDocumentCategory",value:function e(){return babelHelpers.classPrivateFieldGet(this,I)}},{key:"getDocumentStatus",value:function e(){return babelHelpers.classPrivateFieldGet(this,E)}},{key:"hasCategory",value:function e(){return!T.Type.isNull(babelHelpers.classPrivateFieldGet(this,I))}}]);return e}();function F(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */F=function t(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,a=Object.defineProperty||function(e,t,i){e[t]=i.value},r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",l=r.asyncIterator||"@@asyncIterator",n=r.toStringTag||"@@toStringTag";function o(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function e(t,i,a){return t[i]=a}}function c(e,t,i,r){var s=t&&t.prototype instanceof d?t:d,l=Object.create(s.prototype),n=new w(r||[]);return a(l,"_invoke",{value:P(e,i,n)}),l}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var p={};function d(){}function b(){}function v(){}var h={};o(h,s,(function(){return this}));var f=Object.getPrototypeOf,g=f&&f(f(S([])));g&&g!==t&&i.call(g,s)&&(h=g);var T=v.prototype=d.prototype=Object.create(h);function y(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function m(e,t){function r(a,s,l,n){var o=u(e[a],e,s);if("throw"!==o.type){var c=o.arg,p=c.value;return p&&"object"==babelHelpers["typeof"](p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,l,n)}),(function(e){r("throw",e,l,n)})):t.resolve(p).then((function(e){c.value=e,l(c)}),(function(e){return r("throw",e,l,n)}))}n(o.arg)}var s;a(this,"_invoke",{value:function e(i,a){function l(){return new t((function(e,t){r(i,a,e,t)}))}return s=s?s.then(l,l):l()}})}function P(e,t,i){var a="suspendedStart";return function(r,s){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw s;return _()}for(i.method=r,i.arg=s;;){var l=i.delegate;if(l){var n=H(l,i);if(n){if(n===p)continue;return n}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===a)throw a="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a="executing";var o=u(e,t,i);if("normal"===o.type){if(a=i.done?"completed":"suspendedYield",o.arg===p)continue;return{value:o.arg,done:i.done}}"throw"===o.type&&(a="completed",i.method="throw",i.arg=o.arg)}}}function H(e,t){var i=t.method,a=e.iterator[i];if(undefined===a)return t.delegate=null,"throw"===i&&e.iterator["return"]&&(t.method="return",t.arg=undefined,H(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;var r=u(a,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var s=r.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,p):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function S(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function t(){for(;++a<e.length;)if(i.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=undefined,t.done=!0,t};return r.next=r}}return{next:_}}function _(){return{value:undefined,done:!0}}return b.prototype=v,a(T,"constructor",{value:v,configurable:!0}),a(v,"constructor",{value:b,configurable:!0}),b.displayName=o(v,n,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,o(e,n,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},y(m.prototype),o(m.prototype,l,(function(){return this})),e.AsyncIterator=m,e.async=function(t,i,a,r,s){void 0===s&&(s=Promise);var l=new m(c(t,i,a,r),s);return e.isGeneratorFunction(i)?l:l.next().then((function(e){return e.done?e.value:l.next()}))},y(T),o(T,n,"Generator"),o(T,s,(function(){return this})),o(T,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var a in t)i.push(a);return i.reverse(),function e(){for(;i.length;){var a=i.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=S,w.prototype={constructor:w,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(E),!t)for(var a in this)"t"===a.charAt(0)&&i.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var a=this;function r(e,i){return n.type="throw",n.arg=t,a.next=e,i&&(a.method="next",a.arg=undefined),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var l=this.tryEntries[s],n=l.completion;if("root"===l.tryLoc)return r("end");if(l.tryLoc<=this.prev){var o=i.call(l,"catchLoc"),c=i.call(l,"finallyLoc");if(o&&c){if(this.prev<l.catchLoc)return r(l.catchLoc,!0);if(this.prev<l.finallyLoc)return r(l.finallyLoc)}else if(o){if(this.prev<l.catchLoc)return r(l.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return r(l.finallyLoc)}}}},abrupt:function e(t,a){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var l=s;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=a&&a<=l.finallyLoc&&(l=null);var n=l?l.completion:{};return n.type=t,n.arg=a,l?(this.method="next",this.next=l.finallyLoc,p):this.complete(n)},complete:function e(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),p},finish:function e(t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),E(a),p}},catch:function e(t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc===t){var r=a.completion;if("throw"===r.type){var s=r.arg;E(a)}return s}}throw new Error("illegal catch attempt")},delegateYield:function e(t,i,a){return this.delegate={iterator:S(t),resultName:i,nextLoc:a},"next"===this.method&&(this.arg=undefined),p}},e}function S(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=_(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function _(e,t){if(!e)return;if(typeof e==="string")return O(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return O(e,t)}function O(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function C(e,t){A(e,t);t.add(e)}function k(e,t,i){A(e,t);t.set(e,i)}function A(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function G(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var M=new WeakMap;var N=new WeakSet;var D=function(){function e(t){var i=this;babelHelpers.classCallCheck(this,e);C(this,N);k(this,M,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,M,[]);if(T.Type.isArray(t)){t.forEach((function(e){var t=new w(e);babelHelpers.classPrivateFieldGet(i,M).push(t)}))}}babelHelpers.createClass(e,[{key:"getDocumentTypes",value:function e(){var t=new Map;var i=S(babelHelpers.classPrivateFieldGet(this,M)),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;t.set(r.getDocumentType().Type,r.getDocumentType())}}catch(e){i.e(e)}finally{i.f()}return Array.from(t.values())}},{key:"getTypeCategories",value:function e(t){var i=new Map;var a=S(babelHelpers.classPrivateFieldGet(this,M)),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.hasCategory()&&s.getDocumentType().Type===t.Type){var l=s.getDocumentCategory();i.set(l.Id,l)}}}catch(e){a.e(e)}finally{a.f()}return Array.from(i.values())}},{key:"getTypeStatuses",value:function e(t,i){var a=new Set;if(T.Type.isNil(i)){i={Id:null}}var r=function e(r){var s=r.getDocumentType().Type===t.Type&&(r.hasCategory()?r.getDocumentCategory().Id===i.Id:true)&&!a.has(r.getDocumentStatus().Id);if(s){a.add(r.getDocumentStatus().Id)}return s};return Array.from(G(this,N,L).call(this,r)).map((function(e){return e.getDocumentStatus()}))}}]);return e}();function L(e){var t=F().mark((function t(i){var a,r,s;return F().wrap((function t(l){while(1)switch(l.prev=l.next){case 0:a=S(i);l.prev=1;a.s();case 3:if((r=a.n()).done){l.next=10;break}s=r.value;if(!e(s)){l.next=8;break}l.next=8;return s;case 8:l.next=3;break;case 10:l.next=15;break;case 12:l.prev=12;l.t0=l["catch"](1);a.e(l.t0);case 15:l.prev=15;a.f();return l.finish(15);case 18:case"end":return l.stop()}}),t,null,[[1,12,15,18]])}));return t(babelHelpers.classPrivateFieldGet(this,M))}function R(e,t,i){x(e,t);t.set(e,i)}function x(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var B=new WeakMap;var z=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));R(babelHelpers.assertThisInitialized(i),B,{writable:true,value:void 0});i.setEventNamespace("BX.Bizproc.Automation.Context");if(T.Type.isPlainObject(e)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),B,e)}return i}babelHelpers.createClass(t,[{key:"clone",value:function e(){return new t(T.clone(babelHelpers.classPrivateFieldGet(this,B)))}},{key:"getValues",value:function e(){return babelHelpers.classPrivateFieldGet(this,B)}},{key:"set",value:function e(t,i){var a=this.has(t);babelHelpers.classPrivateFieldGet(this,B)[t]=i;this.emit(a?"valueChanged":"valueAdded",{name:t,value:i});return this}},{key:"get",value:function e(t){return babelHelpers.classPrivateFieldGet(this,B)[t]}},{key:"has",value:function e(t){return babelHelpers.classPrivateFieldGet(this,B).hasOwnProperty(t)}},{key:"subsribeValueChanges",value:function e(t,i){this.subscribe("valueChanged",(function(e){if(e.data.name===t){i(e)}}));return this}}]);return t}(n.EventEmitter);var U=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e))}babelHelpers.createClass(t,[{key:"clone",value:function e(){var i;return new t(T.Runtime.clone(this.getValues())).set("document",this.document.clone()).set("userOptions",(i=this.userOptions)===null||i===void 0?void 0:i.clone())}},{key:"getAvailableTrigger",value:function e(t){return this.availableTriggers.find((function(e){return e["CODE"]===t}))}},{key:"document",get:function e(){return this.get("document")}},{key:"signedDocument",get:function e(){var t;return(t=this.get("signedDocument"))!==null&&t!==void 0?t:""}},{key:"ajaxUrl",get:function e(){var t;return(t=this.get("ajaxUrl"))!==null&&t!==void 0?t:""}},{key:"availableRobots",get:function e(){var t=this.get("availableRobots");if(T.Type.isArray(t)){return t}return[]}},{key:"availableTriggers",get:function e(){var t=this.get("availableTriggers");if(T.Type.isArray(t)){return t}return[]}},{key:"canManage",get:function e(){var t=this.get("canManage");return T.Type.isBoolean(t)&&t}},{key:"canEdit",get:function e(){var t=this.get("canEdit");return T.Type.isBoolean(t)&&t}},{key:"userOptions",get:function e(){return this.get("userOptions")}},{key:"tracker",get:function e(){return this.get("tracker")},set:function e(t){this.set("tracker",t)}},{key:"bizprocEditorUrl",get:function e(){return this.get("bizprocEditorUrl")}},{key:"constantsEditorUrl",get:function e(){return this.get("constantsEditorUrl")}},{key:"parametersEditorUrl",get:function e(){return this.get("parametersEditorUrl")}},{key:"automationGlobals",get:function e(){return this.get("automationGlobals")}}]);return t}(z);function W(e,t,i){j(e,t);t.set(e,i)}function j(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Y(e,t,i){Z(e,t);V(i,"get");return X(e,i)}function V(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function Z(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function X(e,t){if(t.get){return t.get.call(e)}return t.value}var q=new WeakMap;var J=new WeakMap;var K=function(){function e(t){babelHelpers.classCallCheck(this,e);W(this,q,{writable:true,value:void 0});W(this,J,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,q,t);babelHelpers.classPrivateFieldSet(this,J,{})}babelHelpers.createClass(e,[{key:"isNone",value:function t(){return babelHelpers.classPrivateFieldGet(this,q)===Y(e,e,Q)}},{key:"isView",value:function t(){return babelHelpers.classPrivateFieldGet(this,q)===Y(e,e,$)}},{key:"isEdit",value:function t(){return babelHelpers.classPrivateFieldGet(this,q)===Y(e,e,ee)}},{key:"isManage",value:function t(){return babelHelpers.classPrivateFieldGet(this,q)===Y(e,e,te)}},{key:"setProperty",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,J)[t]=i;return this}},{key:"getProperty",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(babelHelpers.classPrivateFieldGet(this,J).hasOwnProperty(t)){return babelHelpers.classPrivateFieldGet(this,J)[t]}return i}},{key:"intoRaw",value:function e(){return babelHelpers.classPrivateFieldGet(this,q)}}],[{key:"none",value:function t(){return new e(Y(e,e,Q))}},{key:"view",value:function t(){return new e(Y(e,e,$))}},{key:"edit",value:function t(){return new e(Y(e,e,ee))}},{key:"manage",value:function t(){return new e(Y(e,e,te))}},{key:"fromRaw",value:function t(i){if(e.getAll().includes(i)){return new e(i)}return e.none()}},{key:"getAll",value:function t(){return[Y(this,e,Q),Y(this,e,$),Y(this,e,ee),Y(this,e,te)]}}]);return e}();var Q={writable:true,value:0};var $={writable:true,value:1};var ee={writable:true,value:2};var te={writable:true,value:3};var ie;function ae(e,t,i){re(e,t);t.set(e,i)}function re(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var se=new WeakMap;var le=new WeakMap;var ne=new WeakMap;var oe=new WeakMap;var ce=new WeakMap;var ue=new WeakMap;var pe=new WeakMap;var de=new WeakMap;var be=new WeakMap;var ve=function(e){babelHelpers.inherits(t,e);function t(){var e;babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));ae(babelHelpers.assertThisInitialized(e),se,{writable:true,value:void 0});ae(babelHelpers.assertThisInitialized(e),le,{writable:true,value:void 0});ae(babelHelpers.assertThisInitialized(e),ne,{writable:true,value:void 0});ae(babelHelpers.assertThisInitialized(e),oe,{writable:true,value:void 0});ae(babelHelpers.assertThisInitialized(e),ce,{writable:true,value:void 0});ae(babelHelpers.assertThisInitialized(e),ue,{writable:true,value:void 0});ae(babelHelpers.assertThisInitialized(e),pe,{writable:true,value:void 0});ae(babelHelpers.assertThisInitialized(e),de,{writable:true,value:void 0});ae(babelHelpers.assertThisInitialized(e),be,{writable:true,value:void 0});e.setEventNamespace("BX.Bizproc.Automation");e.draft=false;babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),se,{});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),le,false);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),ne,K.none());babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(e),oe,new h.ConditionGroup);return e}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,se,T.clone(t));if(T.Type.isString(babelHelpers.classPrivateFieldGet(this,se)["ID"])){var a=parseInt(babelHelpers.classPrivateFieldGet(this,se)["ID"]);babelHelpers.classPrivateFieldGet(this,se)["ID"]=T.Type.isNumber(a)?a:0}if(!T.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,se)["APPLY_RULES"])){babelHelpers.classPrivateFieldGet(this,se)["APPLY_RULES"]={}}if(babelHelpers.classPrivateFieldGet(this,se)["APPLY_RULES"].Condition){babelHelpers.classPrivateFieldSet(this,oe,new h.ConditionGroup(babelHelpers.classPrivateFieldGet(this,se)["APPLY_RULES"].Condition))}else{babelHelpers.classPrivateFieldSet(this,oe,new h.ConditionGroup)}babelHelpers.classPrivateFieldSet(this,ne,T.Type.isNil(i)?K.edit():i);babelHelpers.classPrivateFieldSet(this,ce,this.createNode())}},{key:"reInit",value:function e(t,i){var a=babelHelpers.classPrivateFieldGet(this,ce);babelHelpers.classPrivateFieldSet(this,ce,this.createNode());if(a.parentNode){a.parentNode.replaceChild(babelHelpers.classPrivateFieldGet(this,ce),a)}}},{key:"canEdit",value:function e(){return h.getGlobalContext().canEdit}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,se)["ID"]||0}},{key:"getStatusId",value:function e(){return String(babelHelpers.classPrivateFieldGet(this,se)["DOCUMENT_STATUS"]||"")}},{key:"getStatus",value:function e(){var t=this;return h.getGlobalContext().document.statusList.find((function(e){return String(e.STATUS_ID)===t.getStatusId()}))}},{key:"getCode",value:function e(){var t;return(t=babelHelpers.classPrivateFieldGet(this,se)["CODE"])!==null&&t!==void 0?t:""}},{key:"getName",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,se)["NAME"];if(!t){var i;var a=this.getCode();var r=h.getGlobalContext().availableTriggers.find((function(e){return a===e["CODE"]}));t=(i=r===null||r===void 0?void 0:r.NAME)!==null&&i!==void 0?i:a}return t}},{key:"setName",value:function e(t){if(T.Type.isString(t)){babelHelpers.classPrivateFieldGet(this,se)["NAME"]=t}return this}},{key:"getApplyRules",value:function e(){return babelHelpers.classPrivateFieldGet(this,se)["APPLY_RULES"]}},{key:"setApplyRules",value:function e(t){babelHelpers.classPrivateFieldGet(this,se)["APPLY_RULES"]=t;return this}},{key:"getLogStatus",value:function e(){var t=h.getGlobalContext().tracker.getTriggerLog(this.getId());return t?t.status:null}},{key:"getCondition",value:function e(){return babelHelpers.classPrivateFieldGet(this,oe)}},{key:"setCondition",value:function e(t){babelHelpers.classPrivateFieldSet(this,oe,t);return this}},{key:"isBackwardsAllowed",value:function e(){return babelHelpers.classPrivateFieldGet(this,se)["APPLY_RULES"]["ALLOW_BACKWARDS"]==="Y"}},{key:"setAllowBackwards",value:function e(t){babelHelpers.classPrivateFieldGet(this,se)["APPLY_RULES"]["ALLOW_BACKWARDS"]=t?"Y":"N";return this}},{key:"getExecuteBy",value:function e(){return babelHelpers.classPrivateFieldGet(this,se)["APPLY_RULES"]["ExecuteBy"]||""}},{key:"setExecuteBy",value:function e(t){babelHelpers.classPrivateFieldGet(this,se)["APPLY_RULES"]["ExecuteBy"]=t;return this}},{key:"enableManageMode",value:function e(t){babelHelpers.classPrivateFieldSet(this,ne,K.manage().setProperty("isActive",t));var i=T.Tag.render(ie||(ie=babelHelpers.taggedTemplateLiteral(['<div class="ui-ctl ui-ctl-inline bizproc-automation-trigger-checkbox">\n\t\t\t<input class="ui-ctl-checkbox" type="checkbox" name="name">\n\t\t</div>'])));var a=babelHelpers.classPrivateFieldGet(this,ce).querySelector('[data-role="btn-delete-trigger"]');T.Dom.hide(a);if(t&&a){T.Dom.append(i,babelHelpers.classPrivateFieldGet(this,ce))}else{T.Dom.addClass(babelHelpers.classPrivateFieldGet(this,ce),"--locked-node")}}},{key:"disableManageMode",value:function e(){babelHelpers.classPrivateFieldSet(this,ne,K.edit());var t=babelHelpers.classPrivateFieldGet(this,ce).querySelector(".bizproc-automation-trigger-checkbox");var i=babelHelpers.classPrivateFieldGet(this,ce).querySelector('[data-role="btn-delete-trigger"]');babelHelpers.classPrivateFieldGet(this,ce).onclick=undefined;babelHelpers.classPrivateFieldSet(this,ne,K.edit());this.unselectNode();T.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,ce),"--locked-node");T.Dom.remove(t);T.Dom.show(i)}},{key:"selectNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ce)){T.Dom.addClass(babelHelpers.classPrivateFieldGet(this,ce),"--selected");var t=babelHelpers.classPrivateFieldGet(this,ce).querySelector("input");if(t){t.checked=true}this.emit("Trigger:selected")}}},{key:"unselectNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,ce)){T.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,ce),"--selected");var t=babelHelpers.classPrivateFieldGet(this,ce).querySelector("input");if(t){t.checked=false}this.emit("Trigger:unselected")}}},{key:"isSelected",value:function e(){return babelHelpers.classPrivateFieldGet(this,ne).isManage()&&T.Dom.hasClass(this.node,"--selected")}},{key:"createNode",value:function e(){var t=this;var i="bizproc-automation-trigger-item-wrapper";if(babelHelpers.classPrivateFieldGet(this,ne).isEdit()&&this.canEdit()){i+=" bizproc-automation-trigger-item-wrapper-draggable"}var a=null;var r=null;if(babelHelpers.classPrivateFieldGet(this,ne).isEdit()){a=T.Dom.create("div",{attrs:{className:"bizproc-automation-trigger-item-wrapper-edit"},text:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EDIT")});r=T.Dom.create("div",{attrs:{className:"bizproc-automation-trigger-btn-copy"},text:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_COPY")||"copy"});T.Event.bind(r,"click",this.onCopyButtonClick.bind(this,r))}if(this.getLogStatus()===h.TrackingStatus.COMPLETED){i+=" bizproc-automation-trigger-item-wrapper-complete"}else if(h.getGlobalContext().document.getPreviousStatusIdList().includes(this.getStatusId())){i+=" bizproc-automation-trigger-item-wrapper-complete-light"}var s=this.getName();var l="bizproc-automation-trigger-item";if(this.getLogStatus()===h.TrackingStatus.COMPLETED){l+=" --complete"}else if(this.draft){l+=" --draft"}var n=T.Dom.create("DIV",{attrs:{"data-role":"trigger-container",className:l,"data-type":"item-trigger"},children:[T.Dom.create("div",{attrs:{className:i},children:[T.Dom.create("div",{attrs:{className:"bizproc-automation-trigger-item-wrapper-text",title:s},text:s})]}),r,a]});if(!babelHelpers.classPrivateFieldGet(this,ne).isEdit()){return n}if(this.canEdit()){this.registerItem(n)}var o=T.Dom.create("SPAN",{attrs:{"data-role":"btn-delete-trigger",className:"bizproc-automation-trigger-btn-delete"}});T.Event.bind(o,"click",this.onDeleteButtonClick.bind(this,o));n.appendChild(o);if(babelHelpers.classPrivateFieldGet(this,ne).isEdit()){T.Event.bind(n,"click",this.onSettingsButtonClick.bind(this,n))}T.Event.bind(n,"click",(function(){if(babelHelpers.classPrivateFieldGet(t,ne).isManage()&&babelHelpers.classPrivateFieldGet(t,ne).getProperty("isActive",false)){if(!t.isSelected()){t.selectNode()}else{t.unselectNode()}}}));return n}},{key:"onSettingsButtonClick",value:function e(t){if(!this.canEdit()){h.HelpHint.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,ne).isManage()){this.emit("Trigger:onSettingsOpen",{trigger:this})}}},{key:"onCopyButtonClick",value:function e(i,a){a.stopPropagation();if(!this.canEdit()){h.HelpHint.showNoPermissionsHint(i)}else if(!babelHelpers.classPrivateFieldGet(this,ne).isManage()){var r=new t;var s=this.serialize();delete s["ID"];var l=this.getSettingProperties().filter((function(e){return e.Copyable===false})).map((function(e){return e.Id}));l.forEach((function(e){return delete s["APPLY_RULES"][e]}));r.init(s,babelHelpers.classPrivateFieldGet(this,ne));this.emit("Trigger:copied",{trigger:r})}}},{key:"onSearch",value:function e(t){if(!babelHelpers.classPrivateFieldGet(this,ce)){return}var i=t.getData().queryString;var a=!i||this.getName().toLowerCase().indexOf(i)>=0;T.Dom[a?"removeClass":"addClass"](babelHelpers.classPrivateFieldGet(this,ce),"--search-mismatch")}},{key:"registerItem",value:function e(t){if(T.Type.isNil(t["__bxddid"])){t.onbxdragstart=BX.proxy(this.dragStart,this);t.onbxdrag=BX.proxy(this.dragMove,this);t.onbxdragstop=BX.proxy(this.dragStop,this);t.onbxdraghover=BX.proxy(this.dragOver,this);jsDD.registerObject(t);jsDD.registerDest(t,1)}}},{key:"unregisterItem",value:function e(t){t.onbxdragstart=undefined;t.onbxdrag=undefined;t.onbxdragstop=undefined;t.onbxdraghover=undefined;jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},{key:"dragStart",value:function e(){babelHelpers.classPrivateFieldSet(this,ue,BX.proxy_context);if(!babelHelpers.classPrivateFieldGet(this,ue)){jsDD.stopCurrentDrag();return}if(!babelHelpers.classPrivateFieldGet(this,be)){var t=babelHelpers.classPrivateFieldGet(this,ue).offsetWidth;babelHelpers.classPrivateFieldSet(this,be,babelHelpers.classPrivateFieldGet(this,ue).cloneNode(true));babelHelpers.classPrivateFieldGet(this,be).style.position="absolute";babelHelpers.classPrivateFieldGet(this,be).classList.add("bizproc-automation-trigger-item-drag");babelHelpers.classPrivateFieldGet(this,be).style.width=t+"px";document.body.appendChild(babelHelpers.classPrivateFieldGet(this,be))}}},{key:"dragMove",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,be).style.left=t+"px";babelHelpers.classPrivateFieldGet(this,be).style.top=i+"px"}},{key:"dragOver",value:function e(t,i,a){if(babelHelpers.classPrivateFieldGet(this,pe)){babelHelpers.classPrivateFieldGet(this,pe).classList.remove("bizproc-automation-trigger-item-pre")}if(babelHelpers.classPrivateFieldGet(this,de)){babelHelpers.classPrivateFieldGet(this,de).classList.remove("bizproc-automation-trigger-list-pre")}var r=t.getAttribute("data-type");if(r==="item-trigger"){babelHelpers.classPrivateFieldSet(this,pe,t);babelHelpers.classPrivateFieldSet(this,de,null)}if(r==="column-trigger"){babelHelpers.classPrivateFieldSet(this,de,t.querySelector('[data-role="trigger-list"]'));babelHelpers.classPrivateFieldSet(this,pe,null)}if(babelHelpers.classPrivateFieldGet(this,pe)){babelHelpers.classPrivateFieldGet(this,pe).classList.add("bizproc-automation-trigger-item-pre")}if(babelHelpers.classPrivateFieldGet(this,de)){babelHelpers.classPrivateFieldGet(this,de).classList.add("bizproc-automation-trigger-list-pre")}}},{key:"dragStop",value:function e(i,a,r){var s=this;r=r||window.event;var l=null;var n=r&&(r.ctrlKey||r.metaKey);var o=function e(i,a){var r=new t;var l=i.serialize();delete l["ID"];var n=s.getSettingProperties().filter((function(e){return e.Copyable===false})).map((function(e){return e.Id}));n.forEach((function(e){return delete l["APPLY_RULES"][e]}));l["DOCUMENT_STATUS"]=a;r.init(l,babelHelpers.classPrivateFieldGet(i,ne));return r};if(babelHelpers.classPrivateFieldGet(this,ue)){if(babelHelpers.classPrivateFieldGet(this,pe)){babelHelpers.classPrivateFieldGet(this,pe).classList.remove("bizproc-automation-trigger-item-pre");var c=babelHelpers.classPrivateFieldGet(this,pe).parentNode;if(!n){c.insertBefore(babelHelpers.classPrivateFieldGet(this,ue),babelHelpers.classPrivateFieldGet(this,pe));this.moveTo(c.getAttribute("data-status-id"))}else{l=o(this,c.getAttribute("data-status-id"));c.insertBefore(babelHelpers.classPrivateFieldGet(l,ce),babelHelpers.classPrivateFieldGet(this,pe))}}else if(babelHelpers.classPrivateFieldGet(this,de)){babelHelpers.classPrivateFieldGet(this,de).classList.remove("bizproc-automation-trigger-list-pre");if(!n){babelHelpers.classPrivateFieldGet(this,de).appendChild(babelHelpers.classPrivateFieldGet(this,ue));this.moveTo(babelHelpers.classPrivateFieldGet(this,de).getAttribute("data-status-id"))}else{l=o(this,babelHelpers.classPrivateFieldGet(this,de).getAttribute("data-status-id"));babelHelpers.classPrivateFieldGet(this,de).appendChild(babelHelpers.classPrivateFieldGet(l,ce))}}if(l){this.emit("Trigger:copied",{trigger:l,skipInsert:true})}}babelHelpers.classPrivateFieldGet(this,be).parentNode.removeChild(babelHelpers.classPrivateFieldGet(this,be));babelHelpers.classPrivateFieldSet(this,be,null);babelHelpers.classPrivateFieldSet(this,ue,null);babelHelpers.classPrivateFieldSet(this,pe,null)}},{key:"onDeleteButtonClick",value:function e(t,i){i.stopPropagation();if(!this.canEdit()){h.HelpHint.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,ne).isManage()){T.Dom.remove(t.parentNode);this.emit("Trigger:deleted",{trigger:this})}}},{key:"updateData",value:function e(t){if(T.Type.isPlainObject(t)){babelHelpers.classPrivateFieldSet(this,se,t)}else{throw"Invalid data"}}},{key:"markDeleted",value:function e(){babelHelpers.classPrivateFieldSet(this,le,true);return this}},{key:"serialize",value:function e(){var t=T.clone(babelHelpers.classPrivateFieldGet(this,se));if(babelHelpers.classPrivateFieldGet(this,le)){t["DELETED"]="Y"}if(!T.Type.isPlainObject(t.APPLY_RULES)){t.APPLY_RULES={}}if(!babelHelpers.classPrivateFieldGet(this,oe).items.length){delete t.APPLY_RULES.Condition}else{t.APPLY_RULES.Condition=babelHelpers.classPrivateFieldGet(this,oe).serialize()}return t}},{key:"moveTo",value:function e(t){babelHelpers.classPrivateFieldGet(this,se)["DOCUMENT_STATUS"]=t;this.emit("Trigger:modified",{trigger:this})}},{key:"getReturnProperties",value:function e(){var t=this;var i=h.getGlobalContext().availableTriggers.find((function(e){return e["CODE"]===t.getCode()}));return i&&T.Type.isArray(i.RETURN)?i.RETURN:[]}},{key:"getSettingProperties",value:function e(){var t=this;var i=h.getGlobalContext().availableTriggers.find((function(e){return e["CODE"]===t.getCode()}));if(i.SETTINGS&&i.SETTINGS.Properties){return i.SETTINGS.Properties}return[]}},{key:"node",get:function e(){return babelHelpers.classPrivateFieldGet(this,ce)}},{key:"deleted",get:function e(){return babelHelpers.classPrivateFieldGet(this,le)}},{key:"documentStatus",get:function e(){var t;return(t=babelHelpers.classPrivateFieldGet(this,se)["DOCUMENT_STATUS"])!==null&&t!==void 0?t:""}}]);return t}(n.EventEmitter);function he(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=fe(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function fe(e,t){if(!e)return;if(typeof e==="string")return ge(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ge(e,t)}function ge(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Te(e,t,i,a){He(e,t);Pe(i,"set");ye(e,i,a);return a}function ye(e,t,i){if(t.set){t.set.call(e,i)}else{if(!t.writable){throw new TypeError("attempted to set read only private field")}t.value=i}}function me(e,t,i){He(e,t);Pe(i,"get");return Ie(e,i)}function Pe(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function He(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Ie(e,t){if(t.get){return t.get.call(e)}return t.value}var Ee=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"generateUniqueId",value:function t(){var i;Te(e,e,we,(i=me(e,e,we),++i));return"bizproc-automation-cmp-"+me(e,e,we)}},{key:"toJsonString",value:function e(t){return JSON.stringify(t,(function(e,t){if(typeof t=="boolean"){return t?"1":"0"}return t}))}},{key:"getResponsibleUserExpression",value:function e(t){if(T.Type.isArray(t)){var i=he(t),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;if(r["Id"]==="ASSIGNED_BY_ID"||r["Id"]==="RESPONSIBLE_ID"){return"{{"+r["Name"]+"}}"}}}catch(e){i.e(e)}finally{i.f()}}return null}}]);return e}();var we={writable:true,value:0};function Fe(e,t,i,a){Ce(e,t);Oe(i,"set");Se(e,i,a);return a}function Se(e,t,i){if(t.set){t.set.call(e,i)}else{if(!t.writable){throw new TypeError("attempted to set read only private field")}t.value=i}}function _e(e,t,i){Ce(e,t);Oe(i,"get");return ke(e,i)}function Oe(e,t){if(e===undefined){throw new TypeError("attempted to "+t+" private static field before its declaration")}}function Ce(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function ke(e,t){if(t.get){return t.get.call(e)}return t.value}var Ae=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,[{key:"setRobotSettingsDialog",value:function e(t){this.robotSettingsDialog=t;this.robot=t?t.robot:null}},{key:"getRobotSettingsDialog",value:function e(){return this.robotSettingsDialog}},{key:"setTriggerSettingsDialog",value:function e(t){this.triggerSettingsDialog=t}},{key:"getTriggerSettingsDialog",value:function e(){return this.triggerSettingsDialog}}],[{key:"getInstance",value:function t(){if(!_e(e,e,Ge)){Fe(e,e,Ge,new e)}return _e(e,e,Ge)}}]);return e}();var Ge={writable:true,value:void 0};var Me,Ne,De,Le,Re,xe,Be,ze,Ue,We,je,Ye,Ve,Ze,Xe,qe;function Je(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Ke(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Je(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Qe(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=$e(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function $e(e,t){if(!e)return;if(typeof e==="string")return et(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return et(e,t)}function et(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function tt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */tt=function t(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,a=Object.defineProperty||function(e,t,i){e[t]=i.value},r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",l=r.asyncIterator||"@@asyncIterator",n=r.toStringTag||"@@toStringTag";function o(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function e(t,i,a){return t[i]=a}}function c(e,t,i,r){var s=t&&t.prototype instanceof d?t:d,l=Object.create(s.prototype),n=new w(r||[]);return a(l,"_invoke",{value:P(e,i,n)}),l}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var p={};function d(){}function b(){}function v(){}var h={};o(h,s,(function(){return this}));var f=Object.getPrototypeOf,g=f&&f(f(F([])));g&&g!==t&&i.call(g,s)&&(h=g);var T=v.prototype=d.prototype=Object.create(h);function y(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function m(e,t){function r(a,s,l,n){var o=u(e[a],e,s);if("throw"!==o.type){var c=o.arg,p=c.value;return p&&"object"==babelHelpers["typeof"](p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,l,n)}),(function(e){r("throw",e,l,n)})):t.resolve(p).then((function(e){c.value=e,l(c)}),(function(e){return r("throw",e,l,n)}))}n(o.arg)}var s;a(this,"_invoke",{value:function e(i,a){function l(){return new t((function(e,t){r(i,a,e,t)}))}return s=s?s.then(l,l):l()}})}function P(e,t,i){var a="suspendedStart";return function(r,s){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw s;return S()}for(i.method=r,i.arg=s;;){var l=i.delegate;if(l){var n=H(l,i);if(n){if(n===p)continue;return n}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===a)throw a="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a="executing";var o=u(e,t,i);if("normal"===o.type){if(a=i.done?"completed":"suspendedYield",o.arg===p)continue;return{value:o.arg,done:i.done}}"throw"===o.type&&(a="completed",i.method="throw",i.arg=o.arg)}}}function H(e,t){var i=t.method,a=e.iterator[i];if(undefined===a)return t.delegate=null,"throw"===i&&e.iterator["return"]&&(t.method="return",t.arg=undefined,H(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;var r=u(a,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var s=r.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,p):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function F(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function t(){for(;++a<e.length;)if(i.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=undefined,t.done=!0,t};return r.next=r}}return{next:S}}function S(){return{value:undefined,done:!0}}return b.prototype=v,a(T,"constructor",{value:v,configurable:!0}),a(v,"constructor",{value:b,configurable:!0}),b.displayName=o(v,n,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,o(e,n,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},y(m.prototype),o(m.prototype,l,(function(){return this})),e.AsyncIterator=m,e.async=function(t,i,a,r,s){void 0===s&&(s=Promise);var l=new m(c(t,i,a,r),s);return e.isGeneratorFunction(i)?l:l.next().then((function(e){return e.done?e.value:l.next()}))},y(T),o(T,n,"Generator"),o(T,s,(function(){return this})),o(T,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var a in t)i.push(a);return i.reverse(),function e(){for(;i.length;){var a=i.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=F,w.prototype={constructor:w,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(E),!t)for(var a in this)"t"===a.charAt(0)&&i.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var a=this;function r(e,i){return n.type="throw",n.arg=t,a.next=e,i&&(a.method="next",a.arg=undefined),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var l=this.tryEntries[s],n=l.completion;if("root"===l.tryLoc)return r("end");if(l.tryLoc<=this.prev){var o=i.call(l,"catchLoc"),c=i.call(l,"finallyLoc");if(o&&c){if(this.prev<l.catchLoc)return r(l.catchLoc,!0);if(this.prev<l.finallyLoc)return r(l.finallyLoc)}else if(o){if(this.prev<l.catchLoc)return r(l.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return r(l.finallyLoc)}}}},abrupt:function e(t,a){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var l=s;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=a&&a<=l.finallyLoc&&(l=null);var n=l?l.completion:{};return n.type=t,n.arg=a,l?(this.method="next",this.next=l.finallyLoc,p):this.complete(n)},complete:function e(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),p},finish:function e(t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),E(a),p}},catch:function e(t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc===t){var r=a.completion;if("throw"===r.type){var s=r.arg;E(a)}return s}}throw new Error("illegal catch attempt")},delegateYield:function e(t,i,a){return this.delegate={iterator:F(t),resultName:i,nextLoc:a},"next"===this.method&&(this.arg=undefined),p}},e}function it(e,t){rt(e,t);t.add(e)}function at(e,t,i){rt(e,t);t.set(e,i)}function rt(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function st(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var lt=new WeakMap;var nt=new WeakMap;var ot=new WeakMap;var ct=new WeakMap;var ut=new WeakMap;var pt=new WeakMap;var dt=new WeakMap;var bt=new WeakMap;var vt=new WeakMap;var ht=new WeakSet;var ft=new WeakSet;var gt=new WeakSet;var Tt=new WeakSet;var yt=new WeakSet;var mt=new WeakSet;var Pt=new WeakSet;var Ht=function(e){babelHelpers.inherits(t,e);function t(e){var i;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));it(babelHelpers.assertThisInitialized(i),Pt);it(babelHelpers.assertThisInitialized(i),mt);it(babelHelpers.assertThisInitialized(i),yt);it(babelHelpers.assertThisInitialized(i),Tt);it(babelHelpers.assertThisInitialized(i),gt);it(babelHelpers.assertThisInitialized(i),ft);it(babelHelpers.assertThisInitialized(i),ht);at(babelHelpers.assertThisInitialized(i),lt,{writable:true,value:void 0});at(babelHelpers.assertThisInitialized(i),nt,{writable:true,value:void 0});at(babelHelpers.assertThisInitialized(i),ot,{writable:true,value:void 0});at(babelHelpers.assertThisInitialized(i),ct,{writable:true,value:void 0});at(babelHelpers.assertThisInitialized(i),ut,{writable:true,value:void 0});at(babelHelpers.assertThisInitialized(i),pt,{writable:true,value:void 0});at(babelHelpers.assertThisInitialized(i),dt,{writable:true,value:void 0});at(babelHelpers.assertThisInitialized(i),bt,{writable:true,value:void 0});at(babelHelpers.assertThisInitialized(i),vt,{writable:true,value:{}});i.setEventNamespace("BX.Bizproc.Automation");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),lt,e);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),nt,a.userOptions);return i}babelHelpers.createClass(t,[{key:"fetchTriggers",value:function(){var e=babelHelpers.asyncToGenerator(tt().mark((function e(){var t;return tt().wrap((function e(i){while(1)switch(i.prev=i.next){case 0:t=this;return i.abrupt("return",new Promise((function(e,i){return T.ajax({method:"POST",dataType:"json",url:h.getGlobalContext().ajaxUrl,data:{ajax_action:"get_triggers",document_signed:h.getGlobalContext().signedDocument},onsuccess:function a(r){if(r.SUCCESS){t.reInit({TRIGGERS:r.DATA.triggers},babelHelpers.classPrivateFieldGet(t,ot));e()}else{i()}},onerror:function e(){i()}})})));case 2:case"end":return i.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"init",value:function e(t,i){if(!T.Type.isPlainObject(t)){t={}}babelHelpers.classPrivateFieldSet(this,ot,i.isNone()?K.edit():i);babelHelpers.classPrivateFieldSet(this,ut,T.Type.isArray(t.TRIGGERS)?t.TRIGGERS:[]);babelHelpers.classPrivateFieldSet(this,pt,document.querySelectorAll('[data-type="column-trigger"]'));babelHelpers.classPrivateFieldSet(this,dt,babelHelpers.classPrivateFieldGet(this,lt).querySelectorAll('[data-role="trigger-list"]'));babelHelpers.classPrivateFieldSet(this,bt,false);this.initTriggers();this.markModified(false);babelHelpers.classPrivateFieldGet(this,pt).forEach((function(e){return jsDD.registerDest(e,10)}));top.BX.addCustomEvent(top,"Rest:AppLayout:ApplicationInstall",this.onRestAppInstall.bind(this))}},{key:"reInit",value:function e(t,i){if(!T.Type.isPlainObject(t)){t={}}babelHelpers.classPrivateFieldSet(this,ot,i||K.none());babelHelpers.classPrivateFieldGet(this,dt).forEach((function(e){return T.Dom.clean(e)}));babelHelpers.classPrivateFieldSet(this,ut,T.Type.isArray(t.TRIGGERS)?t.TRIGGERS:[]);this.initTriggers();this.markModified(false)}},{key:"initTriggers",value:function e(){var t=this;babelHelpers.classPrivateFieldSet(this,ct,[]);babelHelpers.classPrivateFieldGet(this,ut).forEach((function(e){var i=new ve;i.init(e,babelHelpers.classPrivateFieldGet(t,ot));t.subscribeTriggerEvents(i);t.insertTriggerNode(i.getStatusId(),i.node);babelHelpers.classPrivateFieldGet(t,ct).push(i)}))}},{key:"subscribeTriggerEvents",value:function e(t){var i=this;t.subscribe("Trigger:copied",(function(e){var t=e.data.trigger;babelHelpers.classPrivateFieldGet(i,ct).push(t);if(!e.data.skipInsert){i.insertTriggerNode(t.getStatusId(),t.node)}i.subscribeTriggerEvents(t);i.markModified()}));t.subscribe("Trigger:modified",(function(){return i.markModified()}));t.subscribe("Trigger:onSettingsOpen",(function(e){i.openTriggerSettingsDialog(e.data.trigger)}));t.subscribe("Trigger:deleted",(function(e){return i.deleteTrigger(e.data.trigger)}));Object.entries(babelHelpers.classPrivateFieldGet(this,vt)).forEach((function(e){var i=babelHelpers.slicedToArray(e,2),a=i[0],r=i[1];return t.subscribe(a,r)}))}},{key:"onTriggerEvent",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,vt)[t]=i;babelHelpers.classPrivateFieldGet(this,ct).forEach((function(e){e.subscribe(t,(function(t){return i(t,e)}))}))}},{key:"getSelectedTriggers",value:function e(){return babelHelpers.classPrivateFieldGet(this,ct).filter((function(e){return e.isSelected()}))}},{key:"onSearch",value:function e(t){babelHelpers.classPrivateFieldGet(this,ct).forEach((function(e){return e.onSearch(t)}))}},{key:"enableManageMode",value:function e(t){babelHelpers.classPrivateFieldSet(this,ot,K.manage());document.querySelectorAll('[data-role="trigger-list"]').forEach((function(e){if(e.dataset.statusId===t){T.Dom.addClass(e,"--multiselect-mode")}}));babelHelpers.classPrivateFieldGet(this,ct).forEach((function(e){e.enableManageMode(e.documentStatus===t)}))}},{key:"disableManageMode",value:function e(){babelHelpers.classPrivateFieldSet(this,ot,K.edit());document.querySelectorAll('[data-role="trigger-list"]').forEach((function(e){T.Dom.removeClass(e,"--multiselect-mode")}));babelHelpers.classPrivateFieldGet(this,ct).forEach((function(e){return e.disableManageMode()}))}},{key:"addTrigger",value:function e(t,i){var a=new ve;a.draft=true;a.init(t,babelHelpers.classPrivateFieldGet(this,ot));this.subscribeTriggerEvents(a);if(i){i.call(this,a)}this.emit("TriggerManager:trigger:add",{trigger:a})}},{key:"deleteTrigger",value:function e(t,i){if(t.getId()>0){t.markDeleted()}else{for(var a=0;a<babelHelpers.classPrivateFieldGet(this,ct).length;++a){if(babelHelpers.classPrivateFieldGet(this,ct)[a]===t){babelHelpers.classPrivateFieldGet(this,ct).splice(a,1)}}}if(i){i(t)}this.emit("TriggerManager:trigger:delete",{trigger:t});this.markModified()}},{key:"enableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,ct).forEach((function(e){return e.registerItem(e.node)}));babelHelpers.classPrivateFieldGet(this,lt).querySelectorAll(".bizproc-automation-trigger-item-wrapper").forEach((function(e){T.Dom.addClass(e,"bizproc-automation-trigger-item-wrapper-draggable")}))}},{key:"disableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,ct).forEach((function(e){return e.unregisterItem(e.node)}));babelHelpers.classPrivateFieldGet(this,lt).querySelectorAll(".bizproc-automation-trigger-item-wrapper").forEach((function(e){T.Dom.removeClass(e,"bizproc-automation-trigger-item-wrapper-draggable")}))}},{key:"insertTrigger",value:function e(t){babelHelpers.classPrivateFieldGet(this,ct).push(t);this.markModified(true)}},{key:"insertTriggerNode",value:function e(t,i){var a=babelHelpers.classPrivateFieldGet(this,lt).querySelector('[data-role="trigger-list"][data-status-id="'.concat(t,'"]'));if(a){T.Dom.append(i,a)}}},{key:"serialize",value:function e(){return babelHelpers.classPrivateFieldGet(this,ct).map((function(e){return e.serialize()}))}},{key:"countAllTriggers",value:function e(){return babelHelpers.classPrivateFieldGet(this,ct).filter((function(e){return!e.deleted})).length}},{key:"findTriggerById",value:function e(t){return babelHelpers.classPrivateFieldGet(this,ct).find((function(e){return e.getId()===t}))}},{key:"findTriggersByDocumentStatus",value:function e(t){return babelHelpers.classPrivateFieldGet(this,ct).filter((function(e){return e.getStatusId()===t}))}},{key:"getTriggerName",value:function e(t){var i,a;return(i=(a=h.getGlobalContext().availableTriggers.find((function(e){return t===e.CODE})))===null||a===void 0?void 0:a.NAME)!==null&&i!==void 0?i:t}},{key:"getAvailableTrigger",value:function e(t){var i=h.getGlobalContext().availableTriggers;var a=Qe(i),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;if(t===s.CODE){return s}}}catch(e){a.e(e)}finally{a.f()}return null}},{key:"canEdit",value:function e(){return h.getGlobalContext().canEdit}},{key:"canSetExecuteBy",value:function e(){var t;return(t=h.getGlobalContext().get("TRIGGER_CAN_SET_EXECUTE_BY"))!==null&&t!==void 0?t:false}},{key:"needSave",value:function e(){return babelHelpers.classPrivateFieldGet(this,bt)}},{key:"markModified",value:function e(t){babelHelpers.classPrivateFieldSet(this,bt,t!==false);if(babelHelpers.classPrivateFieldGet(this,bt)){this.emit("TriggerManager:dataModified")}}},{key:"openTriggerSettingsDialog",value:function e(t,i){var a=this;if(Ae.getInstance().getTriggerSettingsDialog()){if(i&&i.changeTrigger){Ae.getInstance().getTriggerSettingsDialog().popup.close()}else{return}}var r="bizproc_automation_trigger_dialog";var s=this.getTriggerName(t.getCode());var l=T.Tag.render(Me||(Me=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<form name="','" style="min-width: 540px;">\n\t\t\t\t','\n\t\t\t\t<span class="bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete">\n\t\t\t\t\t',':\n\t\t\t\t</span>\n\t\t\t\t<div class="bizproc-automation-popup-settings">\n\t\t\t\t\t<input\n\t\t\t\t\t\tclass="bizproc-automation-popup-input"\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tname="name"\n\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t'])),r,this.renderConditionSettings(t),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TRIGGER_NAME"),T.Text.encode(t.getName()||s));var n=this.getAvailableTrigger(t.getCode());if(n&&n.SETTINGS){st(this,ht,It).call(this,t,n.SETTINGS.Properties,l)}T.onCustomEvent("BX.Bizproc.Automation.TriggerManager:onOpenSettingsDialog-".concat(t.getCode()),[t,l]);if(this.canSetExecuteBy()){this.renderExecuteByControl(t,l)}this.renderAllowBackwardsControl(t,l);T.Dom.addClass(babelHelpers.classPrivateFieldGet(this,lt),"automation-base-blocked");Ae.getInstance().setTriggerSettingsDialog({triggerManager:this,trigger:t,form:l});var u=new o.Popup({id:Ee.generateUniqueId(),bindElement:null,content:l,closeByEsc:true,buttons:[new c.SaveButton({onclick:function e(){var i=T.ajax.prepareForm(l);t.setName(i.data.name);if(n.SETTINGS){st(a,gt,wt).call(a,t,n.SETTINGS.Properties,l)}T.onCustomEvent("BX.Bizproc.Automation.TriggerManager:onSaveSettings-".concat(t.getCode()),[t,i]);a.setConditionSettingsFromForm(i.data,t);t.setAllowBackwards(i.data.allow_backwards==="Y");if(a.canSetExecuteBy()){t.setExecuteBy(i.data.execute_by)}T.ajax.runAction("bizproc.analytics.push",{analyticsLabel:"automation_trigger".concat(t.draft?"_draft":"","_save_").concat(t.getCode().toLowerCase())});delete t.draft;t.reInit();a.markModified();u.close()}}),new c.CancelButton({onclick:function e(){u.close()}})],width:590,contentPadding:12,closeIcon:true,events:{onPopupClose:function e(){Ae.getInstance().setTriggerSettingsDialog(null);a.destroySettingsDialogControls();u.destroy();T.Dom.removeClass(babelHelpers.classPrivateFieldGet(a,lt),"automation-base-blocked");a.emit("TriggerManager:onCloseTriggerSettingsDialog")}},titleBar:s,overlay:false,draggable:{restrict:false}});Ae.getInstance().getTriggerSettingsDialog().popup=u;u.show();T.ajax.runAction("bizproc.analytics.push",{analyticsLabel:"automation_trigger".concat(t.draft?"_draft":"","_settings_").concat(t.getCode().toLowerCase())})}},{key:"renderConditionSettings",value:function e(t){var i=this;var a=t.getCondition().clone();this.conditionSelector=new h.ConditionGroupSelector(a,{fields:h.getGlobalContext().document.getFields(),showValuesSelector:false,caption:{head:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_ROBOT_CONDITION_TITLE")},isExpanded:babelHelpers.classPrivateFieldGet(this,nt)&&babelHelpers.classPrivateFieldGet(this,nt).get("defaults","isConditionGroupExpanded","N")==="Y"});if(babelHelpers.classPrivateFieldGet(this,nt)){this.conditionSelector.subscribe("onToggleGroupViewClick",(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(i,nt).set("defaults","isConditionGroupExpanded",t.isExpanded?"Y":"N")}))}return this.conditionSelector.createNode()}},{key:"renderExecuteByControl",value:function e(t,i){T.Dom.append(T.Tag.render(Ne||(Ne=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-top bizproc-automation-popup-settings-title-autocomplete">\n\t\t\t\t\t',":\n\t\t\t\t</span>\n\t\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TRIGGER_EXECUTE_BY")),i);var a=[].concat(babelHelpers.toConsumableArray(h.getGlobalContext().document.getRawType()),[h.getGlobalContext().document.getCategoryId()]);var r={Type:"user"};var s=t.draft?Ee.getResponsibleUserExpression(h.getGlobalContext().document.getFields()):t.getExecuteBy();T.Dom.append(T.Tag.render(De||(De=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="bizproc-automation-popup-settings">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),BX.Bizproc.FieldType.renderControl(a,r,"execute_by",s)),i)}},{key:"renderAllowBackwardsControl",value:function e(t,i){T.Dom.append(T.Tag.render(Le||(Le=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="bizproc-automation-popup-checkbox">\n\t\t\t\t\t<div class="bizproc-automation-popup-checkbox-item">\n\t\t\t\t\t\t<label class="bizproc-automation-popup-chk-label">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclass="bizproc-automation-popup-chk"\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\tname="allow_backwards"\n\t\t\t\t\t\t\t\tvalue="Y"\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t","\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t"])),t.isBackwardsAllowed()?"checked":"",T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TRIGGER_ALLOW_REVERSE_1")),i)}},{key:"setConditionSettingsFromForm",value:function e(t,i){i.setCondition(h.ConditionGroup.createFromForm(t));return this}},{key:"onRestAppInstall",value:function e(t,i){i.redirect=false;setTimeout((function(){T.ajax({method:"POST",dataType:"json",url:h.getGlobalContext().ajaxUrl,data:{ajax_action:"get_available_triggers",document_signed:h.getGlobalContext().signedDocument},onsuccess:function e(t){if(T.Type.isArray(t.DATA)){h.getGlobalContext().set("availableTriggers",t.DATA)}}})}),1500)}},{key:"initSettingsDialogControls",value:function e(t){if(!T.Type.isArray(this.settingsDialogControls)){this.settingsDialogControls=[]}var i=t.querySelectorAll("[data-role]");var a=Qe(i),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;var l=null;var n=s.getAttribute("data-role");if(n==="user-selector"){l=BX.Bizproc.UserSelector.decorateNode(s)}BX.UI.Hint.init(s);if(l){this.settingsDialogControls.push(l)}}}catch(e){a.e(e)}finally{a.f()}}},{key:"destroySettingsDialogControls",value:function e(){if(this.conditionSelector){this.conditionSelector.destroy();this.conditionSelector=null}if(T.Type.isArray(this.settingsDialogControls)){for(var t=0;t<this.settingsDialogControls.length;++t){if(T.Type.isFunction(this.settingsDialogControls[t].destroy)){this.settingsDialogControls[t].destroy()}}}this.settingsDialogControls=null}},{key:"getListByDocumentStatus",value:function e(t){var i=[];babelHelpers.classPrivateFieldGet(this,ct).forEach((function(e){if(e.getStatusId()===t){i.push(e)}}));return i}},{key:"getReturnProperties",value:function e(t){var i=[];var a={};var r=this.getListByDocumentStatus(t);r.forEach((function(e){var t=e.deleted?[]:e.getReturnProperties();if(t.length>0){t.forEach((function(t){if(!a[t.Id]){i.push({Id:t.Id,ObjectId:"Template",Name:t.Name,ObjectName:e.getName(),Type:t.Type,Expression:"{{~*:".concat(t.Id,"}}"),SystemExpression:"{=Template:".concat(t.Id,"}"),ObjectRealId:e.getId()});a[t.Id]=true}}))}}));return i}},{key:"getReturnProperty",value:function e(t,i){var a=this.getReturnProperties(t);var r=Qe(a),s;try{for(r.s();!(s=r.n()).done;){var l=s.value;if(l.Id===i){return l}}}catch(e){r.e(e)}finally{r.f()}return null}}]);return t}(n.EventEmitter);function It(e,t,i){var a=this;t.forEach((function(t){var r=e.getApplyRules()[t.Id];if(t.Type==="@condition-group-selector"){st(a,Tt,Ft).call(a,t,r,i);return}if(t.Type==="@webhook-code"){st(a,mt,_t).call(a,t,r,i);return}if(t.Type==="@field-selector"){st(a,Pt,Ot).call(a,t,r,i);return}var s=Ke({AllowSelection:false},t);if(s.Type==="@robot-select"){st(a,ft,Et).call(a,s)}T.Dom.append(T.Tag.render(Re||(Re=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-top bizproc-automation-popup-settings-title-autocomplete"\n\t\t\t\t\t>',":</span>\n\t\t\t\t"])),T.Text.encode(t.Name)),i);T.Dom.append(T.Tag.render(xe||(xe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="bizproc-automation-popup-settings">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t"])),BX.Bizproc.FieldType.renderControl([].concat(babelHelpers.toConsumableArray(h.getGlobalContext().document.getRawType()),[h.getGlobalContext().document.getCategoryId()]),s,t.Id,r||"")),i)}))}function Et(e){var t=Ae.getInstance().component;e.Options=[];var i=e.Settings.Filter;var a=function e(t){for(var a in i){if(t.data[a]!==i[a]){return false}}return true};t.templateManager.templates.forEach((function(t){t.robots.forEach((function(t){if(a(t)){e.Options.push({value:t.getId(),name:t.getProperty(e.Settings.OptionNameProperty)})}}))}));delete e.Settings;e.Type="select"}function wt(e,t,i){var a=this;var r={};t.forEach((function(e){if(e.Type==="@condition-group-selector"){r[e.Id]=st(a,yt,St).call(a,e,i);return}var t=BX.ajax.prepareForm(i);r[e.Id]=t.data[e.Id]}));e.setApplyRules(r)}function Ft(e,t,i){var a=new h.ConditionGroupSelector(new h.ConditionGroup(t),{fields:e.Settings.Fields,fieldPrefix:e.Id,showValuesSelector:false,caption:{head:e.Name}});T.Dom.append(a.createNode(),i)}function St(e,t){var i=BX.ajax.prepareForm(t);var a=h.ConditionGroup.createFromForm(i.data,e.Id);return a.serialize()}function _t(e,i,a){var r=this;if(!i){i=T.Text.getRandom(5)}T.Dom.append(T.Tag.render(Be||(Be=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete">\n\t\t\t\t\t',":\n\t\t\t\t</span>\n\t\t\t"])),T.Text.encode(e.Name)),a);T.Dom.append(T.Tag.render(ze||(ze=babelHelpers.taggedTemplateLiteral(['<input type="hidden" value="','" name="code"/>'])),T.Text.encode(i)),a);var s=T.Tag.render(Ue||(Ue=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<textarea class="bizproc-automation-popup-textarea" placeholder="..." readonly="readonly" name="webhook_handler">\n\t\t\t</textarea>\n\t\t'])));T.Event.bind(s,"click",(function(){r.select()}));T.Dom.append(T.Tag.render(We||(We=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-settings">',"</div>"])),s),a);T.Dom.append(T.Tag.render(je||(je=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_WEBHOOK_ID")),a);if(e.Settings.Handler){var l=window.location.protocol+"//"+window.location.host+e.Settings.Handler;l=T.Uri.addParam(l,{code:i});l=l.replace("{{DOCUMENT_TYPE}}",h.getGlobalContext().document.getRawType()[2]);l=l.replace("{{USER_ID}}",T.Loc.getMessage("USER_ID"));if(e.Settings.Password){l=l.replace("{{PASSWORD}}",e.Settings.Password)}s.value=l}if(!e.Settings.Password&&e.Settings.PasswordLoader){var n=T.Loc.getMessage("BIZPROC_AUTOMATION_WEBHOOK_PASSWORD_ALERT").replace("#A1#",'<a class="bizproc-automation-popup-settings-link '+'bizproc-automation-popup-settings-link-light" data-role="token-gen">').replace("#A2#","</a>");var o=new t.Alert({color:t.AlertColor.WARNING,icon:t.AlertIcon.WARNING,text:n});T.Event.bind(o.getTextContainer().querySelector('[data-role="token-gen"]'),"click",(function(){var t=e.Settings.PasswordLoader;T.ajax.runComponentAction(t.component,t.action,{mode:t.mode||undefined,data:{documentType:[].concat(babelHelpers.toConsumableArray(h.getGlobalContext().document.getRawType()),[h.getGlobalContext().document.getCategoryId()])}}).then((function(t){if(t.data.error){window.alert(t.data.error)}else if(t.data.password){e.Settings.Password=t.data.password;s.value=s.value.replace("{{PASSWORD}}",e.Settings.Password);o.handleCloseBtnClick()}}))}));T.Dom.append(o.getContainer(),a)}}function Ot(e,t,i){var a="@field-selector".concat(Math.random());var r="".concat(e.Id,"[]");var s=e.Settings.Fields;var l=function e(t,i){var a=i.querySelector('[data-field="'.concat(t.Id,'"]'));if(a){return}T.Dom.append(T.Tag.render(Ye||(Ye=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="bizproc-automation-popup-checkbox-item" data-field="','">\n\t\t\t\t\t\t<label class="bizproc-automation-popup-chk-label">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclass="bizproc-automation-popup-chk"\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\tname="','"\n\t\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\t\tchecked\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t"])),T.Text.encode(t.Id),T.Text.encode(r),T.Text.encode(t.Id),T.Text.encode(t.Name)),i)};var n=function e(t,i){if(BX.Main.MenuManager.getMenuById(a)){return BX.Main.MenuManager.getMenuById(a).show()}var r=[];s.forEach((function(e){r.push({text:T.Text.encode(e.Name),field:e,onclick:function e(t,a){l(a.field,i);this.popupWindow.close()}})}));o.MenuManager.show(a,t,r,{autoHide:true,offsetLeft:T.Dom.getPosition(this).width/2,angle:{position:"top",offset:0},zIndex:200,className:"bizproc-automation-inline-selector-menu",events:{onPopupClose:function e(t){t.destroy()}}})};T.Dom.append(T.Tag.render(Ve||(Ve=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete">\n\t\t\t\t\t',":\n\t\t\t\t</span>\n\t\t\t"])),T.Text.encode(e.Name)),i);var c=T.Tag.render(Ze||(Ze=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-checkbox"></div>'])));T.Dom.append(c,i);var u=T.Tag.render(Xe||(Xe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="bizproc-automation-popup-settings-link">',"</span>\n\t\t"])),T.Text.encode(e.Settings.ChooseFieldLabel));T.Event.bind(u,"click",(function(){n(this,c)}));T.Dom.append(T.Tag.render(qe||(qe=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="bizproc-automation-popup-settings bizproc-automation-popup-settings-text">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),u),i);if(T.Type.isArray(t)){t.forEach((function(e){var t=s.find((function(t){return t.Id===e}));if(t){l(t,c)}}))}}function Ct(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=kt(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function kt(e,t){if(!e)return;if(typeof e==="string")return At(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return At(e,t)}function At(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Gt(e,t){Nt(e,t);t.add(e)}function Mt(e,t,i){Nt(e,t);t.set(e,i)}function Nt(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Dt(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Lt=new WeakMap;var Rt=new WeakMap;var xt=new WeakMap;var Bt=new WeakMap;var zt=new WeakMap;var Ut=new WeakMap;var Wt=new WeakMap;var jt=new WeakSet;var Yt=new WeakSet;var Vt=function(){function e(t){babelHelpers.classCallCheck(this,e);Gt(this,Yt);Gt(this,jt);Mt(this,Lt,{writable:true,value:e.BASIS_TYPE.CurrentDateTime});Mt(this,Rt,{writable:true,value:e.DELAY_TYPE.After});Mt(this,xt,{writable:true,value:0});Mt(this,Bt,{writable:true,value:"i"});Mt(this,zt,{writable:true,value:false});Mt(this,Ut,{writable:true,value:false});Mt(this,Wt,{writable:true,value:void 0});if(T.Type.isPlainObject(t)){if(t.type){this.setType(t.type)}if(t.value){this.setValue(t.value)}if(t.valueType){this.setValueType(t.valueType)}if(t.basis){this.setBasis(t.basis)}if(t.workTime){this.setWorkTime(t.workTime)}if(t.waitWorkDay){this.setWaitWorkDay(t.waitWorkDay)}if(t.inTime){this.setInTime(t.inTime)}}}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e({type:babelHelpers.classPrivateFieldGet(this,Rt),value:babelHelpers.classPrivateFieldGet(this,xt),valueType:babelHelpers.classPrivateFieldGet(this,Bt),basis:babelHelpers.classPrivateFieldGet(this,Lt),workTime:babelHelpers.classPrivateFieldGet(this,zt),waitWorkDay:babelHelpers.classPrivateFieldGet(this,Ut),inTime:babelHelpers.classPrivateFieldGet(this,Wt)?babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(this,Wt)):null})}},{key:"setType",value:function t(i){if(i!==e.DELAY_TYPE.After&&i!==e.DELAY_TYPE.Before&&i!==e.DELAY_TYPE.In){i=e.DELAY_TYPE.After}babelHelpers.classPrivateFieldSet(this,Rt,i);return this}},{key:"setValue",value:function e(t){t=parseInt(t,10);babelHelpers.classPrivateFieldSet(this,xt,t>=0?t:0);return this}},{key:"setValueType",value:function e(t){if(t!=="i"&&t!=="h"&&t!=="d"){t="i"}babelHelpers.classPrivateFieldSet(this,Bt,t);return this}},{key:"setBasis",value:function e(t){if(T.Type.isString(t)&&t!==""){babelHelpers.classPrivateFieldSet(this,Lt,t)}return this}},{key:"setWorkTime",value:function e(t){babelHelpers.classPrivateFieldSet(this,zt,Boolean(t));return this}},{key:"setWaitWorkDay",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ut,Boolean(t));return this}},{key:"setInTime",value:function e(t){babelHelpers.classPrivateFieldSet(this,Wt,t);if(t&&!T.Type.isNumber(t[2])){babelHelpers.classPrivateFieldGet(this,Wt)[2]=Dt(this,jt,Zt).call(this)}return this}},{key:"isNow",value:function t(){return babelHelpers.classPrivateFieldGet(this,Rt)===e.DELAY_TYPE.After&&babelHelpers.classPrivateFieldGet(this,Lt)===e.BASIS_TYPE.CurrentDateTime&&!babelHelpers.classPrivateFieldGet(this,xt)&&!this.workTime&&!this.inTime}},{key:"setNow",value:function t(){this.setType(e.DELAY_TYPE.After);this.setValue(0);this.setValueType("i");this.setBasis(e.BASIS_TYPE.CurrentDateTime);this.setInTime(null)}},{key:"serialize",value:function e(){return{type:babelHelpers.classPrivateFieldGet(this,Rt),value:babelHelpers.classPrivateFieldGet(this,xt),valueType:babelHelpers.classPrivateFieldGet(this,Bt),basis:babelHelpers.classPrivateFieldGet(this,Lt),workTime:babelHelpers.classPrivateFieldGet(this,zt)?1:0,waitWorkDay:babelHelpers.classPrivateFieldGet(this,Ut)?1:0,inTime:babelHelpers.classPrivateFieldGet(this,Wt)?babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(this,Wt)):null}}},{key:"toExpression",value:function t(i,a){var r;var s=(r=babelHelpers.classPrivateFieldGet(this,Lt))!==null&&r!==void 0?r:e.BASIS_TYPE.CurrentDate;if(!e.isSystemBasis(s)&&T.Type.isArray(i)){for(var l=0,n=i.length;l<n;++l){if(s===i[l].SystemExpression){s=i[l].Expression;break}}}if(this.isNow()||babelHelpers.classPrivateFieldGet(this,Rt)===e.DELAY_TYPE.In&&!babelHelpers.classPrivateFieldGet(this,zt)&&!babelHelpers.classPrivateFieldGet(this,Wt)){return s}var o=0;var c=0;var u=0;switch(babelHelpers.classPrivateFieldGet(this,Bt)){case"i":u=babelHelpers.classPrivateFieldGet(this,xt);break;case"h":c=babelHelpers.classPrivateFieldGet(this,xt);break;case"d":o=babelHelpers.classPrivateFieldGet(this,xt);break}var p="";if(o>0){p+="".concat(o,"d")}if(c>0){p+="".concat(c,"h")}if(u>0){p+="".concat(u,"i")}if(p!==""&&babelHelpers.classPrivateFieldGet(this,Rt)===e.DELAY_TYPE.Before){p="-".concat(p)}var d=babelHelpers.classPrivateFieldGet(this,zt)?"workdateadd":"dateadd";if(d==="workdateadd"&&p===""){p="0d"}var b="";if(d==="workdateadd"&&a){b=a}var v=s;var h=false;if(p!==""){v="".concat(d,"(").concat(s,',"').concat(p,'"').concat(b?","+b:"",")");h=true}if(babelHelpers.classPrivateFieldGet(this,Wt)){v="settime(".concat(v,", ").concat(babelHelpers.classPrivateFieldGet(this,Wt)[0]||0,", ").concat(babelHelpers.classPrivateFieldGet(this,Wt)[1]||0,", ").concat(babelHelpers.classPrivateFieldGet(this,Wt)[2]||0,")");h=true}return h?"=".concat(v):v}},{key:"format",value:function t(i,a){var r=i;if(babelHelpers.classPrivateFieldGet(this,Rt)===e.DELAY_TYPE.In){r=T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_IN_TIME_2");if(T.Type.isArray(a)){var s=Ct(a),l;try{for(s.s();!(l=s.n()).done;){var n=l.value;if(babelHelpers.classPrivateFieldGet(this,Lt)===n.SystemExpression){r+=" ".concat(n.Name);break}}}catch(e){s.e(e)}finally{s.f()}}if(this.inTime){r+=" ".concat(this.inTimeString)}}else if(babelHelpers.classPrivateFieldGet(this,xt)){var o=babelHelpers.classPrivateFieldGet(this,Rt)===e.DELAY_TYPE.After?T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_THROUGH_3"):T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_FOR_TIME_3");r="".concat(o," ").concat(this.getFormattedPeriodLabel(babelHelpers.classPrivateFieldGet(this,xt),babelHelpers.classPrivateFieldGet(this,Bt)));if(T.Type.isArray(a)){var c=babelHelpers.classPrivateFieldGet(this,Rt)===e.DELAY_TYPE.After?T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER"):T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BEFORE_1");var u=Ct(a),p;try{for(u.s();!(p=u.n()).done;){var d=p.value;if(babelHelpers.classPrivateFieldGet(this,Lt)===d.SystemExpression){r+=" ".concat(c," ").concat(d.Name);break}}}catch(e){u.e(e)}finally{u.f()}}}if(babelHelpers.classPrivateFieldGet(this,zt)){r+=", ".concat(T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_IN_WORKTIME"))}return r}},{key:"getFormattedPeriodLabel",value:function t(i,a){var r="".concat(i," ");var s=0;if(i>20){i%=10}if(i===1){s=0}else if(i>1&&i<5){s=1}else{s=2}var l=e.getPeriodLabels(a);return r+(l?l[s]:"")}},{key:"basis",get:function e(){return babelHelpers.classPrivateFieldGet(this,Lt)}},{key:"type",get:function e(){return babelHelpers.classPrivateFieldGet(this,Rt)}},{key:"value",get:function e(){return babelHelpers.classPrivateFieldGet(this,xt)}},{key:"valueType",get:function e(){return babelHelpers.classPrivateFieldGet(this,Bt)}},{key:"workTime",get:function e(){return babelHelpers.classPrivateFieldGet(this,zt)}},{key:"waitWorkDay",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ut)}},{key:"inTime",get:function e(){if(!babelHelpers.classPrivateFieldGet(this,Wt)){return null}return Dt(this,Yt,Xt).call(this,babelHelpers.classPrivateFieldGet(this,Wt))}},{key:"inTimeString",get:function e(){if(!babelHelpers.classPrivateFieldGet(this,Wt)){return""}var t=Dt(this,Yt,Xt).call(this,babelHelpers.classPrivateFieldGet(this,Wt));var i=String(t[0]).padStart(2,"0");var a=String(t[1]).padStart(2,"0");return"".concat(i,":").concat(a)}}],[{key:"isSystemBasis",value:function e(t){return t===this.BASIS_TYPE.CurrentDate||t===this.BASIS_TYPE.CurrentDateTime||t===this.BASIS_TYPE.CurrentDateTimeLocal}},{key:"fromString",value:function t(i,a){if(!i){return new e}i=i.toString().trimStart().replace(/^=/,"");var r={basis:e.BASIS_TYPE.CurrentDateTime,workTime:false,inTime:null};var s={i:0,h:0,d:0};if(i.indexOf("settime(")===0){var l;i=i.substring(8,i.length-1);var n=i.split(")");var o=((l=n.pop())===null||l===void 0?void 0:l.split(","))||[];var c=o.length>3?parseInt(o.pop().trim(),10):0;var u=parseInt(o.pop().trim(),10);var p=parseInt(o.pop().trim(),10);i=n.join(")")+o.join(",");r.inTime=[p||0,u||0];if(c>0){r.inTime.push(c)}}if(i.indexOf("dateadd(")===0||i.indexOf("workdateadd(")===0){if(i.indexOf("workdateadd(")===0){i=i.substring(12,i.length-1);r.workTime=true}else{i=i.substring(8,i.length-1)}var d=i.split(",");r.basis=d[0].trim();d[1]=(d[1]||"").replace(/['")]+/g,"");r.type=d[1].indexOf("-")===0?e.DELAY_TYPE.Before:e.DELAY_TYPE.After;var b;var v=/s*([\d]+)\s*(i|h|d)\s*/gi;while(b=v.exec(d[1])){s[b[2]]=parseInt(b[1],10)}}else{r.basis=i;if(r.basis===e.BASIS_TYPE.CurrentDateTime){r.type=e.DELAY_TYPE.After}else{r.type=e.DELAY_TYPE.In}}if(!e.isSystemBasis(r.basis)&&BX.type.isArray(a)){var h=false;for(var f=0,g=a.length;f<g;++f){if(r.basis===a[f].SystemExpression||r.basis===a[f].Expression){r.basis=a[f].SystemExpression;h=true;break}}if(!h){r.basis=e.BASIS_TYPE.CurrentDateTime}}var T=s.i+s.h*60+s.d*60*24;if(T%1440===0){r.value=T/1440;r.valueType="d"}else if(T%60===0){r.value=T/60;r.valueType="h"}else{r.value=T;r.valueType="i"}if(!r.value&&(r.basis!==e.BASIS_TYPE.CurrentDateTime||r.inTime)&&r.basis){r.type=e.DELAY_TYPE.In}return new e(r)}},{key:"fromMinutes",value:function e(t){var i;var a;if(t%1440===0){i=t/1440;a="d"}else if(t%60===0){i=t/60;a="h"}else{i=t;a="i"}return[i,a]}},{key:"toMinutes",value:function e(t,i){var a=0;switch(i){case"i":a=t;break;case"h":a=t*60;break;case"d":a=t*60*24;break;default:a=0}return a}},{key:"getPeriodLabels",value:function e(t){var i=[];switch(t){case"i":{i=[T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MIN1"),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MIN2"),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MIN3")];break}case"h":{i=[T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_HOUR1"),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_HOUR2"),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_HOUR3")];break}case"d":{i=[T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DAY1"),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DAY2"),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DAY3")];break}default:i=[]}return i}}]);return e}();function Zt(){var e=Number(T.Loc.getMessage("USER_TZ_OFFSET"));if(T.Type.isNumber(e)){return e}return 0}function Xt(e){var t=Dt(this,jt,Zt).call(this);if(!T.Type.isNumber(e[2])||e[2]===t){return babelHelpers.toConsumableArray(e)}var i=Math.floor((e[2]-t)/60);var a=e[0]*60+e[1]-i;if(a<0){a+=24*60}var r=Math.floor(a/60);var s=a%60;return[r,s,t]}babelHelpers.defineProperty(Vt,"BASIS_TYPE",{CurrentDate:"{=System:Date}",CurrentDateTime:"{=System:Now}",CurrentDateTimeLocal:"{=System:NowLocal}"});babelHelpers.defineProperty(Vt,"DELAY_TYPE",{After:"after",Before:"before",In:"in"});var qt=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"bindAll",value:function t(i){i.querySelectorAll("[data-text]").forEach((function(t){return e.bindToNode(t)}))}},{key:"bindToNode",value:function e(t){T.Event.bind(t,"mouseover",this.showHint.bind(this,t));T.Event.bind(t,"mouseout",this.hideHint.bind(this))}},{key:"isBindedToNode",value:function e(t){var i,a;return!!((i=this.popupHint)!==null&&i!==void 0&&(a=i.bindElement)!==null&&a!==void 0&&a.isSameNode(t))}},{key:"showHint",value:function e(t){var i=t.getAttribute("data-text");if(!i){return}var a=T.Text.encode(i);a=BX.util.nl2br(a);if(!T.Type.isStringFilled(a)){return}this.hideHint();this.popupHint=new BX.PopupWindow("bizproc-automation-help-tip",t,{lightShadow:true,autoHide:false,darkMode:true,offsetLeft:0,offsetTop:2,bindOptions:{position:"top"},events:{onPopupClose:function e(){this.destroy()}},content:T.Dom.create("div",{attrs:{style:"padding-right: 5px; width: 250px;"},html:a})});this.popupHint.setAngle({offset:32,position:"bottom"});this.popupHint.show();return true}},{key:"showNoPermissionsHint",value:function e(t){this.showAngleHint(t,T.Loc.getMessage("BIZPROC_AUTOMATION_RIGHTS_ERROR_1"))}},{key:"showAngleHint",value:function e(t,i){if(this.timeout){clearTimeout(this.timeout)}this.popupHint=BX.UI.Hint.createInstance({popupParameters:{width:334,height:104,closeByEsc:true,autoHide:true,angle:{offset:T.Dom.getPosition(t).width/2},bindOptions:{position:"top"}}});this.popupHint.close=function(){this.hide()};this.popupHint.show(t,i);this.timeout=setTimeout(this.hideHint.bind(this),5e3)}},{key:"hideHint",value:function e(){if(this.popupHint){this.popupHint.close()}this.popupHint=null}}]);return e}();var Jt=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(Jt,"CREATED",0);babelHelpers.defineProperty(Jt,"RUNNING",1);babelHelpers.defineProperty(Jt,"COMPLETED",2);babelHelpers.defineProperty(Jt,"SUSPENDED",3);babelHelpers.defineProperty(Jt,"TERMINATED",4);function Kt(e,t,i){Qt(e,t);t.set(e,i)}function Qt(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var $t=new WeakMap;var ei=new WeakMap;var ti=function(){function e(){babelHelpers.classCallCheck(this,e);Kt(this,$t,{writable:true,value:void 0});Kt(this,ei,{writable:true,value:void 0})}babelHelpers.createClass(e,[{key:"isTriggerEntry",value:function t(){return this.type===e.TRIGGER_ACTIVITY_TYPE}},{key:"type",get:function e(){return babelHelpers.classPrivateFieldGet(this,$t)},set:function t(i){if(e.getAllActivityTypes().includes(i)){babelHelpers.classPrivateFieldSet(this,$t,i)}}},{key:"workflowStatus",get:function e(){return babelHelpers.classPrivateFieldGet(this,ei)},set:function t(i){if(e.getAllWorkflowStatuses().includes(i)){babelHelpers.classPrivateFieldSet(this,ei,i)}}}],[{key:"getAllActivityTypes",value:function t(){return[e.UNKNOWN_ACTIVITY_TYPE,e.EXECUTE_ACTIVITY_TYPE,e.CLOSE_ACTIVITY_TYPE,e.CANCEL_ACTIVITY_TYPE,e.FAULT_ACTIVITY_TYPE,e.CUSTOM_ACTIVITY_TYPE,e.REPORT_ACTIVITY_TYPE,e.ATTACHED_ENTITY_TYPE,e.TRIGGER_ACTIVITY_TYPE,e.ERROR_ACTIVITY_TYPE,e.DEBUG_ACTIVITY_TYPE,e.DEBUG_AUTOMATION_TYPE,e.DEBUG_DESIGNER_TYPE,e.DEBUG_LINK_TYPE]}},{key:"isKnownActivityType",value:function t(i){return e.getAllActivityTypes().includes(i)}},{key:"getAllWorkflowStatuses",value:function e(){return[Jt.CREATED,Jt.RUNNING,Jt.COMPLETED,Jt.SUSPENDED,Jt.TERMINATED]}},{key:"isKnownWorkflowStatus",value:function t(i){return e.getAllWorkflowStatuses().includes(i)}}]);return e}();babelHelpers.defineProperty(ti,"UNKNOWN_ACTIVITY_TYPE",0);babelHelpers.defineProperty(ti,"EXECUTE_ACTIVITY_TYPE",1);babelHelpers.defineProperty(ti,"CLOSE_ACTIVITY_TYPE",2);babelHelpers.defineProperty(ti,"CANCEL_ACTIVITY_TYPE",3);babelHelpers.defineProperty(ti,"FAULT_ACTIVITY_TYPE",4);babelHelpers.defineProperty(ti,"CUSTOM_ACTIVITY_TYPE",5);babelHelpers.defineProperty(ti,"REPORT_ACTIVITY_TYPE",6);babelHelpers.defineProperty(ti,"ATTACHED_ENTITY_TYPE",7);babelHelpers.defineProperty(ti,"TRIGGER_ACTIVITY_TYPE",8);babelHelpers.defineProperty(ti,"ERROR_ACTIVITY_TYPE",9);babelHelpers.defineProperty(ti,"DEBUG_ACTIVITY_TYPE",10);babelHelpers.defineProperty(ti,"DEBUG_AUTOMATION_TYPE",11);babelHelpers.defineProperty(ti,"DEBUG_DESIGNER_TYPE",12);babelHelpers.defineProperty(ti,"DEBUG_LINK_TYPE",13);var ii=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(ii,"WAITING",0);babelHelpers.defineProperty(ii,"RUNNING",1);babelHelpers.defineProperty(ii,"COMPLETED",2);babelHelpers.defineProperty(ii,"AUTOCOMPLETED",3);function ai(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=ri(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function ri(e,t){if(!e)return;if(typeof e==="string")return si(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return si(e,t)}function si(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function li(e,t,i){ni(e,t);t.set(e,i)}function ni(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var oi=new WeakMap;var ci=function(){function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","");babelHelpers.defineProperty(this,"status",ii.WAITING);babelHelpers.defineProperty(this,"modified",undefined);babelHelpers.defineProperty(this,"notes",[]);babelHelpers.defineProperty(this,"errors",[]);li(this,oi,{writable:true,value:-1});babelHelpers.defineProperty(this,"workflowStatus",Jt.CREATED);if(T.Type.isArray(t)){var i=ai(t),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;this.addEntry(r)}}catch(e){i.e(e)}finally{i.f()}}}babelHelpers.createClass(e,[{key:"addEntry",value:function e(t){this.id=t.name;if(babelHelpers.classPrivateFieldGet(this,oi)<t.id){babelHelpers.classPrivateFieldSet(this,oi,t.id);this.modified=t.datetime;this.workflowStatus=t.workflowStatus;if(t.type===h.TrackingEntry.CLOSE_ACTIVITY_TYPE){this.status=ii.COMPLETED}else{this.status=ii.RUNNING}}if(t.type===h.TrackingEntry.ERROR_ACTIVITY_TYPE){this.errors.push(t.note)}else if(t.type===h.TrackingEntry.CUSTOM_ACTIVITY_TYPE){this.notes.push(t.note)}}}]);return e}();var ui=function e(t){babelHelpers.classCallCheck(this,e);babelHelpers.defineProperty(this,"id","");babelHelpers.defineProperty(this,"status",ii.COMPLETED);babelHelpers.defineProperty(this,"modified",undefined);if(t.isTriggerEntry()){this.id=t.note;this.modified=t.datetime}};function pi(e,t,i){di(e,t);t.set(e,i)}function di(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var bi=new WeakMap;var vi=new WeakMap;var hi=function(){function e(){babelHelpers.classCallCheck(this,e);pi(this,bi,{writable:true,value:{id:ti.UNKNOWN_ACTIVITY_TYPE,workflowId:"",type:ti.EXECUTE_ACTIVITY_TYPE,name:"",title:"",datetime:"",note:"",workflowStatus:Jt.CREATED}});pi(this,vi,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,vi,babelHelpers.classPrivateFieldGet(this,bi))}babelHelpers.createClass(e,[{key:"setLogEntry",value:function e(t){babelHelpers.classPrivateFieldSet(this,vi,Object.assign({},babelHelpers.classPrivateFieldGet(this,bi)));t=Object.assign({},t);if(T.Type.isStringFilled(t["ID"])){t["ID"]=parseInt(t["ID"])}if(T.Type.isStringFilled(t["TYPE"])){t["TYPE"]=parseInt(t["TYPE"])}if(T.Type.isNumber(t["ID"])){babelHelpers.classPrivateFieldGet(this,vi).id=t["ID"]}if(T.Type.isStringFilled(t["WORKFLOW_ID"])){babelHelpers.classPrivateFieldGet(this,vi).workflowId=t["WORKFLOW_ID"]}if(T.Type.isNumber(t["TYPE"])&&ti.isKnownActivityType(t["TYPE"])){babelHelpers.classPrivateFieldGet(this,vi).type=t["TYPE"]}if(T.Type.isStringFilled(t["MODIFIED"])){babelHelpers.classPrivateFieldGet(this,vi).datetime=t["MODIFIED"]}if(T.Type.isNumber(t["WORKFLOW_STATUS"])&&ti.isKnownWorkflowStatus(t["WORKFLOW_STATUS"])){babelHelpers.classPrivateFieldGet(this,vi).workflowStatus=t["WORKFLOW_STATUS"]}babelHelpers.classPrivateFieldGet(this,vi).name=String(t["ACTION_NAME"]);babelHelpers.classPrivateFieldGet(this,vi).title=String(t["ACTION_TITLE"]);babelHelpers.classPrivateFieldGet(this,vi).note=String(t["ACTION_NOTE"]);return this}},{key:"setStatus",value:function e(t){babelHelpers.classPrivateFieldGet(this,vi).status=t;return this}},{key:"build",value:function e(){var t=new ti;t.id=babelHelpers.classPrivateFieldGet(this,vi).id;t.workflowId=babelHelpers.classPrivateFieldGet(this,vi).workflowId;t.type=babelHelpers.classPrivateFieldGet(this,vi).type;t.name=babelHelpers.classPrivateFieldGet(this,vi).name;t.title=babelHelpers.classPrivateFieldGet(this,vi).title;t.note=babelHelpers.classPrivateFieldGet(this,vi).note;t.datetime=babelHelpers.classPrivateFieldGet(this,vi).datetime;t.workflowStatus=babelHelpers.classPrivateFieldGet(this,vi).workflowStatus;return t}}]);return e}();function fi(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=gi(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function gi(e,t){if(!e)return;if(typeof e==="string")return Ti(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ti(e,t)}function Ti(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function yi(e,t,i){mi(e,t);t.set(e,i)}function mi(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Pi=new WeakMap;var Hi=new WeakMap;var Ii=new WeakMap;var Ei=new WeakMap;var wi=function(){function e(t,i){babelHelpers.classCallCheck(this,e);yi(this,Pi,{writable:true,value:void 0});yi(this,Hi,{writable:true,value:void 0});yi(this,Ii,{writable:true,value:void 0});yi(this,Ei,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Pi,i);babelHelpers.classPrivateFieldSet(this,Hi,t)}babelHelpers.createClass(e,[{key:"init",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ii,{});babelHelpers.classPrivateFieldSet(this,Ei,{});this.addLogs(t)}},{key:"reInit",value:function e(t){this.init(t)}},{key:"addLogs",value:function e(t){if(!T.Type.isPlainObject(t)){t={}}var i=new hi;for(var a=0,r=Object.entries(t);a<r.length;a++){var s=babelHelpers.slicedToArray(r[a],2),l=s[0],n=s[1];if(!T.Type.isArray(n)){continue}var o=fi(n),c;try{for(o.s();!(c=o.n()).done;){var u=c.value;var p=i.setLogEntry(u).build();if(p.isTriggerEntry()){this.addTriggerEntry(p)}else{this.addRobotEntry(p);var d=babelHelpers.classPrivateFieldGet(this,Ei)[p.name];if(!T.Type.isNil(babelHelpers.classPrivateFieldGet(this,Hi))){var b=d.status===ii.RUNNING;var v=d.workflowStatus===Jt.COMPLETED;var h=babelHelpers.classPrivateFieldGet(this,Hi).getCurrentStatusId()===l;var f=b&&!h;var g=b&&v&&h;if(f||g){d.status=ii.COMPLETED}}}}}catch(e){o.e(e)}finally{o.f()}}}},{key:"addTriggerEntry",value:function e(t){if(t.isTriggerEntry()){babelHelpers.classPrivateFieldGet(this,Ii)[t.note]=new ui(t)}}},{key:"addRobotEntry",value:function e(t){if(t.isTriggerEntry()){return}if(!babelHelpers.classPrivateFieldGet(this,Ei)[t.name]){babelHelpers.classPrivateFieldGet(this,Ei)[t.name]=new ci([t])}else{babelHelpers.classPrivateFieldGet(this,Ei)[t.name].addEntry(t)}}},{key:"getRobotLog",value:function e(t){return babelHelpers.classPrivateFieldGet(this,Ei)[t]||null}},{key:"getTriggerLog",value:function e(t){return babelHelpers.classPrivateFieldGet(this,Ii)[t]||null}},{key:"update",value:function e(t){var i=this;return BX.ajax({method:"POST",dataType:"json",url:babelHelpers.classPrivateFieldGet(this,Pi),data:{ajax_action:"get_log",document_signed:t},onsuccess:function e(t){if(t.DATA&&t.DATA.LOG){i.reInit(t.DATA.LOG)}}})}}]);return e}();var Fi,Si,_i,Oi,Ci,ki,Ai,Gi,Mi,Ni;function Di(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Li(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function Li(e,t){if(!e)return;if(typeof e==="string")return Ri(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ri(e,t)}function Ri(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function xi(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Bi(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?xi(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xi(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function zi(e,t){Wi(e,t);t.add(e)}function Ui(e,t,i){Wi(e,t);t.set(e,i)}function Wi(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function ji(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Yi=new WeakMap;var Vi=new WeakMap;var Zi=new WeakMap;var Xi=new WeakMap;var qi=new WeakMap;var Ji=new WeakMap;var Ki=new WeakMap;var Qi=new WeakMap;var $i=new WeakMap;var ea=new WeakMap;var ta=new WeakMap;var ia=new WeakSet;var aa=new WeakSet;var ra=new WeakSet;var sa=new WeakSet;var la=new WeakSet;var na=new WeakSet;var oa=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));zi(babelHelpers.assertThisInitialized(i),na);zi(babelHelpers.assertThisInitialized(i),la);zi(babelHelpers.assertThisInitialized(i),sa);zi(babelHelpers.assertThisInitialized(i),ra);zi(babelHelpers.assertThisInitialized(i),aa);zi(babelHelpers.assertThisInitialized(i),ia);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"SYSTEM_EXPRESSION_PATTERN","\\{=\\s*(?<object>[a-z0-9_]+)\\s*\\:\\s*(?<field>[a-z0-9_\\.]+)(\\s*>\\s*(?<mod1>[a-z0-9_\\:]+)(\\s*,\\s*(?<mod2>[a-z0-9_]+))?)?\\s*\\}");Ui(babelHelpers.assertThisInitialized(i),Yi,{writable:true,value:void 0});Ui(babelHelpers.assertThisInitialized(i),Vi,{writable:true,value:void 0});Ui(babelHelpers.assertThisInitialized(i),Zi,{writable:true,value:void 0});Ui(babelHelpers.assertThisInitialized(i),Xi,{writable:true,value:void 0});Ui(babelHelpers.assertThisInitialized(i),qi,{writable:true,value:void 0});Ui(babelHelpers.assertThisInitialized(i),Ji,{writable:true,value:void 0});Ui(babelHelpers.assertThisInitialized(i),Ki,{writable:true,value:void 0});Ui(babelHelpers.assertThisInitialized(i),Qi,{writable:true,value:void 0});Ui(babelHelpers.assertThisInitialized(i),$i,{writable:true,value:void 0});Ui(babelHelpers.assertThisInitialized(i),ea,{writable:true,value:void 0});Ui(babelHelpers.assertThisInitialized(i),ta,{writable:true,value:function e(){}});i.setEventNamespace("BX.Bizproc.Automation");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Vi,e.document);if(!T.Type.isNil(e.template)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Zi,e.template)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),$i,e.isFrameMode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),ea,K.none());babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Xi,e.tracker);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),Qi,false);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),qi,new Vt);return i}babelHelpers.createClass(t,[{key:"hasTemplate",value:function e(){return!T.Type.isNil(babelHelpers.classPrivateFieldGet(this,Zi))}},{key:"getTemplate",value:function e(){return babelHelpers.classPrivateFieldGet(this,Zi)}},{key:"getDocument",value:function e(){return babelHelpers.classPrivateFieldGet(this,Vi)}},{key:"clone",value:function e(){var i=new t({document:babelHelpers.classPrivateFieldGet(this,Vi),template:babelHelpers.classPrivateFieldGet(this,Zi),isFrameMode:babelHelpers.classPrivateFieldGet(this,$i),tracker:babelHelpers.classPrivateFieldGet(this,Xi)});var a=Bi(Bi({},T.Runtime.clone(babelHelpers.classPrivateFieldGet(this,Yi))),{},{Name:t.generateName(),Delay:this.getDelayInterval().serialize(),Condition:this.getCondition().serialize()});i.init(a,babelHelpers.classPrivateFieldGet(this,ea));return i}},{key:"isEqual",value:function e(t){return babelHelpers.classPrivateFieldGet(this,Yi).Name===babelHelpers.classPrivateFieldGet(t,Yi).Name}},{key:"init",value:function e(i,a){if(T.Type.isPlainObject(i)){babelHelpers.classPrivateFieldSet(this,Yi,Bi({},i))}if(!babelHelpers.classPrivateFieldGet(this,Yi).Name){babelHelpers.classPrivateFieldGet(this,Yi).Name=t.generateName()}babelHelpers.classPrivateFieldGet(this,Yi).Activated=T.Type.isNil(babelHelpers.classPrivateFieldGet(this,Yi).Activated)?true:T.Text.toBoolean(babelHelpers.classPrivateFieldGet(this,Yi).Activated);babelHelpers.classPrivateFieldSet(this,qi,new Vt(babelHelpers.classPrivateFieldGet(this,Yi).Delay));babelHelpers.classPrivateFieldSet(this,Ki,new h.ConditionGroup(babelHelpers.classPrivateFieldGet(this,Yi).Condition));if(!babelHelpers.classPrivateFieldGet(this,Yi).Condition){babelHelpers.classPrivateFieldGet(this,Ki).type=h.ConditionGroup.CONDITION_TYPE.Mixed}delete babelHelpers.classPrivateFieldGet(this,Yi).Condition;delete babelHelpers.classPrivateFieldGet(this,Yi).Delay;babelHelpers.classPrivateFieldSet(this,ea,T.Type.isNil(a)?K.edit():a);if(!babelHelpers.classPrivateFieldGet(this,ea).isNone()){babelHelpers.classPrivateFieldSet(this,Ji,this.createNode())}}},{key:"reInit",value:function e(t,i){if(T.Type.isNil(i)&&babelHelpers.classPrivateFieldGet(this,ea).isNone()){return}var a=babelHelpers.classPrivateFieldGet(this,Ji);babelHelpers.classPrivateFieldSet(this,Ji,this.createNode());if(a.parentNode){T.Dom.replace(a,babelHelpers.classPrivateFieldGet(this,Ji))}}},{key:"destroy",value:function e(){T.Dom.remove(babelHelpers.classPrivateFieldGet(this,Ji));this.emit("Robot:destroyed")}},{key:"canEdit",value:function e(){return babelHelpers.classPrivateFieldGet(this,Zi).canEdit()}},{key:"getProperties",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Yi)&&T.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,Yi).Properties)){return babelHelpers.classPrivateFieldGet(this,Yi).Properties}return{}}},{key:"getProperty",value:function e(t){return this.getProperties()[t]||null}},{key:"hasProperty",value:function e(t){return Object.hasOwn(this.getProperties(),t)}},{key:"setProperty",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,Yi).Properties[t]=i;return this}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,Yi).Name||null}},{key:"getLogStatus",value:function e(){var t=ii.WAITING;var i=babelHelpers.classPrivateFieldGet(this,Xi).getRobotLog(this.getId());if(i){t=i.status}else if(babelHelpers.classPrivateFieldGet(this,Yi).DelayName){i=babelHelpers.classPrivateFieldGet(this,Xi).getRobotLog(babelHelpers.classPrivateFieldGet(this,Yi).DelayName);if(i&&i.status===ii.RUNNING){t=ii.RUNNING}}return t}},{key:"getLogErrors",value:function e(){var t=[];var i=babelHelpers.classPrivateFieldGet(this,Xi).getRobotLog(this.getId());if(i&&i.errors){t=i.errors}return t}},{key:"getDelayNotes",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Yi).DelayName){var t=babelHelpers.classPrivateFieldGet(this,Xi).getRobotLog(babelHelpers.classPrivateFieldGet(this,Yi).DelayName);if(t&&t.status===ii.RUNNING){return t.notes}}return[]}},{key:"selectNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ji)){T.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Ji),"--selected");var t=babelHelpers.classPrivateFieldGet(this,Ji).querySelector("input");if(t){t.checked=true}this.emit("Robot:selected")}}},{key:"unselectNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ji)){T.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,Ji),"--selected");var t=babelHelpers.classPrivateFieldGet(this,Ji).querySelector("input");if(t){t.checked=false}this.emit("Robot:unselected")}}},{key:"isSelected",value:function e(){return babelHelpers.classPrivateFieldGet(this,Ji)&&T.Dom.hasClass(babelHelpers.classPrivateFieldGet(this,Ji),"--selected")}},{key:"isActivated",value:function e(){return T.Text.toBoolean(babelHelpers.classPrivateFieldGet(this,Yi).Activated)}},{key:"isInvalid",value:function e(){var t;return((t=babelHelpers.classPrivateFieldGet(this,Yi).viewData)===null||t===void 0?void 0:t.isInvalid)===true}},{key:"setActivated",value:function e(t){babelHelpers.classPrivateFieldGet(this,Yi).Activated=T.Text.toBoolean(t);this.emit(babelHelpers.classPrivateFieldGet(this,Yi).Activated===true?"Robot:onAfterActivated":"Robot:onAfterDeactivated");return this}},{key:"enableManageMode",value:function e(t){var i=this;babelHelpers.classPrivateFieldSet(this,ea,K.manage().setProperty("isActive",t));if(!t){T.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Ji),"--locked-node")}var a=babelHelpers.classPrivateFieldGet(this,Ji).querySelector(".bizproc-automation-robot-btn-delete");T.Dom.hide(a);babelHelpers.classPrivateFieldGet(this,Ji).onclick=function(){if(!babelHelpers.classPrivateFieldGet(i,ea).isManage()||!babelHelpers.classPrivateFieldGet(i,ea).getProperty("isActive",false)){return}if(!i.isSelected()){i.selectNode()}else{i.unselectNode()}}}},{key:"disableManageMode",value:function e(){babelHelpers.classPrivateFieldSet(this,ea,K.edit());this.unselectNode();T.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,Ji),"--locked-node");var t=babelHelpers.classPrivateFieldGet(this,Ji).querySelector(".bizproc-automation-robot-btn-delete");T.Dom.show(t);babelHelpers.classPrivateFieldGet(this,Ji).onclick=undefined}},{key:"createNode",value:function e(){var t=this;var i="bizproc-automation-robot-container-wrapper";var a="bizproc-automation-robot-container";if(babelHelpers.classPrivateFieldGet(this,ea).isEdit()&&this.canEdit()&&ji(this,aa,ua).call(this)){i+=" bizproc-automation-robot-container-wrapper-draggable"}if(this.isActivated()===false){a+=" --deactivated";i+=" --deactivated"}if(this.isInvalid()){a+=" --invalid";i+=" --invalid"}if(this.draft){a+=" --draft"}var r=T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TO");var s=T.Tag.render(Fi||(Fi=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a\n\t\t\t\tclass="bizproc-automation-robot-settings-name ','"\n\t\t\t\ttitle="','"\n\t\t\t>',"</a>\n\t\t"])),babelHelpers.classPrivateFieldGet(this,ea).isView()?"--mode-view":"",T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AUTOMATICALLY"),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AUTOMATICALLY"));if(T.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,Yi).viewData)&&babelHelpers.classPrivateFieldGet(this,Yi).viewData.responsibleLabel){var l=babelHelpers.classPrivateFieldGet(this,Yi).viewData.responsibleLabel.replace("{=Document:ASSIGNED_BY_ID}",T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_RESPONSIBLE")).replace("author",T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_RESPONSIBLE")).replace(/\{=Constant\:Constant[0-9]+\}/,T.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT")).replace(/\{\{~&\:Constant[0-9]+\}\}/,T.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT")).replace(/\{=Template\:Parameter[0-9]+\}/,T.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER")).replace(/\{\{~&:\:Parameter[0-9]+\}\}/,T.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER"));if(l.includes("{=Document")){babelHelpers.classPrivateFieldGet(this,Vi).getFields().forEach((function(e){l=l.replace(e.SystemExpression,e.Name)}))}if(l.includes("{=A")){babelHelpers.classPrivateFieldGet(this,Zi).robots.forEach((function(e){e.getReturnFieldsDescription().forEach((function(t){if(t.Type==="user"){l=l.replace(t.SystemExpression,"".concat(e.getTitle(),": ").concat(t.Name))}}))}))}if(l.includes("{=GlobalVar:")&&T.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,Zi).globalVariables)){babelHelpers.classPrivateFieldGet(this,Zi).globalVariables.forEach((function(e){l=l.replace(e.SystemExpression,e.Name)}))}if(l.includes("{=GlobalConst:")&&T.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,Zi).globalConstants)){babelHelpers.classPrivateFieldGet(this,Zi).globalConstants.forEach((function(e){l=l.replace(e.SystemExpression,e.Name)}))}s.textContent=l;s.setAttribute("title",l);if(babelHelpers.classPrivateFieldGet(this,Yi).viewData.responsibleUrl){s.href=babelHelpers.classPrivateFieldGet(this,Yi).viewData.responsibleUrl;if(babelHelpers.classPrivateFieldGet(this,$i)){s.setAttribute("target","_blank")}}if(babelHelpers.classPrivateFieldGet(this,ea).isEdit()&&parseInt(babelHelpers.classPrivateFieldGet(this,Yi).viewData.responsibleId,10)>0){s.setAttribute("bx-tooltip-user-id",babelHelpers.classPrivateFieldGet(this,Yi).viewData.responsibleId)}}var n=this.getDelayInterval().format(T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AT_ONCE"),babelHelpers.classPrivateFieldGet(this,Vi).getFields());if(this.isExecuteAfterPrevious()){n=n===T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AT_ONCE")?"":"".concat(n,", ");n+=T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER_PREVIOUS")}if(this.getCondition().items.length>0){n+=", ".concat(T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BY_CONDITION"))}var o=T.Dom.create(ji(this,aa,ua).call(this)?"a":"span",{attrs:{className:ji(this,aa,ua).call(this)?"bizproc-automation-robot-link":"bizproc-automation-robot-text",title:n},text:n});var c=T.Tag.render(Si||(Si=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-robot-information"></div>'])));this.subscribeOnce("Robot:destroyed",(function(){if(qt.isBindedToNode(c)){qt.hideHint()}}));switch(this.getLogStatus()){case ii.RUNNING:if(babelHelpers.classPrivateFieldGet(this,Vi).getCurrentStatusId()===babelHelpers.classPrivateFieldGet(this,Zi).getStatusId()){c.classList.add("--loader");var u=this.getDelayNotes();if(u.length){c.setAttribute("data-text",u.join("\n"));qt.bindToNode(c)}}break;case ii.COMPLETED:case ii.AUTOCOMPLETED:a+=" --complete";c.classList.add("--complete");break}var p=this.getLogErrors();if(p.length>0){T.Dom.addClass(c,"--errors");c.setAttribute("data-text",p.join("\n"));qt.bindToNode(c)}var d="bizproc-automation-robot-title-text";if(ji(this,aa,ua).call(this)&&this.canEdit()){d+=" bizproc-automation-robot-title-text-editable"}var b=T.Tag.render(_i||(_i=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div\n\t\t\t\tclass="','"\n\t\t\t\tdata-role="robot-container"\n\t\t\t\tdata-type="item-robot"\n\t\t\t\tdata-id="','"\n\t\t\t>\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t",'\n\t\t\t\t<div class="','">\n\t\t\t\t\t<div class="bizproc-automation-robot-deadline">','</div>\n\t\t\t\t\t<div class="bizproc-automation-robot-title">\n\t\t\t\t\t\t<div ref="titleNode" class="','" title="','">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bizproc-automation-robot-settings">\n\t\t\t\t\t\t<div class="bizproc-automation-robot-settings-title">',":</div>\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),a,T.Text.encode(this.getId()),ji(this,ia,ca).call(this),ji(this,ra,pa).call(this),ji(this,sa,da).call(this),i,o,d,T.Text.encode(this.getTitle()),this.clipTitle(this.getTitle()),r,s,c),v=b.root,h=b.titleNode;T.Event.bind(h,"click",(function(e){if(ji(t,aa,ua).call(t)&&t.canEdit()&&!babelHelpers.classPrivateFieldGet(t,ea).isManage()){t.onTitleEditClick(e)}}));if(this.canEdit()&&ji(this,aa,ua).call(this)){this.registerItem(v)}if(babelHelpers.classPrivateFieldGet(this,ea).isEdit()){var f=T.Tag.render(Oi||(Oi=babelHelpers.taggedTemplateLiteral(['<span class="bizproc-automation-robot-btn-delete"></span>'])));T.Event.bind(f,"click",this.onDeleteButtonClick.bind(this,f));T.Dom.append(f,v.lastChild);if(this.isInvalid()){var g=T.Tag.render(Ci||(Ci=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="bizproc-automation-robot-btn-settings">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_DELETE_BUTTON_TITLE"));T.Event.bind(g,"click",this.onDeleteButtonClick.bind(this,g));T.Dom.append(g,v)}else{var y=T.Tag.render(ki||(ki=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="bizproc-automation-robot-btn-copy">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_ACTIONS_BUTTON_TEXT"));T.Event.bind(y,"click",ji(this,la,ba).bind(this,y));T.Dom.append(y,v);var m=T.Tag.render(Ai||(Ai=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="bizproc-automation-robot-btn-settings">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EDIT"));T.Event.bind(v,"click",this.onSettingsButtonClick.bind(this,v));T.Dom.append(m,v)}}return v}},{key:"onDeleteButtonClick",value:function e(t,i){i.stopPropagation();if(!this.canEdit()){qt.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,ea).isManage()){T.Dom.remove(babelHelpers.classPrivateFieldGet(this,Ji));babelHelpers.classPrivateFieldGet(this,Zi).deleteRobot(this)}}},{key:"onSettingsButtonClick",value:function e(t){if(!this.canEdit()){qt.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,ea).isManage()){var i;babelHelpers.classPrivateFieldGet(this,Zi).openRobotSettingsDialog(this,(i=babelHelpers.classPrivateFieldGet(this,Yi).DialogContext)!==null&&i!==void 0?i:null)}}},{key:"onCopyButtonClick",value:function e(t,i){i.stopPropagation();if(!this.canEdit()){qt.showNoPermissionsHint(t)}else if(!babelHelpers.classPrivateFieldGet(this,ea).isManage()){var a=this.clone();var r=a.getProperty("Title");if(!T.Type.isNil(r)){var s=r+" "+" "+T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_COPY_CAPTION");a.setProperty("Title",s);a.reInit()}dr.copyRobotTo(babelHelpers.classPrivateFieldGet(this,Zi),a,babelHelpers.classPrivateFieldGet(this,Zi).getNextRobot(this))}}},{key:"onTitleEditClick",value:function e(t){t.preventDefault();t.stopPropagation();var i="bizproc_automation_robot_title_dialog";var a=T.Dom.create("form",{props:{name:i},style:{"min-width":"540px"}});a.appendChild(T.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-autocomplete"},text:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ROBOT_NAME")+":"}));a.appendChild(T.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings"},children:[BX.create("input",{attrs:{className:"bizproc-automation-popup-input",type:"text",name:"name",value:this.getTitle()}})]}));this.emit("Robot:title:editStart");var r=this;var s=new BX.PopupWindow(h.Helper.generateUniqueId(),null,{titleBar:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ROBOT_NAME"),content:a,closeIcon:true,offsetLeft:0,offsetTop:0,closeByEsc:true,draggable:{restrict:false},overlay:false,events:{onPopupClose:function e(t){t.destroy();r.emit("Robot:title:editCompleted")}},buttons:[new BX.PopupWindowButton({text:T.Loc.getMessage("JS_CORE_WINDOW_SAVE"),className:"popup-window-button-accept",events:{click:function e(){var t=a.elements.name;r.setProperty("Title",t.value);r.reInit();babelHelpers.classPrivateFieldGet(r,Zi).markModified();this.popupWindow.close()}}}),new BX.PopupWindowButtonLink({text:T.Loc.getMessage("JS_CORE_WINDOW_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function e(){this.popupWindow.close()}}})]});s.show()}},{key:"onSearch",value:function e(t){if(!babelHelpers.classPrivateFieldGet(this,Ji)){return}var i=t.getData().queryString;var a=!i||this.getTitle().toLowerCase().indexOf(i)>=0;if(a){T.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,Ji),"--search-mismatch")}else{T.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Ji),"--search-mismatch")}}},{key:"clipTitle",value:function e(t){var i=T.Text.encode(t);var a=i.split(" ");var r="<span>"+a[a.length-1]+"</span>";a.splice(a.length-1);i=a.join(" ")+" "+r;return i}},{key:"updateData",value:function e(t){if(T.Type.isPlainObject(t)){babelHelpers.classPrivateFieldSet(this,Yi,t);babelHelpers.classPrivateFieldGet(this,Yi).Activated=!T.Type.isNil(babelHelpers.classPrivateFieldGet(this,Yi).Activated)?T.Text.toBoolean(babelHelpers.classPrivateFieldGet(this,Yi).Activated):true}else{throw"Invalid data"}}},{key:"serialize",value:function e(){var t=BX.clone(babelHelpers.classPrivateFieldGet(this,Yi));delete t["viewData"];delete t["DialogContext"];t.Delay=babelHelpers.classPrivateFieldGet(this,qi).serialize();t.Condition=babelHelpers.classPrivateFieldGet(this,Ki).serialize();t.Activated=t.Activated?"Y":"N";return t}},{key:"getDelayInterval",value:function e(){return babelHelpers.classPrivateFieldGet(this,qi)}},{key:"setDelayInterval",value:function e(t){babelHelpers.classPrivateFieldSet(this,qi,t);return this}},{key:"getCondition",value:function e(){return babelHelpers.classPrivateFieldGet(this,Ki)}},{key:"setCondition",value:function e(t){babelHelpers.classPrivateFieldSet(this,Ki,t);return this}},{key:"setExecuteAfterPrevious",value:function e(t){babelHelpers.classPrivateFieldGet(this,Yi).ExecuteAfterPrevious=t?1:0;return this}},{key:"isExecuteAfterPrevious",value:function e(){return babelHelpers.classPrivateFieldGet(this,Yi).ExecuteAfterPrevious===1||babelHelpers.classPrivateFieldGet(this,Yi).ExecuteAfterPrevious==="1"}},{key:"registerItem",value:function e(t){if(T.Type.isNil(t["__bxddid"])){t.onbxdragstart=BX.proxy(this.dragStart,this);t.onbxdrag=BX.proxy(this.dragMove,this);t.onbxdragstop=BX.proxy(this.dragStop,this);t.onbxdraghover=BX.proxy(this.dragOver,this);jsDD.registerObject(t);jsDD.registerDest(t,1)}}},{key:"unregisterItem",value:function e(t){t.onbxdragstart=undefined;t.onbxdrag=undefined;t.onbxdragstop=undefined;t.onbxdraghover=undefined;jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},{key:"dragStart",value:function e(){this.draggableItem=BX.proxy_context;if(!this.draggableItem){jsDD.stopCurrentDrag();return}if(!this.stub){var t=this.draggableItem.offsetWidth;this.stub=this.draggableItem.cloneNode(true);this.stub.style.position="absolute";this.stub.classList.add("bizproc-automation-robot-container-drag");this.stub.style.width=t+"px";document.body.appendChild(this.stub)}}},{key:"dragMove",value:function e(t,i){this.stub.style.left=t+"px";this.stub.style.top=i+"px"}},{key:"dragOver",value:function e(t,i,a){if(this.droppableItem){this.droppableItem.classList.remove("bizproc-automation-robot-container-pre")}if(this.droppableColumn){this.droppableColumn.classList.remove("bizproc-automation-robot-list-pre")}var r=t.getAttribute("data-type");if(r==="item-robot"){this.droppableItem=t;this.droppableColumn=null}if(r==="column-robot"){this.droppableColumn=t.querySelector('[data-role="robot-list"]');this.droppableItem=null}if(this.droppableItem){this.droppableItem.classList.add("bizproc-automation-robot-container-pre")}if(this.droppableColumn){this.droppableColumn.classList.add("bizproc-automation-robot-list-pre")}}},{key:"dragStop",value:function e(t,i,a){a=a||window.event;var r=a&&(a.ctrlKey||a.metaKey);if(this.draggableItem){if(this.droppableItem){this.droppableItem.classList.remove("bizproc-automation-robot-container-pre");this.emit("Robot:manage",{templateNode:this.droppableItem.parentNode,isCopy:r,droppableItem:this.droppableItem,robot:this})}else if(this.droppableColumn){this.droppableColumn.classList.remove("bizproc-automation-robot-list-pre");this.emit("Robot:manage",{templateNode:this.droppableColumn,isCopy:r,robot:this})}}this.stub.parentNode.removeChild(this.stub);this.stub=null;this.draggableItem=null;this.droppableItem=null}},{key:"moveTo",value:function e(t,i){T.Dom.remove(babelHelpers.classPrivateFieldGet(this,Ji));babelHelpers.classPrivateFieldGet(this,Zi).deleteRobot(this);babelHelpers.classPrivateFieldSet(this,Zi,t);babelHelpers.classPrivateFieldGet(this,Zi).insertRobot(this,i);babelHelpers.classPrivateFieldSet(this,Ji,this.createNode());babelHelpers.classPrivateFieldGet(this,Zi).insertRobotNode(babelHelpers.classPrivateFieldGet(this,Ji),i?i.node:null)}},{key:"copyTo",value:function e(i,a){var r=new t({document:babelHelpers.classPrivateFieldGet(this,Vi),template:i,isFrameMode:babelHelpers.classPrivateFieldGet(this,$i),tracker:babelHelpers.classPrivateFieldGet(this,Xi)});var s=this.serialize();delete s["Name"];delete s["DelayName"];r.init(s,babelHelpers.classPrivateFieldGet(this,ea));i.insertRobot(r,a);i.insertRobotNode(r.node,a?a.node:null);return r}},{key:"getTitle",value:function e(){return this.getProperty("Title")||this.getDescriptionTitle()}},{key:"getDescriptionTitle",value:function e(){var t,i;var a="untitled";var r=(t=(i=this.template)===null||i===void 0?void 0:i.getRobotDescription(babelHelpers.classPrivateFieldGet(this,Yi)["Type"]))!==null&&t!==void 0?t:{};if(r["NAME"]){a=r["NAME"]}if(r["ROBOT_SETTINGS"]&&r["ROBOT_SETTINGS"]["TITLE"]){a=r["ROBOT_SETTINGS"]["TITLE"]}return a}},{key:"hasTitle",value:function e(){return this.getTitle()!=="untitled"}},{key:"hasReturnFields",value:function e(){var t=this.template.getRobotDescription(babelHelpers.classPrivateFieldGet(this,Yi)["Type"]);var i=babelHelpers.classPrivateFieldGet(this,Yi)["Properties"];if(!T.Type.isObject(t)){return false}var a=function e(){return T.Type.isObject(t["RETURN"])&&T.Type.isArrayFilled(Object.values(t["RETURN"]))};var r=function e(){return T.Type.isArray(t["ADDITIONAL_RESULT"])&&t["ADDITIONAL_RESULT"].some((function(e){var t;return Object.values((t=i[e])!==null&&t!==void 0?t:[]).length>0}))};return a()||r()}},{key:"getReturnFieldsDescription",value:function e(){var t=this;var i=[];var a=this.template.getRobotDescription(babelHelpers.classPrivateFieldGet(this,Yi)["Type"]);if(a&&a["RETURN"]){for(var r in a["RETURN"]){if(a["RETURN"].hasOwnProperty(r)){var s=a["RETURN"][r];i.push({Id:r,ObjectId:this.getId(),ObjectName:this.getTitle(),Name:s["NAME"],Type:s["TYPE"],Options:s["OPTIONS"]||null,Expression:"{{~"+this.getId()+":"+r+" # "+this.getTitle()+": "+s["NAME"]+"}}",SystemExpression:"{="+this.getId()+":"+r+"}"});if(!this.appendPropertyMods){continue}if(s["TYPE"]==="user"||s["TYPE"]==="bool"||s["TYPE"]==="file"){var l=s["TYPE"]==="user"?"friendly":"printable";i.push({Id:r+"_printable",ObjectId:this.getId(),ObjectName:this.getTitle(),Name:s["NAME"]+" "+T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX"),Type:"string",Expression:"{{~".concat(this.getId(),":").concat(r," > ").concat(l," # ").concat(this.getTitle(),": ").concat(s["NAME"],"}}"),SystemExpression:"{=".concat(this.getId(),":").concat(r,">").concat(l,"}")})}}}}if(a&&T.Type.isArray(a["ADDITIONAL_RESULT"])){var n=babelHelpers.classPrivateFieldGet(this,Yi)["Properties"];a["ADDITIONAL_RESULT"].forEach((function(e){if(n[e]){for(var a in n[e]){if(n[e].hasOwnProperty(a)){var r=n[e][a];i.push({Id:a,ObjectId:t.getId(),ObjectName:t.getTitle(),Name:r["Name"],Type:r["Type"],Options:r["Options"]||null,Expression:"{{~".concat(t.getId(),":").concat(a," # ").concat(t.getTitle(),": ").concat(r["Name"],"}}"),SystemExpression:"{="+t.getId()+":"+a+"}"});if(r["Type"]==="user"||r["Type"]==="bool"||r["Type"]==="file"){var s=r["Type"]==="user"?"friendly":"printable";var l="{{~".concat(t.getId(),":").concat(a," > ").concat(s," # ").concat(t.getTitle(),": ").concat(r["Name"],"}}");i.push({Id:a+"_printable",ObjectId:t.getId(),ObjectName:t.getTitle(),Name:r["Name"]+" "+T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX"),Type:"string",Expression:l,SystemExpression:"{="+t.getId()+":"+a+">"+s+"}"})}}}}}))}return i}},{key:"getReturnProperty",value:function e(t){var i=this.getReturnFieldsDescription();for(var a=0;a<i.length;++a){if(i[a]["Id"]===t){return i[a]}}return null}},{key:"collectUsages",value:function e(){var t=this;var i=this.getProperties();var a={Document:new Set,Constant:new Set,Variable:new Set,Parameter:new Set,GlobalConstant:new Set,GlobalVariable:new Set,Activity:new Set};Object.values(i).forEach((function(e){return t.collectExpressions(e,a)}));var r=this.getCondition().serialize();r.items.forEach((function(e){return t.collectParsedExpressions(e[0],a)}));return a}},{key:"collectExpressions",value:function e(t,i){var a=this;if(T.Type.isArray(t)){t.forEach((function(e){return a.collectExpressions(e,i)}))}else if(T.Type.isPlainObject(t)){Object.values(t).forEach((function(e){return a.collectExpressions(e,i)}))}else if(T.Type.isStringFilled(t)){var r;var s=new RegExp(this.SYSTEM_EXPRESSION_PATTERN,"ig");while((r=s.exec(t))!==null){this.collectParsedExpressions(r.groups,i)}}}},{key:"collectParsedExpressions",value:function e(t,i){if(T.Type.isPlainObject(t)&&t["object"]&&t["field"]){switch(t["object"]){case"Document":i.Document.add(t["field"]);return;case"Constant":i.Constant.add(t["field"]);return;case"Variable":i.Variable.add(t["field"]);return;case"Template":i.Parameter.add(t["field"]);return;case"GlobalConst":i.GlobalConstant.add(t["field"]);return;case"GlobalVar":i.GlobalVariable.add(t["field"]);return}var a=new RegExp(/^A[_0-9]+$/,"ig");if(a.exec(t["object"])){i.Activity.add([t["object"],t["field"]])}}}},{key:"hasBrokenLink",value:function e(){return this.getBrokenLinks().length>0}},{key:"getBrokenLinks",value:function e(){var t=T.Runtime.clone(this.collectUsages());if(!this.template){return[]}var i={Document:babelHelpers.classPrivateFieldGet(this,Vi).getFields(),Constant:babelHelpers.classPrivateFieldGet(this,Zi).getConstants(),Variable:babelHelpers.classPrivateFieldGet(this,Zi).getVariables(),GlobalConstant:babelHelpers.classPrivateFieldGet(this,Zi).globalConstants,GlobalVariable:babelHelpers.classPrivateFieldGet(this,Zi).globalVariables,Parameter:babelHelpers.classPrivateFieldGet(this,Zi).getParameters(),Activity:babelHelpers.classPrivateFieldGet(this,Zi).getSerializedRobots()};var a=[];for(var r in t){if(t[r].size>0){var s=new Set;for(var l in i[r]){if(i[r][l]["Id"]){s.add(i[r][l]["Id"])}else if(i[r][l]["Name"]){s.add(i[r][l]["Name"])}}var n=Di(t[r].values()),o;try{for(n.s();!(o=n.n()).done;){var c=o.value;var u=c;var p=c;if(T.Type.isArray(u)){u=c[0];p=c[1]}if(!s.has(u)){if(r==="Activity"){a.push("{="+u+":"+p+"}")}else{var d=r;if(d==="GlobalVariable"){d="GlobalVar"}if(d==="GlobalConstant"){d="GlobalConst"}if(d==="Parameter"){d="Template"}a.push("{="+d+":"+u+"}")}continue}if(r==="Activity"){var b=babelHelpers.classPrivateFieldGet(this,Zi).getRobotById(u);if(!b.getReturnProperty(p)){a.push("{="+u+":"+p+"}")}}}}catch(e){n.e(e)}finally{n.f()}}}return a}},{key:"onBeforeSaveRobotSettings",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,ta).call(this);return T.Type.isPlainObject(t)?t:{}}},{key:"setOnBeforeSaveRobotSettings",value:function e(t){if(T.Type.isFunction(t)){babelHelpers.classPrivateFieldSet(this,ta,t)}}},{key:"node",get:function e(){return babelHelpers.classPrivateFieldGet(this,Ji)}},{key:"data",get:function e(){return Bi(Bi({},babelHelpers.classPrivateFieldGet(this,Yi)),{},{Condition:babelHelpers.classPrivateFieldGet(this,Ki).serialize(),Delay:babelHelpers.classPrivateFieldGet(this,qi).serialize()})}},{key:"draft",get:function e(){return babelHelpers.classPrivateFieldGet(this,Qi)},set:function e(t){babelHelpers.classPrivateFieldSet(this,Qi,t)}},{key:"template",get:function e(){return babelHelpers.classPrivateFieldGet(this,Zi)}}],[{key:"generateName",value:function e(){return"A".concat(parseInt(Math.random()*1e5,10),"_").concat(parseInt(Math.random()*1e5,10),"_").concat(parseInt(Math.random()*1e5,10),"_").concat(parseInt(Math.random()*1e5,10))}}]);return t}(n.EventEmitter);function ca(){if(this.isInvalid()){return""}return T.Tag.render(Gi||(Gi=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-ctl ui-ctl-inline bizproc-automation-robot-container-checkbox">\n\t\t\t\t<input class="ui-ctl-checkbox" type="checkbox" name="name"/>\n\t\t\t</div>\n\t\t'])))}function ua(){return babelHelpers.classPrivateFieldGet(this,ea).isEdit()&&!this.isInvalid()}function pa(){if(babelHelpers.classPrivateFieldGet(this,Yi).Activated===true){return""}return T.Tag.render(Mi||(Mi=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-robot-deactivated">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_DEACTIVATED_ROBOT_BLOCK_TITLE"))}function da(){if(!this.isInvalid()){return""}return T.Tag.render(Ni||(Ni=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-robot-invalid">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_INVALID_REST_ROBOT_BLOCK_TITLE"))}function ba(e,t){var i=this;if(!this.canEdit()){t.stopPropagation();qt.showNoPermissionsHint(e);return}if(!babelHelpers.classPrivateFieldGet(this,ea).isManage()){t.stopPropagation();var a=babelHelpers.classPrivateFieldGet(this,Yi).Activated?T.Loc.getMessage("BIZPROC_AUTOMATION_ACTIONS_DEACTIVATE_BUTTON_TEXT"):T.Loc.getMessage("BIZPROC_AUTOMATION_ACTIONS_ACTIVATE_BUTTON_TEXT");var r=new o.Menu({bindElement:e,width:150,height:90,autoHide:true,angle:{offset:T.Dom.getPosition(e).width/2+23},items:[{text:T.Loc.getMessage("BIZPROC_AUTOMATION_ACTIONS_COPY_BUTTON_TEXT"),title:T.Loc.getMessage("BIZPROC_AUTOMATION_ACTIONS_COPY_BUTTON_TEXT"),onclick:function e(t,a){i.onCopyButtonClick(a,t);r.destroy()}},{text:a,title:a,onclick:function e(){ji(i,na,va).call(i);r.destroy()}}]});r.show()}}function va(){this.setActivated(!this.isActivated());this.reInit()}function ha(e,t,i){fa(e,t);t.set(e,i)}function fa(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var ga=new WeakMap;var Ta=function(){function e(t){babelHelpers.classCallCheck(this,e);ha(this,ga,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,ga,t)}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e(T.Runtime.clone(babelHelpers.classPrivateFieldGet(this,ga)))}},{key:"set",value:function e(t,i,a){if(!T.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,ga)[t])){babelHelpers.classPrivateFieldGet(this,ga)[t]={}}var r=babelHelpers.classPrivateFieldGet(this,ga)[t][i];if(r!==a){BX.userOptions.save("bizproc.automation",t,i,a,false);babelHelpers.classPrivateFieldGet(this,ga)[t][i]=a}return this}},{key:"get",value:function e(t,i,a){var r=a;if(this.has(t,i)){r=babelHelpers.classPrivateFieldGet(this,ga)[t][i]}return r}},{key:"has",value:function e(t,i){return T.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,ga)[t])&&Object.keys(babelHelpers.classPrivateFieldGet(this,ga)[t]).includes(i)}}]);return e}();var ya,ma,Pa,Ha;var Ia=function e(){return T.Tag.render(ya||(ya=babelHelpers.taggedTemplateLiteral(['\n\t\t<svg \n\t\t\tclass="bizproc-automation_execution-queue_in-turn"\n\t\t\twidth="97"\n\t\t\theight="121"\n\t\t\tviewBox="0 0 97 121"\n\t\t\tfill="none"\n\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\txmlns:xlink="http://www.w3.org/1999/xlink"\n\t\t>\n\t\t\t<rect width="97" height="121" fill="url(#pattern0)"/>\n\t\t\t<path\n\t\t\t\tfill-rule="evenodd"\n\t\t\t\tclip-rule="evenodd"\n\t\t\t\td="M12.25 27C11.5596 27 11 26.4404 11 25.75V18.25C11 17.5596 11.5596 17 12.25 17H15.6875H16H79.75H81.3125H82.7275C83.2009 17 83.6338 17.2675 83.8455 17.691L86 22L83.8455 26.309C83.6338 26.7325 83.2009 27 82.7275 27H81.3125H79.75H16H15.6875H12.25Z"\n\t\t\t\tfill="#DFE0E3"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfill-rule="evenodd"\n\t\t\t\tclip-rule="evenodd"\n\t\t\t\td="M12.25 27C11.5596 27 11 26.4404 11 25.75V18.25C11 17.5596 11.5596 17 12.25 17H15.6875H16H79.75H81.3125H82.7275C83.2009 17 83.6338 17.2675 83.8455 17.691L86 22L83.8455 26.309C83.6338 26.7325 83.2009 27 82.7275 27H81.3125H79.75H16H15.6875H12.25Z"\n\t\t\t\tfill="#55D0E0"\n\t\t\t/>\n\t\t\t<g filter="url(#filter0_d_272_90944)" class="bizproc-automation_execution-queue_transform-element --one">\n\t\t\t\t<rect\n\t\t\t\t\tx="11"\n\t\t\t\t\ty="32"\n\t\t\t\t\twidth="75"\n\t\t\t\t\theight="34"\n\t\t\t\t\trx="4"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td="M11 56H86V62C86 64.2091 84.2091 66 82 66H15C12.7909 66 11 64.2091 11 62V56Z"\n\t\t\t\t\tfill="#C5F8FF"\n\t\t\t\t/>\n\t\t\t\t<rect x="22" y="37" width="21" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="15" y="45" width="54" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="72" y="45" width="8" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="55" y="59" width="28" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<g class="bizproc-automation_execution-queue_checked --one">\n\t\t\t\t\t<circle cx="15" cy="38" r="8" fill="#739F00"/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td="M11.7084 37.089L15.4796 40.8602L13.9711 42.3687L10.1999 38.5975L11.7084 37.089Z"\n\t\t\t\t\t\tfill="white"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td="M20.0051 36.3347L13.9711 42.3687L12.4627 40.8602L18.4966 34.8262L20.0051 36.3347Z"\n\t\t\t\t\t\tfill="white"\n\t\t\t\t\t/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t\t<g filter="url(#filter1_d_272_90944)" class="bizproc-automation_execution-queue_transform-element --two">\n\t\t\t\t<rect\n\t\t\t\t\tx="11"\n\t\t\t\t\ty="71"\n\t\t\t\t\twidth="75"\n\t\t\t\t\theight="34"\n\t\t\t\t\trx="4"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td="M11 95H86V101C86 103.209 84.2091 105 82 105H15C12.7909 105 11 103.209 11 101V95Z"\n\t\t\t\t\tfill="#C5F8FF"\n\t\t\t\t/>\n\t\t\t\t<rect x="15" y="84" width="54" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="72" y="84" width="8" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="55" y="98" width="28" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="22" y="76" width="21" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<g class="bizproc-automation_execution-queue_checked --two">\n\t\t\t\t\t<circle cx="15" cy="77" r="8" fill="#739F00"/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td="M11.7084 76.089L15.4796 79.8602L13.9711 81.3687L10.1999 77.5975L11.7084 76.089Z"\n\t\t\t\t\t\tfill="white"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td="M20.0051 75.3347L13.9711 81.3687L12.4627 79.8602L18.4966 73.8262L20.0051 75.3347Z"\n\t\t\t\t\t\tfill="white"\n\t\t\t\t\t/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t</svg>\n\t'])))};var Ea=function e(){return T.Tag.render(ma||(ma=babelHelpers.taggedTemplateLiteral(['\n\t\t<svg\n\t\t\tclass="bizproc-automation_execution-queue_simultaneously"\n\t\t\twidth="97"\n\t\t\theight="121"\n\t\t\tviewBox="0 0 97 121"\n\t\t\tfill="none"\n\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\txmlns:xlink="http://www.w3.org/1999/xlink"\n\t\t>\n\t\t\t<rect width="97" height="121" fill="url(#pattern0)"/>\n\t\t\t<path\n\t\t\t\tfill-rule="evenodd"\n\t\t\t\tclip-rule="evenodd"\n\t\t\t\td="M12.25 27C11.5596 27 11 26.4404 11 25.75V18.25C11 17.5596 11.5596 17 12.25 17H15.6875H16H79.75H81.3125H82.7275C83.2009 17 83.6338 17.2675 83.8455 17.691L86 22L83.8455 26.309C83.6338 26.7325 83.2009 27 82.7275 27H81.3125H79.75H16H15.6875H12.25Z"\n\t\t\t\tfill="#DFE0E3"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfill-rule="evenodd"\n\t\t\t\tclip-rule="evenodd"\n\t\t\t\td="M12.25 27C11.5596 27 11 26.4404 11 25.75V18.25C11 17.5596 11.5596 17 12.25 17H15.6875H16H79.75H81.3125H82.7275C83.2009 17 83.6338 17.2675 83.8455 17.691L86 22L83.8455 26.309C83.6338 26.7325 83.2009 27 82.7275 27H81.3125H79.75H16H15.6875H12.25Z"\n\t\t\t\tfill="#55D0E0"\n\t\t\t/>\n\t\t\t<g\n\t\t\t\tfilter="url(#filter0_d_272_90944)"\n\t\t\t\tclass="bizproc-automation_execution-queue_transform-element"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tx="11"\n\t\t\t\t\ty="32"\n\t\t\t\t\twidth="75"\n\t\t\t\t\theight="34"\n\t\t\t\t\trx="4"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td="M11 56H86V62C86 64.2091 84.2091 66 82 66H15C12.7909 66 11 64.2091 11 62V56Z"\n\t\t\t\t\tfill="#C5F8FF"\n\t\t\t\t/>\n\t\t\t\t<rect x="22" y="37" width="21" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="15" y="45" width="54" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="72" y="45" width="8" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="55" y="59" width="28" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<g class="bizproc-automation_execution-queue_checked">\n\t\t\t\t\t<circle cx="15" cy="38" r="8" fill="#739F00"/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td="M11.7084 37.089L15.4796 40.8602L13.9711 42.3687L10.1999 38.5975L11.7084 37.089Z"\n\t\t\t\t\t\tfill="white"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td="M20.0051 36.3347L13.9711 42.3687L12.4627 40.8602L18.4966 34.8262L20.0051 36.3347Z"\n\t\t\t\t\t\tfill="white"\n\t\t\t\t\t/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t\t<g\n\t\t\t\tfilter="url(#filter1_d_272_90944)"\n\t\t\t\tclass="bizproc-automation_execution-queue_transform-element"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tx="11"\n\t\t\t\t\ty="71"\n\t\t\t\t\twidth="75"\n\t\t\t\t\theight="34"\n\t\t\t\t\trx="4"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td="M11 95H86V101C86 103.209 84.2091 105 82 105H15C12.7909 105 11 103.209 11 101V95Z"\n\t\t\t\t\tfill="#C5F8FF"\n\t\t\t\t/>\n\t\t\t\t<rect x="15" y="84" width="54" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="72" y="84" width="8" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="55" y="98" width="28" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<rect x="22" y="76" width="21" height="4" rx="2" fill="#999999" fill-opacity="0.33"/>\n\t\t\t\t<g class="bizproc-automation_execution-queue_checked">\n\t\t\t\t\t<circle cx="15" cy="77" r="8" fill="#739F00"/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td="M11.7084 76.089L15.4796 79.8602L13.9711 81.3687L10.1999 77.5975L11.7084 76.089Z"\n\t\t\t\t\t\tfill="white"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td="M20.0051 75.3347L13.9711 81.3687L12.4627 79.8602L18.4966 73.8262L20.0051 75.3347Z"\n\t\t\t\t\t\tfill="white"\n\t\t\t\t\t/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t</svg>\n\t'])))};var wa=function e(t,i,a){var r=T.Tag.render(Pa||(Pa=babelHelpers.taggedTemplateLiteral(['\n\t\t<label\n\t\t\tclass="bizproc-automation-popup-select__wrapper-flex ',' ui-ctl ui-ctl-radio ui-ctl-w100"\n\t\t\tfor="','"\n\t\t\tdata-role="execution-queue-row"\n\t\t>\n\t\t\t<div class="bizproc-automation-popup-select__wrapper-info-block">\n\t\t\t\t<div class="bizproc-automation-popup-select__header-input">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref="radio"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\tid="','"\n\t\t\t\t\t\ttype="radio"\n\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\tname="execution"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class="bizproc-automation-popup-settings__input-title">','</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="bizproc-automation-popup-settings__description">','</div>\n\t\t\t</div>\n\t\t\t<div class="bizproc-automation-popup-settings__image-block">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t</label>\n\t"])),t?"--active":"",i,i,T.Text.encode(a.value),T.Text.encode(a.title),T.Text.encode(a.description),a.imageRenderFunction()),s=r.root,l=r.radio;T.Event.bind(l,"change",(function(){document.querySelectorAll('[data-role="execution-queue-row"]').forEach((function(e){T.Dom.removeClass(e,"--active")}));T.Dom.addClass(s,"--active")}));if(t){T.Dom.attr(l,"checked","checked")}return s};var Fa=function e(t){var i={title:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_AFTER_PREVIOUS_TITLE"),description:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_AFTER_PREVIOUS_DESCRIPTION"),imageRenderFunction:Ia,value:"afterPrevious"};var a={title:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_PARALLEL_TITLE"),description:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_PARALLEL_DESCRIPTION"),imageRenderFunction:Ea,value:"parallel"};var r=T.Tag.render(Ha||(Ha=babelHelpers.taggedTemplateLiteral(['\n\t\t<form class="bizproc-automation-popup-select-block">\n\t\t\t<div class="bizproc-automation-popup-select-item">\n\t\t\t\t','\n\t\t\t</div>\n\t\t\t<div class="bizproc-automation-popup-select-item">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t</form>\n\t"])),wa(t.currentValue==="1","bizproc-automation-cmp1",i),wa(t.currentValue!=="1","bizproc-automation-cmp2",a));var s=new o.Popup({id:h.Helper.generateUniqueId(),bindElement:t.bindElement,content:r,closeByEsc:true,buttons:[new c.Button({color:c.Button.Color.PRIMARY,text:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_CHOOSE_BUTTON_CAPS"),onclick:function e(){if(T.Type.isFunction(t.onSubmitButtonClick)){t.onSubmitButtonClick(new FormData(r))}s.close()}}),new c.Button({color:c.Button.Color.LINK,text:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_CANCEL_BUTTON_CAPS"),onclick:function e(){s.close()}})],width:482,padding:20,closeIcon:false,autoHide:true,titleBar:false,angle:{offset:(t.bindElement.clientWidth+33)/2},overlay:{backgroundColor:"transparent"},events:{onClose:function e(){s.destroy()}}});s.show()};var Sa,_a,Oa,Ca,ka,Aa,Ga,Ma,Na,Da,La,Ra,xa,Ba,za,Ua;function Wa(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function ja(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Wa(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Wa(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ya(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Va(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function Va(e,t){if(!e)return;if(typeof e==="string")return Za(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Za(e,t)}function Za(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Xa(e,t){Ja(e,t);t.add(e)}function qa(e,t,i){Ja(e,t);t.set(e,i)}function Ja(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Ka(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Qa=new WeakMap;var $a=new WeakMap;var er=new WeakMap;var tr=new WeakMap;var ir=new WeakMap;var ar=new WeakMap;var rr=new WeakMap;var sr=new WeakMap;var lr=new WeakMap;var nr=new WeakMap;var or=new WeakMap;var cr=new WeakSet;var ur=new WeakSet;var pr=new WeakSet;var dr=function(e){babelHelpers.inherits(t,e);function t(e){var i;var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Xa(babelHelpers.assertThisInitialized(a),pr);Xa(babelHelpers.assertThisInitialized(a),ur);Xa(babelHelpers.assertThisInitialized(a),cr);qa(babelHelpers.assertThisInitialized(a),Qa,{writable:true,value:void 0});qa(babelHelpers.assertThisInitialized(a),$a,{writable:true,value:void 0});qa(babelHelpers.assertThisInitialized(a),er,{writable:true,value:void 0});qa(babelHelpers.assertThisInitialized(a),tr,{writable:true,value:void 0});qa(babelHelpers.assertThisInitialized(a),ir,{writable:true,value:void 0});qa(babelHelpers.assertThisInitialized(a),ar,{writable:true,value:void 0});qa(babelHelpers.assertThisInitialized(a),rr,{writable:true,value:void 0});qa(babelHelpers.assertThisInitialized(a),sr,{writable:true,value:void 0});qa(babelHelpers.assertThisInitialized(a),lr,{writable:true,value:void 0});qa(babelHelpers.assertThisInitialized(a),nr,{writable:true,value:void 0});qa(babelHelpers.assertThisInitialized(a),or,{writable:true,value:void 0});a.setEventNamespace("BX.Bizproc.Automation");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Qa,(i=e.context)!==null&&i!==void 0?i:h.getGlobalContext());a.constants=e.constants;a.variables=e.variables;babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ar,e.templateContainerNode);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),$a,e.delayMinLimitM);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),er,e.userOptions);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),tr,babelHelpers.classPrivateFieldGet(babelHelpers.assertThisInitialized(a),Qa).tracker);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),or,{});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),nr,[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ir,K.none());return a}babelHelpers.createClass(t,[{key:"init",value:function e(t,i){if(T.Type.isPlainObject(t)){babelHelpers.classPrivateFieldSet(this,or,t);if(!T.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,or).CONSTANTS)){babelHelpers.classPrivateFieldGet(this,or).CONSTANTS={}}if(!T.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,or).PARAMETERS)){babelHelpers.classPrivateFieldGet(this,or).PARAMETERS={}}if(!T.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,or).VARIABLES)){babelHelpers.classPrivateFieldGet(this,or).VARIABLES={}}if(!T.Type.isNil(babelHelpers.classPrivateFieldGet(this,or).DOCUMENT_STATUS)){babelHelpers.classPrivateFieldGet(this,or).DOCUMENT_STATUS=String(babelHelpers.classPrivateFieldGet(this,or).DOCUMENT_STATUS)}this.markExternalModified(babelHelpers.classPrivateFieldGet(this,or).IS_EXTERNAL_MODIFIED);this.markModified(false)}babelHelpers.classPrivateFieldSet(this,ir,K.fromRaw(i));if(!babelHelpers.classPrivateFieldGet(this,ir).isNone()){babelHelpers.classPrivateFieldSet(this,rr,babelHelpers.classPrivateFieldGet(this,ar).querySelector('[data-role="automation-template"][data-status-id="'.concat(babelHelpers.classPrivateFieldGet(this,or).DOCUMENT_STATUS,'"]')));babelHelpers.classPrivateFieldSet(this,sr,babelHelpers.classPrivateFieldGet(this,rr).querySelector('[data-role="robot-list"]'));babelHelpers.classPrivateFieldSet(this,lr,babelHelpers.classPrivateFieldGet(this,rr).querySelector('[data-role="buttons"]'));this.initRobots();this.initButtons();if(!this.isExternalModified()&&this.canEdit()){jsDD.registerDest(babelHelpers.classPrivateFieldGet(this,rr),10)}else{jsDD.unregisterDest(babelHelpers.classPrivateFieldGet(this,rr))}}}},{key:"reInit",value:function e(t,i){T.Dom.clean(babelHelpers.classPrivateFieldGet(this,sr));T.Dom.clean(babelHelpers.classPrivateFieldGet(this,lr));this.destroy();this.init(t,i)}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){return e.destroy()}))}},{key:"canEdit",value:function e(){return babelHelpers.classPrivateFieldGet(this,Qa).canEdit}},{key:"initRobots",value:function e(){babelHelpers.classPrivateFieldSet(this,nr,[]);if(T.Type.isArray(babelHelpers.classPrivateFieldGet(this,or).ROBOTS)){for(var t=0;t<babelHelpers.classPrivateFieldGet(this,or).ROBOTS.length;++t){var i=new oa({document:babelHelpers.classPrivateFieldGet(this,Qa).document,template:this,isFrameMode:babelHelpers.classPrivateFieldGet(this,Qa).get("isFrameMode"),tracker:babelHelpers.classPrivateFieldGet(this,tr)});i.init(babelHelpers.classPrivateFieldGet(this,or).ROBOTS[t],babelHelpers.classPrivateFieldGet(this,ir));this.insertRobotNode(i.node);babelHelpers.classPrivateFieldGet(this,nr).push(i)}}}},{key:"getSelectedRobotNames",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){if(e.isSelected()){t.push(e.data.Name)}}));return t}},{key:"getActivatedRobotNames",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){if(e.isActivated()){t.push(e.data.Name)}}));return t}},{key:"getDeactivatedRobotNames",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){if(!e.isActivated()){t.push(e.data.Name)}}));return t}},{key:"getSerializedRobots",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){return t.push(e.serialize())}));return t}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,or).ID}},{key:"getStatusId",value:function e(){return babelHelpers.classPrivateFieldGet(this,or).DOCUMENT_STATUS}},{key:"getStatus",value:function e(){var t=this;return babelHelpers.classPrivateFieldGet(this,Qa).document.statusList.find((function(e){return String(e.STATUS_ID)===t.getStatusId()}))}},{key:"getTemplateId",value:function e(){var t=parseInt(babelHelpers.classPrivateFieldGet(this,or).ID,10);return Number.isNaN(t)?0:t}},{key:"getDocumentType",value:function e(){return babelHelpers.classPrivateFieldGet(this,or).DOCUMENT_TYPE}},{key:"initButtons",value:function e(){if(this.isExternalModified()){this.createExternalLocker();this.createManageModeButton();this.createTerminateRobotsButton()}else if(babelHelpers.classPrivateFieldGet(this,ir).isEdit()&&this.getTemplateId()>0){this.createConstantsEditButton();this.createParametersEditButton();this.createExternalEditTemplateButton();this.createManageModeButton();this.createTerminateRobotsButton()}}},{key:"enableManageMode",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,sr)){babelHelpers.classPrivateFieldSet(this,ir,K.manage().setProperty("isActive",t));if(t){T.Dom.addClass(babelHelpers.classPrivateFieldGet(this,sr),"--multiselect-mode")}if(this.isExternalModified()){T.Dom.addClass(babelHelpers.classPrivateFieldGet(this,sr),"--locked-node")}else{babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){if(e.isInvalid()){e.enableManageMode(false)}else{e.enableManageMode(t)}}))}}}},{key:"disableManageMode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,sr)){babelHelpers.classPrivateFieldSet(this,ir,K.edit());T.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,sr),"--multiselect-mode");if(this.isExternalModified()){T.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,sr),"--locked-node")}else{babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){e.disableManageMode();if(!e.isInvalid()){var t=e.node.querySelector(".bizproc-automation-robot-container-wrapper");if(t){T.Dom.addClass(t,"bizproc-automation-robot-container-wrapper-draggable")}}}))}}}},{key:"enableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){if(!e.isInvalid()){e.registerItem(e.node);var t=e.node.querySelector(".bizproc-automation-robot-container-wrapper");if(t){T.Dom.addClass(t,"bizproc-automation-robot-container-wrapper-draggable")}}}))}},{key:"disableDragAndDrop",value:function e(){babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){return e.unregisterItem(e.node)}));babelHelpers.classPrivateFieldGet(this,rr).querySelectorAll(".bizproc-automation-robot-container-wrapper").forEach((function(e){T.Dom.removeClass(e,"bizproc-automation-robot-container-wrapper-draggable")}))}},{key:"createExternalEditTemplateButton",value:function e(){var t=this;if(T.Type.isNil(babelHelpers.classPrivateFieldGet(this,Qa).bizprocEditorUrl)){return false}var i=T.Tag.render(Sa||(Sa=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="bizproc-automation-robot-btn-set" href="#" target="_top">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT"));T.Event.bind(i,"click",(function(e){e.preventDefault();if(!babelHelpers.classPrivateFieldGet(t,ir).isManage()){t.onExternalEditTemplateButtonClick(i)}}));if(babelHelpers.classPrivateFieldGet(this,Qa).bizprocEditorUrl.length===0){T.Dom.addClass(i,"bizproc-automation-robot-btn-set-locked")}T.Dom.append(i,babelHelpers.classPrivateFieldGet(this,lr))}},{key:"createManageModeButton",value:function e(){var t=this;if(!babelHelpers.classPrivateFieldGet(this,Qa).canManage){return}var i=T.Tag.render(_a||(_a=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="bizproc-automation-robot-btn-set" target="_top" style="cursor: pointer">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MANAGE_ROBOTS_1"));T.Event.bind(i,"click",(function(e){e.preventDefault();t.onManageModeButtonClick(i)}));T.Dom.append(i,babelHelpers.classPrivateFieldGet(this,lr))}},{key:"onManageModeButtonClick",value:function e(t){if(this.canEdit()){this.emit("Template:enableManageMode",{documentStatus:babelHelpers.classPrivateFieldGet(this,or).DOCUMENT_STATUS})}else{qt.showNoPermissionsHint(t)}}},{key:"createTerminateRobotsButton",value:function e(){var t=this;if(!this.hasRunningRobots()&&this.getRunningCustomRobots().length===0){return}var i=T.Tag.render(Oa||(Oa=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="bizproc-automation-robot-btn-set btn-pointer" target="_top">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"])),T.Loc.getMessage("BIZPROC_JS_AUTOMATION_ROBOTS_TERMINATE"));T.Event.bind(i,"click",(function(e){e.preventDefault();t.onTerminateRobotsButtonClick(i)}));T.Dom.append(i,babelHelpers.classPrivateFieldGet(this,lr))}},{key:"onTerminateRobotsButtonClick",value:function e(t){var i=this;var a=this.getTemplateId();var r=babelHelpers.classPrivateFieldGet(this,Qa).signedDocument;if(a>0&&r){T.Dom.addClass(t,"--disabled");T.ajax.runAction("bizproc.workflow.terminateByTemplate",{data:{templateId:a,signedDocument:r}}).then((function(e){i.notifyMessage(T.Loc.getMessage("BIZPROC_JS_AUTOMATION_ROBOTS_STOPPED"));i.stopTemplate()}))["catch"]((function(e){e.errors.forEach((function(e){i.notifyMessage(e.message)}))}))}}},{key:"stopTemplate",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,rr).querySelectorAll(".bizproc-automation-robot-information.--loader");t.forEach((function(e){T.Dom.removeClass(e,"--loader")}))}},{key:"notifyMessage",value:function e(t){i.UI.Notification.Center.notify({content:t,autoHideDelay:5e3})}},{key:"hasRunningRobots",value:function e(){return Boolean(babelHelpers.classPrivateFieldGet(this,nr).some((function(e){return e.getLogStatus()===ii.RUNNING})))}},{key:"getRunningCustomRobots",value:function e(){var t;return(t=babelHelpers.classPrivateFieldGet(this,or).CUSTOM_ROBOTS)!==null&&t!==void 0?t:[]}},{key:"createConstantsEditButton",value:function e(){if(T.Type.isNil(babelHelpers.classPrivateFieldGet(this,Qa).constantsEditorUrl)){return false}var t=babelHelpers.classPrivateFieldGet(this,ir).isManage()?"#":babelHelpers.classPrivateFieldGet(this,Qa).constantsEditorUrl.replace("#ID#",this.getTemplateId());if(t.length===0){return false}var i=T.Tag.render(Ca||(Ca=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="bizproc-automation-robot-btn-set" href="','">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"])),T.Text.encode(t),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CONSTANTS_EDIT"));T.Dom.append(i,babelHelpers.classPrivateFieldGet(this,lr))}},{key:"createParametersEditButton",value:function e(){if(T.Type.isNil(babelHelpers.classPrivateFieldGet(this,Qa).parametersEditorUrl)){return false}var t=babelHelpers.classPrivateFieldGet(this,Qa).parametersEditorUrl.replace("#ID#",this.getTemplateId());if(t.length===0||babelHelpers.classPrivateFieldGet(this,ir).isManage()){return false}var i=T.Tag.render(ka||(ka=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<a class="bizproc-automation-robot-btn-set" href="','">\n\t\t\t\t',"\n\t\t\t</a>\n\t\t"])),T.Text.encode(t),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_PARAMETERS_EDIT"));T.Dom.append(i,babelHelpers.classPrivateFieldGet(this,lr))}},{key:"createExternalLocker",value:function e(){var t=this;var i=T.Tag.render(Aa||(Aa=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-robot-container">\n\t\t\t\t<div class="bizproc-automation-robot-container-wrapper bizproc-automation-robot-container-wrapper-lock">\n\t\t\t\t\t<div class="bizproc-automation-robot-deadline"></div>\n\t\t\t\t\t<div class="bizproc-automation-robot-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bizproc-automation-robot-information" ref="iconBlock"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EXTERNAL_EDIT_TEXT")),a=i.root,r=i.iconBlock;if(this.getRunningCustomRobots().length>0){T.Dom.addClass(r,"--loader")}if(babelHelpers.classPrivateFieldGet(this,ir).isEdit()){var s=T.Tag.render(Ga||(Ga=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="bizproc-automation-robot-btn-settings">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_EDIT"));T.Event.bind(a,"click",(function(e){e.stopPropagation();if(!babelHelpers.classPrivateFieldGet(t,ir).isManage()){t.onExternalEditTemplateButtonClick(a)}}));T.Dom.append(s,a);var l=T.Tag.render(Ma||(Ma=babelHelpers.taggedTemplateLiteral(['<span class="bizproc-automation-robot-btn-delete"></span>'])));T.Event.bind(l,"click",(function(e){e.stopPropagation();if(!babelHelpers.classPrivateFieldGet(t,ir).isManage()){t.onUnsetExternalModifiedClick(l)}}));T.Dom.append(l,a.lastChild)}T.Dom.append(a,babelHelpers.classPrivateFieldGet(this,sr));babelHelpers.classPrivateFieldSet(this,rr,a)}},{key:"onSearch",value:function e(t){if(this.isExternalModified()){this.onExternalModifiedSearch(t)}else{babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){return e.onSearch(t)}))}}},{key:"onExternalModifiedSearch",value:function e(t){if(babelHelpers.classPrivateFieldGet(this,rr)){var i=t.getData().queryString;T.Dom[i?"addClass":"removeClass"](babelHelpers.classPrivateFieldGet(this,rr),"--search-mismatch")}}},{key:"onExternalEditTemplateButtonClick",value:function e(t){if(!this.canEdit()){qt.showNoPermissionsHint(t);return}if(babelHelpers.classPrivateFieldGet(this,Qa).bizprocEditorUrl.length===0){if(top.BX.UI&&top.BX.UI.InfoHelper){top.BX.UI.InfoHelper.show("limit_office_bp_designer")}return}var i=this.getTemplateId();if(i>0){this.openBizprocEditor(i)}}},{key:"onUnsetExternalModifiedClick",value:function e(t){if(!this.canEdit()){qt.showNoPermissionsHint(t);return}babelHelpers.classPrivateFieldSet(this,rr,null);this.markExternalModified(false);this.markModified();this.reInit(null,babelHelpers.classPrivateFieldGet(this,ir).intoRaw())}},{key:"openBizprocEditor",value:function e(t){top.window.location.href=babelHelpers.classPrivateFieldGet(this,Qa).bizprocEditorUrl.replace("#ID#",t)}},{key:"addRobot",value:function e(t,i){var a=new oa({document:babelHelpers.classPrivateFieldGet(this,Qa).document,template:this,isFrameMode:babelHelpers.classPrivateFieldGet(this,Qa).get("isFrameMode"),tracker:babelHelpers.classPrivateFieldGet(this,tr)});var r={Type:t.CLASS,Properties:{Title:t.NAME},DialogContext:t.DIALOG_CONTEXT};if(babelHelpers.classPrivateFieldGet(this,nr).length>0){var s=babelHelpers.classPrivateFieldGet(this,nr)[babelHelpers.classPrivateFieldGet(this,nr).length-1];if(!s.getDelayInterval().isNow()||s.isExecuteAfterPrevious()){r.Delay=s.getDelayInterval().serialize();r.ExecuteAfterPrevious=1}}a.draft=true;a.init(r,babelHelpers.classPrivateFieldGet(this,ir));this.insertRobot(a);this.insertRobotNode(a.node);this.emit("Template:robot:add",{robot:a});if(i){i.call(this,a)}}},{key:"insertRobot",value:function e(t,i){if(i){for(var a=0;a<babelHelpers.classPrivateFieldGet(this,nr).length;++a){if(babelHelpers.classPrivateFieldGet(this,nr)[a]!==i){continue}babelHelpers.classPrivateFieldGet(this,nr).splice(a,0,t);break}}else{babelHelpers.classPrivateFieldGet(this,nr).push(t)}this.markModified()}},{key:"getNextRobot",value:function e(t){for(var i=0;i<babelHelpers.classPrivateFieldGet(this,nr).length;++i){if(babelHelpers.classPrivateFieldGet(this,nr)[i]===t){return babelHelpers.classPrivateFieldGet(this,nr)[i+1]||null}}return null}},{key:"deleteRobot",value:function e(t,i){for(var a=0;a<babelHelpers.classPrivateFieldGet(this,nr).length;++a){if(babelHelpers.classPrivateFieldGet(this,nr)[a].isEqual(t)){babelHelpers.classPrivateFieldGet(this,nr).splice(a,1);if(i){i(t)}this.markModified();this.emit("Template:robot:delete",{robot:t});break}}}},{key:"insertRobotNode",value:function e(t,i){if(i){babelHelpers.classPrivateFieldGet(this,sr).insertBefore(t,i)}else{T.Dom.append(t,babelHelpers.classPrivateFieldGet(this,sr))}}},{key:"openRobotSettingsDialog",value:function e(t,i,a){var r=this;if(!T.Type.isPlainObject(i)){i={}}if(h.Designer.getInstance().getRobotSettingsDialog()){return}var s=t.getBrokenLinks();var l="bizproc_automation_robot_dialog";var n=T.Tag.render(Na||(Na=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<form name="','">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t</form>\n\t\t"])),l,Ka(this,ur,vr).call(this,t),this.renderDelaySettings(t),this.renderConditionSettings(t),s.length>0?this.renderBrokenLinkAlert(s):"");h.Designer.getInstance().setRobotSettingsDialog({template:this,context:i,robot:t,form:n});i.DOCUMENT_CATEGORY_ID=babelHelpers.classPrivateFieldGet(this,Qa).document.getCategoryId();if(T.Type.isPlainObject(t.data.DialogContext)&&!T.Type.isNil(t.data.DialogContext.addMenuGroup)){i.addMenuGroup=t.data.DialogContext.addMenuGroup}T.ajax({method:"POST",dataType:"html",url:T.Uri.addParam(babelHelpers.classPrivateFieldGet(this,Qa).ajaxUrl,{analyticsLabel:"automation_robot".concat(t.draft?"_draft":"","_settings_").concat(t.data.Type.toLowerCase())}),data:{ajax_action:"get_robot_dialog",document_signed:babelHelpers.classPrivateFieldGet(this,Qa).signedDocument,document_status:babelHelpers.classPrivateFieldGet(this,Qa).document.getCurrentStatusId(),context:i,robot_json:Ee.toJsonString(t.serialize()),context_robots_json:Ee.toJsonString(babelHelpers.classPrivateFieldGet(this,nr).filter((function(e){return e!==t})).map((function(e){return e.serialize()}))),form_name:l},onsuccess:function e(i){if(i){var s=T.Dom.create("div",{html:i});T.Dom.append(s,n)}r.showRobotSettingsPopup(t,n,a)}})}},{key:"showRobotSettingsPopup",value:function e(t,i,a){var r=this;var s=580;var l=s;if(babelHelpers.classPrivateFieldGet(this,er)){this.emit("Template:robot:showSettings");l=parseInt(babelHelpers.classPrivateFieldGet(this,er).get("defaults","robot_settings_popup_width",580),10)}this.initRobotSettingsControls(t,i);if(t.data.Type==="CrmSendEmailActivity"||t.data.Type==="MailActivity"||t.data.Type==="RpaApproveActivity"){s+=170;if(l<s){l=s}}var n=T.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_SETTINGS_TITLE");var u=T.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_SETTINGS_TITLE");if(t.hasTitle()){n=t.getTitle();u=t.getDescriptionTitle();if(u==="untitled"){u=n}}var p=T.Tag.render(Da||(Da=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="popup-window-titlebar-text bizproc-automation-robot-settings-popup-titlebar">\n\t\t\t\t<span class="bizproc-automation-robot-settings-popup-titlebar-text">','</span>\n\t\t\t\t<div class="ui-hint">\n\t\t\t\t\t<span class="ui-hint-icon" data-text="','"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),T.Text.encode(n),T.Text.encode(u));qt.bindAll(p);var d=new o.Popup({id:Ee.generateUniqueId(),bindElement:null,content:i,closeByEsc:true,buttons:[new c.SaveButton({onclick:function e(s){var l=t.draft;var n=function e(){d.close();if(l){r.emit("Template:robot:add",{robot:t})}if(a){a(t)}};r.saveRobotSettings(i,t,n,s.getContainer())}}),new c.CancelButton({text:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_CANCEL_BUTTON_CAPS"),onclick:function e(){d.close()}})],width:l,minWidth:s,minHeight:100,contentPadding:12,resizable:true,closeIcon:true,events:{onPopupClose:function e(){h.Designer.getInstance().setRobotSettingsDialog(null);r.destroyRobotSettingsControls();d.destroy();r.emit("Template:robot:closeSettings")},onPopupResize:function e(){r.onResizeRobotSettings()},onPopupResizeEnd:function e(){if(babelHelpers.classPrivateFieldGet(r,er)){babelHelpers.classPrivateFieldGet(r,er).set("defaults","robot_settings_popup_width",d.getWidth())}}},titleBar:{content:p},draggable:{restrict:false}});h.Designer.getInstance().getRobotSettingsDialog().popup=d;d.show()}},{key:"initRobotSettingsControls",value:function e(t,i){if(!T.Type.isArray(this.robotSettingsControls)){this.robotSettingsControls=[]}var a=i.querySelectorAll("[data-role]");var r=Ya(a),s;try{for(r.s();!(s=r.n()).done;){var l=s.value;this.initRobotSettingsControl(t,l)}}catch(e){r.e(e)}finally{r.f()}}},{key:"initRobotSettingsControl",value:function e(t,i){var a=this;if(!T.Type.isArray(this.robotSettingsControls)){this.robotSettingsControls=[]}var r=i.getAttribute("data-role");var s={context:new h.SelectorContext({fields:T.Runtime.clone(babelHelpers.classPrivateFieldGet(this,Qa).document.getFields()),useSwitcherMenu:babelHelpers.classPrivateFieldGet(this,Qa).get("showTemplatePropertiesMenuOnSelecting"),rootGroupTitle:babelHelpers.classPrivateFieldGet(this,Qa).document.title,userOptions:babelHelpers.classPrivateFieldGet(this,Qa).userOptions}),needSync:t.draft,checkbox:i};if(r===h.SelectorManager.SELECTOR_ROLE_USER){var l=JSON.parse(i.getAttribute("data-property"));s.context.set("additionalUserFields",[].concat(babelHelpers.toConsumableArray(Ka(this,cr,br).call(this,l)),babelHelpers.toConsumableArray(this.globalConstants.filter((function(e){return e.Type==="user"})).map((function(e){return{id:e.Expression,title:e.Name}}))),babelHelpers.toConsumableArray(this.globalVariables.filter((function(e){return e.Type==="user"})).map((function(e){return{id:e.Expression,title:e.Name}})))))}else if(r===h.SelectorManager.SELECTOR_ROLE_FILE){this.robots.forEach((function(e){var t;(t=s.context.fields).push.apply(t,babelHelpers.toConsumableArray(e.getReturnFieldsDescription().filter((function(e){return e.Type==="file"})).map((function(t){return{Id:"{{~".concat(e.getId(),":").concat(t.Id,"}}"),Name:"".concat(e.getTitle(),": ").concat(t.Name),Type:"file",Expression:"{{~".concat(e.getId(),":").concat(t.Id,"}}")}}))))}))}var n=h.SelectorManager.createSelectorByRole(r,s);if(n&&r!==h.SelectorManager.SELECTOR_ROLE_SAVE_STATE){n.renderTo(i);n.subscribe("onAskConstant",(function(e){var t=e.getData(),i=t.fieldProperty;n.onFieldSelect(a.addConstant(i))}));n.subscribe("onAskParameter",(function(e){var t=e.getData(),i=t.fieldProperty;n.onFieldSelect(a.addParameter(i))}));n.subscribe("onOpenFieldMenu",(function(e){return a.onOpenMenu(e,t)}));n.subscribe("onOpenMenu",(function(e){return a.onOpenMenu(e,t)}))}BX.UI.Hint.init(i);if(n){this.robotSettingsControls.push(n)}}},{key:"getRobotsWithReturnFields",value:function e(t){var i=(t===null||t===void 0?void 0:t.getId())||"";return this.robots.filter((function(e){return e.getId()!==i&&e.hasReturnFields()}))}},{key:"destroyRobotSettingsControls",value:function e(){if(this.conditionSelector){this.conditionSelector.destroy();this.conditionSelector=null}if(T.Type.isArray(this.robotSettingsControls)){for(var t=0;t<this.robotSettingsControls.length;++t){if(T.Type.isFunction(this.robotSettingsControls[t].destroy)){this.robotSettingsControls[t].destroy()}}}this.robotSettingsControls=null}},{key:"onBeforeSaveRobotSettings",value:function e(){if(T.Type.isArray(this.robotSettingsControls)){for(var t=0;t<this.robotSettingsControls.length;++t){if(T.Type.isFunction(this.robotSettingsControls[t].onBeforeSave)){this.robotSettingsControls[t].onBeforeSave()}}}}},{key:"onResizeRobotSettings",value:function e(){if(T.Type.isArray(this.robotSettingsControls)){for(var t=0;t<this.robotSettingsControls.length;++t){if(T.Type.isFunction(this.robotSettingsControls[t].onPopupResize)){this.robotSettingsControls[t].onPopupResize()}}}}},{key:"renderDelaySettings",value:function e(t){var i=t.getDelayInterval().clone();var a=T.Tag.render(La||(La=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings">\n\t\t\t\t<div class="bizproc-automation-popup-settings-block">\n\t\t\t\t\t<span class="bizproc-automation-popup-settings-title-wrapper">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref="delayTypeNode"\n\t\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\t\tname="delay_type"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref="delayValueNode"\n\t\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\t\tname="delay_value"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref="delayValueTypeNode"\n\t\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\t\tname="delay_value_type"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref="delayBasisNode"\n\t\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\t\tname="delay_basis"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\tref="delayWorkTimeNode"\n\t\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\t\tname="delay_worktime"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref="delayWaitWorkDayNode"\n\t\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\t\tname="delay_wait_workday"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref="delayInTimeNode"\n\t\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\t\tname="delay_in_time"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tclass="bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-left"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tref="delayIntervalLabelNode"\n\t\t\t\t\t\t\tclass="bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis"\n\t\t\t\t\t\t></span>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),T.Text.encode(i.type),T.Text.encode(i.value),T.Text.encode(i.valueType),T.Text.encode(i.basis),i.workTime?1:0,i.waitWorkDay?1:0,T.Text.encode(i.inTimeString),T.Loc.getMessage("BIZPROC_JS_AUTOMATION_TO_EXECUTE_TITLE")),r=a.root,s=a.delayTypeNode,l=a.delayValueNode,n=a.delayValueTypeNode,o=a.delayBasisNode,c=a.delayWorkTimeNode,u=a.delayWaitWorkDayNode,p=a.delayInTimeNode,d=a.delayIntervalLabelNode;var b=[];var v=babelHelpers.classPrivateFieldGet(this,Qa).document.getFields();var f=babelHelpers.classPrivateFieldGet(this,$a);if(T.Type.isArray(v)){var g=Ya(v),y;try{for(g.s();!(y=g.n()).done;){var m=y.value;if(m.Type==="date"||m.Type==="datetime"){b.push(m)}}}catch(e){g.e(e)}finally{g.f()}}var P=new h.DelayIntervalSelector({labelNode:d,onchange:function e(t){s.value=t.type;l.value=t.value;n.value=t.valueType;o.value=t.basis;c.value=t.workTime?1:0;u.value=t.waitWorkDay?1:0;p.value=t.inTimeString},basisFields:b,minLimitM:f,useAfterBasis:true,showWaitWorkDay:true});P.init(i);return r}},{key:"setDelaySettingsFromForm",value:function e(t,i){var a=new Vt;a.setType(t.delay_type);a.setValue(t.delay_value);a.setValueType(t.delay_value_type);a.setBasis(t.delay_basis);a.setWorkTime(t.delay_worktime==="1");a.setWaitWorkDay(t.delay_wait_workday==="1");a.setInTime(t.delay_in_time?t.delay_in_time.split(":"):null);i.setDelayInterval(a);if(i.hasTemplate()){i.setExecuteAfterPrevious(t.execute_after_previous&&t.execute_after_previous==="1")}return this}},{key:"renderConditionSettings",value:function e(t){var i=this,a;var r=t.getCondition();this.conditionSelector=new h.ConditionGroupSelector(r,{fields:babelHelpers.classPrivateFieldGet(this,Qa).document.getFields(),onOpenFieldMenu:function e(a){return i.onOpenMenu(a,t)},onOpenMenu:function e(a){return i.onOpenMenu(a,t)},caption:{head:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_ROBOT_CONDITION_TITLE")},isExpanded:((a=babelHelpers.classPrivateFieldGet(this,er))===null||a===void 0?void 0:a.get("defaults","isConditionGroupExpanded","N"))==="Y"});this.conditionSelector.subscribe("onToggleGroupViewClick",(function(e){var t=e.getData();babelHelpers.classPrivateFieldGet(i,er).set("defaults","isConditionGroupExpanded",t.isExpanded?"Y":"N")}));return this.conditionSelector.createNode()}},{key:"onOpenMenu",value:function e(t,i){var a=t.getData().selector;var r=t.getData().isMixedCondition;var s=!(T.Type.isBoolean(r)&&!r);if(s){var l=new h.SelectorItemsManager({activityResultFields:Ka(this,pr,hr).call(this,i),constants:this.getConstants(),globalConstants:this.globalConstants,globalVariables:this.globalVariables});l.groupsWithChildren.forEach((function(e){a.addGroup(e.id,e)}))}this.emit("Template:onSelectorMenuOpen",ja({template:this,robot:i},t.getData()))}},{key:"setConditionSettingsFromForm",value:function e(t,i){i.setCondition(h.ConditionGroup.createFromForm(t));return this}},{key:"renderBrokenLinkAlert",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var i=T.Tag.render(Ra||(Ra=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-robot-broken-link-full-info">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),t.map((function(e){return T.Text.encode(e)})).join("<br>"));var a=T.Tag.render(xa||(xa=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="bizproc-automation-robot-broken-link-show-more">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),T.Loc.getMessage("JS_BIZPROC_AUTOMATION_BROKEN_LINK_MESSAGE_ERROR_MORE_INFO"));T.Event.bindOnce(a,"click",(function(){T.Dom.style(i,"height","".concat(i.scrollHeight,"px"));T.Dom.remove(a)}));var r=T.Tag.render(Ba||(Ba=babelHelpers.taggedTemplateLiteral(['<span class="ui-alert-close-btn"></span>'])));var s=T.Tag.render(za||(za=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="ui-alert ui-alert-warning ui-alert-icon-info">\n\t\t\t\t<div class="ui-alert-message">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span>',"</span>\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_BROKEN_LINK_MESSAGE_ERROR"),a,i,r);T.Event.bindOnce(r,"click",(function(){T.Dom.remove(s)}));return s}},{key:"saveRobotSettings",value:function e(t,i,a,r){var s=this;if(r){T.Dom.addClass(r,"ui-btn-wait")}this.onBeforeSaveRobotSettings();var l=BX.ajax.prepareForm(t);var n=i.onBeforeSaveRobotSettings(l);var o=babelHelpers.classPrivateFieldGet(this,Qa).ajaxUrl;var c=babelHelpers.classPrivateFieldGet(this,Qa).signedDocument;T.ajax({method:"POST",dataType:"json",url:T.Uri.addParam(o,{analyticsLabel:"automation_robot".concat(i.draft?"_draft":"","_save_").concat(i.data.Type.toLowerCase())}),data:{ajax_action:"save_robot_settings",document_signed:c,robot_json:Ee.toJsonString(i.serialize()),form_data_json:Ee.toJsonString(ja(ja({},l.data),n)),form_data:l.data},onsuccess:function e(t){if(r){T.Dom.removeClass(r,"ui-btn-wait")}if(t.SUCCESS){i.updateData(t.DATA.robot);s.setDelaySettingsFromForm(l.data,i);s.setConditionSettingsFromForm(l.data,i);i.draft=false;i.reInit();s.markModified();if(a){a(t.DATA)}}else{alert(t.ERRORS[0])}}})}},{key:"serialize",value:function e(){var t=T.Runtime.clone(babelHelpers.classPrivateFieldGet(this,or));t.IS_EXTERNAL_MODIFIED=this.isExternalModified()?1:0;t.ROBOTS=[];for(var i=0;i<babelHelpers.classPrivateFieldGet(this,nr).length;++i){t.ROBOTS.push(babelHelpers.classPrivateFieldGet(this,nr)[i].serialize())}return t}},{key:"isExternalModified",value:function e(){return this.externalModified===true}},{key:"markExternalModified",value:function e(t){this.externalModified=t!==false}},{key:"getRobotById",value:function e(t){return babelHelpers.classPrivateFieldGet(this,nr).find((function(e){return e.getId()===t}))}},{key:"isModified",value:function e(){return this.modified}},{key:"markModified",value:function e(t){this.modified=t!==false;if(this.modified){this.emit("Template:modified")}}},{key:"getConstants",value:function e(){var t=this;var i=[];Object.keys(babelHelpers.classPrivateFieldGet(this,or).CONSTANTS).forEach((function(e){var a=T.Runtime.clone(babelHelpers.classPrivateFieldGet(t,or).CONSTANTS[e]);a.Id=e;a.ObjectId="Constant";a.SystemExpression="{=Constant:".concat(e,"}");a.Expression="{{~&:".concat(e,"}}");a.SuperTitle=T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_TEMPLATE_CONSTANTS_LIST");i.push(a)}));return i}},{key:"getConstant",value:function e(t){var i=this.getConstants();var a=Ya(i),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.Id===t){return s}}}catch(e){a.e(e)}finally{a.f()}return null}},{key:"addConstant",value:function e(t){var i=t.Id||this.generatePropertyId("Constant",babelHelpers.classPrivateFieldGet(this,or).CONSTANTS);if(babelHelpers.classPrivateFieldGet(this,or).CONSTANTS[i]){throw'Constant with id "'.concat(i,'" is already exists')}babelHelpers.classPrivateFieldGet(this,or).CONSTANTS[i]=t;this.emit("Template:constant:add");return this.getConstant(i)}},{key:"updateConstant",value:function e(t,i){if(!babelHelpers.classPrivateFieldGet(this,or).CONSTANTS[t]){throw'Constant with id "'.concat(t,'" does not exists')}babelHelpers.classPrivateFieldGet(this,or).CONSTANTS[t].Description=i.Description;this.emit("Template:constant:update",{constant:this.getConstant(t)});return this.getConstant(t)}},{key:"deleteConstant",value:function e(t){delete babelHelpers.classPrivateFieldGet(this,or).CONSTANTS[t];return true}},{key:"setConstantValue",value:function e(t,i){if(babelHelpers.classPrivateFieldGet(this,or).CONSTANTS[t]){babelHelpers.classPrivateFieldGet(this,or).CONSTANTS[t].Default=i;return true}return false}},{key:"getParameters",value:function e(){var t=this;var i=[];Object.keys(babelHelpers.classPrivateFieldGet(this,or).PARAMETERS).forEach((function(e){var a=T.Runtime.clone(babelHelpers.classPrivateFieldGet(t,or).PARAMETERS[e]);a.Id=e;a.ObjectId="Template";a.SystemExpression="{=Template:".concat(e,"}");a.Expression="{{~*:".concat(e,"}}");i.push(a)}));return i}},{key:"getParameter",value:function e(t){var i=this.getParameters();var a=Ya(i),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.Id===t){return s}}}catch(e){a.e(e)}finally{a.f()}return null}},{key:"addParameter",value:function e(t){var i=t.Id||this.generatePropertyId("Parameter",babelHelpers.classPrivateFieldGet(this,or).PARAMETERS);if(babelHelpers.classPrivateFieldGet(this,or).PARAMETERS[i]){throw'Parameter with id "'.concat(i,'" is already exists')}babelHelpers.classPrivateFieldGet(this,or).PARAMETERS[i]=t;this.emit("Template:parameter:add",{parameter:this.getParameter(i)});return this.getParameter(i)}},{key:"updateParameter",value:function e(t,i){if(!babelHelpers.classPrivateFieldGet(this,or).PARAMETERS[t]){throw'Parameter with id "'.concat(t,'" does not exists')}babelHelpers.classPrivateFieldGet(this,or).PARAMETERS[t].Description=i.Description;this.emit("Template:parameter:update",{parameter:this.getParameter(t)});return this.getParameter(t)}},{key:"deleteParameter",value:function e(t){delete babelHelpers.classPrivateFieldGet(this,or).PARAMETERS[t];return true}},{key:"setParameterValue",value:function e(t,i){if(babelHelpers.classPrivateFieldGet(this,or).PARAMETERS[t]){babelHelpers.classPrivateFieldGet(this,or).PARAMETERS[t].Default=i;return true}return false}},{key:"getVariables",value:function e(){var t=this;var i=[];Object.keys(babelHelpers.classPrivateFieldGet(this,or).VARIABLES).forEach((function(e){var a=T.Runtime.clone(babelHelpers.classPrivateFieldGet(t,or).VARIABLES[e]);a.Id=e;a.ObjectId="Variable";a.SystemExpression="{=Variable:".concat(e,"}");a.Expression="{=Variable:".concat(e,"}");i.push(a)}));return i}},{key:"generatePropertyId",value:function e(t,i){var a;for(a=1;a<=1e3;++a){if(!i[t+a]){break}}return t+a}},{key:"collectUsages",value:function e(){var t={Document:new Set,Constant:new Set,Variable:new Set,Parameter:new Set,GlobalConstant:new Set,GlobalVariable:new Set,Activity:new Set};babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){var i=e.collectUsages();Object.keys(t).forEach((function(e){i[e].forEach((function(i){if(!t[e].has(i)){t[e].add(i)}}))}))}));return t}},{key:"subscribeRobotEvents",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){return e.subscribe(t,i)}));return this}},{key:"unsubscribeRobotEvents",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,nr).forEach((function(e){return e.unsubscribe(t,i)}));return this}},{key:"getRobotDescription",value:function e(t){return babelHelpers.classPrivateFieldGet(this,Qa).availableRobots.find((function(e){return e.CLASS===t}))}},{key:"robots",get:function e(){return babelHelpers.classPrivateFieldGet(this,nr)}},{key:"userOptions",get:function e(){return babelHelpers.classPrivateFieldGet(this,er)}},{key:"globalConstants",get:function e(){return babelHelpers.classPrivateFieldGet(this,Qa).automationGlobals?babelHelpers.classPrivateFieldGet(this,Qa).automationGlobals.globalConstants:[]}},{key:"globalVariables",get:function e(){return babelHelpers.classPrivateFieldGet(this,Qa).automationGlobals?babelHelpers.classPrivateFieldGet(this,Qa).automationGlobals.globalVariables:[]}}],[{key:"copyRobotTo",value:function e(t,i,a){var r=i.copyTo(t,a);t.emit("Template:robot:add",{robot:r})}}]);return t}(n.EventEmitter);function br(e){var t=this.getRobotsWithReturnFields().flatMap((function(e){return e.getReturnFieldsDescription().filter((function(e){return e.Type==="user"})).map((function(t){return{id:"{{~".concat(e.getId(),":").concat(t.Id,"}}"),title:"".concat(e.getTitle(),": ").concat(t.Name)}}))}));if(babelHelpers.classPrivateFieldGet(this,Qa).get("showTemplatePropertiesMenuOnSelecting")&&e){var i=this.addConstant(T.Runtime.clone(e));t.push({id:i.Expression,title:T.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT"),tabs:["recents","bpuserroles"],sort:1});var a=this.addParameter(T.Runtime.clone(e));t.push({id:a.Expression,title:T.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER"),tabs:["recents","bpuserroles"],sort:2})}return t}function vr(e){var t=e.isExecuteAfterPrevious()?T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_AFTER_PREVIOUS_TITLE"):T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_PARALLEL_TITLE");var i=e.isExecuteAfterPrevious()?"1":"0";var a=T.Tag.render(Ua||(Ua=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings">\n\t\t\t\t<div class="bizproc-automation-popup-settings-block">\n\t\t\t\t\t<span class="bizproc-automation-popup-settings-title">\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="bizproc-automation-popup-settings-link-wrapper">\n\t\t\t\t\t\t<a ref="executionQueueLink" class="bizproc-automation-popup-settings-link">','</a>\n\t\t\t\t\t</span>\n\t\t\t\t\t<input ref="input" type="hidden" value="','" name="execute_after_previous"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_TITLE"),t,i),r=a.root,s=a.executionQueueLink,l=a.input;T.Event.bind(s,"click",(function(){Fa({bindElement:s,currentValue:l.value,onSubmitButtonClick:function e(t){var i=t.get("execution")==="afterPrevious";T.Dom.adjust(l,{attrs:{value:i?"1":"0"}});T.Dom.adjust(s,{text:i?T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_AFTER_PREVIOUS_TITLE"):T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXECUTION_QUEUE_PARALLEL_TITLE")})}})}));return r}function hr(e){return this.getRobotsWithReturnFields(e).map((function(e){return{id:e.getId(),title:e.getTitle(),fields:h.enrichFieldsWithModifiers(e.getReturnFieldsDescription(),e.getId(),{friendly:false,printable:false,server:false,responsible:false,shortLink:true})}}))}function fr(e,t,i){gr(e,t);t.set(e,i)}function gr(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Tr=new WeakMap;var yr=new WeakMap;var mr=new WeakMap;var Pr=new WeakMap;var Hr=new WeakMap;var Ir=new WeakMap;var Er=new WeakMap;var wr=function(){function e(t){babelHelpers.classCallCheck(this,e);fr(this,Tr,{writable:true,value:void 0});fr(this,yr,{writable:true,value:void 0});fr(this,mr,{writable:true,value:void 0});fr(this,Pr,{writable:true,value:void 0});fr(this,Hr,{writable:true,value:void 0});fr(this,Ir,{writable:true,value:void 0});fr(this,Er,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Tr,t.rawDocumentType);babelHelpers.classPrivateFieldSet(this,yr,t.documentId);babelHelpers.classPrivateFieldSet(this,mr,t.title);babelHelpers.classPrivateFieldSet(this,Pr,t.categoryId);babelHelpers.classPrivateFieldSet(this,Hr,[]);babelHelpers.classPrivateFieldSet(this,Ir,0);if(T.Type.isArray(t.statusList)){babelHelpers.classPrivateFieldSet(this,Hr,t.statusList.map((function(e){e.STATUS_ID=String(e.STATUS_ID);return e})));babelHelpers.classPrivateFieldSet(this,Ir,babelHelpers.classPrivateFieldGet(this,Hr).findIndex((function(e){return e.STATUS_ID===t.statusId})))}else if(T.Type.isStringFilled(t.statusId)){babelHelpers.classPrivateFieldGet(this,Hr).push(t.statusId)}if(babelHelpers.classPrivateFieldGet(this,Ir)<0){babelHelpers.classPrivateFieldSet(this,Ir,0)}babelHelpers.classPrivateFieldSet(this,Er,T.Type.isArray(t.documentFields)?t.documentFields:[])}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e({rawDocumentType:T.Runtime.clone(babelHelpers.classPrivateFieldGet(this,Tr)),documentId:babelHelpers.classPrivateFieldGet(this,yr),categoryId:babelHelpers.classPrivateFieldGet(this,Pr),statusId:this.getCurrentStatusId(),statusList:T.Runtime.clone(babelHelpers.classPrivateFieldGet(this,Hr)),documentFields:T.Runtime.clone(babelHelpers.classPrivateFieldGet(this,Er)),title:babelHelpers.classPrivateFieldGet(this,mr)})}},{key:"getId",value:function e(){return babelHelpers.classPrivateFieldGet(this,yr)}},{key:"getRawType",value:function e(){return babelHelpers.classPrivateFieldGet(this,Tr)}},{key:"getCategoryId",value:function e(){return babelHelpers.classPrivateFieldGet(this,Pr)}},{key:"getCurrentStatusId",value:function e(){var t;var i=(t=babelHelpers.classPrivateFieldGet(this,Hr)[babelHelpers.classPrivateFieldGet(this,Ir)])===null||t===void 0?void 0:t.STATUS_ID;return!T.Type.isNil(i)?String(i):i}},{key:"getSortedStatusId",value:function e(t){if(t>=0&&t<babelHelpers.classPrivateFieldGet(this,Hr).length){return babelHelpers.classPrivateFieldGet(this,Hr)[t].STATUS_ID}return null}},{key:"getNextStatusIdList",value:function e(){return babelHelpers.classPrivateFieldGet(this,Hr).slice(babelHelpers.classPrivateFieldGet(this,Ir)+1).map((function(e){return e.STATUS_ID}))}},{key:"getPreviousStatusIdList",value:function e(){return babelHelpers.classPrivateFieldGet(this,Hr).slice(0,babelHelpers.classPrivateFieldGet(this,Ir)).map((function(e){return e.STATUS_ID}))}},{key:"setStatus",value:function e(t){var i=babelHelpers.classPrivateFieldGet(this,Hr).findIndex((function(e){return e.STATUS_ID===t}));if(i>=0){babelHelpers.classPrivateFieldSet(this,Ir,i)}return this}},{key:"getFields",value:function e(){return babelHelpers.classPrivateFieldGet(this,Er)}},{key:"setFields",value:function e(t){babelHelpers.classPrivateFieldSet(this,Er,t);return this}},{key:"setStatusList",value:function e(t){if(T.Type.isArrayFilled(t)){babelHelpers.classPrivateFieldSet(this,Hr,t)}return this}},{key:"title",get:function e(){return babelHelpers.classPrivateFieldGet(this,mr)}},{key:"statusList",get:function e(){return babelHelpers.classPrivateFieldGet(this,Hr)}}]);return e}();function Fr(e,t,i){Sr(e,t);t.set(e,i)}function Sr(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var _r=new WeakMap;var Or=new WeakMap;var Cr=new WeakMap;var kr=new WeakMap;var Ar=function(){function e(t,i){babelHelpers.classCallCheck(this,e);Fr(this,_r,{writable:true,value:void 0});Fr(this,Or,{writable:true,value:void 0});Fr(this,Cr,{writable:true,value:void 0});Fr(this,kr,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,_r,"Document");babelHelpers.classPrivateFieldSet(this,Or,"");babelHelpers.classPrivateFieldSet(this,Cr,"!empty");babelHelpers.classPrivateFieldSet(this,kr,"");this.parentGroup=null;if(T.Type.isPlainObject(t)){if(t.object){this.setObject(t.object)}if(t.field){this.setField(t.field)}if(t.operator){this.setOperator(t.operator)}if("value"in t){this.setValue(t.value)}}if(i){this.parentGroup=i}}babelHelpers.createClass(e,[{key:"clone",value:function t(){return new e({object:babelHelpers.classPrivateFieldGet(this,_r),field:babelHelpers.classPrivateFieldGet(this,Or),operator:babelHelpers.classPrivateFieldGet(this,Cr),value:babelHelpers.classPrivateFieldGet(this,kr)},this.parentGroup)}},{key:"setObject",value:function e(t){if(T.Type.isStringFilled(t)){babelHelpers.classPrivateFieldSet(this,_r,t)}}},{key:"setField",value:function e(t){if(T.Type.isStringFilled(t)){babelHelpers.classPrivateFieldSet(this,Or,t)}}},{key:"setOperator",value:function e(t){babelHelpers.classPrivateFieldSet(this,Cr,t!==null&&t!==void 0?t:a.Operator.EQUAL)}},{key:"setValue",value:function e(t){babelHelpers.classPrivateFieldSet(this,kr,t);if(babelHelpers.classPrivateFieldGet(this,Cr)===a.Operator.EQUAL&&babelHelpers.classPrivateFieldGet(this,kr)===""){babelHelpers.classPrivateFieldSet(this,Cr,"empty")}else if(babelHelpers.classPrivateFieldGet(this,Cr)===a.Operator.NOT_EQUAL&&babelHelpers.classPrivateFieldGet(this,kr)===""){babelHelpers.classPrivateFieldSet(this,Cr,"!empty")}}},{key:"serialize",value:function e(){return{object:babelHelpers.classPrivateFieldGet(this,_r),field:babelHelpers.classPrivateFieldGet(this,Or),operator:babelHelpers.classPrivateFieldGet(this,Cr),value:babelHelpers.classPrivateFieldGet(this,kr)}}},{key:"object",get:function e(){return babelHelpers.classPrivateFieldGet(this,_r)}},{key:"field",get:function e(){return babelHelpers.classPrivateFieldGet(this,Or)}},{key:"operator",get:function e(){return babelHelpers.classPrivateFieldGet(this,Cr)}},{key:"value",get:function e(){return babelHelpers.classPrivateFieldGet(this,kr)}}]);return e}();function Gr(e,t,i){Mr(e,t);t.set(e,i)}function Mr(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Nr=new WeakMap;var Dr=new WeakMap;var Lr=new WeakMap;var Rr=function(){function e(t){var i=this;babelHelpers.classCallCheck(this,e);Gr(this,Nr,{writable:true,value:void 0});Gr(this,Dr,{writable:true,value:void 0});Gr(this,Lr,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,Nr,e.CONDITION_TYPE.Field);babelHelpers.classPrivateFieldSet(this,Dr,[]);if(T.Type.isPlainObject(t)){if(t.type){babelHelpers.classPrivateFieldSet(this,Nr,t.type)}if(T.Type.isArray(t.items)){t.items.forEach((function(e){var t=new Ar(e[0],i);i.addItem(t,e[1])}))}if(T.Type.isPlainObject(t.activityNames)){babelHelpers.classPrivateFieldSet(this,Lr,t.activityNames)}}}babelHelpers.createClass(e,[{key:"clone",value:function t(){var i=new e({type:babelHelpers.classPrivateFieldGet(this,Nr)});babelHelpers.classPrivateFieldGet(this,Dr).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),a=t[0],r=t[1];var s=a.clone();s.parentGroup=i;i.addItem(s,r)}));return i}},{key:"addItem",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,Dr).push([t,i])}},{key:"getItems",value:function e(){return babelHelpers.classPrivateFieldGet(this,Dr)}},{key:"serialize",value:function e(){var t=[];babelHelpers.classPrivateFieldGet(this,Dr).forEach((function(e){if(e.field!==""){t.push([e[0].serialize(),e[1]])}}));return{type:babelHelpers.classPrivateFieldGet(this,Nr),items:t,activityNames:babelHelpers.classPrivateFieldGet(this,Lr)}}},{key:"conditionNamesList",get:function e(){if(T.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,Lr))){return[babelHelpers.classPrivateFieldGet(this,Lr).Activity,babelHelpers.classPrivateFieldGet(this,Lr).Branch1,babelHelpers.classPrivateFieldGet(this,Lr).Branch2]}return[]}},{key:"type",get:function e(){return babelHelpers.classPrivateFieldGet(this,Nr)},set:function t(i){if(Object.values(e.CONDITION_TYPE).includes(i)){babelHelpers.classPrivateFieldSet(this,Nr,i)}return this}},{key:"items",get:function e(){return babelHelpers.classPrivateFieldGet(this,Dr)}}],[{key:"createFromForm",value:function t(i,r){var s=new e;if(!r){r="condition_"}if(T.Type.isArray(i[r+"field"])){for(var l=0,n=0;l<i[r+"field"].length;++l,++n){if(i[r+"field"][l]===""){continue}var o=new Ar({},s);o.setObject(i[r+"object"][l]);o.setField(i[r+"field"][l]);o.setOperator(i[r+"operator"][l]);var c=o.operator===a.Operator.BETWEEN?[i[r+"value"][n],i[r+"value"][n+1]]:i[r+"value"][n];o.setValue(c);var u=e.JOINER.And;if(i[r+"joiner"]&&i[r+"joiner"][l]===e.JOINER.Or){u=e.JOINER.Or}if(o.operator===a.Operator.BETWEEN){n++}s.addItem(o,u)}}return s}}]);return e}();babelHelpers.defineProperty(Rr,"CONDITION_TYPE",{Field:"field",Mixed:"mixed"});babelHelpers.defineProperty(Rr,"JOINER",{And:"AND",Or:"OR",message:function e(t){if(t===this.Or){return T.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_OR")}return T.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_AND")}});var xr,Br,zr,Ur,Wr,jr,Yr,Vr,Zr,Xr,qr,Jr,Kr,Qr;function $r(e,t){ts(e,t);t.add(e)}function es(e,t,i){ts(e,t);t.set(e,i)}function ts(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function is(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var as=new WeakMap;var rs=new WeakMap;var ss=new WeakMap;var ls=new WeakMap;var ns=new WeakMap;var os=new WeakMap;var cs=new WeakMap;var us=new WeakMap;var ps=new WeakMap;var ds=new WeakMap;var bs=new WeakSet;var vs=new WeakSet;var hs=new WeakSet;var fs=new WeakSet;var gs=new WeakSet;var Ts=function(e){babelHelpers.inherits(t,e);function t(e,i){var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));$r(babelHelpers.assertThisInitialized(a),gs);$r(babelHelpers.assertThisInitialized(a),fs);$r(babelHelpers.assertThisInitialized(a),hs);$r(babelHelpers.assertThisInitialized(a),vs);$r(babelHelpers.assertThisInitialized(a),bs);es(babelHelpers.assertThisInitialized(a),as,{writable:true,value:void 0});es(babelHelpers.assertThisInitialized(a),rs,{writable:true,value:void 0});es(babelHelpers.assertThisInitialized(a),ss,{writable:true,value:void 0});es(babelHelpers.assertThisInitialized(a),ls,{writable:true,value:void 0});es(babelHelpers.assertThisInitialized(a),ns,{writable:true,value:void 0});es(babelHelpers.assertThisInitialized(a),os,{writable:true,value:void 0});es(babelHelpers.assertThisInitialized(a),cs,{writable:true,value:void 0});es(babelHelpers.assertThisInitialized(a),us,{writable:true,value:void 0});es(babelHelpers.assertThisInitialized(a),ps,{writable:true,value:null});es(babelHelpers.assertThisInitialized(a),ds,{writable:true,value:void 0});a.setEventNamespace("BX.Bizproc.Automation.Condition");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),as,e);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),rs,[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ss,h.ConditionGroup.JOINER.And);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ls,"condition_");if(T.Type.isPlainObject(i)){var r;if(T.Type.isArray(i.fields)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),rs,i.fields.map((function(e){e.ObjectId="Document";return e})))}if(i.joiner&&i.joiner===h.ConditionGroup.JOINER.Or){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ss,h.ConditionGroup.JOINER.Or)}if(i.fieldPrefix){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ls,i.fieldPrefix)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ns,i.rootGroupTitle);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),os,i.onOpenFieldMenu);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),cs,i.onOpenMenu);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),us,(r=i.showValuesSelector)!==null&&r!==void 0?r:true)}return a}babelHelpers.createClass(t,[{key:"createNode",value:function e(){var t=T.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,as).value)?babelHelpers.classPrivateFieldGet(this,as).value[0]:babelHelpers.classPrivateFieldGet(this,as).value;var i=is(this,bs,ys).call(this,t);var r=babelHelpers.classPrivateFieldGet(this,as).operator===a.Operator.BETWEEN?is(this,bs,ys).call(this,T.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,as).value)&&babelHelpers.classPrivateFieldGet(this,as).value.length>1?babelHelpers.classPrivateFieldGet(this,as).value[1]:""):"";var s=T.Tag.render(xr||(xr=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings__condition-selector ui-draggable--item">\n\t\t\t\t<div class="bizproc-automation-popup-settings__condition-item">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref="conditionObjectNode"\n\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\tname="','"\n\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t/>\n\t\t\t\t\t<input\n\t\t\t\t\t\tref="conditionFieldNode"\n\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\tname="','"\n\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t/>\n\t\t\t\t\t<input\n\t\t\t\t\t\tref="conditionOperatorNode"\n\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\tname="','"\n\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t/>\n\t\t\t\t\t',"\n\t\t\t\t\t",'\n\t\t\t\t\t<div class="bizproc-automation-popup-settings__condition-item_draggable">\n\t\t\t\t\t\t<div class="ui-icon-set --more-points"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="labelNode"\n\t\t\t\t\t\tclass="bizproc-automation-popup-settings__condition-item_content"\n\t\t\t\t\t></div>\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),T.Text.encode("".concat(babelHelpers.classPrivateFieldGet(this,ls),"object[]")),T.Text.encode(babelHelpers.classPrivateFieldGet(this,as).object),T.Text.encode("".concat(babelHelpers.classPrivateFieldGet(this,ls),"field[]")),T.Text.encode(babelHelpers.classPrivateFieldGet(this,as).field),T.Text.encode("".concat(babelHelpers.classPrivateFieldGet(this,ls),"operator[]")),T.Text.encode(babelHelpers.classPrivateFieldGet(this,as).operator),i,r,is(this,vs,ms).call(this),is(this,hs,Ps).call(this)),l=s.root,n=s.conditionObjectNode,o=s.conditionFieldNode,c=s.conditionOperatorNode,u=s.labelNode;this.node=l;this.objectNode=n;this.fieldNode=o;this.operatorNode=c;this.valueNode=i;babelHelpers.classPrivateFieldSet(this,ps,r===""?null:r);this.labelNode=u;this.setLabelText();this.bindLabelNode();return this.node}},{key:"init",value:function e(t){babelHelpers.classPrivateFieldSet(this,as,t);this.setLabelText();this.bindLabelNode()}},{key:"setLabelText",value:function e(){if(!this.labelNode||!babelHelpers.classPrivateFieldGet(this,as)){return}T.Dom.clean(this.labelNode);if(babelHelpers.classPrivateFieldGet(this,as).field===""){T.Dom.append(T.Tag.render(Br||(Br=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="bizproc-automation-popup-settings__condition-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t"])),T.Text.encode(this.getOperatorLabel(a.Operator.EMPTY))),this.labelNode)}else{var t=this.getField(babelHelpers.classPrivateFieldGet(this,as).object,babelHelpers.classPrivateFieldGet(this,as).field)||"?";var i=is(this,fs,Hs).call(this,t);T.Dom.append(T.Tag.render(zr||(zr=babelHelpers.taggedTemplateLiteral(['<span class="bizproc-automation-popup-settings__condition-text">',"</span>"])),T.Text.encode(t.Name)),this.labelNode);T.Dom.append(T.Tag.render(Ur||(Ur=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<span class="bizproc-automation-popup-settings__condition-text">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t"])),T.Text.encode(this.getOperatorLabel(babelHelpers.classPrivateFieldGet(this,as).operator))),this.labelNode);if(i){T.Dom.append(T.Tag.render(Wr||(Wr=babelHelpers.taggedTemplateLiteral(['<span class="bizproc-automation-popup-settings__condition-text">',"</span>"])),T.Text.encode(i)),this.labelNode)}}}},{key:"bindLabelNode",value:function e(){if(this.labelNode){T.Event.bind(this.labelNode,"click",this.onLabelClick.bind(this))}}},{key:"onLabelClick",value:function e(){this.showPopup()}},{key:"showPopup",value:function e(){var t=this;if(this.popup){this.popup.show();return}var i=this.filterFields();var r=T.Tag.render(jr||(jr=babelHelpers.taggedTemplateLiteral(['<input type="hidden" class="bizproc-automation-popup-settings-dropdown"/>'])));var s=T.Tag.render(Yr||(Yr=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings-dropdown" readonly="readonly">\n\t\t\t\t<input ref="fieldSelect" type="hidden" class="bizproc-automation-popup-settings-dropdown"/>\n\t\t\t</div>\n\t\t']))),l=s.root,n=s.fieldSelect;T.Event.bind(l,"click",this.onFieldSelectorClick.bind(this,l,n,i,r));var u=this.getField(babelHelpers.classPrivateFieldGet(this,as).object,babelHelpers.classPrivateFieldGet(this,as).field);if(!babelHelpers.classPrivateFieldGet(this,as).field){u=i[0]}babelHelpers.classPrivateFieldSet(this,ds,u);n.value=u.Id;r.value=u.ObjectId;l.textContent=u.Name;var p=is(this,gs,Is).call(this,u,babelHelpers.classPrivateFieldGet(this,as).value,babelHelpers.classPrivateFieldGet(this,as).operator);var d=T.Tag.render(Vr||(Vr=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-settings">',"</div>"])),p);var b=this.createOperatorNode(u,d);if(babelHelpers.classPrivateFieldGet(this,as).field!==""){b.value=babelHelpers.classPrivateFieldGet(this,as).operator}var v=T.Tag.render(Zr||(Zr=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<form class="bizproc-automation-popup-select-block">\n\t\t\t\t<div class="bizproc-automation-popup-settings">','</div>\n\t\t\t\t<div ref="operatorWrapper" class="bizproc-automation-popup-settings">',"</div>\n\t\t\t\t","\n\t\t\t</form>\n\t\t"])),l,b,d),h=v.root,f=v.operatorWrapper;T.Event.bind(n,"change",this.onFieldChange.bind(this,n,f,d,r));this.popup=new o.Popup({id:"bizproc-automation-popup-set",bindElement:this.labelNode,content:h,closeByEsc:true,buttons:[new c.Button({color:c.Button.Color.PRIMARY,text:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_CHOOSE_BUTTON_CAPS"),onclick:function e(){babelHelpers.classPrivateFieldGet(t,as).setObject(r.value);babelHelpers.classPrivateFieldGet(t,as).setField(n.value);babelHelpers.classPrivateFieldGet(t,as).setOperator(f.firstChild.value);var i=d.querySelectorAll('[name^="'.concat(babelHelpers.classPrivateFieldGet(t,ls),'value"]'));if(i.length>0){var s=i[i.length-1].value;if(babelHelpers.classPrivateFieldGet(t,as).operator===a.Operator.BETWEEN&&i.length>1){s=[i[0].value,i[1].value]}babelHelpers.classPrivateFieldGet(t,as).setValue(s)}else{babelHelpers.classPrivateFieldGet(t,as).setValue("")}t.setLabelText();var l=t.getField(babelHelpers.classPrivateFieldGet(t,as).object,babelHelpers.classPrivateFieldGet(t,as).field);if(l&&l.Type==="UF:address"){var o=d.querySelector('[name="'.concat(babelHelpers.classPrivateFieldGet(t,ls),'value"]'));babelHelpers.classPrivateFieldGet(t,as).setValue(o?o.value:"")}t.updateValueNode();t.popup.close()}}),new c.CancelButton({text:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_CANCEL_BUTTON_CAPS"),onclick:function e(){t.popup.close()}})],className:"bizproc-automation-popup-set",closeIcon:false,autoHide:false,events:{onClose:function e(){t.popup.destroy();if(t.fieldDialog){t.fieldDialog.destroy();delete t.fieldDialog}delete t.popup}},titleBar:false,angle:true,overlay:{backgroundColor:"transparent"},offsetLeft:45});this.popup.show()}},{key:"onFieldSelectorClick",value:function e(t,i,a,r,s){if(!this.fieldDialog){var l=h.getGlobalContext();var n=T.Runtime.clone(T.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,rs))?babelHelpers.classPrivateFieldGet(this,rs):l.document.getFields());this.fieldDialog=new h.InlineSelectorCondition({context:new h.SelectorContext({fields:n,rootGroupTitle:l.document.title}),condition:babelHelpers.classPrivateFieldGet(this,as)});if(T.Type.isFunction(babelHelpers.classPrivateFieldGet(this,os))){this.fieldDialog.subscribe("onOpenMenu",babelHelpers.classPrivateFieldGet(this,os))}this.fieldDialog.subscribe("change",(function(e){var a=e.getData().field;t.textContent=a.Name;i.value=a.Id;r.value=a.ObjectId;BX.fireEvent(i,"change")}));this.fieldDialog.renderTo(t)}this.fieldDialog.openMenu(s)}},{key:"updateValueNode",value:function e(){if(babelHelpers.classPrivateFieldGet(this,as)){if(this.objectNode){this.objectNode.value=babelHelpers.classPrivateFieldGet(this,as).object}if(this.fieldNode){this.fieldNode.value=babelHelpers.classPrivateFieldGet(this,as).field}if(this.operatorNode){this.operatorNode.value=babelHelpers.classPrivateFieldGet(this,as).operator}if(this.valueNode){this.valueNode.value=T.Type.isArrayFilled(babelHelpers.classPrivateFieldGet(this,as).value)?babelHelpers.classPrivateFieldGet(this,as).value[0]:babelHelpers.classPrivateFieldGet(this,as).value}if(babelHelpers.classPrivateFieldGet(this,as).operator===a.Operator.BETWEEN){var t=babelHelpers.classPrivateFieldGet(this,as).value[1]||"";if(babelHelpers.classPrivateFieldGet(this,ps)){babelHelpers.classPrivateFieldGet(this,ps).value=t}else{babelHelpers.classPrivateFieldSet(this,ps,is(this,bs,ys).call(this,t));T.Dom.append(babelHelpers.classPrivateFieldGet(this,ps),this.node)}}else if(T.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,ps))){T.Dom.remove(babelHelpers.classPrivateFieldGet(this,ps));babelHelpers.classPrivateFieldSet(this,ps,null)}}}},{key:"onFieldChange",value:function e(t,i,a,r){var s;var l=this.getField(r.value,t.value);var n=this.createOperatorNode(l,a);if(l.Type!==((s=babelHelpers.classPrivateFieldGet(this,ds))===null||s===void 0?void 0:s.Type)){T.Dom.clean(a)}babelHelpers.classPrivateFieldSet(this,ds,l);if(this.getOperators(l.Type,l.Multiple)[i.firstChild.value]){n.value=i.firstChild.value}i.replaceChild(n,i.firstChild);this.onOperatorChange(n,l,a)}},{key:"onOperatorChange",value:function e(t,i,a){var r=a.querySelector('[name^="'.concat(babelHelpers.classPrivateFieldGet(this,ls),'value"]'));T.Dom.clean(a);T.Dom.append(is(this,gs,Is).call(this,i,(r===null||r===void 0?void 0:r.value)||babelHelpers.classPrivateFieldGet(this,as).value,t.value),a)}},{key:"getField",value:function e(t,i){var a;var r=h.Designer.getInstance().robot;var s=h.Designer.getInstance().component;var l=r?r.getTemplate():null;switch(t){case"Document":for(var n=0;n<babelHelpers.classPrivateFieldGet(this,rs).length;++n){if(i===babelHelpers.classPrivateFieldGet(this,rs)[n].Id){a=babelHelpers.classPrivateFieldGet(this,rs)[n]}}break;case"Template":if(l&&s&&s.triggerManager){a=s.triggerManager.getReturnProperty(l.getStatusId(),i)}break;case"Constant":if(l){a=l.getConstant(i)}break;case"GlobalConst":if(s){a=s.getConstant(i)}break;case"GlobalVar":if(s){a=s.getGVariable(i)}break;default:var o=l?l.getRobotById(t):null;if(o){a=o.getReturnProperty(i)}break}return a||{Id:i,ObjectId:t,Name:i,Type:"string",Expression:i,SystemExpression:"{=".concat(t,":").concat(i,"}")}}},{key:"getOperators",value:function e(t,i){var r=a.Operator.getAllLabels();var s={"!empty":r[a.Operator.NOT_EMPTY],empty:r[a.Operator.EMPTY],"=":r[a.Operator.EQUAL],"!=":r[a.Operator.NOT_EQUAL]};switch(t){case"file":case"UF:crm":case"UF:resourcebooking":case"email":case"phone":case"web":case"im":s={"!empty":r[a.Operator.NOT_EMPTY],empty:r[a.Operator.EMPTY]};break;case"bool":case"select":if(i){s[a.Operator.CONTAIN]=r[a.Operator.CONTAIN];s[a.Operator.NOT_CONTAIN]=r[a.Operator.NOT_CONTAIN]}break;case"user":s[a.Operator.IN]=r[a.Operator.IN];s[a.Operator.NOT_IN]=r[a.Operator.NOT_IN];s[a.Operator.CONTAIN]=r[a.Operator.CONTAIN];s[a.Operator.NOT_CONTAIN]=r[a.Operator.NOT_CONTAIN];break;default:s[a.Operator.IN]=r[a.Operator.IN];s[a.Operator.NOT_IN]=r[a.Operator.NOT_IN];s[a.Operator.CONTAIN]=r[a.Operator.CONTAIN];s[a.Operator.NOT_CONTAIN]=r[a.Operator.NOT_CONTAIN];s[a.Operator.GREATER_THEN]=r[a.Operator.GREATER_THEN];s[a.Operator.GREATER_THEN_OR_EQUAL]=r[a.Operator.GREATER_THEN_OR_EQUAL];s[a.Operator.LESS_THEN]=r[a.Operator.LESS_THEN];s[a.Operator.LESS_THEN_OR_EQUAL]=r[a.Operator.LESS_THEN_OR_EQUAL]}if(["time","date","datetime","int","double"].includes(t)||T.Type.isUndefined(t)){s[a.Operator.BETWEEN]=r[a.Operator.BETWEEN]}return s}},{key:"getOperatorLabel",value:function e(t){return a.Operator.getOperatorLabel(t)}},{key:"filterFields",value:function e(){var t=[];for(var i=0;i<babelHelpers.classPrivateFieldGet(this,rs).length;++i){var a=babelHelpers.classPrivateFieldGet(this,rs)[i].Type;if(a==="bool"||a==="date"||a==="datetime"||a==="double"||a==="file"||a==="int"||a==="select"||a==="string"||a==="text"||a==="user"||a==="UF:money"||a==="UF:crm"||a==="UF:resourcebooking"||a==="UF:url"){t.push(babelHelpers.classPrivateFieldGet(this,rs)[i])}}return t}},{key:"createValueNode",value:function e(t,i){var a=this;var r=h.Designer.getInstance().component?h.Designer.getInstance().component.document:h.getGlobalContext().document;var s=[].concat(babelHelpers.toConsumableArray(r.getRawType()),[r.getCategoryId()]);var l=T.Runtime.clone(t);l.Multiple=false;var n=BX.Bizproc.FieldType.renderControlPublic(s,l,"".concat(babelHelpers.classPrivateFieldGet(this,ls),"value"),i,false);n.querySelectorAll("[data-role]").forEach((function(e){var t;var i=h.SelectorManager.createSelectorByRole(e.dataset.role,{context:new h.SelectorContext({fields:h.getGlobalContext().document.getFields(),useSwitcherMenu:false,rootGroupTitle:(t=babelHelpers.classPrivateFieldGet(a,ns))!==null&&t!==void 0?t:h.getGlobalContext().document.title})});if(i){if(babelHelpers.classPrivateFieldGet(a,us)===true){if(T.Type.isFunction(babelHelpers.classPrivateFieldGet(a,cs))){i.subscribe("onOpenMenu",babelHelpers.classPrivateFieldGet(a,cs))}i.renderTo(e)}else{i.targetInput=e;i.parseTargetProperties()}}}));return n}},{key:"createOperatorNode",value:function e(t,i){var a=T.Dom.create("select",{attrs:{className:"bizproc-automation-popup-settings-dropdown"}});var r=this.getOperators(t.Type,t.Multiple);for(var s in r){if(!r.hasOwnProperty(s)){continue}T.Dom.append(T.Tag.render(Xr||(Xr=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<option value="','">',"</option>\n\t\t\t\t"])),T.Text.encode(s),T.Text.encode(r[s])),a)}T.Event.bind(a,"change",this.onOperatorChange.bind(this,a,t,i));return a}},{key:"removeCondition",value:function e(t){this.emit("onRemoveConditionClick",new n.BaseEvent({data:{conditionSelector:this}}));babelHelpers.classPrivateFieldSet(this,as,null);T.Dom.remove(this.node);this.labelNode=null;this.fieldNode=null;this.operatorNode=null;this.valueNode=null;babelHelpers.classPrivateFieldSet(this,ps,null);this.node=null;t.stopPropagation()}},{key:"changeJoiner",value:function e(t,i){}},{key:"destroy",value:function e(){if(this.popup){this.popup.close()}}}]);return t}(n.EventEmitter);function ys(e){return T.Tag.render(qr||(qr=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input\n\t\t\t\ttype="hidden"\n\t\t\t\tname="','"\n\t\t\t\tvalue="','"\n\t\t\t>\n\t\t'])),T.Text.encode("".concat(babelHelpers.classPrivateFieldGet(this,ls),"value[]")),T.Text.encode(e))}function ms(){var e=T.Tag.render(Jr||(Jr=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings__condition-item_close">\n\t\t\t\t<div ref="removeButtonNode" class="ui-icon-set --cross-20"></div>\n\t\t\t</div>\n\t\t']))),t=e.root,i=e.removeButtonNode;T.Event.bind(i,"click",this.removeCondition.bind(this));return t}function Ps(){var e=this;var t=T.Tag.render(Kr||(Kr=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings__condition-switcher">\n\t\t\t\t<div class="bizproc-automation-popup-settings__condition-switcher_wrapper">\n\t\t\t\t\t<span\n\t\t\t\t\t\tref="switcherBtnAnd"\n\t\t\t\t\t\tclass="bizproc-automation-popup-settings__condition-switcher_btn ','"\n\t\t\t\t\t>\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tref="switcherBtnOr"\n\t\t\t\t\t\tclass="bizproc-automation-popup-settings__condition-switcher_btn ','"\n\t\t\t\t\t>\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<input\n\t\t\t\t\tref="inputNode"\n\t\t\t\t\ttype="hidden"\n\t\t\t\t\tname="','"\n\t\t\t\t\tvalue="','"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t'])),babelHelpers.classPrivateFieldGet(this,ss)==="AND"?"--active":"",T.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_AND"),babelHelpers.classPrivateFieldGet(this,ss)==="OR"?"--active":"",T.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_OR"),T.Text.encode("".concat(babelHelpers.classPrivateFieldGet(this,ls),"joiner[]")),T.Text.encode(babelHelpers.classPrivateFieldGet(this,ss))),i=t.root,a=t.switcherBtnAnd,r=t.switcherBtnOr,s=t.inputNode;this.joinerNode=s;T.Event.bind(i,"click",(function(){babelHelpers.classPrivateFieldSet(e,ss,babelHelpers.classPrivateFieldGet(e,ss)===h.ConditionGroup.JOINER.Or?h.ConditionGroup.JOINER.And:h.ConditionGroup.JOINER.Or);if(e.joinerNode){e.joinerNode.value=babelHelpers.classPrivateFieldGet(e,ss)}T.Dom.toggleClass(r,"--active");T.Dom.toggleClass(a,"--active")}));return i}function Hs(e){var t=babelHelpers.classPrivateFieldGet(this,as).operator;var i=babelHelpers.classPrivateFieldGet(this,as).value;if(t==="between"){return T.Loc.getMessage("BIZPROC_AUTOMATION_ROBOT_CONDITION_BETWEEN_VALUE_1",{"#VALUE_1#":BX.Bizproc.FieldType.formatValuePrintable(e,T.Type.isArrayFilled(i)?i[0]:i),"#VALUE_2#":BX.Bizproc.FieldType.formatValuePrintable(e,T.Type.isArrayFilled(i)?i[1]:"")})}if(!t.includes("empty")){return BX.Bizproc.FieldType.formatValuePrintable(e,i)}return null}function Is(e,t,i){if(i===a.Operator.BETWEEN){return T.Tag.render(Qr||(Qr=babelHelpers.taggedTemplateLiteral(["\n\t\t\t\t<div>\n\t\t\t\t\t",'\n\t\t\t\t\t<div style="height: 8px;"></div>\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t"])),this.createValueNode(e,T.Type.isArrayFilled(t)?t[0]:t),this.createValueNode(e,T.Type.isArrayFilled(t)?t[1]:""))}if(!i.includes("empty")){return this.createValueNode(e,t)}return""}var Es;function ws(e,t){Ss(e,t);t.add(e)}function Fs(e,t,i){Ss(e,t);t.set(e,i)}function Ss(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _s(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Os=new WeakMap;var Cs=new WeakMap;var ks=new WeakMap;var As=new WeakMap;var Gs=new WeakMap;var Ms=new WeakMap;var Ns=new WeakMap;var Ds=new WeakMap;var Ls=new WeakMap;var Rs=new WeakMap;var xs=new WeakMap;var Bs=new WeakSet;var zs=new WeakSet;var Us=new WeakSet;var Ws=function(e){babelHelpers.inherits(t,e);function t(e,i){var a;babelHelpers.classCallCheck(this,t);a=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));ws(babelHelpers.assertThisInitialized(a),Us);ws(babelHelpers.assertThisInitialized(a),zs);ws(babelHelpers.assertThisInitialized(a),Bs);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(a),"modern",true);Fs(babelHelpers.assertThisInitialized(a),Os,{writable:true,value:void 0});Fs(babelHelpers.assertThisInitialized(a),Cs,{writable:true,value:void 0});Fs(babelHelpers.assertThisInitialized(a),ks,{writable:true,value:void 0});Fs(babelHelpers.assertThisInitialized(a),As,{writable:true,value:void 0});Fs(babelHelpers.assertThisInitialized(a),Gs,{writable:true,value:void 0});Fs(babelHelpers.assertThisInitialized(a),Ms,{writable:true,value:void 0});Fs(babelHelpers.assertThisInitialized(a),Ns,{writable:true,value:void 0});Fs(babelHelpers.assertThisInitialized(a),Ds,{writable:true,value:void 0});Fs(babelHelpers.assertThisInitialized(a),Ls,{writable:true,value:{}});Fs(babelHelpers.assertThisInitialized(a),Rs,{writable:true,value:void 0});Fs(babelHelpers.assertThisInitialized(a),xs,{writable:true,value:void 0});a.setEventNamespace("BX.Bizproc.Automation.Condition");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Os,e);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Cs,[]);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ks,"condition_");babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),As,[]);if(T.Type.isPlainObject(i)){var r;if(T.Type.isArray(i.fields)){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Cs,i.fields)}if(i.fieldPrefix){babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),ks,i.fieldPrefix)}babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Ds,i.rootGroupTitle);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Gs,i.onOpenFieldMenu);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Ms,i.onOpenMenu);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Ns,(r=i.showValuesSelector)!==null&&r!==void 0?r:true);babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(a),Ls,i)}return a}babelHelpers.createClass(t,[{key:"createNode",value:function e(){var t=this,i,a,r;babelHelpers.classPrivateFieldGet(this,Os).getItems().forEach((function(e){var i=new Ts(e[0],{fields:babelHelpers.classPrivateFieldGet(t,Cs),joiner:e[1],fieldPrefix:babelHelpers.classPrivateFieldGet(t,ks),rootGroupTitle:babelHelpers.classPrivateFieldGet(t,Ds),onOpenFieldMenu:babelHelpers.classPrivateFieldGet(t,Gs),onOpenMenu:babelHelpers.classPrivateFieldGet(t,Ms),showValuesSelector:babelHelpers.classPrivateFieldGet(t,Ns)});i.subscribe("onRemoveConditionClick",_s(t,Us,Vs).bind(t));babelHelpers.classPrivateFieldGet(t,As).push(i)}));var s=babelHelpers.classPrivateFieldGet(this,Os).items.length>0;var l=babelHelpers.classPrivateFieldGet(this,Ls).isExpanded!==true&&s;var n=l?T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXPAND_CONDITION"):T.Loc.getMessage("BIZPROC_JS_AUTOMATION_COLLAPSE_CONDITION");var o=T.Tag.render(Es||(Es=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings">\n\t\t\t\t<div\n\t\t\t\t\tref="conditionContent"\n\t\t\t\t\tclass="bizproc-automation-popup-settings__condition-content ','"\n\t\t\t\t>\n\t\t\t\t\t<div class="bizproc-automation-popup-settings__condition-header">\n\t\t\t\t\t\t<span class="bizproc-automation-popup-settings-title">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tref="btnToggleList"\n\t\t\t\t\t\t\tclass="bizproc-automation-popup-settings__btn-toggle ','"\n\t\t\t\t\t\t\tdata-role="condition-toggle"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span ref="btnTextNode" class="bizproc-automation-popup-settings-title">\n\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<div class="ui-icon-set --chevron-down" style="--ui-icon-set__icon-size: 16px;"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bizproc-automation-popup-settings__transition-height-wrapper">\n\t\t\t\t\t\t<div class="bizproc-automation-popup-settings__transition-height-content">\n\t\t\t\t\t\t\t<div class="bizproc-automation-popup-settings__condition-body">\n\t\t\t\t\t\t\t\t<div ref="draggableNode" class="bizproc-automation-popup-settings__condition">\n\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span class="bizproc-automation-popup-settings-link-wrapper">\n\t\t\t\t\t\t\t\t\t<a ref="addButton" class="bizproc-automation-popup-settings-link">\n\t\t\t\t\t\t\t\t\t\t','\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bizproc-automation-popup-settings__transition-height-wrapper --revert">\n\t\t\t\t\t\t<div class="bizproc-automation-popup-settings__transition-height-content">\n\t\t\t\t\t\t\t<div class="bizproc-automation-popup-settings__condition-help">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),l?"":"--active",T.Text.encode((i=babelHelpers.classPrivateFieldGet(this,Ls).caption)===null||i===void 0?void 0:i.head),s?"":"--disabled",n,babelHelpers.classPrivateFieldGet(this,As).map((function(e){return e.createNode()})),T.Text.encode(((a=babelHelpers.classPrivateFieldGet(this,Ls).caption)===null||a===void 0?void 0:a.add)||T.Loc.getMessage("BIZPROC_JS_AUTOMATION_ADD_CONDITION")),T.Text.encode(((r=babelHelpers.classPrivateFieldGet(this,Ls).caption)===null||r===void 0?void 0:r.collapsed)||T.Loc.getMessage("BIZPROC_JS_AUTOMATION_CONDITION_COLLAPSED_TITLE_1"))),c=o.root,u=o.conditionContent,p=o.btnToggleList,d=o.btnTextNode,b=o.addButton,v=o.draggableNode;babelHelpers.classPrivateFieldSet(this,Rs,p);babelHelpers.classPrivateFieldSet(this,xs,v);T.Event.bind(p,"click",_s(this,Bs,js).bind(this,u,d));T.Event.bind(b,"click",this.addItem.bind(this));_s(this,zs,Ys).call(this);return c}},{key:"addItem",value:function e(){var t=new Ts(new h.Condition({},babelHelpers.classPrivateFieldGet(this,Os)),{fields:babelHelpers.classPrivateFieldGet(this,Cs),fieldPrefix:babelHelpers.classPrivateFieldGet(this,ks),rootGroupTitle:babelHelpers.classPrivateFieldGet(this,Ds),onOpenFieldMenu:babelHelpers.classPrivateFieldGet(this,Gs),onOpenMenu:babelHelpers.classPrivateFieldGet(this,Ms),showValuesSelector:babelHelpers.classPrivateFieldGet(this,Ns)});t.subscribe("onRemoveConditionClick",_s(this,Us,Vs).bind(this));babelHelpers.classPrivateFieldGet(this,As).push(t);T.Dom.append(t.createNode(),babelHelpers.classPrivateFieldGet(this,xs));if(T.Dom.hasClass(babelHelpers.classPrivateFieldGet(this,Rs),"--disabled")){T.Dom.removeClass(babelHelpers.classPrivateFieldGet(this,Rs),"--disabled")}}},{key:"destroy",value:function e(){babelHelpers.classPrivateFieldGet(this,As).forEach((function(e){return e.destroy()}));babelHelpers.classPrivateFieldSet(this,As,[])}}]);return t}(n.EventEmitter);function js(e,t){T.Dom.toggleClass(e,"--active");var i=T.Dom.hasClass(e,"--active");T.Dom.adjust(t,{text:i?T.Loc.getMessage("BIZPROC_JS_AUTOMATION_COLLAPSE_CONDITION"):T.Loc.getMessage("BIZPROC_JS_AUTOMATION_EXPAND_CONDITION")});this.emit("onToggleGroupViewClick",new n.BaseEvent({data:{isCollapsed:!i,isExpanded:i}}))}function Ys(){new s.Draggable({container:babelHelpers.classPrivateFieldGet(this,xs),type:s.Draggable.CLONE,draggable:".bizproc-automation-popup-settings__condition-selector",dragElement:".bizproc-automation-popup-settings__condition-item_draggable"})}function Vs(e){var t=e.getData().conditionSelector;if(t){var i=babelHelpers.classPrivateFieldGet(this,As).indexOf(t);if(i>-1){babelHelpers.classPrivateFieldGet(this,As).splice(i,1)}}if(babelHelpers.classPrivateFieldGet(this,As).length<=0&&!T.Dom.hasClass(babelHelpers.classPrivateFieldGet(this,Rs),"--disabled")){T.Dom.addClass(babelHelpers.classPrivateFieldGet(this,Rs),"--disabled")}}function Zs(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Xs(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Zs(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Zs(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var qs=function e(t,i,a,r){var s="{=".concat(a,":").concat(t.Id," ").concat(r,"}");var l=t.Expression;if(l.startsWith("{{")&&l.endsWith("}}")){l=l.replace(/^{{/,"").replace(/}}$/,"");if(l.includes("#")){l=l.slice(0,l.indexOf("#"))}l="{{".concat(l," ").concat(r,"}}")}else{l=s}return Xs(Xs(Xs({},T.Runtime.clone(t)),i),{},{ObjectId:a,Type:"string",SystemExpression:s,Expression:l})};var Js={friendly:"> friendly",printable:"> printable",server:"> server",responsible:"> responsible",shortLink:"> shortlink"};function Ks(e,t,i){var a=function e(t){return T.Type.isNil(t)||t===true};var r=T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_PRINTABLE_PREFIX");var s=e.map((function(e){return e.Name})).join("\n");var l=[];e.forEach((function(e){var n="".concat(e.Name," ").concat(r);var o=e.BaseType==="string"&&e.Type!=="string";if(!o){l.push(Xs(Xs({},T.Runtime.clone(e)),{},{ObjectId:t}))}if(e.Type==="user"&&a(i===null||i===void 0?void 0:i.friendly)&&!s.includes(n)){l.push(qs(e,{Name:n},t,Js.friendly))}if((["bool","file"].includes(e.Type)||o)&&a(i===null||i===void 0?void 0:i.printable)&&!s.includes(n)){l.push(qs(e,{Name:n},t,Js.printable))}if(["date","datetime","time"].includes(e.BaseType)){if(a(i===null||i===void 0?void 0:i.server)){var c="".concat(e.Name," ").concat(T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_DATE_BY_SERVER"));l.push(qs(e,{Name:c},t,Js.server))}if(a(i===null||i===void 0?void 0:i.responsible)){var u="".concat(e.Name," ").concat(T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_MOD_DATE_BY_RESPONSIBLE"));l.push(qs(e,{Name:u},t,Js.responsible))}}if(e.Type==="file"&&a(i===null||i===void 0?void 0:i.shortLink)){l.push(qs(e,{Id:"".concat(e.Id,"_shortlink")},t,Js.shortLink))}}));return l}function Qs(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function $s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Qs(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Qs(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function el(e,t){il(e,t);t.add(e)}function tl(e,t,i){il(e,t);t.set(e,i)}function il(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function al(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var rl=new WeakMap;var sl=new WeakMap;var ll=new WeakMap;var nl=new WeakSet;var ol=function(){function e(t){babelHelpers.classCallCheck(this,e);el(this,nl);tl(this,rl,{writable:true,value:[]});tl(this,sl,{writable:true,value:{}});tl(this,ll,{writable:true,value:void 0});if(this.constructor===e){throw new Error("Object of Abstract Class cannot be created")}if(!T.Type.isArray(t.fields)){throw new TypeError("fields must be an array")}babelHelpers.classPrivateFieldSet(this,ll,T.Type.isBoolean(t.setSuperTitle)?t.setSuperTitle:true)}babelHelpers.createClass(e,[{key:"addGroup",value:function e(t,i){babelHelpers.classPrivateFieldGet(this,sl)[t]=al(this,nl,cl).call(this,i)}},{key:"hasGroup",value:function e(t){return Object.hasOwn(babelHelpers.classPrivateFieldGet(this,sl),t)}},{key:"addGroupItem",value:function e(t,i){if(this.hasGroup(t)){var a=al(this,nl,cl).call(this,i,babelHelpers.classPrivateFieldGet(this,sl)[t].title);babelHelpers.classPrivateFieldGet(this,sl)[t].children.push(a)}}},{key:"items",get:function e(){return babelHelpers.classPrivateFieldGet(this,rl)}},{key:"groups",get:function e(){return Object.values(babelHelpers.classPrivateFieldGet(this,sl))}},{key:"groupsWithChildren",get:function e(){return this.groups.filter((function(e){return e.children.length>0}))}}]);return e}();function cl(e){var t=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var a=T.Runtime.clone(e);if(!T.Type.isBoolean(a.searchable)){a.searchable=true}if(!T.Type.isArray(a.children)){a.children=[]}a.children=a.children.map((function(e){return al(t,nl,cl).call(t,e,a.title)}));if(babelHelpers.classPrivateFieldGet(this,ll)&&T.Type.isStringFilled(i)&&!T.Type.isStringFilled(a.supertitle)){a.supertitle=i}if(!T.Type.isArrayFilled(a.children)&&a.searchable===true){babelHelpers.classPrivateFieldGet(this,rl).push(a)}return $s({entityId:"bp",tabs:"recents"},a)}var ul=function e(){babelHelpers.classCallCheck(this,e)};babelHelpers.defineProperty(ul,"DOCUMENT","ROOT");babelHelpers.defineProperty(ul,"FILES","__FILES");babelHelpers.defineProperty(ul,"VARIABLES","__GLOB_VARIABLES");babelHelpers.defineProperty(ul,"CONSTANTS","__CONSTANTS");babelHelpers.defineProperty(ul,"ACTIVITY_RESULT","__RESULT");babelHelpers.defineProperty(ul,"TRIGGER_RESULT","__TRESULT");function pl(e,t){dl(e,t);t.add(e)}function dl(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function bl(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var vl=new WeakSet;var hl=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));pl(babelHelpers.assertThisInitialized(i),vl);if(!T.Type.isStringFilled(e.title)){throw new TypeError("title must be filled string")}bl(babelHelpers.assertThisInitialized(i),vl,fl).call(babelHelpers.assertThisInitialized(i),e.fields,e.title);return i}return t}(ol);function fl(e,t){var i=this;var a=ul.DOCUMENT;this.addGroup(a,{id:a,title:t,searchable:false});e.forEach((function(e){var t=e.Id.includes(".")?e.Id.split(".")[0]:a;var r="";var s=e.Name;if(e.Name&&t!==a&&e.Name.includes(": ")){var l=e.Name.split(": ");r=l.shift();s=l.join(": ")}if(e.Id.startsWith("ASSIGNED_BY_")&&e.Id!=="ASSIGNED_BY_ID"&&e.Id!=="ASSIGNED_BY_PRINTABLE"){t="ASSIGNED_BY";var n=e.Name.split(" ");r=n.shift();s=n.join(" ").replace("(","").replace(")","")}if(!i.hasGroup(t)){i.addGroup(t,{id:t,title:r,searchable:false})}i.addGroupItem(t,{id:e.SystemExpression,title:s||e.Id,customData:{field:e}})}))}function gl(e,t){Tl(e,t);t.add(e)}function Tl(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function yl(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var ml=new WeakSet;var Pl=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));gl(babelHelpers.assertThisInitialized(i),ml);yl(babelHelpers.assertThisInitialized(i),ml,Hl).call(babelHelpers.assertThisInitialized(i),e.fields);return i}return t}(ol);function Hl(e){var t=this;var i=ul.FILES;this.addGroup(i,{id:i,title:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_FILES_LINKS"),searchable:false});e.forEach((function(e){var a=e.Name||e.Id;if(T.Type.isStringFilled(e.ObjectName)){a="".concat(e.ObjectName,": ").concat(a)}t.addGroupItem(i,{id:e.SystemExpression,title:a,customData:{field:e}})}))}var Il,El;function wl(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Fl(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?wl(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):wl(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Sl(e,t){Ol(e,t);t.add(e)}function _l(e,t,i){Ol(e,t);t.set(e,i)}function Ol(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Cl(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var kl=new WeakMap;var Al=new WeakMap;var Gl=new WeakMap;var Ml=new WeakSet;var Nl=new WeakSet;var Dl=new WeakSet;var Ll=new WeakSet;var Rl=new WeakSet;var xl=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));Sl(babelHelpers.assertThisInitialized(i),Rl);Sl(babelHelpers.assertThisInitialized(i),Ll);Sl(babelHelpers.assertThisInitialized(i),Dl);Sl(babelHelpers.assertThisInitialized(i),Nl);Sl(babelHelpers.assertThisInitialized(i),Ml);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"fieldProperty",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"replaceOnWrite",false);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"menuButton",null);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"targetInput",null);_l(babelHelpers.assertThisInitialized(i),kl,{writable:true,value:{}});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(i),"basisFields",[]);_l(babelHelpers.assertThisInitialized(i),Al,{writable:true,value:null});_l(babelHelpers.assertThisInitialized(i),Gl,{writable:true,value:null});i.setEventNamespace("BX.Bizproc.Automation.Selector");i.context=e.context;i.basisFields=i.context.fields;return i}babelHelpers.createClass(t,[{key:"hasGroup",value:function e(t){return babelHelpers.classPrivateFieldGet(this,kl).hasOwnProperty(t)}},{key:"addGroup",value:function e(t,i){var a=Cl(this,Nl,zl).call(this,i);if(this.hasGroup(t)){babelHelpers.classPrivateFieldGet(this,kl)[t]=Cl(this,Nl,zl).call(this,Cl(this,Ml,Bl).call(this,babelHelpers.classPrivateFieldGet(this,kl)[t],a));return}babelHelpers.classPrivateFieldGet(this,kl)[t]=a}},{key:"addGroupItem",value:function e(t,i){if(this.hasGroup(t)){babelHelpers.classPrivateFieldGet(this,kl)[t].children.push(Cl(this,Nl,zl).call(this,i))}}},{key:"renderWith",value:function e(t){this.targetInput=T.Runtime.clone(t);this.targetInput.setAttribute("autocomplete","off");this.menuButton=T.Tag.render(Il||(Il=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span \n\t\t\t\tonclick="','"\n\t\t\t\tclass="bizproc-automation-popup-select-dotted"\n\t\t\t></span>\n\t\t'])),this.openMenu.bind(this));this.parseTargetProperties();this.replaceOnWrite|=this.targetInput.getAttribute("data-select-mode")==="replace";return T.Tag.render(El||(El=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-select">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this.targetInput,this.menuButton)}},{key:"renderTo",value:function e(t){t.parentNode.replaceChild(this.renderWith(t),t)}},{key:"bindTargetEvents",value:function e(){T.Event.bind(this.targetInput,"keydown",Cl(this,Rl,jl).bind(this))}},{key:"parseTargetProperties",value:function e(){this.fieldProperty=JSON.parse(this.targetInput.getAttribute("data-property"));var t=this.targetInput.getAttribute("data-selector-type");if(!this.fieldProperty&&t){this.fieldProperty={Type:t}}if(this.fieldProperty){this.fieldProperty.Type=this.fieldProperty.Type||t;Cl(this,Dl,Ul).call(this)}else{this.context.useSwitcherMenu=false}this.replaceOnWrite|=this.targetInput.getAttribute("data-select-mode")==="replace"}},{key:"openMenu",value:function e(t){var i=this;var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!a&&this.context.useSwitcherMenu&&!this.targetInput.value){return this.openPropertiesSwitcherMenu()}if(babelHelpers.classPrivateFieldGet(this,Al)){babelHelpers.classPrivateFieldGet(this,Al).show();return}this.fillGroups();this.onMenuOpen();var r=[];for(var s=0,n=Object.values(babelHelpers.classPrivateFieldGet(this,kl));s<n.length;s++){var o=n[s];if(o.children.length>0){r.push(o)}}if(r.length===1){r=r[0].children}var c=this.menuButton.getAttribute("data-selector-id");if(!c){c=h.Helper.generateUniqueId();this.menuButton.setAttribute("data-selector-id",c)}babelHelpers.classPrivateFieldSet(this,Al,new l.Dialog({targetNode:this.menuButton,width:500,height:300,multiple:false,dropdownMode:true,enableSearch:true,items:this.injectDialogMenuTitles(r),showAvatars:false,events:{"Item:onBeforeSelect":function e(t){t.preventDefault();var a=t.getData().item;i.onFieldSelect(a.getCustomData().get("field"))}},compactView:true}));babelHelpers.classPrivateFieldGet(this,Al).show()}},{key:"fillGroups",value:function e(){this.fillFieldsGroups();this.fillFileGroup()}},{key:"fillFieldsGroups",value:function e(){var t=this;var i=new hl({fields:this.getFields(),title:this.context.rootGroupTitle,setSuperTitle:false});i.groupsWithChildren.forEach((function(e){t.addGroup(e.id,e)}))}},{key:"fillFileGroup",value:function e(){var t=this;var i=this.getFields().filter((function(e){return e.Type==="file"}));var a=new Pl({fields:Ks(i,"Document",{friendly:false,printable:false,server:false,responsible:false,shortLink:true}).filter((function(e){return e.Type==="string"})),setSuperTitle:false});a.groupsWithChildren.forEach((function(e){t.addGroup(e.id,e)}))}},{key:"onMenuOpen",value:function e(){this.emit("onOpenMenu",{selector:this})}},{key:"openPropertiesSwitcherMenu",value:function e(){var t;var i=this;o.MenuManager.show(h.Helper.generateUniqueId(),this.menuButton,[{text:T.Loc.getMessage("BIZPROC_AUTOMATION_ASK_CONSTANT"),disabled:((t=i.fieldProperty)===null||t===void 0?void 0:t.Type)==="file",onclick:function e(t){this.popupWindow.close();i.emit("onAskConstant",{fieldProperty:i.fieldProperty})}},{text:T.Loc.getMessage("BIZPROC_AUTOMATION_ASK_PARAMETER"),onclick:function e(t){this.popupWindow.close();i.emit("onAskParameter",{fieldProperty:i.fieldProperty})}},{text:T.Loc.getMessage("BIZPROC_AUTOMATION_ASK_MANUAL"),onclick:function e(t){this.popupWindow.close();i.openMenu(t,true)}}],{autoHide:true,offsetLeft:20,angle:{position:"top"},events:{onPopupClose:function e(){this.destroy()}}});babelHelpers.classPrivateFieldSet(this,Gl,o.MenuManager.currentItem);return true}},{key:"injectDialogMenuTitles",value:function e(t){var i=this;t.forEach((function(e){if(T.Type.isArray(e.children)){i.injectDialogMenuSupertitles(e.title,e.children)}}));return t}},{key:"injectDialogMenuSupertitles",value:function e(t,i){var a=this;i.forEach((function(e){if(!e.supertitle){e.supertitle=t}if(T.Type.isArrayFilled(e.children)){a.injectDialogMenuSupertitles(e.title,e.children)}}))}},{key:"onFieldSelect",value:function e(t){if(!t){return}var i=this.targetInput.tagName.toLowerCase();if(i==="select"){var a=this.targetInput.querySelector('[data-role="expression"]');if(!a){a=this.targetInput.appendChild(T.Dom.create("option",{attrs:{"data-role":"expression"}}))}a.setAttribute("value",t.Expression);a.textContent=t["Expression"];a.selected=true}else if(i==="label"){this.targetInput.textContent=t.Expression;var r=document.getElementById(this.targetInput.getAttribute("for"));if(r){r.value=t.Expression}}else{if(this.replaceOnWrite){this.targetInput.value=t.Expression;this.targetInput.selectionEnd=this.targetInput.value.length}else{var s="";var l=t.Expression;var n="";if(T.Type.isStringFilled(this.targetInput.value)){s=this.targetInput.value.substr(0,this.targetInput.selectionEnd);n=this.targetInput.value.substr(this.targetInput.selectionEnd)}this.targetInput.value=s+l+n;this.targetInput.selectionEnd=s.length+l.length}}BX.fireEvent(this.targetInput,"change");this.emit("Field:Selected",{field:t})}},{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Al)){babelHelpers.classPrivateFieldGet(this,Al).destroy()}if(babelHelpers.classPrivateFieldGet(this,Gl)){babelHelpers.classPrivateFieldGet(this,Gl).destroy()}}},{key:"getFields",value:function e(){return Ks(this.basisFields,"Document",{shortLink:false})}}]);return t}(n.EventEmitter);function Bl(e,t){return Fl(Fl(Fl({},e),t),{},{children:[].concat(babelHelpers.toConsumableArray(e.children),babelHelpers.toConsumableArray(t.children))})}function zl(e){var t=this;if(!T.Type.isArray(e.children)){e.children=[]}e.children=e.children.filter((function(e){var i;return(i=e.customData)!==null&&i!==void 0&&i.field?Cl(t,Ll,Wl).call(t,e.customData.field):true})).map((function(e){return Cl(t,Nl,zl).call(t,e)}));return Fl({entityId:"bp",tabs:"recents"},e)}function Ul(){var e=this,t;this.basisFields=this.basisFields.filter((function(t){return Cl(e,Ll,Wl).call(e,t)}));var i=(t=this.fieldProperty)===null||t===void 0?void 0:t.Type;if(i==="file"){this.replaceOnWrite=true}else if(i==="date"||i==="datetime"){this.replaceOnWrite=true;var a=new h.DelayIntervalSelector({labelNode:this.targetInput,basisFields:this.basisFields,useAfterBasis:true,onchange:function(e){this.targetInput.value=e.toExpression(this.basisFields,h.Helper.getResponsibleUserExpression(this.context.fields))}.bind(this)});a.init(h.DelayInterval.fromString(this.targetInput.value,this.basisFields))}}function Wl(e){var t;var i=(t=this.fieldProperty)===null||t===void 0?void 0:t.Type;if(i==="file"){return e.Type==="file"}else if(i==="date"||i==="datetime"){return e.Type==="date"||e.Type==="datetime"}else if(i==="time"){return e.Type==="date"||e.Type==="datetime"||e.Type==="time"}return true}function jl(e){if(e.keyCode===45&&e.altKey===false&&e.ctrlKey===false&&e.shiftKey===false){this.openMenu(e);e.preventDefault()}}var Yl,Vl;function Zl(e,t){ql(e,t);t.add(e)}function Xl(e,t,i){ql(e,t);t.set(e,i)}function ql(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Jl(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Kl=new WeakMap;var Ql=new WeakMap;var $l=new WeakMap;var en=new WeakMap;var tn=new WeakMap;var an=new WeakMap;var rn=new WeakMap;var sn=new WeakSet;var ln=new WeakSet;var nn=new WeakSet;var on=new WeakSet;var cn=new WeakSet;var un=new WeakSet;var pn=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Zl(babelHelpers.assertThisInitialized(i),un);Zl(babelHelpers.assertThisInitialized(i),cn);Zl(babelHelpers.assertThisInitialized(i),on);Zl(babelHelpers.assertThisInitialized(i),nn);Zl(babelHelpers.assertThisInitialized(i),ln);Zl(babelHelpers.assertThisInitialized(i),sn);Xl(babelHelpers.assertThisInitialized(i),Kl,{writable:true,value:null});Xl(babelHelpers.assertThisInitialized(i),Ql,{writable:true,value:null});Xl(babelHelpers.assertThisInitialized(i),$l,{writable:true,value:void 0});Xl(babelHelpers.assertThisInitialized(i),en,{writable:true,value:[]});Xl(babelHelpers.assertThisInitialized(i),tn,{writable:true,value:void 0});Xl(babelHelpers.assertThisInitialized(i),an,{writable:true,value:void 0});Xl(babelHelpers.assertThisInitialized(i),rn,{writable:true,value:void 0});Jl(babelHelpers.assertThisInitialized(i),sn,dn).call(babelHelpers.assertThisInitialized(i));Jl(babelHelpers.assertThisInitialized(i),ln,bn).call(babelHelpers.assertThisInitialized(i));babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),$l,T.Type.isNil(e.showValuesSelector)?true:T.Text.toBoolean(e.showValuesSelector));return i}babelHelpers.createClass(t,[{key:"renderWith",value:function e(t){this.targetInput=T.Runtime.clone(t);this.targetInput.setAttribute("autocomplete","off");this.parseTargetProperties();this.replaceOnWrite=true;if(babelHelpers.classPrivateFieldGet(this,$l)===false){return babelHelpers.classPrivateFieldGet(this,Kl)}var i=T.Tag.render(Yl||(Yl=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-select">\n\t\t\t\t','\n\t\t\t\t<span\n\t\t\t\t\tref="menuButton"\n\t\t\t\t\tonclick="','"\n\t\t\t\t\tclass="bizproc-automation-popup-select-dotted"\n\t\t\t\t></span>\n\t\t\t</div>\n\t\t'])),babelHelpers.classPrivateFieldGet(this,Kl),this.openMenu.bind(this)),a=i.root,r=i.menuButton;this.menuButton=r;return a}},{key:"parseTargetProperties",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"parseTargetProperties",this).call(this);Jl(this,on,hn).call(this)}}]);return t}(xl);function dn(){var e=function e(t){return BX.Main.Date.convertBitrixFormat(T.Loc.getMessage(t)).replace(/:?\s*s/,"")};var t=e("FORMAT_DATE");var i=e("FORMAT_DATETIME");babelHelpers.classPrivateFieldSet(this,tn,i.replace(t,"").trim())}function bn(){var e=this;var t=function t(i,a){i.preventDefault();babelHelpers.classPrivateFieldGet(e,Ql).value=T.Text.encode(a.text);a.getMenuWindow().close()};for(var i=0;i<24;i++){babelHelpers.classPrivateFieldGet(this,en).push({id:i*60,text:Jl(this,nn,vn).call(this,i,0),onclick:t},{id:i*60+30,text:Jl(this,nn,vn).call(this,i,30),onclick:t})}}function vn(e,t){var i=new Date;i.setHours(e,t);return u.DateTimeFormat.format(babelHelpers.classPrivateFieldGet(this,tn),i.getTime()/1e3)}function hn(){var e=this.targetInput;var t=T.Type.isDomNode(this.targetInput.parentNode);if(t){this.targetInput=T.Runtime.clone(e)}var i=T.Tag.render(Vl||(Vl=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span onclick="','" style="width: 100%; position: relative">\n\t\t\t\t','\n\t\t\t\t<span \n\t\t\t\t\tref="chevron"\n\t\t\t\t\tclass="ui-icon-set --chevron-down bizproc-automation-inline-time-selector-chevron"\n\t\t\t\t></span>\n\t\t\t</span>\n\t\t'])),Jl(this,cn,fn).bind(this),this.targetInput),a=i.root,r=i.chevron;babelHelpers.classPrivateFieldSet(this,Kl,a);babelHelpers.classPrivateFieldSet(this,Ql,this.targetInput);babelHelpers.classPrivateFieldSet(this,rn,r);if(t){T.Dom.replace(e,babelHelpers.classPrivateFieldGet(this,Kl))}}function fn(e){Jl(this,un,gn).call(this);e.preventDefault()}function gn(){var e=this;if(T.Type.isNil(babelHelpers.classPrivateFieldGet(this,an))){babelHelpers.classPrivateFieldSet(this,an,new o.Menu({autoHide:true,bindElement:babelHelpers.classPrivateFieldGet(this,Kl),items:babelHelpers.classPrivateFieldGet(this,en),maxHeight:230,width:babelHelpers.classPrivateFieldGet(this,Kl).offsetWidth||babelHelpers.classPrivateFieldGet(this,Kl).clientWidth||100,events:{onPopupClose:function t(){if(T.Dom.hasClass(babelHelpers.classPrivateFieldGet(e,rn),"--chevron-up")){T.Dom.toggleClass(babelHelpers.classPrivateFieldGet(e,rn),["--chevron-down","--chevron-up"])}}}}))}babelHelpers.classPrivateFieldGet(this,an).show();if(T.Dom.hasClass(babelHelpers.classPrivateFieldGet(this,rn),"--chevron-down")){T.Dom.toggleClass(babelHelpers.classPrivateFieldGet(this,rn),["--chevron-down","--chevron-up"])}}var Tn=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getSelectorByTarget",value:function e(t){var i;var a=(i=h.Designer.getInstance().getRobotSettingsDialog())===null||i===void 0?void 0:i.template;if(a&&T.Type.isArray(a.robotSettingsControls)){return a.robotSettingsControls.find((function(e){return e.targetInput===t}))}return undefined}},{key:"createSelectorByRole",value:function e(t,i){if(t===this.SELECTOR_ROLE_USER){return new h.UserSelector(i)}else if(t===this.SELECTOR_ROLE_FILE){return new h.FileSelector(i)}else if(t===this.SELECTOR_ROLE_INLINE){return new h.InlineSelector(i)}else if(t===this.SELECTOR_ROLE_INLINE_HTML){return new h.InlineSelectorHtml(i)}else if(t===this.SELECTOR_ROLE_INLINE_TIME){return new pn(i)}else if(t===this.SELECTOR_ROLE_TIME){return new h.TimeSelector(i)}else if(t===this.SELECTOR_ROLE_SAVE_STATE){return new h.SaveStateCheckbox(i)}else if(t===this.SELECTOR_ROLE_MENU){return new h.MenuSelector(i)}else{return undefined}}}]);return e}();babelHelpers.defineProperty(Tn,"SELECTOR_ROLE_USER","user-selector");babelHelpers.defineProperty(Tn,"SELECTOR_ROLE_FILE","file-selector");babelHelpers.defineProperty(Tn,"SELECTOR_ROLE_INLINE","inline-selector-target");babelHelpers.defineProperty(Tn,"SELECTOR_ROLE_INLINE_HTML","inline-selector-html");babelHelpers.defineProperty(Tn,"SELECTOR_ROLE_TIME","time-selector");babelHelpers.defineProperty(Tn,"SELECTOR_ROLE_SAVE_STATE","save-state-checkbox");babelHelpers.defineProperty(Tn,"SELECTOR_ROLE_INLINE_TIME","inline-selector-time");babelHelpers.defineProperty(Tn,"SELECTOR_ROLE_MENU","menu-selector");function yn(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function mn(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yn(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Pn(e,t){In(e,t);t.add(e)}function Hn(e,t,i){In(e,t);t.set(e,i)}function In(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function En(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var wn=new WeakMap;var Fn=new WeakSet;var Sn=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Pn(babelHelpers.assertThisInitialized(i),Fn);Hn(babelHelpers.assertThisInitialized(i),wn,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(i),wn,e.condition);return i}babelHelpers.createClass(t,[{key:"renderTo",value:function e(t){this.targetInput=t;this.menuButton=t;this.parseTargetProperties();this.bindTargetEvents()}},{key:"fillGroups",value:function e(){this.fillFieldsGroups()}},{key:"onMenuOpen",value:function e(){this.emit("onOpenMenu",{selector:this,isMixedCondition:En(this,Fn,_n).call(this)})}},{key:"onFieldSelect",value:function e(t){this.emit("change",{field:t})}},{key:"getFields",value:function e(){return this.context.fields.map((function(e){return mn(mn({},e),{},{ObjectId:"Document"})}))}}]);return t}(xl);function _n(){return babelHelpers.classPrivateFieldGet(this,wn)&&babelHelpers.classPrivateFieldGet(this,wn).parentGroup&&babelHelpers.classPrivateFieldGet(this,wn).parentGroup.type===h.ConditionGroup.CONDITION_TYPE.Mixed}var On;function Cn(e,t){An(e,t);t.add(e)}function kn(e,t,i){An(e,t);t.set(e,i)}function An(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Gn(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Mn=new WeakMap;var Nn=new WeakMap;var Dn=new WeakSet;var Ln=new WeakSet;var Rn=new WeakSet;var xn=new WeakSet;var Bn=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++){r[s]=arguments[s]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(r)));Cn(babelHelpers.assertThisInitialized(i),xn);Cn(babelHelpers.assertThisInitialized(i),Rn);Cn(babelHelpers.assertThisInitialized(i),Ln);Cn(babelHelpers.assertThisInitialized(i),Dn);kn(babelHelpers.assertThisInitialized(i),Mn,{writable:true,value:void 0});kn(babelHelpers.assertThisInitialized(i),Nn,{writable:true,value:{OnEditorInitedAfter:Gn(babelHelpers.assertThisInitialized(i),Rn,Wn).bind(babelHelpers.assertThisInitialized(i))}});return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){Gn(this,Ln,Un).call(this)}},{key:"renderTo",value:function e(t){this.targetInput=t;babelHelpers.classPrivateFieldSet(this,Mn,t.querySelector(".bx-html-editor"));this.menuButton=T.Tag.render(On||(On=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span\n\t\t\t\tonclick="','"\n\t\t\t\tclass="bizproc-automation-popup-select-dotted"\n\t\t\t></span>\n\t\t'])),this.openMenu.bind(this));this.parseTargetProperties();this.bindTargetEvents();t.firstElementChild.appendChild(this.menuButton);Gn(this,Dn,zn).call(this)}},{key:"onFieldSelect",value:function e(t){var i=t.Expression;var a=Gn(this,xn,jn).call(this);if(a&&a.InsertHtml){if(a.synchro.IsFocusedOnTextarea()){a.textareaView.Focus();a.textareaView.WrapWith("","",i)}else{a.InsertHtml(i)}a.synchro.Sync()}}},{key:"onBeforeSave",value:function e(){var t=Gn(this,xn,jn).call(this);if(t&&t.SaveContent){t.SaveContent()}}},{key:"onPopupResize",value:function e(){var t=Gn(this,xn,jn).call(this);if(t&&t.ResizeSceleton){t.ResizeSceleton()}}}]);return t}(xl);function zn(){for(var e=0,t=Object.entries(babelHelpers.classPrivateFieldGet(this,Nn));e<t.length;e++){var i=babelHelpers.slicedToArray(t[e],2),a=i[0],r=i[1];BX.addCustomEvent(a,r)}}function Un(){for(var e=0,t=Object.entries(babelHelpers.classPrivateFieldGet(this,Nn));e<t.length;e++){var i=babelHelpers.slicedToArray(t[e],2),a=i[0],r=i[1];BX.removeCustomEvent(a,r)}}function Wn(e){if(e.dom.cont!==babelHelpers.classPrivateFieldGet(this,Mn)){return false}var t="";var i="";var a=function e(i){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return i.replace(/(^[\s\S]*?)(<body.*?>)/i,(function(e){if(a){t=e}return""}))};var r=function e(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return t.replace(/(<\/body>[\s\S]*?$)/i,(function(e){if(a){i=e}return""}))};BX.addCustomEvent(e,"OnParse",(function(e){if(!e){this.content=r(a(this.content,true),true)}}));BX.addCustomEvent(e,"OnAfterParse",(function(e){if(e){var s=r(a(this.content));if(t!==""&&i!==""){s=t+s+i}this.content=s}}))}function jn(){if(babelHelpers.classPrivateFieldGet(this,Mn)){var e=babelHelpers.classPrivateFieldGet(this,Mn).id.split("-");return BXHtmlEditor.Get(e[e.length-1])}return null}function Yn(e,t){Zn(e,t);t.add(e)}function Vn(e,t,i){Zn(e,t);t.set(e,i)}function Zn(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Xn(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var qn=new WeakMap;var Jn=new WeakMap;var Kn=new WeakMap;var Qn=new WeakSet;var $n=new WeakSet;var eo=function(){function e(t){babelHelpers.classCallCheck(this,e);Yn(this,$n);Yn(this,Qn);Vn(this,qn,{writable:true,value:void 0});Vn(this,Jn,{writable:true,value:void 0});Vn(this,Kn,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,qn,t.context);babelHelpers.classPrivateFieldSet(this,Jn,t.checkbox);babelHelpers.classPrivateFieldSet(this,Kn,t.needSync);if(t.needSync){var i="save_state_checkbox";var a=babelHelpers.classPrivateFieldGet(this,qn).get("userOptions").get(i,Xn(this,Qn,to).call(this),"N");if(a==="Y"){babelHelpers.classPrivateFieldGet(this,Jn).checked=true}}}babelHelpers.createClass(e,[{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Kn)){babelHelpers.classPrivateFieldGet(this,qn).get("userOptions").set("save_state_checkboxes",Xn(this,Qn,to).call(this),Xn(this,$n,io).call(this))}}}]);return e}();function to(){return babelHelpers.classPrivateFieldGet(this,Jn).getAttribute("data-save-state-key")}function io(){return babelHelpers.classPrivateFieldGet(this,Jn).checked?"Y":"N"}var ao,ro,so;function lo(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=no(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function no(e,t){if(!e)return;if(typeof e==="string")return oo(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return oo(e,t)}function oo(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function co(e,t){po(e,t);t.add(e)}function uo(e,t,i){po(e,t);t.set(e,i)}function po(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function bo(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var vo="menu-popup-item-accept";var ho="menu-popup-item-none";var fo=new WeakMap;var go=new WeakMap;var To=new WeakMap;var yo=new WeakMap;var mo=new WeakMap;var Po=new WeakMap;var Ho=new WeakMap;var Io=new WeakMap;var Eo=new WeakMap;var wo=new WeakSet;var Fo=new WeakSet;var So=new WeakSet;var _o=new WeakSet;var Oo=new WeakSet;var Co=new WeakSet;var ko=new WeakSet;var Ao=new WeakSet;var Go=new WeakSet;var Mo=new WeakSet;var No=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));co(babelHelpers.assertThisInitialized(i),Mo);co(babelHelpers.assertThisInitialized(i),Go);co(babelHelpers.assertThisInitialized(i),Ao);co(babelHelpers.assertThisInitialized(i),ko);co(babelHelpers.assertThisInitialized(i),Co);co(babelHelpers.assertThisInitialized(i),Oo);co(babelHelpers.assertThisInitialized(i),_o);co(babelHelpers.assertThisInitialized(i),So);co(babelHelpers.assertThisInitialized(i),Fo);co(babelHelpers.assertThisInitialized(i),wo);uo(babelHelpers.assertThisInitialized(i),fo,{writable:true,value:new Set});uo(babelHelpers.assertThisInitialized(i),go,{writable:true,value:void 0});uo(babelHelpers.assertThisInitialized(i),To,{writable:true,value:null});uo(babelHelpers.assertThisInitialized(i),yo,{writable:true,value:void 0});uo(babelHelpers.assertThisInitialized(i),mo,{writable:true,value:void 0});uo(babelHelpers.assertThisInitialized(i),Po,{writable:true,value:void 0});uo(babelHelpers.assertThisInitialized(i),Ho,{writable:true,value:void 0});uo(babelHelpers.assertThisInitialized(i),Io,{writable:true,value:void 0});uo(babelHelpers.assertThisInitialized(i),Eo,{writable:true,value:void 0});i.setEventNamespace("BX.Bizproc.Automation.Selector");i.context=e.context;return i}babelHelpers.createClass(t,[{key:"renderTo",value:function e(t){babelHelpers.classPrivateFieldSet(this,mo,t);bo(this,wo,Do).call(this);babelHelpers.classPrivateFieldSet(this,yo,T.Tag.render(ao||(ao=babelHelpers.taggedTemplateLiteral(['<a class="bizproc-automation-popup-settings-button">',"</a>"])),T.Text.encode(babelHelpers.classPrivateFieldGet(this,Po))));T.Event.bind(babelHelpers.classPrivateFieldGet(this,yo),"click",bo(this,Ao,Wo).bind(this));T.Dom.append(babelHelpers.classPrivateFieldGet(this,yo),babelHelpers.classPrivateFieldGet(this,mo))}},{key:"prepareItems",value:function e(t){return Object.entries(t).map((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],a=t[1];return{title:a,value:i}}))}},{key:"onBeforeSave",value:function e(){var t=T.Tag.render(ro||(ro=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<select\n\t\t\t\tname="','"\n\t\t\t\t',"\n\t\t\t\thidden\n\t\t\t>\n\t\t\t</select>\n\t\t"])),babelHelpers.classPrivateFieldGet(this,Io)+(babelHelpers.classPrivateFieldGet(this,Ho)?"[]":""),babelHelpers.classPrivateFieldGet(this,Ho)?"multiple":"");var i=lo(babelHelpers.classPrivateFieldGet(this,fo).values()),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;if(T.Type.isNil(r)){continue}var s=T.Tag.render(so||(so=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<option value="','"></option>\n\t\t\t'])),r);s.selected=true;T.Dom.append(s,t)}}catch(e){i.e(e)}finally{i.f()}if(babelHelpers.classPrivateFieldGet(this,Eo)){T.Dom.replace(babelHelpers.classPrivateFieldGet(this,Eo),t)}else{T.Dom.append(t,babelHelpers.classPrivateFieldGet(this,mo))}babelHelpers.classPrivateFieldSet(this,Eo,t)}},{key:"destroy",value:function e(){var t;(t=babelHelpers.classPrivateFieldGet(this,To))===null||t===void 0?void 0:t.close()}}]);return t}(n.EventEmitter);function Do(){var e,t,i;var a=JSON.parse(babelHelpers.classPrivateFieldGet(this,mo).getAttribute("data-config"));babelHelpers.classPrivateFieldSet(this,Po,(e=a.name)!==null&&e!==void 0?e:"Notification");babelHelpers.classPrivateFieldSet(this,Io,(t=a.fieldName)!==null&&t!==void 0?t:"");babelHelpers.classPrivateFieldSet(this,go,a.options?this.prepareItems(a.options):[]);babelHelpers.classPrivateFieldSet(this,Ho,(i=a.multiple)!==null&&i!==void 0?i:false);if(!T.Type.isNil(a.selected)){bo(this,Go,jo).call(this,a.selected)}}function Lo(){var e=this;return babelHelpers.classPrivateFieldGet(this,go).map((function(t){return bo(e,So,Ro).call(e,t)}))}function Ro(e){return{id:"menu-selector-menu-id-".concat(e.value),className:bo(this,_o,xo).call(this,e.value)?vo:ho,onclick:bo(this,Oo,Bo).bind(this,e.value),html:T.Text.encode(e.title)}}function xo(e){return babelHelpers.classPrivateFieldGet(this,fo).has(e)}function Bo(e,t,i){if(bo(this,_o,xo).call(this,e)){bo(this,Co,zo).call(this,e);T.Dom.removeClass(i.getContainer(),vo);T.Dom.addClass(i.getContainer(),ho)}else{if(babelHelpers.classPrivateFieldGet(this,Ho)){bo(this,ko,Uo).call(this,e)}else{var a=lo(babelHelpers.classPrivateFieldGet(this,To).menuItems),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;T.Dom.removeClass(s.getContainer(),vo)}}catch(e){a.e(e)}finally{a.f()}bo(this,Go,jo).call(this,[e])}T.Dom.removeClass(i.getContainer(),ho);T.Dom.addClass(i.getContainer(),vo)}}function zo(e){babelHelpers.classPrivateFieldGet(this,fo)["delete"](e)}function Uo(e){babelHelpers.classPrivateFieldGet(this,fo).add(e)}function Wo(){if(!babelHelpers.classPrivateFieldGet(this,To)){var e=bo(this,Fo,Lo).call(this);var t={closeByEsc:true,autoHide:true,cacheable:true};babelHelpers.classPrivateFieldSet(this,To,o.MenuManager.create(T.Text.getRandom(),babelHelpers.classPrivateFieldGet(this,yo),e,t))}babelHelpers.classPrivateFieldGet(this,To).show()}function jo(e){var t=this;bo(this,Mo,Yo).call(this);e.forEach((function(e){bo(t,ko,Uo).call(t,e)}))}function Yo(){if(babelHelpers.classPrivateFieldGet(this,fo).size===0){return}babelHelpers.classPrivateFieldSet(this,fo,new Set)}var Vo=function(e){babelHelpers.inherits(t,e);function t(){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}babelHelpers.createClass(t,[{key:"renderTo",value:function e(t){this.targetInput=t;this.menuButton=t;this.fieldProperty=JSON.parse(t.getAttribute("data-property"));if(!this.fieldProperty){this.context.useSwitcherMenu=false}var i=this.context.get("additionalUserFields");this.userSelector=BX.Bizproc.UserSelector.decorateNode(t,{additionalFields:T.Type.isArray(i)?i:[]})}},{key:"destroy",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"destroy",this).call(this);if(this.userSelector){this.userSelector.destroy();this.userSelector=null}}}]);return t}(xl);var Zo,Xo,qo,Jo,Ko,Qo,$o,ec;function tc(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=ic(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function ic(e,t){if(!e)return;if(typeof e==="string")return ac(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ac(e,t)}function ac(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function rc(e,t){lc(e,t);t.add(e)}function sc(e,t,i){lc(e,t);t.set(e,i)}function lc(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function nc(e,t,i){oc(e,t);return i}function oc(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function cc(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var uc=new WeakMap;var pc=new WeakMap;var dc=new WeakMap;var bc=new WeakMap;var vc=new WeakMap;var hc=new WeakMap;var fc=new WeakMap;var gc=new WeakMap;var Tc=new WeakMap;var yc=new WeakMap;var mc=new WeakMap;var Pc=new WeakMap;var Hc=new WeakMap;var Ic=new WeakMap;var Ec=new WeakMap;var wc=new WeakSet;var Fc=new WeakSet;var Sc=new WeakSet;var _c=new WeakSet;var Oc=new WeakSet;var Cc=new WeakSet;var kc=new WeakSet;var Ac=new WeakSet;var Gc=new WeakSet;var Mc=new WeakSet;var Nc=new WeakSet;var Dc=new WeakSet;var Lc=new WeakSet;var Rc=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));rc(babelHelpers.assertThisInitialized(i),Lc);rc(babelHelpers.assertThisInitialized(i),Dc);rc(babelHelpers.assertThisInitialized(i),Nc);rc(babelHelpers.assertThisInitialized(i),Mc);rc(babelHelpers.assertThisInitialized(i),Gc);rc(babelHelpers.assertThisInitialized(i),Ac);rc(babelHelpers.assertThisInitialized(i),kc);rc(babelHelpers.assertThisInitialized(i),Cc);rc(babelHelpers.assertThisInitialized(i),Oc);rc(babelHelpers.assertThisInitialized(i),_c);rc(babelHelpers.assertThisInitialized(i),Sc);rc(babelHelpers.assertThisInitialized(i),Fc);rc(babelHelpers.assertThisInitialized(i),wc);sc(babelHelpers.assertThisInitialized(i),uc,{writable:true,value:t.TYPE.None});sc(babelHelpers.assertThisInitialized(i),pc,{writable:true,value:false});sc(babelHelpers.assertThisInitialized(i),dc,{writable:true,value:false});sc(babelHelpers.assertThisInitialized(i),bc,{writable:true,value:""});sc(babelHelpers.assertThisInitialized(i),vc,{writable:true,value:""});sc(babelHelpers.assertThisInitialized(i),hc,{writable:true,value:false});sc(babelHelpers.assertThisInitialized(i),fc,{writable:true,value:""});sc(babelHelpers.assertThisInitialized(i),gc,{writable:true,value:""});sc(babelHelpers.assertThisInitialized(i),Tc,{writable:true,value:""});sc(babelHelpers.assertThisInitialized(i),yc,{writable:true,value:null});sc(babelHelpers.assertThisInitialized(i),mc,{writable:true,value:null});sc(babelHelpers.assertThisInitialized(i),Pc,{writable:true,value:null});sc(babelHelpers.assertThisInitialized(i),Hc,{writable:true,value:null});sc(babelHelpers.assertThisInitialized(i),Ic,{writable:true,value:void 0});sc(babelHelpers.assertThisInitialized(i),Ec,{writable:true,value:void 0});i.context.set("fileFields",i.context.fields.filter((function(e){return e.Type==="file"})));return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,Ec)){babelHelpers.classPrivateFieldGet(this,Ec).close()}}},{key:"renderTo",value:function e(t){this.targetInput=t;var i=this.parseTargetProperties();this.targetInput.appendChild(cc(this,wc,xc).call(this));cc(this,Fc,Bc).call(this,i)}},{key:"parseTargetProperties",value:function e(){var i=JSON.parse(this.targetInput.getAttribute("data-config"));if(!T.Type.isPlainObject(i)){i={}}if(i.type){babelHelpers.classPrivateFieldSet(this,uc,i.type)}else{babelHelpers.classPrivateFieldSet(this,uc,this.context.get("fileFields").length>0?t.TYPE.File:t.TYPE.Disk)}babelHelpers.classPrivateFieldSet(this,pc,i.multiple||false);babelHelpers.classPrivateFieldSet(this,dc,i.required||false);babelHelpers.classPrivateFieldSet(this,bc,i.valueInputName||"");babelHelpers.classPrivateFieldSet(this,vc,i.typeInputName||"");babelHelpers.classPrivateFieldSet(this,hc,i.useDisk||false);babelHelpers.classPrivateFieldSet(this,fc,i.label||"Attachment");babelHelpers.classPrivateFieldSet(this,gc,i.labelFile||"File");babelHelpers.classPrivateFieldSet(this,Tc,i.labelDisk||"Disk");if(i.selected&&i.selected.length>0){return T.Runtime.clone(i.selected)}}},{key:"addItems",value:function e(i){if(babelHelpers.classPrivateFieldGet(this,uc)===t.TYPE.File){var a=tc(i),r;try{for(a.s();!(r=a.n()).done;){var s=r.value;cc(this,Gc,Zc).call(this,s)}}catch(e){a.e(e)}finally{a.f()}}else{cc(this,kc,Yc).call(this).setValues(nc(t,t,qc).call(t,i))}}},{key:"onFieldSelect",value:function e(i){cc(this,Gc,Zc).call(this,{id:i.Id,expression:i.Expression,name:i.Name,type:t.TYPE.File})}},{key:"onBeforeSave",value:function e(){var i=[];if(babelHelpers.classPrivateFieldGet(this,uc)===t.TYPE.Disk){i=cc(this,kc,Yc).call(this).getValues()}else if(babelHelpers.classPrivateFieldGet(this,uc)===t.TYPE.File){i=babelHelpers.toConsumableArray(babelHelpers.classPrivateFieldGet(this,Pc).childNodes).map((function(e){return e.getAttribute("data-file-expression")})).filter((function(e){return e!==""}))}var a=T.Tag.render(Zo||(Zo=babelHelpers.taggedTemplateLiteral(["<div></div>"])));var r=tc(i),s;try{for(r.s();!(s=r.n()).done;){var l=s.value;T.Dom.append(T.Tag.render(Xo||(Xo=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="hidden"\n\t\t\t\t\t\tname="','"\n\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t/>\n\t\t\t\t'])),babelHelpers.classPrivateFieldGet(this,bc)+(babelHelpers.classPrivateFieldGet(this,pc)?"[]":""),l),a)}}catch(e){r.e(e)}finally{r.f()}if(babelHelpers.classPrivateFieldGet(this,Ic)){T.Dom.replace(babelHelpers.classPrivateFieldGet(this,Ic),a)}else{T.Dom.append(a,this.targetInput)}babelHelpers.classPrivateFieldSet(this,Ic,a)}}]);return t}(xl);function xc(){var e=h.Helper.generateUniqueId();var t=null;var i=[];if(this.context.get("fileFields").length>0){t=T.Tag.render(qo||(qo=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<input\n\t\t\t\t\tid="type-1','"\n\t\t\t\t\tclass="bizproc-automation-popup-select-input"\n\t\t\t\t\ttype="radio"\n\t\t\t\t\tname="','"\n\t\t\t\t\tvalue="','"\n\t\t\t\t\t',"\n\t\t\t\t/>\n\t\t\t"])),e,babelHelpers.classPrivateFieldGet(this,vc),Rc.TYPE.File,babelHelpers.classPrivateFieldGet(this,uc)===Rc.TYPE.File?"checked":"")}var a=T.Tag.render(Jo||(Jo=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input\n\t\t\t\tid="type-2','"\n\t\t\t\tclass="bizproc-automation-popup-select-input"\n\t\t\t\ttype="radio"\n\t\t\t\tname="','"\n\t\t\t\tvalue="','"\n\t\t\t\t',"\n\t\t\t/>\n\t\t"])),e,babelHelpers.classPrivateFieldGet(this,vc),Rc.TYPE.Disk,babelHelpers.classPrivateFieldGet(this,uc)===Rc.TYPE.Disk?"checked":"");if(t){i.push(t,T.Tag.render(Ko||(Ko=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<label\n\t\t\t\t\tclass="bizproc-automation-popup-settings-link"\n\t\t\t\t\tfor="type-1','"\n\t\t\t\t\tonclick="','"\n\t\t\t\t>\n\t\t\t\t',"\n\t\t\t\t</label>\n\t\t\t"])),e,cc(this,Ac,Vc).bind(this,Rc.TYPE.File),babelHelpers.classPrivateFieldGet(this,gc)))}i.push(a,T.Tag.render(Qo||(Qo=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<label\n\t\t\t\tclass="bizproc-automation-popup-settings-link"\n\t\t\t\tfor="type-2','"\n\t\t\t\tonclick="','"\n\t\t\t>\n\t\t\t',"\n\t\t\t</label>\n\t\t"])),e,cc(this,Ac,Vc).bind(this,Rc.TYPE.Disk),babelHelpers.classPrivateFieldGet(this,Tc)));return T.Tag.render($o||($o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings-block">\n\t\t\t\t<span class="bizproc-automation-popup-settings-title">',':</span>\n\t\t\t\t<div class="bizproc-automation-popup-settings-tab-head">\n\t\t\t\t\t',"\n\t\t\t\t</div>\t\t\t\t\t\t\t\n\t\t\t</div>\n\t\t"])),babelHelpers.classPrivateFieldGet(this,fc),i)}function Bc(e){if(babelHelpers.classPrivateFieldGet(this,uc)===Rc.TYPE.Disk){cc(this,Cc,jc).call(this);cc(this,Sc,zc).call(this,e)}else if(babelHelpers.classPrivateFieldGet(this,uc)===Rc.TYPE.File){cc(this,_c,Uc).call(this);cc(this,Oc,Wc).call(this,e)}else{cc(this,Cc,jc).call(this);cc(this,_c,Uc).call(this)}}function zc(e){if(babelHelpers.classPrivateFieldGet(this,mc)){T.Dom.show(babelHelpers.classPrivateFieldGet(this,mc))}else{babelHelpers.classPrivateFieldSet(this,mc,T.Dom.create("div"));this.targetInput.appendChild(babelHelpers.classPrivateFieldGet(this,mc));var t=cc(this,kc,Yc).call(this);t.layout(babelHelpers.classPrivateFieldGet(this,mc));t.show(true);if(e){this.addItems(e)}}}function Uc(){if(babelHelpers.classPrivateFieldGet(this,mc)){T.Dom.hide(babelHelpers.classPrivateFieldGet(this,mc))}}function Wc(e){if(babelHelpers.classPrivateFieldGet(this,Hc)){T.Dom.show(babelHelpers.classPrivateFieldGet(this,Hc))}else{babelHelpers.classPrivateFieldSet(this,Pc,T.Dom.create("span",{attrs:{className:"bizproc-automation-popup-settings-tab-item-box"}}));babelHelpers.classPrivateFieldSet(this,Hc,T.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-tab-inner"},children:[babelHelpers.classPrivateFieldGet(this,Pc)]}));this.targetInput.appendChild(babelHelpers.classPrivateFieldGet(this,Hc));var t=T.Dom.create("a",{attrs:{className:"bizproc-automation-popup-settings-link bizproc-automation-popup-settings-link-thin"},text:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ADD_FILE")});var i=T.Dom.create("div",{attrs:{className:"bizproc-automation-popup-settings-desc"},text:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ADD_FILE_LEGEND")});T.Dom.append(i,t);babelHelpers.classPrivateFieldGet(this,Hc).appendChild(t);T.Event.bind(t,"click",cc(this,Dc,Kc).bind(this,t));if(e){this.addItems(e)}}}function jc(){if(babelHelpers.classPrivateFieldGet(this,Hc)){T.Dom.hide(babelHelpers.classPrivateFieldGet(this,Hc))}}function Yc(){if(!babelHelpers.classPrivateFieldGet(this,yc)){babelHelpers.classPrivateFieldSet(this,yc,BX.Bizproc.Automation.DiskUploader.create("",{msg:{diskAttachFiles:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_ATTACH_FILE"),diskAttachedFiles:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_ATTACHED_FILES"),diskSelectFile:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE"),diskSelectFileLegend:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_SELECT_FILE_LEGEND_MSGVER_1"),diskUploadFile:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE"),diskUploadFileLegend:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_DISK_UPLOAD_FILE_LEGEND")}}));babelHelpers.classPrivateFieldGet(this,yc).setMode(1)}return babelHelpers.classPrivateFieldGet(this,yc)}function Vc(e){if(babelHelpers.classPrivateFieldGet(this,uc)!==e){babelHelpers.classPrivateFieldSet(this,uc,e);cc(this,Fc,Bc).call(this)}}function Zc(e){if(cc(this,Mc,Xc).call(this,e)){return false}var t=cc(this,Lc,Qc).call(this,e);if(!babelHelpers.classPrivateFieldGet(this,pc)){T.Dom.clean(babelHelpers.classPrivateFieldGet(this,Pc))}babelHelpers.classPrivateFieldGet(this,Pc).appendChild(t)}function Xc(e){return Boolean(babelHelpers.classPrivateFieldGet(this,Pc).querySelector('[data-file-id="'.concat(e.id,'"]')))}function qc(e){return e.map((function(e){return{ID:e.id,NAME:e.name,SIZE:e.size,VIEW_URL:""}}))}function Jc(e){var t=babelHelpers.classPrivateFieldGet(this,Pc).querySelector('[data-file-id="'.concat(e.id,'"]'));if(t){babelHelpers.classPrivateFieldGet(this,Pc).removeChild(t)}}function Kc(e,t){var i=this;if(!babelHelpers.classPrivateFieldGet(this,Ec)){babelHelpers.classPrivateFieldSet(this,Ec,o.MenuManager.create(h.Helper.generateUniqueId(),e,this.context.get("fileFields").map((function(e){return{text:T.Text.encode(e.Name),field:e,onclick:function t(){this.popupWindow.close();i.onFieldSelect(e)}}})),{autoHide:true,offsetLeft:T.Dom.getPosition(e).width/2,angle:{position:"top",offset:0}}))}babelHelpers.classPrivateFieldGet(this,Ec).show();t.preventDefault()}function Qc(e){var t=this.context.get("fileFields").find((function(t){return t.Expression===e.expression}));var i=(t===null||t===void 0?void 0:t.Name)||"";return T.Tag.render(ec||(ec=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span\n\t\t\t\tclass="bizproc-automation-popup-autocomplete-item"\n\t\t\t\tdata-file-id="','"\n\t\t\t\tdata-file-expression="','"\n\t\t\t>\n\t\t\t\t<span class="bizproc-automation-popup-autocomplete-name">','</span>\n\t\t\t\t<span\n\t\t\t\t\tclass="bizproc-automation-popup-autocomplete-delete"\n\t\t\t\t\tonclick="','"\n\t\t\t\t></span>\n\t\t\t</span>\n\t\t'])),e.id,e.expression,i,cc(this,Nc,Jc).bind(this,e))}babelHelpers.defineProperty(Rc,"TYPE",{None:"",Disk:"disk",File:"file"});function $c(e,t){tu(e,t);t.add(e)}function eu(e,t,i){tu(e,t);t.set(e,i)}function tu(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function iu(e,t,i){au(e,t);return i}function au(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function ru(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var su=new WeakMap;var lu=new WeakSet;var nu=new WeakSet;var ou=new WeakSet;var cu=function(e){babelHelpers.inherits(t,e);function t(){var e;var i;babelHelpers.classCallCheck(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++){r[s]=arguments[s]}i=babelHelpers.possibleConstructorReturn(this,(e=babelHelpers.getPrototypeOf(t)).call.apply(e,[this].concat(r)));$c(babelHelpers.assertThisInitialized(i),ou);$c(babelHelpers.assertThisInitialized(i),nu);$c(babelHelpers.assertThisInitialized(i),lu);eu(babelHelpers.assertThisInitialized(i),su,{writable:true,value:void 0});return i}babelHelpers.createClass(t,[{key:"destroy",value:function e(){if(babelHelpers.classPrivateFieldGet(this,su)){babelHelpers.classPrivateFieldGet(this,su).closeWnd()}}},{key:"renderTo",value:function e(i){var a;this.targetInput=i;var r=new Date;r.setHours(0,0,0,0);r.setTime(r.getTime()+ru(this,nu,pu).call(this)*1e3);this.targetInput.value=iu(a=this.constructor,t,bu).call(a,r);T.Event.bind(i,"click",this.showClock.bind(this))}},{key:"showClock",value:function e(){if(!babelHelpers.classPrivateFieldGet(this,su)){babelHelpers.classPrivateFieldSet(this,su,new BX.CClockSelector({start_time:ru(this,nu,pu).call(this),node:this.targetInput,callback:ru(this,lu,uu).bind(this)}))}babelHelpers.classPrivateFieldGet(this,su).Show()}}]);return t}(xl);function uu(e){this.targetInput.value=e;BX.fireEvent(this.targetInput,"change");babelHelpers.classPrivateFieldGet(this,su).closeWnd()}function pu(){return ru(this,ou,du).call(this,this.targetInput.value)}function du(e){var t=e.split(/[\s:]+/).map((function(e){return parseInt(e)}));var i=babelHelpers.slicedToArray(t,2),a=i[0],r=i[1];if(t.length===3){var s=t[2];if(s==="pm"&&a<12){a+=12}else if(s==="am"&&a===12){a=0}}return a*3600+r*60}function bu(e){var t=function e(t){return BX.date.convertBitrixFormat(T.Loc.getMessage(t)).replace(/:?\s*s/,"")};var i=t("FORMAT_DATE");var a=t("FORMAT_DATETIME").replace(i,"").trim();return BX.date.format(a,e)}var vu,hu,fu,gu,Tu,yu,mu,Pu,Hu,Iu,Eu,wu,Fu;function Su(e,t){_u(e,t);t.add(e)}function _u(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Ou(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Cu=new WeakSet;var ku=new WeakSet;var Au=new WeakSet;var Gu=new WeakSet;var Mu=new WeakSet;var Nu=new WeakSet;var Du=new WeakSet;var Lu=new WeakSet;var Ru=new WeakSet;var xu=new WeakSet;var Bu=new WeakSet;var zu=new WeakSet;var Uu=new WeakSet;var Wu=new WeakSet;var ju=new WeakSet;var Yu=function(){function e(t){babelHelpers.classCallCheck(this,e);Su(this,ju);Su(this,Wu);Su(this,Uu);Su(this,zu);Su(this,Bu);Su(this,xu);Su(this,Ru);Su(this,Lu);Su(this,Du);Su(this,Nu);Su(this,Mu);Su(this,Gu);Su(this,Au);Su(this,ku);Su(this,Cu);this.basisFields=[];this.onchange=null;if(T.Type.isPlainObject(t)){this.labelNode=t.labelNode;this.useAfterBasis=t.useAfterBasis;if(T.Type.isArray(t.basisFields)){this.basisFields=t.basisFields}this.onchange=t.onchange;this.minLimitM=t.minLimitM;this.showWaitWorkDay=t.showWaitWorkDay}}babelHelpers.createClass(e,[{key:"init",value:function e(t){this.delay=t;this.setLabelText();this.bindLabelNode();this.prepareBasisFields()}},{key:"setLabelText",value:function e(){if(this.delay&&this.labelNode){this.labelNode.textContent=this.delay.format(T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AT_ONCE_2"),this.basisFields)}}},{key:"bindLabelNode",value:function e(){if(this.labelNode){T.Event.bind(this.labelNode,"click",this.onLabelClick.bind(this))}}},{key:"onLabelClick",value:function e(t){this.showDelayIntervalPopup();t.preventDefault()}},{key:"showDelayIntervalPopup",value:function e(){var t=this;var i=this.delay;var a=Ee.generateUniqueId();var r=T.Tag.render(vu||(vu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t <form class="bizproc-automation-popup-select-block">\n\t\t\t\t',"\n\t\t\t\t","\n\t\t\t\t","\n\t\t\t\t",'\n\t\t\t\t<div class="bizproc-automation-popup-settings__subtitle ui-typography-heading-h6">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="bizproc-automation-popup-settings__checkbox-label">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref="workTimeCheckBox"\n\t\t\t\t\t\tclass="bizproc-automation-popup-settings__checkbox"\n\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\tid="','worktime"\n\t\t\t\t\t\tname="worktime"\n\t\t\t\t\t\tvalue="1"\n\t\t\t\t\t\tstyle="vertical-align: middle"\n\t\t\t\t\t/>\n\t\t\t\t\t<label for="','worktime" class="bizproc-automation-popup-settings-lbl">\n\t\t\t\t\t\t','\n\t\t\t\t\t</label>\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="bizproc-automation-status-help bizproc-automation-status-help-right"\n\t\t\t\t\t\tdata-hint="','"\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\t\t\t\t',"\n\t\t\t</form>\n\t\t"])),Ou(this,Cu,Vu).call(this,a),this.createAfterControlNode(),this.basisFields.length>0?this.createBeforeControlNode():"",this.basisFields.length>0?this.createInControlNode():"",T.Loc.getMessage("BIZPROC_JS_AUTOMATION_DELAY_INTERVAL_ADDITIONAL_SETTINGS"),a,a,T.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_WORK_TIME_MSGVER_1"),T.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_WORK_TIME_HELP"),this.showWaitWorkDay?Ou(this,Wu,sp).call(this):""),s=r.root,l=r.workTimeCheckBox;if(i.workTime){T.Dom.attr(l,"checked","checked")}BX.UI.Hint.init(s);var n=new o.Popup({id:Ee.generateUniqueId(),bindElement:this.labelNode,content:s,closeByEsc:true,buttons:[new c.Button({color:c.Button.Color.PRIMARY,text:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_CHOOSE_BUTTON_CAPS"),onclick:function e(){t.saveFormData(new FormData(s));n.close()}}),new c.Button({color:c.Button.Color.LINK,text:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_CANCEL_BUTTON_CAPS"),onclick:function e(){n.close()}})],width:482,padding:20,closeIcon:false,autoHide:true,events:{onPopupClose:function e(){if(t.fieldsMenu){t.fieldsMenu.popupWindow.close()}if(t.valueTypeMenu){t.valueTypeMenu.popupWindow.close()}n.destroy()}},titleBar:false,angle:{offset:40},overlay:{backgroundColor:"transparent"}});n.show()}},{key:"saveFormData",value:function e(t){Ou(this,Au,Xu).call(this,t);if(!this.delay.isNow()){var i="basis_in_time_".concat(T.Text.encode(this.delay.type));this.delay.setInTime(Ou(this,Gu,qu).call(this,t.get(i)))}this.delay.setWorkTime(t.get("worktime"));this.delay.setWaitWorkDay(t.get("wait_workday"));this.setLabelText();if(this.onchange){this.onchange(this.delay)}}},{key:"createAfterControlNode",value:function e(){var t=this.delay;var i=Ee.generateUniqueId();var a=t.type===Vt.DELAY_TYPE.After&&t.value?t.value:this.minLimitM||5;var r=Ou(this,Mu,Ju).call(this,Vt.DELAY_TYPE.After,"value_type_after");var s=Ou(this,Nu,Ku).call(this,r,t.valueType!=="d","value_type_after");var l=T.Tag.render(hu||(hu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-select-item">\n\t\t\t\t<label\n\t\t\t\t\tref="labelAfter" \n\t\t\t\t\tclass="bizproc-automation-popup-select__wrapper ui-ctl ui-ctl-radio ui-ctl-w100"\n\t\t\t\t\tfor="','"\n\t\t\t\t\tdata-role="select-item"\n\t\t\t\t>\n\t\t\t\t\t<div class="bizproc-automation-popup-select__visible-row">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\tref="radioAfter"\n\t\t\t\t\t\t\ttype="radio"\n\t\t\t\t\t\t\tid="','"\n\t\t\t\t\t\t\tclass="bizproc-automation-popup-select__input ui-ctl-element"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\tname="type"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class="bizproc-automation-popup-settings__text --first">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tname="value_after"\n\t\t\t\t\t\t\tclass="bizproc-automation-popup-settings__input"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t"])),i,i,Vt.DELAY_TYPE.After,T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_THROUGH_3"),T.Text.encode(a),this.createValueTypeSelector("value_type_after"),Ou(this,Ru,ep).call(this),this.useAfterBasis?s:"",this.useAfterBasis?r:""),n=l.root,o=l.labelAfter,c=l.radioAfter;T.Event.bind(c,"change",Ou(this,ku,Zu).bind(this,o));if(t.type===Vt.DELAY_TYPE.After&&t.value>0){c.setAttribute("checked","checked");T.Dom.addClass(o,"--active");if(t.valueType==="d"&&this.delay.inTime){T.Dom.addClass(r,"--visible");T.Dom.addClass(s,"--active")}}return n}},{key:"createBeforeControlNode",value:function e(){var t=this.delay;var i=Ee.generateUniqueId();var a=t.type===Vt.DELAY_TYPE.Before&&t.value?t.value:this.minLimitM||5;var r=Ou(this,Mu,Ju).call(this,Vt.DELAY_TYPE.Before,"value_type_before");var s=Ou(this,Nu,Ku).call(this,r,t.valueType!=="d","value_type_before");var l=T.Tag.render(fu||(fu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-select-item">\n\t\t\t\t<label\n\t\t\t\t\tref="labelBefore"\n\t\t\t\t\tclass="bizproc-automation-popup-select__wrapper ui-ctl ui-ctl-radio ui-ctl-w100"\n\t\t\t\t\tfor="','"\n\t\t\t\t\tdata-role="select-item"\n\t\t\t\t>\n\t\t\t\t\t<div class="bizproc-automation-popup-select__visible-row"> \n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref="radioBefore"\n\t\t\t\t\t\t\ttype="radio"\n\t\t\t\t\t\t\tid="','"\n\t\t\t\t\t\t\tclass="bizproc-automation-popup-select__input ui-ctl-element"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t\tname="type"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class="bizproc-automation-popup-settings__text --first">\n\t\t\t\t\t\t\t','\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tname="value_before"\n\t\t\t\t\t\t\tclass="bizproc-automation-popup-settings__input"\n\t\t\t\t\t\t\tvalue="','"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t"])),i,i,Vt.DELAY_TYPE.Before,T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_FOR_TIME_3"),T.Text.encode(a),this.createValueTypeSelector("value_type_before"),Ou(this,xu,tp).call(this),s,r),n=l.root,o=l.labelBefore,c=l.radioBefore;T.Event.bind(c,"change",Ou(this,ku,Zu).bind(this,o));if(t.type===Vt.DELAY_TYPE.Before){c.setAttribute("checked","checked");T.Dom.addClass(o,"--active");if(t.valueType==="d"&&this.delay.inTime){T.Dom.addClass(r,"--visible");T.Dom.addClass(s,"--active")}}return n}},{key:"createInControlNode",value:function e(){var t=this.delay;var i=Ee.generateUniqueId();var a=Ou(this,Mu,Ju).call(this,Vt.DELAY_TYPE.In,"value_type_in");var r=Ou(this,Nu,Ku).call(this,a,false,"value_type_in");var s=T.Tag.render(gu||(gu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-select-item">\n\t\t\t\t<label\n\t\t\t\t\tref="labelIn"\n\t\t\t\t\tclass="bizproc-automation-popup-select__wrapper --last ui-ctl ui-ctl-radio ui-ctl-w100"\n\t\t\t\t\tfor="','"\n\t\t\t\t\tdata-role="select-item"\n\t\t\t\t>\n\t\t\t\t\t<div class="bizproc-automation-popup-select__visible-row">\n\t\t\t\t\t\t<input \n\t\t\t\t\t\t\tref="radioIn"\n\t\t\t\t\t\t\tclass="bizproc-automation-popup-select__input ui-ctl-element" \n\t\t\t\t\t\t\tid="','" \n\t\t\t\t\t\t\ttype="radio" \n\t\t\t\t\t\t\tvalue="','" \n\t\t\t\t\t\t\tname="type"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t',"\n\t\t\t\t\t\t","\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t"])),i,i,Vt.DELAY_TYPE.In,Ou(this,Bu,ip).call(this),r,a),l=s.root,n=s.labelIn,o=s.radioIn;T.Event.bind(o,"change",Ou(this,ku,Zu).bind(this,n));if(t.type===Vt.DELAY_TYPE.In){o.setAttribute("checked","checked");T.Dom.addClass(n,"--active");if(this.delay.inTime){T.Dom.addClass(a,"--visible");T.Dom.addClass(r,"--active")}}return l}},{key:"createValueTypeSelector",value:function e(t){var i=this.delay;var a={i:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_M"),h:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_H"),d:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_D")};var r=T.Tag.render(Tu||(Tu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span>\n\t\t\t\t<label ref="label" class="bizproc-automation-popup-settings-link">\n\t\t\t\t\t','\n\t\t\t\t</label>\n\t\t\t\t<input ref="input" type="hidden" name="','" value="','"/>\n\t\t\t</span>\n\t\t'])),T.Text.encode(a[i.valueType]),T.Text.encode(t),T.Text.encode(i.valueType)),s=r.root,l=r.label,n=r.input;T.Event.bind(l,"click",this.onValueTypeSelectorClick.bind(this,l,n));return s}},{key:"onValueTypeSelectorClick",value:function e(t,i){var a=this;var r=Ee.generateUniqueId();var s=function e(r,s){s.getMenuWindow().close();i.value=s.valueId;t.textContent=s.text;if(s.valueId==="d"){Ou(a,Lu,$u).call(a,document.querySelector('[data-role="chevron_'.concat(i.name,'"]')),document.querySelector('[data-role="hidden_row_'.concat(i.name,'"]')))}else{Ou(a,Du,Qu).call(a,document.querySelector('[data-role="chevron_'.concat(i.name,'"]')),document.querySelector('[data-role="hidden_row_'.concat(i.name,'"]')))}};var l=[{text:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_M"),valueId:"i",onclick:s},{text:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_H"),valueId:"h",onclick:s},{text:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_INTERVAL_D"),valueId:"d",onclick:s}];o.MenuManager.show(r,t,l,{autoHide:true,offsetLeft:25,angle:{position:"top"},events:{onPopupClose:function e(){this.destroy()}},overlay:{backgroundColor:"transparent"}});this.valueTypeMenu=o.MenuManager.currentItem}},{key:"onBasisClick",value:function e(t,i,a,r){var s=[];var l=function e(t,i){if(a){a(i.field||i.options.field)}i.getMenuWindow().close()};if(r===Vt.DELAY_TYPE.After||r===Vt.DELAY_TYPE.In){s.push({text:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_NOW"),field:{Name:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_NOW"),SystemExpression:Vt.BASIS_TYPE.CurrentDateTime},onclick:l},{text:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_DATE"),field:{Name:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_DATE"),SystemExpression:Vt.BASIS_TYPE.CurrentDate},onclick:l},{delimiter:true})}for(var n=0;n<this.basisFields.length;++n){if(r!==Vt.DELAY_TYPE.After&&this.basisFields[n].Id.includes("DATE_CREATE")){continue}s.push({text:T.Text.encode(this.basisFields[n].Name),field:this.basisFields[n],onclick:l})}var c=i.getAttribute("data-menu-id");if(!c){c=Ee.generateUniqueId();i.setAttribute("data-menu-id",c)}o.MenuManager.show(c,i,s,{autoHide:true,offsetLeft:T.Dom.getPosition(i).width/2,angle:{position:"top",offset:0},overlay:{backgroundColor:"transparent"}});this.fieldsMenu=o.MenuManager.currentItem}},{key:"getBasisField",value:function e(t,i){if(i&&(t===Vt.BASIS_TYPE.CurrentDateTime||t===Vt.BASIS_TYPE.CurrentDateTimeLocal)){return{Name:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_NOW"),SystemExpression:Vt.BASIS_TYPE.CurrentDateTime}}if(i&&t===Vt.BASIS_TYPE.CurrentDate){return{Name:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BASIS_DATE"),SystemExpression:Vt.BASIS_TYPE.CurrentDate}}var a=null;for(var r=0;r<this.basisFields.length;++r){if(t===this.basisFields[r].SystemExpression){a=this.basisFields[r]}}return a}},{key:"prepareBasisFields",value:function e(){var t=[];for(var i=0;i<this.basisFields.length;++i){var a=this.basisFields[i];if(!a.Id.includes("DATE_MODIFY")&&!a.Id.includes("EVENT_DATE")&&!a.Id.includes("BIRTHDATE")){t.push(a)}}this.basisFields=t}}]);return e}();function Vu(e){var t=T.Loc.getMessage(this.useAfterBasis?"BIZPROC_AUTOMATION_CMP_BASIS_NOW":"BIZPROC_AUTOMATION_CMP_AT_ONCE_2");var i=T.Loc.getMessage(this.useAfterBasis?"BIZPROC_AUTOMATION_CMP_DELAY_NOW_HELP_2":"BIZPROC_AUTOMATION_CMP_DELAY_NOW_HELP");var a=T.Tag.render(yu||(yu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-select-item">\n\t\t\t\t<label\n\t\t\t\t\tref="labelAfter"\n\t\t\t\t\tclass="bizproc-automation-popup-select__wrapper --first ui-ctl ui-ctl-radio ui-ctl-w100"\n\t\t\t\t\tfor="','now"\n\t\t\t\t\tdata-role="select-item"\n\t\t\t\t>\n\t\t\t\t\t<input \n\t\t\t\t\t\tref="radioNow"\n\t\t\t\t\t\tclass="bizproc-automation-popup-select__input ui-ctl-element"\n\t\t\t\t\t\tid="','now"\n\t\t\t\t\t\ttype="radio"\n\t\t\t\t\t\tvalue="now"\n\t\t\t\t\t\tname="type"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class="bizproc-automation-popup-settings__text --first">','</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="bizproc-automation-status__help"\n\t\t\t\t\t\tdata-hint="','"\n\t\t\t\t\t></span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t'])),e,e,t,i),r=a.root,s=a.labelAfter,l=a.radioNow;T.Event.bind(l,"change",Ou(this,ku,Zu).bind(this,s));if(this.delay.isNow()){l.setAttribute("checked","checked");T.Dom.addClass(s,"--active")}return r}function Zu(e){document.querySelectorAll('[data-role="select-item"]').forEach((function(e){T.Dom.removeClass(e,"--active")}));T.Dom.addClass(e,"--active")}function Xu(e){var t=e.get("type");if(t==="now"){this.delay.setNow()}else if(t===Vt.DELAY_TYPE.In){this.delay.setType(Vt.DELAY_TYPE.In);this.delay.setValue(0);this.delay.setValueType("i");this.delay.setBasis(e.get("basis_in"))}else{this.delay.setType(t);this.delay.setValue(e.get("value_".concat(t)));this.delay.setValueType(e.get("value_type_".concat(t)));if(t===Vt.DELAY_TYPE.After){if(this.useAfterBasis){this.delay.setBasis(e.get("basis_after"))}else{this.delay.setBasis(Vt.BASIS_TYPE.CurrentDateTime)}if(this.minLimitM>0&&this.delay.basis===Vt.BASIS_TYPE.CurrentDateTime&&this.delay.valueType==="i"&&this.delay.value<this.minLimitM){BX.UI.Notification.Center.notify({content:T.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_MIN_LIMIT_LABEL")});this.delay.setValue(this.minLimitM)}}else{this.delay.setBasis(e.get("basis_before"))}}}function qu(e){if(T.Type.isStringFilled(e)){var t=e.trim();if(/^\d{2}:\d{2}\s?[ap]?m?$/.test(t)){if(t.includes("am")){return[String(T.Text.toInteger(t.slice(0,2))%12).padStart(2,"0"),String(T.Text.toInteger(t.slice(3))%60).padStart(2,"0")]}if(t.includes("pm")){return[String(T.Text.toInteger(t.slice(0,2))%12+12).padStart(2,"0"),String(T.Text.toInteger(t.slice(3))%60).padStart(2,"0")]}return[String(T.Text.toInteger(t.slice(0,2))%24).padStart(2,"0"),String(T.Text.toInteger(t.slice(3))%60).padStart(2,"0")]}}return null}function Ju(e,t){return T.Tag.render(mu||(mu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-select__hidden-row" data-role="hidden_row_','">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),t,Ou(this,zu,ap).call(this,e))}function Ku(e,t,i){var a=T.Tag.render(Pu||(Pu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div \n\t\t\t\tclass="ui-icon-set --chevron-down bizproc-automation-popup-select__chevron"\n\t\t\t\tdata-role="chevron_','"\n\t\t\t></div>\n\t\t'])),i);if(t){Ou(this,Du,Qu).call(this,a,e)}T.Event.bind(a,"click",(function(){if(T.Dom.hasClass(a,"--disabled")){return}T.Dom.toggleClass(a,"--active");T.Dom.toggleClass(e,"--visible")}));return a}function Qu(e,t){T.Dom.removeClass(e,"--active");T.Dom.addClass(e,"--disabled");T.Dom.attr(e,{"data-hint-html":"Y","data-hint-no-icon":"Y"});e.dataset.hint=T.Loc.getMessage("BIZPROC_JS_AUTOMATION_DELAY_INTERVAL_CHEVRON_DISABLED");T.Dom.removeClass(t,"--visible");BX.UI.Hint.initNode(e)}function $u(e,t){T.Dom.replace(e,Ou(this,Nu,Ku).call(this,t,false,T.Dom.attr(e,"data-role").replace("chevron_","")))}function ep(){var e=this;if(!this.useAfterBasis){return""}var t=this.delay;var i=this.getBasisField(t.basis,true);var a=t.basis;if(!i){i=this.getBasisField(Vt.BASIS_TYPE.CurrentDateTime,true);a=i.SystemExpression}var r=i?T.Text.encode(i.Name):T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD");var s=T.Tag.render(Hu||(Hu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-auto-width">\n\t\t\t\t','\n\t\t\t</span>\n\t\t\t<input ref="beforeBasisValueNode" type="hidden" name="basis_after" value="','">\n\t\t\t<span class="bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis">\n\t\t\t\t<span ref="beforeBasisNode">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_AFTER"),T.Text.encode(a),T.Text.encode(r)),l=s.root,n=s.beforeBasisValueNode,o=s.beforeBasisNode;T.Event.bind(o,"click",(function(t){var i=function e(t){o.textContent=T.Text.encode(t.Name);n.value=t.SystemExpression};e.onBasisClick(t,o,i,Vt.DELAY_TYPE.After)}));return l}function tp(){var e=this;var t=this.delay;var i=this.getBasisField(t.basis);var a=t.basis;if(!i){i=this.basisFields[0];a=i.SystemExpression}var r=T.Tag.render(Iu||(Iu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="bizproc-automation-popup-settings-title bizproc-automation-popup-settings-title-auto-width">\n\t\t\t\t','\n\t\t\t</span>\n\t\t\t<input ref="beforeBasisValueNode" type="hidden" name="basis_before" value="','">\n\t\t\t<span class="bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis">\n\t\t\t\t<span ref="beforeBasisNode">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_BEFORE_1"),a,i?i.Name:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD")),s=r.root,l=r.beforeBasisValueNode,n=r.beforeBasisNode;T.Event.bind(n,"click",(function(t){var i=function e(t){n.textContent=T.Text.encode(t.Name);l.value=T.Text.encode(t.SystemExpression)};e.onBasisClick(t,n,i,Vt.DELAY_TYPE.Before)}));return s}function ip(){var e=this;var t=this.delay;var i=this.getBasisField(t.basis,true);var a=t.basis;if(!i){i=this.basisFields[0];a=i.SystemExpression}var r=T.Tag.render(Eu||(Eu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="bizproc-automation-popup-settings__text --first">\n\t\t\t\t','\n\t\t\t</span>\n\t\t\t<input ref="inBasisValueNode" type="hidden" name="basis_in" value="','"/>\n\t\t\t<span class="bizproc-automation-popup-settings-link bizproc-automation-delay-interval-basis">\n\t\t\t\t<span ref="inBasisNode">\n\t\t\t\t\t',"\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t"])),T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_IN_TIME_2"),a,i?i.Name:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CHOOSE_DATE_FIELD")),s=r.root,l=r.inBasisValueNode,n=r.inBasisNode;T.Event.bind(n,"click",(function(t){var i=function e(t){n.textContent=T.Text.encode(t.Name);l.value=T.Text.encode(t.SystemExpression)};e.onBasisClick(t,n,i,Vt.DELAY_TYPE.In)}));return s}function ap(e){var t=e===this.delay.type?this.delay.inTime:[];var i=Ou(this,Uu,rp).call(this,t!==null&&t!==void 0?t:[]);var a=T.Tag.render(wu||(wu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings__text">\n\t\t\t\t<span style="margin-right: 10px">\n\t\t\t\t\t','\n\t\t\t\t</span>\n\t\t\t\t<input\n\t\t\t\t\tref="input"\n\t\t\t\t\ttype="text"\n\t\t\t\t\tname="basis_in_time_','"\n\t\t\t\t\tclass="bizproc-automation-delay-interval-set-time bizproc-automation-popup-settings__input"\n\t\t\t\t\tautocomplete="off"\n\t\t\t\t\tvalue="','"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t'])),T.Loc.getMessage("BIZPROC_JS_AUTOMATION_DELAY_INTERVAL_SET_TIME_LABEL"),T.Text.encode(e),T.Text.encode(i)),r=a.root,s=a.input;new pn({context:{fields:[]},showValuesSelector:false}).renderTo(s);return r}function rp(e){var t,i;var a=BX.Main.Date.convertBitrixFormat(T.Loc.getMessage("FORMAT_DATE")).replace(/:?\s*s/,"");var r=BX.Main.Date.convertBitrixFormat(T.Loc.getMessage("FORMAT_DATETIME")).replace("".concat(a," "),"").replace(":s","");var s=new Date;s.setHours((t=e[0])!==null&&t!==void 0?t:0,(i=e[1])!==null&&i!==void 0?i:0,0,0);return T.Type.isArrayFilled(e)?u.DateTimeFormat.format(r,s):""}function sp(){var e=this.delay;var t=Ee.generateUniqueId();var i=Ou(this,ju,lp).call(this);var a=T.Tag.render(Fu||(Fu=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-select-item">\n\t\t\t\t<div class="bizproc-automation-popup-settings__checkbox-label">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref="workDayCheckbox"\n\t\t\t\t\t\tclass="bizproc-automation-popup-settings__checkbox"\n\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\tid="','"\n\t\t\t\t\t\tname="wait_workday"\n\t\t\t\t\t\tvalue="1"\n\t\t\t\t\t\tstyle="vertical-align: middle"\n\t\t\t\t\t/>\n\t\t\t\t\t<label\n\t\t\t\t\t\tclass="bizproc-automation-popup-settings-lbl ','"\n\t\t\t\t\t\tfor="','"\n\t\t\t\t\t>','</label>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass="bizproc-automation-status-help bizproc-automation-status-help-right"\n\t\t\t\t\t\tdata-hint="','"\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'])),"".concat(t,"wait_workday"),i?"":"bizproc-automation-robot-btn-set-locked","".concat(t,"wait_workday"),T.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_WAIT_WORK_DAY_MSGVER_1"),T.Loc.getMessage("BIZPROC_AUTOMATION_DELAY_WAIT_WORK_DAY_HELP")),r=a.root,s=a.workDayCheckbox;if(e.waitWorkDay&&i){T.Dom.attr(s,"checked","checked")}if(!i){T.Event.bind(r,"click",(function(){if(top.BX.UI&&top.BX.UI.InfoHelper){top.BX.UI.InfoHelper.show("limit_office_worktime_responsible")}}));s.disabled=true}return r}function lp(){var e;return(e=yb().get("IS_WORKTIME_AVAILABLE"))!==null&&e!==void 0?e:false}var np=function(e){babelHelpers.inherits(t,e);function t(e){babelHelpers.classCallCheck(this,t);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e))}babelHelpers.createClass(t,[{key:"fields",get:function e(){var t=this.get("fields");return T.Type.isArray(t)?t:[]}},{key:"useSwitcherMenu",get:function e(){return T.Type.isBoolean(this.get("useSwitcherMenu"))?this.get("useSwitcherMenu"):false},set:function e(t){this.set("useSwitcherMenu",t)}},{key:"rootGroupTitle",get:function e(){var t;return(t=this.get("rootGroupTitle"))!==null&&t!==void 0?t:""}}]);return t}(z);function op(e,t){up(e,t);t.add(e)}function cp(e,t,i){up(e,t);t.set(e,i)}function up(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function pp(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var dp=new WeakMap;var bp=new WeakMap;var vp=new WeakSet;var hp=new WeakSet;var fp=new WeakSet;var gp=new WeakSet;var Tp=new WeakSet;var yp=new WeakSet;var mp=new WeakSet;var Pp=function(){function e(t){var i=this;babelHelpers.classCallCheck(this,e);op(this,mp);op(this,yp);op(this,Tp);op(this,gp);op(this,fp);op(this,hp);op(this,vp);cp(this,dp,{writable:true,value:[]});cp(this,bp,{writable:true,value:[]});if(T.Type.isArrayFilled(t.variables)){var a=[];t.variables.forEach((function(e){a.push(pp(i,hp,Ip).call(i,e.Id,e,v.Globals.Manager.Instance.mode.variable))}));babelHelpers.classPrivateFieldSet(this,dp,a)}if(T.Type.isArrayFilled(t.constants)){var r=[];t.constants.forEach((function(e){r.push(pp(i,hp,Ip).call(i,e.Id,e,v.Globals.Manager.Instance.mode.constant))}));babelHelpers.classPrivateFieldSet(this,bp,r)}}babelHelpers.createClass(e,[{key:"updateGlobals",value:function e(t,i){var a=this;if(!pp(this,vp,Hp).call(this,t)||Object.keys(i).length<1){return}var r=pp(this,yp,Sp).call(this,t);var s=[];var l=function e(l){var n=i[l];var o=r.findIndex((function(e){return e.Id===l}));if(o>-1){if(r[o].Name!==n.Name){r[o].Name=n.Name;r[o].Expression=pp(a,fp,Ep).call(a,n.Name,n.VisibilityName)}return"continue"}s.push(pp(a,hp,Ip).call(a,l,n,t))};for(var n in i){var o=l(n);if(o==="continue")continue}if(T.Type.isArrayFilled(s)){r=r.concat(s)}pp(this,mp,_p).call(this,t,r)}},{key:"deleteGlobals",value:function e(t,i){if(!pp(this,vp,Hp).call(this,t)||!T.Type.isArrayFilled(i)){return}var a=pp(this,yp,Sp).call(this,t);i.forEach((function(e){var t=a.findIndex((function(t){return t.Id===e}));if(t>-1){a.splice(t,1)}}));pp(this,mp,_p).call(this,t,a)}},{key:"globalVariables",get:function e(){return babelHelpers.classPrivateFieldGet(this,dp)},set:function e(t){if(!T.Type.isArray(t)){return}babelHelpers.classPrivateFieldSet(this,dp,t)}},{key:"globalConstants",get:function e(){return babelHelpers.classPrivateFieldGet(this,bp)},set:function e(t){if(!T.Type.isArray(t)){return}babelHelpers.classPrivateFieldSet(this,bp,t)}}]);return e}();function Hp(e){return T.Type.isStringFilled(e)&&Object.values(v.Globals.Manager.Instance.mode).includes(e)}function Ip(e,t,i){return{ObjectId:pp(this,Tp,Fp).call(this,i),SuperTitle:String(t.VisibilityName),Id:String(e),Name:String(t.Name),Type:String(t.Type),BaseType:String(t.BaseType||t.Type),Expression:T.Type.isStringFilled(t.Expression)?t.Expression:pp(this,fp,Ep).call(this,t.Name,t.VisibilityName),SystemExpression:T.Type.isStringFilled(t.SystemExpression)?t.SystemExpression:pp(this,gp,wp).call(this,i,e),Options:t.Options,Multiple:T.Type.isBoolean(t.Multiple)?t.Multiple:t.Multiple==="Y",Visibility:String(t.Visibility)}}function Ep(e,t){return"{{"+String(t)+": "+String(e)+"}}"}function wp(e,t){return"{="+pp(this,Tp,Fp).call(this,e)+":"+String(t)+"}"}function Fp(e){return e===v.Globals.Manager.Instance.mode.variable?"GlobalVar":"GlobalConst"}function Sp(e){if(e===v.Globals.Manager.Instance.mode.variable){return this.globalVariables}if(e===v.Globals.Manager.Instance.mode.constant){return this.globalConstants}}function _p(e,t){if(e===v.Globals.Manager.Instance.mode.variable){babelHelpers.classPrivateFieldSet(this,dp,t)}if(e===v.Globals.Manager.Instance.mode.constant){babelHelpers.classPrivateFieldSet(this,bp,t)}}function Op(e,t){kp(e,t);t.add(e)}function Cp(e,t,i){kp(e,t);t.set(e,i)}function kp(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Ap(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Gp=new WeakMap;var Mp=new WeakMap;var Np=new WeakMap;var Dp=new WeakSet;var Lp=new WeakSet;var Rp=new WeakSet;var xp=function(){function e(t){babelHelpers.classCallCheck(this,e);Op(this,Rp);Op(this,Lp);Op(this,Dp);Cp(this,Gp,{writable:true,value:[]});Cp(this,Mp,{writable:true,value:-1});Cp(this,Np,{writable:true,value:"#d4d6da"});var i=t.querySelector(".bizproc-automation-status-list");if(i){babelHelpers.classPrivateFieldSet(this,Gp,i.querySelectorAll('[data-role="automation-status-title"]'))}}babelHelpers.createClass(e,[{key:"init",value:function e(t){var i=h.getGlobalContext();if(i.document.getId()<=0){babelHelpers.classPrivateFieldSet(this,Mp,babelHelpers.classPrivateFieldGet(this,Gp).length-1)}else{babelHelpers.classPrivateFieldSet(this,Mp,t.findIndex((function(e){return e.getStatusId()===i.document.getCurrentStatusId()})))}}},{key:"fixColors",value:function e(){Ap(this,Dp,Bp).call(this);Ap(this,Lp,zp).call(this)}}]);return e}();function Bp(){var e=this;babelHelpers.classPrivateFieldGet(this,Gp).forEach((function(t,i){var a=t.querySelector(".bizproc-automation__status--bg");if(a){var r=Ap(e,Rp,Up).call(e,i)&&t.dataset.bgcolor?t.dataset.bgcolor:babelHelpers.classPrivateFieldGet(e,Np);T.Dom.style(a,{backgroundColor:r,borderColor:r})}}))}function zp(){var e=this;babelHelpers.classPrivateFieldGet(this,Gp).forEach((function(t,i){if(!Ap(e,Rp,Up).call(e,i)){return}var a=t.dataset.bgcolor;if(a){var r=parseInt(a,16);var s=r>>16&255;var l=r>>8&255;var n=r&255;var o=.21*s+.72*l+.07*n<145;if(o){T.Dom.style(t,"color","white")}}}))}function Up(e){return e<=babelHelpers.classPrivateFieldGet(this,Mp)}function Wp(e,t){jp(e,t);t.add(e)}function jp(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Yp(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Vp=new WeakSet;var Zp=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));Wp(babelHelpers.assertThisInitialized(i),Vp);Yp(babelHelpers.assertThisInitialized(i),Vp,Xp).call(babelHelpers.assertThisInitialized(i),e.fields);return i}return t}(ol);function Xp(e){var t=this;var i=ul.CONSTANTS;this.addGroup(i,{id:i,title:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_CONSTANTS_LIST"),searchable:false});e.forEach((function(e){t.addGroupItem(i,{id:e.SystemExpression,title:e.Name||e.Id,supertitle:e.SuperTitle||"",customData:{field:e}})}))}function qp(e,t){Jp(e,t);t.add(e)}function Jp(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Kp(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var Qp=new WeakSet;var $p=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));qp(babelHelpers.assertThisInitialized(i),Qp);if(!T.Type.isStringFilled(e.title)){throw new TypeError("title must be filled string")}Kp(babelHelpers.assertThisInitialized(i),Qp,ed).call(babelHelpers.assertThisInitialized(i),e.fields,e.title);return i}return t}(ol);function ed(e,t){var i=this;var a=ul.ACTIVITY_RESULT;this.addGroup(a,{id:a,title:t,searchable:false});e.forEach((function(e){i.addGroupItem(a,{id:e.id,title:e.title,searchable:false,children:e.fields.map((function(e){return{id:e.SystemExpression,title:e.Name,customData:{field:e}}}))})}))}function td(e,t){id(e,t);t.add(e)}function id(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function ad(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var rd=new WeakSet;var sd=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));td(babelHelpers.assertThisInitialized(i),rd);ad(babelHelpers.assertThisInitialized(i),rd,ld).call(babelHelpers.assertThisInitialized(i),e.fields);return i}return t}(ol);function ld(e){var t=this;var i=ul.TRIGGER_RESULT;this.addGroup(i,{id:i,title:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_SELECTOR_GROUP_MANAGER_TRIGGER_LIST"),searchable:false});e.forEach((function(e){t.addGroupItem(i,{id:e.id,title:e.title,searchable:false,children:e.fields.map((function(e){return{id:e.SystemExpression,title:e.Name,customData:{field:e}}}))})}))}function nd(e,t){od(e,t);t.add(e)}function od(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function cd(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var ud=new WeakSet;var pd=function(e){babelHelpers.inherits(t,e);function t(e){var i;babelHelpers.classCallCheck(this,t);i=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,e));nd(babelHelpers.assertThisInitialized(i),ud);cd(babelHelpers.assertThisInitialized(i),ud,dd).call(babelHelpers.assertThisInitialized(i),e.fields);return i}return t}(ol);function dd(e){var t=this;var i=ul.VARIABLES;this.addGroup(i,{id:i,title:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_GLOB_VARIABLES_LIST_1"),searchable:false});e.forEach((function(e){t.addGroupItem(i,{id:e.SystemExpression,title:e.Name||e.Id,supertitle:e.SuperTitle||"",customData:{field:e}})}))}function bd(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function vd(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?bd(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):bd(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function hd(e,t){gd(e,t);t.add(e)}function fd(e,t,i){gd(e,t);t.set(e,i)}function gd(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Td(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var yd=new WeakMap;var md=new WeakMap;var Pd=new WeakMap;var Hd=new WeakMap;var Id=new WeakMap;var Ed=new WeakMap;var wd=new WeakMap;var Fd=new WeakMap;var Sd=new WeakSet;var _d=new WeakSet;var Od=new WeakSet;var Cd=new WeakSet;var kd=new WeakSet;var Ad=new WeakSet;var Gd=function(){function e(t){babelHelpers.classCallCheck(this,e);hd(this,Ad);hd(this,kd);hd(this,Cd);hd(this,Od);hd(this,_d);hd(this,Sd);fd(this,yd,{writable:true,value:[]});fd(this,md,{writable:true,value:T.Loc.getMessage("BIZPROC_JS_AUTOMATION_SELECTOR_GROUP_MANAGER_DOCUMENT_GROUP_TITLE")});fd(this,Pd,{writable:true,value:[]});fd(this,Hd,{writable:true,value:[]});fd(this,Id,{writable:true,value:[]});fd(this,Ed,{writable:true,value:[]});fd(this,wd,{writable:true,value:T.Loc.getMessage("BIZPROC_AUTOMATION_CMP_ROBOT_LIST")});fd(this,Fd,{writable:true,value:[]});if(T.Type.isArray(t.documentFields)){Td(this,Sd,Md).call(this,t.documentFields)}if(T.Type.isStringFilled(t.documentTitle)){babelHelpers.classPrivateFieldSet(this,md,t.documentTitle)}if(T.Type.isArray(t.variables)){Td(this,_d,Nd).call(this,t.variables)}if(T.Type.isArray(t.globalVariables)){Td(this,_d,Nd).call(this,t.globalVariables)}if(T.Type.isArray(t.constants)){Td(this,Od,Dd).call(this,t.constants)}if(T.Type.isArray(t.globalConstants)){Td(this,Od,Dd).call(this,t.globalConstants)}if(T.Type.isArray(t.activityResultFields)){Td(this,Cd,Ld).call(this,t.activityResultFields)}if(T.Type.isStringFilled(t.activityResultFieldsTitle)){babelHelpers.classPrivateFieldSet(this,wd,t.activityResultFieldsTitle)}if(T.Type.isArray(t.triggerResultFields)){Td(this,kd,Rd).call(this,t.triggerResultFields)}}babelHelpers.createClass(e,[{key:"groupsWithChildren",get:function e(){var t=new hl({fields:babelHelpers.classPrivateFieldGet(this,yd),title:babelHelpers.classPrivateFieldGet(this,md)});var i=new Pl({fields:babelHelpers.classPrivateFieldGet(this,Pd)});var a=new pd({fields:babelHelpers.classPrivateFieldGet(this,Hd)});var r=new Zp({fields:babelHelpers.classPrivateFieldGet(this,Id)});var s=new $p({fields:babelHelpers.classPrivateFieldGet(this,Ed),title:babelHelpers.classPrivateFieldGet(this,wd)});var l=new sd({fields:babelHelpers.classPrivateFieldGet(this,Fd)});return[].concat(babelHelpers.toConsumableArray(t.groupsWithChildren),babelHelpers.toConsumableArray(i.groupsWithChildren),babelHelpers.toConsumableArray(s.groupsWithChildren),babelHelpers.toConsumableArray(r.groupsWithChildren),babelHelpers.toConsumableArray(a.groupsWithChildren),babelHelpers.toConsumableArray(l.groupsWithChildren))}},{key:"items",get:function e(){var t=new hl({fields:babelHelpers.classPrivateFieldGet(this,yd),title:babelHelpers.classPrivateFieldGet(this,md)});var i=new Pl({fields:babelHelpers.classPrivateFieldGet(this,Pd)});var a=new pd({fields:babelHelpers.classPrivateFieldGet(this,Hd)});var r=new Zp({fields:babelHelpers.classPrivateFieldGet(this,Id)});var s=new $p({fields:babelHelpers.classPrivateFieldGet(this,Ed),title:babelHelpers.classPrivateFieldGet(this,wd)});var l=new sd({fields:babelHelpers.classPrivateFieldGet(this,Fd)});return[].concat(babelHelpers.toConsumableArray(t.items),babelHelpers.toConsumableArray(i.items),babelHelpers.toConsumableArray(a.items),babelHelpers.toConsumableArray(r.items),babelHelpers.toConsumableArray(s.items),babelHelpers.toConsumableArray(l.items))}}]);return e}();function Md(e){var t=this;e.forEach((function(e){if(Td(t,Ad,xd).call(t,e)){babelHelpers.classPrivateFieldGet(t,Pd).push(T.Runtime.clone(e));return}babelHelpers.classPrivateFieldGet(t,yd).push(T.Runtime.clone(e))}))}function Nd(e){var t=this;e.forEach((function(e){babelHelpers.classPrivateFieldGet(t,Hd).push(vd({},T.Runtime.clone(e)))}))}function Dd(e){var t=this;e.forEach((function(e){babelHelpers.classPrivateFieldGet(t,Id).push(vd({},T.Runtime.clone(e)))}))}function Ld(e){var t=this;e.forEach((function(e){var i=[];e.fields.forEach((function(e){if(Td(t,Ad,xd).call(t,e)){babelHelpers.classPrivateFieldGet(t,Pd).push(T.Runtime.clone(e));return}i.push(T.Runtime.clone(e))}));babelHelpers.classPrivateFieldGet(t,Ed).push({id:e.id,title:e.title,fields:i})}))}function Rd(e){var t;var i={};e.forEach((function(e){var t=e.ObjectRealId;if(!t){return}if(!Object.hasOwn(i,t)){i[t]={id:t,title:e.ObjectName,fields:[]}}i[t].fields.push(vd({},T.Runtime.clone(e)))}));(t=babelHelpers.classPrivateFieldGet(this,Fd)).push.apply(t,babelHelpers.toConsumableArray(Object.values(i)))}function xd(e){return e.Id.endsWith("_shortlink")&&e.Type==="string"}function Bd(e,t,i){zd(e,t);t.set(e,i)}function zd(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var Ud=new WeakMap;var Wd=function(){function e(t){babelHelpers.classCallCheck(this,e);Bd(this,Ud,{writable:true,value:void 0});if(!T.Type.isElementNode(t.target)){throw"options.target must be Node Element"}var i=T.Type.isStringFilled(t.text)?t.text:T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_SUBTITLE_1");var a=T.Type.isStringFilled(t.article)?T.Text.toInteger(t.article):"";babelHelpers.classPrivateFieldSet(this,Ud,new y.Guide({steps:[{target:t.target,title:T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_BEGINNING_TITLE"),text:i,article:a,condition:{top:true,bottom:false,color:"primary"},position:"bottom"}],onEvents:true}));babelHelpers.classPrivateFieldGet(this,Ud).getPopup().setAutoHide(true)}babelHelpers.createClass(e,[{key:"start",value:function e(){babelHelpers.classPrivateFieldGet(this,Ud).showNextStep()}}]);return e}();function jd(e,t){var i=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=Yd(e))||t&&e&&typeof e.length==="number"){if(i)e=i;var a=0;var r=function e(){};return{s:r,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=true,l=false,n;return{s:function t(){i=i.call(e)},n:function e(){var t=i.next();s=t.done;return t},e:function e(t){l=true;n=t},f:function e(){try{if(!s&&i["return"]!=null)i["return"]()}finally{if(l)throw n}}}}function Yd(e,t){if(!e)return;if(typeof e==="string")return Vd(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor)i=e.constructor.name;if(i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Vd(e,t)}function Vd(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Zd(e,t){qd(e,t);t.add(e)}function Xd(e,t,i){qd(e,t);t.set(e,i)}function qd(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function Jd(e,t,i){Kd(e,t);return i}function Kd(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}function Qd(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var $d=new WeakMap;var eb=new WeakMap;var tb=new WeakMap;var ib=new WeakMap;var ab=new WeakMap;var rb=new WeakMap;var sb=new WeakMap;var lb=new WeakSet;var nb=new WeakSet;var ob=new WeakSet;var cb=new WeakSet;var ub=new WeakSet;var pb=function(){function e(t){babelHelpers.classCallCheck(this,e);Zd(this,ub);Zd(this,cb);Zd(this,ob);Zd(this,nb);Zd(this,lb);Xd(this,$d,{writable:true,value:true});Xd(this,eb,{writable:true,value:true});Xd(this,tb,{writable:true,value:false});Xd(this,ib,{writable:true,value:false});Xd(this,ab,{writable:true,value:false});Xd(this,rb,{writable:true,value:false});Xd(this,sb,{writable:true,value:{}});if(T.Type.isBoolean(t.isShownRobotGuide)){babelHelpers.classPrivateFieldSet(this,$d,t.isShownRobotGuide)}if(T.Type.isBoolean(t.isShownTriggerGuide)){babelHelpers.classPrivateFieldSet(this,eb,t.isShownTriggerGuide)}}babelHelpers.createClass(e,[{key:"setShowRobotGuide",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,ib,t);if(t){babelHelpers.classPrivateFieldGet(this,sb)["robot"]=i!==null&&i!==void 0?i:null}}},{key:"setShowTriggerGuide",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,ab,t);if(t){babelHelpers.classPrivateFieldGet(this,sb)["trigger"]=i!==null&&i!==void 0?i:null}}},{key:"setShowSupportingRobotGuide",value:function e(t,i){babelHelpers.classPrivateFieldSet(this,rb,t);if(t){babelHelpers.classPrivateFieldGet(this,sb)["supportingRobot"]=i!==null&&i!==void 0?i:null}}},{key:"start",value:function e(){Qd(this,lb,db).call(this);var t=Qd(this,nb,bb).call(this);if(t){var i=t.getCurrentStep().target;if(T.Type.isDomNode(i)&&document.body.contains(i)){t.showNextStep()}}}},{key:"isShownRobotGuide",get:function e(){return babelHelpers.classPrivateFieldGet(this,$d)}},{key:"isShownTriggerGuide",get:function e(){return babelHelpers.classPrivateFieldGet(this,eb)}}]);return e}();function db(){if(babelHelpers.classPrivateFieldGet(this,eb)){babelHelpers.classPrivateFieldSet(this,ab,false)}if(babelHelpers.classPrivateFieldGet(this,tb)){babelHelpers.classPrivateFieldSet(this,rb,false);babelHelpers.classPrivateFieldSet(this,$d,true)}if(babelHelpers.classPrivateFieldGet(this,$d)){babelHelpers.classPrivateFieldSet(this,ib,false)}if(babelHelpers.classPrivateFieldGet(this,rb)){babelHelpers.classPrivateFieldSet(this,$d,true)}}function bb(){var e=null;if(babelHelpers.classPrivateFieldGet(this,rb)){if(T.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,sb)["supportingRobot"])){e=Qd(this,ub,fb).call(this);e.getPopup().setAutoHide(true)}return e}if(babelHelpers.classPrivateFieldGet(this,ab)){if(T.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,sb)["trigger"])){e=Qd(this,cb,hb).call(this);e.getPopup().setAutoHide(true)}return e}if(babelHelpers.classPrivateFieldGet(this,ib)){if(T.Type.isDomNode(babelHelpers.classPrivateFieldGet(this,sb)["robot"])){e=Qd(this,ob,vb).call(this);e.getPopup().setAutoHide(true)}return e}return e}function vb(){var e=this;var t;return new y.Guide({steps:[{target:babelHelpers.classPrivateFieldGet(this,sb)["robot"],title:T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_TITLE_1"),text:Jd(t=this.constructor,pb,gb).call(t,[T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_SUBTITLE_1"),T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_ROBOT_SUBTITLE_2")]),article:"16547618",condition:{top:false,bottom:true,color:"primary"},position:"top",events:{onShow:function t(){babelHelpers.classPrivateFieldSet(e,$d,true)}}}],onEvents:true})}function hb(){var e=this;var t;return new y.Guide({steps:[{target:babelHelpers.classPrivateFieldGet(this,sb)["trigger"],title:T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_TITLE_1"),text:Jd(t=this.constructor,pb,gb).call(t,[T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_SUBTITLE_1"),T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_TRIGGER_SUBTITLE_2")]),article:"16547632",condition:{top:false,bottom:true,color:"primary"},position:"top",events:{onShow:function t(){babelHelpers.classPrivateFieldSet(e,eb,true)}}}],onEvents:true})}function fb(){var e=this;var t;return new y.Guide({steps:[{target:babelHelpers.classPrivateFieldGet(this,sb)["supportingRobot"],title:T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_TITLE"),text:Jd(t=this.constructor,pb,gb).call(t,[T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_SUBTITLE_1"),T.Loc.getMessage("BIZPROC_AUTOMATION_TOUR_GUIDE_SUPPORTING_ROBOT_SUBTITLE_2")]),article:"16547644",condition:{top:false,bottom:true,color:"primary"},position:"top",events:{onShow:function t(){babelHelpers.classPrivateFieldSet(e,tb,true)}}}],onEvents:true})}function gb(e){var t='<ul class="bizproc-automation-tour-guide-list">';var i=jd(e),a;try{for(i.s();!(a=i.n()).done;){var r=a.value;t+='<li class="bizproc-automation-tour-guide-list-item"> '.concat(T.Text.encode(r)," </li>")}}catch(e){i.e(e)}finally{i.f()}t+="</ul>";return t}var Tb;function yb(){if(Tb instanceof U){return Tb}throw new Error("Context is not initialized yet")}function mb(){try{return yb()}catch(e){return null}}function Pb(e){if(e instanceof U){Tb=e}else{throw new Error("Unsupported Context")}return e}e.TemplatesScheme=D;e.Context=U;e.enrichFieldsWithModifiers=Ks;e.getGlobalContext=yb;e.tryGetGlobalContext=mb;e.setGlobalContext=Pb;e.TemplateScope=w;e.TriggerManager=Ht;e.Trigger=ve;e.Template=dr;e.Robot=oa;e.UserOptions=Ta;e.Document=wr;e.ViewMode=K;e.ConditionGroup=Rr;e.ConditionGroupSelector=Ws;e.Condition=Ar;e.Designer=Ae;e.SelectorManager=Tn;e.InlineSelector=xl;e.InlineSelectorCondition=Sn;e.InlineSelectorHtml=Bn;e.SaveStateCheckbox=eo;e.MenuSelector=No;e.UserSelector=Vo;e.FileSelector=Rc;e.TimeSelector=cu;e.DelayInterval=Vt;e.DelayIntervalSelector=Yu;e.HelpHint=qt;e.SelectorContext=np;e.AutomationGlobals=Pp;e.Statuses=xp;e.SelectorItemsManager=Gd;e.Helper=Ee;e.BeginningGuide=Wd;e.AutomationGuide=pb;e.RobotEntry=ci;e.TriggerEntry=ui;e.TrackingEntryBuilder=hi;e.TrackingEntry=ti;e.TrackingStatus=ii;e.Tracker=wi;e.WorkflowStatus=Jt})(this.BX.Bizproc.Automation=this.BX.Bizproc.Automation||{},BX.UI,BX,BX.Bizproc,BX,BX.UI.DragAndDrop,BX.UI.EntitySelector,BX.Event,BX.Main,BX.UI,BX.Main,BX,BX,BX,BX.Bizproc,BX.Bizproc.Automation,BX,BX,BX,BX.UI.Tour);
//# sourceMappingURL=automation.bundle.map.js