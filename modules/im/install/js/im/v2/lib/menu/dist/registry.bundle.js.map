{"version":3,"file":"registry.bundle.js","sources":["../src/base/base.js","../src/recent/invite-manager.js","../src/recent/recent.js"],"sourcesContent":["import { Type } from 'main.core';\nimport {MenuManager, Menu} from 'main.popup';\nimport {EventEmitter} from 'main.core.events';\nimport {Store} from 'ui.vue3.vuex';\nimport {RestClient} from 'rest.client';\n\nimport {Core} from 'im.v2.application.core';\nimport {EventType} from 'im.v2.const';\n\nimport type {MenuItem} from '../type/menu';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Lib.Menu';\n\nexport class BaseMenu extends EventEmitter\n{\n\tmenuInstance: Menu;\n\tcontext: Object;\n\ttarget: HTMLElement;\n\tstore: Store;\n\trestClient: RestClient;\n\tid: String = 'im-base-context-menu';\n\n\tstatic events = {\n\t\tonCloseMenu: 'onCloseMenu'\n\t};\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\n\t\tthis.onClosePopupHandler = this.onClosePopup.bind(this);\n\t}\n\n\t// public\n\topenMenu(context: Object, target: HTMLElement)\n\t{\n\t\tif (this.menuInstance)\n\t\t{\n\t\t\tthis.close();\n\t\t}\n\t\tthis.context = context;\n\t\tthis.target = target;\n\t\tthis.menuInstance = this.getMenuInstance();\n\t\tthis.menuInstance.show();\n\n\t\t// EventEmitter.subscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t}\n\n\tgetMenuInstance(): Menu\n\t{\n\t\treturn MenuManager.create(this.getMenuOptions());\n\t}\n\n\tgetMenuOptions(): Object\n\t{\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tbindOptions: {forceBindPosition: true, position: 'bottom'},\n\t\t\ttargetContainer: document.body,\n\t\t\tbindElement: this.target,\n\t\t\tcacheable: false,\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\titems: this.#prepareMenuItems(),\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.emit(BaseMenu.events.onCloseMenu);\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [];\n\t}\n\n\tgetMenuClassName(): string\n\t{\n\t\treturn '';\n\t}\n\n\tonClosePopup()\n\t{\n\t\tthis.close();\n\t}\n\n\tclose()\n\t{\n\t\t// EventEmitter.unsubscribe(EventType.dialog.closePopup, this.onClosePopupHandler);\n\t\tif (!this.menuInstance)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.menuInstance.destroy();\n\t\tthis.menuInstance = null;\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.close();\n\t}\n\n\tgetCurrentUserId(): number\n\t{\n\t\treturn Core.getUserId();\n\t}\n\n\t#prepareMenuItems(): MenuItem[]\n\t{\n\t\treturn this.#filterExcessDelimiters(this.getMenuItems());\n\t}\n\n\t#filterExcessDelimiters(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tconst menuItemsWithoutDuplicates = this.#filterDuplicateDelimiters(menuItems);\n\n\t\treturn this.#filterFinishingDelimiter(menuItemsWithoutDuplicates);\n\t}\n\n\t#filterDuplicateDelimiters(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tlet previousElement = null;\n\n\t\treturn menuItems.filter((element) => {\n\t\t\tif (this.#isDelimiter(previousElement) && this.#isDelimiter(element))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element !== null)\n\t\t\t{\n\t\t\t\tpreviousElement = element;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\t#filterFinishingDelimiter(menuItems: MenuItem[]): MenuItem[]\n\t{\n\t\tlet previousElement = null;\n\n\t\treturn menuItems.reverse().filter((element) => {\n\t\t\tif (previousElement === null && this.#isDelimiter(element))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element !== null)\n\t\t\t{\n\t\t\t\tpreviousElement = element;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}).reverse();\n\t}\n\n\t#isDelimiter(element: ?MenuItem): boolean\n\t{\n\t\treturn Type.isObjectLike(element) && element.delimiter === true;\n\t}\n}\n","import {ajax as Ajax, Loc} from 'main.core';\n\nconst resendAction = 'intranet.controller.invite.reinvite';\nconst cancelAction = 'intranet.controller.invite.deleteinvitation';\n\nexport const InviteManager = {\n\tresendInvite(userId: number)\n\t{\n\t\tconst data = {\n\t\t\tparams: {userId}\n\t\t};\n\t\tAjax.runAction(resendAction, {data}).then(() => {\n\t\t\tthis.showNotification(Loc.getMessage('IM_LIB_MENU_INVITE_RESEND_DONE'), 2000);\n\t\t}, (error) => {\n\t\t\tthis.handleActionError(error);\n\t\t});\n\t},\n\n\tcancelInvite(userId: number)\n\t{\n\t\tconst data = {\n\t\t\tparams: {userId}\n\t\t};\n\t\tAjax.runAction(cancelAction, {data}).then(() => {\n\t\t\tthis.showNotification(Loc.getMessage('IM_LIB_MENU_INVITE_CANCEL_DONE'), 2000);\n\t\t}, (error) => {\n\t\t\tthis.handleActionError(error);\n\t\t});\n\t},\n\n\tshowNotification(text: string, autoHideDelay: number = 4000)\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: text,\n\t\t\tautoHideDelay\n\t\t});\n\t},\n\n\thandleActionError(error: Object)\n\t{\n\t\tif (error.status === 'error' && error.errors.length > 0)\n\t\t{\n\t\t\tconst errorContent = error.errors.map((element) => {\n\t\t\t\treturn element.message;\n\t\t\t}).join('. ');\n\t\t\tthis.showNotification(errorContent);\n\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.showNotification(Loc.getMessage('IM_LIST_RECENT_CONNECT_ERROR'));\n\t}\n};","import { MessengerSlider } from 'im.v2.lib.slider';\nimport { Loc, Type } from 'main.core';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\n\nimport { Core } from 'im.v2.application.core';\nimport { ChatActionType, PathPlaceholder } from 'im.v2.const';\nimport { CallManager } from 'im.v2.lib.call';\nimport { ChatService, RecentService } from 'im.v2.provider.service';\nimport { Utils } from 'im.v2.lib.utils';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { showLeaveFromChatConfirm } from 'im.v2.lib.confirm';\nimport { Messenger } from 'im.public';\n\nimport { BaseMenu } from '../base/base';\nimport { InviteManager } from './invite-manager';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\nimport type { ImModelRecentItem } from 'im.v2.model';\n\nexport class RecentMenu extends BaseMenu\n{\n\tcontext: ImModelRecentItem;\n\tcallManager: CallManager;\n\tpermissionManager: PermissionManager;\n\tchatService: ChatService;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-recent-context-menu';\n\t\tthis.chatService = new ChatService();\n\t\tthis.callManager = CallManager.getInstance();\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetMenuOptions(): Object\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: true,\n\t\t\toffsetLeft: 32,\n\t\t};\n\t}\n\n\tgetMenuClassName(): string\n\t{\n\t\treturn this.context.compactMode ? '' : super.getMenuClassName();\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\tif (this.context.invitation.isActive)\n\t\t{\n\t\t\treturn this.getInviteItems();\n\t\t}\n\n\t\treturn [\n\t\t\tthis.getOpenItem(),\n\t\t\tthis.getUnreadMessageItem(),\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getMuteItem(),\n\t\t\tthis.getCallItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getHideItem(),\n\t\t\tthis.getLeaveItem(),\n\t\t];\n\t}\n\n\tgetSendMessageItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_WRITE'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN'),\n\t\t\tonclick: () => {\n\t\t\t\tMessenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenInNewTabItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_IN_NEW_TAB'),\n\t\t\tonclick: () => {\n\t\t\t\tMessengerSlider.getInstance().openNewTab(\n\t\t\t\t\tPathPlaceholder.dialog.replace('#DIALOG_ID#', this.context.dialogId),\n\t\t\t\t);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetUnreadMessageItem(): MenuItem\n\t{\n\t\tconst dialog = this.store.getters['dialogues/get'](this.context.dialogId, true);\n\t\tconst showReadOption = this.context.unread || dialog.counter > 0;\n\n\t\treturn {\n\t\t\ttext: showReadOption ? Loc.getMessage('IM_LIB_MENU_READ') : Loc.getMessage('IM_LIB_MENU_UNREAD'),\n\t\t\tonclick: () => {\n\t\t\t\tif (showReadOption)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.readDialog(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unreadDialog(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetPinMessageItem(): MenuItem\n\t{\n\t\tconst isPinned = this.context.pinned;\n\n\t\treturn {\n\t\t\ttext: isPinned ? Loc.getMessage('IM_LIB_MENU_UNPIN') : Loc.getMessage('IM_LIB_MENU_PIN'),\n\t\t\tonclick: () => {\n\t\t\t\tif (isPinned)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unpinChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.pinChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetMuteItem(): ?MenuItem\n\t{\n\t\tconst canMute = this.permissionManager.canPerformAction(ChatActionType.mute, this.context.dialogId);\n\t\tif (!canMute)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst dialog = this.store.getters['dialogues/get'](this.context.dialogId, true);\n\t\tconst isMuted = dialog.muteList.includes(Core.getUserId());\n\n\t\treturn {\n\t\t\ttext: isMuted ? Loc.getMessage('IM_LIB_MENU_UNMUTE_2') : Loc.getMessage('IM_LIB_MENU_MUTE_2'),\n\t\t\tonclick: () => {\n\t\t\t\tif (isMuted)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.unmuteChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.muteChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCallItem(): ?MenuItem\n\t{\n\t\tconst chatCanBeCalled = this.callManager.chatCanBeCalled(this.context.dialogId);\n\t\tconst chatIsAllowedToCall = this.permissionManager.canPerformAction(ChatActionType.call, this.context.dialogId);\n\t\tif (!chatCanBeCalled || !chatIsAllowedToCall)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_CALL_2'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.callManager.startCall(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenProfileItem(): ?MenuItem\n\t{\n\t\tconst isUser = this.store.getters['dialogues/isUser'](this.context.dialogId);\n\t\tif (!isUser)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_OPEN_PROFILE'),\n\t\t\thref: profileUri,\n\t\t\tonclick: () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetHideItem(): ?MenuItem\n\t{\n\t\tif (this.context.invitation?.isActive || this.context.options?.default_user_record)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_HIDE'),\n\t\t\tonclick: () => {\n\t\t\t\tRecentService.getInstance().hideChat(this.context.dialogId);\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetLeaveItem(): ?MenuItem\n\t{\n\t\tconst canLeaveChat = this.permissionManager.canPerformAction(ChatActionType.leave, this.context.dialogId);\n\t\tif (!canLeaveChat)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_LEAVE'),\n\t\t\tonclick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showLeaveFromChatConfirm();\n\t\t\t\tif (userChoice === true)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.leaveChat(this.context.dialogId);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\t// invitation\n\tgetInviteItems(): Array\n\t{\n\t\tconst items = [\n\t\t\tthis.getSendMessageItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t];\n\n\t\tlet canInvite; // TODO change to APPLICATION variable\n\t\tif (Type.isUndefined(BX.MessengerProxy))\n\t\t{\n\t\t\tcanInvite = true;\n\t\t\tconsole.error('BX.MessengerProxy.canInvite() method not found in v2 version!');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcanInvite = BX.MessengerProxy.canInvite();\n\t\t}\n\n\t\tconst canManageInvite = canInvite && Core.getUserId() === this.context.invitation.originator;\n\t\tif (canManageInvite)\n\t\t{\n\t\t\titems.push(\n\t\t\t\tthis.getDelimiter(),\n\t\t\t\tthis.context.invitation.canResend ? this.getResendInviteItem() : null,\n\t\t\t\tthis.getCancelInviteItem(),\n\t\t\t);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetResendInviteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_INVITE_RESEND'),\n\t\t\tonclick: () => {\n\t\t\t\tInviteManager.resendInvite(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCancelInviteItem(): MenuItem\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_LIB_MENU_INVITE_CANCEL'),\n\t\t\tonclick: () => {\n\t\t\t\tMessageBox.show({\n\t\t\t\t\tmessage: Loc.getMessage('IM_LIB_MENU_INVITE_CANCEL_CONFIRM'),\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\t\tInviteManager.cancelInvite(this.context.dialogId);\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: (messageBox) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\t// invitation end\n\n\tgetDelimiter(): Object\n\t{\n\t\treturn { delimiter: true };\n\t}\n}\n"],"names":["EVENT_NAMESPACE","BaseMenu","EventEmitter","constructor","id","setEventNamespace","store","Core","getStore","restClient","getRestClient","onClosePopupHandler","onClosePopup","bind","openMenu","context","target","menuInstance","close","getMenuInstance","show","MenuManager","create","getMenuOptions","bindOptions","forceBindPosition","position","targetContainer","document","body","bindElement","cacheable","className","getMenuClassName","items","events","onClose","emit","onCloseMenu","getMenuItems","destroy","getCurrentUserId","getUserId","menuItems","menuItemsWithoutDuplicates","previousElement","filter","element","reverse","Type","isObjectLike","delimiter","resendAction","cancelAction","InviteManager","resendInvite","userId","data","params","Ajax","runAction","then","showNotification","Loc","getMessage","error","handleActionError","cancelInvite","text","autoHideDelay","BX","UI","Notification","Center","notify","content","status","errors","length","errorContent","map","message","join","RecentMenu","chatService","ChatService","callManager","CallManager","getInstance","permissionManager","PermissionManager","angle","offsetLeft","compactMode","invitation","isActive","getInviteItems","getOpenItem","getUnreadMessageItem","getPinMessageItem","getMuteItem","getCallItem","getOpenProfileItem","getHideItem","getLeaveItem","getSendMessageItem","onclick","Messenger","openChat","dialogId","getOpenInNewTabItem","MessengerSlider","openNewTab","PathPlaceholder","dialog","replace","getters","showReadOption","unread","counter","readDialog","unreadDialog","isPinned","pinned","unpinChat","pinChat","canMute","canPerformAction","ChatActionType","mute","isMuted","muteList","includes","unmuteChat","muteChat","chatCanBeCalled","chatIsAllowedToCall","call","startCall","isUser","profileUri","Utils","user","getProfileLink","href","options","default_user_record","RecentService","hideChat","canLeaveChat","leave","userChoice","showLeaveFromChatConfirm","leaveChat","canInvite","isUndefined","MessengerProxy","console","canManageInvite","originator","push","getDelimiter","canResend","getResendInviteItem","getCancelInviteItem","MessageBox","modal","buttons","MessageBoxButtons","OK_CANCEL","onOk","messageBox","onCancel"],"mappings":"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"}