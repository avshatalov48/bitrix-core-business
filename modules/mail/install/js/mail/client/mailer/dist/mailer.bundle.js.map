{"version":3,"file":"mailer.bundle.js","sources":["../src/mailer.js"],"sourcesContent":["import { FilterToolbar } from 'mail.client.filtertoolbar';\nimport { Binding } from 'mail.client.binding';\nimport { BaseEvent, EventEmitter } from \"main.core.events\";\n\nexport class Mailer\n{\n\t#filter;\n\t#filterToolbar;\n\t#binding;\n\t#mailboxId;\n\tfocusReset = false;\n\n\tconstructor(config ={\n\t\tfilterId: '',\n\t\tmailboxId: 0,\n\t\tsyncAvailable: true,\n\t})\n\t{\n\t\t//delete the loader (the envelope is bouncing)\n\t\tlet elements = top.document.getElementsByClassName('mail-loader-modifier');\n\t\tfor (let element of elements)\n\t\t{\n\t\t\telement.classList.remove('mail-loader-modifier');\n\t\t}\n\n\t\tthis.#mailboxId = config['mailboxId'];\n\t\tthis.#filter = BX.Main.filterManager.getById(config['filterId']);\n\n\t\tthis.sendApplyFilterEventForMenuRefresh();\n\n\t\t//Removing the focus from the filter field\n\t\tif (document.activeElement)\n\t\t{\n\t\t\tdocument.activeElement.blur();\n\t\t}\n\n\t\tconst mailCounterWrapper = document.querySelector('[data-role=\"mail-counter-toolbar\"]');\n\n\t\tconst filterToolbar = new FilterToolbar({\n\t\t\twrapper: mailCounterWrapper,\n\t\t\tfilter: this.#filter,\n\t\t});\n\n\t\tfilterToolbar.build();\n\t\tthis.#filterToolbar = filterToolbar;\n\n\t\tthis.#binding = new Binding(this.#mailboxId);\n\t\tBinding.initButtons();\n\n\t\tEventEmitter.subscribe('Grid::updated', (event) => {\n\t\t\tconst [grid] = event.getCompatData();\n\t\t\tif(grid !== {} && grid !== undefined && BX.Mail.Home.Grid.getId() === grid.getId())\n\t\t\t{\n\t\t\t\tBinding.initButtons();\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', (event) => {\n\t\t\tlet dir = this.#filter.getFilterFieldsValues()['DIR'];\n\t\t\tBX.Mail.Home.Counters.setDirectory(dir);\n\t\t});\n\n\t\tif(!config['syncAvailable'])\n\t\t{\n\t\t\ttop.BX.UI.InfoHelper.show('limit_contact_center_mail_box_number');\n\t\t\tlet lock = false;\n\t\t\tconst handler  = () => {\n\t\t\t\tif(!lock)\n\t\t\t\t{\n\t\t\t\t\tlock = true;\n\t\t\t\t\ttop.BX.removeCustomEvent(\"SidePanel.Slider:onCloseComplete\", handler);\n\t\t\t\t\ttop.BX.SidePanel.Instance.close();\n\t\t\t\t}\n\t\t\t}\n\t\t\ttop.BX.addCustomEvent(\"SidePanel.Slider:onCloseComplete\", handler);\n\t\t}\n\t}\n\n\tsendApplyFilterEventForMenuRefresh()\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tsetTimeout(function ()\n\t\t\t{\n\t\t\t\tEventEmitter.emit('BX.Main.Filter:apply', new BaseEvent());\n\t\t\t},1);\n\t\t}\n\t}\n\n\tsetFilterDir(name)\n\t{\n\t\tif (!!this.#filter && (this.#filter instanceof BX.Main.Filter))\n\t\t{\n\t\t\tconst FilterApi = this.#filter.getApi();\n\t\t\tFilterApi.setFields({\n\t\t\t\t'DIR': name,\n\t\t\t});\n\t\t\tFilterApi.apply();\n\t\t}\n\t}\n\n\tgetFilterToolbar()\n\t{\n\t\treturn this.#filterToolbar;\n\t}\n}"],"names":["Mailer","config","filterId","mailboxId","syncAvailable","elements","top","document","getElementsByClassName","element","classList","remove","BX","Main","filterManager","getById","sendApplyFilterEventForMenuRefresh","activeElement","blur","mailCounterWrapper","querySelector","filterToolbar","FilterToolbar","wrapper","filter","build","Binding","initButtons","EventEmitter","subscribe","event","getCompatData","grid","undefined","Mail","Home","Grid","getId","dir","getFilterFieldsValues","Counters","setDirectory","UI","InfoHelper","show","lock","handler","removeCustomEvent","SidePanel","Instance","close","addCustomEvent","Filter","setTimeout","emit","BaseEvent","name","FilterApi","getApi","setFields","apply"],"mappings":"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"}