{"version":3,"file":"backend.bundle.js","sources":["../src/backend.js"],"sourcesContent":["import {Uri, Cache, Loc, Reflection, Type, Http, ajax, Text} from 'main.core';\nimport {Env} from 'landing.env';\nimport type {Block, Landing, Site, Template, CreatePageOptions, SourceResponse, PreparedResponse} from './types';\n\nlet additionalRequestCompleted = true;\n\n/**\n * @memberOf BX.Landing\n */\nexport class Backend\n{\n\tstatic +instance: Backend = null;\n\tstatic getInstance(): Backend\n\t{\n\t\tif (!Backend.instance)\n\t\t{\n\t\t\tBackend.instance = new Backend();\n\t\t}\n\n\t\treturn Backend.instance;\n\t}\n\n\tstatic makeResponse(xhr: XMLHttpRequest, sourceResponse: SourceResponse = {}): PreparedResponse\n\t{\n\t\tconst type = (() => {\n\t\t\tif (Type.isStringFilled(sourceResponse.type))\n\t\t\t{\n\t\t\t\treturn sourceResponse.type;\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(sourceResponse) && Object.values(sourceResponse).length > 0)\n\t\t\t{\n\t\t\t\tconst allSuccess = Object.values(sourceResponse).every((item) => {\n\t\t\t\t\treturn item.type === 'success';\n\t\t\t\t});\n\n\t\t\t\tif (allSuccess)\n\t\t\t\t{\n\t\t\t\t\treturn 'success';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Type.isArray(sourceResponse))\n\t\t\t{\n\t\t\t\treturn 'other';\n\t\t\t}\n\n\t\t\treturn 'error';\n\t\t})();\n\n\t\tif (type === 'other')\n\t\t{\n\t\t\treturn sourceResponse;\n\t\t}\n\n\t\treturn {\n\t\t\tresult: null,\n\t\t\ttype,\n\t\t\t...sourceResponse,\n\t\t\tstatus: xhr.status,\n\t\t\tauthorized: xhr.getResponseHeader('X-Bitrix-Ajax-Status') !== 'Authorize',\n\t\t};\n\t}\n\n\tstatic request({url, data}): Promise<any, any>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst fd = data instanceof FormData ? data : Http.Data.convertObjectToFormData(data);\n\t\t\tconst xhr = ajax({\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\turl,\n\t\t\t\tdata: fd,\n\t\t\t\tstart: false,\n\t\t\t\tpreparePost: false,\n\t\t\t\tonsuccess: (sourceResponse) => {\n\t\t\t\t\tconst response = Backend.makeResponse(xhr, sourceResponse);\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tType.isStringFilled(response.sessid) &&\n\t\t\t\t\t\tLoc.getMessage('bitrix_sessid') !== response.sessid &&\n\t\t\t\t\t\tadditionalRequestCompleted\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tLoc.setMessage('bitrix_sessid', response.sessid);\n\t\t\t\t\t\tadditionalRequestCompleted = false;\n\n\t\t\t\t\t\tconst newData = {...data, sessid: Loc.getMessage('bitrix_sessid')};\n\n\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t.request({url, data: newData})\n\t\t\t\t\t\t\t.then((newResponse) => {\n\t\t\t\t\t\t\t\tadditionalRequestCompleted = true;\n\t\t\t\t\t\t\t\tresolve(newResponse);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((newResponse) => {\n\t\t\t\t\t\t\t\tadditionalRequestCompleted = true;\n\t\t\t\t\t\t\t\treject(newResponse);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!Type.isPlainObject(response))\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tresponse.type === 'error'\n\t\t\t\t\t\t|| response.authorized === false\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (response.authorized === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttop.window.location.reload();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(response);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(response);\n\t\t\t\t},\n\t\t\t\tonfailure: (sourceResponse) => {\n\t\t\t\t\tif (sourceResponse === 'auth')\n\t\t\t\t\t{\n\t\t\t\t\t\ttop.window.location.reload();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(\n\t\t\t\t\t\t\tBackend.makeResponse(xhr, sourceResponse),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\n\t\t\txhr.send(fd);\n\t\t});\n\t}\n\n\tcache = new Cache.MemoryCache();\n\n\tgetControllerUrl(): string\n\t{\n\t\treturn this.cache.remember('controllerUrl', () => {\n\t\t\tconst uri = new Uri('/bitrix/tools/landing/ajax.php');\n\t\t\turi.setQueryParams({\n\t\t\t\tsite: Loc.getMessage('SITE_ID') || undefined,\n\t\t\t\ttype: this.getSitesType(),\n\t\t\t});\n\t\t\treturn uri.toString();\n\t\t});\n\t}\n\n\tgetSiteId(): number\n\t{\n\t\treturn this.cache.remember('siteId', () => {\n\t\t\tconst landing = Reflection.getClass('BX.Landing.Main');\n\n\t\t\tif (landing)\n\t\t\t{\n\t\t\t\tconst instance = landing.getInstance();\n\n\t\t\t\tif (\n\t\t\t\t\t'options' in instance\n\t\t\t\t\t&& 'site_id' in instance.options\n\t\t\t\t\t&& !Type.isUndefined(instance.options.site_id)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn instance.options.site_id;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn -1;\n\t\t});\n\t}\n\n\tgetLandingId(): number\n\t{\n\t\treturn this.cache.remember('landingId', () => {\n\t\t\tconst landing = Reflection.getClass('BX.Landing.Main');\n\n\t\t\tif (landing)\n\t\t\t{\n\t\t\t\treturn landing.getInstance().id;\n\t\t\t}\n\n\t\t\treturn -1;\n\t\t});\n\t}\n\n\tgetSitesType(): 'PAGE' | 'STORE'\n\t{\n\t\treturn this.cache.remember('siteType', () => {\n\t\t\treturn Env.getInstance().getType();\n\t\t});\n\t}\n\n\taction(\n\t\taction: string,\n\t\tdata: {[key: string]: any} = {},\n\t\tqueryParams = {},\n\t\tuploadParams = {},\n\t): Promise<{[key: string]: any}, any>\n\t{\n\t\tif (!queryParams.site_id)\n\t\t{\n\t\t\tqueryParams.site_id = this.getSiteId();\n\t\t}\n\n\t\tconst requestBody = {\n\t\t\tsessid: Loc.getMessage('bitrix_sessid'),\n\t\t\taction: uploadParams.action || action.replace('Landing\\\\Block', 'Block'),\n\t\t\tdata: {...data, uploadParams, lid: data.lid || this.getLandingId()},\n\t\t};\n\n\t\tconst uri = new Uri(this.getControllerUrl());\n\t\turi.setQueryParams({\n\t\t\taction: requestBody.action,\n\t\t\t...queryParams,\n\t\t});\n\n\t\treturn Backend\n\t\t\t.request({\n\t\t\t\turl: uri.toString(),\n\t\t\t\tdata: requestBody,\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tif (\n\t\t\t\t\trequestBody.action === 'Block::updateNodes'\n\t\t\t\t\t|| requestBody.action === 'Block::removeCard'\n\t\t\t\t\t|| requestBody.action === 'Block::cloneCard'\n\t\t\t\t\t|| requestBody.action === 'Block::addCard'\n\t\t\t\t\t|| requestBody.action === 'Block::updateStyles'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tBX.Landing.UI.Panel.StatusPanel.getInstance().update();\n\t\t\t\t}\n\n\t\t\t\tBX.onCustomEvent(\n\t\t\t\t\tBX.Landing.PageObject.getRootWindow(),\n\t\t\t\t\t'BX.Landing.Backend:action',\n\t\t\t\t\t[action, data]\n\t\t\t\t);\n\n\t\t\t\t/*if (!response.result) {\n\t\t\t\t\tBX.Landing.ErrorManager.getInstance().add({\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}*/\n\n\t\t\t\treturn response.result;\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tif (\n\t\t\t\t\trequestBody.action !== 'Landing::downBlock'\n\t\t\t\t\t&& requestBody.action !== 'Landing::upBlock'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tif (\n\t\t\t\t\t\trequestBody.action !== 'Block::getById'\n\t\t\t\t\t\t&& requestBody.action !== 'Block::publication'\n\t\t\t\t\t\t&& requestBody.action !== 'Landing::move'\n\t\t\t\t\t\t&& requestBody.action !== 'Landing::copy'\n\t\t\t\t\t\t&& requestBody.action !== 'Landing::publication'\n\t\t\t\t\t\t&& requestBody.action !== 'Site::publication'\n\t\t\t\t\t\t&& requestBody.action !== 'Site::moveFolder'\n\t\t\t\t\t\t&& requestBody.action !== 'Site::markDelete'\n\t\t\t\t\t\t&& requestBody.action !== 'Vk::getVideoInfo'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst error = Type.isString(err) ? {type: 'error'} : err;\n\t\t\t\t\t\terr.action = requestBody.action;\n\n\t\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\t\tBX.Landing.ErrorManager.getInstance().add(error);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tbatch(action, data = {}, queryParams = {}): Promise<{[key: string]: any}, any>\n\t{\n\t\tqueryParams.site_id = this.getSiteId();\n\n\t\tconst requestBody = {\n\t\t\tsessid: Loc.getMessage('bitrix_sessid'),\n\t\t\taction: action.replace('Landing\\\\Block', 'Block'),\n\t\t\tdata: {lid: data.lid || this.getLandingId()},\n\t\t\tbatch: data,\n\t\t};\n\n\t\tconst uri = new Uri(this.getControllerUrl());\n\t\turi.setQueryParams({\n\t\t\taction: requestBody.action,\n\t\t\t...queryParams,\n\t\t});\n\n\t\treturn Backend\n\t\t\t.request({\n\t\t\t\turl: uri.toString(),\n\t\t\t\tdata: requestBody,\n\t\t\t})\n\t\t\t.then((response) => {\n\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tBX.Landing.UI.Panel.StatusPanel.getInstance().update();\n\n\t\t\t\tBX.onCustomEvent(\n\t\t\t\t\tBX.Landing.PageObject.getRootWindow(),\n\t\t\t\t\t'BX.Landing.Backend:batch',\n\t\t\t\t\t[action, data]\n\t\t\t\t);\n\n\t\t\t\t/*if (!response.result) {\n\t\t\t\t\tBX.Landing.ErrorManager.getInstance().add({\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}*/\n\n\t\t\t\treturn response;\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tif (\n\t\t\t\t\trequestBody.action !== 'Landing::downBlock'\n\t\t\t\t\t&& requestBody.action !== 'Landing::upBlock'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tif (requestBody.action !== 'Block::getById')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst error = Type.isString(err) ? {type: 'error'} : err;\n\t\t\t\t\t\terror.action = requestBody.action;\n\t\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\t\tBX.Landing.ErrorManager.getInstance().add(error);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tupload(file: File | Blob, uploadParams = {}): Promise<{[key: string]: any}, any>\n\t{\n\t\tconst formData = new FormData();\n\n\t\tformData.append('sessid', Loc.getMessage('bitrix_sessid'));\n\t\tformData.append('picture', file, file.name);\n\n\t\tif ('block' in uploadParams)\n\t\t{\n\t\t\tformData.append('action', 'Block::uploadFile');\n\t\t\tformData.append('data[block]', uploadParams.block);\n\t\t}\n\n\t\tif ('lid' in uploadParams)\n\t\t{\n\t\t\tformData.set('action', 'Landing::uploadFile');\n\t\t\tformData.append('data[lid]', uploadParams.lid);\n\t\t}\n\n\t\tif ('id' in uploadParams)\n\t\t{\n\t\t\tformData.set('action', 'Site::uploadFile');\n\t\t\tformData.append('data[id]', uploadParams.id);\n\t\t}\n\n\t\tif ('temp' in uploadParams)\n\t\t{\n\t\t\tformData.append('data[temp]', true);\n\t\t}\n\n\t\tconst uri = new Uri(this.getControllerUrl());\n\t\turi.setQueryParams({\n\t\t\taction: formData.get('action'),\n\t\t\tsite_id: this.getSiteId(),\n\t\t});\n\n\t\tif (uploadParams.context)\n\t\t{\n\t\t\turi.setQueryParam('context', uploadParams.context);\n\t\t}\n\n\t\treturn Backend\n\t\t\t.request({\n\t\t\t\turl: uri.toString(),\n\t\t\t\tdata: formData,\n\t\t\t})\n\t\t\t.then((response) => response.result)\n\t\t\t.catch((err) => {\n\t\t\t\tconst error = Type.isString(err) ? {type: 'error'} : err;\n\t\t\t\terror.action = 'Block::uploadFile';\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tBX.Landing.ErrorManager.getInstance().add(error);\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t}\n\n\tgetSites({filter = {}} = {}): Promise<Array<Site>>\n\t{\n\t\treturn this.cache.remember(`sites+${JSON.stringify(filter)}`, () => {\n\t\t\treturn this\n\t\t\t\t.action('Site::getList', {\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tfilter,\n\t\t\t\t\t\torder: {ID: 'DESC'}\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((response) => response);\n\t\t});\n\t}\n\n\tgetLandings({siteId = []}: {siteId?: number | Array<number>} = {}, filter: {}): Promise<Array<Landing>>\n\t{\n\t\tlet skipFilter = false;\n\t\tif (!BX.Type.isPlainObject(filter))\n\t\t{\n\t\t\tfilter = {};\n\t\t\tskipFilter = true;\n\t\t}\n\n\t\tconst ids = Type.isArray(siteId) ? siteId : [siteId];\n\t\tfilter.SITE_ID = ids;\n\n\t\tconst getBathItem = (id) => ({\n\t\t\taction: 'Landing::getList',\n\t\t\tdata: {\n\t\t\t\tparams: {\n\t\t\t\t\tfilter: (() => {\n\t\t\t\t\t\tif (skipFilter)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tSITE_ID: id,\n\t\t\t\t\t\t\t\tDELETED: 'N',\n\t\t\t\t\t\t\t\tFOLDER: 'N',\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn filter;\n\t\t\t\t\t})(),\n\t\t\t\t\torder: {ID: 'DESC'},\n\t\t\t\t\tget_preview: true,\n\t\t\t\t\tcheck_area: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tconst prepareResponse = (response) => {\n\t\t\treturn response.reduce((acc, item) => {\n\t\t\t\treturn [...acc, ...item.result];\n\t\t\t}, []);\n\t\t};\n\n\t\treturn this.cache.remember(`landings+${JSON.stringify(ids)}`, () => {\n\t\t\tif (ids.filter((id) => !Type.isNil(id)).length === 0)\n\t\t\t{\n\t\t\t\treturn this.getSites()\n\t\t\t\t\t.then((sites) => {\n\t\t\t\t\t\tconst data = sites.map((site) => getBathItem(site.ID));\n\t\t\t\t\t\treturn this.batch('Landing::getList', data);\n\t\t\t\t\t})\n\t\t\t\t\t.then((response) => prepareResponse(response))\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tresponse.forEach((landing) => {\n\t\t\t\t\t\t\tthis.cache.set(`landing+${landing.ID}`, Promise.resolve(landing));\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst data = ids.map((id) => getBathItem(id));\n\t\t\treturn this.batch('Landing::getList', data)\n\t\t\t\t.then((response) => prepareResponse(response))\n\t\t\t\t.then((response) => {\n\t\t\t\t\tresponse.forEach((landing) => {\n\t\t\t\t\t\tthis.cache.set(`landing+${landing.ID}`, Promise.resolve(landing));\n\t\t\t\t\t});\n\t\t\t\t\treturn response;\n\t\t\t\t});\n\t\t});\n\t}\n\n\tgetLanding({landingId}: {landingId: string}): Promise<Landing>\n\t{\n\t\treturn this.cache.remember(`landing+${landingId}`, () => {\n\t\t\treturn this\n\t\t\t\t.action('Landing::getList', {\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tfilter: {ID: landingId},\n\t\t\t\t\t\tget_preview: true,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((response) => {\n\t\t\t\t\tif (Type.isArray(response) && response.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn response[0];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\t\t});\n\t}\n\n\tgetBlocks({landingId}: {landingId: string}): Promise<Array<Block>>\n\t{\n\t\treturn this.cache.remember(`blocks+${landingId}`, () => {\n\t\t\treturn this\n\t\t\t\t.action('Block::getList', {\n\t\t\t\t\tlid: landingId,\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tget_content: true,\n\t\t\t\t\t\tedit_mode: true,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.then((blocks) => {\n\t\t\t\t\tblocks.forEach((block) => {\n\t\t\t\t\t\tthis.cache.set(`block+${block.id}`, Promise.resolve(block));\n\t\t\t\t\t});\n\n\t\t\t\t\treturn blocks;\n\t\t\t\t});\n\t\t});\n\t}\n\n\tgetBlock({blockId}: {blockId: string}): Promise<Block>\n\t{\n\t\treturn this.cache.remember(`blockId+${blockId}`, () => {\n\t\t\treturn this.action('Block::getById', {\n\t\t\t\tblock: blockId,\n\t\t\t\tparams: {\n\t\t\t\t\tedit_mode: true,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTemplates({type = 'page', filter = {}} = {}): Promise<Array<Template>>\n\t{\n\t\treturn this.cache.remember(`templates+${JSON.stringify(filter)}`, () => {\n\t\t\treturn this\n\t\t\t\t.action('Demos::getPageList', {type, filter})\n\t\t\t\t.then((response) => Object.values(response));\n\t\t});\n\t}\n\n\tgetDynamicTemplates(sourceId: string = ''): Promise<Array<Template>>\n\t{\n\t\treturn this.cache.remember(`dynamicTemplates:${sourceId}`, () => {\n\t\t\treturn this.getTemplates({filter: {section: `dynamic${sourceId ? `:${sourceId}` : ''}`}});\n\t\t});\n\t}\n\n\tcreatePage(options: CreatePageOptions = {})\n\t{\n\t\tconst envOptions = Env.getInstance().getOptions();\n\t\tconst {\n\t\t\ttitle,\n\t\t\tsiteId = envOptions.site_id,\n\t\t\tsiteType = envOptions.params.type,\n\t\t\tcode = Text.getRandom(16),\n\t\t\tblockId,\n\t\t\tmenuCode,\n\t\t\tfolderId,\n\t\t} = options;\n\n\t\tconst templateCode = (() => {\n\t\t\tconst {theme} = envOptions;\n\t\t\tif (\n\t\t\t\tType.isPlainObject(theme)\n\t\t\t\t&& Type.isArray(theme.newPageTemplate)\n\t\t\t\t&& Type.isStringFilled(theme.newPageTemplate[0])\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn theme.newPageTemplate[0];\n\t\t\t}\n\n\t\t\treturn 'empty';\n\t\t})();\n\n\t\tconst requestBody = {\n\t\t\tsiteId,\n\t\t\tcode: templateCode,\n\t\t\tfields: {\n\t\t\t\tTITLE: title,\n\t\t\t\tCODE: code,\n\t\t\t\t//@todo: refactor\n\t\t\t\tADD_IN_MENU: (siteType === 'KNOWLEDGE' || siteType === 'GROUP') ? 'Y' : 'N'\n\t\t\t},\n\t\t};\n\n\t\tif (Type.isNumber(blockId) && Type.isString(menuCode))\n\t\t{\n\t\t\trequestBody.fields.BLOCK_ID = blockId;\n\t\t\trequestBody.fields.MENU_CODE = menuCode;\n\t\t}\n\n\t\tif (Type.isNumber(folderId))\n\t\t{\n\t\t\trequestBody.fields.FOLDER_ID = folderId;\n\t\t}\n\n\t\treturn this.action('Landing::addByTemplate', requestBody);\n\t}\n}\n"],"names":["additionalRequestCompleted","Backend","Cache","MemoryCache","cache","remember","uri","Uri","setQueryParams","site","Loc","getMessage","undefined","type","getSitesType","toString","landing","Reflection","getClass","instance","getInstance","options","Type","isUndefined","site_id","id","Env","getType","action","data","queryParams","uploadParams","getSiteId","requestBody","sessid","replace","lid","getLandingId","getControllerUrl","request","url","then","response","BX","Landing","UI","Panel","StatusPanel","update","onCustomEvent","PageObject","getRootWindow","result","err","error","isString","ErrorManager","add","Promise","reject","batch","file","formData","FormData","append","name","block","set","get","context","setQueryParam","filter","JSON","stringify","params","order","ID","siteId","skipFilter","isPlainObject","ids","isArray","SITE_ID","getBathItem","DELETED","FOLDER","get_preview","check_area","prepareResponse","reduce","acc","item","isNil","length","getSites","sites","map","forEach","resolve","landingId","get_content","edit_mode","blocks","blockId","Object","values","sourceId","getTemplates","section","envOptions","getOptions","title","siteType","code","Text","getRandom","menuCode","folderId","templateCode","theme","newPageTemplate","isStringFilled","fields","TITLE","CODE","ADD_IN_MENU","isNumber","BLOCK_ID","MENU_CODE","FOLDER_ID","xhr","sourceResponse","allSuccess","every","status","authorized","getResponseHeader","fd","Http","Data","convertObjectToFormData","ajax","method","dataType","start","preparePost","onsuccess","makeResponse","setMessage","newData","newResponse","top","window","location","reload","onfailure","send"],"mappings":"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"}