(function(e,t,i,a){"use strict";var r,n,o,l,s,p,u,d,b,c,v,g,h,m,y,f,T,I,B,A,O,R,N,x,V,_,P,C,S;var k=t.Reflection.namespace("BX.Bizproc.Activity");var E=function(){function e(i){babelHelpers.classCallCheck(this,e);if(t.Type.isPlainObject(i)){var a,r;this.isRobot=i.isRobot;this.documentType=i.documentType;this.signedDocumentType=i.signedDocumentType;this.variables=i.variables;this.constants=(a=i.constants)!==null&&a!==void 0?a:{};this.documentFields=(r=i.documentFields)!==null&&r!==void 0?r:{};this.currentValues=i.currentValues;this.visibilityMessages=i.visibilityMessages;this.formName=i.formName;this.addRowTable=i.addRowTable}}babelHelpers.createClass(e,[{key:"init",value:function e(){this.initObjectNames();this.initNodeIdNames();this.initNodeAttributeNames();this.initAvailableOptions();this.rowIndex=-1;this.numberOfTypes=9;var t=this.isRobot?"addAssignmentExpressionRobot":"addAssignmentExpressionDesigner";if(Object.keys(this.currentValues).length<=0){this[t]()}for(var i in this.currentValues){this[t](i,this.currentValues[i])}}},{key:"initObjectNames",value:function e(){this.gVarObjectName="GlobalVar";this.gConstObjectName="GlobalConst";this.documentObjectName="Document";this.helperObjectName="Default"}},{key:"isGVariableVisibility",value:function e(t){return t.startsWith(this.gVarObjectName)}},{key:"isGConstantVisibility",value:function e(t){return t.startsWith(this.gConstObjectName)}},{key:"isDocumentVisibility",value:function e(t){return t.startsWith(this.documentObjectName)}},{key:"isHelperVisibility",value:function e(t){return t.startsWith(this.helperObjectName)}},{key:"initNodeIdNames",value:function e(){this.addRowTableNodeId="bp_sgva_addrow_table";this.addButtonNodeId="bp_sgva_add_button";this.hiddenInputsNodeId="bp_sgva_results_";this.variableRole="bp_sgva_variable_";this.parameterRole="bp_sgva_value_"}},{key:"initNodeAttributeNames",value:function e(){this.indexAttributeName="bp_sgva_index";this.inputIndexAttributeName="bp_sgva_input_index"}},{key:"initAvailableOptions",value:function e(){this.availableOptions=this.getAvailableOptions();this.availableOptionsByGroupId=this.getAvailableOptionsByGroup()}},{key:"getAvailableOptions",value:function e(){var t=new Map;this.fillOptions(this.variables,t);this.fillOptions(this.constants,t);this.fillOptions(this.documentFields,t);t.set("variable",{id:"",title:BX.message("BPSGVA_VARIABLE"),customData:{property:{Type:"string",Multiple:false},groupId:this.helperObjectName,title:BX.message("BPSGVA_VARIABLE")}});t.set("parameter",{id:"",title:BX.message("BPSGVA_PARAMETER"),customData:{property:{Type:"string",Multiple:false},groupId:this.helperObjectName,title:BX.message("BPSGVA_PARAMETER")}});t.set("clear",{id:"",title:BX.message("BPSGVA_CLEAR"),customData:{property:{Type:"string",Multiple:false},groupId:this.helperObjectName,title:BX.message("BPSGVA_CLEAR")}});return t}},{key:"fillOptions",value:function e(t,i){var a,r,n;for(var o in t){n=t[o];if(n["children"]){n=n["children"]}for(var l in n){a=n[l]["id"];r=n[l];i.set(a,r)}}}},{key:"getAvailableOptionsByGroup",value:function e(){var t=new Map;this.fillOptionsByGroupWithGlobals(this.variables,t,this.gVarObjectName);this.fillOptionsByGroupWithGlobals(this.constants,t,this.gConstObjectName);var i=[];for(var a in this.documentFields){i.push(this.documentFields[a])}t.set(this.documentObjectName+":"+this.documentObjectName,i);return t}},{key:"fillOptionsByGroupWithGlobals",value:function e(t,i,a){for(var r in t){var n=a+":"+r;i.set(n,t[r])}}},{key:"addAssignmentExpressionRobot",value:function e(i,a){if(t.Type.isString(a)){a={0:a}}var s={variable:i,values:a};this.modifyIncomingDataRobot(s);var p=this.addRowTable;this.rowIndex++;var u=t.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-settings"></div>'])));var d=t.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['<div id="','"></div>'])),this.hiddenInputsNodeId+this.rowIndex);var b=t.Tag.render(o||(o=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div \n\t\t\t\tclass="bizproc-automation-popup-settings bizproc-automation-popup-settings-text" \n\t\t\t\tstyle="display: flex; align-items: flex-start"\n\t\t\t></div>\n\t\t'])));b.appendChild(this.createVariableRowRobot(s.variable,d));var c=t.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-settings-title"></div>'])));c.setAttribute("data-role",this.parameterRole+this.rowIndex);if(s.values.length<=0){var v=BX.clone(this.getOptionPropertiesRobot("clear"));v["multiple"]=s.variable.property.Multiple;v["type"]=s.variable.property.Type;v["inputIndex"]=0;c.appendChild(this.createParameterRowRobot(this.rowIndex,v,d))}for(var g in s.values){var h=BX.clone(s.values[g]);h["multiple"]=s.variable.property.Multiple;h["type"]=s.variable.property.Type;h["inputIndex"]=g;c.appendChild(this.createParameterRowRobot(this.rowIndex,h,d))}if(s.variable.property.Multiple&&s.variable.property.Type!=="user"){c.appendChild(this.createAddParameterRowRobot(this.rowIndex,s.values.length))}b.appendChild(c);u.appendChild(b);u.appendChild(d);p.appendChild(u)}},{key:"modifyIncomingDataRobot",value:function e(t){var i=this.getOptionPropertiesRobot(t.variable);if(t.variable===undefined||i.groupId===this.helperObjectName+":text"){t.variable=BX.clone(this.getOptionPropertiesRobot("variable"));var a=BX.clone(this.getOptionPropertiesRobot("parameter"));t.values=[{id:a.id,title:a.title}];return}var r=[];switch(i.property.Type){case"select":r=this.getIncomingValuesSelect(t);break;case"bool":r=this.getIncomingValuesBool(t);break;default:for(var n in t.values){var o=this.getOptionPropertiesRobot(t.values[n]);if(t.values[n]===""){o=this.getOptionPropertiesRobot("clear")}r.push({id:o.id,title:o.title})}}t.variable=BX.clone(i);t.values=r}},{key:"getOptionPropertiesRobot",value:function e(t){var i=this.availableOptions.get(t);if(i===undefined){return this.getDefaultOptionProperties(t)}return this.getShortOptionProperties(i)}},{key:"getDefaultOptionProperties",value:function e(t){return{id:t,property:{Type:"string",Multiple:false},groupId:this.helperObjectName+":text",title:t}}},{key:"getShortOptionProperties",value:function e(t){return{id:t.id,property:t.customData.property,groupId:t.customData.groupId,title:t.customData.title}}},{key:"getIncomingValuesSelect",value:function e(t){var i=this.getOptionPropertiesRobot(t.variable);var a,r,n=[],o;for(var l in t.values){a=BX.message("BPSGVA_CLEAR");if(t.values[l]!==""){r=this.getOptionPropertiesRobot(t.values[l]);o=true;a=r.title}if(i.property.Options[t.values[l]]!==undefined){o=false;a=i.property.Options[t.values[l]]}n.push({id:t.values[l],title:a,isExpressionOption:o})}return n}},{key:"getIncomingValuesBool",value:function e(t){var i,a,r=[];for(var n in t.values){var o=false;switch(t.values[n]){case"Y":i=BX.message("BPSGVA_BOOL_YES");break;case"N":i=BX.message("BPSGVA_BOOL_NO");break;case"":i=BX.message("BPSGVA_CLEAR");break;default:a=this.getOptionPropertiesRobot(t.values[n]);i=a.title;o=true}r.push({id:t.values[n],title:i,isExpressionOption:o})}return r}},{key:"createVariableRowRobot",value:function e(i,a){var r=t.Tag.render(s||(s=babelHelpers.taggedTemplateLiteral(["<div></div>"])));var n=t.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="bizproc-automation-popup-settings-link setglobalvariableactivity-underline"></span>\n\t\t'])));n.setAttribute("data-role",this.variableRole+this.rowIndex);n.setAttribute(this.indexAttributeName,String(this.rowIndex));var o=this.getDataForTitleReplacement(i,n.getAttribute("data-role"));o.multiple=false;o.type="string";o.inputIndex=0;if(o.title===""){o.title=BX.message("BPSGVA_VARIABLE")}this.replaceTitleAndHiddenInputRobot(n,o,a);BX.bind(n,"click",BX.proxy(this.onVariableSelectClickRobot,this));r.appendChild(n);return r}},{key:"createParameterRowRobot",value:function e(i,a,r){var n=this;var o=t.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings-title setglobalvariableactivity-parameter-wrapper"></div>\n\t\t'])));var l=t.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-popup-settings-title setglobalvariableactivity-symbol-equal"> = </div>\n\t\t'])));var s=t.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(["<div></div>"])));var p=t.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="bizproc-automation-popup-settings-link setglobalvariableactivity-underline"></span>\n\t\t'])));p.setAttribute("data-role",this.parameterRole+i);p.setAttribute(this.indexAttributeName,String(i));p.setAttribute(this.inputIndexAttributeName,String(a.inputIndex));o.appendChild(l);s.appendChild(p);o.appendChild(s);var v=BX.clone(this.getDataForTitleReplacement(a,p.getAttribute("data-role")));v.isExpressionOption=a.isExpressionOption;if(v.title===""){v.title=BX.message("BPSGVA_CLEAR")}this.replaceTitleAndHiddenInputRobot(p,v,r);BX.bind(p,"click",BX.proxy(function(e){n.onParameterSelectClickRobot(e,a.inputIndex)},this));return o}},{key:"getDataForTitleReplacement",value:function e(t,i){return{inputValue:t.id,title:t.title,multiple:t.multiple,type:t.type,inputIndex:t.inputIndex,property:t.property,role:i}}},{key:"replaceTitleAndHiddenInputRobot",value:function e(t,i,a){var r;t.innerText=(r=this.getTitleForReplacement(i))!==null&&r!==void 0?r:i.title;this.replaceHiddenInputRobot(i,a)}},{key:"getTitleForReplacement",value:function e(t){var i=t.type;var a=t.title;var r=t.inputValue;if(i==="bool"){if(["Y","N"].includes(r)){return BX.Bizproc.FieldType.formatValuePrintable({Type:i},r)}return null}return BX.Bizproc.FieldType.formatValuePrintable({Type:i},a)}},{key:"replaceHiddenInputRobot",value:function e(i,a){var r=i.inputValue;var n=i.role+"_input";var o=document.querySelectorAll('[data-role="'+n+'"]');if(o.length>=1&&!i.multiple){o[0].name=i.isExpressionOption?i.role+"_text":i.role;o[0].value=i.inputValue;return}if(o.length>=1&&i.multiple){var l=Object.keys(o);for(var s in l){var p=o[l[s]].getAttribute(this.inputIndexAttributeName);if(i.inputIndex===p){o[s].name=i.isExpressionOption?i.role+"_text":i.role+"[]";o[s].value=i.inputValue;return}}}o=t.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['<input type="hidden"">'])));if(i.isExpressionOption){o.name=i.role+"_text"}else{o.name=i.multiple?i.role+"[]":i.role}o.value=r;o.setAttribute("data-role",n);o.setAttribute(this.inputIndexAttributeName,String(i.inputIndex));a.appendChild(o)}},{key:"onVariableSelectClickRobot",value:function e(t){var i=t.target;var a=this.getVariableInputValue(i.getAttribute("data-role"));var r=i.getAttribute(this.indexAttributeName);var n=this.createFormForMenuRobot("variable",a,r);var o=this;var l=new BX.PopupWindow(i.id+"_popup",i,{className:"bizproc-automation-popup-set",autoHide:true,closeByEsc:true,offsetTop:5,overlay:{backgroundColor:"transparent"},content:n,buttons:[new BX.PopupWindowButton({text:BX.message("BIZPROC_AUTOMATION_CMP_CHOOSE"),className:"webform-button webform-button-create",events:{click:function e(){var t;var a=document.getElementById(o.hiddenInputsNodeId+r);var s=o.findInputInFormRobot(n);var p=o.getDataForTitleReplacement(o.getOptionPropertiesRobot(s.value),i.getAttribute("data-role"));p.multiple=false;p.type="string";p.inputIndex=(t=i.getAttribute(o.inputIndexAttributeName))!==null&&t!==void 0?t:"0";if(p.title===""){p.title=BX.message("BPSGVA_VARIABLE")}o.replaceTitleAndHiddenInputRobot(i,p,a);o.changeParameterExpressionRobot(r,p);l.close()}}}),new BX.PopupWindowButtonLink({text:BX.message("BIZPROC_AUTOMATION_CMP_CANCEL"),className:"popup-window-button-link",events:{click:function e(){l.close()}}})],events:{onPopupClose:function e(){this.destroy()}}});l.show()}},{key:"getVariableInputValue",value:function e(t){var i=t+"_input";var a=document.querySelectorAll('[data-role="'+i+'"]');return a.length>=1?a["0"].value:""}},{key:"createFormForMenuRobot",value:function e(i,r,n){var o=this;var l=t.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['<form class="bizproc-automation-popup-select-block"></form>'])));var s=t.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-settings"></div>'])));var p=t.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-robot-settings-title"></div>'])));p.innerText=BX.message("BPSGVA_LIST_OF_VALUES");var u=this.createInputForMenuFormRobot(i,n,r);var d=this.findInputInFormRobot(u);var b=i==="variable"?"string":this.getVariableOptionFromVariableInput(n).property.Type;var c=t.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-settings-dropdown" readonly="readonly"></div>'])));BX.bind(c,"click",function(){var e;var t=(e=o.availableOptionsByGroupId.get(A.value))!==null&&e!==void 0?e:[];var i=o.filterItemsInStandardMenuRobot(b,t);var r=o.getVisibilityInfoForDialog(A.value);var l=o.getDialogOptions(i,r);l["targetNode"]=c;l["events"]={"Item:onBeforeSelect":function e(t){var i=t.data.item;c.innerText=i.customData.get("title");if(d.tagName!=="SELECT"){d.value=i.id}else{o.resolveAdditionOptionInSelectRobot(d,i)}},onHide:function e(t){t.target.destroy()},"Search:onItemCreateAsync":function e(t){return new Promise(function(e){var i=t.getData().searchQuery.query;var a=t.getTarget();var l={visibilityInfo:r,index:n};o.onCreateGlobalsClick(a,l,i,o,e)})}};var s=new a.Dialog(l);if(i.length<=0){s.setFooter(o.getFooter({visibilityInfo:r,index:n},s))}s.show()});var v=t.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-settings"></div>'])));var A=t.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['<select class="bizproc-automation-popup-settings-dropdown"></select>'])));BX.bind(A,"change",BX.proxy(function(){o.changeParameterSelectInFormRobot(A.value,c,p,u)},this));var O=this.getVisibilityNamesForSelect(i);for(var R in O){var N=t.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<option value="','">\n\t\t\t\t\t',"\n\t\t\t\t</option>\n\t\t\t"])),BX.util.htmlspecialchars(R),BX.util.htmlspecialchars(O[R]));A.appendChild(N)}var x=this.getOptionPropertiesRobot(r);if(x.groupId===this.helperObjectName){x.groupId=this.helperObjectName+":text";x.id=r}A.value=this.getVisibilityRelativeToVariableType(x,b);if(A.selectedIndex===-1){A.selectedIndex=0}this.changeParameterSelectInFormRobot(A.value,c,p,u);c.innerText=x.title!==""?x.title:BX.message("BPSGVA_EMPTY");if(A.value===this.helperObjectName+":text"&&x.groupId!==this.helperObjectName+":text"){d.value=this.convertFieldExpression(x)}else{d.value=x.id}v.appendChild(t.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-automation-robot-settings-title">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),BX.util.htmlspecialchars(BX.message("BPSGVA_TYPE_OF_PARAMETER"))));v.appendChild(A);s.appendChild(p);s.appendChild(c);s.append(u);l.appendChild(v);l.appendChild(s);return l}},{key:"createInputForMenuFormRobot",value:function e(i,a,r){if(i==="variable"){var n=t.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-select"></div>'])));var o=t.Tag.render(O||(O=babelHelpers.taggedTemplateLiteral(['<input class="bizproc-automation-popup-input" type="hidden" style="width: 280px">'])));n.appendChild(o);return n}var l=this.getVariableOptionFromVariableInput(a);var s;switch(l.property.Type){case"user":s=BX.Bizproc.FieldType.renderControl(this.documentType,l.property,"bp_sgva_field_input",r);break;case"select":case"bool":s=BX.Bizproc.FieldType.renderControl(this.documentType,{Type:l.property.Type,Options:l.property.Options},"bp_sgva_field_input",r);break;default:s=BX.Bizproc.FieldType.renderControl(this.documentType,{Type:l.property.Type},"bp_sgva_field_input",l.id)}s.style.width="280px";var p=this.findInputInFormRobot(s);if(["bool","select"].includes(l.property.Type)){if(p.value!==r){var u=this.getOptionPropertiesRobot(r);this.resolveAdditionOptionInSelectRobot(p,u)}}p.style.width="100%";return s}},{key:"getVariableOptionFromVariableInput",value:function e(t){var i=document.querySelector('[data-role="'+this.variableRole+t+'_input"]');var a=i?i.value:"";return this.getOptionPropertiesRobot(a)}},{key:"findInputInFormRobot",value:function e(t){var i=t.getElementsByTagName("input");if(i.length>=1){return i[i.length-1]}i=t.getElementsByTagName("textarea");if(i.length>=1){return i[i.length-1]}i=t.getElementsByTagName("select");if(i.length>=1){return i[i.length-1]}}},{key:"resolveAdditionOptionInSelectRobot",value:function e(i,a){var r=i.options;var n=r[r.length-1];if(n.getAttribute("data-role")!=="expression"){n=t.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(["<option></option>"])));n.setAttribute("data-role","expression");i.appendChild(n)}n.value=a.id;if(!a.customData){n.text=a.title}else{n.text=a.customData.get("title")}n.setAttribute("selected","selected");if(!n.selected){n.selected=true}}},{key:"filterItemsInStandardMenuRobot",value:function e(t,i){var a=this.getFilterByVariableType(t);if(a.length===this.numberOfTypes){return i}var r=[];for(var n in i){if(i[n].children){var o=this.filterItemsInStandardMenuRobot(t,i[n].children);if(o.length>=1){var l=i[n];l.children=o;r.push(l)}}else{if(a.includes(i[n].customData.property.Type)){r.push(i[n])}}}return r}},{key:"getFilterByVariableType",value:function e(t){switch(t){case"double":return["int","double"];case"datetime":return["date","datetime"];case"date":case"int":case"user":return[t];default:return["string","text","select","bool","int","double","date","datetime","user"]}}},{key:"getVisibilityInfoForDialog",value:function e(t){var a={};var r={};var n={};var o="";var l="";if(this.isGVariableVisibility(t)){a={title:BX.message("BPSGVA_GVARIABLE_NO_EXIST"),subtitle:BX.message("BPSGVA_CREATE_GVARIABLE_QUESTION"),arrow:true};r={title:BX.message("BPSGVA_GVARIABLE_NOT_FOUND"),subtitle:BX.message("BPSGVA_CREATE_GVARIABLE_QUESTION"),arrow:true};n={label:BX.message("BPSGVA_CREATE_GVARIABLE")};o=i.Globals.Manager.Instance.mode.variable;l=this.gVarObjectName}else if(this.isGConstantVisibility(t)){a={title:BX.message("BPSGVA_GCONSTANT_NO_EXIST"),subtitle:BX.message("BPSGVA_CREATE_GCONSTANT_QUESTION"),arrow:true};r={title:BX.message("BPSGVA_GCONSTANT_NOT_FOUND"),subtitle:BX.message("BPSGVA_CREATE_GCONSTANT_QUESTION"),arrow:true};n={label:BX.message("BPSGVA_CREATE_GCONSTANT")};o=i.Globals.Manager.Instance.mode.constant;l=this.gConstObjectName}else if(this.isDocumentVisibility(t)){l=this.documentObjectName}return{recentStubOptions:a,searchStubOptions:r,searchFooterOptions:n,mode:o,objectName:l,visibility:t}}},{key:"getDialogOptions",value:function e(t,i){var a={width:480,height:300,multiple:false,dropdownMode:true,enableSearch:true,showAvatars:false,compactView:true,items:t,tagSelectorOptions:{textBoxWidth:400}};var r={recentTabOptions:{stub:true,icon:"",stubOptions:i.recentStubOptions},searchTabOptions:{stub:true,stubOptions:i.searchStubOptions},searchOptions:{allowCreateItem:true,footerOptions:i.searchFooterOptions}};if(i.objectName===this.gVarObjectName||i.objectName===this.gConstObjectName){return Object.assign(a,r)}return a}},{key:"getFooter",value:function e(i,a){var r=this;var n=t.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<span class="ui-selector-footer-link ui-selector-footer-link-add" style="border: none">\n\t\t\t\t',"\n\t\t\t</span>\n\t\t"])),BX.util.htmlspecialchars(i.visibilityInfo.searchFooterOptions.label));BX.bind(n,"click",function(){r.onCreateGlobalsClick(a,i,"",r)});return n}},{key:"onCreateGlobalsClick",value:function e(t,a,r,n,o){var l=n.getVariableOptionFromVariableInput(a.index).property.Type;var s=n.getFilterByVariableType(l);var p=a.visibilityInfo.visibility;var u={visibility:p.slice(p.indexOf(":")+1),availableTypes:s};i.Globals.Manager.Instance.createGlobals(a.visibilityInfo.mode,n.signedDocumentType,r,u).then(function(e){var i={objectName:a.visibilityInfo.objectName,visibility:a.visibilityInfo.visibility,index:a.index};n.onAfterCreateGlobals(t,e,i);if(o){o()}})}},{key:"onAfterCreateGlobals",value:function e(t,i,a){var r;var n=i.getData().entries();var o=Object.keys(n);if(o.length<=0){return}var l=o[0];var s=BX.clone(n[o[0]]);s.Multiple=s.Multiple==="Y";var p=this.getVariableOptionFromVariableInput(a.index).property.Type;var u=this.getFilterByVariableType(p);var d={entityId:"bp",tabs:"recents",title:s["Name"],id:"{="+a.objectName+":"+l+"}",customData:{groupId:a.objectName+":"+s["Visibility"],property:s,title:s["Name"]}};if(d.customData.groupId===a.visibility&&u.includes(d.customData.property.Type)){t.setFooter(null);t.addItem(d)}this.availableOptions.set(d.id,d);var b=(r=this.availableOptionsByGroupId.get(d.customData.groupId))!==null&&r!==void 0?r:[];b.push(d);this.availableOptionsByGroupId.set(d.customData.groupId,b)}},{key:"changeParameterSelectInFormRobot",value:function e(t,i,a,r){if(t!==this.helperObjectName+":text"){i.style.display="inline-block";i.innerText=BX.message("BPSGVA_EMPTY");a.innerText=BX.message("BPSGVA_LIST_OF_VALUES");r.style.display="none"}else{i.style.display="none";a.innerText=BX.message("BPSGVA_INPUT_TEXT");r.style.display=""}var n=this.findInputInFormRobot(r);n.value=""}},{key:"getVisibilityNamesForSelect",value:function e(t){var i={};var a={};a[this.helperObjectName]={text:BX.message("BPSGVA_TEXT")};var r=Object.assign({},this.visibilityMessages,a);for(var n in r){if(t==="variable"&&n!==this.gVarObjectName){continue}for(var o in r[n]){i[n+":"+o]=r[n][o]}}return i}},{key:"getVisibilityRelativeToVariableType",value:function e(t,i){var a=this.getFilterByVariableType(i);if(t.groupId===this.helperObjectName+":text"||a.includes(t.property.Type)){return t.groupId}return this.helperObjectName+":text"}},{key:"changeParameterExpressionRobot",value:function e(t,i){var a=document.querySelector('[data-role="'+this.parameterRole+t+'"]');this.deleteOldValueRowsRobot(a);var r=document.getElementById(this.hiddenInputsNodeId+t);var n=BX.clone(this.getOptionPropertiesRobot("parameter"));n["multiple"]=i.property.Multiple;n["inputIndex"]="0";a.appendChild(this.createParameterRowRobot(t,n,r));if(i.property.Multiple&&i.property.Type!=="user"){var o=i.inputIndex!=="0"?i.inputIndex:"1";a.appendChild(this.createAddParameterRowRobot(t,o))}}},{key:"deleteOldValueRowsRobot",value:function e(t){var i=t.getAttribute("data-role");t.innerHTML="";var a=document.querySelectorAll('[data-role="'+i+'_input"]');for(var r in Object.keys(a)){a[r].remove()}}},{key:"createAddParameterRowRobot",value:function e(i,a){var r=t.Tag.render(x||(x=babelHelpers.taggedTemplateLiteral(['<div class="bizproc-automation-popup-settings-title" style="display:flex;"></div>'])));var n=t.Tag.render(V||(V=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="bizproc-type-control-clone-btn setglobalvariableactivity-dashed-grey setglobalvariableactivity-add-parameter">\n\t\t\t\t',"\n\t\t\t</div>\n\t\t"])),BX.util.htmlspecialchars(BX.message("BPSGVA_ADD_PARAMETER")));n.setAttribute(this.indexAttributeName,String(i));n.setAttribute(this.inputIndexAttributeName,String(a));BX.bind(n,"click",BX.proxy(this.onAddParameterButtonClickRobot,this));r.appendChild(n);return r}},{key:"onAddParameterButtonClickRobot",value:function e(t){var i=t.target.getAttribute(this.indexAttributeName);var a=document.getElementById(this.hiddenInputsNodeId+i);var r=t.target.getAttribute(this.inputIndexAttributeName);var n=BX.clone(this.getOptionPropertiesRobot("parameter"));n["multiple"]=true;n["inputIndex"]=r;t.target.parentNode.before(this.createParameterRowRobot(i,n,a));t.target.setAttribute(this.inputIndexAttributeName,Number(r)+1)}},{key:"onParameterSelectClickRobot",value:function e(t,i){var a=t.target;var r=this.getParameterInputValue(a.getAttribute("data-role")+"_input",i);var n=a.getAttribute(this.indexAttributeName);var o=this.createFormForMenuRobot("all",r,n);var l=this;var s=new BX.PopupWindow(a.id+"_popup",a,{className:"bizproc-automation-popup-set",closeByEsc:true,autoHide:true,offsetTop:5,overlay:{backgroundColor:"transparent"},content:o,buttons:[new BX.PopupWindowButton({text:BX.message("BIZPROC_AUTOMATION_CMP_CHOOSE"),className:"webform-button webform-button-create",events:{click:function e(){var t;var i=document.getElementById(l.hiddenInputsNodeId+n);var r=l.getVariableOptionFromVariableInput(n);var p=l.findInputInFormRobot(o);var u;if(p.tagName==="SELECT"){var d=p.selectedOptions[0].value;var b=d!==""?p.selectedOptions[0].text:BX.message("BPSGVA_CLEAR");u=l.getDataForTitleReplacement({id:d,title:b},a.getAttribute("data-role"));u.isExpressionOption=p.selectedOptions[0].getAttribute("data-role")==="expression"}else{var c=BX.clone(l.getOptionPropertiesRobot(p.value));if(c.groupId===l.helperObjectName){c.id=p.value;c.title=p.value}u=l.getDataForTitleReplacement(l.getOptionPropertiesRobot(p.value),a.getAttribute("data-role"))}u.inputIndex=(t=a.getAttribute(l.inputIndexAttributeName))!==null&&t!==void 0?t:"0";u.multiple=r.property.Multiple;u.type=r.property.Type;if(u.title===""){u.title=BX.message("BPSGVA_CLEAR")}l.replaceTitleAndHiddenInputRobot(a,u,i);s.close()}}}),new BX.PopupWindowButtonLink({text:BX.message("BIZPROC_AUTOMATION_CMP_CANCEL"),className:"popup-window-button-link",events:{click:function e(){s.close()}}})],events:{onPopupClose:function e(){this.destroy()}}});s.show()}},{key:"getParameterInputValue",value:function e(t,i){var a=document.querySelectorAll('[data-role="'+t+'"]',i);var r=Object.keys(a);for(var n in r){if(String(a[r[n]].getAttribute(this.inputIndexAttributeName))===String(i)){return a[r[n]].value}}return""}},{key:"addExpressionButtonRobot",value:function e(){var t=document.getElementById(this.addButtonNodeId);t.innerText=BX.message("BPSGVA_ADD_VARIABLE");BX.bind(t,"click",BX.proxy(function(){this.addAssignmentExpressionRobot()},this))}},{key:"convertFieldExpression",value:function e(t){if(this.isDocumentVisibility(t.groupId)){return"{{"+t.property.Name+"}}"}if(this.isGVariableVisibility(t.groupId)){var i=this.visibilityMessages[this.gVarObjectName];var a=t.property.Visibility;var r=t.property.Name;return"{{"+i[a]+": "+r+"}}"}if(this.isGConstantVisibility(t.groupId)){var n=this.visibilityMessages[this.gConstObjectName];var o=t.property.Visibility;var l=t.property.Name;return"{{"+n[o]+": "+l+"}}"}return t.id}},{key:"addAssignmentExpressionDesigner",value:function e(i,a){var r=this.addRowTable;this.rowIndex++;var n=r.insertRow(-1);n.id="delete_row_"+this.rowIndex;var o=n.insertCell(-1);var l=t.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['<select name="','"></select>'])),this.variableRole+this.rowIndex);l.setAttribute(this.indexAttributeName,this.rowIndex);var s=this;l.onchange=function(){s.changeFieldTypeDesigner(this.getAttribute(s.indexAttributeName),this.options[this.selectedIndex].value,null)};var p=this.visibilityMessages[this.gVarObjectName];for(var u in p){var d=p[u];var b=t.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['<optgroup label="','"></optgroup>'])),BX.util.htmlspecialchars(d));var c=this.availableOptionsByGroupId.get(this.gVarObjectName+":"+u);if(!c){continue}var v=void 0;for(var g in c){v=t.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<option value="','">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</option>\n\t\t\t\t"])),BX.util.htmlspecialchars(c[g]["id"]),BX.util.htmlspecialchars(c[g]["customData"]["title"]));b.appendChild(v)}l.appendChild(b)}l.value=i;if(l.selectedIndex===-1){l.selectedIndex=0}o.appendChild(l);var h=n.insertCell(-1);h.innerHTML="=";var m=n.insertCell(-1);m.id="id_td_variable_value_"+this.rowIndex;m.innerHTML="";var y=n.insertCell(-1);y.aligh="right";var f=t.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['<a href="#">',"</a>"])),BX.util.htmlspecialchars(BX.message("BPSGVA_PD_DELETE")));BX.bind(f,"click",function(){s.deleteConditionDesigner(s.rowIndex)});y.appendChild(f);if(t.Type.isArray(a)){for(var T in a){var I=this.getOptionPropertiesRobot(a[T]);if(I.groupId===this.helperObjectName+":text"){continue}a[T]=this.convertFieldExpression(I)}}else{var B=this.getOptionPropertiesRobot(a);if(B.groupId!==this.helperObjectName+":text"){a=this.convertFieldExpression(B)}}if(a===undefined){a=null}this.changeFieldTypeDesigner(this.rowIndex,l.value,a)}},{key:"changeFieldTypeDesigner",value:function e(t,i,a){BX.showWait();var r=document.getElementById("id_td_variable_value_"+t);var n=i.indexOf(":");var o=i;if(n!==-1){o=i.slice(n+1,i.length-1)}objFieldsGlobalVar.GetFieldInputControl(objFieldsGlobalVar.arDocumentFields[o],a,{Field:o,Form:this.formName},function(e){if(e===undefined){r.innerHTML=""}else{r.innerHTML=e;if(typeof BX.Bizproc.Selector!=="undefined"){BX.Bizproc.Selector.initSelectors(r)}}BX.closeWait()},true)}},{key:"deleteConditionDesigner",value:function e(t){var i=document.getElementById(this.addRowTableNodeId);var a=i.rows.length;for(var r=0;r<a;r++){if(i.rows[r].id!=="delete_row_"+t){continue}i.deleteRow(r);break}}}]);return e}();k.SetGlobalVariableActivity=E})(this.window=this.window||{},BX,BX.Bizproc,BX.UI.EntitySelector);
//# sourceMappingURL=script.map.js