this.BX=this.BX||{};this.BX.Calendar=this.BX.Calendar||{};(function(e,t,s,a,i,o,n){"use strict";var l=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,s));e.setEventNamespace("BX.Calendar.Rooms.ReserveButton");e.zIndex=s.zIndex||3200;e.popupId=s.id||"add-button-"+Math.round(Math.random()*1e4);e.showTasks=s.showTasks;e.addEntryHandler=a.Type.isFunction(s.addEntry)?s.addEntry:null;e.addTaskHandler=a.Type.isFunction(s.addTask)?s.addTask:null;e.create();return e}babelHelpers.createClass(t,[{key:"create",value:function e(){this.DOM.wrap=a.Dom.create("button",{props:{className:"ui-btn ui-btn-success",type:"button"},html:a.Loc.getMessage("EC_RESERVE"),events:{click:this.addEntry.bind(this)}})}}]);return t}(t.AddButton);var r,c,d,p;var h=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"DOM",{});babelHelpers.defineProperty(babelHelpers.assertThisInitialized(e),"isCreated",false);e.setEventNamespace("BX.Calendar.SectionInterface.EditForm");e.DOM.outerWrap=s.wrap;e.sectionAccessTasks=s.sectionAccessTasks;e.sectionManager=s.sectionManager;e.closeCallback=s.closeCallback;e.BX=n.Util.getBX();e.keyHandlerBinded=e.keyHandler.bind(babelHelpers.assertThisInitialized(e));return e}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.section=t.section;this.create();this.showAccess=t.showAccess!==false;if(this.showAccess){this.DOM.accessLink.style.display="";this.DOM.accessWrap.style.display=""}else{this.DOM.accessLink.style.display="none";this.DOM.accessWrap.style.display="none"}a.Event.bind(document,"keydown",this.keyHandlerBinded);a.Dom.addClass(this.DOM.outerWrap,"show");if(t.section){if(t.section.color){this.setColor(t.section.color)}this.setAccess(t.section.access||t.section.data.ACCESS||{});if(t.section.name){this.DOM.sectionTitleInput.value=t.section.name}}BX.focus(this.DOM.sectionTitleInput);if(this.DOM.sectionTitleInput.value!==""){this.DOM.sectionTitleInput.select()}this.isOpenedState=true}},{key:"close",value:function e(){this.isOpenedState=false;a.Event.unbind(document,"keydown",this.keyHandlerBinded);a.Dom.removeClass(this.DOM.outerWrap,"show");if(a.Type.isFunction(this.closeCallback)){this.closeCallback()}}},{key:"isOpened",value:function e(){return this.isOpenedState}},{key:"create",value:function e(){this.wrap=this.DOM.outerWrap.querySelector(".calendar-form-content");if(this.wrap){a.Dom.clean(this.wrap)}else{this.wrap=this.DOM.outerWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-form-content"}}))}this.DOM.formFieldsWrap=this.wrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content"}})).appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-widget-content-block"}}));this.DOM.sectionTitleInput=this.DOM.formFieldsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-field-container calendar-field-container-string"}})).appendChild(a.Dom.create("DIV",{props:{className:"calendar-field-block"}})).appendChild(a.Dom.create("INPUT",{attrs:{type:"text",placeholder:a.Loc.getMessage("EC_SEC_SLIDER_SECTION_TITLE")},props:{className:"calendar-field calendar-field-string"}}));this.DOM.optionsWrap=this.DOM.formFieldsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-new-calendar-options-container"}}));this.initSectionColorSelector();this.initAccessController();this.buttonsWrap=this.DOM.formFieldsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-btn-container"}}));this.saveBtn=new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_SAVE"),className:"ui-btn ui-btn-success",events:{click:this.save.bind(this)}});this.saveBtn.renderTo(this.buttonsWrap);new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-link",events:{click:this.checkClose.bind(this)}}).renderTo(this.buttonsWrap);this.isCreated=true}},{key:"keyHandler",value:function e(t){if(t.keyCode===n.Util.getKeyCode("escape")){this.checkClose()}else if(t.keyCode===n.Util.getKeyCode("enter")){this.save()}}},{key:"checkClose",value:function e(){this.close()}},{key:"save",value:function e(){var t=this;this.saveBtn.setWaiting(true);this.sectionManager.saveSection(this.DOM.sectionTitleInput.value,this.color,this.access,{section:this.section}).then(function(){t.saveBtn.setWaiting(false);t.close()})}},{key:"initSectionColorSelector",value:function e(){this.DOM.colorContWrap=this.DOM.optionsWrap.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-new-calendar-option-color"},html:a.Loc.getMessage("EC_SEC_SLIDER_COLOR")}));this.colorIcon=this.DOM.colorContWrap.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-color-selected"}}));this.colorChangeLink=this.DOM.colorContWrap.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-color-change"},html:a.Loc.getMessage("EC_SEC_SLIDER_CHANGE")}));a.Event.bind(this.colorIcon,"click",this.showSimplePicker.bind(this));a.Event.bind(this.colorChangeLink,"click",this.showSimplePicker.bind(this))}},{key:"showSimplePicker",value:function e(t){var s=a.Runtime.clone(n.Util.getDefaultColorList(),true);var i=a.Dom.create("DIV",{props:{className:"calendar-simple-color-wrap calendar-field-container-colorpicker-square"}});var o=i.appendChild(a.Dom.create("DIV",{events:{click:BX.delegate(this.simplePickerClick,this)}}));var l=i.appendChild(a.Dom.create("DIV",{props:{className:"calendar-simple-color-more-link-wrap"}}));var r=l.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-simple-color-more-link"},html:a.Loc.getMessage("EC_COLOR"),events:{click:BX.delegate(this.showFullPicker,this)}}));this.simplePickerColorWrap=o;this.colors=[];if(!s.includes(this.color)){s.push(this.color)}for(var c=0;c<s.length;c++){this.colors.push({color:s[c],node:o.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-field-colorpicker-color-item"},style:{backgroundColor:s[c]},attrs:{"data-bx-calendar-color":s[c]},html:'<span class="calendar-field-colorpicker-color"></span>'}))})}this.lastActiveNode=this.colors[BX.util.array_search(this.color,s)||0].node;a.Dom.addClass(this.lastActiveNode,"active");this.simpleColorPopup=BX.PopupWindowManager.create("simple-color-popup-"+n.Util.getRandomInt(),this.colorIcon,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:9,lightShadow:true,content:i,cacheable:false});this.simpleColorPopup.setAngle({offset:10});this.simpleColorPopup.show(true)}},{key:"simplePickerClick",value:function e(t){var s=n.Util.findTargetNode(t.target||t.srcElement,this.DOM.outerWrap);if(a.Type.isElementNode(s)){var i=s.getAttribute("data-bx-calendar-color");if(i!==null){if(this.lastActiveNode){a.Dom.removeClass(this.lastActiveNode,"active")}a.Dom.addClass(s,"active");this.lastActiveNode=s;this.setColor(i)}}}},{key:"showFullPicker",value:function e(){if(this.simpleColorPopup){this.simpleColorPopup.close()}if(!this.fullColorPicker){this.fullColorPicker=new BX.ColorPicker({bindElement:this.colorIcon,onColorSelected:BX.delegate(function(e){this.setColor(e)},this),popupOptions:{cacheable:false,zIndex:this.zIndex,events:{onPopupClose:BX.delegate(function(){},this)}}})}this.fullColorPicker.open()}},{key:"setColor",value:function e(t){this.colorIcon.style.backgroundColor=t;this.color=t}},{key:"setAccess",value:function e(t){var s=0;for(var a in t){if(t.hasOwnProperty(a)){s++}}this.accessRowsCount=s;this.access=t;for(var i in t){if(t.hasOwnProperty(i)){this.insertAccessRow(n.Util.getAccessName(i),i,t[i])}}this.checkAccessTableHeight()}},{key:"initAccessController",value:function e(){this.buildAccessController();if(this.sectionManager&&this.sectionManager.calendarType==="group"){this.initDialogGroup()}else{this.initDialogStandard()}this.initAccessSelectorPopup()}},{key:"initAccessSelectorPopup",value:function e(){var t=this;a.Event.bind(this.DOM.accessWrap,"click",function(e){var s=n.Util.findTargetNode(e.target||e.srcElement,t.DOM.outerWrap);if(a.Type.isElementNode(s)){if(s.getAttribute("data-bx-calendar-access-selector")!==null){var i=s.getAttribute("data-bx-calendar-access-selector");if(t.accessControls[i]){t.showAccessSelectorPopup({node:t.accessControls[i].removeIcon,setValueCallback:function e(s){if(t.accessTasks[s]&&t.accessControls[i]){t.accessControls[i].valueNode.innerHTML=a.Text.encode(t.accessTasks[s].title);t.access[i]=s}}})}}else if(s.getAttribute("data-bx-calendar-access-remove")!==null){var o=s.getAttribute("data-bx-calendar-access-remove");if(t.accessControls[o]){a.Dom.remove(t.accessControls[o].rowNode);t.accessControls[o]=null;delete t.access[o]}}}})}},{key:"buildAccessController",value:function e(){var t=this;this.DOM.accessLink=this.DOM.optionsWrap.appendChild(a.Tag.render(r||(r=babelHelpers.taggedTemplateLiteral(['<div class="calendar-list-slider-new-calendar-option-more">',"</div>"])),a.Loc.getMessage("EC_SEC_SLIDER_ACCESS")));this.DOM.accessWrap=this.DOM.formFieldsWrap.appendChild(a.Tag.render(c||(c=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-list-slider-access-container">\n\t\t\t\t\t<div class="calendar-list-slider-access-inner-wrap">\n\t\t\t\t\t\t','\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="calendar-list-slider-new-calendar-options-container">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t</div>"])),this.DOM.accessTable=a.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<table class="calendar-section-slider-access-table"></table>\n\t\t\t\t\t\t']))),this.DOM.accessButton=a.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t\t<span class="calendar-list-slider-new-calendar-option-add">\n\t\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t\t</span>"])),a.Loc.getMessage("EC_SEC_SLIDER_ACCESS_ADD"))));this.accessControls={};this.accessTasks=this.sectionAccessTasks;a.Event.bind(this.DOM.accessLink,"click",function(){if(a.Dom.hasClass(t.DOM.accessWrap,"shown")){a.Dom.removeClass(t.DOM.accessWrap,"shown")}else{a.Dom.addClass(t.DOM.accessWrap,"shown")}t.checkAccessTableHeight()})}},{key:"initDialogStandard",value:function e(){var t=this;a.Event.bind(this.DOM.accessButton,"click",function(){t.entitySelectorDialog=new o.Dialog({targetNode:t.DOM.accessButton,context:"CALENDAR",preselectedItems:[],enableSearch:true,events:{"Item:onSelect":t.handleEntitySelectorChanges.bind(t),"Item:onDeselect":t.handleEntitySelectorChanges.bind(t)},popupOptions:{targetContainer:document.body},entities:[{id:"user"},{id:"project"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}]});t.entitySelectorDialog.show()})}},{key:"initDialogGroup",value:function e(){var t=this;a.Event.bind(this.DOM.accessButton,"click",function(){t.entitySelectorDialog=new o.Dialog({targetNode:t.DOM.accessButton,context:"CALENDAR",preselectedItems:[],enableSearch:true,events:{"Item:onSelect":t.handleEntitySelectorChanges.bind(t),"Item:onDeselect":t.handleEntitySelectorChanges.bind(t)},popupOptions:{targetContainer:document.body},entities:[{id:"user"},{id:"department",options:{selectMode:"usersAndDepartments"}},{id:"meta-user",options:{"all-users":true}}],tabs:[{id:"groupAccess",title:t.sectionManager.ownerName}],items:[{id:"SG"+t.sectionManager.ownerId+"_"+"A",entityId:"group",tabs:"groupAccess",title:a.Loc.getMessage("EC_ACCESS_GROUP_ADMIN")},{id:"SG"+t.sectionManager.ownerId+"_"+"E",entityId:"group",tabs:"groupAccess",title:a.Loc.getMessage("EC_ACCESS_GROUP_MODERATORS")},{id:"SG"+t.sectionManager.ownerId+"_"+"K",entityId:"group",tabs:"groupAccess",title:a.Loc.getMessage("EC_ACCESS_GROUP_MEMBERS")}]});t.entitySelectorDialog.show()})}},{key:"handleEntitySelectorChanges",value:function e(){var t=this;var s=this.entitySelectorDialog.getSelectedItems();this.entitySelectorDialog.hide();if(a.Type.isArray(s)){s.forEach(function(e){var s;if(e.entityId==="group"){s=t.sectionManager.ownerName+": "+e.title.text}else{s=e.title.text}var a=n.Util.convertEntityToAccessCode(e);n.Util.setAccessName(a,s);t.insertAccessRow(s,a)})}a.Runtime.debounce(function(){t.entitySelectorDialog.destroy()},400)()}},{key:"insertAccessRow",value:function e(t,s,i){if(!this.accessControls[s]){if(i===undefined){for(var o in this.sectionAccessTasks){if(this.sectionAccessTasks.hasOwnProperty(o)&&this.sectionAccessTasks[o].name==="calendar_view"){i=o;break}}}var n=a.Dom.adjust(this.DOM.accessTable.insertRow(-1),{props:{className:"calendar-section-slider-access-table-row"}}),l=a.Dom.adjust(n.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},html:'<span class="calendar-section-slider-access-title">'+a.Text.encode(t)+":</span>"}),r=a.Dom.adjust(n.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},attrs:{"data-bx-calendar-access-selector":s}}),c=r.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-section-slider-access-container"}})),d=c.appendChild(a.Dom.create("SPAN",{text:this.accessTasks[i]?this.accessTasks[i].title:"",props:{className:"calendar-section-slider-access-value"}})),p=c.appendChild(a.Dom.create("SPAN",{props:{className:"calendar-section-slider-access-remove"},attrs:{"data-bx-calendar-access-remove":s}}));this.access[s]=i;this.accessControls[s]={rowNode:n,titleNode:l,valueNode:d,removeIcon:p}}}},{key:"checkAccessTableHeight",value:function e(){var t=this;if(this.checkTableTimeout){this.checkTableTimeout=clearTimeout(this.checkTableTimeout)}this.checkTableTimeout=setTimeout(function(){if(a.Dom.hasClass(t.DOM.accessWrap,"shown")){if(t.DOM.accessWrap.offsetHeight-t.DOM.accessTable.offsetHeight<36){t.DOM.accessWrap.style.maxHeight=parseInt(t.DOM.accessTable.offsetHeight)+100+"px"}}else{t.DOM.accessWrap.style.maxHeight=""}},300)}},{key:"showAccessSelectorPopup",value:function e(t){if(this.accessPopupMenu&&this.accessPopupMenu.popupWindow&&this.accessPopupMenu.popupWindow.isShown()){return this.accessPopupMenu.close()}var s=this;var a=[];for(var i in this.accessTasks){if(this.accessTasks.hasOwnProperty(i)){a.push({text:this.accessTasks[i].title,onclick:function(e){return function(){t.setValueCallback(e);s.accessPopupMenu.close()}}(i)})}}this.accessPopupMenu=this.BX.PopupMenu.create("section-access-popup"+n.Util.randomInt(),t.node,a,{closeByEsc:true,autoHide:true,offsetTop:-5,offsetLeft:0,angle:true,cacheable:false});this.accessPopupMenu.show()}}]);return t}(i.EventEmitter);var u,m,g,b,C,v,f,D,E,M,y,T;var k=function(e){babelHelpers.inherits(t,e);function t(){var e;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);e=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,s));e.setEventNamespace("BX.Calendar.Rooms.EditFormRoom");e.DOM.outerWrap=s.wrap;e.roomsManager=s.roomsManager;e.capacityNumbers=[3,5,7,10,25];e.zIndex=s.zIndex||3100;e.closeCallback=s.closeCallback;e.BX=n.Util.getBX();e.keyHandlerBinded=e.keyHandler.bind(babelHelpers.assertThisInitialized(e));return e}babelHelpers.createClass(t,[{key:"show",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.actionType=t.actionType;this.room=t.room;this.create();this.showAccess=t.showAccess!==false;if(this.showAccess){this.DOM.accessLink.style.display="";this.DOM.accessWrap.style.display=""}else{this.DOM.accessLink.style.display="none";this.DOM.accessWrap.style.display="none"}a.Event.bind(document,"keydown",this.keyHandlerBinded);a.Dom.addClass(this.DOM.outerWrap,"show");if(t.room){if(t.room.color){this.setColor(t.room.color)}this.setAccess(t.room.access||t.room.data.ACCESS||{});if(t.room.name){this.DOM.roomsTitleInput.value=t.room.name}if(t.room.capacity){this.DOM.roomsCapacityInput.value=t.room.capacity}}BX.focus(this.DOM.roomsTitleInput);if(this.DOM.roomsTitleInput.value!==""){this.DOM.roomsTitleInput.select()}this.isOpenedState=true}},{key:"create",value:function e(){this.wrap=this.DOM.outerWrap.querySelector(".calendar-form-content");if(this.wrap){a.Dom.clean(this.wrap)}else{this.wrap=this.DOM.outerWrap.appendChild(a.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-form-content"></div>\n\t\t\t\t']))))}this.DOM.formFieldsWrap=this.wrap.appendChild(a.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-list-slider-widget-content"></div>\n\t\t\t'])))).appendChild(a.Tag.render(g||(g=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-list-slider-widget-content-block"></div>']))));this.DOM.roomsTitleInput=this.DOM.formFieldsWrap.appendChild(a.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-container calendar-field-container-string"></div>'])))).appendChild(a.Tag.render(C||(C=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block"></div>'])))).appendChild(a.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input type="text" placeholder="','" \n\t\t\tclass="calendar-field calendar-field-string"/>'])),a.Loc.getMessage("EC_SEC_SLIDER_SECTION_TITLE")));this.DOM.roomsCapacityInput=this.DOM.formFieldsWrap.appendChild(a.Tag.render(f||(f=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-container calendar-field-container-string"></div>'])))).appendChild(a.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-field-block"></div>'])))).appendChild(a.Tag.render(E||(E=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class ="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">\n\t\t\t\t\t\t\t',"\n\t\t\t\t\t\t</span>\t\n\t\t\t\t\t</div>\t\t\t\t\t\t\n\t\t\t\t\t"])),a.Loc.getMessage("EC_SEC_SLIDER_SECTION_CAPACITY"))).appendChild(a.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<input type="number" class="calendar-field calendar-field-number" placeholder="0"/>']))));this.DOM.optionsWrap=this.DOM.formFieldsWrap.appendChild(a.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-list-slider-new-calendar-options-container"></div>']))));this.initSectionColorSelector();this.initAccessController();this.buttonsWrap=this.DOM.formFieldsWrap.appendChild(a.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-list-slider-btn-container"></div>']))));if(this.actionType==="createRoom"){this.saveBtn=new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_SAVE"),className:"ui-btn ui-btn-success",events:{click:this.createRoom.bind(this)}});this.saveBtn.renderTo(this.buttonsWrap)}else if(this.actionType==="updateRoom"){this.saveBtn=new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_SAVE"),className:"ui-btn ui-btn-success",events:{click:this.updateRoom.bind(this)}});this.saveBtn.renderTo(this.buttonsWrap)}new BX.UI.Button({text:a.Loc.getMessage("EC_SEC_SLIDER_CANCEL"),className:"ui-btn ui-btn-link",events:{click:this.checkClose.bind(this)}}).renderTo(this.buttonsWrap);this.isCreated=true}},{key:"createRoom",value:function e(){var t=this;this.saveBtn.setWaiting(true);this.roomsManager.createRoom({name:this.DOM.roomsTitleInput.value,capacity:this.DOM.roomsCapacityInput.value,color:this.color,access:this.access}).then(function(){t.saveBtn.setWaiting(false);t.close()})}},{key:"initAccessController",value:function e(){this.buildAccessController();this.initDialogStandard();this.initAccessSelectorPopup()}},{key:"updateRoom",value:function e(){var t=this;this.saveBtn.setWaiting(true);this.roomsManager.updateRoom({id:this.room.id,location_id:this.room.location_id,name:this.DOM.roomsTitleInput.value,capacity:this.DOM.roomsCapacityInput.value,color:this.color,access:this.access}).then(function(){t.saveBtn.setWaiting(false);t.close()})}},{key:"keyHandler",value:function e(t){if(t.keyCode===n.Util.getKeyCode("escape")){this.checkClose()}else if(t.keyCode===n.Util.getKeyCode("enter")&&this.actionType==="createRoom"){this.createRoom()}else if(t.keyCode===n.Util.getKeyCode("enter")&&this.actionType==="updateRoom"){this.updateRoom()}}}]);return t}(h);var O,S,w,R,B,L,I,A,H,_,N,W,X;var x=function(e){babelHelpers.inherits(t,e);function t(e){var s;var a=e.calendarContext,i=e.readonly,o=e.roomsManager,l=e.isConfigureList,r=l===void 0?false:l;babelHelpers.classCallCheck(this,t);s=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).call(this,{calendarContext:a,readonly:i,roomsManager:o}));babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"SLIDER_WIDTH",400);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"SLIDER_DURATION",80);babelHelpers.defineProperty(babelHelpers.assertThisInitialized(s),"sliderId","calendar:rooms-slider");s.setEventNamespace("BX.Calendar.RoomsInterface");s.roomsManager=o;s.isConfigureList=r;s.calendarContext=a;s.readonly=i;s.BX=n.Util.getBX();s.sliderOnClose=s.hide.bind(babelHelpers.assertThisInitialized(s));s.deleteRoomHandlerBinded=s.deleteRoomHandler.bind(babelHelpers.assertThisInitialized(s));s.refreshRoomListBinded=s.refreshRoomList.bind(babelHelpers.assertThisInitialized(s));if(s.calendarContext!==null){if(s.calendarContext.util.config.accessNames){var c,d,p;n.Util.setAccessNames((c=s.calendarContext)===null||c===void 0?void 0:(d=c.util)===null||d===void 0?void 0:(p=d.config)===null||p===void 0?void 0:p.accessNames)}}return s}babelHelpers.createClass(t,[{key:"addEventEmitterSubscriptions",value:function e(){n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:create",this.refreshRoomListBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:update",this.refreshRoomListBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:delete",this.deleteRoomHandlerBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:pull-create",this.refreshRoomListBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:pull-update",this.refreshRoomListBinded);n.Util.getBX().Event.EventEmitter.subscribe("BX.Calendar.Rooms:pull-delete",this.deleteRoomHandlerBinded)}},{key:"destroyEventEmitterSubscriptions",value:function e(){n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:create",this.refreshRoomListBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:update",this.refreshRoomListBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:delete",this.deleteRoomHandlerBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:pull-create",this.refreshRoomListBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:pull-update",this.refreshRoomListBinded);n.Util.getBX().Event.EventEmitter.unsubscribe("BX.Calendar.Rooms:pull-delete",this.deleteRoomHandlerBinded)}},{key:"createContent",value:function e(){this.DOM.outerWrap=a.Tag.render(O||(O=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="calendar-list-slider-wrap"></div>\n\t\t'])));this.DOM.titleWrap=this.DOM.outerWrap.appendChild(a.Tag.render(S||(S=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="calendar-list-slider-title-container">\n\t\t\t\t\t<div class="calendar-list-slider-title">',"</div>\n\t\t\t\t</div>\n\t\t\t"])),a.Loc.getMessage("EC_SECTION_ROOMS")));if(!this.readonly){this.createAddButton();this.DOM.roomFormWrap=this.DOM.outerWrap.appendChild(a.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-list-slider-card-widget calendar-list-slider-form-wrap">\n\t\t\t\t\t\t<div class="calendar-list-slider-card-widget-title">\n\t\t\t\t\t\t\t<span class="calendar-list-slider-card-widget-title-text">',"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"])),a.Loc.getMessage("EC_SEC_SLIDER_NEW_ROOM")))}this.createRoomList();return this.DOM.outerWrap}},{key:"createAddButton",value:function e(){this.actionType="createRoom";var t=this.DOM.titleWrap.appendChild(a.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="ui-btn-light-border" style="margin-right: 0"></span>\n\t\t\t']))));this.DOM.addButton=t.appendChild(a.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<span class="ui-btn" onclick="','">',"</span>\n\t\t\t"])),this.showEditRoomForm.bind(this),a.Loc.getMessage("EC_ADD")))}},{key:"createRoomList",value:function e(){this.sliderRoom=this.roomsManager.getRooms();if(this.DOM.roomListWrap){a.Dom.clean(this.DOM.roomListWrap);a.Dom.adjust(this.DOM.roomListWrap,{props:{className:"calendar-list-slider-card-widget"}})}else{this.DOM.roomListWrap=this.DOM.outerWrap.appendChild(a.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-list-slider-card-widget">\n\t\t\t\t\t</div>\n\t\t\t\t']))))}this.createRoomBlock({wrap:this.DOM.roomListWrap,roomList:this.sliderRoom.filter(function(e){return e.belongsToView()||e.isPseudo()})})}},{key:"showEditRoomForm",value:function e(){var t=this;var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(typeof s.actionType==="undefined"){s.actionType="createRoom"}this.closeForms();var i=this.DOM.roomFormWrap.querySelector(".calendar-list-slider-card-widget-title-text");this.editSectionForm=new k({wrap:this.DOM.roomFormWrap,sectionAccessTasks:this.roomsManager.getSectionAccessTasks(),roomsManager:this.roomsManager,closeCallback:function e(){t.allowSliderClose()}});var o=true;if(s.room&&s.room.id){i.innerHTML=a.Loc.getMessage("EC_SEC_SLIDER_EDIT_SECTION_ROOM");o=s.room.canDo("access")}else{i.innerHTML=a.Loc.getMessage("EC_SEC_SLIDER_NEW_ROOM")}this.editSectionForm.show({showAccess:o,room:s.room||{color:n.Util.getRandomColor(),access:this.roomsManager.getDefaultSectionAccess()},actionType:s.actionType});this.denySliderClose()}},{key:"showRoomMenu",value:function e(t,s){var i=this;var o=[];var l=s.closest("[data-bx-calendar-section]")||s.closest("[ data-bx-calendar-section-without-action]");if(a.Type.isElementNode(l)){a.Dom.addClass(l,"active")}if(t.canDo("view_time")&&!this.isConfigureList){o.push({text:a.Loc.getMessage("EC_SEC_LEAVE_ONE_ROOM"),onclick:function e(){i.roomActionMenu.close();i.showOnlyOneSection(t,i.roomsManager.rooms)}})}if(!this.readonly&&t.canDo("edit_section")){o.push({text:a.Loc.getMessage("EC_SEC_EDIT"),onclick:function e(){i.roomActionMenu.close();i.showEditRoomForm({room:t,actionType:"updateRoom"})}})}if(t.canDo("edit_section")&&t.belongsToView()){o.push({text:a.Loc.getMessage("EC_SEC_DELETE"),onclick:function e(){i.roomActionMenu.close();i.deleteRoom(t)}})}if(o&&o.length>0){this.roomActionMenu=top.BX.PopupMenu.create("section-menu-"+n.Util.getRandomInt(),s,o,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:9,angle:true,cacheable:false});this.roomActionMenu.show();this.roomActionMenu.popupWindow.subscribe("onClose",function(){if(a.Type.isElementNode(l)){a.Dom.removeClass(l,"active")}i.allowSliderClose()});this.denySliderClose()}else{a.Dom.removeClass(l,"active")}}},{key:"refreshRoomList",value:function e(){this.createRoomList()}},{key:"createRoomBlock",value:function e(t){var s=this;var i=t.wrap,o=t.roomList;if(a.Type.isArray(o)){var n=i.appendChild(a.Tag.render(I||(I=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-list-slider-widget-content"></div>\n\t\t\t\t'])))).appendChild(a.Tag.render(A||(A=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-list-slider-widget-content-block"></div>\n\t\t\t\t\t'])))).appendChild(a.Tag.render(H||(H=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<ul class="calendar-list-slider-container"></ul>\n\t\t\t\t\t']))));a.Event.bind(n,"click",this.roomClickHandler.bind(this));o.forEach(function(e){if(!e.DOM){e.DOM={}}var t=e.id;var i;var o;if(s.isConfigureList){i=n.appendChild(a.Tag.render(_||(_=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<li class="calendar-list-slider-item"  data-bx-calendar-section-without-action="','"></li>\n\t\t\t\t\t'])),t));o=i.appendChild(a.Dom.create("DIV",{props:{className:"calendar-field-select-icon"},style:{backgroundColor:e.color}}))}else{i=n.appendChild(a.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t\t<li class="calendar-list-slider-item" data-bx-calendar-section="','"></li>\n\t\t\t\t\t'])),t));o=i.appendChild(a.Dom.create("DIV",{props:{className:"calendar-list-slider-item-checkbox"+(e.isShown()?" calendar-list-slider-item-checkbox-checked":"")},style:{backgroundColor:e.color}}))}var l=i.appendChild(a.Tag.render(W||(W=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-list-slider-item-name" title="','">',"</div>\n\t\t\t\t\t"])),BX.util.htmlspecialchars(e.name),BX.util.htmlspecialchars(e.name)));e.DOM.item=i;e.DOM.checkbox=o;e.DOM.title=l;e.DOM.actionCont=i.appendChild(a.Tag.render(X||(X=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="calendar-list-slider-item-actions-container" data-bx-calendar-section-menu="','">\n\t\t\t\t\t\t<span class="calendar-list-slider-item-context-menu"></span>\n\t\t\t\t\t</div>\n\t\t\t\t'])),t))})}}},{key:"roomClickHandler",value:function e(t){var s=n.Util.findTargetNode(t.target||t.srcElement,this.DOM.outerWrap);if(s&&s.getAttribute){if(s.getAttribute("data-bx-calendar-section-menu")!==null){var a=s.getAttribute("data-bx-calendar-section-menu");this.showRoomMenu(this.roomsManager.getRoom(a),s)}else if(s.getAttribute("data-bx-calendar-section")!==null){var i=s.getAttribute("data-bx-calendar-section");this.switchSection(this.roomsManager.getRoom(i))}}}},{key:"findCheckBoxNodes",value:function e(t){return this.DOM.roomListWrap.querySelectorAll(".calendar-list-slider-item[data-bx-calendar-section='"+t+"'] .calendar-list-slider-item-checkbox")}},{key:"destroy",value:function e(t){if(t&&t.getSlider&&t.getSlider().getUrl()===this.sliderId){this.destroyEventEmitterSubscriptions();BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.SidePanel.Instance.destroy(this.sliderId);delete this.DOM.roomListWrap;if(this.roomActionMenu){this.roomActionMenu.close()}}}},{key:"deleteRoomHandler",value:function e(t){var s=this;if(t&&t instanceof n.Util.getBX().Event.BaseEvent){var i=t.getData();var o=parseInt(i.id);this.sliderRoom.forEach(function(e,t){if(parseInt(e.id)===o&&e.DOM&&e.DOM.item){a.Dom.addClass(e.DOM.item,"calendar-list-slider-item-disappearing");setTimeout(function(){a.Dom.clean(e.DOM.item,true);s.sliderRoom.splice(t,1)},300)}},this);this.closeForms()}}},{key:"deleteRoom",value:function e(t){this.roomsManager.deleteRoom(t.id,t.location_id)}}]);return t}(s.SectionInterface);e.ReserveButton=l;e.RoomsInterface=x;e.EditFormRoom=k})(this.BX.Calendar.Rooms=this.BX.Calendar.Rooms||{},BX.Calendar.Controls,BX.Calendar,BX,BX.Event,BX.UI.EntitySelector,BX.Calendar);
//# sourceMappingURL=rooms.bundle.map.js