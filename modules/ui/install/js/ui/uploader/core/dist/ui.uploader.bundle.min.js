this.BX=this.BX||{};this.BX.UI=this.BX.UI||{};(function(e,s,t){"use strict";const i={INIT:"init",ADDED:"added",LOADING:"loading",PENDING:"pending",UPLOADING:"uploading",COMPLETE:"complete",LOAD_FAILED:"load-failed",UPLOAD_FAILED:"upload-failed"};const r={CLIENT:"client",SERVER:"server"};const l={ADD:"onAdd",BEFORE_UPLOAD:"onBeforeUpload",UPLOAD_START:"onUploadStart",UPLOAD_ERROR:"onUploadError",UPLOAD_PROGRESS:"onUploadProgress",UPLOAD_COMPLETE:"onUploadComplete",UPLOAD_CONTROLLER_INIT:"onUploadControllerInit",LOAD_START:"onLoadStart",LOAD_PROGRESS:"onLoadProgress",LOAD_COMPLETE:"onLoadComplete",LOAD_ERROR:"onLoadError",LOAD_CONTROLLER_INIT:"onLoadControllerInit",REMOVE_ERROR:"onRemoveError",REMOVE_COMPLETE:"onRemoveComplete",REMOVE_CONTROLLER_INIT:"onRemoveControllerInit",STATE_CHANGE:"onStateChange",STATUS_CHANGE:"onStatusChange",VALIDATE_FILE_ASYNC:"onValidateFileAsync",PREPARE_FILE_ASYNC:"onPrepareFileAsync"};class a extends t.BaseError{constructor(e,...s){let i=t.Type.isString(s[0])?s[0]:null;let r=t.Type.isString(s[1])?s[1]:null;const l=t.Type.isPlainObject(s[s.length-1])?s[s.length-1]:{};const o={};Object.keys(l).forEach((e=>{o[`#${e}#`]=l[e]}));if(!t.Type.isString(i)&&t.Loc.hasMessage(`UPLOADER_${e}`)){i=t.Loc.getMessage(`UPLOADER_${e}`,o)}if(t.Type.isStringFilled(i)&&!t.Type.isString(r)&&t.Loc.hasMessage(`UPLOADER_${e}_DESC`)){r=t.Loc.getMessage(`UPLOADER_${e}_DESC`,o)}super(i,e,l);this.description="";this.origin=a.Origin.CLIENT;this.type=a.Type.USER;this.setDescription(r)}static createFromAjaxErrors(e){if(!t.Type.isArrayFilled(e)||!t.Type.isPlainObject(e[0])){return new this("SERVER_ERROR")}const s=e.find((e=>e.type==="file-uploader"));if(s&&!s.system){const{code:e,message:t,description:i,customData:r}=s;const l=new this(e,t,i,r);l.setOrigin(a.Origin.SERVER);l.setType(a.Type.USER);return l}let{code:i,message:r,description:l}=e[0];const{customData:o,system:n,type:c}=e[0];if(i==="NETWORK_ERROR"){r=t.Loc.getMessage("UPLOADER_NETWORK_ERROR")}else{i=t.Type.isStringFilled(i)?i:"SERVER_ERROR";if(!t.Type.isStringFilled(l)){l=r;r=t.Loc.getMessage("UPLOADER_SERVER_ERROR")}}console.error("Uploader",e);const d=new this(i,r,l,o);d.setOrigin(a.Origin.SERVER);if(c==="file-uploader"){d.setType(n?a.Type.SYSTEM:a.Type.USER)}else{d.setType(a.Type.UNKNOWN)}return d}static createFromError(e){return new this(e.name,e.message)}getDescription(){return this.description}setDescription(e){if(t.Type.isString(e)){this.description=e}return this}getOrigin(){return this.origin}setOrigin(e){if(Object.values(a.Origin).includes(e)){this.origin=e}return this}getType(){return this.type}setType(e){if(t.Type.isStringFilled(e)){this.type=e}return this}clone(){const e=JSON.parse(JSON.stringify(this));const s=new a(e.code,e.message,e.description,e.customData);s.setOrigin(e.origin);s.setType(e.type);return s}toString(){return`Uploader Error (${this.getCode()}): ${this.getMessage()} (${this.getOrigin()})`}toJSON(){return{code:this.getCode(),message:this.getMessage(),description:this.getDescription(),origin:this.getOrigin(),type:this.getType(),customData:this.getCustomData()}}}a.Origin={SERVER:"server",CLIENT:"client"};a.Type={USER:"user",SYSTEM:"system",UNKNOWN:"unknown"};var o=babelHelpers.classPrivateFieldLooseKey("server");var n=babelHelpers.classPrivateFieldLooseKey("options");class c extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.UploadController");babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}getOption(e,s){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,n)[n][e])){return babelHelpers.classPrivateFieldLooseBase(this,n)[n][e]}if(!t.Type.isUndefined(s)){return s}return null}upload(e){throw new Error("You must implement upload() method.")}abort(){throw new Error("You must implement abort() method.")}}var d=babelHelpers.classPrivateFieldLooseKey("server");var h=babelHelpers.classPrivateFieldLooseKey("options");class b extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,d,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.LoadController");babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,d)[d]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,h)[h]}getOption(e,s){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,h)[h][e])){return babelHelpers.classPrivateFieldLooseBase(this,h)[h][e]}if(!t.Type.isUndefined(s)){return s}return null}load(e){throw new Error("You must implement load() method.")}abort(){throw new Error("You must implement abort() method.")}}var p=babelHelpers.classPrivateFieldLooseKey("server");var u=babelHelpers.classPrivateFieldLooseKey("options");class v extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});this.setEventNamespace("BX.UI.Uploader.RemoveController");babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=s}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}getOptions(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}getOption(e,s){if(!t.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,u)[u][e])){return babelHelpers.classPrivateFieldLooseBase(this,u)[u][e]}if(!t.Type.isUndefined(s)){return s}return null}remove(e){throw new Error("You must implement remove() method.")}}let g=window.crypto||window.msCrypto;if(!g&&typeof process==="object"){g=require("crypto").webcrypto}const P=()=>`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replaceAll(/[018]/g,(e=>(e^g.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));const F=e=>{if(!t.Type.isStringFilled(e)){return""}const s=e.split("/").pop();if(/javascript/.test(s)){return"js"}if(/plain/.test(s)){return"txt"}if(/svg/.test(s)){return"svg"}if(/[a-z]+/.test(s)){return s}return""};let f=0;const L=(e,s)=>{let i=s;if(!t.Type.isStringFilled(i)){const s=new Date;i=`File ${s.getFullYear()}-${s.getMonth()}-${s.getDate()}-${++f}`;const t=F(e.type);if(t){i+=`.${t}`}}try{return new File([e],i,{lastModified:Date.now(),lastModifiedDate:new Date,type:e.type})}catch{const s=e.slice(0,e.size,e.type);s.name=i;s.lastModified=Date.now();s.lastModifiedDate=new Date;return s}};const m=/^data:((?:\w+\/(?:(?!;).)+)?)((?:;[\W\w]*?[^;])*),(.+)$/;const y=e=>t.Type.isString(e)?e.match(m):false;const H=e=>{const s=atob(e.split(",")[1]);const t=e.split(",")[0].split(":")[1].split(";")[0];const i=new ArrayBuffer(s.length);const r=new Uint8Array(i);for(let e=0;e<s.length;e++){r[e]=s.codePointAt(e)}return new Blob([i],{type:t})};const E=e=>{const s=t.Type.isStringFilled(e)?e.lastIndexOf("."):-1;return s>0?e.slice(Math.max(0,s+1)):""};const B=new Set(["jpg","bmp","jpeg","jpe","gif","png","webp"]);const T=(e,s=null)=>{const i=t.Type.isFile(e)?e.name:e;const r=t.Type.isFile(e)?e.type:s;const l=E(i).toLowerCase();return B.has(l)&&(r===null||/^image\/[\d.a-z-]+$/i.test(r))};const w=(e,s=1024)=>{let i=0;const r=S();let l=e;while(l>=s&&r[i+1]){l/=s;i++}return(t.Type.isInteger(l)?l:l.toFixed(1))+r[i]};let O=null;const S=()=>{if(O!==null){return O}const e=t.Loc.getMessage("UPLOADER_FILE_SIZE_POSTFIXES").split(/\|/);O=t.Type.isArrayFilled(e)?e:["B","kB","MB","GB","TB"];return O};var I=babelHelpers.classPrivateFieldLooseKey("id");var A=babelHelpers.classPrivateFieldLooseKey("file");var R=babelHelpers.classPrivateFieldLooseKey("serverFileId");var C=babelHelpers.classPrivateFieldLooseKey("name");var D=babelHelpers.classPrivateFieldLooseKey("size");var U=babelHelpers.classPrivateFieldLooseKey("type");var M=babelHelpers.classPrivateFieldLooseKey("width");var _=babelHelpers.classPrivateFieldLooseKey("height");var N=babelHelpers.classPrivateFieldLooseKey("treatImageAsFile");var z=babelHelpers.classPrivateFieldLooseKey("clientPreview");var j=babelHelpers.classPrivateFieldLooseKey("clientPreviewUrl");var x=babelHelpers.classPrivateFieldLooseKey("clientPreviewWidth");var K=babelHelpers.classPrivateFieldLooseKey("clientPreviewHeight");var k=babelHelpers.classPrivateFieldLooseKey("serverPreviewUrl");var W=babelHelpers.classPrivateFieldLooseKey("serverPreviewWidth");var G=babelHelpers.classPrivateFieldLooseKey("serverPreviewHeight");var V=babelHelpers.classPrivateFieldLooseKey("downloadUrl");var $=babelHelpers.classPrivateFieldLooseKey("status");var X=babelHelpers.classPrivateFieldLooseKey("origin");var J=babelHelpers.classPrivateFieldLooseKey("errors");var Y=babelHelpers.classPrivateFieldLooseKey("progress");var q=babelHelpers.classPrivateFieldLooseKey("customData");var Q=babelHelpers.classPrivateFieldLooseKey("uploadController");var Z=babelHelpers.classPrivateFieldLooseKey("loadController");var ee=babelHelpers.classPrivateFieldLooseKey("removeController");var se=babelHelpers.classPrivateFieldLooseKey("forceServerLoad");var te=babelHelpers.classPrivateFieldLooseKey("uploadCallbacks");var ie=babelHelpers.classPrivateFieldLooseKey("setStatus");class re extends s.EventEmitter{constructor(e,s={}){super();Object.defineProperty(this,ie,{value:le});Object.defineProperty(this,I,{writable:true,value:null});Object.defineProperty(this,A,{writable:true,value:null});Object.defineProperty(this,R,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:null});Object.defineProperty(this,D,{writable:true,value:0});Object.defineProperty(this,U,{writable:true,value:""});Object.defineProperty(this,M,{writable:true,value:null});Object.defineProperty(this,_,{writable:true,value:null});Object.defineProperty(this,N,{writable:true,value:false});Object.defineProperty(this,z,{writable:true,value:null});Object.defineProperty(this,j,{writable:true,value:null});Object.defineProperty(this,x,{writable:true,value:null});Object.defineProperty(this,K,{writable:true,value:null});Object.defineProperty(this,k,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:null});Object.defineProperty(this,G,{writable:true,value:null});Object.defineProperty(this,V,{writable:true,value:null});Object.defineProperty(this,$,{writable:true,value:i.INIT});Object.defineProperty(this,X,{writable:true,value:r.CLIENT});Object.defineProperty(this,J,{writable:true,value:[]});Object.defineProperty(this,Y,{writable:true,value:0});Object.defineProperty(this,q,{writable:true,value:Object.create(null)});Object.defineProperty(this,Q,{writable:true,value:null});Object.defineProperty(this,Z,{writable:true,value:null});Object.defineProperty(this,ee,{writable:true,value:null});Object.defineProperty(this,se,{writable:true,value:false});Object.defineProperty(this,te,{writable:true,value:new oe(this)});this.setEventNamespace("BX.UI.Uploader.File");const a=t.Type.isPlainObject(s)?s:{};if(t.Type.isFile(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e;this.update(a)}else if(t.Type.isBlob(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=L(e,a.name||e.name);this.update(a)}else if(y(e)){const s=H(e);babelHelpers.classPrivateFieldLooseBase(this,A)[A]=L(s,a.name);this.update(a)}else if(t.Type.isNumber(e)||t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,X)[X]=r.SERVER;babelHelpers.classPrivateFieldLooseBase(this,R)[R]=e;this.update(a)}else if(t.Type.isPlainObject(e)&&(t.Type.isNumber(e.serverFileId)||t.Type.isStringFilled(e.serverFileId))){babelHelpers.classPrivateFieldLooseBase(this,X)[X]=r.SERVER;this.update(e)}babelHelpers.classPrivateFieldLooseBase(this,I)[I]=t.Type.isStringFilled(a.id)?a.id:P();if(babelHelpers.classPrivateFieldLooseBase(this,X)[X]===r.SERVER){babelHelpers.classPrivateFieldLooseBase(this,se)[se]=a.preload===true||t.Type.isPlainObject(e)&&e.preload===true}this.subscribeFromOptions({[l.ADD]:()=>{babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.ADDED)}});this.subscribeFromOptions(a.events)}load(){if(!this.canLoad()){return}babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.LOADING);this.emit(l.LOAD_START);babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].load(this)}shouldForceServerLoad(){return babelHelpers.classPrivateFieldLooseBase(this,se)[se]}upload(e={}){babelHelpers.classPrivateFieldLooseBase(this,te)[te].subscribe(e);if(this.isComplete()&&this.isUploadable()){babelHelpers.classPrivateFieldLooseBase(this,te)[te].emit("onComplete");return}if(this.isUploadFailed()){babelHelpers.classPrivateFieldLooseBase(this,te)[te].emit("onError",{error:this.getError()});return}if(!this.canUpload()){babelHelpers.classPrivateFieldLooseBase(this,te)[te].emit("onError",{error:new a("FILE_UPLOAD_NOT_ALLOWED")});return}const t=new s.BaseEvent({data:{file:this}});this.emit(l.BEFORE_UPLOAD,t);if(t.isDefaultPrevented()){return}const r=new s.BaseEvent({data:{file:this}});this.emitAsync(l.PREPARE_FILE_ASYNC,r).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.UPLOADING);this.emit(l.UPLOAD_START);babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].upload(this)})).catch((e=>{const s=this.addError(e);babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.UPLOAD_FAILED);this.emit(l.UPLOAD_ERROR,{error:s})}))}remove(e){if(this.getStatus()===i.INIT){return}babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.INIT);this.emit(l.REMOVE_COMPLETE);this.abort();const s=!e||e.removeFromServer!==false;if(s&&babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]!==null&&this.getOrigin()===r.CLIENT){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].remove(this)}babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=null;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=null;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=null}abort(){if(this.isLoading()){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.LOAD_FAILED);const e=new a("FILE_LOAD_ABORTED");this.emit(l.LOAD_ERROR,{error:e})}else if(this.isUploading()){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.UPLOAD_FAILED);const e=new a("FILE_UPLOAD_ABORTED");this.emit("onUploadError",{error:e});babelHelpers.classPrivateFieldLooseBase(this,te)[te].emit("onError",{error:e})}if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].abort()}if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].abort()}}getUploadController(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]}setUploadController(e){if(!(e instanceof c)&&!t.Type.isNull(e)){return}const s=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]!==e;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=e;if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]&&s){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].subscribeOnce("onError",(e=>{const s=this.addError(e.getData().error);babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.UPLOAD_FAILED);this.emit(l.UPLOAD_ERROR,{error:s});babelHelpers.classPrivateFieldLooseBase(this,te)[te].emit("onError",{error:s})}));babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].subscribe("onProgress",(e=>{const{progress:s}=e.getData();this.setProgress(s);this.emit(l.UPLOAD_PROGRESS,{progress:s})}));babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].subscribeOnce("onUpload",(e=>{babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.COMPLETE);this.update(e.getData().fileInfo);this.emit(l.UPLOAD_COMPLETE);babelHelpers.classPrivateFieldLooseBase(this,te)[te].emit("onComplete")}))}if(s){this.emit(l.UPLOAD_CONTROLLER_INIT,{controller:e})}}setLoadController(e){if(!(e instanceof b)){return}const t=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]!==e;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=e;if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]&&t){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].subscribeOnce("onError",(e=>{const s=this.addError(e.getData().error);babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:s})}));babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].subscribe("onProgress",(e=>{const{progress:s}=e.getData();this.emit(l.LOAD_PROGRESS,{progress:s})}));babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].subscribeOnce("onLoad",(e=>{if(this.getOrigin()===r.CLIENT){const e=new s.BaseEvent({data:{file:this}});this.emitAsync(l.VALIDATE_FILE_ASYNC,e).then((()=>{if(this.isUploadable()){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.PENDING);this.emit(l.LOAD_COMPLETE)}else{const e=new s.BaseEvent({data:{file:this}});this.emitAsync(l.PREPARE_FILE_ASYNC,e).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.COMPLETE);this.emit(l.LOAD_COMPLETE)})).catch((e=>{const s=this.addError(e);babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:s})}))}})).catch((e=>{const s=this.addError(e);babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.LOAD_FAILED);this.emit(l.LOAD_ERROR,{error:s})}))}else{this.update(e.getData().fileInfo);if(this.isUploadable()){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.PENDING)}else{babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](i.COMPLETE)}this.emit(l.LOAD_COMPLETE)}}))}if(t){this.emit(l.LOAD_CONTROLLER_INIT,{controller:e})}}setRemoveController(e){if(!(e instanceof v)&&!t.Type.isNull(e)){return}const s=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]!==e;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=e;if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]&&s){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].subscribeOnce("onError",(e=>{}));babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].subscribeOnce("onRemove",(e=>{}))}if(s){this.emit(l.REMOVE_CONTROLLER_INIT,{controller:e})}}isReadyToUpload(){return this.getStatus()===i.PENDING}isUploadable(){return babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]!==null}isLoadable(){return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]!==null}isRemoveable(){return babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]!==null}canUpload(){return this.isReadyToUpload()&&this.isUploadable()}canLoad(){return this.getStatus()===i.ADDED&&this.isLoadable()}isUploading(){return this.getStatus()===i.UPLOADING}isLoading(){return this.getStatus()===i.LOADING}isComplete(){return this.getStatus()===i.COMPLETE}isFailed(){return this.getStatus()===i.LOAD_FAILED||this.getStatus()===i.UPLOAD_FAILED}isLoadFailed(){return this.getStatus()===i.LOAD_FAILED}isUploadFailed(){return this.getStatus()===i.UPLOAD_FAILED}getBinary(){return babelHelpers.classPrivateFieldLooseBase(this,A)[A]}setFile(e){if(t.Type.isFile(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e}else if(t.Type.isBlob(e)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=L(e,this.getName())}}update(e){if(t.Type.isPlainObject(e)){this.setName(e.name);this.setType(e.type);this.setSize(e.size);this.setServerFileId(e.serverFileId);this.setWidth(e.width);this.setHeight(e.height);this.setTreatImageAsFile(e.treatImageAsFile);this.setClientPreview(e.clientPreview,e.clientPreviewWidth,e.clientPreviewHeight);this.setServerPreview(e.serverPreviewUrl,e.serverPreviewWidth,e.serverPreviewHeight);this.setDownloadUrl(e.downloadUrl);this.setCustomData(e.customData);this.setLoadController(e.loadController);this.setUploadController(e.uploadController);this.setRemoveController(e.removeController)}}getName(){return babelHelpers.classPrivateFieldLooseBase(this,C)[C]===null?this.getBinary()?this.getBinary().name:"":babelHelpers.classPrivateFieldLooseBase(this,C)[C]}setName(e){if(t.Type.isStringFilled(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;this.emit(l.STATE_CHANGE,{property:"name",value:e})}}getExtension(){const e=this.getName();const s=e.lastIndexOf(".");return s>=0?e.slice(Math.max(0,s+1)).toLowerCase():""}getType(){return this.getBinary()?this.getBinary().type:babelHelpers.classPrivateFieldLooseBase(this,U)[U]}setType(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e;this.emit(l.STATE_CHANGE,{property:"type",value:e})}}getSize(){return this.getBinary()?this.getBinary().size:babelHelpers.classPrivateFieldLooseBase(this,D)[D]}getSizeFormatted(){return w(this.getSize())}setSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e;this.emit(l.STATE_CHANGE,{property:"size",value:e})}}getId(){return babelHelpers.classPrivateFieldLooseBase(this,I)[I]}getServerFileId(){return babelHelpers.classPrivateFieldLooseBase(this,R)[R]}getServerId(){return this.getServerFileId()}setServerFileId(e){if(t.Type.isNumber(e)||t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,R)[R]=e;this.emit(l.STATE_CHANGE,{property:"serverFileId",value:e})}}getStatus(){return babelHelpers.classPrivateFieldLooseBase(this,$)[$]}getOrigin(){return babelHelpers.classPrivateFieldLooseBase(this,X)[X]}getDownloadUrl(){return babelHelpers.classPrivateFieldLooseBase(this,V)[V]}setDownloadUrl(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,V)[V]=e;this.emit(l.STATE_CHANGE,{property:"downloadUrl",value:e})}}getWidth(){return babelHelpers.classPrivateFieldLooseBase(this,M)[M]}setWidth(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,M)[M]=e;this.emit(l.STATE_CHANGE,{property:"width",value:e})}}getHeight(){return babelHelpers.classPrivateFieldLooseBase(this,_)[_]}setHeight(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,_)[_]=e;this.emit(l.STATE_CHANGE,{property:"height",value:e})}}setTreatImageAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e;this.emit(l.STATE_CHANGE,{property:"treatImageAsFile",value:e})}}shouldTreatImageAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N]}getPreviewUrl(){return this.getClientPreview()?this.getClientPreviewUrl():this.getServerPreviewUrl()}getPreviewWidth(){return this.getClientPreview()?this.getClientPreviewWidth():this.getServerPreviewWidth()}getPreviewHeight(){return this.getClientPreview()?this.getClientPreviewHeight():this.getServerPreviewHeight()}getClientPreview(){return babelHelpers.classPrivateFieldLooseBase(this,z)[z]}setClientPreview(e,s=null,i=null){if(t.Type.isBlob(e)||t.Type.isNull(e)){this.revokeClientPreviewUrl();const r=t.Type.isNull(e)?null:URL.createObjectURL(e);babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e;babelHelpers.classPrivateFieldLooseBase(this,j)[j]=r;babelHelpers.classPrivateFieldLooseBase(this,x)[x]=s;babelHelpers.classPrivateFieldLooseBase(this,K)[K]=i;this.emit(l.STATE_CHANGE,{property:"clientPreviewUrl",value:r});this.emit(l.STATE_CHANGE,{property:"clientPreviewWidth",value:s});this.emit(l.STATE_CHANGE,{property:"clientPreviewHeight",value:i})}}getClientPreviewUrl(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]}revokeClientPreviewUrl(){if(babelHelpers.classPrivateFieldLooseBase(this,j)[j]!==null){URL.revokeObjectURL(babelHelpers.classPrivateFieldLooseBase(this,j)[j]);babelHelpers.classPrivateFieldLooseBase(this,j)[j]=null;this.emit(l.STATE_CHANGE,{property:"clientPreviewUrl",value:null})}}getClientPreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,x)[x]}getClientPreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K]}getServerPreviewUrl(){return babelHelpers.classPrivateFieldLooseBase(this,k)[k]}setServerPreview(e,s=null,i=null){if(t.Type.isStringFilled(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e;babelHelpers.classPrivateFieldLooseBase(this,W)[W]=s;babelHelpers.classPrivateFieldLooseBase(this,G)[G]=i;this.emit(l.STATE_CHANGE,{property:"serverPreviewUrl",value:e});this.emit(l.STATE_CHANGE,{property:"serverPreviewWidth",value:s});this.emit(l.STATE_CHANGE,{property:"serverPreviewHeight",value:i})}}getServerPreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W]}getServerPreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,G)[G]}isImage(){if(this.shouldTreatImageAsFile()){return false}return this.getWidth()>0&&this.getHeight()>0&&T(this.getName(),this.getType())}getProgress(){return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]}setProgress(e){if(t.Type.isNumber(e)){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=e;this.emit(l.STATE_CHANGE,{property:"progress",value:e})}}addError(e){const s=e instanceof Error?a.createFromError(e):e;babelHelpers.classPrivateFieldLooseBase(this,J)[J].push(s);this.emit(l.STATE_CHANGE);return s}getError(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J][0]||null}getErrors(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J]}getState(){return JSON.parse(JSON.stringify(this))}setCustomData(e,s){if(t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,q)[q]=Object.create(null);this.emit(l.STATE_CHANGE,{property:"customData",value:null})}else if(t.Type.isPlainObject(e)){Object.entries(e).forEach((e=>{const[s,t]=e;this.setCustomData(s,t)}))}else if(t.Type.isString(e)){if(t.Type.isNull(s)){delete babelHelpers.classPrivateFieldLooseBase(this,q)[q][e];this.emit(l.STATE_CHANGE,{property:"customData",customProperty:e,value:null})}else if(!t.Type.isUndefined(s)){babelHelpers.classPrivateFieldLooseBase(this,q)[q][e]=s;this.emit(l.STATE_CHANGE,{property:"customData",customProperty:e,value:s})}}}getCustomData(e){if(t.Type.isUndefined(e)){return babelHelpers.classPrivateFieldLooseBase(this,q)[q]}if(t.Type.isStringFilled(e)){return babelHelpers.classPrivateFieldLooseBase(this,q)[q][e]}return undefined}toJSON(){return{id:this.getId(),serverFileId:this.getServerFileId(),serverId:this.getServerFileId(),status:this.getStatus(),name:this.getName(),size:this.getSize(),sizeFormatted:this.getSizeFormatted(),type:this.getType(),extension:this.getExtension(),origin:this.getOrigin(),isImage:this.isImage(),failed:this.isFailed(),width:this.getWidth(),height:this.getHeight(),progress:this.getProgress(),error:this.getError(),errors:this.getErrors(),previewUrl:this.getPreviewUrl(),previewWidth:this.getPreviewWidth(),previewHeight:this.getPreviewHeight(),clientPreviewUrl:this.getClientPreviewUrl(),clientPreviewWidth:this.getClientPreviewWidth(),clientPreviewHeight:this.getClientPreviewHeight(),serverPreviewUrl:this.getServerPreviewUrl(),serverPreviewWidth:this.getServerPreviewWidth(),serverPreviewHeight:this.getServerPreviewHeight(),downloadUrl:this.getDownloadUrl(),customData:this.getCustomData()}}}function le(e){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=e;this.emit(l.STATE_CHANGE,{property:"status",value:e});this.emit(l.STATUS_CHANGE)}var ae=babelHelpers.classPrivateFieldLooseKey("emitter");class oe{constructor(e){Object.defineProperty(this,ae,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=new s.EventEmitter(e,"BX.UI.Uploader.File.UploadCallbacks")}subscribe(e={}){const s=t.Type.isPlainObject(e)?e:{};if(t.Type.isFunction(s.onComplete)){this.getEmitter().subscribeOnce("onComplete",s.onComplete)}if(t.Type.isFunction(s.onError)){this.getEmitter().subscribeOnce("onError",s.onError)}}emit(e,s){if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].emit(e,s);babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].unsubscribeAll()}}getEmitter(){if(t.Type.isNull(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae])){babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=new s.EventEmitter(this,"BX.UI.Uploader.File.UploadCallbacks")}return babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]}}var ne=babelHelpers.classPrivateFieldLooseKey("data");var ce=babelHelpers.classPrivateFieldLooseKey("offset");var de=babelHelpers.classPrivateFieldLooseKey("retries");class he{constructor(e,s){Object.defineProperty(this,ne,{writable:true,value:null});Object.defineProperty(this,ce,{writable:true,value:0});Object.defineProperty(this,de,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=e;babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=s}getNextRetryDelay(){if(babelHelpers.classPrivateFieldLooseBase(this,de)[de].length===0){return null}return babelHelpers.classPrivateFieldLooseBase(this,de)[de].shift()}setRetries(e){if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,de)[de]=e}}getData(){return babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]}getOffset(){return babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]}getSize(){return this.getData().size}}var be=babelHelpers.classPrivateFieldLooseKey("file");var pe=babelHelpers.classPrivateFieldLooseKey("chunkOffset");var ue=babelHelpers.classPrivateFieldLooseKey("chunkTimeout");var ve=babelHelpers.classPrivateFieldLooseKey("token");var ge=babelHelpers.classPrivateFieldLooseKey("xhr");var Pe=babelHelpers.classPrivateFieldLooseKey("aborted");var Fe=babelHelpers.classPrivateFieldLooseKey("uploadChunk");var fe=babelHelpers.classPrivateFieldLooseKey("retryUploadChunk");var Le=babelHelpers.classPrivateFieldLooseKey("getNextChunk");class me extends c{constructor(e,s={}){super(e,s);Object.defineProperty(this,Le,{value:Ee});Object.defineProperty(this,fe,{value:He});Object.defineProperty(this,Fe,{value:ye});Object.defineProperty(this,be,{writable:true,value:null});Object.defineProperty(this,pe,{writable:true,value:null});Object.defineProperty(this,ue,{writable:true,value:null});Object.defineProperty(this,ve,{writable:true,value:null});Object.defineProperty(this,ge,{writable:true,value:null});Object.defineProperty(this,Pe,{writable:true,value:false})}upload(e){if(!t.Type.isFile(e.getBinary())){this.emit("onError",{error:new a("WRONG_FILE_SOURCE")});return}if(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]!==null){return}babelHelpers.classPrivateFieldLooseBase(this,be)[be]=e;const s=babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]();if(s){babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](s)}}abort(){if(babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=true;babelHelpers.classPrivateFieldLooseBase(this,ge)[ge].abort();babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]=null}clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue])}getFile(){return babelHelpers.classPrivateFieldLooseBase(this,be)[be]}getChunkSize(){return this.getServer().getChunkSize()}getChunkOffset(){return babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]}getToken(){return babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]}setToken(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=e}}}function ye(e){const s=this.getFile().getSize();const i=e.getOffset()===0&&s===e.getSize();let r=this.getFile().getName();if(r.normalize){r=r.normalize()}const l=t.Type.isStringFilled(this.getFile().getType())?this.getFile().getType():"application/octet-stream";const o=[{name:"Content-Type",value:l},{name:"X-Upload-Content-Name",value:encodeURIComponent(r)}];if(!i){const t=e.getOffset();const i=e.getOffset()+e.getSize()-1;const r=`bytes ${t}-${i}/${s}`;o.push({name:"Content-Range",value:r})}const n=this.getServer().getControllerOptions();t.ajax.runAction("ui.fileuploader.upload",{headers:o,data:e.getData(),preparePost:false,getParameters:{controller:this.getServer().getController(),controllerOptions:n?JSON.stringify(n):null,token:this.getToken()||""},onrequeststart:e=>{babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]=e;babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=false},onprogressupload:s=>{if(s.lengthComputable){const t=this.getFile().getSize();const i=Math.min(t,e.getOffset()+s.loaded);const r=t>0?Math.floor(i/t*100):100;this.emit("onProgress",{progress:r})}}}).then((s=>{if(s.data.token){this.setToken(s.data.token);if(this.getFile().getServerFileId()===null){this.getFile().setServerFileId(s.data.token)}const t=this.getFile().getSize();const i=t>0?Math.floor((e.getOffset()+e.getSize())/t*100):100;this.emit("onProgress",{progress:i});const r=babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]();if(r){babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](r)}else{this.emit("onProgress",{progress:100});this.emit("onUpload",{fileInfo:s.data.file})}}else{this.emit("onError",{error:new a("SERVER_ERROR")})}})).catch((s=>{if(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]){return}const t=a.createFromAjaxErrors(s.errors);const i=t.getCode()==="NETWORK_ERROR"||t.getType()===a.Type.UNKNOWN;if(!i||!babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e)){this.emit("onError",{error:t})}}))}function He(e){const s=e.getNextRetryDelay();if(s===null){return false}clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]);babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](e)}),s);return true}function Ee(){if(this.getChunkOffset()!==null&&this.getChunkOffset()>=this.getFile().getSize()){return null}if(this.getChunkOffset()===null){babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]=0}let e=null;if(this.getChunkOffset()===0&&this.getFile().getSize()<=this.getChunkSize()){e=new he(this.getFile().getBinary(),this.getChunkOffset());babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]=this.getFile().getSize()}else{const s=Math.min(this.getChunkSize(),this.getFile().getSize()-this.getChunkOffset());const t=this.getChunkOffset()+s;const i=this.getFile().getBinary().slice(this.getChunkOffset(),t);e=new he(i,this.getChunkOffset());babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]=t}e.setRetries([...this.getServer().getChunkRetryDelays()]);return e}const Be=new WeakMap;const Te=new WeakMap;function we(e,s){const i=e.getServer();const r=e.getOption("timeout",100);let l=Be.get(i);if(!l){l={tasks:[],load:t.Runtime.debounce(Se,r,i),xhr:null,aborted:false};Be.set(i,l)}l.tasks.push({controller:e,file:s});l.load()}function Oe(e,s){const t=e.getServer();const i=Be.get(t);if(i){i.tasks=i.tasks.filter((e=>e.file!==s));if(i.tasks.length===0){Be.delete(t)}}else{const e=Te.get(s);if(e){e.tasks=e.tasks.filter((e=>e.file!==s));Te.delete(s);if(e.tasks.length===0){e.aborted=true;e.xhr.abort()}}}}function Se(){const e=this;const s=Be.get(e);if(!s){return}Be.delete(e);if(s.tasks.length===0){return}const i=[];s.tasks.forEach((e=>{const t=e.file;i.push(t.getServerFileId());Te.set(t,s)}));const r=e.getControllerOptions();t.ajax.runAction("ui.fileuploader.load",{data:{fileIds:i},getParameters:{controller:e.getController(),controllerOptions:r?JSON.stringify(r):null},onrequeststart:e=>{s.xhr=e},onprogress:e=>{if(e.lengthComputable){const t=e.total>0?Math.floor(e.loaded/e.total*100):100;s.tasks.forEach((e=>{const{controller:s}=e;s.emit("onProgress",{progress:t})}))}}}).then((e=>{var t;if((t=e.data)!=null&&t.files){const t={};e.data.files.forEach((e=>{t[e.id]=e}));s.tasks.forEach((e=>{const{controller:s,file:i}=e;const r=t[i.getServerFileId()]||null;Te.delete(i);if(r&&r.success){s.emit("onProgress",{progress:100});s.emit("onLoad",{fileInfo:r.data.file})}else{const e=a.createFromAjaxErrors(r==null?void 0:r.errors);s.emit("onError",{error:e})}}))}else{const e=new a("SERVER_ERROR");s.tasks.forEach((s=>{const{controller:t,file:i}=s;Te.delete(i);t.emit("onError",{error:e.clone()})}))}})).catch((e=>{const t=s.aborted?null:a.createFromAjaxErrors(e.errors);s.tasks.forEach((e=>{const{controller:i,file:r}=e;Te.delete(r);if(!s.aborted){i.emit("onError",{error:t.clone()})}}))}))}var Ie=babelHelpers.classPrivateFieldLooseKey("file");class Ae extends b{constructor(e,s={}){super(e,s);Object.defineProperty(this,Ie,{writable:true,value:null})}load(e){if(this.getServer().getController()){babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]=e;we(this,e)}else{this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:null})}}abort(){if(this.getServer().getController()&&babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]){Oe(this,babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie])}}}class Re extends b{constructor(e,s={}){super(e,s)}load(e){if(t.Type.isFile(e.getBinary())){this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:e})}else{this.emit("onError",{error:new a("WRONG_FILE_SOURCE")})}}abort(){}}const Ce=new WeakMap;function De(e,s){const i=e.getServer();let r=Ce.get(i);if(!r){r={tasks:[],remove:t.Runtime.debounce(Ue,1e3,i),xhr:null};Ce.set(i,r)}r.tasks.push({controller:e,file:s});r.remove()}function Ue(){const e=this;const s=Ce.get(e);if(!s){return}const{tasks:i}=s;Ce.delete(e);const r=[];i.forEach((e=>{const s=e.file;if(s.getServerFileId()!==null){r.push(s.getServerFileId())}}));if(r.length===0){return}const l=e.getControllerOptions();t.ajax.runAction("ui.fileuploader.remove",{data:{fileIds:r},getParameters:{controller:e.getController(),controllerOptions:l?JSON.stringify(l):null},onrequeststart:e=>{s.xhr=e}}).then((e=>{var s;if((s=e.data)!=null&&s.files){const s={};e.data.files.forEach((e=>{s[e.id]=e}));i.forEach((e=>{const{controller:t,file:i}=e;const r=s[i.getServerFileId()]||null;if(r&&r.success){t.emit("onRemove",{fileId:r.id})}else{const e=a.createFromAjaxErrors(r==null?void 0:r.errors);t.emit("onError",{error:e})}}))}else{const e=new a("SERVER_ERROR");i.forEach((s=>{const{controller:t}=s;t.emit("onError",{error:e.clone()})}))}})).catch((e=>{const s=a.createFromAjaxErrors(e.errors);i.forEach((e=>{const{controller:t}=e;t.emit("onError",{error:s.clone()})}))}))}class Me extends v{remove(e){De(this,e)}}class _e extends b{constructor(e,s={}){super(e,s)}load(e){if(t.Type.isStringFilled(e.getName())){this.emit("onProgress",{progress:100});this.emit("onLoad",{fileInfo:e})}else{this.emit("onError",{error:new a("WRONG_FILE_SOURCE")})}}abort(){}}var Ne=babelHelpers.classPrivateFieldLooseKey("controller");var ze=babelHelpers.classPrivateFieldLooseKey("controllerOptions");var je=babelHelpers.classPrivateFieldLooseKey("uploadControllerClass");var xe=babelHelpers.classPrivateFieldLooseKey("uploadControllerOptions");var Ke=babelHelpers.classPrivateFieldLooseKey("loadControllerClass");var ke=babelHelpers.classPrivateFieldLooseKey("loadControllerOptions");var We=babelHelpers.classPrivateFieldLooseKey("removeControllerClass");var Ge=babelHelpers.classPrivateFieldLooseKey("removeControllerOptions");var Ve=babelHelpers.classPrivateFieldLooseKey("chunkSize");var $e=babelHelpers.classPrivateFieldLooseKey("defaultChunkSize");var Xe=babelHelpers.classPrivateFieldLooseKey("chunkMinSize");var Je=babelHelpers.classPrivateFieldLooseKey("chunkMaxSize");var Ye=babelHelpers.classPrivateFieldLooseKey("chunkRetryDelays");var qe=babelHelpers.classPrivateFieldLooseKey("calcChunkSize");class Qe{constructor(e){Object.defineProperty(this,qe,{value:Ze});Object.defineProperty(this,Ne,{writable:true,value:null});Object.defineProperty(this,ze,{writable:true,value:null});Object.defineProperty(this,je,{writable:true,value:null});Object.defineProperty(this,xe,{writable:true,value:{}});Object.defineProperty(this,Ke,{writable:true,value:null});Object.defineProperty(this,ke,{writable:true,value:{}});Object.defineProperty(this,We,{writable:true,value:null});Object.defineProperty(this,Ge,{writable:true,value:{}});Object.defineProperty(this,Ve,{writable:true,value:null});Object.defineProperty(this,$e,{writable:true,value:null});Object.defineProperty(this,Xe,{writable:true,value:null});Object.defineProperty(this,Je,{writable:true,value:null});Object.defineProperty(this,Ye,{writable:true,value:[1e3,3e3,6e3]});const s=t.Type.isPlainObject(e)?e:{};babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]=t.Type.isStringFilled(s.controller)?s.controller:null;babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=t.Type.isPlainObject(s.controllerOptions)?s.controllerOptions:null;const i=t.Type.isNumber(s.chunkSize)&&s.chunkSize>0?s.chunkSize:this.getDefaultChunkSize();babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=s.forceChunkSize===true?i:babelHelpers.classPrivateFieldLooseBase(this,qe)[qe](i);if(s.chunkRetryDelays===false||s.chunkRetryDelays===null){babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=[]}else if(t.Type.isArray(s.chunkRetryDelays)){babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=s.chunkRetryDelays}const r=["uploadControllerClass","loadControllerClass","removeControllerClass"];r.forEach((e=>{let i=null;if(t.Type.isStringFilled(s[e])){i=t.Runtime.getClass(s[e]);if(!t.Type.isFunction(i)){throw new TypeError(`Uploader.Server: "${e}" must be a function.`)}}else if(t.Type.isFunction(s[e])){i=s[e]}switch(e){case"uploadControllerClass":babelHelpers.classPrivateFieldLooseBase(this,je)[je]=i;break;case"loadControllerClass":babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]=i;break;case"removeControllerClass":babelHelpers.classPrivateFieldLooseBase(this,We)[We]=i;break;default:}}));babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]=t.Type.isPlainObject(s.loadControllerOptions)?s.loadControllerOptions:{};babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=t.Type.isPlainObject(s.uploadControllerOptions)?s.uploadControllerOptions:{};babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=t.Type.isPlainObject(s.removeControllerOptions)?s.removeControllerOptions:{}}createUploadController(){if(babelHelpers.classPrivateFieldLooseBase(this,je)[je]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,je)[je])(this,babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]);if(!(e instanceof c)){throw new TypeError('Uploader.Server: "uploadControllerClass" must be an instance of AbstractUploadController.')}return e}if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne])){return new me(this,babelHelpers.classPrivateFieldLooseBase(this,xe)[xe])}return null}createServerLoadController(){if(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke])(this,babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]);if(!(e instanceof b)){throw new TypeError('Uploader.Server: "loadControllerClass" must be an instance of AbstractLoadController.')}return e}return this.createDefaultServerLoadController()}createDefaultServerLoadController(){return new Ae(this,babelHelpers.classPrivateFieldLooseBase(this,ke)[ke])}createClientLoadController(){return new Re(this,babelHelpers.classPrivateFieldLooseBase(this,ke)[ke])}createServerlessLoadController(){return new _e(this,babelHelpers.classPrivateFieldLooseBase(this,ke)[ke])}createRemoveController(){if(babelHelpers.classPrivateFieldLooseBase(this,We)[We]){const e=new(babelHelpers.classPrivateFieldLooseBase(this,We)[We])(this,babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]);if(!(e instanceof v)){throw new TypeError('Uploader.Server: "removeControllerClass" must be an instance of AbstractRemoveController.')}return e}if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne])){return new Me(this,babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge])}return null}getController(){return babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne]}getControllerOptions(){return babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]}getChunkSize(){return babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]}getDefaultChunkSize(){if(babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]=e.get("defaultChunkSize",5*1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]}getChunkMinSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]=e.get("chunkMinSize",1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]}getChunkMaxSize(){if(babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]===null){const e=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=e.get("chunkMaxSize",5*1024*1024)}return babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]}getChunkRetryDelays(){return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]}}function Ze(e){return Math.min(Math.max(this.getChunkMinSize(),e),this.getChunkMaxSize())}var es=babelHelpers.classPrivateFieldLooseKey("uploader");class ss{constructor(e,s={}){Object.defineProperty(this,es,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,es)[es]=e}getUploader(){return babelHelpers.classPrivateFieldLooseBase(this,es)[es]}apply(...e){throw new Error("You must implement apply() method.")}}var ts=babelHelpers.classPrivateFieldLooseKey("maxFileSize");var is=babelHelpers.classPrivateFieldLooseKey("minFileSize");var rs=babelHelpers.classPrivateFieldLooseKey("maxTotalFileSize");var ls=babelHelpers.classPrivateFieldLooseKey("imageMaxFileSize");var as=babelHelpers.classPrivateFieldLooseKey("imageMinFileSize");var os=babelHelpers.classPrivateFieldLooseKey("treatOversizeImageAsFile");class ns extends ss{constructor(e,s={}){super(e);Object.defineProperty(this,ts,{writable:true,value:256*1024*1024});Object.defineProperty(this,is,{writable:true,value:0});Object.defineProperty(this,rs,{writable:true,value:null});Object.defineProperty(this,ls,{writable:true,value:48*1024*1024});Object.defineProperty(this,as,{writable:true,value:0});Object.defineProperty(this,os,{writable:true,value:false});const i=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=i.get("maxFileSize",babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]);babelHelpers.classPrivateFieldLooseBase(this,is)[is]=i.get("minFileSize",babelHelpers.classPrivateFieldLooseBase(this,is)[is]);babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=i.get("maxTotalFileSize",babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]);babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]=i.get("imageMaxFileSize",babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]);babelHelpers.classPrivateFieldLooseBase(this,as)[as]=i.get("imageMinFileSize",babelHelpers.classPrivateFieldLooseBase(this,as)[as]);const r=t.Type.isPlainObject(s)?s:{};this.setMaxFileSize(r.maxFileSize);this.setMinFileSize(r.minFileSize);this.setMaxTotalFileSize(r.maxTotalFileSize);this.setImageMaxFileSize(r.imageMaxFileSize);this.setImageMinFileSize(r.imageMinFileSize);this.setTreatOversizeImageAsFile(r.treatOversizeImageAsFile)}apply(e){return new Promise(((s,t)=>{if(this.getMaxFileSize()!==null&&e.getSize()>this.getMaxFileSize()){t(new a("MAX_FILE_SIZE_EXCEEDED",{maxFileSize:w(this.getMaxFileSize()),maxFileSizeInBytes:this.getMaxFileSize()}));return}if(e.getSize()<this.getMinFileSize()){t(new a("MIN_FILE_SIZE_EXCEEDED",{minFileSize:w(this.getMinFileSize()),minFileSizeInBytes:this.getMinFileSize()}));return}if(T(e.getName(),e.getType())){if(this.getImageMaxFileSize()!==null&&e.getSize()>this.getImageMaxFileSize()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true)}else{t(new a("IMAGE_MAX_FILE_SIZE_EXCEEDED",{imageMaxFileSize:w(this.getImageMaxFileSize()),imageMaxFileSizeInBytes:this.getImageMaxFileSize()}));return}}if(e.getSize()<this.getImageMinFileSize()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true)}else{t(new a("IMAGE_MIN_FILE_SIZE_EXCEEDED",{imageMinFileSize:w(this.getImageMinFileSize()),imageMinFileSizeInBytes:this.getImageMinFileSize()}));return}}}if(this.getMaxTotalFileSize()!==null&&this.getUploader().getTotalSize()>this.getMaxTotalFileSize()){t(new a("MAX_TOTAL_FILE_SIZE_EXCEEDED",{maxTotalFileSize:w(this.getMaxTotalFileSize()),maxTotalFileSizeInBytes:this.getMaxTotalFileSize()}));return}s()}))}getMaxFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]}setMaxFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=e}}getMinFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,is)[is]}setMinFileSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,is)[is]=e}}getMaxTotalFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]}setMaxTotalFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,rs)[rs]=e}}getImageMaxFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]}setImageMaxFileSize(e){if(t.Type.isNumber(e)&&e>=0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]=e}}getImageMinFileSize(){return babelHelpers.classPrivateFieldLooseBase(this,as)[as]}setImageMinFileSize(e){if(t.Type.isNumber(e)&&e>=0){babelHelpers.classPrivateFieldLooseBase(this,as)[as]=e}}setTreatOversizeImageAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,os)[os]=e}}shouldTreatOversizeImageAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,os)[os]}}const cs=(e,s)=>{if(!t.Type.isArrayFilled(s)){return true}const i=e.type;const r=i.replace(/\/.*$/,"");for(const l of s){if(!t.Type.isStringFilled(l)){continue}const s=l.trim().toLowerCase();if(s.charAt(0)==="."){if(e.name.toLowerCase().includes(s,e.name.length-s.length)){return true}}else if(/\/\*$/.test(s)){if(r===s.replace(/\/.*$/,"")){return true}}else if(i===s){return true}}return false};class ds extends ss{constructor(e,s={}){super(e)}apply(e){return new Promise(((s,t)=>{if(cs(e.getBinary(),this.getUploader().getAcceptedFileTypes())){s()}else{t(new a("FILE_TYPE_NOT_ALLOWED"))}}))}}const hs=e=>{if(e.arrayBuffer){return e.arrayBuffer()}return new Promise(((s,t)=>{const i=new FileReader;i.readAsArrayBuffer(e);i.onload=()=>{const e=i.result;s(e)};i.onerror=()=>{t(i.error)}}))};const bs=e=>{const s=[];for(let t=0;t<e.length;t++){s.push(e.codePointAt(t)&255)}return s};const ps=(e,s,t)=>{for(let i=t,r=0;r<s.length;){if(e.getUint8(i++)!==s[r++]){return false}}return true};const us=bs("GIF87a");const vs=bs("GIF89a");class gs{getSize(e){return new Promise(((s,t)=>{if(e.size<10){t(new Error("GIF signature not found."));return}const i=e.slice(0,10);hs(i).then((e=>{const i=new DataView(e);if(!ps(i,us,0)&&!ps(i,vs,0)){t(new Error("GIF signature not found."));return}s({width:i.getUint16(6,true),height:i.getUint16(8,true)})})).catch((e=>{t(e)}))}))}}const Ps=bs("\x89PNG\r\n\x1a\n");const Fs=bs("IHDR");const fs=bs("CgBI");class Ls{getSize(e){return new Promise(((s,t)=>{if(e.size<40){t(new Error("PNG signature not found."));return}const i=e.slice(0,40);hs(i).then((e=>{const i=new DataView(e);if(!ps(i,Ps,0)){t(new Error("PNG signature not found."));return}if(ps(i,fs,12)){if(ps(i,Fs,28)){s({width:i.getUint32(32),height:i.getUint32(36)})}else{t(new Error("PNG IHDR not found."))}}else if(ps(i,Fs,12)){s({width:i.getUint32(16),height:i.getUint32(20)})}else{t(new Error("PNG IHDR not found."))}})).catch((e=>t(e)))}))}}const ms=16973;class ys{getSize(e){return new Promise(((s,t)=>{if(e.size<26){t(new Error("BMP signature not found."));return}const i=e.slice(0,26);hs(i).then((e=>{const i=new DataView(e);if(!i.getUint16(0)===ms){t(new Error("BMP signature not found."));return}s({width:i.getUint32(18,true),height:Math.abs(i.getInt32(22,true))})})).catch((e=>{t(e)}))}))}}const Hs=bs("Exif\0\0");class Es{getSize(e){return new Promise(((s,t)=>{if(e.size<2){t(new Error("JPEG signature not found."));return}hs(e).then((e=>{const i=new DataView(e);if(i.getUint8(0)!==255||i.getUint8(1)!==216){t(new Error("JPEG signature not found."));return}let r=2;let l=-1;for(;;){if(i.byteLength-r<2){t(new Error("JPEG signature not found."));return}if(i.getUint8(r++)!==255){t(new Error("JPEG signature not found."));return}let e=i.getUint8(r++);let a=0;while(e===255){e=i.getUint8(r++)}if(e>=208&&e<=217||e===1){a=0}else if(e>=192&&e<=254){if(i.byteLength-r<2){t(new Error("JPEG signature not found."));return}a=i.getUint16(r)-2;r+=2}else{t(new Error("JPEG unknown markers."));return}if(e===217||e===218){t(new Error("JPEG end of the data stream."));return}if(e===225&&a>=10&&ps(i,Hs,r)){const e=new DataView(i.buffer,r+6,r+a);l=Ts(e)}if(a>=5&&e>=192&&e<=207&&e!==196&&e!==200&&e!==204){if(i.byteLength-r<a){t(new Error("JPEG size not found."));return}let e=i.getUint16(r+3);let o=i.getUint16(r+1);if(l>=5&&l<=8){[e,o]=[o,e]}s({width:e,height:o,orientation:l});return}r+=a}})).catch((e=>{t(e)}))}))}}const Bs={BIG_ENDIAN:19789,LITTLE_ENDIAN:18761};const Ts=e=>{const s=e.getUint16(0);const t=s===Bs.BIG_ENDIAN;const i=s===Bs.LITTLE_ENDIAN;if(t||i){return ws(e,i)}return-1};const ws=(e,s=false)=>{const t=8;const i=e.getUint16(t,s);const r=12;const l=2;for(let a=0;a<i;a++){const i=t+l+a*r;const o=i+r;if(i>e.byteLength){return-1}const n=new DataView(e.buffer,e.byteOffset+i,o-i);const c=n.getUint16(0,s);if(c===274){const e=n.getUint16(2,s);if(e!==3){return-1}const t=n.getUint32(4,s);if(t!==1){return-1}return n.getUint16(8,s)}}return-1};const Os=1380533830;const Ss=1464156752;const Is=1448097824;const As=1448097868;const Rs=1448097880;class Cs{getSize(e){return new Promise(((s,t)=>{if(e.size<16){t(new Error("WEBP signature not found."));return}const i=e.slice(0,30);hs(i).then((e=>{const i=new DataView(e);if(i.getUint32(0)!==Os&&i.getUint32(8)!==Ss){t(new Error("WEBP signature not found."));return}const r=i.getUint32(12);const l=new DataView(e,20,10);if(r===Is&&l.getUint8(0)!==47){s({width:l.getUint16(6,true)&16383,height:l.getUint16(8,true)&16383});return}if(r===As&&l.getUint8(0)===47){const e=l.getUint32(1,true);s({width:(e&16383)+1,height:(e>>14&16383)+1});return}if(r===Rs){const e=l.getUint8(0);const t=(e&192)===0;const i=(e&1)===0;if(t&&i){const e=1+(l.getUint8(6)<<16|l.getUint8(5)<<8|l.getUint8(4));const t=1+(Math.trunc(l.getUint8(9))|l.getUint8(8)<<8|l.getUint8(7));s({width:e,height:t});return}}t(new Error("WEBP signature not found."))})).catch((e=>{t(e)}))}))}}const Ds=new Es;const Us={gif:new gs,png:new Ls,bmp:new ys,jpg:Ds,jpeg:Ds,jpe:Ds,webp:new Cs};const Ms=e=>{if(e.size===0){return Promise.reject(new Error("Unknown image type."))}const s=E(e.name).toLowerCase();const t=e.type.replace(/^image\//,"");const i=Us[s]||Us[t];if(!i){return Promise.reject(new Error("Unknown image type."))}return i.getSize(e)};var _s=babelHelpers.classPrivateFieldLooseKey("imageMinWidth");var Ns=babelHelpers.classPrivateFieldLooseKey("imageMinHeight");var zs=babelHelpers.classPrivateFieldLooseKey("imageMaxWidth");var js=babelHelpers.classPrivateFieldLooseKey("imageMaxHeight");var xs=babelHelpers.classPrivateFieldLooseKey("ignoreUnknownImageTypes");var Ks=babelHelpers.classPrivateFieldLooseKey("treatOversizeImageAsFile");class ks extends ss{constructor(e,s={}){super(e);Object.defineProperty(this,_s,{writable:true,value:1});Object.defineProperty(this,Ns,{writable:true,value:1});Object.defineProperty(this,zs,{writable:true,value:7e3});Object.defineProperty(this,js,{writable:true,value:7e3});Object.defineProperty(this,xs,{writable:true,value:false});Object.defineProperty(this,Ks,{writable:true,value:false});const i=t.Extension.getSettings("ui.uploader.core");babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]=i.get("imageMinWidth",babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]);babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]=i.get("imageMinHeight",babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]);babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]=i.get("imageMaxWidth",babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]);babelHelpers.classPrivateFieldLooseBase(this,js)[js]=i.get("imageMaxHeight",babelHelpers.classPrivateFieldLooseBase(this,js)[js]);const r=t.Type.isPlainObject(s)?s:{};this.setImageMinWidth(r.imageMinWidth);this.setImageMinHeight(r.imageMinHeight);this.setImageMaxWidth(r.imageMaxWidth);this.setImageMaxHeight(r.imageMaxHeight);this.setIgnoreUnknownImageTypes(r.ignoreUnknownImageTypes);this.setTreatOversizeImageAsFile(r.treatOversizeImageAsFile)}apply(e){return new Promise(((s,t)=>{if(!T(e.getName(),e.getType())){s();return}Ms(e.getBinary()).then((({width:i,height:r})=>{e.setWidth(i);e.setHeight(r);if(i<this.getImageMinWidth()||r<this.getImageMinHeight()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true);s()}else{t(new a("IMAGE_IS_TOO_SMALL",{minWidth:this.getImageMinWidth(),minHeight:this.getImageMinHeight()}))}}else if(i>this.getImageMaxWidth()||r>this.getImageMaxHeight()){if(this.shouldTreatOversizeImageAsFile()){e.setTreatImageAsFile(true);s()}else{t(new a("IMAGE_IS_TOO_BIG",{maxWidth:this.getImageMaxWidth(),maxHeight:this.getImageMaxHeight()}))}}else{s()}})).catch((i=>{if(this.getIgnoreUnknownImageTypes()){e.setTreatImageAsFile(true);s()}else{if(i){console.warn("Uploader ImageSizeFilter:",i)}t(new a("IMAGE_TYPE_NOT_SUPPORTED"))}}))}))}getImageMinWidth(){return babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]}setImageMinWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,_s)[_s]=e}}getImageMinHeight(){return babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]}setImageMinHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Ns)[Ns]=e}}getImageMaxWidth(){return babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]}setImageMaxWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,zs)[zs]=e}}getImageMaxHeight(){return babelHelpers.classPrivateFieldLooseBase(this,js)[js]}setImageMaxHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,js)[js]=e}}getIgnoreUnknownImageTypes(){return babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]}setIgnoreUnknownImageTypes(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,xs)[xs]=e}}setTreatOversizeImageAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Ks)[Ks]=e}}shouldTreatOversizeImageAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,Ks)[Ks]}}const Ws=e=>{const s=new Blob(["(",e.toString(),")()"],{type:"application/javascript"});const t=URL.createObjectURL(s);const i=new Worker(t);return{post:(e,s,t)=>{const r=P();i.onmessage=e=>{if(e.data.id===r){s(e.data.message)}};i.postMessage({id:r,message:e},t)},terminate:()=>{i.terminate();URL.revokeObjectURL(t)}}};const Gs=function(){self.onmessage=e=>{setTimeout((()=>{createImageBitmap(e.data.message.file).then((s=>{var t;self.postMessage({id:e==null?void 0:(t=e.data)==null?void 0:t.id,message:s},[s])})).catch((()=>{self.postMessage({id:e.data.id,message:null},[])}))}),0)}};const Vs=()=>{self.onmessage=e=>{setTimeout((()=>{const{file:s,options:t={},getResizedImageSizeSource:i,createImagePreviewCanvasSource:r,sharpenSource:l,shouldSharpenSource:a}=e.data.message;createImageBitmap(s).then((s=>{const o=new Function(`return ${i}`)();const{targetWidth:n,targetHeight:c,useOriginalSize:d}=o(s,t);if(d){var h;s.close();self.postMessage({id:e==null?void 0:(h=e.data)==null?void 0:h.id,message:{useOriginalSize:d,targetWidth:n,targetHeight:c}},[])}else{var b;const t=new Function(`return ${r}`)();let i=t(s,n,c);const o=new Function(`return ${l}`)();const h=new Function(`return ${a}`)();if(h(s,n,c)){o(i,n,c,.2)}s.close();const p=i.transferToImageBitmap();i.width=0;i.height=0;i=null;self.postMessage({id:e==null?void 0:(b=e.data)==null?void 0:b.id,message:{bitmap:p,useOriginalSize:d,targetWidth:n,targetHeight:c}},[p])}})).catch((s=>{console.log("Uploader: Resize Worker Error (createImageBitmap)",s);self.postMessage({id:e.data.id,message:null},[])}))}),0)}};const $s=e=>new Promise(((s,t)=>{const i=document.createElement("img");const r=URL.createObjectURL(e);i.src=r;i.onerror=e=>{URL.revokeObjectURL(i.src);t(e)};i.onload=()=>{URL.revokeObjectURL(r);s({width:i.naturalWidth,height:i.naturalHeight,image:i})}}));const Xs=(e,s,t)=>{let i=Math.round(s);let r=Math.round(t);const l=typeof window!=="undefined"&&typeof document!=="undefined"&&typeof parent!=="undefined";const a=(e,s)=>{if(l){const t=document.createElement("canvas");t.width=e;t.height=s;return t}return new OffscreenCanvas(e,s)};if(e.height<=r&&e.width<=i){const s=a(i,r);const t=s.getContext("2d");t.imageSmoothingQuality="high";t.drawImage(e,0,0,i,r);return s}if(e.height>e.width){i=Math.floor(r*(e.width/e.height))}else{r=Math.floor(i*(e.height/e.width))}let o=Math.floor(e.width);let n=Math.floor(e.height);let c=e;let d=null;while(o*.5>i){const e=Math.floor(o*.5);const s=Math.floor(n*.5);d=a(e,s);const t=d.getContext("2d");t.imageSmoothingQuality="high";t.drawImage(c,0,0,o,n,0,0,e,s);o=e;n=s;c=d}const h=a(i,r);const b=h.getContext("2d");b.imageSmoothingQuality="high";b.drawImage(d===null?e:d,0,0,o,n,0,0,i,r);if(d){d.width=0;d.height=0;d=null;c.width=0;c.height=0;c=null}return h};const Js=(e,s)=>{const{mode:t="contain",upscale:i=false}=s;let{width:r,height:l}=s;if(!r&&!l){return{targetWidth:0,targetHeight:0,useOriginalSize:true}}if(r===null){r=l}else if(l===null){l=r}if(t!=="force"){const s=r/e.width;const a=l/e.height;let o=1;if(t==="cover"){o=Math.max(s,a)}else if(t==="contain"){o=Math.min(s,a)}if(o>1&&i===false){return{targetWidth:e.width,targetHeight:e.height,useOriginalSize:true}}r=e.width*o;l=e.height*o}return{targetWidth:Math.round(r),targetHeight:Math.round(l),useOriginalSize:false}};const Ys=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype;const qs=window.HTMLCanvasElement&&Ys.toBlob;const Qs=!t.Type.isUndefined(window.OffscreenCanvas);const Zs=(e,s,t)=>new Promise(((i,r)=>{if(Qs&&e instanceof OffscreenCanvas){e.convertToBlob({type:s,quality:t}).then((e=>{i(e)})).catch((e=>{r(e)}))}else if(qs){e.toBlob((e=>{i(e)}),s,t)}else{const r=H(e.toDataURL(s,t));i(r)}}));const et=t.Browser.isSafari()?["image/jpeg","image/png"]:["image/jpeg","image/png","image/webp"];const st=e=>et.includes(e);const tt=(e,s,t,i)=>{const r=e.getContext("2d");const l=[0,-1,0,-1,5,-1,0,-1,0];const a=Math.round(Math.sqrt(l.length));const o=Math.trunc(a*.5);const n=r.createImageData(s,t);const c=n.data;const d=r.getImageData(0,0,s,t).data;let h=t;while(h--){let e=s;while(e--){const r=h;const n=e;const b=(h*s+e)*4;let p=0;let u=0;let v=0;for(let e=0;e<a;e++){for(let i=0;i<a;i++){const c=r+e-o;const h=n+i-o;if(c>=0&&c<t&&h>=0&&h<s){const t=(c*s+h)*4;const r=l[e*a+i];p+=d[t]*r;u+=d[t+1]*r;v+=d[t+2]*r}}}c[b]=p*i+d[b]*(1-i);c[b+1]=u*i+d[b+1]*(1-i);c[b+2]=v*i+d[b+2]*(1-i);c[b+3]=d[b+3]}}r.putImageData(n,0,0)};const it=(e,s,t)=>{const i=s/e.width;const r=t/e.height;const l=Math.min(i,r);return l<.5};const rt=(e,s)=>{const{targetWidth:t,targetHeight:i}=Js(e,s);const r=Xs(e,t,i);if(it(e,t,i)){tt(r,t,i,.2)}const{quality:l=.92}=s;const a=st(s.mimeType)?s.mimeType:"image/jpeg";return Zs(r,a,l).then((e=>({width:t,height:i,blob:e})))};const lt=(e,s)=>{const t=st(s.mimeType)?s.mimeType:"image/jpeg";const i=s.mimeTypeMode;if(i==="force"){return t}return st(e.type)?e.type:t};const at=e=>e.slice(0,Math.max(0,e.lastIndexOf(".")))||e;const ot={jpeg:"jpg"};const nt=(e,s)=>{const t=at(e);const i=s.split("/")[1];const r=ot[i]||i;return`${t}.${r}`};let ct="createImageBitmap"in window&&!t.Type.isUndefined(window.ImageBitmap)&&ImageBitmap.prototype&&ImageBitmap.prototype.close;if(ct&&t.Browser.isSafari()){const e=navigator.userAgent.toLowerCase();const s=/version\/([\d.]+)/i;const t=s.exec(e);if(t&&t[1]&&t[1]<"16.4"){ct=false}}const dt=Xs.toString();const ht=Js.toString();const bt=tt.toString();const pt=it.toString();const ut=ct&&!t.Type.isUndefined(window.OffscreenCanvas);const vt=(e,s)=>new Promise(((i,r)=>{if(ut){const r=Ws(Vs);const l=lt(e,s);r.post({file:e,type:l,options:s,createImagePreviewCanvasSource:dt,getResizedImageSizeSource:ht,sharpenSource:bt,shouldSharpenSource:pt},(o=>{r.terminate();if(o){const{bitmap:r,targetWidth:n,targetHeight:c,useOriginalSize:d}=o;if(d){i({preview:e,width:n,height:c})}else{let o=document.createElement("canvas");o.width=r.width;o.height=r.height;const d=o.getContext("bitmaprenderer");d.transferFromImageBitmap(r);const{quality:h=.92}=s;Zs(o,l,h).then((s=>{let r=s;if(t.Type.isFile(e)){const t=nt(e.name,l);r=L(s,t)}i({preview:r,width:n,height:c})})).catch((e=>{console.log("Uploader: convertCanvasToBlob error",e);a()})).finally((()=>{o.width=0;o.height=0;o=null;r.close()}))}}else{a()}}))}else if(ct){const s=Ws(Gs);s.post({file:e},(e=>{s.terminate();if(e){l(e)}else{a()}}))}else{a()}function l(l){const{useOriginalSize:a,targetWidth:o,targetHeight:n}=Js(l,s);if(a){if("close"in l){l.close()}i({preview:e,width:o,height:n})}else{const a=lt(e,s);rt(l,{...s,mimeType:a}).then((({blob:s,width:r,height:l})=>{let o=s;if(t.Type.isFile(e)){const t=nt(e.name,a);o=L(s,t)}i({preview:o,width:r,height:l})})).catch((e=>{r(e)})).finally((()=>{if("close"in l){l.close()}}))}}function a(){console.log("Uploader: resize image fallback");$s(e).then((({image:e})=>{l(e)})).catch((e=>{r(e)}))}}));const gt=e=>/^video\/[\d.a-z-]+$/i.test(e.type);const Pt=(e,s={width:300,height:3e3},i=10)=>new Promise(((r,l)=>{const a=document.createElement("video");a.setAttribute("src",URL.createObjectURL(e));a.load();t.Event.bind(a,"error",(e=>{l(e||"Error while loading video file")}));t.Event.bind(a,"loadedmetadata",(()=>{a.currentTime=a.duration<i?0:i;t.Event.bind(a,"seeked",(()=>{const e={width:a.videoWidth,height:a.videoHeight};const{targetWidth:t,targetHeight:i}=Js(e,s);if(!t||!i){l();return}const o=Xs(a,t,i);const{quality:n=.92,mimeType:c="image/jpeg"}=s;Zs(o,c,n).then((e=>{r({preview:e,width:t,height:i})})).catch((()=>{l()}))}))}))}));var Ft=babelHelpers.classPrivateFieldLooseKey("imagePreviewWidth");var ft=babelHelpers.classPrivateFieldLooseKey("imagePreviewHeight");var Lt=babelHelpers.classPrivateFieldLooseKey("imagePreviewQuality");var mt=babelHelpers.classPrivateFieldLooseKey("imagePreviewMimeType");var yt=babelHelpers.classPrivateFieldLooseKey("imagePreviewMimeTypeMode");var Ht=babelHelpers.classPrivateFieldLooseKey("imagePreviewUpscale");var Et=babelHelpers.classPrivateFieldLooseKey("imagePreviewResizeMode");var Bt=babelHelpers.classPrivateFieldLooseKey("imagePreviewFilter");var Tt=babelHelpers.classPrivateFieldLooseKey("getResizeImageOptions");class wt extends ss{constructor(e,s={}){super(e);Object.defineProperty(this,Tt,{value:Ot});Object.defineProperty(this,Ft,{writable:true,value:300});Object.defineProperty(this,ft,{writable:true,value:300});Object.defineProperty(this,Lt,{writable:true,value:.92});Object.defineProperty(this,mt,{writable:true,value:"image/jpeg"});Object.defineProperty(this,yt,{writable:true,value:"auto"});Object.defineProperty(this,Ht,{writable:true,value:false});Object.defineProperty(this,Et,{writable:true,value:"contain"});Object.defineProperty(this,Bt,{writable:true,value:null});const i=t.Type.isPlainObject(s)?s:{};this.setImagePreviewWidth(i.imagePreviewWidth);this.setImagePreviewHeight(i.imagePreviewHeight);this.setImagePreviewQuality(i.imagePreviewQuality);this.setImagePreviewUpscale(i.imagePreviewUpscale);this.setImagePreviewResizeMode(i.imagePreviewResizeMode);this.setImagePreviewMimeType(i.imagePreviewMimeType);this.setImagePreviewMimeTypeMode(i.imagePreviewMimeTypeMode);this.setImagePreviewFilter(i.imagePreviewFilter)}apply(e){return new Promise((s=>{if(!e.shouldTreatImageAsFile()&&T(e.getBinary())){const i=this.invokeFilter(e);if(i===false){s();return}const r=t.Type.isPlainObject(i)?i:{};vt(e.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt](r)).then((({preview:t,width:i,height:r})=>{e.setClientPreview(t,i,r);s()})).catch((e=>{if(e){console.warn("Uploader: image resize error",e)}s()}))}else if(gt(e.getBinary())&&!t.Browser.isSafari()){Pt(e.getBinary(),babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt]()).then((({preview:t,width:i,height:r})=>{e.setClientPreview(t,i,r);s()})).catch((e=>{if(e){console.warn("Uploader: video preview error",e)}s()}))}else{s()}}))}getImagePreviewWidth(){return babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]}setImagePreviewWidth(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]=e}}getImagePreviewHeight(){return babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]}setImagePreviewHeight(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]=e}}getImagePreviewQuality(){return babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]}setImagePreviewQuality(e){if(t.Type.isNumber(e)&&e>.1&&e<=1){babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=e}}getImagePreviewUpscale(){return babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]}setImagePreviewUpscale(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]=e}}getImagePreviewResizeMode(){return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]}setImagePreviewResizeMode(e){if(["contain","force","cover"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]=e}}getImagePreviewMimeType(){return babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]}setImagePreviewMimeType(e){if(["image/jpeg","image/png","image/webp"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]=e}}getImagePreviewMimeTypeMode(){return babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]}setImagePreviewMimeTypeMode(e){if(["auto","force"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,yt)[yt]=e}}setImagePreviewFilter(e){if(t.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt]=e}}invokeFilter(e){if(babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt]!==null){const s=babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt](e);if(t.Type.isBoolean(s)||t.Type.isPlainObject(s)){return s}}return true}}function Ot(e={}){return{width:t.Type.isNumber(e.width)?e.width:this.getImagePreviewWidth(),height:t.Type.isNumber(e.height)?e.height:this.getImagePreviewHeight(),mode:t.Type.isStringFilled(e.mode)?e.mode:this.getImagePreviewResizeMode(),upscale:t.Type.isBoolean(e.upscale)?e.upscale:this.getImagePreviewUpscale(),quality:t.Type.isNumber(e.quality)?e.quality:this.getImagePreviewQuality(),mimeType:t.Type.isStringFilled(e.mimeType)?e.mimeType:this.getImagePreviewMimeType(),mimeTypeMode:t.Type.isStringFilled(e.mimeTypeMode)?e.mimeTypeMode:this.getImagePreviewMimeTypeMode()}}var St=babelHelpers.classPrivateFieldLooseKey("resizeWidth");var It=babelHelpers.classPrivateFieldLooseKey("resizeHeight");var At=babelHelpers.classPrivateFieldLooseKey("resizeMethod");var Rt=babelHelpers.classPrivateFieldLooseKey("resizeMimeType");var Ct=babelHelpers.classPrivateFieldLooseKey("resizeMimeTypeMode");var Dt=babelHelpers.classPrivateFieldLooseKey("resizeQuality");var Ut=babelHelpers.classPrivateFieldLooseKey("resizeFilter");class Mt extends ss{constructor(e,s={}){super(e);Object.defineProperty(this,St,{writable:true,value:null});Object.defineProperty(this,It,{writable:true,value:null});Object.defineProperty(this,At,{writable:true,value:"contain"});Object.defineProperty(this,Rt,{writable:true,value:"image/jpeg"});Object.defineProperty(this,Ct,{writable:true,value:"auto"});Object.defineProperty(this,Dt,{writable:true,value:.92});Object.defineProperty(this,Ut,{writable:true,value:null});const i=t.Type.isPlainObject(s)?s:{};this.setResizeWidth(i.imageResizeWidth);this.setResizeHeight(i.imageResizeHeight);this.setResizeMode(i.imageResizeMode);this.setResizeMimeType(i.imageResizeMimeType);this.setResizeMimeTypeMode(i.imageResizeMimeTypeMode);this.setResizeQuality(i.imageResizeQuality);this.setResizeFilter(i.imageResizeFilter)}apply(e){return new Promise((s=>{if(this.getResizeWidth()===null&&this.getResizeHeight()===null){s();return}if(e.shouldTreatImageAsFile()||!T(e.getBinary())){s();return}const i=this.invokeFilter(e);if(i===false){s();return}const r=t.Type.isPlainObject(i)?i:{};const l={width:t.Type.isNumber(r.width)?r.width:this.getResizeWidth(),height:t.Type.isNumber(r.height)?r.height:this.getResizeHeight(),mode:t.Type.isStringFilled(r.mode)?r.mode:this.getResizeMode(),quality:t.Type.isNumber(r.quality)?r.quality:this.getResizeQuality(),mimeType:t.Type.isStringFilled(r.mimeType)?r.mimeType:this.getResizeMimeType(),mimeTypeMode:t.Type.isStringFilled(r.mimeTypeMode)?r.mimeTypeMode:this.getResizeMimeTypeMode()};vt(e.getBinary(),l).then((({preview:t,width:i,height:r})=>{e.setWidth(i);e.setHeight(r);e.setFile(t);s()})).catch((e=>{if(e){console.warn("image resize error",e)}s()}))}))}getResizeWidth(){return babelHelpers.classPrivateFieldLooseBase(this,St)[St]}setResizeWidth(e){if(t.Type.isNumber(e)&&e>0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,St)[St]=e}}getResizeHeight(){return babelHelpers.classPrivateFieldLooseBase(this,It)[It]}setResizeHeight(e){if(t.Type.isNumber(e)&&e>0||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,It)[It]=e}}getResizeMode(){return babelHelpers.classPrivateFieldLooseBase(this,At)[At]}setResizeMode(e){if(["contain","force","cover"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,At)[At]=e}}getResizeMimeType(){return babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]}setResizeMimeType(e){if(["image/jpeg","image/png","image/webp"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt]=e}}getResizeMimeTypeMode(){return babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]}setResizeMimeTypeMode(e){if(["auto","force"].includes(e)){babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]=e}}getResizeQuality(){return babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]}setResizeQuality(e){if(t.Type.isNumber(e)&&e>.1&&e<=1){babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]=e}}setResizeFilter(e){if(t.Type.isFunction(e)){babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut]=e}}invokeFilter(e){if(babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut]!==null){const s=babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut](e);if(t.Type.isBoolean(s)||t.Type.isPlainObject(s)){return s}}return true}}const _t={STARTED:0,STOPPED:1};const Nt={UPLOAD_START:"onUploadStart",UPLOAD_COMPLETE:"onUploadComplete",ERROR:"onError",MAX_FILE_COUNT_EXCEEDED:"onMaxFileCountExceeded",DESTROY:"onDestroy",BEFORE_BROWSE:"onBeforeBrowse",BEFORE_DROP:"onBeforeDrop",BEFORE_PASTE:"onBeforePaste",BEFORE_FILES_ADD:"onBeforeFilesAdd",FILE_BEFORE_ADD:"File:onBeforeAdd",FILE_ADD_START:"File:onAddStart",FILE_LOAD_START:"File:onLoadStart",FILE_LOAD_PROGRESS:"File:onLoadProgress",FILE_LOAD_COMPLETE:"File:onLoadComplete",FILE_ERROR:"File:onError",FILE_ADD:"File:onAdd",FILE_REMOVE:"File:onRemove",FILE_UPLOAD_START:"File:onUploadStart",FILE_UPLOAD_PROGRESS:"File:onUploadProgress",FILE_UPLOAD_COMPLETE:"File:onUploadComplete",FILE_COMPLETE:"File:onComplete",FILE_STATUS_CHANGE:"File:onStatusChange",FILE_STATE_CHANGE:"File:onStateChange"};const zt={VALIDATION:"validation",PREPARATION:"preparation"};const jt=e=>new Promise(((s,t)=>{const i=[];let r=0;let l=0;const a=()=>{if(l===0&&r===0){s(i)}};const o=e=>{r++;const s=e.createReader();const n=()=>{s.readEntries((e=>{if(e.length===0){r--;a();return}e.forEach((e=>{if(e.isDirectory){o(e)}else{l++;e.file((e=>{i.push(e);l--;a()}))}}));n()}),t)};n()};o(e)}));const xt=e=>"webkitGetAsEntry"in e&&(e.webkitGetAsEntry()||{}).isDirectory===true;const Kt=e=>{if("webkitGetAsEntry"in e){const s=e.webkitGetAsEntry();if(s){return s.isFile||s.isDirectory}}return e.kind==="file"};const kt=e=>new Promise(((s,t)=>{if(xt(e)){jt(e.webkitGetAsEntry()).then(s).catch(t);return}s([e.getAsFile()])}));const Wt=(e,s=true)=>new Promise(((t,i)=>{if(!e.items||e.items.length===0){t(e.files?[...e.files]:[]);return}const r=[...e.items].filter((e=>s?Kt(e):e.kind==="file")).map((e=>kt(e)));Promise.all(r).then((e=>{const s=[];e.forEach((e=>{s.push(...e)}));t(s)})).catch(i)}));const Gt=(e,s=true)=>new Promise(((t,i)=>{if(!e.items){t(e.files?e.files.length>0:false);return}const r=[...e.items].every((e=>s?Kt(e):e.kind==="file"&&!xt(e)));t(r)}));const Vt=(e,s=true)=>{if(!e.types.includes("Files")){return false}let t=0;let i=0;const r=e.items;for(const e of r){if(e.kind==="string"){i++}else{const i=s?Kt(e):e.kind==="file"&&!xt(e);if(i){t++}}}return t>=i};let $t=null;const Xt=()=>{if($t===null){try{const e=new DataTransfer;const s=new File(["hello"],"my.txt");e.items.add(s);const t=document.createElement("input");t.setAttribute("type","file");t.files=e.files;$t=t.files.length===1}catch{$t=false}}return $t};const Jt=(e,s)=>{try{const i=new DataTransfer;const r=t.Type.isArray(s)?s:[s];r.forEach((e=>{i.items.add(e)}));e.files=i.files}catch{return false}return true};const Yt=new Map;var qt=babelHelpers.classPrivateFieldLooseKey("id");var Qt=babelHelpers.classPrivateFieldLooseKey("files");var Zt=babelHelpers.classPrivateFieldLooseKey("multiple");var ei=babelHelpers.classPrivateFieldLooseKey("autoUpload");var si=babelHelpers.classPrivateFieldLooseKey("allowReplaceSingle");var ti=babelHelpers.classPrivateFieldLooseKey("maxParallelUploads");var ii=babelHelpers.classPrivateFieldLooseKey("maxParallelLoads");var ri=babelHelpers.classPrivateFieldLooseKey("acceptOnlyImages");var li=babelHelpers.classPrivateFieldLooseKey("acceptedFileTypes");var ai=babelHelpers.classPrivateFieldLooseKey("ignoredFileNames");var oi=babelHelpers.classPrivateFieldLooseKey("maxFileCount");var ni=babelHelpers.classPrivateFieldLooseKey("server");var ci=babelHelpers.classPrivateFieldLooseKey("hiddenFields");var di=babelHelpers.classPrivateFieldLooseKey("hiddenFieldsContainer");var hi=babelHelpers.classPrivateFieldLooseKey("hiddenFieldName");var bi=babelHelpers.classPrivateFieldLooseKey("assignAsFile");var pi=babelHelpers.classPrivateFieldLooseKey("assignServerFile");var ui=babelHelpers.classPrivateFieldLooseKey("filters");var vi=babelHelpers.classPrivateFieldLooseKey("status");var gi=babelHelpers.classPrivateFieldLooseKey("onBeforeUploadHandler");var Pi=babelHelpers.classPrivateFieldLooseKey("onFileStatusChangeHandler");var Fi=babelHelpers.classPrivateFieldLooseKey("onFileStateChangeHandler");var fi=babelHelpers.classPrivateFieldLooseKey("onInputFileChangeHandler");var Li=babelHelpers.classPrivateFieldLooseKey("onPasteHandler");var mi=babelHelpers.classPrivateFieldLooseKey("onDropHandler");var yi=babelHelpers.classPrivateFieldLooseKey("browsingNodes");var Hi=babelHelpers.classPrivateFieldLooseKey("dropNodes");var Ei=babelHelpers.classPrivateFieldLooseKey("pastingNodes");var Bi=babelHelpers.classPrivateFieldLooseKey("setLoadEvents");var Ti=babelHelpers.classPrivateFieldLooseKey("setUploadEvents");var wi=babelHelpers.classPrivateFieldLooseKey("setRemoveEvents");var Oi=babelHelpers.classPrivateFieldLooseKey("handleBeforeUpload");var Si=babelHelpers.classPrivateFieldLooseKey("handleFileStatusChange");var Ii=babelHelpers.classPrivateFieldLooseKey("handleFileStateChange");var Ai=babelHelpers.classPrivateFieldLooseKey("exceedsMaxFileCount");var Ri=babelHelpers.classPrivateFieldLooseKey("applyFilters");var Ci=babelHelpers.classPrivateFieldLooseKey("removeFile");var Di=babelHelpers.classPrivateFieldLooseKey("handleBrowseClick");var Ui=babelHelpers.classPrivateFieldLooseKey("handleInputFileChange");var Mi=babelHelpers.classPrivateFieldLooseKey("handleDrop");var _i=babelHelpers.classPrivateFieldLooseKey("preventDefault");var Ni=babelHelpers.classPrivateFieldLooseKey("handlePaste");var zi=babelHelpers.classPrivateFieldLooseKey("uploadNext");var ji=babelHelpers.classPrivateFieldLooseKey("loadNext");var xi=babelHelpers.classPrivateFieldLooseKey("setHiddenField");var Ki=babelHelpers.classPrivateFieldLooseKey("updateHiddenField");var ki=babelHelpers.classPrivateFieldLooseKey("resetHiddenField");var Wi=babelHelpers.classPrivateFieldLooseKey("resetHiddenFields");var Gi=babelHelpers.classPrivateFieldLooseKey("syncInputPositions");class Vi extends s.EventEmitter{static getById(e){return Yt.get(e)||null}static getInstances(){return[...Yt.values()]}constructor(e){super();Object.defineProperty(this,Gi,{value:pr});Object.defineProperty(this,Wi,{value:br});Object.defineProperty(this,ki,{value:hr});Object.defineProperty(this,Ki,{value:dr});Object.defineProperty(this,xi,{value:cr});Object.defineProperty(this,ji,{value:nr});Object.defineProperty(this,zi,{value:or});Object.defineProperty(this,Ni,{value:ar});Object.defineProperty(this,_i,{value:lr});Object.defineProperty(this,Mi,{value:rr});Object.defineProperty(this,Ui,{value:ir});Object.defineProperty(this,Di,{value:tr});Object.defineProperty(this,Ci,{value:sr});Object.defineProperty(this,Ri,{value:er});Object.defineProperty(this,Ai,{value:Zi});Object.defineProperty(this,Ii,{value:Qi});Object.defineProperty(this,Si,{value:qi});Object.defineProperty(this,Oi,{value:Yi});Object.defineProperty(this,wi,{value:Ji});Object.defineProperty(this,Ti,{value:Xi});Object.defineProperty(this,Bi,{value:$i});Object.defineProperty(this,qt,{writable:true,value:null});Object.defineProperty(this,Qt,{writable:true,value:[]});Object.defineProperty(this,Zt,{writable:true,value:false});Object.defineProperty(this,ei,{writable:true,value:true});Object.defineProperty(this,si,{writable:true,value:true});Object.defineProperty(this,ti,{writable:true,value:2});Object.defineProperty(this,ii,{writable:true,value:10});Object.defineProperty(this,ri,{writable:true,value:false});Object.defineProperty(this,li,{writable:true,value:[]});Object.defineProperty(this,ai,{writable:true,value:[".ds_store","thumbs.db","desktop.ini"]});Object.defineProperty(this,oi,{writable:true,value:null});Object.defineProperty(this,ni,{writable:true,value:null});Object.defineProperty(this,ci,{writable:true,value:new Map});Object.defineProperty(this,di,{writable:true,value:null});Object.defineProperty(this,hi,{writable:true,value:"file"});Object.defineProperty(this,bi,{writable:true,value:false});Object.defineProperty(this,pi,{writable:true,value:true});Object.defineProperty(this,ui,{writable:true,value:new Map});Object.defineProperty(this,vi,{writable:true,value:_t.STOPPED});Object.defineProperty(this,gi,{writable:true,value:null});Object.defineProperty(this,Pi,{writable:true,value:null});Object.defineProperty(this,Fi,{writable:true,value:null});Object.defineProperty(this,fi,{writable:true,value:null});Object.defineProperty(this,Li,{writable:true,value:null});Object.defineProperty(this,mi,{writable:true,value:null});Object.defineProperty(this,yi,{writable:true,value:new Map});Object.defineProperty(this,Hi,{writable:true,value:new Set});Object.defineProperty(this,Ei,{writable:true,value:new Set});this.setEventNamespace("BX.UI.Uploader");babelHelpers.classPrivateFieldLooseBase(this,gi)[gi]=babelHelpers.classPrivateFieldLooseBase(this,Oi)[Oi].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi]=babelHelpers.classPrivateFieldLooseBase(this,Si)[Si].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi]=babelHelpers.classPrivateFieldLooseBase(this,Ii)[Ii].bind(this);babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]=babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui].bind(this);babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]=babelHelpers.classPrivateFieldLooseBase(this,Ni)[Ni].bind(this);babelHelpers.classPrivateFieldLooseBase(this,mi)[mi]=babelHelpers.classPrivateFieldLooseBase(this,Mi)[Mi].bind(this);const s=t.Type.isPlainObject(e)?{...e}:{};babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]=t.Type.isStringFilled(s.id)?s.id:`ui-uploader-${t.Text.getRandom().toLowerCase()}`;babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=t.Type.isBoolean(s.multiple)?s.multiple:false;const i=t.Type.isBoolean(s.acceptOnlyImages)?s.acceptOnlyImages:null;const r=Vi.getGlobalOption("acceptOnlyImages",null);this.setAcceptOnlyImages(i||r);if(t.Type.isString(s.acceptedFileTypes)||t.Type.isArray(s.acceptedFileTypes)){this.setAcceptedFileTypes(s.acceptedFileTypes)}else if(i!==true){const e=Vi.getGlobalOption("acceptedFileTypes",null);this.setAcceptedFileTypes(e)}const l=t.Type.isArray(s.ignoredFileNames)?s.ignoredFileNames:Vi.getGlobalOption("ignoredFileNames",null);this.setIgnoredFileNames(l);this.setMaxFileCount(s.maxFileCount);this.setAllowReplaceSingle(s.allowReplaceSingle);this.assignBrowse(s.browseElement);this.assignDropzone(s.dropElement);this.assignPaste(s.pasteElement);this.setHiddenFieldsContainer(s.hiddenFieldsContainer);this.setHiddenFieldName(s.hiddenFieldName);this.setAssignAsFile(s.assignAsFile);this.setAssignServerFile(s.assignServerFile);this.setAutoUpload(s.autoUpload);this.setMaxParallelUploads(s.maxParallelUploads);this.setMaxParallelLoads(s.maxParallelLoads);let a=t.Type.isPlainObject(s.serverOptions)?s.serverOptions:{};a={controller:s.controller,controllerOptions:s.controllerOptions,...a};babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]=new Qe(a);this.subscribeFromOptions(s.events);this.addFilter(zt.VALIDATION,new ns(this,s));this.addFilter(zt.VALIDATION,new ds(this,s));this.addFilter(zt.VALIDATION,new ks(this,s));this.addFilter(zt.VALIDATION,new wt(this,s));this.addFilter(zt.PREPARATION,new Mt(this,s));this.addFilters(s.filters);this.addFiles(s.files);Yt.set(babelHelpers.classPrivateFieldLooseBase(this,qt)[qt],this)}static getGlobalOption(e,s=null){const i=t.Extension.getSettings("ui.uploader.core");return i.get(e,s)}addFiles(e){if(!t.Type.isArrayLike(e)){return[]}const r=[];[...e].forEach((e=>{if(e instanceof re){if(e.getStatus()===i.INIT){r.push(e)}}else if(t.Type.isArrayFilled(e)){r.push(new re(e[0],e[1]))}else{r.push(new re(e))}}));const l=new s.BaseEvent({data:{files:[...r]}});this.emit(Nt.BEFORE_FILES_ADD,l);if(l.isDefaultPrevented()){const{error:e}=l.getData();if(e instanceof a){this.emit(Nt.ERROR,{error:e})}return[]}if(babelHelpers.classPrivateFieldLooseBase(this,Ai)[Ai](r)){return[]}const o=[];r.forEach((e=>{const s=this.addFile(e);if(s!==null){o.push(s)}}));return o}addFile(e,a){let o=null;if(e instanceof re){if(e.getStatus()===i.INIT){o=e}else{return null}}else{o=new re(e,a)}if(this.getIgnoredFileNames().includes(o.getName().toLowerCase())){return null}if(babelHelpers.classPrivateFieldLooseBase(this,Ai)[Ai]([o])){return null}if(!this.isMultiple()&&this.shouldReplaceSingle()&&babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].length>0){const e=babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt][0];this.removeFile(e)}const n=new s.BaseEvent({data:{file:o}});this.emit(Nt.FILE_BEFORE_ADD,n);if(n.isDefaultPrevented()){return null}o.subscribe(l.STATUS_CHANGE,babelHelpers.classPrivateFieldLooseBase(this,Pi)[Pi]);o.subscribe(l.STATE_CHANGE,babelHelpers.classPrivateFieldLooseBase(this,Fi)[Fi]);babelHelpers.classPrivateFieldLooseBase(this,Ti)[Ti](o);babelHelpers.classPrivateFieldLooseBase(this,Bi)[Bi](o);babelHelpers.classPrivateFieldLooseBase(this,wi)[wi](o);if(!o.isLoadable()){if(o.getOrigin()===r.SERVER){const e=t.Type.isStringFilled(o.getName());if(!e||o.shouldForceServerLoad()){o.setLoadController(this.getServer().createServerLoadController())}else{o.setLoadController(this.getServer().createServerlessLoadController())}}else{o.setLoadController(this.getServer().createClientLoadController())}}if(!o.isUploadable()&&o.getOrigin()===r.CLIENT){const e=this.getServer().createUploadController();o.setUploadController(e)}if(!o.isRemoveable()){o.setRemoveController(this.getServer().createRemoveController())}babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].push(o);o.emit(l.ADD);this.emit(Nt.FILE_ADD_START,{file:o});if(o.getOrigin()===r.CLIENT){babelHelpers.classPrivateFieldLooseBase(this,ji)[ji]()}else{o.load()}return o}start(){if(this.getStatus()!==_t.STARTED&&this.getPendingFileCount()>0){babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]=_t.STARTED;this.emit(Nt.UPLOAD_START);babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]()}}destroy(e){this.emit(Nt.DESTROY);this.unassignBrowseAll();this.unassignDropzoneAll();this.unassignPasteAll();const s=!e||e.removeFilesFromServer!==false;this.removeFiles({removeFromServer:s});babelHelpers.classPrivateFieldLooseBase(this,Wi)[Wi]();Yt.delete(this.getId());babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]=[];babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]=null;babelHelpers.classPrivateFieldLooseBase(this,li)[li]=null;babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]=null;babelHelpers.classPrivateFieldLooseBase(this,ui)[ui]=null;Object.setPrototypeOf(this,null)}removeFiles(e){this.getFiles().forEach((s=>{s.remove(e)}))}removeFile(e,s){const i=t.Type.isString(e)?this.getFile(e):e;const r=babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].indexOf(i);if(r===-1){return}i.remove(s)}getFile(e){return babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].find((s=>s.getId()===e))||null}getFiles(){return[...babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]]}getId(){return babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]}isMultiple(){return babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]}getStatus(){return babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]}addFilter(e,s,i={}){let r=null;if(t.Type.isFunction(s)||t.Type.isString(s)){const e=t.Type.isString(s)?t.Reflection.getClass(s):s;if(t.Type.isFunction(e)){r=new e(this,i)}}else{r=s}if(r instanceof ss){let s=babelHelpers.classPrivateFieldLooseBase(this,ui)[ui].get(e);if(!t.Type.isArray(s)){s=[];babelHelpers.classPrivateFieldLooseBase(this,ui)[ui].set(e,s)}s.push(r)}else{throw new TypeError("Uploader: a filter must be an instance of FileUploader.Filter.")}}addFilters(e){if(t.Type.isArray(e)){e.forEach((e=>{if(t.Type.isPlainObject(e)){this.addFilter(e.type,e.filter,e.options)}}))}}getServer(){return babelHelpers.classPrivateFieldLooseBase(this,ni)[ni]}assignBrowse(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].has(e)){return}let s=null;if(e.tagName==="INPUT"&&e.type==="file"){s=e;if(s.files&&s.files.length>0){this.addFiles(s.files)}const i=s.getAttribute("accept");if(t.Type.isStringFilled(i)){this.setAcceptedFileTypes(i)}babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].set(e,null)}else{s=document.createElement("input");s.setAttribute("type","file");const i=babelHelpers.classPrivateFieldLooseBase(this,Di)[Di].bind(this,s,e);babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].set(e,i);t.Event.bind(e,"click",i)}if(this.isMultiple()){s.setAttribute("multiple","multiple")}if(t.Type.isArrayFilled(this.getAcceptedFileTypes())){s.setAttribute("accept",this.getAcceptedFileTypes().join(","))}t.Event.bind(s,"change",babelHelpers.classPrivateFieldLooseBase(this,fi)[fi])}))}unassignBrowse(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].has(e)){t.Event.unbind(e,"click",babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].get(e));t.Event.unbind(e,"change",babelHelpers.classPrivateFieldLooseBase(this,fi)[fi]);babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].delete(e)}}))}unassignBrowseAll(){[...babelHelpers.classPrivateFieldLooseBase(this,yi)[yi].keys()].forEach((e=>{this.unassignBrowse(e)}))}assignDropzone(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi].has(e)){return}t.Event.bind(e,"dragover",babelHelpers.classPrivateFieldLooseBase(this,_i)[_i]);t.Event.bind(e,"dragenter",babelHelpers.classPrivateFieldLooseBase(this,_i)[_i]);t.Event.bind(e,"drop",babelHelpers.classPrivateFieldLooseBase(this,mi)[mi]);babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi].add(e)}))}unassignDropzone(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi].has(e)){t.Event.unbind(e,"dragover",babelHelpers.classPrivateFieldLooseBase(this,_i)[_i]);t.Event.unbind(e,"dragenter",babelHelpers.classPrivateFieldLooseBase(this,_i)[_i]);t.Event.unbind(e,"drop",babelHelpers.classPrivateFieldLooseBase(this,mi)[mi]);babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi].delete(e)}}))}unassignDropzoneAll(){[...babelHelpers.classPrivateFieldLooseBase(this,Hi)[Hi]].forEach((e=>{this.unassignDropzone(e)}))}assignPaste(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(!t.Type.isElementNode(e)||babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei].has(e)){return}t.Event.bind(e,"paste",babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]);babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei].add(e)}))}unassignPaste(e){const s=t.Type.isElementNode(e)?[e]:e;if(!t.Type.isArray(s)){return}s.forEach((e=>{if(babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei].has(e)){t.Event.unbind(e,"paste",babelHelpers.classPrivateFieldLooseBase(this,Li)[Li]);babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei].delete(e)}}))}unassignPasteAll(){[...babelHelpers.classPrivateFieldLooseBase(this,Ei)[Ei]].forEach((e=>{this.unassignPaste(e)}))}getHiddenFieldsContainer(){let e=null;if(t.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,di)[di])){e=document.querySelector(babelHelpers.classPrivateFieldLooseBase(this,di)[di]);if(!t.Type.isElementNode(e)){console.error(`Uploader: a hidden field container was not found (${babelHelpers.classPrivateFieldLooseBase(this,di)[di]}).`)}}else if(t.Type.isElementNode(babelHelpers.classPrivateFieldLooseBase(this,di)[di])){e=babelHelpers.classPrivateFieldLooseBase(this,di)[di]}return e}setHiddenFieldsContainer(e){if(t.Type.isStringFilled(e)||t.Type.isElementNode(e)||t.Type.isNull(e)){babelHelpers.classPrivateFieldLooseBase(this,di)[di]=e}}getHiddenFieldName(){return babelHelpers.classPrivateFieldLooseBase(this,hi)[hi]}setHiddenFieldName(e){if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,hi)[hi]=e}}shouldAssignAsFile(){return babelHelpers.classPrivateFieldLooseBase(this,bi)[bi]}setAssignAsFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,bi)[bi]=e}}shouldAssignServerFile(){return babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]}setAssignServerFile(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,pi)[pi]=e}}getTotalSize(){return babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].reduce(((e,s)=>e+s.getSize()),0)}shouldAutoUpload(){return babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]}setAutoUpload(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,ei)[ei]=e}}getMaxParallelUploads(){return babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]}setMaxParallelUploads(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,ti)[ti]=e}}getMaxParallelLoads(){return babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]}setMaxParallelLoads(e){if(t.Type.isNumber(e)&&e>0){babelHelpers.classPrivateFieldLooseBase(this,ii)[ii]=e}}getUploadingFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].filter((e=>e.isUploading())).length}getPendingFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].filter((e=>e.isReadyToUpload())).length}static getImageExtensions(){return this.getGlobalOption("imageExtensions",[".jpg",".bmp",".jpeg",".jpe",".gif",".png",".webp"])}setAcceptOnlyImages(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]=e;if(e){this.acceptOnlyImages()}}}acceptOnlyImages(){const e=Vi.getImageExtensions();this.setAcceptedFileTypes(e);babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]=true}shouldAcceptOnlyImages(){return babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]}getAcceptedFileTypes(){return babelHelpers.classPrivateFieldLooseBase(this,li)[li]}setAcceptedFileTypes(e){const s=t.Type.isString(e)?e.split(","):e;if(t.Type.isArray(s)){babelHelpers.classPrivateFieldLooseBase(this,li)[li]=[];babelHelpers.classPrivateFieldLooseBase(this,ri)[ri]=false;s.forEach((e=>{if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,li)[li].push(e)}}))}}getIgnoredFileNames(){return babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]}setIgnoredFileNames(e){if(t.Type.isArray(e)){babelHelpers.classPrivateFieldLooseBase(this,ai)[ai]=[];e.forEach((e=>{if(t.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,ai)[ai].push(e.toLowerCase())}}))}}setMaxFileCount(e){if(t.Type.isNumber(e)&&e>0||e===null){babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]=e}}getMaxFileCount(){return babelHelpers.classPrivateFieldLooseBase(this,oi)[oi]}setAllowReplaceSingle(e){if(t.Type.isBoolean(e)){babelHelpers.classPrivateFieldLooseBase(this,si)[si]=e}}shouldReplaceSingle(){return babelHelpers.classPrivateFieldLooseBase(this,si)[si]}}function $i(e){e.subscribeFromOptions({[l.LOAD_START]:()=>{this.emit(Nt.FILE_LOAD_START,{file:e})},[l.LOAD_PROGRESS]:s=>{const{progress:t}=s.getData();this.emit(Nt.FILE_LOAD_PROGRESS,{file:e,progress:t})},[l.LOAD_ERROR]:s=>{const{error:t}=s.getData();this.emit(Nt.FILE_ERROR,{file:e,error:t});this.emit(Nt.FILE_ADD,{file:e,error:t});babelHelpers.classPrivateFieldLooseBase(this,ji)[ji]()},[l.LOAD_COMPLETE]:()=>{this.emit(Nt.FILE_ADD,{file:e});this.emit(Nt.FILE_LOAD_COMPLETE,{file:e});if(!e.isUploadable()){this.emit(Nt.FILE_COMPLETE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,xi)[xi](e)}else if(this.shouldAutoUpload()){e.upload()}babelHelpers.classPrivateFieldLooseBase(this,ji)[ji]()},[l.VALIDATE_FILE_ASYNC]:e=>{const s=e.getData().file;return babelHelpers.classPrivateFieldLooseBase(this,Ri)[Ri](zt.VALIDATION,s)},[l.PREPARE_FILE_ASYNC]:e=>{const s=e.getData().file;return babelHelpers.classPrivateFieldLooseBase(this,Ri)[Ri](zt.PREPARATION,s)}})}function Xi(e){e.subscribeFromOptions({[l.BEFORE_UPLOAD]:babelHelpers.classPrivateFieldLooseBase(this,gi)[gi],[l.UPLOAD_START]:()=>{this.emit(Nt.FILE_UPLOAD_START,{file:e})},[l.UPLOAD_PROGRESS]:s=>{const{progress:t}=s.getData();this.emit(Nt.FILE_UPLOAD_PROGRESS,{file:e,progress:t})},[l.UPLOAD_ERROR]:s=>{const{error:t}=s.getData();this.emit(Nt.FILE_ERROR,{file:e,error:t});babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]()},[l.UPLOAD_COMPLETE]:()=>{this.emit(Nt.FILE_UPLOAD_COMPLETE,{file:e});this.emit(Nt.FILE_COMPLETE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,xi)[xi](e);babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]()}})}function Ji(e){e.subscribeOnce(l.REMOVE_ERROR,(s=>{const{error:t}=s.getData();this.emit(Nt.FILE_ERROR,{file:e,error:t})}));e.subscribeOnce(l.REMOVE_COMPLETE,(()=>{babelHelpers.classPrivateFieldLooseBase(this,Ci)[Ci](e)}))}function Yi(e){if(this.getStatus()===_t.STOPPED){e.preventDefault();this.start()}else if(this.getUploadingFileCount()>=this.getMaxParallelUploads()){e.preventDefault()}}function qi(e){const s=e.getTarget();this.emit(Nt.FILE_STATUS_CHANGE,{file:s})}function Qi(e){const s=e.getTarget();const t=e.getData().property;const i=e.getData().value;if(t==="serverFileId"){babelHelpers.classPrivateFieldLooseBase(this,Ki)[Ki](s)}this.emit(Nt.FILE_STATE_CHANGE,{file:s,property:t,value:i})}function Zi(e){const s=e.length;const t=babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].length;if(!this.isMultiple()&&s>1){return true}let i=null;if(this.isMultiple()){i=this.getMaxFileCount()}else{i=this.shouldReplaceSingle()?null:1}if(i!==null&&t+s>i){const e=new a("MAX_FILE_COUNT_EXCEEDED",{maxFileCount:i});this.emit(Nt.MAX_FILE_COUNT_EXCEEDED,{error:e});this.emit(Nt.ERROR,{error:e});return true}return false}function er(e,...s){return new Promise(((t,i)=>{const r=[...babelHelpers.classPrivateFieldLooseBase(this,ui)[ui].get(e)||[]];if(r.length===0){t();return}const l=r.shift();r.reduce(((e,t)=>e.then((()=>t.apply(...s)))),l.apply(...s)).then((e=>t(e))).catch((e=>i(e)))}))}function sr(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].indexOf(e);if(s!==-1){babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].splice(s,1)}e.unsubscribeAll();this.emit(Nt.FILE_REMOVE,{file:e});babelHelpers.classPrivateFieldLooseBase(this,ki)[ki](e)}function tr(e,t){const i=new s.BaseEvent({data:{input:e,node:t}});this.emit(Nt.BEFORE_BROWSE,i);if(i.isDefaultPrevented()){return}e.click()}function ir(e){const s=e.currentTarget;this.addFiles([...s.files]);s.value=""}function rr(e){e.preventDefault();const t=new s.BaseEvent({data:{dragEvent:e}});this.emit(Nt.BEFORE_DROP,t);if(t.isDefaultPrevented()){return}Wt(e.dataTransfer).then((e=>{this.addFiles(e)})).catch((e=>{console.error("Uploader: data transfer error",e)}))}function lr(e){e.preventDefault()}function ar(e){const t=e.clipboardData;if(!t){return}const i=new s.BaseEvent({data:{clipboardEvent:e}});this.emit(Nt.BEFORE_PASTE,i);if(i.isDefaultPrevented()){return}if(Vt(t)){e.preventDefault();Wt(t).then((e=>{this.addFiles(e)})).catch((e=>{console.error("Uploader: data transfer error",e)}))}}function or(){if(this.getStatus()!==_t.STARTED){return}const e=this.getMaxParallelUploads();const s=this.getUploadingFileCount();const t=babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].filter((e=>e.isReadyToUpload()));const i=t.length;if(s<e){const i=Math.min(e-s,t.length);for(let e=0;e<i;e++){const s=t[e];s.upload()}}if(s===0&&i===0){babelHelpers.classPrivateFieldLooseBase(this,vi)[vi]=_t.STOPPED;this.emit(Nt.UPLOAD_COMPLETE)}}function nr(){const e=this.getMaxParallelLoads();const s=babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].filter((e=>e.isLoading())).length;const t=babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].filter((e=>e.getStatus()===i.ADDED&&e.getOrigin()===r.CLIENT));if(s<e){const i=Math.min(e-s,t.length);for(let e=0;e<i;e++){const s=t[e];s.load()}}}function cr(e){const s=this.getHiddenFieldsContainer();if(!s||babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].has(e.getId())){return}if(e.getOrigin()===r.SERVER&&!this.shouldAssignServerFile()){return}const i=e.getOrigin()===r.CLIENT&&!e.isUploadable()&&this.shouldAssignAsFile()&&Xt();const l=document.createElement("input");l.type=i?"file":"hidden";l.name=this.getHiddenFieldName()+(this.isMultiple()?"[]":"");if(i){t.Dom.style(l,{visibility:"hidden",left:0,top:0,width:0,height:0,position:"absolute","pointer-events":"none"});Jt(l,e.getBinary())}else if(e.getServerFileId()!==null){l.value=e.getServerFileId()}t.Dom.append(l,s);babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].set(e.getId(),l);babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi]()}function dr(e){const s=babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].get(e.getId());if(s&&s.type==="hidden"){if(e.getServerFileId()===null){babelHelpers.classPrivateFieldLooseBase(this,ki)[ki](e)}else{s.value=e.getServerFileId()}}}function hr(e){const s=babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].get(e.getId());if(s){t.Dom.remove(s);babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].delete(e.getId())}}function br(){[...babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].values()].forEach((e=>{t.Dom.remove(e)}));babelHelpers.classPrivateFieldLooseBase(this,ci)[ci]=[]}function pr(){const e=this.getHiddenFieldsContainer();if(!e){return}this.getFiles().forEach((s=>{const i=babelHelpers.classPrivateFieldLooseBase(this,ci)[ci].get(s.getId());if(i){t.Dom.append(i,e)}}))}const ur=e=>/^image\/[\d.a-z-]+$/i.test(e.type);const vr={JPEG:65496,APP1:65505,EXIF:1165519206,TIFF:18761,Orientation:274,Unknown:65280};const gr=(e,s,t=false)=>e.getUint16(s,t);const Pr=(e,s,t=false)=>e.getUint32(s,t);const Fr=e=>new Promise(((s,t)=>{const i=new FileReader;i.onload=function(e){const t=new DataView(e.target.result);if(gr(t,0)!==vr.JPEG){s(-1);return}const i=t.byteLength;let r=2;while(r<i){const e=gr(t,r);r+=2;if(e===vr.APP1){r+=2;if(Pr(t,r)!==vr.EXIF){break}const e=gr(t,r+=6)===vr.TIFF;r+=Pr(t,r+4,e);const i=gr(t,r,e);r+=2;for(let l=0;l<i;l++){if(gr(t,r+l*12,e)===vr.Orientation){s(gr(t,r+l*12+8,e));return}}}else if((e&vr.Unknown)===vr.Unknown){r+=gr(t,r)}else{break}}s(-1)};i.readAsArrayBuffer(e.slice(0,64*1024))}));const fr=e=>/^image\/jpeg$/i.test(e.type);var Lr=Object.freeze({formatFileSize:w,getFileExtension:E,getFilenameWithoutExtension:at,getExtensionFromType:F,getJpegOrientation:Fr,getArrayBuffer:hs,isDataUri:y,isImage:ur,isResizableImage:T,isJpeg:fr,getImageSize:Ms,getResizedImageSize:Js,resizeImage:vt,loadImage:$s,isValidFileType:cs,canAppendFileToForm:Xt,assignFileToInput:Jt,createFileFromBlob:L,createBlobFromDataUri:H,createVideoPreview:Pt,createUniqueId:P,createWorker:Ws,getFilesFromDataTransfer:Wt,hasDataTransferOnlyFiles:Gt,isFilePasted:Vt});e.Uploader=Vi;e.UploaderStatus=_t;e.UploaderEvent=Nt;e.FileStatus=i;e.FileOrigin=r;e.FileEvent=l;e.FilterType=zt;e.Helpers=Lr;e.UploaderError=a;e.Server=Qe;e.AbstractLoadController=b;e.AbstractUploadController=c;e.AbstractRemoveController=v;e.formatFileSize=w;e.getFileExtension=E;e.getFilenameWithoutExtension=at;e.getExtensionFromType=F;e.getJpegOrientation=Fr;e.getArrayBuffer=hs;e.isDataUri=y;e.isImage=ur;e.isResizableImage=T;e.isJpeg=fr;e.getImageSize=Ms;e.getResizedImageSize=Js;e.resizeImage=vt;e.loadImage=$s;e.isValidFileType=cs;e.canAppendFileToForm=Xt;e.assignFileToInput=Jt;e.createFileFromBlob=L;e.createBlobFromDataUri=H;e.createVideoPreview=Pt;e.createUniqueId=P;e.createWorker=Ws;e.getFilesFromDataTransfer=Wt;e.hasDataTransferOnlyFiles=Gt;e.isFilePasted=Vt})(this.BX.UI.Uploader=this.BX.UI.Uploader||{},BX.Event,BX);
//# sourceMappingURL=ui.uploader.bundle.map.js