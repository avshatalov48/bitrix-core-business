this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.Provider=this.BX.Messenger.Provider||{};(function(e,s,t,i){"use strict";var a=function(){babelHelpers.createClass(e,null,[{key:"create",value:function e(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new this(s)}}]);function e(){var s=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,e);if(babelHelpers.typeof(s.controller)==="object"&&s.controller){this.controller=s.controller}if(babelHelpers.typeof(s.store)==="object"&&s.store){this.store=s.store}}babelHelpers.createClass(e,[{key:"execute",value:function e(s,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};s="handle"+s.split(".").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("");if(t.error()){if(typeof this[s+"Error"]==="function"){return this[s+"Error"](t.error(),i)}}else{if(typeof this[s+"Success"]==="function"){return this[s+"Success"](t.data(),i)}}return typeof this[s]==="function"?this[s](t,i):null}}]);return e}();var r=function(e){babelHelpers.inherits(a,e);function a(){babelHelpers.classCallCheck(this,a);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(a).apply(this,arguments))}babelHelpers.createClass(a,[{key:"handleImUserListGetSuccess",value:function e(t){this.store.dispatch("users/set",s.VuexBuilderModel.convertToArray(t))}},{key:"handleImUserGetSuccess",value:function e(s){this.store.dispatch("users/set",[s])}},{key:"handleImChatGetSuccess",value:function e(s){this.store.dispatch("dialogues/set",s)}},{key:"handleImDialogMessagesGetSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/setBefore",this.controller.application.prepareFilesBeforeSave(s.files));this.store.dispatch("messages/setBefore",s.messages)}},{key:"handleImDialogMessagesGetInitSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/set",this.controller.application.prepareFilesBeforeSave(s.files));this.store.dispatch("messages/set",s.messages.reverse())}},{key:"handleImDialogMessagesGetUnreadSuccess",value:function e(s){this.store.dispatch("users/set",s.users);this.store.dispatch("files/set",this.controller.application.prepareFilesBeforeSave(s.files));this.store.dispatch("messages/setAfter",s.messages)}},{key:"handleImDiskFolderGetSuccess",value:function e(s){this.store.commit("application/set",{dialog:{diskFolderId:s.ID}})}},{key:"handleImMessageAddSuccess",value:function e(s,t){var i=this;this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{id:s,sending:false,error:false}}).then(function(){i.store.dispatch("messages/actionFinish",{id:s,chatId:t.chatId})})}},{key:"handleImMessageAddError",value:function e(s,t){this.store.dispatch("messages/actionError",{id:t.id,chatId:t.chatId})}},{key:"handleImDiskFileCommitSuccess",value:function e(s,t){var i=this;this.store.dispatch("messages/update",{id:t.id,chatId:t.chatId,fields:{id:s["MESSAGE_ID"],sending:false,error:false}}).then(function(){i.store.dispatch("messages/actionFinish",{id:s["MESSAGE_ID"],chatId:t.chatId})})}},{key:"handleImDiskFileCommitError",value:function e(s,i){this.store.dispatch("files/update",{chatId:i.chatId,id:i.file.id,fields:{status:t.FileStatus.error,progress:0}});this.store.dispatch("messages/actionError",{id:i.id,chatId:i.chatId,retry:false})}},{key:"handleImRecentListSuccess",value:function e(s,t){i.Logger.warn("Provider.Rest.handleImRecentGetSuccess",s);var a=[];var r=[];var n={general:[],pinned:[]};s.items.forEach(function(e){var s=0;var t=0;if(e.user&&e.user.id>0){s=e.user.id;a.push(e.user)}if(e.chat){t=e.chat.id;r.push(Object.assign(e.chat,{dialogId:e.id}))}else{r.push(Object.assign({},{dialogId:e.id}))}n.general.push(babelHelpers.objectSpread({},e,{avatar:e.avatar.url,color:e.avatar.color,userId:s,chatId:t}))});s.pinned.forEach(function(e){var s=0;var t=0;if(e.user&&e.user.id>0){s=e.user.id;a.push(e.user)}if(e.chat){t=e.chat.id;r.push(Object.assign(e.chat,{dialogId:e.id}))}else{r.push(Object.assign({},{dialogId:e.id}))}n.pinned.push(babelHelpers.objectSpread({},e,{avatar:e.avatar.url,color:e.avatar.color,userId:s,chatId:t}))});this.store.dispatch("users/set",a);this.store.dispatch("dialogues/set",r);this.store.dispatch("recent/set",n)}}]);return a}(a);var n=function(e){babelHelpers.inherits(s,e);function s(e){var t;babelHelpers.classCallCheck(this,s);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(s).call(this,e));t.application=e.application;return t}babelHelpers.createClass(s,[{key:"handleImChatGetSuccess",value:function e(s){this.store.commit("application/set",{dialog:{chatId:s.id,dialogId:s.dialog_id,diskFolderId:s.disk_folder_id}})}},{key:"handleImCallGetCallLimitsSuccess",value:function e(s){this.store.commit("application/set",{call:{serverEnabled:s.callServerEnabled,maxParticipants:s.maxParticipants}})}},{key:"handleImChatGetError",value:function e(s){if(s.ex.error==="ACCESS_ERROR"){i.Logger.error("MobileRestAnswerHandler.handleImChatGetError: ACCESS_ERROR")}}},{key:"handleImDialogMessagesGetInitSuccess",value:function e(){this.controller.application.emit(t.EventType.dialog.sendReadMessages)}},{key:"handleImMessageAddSuccess",value:function e(s,t){this.application.messagesQueue=this.context.messagesQueue.filter(function(e){return e.id!==t.id})}},{key:"handleImMessageAddError",value:function e(s,t){this.application.messagesQueue=this.context.messagesQueue.filter(function(e){return e.id!==t.id})}},{key:"handleImDiskFileCommitSuccess",value:function e(s,t){this.application.messagesQueue=this.context.messagesQueue.filter(function(e){return e.id!==t.id})}}]);return s}(a);e.BaseRestHandler=a;e.CoreRestHandler=r;e.DialogRestHandler=n})(this.BX.Messenger.Provider.Rest=this.BX.Messenger.Provider.Rest||{},BX,BX.Messenger.Const,BX.Messenger.Lib);
//# sourceMappingURL=registry.bundle.map.js