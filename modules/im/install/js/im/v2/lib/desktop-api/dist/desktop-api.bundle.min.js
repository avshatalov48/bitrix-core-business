this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(t,e,o,s,n){"use strict";const i={isDesktop(){return o.Type.isObject(window.BXDesktopSystem)},restart(){var t;if(this.getApiVersion()<74){return}(t=BXDesktopSystem)==null?void 0:t.Restart()},shutdown(){var t;(t=BXDesktopSystem)==null?void 0:t.Shutdown()}};const r={mask:{id:"mask",version:72},restart:{id:"restart",version:74},accountManagement:{id:"accountManagement",version:75}};const a={getApiVersion(){if(!this.isDesktop()){return 0}const[t,e,o,s]=window.BXDesktopSystem.GetProperty("versionParts");return s},isFeatureEnabled(t){var e;return Boolean((e=window.BXDesktopSystem)==null?void 0:e.FeatureEnabled(t))},isFeatureSupported(t){if(!r[t]){return false}return this.getApiVersion()>=r[t].version}};const d={};const u={subscribe(t,e){if(!this.isDesktop()){return}const s=t=>{var o;const s=(o=t.detail)!=null?o:[];e.apply(window,s)};if(!d[t]){d[t]=[]}d[t].push(s);o.Event.bind(window,t,s)},unsubscribe(t,e){if(!o.Type.isFunction(e)){if(!o.Type.isArrayFilled(d[t])){return}d[t].forEach((e=>{o.Event.unbind(window,t,e)}));return}o.Event.unbind(window,t,e)},emit(t,e=[]){const o=opener||top;const s=o.BXWindows;s.forEach((o=>{var s;if(!o||o.name===""){return}o==null?void 0:(s=o.BXDesktopWindow)==null?void 0:s.DispatchCustomEvent(t,e)}));this.emitToMainWindow(t,e)},emitToMainWindow(t,e=[]){var o,s;const n=opener||top;(o=n.BXDesktopSystem)==null?void 0:(s=o.GetMainWindow())==null?void 0:s.DispatchCustomEvent(t,e)}};const l={isTwoWindowMode(){var t;return Boolean((t=BXDesktopSystem)==null?void 0:t.IsTwoWindowsMode())},isChatWindow(){const t=o.Extension.getSettings("im.v2.lib.desktop-api");return this.isDesktop()&&t.get("isChatWindow")},isChatTab(){return this.isChatWindow()||this.isDesktop()&&location.href.includes("&IM_TAB=Y")},setActiveTab(t=window){var e;if(!o.Type.isObject(t)){return}(e=t.BXDesktopSystem)==null?void 0:e.SetActiveTab()},showWindow(t=window){var e;if(!o.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("show")},activateWindow(t=window){this.setActiveTab(t);this.showWindow(t)},hideWindow(t=window){var e;if(!o.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("hide")},closeWindow(t=window){var e;if(!o.Type.isObject(t)){return}(e=t.BXDesktopWindow)==null?void 0:e.ExecuteCommand("close")},hideLoader(){o.Dom.remove(document.getElementById("bx-desktop-loader"))},reloadWindow(){const t=new n.BaseEvent;n.EventEmitter.emit(window,s.EventType.desktop.onReload,t);location.reload()},findWindow(t=""){const e=opener||top;return e.BXWindows.find((e=>(e==null?void 0:e.name)===t))},createTab(t){const e=o.Dom.create({tag:"a",attrs:{href:t}}).href;BXDesktopSystem.CreateTab(e)},createImTab(t){const e=o.Dom.create({tag:"a",attrs:{href:t}}).href;BXDesktopSystem.CreateImTab(e)},createWindow(t,e){BXDesktopSystem.GetWindow(t,e)},createTopmostWindow(t){return BXDesktopSystem.ExecuteCommand("topmost.show.html",t)},setWindowPosition(t){var e;const o={};Object.entries(t).forEach((([t,e])=>{const s=t[0].toUpperCase()+t.slice(1);o[s]=e}));(e=BXDesktopWindow)==null?void 0:e.SetProperty("position",o)},prepareHtml(t,e){if(o.Type.isDomNode(t)){t=t.outerHTML}if(o.Type.isDomNode(e)){e=e.outerHTML}o.Event.ready();if(o.Type.isStringFilled(e)){e=`\n\t\t\t\t<script type="text/javascript">\n\t\t\t\t\tBX.ready(() => {\n\t\t\t\t\t\t${e}\n\t\t\t\t\t});\n\t\t\t\t<\/script>\n\t\t\t`}const s=document.head.outerHTML.replaceAll(/BX\.PULL\.start\([^)]*\);/g,"");return`\n\t\t\t<!DOCTYPE html>\n\t\t\t<html>\n\t\t\t\t${s}\n\t\t\t\t<body class="im-desktop im-desktop-popup">\n\t\t\t\t\t${t}${e}\n\t\t\t\t</body>\n\t\t\t</html>\n\t\t`},setWindowSize(t,e){BXDesktopWindow.SetProperty("clientSize",{Width:t,Height:e})},setMinimumWindowSize(t,e){BXDesktopWindow.SetProperty("minClientSize",{Width:t,Height:e})}};const c={setCounter(t,e=false){var o,s;const n=t.toString();(o=BXDesktopSystem)==null?void 0:o.SetIconBadge(n,e);(s=BXDesktopSystem)==null?void 0:s.SetTabBadge(0,n)},setBrowserIconBadge(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetBrowserIconBadge(t.toString())},setIconStatus(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetIconStatus(t)},setOfflineIcon(){var t;(t=BXDesktopSystem)==null?void 0:t.SetIconStatus("offline")},flashIcon(){var t;if(!o.Browser.isWin()){return}(t=BXDesktopSystem)==null?void 0:t.FlashIcon()}};const p={smoothing:"bxd_camera_smoothing",telemetry:"bxd_telemetry",sliderBindingsStatus:"sliderBindingsStatus"};const m={getCameraSmoothingStatus(){return this.getCustomSetting(p.smoothing,"0")==="1"},setCameraSmoothingStatus(t){const e=t===true?"1":"0";this.setCustomSetting(p.smoothing,e)},isTwoWindowMode(){var t;return Boolean((t=BXDesktopSystem)==null?void 0:t.IsTwoWindowsMode())},setTwoWindowMode(t){var e;if(t===true){var o;(o=BXDesktopSystem)==null?void 0:o.V10();return}(e=BXDesktopSystem)==null?void 0:e.V8()},getAutostartStatus(){var t;return(t=BXDesktopSystem)==null?void 0:t.GetProperty("autostart")},setAutostartStatus(t){var e;(e=BXDesktopSystem)==null?void 0:e.SetProperty("autostart",t)},getTelemetryStatus(){return this.getCustomSetting(p.telemetry,"1")==="1"},setTelemetryStatus(t){this.setCustomSetting(p.telemetry,t?"1":"0")},setCustomSetting(t,e){var o;(o=BXDesktopSystem)==null?void 0:o.StoreSettings(t,e)},getCustomSetting(t,e){var o;return(o=BXDesktopSystem)==null?void 0:o.QuerySettings(t,e)}};const v={prepareResourcePath(t){let e="";try{const o=new URL(t,location.origin);e=o.href}catch{}return e}};const S={changeTab(t){const e=o.Extension.getSettings("im.v2.lib.desktop-api");const s=e.get("v2");if(s){return}BX.desktop.changeTab(t)}};const g={removeNativeNotifications(){var t;if(this.getApiVersion()<74){return}(t=BXDesktopSystem)==null?void 0:t.NotificationRemoveAll()}};const y={writeToLogFile(t,e){var s;if(!o.Type.isStringFilled(t)){console.error("Desktop logger: filename is not defined");return}let n="";if(o.Type.isString(e)){n=e}else if(o.Type.isNumber(e)){n=e.toString()}else{n=JSON.stringify(e)}(s=BXDesktopSystem)==null?void 0:s.Log(t,n)},printWelcomePrompt(){const t=BXDesktopSystem.GetProperty("versionParts").join(".");let s="unknown";if(o.Browser.isMac()){s="MacOS"}else if(o.Browser.isWin()){s="Windows"}else if(o.Browser.isLinux()){s="Linux"}const n=o.Loc.getMessage("IM_LIB_DESKTOP_API_WELCOME_PROMPT",{"#VERSION#":t,"#OS#":s});e.Logger.desktop(n)},setLogInfo(t){BXDesktopSystem.LogInfo=t}};const B={getCallMask(){if(!this.isDesktop()){return{id:""}}return{id:BXDesktopSystem.QuerySettings("bxd_camera_3dbackground_id")||""}},setCallMaskLoadHandlers(t){this.subscribe("BX3dAvatarReady",t);this.subscribe("BX3dAvatarError",t)},setCallMask(t,e,o){if(this.getApiVersion()<72){return false}if(!t){BXDesktopSystem.Set3dAvatar("","");BXDesktopSystem.StoreSettings("bxd_camera_3dbackground_id","");return true}e=this.prepareResourcePath(e);o=this.prepareResourcePath(o);BXDesktopSystem.Set3dAvatar(e,o);BXDesktopSystem.StoreSettings("bxd_camera_3dbackground_id",t);return true}};const k={getBackgroundImage(){if(!this.isDesktop()){return{id:"none",source:""}}const t=BXDesktopSystem.QuerySettings("bxd_camera_background_id")||"none";return{id:t}},setCallBackground(t,e){if(e==="none"||e===""){e=""}else if(e==="blur");else if(e==="gaussianBlur"){e="GaussianBlur"}else{e=this.prepareResourcePath(e)}var o=new BX.Promise;setTimeout((()=>{this.setCallMask(false);BXDesktopSystem.StoreSettings("bxd_camera_background_id",t);BXDesktopSystem.StoreSettings("bxd_camera_background",e);o.resolve()}),100);return o}};const w={openAddAccountTab(){var t;(t=BXDesktopSystem)==null?void 0:t.AccountAddForm()},deleteAccount(t,e){var o;(o=BXDesktopSystem)==null?void 0:o.AccountDelete(t,e)},connectAccount(t,e,o,s){var n;(n=BXDesktopSystem)==null?void 0:n.AccountConnect(t,e,o,s)},disconnectAccount(t){var e;(e=BXDesktopSystem)==null?void 0:e.AccountDisconnect(t)},getAccountList(){var t;return(t=BXDesktopSystem)==null?void 0:t.AccountList()},login(){return new Promise((t=>{var e;(e=BXDesktopSystem)==null?void 0:e.Login({success:()=>t()})}))},async logout(){try{var t;await o.ajax.runAction(s.RestMethod.imV2DesktopLogout);(t=BXDesktopSystem)==null?void 0:t.Logout(2)}catch(t){var e;console.error("DesktopApi logout error",t);(e=BXDesktopSystem)==null?void 0:e.Logout(3)}},async terminate(){try{await o.ajax.runAction(s.RestMethod.imV2DesktopLogout)}finally{i.shutdown()}}};const h={startDiskSync(){var t;(t=BXFileStorage)==null?void 0:t.SyncPause(false);const e=new n.BaseEvent({compatData:[true]});n.EventEmitter.emit(window,s.EventType.desktop.onSyncPause,e)},stopDiskSync(){var t;(t=BXFileStorage)==null?void 0:t.SyncPause(true);const e=new n.BaseEvent({compatData:[false]});n.EventEmitter.emit(window,s.EventType.desktop.onSyncPause,e)}};const D={openDeveloperTools(){var t;(t=BXDesktopWindow)==null?void 0:t.OpenDeveloperTools()},openLogsFolder(){var t;(t=BXDesktopSystem)==null?void 0:t.OpenLogsFolder()}};const X={...i,...v,...a,...u,...l,...c,...g,...m,...S,...k,...B,...y,...w,...h,...D};t.DesktopApi=X;t.DesktopFeature=r;t.DesktopSettingsKey=p})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Const,BX.Event);
//# sourceMappingURL=desktop-api.bundle.map.js