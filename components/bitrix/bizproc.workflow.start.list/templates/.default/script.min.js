(function(e,t,i,r,a){"use strict";var n;function o(e,t){s(e,t);t.add(e)}function l(e,t,i){s(e,t);t.set(e,i)}function s(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function c(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var d=t.Reflection.namespace("BX.Bizproc.Component");var p=new WeakMap;var u=new WeakMap;var v=new WeakMap;var f=new WeakSet;var m=new WeakSet;var g=function(){function e(i){babelHelpers.classCallCheck(this,e);o(this,m);o(this,f);l(this,p,{writable:true,value:void 0});l(this,u,{writable:true,value:void 0});l(this,v,{writable:true,value:new Map});if(!t.Type.isPlainObject(i)){return}this.gridId=i.gridId;this.createTemplateButton=i.createTemplateButton;this.errorsContainerDiv=i.errorsContainerDiv;if(t.Type.isStringFilled(i.signedDocumentType)){babelHelpers.classPrivateFieldSet(this,p,i.signedDocumentType)}if(t.Type.isStringFilled(i.signedDocumentId)){babelHelpers.classPrivateFieldSet(this,u,i.signedDocumentId)}}babelHelpers.createClass(e,[{key:"init",value:function e(){var r=this;if(this.createTemplateButton){t.Event.bind(this.createTemplateButton,"click",(function(e){return r.createTemplate()}))}BX.UI.Hint.init(document);if(this.getGrid()){BX.Bizproc.Component.WorkflowStartList.colorPinnedRows(this.getGrid())}i.EventEmitter.subscribe("Grid::updated",c(this,f,h).bind(this))}},{key:"createTemplate",value:function e(){alert("Create Template")}},{key:"editTemplate",value:function e(t){alert("Edit Template "+t)}},{key:"showErrors",value:function e(t){var i=this;this.errorsContainerDiv.style.margin="10px";t.forEach((function(e){var t=new r.Alert({text:e.message,color:r.AlertColor.DANGER,closeBtn:true,animated:true});t.renderTo(i.errorsContainerDiv)}))}},{key:"reloadGrid",value:function e(){var t=this.getGrid();if(t){t.reload()}}},{key:"getGrid",value:function e(){if(this.gridId){return BX.Main.gridManager&&BX.Main.gridManager.getInstanceById(this.gridId)}return null}},{key:"startWorkflow",value:function e(i,r){var n=this;i.preventDefault();var o=t.Text.toNumber(r);if(o<=0||!babelHelpers.classPrivateFieldGet(this,p)||!babelHelpers.classPrivateFieldGet(this,u)){return}var l=function e(){var t;var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.close();return}if(!babelHelpers.classPrivateFieldGet(n,v).has(r)){babelHelpers.classPrivateFieldGet(n,v).set(r,0)}babelHelpers.classPrivateFieldGet(n,v).set(r,babelHelpers.classPrivateFieldGet(n,v).get(r)+1);(t=n.getGrid())===null||t===void 0?void 0:t.reload()};a.Starter.singleStart({signedDocumentId:babelHelpers.classPrivateFieldGet(this,u),signedDocumentType:babelHelpers.classPrivateFieldGet(this,p),templateId:o},l)}}],[{key:"changePin",value:function e(i,r,a){var n=a.getData();var o=n.button;if(t.Dom.hasClass(o,BX.Grid.CellActionState.ACTIVE)){BX.Bizproc.Component.WorkflowStartList.action("unpin",i,r);t.Dom.removeClass(o,BX.Grid.CellActionState.ACTIVE)}else{BX.Bizproc.Component.WorkflowStartList.action("pin",i,r);t.Dom.addClass(o,BX.Grid.CellActionState.ACTIVE)}var l=BX.Main.gridManager.getInstanceById(r);if(l){BX.Bizproc.Component.WorkflowStartList.colorPinnedRows(l)}}},{key:"action",value:function e(t,i,r){var a="bitrix:bizproc.workflow.start.list";BX.ajax.runComponentAction(a,t,{mode:"class",data:{templateId:i}}).then((function(e){var t=BX.Main.gridManager.getInstanceById(r);if(t){t.reload()}}))}},{key:"colorPinnedRows",value:function e(i){i.getRows().getRows().forEach((function(e){var i=e.getNode();if(t.Type.isElementNode(i.querySelector(".main-grid-cell-content-action-pin.main-grid-cell-content-action-active"))){t.Dom.addClass(i,"bizproc-workflow-start-list-item-pinned")}else{t.Dom.removeClass(i,"bizproc-workflow-start-list-item-pinned")}}))}}]);return e}();function h(){var e=this;if(this.getGrid()){BX.UI.Hint.init(this.getGrid().getContainer());BX.Bizproc.Component.WorkflowStartList.colorPinnedRows(this.getGrid())}babelHelpers.classPrivateFieldGet(this,v).forEach((function(i,r){var a=document.querySelector('[data-role="template-'.concat(r,'-counter"]'));if(t.Type.isElementNode(a)){t.Dom.clean(a);t.Dom.append(c(e,m,b).call(e,r),a)}}))}function b(e){var i=t.Text.encode(t.Loc.getMessage("BIZPROC_CMP_TMP_WORKKFLOW_START_LIST_START_COUNTER",{"#COUNTER#":babelHelpers.classPrivateFieldGet(this,v).get(e)}));i=i.replace("[bold]",'<span class="bizproc-workflow-start-list-column-start-counter">');i=i.replace("[/bold]","</span>");return t.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['<div class="ui-typography-text-xs">',"</div>"])),i)}d.WorkflowStartList=g})(this.window=this.window||{},BX,BX.Event,BX.UI,BX.Bizproc.Workflow);
//# sourceMappingURL=script.map.js