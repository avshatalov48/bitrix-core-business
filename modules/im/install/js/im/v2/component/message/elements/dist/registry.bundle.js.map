{"version":3,"file":"registry.bundle.js","sources":["../src/message-status/message-status.js","../src/attach/attach.js","../src/keyboard/keyboard.js","../src/reaction/components/user.js","../src/reaction/classes/user-service.js","../src/reaction/components/additional-users.js","../src/reaction/components/item.js","../src/reaction/classes/reaction-service.js","../src/reaction/list.js","../src/reaction/selector.js","../src/default-message-content/default-message-content.js","../src/author-title/author-title.js","../src/context-menu/context-menu.js","../src/retry-button/classes/retry-context-menu.js","../src/retry-button/retry-button.js","../src/message-header/message-header.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\nimport { OwnMessageStatus as StatusType } from 'im.v2.const';\nimport { DateCode, DateFormatter } from 'im.v2.lib.date-formatter';\n\nimport './message-status.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const MessageStatus = {\n\tname: 'MessageStatus',\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisOverlay: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\treturn DateFormatter.formatByCode(this.message.date, DateCode.shortTimeFormat);\n\t\t},\n\t\tisSelfMessage(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === Core.getUserId();\n\t\t},\n\t\tmessageStatus(): $Values<typeof StatusType>\n\t\t{\n\t\t\tif (this.message.error)\n\t\t\t{\n\t\t\t\treturn StatusType.error;\n\t\t\t}\n\n\t\t\tif (this.message.sending)\n\t\t\t{\n\t\t\t\treturn StatusType.sending;\n\t\t\t}\n\n\t\t\tif (this.message.viewedByOthers)\n\t\t\t{\n\t\t\t\treturn StatusType.viewed;\n\t\t\t}\n\n\t\t\treturn StatusType.sent;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-status__container bx-im-message-status__scope\" :class=\"{'--overlay': isOverlay}\">\n\t\t\t<div v-if=\"message.isEdited && !message.isDeleted\" class=\"bx-im-message-status__edit-mark\">\n\t\t\t\t{{ loc('IM_MESSENGER_MESSAGE_EDITED') }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-message-status__date\" :class=\"{'--overlay': isOverlay}\">\n\t\t\t\t{{ formattedDate }}\n\t\t\t</div>\n\t\t\t<div v-if=\"isSelfMessage\" :class=\"'--' + messageStatus\" class=\"bx-im-message-status__icon\"></div>\n\t\t</div>\n\t`,\n};\n","import { provide } from 'ui.vue3';\n\nimport { Attach } from 'im.v2.component.elements';\nimport { ChatType } from 'im.v2.const';\n\nimport './attach.css';\n\nimport type { ImModelChat, ImModelMessage, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const MessageAttach = {\n\tname: 'MessageAttach',\n\tcomponents: { Attach },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialogColor(): string\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user ? this.user.color : this.dialog.color;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tprovide('message', this.message);\n\t},\n\ttemplate: `\n\t\t<div v-for=\"config in message.attach\" :key=\"config.id\" class=\"bx-im-message-attach__container\">\n\t\t\t<Attach :baseColor=\"dialogColor\" :config=\"config\" />\n\t\t</div>\n\t`,\n};\n","import { Keyboard } from 'im.v2.component.elements';\n\nimport './keyboard.css';\n\nimport type { ImModelChat, ImModelMessage, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const MessageKeyboard = {\n\tname: 'MessageKeyboard',\n\tcomponents: { Keyboard },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-keyboard__container\">\n\t\t\t<Keyboard :buttons=\"message.keyboard\" :dialogId=\"dialogId\" :messageId=\"message.id\" />\n\t\t</div>\n\t`,\n};\n","import { Avatar, AvatarSize } from 'im.v2.component.elements';\n\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const ReactionUser = {\n\tcomponents: { Avatar },\n\tprops:\n\t{\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.userId);\n\t\t},\n\t\tavatarStyle(): Object\n\t\t{\n\t\t\tif (!this.user.avatar)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${this.user.avatar}')`,\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-reaction-list__user_avatar\">\n\t\t\t<Avatar \n\t\t\t\t:dialogId=\"userId\" \n\t\t\t\t:size=\"AvatarSize.XS\" \n\t\t\t\t:withAvatarLetters=\"false\"\n\t\t\t\t:withTooltip=\"false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import {Core} from 'im.v2.application.core';\nimport {RestMethod} from 'im.v2.const';\nimport {UserManager} from 'im.v2.lib.user';\nimport {Logger} from 'im.v2.lib.logger';\n\nimport type {Store} from 'ui.vue3.vuex';\nimport type {RestClient} from 'rest.client';\n\nexport class UserService\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\t#userManager: UserManager;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t\tthis.#userManager = new UserManager();\n\t}\n\n\tloadReactionUsers(messageId: number, reaction: string): Promise<number[]>\n\t{\n\t\tlet users = [];\n\t\tLogger.warn('Reactions: UserService: loadReactionUsers', messageId, reaction);\n\t\tconst queryParams = {\n\t\t\tmessageId,\n\t\t\tfilter: {\n\t\t\t\treaction\n\t\t\t}\n\t\t};\n\t\treturn this.#restClient.callMethod(RestMethod.imV2ChatMessageReactionTail, queryParams)\n\t\t\t.then(response => {\n\t\t\t\tusers = response.data().users;\n\t\t\t\treturn this.#userManager.setUsersToModel(Object.values(users));\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\treturn users.map(user => user.id);\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error('Reactions: UserService: loadReactionUsers error', error);\n\t\t\t\tthrow new Error(error);\n\t\t\t});\n\t}\n}","import {Core} from 'im.v2.application.core';\nimport {UserListPopup} from 'im.v2.component.elements';\n\nimport {UserService} from '../classes/user-service';\n\n// @vue/component\nexport const AdditionalUsers = {\n\tcomponents: {UserListPopup},\n\tprops: {\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true\n\t\t},\n\t\treaction: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t},\n\t\tshow: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t}\n\t},\n\temits: ['close'],\n\tdata()\n\t{\n\t\treturn {\n\t\t\tshowPopup: false,\n\t\t\tloadingAdditionalUsers: false,\n\t\t\tadditionalUsers: []\n\t\t};\n\t},\n\twatch:\n\t{\n\t\tshow(newValue, oldValue)\n\t\t{\n\t\t\tif (!oldValue && newValue)\n\t\t\t{\n\t\t\t\tthis.showPopup = true;\n\t\t\t\tthis.loadUsers();\n\t\t\t}\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tloadUsers()\n\t\t{\n\t\t\tthis.loadingAdditionalUsers = true;\n\t\t\tthis.getUserService().loadReactionUsers(this.messageId, this.reaction)\n\t\t\t\t.then(userIds => {\n\t\t\t\t\tthis.additionalUsers = userIds;\n\t\t\t\t\tthis.loadingAdditionalUsers = false;\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.loadingAdditionalUsers = false;\n\t\t\t\t});\n\t\t},\n\t\tonPopupClose()\n\t\t{\n\t\t\tthis.showPopup = false;\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tprepareAdditionalUsers(userIds: number[]): number[]\n\t\t{\n\t\t\tconst firstViewerId = this.dialog.lastMessageViews.firstViewer.userId;\n\n\t\t\treturn userIds.filter(userId => {\n\t\t\t\treturn userId !== Core.getUserId() && userId !== firstViewerId;\n\t\t\t});\n\t\t},\n\t\tgetUserService(): UserService\n\t\t{\n\t\t\tif (!this.userService)\n\t\t\t{\n\t\t\t\tthis.userService = new UserService();\n\t\t\t}\n\n\t\t\treturn this.userService;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<UserListPopup\n\t\t\tid=\"bx-im-message-reaction-users\"\n\t\t\t:showPopup=\"showPopup\"\n\t\t\t:loading=\"loadingAdditionalUsers\"\n\t\t\t:userIds=\"additionalUsers\"\n\t\t\t:bindElement=\"bindElement || {}\"\n\t\t\t:withAngle=\"false\"\n\t\t\t:offsetLeft=\"-112\"\n\t\t\t:forceTop=\"true\"\n\t\t\t@close=\"onPopupClose\"\n\t\t/>\n\t`\n};","import { Event } from 'main.core';\n\nimport { ReactionsSelect, reactionCssClass as ReactionIconClass } from 'ui.reactions-select';\nimport { Lottie } from 'ui.lottie';\n\nimport { ReactionUser } from './user';\nimport { AdditionalUsers } from './additional-users';\n\nconst USERS_TO_SHOW = 5;\nconst SHOW_USERS_DELAY = 500;\n\n// @vue/component\nexport const ReactionItem = {\n\tcomponents: { ReactionUser, AdditionalUsers },\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tcounter: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tusers: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tselected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tanimate: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['click'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tshowAdditionalUsers: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tshowUsers(): boolean\n\t\t{\n\t\t\tconst userLimitIsNotReached = this.counter <= USERS_TO_SHOW;\n\t\t\tconst weHaveUsersData = this.counter === this.users.length;\n\n\t\t\treturn userLimitIsNotReached && weHaveUsersData;\n\t\t},\n\t\tpreparedUsers(): number[]\n\t\t{\n\t\t\treturn [...this.users].sort((a, b) => a - b).reverse();\n\t\t},\n\t\treactionClass(): string\n\t\t{\n\t\t\treturn ReactionIconClass[this.type];\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tif (this.animate)\n\t\t{\n\t\t\tthis.playAnimation();\n\t\t}\n\t},\n\tmethods:\n\t{\n\t\tplayAnimation()\n\t\t{\n\t\t\tthis.animation = Lottie.loadAnimation({\n\t\t\t\tanimationData: ReactionsSelect.getLottieAnimation(this.type),\n\t\t\t\tcontainer: this.$refs.reactionIcon,\n\t\t\t\tloop: false,\n\t\t\t\tautoplay: false,\n\t\t\t\trenderer: 'svg',\n\t\t\t\trendererSettings: {\n\t\t\t\t\tviewBoxOnly: true,\n\t\t\t\t},\n\t\t\t});\n\t\t\tEvent.bind(this.animation, 'complete', () => {\n\t\t\t\tthis.animation.destroy();\n\t\t\t});\n\t\t\tEvent.bind(this.animation, 'destroy', () => {\n\t\t\t\tthis.animation = null;\n\t\t\t});\n\t\t\tthis.animation.play();\n\t\t},\n\t\tstartShowUsersTimer()\n\t\t{\n\t\t\tthis.showUsersTimeout = setTimeout(() => {\n\t\t\t\tthis.showAdditionalUsers = true;\n\t\t\t}, SHOW_USERS_DELAY);\n\t\t},\n\t\tclearShowUsersTimer()\n\t\t{\n\t\t\tclearTimeout(this.showUsersTimeout);\n\t\t},\n\t\tonClick()\n\t\t{\n\t\t\tthis.clearShowUsersTimer();\n\t\t\tthis.$emit('click', { animateItemFunction: this.playAnimation });\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t@click=\"onClick\" \n\t\t\t@mouseenter=\"startShowUsersTimer\"\n\t\t\t@mouseleave=\"clearShowUsersTimer\"\n\t\t\tclass=\"bx-im-reaction-list__item\"\n\t\t\t:class=\"{'--selected': selected}\"\n\t\t>\n\t\t\t<div class=\"bx-im-reaction-list__item_icon\" :class=\"reactionClass\" ref=\"reactionIcon\"></div>\n\t\t\t<div v-if=\"showUsers\" class=\"bx-im-reaction-list__user_container\" ref=\"users\">\n\t\t\t\t<TransitionGroup name=\"bx-im-reaction-list__user_animation\">\n\t\t\t\t\t<ReactionUser v-for=\"user in preparedUsers\" :key=\"user\" :userId=\"user\" />\n\t\t\t\t</TransitionGroup>\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-im-reaction-list__item_counter\" ref=\"counter\">{{ counter }}</div>\n\t\t\t<AdditionalUsers\n\t\t\t\t:show=\"showAdditionalUsers\"\n\t\t\t\t:bindElement=\"$refs['users'] || $refs['counter'] || {}\"\n\t\t\t\t:messageId=\"messageId\"\n\t\t\t\t:reaction=\"type\"\n\t\t\t\t@close=\"showAdditionalUsers = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import {Core} from 'im.v2.application.core';\nimport {RestMethod} from 'im.v2.const';\nimport {Logger} from 'im.v2.lib.logger';\n\nimport type {Store} from 'ui.vue3.vuex';\nimport type {reactionType as ReactionType} from 'ui.reactions-select';\nimport type {RestClient} from 'rest.client';\n\nexport class ReactionService\n{\n\t#store: Store;\n\t#restClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#restClient = Core.getRestClient();\n\t}\n\n\tsetReaction(messageId: number, reaction: $Values<typeof ReactionType>)\n\t{\n\t\tLogger.warn('ReactionService: setReaction', messageId, reaction);\n\t\tthis.#store.dispatch('messages/reactions/setReaction', {\n\t\t\tmessageId,\n\t\t\treaction,\n\t\t\tuserId: Core.getUserId()\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatMessageReactionAdd, {\n\t\t\tmessageId,\n\t\t\treaction\n\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error('ReactionService: error setting reaction', error);\n\t\t\t});\n\t}\n\n\tremoveReaction(messageId: number, reaction: $Values<typeof ReactionType>)\n\t{\n\t\tLogger.warn('ReactionService: removeReaction', messageId, reaction);\n\t\tthis.#store.dispatch('messages/reactions/removeReaction', {\n\t\t\tmessageId,\n\t\t\treaction,\n\t\t\tuserId: Core.getUserId()\n\t\t});\n\t\tthis.#restClient.callMethod(RestMethod.imV2ChatMessageReactionDelete, {\n\t\t\t\tmessageId,\n\t\t\t\treaction\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error('ReactionService: error removing reaction', error);\n\t\t\t});\n\t}\n}","import { EventEmitter } from 'main.core.events';\nimport { reactionType as Reaction } from 'ui.reactions-select';\n\nimport { DialogScrollThreshold, EventType } from 'im.v2.const';\n\nimport { ReactionItem } from './components/item';\nimport { ReactionService } from './classes/reaction-service';\n\nimport './list.css';\n\nimport type { ImModelReactions, ImModelMessage } from 'im.v2.model';\n\ntype ReactionType = $Values<typeof Reaction>;\n\n// @vue/component\nexport const ReactionList = {\n\tname: 'ReactionList',\n\tcomponents: { ReactionItem },\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tmounted: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tReaction: () => Reaction,\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.messageId);\n\t\t},\n\t\treactionsData(): ImModelReactions\n\t\t{\n\t\t\treturn this.$store.getters['messages/reactions/getByMessageId'](this.messageId);\n\t\t},\n\t\treactionCounters(): {[ReactionType]: number}\n\t\t{\n\t\t\treturn this.reactionsData?.reactionCounters ?? {};\n\t\t},\n\t\townReactions(): Set<ReactionType>\n\t\t{\n\t\t\treturn this.reactionsData?.ownReactions ?? new Set();\n\t\t},\n\t\tshowReactionsContainer(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.reactionCounters).length > 0;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tshowReactionsContainer(newValue, oldValue)\n\t\t{\n\t\t\tif (!oldValue && newValue)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.message.chatId,\n\t\t\t\t\tthreshold: DialogScrollThreshold.nearTheBottom,\n\t\t\t\t\tanimation: false,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tthis.mounted = true;\n\t},\n\tmethods:\n\t{\n\t\tonReactionSelect(reaction: ReactionType, event: {animateItemFunction: () => void})\n\t\t{\n\t\t\tconst { animateItemFunction } = event;\n\t\t\tif (this.ownReactions?.has(reaction))\n\t\t\t{\n\t\t\t\tthis.getReactionService().removeReaction(this.messageId, reaction);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getReactionService().setReaction(this.messageId, reaction);\n\t\t\tanimateItemFunction();\n\t\t},\n\t\tgetReactionUsers(reaction: ReactionType): number[]\n\t\t{\n\t\t\tconst users = this.reactionsData.reactionUsers[reaction];\n\t\t\tif (!users)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn [...users];\n\t\t},\n\t\tgetReactionService(): ReactionService\n\t\t{\n\t\t\tif (!this.reactionService)\n\t\t\t{\n\t\t\t\tthis.reactionService = new ReactionService();\n\t\t\t}\n\n\t\t\treturn this.reactionService;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"showReactionsContainer\" class=\"bx-im-reaction-list__container bx-im-reaction-list__scope\">\n\t\t\t<template v-for=\"reactionType in Reaction\">\n\t\t\t\t<ReactionItem\n\t\t\t\t\tv-if=\"reactionCounters[reactionType] > 0\"\n\t\t\t\t\t:key=\"reactionType + messageId\"\n\t\t\t\t\t:messageId=\"messageId\"\n\t\t\t\t\t:type=\"reactionType\"\n\t\t\t\t\t:counter=\"reactionCounters[reactionType]\"\n\t\t\t\t\t:users=\"getReactionUsers(reactionType)\"\n\t\t\t\t\t:selected=\"ownReactions.has(reactionType)\"\n\t\t\t\t\t:animate=\"mounted\"\n\t\t\t\t\t@click=\"onReactionSelect(reactionType, $event)\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { ReactionsSelect, reactionType as ReactionType } from 'ui.reactions-select';\n\nimport { UserRole, ChatType } from 'im.v2.const';\n\nimport { ReactionService } from './classes/reaction-service';\n\nimport './selector.css';\n\nimport type { ImModelChat, ImModelMessage, ImModelReactions, ImModelUser } from 'im.v2.model';\n\nconst SHOW_DELAY = 500;\nconst HIDE_DELAY = 800;\n\nconst chatTypesWithReactionDisabled = new Set([ChatType.copilot]);\n\n// @vue/component\nexport const ReactionSelector = {\n\tname: 'ReactionSelector',\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.messageId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/getByChatId'](this.message.chatId);\n\t\t},\n\t\treactionsData(): ImModelReactions\n\t\t{\n\t\t\treturn this.$store.getters['messages/reactions/getByMessageId'](this.messageId);\n\t\t},\n\t\townReactionSet(): boolean\n\t\t{\n\t\t\treturn this.reactionsData?.ownReactions?.size > 0;\n\t\t},\n\t\tisGuest(): boolean\n\t\t{\n\t\t\treturn this.dialog.role === UserRole.guest;\n\t\t},\n\t\tisBot(): boolean\n\t\t{\n\t\t\tconst user: ImModelUser = this.$store.getters['users/get'](this.dialog.dialogId);\n\n\t\t\treturn user?.bot === true;\n\t\t},\n\t\tcanSetReactions(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.messageId)\n\t\t\t\t&& !this.isGuest\n\t\t\t\t&& !this.isBot\n\t\t\t\t&& !this.areReactionsDisabledForType(this.dialog.type);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tstartShowTimer()\n\t\t{\n\t\t\tthis.clearHideTimer();\n\t\t\tif (this.selector?.isShown())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.showTimeout = setTimeout(() => {\n\t\t\t\tthis.showSelector();\n\t\t\t}, SHOW_DELAY);\n\t\t},\n\t\tclearShowTimer()\n\t\t{\n\t\t\tclearTimeout(this.showTimeout);\n\t\t\tthis.startHideTimer();\n\t\t},\n\t\tshowSelector()\n\t\t{\n\t\t\tthis.selector = new ReactionsSelect({\n\t\t\t\tname: 'im-base-message-reaction-selector',\n\t\t\t\tposition: this.$refs.selector,\n\t\t\t});\n\t\t\tthis.subscribeToSelectorEvents();\n\t\t\tthis.selector.show();\n\t\t},\n\t\tsubscribeToSelectorEvents()\n\t\t{\n\t\t\tthis.selector.subscribe('select', (selectEvent) => {\n\t\t\t\tconst { reaction } = selectEvent.getData();\n\t\t\t\tthis.getReactionService().setReaction(this.messageId, reaction);\n\t\t\t\tthis.selector?.hide();\n\t\t\t});\n\n\t\t\tthis.selector.subscribe('mouseleave', this.startHideTimer);\n\n\t\t\tthis.selector.subscribe('mouseenter', () => {\n\t\t\t\tclearTimeout(this.hideTimeout);\n\t\t\t});\n\n\t\t\tthis.selector.subscribe('hide', () => {\n\t\t\t\tclearTimeout(this.hideTimeout);\n\t\t\t\tthis.selector = null;\n\t\t\t});\n\t\t},\n\t\tstartHideTimer()\n\t\t{\n\t\t\tthis.hideTimeout = setTimeout(() => {\n\t\t\t\tthis.selector?.hide();\n\t\t\t}, HIDE_DELAY);\n\t\t},\n\t\tclearHideTimer()\n\t\t{\n\t\t\tclearTimeout(this.hideTimeout);\n\t\t},\n\t\tonIconClick()\n\t\t{\n\t\t\tthis.clearShowTimer();\n\t\t\tif (this.ownReactionSet)\n\t\t\t{\n\t\t\t\tconst [currentReaction] = [...this.reactionsData.ownReactions];\n\t\t\t\tthis.getReactionService().removeReaction(this.messageId, currentReaction);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getReactionService().setReaction(this.messageId, ReactionType.like);\n\t\t},\n\t\tgetReactionService(): ReactionService\n\t\t{\n\t\t\tif (!this.reactionService)\n\t\t\t{\n\t\t\t\tthis.reactionService = new ReactionService();\n\t\t\t}\n\n\t\t\treturn this.reactionService;\n\t\t},\n\t\tareReactionsDisabledForType(type: $Values<typeof ChatType>)\n\t\t{\n\t\t\treturn chatTypesWithReactionDisabled.has(this.dialog.type);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"canSetReactions\" class=\"bx-im-reaction-selector__container\">\n\t\t\t<div\n\t\t\t\t@click=\"onIconClick\"\n\t\t\t\t@mouseenter=\"startShowTimer\"\n\t\t\t\t@mouseleave=\"clearShowTimer\"\n\t\t\t\tclass=\"bx-im-reaction-selector__selector\"\n\t\t\t\tref=\"selector\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-im-reaction-selector__icon\" :class=\"{'--active': ownReactionSet}\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { Reactions } from 'ui.vue3.components.reactions';\n\nimport { Parser } from 'im.v2.lib.parser';\n\nimport { MessageAttach, MessageStatus, ReactionList } from '../registry';\n\nimport './default-message-content.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const DefaultMessageContent = {\n\tname: 'DefaultMessageContent',\n\tcomponents: {\n\t\tReactions,\n\t\tMessageStatus,\n\t\tMessageAttach,\n\t\tReactionList,\n\t},\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithMessageStatus: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\twithText: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\twithAttach: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tformattedText(): string\n\t\t{\n\t\t\treturn Parser.decodeMessage(this.item);\n\t\t},\n\t\tcanSetReactions(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.message.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-default-content__container bx-im-message-default-content__scope\">\n\t\t\t<div v-if=\"withText\" class=\"bx-im-message-default-content__text\" v-html=\"formattedText\"></div>\n\t\t\t<div v-if=\"withAttach && message.attach.length > 0\" class=\"bx-im-message-default-content__attach\">\n\t\t\t\t<MessageAttach :item=\"message\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-message-default-content__bottom-panel\">\n\t\t\t\t<ReactionList \n\t\t\t\t\tv-if=\"canSetReactions\" \n\t\t\t\t\t:messageId=\"message.id\" \n\t\t\t\t\tclass=\"bx-im-message-default-content__reaction-list\" \n\t\t\t\t/>\n\t\t\t\t<div v-if=\"withMessageStatus\" class=\"bx-im-message-default-content__status-container\">\n\t\t\t\t\t<MessageStatus :item=\"message\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { EventType, ChatType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { EventEmitter } from 'main.core.events';\n\nimport { ChatTitle } from 'im.v2.component.elements';\n\nimport './author-title.css';\n\nimport type { ImModelMessage, ImModelUser, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const AuthorTitle = {\n\tname: 'AuthorTitle',\n\tcomponents: {\n\t\tChatTitle,\n\t},\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/getByChatId'](this.message.chatId);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.message.authorId, true);\n\t\t},\n\t\tisSystemMessage(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === 0;\n\t\t},\n\t\tisSelfMessage(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === Core.getUserId();\n\t\t},\n\t\tisUserChat(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user && !this.isBotWithFakeAuthorNames;\n\t\t},\n\t\tisBotWithFakeAuthorNames(): boolean\n\t\t{\n\t\t\treturn this.isSupportBot || this.isNetworkBot;\n\t\t},\n\t\tisNetworkBot(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['users/bots/isNetwork'](this.dialog.dialogId);\n\t\t},\n\t\tisSupportBot(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['users/bots/isSupport'](this.dialog.dialogId);\n\t\t},\n\t\tshowTitle(): boolean\n\t\t{\n\t\t\treturn !this.isSystemMessage && !this.isSelfMessage && !this.isUserChat;\n\t\t},\n\t\tauthorDialogId(): string\n\t\t{\n\t\t\tif (this.message.authorId)\n\t\t\t{\n\t\t\t\treturn this.message.authorId.toString();\n\t\t\t}\n\n\t\t\treturn this.dialogId;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonAuthorNameClick()\n\t\t{\n\t\t\tconst authorId = Number.parseInt(this.authorDialogId, 10);\n\t\t\tif (!authorId || authorId === Core.getUserId())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.textarea.insertMention, {\n\t\t\t\tmentionText: this.user.name,\n\t\t\t\tmentionReplacement: Utils.text.getMentionBbCode(this.user.id, this.user.name),\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"showTitle\" @click=\"onAuthorNameClick\" class=\"bx-im-message-author-title__container\">\n\t\t\t<ChatTitle\n\t\t\t\t:dialogId=\"authorDialogId\"\n\t\t\t\t:showItsYou=\"false\"\n\t\t\t\t:withColor=\"true\"\n\t\t\t\t:withLeftIcon=\"true\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Quote } from 'im.v2.lib.quote';\n\nimport './context-menu.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const ContextMenu = {\n\tname: 'ContextMenu',\n\tprops:\n\t{\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tmenuIsActiveForId: {\n\t\t\ttype: [String, Number],\n\t\t\tdefault: 0,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmenuTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(\n\t\t\t\t'IM_MESSENGER_MESSAGE_MENU_TITLE',\n\t\t\t\t{ '#SHORTCUT#': Utils.platform.isMac() ? 'CMD' : 'CTRL' },\n\t\t\t);\n\t\t},\n\t\tmessageItem(): ImModelMessage\n\t\t{\n\t\t\treturn this.message;\n\t\t},\n\t\tmessageHasError(): boolean\n\t\t{\n\t\t\treturn this.messageItem.error;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonMenuClick(event: PointerEvent)\n\t\t{\n\t\t\tif (Utils.key.isCombination(event, ['Alt+Ctrl']))\n\t\t\t{\n\t\t\t\tconst message = { ...this.message };\n\n\t\t\t\tEventEmitter.emit(EventType.textarea.insertText, {\n\t\t\t\t\ttext: Quote.prepareQuoteText(message),\n\t\t\t\t\twithNewLine: true,\n\t\t\t\t\treplace: false,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Utils.key.isCmdOrCtrl(event))\n\t\t\t{\n\t\t\t\tconst message = { ...this.message };\n\t\t\t\tEventEmitter.emit(EventType.textarea.replyMessage, {\n\t\t\t\t\tmessageId: message.id,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(EventType.dialog.onClickMessageContextMenu, {\n\t\t\t\tmessage: this.message,\n\t\t\t\tevent,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"!messageHasError\" class=\"bx-im-message-context-menu__container bx-im-message-context-menu__scope\">\n\t\t\t<button\n\t\t\t\t:title=\"menuTitle\"\n\t\t\t\t@click=\"onMenuClick\"\n\t\t\t\t@contextmenu.prevent\n\t\t\t\t:class=\"{'--active': menuIsActiveForId === message.id}\"\n\t\t\t\tclass=\"bx-im-message-context-menu__button\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { BaseMenu } from 'im.v2.lib.menu';\nimport { SendingService, MessageService } from 'im.v2.provider.service';\n\nimport type { MenuItem } from 'im.v2.lib.menu';\nimport type { ImModelMessage } from 'im.v2.model';\n\nexport class RetryContextMenu extends BaseMenu\n{\n\tcontext: ImModelMessage & {dialogId: string};\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'bx-im-message-retry-context-menu';\n\t}\n\n\tgetMenuItems(): MenuItem[]\n\t{\n\t\treturn [\n\t\t\tthis.getRetryItem(),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\t}\n\n\tgetRetryItem(): MenuItem\n\t{\n\t\tif (!this.#isOwnMessage() || !this.#hasError())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('IM_MESSENGER_MESSAGE_CONTEXT_MENU_RETRY'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#retrySend();\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetDeleteItem(): ?MenuItem\n\t{\n\t\tif (!this.#isOwnMessage() || !this.#hasError())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst phrase = Loc.getMessage('IM_MESSENGER_MESSAGE_CONTEXT_MENU_DELETE');\n\n\t\treturn {\n\t\t\thtml: `<span class=\"bx-im-message-retry-button__context-menu-delete\">${phrase}</span>`,\n\t\t\tonclick: () => {\n\t\t\t\tconst messageService = new MessageService({ chatId: this.context.chatId });\n\t\t\t\tmessageService.deleteMessage(this.context.id);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t#isOwnMessage(): boolean\n\t{\n\t\treturn this.context.authorId === Core.getUserId();\n\t}\n\n\t#hasError(): boolean\n\t{\n\t\treturn this.context.error;\n\t}\n\n\t#retrySend()\n\t{\n\t\tconst hasFiles = this.context.files.length > 0;\n\t\tif (hasFiles)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#retrySendMessage();\n\t}\n\n\t#retrySendMessage()\n\t{\n\t\t(new SendingService()).retrySendMessage({\n\t\t\ttempMessageId: this.context.id,\n\t\t\tdialogId: this.context.dialogId,\n\t\t});\n\t}\n}\n","import { RetryContextMenu } from './classes/retry-context-menu';\n\nimport './retry-button.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const RetryButton = {\n\tname: 'RetryButton',\n\tprops:\n\t{\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessageItem(): ImModelMessage\n\t\t{\n\t\t\treturn this.message;\n\t\t},\n\t\tmenuTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_MESSENGER_MESSAGE_CONTEXT_MENU_RETRY');\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new RetryContextMenu();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tconst context = { dialogId: this.dialogId, ...this.messageItem };\n\t\t\tthis.contextMenu.openMenu(context, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-retry-button__container bx-im-message-retry-button__scope\">\n\t\t\t<button\n\t\t\t\t:title=\"menuTitle\"\n\t\t\t\t@click=\"onClick\"\n\t\t\t\tclass=\"bx-im-message-retry-button__arrow\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport { AuthorTitle } from '../author-title/author-title';\n\nimport './message-header.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const MessageHeader = {\n\tname: 'MessageHeader',\n\tcomponents: { AuthorTitle },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tforwardAuthorId(): number\n\t\t{\n\t\t\treturn this.message.forward.userId;\n\t\t},\n\t\tforwardContextId(): string\n\t\t{\n\t\t\treturn this.message.forward.id;\n\t\t},\n\t\tisForwarded(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/isForward'](this.message.id);\n\t\t},\n\t\tforwardAuthorName(): string\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.forwardAuthorId, true).name;\n\t\t},\n\t\tisSystemMessage(): boolean\n\t\t{\n\t\t\treturn this.message.forward.userId === 0;\n\t\t},\n\t\tforwardAuthorTitle(): { prefix: string, name: string }\n\t\t{\n\t\t\tconst [prefix] = this.loc('IM_MESSENGER_MESSAGE_HEADER_FORWARDED_FROM').split('#NAME#');\n\n\t\t\treturn {\n\t\t\t\tprefix,\n\t\t\t\tname: this.forwardAuthorName,\n\t\t\t};\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(code: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(code);\n\t\t},\n\t\tonForwardClick()\n\t\t{\n\t\t\tconst contextCode = Parser.getContextCodeFromForwardId(this.forwardContextId);\n\t\t\tif (contextCode.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [dialogId, messageId] = contextCode.split('/');\n\n\t\t\tEventEmitter.emit(EventType.dialog.goToMessageContext, {\n\t\t\t\tmessageId: Number.parseInt(messageId, 10),\n\t\t\t\tdialogId: dialogId.toString(),\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"isForwarded\" class=\"bx-im-message-header__container\" @click=\"onForwardClick\">\n\t\t\t<span v-if=\"isSystemMessage\">{{ loc('IM_MESSENGER_MESSAGE_HEADER_FORWARDED_FROM_SYSTEM')}}</span> \n\t\t\t<span v-else>\n\t\t\t\t{{ forwardAuthorTitle.prefix }}\n\t\t\t\t<span class=\"bx-im-message-header__author-name\">{{ forwardAuthorTitle.name }}</span> \n\t\t\t</span>\n\t\t</div>\n\t\t<AuthorTitle v-else-if=\"withTitle\" :item=\"item\" />\n\t`,\n};\n"],"names":["MessageStatus","name","props","item","type","Object","required","isOverlay","Boolean","default","computed","message","formattedDate","DateFormatter","formatByCode","date","DateCode","shortTimeFormat","isSelfMessage","authorId","Core","getUserId","messageStatus","error","StatusType","sending","viewedByOthers","viewed","sent","methods","loc","phraseCode","$Bitrix","Loc","getMessage","template","MessageAttach","components","Attach","dialogId","String","dialog","$store","getters","user","dialogColor","ChatType","color","created","provide","MessageKeyboard","Keyboard","ReactionUser","Avatar","userId","Number","AvatarSize","avatarStyle","avatar","backgroundImage","UserService","constructor","getStore","getRestClient","UserManager","loadReactionUsers","messageId","reaction","users","Logger","warn","queryParams","filter","callMethod","RestMethod","imV2ChatMessageReactionTail","then","response","data","setUsersToModel","values","map","id","catch","console","Error","AdditionalUsers","UserListPopup","show","bindElement","emits","showPopup","loadingAdditionalUsers","additionalUsers","watch","newValue","oldValue","loadUsers","getUserService","userIds","onPopupClose","$emit","prepareAdditionalUsers","firstViewerId","lastMessageViews","firstViewer","userService","USERS_TO_SHOW","SHOW_USERS_DELAY","ReactionItem","counter","Array","selected","animate","showAdditionalUsers","showUsers","userLimitIsNotReached","weHaveUsersData","length","preparedUsers","sort","a","b","reverse","reactionClass","ReactionIconClass","mounted","playAnimation","animation","Lottie","loadAnimation","animationData","ReactionsSelect","getLottieAnimation","container","$refs","reactionIcon","loop","autoplay","renderer","rendererSettings","viewBoxOnly","Event","bind","destroy","play","startShowUsersTimer","showUsersTimeout","setTimeout","clearShowUsersTimer","clearTimeout","onClick","animateItemFunction","ReactionService","setReaction","dispatch","imV2ChatMessageReactionAdd","removeReaction","imV2ChatMessageReactionDelete","ReactionList","Reaction","reactionsData","reactionCounters","ownReactions","Set","showReactionsContainer","keys","EventEmitter","emit","EventType","scrollToBottom","chatId","threshold","DialogScrollThreshold","nearTheBottom","onReactionSelect","event","has","getReactionService","getReactionUsers","reactionUsers","reactionService","SHOW_DELAY","HIDE_DELAY","chatTypesWithReactionDisabled","copilot","ReactionSelector","ownReactionSet","size","isGuest","role","UserRole","guest","isBot","bot","canSetReactions","Type","isNumber","areReactionsDisabledForType","startShowTimer","clearHideTimer","selector","isShown","showTimeout","showSelector","clearShowTimer","startHideTimer","position","subscribeToSelectorEvents","subscribe","selectEvent","getData","hide","hideTimeout","onIconClick","currentReaction","ReactionType","like","DefaultMessageContent","Reactions","withMessageStatus","withText","withAttach","formattedText","Parser","decodeMessage","AuthorTitle","ChatTitle","isSystemMessage","isUserChat","isBotWithFakeAuthorNames","isSupportBot","isNetworkBot","showTitle","authorDialogId","toString","onAuthorNameClick","parseInt","textarea","insertMention","mentionText","mentionReplacement","Utils","text","getMentionBbCode","ContextMenu","menuIsActiveForId","menuTitle","platform","isMac","messageItem","messageHasError","onMenuClick","key","isCombination","insertText","Quote","prepareQuoteText","withNewLine","replace","isCmdOrCtrl","replyMessage","onClickMessageContextMenu","RetryContextMenu","BaseMenu","getMenuItems","getRetryItem","getDeleteItem","onclick","menuInstance","close","phrase","html","messageService","MessageService","context","deleteMessage","hasFiles","files","SendingService","retrySendMessage","tempMessageId","RetryButton","contextMenu","openMenu","currentTarget","MessageHeader","withTitle","forwardAuthorId","forward","forwardContextId","isForwarded","forwardAuthorName","forwardAuthorTitle","prefix","split","code","onForwardClick","contextCode","getContextCodeFromForwardId","goToMessageContext"],"mappings":"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"}