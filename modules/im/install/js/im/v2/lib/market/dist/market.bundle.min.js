this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,a,t,r,l){"use strict";var i=babelHelpers.classPrivateFieldLooseKey("loadLink");var o=babelHelpers.classPrivateFieldLooseKey("getPlacementOptions");class n{constructor(){Object.defineProperty(this,o,{value:c});Object.defineProperty(this,i,{writable:true,value:""})}openPlacement(e,s){return new Promise(((a,t)=>{const r=new FormData;Object.entries(e.loadConfiguration).forEach((([e,s])=>{r.append(`PARAMS[params][${e}]`,s)}));Object.entries(babelHelpers.classPrivateFieldLooseBase(this,o)[o](s)).forEach((([e,s])=>{r.append(`PARAMS[params][PLACEMENT_OPTIONS][${e}]`,s)}));const l={method:"POST",body:r};fetch(babelHelpers.classPrivateFieldLooseBase(this,i)[i],l).then((e=>e.text())).then((e=>a(e))).catch((e=>t(e)))}))}setLoadLink(e){babelHelpers.classPrivateFieldLooseBase(this,i)[i]=e}}function c(e){const s={};if(e.dialogId){s.dialogId=e.dialogId}if(e.messageId){s.messageId=e.messageId}return s}const b=Object.freeze({user:"user",chat:"chat",lines:"lines",crm:"crm",all:"all"});var p=babelHelpers.classPrivateFieldLooseKey("canShowPlacementInChat");var d=babelHelpers.classPrivateFieldLooseKey("matchDialogType");var v=babelHelpers.classPrivateFieldLooseKey("isUser");var u=babelHelpers.classPrivateFieldLooseKey("isChat");var h=babelHelpers.classPrivateFieldLooseKey("isLines");var P=babelHelpers.classPrivateFieldLooseKey("isCrm");class L{constructor(){Object.defineProperty(this,P,{value:F});Object.defineProperty(this,h,{value:m});Object.defineProperty(this,u,{value:g});Object.defineProperty(this,v,{value:f});Object.defineProperty(this,d,{value:B});Object.defineProperty(this,p,{value:y})}getAvailablePlacements(e,s=""){return e.filter((e=>babelHelpers.classPrivateFieldLooseBase(this,p)[p](e,s)))}}function y(e,s){if(!e.options.context||!s){return true}return e.options.context.some((e=>babelHelpers.classPrivateFieldLooseBase(this,d)[d](e,s)))}function B(e,s){switch(e){case b.user:return babelHelpers.classPrivateFieldLooseBase(this,v)[v](s);case b.chat:return babelHelpers.classPrivateFieldLooseBase(this,u)[u](s);case b.lines:return babelHelpers.classPrivateFieldLooseBase(this,h)[h](s);case b.crm:return babelHelpers.classPrivateFieldLooseBase(this,P)[P](s);case b.all:return true;default:return false}}function f(e){return e===l.ChatType.user}function g(e){return e!==l.ChatType.lines&&e!==l.ChatType.crm&&e!==l.ChatType.user}function m(e){return e===l.ChatType.lines}function F(e){return e===l.ChatType.crm}var H=babelHelpers.classPrivateFieldLooseKey("instance");var O=babelHelpers.classPrivateFieldLooseKey("store");var M=babelHelpers.classPrivateFieldLooseKey("marketService");var j=babelHelpers.classPrivateFieldLooseKey("availabilityManager");var C=babelHelpers.classPrivateFieldLooseKey("init");class I{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,H)[H]){babelHelpers.classPrivateFieldLooseBase(this,H)[H]=new this}return babelHelpers.classPrivateFieldLooseBase(this,H)[H]}static init(){I.getInstance()}constructor(){Object.defineProperty(this,C,{value:X});Object.defineProperty(this,O,{writable:true,value:void 0});Object.defineProperty(this,M,{writable:true,value:void 0});Object.defineProperty(this,j,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,O)[O]=t.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,M)[M]=new n;babelHelpers.classPrivateFieldLooseBase(this,j)[j]=new L;const{marketApps:e}=t.Core.getApplicationData();r.Logger.warn("MarketManager: marketApps",e);babelHelpers.classPrivateFieldLooseBase(this,C)[C](e)}getAvailablePlacementsByType(e,s=""){const a=babelHelpers.classPrivateFieldLooseBase(this,O)[O].getters["market/getByPlacement"](e);const t=babelHelpers.classPrivateFieldLooseBase(this,O)[O].getters["chats/get"](s);const r=t?t.type:"";return babelHelpers.classPrivateFieldLooseBase(this,j)[j].getAvailablePlacements(a,r)}loadPlacement(e,s={}){const a=babelHelpers.classPrivateFieldLooseBase(this,O)[O].getters["market/getById"](Number.parseInt(e,10));return babelHelpers.classPrivateFieldLooseBase(this,M)[M].openPlacement(a,s)}unloadPlacement(e){const s=Object.values(BX.rest.layoutList).filter((s=>s.params.placementId===e));if(s.length>0){s.forEach((e=>{e.destroy()}))}}static async openSlider(e,s){await a.Runtime.loadExtension("applayout");BX.rest.AppLayout.openApplication(e.loadConfiguration.ID,s,e.loadConfiguration)}static openMarketplace(){const e="IM_CHAT";BX.SidePanel.Instance.open(`/market/?placement=${e}`)}}function X(e){if(!e){return}void babelHelpers.classPrivateFieldLooseBase(this,O)[O].dispatch("market/set",e);babelHelpers.classPrivateFieldLooseBase(this,M)[M].setLoadLink(e.links.load)}Object.defineProperty(I,H,{writable:true,value:void 0});e.MarketManager=I})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Vue3.Vuex,BX,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=market.bundle.map.js