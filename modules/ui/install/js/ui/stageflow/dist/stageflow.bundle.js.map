{"version":3,"file":"stageflow.bundle.js","sources":["../src/stage.js","../src/chart.js","../src/index.js"],"sourcesContent":["import {Tag, Text, Type} from 'main.core';\n\nexport class Stage\n{\n\tid;\n\tname;\n\tsuccess;\n\tfail;\n\tcolor;\n\tfillingColor;\n\tbackgroundColor;\n\tisFilled;\n\tnode;\n\ttextNode;\n\tbackgroundImage = 'url(data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2216px%22%20height%3D%2232px%22%20viewBox%3D%220%200%2016%2032%22%20version%3D%221.1%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cdefs%3E%3Cpath%20d%3D%22M0%2C2.99610022%20C0%2C1.34139976%201.3355407%2C0%202.99805158%2C0%20L6.90478569%2C0%20C8.56056385%2C0%2010.3661199%2C1.25756457%2010.9371378%2C2.80757311%20L16%2C16.5505376%20L11.0069874%2C29.2022189%20C10.3971821%2C30.7473907%208.56729657%2C32%206.90478569%2C32%20L2.99805158%2C32%20C1.34227341%2C32%200%2C30.6657405%200%2C29.0038998%20L0%2C2.99610022%20Z%22%20id%3D%22Bg%22/%3E%3C/defs%3E%3Cg%20id%3D%22Bar%22%20stroke%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cmask%20fill%3D%22white%22%20id%3D%22mask%22%3E%3Cuse%20xlink%3Ahref%3D%22%23Bg%22/%3E%3C/mask%3E%3Cuse%20fill%3D%22#COLOR2#%22%20xlink%3Ahref%3D%22%23Bg%22/%3E%3Cpolygon%20id%3D%22Ln%22%20fill%3D%22#COLOR1#%22%20mask%3D%22url%28%23mask%29%22%20points%3D%220%2030%2016%2030%2016%2032%200%2032%22/%3E%3C/g%3E%3C/svg%3E) 3 10 3 3 fill repeat';\n\n\tconstructor({id, name, color, backgroundColor, isFilled, events, isSuccess, isFail, fillingColor})\n\t{\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t\tthis.color = color;\n\t\tthis.backgroundColor = backgroundColor;\n\t\tthis.isFilled = isFilled;\n\t\tthis.events = events;\n\t\tthis.success = isSuccess;\n\t\tthis.fail = isFail;\n\t\tthis.fillingColor = fillingColor;\n\t}\n\n\tstatic create(data: {\n\t\tid: number,\n\t\tname: string,\n\t\tisSuccess: boolean,\n\t\tisFail: boolean,\n\t\tcolor: string,\n\t\tbackgroundColor: string,\n\t\tfillingColor: string,\n\t\tisFilled: boolean,\n\t\tevents: {\n\t\t\t\tonMouseEnter: ?Function,\n\t\t\t\tonMouseLeave: ?Function,\n\t\t\t\tonClick: ?Function,\n\t\t}\n\t}): ?Stage\n\t{\n\t\tif(Type.isPlainObject(data) && data.id && data.name && data.color && data.backgroundColor)\n\t\t{\n\t\t\tdata.id = Text.toInteger(data.id);\n\t\t\tdata.name = data.name.toString();\n\t\t\tdata.color = data.color.toString();\n\t\t\tdata.backgroundColor = data.backgroundColor.toString();\n\t\t\tif(!Type.isPlainObject(data.events))\n\t\t\t{\n\t\t\t\tdata.events = {};\n\t\t\t}\n\t\t\tif(!Type.isBoolean(data.isFilled))\n\t\t\t{\n\t\t\t\tdata.isFilled = false;\n\t\t\t}\n\n\t\t\tif(data.id > 0)\n\t\t\t{\n\t\t\t\treturn new Stage(data);\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.name;\n\t}\n\n\tsetName(name: string): Stage\n\t{\n\t\tthis.name = name;\n\t\tif(this.textNode)\n\t\t{\n\t\t\tthis.textNode.innerText = this.name;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tisSuccess(): boolean\n\t{\n\t\treturn (this.success === true);\n\t}\n\n\tisFail(): boolean\n\t{\n\t\treturn (this.fail === true);\n\t}\n\n\tisFinal(): boolean\n\t{\n\t\treturn (this.isFail() || this.isSuccess());\n\t}\n\n\tgetColor(): string\n\t{\n\t\treturn this.color;\n\t}\n\n\tsetColor(color: string): Stage\n\t{\n\t\tthis.color = color;\n\n\t\treturn this;\n\t}\n\n\trender(): Element\n\t{\n\t\tif(this.node)\n\t\t{\n\t\t\tthis.textNode.style.backgroundImage = this.getBackgroundImage();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.textNode = Tag.render`<div style=\"border-image: ${this.getBackgroundImage()};\" class=\"ui-stageflow-stage-item-text\">${Text.encode(this.getName())}</div>`;\n\t\t\tthis.node = Tag.render`<div \n\t\t\t\t\tclass=\"ui-stageflow-stage\" \n\t\t\t\t\tdata-stage-id=\"${this.getId()}\" \n\t\t\t\t\tonmouseenter=\"${this.onMouseEnter.bind(this)}\" \n\t\t\t\t\tonmouseleave=\"${this.onMouseLeave.bind(this)}\"\n\t\t\t\t\tonclick=\"${this.onClick.bind(this)}\"\n\t\t\t\t>\n\t\t\t\t<div class=\"ui-stageflow-stage-item\">\n\t\t\t\t\t${this.textNode}\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\tthis.textNode.style.color = Stage.calculateTextColor('#' + (this.isFilled ? this.color : this.backgroundColor));\n\n\t\treturn this.node;\n\t}\n\n\tgetBackgroundImage(color: string = null, isFilled: boolean = null): string\n\t{\n\t\tif(!color)\n\t\t{\n\t\t\tif(this.isFilled && this.fillingColor)\n\t\t\t{\n\t\t\t\tcolor = this.fillingColor;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcolor = this.getColor();\n\t\t\t}\n\t\t}\n\t\tif(Type.isNull(isFilled))\n\t\t{\n\t\t\tisFilled = this.isFilled;\n\t\t}\n\n\t\tlet image = this.backgroundImage.replace('#COLOR1#', encodeURIComponent('#' + color));\n\n\t\tif(isFilled)\n\t\t{\n\t\t\timage = image.replace('#COLOR2#', encodeURIComponent('#' + color));\n\t\t}\n\t\telse\n\t\t{\n\t\t\timage = image.replace('#COLOR2#', encodeURIComponent('#' + this.backgroundColor));\n\t\t}\n\n\t\treturn image;\n\t}\n\n\tonMouseEnter()\n\t{\n\t\tif(Type.isFunction(this.events.onMouseEnter))\n\t\t{\n\t\t\tthis.events.onMouseEnter(this);\n\t\t}\n\t}\n\n\tonMouseLeave()\n\t{\n\t\tif(Type.isFunction(this.events.onMouseLeave))\n\t\t{\n\t\t\tthis.events.onMouseLeave(this);\n\t\t}\n\t}\n\n\tonClick()\n\t{\n\t\tif(Type.isFunction(this.events.onClick))\n\t\t{\n\t\t\tthis.events.onClick(this);\n\t\t}\n\t}\n\n\taddBackLight(color)\n\t{\n\t\tif(this.textNode)\n\t\t{\n\t\t\tthis.textNode.style.borderImage = this.getBackgroundImage(color, true);\n\t\t\tthis.textNode.style.color = Stage.calculateTextColor('#' + color);\n\t\t}\n\t}\n\n\tremoveBackLight()\n\t{\n\t\tif(this.textNode)\n\t\t{\n\t\t\tthis.textNode.style.borderImage = this.getBackgroundImage();\n\t\t\tthis.textNode.style.color = Stage.calculateTextColor('#' + this.backgroundColor);\n\t\t}\n\t}\n\n\tstatic calculateTextColor(baseColor)\n\t{\n\t\tvar r, g, b;\n\t\tif ( baseColor.length > 7 )\n\t\t{\n\t\t\tvar hexComponent = baseColor.split(\"(\")[1].split(\")\")[0];\n\t\t\thexComponent = hexComponent.split(\",\");\n\t\t\tr = parseInt(hexComponent[0]);\n\t\t\tg = parseInt(hexComponent[1]);\n\t\t\tb = parseInt(hexComponent[2]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(/^#([A-Fa-f0-9]{3}){1,2}$/.test(baseColor))\n\t\t\t{\n\t\t\t\tvar c = baseColor.substring(1).split('');\n\t\t\t\tif(c.length === 3)\n\t\t\t\t{\n\t\t\t\t\tc= [c[0], c[0], c[1], c[1], c[2], c[2]];\n\t\t\t\t}\n\t\t\t\tc = '0x'+c.join('');\n\t\t\t\tr = ( c >> 16 ) & 255;\n\t\t\t\tg = ( c >> 8 ) & 255;\n\t\t\t\tb =  c & 255;\n\t\t\t}\n\t\t}\n\n\t\tvar y = 0.21 * r + 0.72 * g + 0.07 * b;\n\t\treturn ( y < 145 ) ? \"#fff\" : \"#333\";\n\t}\n}","import {Text, Dom, Tag, Type, Loc} from 'main.core';\nimport {Stage} from \"./stage\";\n\nimport {MenuManager, Popup, PopupManager} from 'main.popup';\n\nconst semanticSelectorPopupId = 'ui-stageflow-select-semantic-popup';\nconst finalStageSelectorPopupId = 'ui-stageflow-select-final-stage-popup';\nconst FinalStageDefaultData = {\n\tid: 'final',\n\tcolor: '7BD500',\n\tisFilled: false,\n};\n\nconst defaultFinalStageLabels = {\n\tfinalStageName: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_NAME'),\n\tfinalStagePopupTitle: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_POPUP_TITLE'),\n\tfinalStagePopupFail: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_POPUP_FAIL'),\n\tfinalStageSelectorTitle: Loc.getMessage('UI_STAGEFLOW_FINAL_STAGE_SELECTOR_TITLE'),\n};\n\nexport class Chart\n{\n\tbackgroundColor;\n\tcontainer;\n\tcurrentStage = 0;\n\tstages: Map;\n\tisActive = false;\n\tonStageChange;\n\tlabels: {\n\t\tfinalStageName: string,\n\t\tfinalStagePopupTitle: string,\n\t\tfinalStagePopupFail: string,\n\t\tfinalStageSelectorTitle: string,\n\t};\n\n\tconstructor(params: {\n\t\tbackgroundColor: string,\n\t\tcurrentStage: number,\n\t\tisActive: boolean,\n\t\tonStageChange: ?Function,\n\t\tlabels: ?{},\n\t}, stages = [])\n\t{\n\t\tthis.labels = defaultFinalStageLabels;\n\t\tif(Type.isPlainObject(params))\n\t\t{\n\t\t\tif(Type.isString(params.backgroundColor) && params.backgroundColor.length === 6)\n\t\t\t{\n\t\t\t\tthis.backgroundColor = params.backgroundColor;\n\t\t\t}\n\t\t\tif(params.currentStage)\n\t\t\t{\n\t\t\t\tthis.currentStage = Text.toInteger(params.currentStage);\n\t\t\t}\n\t\t\tif(Type.isBoolean(params.isActive))\n\t\t\t{\n\t\t\t\tthis.isActive = params.isActive;\n\t\t\t}\n\t\t\tif(Type.isFunction(params.onStageChange))\n\t\t\t{\n\t\t\t\tthis.onStageChange = params.onStageChange;\n\t\t\t}\n\t\t\tif(Type.isPlainObject(params.labels))\n\t\t\t{\n\t\t\t\tthis.labels = {...this.labels, ...params.labels};\n\t\t\t}\n\t\t}\n\t\tFinalStageDefaultData.name = this.labels.finalStageName;\n\t\tif(Type.isArray(stages))\n\t\t{\n\t\t\tlet fillingColor = null;\n\t\t\tif(this.currentStage > 0)\n\t\t\t{\n\t\t\t\tstages.forEach((data) => {\n\t\t\t\t\tif(Text.toInteger(data.id) === Text.toInteger(this.currentStage))\n\t\t\t\t\t{\n\t\t\t\t\t\tfillingColor = data.color;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\tthis.fillStages(stages, fillingColor);\n\t\t}\n\t\tif(!this.currentStage && this.stages.length > 0)\n\t\t{\n\t\t\tthis.currentStage = this.stages.keys().next().value;\n\t\t}\n\t}\n\n\tsetCurrentStageId(stageId: number): Chart\n\t{\n\t\tstageId = Text.toInteger(stageId);\n\t\tconst currentStage = this.getStageById(stageId);\n\t\tif(!currentStage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentStage = stageId;\n\t\tconst finalStage = this.getFinalStage();\n\t\tif(finalStage)\n\t\t{\n\t\t\tif(currentStage.isFinal())\n\t\t\t{\n\t\t\t\tfinalStage.setColor(currentStage.getColor()).setName(currentStage.getName());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfinalStage.setColor(FinalStageDefaultData.color).setName(FinalStageDefaultData.name);\n\t\t\t}\n\t\t}\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(!stage.isFinal())\n\t\t\t{\n\t\t\t\tstage.fillingColor = currentStage.getColor();\n\t\t\t}\n\t\t});\n\t\tthis.addBackLightUpToStage();\n\n\t\treturn this;\n\t}\n\n\tfillStages(stages: Array, fillingColor: ?string)\n\t{\n\t\tlet isFilled = (this.currentStage > 0);\n\t\tconst finalStageOptions = {};\n\t\tthis.stages = new Map();\n\t\tstages.forEach((data) =>\n\t\t{\n\t\t\tdata.isFilled = isFilled;\n\t\t\tdata.backgroundColor = this.backgroundColor;\n\t\t\tdata.fillingColor = fillingColor;\n\t\t\tdata.events = {\n\t\t\t\tonMouseEnter: this.onStageMouseHover.bind(this),\n\t\t\t\tonMouseLeave: this.onStageMouseLeave.bind(this),\n\t\t\t\tonClick: this.onStageClick.bind(this),\n\t\t\t};\n\t\t\tconst stage = Stage.create(data);\n\t\t\tif(stage)\n\t\t\t{\n\t\t\t\tthis.stages.set(stage.getId(), stage);\n\t\t\t}\n\t\t\tif(stage.isSuccess())\n\t\t\t{\n\t\t\t\tFinalStageDefaultData.color = stage.getColor();\n\t\t\t}\n\t\t\tif(stage.isFinal())\n\t\t\t{\n\t\t\t\tfinalStageOptions.isFilled = isFilled;\n\t\t\t\tif(stage.getId() === this.currentStage)\n\t\t\t\t{\n\t\t\t\t\tfinalStageOptions.name = stage.getName();\n\t\t\t\t\tfinalStageOptions.color = stage.getColor();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(isFilled && stage.getId() === this.currentStage)\n\t\t\t{\n\t\t\t\tisFilled = false;\n\t\t\t}\n\t\t});\n\n\t\tif(this.getFailStages().length <= 0)\n\t\t{\n\t\t\tFinalStageDefaultData.name = finalStageOptions.name = this.getSuccessStage().getName();\n\t\t}\n\n\t\tthis.addFinalStage(finalStageOptions);\n\t}\n\n\taddFinalStage(data: {\n\t\tisFilled: ?boolean,\n\t\tname: ?string,\n\t\tcolor: ?string,\n\t})\n\t{\n\t\tthis.stages.set(FinalStageDefaultData.id, new Stage({...{\n\t\t\tbackgroundColor: this.backgroundColor,\n\t\t\tevents: {\n\t\t\t\tonMouseEnter: this.onStageMouseHover.bind(this),\n\t\t\t\tonMouseLeave: this.onStageMouseLeave.bind(this),\n\t\t\t\tonClick: this.onFinalStageClick.bind(this),\n\t\t\t},\n\t\t}, ...FinalStageDefaultData, ...data}));\n\t}\n\n\tgetFinalStage(): ?Stage\n\t{\n\t\treturn this.getStageById(FinalStageDefaultData.id);\n\t}\n\n\tgetStages(): Map\n\t{\n\t\treturn this.stages;\n\t}\n\n\tgetFirstFailStage(): ?Stage\n\t{\n\t\tlet failStage = null;\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isFail() && !failStage)\n\t\t\t{\n\t\t\t\tfailStage = stage;\n\t\t\t}\n\t\t});\n\n\t\treturn failStage;\n\t}\n\n\tgetFailStages(): Array\n\t{\n\t\tconst failStages = [];\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isFail())\n\t\t\t{\n\t\t\t\tfailStages.push(stage);\n\t\t\t}\n\t\t});\n\n\t\treturn failStages;\n\t}\n\n\tgetSuccessStage(): ?Stage\n\t{\n\t\tlet finalStage = null;\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isSuccess())\n\t\t\t{\n\t\t\t\tfinalStage = stage;\n\t\t\t}\n\t\t});\n\n\t\treturn finalStage;\n\t}\n\n\tgetStageById(id: number): ?Stage\n\t{\n\t\treturn this.stages.get(id);\n\t}\n\n\trender(): Element\n\t{\n\t\tconst container = this.renderContainer();\n\n\t\tthis.getStages().forEach((stage: Stage) =>\n\t\t{\n\t\t\tif(stage.isFinal())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcontainer.appendChild(stage.render());\n\t\t});\n\n\t\tthis.addBackLightUpToStage();\n\n\t\treturn container;\n\t}\n\n\trenderContainer(): Element\n\t{\n\t\tif(this.container)\n\t\t{\n\t\t\tDom.clean(this.container);\n\t\t\treturn this.container;\n\t\t}\n\n\t\tthis.container = Tag.render`<div class=\"ui-stageflow-container\"></div>`;\n\n\t\treturn this.container;\n\t}\n\n\tonStageMouseHover(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor(let [id, currentStage] of this.stages)\n\t\t{\n\t\t\tcurrentStage.addBackLight(stage.getColor());\n\t\t\tif(id === stage.getId())\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tonStageMouseLeave(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tfor(let [id, currentStage] of this.stages)\n\t\t{\n\t\t\tcurrentStage.removeBackLight();\n\t\t\tif(id === stage.getId())\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tonStageClick(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif(stage.getId() !== this.currentStage && Type.isFunction(this.onStageChange))\n\t\t{\n\t\t\tthis.onStageChange(stage);\n\t\t}\n\t\tconst popup = this.getSemanticSelectorPopup();\n\t\tif(popup.isShown())\n\t\t{\n\t\t\tpopup.close();\n\t\t}\n\t}\n\n\tonFinalStageClick(stage: Stage)\n\t{\n\t\tif(!this.isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.getFailStages().length <= 0)\n\t\t{\n\t\t\tthis.onStageClick(this.getSuccessStage());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst popup = this.getSemanticSelectorPopup();\n\t\t\tpopup.show();\n\t\t\tconst currentStage = this.getStageById(this.currentStage);\n\t\t\tthis.isActive = false;\n\t\t\tif (!currentStage.isFinal()) {\n\t\t\t\tconst finalStage = this.getStageById(FinalStageDefaultData.id);\n\t\t\t\tif (finalStage) {\n\t\t\t\t\tthis.addBackLightUpToStage(finalStage.getId(), finalStage.getColor());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\taddBackLightUpToStage(stageId: number|string = null, color: string = null)\n\t{\n\t\tif(!stageId)\n\t\t{\n\t\t\tstageId = this.currentStage;\n\t\t}\n\t\tconst currentStage = this.getStageById(stageId);\n\t\tif(currentStage && !color)\n\t\t{\n\t\t\tcolor = currentStage.getColor();\n\t\t}\n\n\t\tlet isFilled = !!stageId;\n\t\tthis.stages.forEach((stage: Stage) =>\n\t\t{\n\t\t\tstage.isFilled = isFilled;\n\t\t\tif(stage.isFilled)\n\t\t\t{\n\t\t\t\tstage.addBackLight(color ? color : stage.getColor());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstage.removeBackLight();\n\t\t\t}\n\t\t\tif(!stage.isFinal() && isFilled && stage.getId() === stageId)\n\t\t\t{\n\t\t\t\tisFilled = false;\n\t\t\t}\n\t\t});\n\t}\n\n\tgetSemanticSelectorPopup(): Popup\n\t{\n\t\tlet popup = PopupManager.getPopupById(semanticSelectorPopupId);\n\n\t\tif(!popup)\n\t\t{\n\t\t\tlet failSemanticText = this.getFailStageName();\n\n\t\t\tpopup = PopupManager.create({\n\t\t\t\tid: semanticSelectorPopupId,\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tmaxWidth: 420,\n\t\t\t\tcontent: Tag.render`<div class=\"ui-stageflow-popup-title\">${this.labels.finalStagePopupTitle}</div>`,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\t\tcolor: BX.UI.Button.Color.SUCCESS,\n\t\t\t\t\t\ttext: this.getSuccessStage().getName(),\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\t\t\tthis.onStageClick(this.getSuccessStage());\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\t(failSemanticText ? new BX.UI.Button({\n\t\t\t\t\t\tcolor: BX.UI.Button.Color.DANGER,\n\t\t\t\t\t\ttext: failSemanticText,\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\tconst finalStagePopup = this.getFinalStageSelectorPopup();\n\t\t\t\t\t\t\tfinalStagePopup.show();\n\t\t\t\t\t\t\tthis.isActive = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}) : null),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setCurrentStageId(this.currentStage);\n\t\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\treturn popup;\n\t}\n\n\tgetFinalStageSemanticSelector(isSuccess: boolean = null): Element\n\t{\n\t\tif(!this.finalStageSemanticSelector)\n\t\t{\n\t\t\tthis.finalStageSemanticSelector = Tag.render`<div class=\"ui-stageflow-stage-selector-option ui-stageflow-stage-selector-option-fail\" onclick=\"${this.onSemanticSelectorClick.bind(this)}\"></div>`;\n\t\t}\n\n\t\tif(Type.isBoolean(isSuccess))\n\t\t{\n\t\t\tlet realFinalStage = null;\n\t\t\tlet failStageName = this.getFailStageName();\n\t\t\tif(isSuccess || !failStageName)\n\t\t\t{\n\t\t\t\tthis.finalStageSemanticSelector.classList.add('ui-stageflow-stage-selector-option-success');\n\t\t\t\tthis.finalStageSemanticSelector.classList.remove('ui-stageflow-stage-selector-option-fail');\n\t\t\t\tthis.finalStageSemanticSelector.innerText = this.getSuccessStage().getName();\n\t\t\t\trealFinalStage = this.getSuccessStage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.finalStageSemanticSelector.classList.add('ui-stageflow-stage-selector-option-fail');\n\t\t\t\tthis.finalStageSemanticSelector.classList.remove('ui-stageflow-stage-selector-option-success');\n\t\t\t\tthis.finalStageSemanticSelector.innerText = failStageName;\n\t\t\t\trealFinalStage = this.getFirstFailStage();\n\t\t\t}\n\t\t\tconst finalStage = this.getFinalStage();\n\t\t\tif(finalStage && realFinalStage)\n\t\t\t{\n\t\t\t\tfinalStage.setColor(realFinalStage.getColor()).setName(realFinalStage.getName());\n\t\t\t}\n\t\t\tthis.addBackLightUpToStage(finalStage.getId(), finalStage.getColor());\n\t\t}\n\n\t\treturn this.finalStageSemanticSelector;\n\t}\n\n\tgetFinalStageSelectorPopup(isSuccess: boolean = false): Popup\n\t{\n\t\tlet titleBar = {};\n\t\tlet content = Tag.render`<div class=\"ui-stageflow-final-fail-stage-list-wrapper\"></div>`;\n\t\tif(!isSuccess)\n\t\t{\n\t\t\tconst failStages = this.getFailStages();\n\t\t\tif(failStages.length > 1)\n\t\t\t{\n\t\t\t\tlet isChecked = true;\n\t\t\t\tfailStages.forEach((stage: Stage) =>\n\t\t\t\t{\n\t\t\t\t\tcontent.appendChild(Tag.render`<div class=\"ui-stageflow-final-fail-stage-list-section\">\n\t\t\t\t\t\t<input data-stage-id=\"${stage.getId()}\" id=\"ui-stageflow-final-fail-stage-${stage.getId()}\" name=\"ui-stageflow-final-fail-stage-input\" class=\"crm-list-fail-deal-button\" type=\"radio\" ${(isChecked ? 'checked=\"checked\"' : '')}>\n\t\t\t\t\t\t<label for=\"ui-stageflow-final-fail-stage-${stage.getId()}\">${stage.getName()}</label>\n\t\t\t\t\t</div>`);\n\t\t\t\t\tisChecked = false;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\ttitleBar.content = Tag.render`<div class=\"ui-stageflow-stage-selector-block\">\n\t\t\t<span>${this.labels.finalStageSelectorTitle} </span>\n\t\t\t${this.getFinalStageSemanticSelector(isSuccess)}\n\t\t</div>`;\n\t\tlet popup = PopupManager.getPopupById(finalStageSelectorPopupId);\n\t\tif(!popup)\n\t\t{\n\t\t\tpopup = PopupManager.create({\n\t\t\t\tid: finalStageSelectorPopupId,\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcloseIcon: true,\n\t\t\t\twidth: 420,\n\t\t\t\ttitleBar: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew BX.UI.SaveButton({\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t\tconst stage = this.getSelectedFinalStage();\n\t\t\t\t\t\t\tif(stage)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.onStageClick(stage);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tnew BX.UI.CancelButton({\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setCurrentStageId(this.currentStage);\n\t\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tpopup.setContent(content);\n\t\tpopup.setTitleBar(titleBar);\n\n\t\treturn popup;\n\t}\n\n\tonSemanticSelectorClick()\n\t{\n\t\tconst failStageName = this.getFailStageName();\n\t\tconst menu = MenuManager.create({\n\t\t\tid: 'ui-stageflow-final-stage-semantic-selector',\n\t\t\tbindElement: this.getFinalStageSemanticSelector(),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\ttext: this.getSuccessStage().getName(),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getFinalStageSelectorPopup(true);\n\t\t\t\t\t\tmenu.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t(failStageName ? {\n\t\t\t\t\ttext: failStageName,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getFinalStageSelectorPopup(false);\n\t\t\t\t\t\tmenu.close();\n\t\t\t\t\t},\n\t\t\t\t} : null),\n\t\t\t]\n\t\t});\n\n\t\tmenu.show();\n\t}\n\n\tgetSelectedFinalStage(): ?Stage\n\t{\n\t\tconst finalStageSemanticSelector = this.getFinalStageSemanticSelector();\n\t\tif(finalStageSemanticSelector.classList.contains('ui-stageflow-stage-selector-option-success'))\n\t\t{\n\t\t\treturn this.getSuccessStage();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst failStages = this.getFailStages();\n\t\t\tif(failStages.length > 1)\n\t\t\t{\n\t\t\t\tconst finalStageSelectorPopupContainer = document.getElementById(finalStageSelectorPopupId);\n\t\t\t\tif(finalStageSelectorPopupContainer)\n\t\t\t\t{\n\t\t\t\t\tconst selectedInput = finalStageSelectorPopupContainer.querySelector('input:checked');\n\t\t\t\t\tif(selectedInput)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst failStage = this.getStageById(Text.toInteger(selectedInput.dataset.stageId));\n\t\t\t\t\t\tif(failStage)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn failStage;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.getFirstFailStage();\n\t\t}\n\t}\n\n\tgetFailStageName(): ?string\n\t{\n\t\tconst failStagesLength = this.getFailStages().length;\n\n\t\tif(failStagesLength <= 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\telse if(failStagesLength === 1)\n\t\t{\n\t\t\treturn this.getFirstFailStage().getName();\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.labels.finalStagePopupFail;\n\t\t}\n\t}\n}","import {Chart} from './chart';\nimport {Stage} from './stage';\n\nexport const StageFlow = {\n\tChart,\n\tStage,\n};"],"names":["Stage","id","name","color","backgroundColor","isFilled","events","isSuccess","isFail","fillingColor","success","fail","textNode","innerText","node","style","backgroundImage","getBackgroundImage","Tag","render","Text","encode","getName","getId","onMouseEnter","bind","onMouseLeave","onClick","calculateTextColor","getColor","Type","isNull","image","replace","encodeURIComponent","isFunction","borderImage","data","isPlainObject","toInteger","toString","isBoolean","baseColor","r","g","b","length","hexComponent","split","parseInt","test","c","substring","join","y","semanticSelectorPopupId","finalStageSelectorPopupId","FinalStageDefaultData","defaultFinalStageLabels","finalStageName","Loc","getMessage","finalStagePopupTitle","finalStagePopupFail","finalStageSelectorTitle","Chart","params","stages","labels","isString","currentStage","isActive","onStageChange","isArray","forEach","fillStages","keys","next","value","stageId","getStageById","finalStage","getFinalStage","isFinal","setColor","setName","stage","addBackLightUpToStage","finalStageOptions","Map","onStageMouseHover","onStageMouseLeave","onStageClick","create","set","getFailStages","getSuccessStage","addFinalStage","onFinalStageClick","failStage","failStages","push","get","container","renderContainer","getStages","appendChild","Dom","clean","addBackLight","removeBackLight","popup","getSemanticSelectorPopup","isShown","close","show","PopupManager","getPopupById","failSemanticText","getFailStageName","autoHide","closeByEsc","closeIcon","maxWidth","content","buttons","BX","UI","Button","Color","SUCCESS","text","onclick","DANGER","finalStagePopup","getFinalStageSelectorPopup","onClose","setCurrentStageId","finalStageSemanticSelector","onSemanticSelectorClick","realFinalStage","failStageName","classList","add","remove","getFirstFailStage","titleBar","isChecked","getFinalStageSemanticSelector","width","SaveButton","getSelectedFinalStage","CancelButton","setContent","setTitleBar","menu","MenuManager","bindElement","items","contains","finalStageSelectorPopupContainer","document","getElementById","selectedInput","querySelector","dataset","failStagesLength","StageFlow"],"mappings":"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"}