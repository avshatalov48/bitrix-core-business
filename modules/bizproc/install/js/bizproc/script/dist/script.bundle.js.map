{"version":3,"file":"script.bundle.js","sources":["../src/manager.js","../src/market.js","../src/script.js"],"sourcesContent":["import {ajax, Text, Type, Tag, Uri, Dom, Loc} from 'main.core';\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {UI} from 'ui.notification';\nimport {Popup} from 'main.popup';\nimport {Button} from 'ui.buttons';\nimport 'sidepanel';\nimport 'bp_field_type';\n\nlet instance = null;\n\nexport default class Manager\n{\n\tscriptEditUrl = '/bitrix/components/bitrix/bizproc.script.edit/';\n\tscriptListUrl = '/bitrix/components/bitrix/bizproc.script.list/';\n\tscriptQueueListUrl = '/bitrix/components/bitrix/bizproc.script.queue.list/';\n\tscriptQueueDocumentListUrl = '/bitrix/components/bitrix/bizproc.script.queue.document.list/';\n\n\tstatic get Instance(): Manager\n\t{\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new Manager();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tstartScript(scriptId, placement)\n\t{\n\t\tconst documentIds = this.getDocumentIds(...placement.split(':'));\n\n\t\tif (!documentIds.length)\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_NOTHING_SELECTED'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst startCallback = () =>\n\t\t{\n\t\t\tthis.#startScriptInternal(scriptId, documentIds);\n\t\t\treturn true;\n\t\t};\n\n\t\tif (documentIds.length > 1)\n\t\t{\n\t\t\tMessageBox.confirm(\n\t\t\t\tLoc.getMessage('BIZPROC_SCRIPT_MANAGER_START_TEXT_START')\n\t\t\t\t\t.replace('#CNT#', documentIds.length),\n\t\t\t\tstartCallback,\n\t\t\t\tLoc.getMessage('BIZPROC_SCRIPT_MANAGER_START_BUTTON_START')\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstartCallback();\n\t\t}\n\t}\n\n\t#startScriptInternal(scriptId, documentIds, parameters = {}, popup)\n\t{\n\t\tajax.runAction('bizproc.script.start', {\n\t\t\tanalyticsLabel: 'bizprocScriptStart',\n\t\t\tdata: {scriptId, documentIds, parameters}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (response.data.error)\n\t\t\t{\n\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t}\n\n\t\t\tif (response.data.status === 'FILL_PARAMETERS')\n\t\t\t{\n\t\t\t\tthis.#showFillParametersPopup(scriptId, documentIds, response.data);\n\t\t\t}\n\t\t\telse if (response.data.status === 'INVALID_PARAMETERS')\n\t\t\t{\n\t\t\t\t//error has already shown by MessageBox.alert\n\t\t\t\t//no actions to do\n\t\t\t}\n\t\t\telse if (response.data.status === 'QUEUED')\n\t\t\t{\n\t\t\t\tif (popup)\n\t\t\t\t{\n\t\t\t\t\tpopup.close();\n\t\t\t\t}\n\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_QUEUED')\n\t\t\t\t});\n\n\t\t\t\tthis.#keepAliveQueue(response.data.queueId);\n\t\t\t}\n\t\t});\n\t}\n\n\t#keepAliveQueue(queueId, delay = 500)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tajax.runAction('bizproc.script.execQueue', {\n\t\t\t\tdata: {queueId}\n\t\t\t}).then((response) =>\n\t\t\t{\n\t\t\t\tif (!response.data.finished)\n\t\t\t\t{\n\t\t\t\t\tthis.#keepAliveQueue(queueId, delay);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_FINISHED')\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}, delay);\n\t}\n\n\t#showFillParametersPopup(scriptId, documentIds, {parameters, documentType, scriptName})\n\t{\n\t\tconst form = this.renderParametersPopupContent(parameters, documentType);\n\t\tconst popup = new Popup(null, null, {\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttitleBar: scriptName || Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_PARAMS_POPUP_TITLE'),\n\t\t\tcontent: form,\n\t\t\twidth: 595,\n\t\t\tcontentNoPaddings: true,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\ttext : Loc.getMessage('BIZPROC_SCRIPT_MANAGER_START_BUTTON_SEND_PARAMS'),\n\t\t\t\t\tcolor: Button.Color.SUCCESS,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tconst paramFields = {};\n\t\t\t\t\t\tfor (let field of (new FormData(form)).entries())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tparamFields[field[0]] = field[1];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.#startScriptInternal(scriptId, documentIds, paramFields, popup);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew BX.UI.Button({\n\t\t\t\t\ttext : Loc.getMessage('UI_MESSAGE_BOX_CANCEL_CAPTION'),\n\t\t\t\t\tcolor: BX.UI.Button.Color.LINK,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tpopup.close();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\tpopup.show();\n\t}\n\n\trenderParametersPopupContent(parameters: [], documentType)\n\t{\n\t\tconst form = Dom.create('form', {attrs: {className: 'bp-script-start-form'}});\n\n\t\tparameters.forEach((param) => {\n\t\t\tconst field = BX.Bizproc.FieldType.renderControl(documentType, param, param.Id, param.Default || '');\n\t\t\tconst description = param.Description\n\t\t\t\t? Dom.create('span', {\n\t\t\t\t\ttext: param.Description,\n\t\t\t\t\tattrs: {className: 'bp-script-start-form-row-desc'}\n\t\t\t\t})\n\t\t\t\t: ''\n\t\t\t;\n\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div class=\"bp-script-start-form-row\">\n\t\t\t\t\t\t<span class=\"bp-script-start-form-row-title\">${Text.encode(param.Name)}</span>\n\t\t\t\t\t\t${description}\n\t\t\t\t\t\t<div class=\"bp-script-start-form-row-field\">${field}</div>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\tform\n\t\t\t);\n\t\t});\n\n\t\treturn form;\n\t}\n\n\tgetDocumentIds(section, entity): []\n\t{\n\t\tlet ids = [];\n\t\tif (section === 'crm_switcher')\n\t\t{\n\t\t\tconst grid = this.#findGridInstance(entity);\n\t\t\tif (grid)\n\t\t\t{\n\t\t\t\tids = grid.getRows().getSelectedIds();\n\t\t\t}\n\t\t\telse if (BX.CRM && BX.CRM.Kanban && BX.CRM.Kanban.Grid && BX.CRM.Kanban.Grid.Instance)\n\t\t\t{\n\t\t\t\tids = BX.CRM.Kanban.Grid.Instance.getCheckedId();\n\t\t\t}\n\t\t}\n\t\telse if (section === 'crm_detail')\n\t\t{\n\t\t\tids = [BX.Crm.EntityEditor.getDefault().getEntityId()];\n\t\t}\n\n\t\t//Prepare crm document ids\n\t\tif (Type.isArrayFilled(ids))\n\t\t{\n\t\t\tids = ids.map((id) => `${entity.toUpperCase()}_${id}`);\n\t\t}\n\n\t\treturn ids;\n\t}\n\n\t#findGridInstance(entity: string)\n\t{\n\t\tif (!BX.Main.gridManager)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst gridId = `CRM_${entity.toUpperCase()}_LIST`;\n\t\tconst grid = BX.Main.gridManager.data.find((current) => {\n\t\t\treturn current.id.indexOf(gridId) === 0 || current.id.indexOf('crm-type-item-list') === 0;\n\t\t})\n\n\t\treturn grid ? grid.instance : null;\n\t}\n\n\tcreateScript(documentType: string, placement: string): Promise\n\t{\n\t\treturn Manager.openSlider(\n\t\t\tUri.addParam(this.scriptEditUrl, {documentType, placement}),\n\t\t\t{\n\t\t\t\twidth: 930,\n\t\t\t\tcacheable: false,\n\t\t\t\tallowChangeHistory: false\n\t\t\t}\n\t\t);\n\t}\n\n\tshowScriptList(documentType: string, placement: string)\n\t{\n\n\t\tManager.openSlider(\n\t\t\tUri.addParam(this.scriptListUrl, {documentType, placement}),\n\t\t\t{cacheable: false, allowChangeHistory: false}\n\t\t).then((slider) =>\n\t\t{\n\t\t\tif(slider.isLoaded())\n\t\t\t{\n\t\t\t\t//do smth\n\t\t\t}\n\t\t});\n\t}\n\n\tshowScriptQueueList(scriptId: number)\n\t{\n\t\tManager.openSlider(\n\t\t\tUri.addParam(this.scriptQueueListUrl, {scriptId}),\n\t\t\t{cacheable: false, allowChangeHistory: false}\n\t\t);\n\t}\n\n\tshowScriptQueueDocumentList(queueId: number)\n\t{\n\t\tManager.openSlider(\n\t\t\tUri.addParam(this.scriptQueueDocumentListUrl, {queueId}),\n\t\t\t{cacheable: false, allowChangeHistory: false}\n\t\t);\n\t}\n\n\tstatic openSlider(url, options): Promise<?BX.SidePanel.Slider>\n\t{\n\t\tif(!Type.isPlainObject(options))\n\t\t{\n\t\t\toptions = {};\n\t\t}\n\t\toptions = {...{cacheable: false, allowChangeHistory: true, events: {}}, ...options};\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif(Type.isString(url) && url.length > 1)\n\t\t\t{\n\t\t\t\toptions.events.onClose = function(event)\n\t\t\t\t{\n\t\t\t\t\tresolve(event.getSlider());\n\t\t\t\t};\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\teditScript(scriptId: number, placement: string): Promise\n\t{\n\t\treturn Manager.openSlider(\n\t\t\tUri.addParam(this.scriptEditUrl, {scriptId, placement}),\n\t\t\t{width: 930, cacheable: false, allowChangeHistory: false}\n\t\t);\n\t}\n\n\tdeleteScript(scriptId: number): Promise\n\t{\n\t\treturn ajax.runAction('bizproc.script.delete', {\n\t\t\tanalyticsLabel: 'bizprocScriptDelete',\n\t\t\tdata: {scriptId}\n\t\t});\n\t}\n\n\tactivateScript(scriptId: number): Promise\n\t{\n\t\treturn ajax.runAction('bizproc.script.activate', {\n\t\t\tanalyticsLabel: 'bizprocScriptActivate',\n\t\t\tdata: {scriptId}\n\t\t});\n\t}\n\n\tdeactivateScript(scriptId: number): Promise\n\t{\n\t\treturn ajax.runAction('bizproc.script.deactivate', {\n\t\t\tanalyticsLabel: 'bizprocScriptDeactivate',\n\t\t\tdata: {scriptId}\n\t\t});\n\t}\n\n\tterminateScriptQueue(queueId: number)\n\t{\n\t\tajax.runAction('bizproc.script.terminateQueue', {\n\t\t\tanalyticsLabel: 'bizprocScriptTerminateQueue',\n\t\t\tdata: {queueId}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (response.data.error)\n\t\t\t{\n\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t}\n\t\t});\n\t}\n\n\tdeleteScriptQueue(queueId: number)\n\t{\n\t\tajax.runAction('bizproc.script.deleteQueue', {\n\t\t\tanalyticsLabel: 'bizprocScriptDeleteQueue',\n\t\t\tdata: {queueId}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tif (response.data.error)\n\t\t\t{\n\t\t\t\tMessageBox.alert(response.data.error);\n\t\t\t}\n\t\t});\n\t}\n}","let instance = null;\n\nexport default class Market\n{\n\tstatic get Instance(): Market\n\t{\n\t\tif(instance === null)\n\t\t{\n\t\t\tinstance = new Market();\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tshowForPlacement(placement: string)\n\t{\n\t\tif (BX.rest && BX.rest.Marketplace)\n\t\t{\n\t\t\tBX.rest.Marketplace.open({PLACEMENT: placement});\n\t\t}\n\t}\n}","import Manager from './manager';\nimport Market from './market';\n\nexport const Script = {\n\tMarket,\n\tManager,\n};"],"names":["instance","Manager","scriptId","placement","documentIds","getDocumentIds","split","length","MessageBox","alert","Loc","getMessage","startCallback","confirm","replace","parameters","documentType","form","Dom","create","attrs","className","forEach","param","field","BX","Bizproc","FieldType","renderControl","Id","Default","description","Description","text","append","Tag","render","Text","encode","Name","section","entity","ids","grid","getRows","getSelectedIds","CRM","Kanban","Grid","Instance","getCheckedId","Crm","EntityEditor","getDefault","getEntityId","Type","isArrayFilled","map","id","toUpperCase","openSlider","Uri","addParam","scriptEditUrl","width","cacheable","allowChangeHistory","scriptListUrl","then","slider","isLoaded","scriptQueueListUrl","queueId","scriptQueueDocumentListUrl","ajax","runAction","analyticsLabel","data","response","error","url","options","isPlainObject","events","Promise","resolve","isString","onClose","event","getSlider","SidePanel","open","popup","status","close","UI","Notification","Center","notify","content","delay","setTimeout","finished","scriptName","renderParametersPopupContent","Popup","onPopupClose","destroy","titleBar","contentNoPaddings","buttons","Button","color","Color","SUCCESS","onclick","paramFields","FormData","entries","LINK","show","Main","gridManager","gridId","find","current","indexOf","Market","rest","Marketplace","PLACEMENT","Script"],"mappings":"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"}