{"version":3,"file":"opener.bundle.js","sources":["../src/opener.js"],"sourcesContent":["import { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { EventEmitter } from 'main.core.events';\n\nimport { EventType, GetParameter, Layout } from 'im.v2.const';\nimport { CallManager } from 'im.v2.lib.call';\nimport { DesktopApi, DesktopFeature } from 'im.v2.lib.desktop-api';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { Logger } from 'im.v2.lib.logger';\nimport { PhoneManager } from 'im.v2.lib.phone';\nimport { Utils } from 'im.v2.lib.utils';\nimport { MessengerSlider } from 'im.v2.lib.slider';\nimport { LinesService } from 'im.v2.provider.service';\n\nimport type { ForwardedEntityConfig } from 'im.v2.provider.service';\nimport type { CreatableChatType } from 'im.v2.component.content.chat-forms.forms';\n\nexport const Opener = {\n\tasync openChat(dialogId: string | number = '', messageId: number = 0): Promise\n\t{\n\t\tconst preparedDialogId = dialogId.toString();\n\t\tif (Utils.dialog.isLinesExternalId(preparedDialogId))\n\t\t{\n\t\t\treturn this.openLines(preparedDialogId);\n\t\t}\n\n\t\tawait MessengerSlider.getInstance().openSlider();\n\t\tconst layoutParams = {\n\t\t\tname: Layout.chat.name,\n\t\t\tentityId: preparedDialogId,\n\t\t};\n\t\tif (messageId > 0)\n\t\t{\n\t\t\tlayoutParams.contextId = messageId;\n\t\t}\n\t\tawait LayoutManager.getInstance().setLayout(layoutParams);\n\t\tEventEmitter.emit(EventType.layout.onOpenChat, { dialogId: preparedDialogId });\n\n\t\treturn Promise.resolve();\n\t},\n\n\tasync forwardEntityToChat(dialogId: string, entityConfig: ForwardedEntityConfig): Promise\n\t{\n\t\tconst preparedDialogId = dialogId.toString();\n\t\tawait MessengerSlider.getInstance().openSlider();\n\t\tconst layoutParams = {\n\t\t\tname: Layout.chat.name,\n\t\t\tentityId: preparedDialogId,\n\t\t};\n\t\tawait LayoutManager.getInstance().setLayout(layoutParams);\n\t\tEventEmitter.emit(EventType.layout.onOpenChat, { dialogId: preparedDialogId });\n\t\tEventEmitter.emit(EventType.textarea.forwardEntity, { dialogId, entityConfig });\n\n\t\treturn Promise.resolve();\n\t},\n\n\tasync openLines(dialogId: string = ''): Promise\n\t{\n\t\tlet preparedDialogId = dialogId.toString();\n\t\tif (Utils.dialog.isLinesExternalId(preparedDialogId))\n\t\t{\n\t\t\tconst linesService = new LinesService();\n\t\t\tpreparedDialogId = await linesService.getDialogIdByUserCode(preparedDialogId);\n\t\t}\n\n\t\tawait MessengerSlider.getInstance().openSlider();\n\n\t\tconst optionOpenLinesV2Activated = FeatureManager.isFeatureAvailable(Feature.openLinesV2);\n\n\t\treturn LayoutManager.getInstance().setLayout({\n\t\t\tname: optionOpenLinesV2Activated ? Layout.openlinesV2.name : Layout.openlines.name,\n\t\t\tentityId: preparedDialogId,\n\t\t});\n\t},\n\n\tasync openCopilot(dialogId: string = '', contextId = 0): Promise\n\t{\n\t\tconst preparedDialogId = dialogId.toString();\n\n\t\tawait MessengerSlider.getInstance().openSlider();\n\n\t\treturn LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.copilot.name,\n\t\t\tentityId: preparedDialogId,\n\t\t\tcontextId,\n\t\t});\n\t},\n\n\tasync openCollab(dialogId: string = ''): Promise\n\t{\n\t\tconst preparedDialogId = dialogId.toString();\n\n\t\tawait MessengerSlider.getInstance().openSlider();\n\n\t\treturn LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.collab.name,\n\t\t\tentityId: preparedDialogId,\n\t\t});\n\t},\n\n\topenHistory(dialogId: string | number = ''): Promise\n\t{\n\t\tif (Utils.dialog.isDialogId(dialogId))\n\t\t{\n\t\t\treturn this.openChat(dialogId);\n\t\t}\n\n\t\tif (!checkHistoryDialogId(dialogId))\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\tconst sliderLink = prepareHistorySliderLink(dialogId);\n\t\tBX.SidePanel.Instance.open(sliderLink, {\n\t\t\twidth: Utils.dialog.isLinesExternalId(dialogId) ? 700 : 1000,\n\t\t\tallowChangeHistory: false,\n\t\t\tallowChangeTitle: false,\n\t\t\tcacheable: false,\n\t\t});\n\n\t\treturn Promise.resolve();\n\t},\n\n\tasync openNotifications(): Promise\n\t{\n\t\tawait MessengerSlider.getInstance().openSlider();\n\t\tawait LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.notification.name,\n\t\t});\n\n\t\tEventEmitter.emit(EventType.layout.onOpenNotifications);\n\n\t\treturn Promise.resolve();\n\t},\n\n\tasync openRecentSearch(): Promise\n\t{\n\t\tawait MessengerSlider.getInstance().openSlider();\n\t\tawait LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.chat.name,\n\t\t});\n\n\t\tEventEmitter.emit(EventType.recent.openSearch);\n\n\t\treturn Promise.resolve();\n\t},\n\n\tasync openSettings(sectionName: string): Promise\n\t{\n\t\tLogger.warn('Slider: openSettings', sectionName);\n\t\tawait MessengerSlider.getInstance().openSlider();\n\n\t\tawait LayoutManager.getInstance().setLayout({\n\t\t\tname: Layout.settings.name,\n\t\t\tentityId: sectionName,\n\t\t});\n\n\t\treturn Promise.resolve();\n\t},\n\n\topenConference(code: string = ''): Promise\n\t{\n\t\tLogger.warn('Slider: openConference', code);\n\n\t\tif (!Utils.conference.isValidCode(code))\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\tconst url = Utils.conference.getUrlByCode(code);\n\t\tUtils.browser.openLink(url, Utils.conference.getWindowNameByCode(code));\n\n\t\treturn Promise.resolve();\n\t},\n\n\tasync openChatCreation(chatType: CreatableChatType): Promise\n\t{\n\t\tLogger.warn('Slider: openChatCreation', chatType);\n\n\t\tawait MessengerSlider.getInstance().openSlider();\n\t\tconst layoutParams = {\n\t\t\tname: Layout.createChat.name,\n\t\t\tentityId: chatType,\n\t\t};\n\n\t\treturn LayoutManager.getInstance().setLayout(layoutParams);\n\t},\n\n\tstartVideoCall(dialogId: string = '', withVideo: boolean = true): Promise\n\t{\n\t\tLogger.warn('Slider: onStartVideoCall', dialogId, withVideo);\n\t\tif (!Utils.dialog.isDialogId(dialogId))\n\t\t{\n\t\t\tLogger.error('Slider: onStartVideoCall - dialogId is not correct', dialogId);\n\n\t\t\treturn false;\n\t\t}\n\n\t\tCallManager.getInstance().startCall(dialogId, withVideo);\n\n\t\treturn Promise.resolve();\n\t},\n\n\tstartPhoneCall(number: string, params: Object<any, string>): Promise\n\t{\n\t\tLogger.warn('Slider: startPhoneCall', number, params);\n\t\tvoid PhoneManager.getInstance().startCall(number, params);\n\n\t\treturn Promise.resolve();\n\t},\n\n\tstartCallList(callListId: number, params: Object<string, any>): Promise\n\t{\n\t\tLogger.warn('Slider: startCallList', callListId, params);\n\t\tPhoneManager.getInstance().startCallList(callListId, params);\n\n\t\treturn Promise.resolve();\n\t},\n\n\topenNewTab(path)\n\t{\n\t\tif (DesktopApi.isChatTab() && DesktopApi.isFeatureSupported(DesktopFeature.openNewTab.id))\n\t\t{\n\t\t\tDesktopApi.createImTab(`${path}&${GetParameter.desktopChatTabMode}=Y`);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tUtils.browser.openLink(path);\n\t\t}\n\t},\n};\n\nconst checkHistoryDialogId = (dialogId: string): boolean => {\n\treturn (\n\t\tUtils.dialog.isLinesHistoryId(dialogId)\n\t\t|| Utils.dialog.isLinesExternalId(dialogId)\n\t);\n};\n\nconst prepareHistorySliderLink = (dialogId: string): string => {\n\tconst getParams = new URLSearchParams({\n\t\t[GetParameter.openHistory]: dialogId,\n\t\t[GetParameter.backgroundType]: 'light',\n\t});\n\n\treturn `/desktop_app/history.php?${getParams.toString()}`;\n};\n"],"names":["Opener","openChat","dialogId","messageId","preparedDialogId","toString","Utils","dialog","isLinesExternalId","openLines","MessengerSlider","getInstance","openSlider","layoutParams","name","Layout","chat","entityId","contextId","LayoutManager","setLayout","EventEmitter","emit","EventType","layout","onOpenChat","Promise","resolve","forwardEntityToChat","entityConfig","textarea","forwardEntity","linesService","LinesService","getDialogIdByUserCode","optionOpenLinesV2Activated","FeatureManager","isFeatureAvailable","Feature","openLinesV2","openlinesV2","openlines","openCopilot","copilot","openCollab","collab","openHistory","isDialogId","checkHistoryDialogId","reject","sliderLink","prepareHistorySliderLink","BX","SidePanel","Instance","open","width","allowChangeHistory","allowChangeTitle","cacheable","openNotifications","notification","onOpenNotifications","openRecentSearch","recent","openSearch","openSettings","sectionName","Logger","warn","settings","openConference","code","conference","isValidCode","url","getUrlByCode","browser","openLink","getWindowNameByCode","openChatCreation","chatType","createChat","startVideoCall","withVideo","error","CallManager","startCall","startPhoneCall","number","params","PhoneManager","startCallList","callListId","openNewTab","path","DesktopApi","isChatTab","isFeatureSupported","DesktopFeature","id","createImTab","GetParameter","desktopChatTabMode","isLinesHistoryId","getParams","URLSearchParams","backgroundType"],"mappings":"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"}